---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BlogPost from "../layouts/BlogPost.astro";

export async function getStaticPaths() {
  const posts = (await getCollection("blog")).sort(
    (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
      b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
  );

  return posts.map((post: CollectionEntry<"blog">, index: number) => {
    const previousPost = posts[index - 1];
    const nextPost = posts[index + 1];

    return {
      params: { slug: post.id },
      props: {
        ...post,
        previousPost: previousPost
          ? { title: previousPost.data.title, url: `/${previousPost.id}/` }
          : null,
        nextPost: nextPost
          ? { title: nextPost.data.title, url: `/${nextPost.id}/` }
          : null,
      },
    };
  });
}
type PostNav = {
  title: string;
  url: string;
};

type Props = CollectionEntry<"blog"> & {
  previousPost: PostNav | null;
  nextPost: PostNav | null;
};

const post = Astro.props as Props;
const { Content } = await render(post);
---

<BlogPost
  {...post.data}
  previousPost={post.previousPost}
  nextPost={post.nextPost}
>
  <Content />
</BlogPost>
