---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";

type Props = {
  post: CollectionEntry<"blog">;
  slug: string;
  excerpt: string;
};

const { post, slug, excerpt } = Astro.props;
const { title, description, author, organization, pubDate } = post.data;

// Generate the full URL to the post using site/base from Astro config
const basePath = import.meta.env.BASE_URL || "/";
const normalizedBase = basePath.endsWith("/") ? basePath : `${basePath}/`;
const postPath = `${normalizedBase}${slug}/`;
const postUrl = Astro.site
  ? new URL(postPath, Astro.site).toString()
  : postPath;

const styles = {
  table:
    "width: 100%; max-width: 600px; margin: 0 auto 2em auto; border-collapse: collapse;",
  cell: "padding: 1.5em; background: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px;",
  title:
    "margin: 0 0 0.5em 0; font-size: 1.5em; line-height: 1.3; color: #1a1a1a; font-family: sans-serif;",
  meta: "margin: 0 0 1em 0; font-size: 0.9em; color: #666; font-style: italic; font-family: sans-serif;",
  description:
    "margin: 0 0 1em 0; font-size: 1em; line-height: 1.6; color: #555; font-weight: 500; font-family: sans-serif;",
  body: "margin: 0 0 1em 0; font-family: sans-serif; font-size: 1em; line-height: 1.6; color: #333;",
  buttonWrap: "margin: 1.5em 0 0 0; font-family: sans-serif;",
  button:
    "display: inline-block; padding: 0.6em 1.2em; background: #0066cc; color: #ffffff; text-decoration: none; border-radius: 4px; font-weight: 500;",
  separator:
    "width: 100%; max-width: 600px; margin: 0 auto 2em auto; border-collapse: collapse;",
  separatorCell: "height: 1px; background: #e0e0e0;",
};
---

<!-- Email-friendly post container using table layout -->
<table role="presentation" style={styles.table}>
  <tr>
    <td style={styles.cell}>
      <!-- Post Title -->
      <h2 style={styles.title}>
        <a
          href={postUrl}
          style="color: #1a1a1a; text-decoration: none;"
          target="_blank"
        >
          {title}
        </a>
      </h2>

      <!-- Author and Date -->
      <p style={styles.meta}>
        By {author}{organization ? ` (${organization})` : ""} • <FormattedDate
          date={pubDate}
        />
      </p>

      <!-- Description/Summary -->
      {description && <p style={styles.description}>{description}</p>}

      <!-- Excerpt Content -->
      <div style={styles.body} set:html={excerpt} />

      <!-- Read More Link -->
      <p style={styles.buttonWrap}>
        <a href={postUrl} style={styles.button} target="_blank">
          Read Full Post →
        </a>
      </p>
    </td>
  </tr>
</table>

<!-- Separator -->
<table role="presentation" style={styles.separator}>
  <tr>
    <td style={styles.separatorCell}></td>
  </tr>
</table>
