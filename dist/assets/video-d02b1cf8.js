import{av as W,bn as L,r as u,ad as M,j as p,a as I,s as z}from"./index-51be1395.js";import{s as F}from"./css-14ccef8c.js";import{V as _}from"./visibility-sensor-31436047.js";const B=z.div`
&: focus {
  outline: 2px solid var(--canvastext);
  outline-offset: 2px;
}
`,O=W.memo(function(x){var Y;let{name:q,id:g,SVs:n,actions:a,callAction:l}=L(x),r=u.useRef(null),T=u.useRef(null),o=u.useRef(null),i=u.useRef([]),s=u.useRef(null),R=u.useRef(null),P=u.useRef(0),d=u.useRef(null),w=u.useRef(null),f=u.useRef(null),A=e=>{l({action:a.recordVisibilityChange,args:{isVisible:e}})};u.useEffect(()=>()=>{l({action:a.recordVisibilityChange,args:{isVisible:!1}})},[]),u.useEffect(()=>{if(n.youtube){let e=M(g);window.YT&&(r.current=new window.YT.Player(e,{playerVars:{autoplay:0,controls:1,modestbranding:1,rel:0},events:{onReady:U,onStateChange:j,onPlaybackRateChange:G}}))}},[window.YT]);function N(){let e=r.current.getCurrentTime(),t;T.current?t=e-T.current:t=e-o.current,!(o.current>=0)||t>0&&t<1?(o.current=e,T.current=null):t!==0&&(T.current=e);let m=Math.floor(e);m!==f.current&&(f.current=m,l({action:a.setTime,args:{time:m}}))}function U(e){l({action:a.recordVideoReady,args:{duration:r.current.getDuration()}})}function j(e){let t=r.current.getDuration();switch(e.data){case window.YT.PlayerState.PLAYING:if(s.current!==e.data){let c=r.current.getCurrentTime();if(clearInterval(w.current),w.current=window.setInterval(N,200),s.current===window.YT.PlayerState.PAUSED){let v=c-P.current;(v<0||v>.5)&&l({action:a.recordVideoSkipped,args:{beginTime:P.current,endTime:c,duration:t}})}let E=r.current.getPlaybackRate();i.current=[{startingPoint:c,rate:E}],d.current=c,o.current=c,T.current=null,l({action:a.recordVideoStarted,args:{beginTime:r.current.getCurrentTime(),duration:t,rate:E}}),s.current=e.data}break;case window.YT.PlayerState.PAUSED:let m=s.current,k=d.current,y=r.current.getCurrentTime();R.current=setTimeout(function(){clearInterval(w.current),m===window.YT.PlayerState.PLAYING&&y>k&&(i.current[i.current.length-1].endingPoint=y,l({action:a.recordVideoWatched,args:{beginTime:k,endTime:y,duration:t,rates:i.current}}),d.current=null),l({action:a.recordVideoPaused,args:{endTime:y,duration:t}}),P.current=y,s.current=e.data},250);break;case window.YT.PlayerState.BUFFERING:clearTimeout(R.current);let D=r.current.getCurrentTime();if(d.current!==null){let c=d.current;o.current>c&&(i.current[i.current.length-1].endingPoint=o.current,l({action:a.recordVideoWatched,args:{beginTime:c,endTime:o.current,duration:t,rates:i.current}}),c=o.current),l({action:a.recordVideoSkipped,args:{beginTime:c,endTime:D,duration:t}}),s.current=e.data,d.current=null,o.current=D,T.current=null}break;case window.YT.PlayerState.ENDED:clearInterval(w.current);let h=d.current,V=r.current.getCurrentTime();i.current.length>0&&h!==null&&V>h&&(i.current[i.current.length-1].endingPoint=V,l({action:a.recordVideoWatched,args:{beginTime:h,endTime:V,duration:t,rates:i.current}}),d.current=null),l({action:a.recordVideoCompleted,args:{duration:t}}),s.current=e.data;break;case window.YT.PlayerState.UNSTARTED:s.current=e.data;break}}function G(e){let t=r.current.getCurrentTime();i.current[i.current.length-1].endingPoint=t,i.current.push({startingPoint:t,rate:e.data})}if((Y=r.current)!=null&&Y.getPlayerState){let e=r.current.getPlayerState();if(n.state==="playing"?(e===window.YT.PlayerState.UNSTARTED||e===window.YT.PlayerState.PAUSED||e===window.YT.PlayerState.CUED||e===window.YT.PlayerState.ENDED)&&r.current.playVideo():n.state==="stopped"&&e===window.YT.PlayerState.PLAYING&&r.current.pauseVideo(),n.time!==Number(f.current)){let t=n.time,m=r.current.getDuration();t>m&&(t=Math.floor(m),l({action:a.setTime,args:{time:t}})),t!==Number(f.current)&&(r.current.getPlayerState()===window.YT.PlayerState.CUED?(r.current.pauseVideo(),r.current.seekTo(t,!0),setTimeout(()=>r.current.pauseVideo(),200)):r.current.seekTo(t,!0),f.current=t)}}if(n.hidden)return null;let b={};n.displayMode==="inline"?b={display:"inline-block",verticalAlign:"middle",margin:"12px 0"}:b={display:"flex",justifyContent:n.horizontalAlign,margin:"12px 0"};let C={maxWidth:"100%",width:F(n.width),aspectRatio:String(n.aspectRatio)},S;return n.youtube?S=p("iframe",{id:g,style:C,src:"https://www.youtube.com/embed/"+n.youtube+"?enablejsapi=1&rel=0&modestbranding=1",allow:"autoplay; fullscreen"}):n.source?S=I("video",{className:"video",id:g,controls:!0,style:C,children:[p("source",{src:n.source,type:`video/${n.source.split("/").pop().split(".").pop()}`}),"Your browser does not support the <video> tag."]}):S=p("span",{id:g}),p(_,{partialVisibility:!0,onChange:A,children:I(B,{tabIndex:"0",style:b,id:g+"_outer",children:[p("a",{name:g}),S]})})});export{O as default};
