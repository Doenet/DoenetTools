import{av as V,bn as W,r as a,l as H,bs as q,j as F,a as K,F as Q,b9 as Z}from"./index-ab5ab855.js";import{BoardContext as $,POINT_LAYER_OFFSET as U}from"./graph-7de05658.js";import"./css-14ccef8c.js";import"./visibility-sensor-7b80a154.js";const ie=V.memo(function p(v){var _,E;let{name:z,id:X,SVs:e,actions:g,sourceOfUpdate:L,callAction:x}=W(v);p.ignoreActionsWithoutCore=!0;const s=a.useContext($);let t=a.useRef(null),r=a.useRef(null),S=a.useRef(!1),M=a.useRef(!1),k=a.useRef(!1),G=a.useRef(null),J=a.useRef(null),w=a.useRef(null),O=a.useRef(null),D=a.useRef(null);D.current=e.numericalXs;const B=H(q),A=e.open||["cross","plus"].includes(e.selectedStyle.markerStyle);a.useEffect(()=>()=>{t.current!==null&&(r.current.off("drag"),r.current.off("down"),r.current.off("up"),s.removeObject(t.current),s.removeObject(r.current),t.current=null,r.current=null)},[]);function Y(){let c=B==="dark"?e.selectedStyle.markerColorDarkMode:e.selectedStyle.markerColor;c=c.toLowerCase();let C=A?"var(--canvas)":c,R=A?c:"none",h=!e.draggable||e.fixed,m=e.showLabel&&e.labelForGraph!=="",o={name:e.labelForGraph,visible:!e.hidden,withlabel:m,fixed:!0,layer:10*e.layer+U,fillColor:C,strokeColor:R,strokeOpacity:e.selectedStyle.lineOpacity,fillOpacity:e.selectedStyle.lineOpacity,highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),highlightStrokeColor:getComputedStyle(document.documentElement).getPropertyValue("--lightBlue"),size:I(e.selectedStyle.markerSize,e.selectedStyle.markerStyle),face:j(e.selectedStyle.markerStyle),highlight:!h};if(m){let i,n,l;e.labelPosition==="upperright"?(l=[5,5],i="left",n="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],i="right",n="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],i="left",n="top"):e.labelPosition==="lowerleft"?(l=[-5,-5],i="right",n="top"):e.labelPosition==="top"?(l=[0,10],i="middle",n="bottom"):e.labelPosition==="bottom"?(l=[0,-10],i="middle",n="top"):e.labelPosition==="left"?(l=[-10,0],i="right",n="middle"):(l=[10,0],i="left",n="middle"),o.label={offset:l,anchorx:i,anchory:n,highlight:!1},e.labelHasLatex&&(o.label.useMathJax=!0),e.applyStyleToLabel?o.label.strokeColor=c:o.label.strokeColor="var(--canvastext)"}else o.label={highlight:!1},e.labelHasLatex&&(o.label.useMathJax=!0);h?o.showInfoBox=!1:o.showInfoBox=e.showCoordsWhenDragging;let d=[e.numericalXs[0],e.numericalXs[1]];Number.isFinite(d[0])||(d[0]=0,o.visible=!1),Number.isFinite(d[1])||(d[1]=0,o.visible=!1);let P={...o};P.fixed=h,P.showInfoBox=!1,P.withlabel=!1,P.fillOpacity=0,P.strokeOpacity=0;let b=s.create("point",d,P),y=s.create("point",d,o);b.on("down",function(i){S.current=[i.x,i.y],M.current=[...b.coords.scrCoords],k.current=!1,r.current.visProp.fillopacity=t.current.visProp.fillopacity,r.current.visProp.strokeopacity=t.current.visProp.strokeopacity,x({action:g.mouseDownOnPoint})}),b.on("up",function(i){k.current?x({action:g.movePoint,args:{x:w.current,y:O.current}}):e.switchable&&!e.fixed?(x({action:g.switchPoint}),x({action:g.pointClicked})):x({action:g.pointClicked}),k.current=!1,r.current.visProp.fillopacity=0,r.current.visProp.strokeopacity=0}),b.on("drag",function(i){var n=s.origin.scrCoords;let[l,u,f,T]=s.getBoundingBox();w.current=(M.current[1]+i.x-S.current[0]-n[1])/s.unitX,w.current=Math.min(f,Math.max(l,w.current)),O.current=(n[2]-(M.current[2]+i.y-S.current[1]))/s.unitY,O.current=Math.min(u,Math.max(T,O.current)),x({action:g.movePoint,args:{x:w.current,y:O.current,transient:!0,skippable:!0}}),y.coords.setCoordinates(JXG.COORDS_BY_USER,D.current),s.updateInfobox(y),(Math.abs(i.x-S.current[0])>.1||Math.abs(i.y-S.current[1])>.1)&&(k.current=!0)}),t.current=y,r.current=b,J.current=e.labelPosition,G.current=m}if(s){if(t.current===null)Y();else{let c=B==="dark"?e.selectedStyle.markerColorDarkMode:e.selectedStyle.markerColor;c=c.toLowerCase();let C=A?"var(--canvas)":c,R=A?c:"none";t.current.visProp.fillcolor!==C&&(t.current.visProp.fillcolor=C);let h=(_=e.numericalXs)==null?void 0:_[0],m=(E=e.numericalXs)==null?void 0:E[1];t.current.coords.setCoordinates(JXG.COORDS_BY_USER,[h,m]),k.current||r.current.coords.setCoordinates(JXG.COORDS_BY_USER,[h,m]);let o=!e.hidden;if(Number.isFinite(h)&&Number.isFinite(m)){let l=t.current.visProp.visible!==o;t.current.visProp.visible=o,t.current.visPropCalc.visible=o,r.current.visProp.visible=o,r.current.visPropCalc.visible=o,l&&(t.current.setAttribute({visible:o}),r.current.setAttribute({visible:o}))}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1,r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;let d=10*e.layer+U;t.current.visProp.layer!==d&&(t.current.setAttribute({layer:d}),r.current.setAttribute({layer:d}));let b=!e.draggable||e.fixed;t.current.visProp.highlight=!b,r.current.visProp.highlight=!b,r.current.visProp.fixed=b,t.current.visProp.strokecolor!==R&&(t.current.visProp.strokecolor=R,r.current.visProp.strokecolor=R,t.current.visProp.fillColor=C,r.current.visProp.fillColor=C),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.fillopacity=e.selectedStyle.lineOpacity);let y=j(e.selectedStyle.markerStyle);t.current.visProp.face!==y&&(t.current.setAttribute({face:y}),r.current.setAttribute({face:y}));let i=I(e.selectedStyle.markerSize,e.selectedStyle.markerStyle);t.current.visProp.size!==i&&(t.current.setAttribute({size:i}),r.current.setAttribute({size:i})),b?t.current.visProp.showinfobox=!1:t.current.visProp.showinfobox=e.showCoordsWhenDragging,L.sourceInformation&&z in L.sourceInformation&&s.updateInfobox(t.current),t.current.name=e.labelForGraph;let n=e.showLabel&&e.labelForGraph!=="";if(n!=G.current&&(t.current.setAttribute({withlabel:n}),G.current=n),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=c:t.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==J.current){let l,u,f;e.labelPosition==="upperright"?(f=[5,5],l="left",u="bottom"):e.labelPosition==="upperleft"?(f=[-5,5],l="right",u="bottom"):e.labelPosition==="lowerright"?(f=[5,-5],l="left",u="top"):e.labelPosition==="lowerleft"?(f=[-5,-5],l="right",u="top"):e.labelPosition==="top"?(f=[0,10],l="middle",u="bottom"):e.labelPosition==="bottom"?(f=[0,-10],l="middle",u="top"):e.labelPosition==="left"?(f=[-10,0],l="right",u="middle"):(f=[10,0],l="left",u="middle"),t.current.label.visProp.anchorx=l,t.current.label.visProp.anchory=u,t.current.label.visProp.offset=f,J.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();t.current.needsUpdate=!0,t.current.update(),r.current.needsUpdate=!0,r.current.update(),s.updateRenderer()}return F("a",{name:X})}if(e.hidden)return null;let N="\\("+e.latex+"\\)";return K(Q,{children:[F("a",{name:X}),F("span",{id:X,children:F(Z.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:N})})]})});function I(p,v){return v==="diamond"?p*1.4:v==="plus"?p*1.2:v==="square"?p*1.1:v.substring(0,8)==="triangle"?p*1.5:p}function j(p){return p==="triangle"?"triangleup":p}export{ie as default};
