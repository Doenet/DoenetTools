import{r as i,v as q,g as D,w as k,j as e,a as m,B as j,C as H}from"./index-a1cd8b25.js";import{T as _}from"./Textfield-07b7a0c1.js";var P={},Q={get exports(){return P},set exports(y){P=y}};/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */(function(y,h){(function(C){var u;if(y.exports=C(),u=!0,!u){var w=window.Cookies,a=window.Cookies=C();a.noConflict=function(){return window.Cookies=w,a}}})(function(){function C(){for(var a=0,s={};a<arguments.length;a++){var r=arguments[a];for(var o in r)s[o]=r[o]}return s}function u(a){return a.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function w(a){function s(){}function r(l,c,t){if(!(typeof document>"u")){t=C({path:"/"},s.defaults,t),typeof t.expires=="number"&&(t.expires=new Date(new Date*1+t.expires*864e5)),t.expires=t.expires?t.expires.toUTCString():"";try{var x=JSON.stringify(c);/^[\{\[]/.test(x)&&(c=x)}catch{}c=a.write?a.write(c,l):encodeURIComponent(String(c)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),l=encodeURIComponent(String(l)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var p="";for(var g in t)t[g]&&(p+="; "+g,t[g]!==!0&&(p+="="+t[g].split(";")[0]));return document.cookie=l+"="+c+p}}function o(l,c){if(!(typeof document>"u")){for(var t={},x=document.cookie?document.cookie.split("; "):[],p=0;p<x.length;p++){var g=x[p].split("="),f=g.slice(1).join("=");!c&&f.charAt(0)==='"'&&(f=f.slice(1,-1));try{var S=u(g[0]);if(f=(a.read||a)(f,S)||u(f),c)try{f=JSON.parse(f)}catch{}if(t[S]=f,l===S)break}catch{}}return l?t[l]:t}}return s.set=r,s.get=function(l){return o(l,!1)},s.getJSON=function(l){return o(l,!0)},s.remove=function(l,c){r(l,"",C(c,{expires:-1}))},s.defaults={},s.withConverter=w,s}return w(function(){})})})(Q);const X=P;function te(y){let[h,C]=i.useState(""),[u,w]=i.useState(""),[a,s]=i.useState(0),[r,o]=i.useState("init"),[l,c]=i.useState(!1),[t,x]=i.useState(""),[p,g]=i.useState(!1),[f,S]=i.useState(!1),[I,b]=i.useState(!1),[R,L]=i.useState(!1),[z,J]=i.useState(!0),[K,U]=i.useState(!0),[B,M]=i.useState(""),[T,V]=i.useState(""),[G,W]=i.useState("");const Z=X.get(),$=i.useRef(null),O=i.useRef(null),A=q();function F(n){/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(n)?(J(!1),b(!0),g(!1)):(J(!0),b(!1),g(!0))}if(i.useEffect(()=>{/\d{9}/.test(u)?(U(!1),L(!0),S(!1)):u===""?(U(!0),L(!1),S(!1)):(U(!0),L(!1),S(!0)),O.current!==null&&!R?O.current.focus():$.current!==null&&!I&&$.current.focus()}),Object.keys(Z).includes("JWT_JS"))return D.get("/api/loadProfile.php",{params:{}}).then(n=>{localStorage.setItem("Profile",JSON.stringify(n.data.profile)),location.href="/"}).catch(n=>{console.log(n)}),null;if(r==="check code"){const d={params:{emailaddress:h,nineCode:u,deviceName:t}};return D.get("/api/checkCredentials.php",d).then(v=>{if(v.data.success){let N="1";v.data.existed&&(N="0");let E="0";a>0&&(E="1"),v.data.hasFullName==0?(o("Need Name Entered"),W(`/api/jwt.php?emailaddress=${encodeURIComponent(h)}&nineCode=${encodeURIComponent(u)}&deviceName=${t}&newAccount=${N}&stay=${E}`)):location.href=`/api/jwt.php?emailaddress=${encodeURIComponent(h)}&nineCode=${encodeURIComponent(u)}&deviceName=${t}&newAccount=${N}&stay=${E}`}else v.data.reason==="Code expired"?o("Code expired"):v.data.reason==="Invalid Code"&&(o("enter code"),A("Invalid code. Please try again.",k.ERROR))}).catch(v=>{console.error(v)}),o("Loading"),null}if(r==="Need Name Entered")return e("div",{children:m("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:[e("h2",{style:{textAlign:"center"},children:"Please enter your first and last name."}),m("div",{style:{display:"flex",flexDirection:"column",rowGap:"10px"},children:[m("div",{children:["First Name:"," ",e("input",{type:"text",value:B,onChange:n=>{M(n.target.value)}})]}),m("div",{children:["Last Name:"," ",e("input",{type:"text",value:T,onChange:n=>{V(n.target.value)}})]}),e(j,{disabled:B==""||T=="",value:"Submit",onClick:()=>{D.get("/api/saveUsersName.php",{params:{firstName:B,lastName:T,email:h}}).then(n=>{location.href=G})}})]})]})});if(r==="Loading")return e("div",{children:e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:e("h2",{style:{textAlign:"center"},children:"Signing in..."})})});if(r==="Code expired")return m("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:[e("h2",{style:{textAlign:"center"},children:"Code Expired"}),e(j,{onClick:()=>{location.href="/signin"},value:"Restart Signin"})]});if(r==="enter code"||r==="Invalid Code"){if(!l){const d="/api/sendSignInEmail.php",N={params:{emailaddress:h}};D.get(d,N).then(E=>{x(E.data.deviceName)}).catch(E=>{this.setState({error:E})}),c(!0)}let n=e("h2",{style:{textAlign:"center"},children:"Email Sent!"});return r==="Invalid Code"&&(n=e("h2",{style:{textAlign:"center"},children:"Invalid Code. Try again."})),e("div",{style:y.style,children:m("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:[n,m("div",{style:{weight:"bold",fontSize:"14px"},children:["Device Name: ",t]}),e("div",{children:e("p",{style:{fontSize:"14px"},children:"Check your email for a code to complete sign in."})}),e("p",{children:e(_,{label:"Code (9 digit code):",ref:O,value:u,dataTest:"signinCodeInput",alert:f,onKeyDown:d=>{d.key==="Enter"&&R?o("check code"):d.key==="Enter"&&!R&&A("Invalid code format. Please enter 9 digits.",k.ERROR)},onBlur:()=>{!R&&!f&&A("Invalid code format. Please enter 9 digits.",k.ERROR)},onChange:d=>{w(d.target.value)}})}),e(j,{disabled:K,onClick:()=>{R&&o("check code")},dataTest:"signInButton",value:"Sign In"})]})})}if(r==="init"){let n=0;return a>0&&(n=1),e("div",{style:y.style,children:m("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",margin:"20"},children:[e("img",{style:{width:"250px",height:"250px"},alt:"Doenet Logo",src:"/Doenet_Logo_Frontpage.png"}),m("div",{children:[e("p",{style:{marginLeft:"2px"},children:e(_,{dataTest:"email input",label:"Email Address:",ref:$,value:h,alert:p,onKeyDown:d=>{F(h),d.key==="Enter"&&I?o("enter code"):d.key==="Enter"&&!I&&A("Invalid email. Please try again.",k.ERROR)},onBlur:()=>{F(h),!I&&!p&&A("Invalid email. Please try again.",k.ERROR)},onChange:d=>{C(d.target.value)}})}),m("p",{style:{fontSize:"14px"},children:[e(H,{checked:n,onClick:d=>{s(n?0:24e4)}})," ","Stay Logged In"]}),e(j,{disabled:z,onClick:()=>{I&&o("enter code")},dataTest:"sendEmailButton",value:"Send Email"})]})]})})}return e("div",{style:y.style,children:e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",margin:"20"},children:e("h2",{style:{textAlign:"center"},children:"Loading..."})})})}export{te as default};
