import{aw as B,bn as T,r as d,j as x,F as J}from"./index-1922ac75.js";import{BoardContext as V,LINE_LAYER_OFFSET as U,VERTEX_LAYER_OFFSET as G}from"./graph-58b7c38a.js";import"./css-14ccef8c.js";import"./visibility-sensor-740cae0e.js";const z=B.memo(function v(Y){let{name:X,id:A,SVs:e,actions:p,sourceOfUpdate:k,callAction:f}=T(Y);v.ignoreActionsWithoutCore=!0;const c=d.useContext(V);let t=d.useRef(null),o=d.useRef(null),i=d.useRef(null),m=d.useRef(!1),O=d.useRef(!1),h=d.useRef(null),w=d.useRef(null),E=d.useRef(null),a=d.useRef(null),y=d.useRef(null),L=d.useRef(null);L.current=e.numericalEndpoints,d.useEffect(()=>()=>{t.current&&_()},[]);function j(){if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(r=>r.length!==2)){t.current=null,o.current=null,i.current=null;return}let n=!e.draggable||e.fixed,u=e.showLabel&&e.labelForGraph!=="";var s={name:e.labelForGraph,visible:!e.hidden,withlabel:u,fixed:n,layer:10*e.layer+U,strokeColor:e.selectedStyle.lineColor,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:e.selectedStyle.lineColor,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:W(e.selectedStyle.lineStyle),highlight:!n};if(u){let r,g,l;e.labelPosition==="upperright"?(l=[5,5],r="left",g="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],r="right",g="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],r="left",g="top"):(l=[-5,-5],r="right",g="top"),s.label={offset:l,anchorx:r,anchory:g,highlight:!1},e.labelHasLatex&&(s.label.useMathJax=!0),e.applyStyleToLabel?s.label.strokeColor=e.selectedStyle.lineColor:s.label.strokeColor="#000000"}else s.label={highlight:!1},e.labelHasLatex&&(s.label.useMathJax=!0);let b=!(!e.endpointsDraggable||e.fixed)&&!e.hidden,S=Object.assign({},s);Object.assign(S,{withLabel:!1,fixed:!1,highlight:!0,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*e.layer+G,showInfoBox:e.showCoordsWhenDragging,visible:b});let F=[[...e.numericalEndpoints[0]],[...e.numericalEndpoints[1]]];return o.current=c.create("point",F[0],S),i.current=c.create("point",F[1],S),t.current=c.create("segment",[o.current,i.current],s),o.current.on("drag",r=>R(1,r)),i.current.on("drag",r=>R(2,r)),t.current.on("drag",r=>R(0,r)),o.current.on("up",()=>{h.current===1?f({action:p.moveLineSegment,args:{point1coords:a.current}}):h.current===null&&f({action:p.lineSegmentClicked}),y.current=null}),i.current.on("up",()=>{h.current===2?f({action:p.moveLineSegment,args:{point2coords:a.current}}):h.current===null&&f({action:p.lineSegmentClicked}),y.current=null}),t.current.on("up",function(r){h.current===0?f({action:p.moveLineSegment,args:{point1coords:a.current[0],point2coords:a.current[1]}}):h.current===null&&y.current===null&&f({action:p.lineSegmentClicked})}),o.current.on("down",r=>{h.current=null,m.current=[r.x,r.y],y.current=1,f({action:p.mouseDownOnLineSegment})}),i.current.on("down",r=>{h.current=null,m.current=[r.x,r.y],y.current=2,f({action:p.mouseDownOnLineSegment})}),t.current.on("down",function(r){h.current=null,m.current=[r.x,r.y],O.current=[[...o.current.coords.scrCoords],[...i.current.coords.scrCoords]],y.current===null&&f({action:p.mouseDownOnLineSegment})}),E.current=e.labelPosition,w.current=u,t.current}function R(n,u){(Math.abs(u.x-m.current[0])>.1||Math.abs(u.y-m.current[1])>.1)&&(h.current=n,n==1?(a.current=[t.current.point1.X(),t.current.point1.Y()],f({action:p.moveLineSegment,args:{point1coords:a.current,transient:!0,skippable:!0,sourceDetails:{endpoint:n}}})):n==2?(a.current=[t.current.point2.X(),t.current.point2.Y()],f({action:p.moveLineSegment,args:{point2coords:a.current,transient:!0,skippable:!0,sourceDetails:{endpoint:n}}})):(I(u),f({action:p.moveLineSegment,args:{point1coords:a.current[0],point2coords:a.current[1],transient:!0,skippable:!0}}))),t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,L.current[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,L.current[1]),n==1?c.updateInfobox(t.current.point1):n==2&&c.updateInfobox(t.current.point2)}function I(n){var u=c.origin.scrCoords;a.current=[];for(let s=0;s<2;s++){let D=(O.current[s][1]+n.x-m.current[0]-u[1])/c.unitX,b=(u[2]-(O.current[s][2]+n.y-m.current[1]))/c.unitY;a.current.push([D,b])}return a.current}function _(){t.current.off("drag"),t.current.off("down"),t.current.off("up"),c.removeObject(t.current),t.current=null,o.current.off("drag"),o.current.off("down"),o.current.off("up"),c.removeObject(o.current),o.current=null,i.current.off("drag"),i.current.off("down"),i.current.off("up"),c.removeObject(i.current),i.current=null}if(c){if(t.current===null)j();else if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(n=>n.length!==2))_();else{let n=!0;for(let l of[e.numericalEndpoints[0],e.numericalEndpoints[1]])Number.isFinite(l[0])||(n=!1),Number.isFinite(l[1])||(n=!1);if(t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[1]),k.sourceInformation&&X in k.sourceInformation){let l=k.sourceInformation[X].endpoint;l===1?c.updateInfobox(t.current.point1):l===2&&c.updateInfobox(t.current.point2)}let u=!e.hidden&&n;if(n){let l=t.current.visProp.visible!==u;t.current.visProp.visible=u,t.current.visPropCalc.visible=u,l&&t.current.setAttribute({visible:u})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let s=!e.draggable||e.fixed,b=!(!e.endpointsDraggable||e.fixed)&&u;o.current.visProp.visible=b,o.current.visPropCalc.visible=b,i.current.visProp.visible=b,i.current.visPropCalc.visible=b,t.current.visProp.fixed=s,t.current.visProp.highlight=!s;let S=10*e.layer+U;t.current.visProp.layer!==S&&(t.current.setAttribute({layer:S}),o.current.setAttribute({layer:10*e.layer+G}),i.current.setAttribute({layer:10*e.layer+G})),t.current.visProp.strokecolor!==e.selectedStyle.lineColor&&(t.current.visProp.strokecolor=e.selectedStyle.lineColor,t.current.visProp.highlightstrokecolor=e.selectedStyle.lineColor),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let r=W(e.selectedStyle.lineStyle);t.current.visProp.dash!==r&&(t.current.visProp.dash=r),t.current.name=e.labelForGraph;let g=e.showLabel&&e.labelForGraph!=="";if(g!=w.current&&(t.current.setAttribute({withlabel:g}),w.current=g),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=e.selectedStyle.lineColor:t.current.label.visProp.strokecolor="#000000",e.labelPosition!==E.current){let l,P,C;e.labelPosition==="upperright"?(C=[5,5],l="left",P="bottom"):e.labelPosition==="upperleft"?(C=[-5,5],l="right",P="bottom"):e.labelPosition==="lowerright"?(C=[5,-5],l="left",P="top"):(C=[-5,-5],l="right",P="top"),t.current.label.visProp.anchorx=l,t.current.label.visProp.anchory=P,t.current.label.visProp.offset=C,E.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();o.current.needsUpdate=!0,o.current.update(),i.current.needsUpdate=!0,i.current.update(),c.updateRenderer()}return x(J,{children:x("a",{name:A})})}return e.hidden?null:x(J,{children:x("a",{name:A})})});function W(v){return v==="solid"?0:v==="dashed"?2:v==="dotted"?1:0}export{z as default};
