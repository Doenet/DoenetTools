import{ao as W,bn as I,r as u,bq as U,bv as Y,j as w,a as K,B as Q}from"./index-8f45050f.js";import{BoardContext as Z}from"./graph-4241e72c.js";import"./css-14ccef8c.js";const ne=W.memo(function E(M){let{name:$,id:x,SVs:t,actions:m,callAction:b}=I(M,!1);E.ignoreActionsWithoutCore=o=>o==="moveButton";let e=u.useRef(null),v=u.useRef(null),y=u.useRef(null);const i=u.useContext(Z);let p=u.useRef(!1),A=u.useRef(!1),a=u.useRef(!1),s=u.useRef(null),l=u.useRef(null),D=u.useRef(null),B=u.useRef(null),_=u.useRef(!1),P=u.useRef(!1);_.current=t.fixed,P.current=!t.draggable||t.fixLocation||t.fixed;let C=t.label?t.label:"Button";u.useEffect(()=>()=>{e.current!==null&&H()},[]);function L(){let o={visible:!t.hidden,fixed:_.current,disabled:t.disabled,useMathJax:t.labelHasLatex,parse:!1},r;try{let n=U.fromAst(t.anchor),d=[n.get_component(0).evaluate_to_constant(),n.get_component(1).evaluate_to_constant()];Number.isFinite(d[0])||(d[0]=0,o.visible=!1),Number.isFinite(d[1])||(d[1]=0,o.visible=!1),r=i.create("point",d,{visible:!1})}catch{o.visible=!1,r=i.create("point",[0,0],{visible:!1});return}o.anchor=r;let{anchorx:f,anchory:h}=Y(t.positionFromAnchor);o.anchorx=f,o.anchory=h,y.current=[f,h];let c=i.create("button",[0,0,C,()=>b({action:m[t.clickAction]})],o);c.isDraggable=!P.current,c.on("down",function(n){p.current=[n.x,n.y],A.current=[...r.coords.scrCoords],a.current=!1}),c.on("hit",function(n){a.current=!1}),c.on("up",function(n){a.current&&(b({action:m.moveButton,args:{x:s.current,y:l.current}}),a.current=!1)}),c.on("keyfocusout",function(n){a.current&&(b({action:m.moveButton,args:{x:s.current,y:l.current}}),a.current=!1)}),c.on("drag",function(n){let d=n.type==="pointermove";(!d||Math.abs(n.x-p.current[0])>.1||Math.abs(n.y-p.current[1])>.1)&&(a.current=!0);let[X,F,J,k]=i.getBoundingBox(),G=c.size[0]/i.unitX,j=c.size[1]/i.unitY,O=y.current[0],S=y.current[1],g=0;O==="middle"?g=-G/2:O==="right"&&(g=-G);let R=0;S==="middle"?R=-j/2:S==="top"&&(R=-j);let T=X+.04*(J-X)-g-G,z=J-.04*(J-X)-g,V=k+.04*(F-k)-R-j,q=F-.04*(F-k)-R;if(d){var N=i.origin.scrCoords;s.current=(A.current[1]+n.x-p.current[0]-N[1])/i.unitX,l.current=(N[2]-(A.current[2]+n.y-p.current[1]))/i.unitY}else s.current=r.X()+c.relativeCoords.usrCoords[1],l.current=r.Y()+c.relativeCoords.usrCoords[2];s.current=Math.min(z,Math.max(T,s.current)),l.current=Math.min(q,Math.max(V,l.current)),b({action:m.moveButton,args:{x:s.current,y:l.current,transient:!0,skippable:!0}}),c.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),r.coords.setCoordinates(JXG.COORDS_BY_USER,D.current)}),c.on("keydown",function(n){n.key==="Enter"&&a.current&&(b({action:m.moveButton,args:{x:s.current,y:l.current}}),a.current=!1)}),e.current=c,v.current=r,B.current=t.positionFromAnchor,t.labelHasLatex&&setTimeout(()=>{e.current&&(e.current.needsUpdate=!0,e.current.setText(C),e.current.update(),i==null||i.updateRenderer())},1e3)}function H(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),i.removeObject(e.current),e.current=null}if(i){let o;try{let r=U.fromAst(t.anchor);o=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()]}catch{o=[NaN,NaN]}if(D.current=o,e.current===null)L();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),v.current.coords.setCoordinates(JXG.COORDS_BY_USER,o),e.current.setText(C);let r=!t.hidden;if(Number.isFinite(o[0])&&Number.isFinite(o[1])){let f=e.current.visProp.visible!==r;e.current.visProp.visible=r,e.current.visPropCalc.visible=r,f&&e.current.setAttribute({visible:r})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;if(e.current.visProp.disabled!==t.disabled&&(e.current.visProp.disabled=t.disabled,e.current.setAttribute({disabled:t.disabled})),e.current.visProp.fixed=_.current,e.current.isDraggable=!P.current,e.current.needsUpdate=!0,t.positionFromAnchor!==B.current){let{anchorx:f,anchory:h}=Y(t.positionFromAnchor);e.current.visProp.anchorx=f,e.current.visProp.anchory=h,y.current=[f,h],B.current=t.positionFromAnchor,e.current.fullUpdate()}else e.current.update();v.current.needsUpdate=!0,v.current.update(),i.updateRenderer()}return w("a",{name:x})}return t.hidden?null:K("div",{id:x,margin:"12px 0",style:{display:"inline-block"},children:[w("a",{name:x}),w(Q,{id:x+"_button",onClick:()=>b({action:m[t.clickAction]}),disabled:t.disabled,value:C,valueHasLatex:t.labelHasLatex})]})});export{ne as default};
