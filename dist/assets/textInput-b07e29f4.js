import{bl as ke,r as i,R as Re,bs as we,bo as le,bt as se,j as u,H as W,bq as Ve,$ as Ae,aP as Ie,br as _e,a as C,F as te,ao as Ne,h as re,bm as Se}from"./index-a1cd8b25.js";import{s as ce}from"./css-14ccef8c.js";import{BoardContext as Be}from"./graph-36cd2399.js";const _=re.button`
  position: relative;
  height: 24px;
  width: 24px;
  display: inline-block;
  color: white;
  background-color: var(--mainBlue);
  padding: 2px;
  /* border: var(--mainBorder); */
  border: none;
  border-radius: var(--mainBorderRadius);
  margin: 0px 4px 4px 0px;

  &:hover {
    background-color: var(--lightBlue);
    color: black;
  }
`,Pe=re.textarea`
  width: ${l=>l.width};
  height: ${l=>l.height}; // Same height as the checkWorkButton, accounting for the borders
  font-size: 14px;
  border: ${l=>l.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
  cursor: ${l=>l.disabled?"not-allowed":"auto"};

  &:focus {
    outline: var(--mainBorder);
    outline-offset: 2px;
  }
`,Ee=re.input`
  width: ${l=>l.width};
  height: 20px; // Same height as the checkWorkButton, accounting for the borders
  font-size: 14px;
  border: ${l=>l.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
  cursor: ${l=>l.disabled?"not-allowed":"auto"};

  &:focus {
    outline: var(--mainBorder);
    outline-offset: 2px;
  }
`;function de(l){let{name:Le,id:m,SVs:e,actions:p,sourceOfUpdate:Fe,ignoreUpdate:pe,rendererName:fe,callAction:f}=ke(l),N=ce(e.width),me=ce(e.height);de.baseStateVariable="immediateValue",de.ignoreActionsWithoutCore=n=>n==="moveInput";const[w,M]=i.useState(e.immediateValue);let k=i.useRef(null);k.current=w;const he=Re(we(fe));let S=i.useRef(e.immediateValue),ne=i.useRef(null),V=i.useRef(null),t=i.useRef(null),B=i.useRef(null),P=i.useRef(null);const s=i.useContext(Be);let A=i.useRef(!1),T=i.useRef(!1),h=i.useRef(!1),x=i.useRef(null),v=i.useRef(null),ae=i.useRef(null),$=i.useRef(null),K=i.useRef(!1),I=i.useRef(!1);K.current=e.fixed,I.current=!e.draggable||e.fixLocation||e.fixed,i.useEffect(()=>()=>{t.current!==null&&xe()},[]),!pe&&V.current!==e.immediateValue?(M(e.immediateValue),V.current=e.immediateValue,S.current=e.immediateValue):V.current=null;let R="unvalidated";e.valueHasBeenValidated&&(e.creditAchieved===1?R="correct":e.creditAchieved===0?R="incorrect":R="partialcorrect");function E(n){n.key==="Enter"&&(S.current=k.current,f({action:p.updateValue,baseVariableValue:k.current}),e.includeCheckWork&&!e.suppressCheckwork&&!e.expanded&&R==="unvalidated"&&f({action:p.submitAnswer}))}function L(n){if(n.key==="Escape"){let r=S.current;r!==k.current&&(M(r),V.current=e.immediateValue,f({action:p.updateImmediateValue,args:{text:r},baseVariableValue:r}))}}function F(n){ne.current=!0}function G(n){ne.current=!1,S.current=k.current,f({action:p.updateValue,baseVariableValue:k.current})}function X(n){let r=n.target.value;r!==k.current&&(M(r),he(b=>{let g={...b};return g.ignoreUpdate=!0,g}),V.current=e.immediateValue,f({action:p.updateImmediateValue,args:{text:r},baseVariableValue:r}))}function be(){let n={visible:!e.hidden,fixed:K.current,disabled:e.disabled,useMathJax:e.labelHasLatex,strokeColor:"var(--canvastext)",highlightStrokeColor:"var(--canvastext)",highlight:!I.current,parse:!1},r;try{let o=le.fromAst(e.anchor),y=[o.get_component(0).evaluate_to_constant(),o.get_component(1).evaluate_to_constant()];Number.isFinite(y[0])||(y[0]=0,n.visible=!1),Number.isFinite(y[1])||(y[1]=0,n.visible=!1),r=s.create("point",y,{visible:!1})}catch{n.visible=!1,r=s.create("point",[0,0],{visible:!1});return}n.anchor=r;let{anchorx:b,anchory:g}=se(e.positionFromAnchor);n.anchorx=b,n.anchory=g,P.current=[b,g];let a=s.create("input",[0,0,w,e.label],n);a.isDraggable=!I.current,a.rendNodeInput.addEventListener("input",X),a.rendNodeInput.addEventListener("keypress",E),a.rendNodeInput.addEventListener("keydown",L),a.rendNodeInput.addEventListener("blur",G),a.rendNodeInput.addEventListener("focus",F),a.rendNodeInput.style.width=N,a.rendNodeInput.style.color="var(--canvastext)",a.rendNodeInput.style.background="var(--canvas)",a.rendNodeInput.style.borderColor="var(--canvastext)",a.rendNodeLabel.style.marginRight="2px",a.on("down",function(o){A.current=[o.x,o.y],T.current=[...r.coords.scrCoords],h.current=!1}),a.on("hit",function(o){h.current=!1}),a.on("up",function(o){h.current&&(f({action:p.moveInput,args:{x:x.current,y:v.current}}),h.current=!1)}),a.on("keyfocusout",function(o){h.current&&(f({action:p.moveInput,args:{x:x.current,y:v.current}}),h.current=!1)}),a.on("drag",function(o){let y=o.type==="pointermove";(!y||Math.abs(o.x-A.current[0])>.1||Math.abs(o.y-A.current[1])>.1)&&(h.current=!0);let[H,z,q,Q]=s.getBoundingBox(),Z=a.size[0]/s.unitX,ee=a.size[1]/s.unitY,ie=P.current[0],oe=P.current[1],j=0;ie==="middle"?j=-Z/2:ie==="right"&&(j=-Z);let O=0;oe==="middle"?O=-ee/2:oe==="top"&&(O=-ee);let ve=H+.04*(q-H)-j-Z,ge=q-.04*(q-H)-j,ye=Q+.04*(z-Q)-O-ee,Ce=z-.04*(z-Q)-O;if(y){var ue=s.origin.scrCoords;x.current=(T.current[1]+o.x-A.current[0]-ue[1])/s.unitX,v.current=(ue[2]-(T.current[2]+o.y-A.current[1]))/s.unitY}else x.current=r.X()+a.relativeCoords.usrCoords[1],v.current=r.Y()+a.relativeCoords.usrCoords[2];x.current=Math.min(ge,Math.max(ve,x.current)),v.current=Math.min(Ce,Math.max(ye,v.current)),f({action:p.moveInput,args:{x:x.current,y:v.current,transient:!0,skippable:!0}}),a.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),r.coords.setCoordinates(JXG.COORDS_BY_USER,ae.current)}),a.on("keydown",function(o){o.key==="Enter"&&h.current&&(f({action:p.moveInput,args:{x:x.current,y:v.current}}),h.current=!1)}),t.current=a,B.current=r,$.current=e.positionFromAnchor,e.labelHasLatex&&setTimeout(()=>{t.current&&(t.current.needsUpdate=!0,t.current.setText(e.label),t.current.update(),s==null||s.updateRenderer())},1e3)}function xe(){t.current.rendNodeInput.removeEventListener("input",X),t.current.rendNodeInput.removeEventListener("keypress",E),t.current.rendNodeInput.removeEventListener("keydown",L),t.current.rendNodeInput.removeEventListener("blur",G),t.current.rendNodeInput.removeEventListener("focus",F),t.current.off("drag"),t.current.off("down"),t.current.off("hit"),t.current.off("up"),t.current.off("keyfocusout"),t.current.off("keydown"),s.removeObject(t.current),t.current=null}if(s){let n;try{let r=le.fromAst(e.anchor);n=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()]}catch{n=[NaN,NaN]}if(ae.current=n,t.current===null)be();else{t.current.Value()!==w&&t.current.set(w),t.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),B.current.coords.setCoordinates(JXG.COORDS_BY_USER,n),t.current.setText(e.label),t.current.rendNodeInput.style.width=N;let r=!e.hidden;if(Number.isFinite(n[0])&&Number.isFinite(n[1])){let b=t.current.visProp.visible!==r;t.current.visProp.visible=r,t.current.visPropCalc.visible=r,b&&t.current.setAttribute({visible:r})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;if(t.current.visProp.disabled!==e.disabled&&(t.current.visProp.disabled=e.disabled,t.current.setAttribute({disabled:e.disabled})),t.current.visProp.highlight=!I.current,t.current.visProp.fixed=K.current,t.current.isDraggable=!I.current,t.current.needsUpdate=!0,e.positionFromAnchor!==$.current){let{anchorx:b,anchory:g}=se(e.positionFromAnchor);t.current.visProp.anchorx=b,t.current.visProp.anchory=g,P.current=[b,g],$.current=e.positionFromAnchor,t.current.fullUpdate()}else t.current.update();B.current.needsUpdate=!0,B.current.update(),s.updateRenderer()}return u("a",{name:m})}if(e.hidden)return null;let D=e.disabled;const J=m+"_input";let c={cursor:"pointer",padding:"1px 6px 1px 6px"};D&&(c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),c.cursor="not-allowed",c.color="black");let d=null;if(e.includeCheckWork&&!e.suppressCheckwork){if(R==="unvalidated")d=u(_,{id:m+"_submit",tabIndex:"0",disabled:D,style:c,onClick:()=>f({action:p.submitAnswer}),onKeyPress:n=>{n.key==="Enter"&&f({action:p.submitAnswer})},children:u(W,{style:{},icon:Ve,transform:{rotate:90}})});else if(e.showCorrectness)if(R==="correct")c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGreen"),d=u(_,{id:m+"_correct",style:c,children:u(W,{icon:Ae})});else if(R==="partialcorrect"){let r=`${Math.round(e.creditAchieved*100)} %`;c.width="44px",c.backgroundColor="#efab34",d=u(_,{id:m+"_partial",style:c,children:r})}else c.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainRed"),d=u(_,{id:m+"_incorrect",style:c,children:u(W,{icon:Ie})});else c.backgroundColor="rgb(74, 3, 217)",c.padding="1px 8px 1px 4px",d=u(_,{id:m+"_saved",style:c,children:u(W,{icon:_e})});e.numAttemptsLeft<0?d=C(te,{children:[d,u("span",{children:"(no attempts remaining)"})]}):e.numAttemptsLeft==1?d=C(te,{children:[d,u("span",{children:"(1 attempt remaining)"})]}):Number.isFinite(e.numAttemptsLeft)&&(d=C(te,{children:[d,C("span",{children:["(attempts remaining: ",e.numAttemptsLeft,")"]})]}))}let Y,U=e.label;return e.labelHasLatex&&(U=u(Se.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:U})),e.expanded?Y=C("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[U,u(Pe,{id:J,value:w,disabled:D,onChange:X,onKeyPress:E,onKeyDown:L,onBlur:G,onFocus:F,width:N,height:me,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},J)]}):Y=C("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[U,u(Ee,{id:J,value:w,disabled:D,onChange:X,onKeyPress:E,onKeyDown:L,onBlur:G,onFocus:F,width:N,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},J)]}),C(Ne.Fragment,{children:[u("a",{name:m}),C("span",{className:"textInputSurroundingBox",id:m,style:{display:"inline-flex",maxWidth:"100%"},children:[Y,d]})]})}export{de as default};
