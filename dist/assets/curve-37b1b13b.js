import{av as ye,bn as xe,r as d,l as we,bs as Re,bt as P,j as R,F as B}from"./index-ab5ab855.js";import{BoardContext as Te,LINE_LAYER_OFFSET as ge,VERTEX_LAYER_OFFSET as N,CONTROL_POINT_LAYER_OFFSET as me}from"./graph-7de05658.js";import"./css-14ccef8c.js";import"./visibility-sensor-7b80a154.js";const De=ye.memo(function A(Q){let{name:T,id:F,SVs:e,actions:x,sourceOfUpdate:V,callAction:w}=xe(Q);A.ignoreActionsWithoutCore=!0;const l=d.useContext(Te);let o=d.useRef(null),p=d.useRef(null),i=d.useRef(null),H=d.useRef(null),O=d.useRef(null),k=d.useRef(null),Y=d.useRef(!1),oe=d.useRef(null),S=d.useRef(null),I=d.useRef(null),_=d.useRef(null),q=d.useRef(null),D=d.useRef(null),C=d.useRef(null),a=d.useRef([]),M=d.useRef(null),j=d.useRef(null),K=d.useRef(null),J=d.useRef(null),Z=d.useRef([]),U=d.useRef([]);K.current=e.vectorControlDirections;let le=d.useRef(null);le.current=e.numericalThroughPoints;let ie=d.useRef(null);ie.current=e.numericalControlPoints;const ue=we(Re);d.useEffect(()=>()=>{o.current&&$()},[]);function ce(){if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)return null;let r=ue==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;r=r.toLowerCase();var t={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:!0,layer:10*e.layer+ge,strokeColor:r,strokeOpacity:e.selectedStyle.lineOpacity,strokeWidth:e.selectedStyle.lineWidth,dash:ve(e.selectedStyle.lineStyle,e.dashed),highlight:!1,lineCap:"butt"};if(e.showLabel&&e.labelForGraph!==""){let u,c,h;e.labelPosition==="upperright"?(h="urt",c=[-5,-10],u="right"):e.labelPosition==="upperleft"?(h="ulft",c=[5,-10],u="left"):e.labelPosition==="lowerright"?(h="lrt",c=[-5,10],u="right"):e.labelPosition==="lowerleft"?(h="llft",c=[5,10],u="left"):e.labelPosition==="top"?(h="top",c=[0,-10],u="left"):e.labelPosition==="bottom"?(h="bot",c=[0,10],u="left"):e.labelPosition==="left"?(h="lft",c=[10,0],u="left"):(h="rt",c=[-10,0],u="right"),t.label={offset:c,position:h,anchorx:u,highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0),e.applyStyleToLabel?t.label.strokeColor=r:t.label.strokeColor="var(canvastext)"}else t.label={highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0);let g;if(e.curveType==="parameterization"){let u=P(e.fDefinitions[0]),c=P(e.fDefinitions[1]);g=l.create("curve",[u,c,e.parMin,e.parMax],t)}else if(e.curveType==="bezier"){let u=P(e.fDefinitions[0]),c=P(e.fDefinitions[1]);g=l.create("curve",[u,c,e.parMin,e.parMax],t)}else{let u=P(e.fDefinitions[0]);if(e.flipFunction){let c=e.graphYmin,h=e.graphYmax,m=Math.max(c-(h-c)*.1,e.parMin),L=Math.min(h+(h-c)*.1,e.parMax);g=l.create("curve",[u,re=>re,m,L],t)}else{let c=e.graphXmin,h=e.graphXmax,m=Math.max(c-(h-c)*.1,e.parMin),L=Math.min(h+(h-c)*.1,e.parMax);g=l.create("functiongraph",[u,m,L],t)}oe.current=e.flipFunction}return H.current=e.curveType,O.current=null,k.current=null,g.on("up",function(u){!Y.current&&O.current===null&&k.current===null&&(e.switchable&&!e.fixed&&w({action:x.switchCurve}),w({action:x.curveClicked,args:{name:T}}))}),e.curveType==="bezier"?(l.on("up",he),g.on("down",()=>{y(),w({action:x.mouseDownOnCurve,args:{name:T}})}),S.current={visible:!1,withLabel:!1,fixed:!0,strokeColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",layer:10*e.layer+N,strokeWidth:1,highlightStrokeWidth:1},I.current={visible:!e.hidden,withLabel:!1,fixed:!1,fillColor:"none",strokeColor:"none",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+N,size:3},_.current={fillcolor:"var(--mainGray)",strokecolor:"var(--mainGray)"},q.current={fillcolor:"none",strokecolor:"none"},D.current={visible:!1,withLabel:!1,fixed:!1,fillColor:"var(--mainGray)",strokeColor:"var(--mainGray)",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+me,size:2},e.draggable&&!e.fixed&&(ae(),e.bezierControlsAlwaysVisible&&(ee(),Ce()),l.updateRenderer(),C.current=e.numericalThroughPoints.length,J.current=[...e.vectorControlDirections])):g.on("down",function(u){Y.current=!1,w({action:x.mouseDownOnCurve,args:{name:T}})}),g}function $(){l.off("up",he),o.current.off("down"),o.current.off("up"),l.removeObject(o.current),o.current=null,se()}function ae(){p.current=[],i.current=[],a.current=[];for(let r=0;r<e.numericalThroughPoints.length;r++){let t=l.create("point",[...e.numericalThroughPoints[r]],I.current);p.current.push(t);let g=l.create("point",[...e.numericalControlPoints[r][0]],D.current),u=l.create("point",[...e.numericalControlPoints[r][1]],D.current);i.current.push([g,u]);let c=l.create("segment",[t,g],S.current),h=l.create("segment",[t,u],S.current);a.current.push([c,h]),t.on("drag",m=>fe(r)),t.on("down",m=>pe(r)),t.on("up",m=>de(r)),g.on("drag",m=>W(r,0)),u.on("drag",m=>W(r,1)),g.on("down",y),u.on("down",y),c.on("down",y),c.on("down",y),g.on("up",m=>z(r,0)),u.on("up",m=>z(r,1))}M.current=[]}function se(){a.current.length>0&&(a.current.forEach(r=>r.forEach(t=>{t&&(t.off("down"),l.removeObject(t))})),a.current=[],i.current.forEach(r=>r.forEach(t=>{t&&(t.off("drag"),t.off("down"),t.off("up"),l.removeObject(t))})),i.current=[],p.current.forEach(r=>{r.off("drag"),r.off("down"),r.off("up"),l.removeObject(r)}),p.current=[])}function fe(r){k.current=r,Z.current[r]=[p.current[r].X(),p.current[r].Y()],w({action:x.moveThroughPoint,args:{throughPoint:Z.current[r],throughPointInd:r,transient:!0,skippable:!0}}),p.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,le.current[r]),l.updateInfobox(p.current[r])}function de(r){k.current===r&&w({action:x.moveThroughPoint,args:{throughPoint:Z.current[r],throughPointInd:r}})}function W(r,t){O.current=r+"_"+t,U.current[r]||(U.current[r]={}),U.current[r][t]=[i.current[r][t].X()-p.current[r].X(),i.current[r][t].Y()-p.current[r].Y()],w({action:x.moveControlVector,args:{controlVector:U.current[r][t],controlVectorInds:[r,t],transient:!0,skippable:!0}}),i.current[r][t].coords.setCoordinates(JXG.COORDS_BY_USER,[...ie.current[r][t]]),l.updateInfobox(i.current[r][t])}function z(r,t){O.current===r+"_"+t&&w({action:x.moveControlVector,args:{controlVector:U.current[r][t],controlVectorInds:[r,t]}})}function ee(){for(let r of p.current){for(let t in _.current)r.visProp[t]=_.current[t];r.needsUpdate=!0,r.update()}}function be(){for(let r of p.current){for(let t in q.current)r.visProp[t]=q.current[t];r.needsUpdate=!0,r.update()}}function Pe(){for(let r of i.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());for(let r of a.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());M.current=[]}function Ce(){for(let r in i.current)E(r)}function he(){!e.draggable||e.fixed||(j.current!==!0&&!e.bezierControlsAlwaysVisible&&(be(),Pe(),l.updateRenderer()),j.current=!1)}function pe(r,t){!e.draggable||e.fixed||(k.current=null,O.current=null,j.current=!0,ee(),E(r),l.updateRenderer())}function E(r){if(!e.hiddenControls[r]){if(i.current[r][0]){let t=(r>0||e.extrapolateBackward)&&["symmetric","both","previous"].includes(K.current[r]);i.current[r][0].visProp.visible=t,i.current[r][0].visPropCalc.visible=t,i.current[r][0].needsUpdate=!0,i.current[r][0].update(),a.current[r][0].visProp.visible=t,a.current[r][0].visPropCalc.visible=t,a.current[r][0].needsUpdate=!0,a.current[r][0].update()}if(i.current[r][1]){let t=(r<p.current.length-1||e.extrapolateForward)&&["symmetric","both","next"].includes(K.current[r]);i.current[r][1].visProp.visible=t,i.current[r][1].visPropCalc.visible=t,i.current[r][1].needsUpdate=!0,i.current[r][1].update(),a.current[r][1].visProp.visible=t,a.current[r][1].visPropCalc.visible=t,a.current[r][1].needsUpdate=!0,a.current[r][1].update()}M.current[r]=!0}}function y(){!e.draggable||e.fixed||(k.current=null,O.current=null,j.current=!0,Y.current=!1,ee(),l.updateRenderer())}if(l)if(!o.current)o.current=ce();else if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)$();else if(H.current!==e.curveType||H.current==="function"&&oe.current!==e.flipFunction)$(),o.current=ce(),l.updateQuality===l.BOARD_QUALITY_LOW&&(l.itemsRenderedLowQuality[F]=o.current);else{l.updateQuality===l.BOARD_QUALITY_LOW&&(l.itemsRenderedLowQuality[F]=o.current),Y.current=!0;let r=!e.hidden;o.current.name=e.labelForGraph,o.current.visProp.visible=r,o.current.visPropCalc.visible=r;let t=10*e.layer+ge,g=o.current.visProp.layer!==t,u,c,h;g&&(u=10*e.layer+N,c=10*e.layer+N,h=10*e.layer+me,o.current.setAttribute({layer:t}),S.current.layer=u,I.current.layer=c,D.current.layer=h);let m=ue==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;m=m.toLowerCase(),o.current.visProp.strokecolor!==m&&(o.current.visProp.strokecolor=m,o.current.visProp.highlightstrokecolor=m),o.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(o.current.visProp.strokeopacity=e.selectedStyle.lineOpacity);let L=ve(e.selectedStyle.lineStyle,e.dashed);if(o.current.visProp.dash!==L&&(o.current.visProp.dash=L),o.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(o.current.visProp.strokewidth=e.selectedStyle.lineWidth),e.curveType==="parameterization"){let n=P(e.fDefinitions[0]),s=P(e.fDefinitions[1]);o.current.X=n,o.current.Y=s,o.current.minX=()=>e.parMin,o.current.maxX=()=>e.parMax}else if(e.curveType==="bezier")o.current.X=P(e.fDefinitions[0]),o.current.Y=P(e.fDefinitions[1]),o.current.minX=()=>e.parMin,o.current.maxX=()=>e.parMax;else{let n=P(e.fDefinitions[0]);if(e.flipFunction){o.current.X=n;let s=e.graphYmin,f=e.graphYmax,v=Math.max(s-(f-s)*.1,e.parMin),b=Math.min(f+(f-s)*.1,e.parMax);o.current.minX=()=>v,o.current.maxX=()=>b}else{o.current.Y=n;let s=e.graphXmin,f=e.graphXmax,v=Math.max(s-(f-s)*.1,e.parMin),b=Math.min(f+(f-s)*.1,e.parMax);o.current.minX=()=>v,o.current.maxX=()=>b}}if(o.current.needsUpdate=!0,o.current.updateCurve(),o.current.hasLabel&&(o.current.label.needsUpdate=!0,o.current.label.visPropCalc.visible=e.showLabel&&e.labelForGraph!=="",e.applyStyleToLabel?o.current.label.visProp.strokecolor=m:o.current.label.visProp.strokecolor="var(canvastext)",o.current.label.update()),e.curveType!=="bezier")return l.updateRenderer(),R(B,{children:R("a",{name:F})});if(!e.draggable||e.fixed)return a.current.length>0&&se(),l.updateRenderer(),R(B,{children:R("a",{name:F})});if(a.current.length===0)return ae(),C.current=e.numericalThroughPoints.length,J.current=[...e.vectorControlDirections],l.updateRenderer(),R(B,{children:R("a",{name:F})});if(e.numericalThroughPoints.length>C.current){let n=C.current-1,s=Object.assign({},I.current);p.current[n].visProp.fillcolor===_.current.fillcolor&&Object.assign(s,_.current);for(let f=C.current;f<e.numericalThroughPoints.length;f++){let v=l.create("point",[...e.numericalThroughPoints[f]],s);p.current.push(v);let b=l.create("point",[...e.numericalControlPoints[f][0]],D.current),X=l.create("point",[...e.numericalControlPoints[f][1]],D.current);i.current.push([b,X]);let te=l.create("segment",[v,b],S.current),ne=l.create("segment",[v,X],S.current);a.current.push([te,ne]),b.visProp.visible=!1,te.visProp.visible=!1,X.visProp.visible=!1,ne.visProp.visible=!1,v.on("drag",G=>fe(f)),v.on("down",G=>pe(f)),v.on("up",G=>de(f)),b.on("drag",G=>W(f,0)),b.on("down",y),b.on("up",G=>z(f,0)),X.on("drag",G=>W(f,1)),X.on("down",y),X.on("up",G=>z(f,1)),te.on("down",y),ne.on("down",y)}M.current[n]&&E(n)}else if(e.numericalThroughPoints.length<C.current){for(let s=C.current-1;s>=e.numericalThroughPoints.length;s--){a.current[s][0].off("down"),a.current[s][1].off("down"),l.removeObject(a.current[s][0]),l.removeObject(a.current[s][1]),a.current.pop(),i.current[s][0].off("drag"),i.current[s][0].off("down"),i.current[s][0].off("up"),i.current[s][1].off("drag"),i.current[s][1].off("down"),i.current[s][1].off("up"),l.removeObject(i.current[s][0]),l.removeObject(i.current[s][1]),i.current.pop();let f=p.current.pop();f.off("drag"),f.off("down"),f.off("up"),l.removeObject(f)}let n=e.numericalThroughPoints.length-1;M.current[n]&&E(n)}let re=Math.min(e.numericalThroughPoints.length,C.current);for(let n=0;n<re;n++)J.current[n]!==e.vectorControlDirections[n]&&M.current[n]&&E(n),g&&(p.current[n].setAttribute({layer:c}),a.current[n][0].setAttribute({layer:u}),i.current[n][0].setAttribute({layer:h}),a.current[n][1].setAttribute({layer:u}),i.current[n][1].setAttribute({layer:h})),p.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalThroughPoints[n]]),p.current[n].needsUpdate=!0,p.current[n].update(),i.current[n][0].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][0]]),i.current[n][0].needsUpdate=!0,i.current[n][0].update(),a.current[n][0].needsUpdate=!0,a.current[n][0].update(),i.current[n][1].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][1]]),i.current[n][1].needsUpdate=!0,i.current[n][1].update(),a.current[n][1].needsUpdate=!0,a.current[n][1].update();for(let n=0;n<e.numericalThroughPoints.length;n++)p.current[n].visProp.visible=!e.hidden,p.current[n].visPropCalc.visible=!e.hidden;if(V.sourceInformation&&T in V.sourceInformation){let n=V.sourceInformation[T].throughPointMoved;n!==void 0?l.updateInfobox(p.current[n]):(n=V.sourceInformation[T].controlVectorMoved,n!==void 0&&l.updateInfobox(i.current[n[0]][n[1]]))}C.current=e.numericalThroughPoints.length,J.current=[...e.vectorControlDirections],l.updateRenderer()}return e.hidden?null:R(B,{children:R("a",{name:F})})});function ve(A,Q){return A==="dashed"||Q?2:A==="solid"?0:A==="dotted"?1:0}export{De as default};
