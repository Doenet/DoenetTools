import{ao as oe,bn as ce,r as o,by as se,bq as $,bv as q,j as M,bL as ie,a as ue,F as le,bo as ae}from"./index-b99cb1f6.js";import{BoardContext as de,TEXT_LAYER_OFFSET as H}from"./graph-218b577d.js";import"./css-14ccef8c.js";const pe=oe.memo(function I(W){let{name:R,id:N,SVs:r,actions:a,sourceOfUpdate:fe,callAction:d}=ce(W);I.ignoreActionsWithoutCore=()=>!0;let e=o.useRef(null),S=o.useRef(null),A=o.useRef(null);const c=o.useContext(de);let y=o.useRef(!1),P=o.useRef(!1),D=o.useRef(!1),X=o.useRef(!1),l=o.useRef(!1),f=o.useRef(null),h=o.useRef(null),B=o.useRef(null),O=o.useRef(null),x=o.useRef(!1),v=o.useRef(!1);x.current=r.fixed,v.current=!r.draggable||r.fixLocation||r.fixed;const{darkMode:C}=o.useContext(se)||{};o.useEffect(()=>()=>{e.current!==null&&Q(),c&&c.off("move",T)},[]),o.useEffect(()=>{c&&c.on("move",T)},[c]);function K(){let i=C==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,u=C==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,g="";u&&(g+=`background-color: ${u}`);let m={visible:!r.hidden,fixed:x.current,layer:10*r.layer+H,cssStyle:g,highlightCssStyle:g,strokeColor:i,strokeOpacity:1,highlightStrokeColor:i,highlightStrokeOpacity:.5,highlight:!v.current,parse:!1},s;try{let t=$.fromAst(r.anchor),p=[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()];Number.isFinite(p[0])||(p[0]=0,m.visible=!1),Number.isFinite(p[1])||(p[1]=0,m.visible=!1),s=c.create("point",p,{visible:!1})}catch{m.visible=!1,s=c.create("point",[0,0],{visible:!1})}m.anchor=s;let{anchorx:k,anchory:b}=q(r.positionFromAnchor);m.anchorx=k,m.anchory=b,A.current=[k,b];let n=c.create("text",[0,0,r.text],m);n.isDraggable=!v.current,n.on("down",function(t){y.current=[t.x,t.y],P.current=[...s.coords.scrCoords],l.current=!1,D.current=!0,X.current=!1,x.current||d({action:a.numberFocused,args:{name:R}})}),n.on("hit",function(t){P.current=[...s.coords.scrCoords],l.current=!1,d({action:a.numberFocused,args:{name:R}})}),n.on("up",function(t){l.current?(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1):!X.current&&!x.current&&d({action:a.numberClicked,args:{name:R}}),D.current=!1}),n.on("keyfocusout",function(t){l.current&&(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1)}),n.on("drag",function(t){let p=t.type==="pointermove";(!p||Math.abs(t.x-y.current[0])>.1||Math.abs(t.y-y.current[1])>.1)&&(l.current=!0);let[E,J,j,G]=c.getBoundingBox(),U=n.size[0]/c.unitX,Y=n.size[1]/c.unitY,L=A.current[0],z=A.current[1],_=0;L==="middle"?_=-U/2:L==="right"&&(_=-U);let F=0;z==="middle"?F=-Y/2:z==="top"&&(F=-Y);let ee=E+.04*(j-E)-_-U,re=j-.04*(j-E)-_,te=G+.04*(J-G)-F-Y,ne=J-.04*(J-G)-F;if(p){var V=c.origin.scrCoords;f.current=(P.current[1]+t.x-y.current[0]-V[1])/c.unitX,h.current=(V[2]-(P.current[2]+t.y-y.current[1]))/c.unitY}else f.current=s.X()+n.relativeCoords.usrCoords[1],h.current=s.Y()+n.relativeCoords.usrCoords[2];f.current=Math.min(re,Math.max(ee,f.current)),h.current=Math.min(ne,Math.max(te,h.current)),d({action:a.moveNumber,args:{x:f.current,y:h.current,transient:!0,skippable:!0}}),n.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,B.current)}),n.on("keydown",function(t){t.key==="Enter"&&(l.current&&(d({action:a.moveNumber,args:{x:f.current,y:h.current}}),l.current=!1),d({action:a.numberClicked,args:{name:R}}))}),e.current=n,S.current=s,O.current=r.positionFromAnchor}function T(i){D.current&&(Math.abs(i.x-y.current[0])>.1||Math.abs(i.y-y.current[1])>.1)&&(X.current=!0)}function Q(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),c.removeObject(e.current),e.current=null}if(c){let i;try{let u=$.fromAst(r.anchor);i=[u.get_component(0).evaluate_to_constant(),u.get_component(1).evaluate_to_constant()]}catch{i=[NaN,NaN]}if(B.current=i,e.current===null)K();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),S.current.coords.setCoordinates(JXG.COORDS_BY_USER,i),e.current.setText(r.text);let u=!r.hidden;if(Number.isFinite(i[0])&&Number.isFinite(i[1])){let n=e.current.visProp.visible!==u;e.current.visProp.visible=u,e.current.visPropCalc.visible=u,n&&e.current.setAttribute({visible:u})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let g=10*r.layer+H;e.current.visProp.layer!==g&&e.current.setAttribute({layer:g});let s=C==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,k=C==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,b="";if(k?b+=`background-color: ${k}`:b+="background-color: transparent",e.current.visProp.strokecolor!==s&&(e.current.visProp.strokecolor=s,e.current.visProp.highlightstrokecolor=s),e.current.visProp.cssstyle!==b&&(e.current.visProp.cssstyle=b,e.current.visProp.highlightcssstyle=b),e.current.visProp.highlight=!v.current,e.current.visProp.fixed=x.current,e.current.isDraggable=!v.current,e.current.needsUpdate=!0,r.positionFromAnchor!==O.current){let{anchorx:n,anchory:t}=q(r.positionFromAnchor);e.current.visProp.anchorx=n,e.current.visProp.anchory=t,A.current=[n,t],O.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();S.current.needsUpdate=!0,S.current.update(),c.updateRenderer()}return M("a",{name:N})}if(r.hidden)return null;let w=r.text;r.renderAsMath&&(w="\\("+w+"\\)");let Z=ie(C,r.selectedStyle);return ue(le,{children:[M("a",{name:N}),M("span",{id:N,style:Z,children:M(ae.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:w})})]})});export{pe as default};
