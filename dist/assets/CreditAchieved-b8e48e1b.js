import{l as t,m as h,H as z,u as W,e as H,r as P,w as J,k as M,j as r,a as i,s as O,z as V,g as X,R as q,B as k,A as K}from"./index-0510454e.js";import{currentAttemptNumber as Q,creditAchievedAtom as B}from"./AssignmentViewer-b8d4fdd2.js";import{i as Y,c as Z,a as ee}from"./ActivityViewer-6fe70aed.js";import{e as te}from"./RoleDropdown-808bf99e.js";import{B as re}from"./ButtonGroup-6ae9cd9f.js";import{T as ie}from"./Textfield-6499fab3.js";import{overviewData as se}from"./Gradebook-0d6ab288.js";import"./activityUtils-fb02a551.js";import"./ActionButton-3674e5f3.js";import"./visibility-sensor-42a61489.js";import"./DropdownMenu-5ca06401.js";import"./setPrototypeOf-51e8cf87.js";const ne=O.div`
  border-bottom: 2px solid var(--canvastext);
  height: 2px;
  width: 230px;
`,u=O.div`
  position: absolute;
  right: 0px;
  top: 0px;
`,p=O.div`
  position: relative;
  background: ${e=>e.highlight?"var(--mainGray)":"var(--canvas)"};
  cursor: ${e=>e.isLink?"pointer":"auto"};
`;function oe({score:e}){const f=V();let S=t(h("courseId")),v=t(h("doenetId")),b=t(h("userId")),{canViewAndModifyGrades:F}=t(te(S));const[c,C]=X(B),[N,d]=P.useState(!1),[n,w]=P.useState(e),y=q(se);return N?i("div",{style:{display:"flex",flexDirection:"column",rowGap:"4px"},children:[r("div",{children:"Final Score:"}),r(ie,{width:"menu",value:n,onChange:l=>{w(l.target.value)}}),r(k,{value:"Update",onClick:async()=>{if(isNaN(n)||n=="")f("Final Score needs to be a number.",K.ERROR);else{const{data:l}=await M.get("/api/saveActivityOverrideGrades.php",{params:{score:n,doenetId:v,userId:b}});let o=Number(n)/(c==null?void 0:c.totalPointsOrPercent);l.success&&(d(!1),C(I=>{let x={...I};return x.creditForAssignment=o,x}),y({doenetId:v,userId:b,credit:`${o}`}))}}})]}):F==1?i(p,{children:[i(re,{children:["Final Score ",r(k,{value:"Edit",onClick:()=>d(!0)}),": ",r(u,{"data-test":"Final Score",children:e})]})," "]}):i(p,{children:["Final Score: ",r(u,{"data-test":"Final Score",children:e})]})}function be(){const e=t(Q),f=t(h("doenetId")),S=t(h("userId")),v=t(h("tool"));t(z(f));const b=t(Y),F=t(Z),c=t(ee);let{search:C}=W(),N=H();const d=P.useRef(null);let[n,w]=P.useState(!1);const{creditByItem:y,creditForAttempt:l,creditForAssignment:o,totalPointsOrPercent:I}=t(B),x=J(({set:m})=>async(s,g,T,_)=>{const{data:a}=await M.get("/api/loadAssessmentCreditAchieved.php",{params:{attemptNumber:s,doenetId:g,userId:T,tool:_}});if(a.success){const $=a.creditByItem.map(Number),G=Number(a.creditForAssignment),L=Number(a.creditForAttempt);Number(a.creditOverride_for_assignment);const j=a.showCorrectness==="1",E=Number(a.totalPointsOrPercent);!j&&_.substring(0,9)!=="gradebook"?w(!0):m(B,U=>{let A={...U};return A.creditByItem=$,A.creditForAssignment=G,A.creditForAttempt=L,A.totalPointsOrPercent=E,A}),d.current=s}},[]);if(!y||!e||!f||!v)return null;if(c!==e)return d.current=c,null;if(d.current!==e)return x(e,f,S,v),null;if(n)return r("div",{style:{fontSize:"20px",textAlign:"center"},children:"Not Shown"});let R=0;o&&(R=Math.round(o*I*100)/100);let D=y.map((m,s)=>{let g;return b[s]===0?g=m===0?"Not started":m===1?"Complete":"In progress":g=(m?Math.round(m*1e3)/10:0)+"%",i(p,{highlight:F===s+1,onClick:()=>N(C+`#page${s+1}`),isLink:!0,children:["Item ",s+1,": ",r(u,{"data-test":`Item ${s+1} Credit`,children:g})]},`creditByItem${s}`)});return i("div",{children:[i(p,{children:["Possible Points: ",r(u,{"data-test":"Possible Points",children:I})]}),r(oe,{score:R}),r(ne,{}),r("b",{children:"Credit For:"}),i(p,{"data-test":"Attempt Container",children:["Attempt ",e,": ",i(u,{"data-test":"Attempt Percent",children:[l?Math.round(l*1e3)/10:0,"%"]})]}),r("div",{style:{marginLeft:"15px"},children:D}),i(p,{children:["Assignment: ",i(u,{"data-test":"Assignment Percent",children:[o?Math.round(o*1e3)/10:0,"%"]})]})]})}export{be as default};
