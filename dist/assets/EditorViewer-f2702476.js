import{r as i,a4 as ne,l,m as k,g as D,w as oe,h as se,R as w,f as ae,G as b,E as re,c as ie,ab as le,u as ue,Q as ce,S as de,v as F,k as fe,j as O,P as me}from"./index-ab5ab855.js";import{v as _,e as x,r as N,a as $,u as pe,t as B}from"./EditorViewerRecoil-a442c8de.js";function ge(t,s,n=window){const a=i.useRef(s);i.useEffect(()=>{a.current=s},[s]),i.useEffect(()=>{if(n==null)return;const c=p=>a.current(p);return n.addEventListener(t,c),()=>n.removeEventListener(t,c)},[t,n])}const K=()=>F(({snapshot:s,set:n})=>async()=>{const a=await s.getPromise(B),c=await s.getPromise($);n(_,a),c&&n(N,p=>p+1)});function Ie(){let t=ne();const s=t==null?void 0:t.courseId,n=t==null?void 0:t.doenetId,a=t==null?void 0:t.pageDoenetId,c=l(_),p=l(k("pageId")),P=l(k("linkPageId")),y=l(k("doenetId"));let u=p,v=y;P&&(u=P,v=P),n&&(u=a,v=n);const[A,M]=D(oe),U=l(x),[z,G]=D(se),J=w(ae),V=w(x),q=l(N),H=w($),[h,Q]=D(b(u)),d=l(b(y)),C=w(re),{canUpload:T}=l(ie),W=K(),X=w(le);let o=ue();const g=i.useRef({}),E=i.useRef(null);ce(v),de(A);let L=!1,I=null;Object.keys(h).length>0&&(L=!0,d!=null&&d.isSinglePage&&!P?I=d==null?void 0:d.label:I=h.label),i.useEffect(()=>{const e=document.title;return I&&(document.title=`${I} - Doenet`),()=>{document.title=e}},[I]);let R=F(({snapshot:e,set:r})=>async f=>{let{data:S}=await fe.get(`/media/byPageId/${f}.doenet`);S=S.toString();let j=await e.getPromise(b(f)),te=await e.getPromise(b(j.containingDoenetId));r(pe,S),r(B,S),r(_,S),r(x,f);let m=[];te.type=="bank"&&m.push("AssignmentSettingsMenu"),j.type=="pageLink"&&(m.push("AssignmentSettingsMenu"),m.push("PageLink"),m.push("SupportingFilesMenu")),T!=="1"&&m.push("SupportingFilesMenu"),C(m)},[C]);if(i.useEffect(()=>(u!==""&&L?R(u):a&&(M(s),Q({containingDoenetId:n,doenetId:a,isSelected:!1,label:"Untitled",parentDoenetId:n,type:"page"})),()=>{V("")}),[s,M,R,V,a,u,L]),ge("keydown",e=>{(e.keyCode===83&&e.metaKey||e.keyCode===83&&e.ctrlKey)&&(e.preventDefault(),W())}),i.useEffect(()=>{var e,r;E.current!==o.key&&(((e=o.state)==null?void 0:e.previousScrollPosition)!==void 0&&E.current&&(g.current[E.current].lastScrollPosition=o.state.previousScrollPosition),g.current[o.key]&&((r=g.current[o.key])==null?void 0:r.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:g.current[o.key].lastScrollPosition}),g.current[o.key]={...o},E.current=o.key)},[o]),i.useEffect(()=>{const e=document.getElementById("mainPanel");X(e)},[]),A==="__not_found__")return O("h1",{children:"Content not found or no permission to view content"});if(u!==U)return null;let Y=1,Z="button";function ee(e,r){const f=JSON.parse(JSON.stringify(e));J({index:f.index,allPossibleVariants:r}),G({index:f.index})}return O(me,{doenetML:c,flags:{showCorrectness:!0,solutionDisplayMode:Z,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},doenetId:y,attemptNumber:Y,generatedVariantCallback:ee,requestedVariantIndex:z.index,setIsInErrorState:H,pageIsActive:!0},`pageViewer${q}`)}const Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Ie,useUpdateViewer:K},Symbol.toStringTag,{value:"Module"}));export{Pe as E,ge as a,K as u};
