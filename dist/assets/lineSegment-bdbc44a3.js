import{av as T,bn as V,r as d,l as H,bs as N,j as L,F as W}from"./index-61b6fc23.js";import{BoardContext as q,LINE_LAYER_OFFSET as Y,VERTEX_LAYER_OFFSET as G}from"./graph-1ff63df5.js";import"./css-14ccef8c.js";import"./visibility-sensor-398e690f.js";const $=T.memo(function C(I){let{name:X,id:_,SVs:e,actions:p,sourceOfUpdate:O,callAction:f}=V(I);C.ignoreActionsWithoutCore=!0;const s=d.useContext(q);let t=d.useRef(null),l=d.useRef(null),i=d.useRef(null),v=d.useRef(!1),R=d.useRef(!1),g=d.useRef(null),E=d.useRef(null),D=d.useRef(null),c=d.useRef(null),S=d.useRef(null),F=d.useRef(null);F.current=e.numericalEndpoints;const J=H(N);d.useEffect(()=>()=>{t.current&&U()},[]);function M(){if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(r=>r.length!==2)){t.current=null,l.current=null,i.current=null;return}let n=!e.draggable||e.fixed,u=e.showLabel&&e.labelForGraph!=="",a=J==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;a=a.toLowerCase();var h={name:e.labelForGraph,visible:!e.hidden,withlabel:u,fixed:n,layer:10*e.layer+Y,strokeColor:a,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:a,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:j(e.selectedStyle.lineStyle),highlight:!n};if(u){let r,m,o;e.labelPosition==="upperright"?(o=[5,5],r="left",m="bottom"):e.labelPosition==="upperleft"?(o=[-5,5],r="right",m="bottom"):e.labelPosition==="lowerright"?(o=[5,-5],r="left",m="top"):(o=[-5,-5],r="right",m="top"),h.label={offset:o,anchorx:r,anchory:m,highlight:!1},e.labelHasLatex&&(h.label.useMathJax=!0),e.applyStyleToLabel?h.label.strokeColor=a:h.label.strokeColor="var(--canvastext)"}else h.label={highlight:!1},e.labelHasLatex&&(h.label.useMathJax=!0);let k=!(!e.endpointsDraggable||e.fixed)&&!e.hidden,w=Object.assign({},h);Object.assign(w,{withLabel:!1,fixed:!1,highlight:!0,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*e.layer+G,showInfoBox:e.showCoordsWhenDragging,visible:k});let b=[[...e.numericalEndpoints[0]],[...e.numericalEndpoints[1]]];return l.current=s.create("point",b[0],w),i.current=s.create("point",b[1],w),t.current=s.create("segment",[l.current,i.current],h),l.current.on("drag",r=>A(1,r)),i.current.on("drag",r=>A(2,r)),t.current.on("drag",r=>A(0,r)),l.current.on("up",()=>{g.current===1?f({action:p.moveLineSegment,args:{point1coords:c.current}}):g.current===null&&f({action:p.lineSegmentClicked}),S.current=null}),i.current.on("up",()=>{g.current===2?f({action:p.moveLineSegment,args:{point2coords:c.current}}):g.current===null&&f({action:p.lineSegmentClicked}),S.current=null}),t.current.on("up",function(r){g.current===0?f({action:p.moveLineSegment,args:{point1coords:c.current[0],point2coords:c.current[1]}}):g.current===null&&S.current===null&&f({action:p.lineSegmentClicked})}),l.current.on("down",r=>{g.current=null,v.current=[r.x,r.y],S.current=1,f({action:p.mouseDownOnLineSegment})}),i.current.on("down",r=>{g.current=null,v.current=[r.x,r.y],S.current=2,f({action:p.mouseDownOnLineSegment})}),t.current.on("down",function(r){g.current=null,v.current=[r.x,r.y],R.current=[[...l.current.coords.scrCoords],[...i.current.coords.scrCoords]],S.current===null&&f({action:p.mouseDownOnLineSegment})}),D.current=e.labelPosition,E.current=u,t.current}function A(n,u){(Math.abs(u.x-v.current[0])>.1||Math.abs(u.y-v.current[1])>.1)&&(g.current=n,n==1?(c.current=[t.current.point1.X(),t.current.point1.Y()],f({action:p.moveLineSegment,args:{point1coords:c.current,transient:!0,skippable:!0,sourceDetails:{endpoint:n}}})):n==2?(c.current=[t.current.point2.X(),t.current.point2.Y()],f({action:p.moveLineSegment,args:{point2coords:c.current,transient:!0,skippable:!0,sourceDetails:{endpoint:n}}})):(B(u),f({action:p.moveLineSegment,args:{point1coords:c.current[0],point2coords:c.current[1],transient:!0,skippable:!0}}))),t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,F.current[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,F.current[1]),n==1?s.updateInfobox(t.current.point1):n==2&&s.updateInfobox(t.current.point2)}function B(n){var u=s.origin.scrCoords;c.current=[];for(let a=0;a<2;a++){let h=(R.current[a][1]+n.x-v.current[0]-u[1])/s.unitX,y=(u[2]-(R.current[a][2]+n.y-v.current[1]))/s.unitY;c.current.push([h,y])}return c.current}function U(){t.current.off("drag"),t.current.off("down"),t.current.off("up"),s.removeObject(t.current),t.current=null,l.current.off("drag"),l.current.off("down"),l.current.off("up"),s.removeObject(l.current),l.current=null,i.current.off("drag"),i.current.off("down"),i.current.off("up"),s.removeObject(i.current),i.current=null}if(s){if(t.current===null)M();else if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(n=>n.length!==2))U();else{let n=!0;for(let o of[e.numericalEndpoints[0],e.numericalEndpoints[1]])Number.isFinite(o[0])||(n=!1),Number.isFinite(o[1])||(n=!1);if(t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[1]),O.sourceInformation&&X in O.sourceInformation){let o=O.sourceInformation[X].endpoint;o===1?s.updateInfobox(t.current.point1):o===2&&s.updateInfobox(t.current.point2)}let u=!e.hidden&&n;if(n){let o=t.current.visProp.visible!==u;t.current.visProp.visible=u,t.current.visPropCalc.visible=u,o&&t.current.setAttribute({visible:u})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let a=!e.draggable||e.fixed,y=!(!e.endpointsDraggable||e.fixed)&&u;l.current.visProp.visible=y,l.current.visPropCalc.visible=y,i.current.visProp.visible=y,i.current.visPropCalc.visible=y,t.current.visProp.fixed=a,t.current.visProp.highlight=!a;let k=10*e.layer+Y;t.current.visProp.layer!==k&&(t.current.setAttribute({layer:k}),l.current.setAttribute({layer:10*e.layer+G}),i.current.setAttribute({layer:10*e.layer+G}));let b=J==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;b=b.toLowerCase(),t.current.visProp.strokecolor!==b&&(t.current.visProp.strokecolor=b,t.current.visProp.highlightstrokecolor=b),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let r=j(e.selectedStyle.lineStyle);t.current.visProp.dash!==r&&(t.current.visProp.dash=r),t.current.name=e.labelForGraph;let m=e.showLabel&&e.labelForGraph!=="";if(m!=E.current&&(t.current.setAttribute({withlabel:m}),E.current=m),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=b:t.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==D.current){let o,P,x;e.labelPosition==="upperright"?(x=[5,5],o="left",P="bottom"):e.labelPosition==="upperleft"?(x=[-5,5],o="right",P="bottom"):e.labelPosition==="lowerright"?(x=[5,-5],o="left",P="top"):(x=[-5,-5],o="right",P="top"),t.current.label.visProp.anchorx=o,t.current.label.visProp.anchory=P,t.current.label.visProp.offset=x,D.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();l.current.needsUpdate=!0,l.current.update(),i.current.needsUpdate=!0,i.current.update(),s.updateRenderer()}return L(W,{children:L("a",{name:_})})}return e.hidden?null:L(W,{children:L("a",{name:_})})});function j(C){return C==="solid"?0:C==="dashed"?2:C==="dotted"?1:0}export{$ as default};
