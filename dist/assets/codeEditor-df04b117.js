import{ao as $,bn as M,R as D,bu as F,r as h,a as m,F as C,j as i,b6 as I,a9 as _,bp as H,bA as k,bB as U}from"./index-b99cb1f6.js";import{s as a}from"./css-14ccef8c.js";const N=$.memo(function L(T){let{name:X,id:f,SVs:e,children:V,actions:l,ignoreUpdate:z,rendererName:A,callAction:o}=M(T);L.baseStateVariable="immediateValue";const B=D(F(A));let d=h.useRef(e.immediateValue),n=h.useRef(null),K=h.useRef(null),y=h.useRef(e.immediateValue),j={...e.height},b={...e.height};e.showResults&&e.resultsLocation==="bottom"&&(b.size*=1-e.viewerRatio);let O=t=>{o({action:l.recordVisibilityChange,args:{isVisible:t}})};if(h.useEffect(()=>()=>{o({action:l.recordVisibilityChange,args:{isVisible:!1}}),n.current!==null&&(clearTimeout(n.current),o({action:l.updateValue,baseVariableValue:d.current}))},[]),e.hidden)return null;h.useEffect(()=>{let t="Linux";navigator.platform.indexOf("Win")!=-1?t="Win":navigator.platform.indexOf("Mac")!=-1&&(t="Mac");const r=u=>{(t=="Mac"&&u.metaKey&&u.code==="KeyS"||t!="Mac"&&u.ctrlKey&&u.code==="KeyS")&&(u.preventDefault(),u.stopPropagation(),clearTimeout(n.current),o({action:l.updateValue,baseVariableValue:d.current}),n.current=null,o({action:l.updateComponents}))};let c=document.getElementById(f);return e.showResults&&c.addEventListener("keydown",r),()=>{c.removeEventListener("keydown",r)}},[e.showResults]);const v=f+"_editor",R=f+"_viewer";!z&&e.immediateValue!==d.current&&(d.current=e.immediateValue,y.current=e.immediateValue);let g=null,x=e.width,w=e.width;e.showResults&&["left","right"].includes(e.resultsLocation)&&(x={size:100,isAbsolute:!1});let P={width:a(x),height:a(b),maxWidth:"100%",padding:"0px",overflowX:"hidden",overflowY:"hidden"};e.showResults&&(e.resultsLocation==="bottom"?g=m(C,{children:[i("hr",{style:{width:a(w),maxWidth:"100%"}}),i("div",{id:R,children:V})]}):g=i("div",{id:R,children:V}));let p={...b};p.size/=2,p=a(p);let W=null,S=0;if(e.errorsAndWarnings){S=32;const t=1,r=e.errorsAndWarnings.warnings.filter(u=>u.level<=t),c=[...e.errorsAndWarnings.errors];W=i(k,{ml:"0px",h:"32px",bg:"doenet.mainGray",pl:"10px",pt:"1px",children:i(U,{warningsObjs:r,errorsObjs:c})})}let E=m("div",{id:v,style:P,children:[i(I,{height:`calc(${a(b)} - ${S}px)`,w:"100%",overflowY:"scroll",overflowX:"hidden",children:i(_,{editorRef:K,setInternalValueTo:y.current,readOnly:e.disabled,onBlur:()=>{clearTimeout(n.current),o({action:l.updateValue,baseVariableValue:d.current}),n.current=null},onFocus:()=>{},onBeforeChange:t=>{d.current!==t&&(d.current=t,B(r=>{let c={...r};return c.ignoreUpdate=!0,c}),o({action:l.updateImmediateValue,args:{text:t},baseVariableValue:t}),clearTimeout(n.current),n.current=setTimeout(function(){o({action:l.updateValue,baseVariableValue:d.current}),n.current=null},3e3))},paddingBottom:p})}),W]},v),s=E;if(e.showResults&&e.resultsLocation==="bottom"&&(s=m(C,{children:[E,g]})),s=m("div",{style:{margin:"12px 0"},children:[i("a",{name:f}),i("div",{style:{padding:"0",border:"var(--mainBorder)",borderRadius:"var(--mainBorderRadius)",height:a(j),width:a(x),maxWidth:"100%",display:"flex",flexDirection:"column"},id:f,children:s})]}),e.showResults){if(e.resultsLocation==="left"){let t=e.viewerRatio*100,r=100-t;s=m("div",{style:{display:"flex",width:a(w),maxWidth:"100%",margin:"12px 0"},children:[i("div",{style:{maxWidth:`${t}%`,paddingRight:"15px",boxSizing:"border-box"},children:g}),i("div",{style:{width:`${r}%`,boxSizing:"border-box"},children:s})]})}else if(e.resultsLocation==="right"){let t=e.viewerRatio*100,r=100-t;s=m("div",{style:{display:"flex",width:a(w),maxWidth:"100%",margin:"12px 0"},children:[i("div",{style:{width:`${r}%`,paddingRight:"15px",boxSizing:"border-box"},children:s}),i("div",{style:{width:`${t}%`,boxSizing:"border-box"},children:g})]})}}return i(H,{partialVisibility:!0,onChange:O,children:s})});export{N as default};
