import{a4 as E,R as L,l as a,m,w as M,r as n,j as p}from"./index-c9d6e71c.js";import{C as R}from"./CodeMirror-e96b6a63.js";import{u as k}from"./useSaveDraft-efff7d16.js";import{t as A,u as h,v as T,e as b}from"./EditorViewerRecoil-e3485b3b.js";function y(){let i=E();const s=i==null?void 0:i.pageDoenetId,I=L(A),g=a(h),D=a(T),P=a(m("pageId")),d=a(m("linkPageId"));let c=P,f=!1;d&&(f=!0,c=d),s&&(c=s);const o=a(M),t=a(b);let v=n.useRef(null),e=n.useRef(null),r=n.useRef(!0);const{saveDraft:u}=k();return n.useEffect(()=>()=>{t!==""&&(u({pageId:t,courseId:o,backup:r.current}),e.current!==null&&clearTimeout(e.current),e.current=null)},[t,u,o]),n.useEffect(()=>{t!==""&&(u({pageId:t,courseId:o,backup:r.current}).then(({success:l})=>{l&&(r.current=!1)}),e.current!==null&&clearTimeout(e.current),e.current=null)},[D]),c!==t?(r.current=!0,null):p("div",{children:p(R,{readOnly:f,editorRef:v,setInternalValue:g,onBeforeChange:l=>{I(l),clearTimeout(e.current),e.current=setTimeout(function(){u({pageId:t,courseId:o,backup:r.current}).then(({success:x})=>{x&&(r.current=!1)}),e.current=null},3e3)}},"codemirror")})}export{y as default};
