import{R as ae,p as oe,e as j,P as se,r as R,f as le,o as q,m as ie,k as re,g as Q,A as de,E as ce,j as t,M as L,a as y,F as ue,B as _,_ as ge,H as E,aK as me,a1 as pe,ap as N,C as he,aL as fe}from"./index-a1cd8b25.js";import{g as be,c as ye}from"./CourseToolHandler-ceca1b11.js";import{e as we}from"./RoleDropdown-6cbb7a86.js";const J=N({key:"classTimesAtom",default:[]}),xe=N({key:"showCompletedAtom",default:!0}),De=N({key:"showOverdueAtom",default:!1});function ke(e,x,r,p){if(e=="Invalid Date"||e==null)return null;let u=e.getDay();for(let g of x)if(g.dotwIndex==u){let s=new Date(e.getTime());const[i,f]=g.startTime.split(":");s.setHours(i,f,0,0);let D=new Date(e.getTime());const[A,a]=g.endTime.split(":");if(D.setHours(A,a,0,0),e>=s&&e<D)return e.getMonth()!=r.getMonth()||e.getDate()!=r.getDate()?`In Class ${e.getMonth()+1}/${e.getDate()}`:"In Class";if(e.getTime()==D.getTime())return e.getMonth()!=r.getMonth()||e.getDate()!=r.getDate()?`After Class ${e.getMonth()+1}/${e.getDate()}`:"After Class"}let l=e.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});if(l==="Invalid Date"&&(l=null),p){let g=new Date,s=new Date(g.getTime()+1e3*60*60*24*-1),i=new Date(g.getTime()+1e3*60*60*24*1);return e.getMonth()==s.getMonth()&&e.getDate()==s.getDate()&&e.getFullYear()==s.getFullYear()?`Yesterday - ${l}`:e.getMonth()==i.getMonth()&&e.getDate()==i.getDate()&&e.getFullYear()==i.getFullYear()?`Tomorrow - ${l}`:`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()]} - ${l}`}let w=`${e.getMonth()+1}/${e.getDate()} ${l}`;return l===null&&(w=null),w}function Te(e,x){if(e=="Invalid Date"||e==null)return null;let r=e.getDay();for(let u of x)if(u.dotwIndex==r){let l=new Date(e.getTime());const[w,g]=u.startTime.split(":");l.setHours(w,g,0,0);let s=new Date(e.getTime());const[i,f]=u.endTime.split(":");if(s.setHours(i,f,0,0),e.getTime()==l.getTime())return"Before Class";if(e>l&&e<s)return"In Class";if(e.getTime()==s.getTime())return"End of Class"}let p=e.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});return p=`${e.getMonth()+1}/${e.getDate()} ${p}`,p==="Invalid Date"&&(p=null),p}function H({dotw:e="",rowLabel:x="",assignments:r,clickCallback:p,completedArray:u,setCompletedArray:l,classTimes:w,weekShift:g,selectedItemId:s,showCompleted:i}){let f=[];if(r.length>0){let D=!0,A=0;for(let a of r){let n=u.includes(a.doenetId);(i||!i&&!n)&&A++}for(let a=0;a<r.length;a++){let n=r[a],k=L(n.assignedDate),I="";k&&k.setSeconds(0,0);let v=L(n.dueDate),T="",S="";v&&(v.setSeconds(0,0),S=`${e} `,T=Te(v,w),k&&(I=ke(k,w,v,g==0))),x!==""&&(S=x);let c=null;n.itemId===s&&(c="#B8D2EA");let b=h=>{h.stopPropagation(),p({courseId:n.courseId,doenetId:n.doenetId})},O=u.includes(n.doenetId);if(!i&&O)continue;let B="";if(n.gradeCategory){const h=Number(n.totalPointsOrPercent);let C=Math.round(n.credit*h*100)/100;n.creditOverride&&(C=Math.round(n.creditOverride*h*100)/100),B=`${C}/${h}`}let M=t(he,{checked:O,onClick:h=>{h.stopPropagation(),l(O?C=>{let P=[...C];return P.splice(P.indexOf(n.doenetId),1),P}:C=>[n.doenetId,...C]),Q.get("/api/saveCompleted.php",{params:{doenetId:n.doenetId}})}});D?(D=!1,f.push(y("tr",{"data-test":`cbw row ${a}`,children:[t("td",{"data-test":`cbw row label ${a}`,style:{borderBottom:"2px solid black",padding:"8px"},rowSpan:A,children:S}),t("td",{"data-test":`cbw assignment label ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:n.label}),t("td",{"data-test":`cbw assigned date ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:I}),t("td",{"data-test":`cbw due date ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:T}),t("td",{"data-test":`cbw score ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:B}),t("td",{"data-test":`cbw completed ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:M})]},`${S}${n.doenetId}`))):f.push(y("tr",{"data-test":`cbw row ${a}`,children:[t("td",{"data-test":`cbw assignment label ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:n.label}),t("td",{"data-test":`cbw assigned date ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:I}),t("td",{"data-test":`cbw due date ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:b,children:T}),t("td",{"data-test":`cbw score ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:B}),t("td",{"data-test":`cbw completed ${a}`,style:{backgroundColor:c,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:M})]},`${S}${n.doenetId}${a}`))}}return f}function Ie({courseId:e}){var K;const x=ae(oe),r=j(xe),p=j(De);se(e);let[u,l]=R.useState([]),[w,g]=R.useState([]),[s,i]=R.useState([]),[f,D]=R.useState(!1),[A,a]=R.useState(""),[n,k]=R.useState(0),I=j(J),v=j(be),T=null;((K=v[0])==null?void 0:K.driveInstanceId)==="currentContent"&&(T=v[0].itemId);const S=le();let c=q(({set:d})=>async m=>{d(ie,$=>[...$,{atom:ye,value:null},{atom:re,value:null}]);const{data:o}=await Q.get("/api/loadTODO.php",{params:{courseId:m}});if(!o.success){a(o.message);return}o.assignments&&(l(o.assignments),g(o.pinned)),o.classTimes&&d(J,o.classTimes),o.completed&&i(o.completed)});const b=q(({set:d,snapshot:m})=>async o=>{const $=o.courseId,W=o.doenetId;let{canEditContent:ee}=await m.getPromise(we($));if(ee==="1"){let te=await m.getPromise(de(W)),ne=ce(te.content);S(`/courseactivityeditor/${W}/${ne}/?from=dashboard`)}else x({page:"course",tool:"assignment",view:"",params:{doenetId:W}})},[]);if(!f&&e!=="")return D(!0),c(e),null;if(A!=="")return t("div",{children:t("h2",{children:A})});let O=new Date,B=1-O.getDay();B===1&&(B=-6);let M=new Date(O.getTime()+1e3*60*60*24*B+1e3*60*60*24*n*7),h=new Date(M.getTime()+1e3*60*60*24*6),C=`${M.getMonth()+1}/${M.getDate()}`,P=`${h.getMonth()+1}/${h.getDate()}`,V=[],Y=[],X=y("p",{children:[t(E,{icon:fe})," Pinned"]});if(n==0&&(V.push(...H({rowLabel:X,assignments:w,clickCallback:b,completedArray:s,setCompletedArray:i,classTimes:I,weekShift:n,selectedItemId:T,showCompleted:r})),p)){const d=new Date;let m=[];for(let o of u){const $=L(o.dueDate);if(!$||$>d)break;s.includes(o.doenetId)||m.push(o)}Y.push(...H({rowLabel:"Overdue",assignments:m,clickCallback:b,completedArray:s,setCompletedArray:i,classTimes:I,weekShift:n,selectedItemId:T,showCompleted:r}))}let z=[],U=new Date(M.getTime());U.setHours(0,0,0,0);let G=new Date(h.getTime());G.setHours(23,59,59,999);let F=[[],[],[],[],[],[],[]];for(let d=0;d<u.length;d++){let m=u[d],o=L(m.dueDate);if(!o||o<U)continue;if(o>G)break;let $=o.getDay();F[$].push({...m})}F.push(F.shift());const Z=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let[d,m]of Object.entries(F))z.push(...H({dotw:Z[d],assignments:m,clickCallback:b,completedArray:s,setCompletedArray:i,classTimes:I,weekShift:n,selectedItemId:T,showCompleted:r}));return y(ue,{children:[y("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-evenly",width:"850px",height:"70px"},children:[y("span",{children:[t(_,{onClick:()=>k(0),value:"This Week"})," "]}),t("h1",{children:"Content by Week"}),y("span",{style:{fontSize:"1.4em"},children:[C," - ",P]}),y(ge,{children:[t("span",{children:t(_,{dataTest:"previous week button",onClick:()=>k(d=>d-1),icon:t(E,{icon:me})})}),t("span",{children:t(_,{dataTest:"next week button",onClick:()=>k(d=>d+1),icon:t(E,{icon:pe})})})]})]}),y("table",{style:{width:"850px",borderSpacing:"0em .2em"},children:[y("tr",{children:[t("th",{style:{width:"100px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Day"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Name"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Assigned"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Due"}),t("th",{style:{width:"50px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Score"}),t("th",{style:{width:"100px",padding:"8px",textAlign:"center",borderBottom:"2px solid black"},children:"Completed"})]}),V,Y,z]})]})}export{Ie as N,xe as a,J as c,De as s};
