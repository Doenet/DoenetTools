import{l as j,m as k,w as E,J as L,a5 as M,aG as F,j as N,B as J}from"./index-b4c9ab18.js";import{assignmentData as U,overviewData as W,gradeCategories as X}from"./Gradebook-34b73e97.js";import"./RoleDropdown-da69f95c.js";import"./DropdownMenu-9591c1a3.js";import"./setPrototypeOf-51e8cf87.js";function Y(){const R=j(k("courseId")),D=E(({snapshot:d})=>async w=>{var h,x,S,A,T,B;const{label:G}=await d.getPromise(L(w));let O=`${G}.csv`,f,l=await d.getPromise(U),V=await d.getPromise(W);const{value:_}=await d.getPromise(M(w));let t={},I="Name,Email,External Id,Section,Withdrew,",a="Possible Points,,,,,";for(const{userId:o,email:i,roleId:P,withdrew:v,externalId:m,section:g,firstName:b,lastName:e}of _){const{isIncludedInGradebook:s}=await d.getPromise(F({courseId:w,roleId:P}));if(s!=="1")continue;const $=`${b} ${e}`.replaceAll('"','""');t[o]={courseTotal:0,csv:`"${$}",${i},${m},${g},${v==="1"?"X":""},`}}let y=0,C=Object.entries(l);C.sort((o,i)=>o[1].sortOrder<i[1].sortOrder?-1:1);for(let{category:o,scaleFactor:i=1,maximumNumber:P=1/0,maximumValue:v=1/0}of X){let m=[];for(const e in t)t[e][o]=[];for(const[e]of C){let s=(h=l[e])==null?void 0:h.category;if((s==null?void 0:s.toLowerCase())!==(o==null?void 0:o.toLowerCase()))continue;let $=(x=l[e])==null?void 0:x.label.replaceAll('"','""');I+=`"${$}",`;let n=((S=l==null?void 0:l[e])==null?void 0:S.totalPointsOrPercent)*1;a=`${a}${n},`,m.push(n);for(const r in t){let c=(T=(A=V[r])==null?void 0:A.assignments)==null?void 0:T[e];if(c===null&&((B=l==null?void 0:l[e])==null?void 0:B.isGloballyAssigned)==="0"){t[r].csv=`${t[r].csv},`;continue}let p=n*c;p=Math.round(p*100)/100,t[r].csv=`${t[r].csv}${p},`,t[r][o].push(p)}}m.sort((e,s)=>s-e).slice(0,P);let g=m.reduce((e,s)=>e+s,0)*i,b=Math.min(g,v);y+=b,I+=`${o} Total,`,a=`${a}${b},`;for(const e in t){let s=t[e][o];s=s.sort((r,c)=>c-r).slice(0,P);let $=s.reduce((r,c)=>r+c,0)*i,n=Math.min($,v);t[e].csv=`${t[e].csv}${n},`,t[e].courseTotal+=n}}I+="Course Total",a=`${a}${y}`,f=`${I}
${a}`;for(const o in t)f=`${f}
${t[o].csv}${t[o].courseTotal}`;var u=document.createElement("a");u.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(f)),u.setAttribute("download",O),document.body.appendChild(u),u.click(),document.body.removeChild(u)},[]);return N("div",{children:N(J,{value:"Download CSV",onClick:()=>{D(R)}})})}export{Y as default};
