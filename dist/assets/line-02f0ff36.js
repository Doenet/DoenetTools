import{av as E,bn as W,r as u,l as j,bs as U,j as v,F,a as Y,b9 as B}from"./index-ab5ab855.js";import{BoardContext as T,LINE_LAYER_OFFSET as J}from"./graph-7de05658.js";import"./css-14ccef8c.js";import"./visibility-sensor-7b80a154.js";const z=E.memo(function b(C){var D;let{name:N,id:S,SVs:e,actions:h,callAction:f}=W(C);b.ignoreActionsWithoutCore=!0;const d=u.useContext(T);let t=u.useRef({}),g=u.useRef(!1),k=u.useRef(!1),x=u.useRef(!1),L=u.useRef(null),w=u.useRef(null),p=u.useRef(null),R=u.useRef(null);R.current=e.numericalPoints;const O=j(U);u.useEffect(()=>()=>{Object.keys(t.current).length!==0&&G()},[]);function A(){var y;if(((y=e.numericalPoints)==null?void 0:y.length)!==2||e.numericalPoints.some(r=>r.length!==2)){t.current={};return}let s=!e.draggable||e.fixed,c=e.showLabel&&e.labelForGraph!=="",o=O==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;o=o.toLowerCase();var n={name:e.labelForGraph,visible:!e.hidden,withlabel:c,fixed:s,layer:10*e.layer+J,strokeColor:o,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:o,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:_(e.selectedStyle.lineStyle,e.dashed),highlight:!s};if(c){let r,l,a;e.labelPosition==="upperright"?(a=[5,5],r="left",l="bottom"):e.labelPosition==="upperleft"?(a=[-5,5],r="right",l="bottom"):e.labelPosition==="lowerright"?(a=[5,-5],r="left",l="top"):(a=[-5,-5],r="right",l="top"),n.label={offset:a,anchorx:r,anchory:l,position:"top",highlight:!1},e.labelHasLatex&&(n.label.useMathJax=!0),e.applyStyleToLabel?n.label.strokeColor=o:n.label.strokeColor="var(--canvastext)"}else n.label={highlight:!1},e.labelHasLatex&&(n.label.useMathJax=!0);let m=[[...e.numericalPoints[0]],[...e.numericalPoints[1]]],i=d.create("line",m,n);i.on("drag",function(r){(Math.abs(r.x-g.current[0])>.1||Math.abs(r.y-g.current[1])>.1)&&(x.current=!0),M(r),f({action:h.moveLine,args:{point1coords:p.current[0],point2coords:p.current[1],transient:!0,skippable:!0}}),i.point1.coords.setCoordinates(JXG.COORDS_BY_USER,R.current[0]),i.point2.coords.setCoordinates(JXG.COORDS_BY_USER,R.current[1])}),i.on("up",function(r){x.current?f({action:h.moveLine,args:{point1coords:p.current[0],point2coords:p.current[1]}}):e.switchable&&!e.fixed?(f({action:h.switchLine}),f({action:h.lineClicked})):f({action:h.lineClicked})}),i.on("down",function(r){x.current=!1,g.current=[r.x,r.y],k.current=[[...i.point1.coords.scrCoords],[...i.point2.coords.scrCoords]],f({action:h.mouseDownOnLine})}),L.current=e.showLabel&&e.labelForGraph!=="",t.current=i}function M(s){var c=d.origin.scrCoords;p.current=[];for(let o=0;o<2;o++){let n=(k.current[o][1]+s.x-g.current[0]-c[1])/d.unitX,m=(c[2]-(k.current[o][2]+s.y-g.current[1]))/d.unitY;p.current.push([n,m])}}function G(){t.current.off("drag"),t.current.off("down"),t.current.off("up"),d.removeObject(t.current),t.current={}}if(d){if(Object.keys(t.current).length===0)A();else if(((D=e.numericalPoints)==null?void 0:D.length)!==2||e.numericalPoints.some(s=>s.length!==2))G();else{let s=!0;for(let l of[e.numericalPoints[0],e.numericalPoints[1]])Number.isFinite(l[0])||(s=!1),Number.isFinite(l[1])||(s=!1);t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[1]);let c=!e.hidden;if(s){let l=t.current.visProp.visible!==c;t.current.visProp.visible=c,t.current.visPropCalc.visible=c,l&&t.current.setAttribute({visible:c})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let o=!e.draggable||e.fixed;t.current.visProp.fixed=o,t.current.visProp.highlight=!o;let n=10*e.layer+J;t.current.visProp.layer!==n&&t.current.setAttribute({layer:n});let i=O==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;i=i.toLowerCase(),t.current.visProp.strokecolor!==i&&(t.current.visProp.strokecolor=i,t.current.visProp.highlightstrokecolor=i),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let y=_(e.selectedStyle.lineStyle,e.dashed);t.current.visProp.dash!==y&&(t.current.visProp.dash=y),t.current.name=e.labelForGraph;let r=e.showLabel&&e.labelForGraph!=="";if(r!=L.current&&(t.current.setAttribute({withlabel:r}),L.current=r),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=i:t.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==w.current){let l,a,P;e.labelPosition==="upperright"?(P=[5,5],l="left",a="bottom"):e.labelPosition==="upperleft"?(P=[-5,5],l="right",a="bottom"):e.labelPosition==="lowerright"?(P=[5,-5],l="left",a="top"):(P=[-5,-5],l="right",a="top"),t.current.label.visProp.anchorx=l,t.current.label.visProp.anchory=a,t.current.label.visProp.offset=P,w.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();d.updateRenderer()}return v(F,{children:v("a",{name:S})})}if(e.hidden)return null;let X="\\("+e.latex+"\\)";return Y(F,{children:[v("a",{name:S}),v("span",{id:S,children:v(B.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:X})})]})});function _(b,C){return b==="dashed"||C?2:b==="solid"?0:b==="dotted"?1:0}export{z as default};
