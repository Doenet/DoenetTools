import{r as l,a3 as ne,e as r,a6 as M,s as b,l as k,q as se,a7 as A,ai as ae,R as P,aj as ie,ak as U,al as O,A as y,y as re,c as le,f as ue,u as ce,O as de,P as fe,o as K,g as ge,aT as pe,a5 as me,a4 as N,aU as Ie,j as F,D as we}from"./index-a1cd8b25.js";function Se(t,s,o=window){const a=l.useRef(s);l.useEffect(()=>{a.current=s},[s]),l.useEffect(()=>{if(o==null)return;const c=p=>a.current(p);return o.addEventListener(t,c),()=>o.removeEventListener(t,c)},[t,o])}const $=()=>K(({snapshot:s,set:o})=>async()=>{const a=await s.getPromise(N),c=await s.getPromise(O);o(M,a),c&&o(U,p=>p+1)});function Pe(){let t=ne();const s=t==null?void 0:t.courseId,o=t==null?void 0:t.doenetId,a=t==null?void 0:t.pageDoenetId,c=r(M),p=r(b("pageId")),w=r(b("linkPageId")),L=r(b("doenetId"));let u=p,v=L;w&&(u=w,v=w),o&&(u=a,v=o);const[_,x]=k(se),T=r(A),[q,z]=k(ae),B=P(ie),h=P(A),H=r(U),Q=P(O),[V,G]=k(y(u)),d=r(y(L)),C=P(re),{canUpload:J}=r(le),W=$();let X=ue(),n=ce();const m=l.useRef({}),S=l.useRef(null);de(v),fe(_);let E=!1,I=null;Object.keys(V).length>0&&(E=!0,d!=null&&d.isSinglePage&&!w?I=d==null?void 0:d.label:I=V.label),l.useEffect(()=>{const e=document.title;return I&&(document.title=`${I} - Doenet`),()=>{document.title=e}},[I]);let R=K(({snapshot:e,set:i})=>async D=>{let{data:f}=await ge.get(`/media/byPageId/${D}.doenet`);f=f.toString();let j=await e.getPromise(y(D)),te=await e.getPromise(y(j.containingDoenetId));const oe=await pe(f);i(me,f),i(N,f),i(M,f),i(A,D),i(Ie,oe);let g=[];te.type=="bank"&&g.push("AssignmentSettingsMenu"),j.type=="pageLink"&&(g.push("AssignmentSettingsMenu"),g.push("PageLink"),g.push("SupportingFilesMenu")),J!=="1"&&g.push("SupportingFilesMenu"),C(g)},[C]);if(l.useEffect(()=>(u!==""&&E?R(u):a&&(x(s),G({containingDoenetId:o,doenetId:a,isSelected:!1,label:"Untitled",parentDoenetId:o,type:"page"})),()=>{h("")}),[s,x,R,h,a,u,E]),Se("keydown",e=>{(e.keyCode===83&&e.metaKey||e.keyCode===83&&e.ctrlKey)&&(e.preventDefault(),W())}),l.useEffect(()=>{var e,i;S.current!==n.key&&(((e=n.state)==null?void 0:e.previousScrollPosition)!==void 0&&S.current&&(m.current[S.current].lastScrollPosition=n.state.previousScrollPosition),m.current[n.key]&&((i=m.current[n.key])==null?void 0:i.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:m.current[n.key].lastScrollPosition}),m.current[n.key]={...n},S.current=n.key)},[n]),_==="__not_found__")return F("h1",{children:"Content not found or no permission to view content"});if(u!==T)return null;let Y=1,Z="button";function ee(e){B(e),z(e)}return F(we,{doenetML:c,flags:{showCorrectness:!0,solutionDisplayMode:Z,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},activityId:L,idsIncludeActivityId:!1,attemptNumber:Y,generatedVariantCallback:ee,requestedVariantIndex:q.index,setIsInErrorState:Q,location:n,navigate:X,linkSettings:{viewURL:"/course?tool=assignment",editURL:"/course?tool=editor",useQueryParameters:!0}},`pageViewer${H}`)}const Le=Object.freeze(Object.defineProperty({__proto__:null,default:Pe,useUpdateViewer:$},Symbol.toStringTag,{value:"Module"}));export{Le as E,Se as a,$ as u};
