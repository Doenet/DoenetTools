import{ao as Q,bl as Z,r as u,bw as $,j as B,F as ee}from"./index-a1cd8b25.js";import{BoardContext as re,LINE_LAYER_OFFSET as D,VERTEX_LAYER_OFFSET as T}from"./graph-36cd2399.js";import"./css-14ccef8c.js";const le=Q.memo(function P(z){let{name:g,id:q,SVs:e,actions:p,sourceOfUpdate:F,callAction:y}=Z(z);P.ignoreActionsWithoutCore=()=>!0;const c=u.useContext(re);let r=u.useRef(null),h=u.useRef(null),v=u.useRef(null),w=u.useRef(null),b=u.useRef(null),E=u.useRef(null),L=u.useRef(!1),A=u.useRef(!1),m=u.useRef(null),C=u.useRef(null),M=u.useRef(null),k=u.useRef(!1),S=u.useRef(!1),O=u.useRef(!1);M.current=e.numericalVertices,k.current=e.fixed,S.current=!e.draggable||e.fixLocation||e.fixed,O.current=!e.verticesDraggable||e.fixed||e.fixLocation;const{darkMode:R}=u.useContext($)||{};u.useEffect(()=>()=>{r.current&&I(),c&&c.off("move",G)},[]),u.useEffect(()=>{c&&c.on("move",G)},[c]);function K(){if(!(e.numVertices>=2))return null;let t=R==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,n=R==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;n=e.filled?n:"none",C.current={fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),visible:!O.current&&!e.hidden,withLabel:!1,layer:10*e.layer+T,highlight:!0,showInfoBox:e.showCoordsWhenDragging};let l={highlight:!1,visible:!e.hidden,layer:10*e.layer+D,fixed:!0,strokeColor:t,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:t,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:N(e.selectedStyle.lineStyle)},i={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:k.current,layer:10*e.layer+D,fillColor:n,fillOpacity:e.selectedStyle.fillOpacity,highlightFillColor:n,highlightFillOpacity:e.selectedStyle.fillOpacity*.5,highlight:!S.current,vertices:C.current,borders:l};i.label={highlight:!1},e.labelHasLatex&&(i.label.useMathJax=!0),e.applyStyleToLabel?i.label.strokeColor=t:i.label.strokeColor="var(--canvastext)",e.filled&&(i.hasInnerPoints=!0),c.suspendUpdate();let a=[];for(let d of e.numericalVertices)a.push(c.create("point",[...d],C.current));let f=c.create("polygon",a,i);return f.isDraggable=!S.current,X(f),f.on("drag",d=>U(-1,d)),f.on("up",d=>Y(-1)),f.on("keyfocusout",d=>H(-1)),f.on("keydown",d=>J(-1,d)),f.on("down",d=>W(-1,d)),f.on("hit",d=>_()),c.unsuspendUpdate(),m.current=e.numVertices,f}function G(t){L.current&&(Math.abs(t.x-b.current[0])>.1||Math.abs(t.y-b.current[1])>.1)&&(A.current=!0)}function X(t){for(let n=0;n<e.numVertices;n++){let l=t.vertices[n];l.off("drag"),l.on("drag",i=>U(n,i)),l.off("up"),l.on("up",()=>Y(n)),l.off("keyfocusout"),l.on("keyfocusout",()=>H(n)),l.off("keydown"),l.on("keydown",i=>J(n,i)),l.off("down"),l.on("down",i=>W(n,i)),l.off("hit"),l.on("hit",i=>_())}}function I(){for(let t=0;t<e.numVertices;t++){let n=r.current.vertices[t];n&&(n.off("drag"),n.off("up"),n.off("down"),n.off("hit"))}r.current.off("drag"),r.current.off("up"),r.current.off("down"),r.current.off("hit"),c.removeObject(r.current),r.current=null}function U(t,n){let l=n.type==="pointermove";if(!l||Math.abs(n.x-b.current[0])>.1||Math.abs(n.y-b.current[1])>.1)if(v.current=t,t===-1){h.current=[];var i=c.origin.scrCoords;for(let a=0;a<r.current.vertices.length-1;a++)if(l){let f=(E.current[a][1]+n.x-b.current[0]-i[1])/c.unitX,d=(i[2]-(E.current[a][2]+n.y-b.current[1]))/c.unitY;h.current.push([f,d])}else{let f=r.current.vertices[a];h.current.push([f.X(),f.Y()])}y({action:p.movePolygon,args:{pointCoords:h.current,transient:!0,skippable:!0}});for(let a=0;a<e.numVertices;a++)r.current.vertices[a].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[a]])}else h.current={},h.current[t]=[r.current.vertices[t].X(),r.current.vertices[t].Y()],y({action:p.movePolygon,args:{pointCoords:h.current,transient:!0,skippable:!0,sourceDetails:{vertex:t}}}),r.current.vertices[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[t]]),c.updateInfobox(r.current.vertices[t])}function W(t,n){v.current=null,b.current=[n.x,n.y],t===-1?(w.current===null&&!k.current&&y({action:p.polygonFocused,args:{name:g}}),E.current=r.current.vertices.map(l=>[...l.coords.scrCoords])):(O.current||y({action:p.polygonFocused,args:{name:g}}),w.current=t),L.current=!0,A.current=!1}function _(){v.current=null,y({action:p.polygonFocused,args:{name:g}})}function Y(t){v.current===t?y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceDetails:{vertex:t}}}):!A.current&&(w.current===null||t!==-1)&&!k.current&&y({action:p.polygonClicked,args:{name:g}}),t!==-1&&(w.current=null),L.current=!1}function H(t){v.current===t&&y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceInformation:{vertex:t}}}),v.current=null}function J(t,n){n.key==="Enter"&&(v.current===t&&y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceInformation:{vertex:t}}}),v.current=null,y({action:p.polygonClicked,args:{name:g}}))}if(c)if(!r.current)r.current=K();else if(!(e.numVertices>=2))I();else{let t=!0;for(let o of e.numericalVertices)Number.isFinite(o[0])||(t=!1),Number.isFinite(o[1])||(t=!1);if(e.numVertices>m.current){for(let o=m.current;o<e.numVertices;o++){let s=c.create("point",[...e.numericalVertices[o]],C.current);r.current.addPoints(s)}X(r.current)}else if(e.numVertices<m.current){for(let o=m.current-1;o>=e.numVertices;o--)r.current.vertices[o].off("drag"),r.current.vertices[o].off("down"),r.current.vertices[o].off("hit"),r.current.vertices[o].off("up"),r.current.vertices[o].off("keyfocusout"),r.current.vertices[o].off("keydown"),r.current.removePoints(r.current.vertices[o]);X(r.current)}let n=!O.current&&!e.hidden;for(let o=0;o<e.numVertices;o++)r.current.vertices[o].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[o]]),r.current.vertices[o].needsUpdate=!0,r.current.vertices[o].update(),r.current.vertices[o].visProp.visible=n,r.current.vertices[o].visPropCalc.visible=n,r.current.vertices[o].visProp.showinfobox=e.showCoordsWhenDragging;if(F.sourceInformation&&g in F.sourceInformation){let o=F.sourceInformation[g].vertex;o!==void 0&&c.updateInfobox(r.current.vertices[o])}let l=!e.hidden;t||(l=!1),r.current.visProp.fixed=k.current,r.current.visProp.highlight=!S.current,r.current.isDraggable=!S.current,r.current.visProp.visible=l,r.current.visPropCalc.visible=l;let i=10*e.layer+D,a=r.current.visProp.layer!==i,f,d;a&&(f=10*e.layer+D,d=10*e.layer+T,r.current.setAttribute({layer:i}));let V=R==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,x=R==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;x=e.filled?x:"none",r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=V:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),r.current.visProp.fillcolor!==x&&(r.current.visProp.fillcolor=x,r.current.visProp.highlightfillcolor=x,r.current.visProp.hasinnerpoints=e.filled),r.current.visProp.fillopacity!==e.selectedStyle.fillOpacity&&(r.current.visProp.fillopacity=e.selectedStyle.fillOpacity,r.current.visProp.highlightfillopacity=e.selectedStyle.fillOpacity*.5),r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let o=0;o<r.current.borders.length;o++){let s=r.current.borders[o];s.visProp.visible=l,s.visPropCalc.visible=l,a&&s.setAttribute({layer:f}),s.visProp.strokecolor!==V&&(s.visProp.strokecolor=V,s.visProp.highlightstrokecolor=V),s.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(s.visProp.strokeopacity=e.selectedStyle.lineOpacity,s.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let j=N(e.selectedStyle.lineStyle);s.visProp.dash!==j&&(s.visProp.dash=j),s.visProp.strokewidth!==e.selectedStyle.lineWidth&&(s.visProp.strokewidth=e.selectedStyle.lineWidth,s.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),s.needsUpdate=!0,s.update()}if(a){C.current.layer=d;for(let o of r.current.vertices)o.setAttribute({layer:d}),o.needsUpdate=!0,o.update()}m.current=e.numVertices,c.updateRenderer()}return e.hidden?null:B(ee,{children:B("a",{name:q})})});function N(P){return P==="solid"?0:P==="dashed"?2:P==="dotted"?1:0}export{le as default};
