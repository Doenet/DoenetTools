import{ao as J,bl as W,r as n,bw as Y,j as D,F as U}from"./index-e270c841.js";import{BoardContext as j,LINE_LAYER_OFFSET as G}from"./graph-8dcd0c22.js";import"./css-14ccef8c.js";const V=J.memo(function y(T){let{name:C,id:L,SVs:r,actions:a,sourceOfUpdate:B,callAction:d}=W(T);y.ignoreActionsWithoutCore=()=>!0;const i=n.useContext(j);let e=n.useRef({}),h=n.useRef(null),k=n.useRef(null),S=n.useRef(!1),R=n.useRef(!1),f=n.useRef(!1),x=n.useRef(null),l=n.useRef(null),P=n.useRef(null),O=n.useRef(null),g=n.useRef(!1),b=n.useRef(!1);P.current=r.numericalEndpoint,O.current=r.numericalThroughpoint,g.current=r.fixed,b.current=!r.draggable||r.fixLocation||r.fixed;const{darkMode:E}=n.useContext(Y)||{};n.useEffect(()=>()=>{Object.keys(e.current).length!==0&&F(),i&&i.off("move",w)},[]),n.useEffect(()=>{i&&i.on("move",w)},[i]);function M(){if(r.numericalEndpoint.length!==2||r.numericalThroughpoint.length!==2){e.current={};return}let c=E==="dark"?r.selectedStyle.lineColorDarkMode:r.selectedStyle.lineColor;var u={name:r.labelForGraph,visible:!r.hidden,withLabel:r.labelForGraph!=="",layer:10*r.layer+G,fixed:g.current,strokeColor:c,strokeOpacity:r.selectedStyle.lineOpacity,highlightStrokeColor:c,highlightStrokeOpacity:r.selectedStyle.lineOpacity*.5,strokeWidth:r.selectedStyle.lineWidth,highlightStrokeWidth:r.selectedStyle.lineWidth,dash:X(r.selectedStyle.lineStyle),highlight:!b.current,straightFirst:!1};u.label={highlight:!1},r.labelHasLatex&&(u.label.useMathJax=!0),r.applyStyleToLabel?u.label.strokeColor=c:u.label.strokeColor="var(--canvastext)";let m=[[...r.numericalEndpoint],[...r.numericalThroughpoint]],o=i.create("line",m,u);o.isDraggable=!b.current,o.on("drag",function(t){let v=t.type==="pointermove";if(!v||Math.abs(t.x-h.current[0])>.1||Math.abs(t.y-h.current[1])>.1){f.current=!0,l.current=[];for(let s=0;s<2;s++)if(v){var p=i.origin.scrCoords;let _=(k.current[s][1]+t.x-h.current[0]-p[1])/i.unitX,A=(p[2]-(k.current[s][2]+t.y-h.current[1]))/i.unitY;l.current.push([_,A])}else l.current.push([o.point1.X(),o.point1.Y()]),l.current.push([o.point2.X(),o.point2.Y()]);d({action:a.moveRay,args:{endpointcoords:l.current[0],throughcoords:l.current[1],transient:!0,skippable:!0}})}e.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,P.current),e.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,O.current)}),o.on("up",function(t){f.current?d({action:a.moveRay,args:{endpointcoords:l.current[0],throughcoords:l.current[1]}}):!R.current&&!g.current&&d({action:a.rayClicked,args:{name:C}}),S.current=!1}),o.on("keyfocusout",function(t){f.current&&(d({action:a.moveRay,args:{point1coords:l.current[0],point2coords:l.current[1]}}),f.current=!1)}),o.on("down",function(t){f.current=!1,h.current=[t.x,t.y],k.current=[[...o.point1.coords.scrCoords],[...o.point2.coords.scrCoords]],S.current=!0,R.current=!1,g.current||d({action:a.rayFocused,args:{name:C}})}),o.on("hit",function(t){f.current=!1,d({action:a.rayFocused,args:{name:C}})}),o.on("keydown",function(t){t.key==="Enter"&&(f.current&&(d({action:a.moveRay,args:{point1coords:l.current[0],point2coords:l.current[1]}}),f.current=!1),d({action:a.rayClicked,args:{name:C}}))}),x.current=r.labelForGraph!=="",e.current=o}function w(c){S.current&&(Math.abs(c.x-h.current[0])>.1||Math.abs(c.y-h.current[1])>.1)&&(R.current=!0)}function F(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),i.removeObject(e.current),e.current={}}if(i)if(Object.keys(e.current).length===0)M();else if(r.numericalEndpoint.length!==2||r.numericalThroughpoint.length!==2)F();else{let c=!0;for(let s of[r.numericalEndpoint,r.numericalThroughpoint])Number.isFinite(s[0])||(c=!1),Number.isFinite(s[1])||(c=!1);e.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,r.numericalEndpoint),e.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,r.numericalThroughpoint);let u=!r.hidden;if(c){let s=e.current.visProp.visible!==u;e.current.visProp.visible=u,e.current.visPropCalc.visible=u,s&&e.current.setAttribute({visible:u})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;e.current.visProp.fixed=g.current,e.current.visProp.highlight=!b.current,e.current.isDraggable=!b.current;let m=10*r.layer+G;e.current.visProp.layer!==m&&e.current.setAttribute({layer:m});let t=E==="dark"?r.selectedStyle.lineColorDarkMode:r.selectedStyle.lineColor;e.current.visProp.strokecolor!==t&&(e.current.visProp.strokecolor=t,e.current.visProp.highlightstrokecolor=t),e.current.visProp.strokewidth!==r.selectedStyle.lineWidth&&(e.current.visProp.strokewidth=r.selectedStyle.lineWidth,e.current.visProp.highlightstrokewidth=r.selectedStyle.lineWidth),e.current.visProp.strokeopacity!==r.selectedStyle.lineOpacity&&(e.current.visProp.strokeopacity=r.selectedStyle.lineOpacity,e.current.visProp.highlightstrokeopacity=r.selectedStyle.lineOpacity*.5);let v=X(r.selectedStyle.lineStyle);e.current.visProp.dash!==v&&(e.current.visProp.dash=v),e.current.name=r.labelForGraph;let p=r.labelForGraph!=="";p!=x.current&&(e.current.setAttribute({withlabel:p}),x.current=p),e.current.needsUpdate=!0,e.current.update(),e.current.hasLabel&&(r.applyStyleToLabel?e.current.label.visProp.strokecolor=t:e.current.label.visProp.strokecolor="var(--canvastext)",e.current.label.needsUpdate=!0,e.current.label.update()),i.updateRenderer()}return r.hidden?null:D(U,{children:D("a",{name:L})})});function X(y){return y==="solid"?0:y==="dashed"?2:y==="dotted"?1:0}export{V as default};
