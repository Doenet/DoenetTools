import{e as j,s as k,o as E,G as L,aa as M,aC as F,j as N,B as U}from"./index-a1cd8b25.js";import{assignmentData as W,overviewData as X,gradeCategories as q}from"./Gradebook-b70ece1a.js";import"./RoleDropdown-6cbb7a86.js";import"./DropdownMenu-3b5a6419.js";function Q(){const R=j(k("courseId")),D=E(({snapshot:d})=>async p=>{var h,x,S,A,T,B;const{label:G}=await d.getPromise(L(p));let O=`${G}.csv`,f,a=await d.getPromise(W),V=await d.getPromise(X);const{value:_}=await d.getPromise(M(p));let t={},I="Name,Email,External Id,Section,Withdrew,",l="Possible Points,,,,,";for(const{userId:o,email:i,roleId:P,withdrew:v,externalId:m,section:w,firstName:b,lastName:e}of _){const{isIncludedInGradebook:s}=await d.getPromise(F({courseId:p,roleId:P}));if(s!=="1")continue;const $=`${b} ${e}`.replaceAll('"','""');t[o]={courseTotal:0,csv:`"${$}",${i},${m},${w},${v==="1"?"X":""},`}}let y=0,C=Object.entries(a);C.sort((o,i)=>o[1].sortOrder<i[1].sortOrder?-1:1);for(let{category:o,scaleFactor:i=1,maximumNumber:P=1/0,maximumValue:v=1/0}of q){let m=[];for(const e in t)t[e][o]=[];for(const[e]of C){let s=(h=a[e])==null?void 0:h.category;if((s==null?void 0:s.toLowerCase())!==(o==null?void 0:o.toLowerCase()))continue;let $=(x=a[e])==null?void 0:x.label.replaceAll('"','""');I+=`"${$}",`;let n=((S=a==null?void 0:a[e])==null?void 0:S.totalPointsOrPercent)*1;l=`${l}${n},`,m.push(n);for(const r in t){let c=(T=(A=V[r])==null?void 0:A.assignments)==null?void 0:T[e];if(c===null&&((B=a==null?void 0:a[e])==null?void 0:B.isGloballyAssigned)==="0"){t[r].csv=`${t[r].csv},`;continue}let g=n*c;g=Math.round(g*100)/100,t[r].csv=`${t[r].csv}${g},`,t[r][o].push(g)}}m.sort((e,s)=>s-e).slice(0,P);let w=m.reduce((e,s)=>e+s,0)*i,b=Math.min(w,v);y+=b,I+=`${o} Total,`,l=`${l}${b},`;for(const e in t){let s=t[e][o];s=s.sort((r,c)=>c-r).slice(0,P);let $=s.reduce((r,c)=>r+c,0)*i,n=Math.min($,v);t[e].csv=`${t[e].csv}${n},`,t[e].courseTotal+=n}}I+="Course Total",l=`${l}${y}`,f=`${I}
${l}`;for(const o in t)f=`${f}
${t[o].csv}${t[o].courseTotal}`;var u=document.createElement("a");u.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(f)),u.setAttribute("download",O),document.body.appendChild(u),u.click(),document.body.removeChild(u)},[]);return N("div",{children:N(U,{value:"Download CSV",onClick:()=>{D(R)}})})}export{Q as default};
