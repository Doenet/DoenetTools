import{av as W,bn as N,r as d,l as I,bs as B,j as G,F as H}from"./index-9d63439d.js";import{BoardContext as q,LINE_LAYER_OFFSET as Y,VERTEX_LAYER_OFFSET as _}from"./graph-0c612329.js";import"./css-14ccef8c.js";import"./visibility-sensor-aefdbbd5.js";const z=W.memo(function V(j){let{name:D,id:J,SVs:e,actions:y,sourceOfUpdate:F,callAction:g}=N(j);V.ignoreActionsWithoutCore=!0;const s=d.useContext(q);let r=d.useRef(null),i=d.useRef(null),v=d.useRef(null),b=d.useRef(null),k=d.useRef(null),m=d.useRef(null),X=d.useRef(null),C=d.useRef(null),P=d.useRef(null),S=d.useRef(null);S.current=e.numericalVertices;const E=I(B);d.useEffect(()=>()=>{r.current&&L()},[]);function T(){if(e.numericalVertices.length!==e.nVertices||e.numericalVertices.some(l=>l.length!==2))return null;let n=!0;for(let l of e.numericalVertices)Number.isFinite(l[0])||(n=!1),Number.isFinite(l[1])||(n=!1);let a=!e.draggable||e.fixed,u=E==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;u=u.toLowerCase();let o={name:e.labelForGraph,visible:!e.hidden&&n,withLabel:e.showLabel&&e.labelForGraph!=="",layer:10*e.layer+Y,fixed:a,strokeColor:u,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:u,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:A(e.selectedStyle.lineStyle),highlight:!a,lineCap:"butt"},c=!e.verticesDraggable||e.fixed;P.current=Object.assign({},o),Object.assign(P.current,{fixed:!1,highlight:!0,withLabel:!1,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*e.layer+_}),(c||e.hidden||!n)&&(P.current.visible=!1),o.label={highlight:!1},e.labelHasLatex&&(o.label.useMathJax=!0),e.applyStyleToLabel?o.label.strokeColor=u:o.label.strokeColor="var(--canvastext)",i.current=[];for(let l=0;l<e.nVertices;l++)i.current.push(s.create("point",[...e.numericalVertices[l]],P.current));let x=[],R=[];e.numericalVertices.forEach(l=>{x.push(l[0]),R.push(l[1])});let p=s.create("curve",[x,R],o);for(let l=0;l<e.nVertices;l++)i.current[l].on("drag",h=>O(l,h)),i.current[l].on("up",()=>M(l)),i.current[l].on("down",h=>{b.current=null,m.current=[h.x,h.y],k.current=l,g({action:y.mouseDownOnPolyline})});return p.on("drag",l=>O(-1,l)),p.on("up",()=>M(-1)),p.on("down",function(l){b.current=null,m.current=[l.x,l.y],X.current=p.points.map(h=>[...h.scrCoords]),k.current===null&&g({action:y.mouseDownOnPolyline})}),C.current=e.nVertices,p}function L(){r.current.off("drag"),r.current.off("down"),r.current.off("up"),s.removeObject(r.current),r.current=null;for(let n=0;n<e.nVertices;n++)i.current[n].off("drag"),i.current[n].off("down"),i.current[n].off("up"),s.removeObject(i.current[n]),delete i.current[n]}function O(n,a){if(Math.abs(a.x-m.current[0])>.1||Math.abs(a.y-m.current[1])>.1)if(b.current=n,n===-1){v.current=U(a),g({action:y.movePolyline,args:{pointCoords:v.current,transient:!0,skippable:!0}}),r.current.updateTransformMatrix();let u=r.current.transformMat[1][0],o=r.current.transformMat[2][0];for(let c=0;c<e.nVertices;c++)i.current[c].coords.setCoordinates(JXG.COORDS_BY_USER,[...S.current[c]]),r.current.dataX[c]=S.current[c][0]-u,r.current.dataY[c]=S.current[c][1]-o}else v.current={},v.current[n]=[i.current[n].X(),i.current[n].Y()],g({action:y.movePolyline,args:{pointCoords:v.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),i.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...S.current[n]]),s.updateInfobox(i.current[n])}function M(n){b.current===n?g(n===-1?{action:y.movePolyline,args:{pointCoords:v.current}}:{action:y.movePolyline,args:{pointCoords:v.current,sourceDetails:{vertex:n}}}):b.current===null&&(k.current===null||n!==-1)&&g({action:y.polylineClicked}),n!==-1&&(k.current=null)}function U(n){var a=s.origin.scrCoords;let u=[];for(let o=0;o<r.current.points.length;o++){let c=(X.current[o][1]+n.x-m.current[0]-a[1])/s.unitX,x=(a[2]-(X.current[o][2]+n.y-m.current[1]))/s.unitY;u.push([c,x])}return u}if(s)if(!r.current)r.current=T();else if(e.numericalVertices.length!==e.nVertices||e.numericalVertices.some(n=>n.length!==2))L();else{let n=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(n=!1),Number.isFinite(t[1])||(n=!1);let a=!e.draggable||e.fixed;r.current.visProp.fixed=a,r.current.visProp.highlight=!a;let u=10*e.layer+Y,o=r.current.visProp.layer!==u,c=10*e.layer+_;if(o&&(r.current.setAttribute({layer:u}),P.current.layer=c),e.nVertices>C.current)for(let t=C.current;t<e.nVertices;t++)i.current.push(s.create("point",[...e.numericalVertices[t]],P.current)),r.current.dataX.length=e.nVertices,i.current[t].on("drag",f=>O(t,!0)),i.current[t].on("up",f=>O(t,!1)),i.current[t].on("down",f=>b.current=null);else if(e.nVertices<C.current){for(let t=e.nVertices;t<C.current;t++){let f=i.current.pop();f.off("drag"),f.off("down"),f.off("up"),s.removeObject(f)}r.current.dataX.length=e.nVertices}C.current=e.nVertices,r.current.updateTransformMatrix();let x=r.current.transformMat[1][0],R=r.current.transformMat[2][0];for(let t=0;t<e.nVertices;t++)i.current[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[t]]),r.current.dataX[t]=e.numericalVertices[t][0]-x,r.current.dataY[t]=e.numericalVertices[t][1]-R;let p=!e.hidden;if(n){r.current.visProp.visible=p,r.current.visPropCalc.visible=p;let t=!e.verticesDraggable||e.fixed,f=p&&!t;for(let w=0;w<e.nVertices;w++)i.current[w].visProp.visible=f,i.current[w].visPropCalc.visible=f}else{r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;for(let t=0;t<e.nVertices;t++)i.current[t].visProp.visible=!1,i.current[t].visPropCalc.visible=!1}let l=E==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;l=l.toLowerCase(),r.current.visProp.strokecolor!==l&&(r.current.visProp.strokecolor=l,r.current.visProp.highlightstrokecolor=l),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let h=A(e.selectedStyle.lineStyle);if(r.current.visProp.dash!==h&&(r.current.visProp.dash=h),r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=l:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),F.sourceInformation&&D in F.sourceInformation){let t=F.sourceInformation[D].vertex;Number.isFinite(t)&&s.updateInfobox(i.current[t])}r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let t=0;t<e.nVertices;t++)o&&i.current[t].setAttribute({layer:c}),i.current[t].needsUpdate=!0,i.current[t].update();s.updateRenderer()}return e.hidden?null:G(H,{children:G("a",{name:J})})});function A(V){return V==="solid"?0:V==="dashed"?2:V==="dotted"?1:0}export{z as default};
