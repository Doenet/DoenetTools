import{R as ne,p as ae,l as j,S as oe,r as R,v as q,o as se,q as le,k as K,G as ie,H as re,j as t,N as L,a as f,F as de,B as _,i as H,aL as ce,a2 as ue,ah as E,A as ge,aM as me}from"./index-404de25b.js";import{g as pe,c as he}from"./CourseToolHandler-94ff05aa.js";import{B as fe}from"./ButtonGroup-c43b7e60.js";import{e as be}from"./RoleDropdown-445d5eea.js";const J=E({key:"classTimesAtom",default:[]}),we=E({key:"showCompletedAtom",default:!0}),ye=E({key:"showOverdueAtom",default:!1});function xe(e,b,r,p){if(e=="Invalid Date"||e==null)return null;let u=e.getDay();for(let g of b)if(g.dotwIndex==u){let s=new Date(e.getTime());const[i,h]=g.startTime.split(":");s.setHours(i,h,0,0);let D=new Date(e.getTime());const[$,a]=g.endTime.split(":");if(D.setHours($,a,0,0),e>=s&&e<D)return e.getMonth()!=r.getMonth()||e.getDate()!=r.getDate()?`In Class ${e.getMonth()+1}/${e.getDate()}`:"In Class";if(e.getTime()==D.getTime())return e.getMonth()!=r.getMonth()||e.getDate()!=r.getDate()?`After Class ${e.getMonth()+1}/${e.getDate()}`:"After Class"}let l=e.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});if(l==="Invalid Date"&&(l=null),p){let g=new Date,s=new Date(g.getTime()+1e3*60*60*24*-1),i=new Date(g.getTime()+1e3*60*60*24*1);return e.getMonth()==s.getMonth()&&e.getDate()==s.getDate()&&e.getFullYear()==s.getFullYear()?`Yesterday - ${l}`:e.getMonth()==i.getMonth()&&e.getDate()==i.getDate()&&e.getFullYear()==i.getFullYear()?`Tomorrow - ${l}`:`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()]} - ${l}`}let w=`${e.getMonth()+1}/${e.getDate()} ${l}`;return l===null&&(w=null),w}function De(e,b){if(e=="Invalid Date"||e==null)return null;let r=e.getDay();for(let u of b)if(u.dotwIndex==r){let l=new Date(e.getTime());const[w,g]=u.startTime.split(":");l.setHours(w,g,0,0);let s=new Date(e.getTime());const[i,h]=u.endTime.split(":");if(s.setHours(i,h,0,0),e.getTime()==l.getTime())return"Before Class";if(e>l&&e<s)return"In Class";if(e.getTime()==s.getTime())return"End of Class"}let p=e.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});return p=`${e.getMonth()+1}/${e.getDate()} ${p}`,p==="Invalid Date"&&(p=null),p}function N({dotw:e="",rowLabel:b="",assignments:r,clickCallback:p,completedArray:u,setCompletedArray:l,classTimes:w,weekShift:g,selectedItemId:s,showCompleted:i}){let h=[];if(r.length>0){let D=!0,$=0;for(let a of r){let n=u.includes(a.doenetId);(i||!i&&!n)&&$++}for(let a=0;a<r.length;a++){let n=r[a],k=L(n.assignedDate),v="";k&&k.setSeconds(0,0);let S=L(n.dueDate),T="",B="";S&&(S.setSeconds(0,0),B=`${e} `,T=De(S,w),k&&(v=xe(k,w,S,g==0))),b!==""&&(B=b);let d=null;n.itemId===s&&(d="#B8D2EA");let y=x=>{x.stopPropagation(),p({courseId:n.courseId,doenetId:n.doenetId})},M=u.includes(n.doenetId);if(!i&&M)continue;let C="";if(n.gradeCategory){const x=Number(n.totalPointsOrPercent);let A=Math.round(n.credit*x*100)/100;n.creditOverride&&(A=Math.round(n.creditOverride*x*100)/100),C=`${A}/${x}`}let P=t(ge,{checked:M,onClick:x=>{x.stopPropagation(),l(M?A=>{let O=[...A];return O.splice(O.indexOf(n.doenetId),1),O}:A=>[n.doenetId,...A]),K.get("/api/saveCompleted.php",{params:{doenetId:n.doenetId}})}});D?(D=!1,h.push(f("tr",{"data-test":`cbw row ${a}`,children:[t("td",{"data-test":`cbw row label ${a}`,style:{borderBottom:"2px solid black",padding:"8px"},rowSpan:$,children:B}),t("td",{"data-test":`cbw assignment label ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:n.label}),t("td",{"data-test":`cbw assigned date ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:v}),t("td",{"data-test":`cbw due date ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:T}),t("td",{"data-test":`cbw score ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:C}),t("td",{"data-test":`cbw completed ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:P})]},`${B}${n.doenetId}`))):h.push(f("tr",{"data-test":`cbw row ${a}`,children:[t("td",{"data-test":`cbw assignment label ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:n.label}),t("td",{"data-test":`cbw assigned date ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:v}),t("td",{"data-test":`cbw due date ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",cursor:"pointer"},onClick:y,children:T}),t("td",{"data-test":`cbw score ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:C}),t("td",{"data-test":`cbw completed ${a}`,style:{backgroundColor:d,padding:"8px",borderBottom:"2px solid black",textAlign:"center"},children:P})]},`${B}${n.doenetId}${a}`))}}return h}function Ie({courseId:e}){var G;const b=ne(ae),r=j(we),p=j(ye);oe(e);let[u,l]=R.useState([]),[w,g]=R.useState([]),[s,i]=R.useState([]),[h,D]=R.useState(!1),[$,a]=R.useState(""),[n,k]=R.useState(0),v=j(J),S=j(pe),T=null;((G=S[0])==null?void 0:G.driveInstanceId)==="currentContent"&&(T=S[0].itemId);let B=q(({set:c})=>async m=>{c(se,I=>[...I,{atom:he,value:null},{atom:le,value:null}]);const{data:o}=await K.get("/api/loadTODO.php",{params:{courseId:m}});if(!o.success){a(o.message);return}o.assignments&&(l(o.assignments),g(o.pinned)),o.classTimes&&c(J,o.classTimes),o.completed&&i(o.completed)});const d=q(({set:c,snapshot:m})=>async o=>{const I=o.courseId,W=o.doenetId;let{canEditContent:Z}=await m.getPromise(be(I));if(Z==="1"){let ee=await m.getPromise(ie(W)),te=re(ee.content);b({page:"course",tool:"editor",view:"",params:{doenetId:W,pageId:te}})}else b({page:"course",tool:"assignment",view:"",params:{doenetId:W}})},[]);if(!h&&e!=="")return D(!0),B(e),null;if($!=="")return t("div",{children:t("h2",{children:$})});let y=new Date,M=1-y.getDay();M===1&&(M=-6);let C=new Date(y.getTime()+1e3*60*60*24*M+1e3*60*60*24*n*7),P=new Date(C.getTime()+1e3*60*60*24*6),x=`${C.getMonth()+1}/${C.getDate()}`,A=`${P.getMonth()+1}/${P.getDate()}`,O=[],V=[],Q=f("p",{children:[t(H,{icon:me})," Pinned"]});if(n==0&&(O.push(...N({rowLabel:Q,assignments:w,clickCallback:d,completedArray:s,setCompletedArray:i,classTimes:v,weekShift:n,selectedItemId:T,showCompleted:r})),p)){const c=new Date;let m=[];for(let o of u){const I=L(o.dueDate);if(!I||I>c)break;s.includes(o.doenetId)||m.push(o)}V.push(...N({rowLabel:"Overdue",assignments:m,clickCallback:d,completedArray:s,setCompletedArray:i,classTimes:v,weekShift:n,selectedItemId:T,showCompleted:r}))}let Y=[],z=new Date(C.getTime());z.setHours(0,0,0,0);let U=new Date(P.getTime());U.setHours(23,59,59,999);let F=[[],[],[],[],[],[],[]];for(let c=0;c<u.length;c++){let m=u[c],o=L(m.dueDate);if(!o||o<z)continue;if(o>U)break;let I=o.getDay();F[I].push({...m})}F.push(F.shift());const X=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(let[c,m]of Object.entries(F))Y.push(...N({dotw:X[c],assignments:m,clickCallback:d,completedArray:s,setCompletedArray:i,classTimes:v,weekShift:n,selectedItemId:T,showCompleted:r}));return f(de,{children:[f("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-evenly",width:"850px",height:"70px"},children:[f("span",{children:[t(_,{onClick:()=>k(0),value:"This Week"})," "]}),t("h1",{children:"Content by Week"}),f("span",{style:{fontSize:"1.4em"},children:[x," - ",A]}),f(fe,{children:[t("span",{children:t(_,{dataTest:"previous week button",onClick:()=>k(c=>c-1),icon:t(H,{icon:ce})})}),t("span",{children:t(_,{dataTest:"next week button",onClick:()=>k(c=>c+1),icon:t(H,{icon:ue})})})]})]}),f("table",{style:{width:"850px",borderSpacing:"0em .2em"},children:[f("tr",{children:[t("th",{style:{width:"100px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Day"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Name"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Assigned"}),t("th",{style:{width:"200px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Due"}),t("th",{style:{width:"50px",padding:"8px",textAlign:"left",borderBottom:"2px solid black"},children:"Score"}),t("th",{style:{width:"100px",padding:"8px",textAlign:"center",borderBottom:"2px solid black"},children:"Completed"})]}),O,V,Y]})]})}export{Ie as N,we as a,J as c,ye as s};
