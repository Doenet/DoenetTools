import{r as i,a4 as Y,l as o,m as L,w as Z,g as ee,h as te,R as w,f as ne,G as E,E as oe,c as ae,ab as se,u as re,Q as ie,S as le,v as h,k as ue,j as V,P as ce}from"./index-7c464f87.js";import{v as x,e as k,r as C,a as R,u as de,t as j}from"./EditorViewerRecoil-3cdc0eec.js";function fe(t,a,s=window){const c=i.useRef(a);i.useEffect(()=>{c.current=a},[a]),i.useEffect(()=>{if(s==null)return;const d=l=>c.current(l);return s.addEventListener(t,d),()=>s.removeEventListener(t,d)},[t,s])}const F=()=>h(({snapshot:a,set:s})=>async()=>{const c=await a.getPromise(j),d=await a.getPromise(R);s(x,c),d&&s(C,l=>l+1)});function me(){let t=Y();const a=t==null?void 0:t.doenetId,s=t==null?void 0:t.pageDoenetId,c=o(x),d=o(L("pageId")),l=o(L("linkPageId")),v=o(L("doenetId"));let u=d,y=v;l&&(u=l,y=l),a&&(u=s,y=a);const _=o(Z),N=o(k),[O,$]=ee(te),B=w(ne),K=w(k),z=o(C),G=w(R),A=o(E(u)),f=o(E(v)),D=w(oe),{canUpload:J}=o(ae),U=F(),q=w(se);let n=re();const g=i.useRef({}),P=i.useRef(null);ie(y),le(_);let b=!1,I=null;Object.keys(A).length>0&&(b=!0,f!=null&&f.isSinglePage&&!l?I=f==null?void 0:f.label:I=A.label),i.useEffect(()=>{const e=document.title;return I&&(document.title=`${I} - Doenet`),()=>{document.title=e}},[I]);let H=h(({snapshot:e,set:r})=>async m=>{let{data:S}=await ue.get(`/media/byPageId/${m}.doenet`);S=S.toString();let M=await e.getPromise(E(m)),X=await e.getPromise(E(M.containingDoenetId));r(de,S),r(j,S),r(x,S),r(k,m);let p=[];X.type=="bank"&&p.push("AssignmentSettingsMenu"),M.type=="pageLink"&&(p.push("AssignmentSettingsMenu"),p.push("PageLink"),p.push("SupportingFilesMenu")),J!=="1"&&p.push("SupportingFilesMenu"),D(p)},[D]);if(i.useEffect(()=>(u!==""&&b&&H(u),()=>{K("")}),[u,b]),fe("keydown",e=>{(e.keyCode===83&&e.metaKey||e.keyCode===83&&e.ctrlKey)&&(e.preventDefault(),U())}),i.useEffect(()=>{var e,r;P.current!==n.key&&(((e=n.state)==null?void 0:e.previousScrollPosition)!==void 0&&P.current&&(g.current[P.current].lastScrollPosition=n.state.previousScrollPosition),g.current[n.key]&&((r=g.current[n.key])==null?void 0:r.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:g.current[n.key].lastScrollPosition}),g.current[n.key]={...n},P.current=n.key)},[n]),i.useEffect(()=>{const e=document.getElementById("mainPanel");q(e)},[]),_==="__not_found__")return V("h1",{children:"Content not found or no permission to view content"});if(u!==N)return null;let Q=1,T="button";function W(e,r){const m=JSON.parse(JSON.stringify(e));B({index:m.index,allPossibleVariants:r}),$({index:m.index})}return V(ce,{doenetML:c,flags:{showCorrectness:!0,solutionDisplayMode:T,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},doenetId:v,attemptNumber:Q,generatedVariantCallback:W,requestedVariantIndex:O.index,setIsInErrorState:G,pageIsActive:!0},`pageViewer${z}`)}const Ie=Object.freeze(Object.defineProperty({__proto__:null,default:me,useUpdateViewer:F},Symbol.toStringTag,{value:"Module"}));export{Ie as E,fe as a,F as u};
