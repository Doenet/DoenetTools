var hu=Object.defineProperty;var yu=(Il,Vl,_l)=>Vl in Il?hu(Il,Vl,{enumerable:!0,configurable:!0,writable:!0,value:_l}):Il[Vl]=_l;var Ms=(Il,Vl,_l)=>(yu(Il,typeof Vl!="symbol"?Vl+"":Vl,_l),_l);(function(){var kl,uu,cu,Bl,Xl,pu,Ll,eu,Rl,Yl,tu,ru,zl;"use strict";class ParameterStack{constructor(ts){this.stack=[{}],ts!==void 0&&Object.assign(this.parameters,ts)}get parameters(){return this.stack[this.stack.length-1]}push(ts,rs=!0){let ns={};rs?(Object.assign(ns,this.parameters),ts!==void 0&&Object.assign(ns,ts)):ns=ts,this.stack.push(ns)}pop(){let ts=this.stack.pop();return this.stack.length===0&&(this.stack=[{}]),ts}}class Numerics{constructor({maxIterationsRoot:ts=80,maxIterationsMinimize:rs=500,eps:ns=1e-6}={}){this.maxIterationsRoot=ts,this.maxIterationsMinimize=rs,this.eps=ns}fzero(ts,rs,ns){var is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs,xs,As,ws,Es=this.eps,Ss=this.maxIterationsRoot,Ds=0;if(Array.isArray(rs)){if(rs.length<2)throw new Error("fzero: length of array x0 has to be at least two.");is=rs[0],ls=ts.call(ns,is),as=rs[1],us=ts.call(ns,as)}else{for(is=rs,ls=ts.call(ns,is),is===0?ps=1:ps=is,ds=[.9*ps,1.1*ps,ps-1,ps+1,.5*ps,1.5*ps,-ps,2*ps,-10*ps,10*ps],hs=ds.length,fs=0;fs<hs&&(as=ds[fs],us=ts.call(ns,as),!(ls*us<=0));fs++);as<is&&(ys=is,is=as,as=ys,gs=ls,ls=us,us=gs)}if(ls*us>0)return Array.isArray(rs)?this.fminbr(ts,[is,as],ns).x:this.Newton(ts,is,ns);for(os=is,cs=ls;Ds<Ss;){if(bs=as-is,Math.abs(cs)<Math.abs(us)&&(is=as,as=os,os=is,ls=us,us=cs,cs=ls),Cs=.5*Es*(Math.abs(as)+1),ws=(os-as)*.5,Math.abs(ws)<=Cs&&Math.abs(us)<=Es)return as;Math.abs(bs)>=Cs&&Math.abs(ls)>Math.abs(us)&&(Ns=os-as,is===os?(vs=us/ls,xs=Ns*vs,As=1-vs):(As=ls/cs,vs=us/cs,Ts=us/ls,xs=Ts*(Ns*As*(As-vs)-(as-is)*(vs-1)),As=(As-1)*(vs-1)*(Ts-1)),xs>0?As=-As:xs=-xs,xs<.75*Ns*As-Math.abs(Cs*As)*.5&&xs<Math.abs(bs*As*.5)&&(ws=xs/As)),Math.abs(ws)<Cs&&(ws>0?ws=Cs:ws=-Cs),is=as,ls=us,as+=ws,us=ts.call(ns,as),(us>0&&cs>0||us<0&&cs<0)&&(os=is,cs=ls),Ds++}return as}fminbr(ts,rs,ns,is){let as=is!==void 0?is:this.eps;var os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs,xs,As=(3-Math.sqrt(5))*.5,ws=as,Es=as,Ss=this.maxIterationsMinimize,Ds=0;if(!Array.isArray(rs)||rs.length<2)throw new Error("Numerics.fminbr: length of array x0 has to be at least two.");if(os=rs[0],ls=rs[1],cs=os+As*(ls-os),fs=ts.call(ns,cs),Number.isNaN(fs))return{success:!1};for(us=cs,ps=cs,ds=fs,hs=fs;Ds<Ss;){if(ys=ls-os,gs=(os+ls)*.5,bs=Es*Math.abs(us)+ws/3,Math.abs(us-gs)+ys*.5<=2*bs)return{success:!0,x:us,fx:ds,tol:bs};if(vs=As*(us<gs?ls-us:os-us),Math.abs(us-ps)>=bs&&(Cs=(us-ps)*(ds-fs),Ts=(us-cs)*(ds-hs),Ns=(us-cs)*Ts-(us-ps)*Cs,Ts=2*(Ts-Cs),Ts>0?Ns=-Ns:Ts=-Ts,Math.abs(Ns)<Math.abs(vs*Ts)&&Ns>Ts*(os-us+2*bs)&&Ns<Ts*(ls-us-2*bs)&&(vs=Ns/Ts)),Math.abs(vs)<bs&&(vs>0?vs=bs:vs=-bs),Cs=us+vs,xs=ts.call(ns,Cs),Number.isNaN(xs))return{success:!1};xs<=ds?(Cs<us?ls=us:os=us,cs=ps,ps=us,us=Cs,fs=hs,hs=ds,ds=xs):(Cs<us?os=Cs:ls=Cs,xs<=hs||ps===us?(cs=ps,ps=Cs,fs=hs,hs=xs):(xs<=fs||cs===us||cs===ps)&&(cs=Cs,fs=xs)),Ds+=1}return{success:!1,x:us,fx:ds}}Newton(ts,rs,ns){var is,as=0,os=this.eps,ls=ts.apply(ns,[rs]);for(Array.isArray(rs)&&(rs=rs[0]);as<50&&Math.abs(ls)>os;)is=this.D(ts,ns)(rs),Math.abs(is)>os?rs-=ls/is:rs+=Math.random()*.2-1,ls=ts.apply(ns,[rs]),as+=1;return rs}D(ts,rs){return rs!=null?function(ns){var is=1e-5,as=is*2;return(ts(ns+is)-ts(ns-is))/as}:function(ns){var is=1e-5,as=is*2;return(ts.apply(rs,[ns+is])-ts.apply(rs,[ns-is]))/as}}}function _prng_restore(ss,ts,rs){let ns=rs&&rs.state;ns&&(typeof ns=="object"&&ts.copy(ns,ts),ss.state=()=>ts.copy(ts,{}))}function prng_alea(ss,ts){let rs=new AleaGen(ss),ns=()=>rs.next();return ns.double=()=>ns()+(ns()*2097152|0)*11102230246251565e-32,ns.int32=()=>rs.next()*4294967296|0,ns.quick=ns,_prng_restore(ns,rs,ts),ns}class AleaGen{constructor(ts){ts==null&&(ts=+new Date);let rs=4022871197;this.c=1,this.s0=ns(" "),this.s1=ns(" "),this.s2=ns(" "),this.s0-=ns(ts),this.s0<0&&(this.s0+=1),this.s1-=ns(ts),this.s1<0&&(this.s1+=1),this.s2-=ns(ts),this.s2<0&&(this.s2+=1);function ns(is){is=String(is);for(let as=0;as<is.length;as++){rs+=is.charCodeAt(as);let os=.02519603282416938*rs;rs=os>>>0,os-=rs,os*=rs,rs=os>>>0,os-=rs,rs+=os*4294967296}return(rs>>>0)*23283064365386963e-26}}next(){let{c:ts,s0:rs,s1:ns,s2:is}=this,as=2091639*rs+ts*23283064365386963e-26;return this.s0=ns,this.s1=is,this.s2=as-(this.c=as|0)}copy(ts,rs){return rs.c=ts.c,rs.s0=ts.s0,rs.s1=ts.s1,rs.s2=ts.s2,rs}}var global$2=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{};const get_tree=function(ss){if(ss!=null)return ss.tree!==void 0?ss.tree:ss};function*subsets(ss,ts){var rs=ss.length;if(ts===void 0&&(ts=rs),ts!==0){for(let ns=0;ns<rs;ns++)yield[ss[ns]];if(ts!==1)for(let ns=0;ns<rs;ns++){let is=subsets(ss.slice(ns+1),ts-1);for(let as of is)yield[ss[ns]].concat(as)}}}var is_associative$1={"+":!0,"*":!0,and:!0,or:!0,union:!0,intersect:!0};function flatten$5(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(ns=ns.map(function(os,ls){return flatten$5(os)}),is_associative$1[rs]){for(var is=[],as=0;as<ns.length;as++)Array.isArray(ns[as])&&ns[as][0]===rs&&ns[as].length>2?is=is.concat(ns[as].slice(1)):is.push(ns[as]);ns=is}return[rs].concat(ns)}const unflattenRight=function(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if((ns=ns.map(function(ls,us){return unflattenRight(ls)})).length>2&&is_associative$1[rs]){for(var is=[rs,ns[0],void 0],as=is,os=1;os<ns.length-1;os++)as[2]=[rs,ns[os],void 0],as=as[2];return as[2]=ns[ns.length-1],is}return[rs].concat(ns)},unflattenLeft=function(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if((ns=ns.map(function(ls,us){return unflattenLeft(ls)})).length>2&&is_associative$1[rs]){for(var is=[rs,void 0,ns[ns.length-1]],as=is,os=ns.length-2;os>0;os--)as[1]=[rs,void 0,ns[os]],as=as[1];return as[1]=ns[0],is}return[rs].concat(ns)},allChildren=function(ss){if(!Array.isArray(ss))return[];var ts=ss[0],rs=ss.slice(1);return is_associative$1[ts]?rs.reduce(function(ns,is){return Array.isArray(is)&&is[0]===ts?ns.concat(allChildren(is)):ns.concat([is])},[]):rs};function get_all_units(){return{"%":{scale:ss=>["/",ss,100],only_scales:!0},$:{prefix:!0,scale:ss=>ss},deg:{scale:ss=>["/",["*",ss,"pi"],180],only_scales:!0}}}let all_units$1=get_all_units();function get_unit_of_tree(ss){if(ss[0]==="unit"){for(let ts in all_units$1)if(all_units$1[ts].prefix){if(ss[1]===ts)return ts}else if(ss[2]===ts)return ts}return null}function get_unit_value_of_tree(ss){if(ss[0]==="unit"){for(let ts in all_units$1)if(all_units$1[ts].prefix){if(ss[1]===ts)return[ts,ss[2]]}else if(ss[2]===ts)return[ts,ss[1]]}return null}function remove_duplicate_negatives(ss){if(!Array.isArray(ss))return ss;var ts=ss[0],rs=ss.slice(1);return ts==="-"&&rs[0][0]==="-"?remove_duplicate_negatives(rs[0][1]):(rs=rs.map(remove_duplicate_negatives),[ts].concat(rs))}function normalize_negatives_in_factors(ss){if(!Array.isArray(ss))return ss;var ts=ss[0],rs=ss.slice(1);if(rs=rs.map(normalize_negatives_in_factors),ts!=="*"&&ts!=="/")return[ts].concat(rs);for(var ns=1,is=[],as=0;as<rs.length;as++)rs[as][0]==="-"?(ns*=-1,is.push(rs[as][1])):is.push(rs[as]);var os=[ts].concat(is);return ns===-1&&(os=["-",os]),os}function normalize_negatives(ss){var ts=get_tree(ss);return ts=remove_duplicate_negatives(ts),ts=remove_duplicate_negatives(ts=normalize_negatives_in_factors(ts))}function sort_key(ss,ts={}){if(typeof ss=="number")return ts.ignore_negatives?[0,"number",Math.abs(ss)]:[0,"number",ss];if(typeof ss=="string")return[1,"symbol",ss];if(typeof ss=="boolean")return[1,"boolean",ss];if(!Array.isArray(ss))return[-1,"unknown",ss];var rs=ss[0],ns=ss.slice(1);if(rs==="apply"){var is=[2,"function",ns[0]],as=ns[1],os=1,ls=[];return Array.isArray(as)?(os=(as=as.slice(1)).length,ls=as.map(ps=>sort_key(ps,ts))):ls=[sort_key(as,ts)],is.push([os,ls]),is}if(rs==="unit"){let[ps,ds]=get_unit_value_of_tree(ss);if(ps){let fs=sort_key(ds,ts);return fs[1]+="_"+ps,fs}}var us=ns.length,cs=ns.map(sort_key,ts);return rs==="*"?[4,"product",us,cs]:rs==="/"?[4,"quotient",us,cs]:rs==="+"?[5,"sum",us,cs]:rs==="-"?ts.ignore_negatives?cs[0]:[6,"minus",us,cs]:[7,rs,us,cs]}function arrayCompare(ss,ts){if(Array.isArray(ss)){if(Array.isArray(ts)){let rs=Math.min(ss.length,ts.length);for(let ns=0;ns<rs;ns++){let is=arrayCompare(ss[ns],ts[ns]);if(is!==0)return is}return ss.length<ts.length?-1:ss.length>ts.length?1:0}return 1}return Array.isArray(ts)||ss<ts?-1:ss>ts?1:0}function compare_function(ss,ts,rs={}){return arrayCompare(sort_key(ss,rs),sort_key(ts,rs))}function coeff_factors_from_term(ss,ts){if(typeof ss=="string"){let rs=ts.indexOf(ss);rs===-1&&(ts.push(ss),rs=ts.length-1);let ns=[];return ns[rs]=1,{factor_contains:ns,coeff:1}}if(Array.isArray(ss)){let rs=ss[0],ns=ss.slice(1);if(rs==="*"){let is=[],as=[];for(let os of ns)if(typeof os!="string")if(Array.isArray(os)&&os[0]==="^"||os[0]==="-"){let ls=coeff_factors_from_term(os,ts);for(let us in ls.factor_contains)as[us]===void 0&&(as[us]=0),as[us]+=ls.factor_contains[us];ls.coeff!==1&&is.push(ls.coeff)}else is.push(os);else{let ls=ts.indexOf(os);ls===-1&&(ts.push(os),ls=ts.length-1),as[ls]===void 0&&(as[ls]=0),as[ls]++}return is=is.length===0?1:is.length===1?is[0]:["*",...is],{factor_contains:as,coeff:is}}if(rs==="^"){let is=ns[0],as=ns[1],os=[];if(typeof is=="string"&&Number.isFinite(as)){let ls=ts.indexOf(is);return ls===-1&&(ts.push(is),ls=ts.length-1),os[ls]=as,{factor_contains:os,coeff:1}}}else{if(rs==="-"){let is=coeff_factors_from_term(ns[0],ts),as=-1;return typeof is.coeff=="number"?as*=is.coeff:as=["-",is.coeff],{factor_contains:is.factor_contains,coeff:as}}if(rs==="/"){let is=coeff_factors_from_term(ns[0],ts),as=["/",is.coeff,ns[1]];return{factor_contains:is.factor_contains,coeff:as}}}}return{factor_contains:[],coeff:ss}}function default_order(ss,ts){ts===void 0&&(ts={});var rs=get_tree(ss);return rs=normalize_negatives(rs=flatten$5(rs)),normalize_negatives(function ns(is){if(!Array.isArray(is))return is;var as=is[0],os=is.slice(1);if(os=os.map(ns),as==="+"){let cs=[],ps=[],ds=[];for(let gs of os){let bs=coeff_factors_from_term(gs,cs);ps.push(bs.factor_contains),ds.push(bs.coeff)}let fs=[];for(let[gs,bs]of cs.entries()){let vs={varname:bs,exponents_in_term:[]};for(let Ns=0;Ns<ps.length;Ns++)vs.exponents_in_term.push(ps[Ns][gs]||0);fs.push(vs)}fs.sort((gs,bs)=>gs.varname<bs.varname?-1:1);let hs=[];for(let gs=0;gs<ds.length;gs++){let bs=fs.reduce((vs,Ns)=>[...vs,-Ns.exponents_in_term[gs]],[]);bs.push(sort_key(ds[gs],ts)),hs.push(bs)}let ys=[];for(let[gs,bs]of os.entries())ys.push({term:bs,sort_key:hs[gs]});ys.sort((gs,bs)=>arrayCompare(gs.sort_key,bs.sort_key)),os=ys.map(gs=>gs.term)}else if(as==="*"){let cs=[],ps=[];for(let ds of os)["tuple","list","vector","altvector","interval","set","array","matrix"].includes(ds[0])?ps.push(ds):cs.push(ds);cs.sort((ds,fs)=>compare_function(ds,fs,ts)),os=[...cs,...ps]}else if(as==="="||as==="and"||as==="or"||as==="ne"||as==="union"||as==="intersect")os.sort((cs,ps)=>compare_function(cs,ps,ts));else if(as===">"||as==="ge")os=os.reverse(),as=as===">"?"<":"le";else if(as==="gts"){var ls=os[0],us=os[1];if(ls[0]!=="tuple"||us[0]!=="tuple")throw new Error("Badly formed ast");as="lts",os=[ls=["tuple"].concat(ls.slice(1).reverse()),us=["tuple"].concat(us.slice(1).reverse())]}else if(as==="ni"||as==="notni"||as==="superset"||as==="notsuperset"||as==="superseteq"||as==="notsuperseteq")os=os.reverse(),as==="ni"?as="in":as==="notni"?as="notin":as==="superset"?as="subset":as==="notsuperset"?as="notsubset":as==="superseteq"?as="subseteq":as==="notsuperseteq"&&(as="notsubseteq");else if(as==="-"&&os[0][0]==="*")return os[0][1]=["-",os[0][1]],os[0];return[as].concat(os)}(rs))}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(ss){for(var ts=1;ts<arguments.length;ts++){var rs=arguments[ts];for(var ns in rs)Object.prototype.hasOwnProperty.call(rs,ns)&&(ss[ns]=rs[ns])}return ss},_extends$1.apply(this,arguments)}var DEFAULT_CONFIG={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function isNumber$1(ss){return typeof ss=="number"}function isBigNumber(ss){return!(!ss||typeof ss!="object"||typeof ss.constructor!="function")&&(ss.isBigNumber===!0&&typeof ss.constructor.prototype=="object"&&ss.constructor.prototype.isBigNumber===!0||typeof ss.constructor.isDecimal=="function"&&ss.constructor.isDecimal(ss)===!0)}function isComplex(ss){return ss&&typeof ss=="object"&&Object.getPrototypeOf(ss).isComplex===!0||!1}function isFraction(ss){return ss&&typeof ss=="object"&&Object.getPrototypeOf(ss).isFraction===!0||!1}function isUnit(ss){return ss&&ss.constructor.prototype.isUnit===!0||!1}function isString$1$1(ss){return typeof ss=="string"}var isArray$1$1=Array.isArray;function isMatrix(ss){return ss&&ss.constructor.prototype.isMatrix===!0||!1}function isCollection(ss){return Array.isArray(ss)||isMatrix(ss)}function isDenseMatrix(ss){return ss&&ss.isDenseMatrix&&ss.constructor.prototype.isMatrix===!0||!1}function isSparseMatrix(ss){return ss&&ss.isSparseMatrix&&ss.constructor.prototype.isMatrix===!0||!1}function isRange(ss){return ss&&ss.constructor.prototype.isRange===!0||!1}function isIndex(ss){return ss&&ss.constructor.prototype.isIndex===!0||!1}function isBoolean$1$1(ss){return typeof ss=="boolean"}function isResultSet(ss){return ss&&ss.constructor.prototype.isResultSet===!0||!1}function isHelp(ss){return ss&&ss.constructor.prototype.isHelp===!0||!1}function isFunction$2$1(ss){return typeof ss=="function"}function isDate$1(ss){return ss instanceof Date}function isRegExp$1(ss){return ss instanceof RegExp}function isObject$1$1(ss){return!(!ss||typeof ss!="object"||ss.constructor!==Object||isComplex(ss)||isFraction(ss))}function isNull$1(ss){return ss===null}function isUndefined$1$1(ss){return ss===void 0}function isAccessorNode(ss){return ss&&ss.isAccessorNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isArrayNode(ss){return ss&&ss.isArrayNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isAssignmentNode(ss){return ss&&ss.isAssignmentNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isBlockNode(ss){return ss&&ss.isBlockNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isConditionalNode(ss){return ss&&ss.isConditionalNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isConstantNode(ss){return ss&&ss.isConstantNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isFunctionAssignmentNode(ss){return ss&&ss.isFunctionAssignmentNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isFunctionNode(ss){return ss&&ss.isFunctionNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isIndexNode(ss){return ss&&ss.isIndexNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isNode$1(ss){return ss&&ss.isNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isObjectNode(ss){return ss&&ss.isObjectNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isOperatorNode(ss){return ss&&ss.isOperatorNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isParenthesisNode(ss){return ss&&ss.isParenthesisNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isRangeNode(ss){return ss&&ss.isRangeNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isSymbolNode(ss){return ss&&ss.isSymbolNode===!0&&ss.constructor.prototype.isNode===!0||!1}function isChain(ss){return ss&&ss.constructor.prototype.isChain===!0||!1}function typeOf$1(ss){var ts=typeof ss;return ts==="object"?ss===null?"null":Array.isArray(ss)?"Array":ss instanceof Date?"Date":ss instanceof RegExp?"RegExp":isBigNumber(ss)?"BigNumber":isComplex(ss)?"Complex":isFraction(ss)?"Fraction":isMatrix(ss)?"Matrix":isUnit(ss)?"Unit":isIndex(ss)?"Index":isRange(ss)?"Range":isResultSet(ss)?"ResultSet":isNode$1(ss)?ss.type:isChain(ss)?"Chain":isHelp(ss)?"Help":"Object":ts==="function"?"Function":ts}function clone$3(ss){var ts=typeof ss;if(ts==="number"||ts==="string"||ts==="boolean"||ss==null)return ss;if(typeof ss.clone=="function")return ss.clone();if(Array.isArray(ss))return ss.map(function(rs){return clone$3(rs)});if(ss instanceof Date)return new Date(ss.valueOf());if(isBigNumber(ss))return ss;if(ss instanceof RegExp)throw new TypeError("Cannot clone "+ss);return mapObject$1(ss,clone$3)}function mapObject$1(ss,ts){var rs={};for(var ns in ss)hasOwnProperty$2(ss,ns)&&(rs[ns]=ts(ss[ns]));return rs}function extend$2(ss,ts){for(var rs in ts)hasOwnProperty$2(ts,rs)&&(ss[rs]=ts[rs]);return ss}function deepExtend(ss,ts){if(Array.isArray(ts))throw new TypeError("Arrays are not supported by deepExtend");for(var rs in ts)if(hasOwnProperty$2(ts,rs)&&!(rs in Object.prototype)&&!(rs in Function.prototype))if(ts[rs]&&ts[rs].constructor===Object)ss[rs]===void 0&&(ss[rs]={}),ss[rs]&&ss[rs].constructor===Object?deepExtend(ss[rs],ts[rs]):ss[rs]=ts[rs];else{if(Array.isArray(ts[rs]))throw new TypeError("Arrays are not supported by deepExtend");ss[rs]=ts[rs]}return ss}function deepStrictEqual(ss,ts){var rs,ns,is;if(Array.isArray(ss)){if(!Array.isArray(ts)||ss.length!==ts.length)return!1;for(ns=0,is=ss.length;ns<is;ns++)if(!deepStrictEqual(ss[ns],ts[ns]))return!1;return!0}if(typeof ss=="function")return ss===ts;if(ss instanceof Object){if(Array.isArray(ts)||!(ts instanceof Object))return!1;for(rs in ss)if(!(rs in ts)||!deepStrictEqual(ss[rs],ts[rs]))return!1;for(rs in ts)if(!(rs in ss))return!1;return!0}return ss===ts}function deepFlatten(ss){var ts={};return _deepFlatten(ss,ts),ts}function _deepFlatten(ss,ts){for(var rs in ss)if(hasOwnProperty$2(ss,rs)){var ns=ss[rs];typeof ns=="object"&&ns!==null?_deepFlatten(ns,ts):ts[rs]=ns}}function lazy(ss,ts,rs){var ns,is=!0;Object.defineProperty(ss,ts,{get:function(){return is&&(ns=rs(),is=!1),ns},set:function(as){ns=as,is=!1},configurable:!0,enumerable:!0})}function hasOwnProperty$2(ss,ts){return ss&&Object.hasOwnProperty.call(ss,ts)}function isLegacyFactory(ss){return ss&&typeof ss.factory=="function"}function pickShallow(ss,ts){for(var rs={},ns=0;ns<ts.length;ns++){var is=ts[ns],as=ss[is];as!==void 0&&(rs[is]=as)}return rs}function values$1(ss){return Object.keys(ss).map(ts=>ss[ts])}var MATRIX_OPTIONS=["Matrix","Array"],NUMBER_OPTIONS=["number","BigNumber","Fraction"];function configFactory(ss,ts){function rs(ns){if(ns){var is=mapObject$1(ss,clone$3);validateOption(ns,"matrix",MATRIX_OPTIONS),validateOption(ns,"number",NUMBER_OPTIONS),deepExtend(ss,ns);var as=mapObject$1(ss,clone$3),os=mapObject$1(ns,clone$3);return ts("config",as,is,os),as}return mapObject$1(ss,clone$3)}return rs.MATRIX_OPTIONS=MATRIX_OPTIONS,rs.NUMBER_OPTIONS=NUMBER_OPTIONS,Object.keys(DEFAULT_CONFIG).forEach(ns=>{Object.defineProperty(rs,ns,{get:()=>ss[ns],enumerable:!0,configurable:!0})}),rs}function contains$2(ss,ts){return ss.indexOf(ts)!==-1}function validateOption(ss,ts,rs){ss[ts]===void 0||contains$2(rs,ss[ts])||console.warn('Warning: Unknown value "'+ss[ts]+'" for configuration option "'+ts+'". Available options: '+rs.map(ns=>JSON.stringify(ns)).join(", ")+".")}var config$2=function(ss){if(ss)throw new Error(`The global config is readonly. 
Please create a mathjs instance if you want to change the default configuration. 
Example:

  import { create, all } from 'mathjs';
  const mathjs = create(all);
  mathjs.config({ number: 'BigNumber' });
`);return Object.freeze(DEFAULT_CONFIG)};_extends$1(config$2,DEFAULT_CONFIG,{MATRIX_OPTIONS,NUMBER_OPTIONS});var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global$2<"u"?global$2:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(ss){return ss&&ss.__esModule&&Object.prototype.hasOwnProperty.call(ss,"default")?ss.default:ss}function getAugmentedNamespace(ss){var ts=ss.default;if(typeof ts=="function"){var rs=function(){return ts.apply(this,arguments)};rs.prototype=ts.prototype}else rs={};return Object.defineProperty(rs,"__esModule",{value:!0}),Object.keys(ss).forEach(function(ns){var is=Object.getOwnPropertyDescriptor(ss,ns);Object.defineProperty(rs,ns,is.get?is:{enumerable:!0,get:function(){return ss[ns]}})}),rs}var typedFunction$1={exports:{}};typedFunction$1.exports=function(){function ss(){return!0}function ts(){return!1}function rs(){}function ns(){var is=[{name:"number",test:function(qs){return typeof qs=="number"}},{name:"string",test:function(qs){return typeof qs=="string"}},{name:"boolean",test:function(qs){return typeof qs=="boolean"}},{name:"Function",test:function(qs){return typeof qs=="function"}},{name:"Array",test:Array.isArray},{name:"Date",test:function(qs){return qs instanceof Date}},{name:"RegExp",test:function(qs){return qs instanceof RegExp}},{name:"Object",test:function(qs){return typeof qs=="object"&&qs!==null&&qs.constructor===Object}},{name:"null",test:function(qs){return qs===null}},{name:"undefined",test:function(qs){return qs===void 0}}],as={name:"any",test:ss},os=[],ls=[],us={types:is,conversions:ls,ignore:os};function cs(qs){var Gs=Ls(us.types,function(Ks){return Ks.name===qs});if(Gs)return Gs;if(qs==="any")return as;var Xs=Ls(us.types,function(Ks){return Ks.name.toLowerCase()===qs.toLowerCase()});throw new TypeError('Unknown type "'+qs+'"'+(Xs?'. Did you mean "'+Xs.name+'"?':""))}function ps(qs){return qs===as?999:us.types.indexOf(qs)}function ds(qs){var Gs=Ls(us.types,function(Xs){return Xs.test(qs)});if(Gs)return Gs.name;throw new TypeError("Value has unknown type. Value: "+qs)}function fs(qs,Gs){if(!qs.signatures)throw new TypeError("Function is no typed-function");var Xs;if(typeof Gs=="string"){Xs=Gs.split(",");for(var Ks=0;Ks<Xs.length;Ks++)Xs[Ks]=Xs[Ks].trim()}else{if(!Array.isArray(Gs))throw new TypeError("String array or a comma separated string expected");Xs=Gs}var ol=Xs.join(","),Fs=qs.signatures[ol];if(Fs)return Fs;throw new TypeError("Signature not found (signature: "+(qs.name||"unnamed")+"("+Xs.join(", ")+"))")}function hs(qs,Gs){var Xs=ds(qs);if(Gs===Xs)return qs;for(var Ks=0;Ks<us.conversions.length;Ks++){var ol=us.conversions[Ks];if(ol.from===Xs&&ol.to===Gs)return ol.convert(qs)}throw new Error("Cannot convert from "+Xs+" to "+Gs)}function ys(qs){return qs.map(function(Gs){var Xs=Gs.types.map(ws);return(Gs.restParam?"...":"")+Xs.join("|")}).join(",")}function gs(qs,Gs){var Xs=qs.indexOf("...")===0,Ks=(Xs?qs.length>3?qs.slice(3):"any":qs).split("|").map(Ys).filter(il).filter(el),ol=$s(Gs,Ks),Fs=Ks.map(function(Js){var ul=cs(Js);return{name:Js,typeIndex:ps(ul),test:ul.test,conversion:null,conversionIndex:-1}}),Qs=ol.map(function(Js){var ul=cs(Js.from);return{name:Js.from,typeIndex:ps(ul),test:ul.test,conversion:Js,conversionIndex:Gs.indexOf(Js)}});return{types:Fs.concat(Qs),restParam:Xs}}function bs(qs,Gs,Xs){var Ks=[];return qs.trim()!==""&&(Ks=qs.split(",").map(Ys).map(function(ol,Fs,Qs){var Js=gs(ol,Xs);if(Js.restParam&&Fs!==Qs.length-1)throw new SyntaxError('Unexpected rest parameter "'+ol+'": only allowed for the last parameter');return Js})),Ks.some(ll)?null:{params:Ks,fn:Gs}}function vs(qs){var Gs=cl(qs);return!!Gs&&Gs.restParam}function Ns(qs){return qs.types.some(function(Gs){return Gs.conversion!=null})}function Ts(qs){if(qs&&qs.types.length!==0){if(qs.types.length===1)return cs(qs.types[0].name).test;if(qs.types.length===2){var Gs=cs(qs.types[0].name).test,Xs=cs(qs.types[1].name).test;return function(ol){return Gs(ol)||Xs(ol)}}var Ks=qs.types.map(function(ol){return cs(ol.name).test});return function(ol){for(var Fs=0;Fs<Ks.length;Fs++)if(Ks[Fs](ol))return!0;return!1}}return ss}function Cs(qs){var Gs,Xs,Ks;if(vs(qs)){var ol=(Gs=nl(qs).map(Ts)).length,Fs=Ts(cl(qs)),Qs=function(Js){for(var ul=ol;ul<Js.length;ul++)if(!Fs(Js[ul]))return!1;return!0};return function(Js){for(var ul=0;ul<Gs.length;ul++)if(!Gs[ul](Js[ul]))return!1;return Qs(Js)&&Js.length>=ol+1}}return qs.length===0?function(Js){return Js.length===0}:qs.length===1?(Xs=Ts(qs[0]),function(Js){return Xs(Js[0])&&Js.length===1}):qs.length===2?(Xs=Ts(qs[0]),Ks=Ts(qs[1]),function(Js){return Xs(Js[0])&&Ks(Js[1])&&Js.length===2}):(Gs=qs.map(Ts),function(Js){for(var ul=0;ul<Gs.length;ul++)if(!Gs[ul](Js[ul]))return!1;return Js.length===Gs.length})}function xs(qs,Gs){return Gs<qs.params.length?qs.params[Gs]:vs(qs.params)?cl(qs.params):null}function As(qs,Gs,Xs){var Ks=xs(qs,Gs);return(Ks?Xs?Ks.types.filter(Es):Ks.types:[]).map(ws)}function ws(qs){return qs.name}function Es(qs){return qs.conversion===null||qs.conversion===void 0}function Ss(qs,Gs){var Xs=Ws(Zs(qs,function(Ks){return As(Ks,Gs,!1)}));return Xs.indexOf("any")!==-1?["any"]:Xs}function Ds(qs,Gs,Xs){var Ks,ol,Fs,Qs=qs||"unnamed",Js=Xs;for(Fs=0;Fs<Gs.length;Fs++){var ul=Js.filter(function(hl){var yl=Ts(xs(hl,Fs));return(Fs<hl.params.length||vs(hl.params))&&yl(Gs[Fs])});if(ul.length===0){if((ol=Ss(Js,Fs)).length>0){var pl=ds(Gs[Fs]);return(Ks=new TypeError("Unexpected type of argument in function "+Qs+" (expected: "+ol.join(" or ")+", actual: "+pl+", index: "+Fs+")")).data={category:"wrongType",fn:Qs,index:Fs,actual:pl,expected:ol},Ks}}else Js=ul}var ml=Js.map(function(hl){return vs(hl.params)?1/0:hl.params.length});if(Gs.length<Math.min.apply(null,ml))return ol=Ss(Js,Fs),(Ks=new TypeError("Too few arguments in function "+Qs+" (expected: "+ol.join(" or ")+", index: "+Gs.length+")")).data={category:"tooFewArgs",fn:Qs,index:Gs.length,expected:ol},Ks;var fl=Math.max.apply(null,ml);return Gs.length>fl?((Ks=new TypeError("Too many arguments in function "+Qs+" (expected: "+fl+", actual: "+Gs.length+")")).data={category:"tooManyArgs",fn:Qs,index:Gs.length,expectedLength:fl},Ks):((Ks=new TypeError('Arguments of type "'+Gs.join(", ")+'" do not match any of the defined signatures of function '+Qs+".")).data={category:"mismatch",actual:Gs.map(ds)},Ks)}function Vs(qs){for(var Gs=999,Xs=0;Xs<qs.types.length;Xs++)Es(qs.types[Xs])&&(Gs=Math.min(Gs,qs.types[Xs].typeIndex));return Gs}function Is(qs){for(var Gs=999,Xs=0;Xs<qs.types.length;Xs++)Es(qs.types[Xs])||(Gs=Math.min(Gs,qs.types[Xs].conversionIndex));return Gs}function Os(qs,Gs){var Xs;return(Xs=qs.restParam-Gs.restParam)!=0||(Xs=Ns(qs)-Ns(Gs))!=0||(Xs=Vs(qs)-Vs(Gs))!=0?Xs:Is(qs)-Is(Gs)}function Ps(qs,Gs){var Xs,Ks,ol=Math.min(qs.params.length,Gs.params.length);if((Ks=qs.params.some(Ns)-Gs.params.some(Ns))!=0)return Ks;for(Xs=0;Xs<ol;Xs++)if((Ks=Ns(qs.params[Xs])-Ns(Gs.params[Xs]))!=0)return Ks;for(Xs=0;Xs<ol;Xs++)if((Ks=Os(qs.params[Xs],Gs.params[Xs]))!==0)return Ks;return qs.params.length-Gs.params.length}function $s(qs,Gs){var Xs={};return qs.forEach(function(Ks){Gs.indexOf(Ks.from)!==-1||Gs.indexOf(Ks.to)===-1||Xs[Ks.from]||(Xs[Ks.from]=Ks)}),Object.keys(Xs).map(function(Ks){return Xs[Ks]})}function Rs(qs,Gs){var Xs=Gs;if(qs.some(Ns)){var Ks=vs(qs),ol=qs.map(ks);Xs=function(){for(var Js=[],ul=Ks?arguments.length-1:arguments.length,pl=0;pl<ul;pl++)Js[pl]=ol[pl](arguments[pl]);return Ks&&(Js[ul]=arguments[ul].map(ol[ul])),Gs.apply(this,Js)}}var Fs=Xs;if(vs(qs)){var Qs=qs.length-1;Fs=function(){return Xs.apply(this,dl(arguments,0,Qs).concat([dl(arguments,Qs)]))}}return Fs}function ks(qs){var Gs,Xs,Ks,ol,Fs=[],Qs=[];switch(qs.types.forEach(function(Js){Js.conversion&&(Fs.push(cs(Js.conversion.from).test),Qs.push(Js.conversion.convert))}),Qs.length){case 0:return function(Js){return Js};case 1:return Gs=Fs[0],Ks=Qs[0],function(Js){return Gs(Js)?Ks(Js):Js};case 2:return Gs=Fs[0],Xs=Fs[1],Ks=Qs[0],ol=Qs[1],function(Js){return Gs(Js)?Ks(Js):Xs(Js)?ol(Js):Js};default:return function(Js){for(var ul=0;ul<Qs.length;ul++)if(Fs[ul](Js))return Qs[ul](Js);return Js}}}function _s(qs){var Gs={};return qs.forEach(function(Xs){Xs.params.some(Ns)||Bs(Xs.params,!0).forEach(function(Ks){Gs[ys(Ks)]=Xs.fn})}),Gs}function Bs(qs,Gs){function Xs(Ks,ol,Fs){if(ol<Ks.length){var Qs,Js=Ks[ol],ul=Gs?Js.types.filter(Es):Js.types;if(Js.restParam){var pl=ul.filter(Es);Qs=pl.length<ul.length?[pl,ul]:[ul]}else Qs=ul.map(function(ml){return[ml]});return Zs(Qs,function(ml){return Xs(Ks,ol+1,Fs.concat([ml]))})}return[Fs.map(function(ml,fl){return{types:ml,restParam:fl===Ks.length-1&&vs(Ks)}})]}return Xs(qs,0,[])}function Us(qs,Gs){for(var Xs=Math.max(qs.params.length,Gs.params.length),Ks=0;Ks<Xs;Ks++)if(!js(As(qs,Ks,!0),As(Gs,Ks,!0)))return!1;var ol=qs.params.length,Fs=Gs.params.length,Qs=vs(qs.params),Js=vs(Gs.params);return Qs?Js?ol===Fs:Fs>=ol:Js?ol>=Fs:ol===Fs}function zs(qs,Gs){if(Object.keys(Gs).length===0)throw new SyntaxError("No signatures provided");var Xs=[];Object.keys(Gs).map(function(Cl){return bs(Cl,Gs[Cl],us.conversions)}).filter(al).forEach(function(Cl){var wl=Ls(Xs,function(Dl){return Us(Dl,Cl)});if(wl)throw new TypeError('Conflicting signatures "'+ys(wl.params)+'" and "'+ys(Cl.params)+'".');Xs.push(Cl)});var Ks=Zs(Xs,function(Cl){return(Cl?Bs(Cl.params,!1):[]).map(function(wl){return{params:wl,fn:Cl.fn}})}).filter(al);Ks.sort(Ps);var ol=Ks[0]&&Ks[0].params.length<=2&&!vs(Ks[0].params),Fs=Ks[1]&&Ks[1].params.length<=2&&!vs(Ks[1].params),Qs=Ks[2]&&Ks[2].params.length<=2&&!vs(Ks[2].params),Js=Ks[3]&&Ks[3].params.length<=2&&!vs(Ks[3].params),ul=Ks[4]&&Ks[4].params.length<=2&&!vs(Ks[4].params),pl=Ks[5]&&Ks[5].params.length<=2&&!vs(Ks[5].params),ml=ol&&Fs&&Qs&&Js&&ul&&pl,fl=Ks.map(function(Cl){return Cs(Cl.params)}),hl=ol?Ts(Ks[0].params[0]):ts,yl=Fs?Ts(Ks[1].params[0]):ts,bl=Qs?Ts(Ks[2].params[0]):ts,Tl=Js?Ts(Ks[3].params[0]):ts,Nl=ul?Ts(Ks[4].params[0]):ts,gl=pl?Ts(Ks[5].params[0]):ts,vl=ol?Ts(Ks[0].params[1]):ts,Ml=Fs?Ts(Ks[1].params[1]):ts,Sl=Qs?Ts(Ks[2].params[1]):ts,jl=Js?Ts(Ks[3].params[1]):ts,du=ul?Ts(Ks[4].params[1]):ts,Pl=pl?Ts(Ks[5].params[1]):ts,El=Ks.map(function(Cl){return Rs(Cl.params,Cl.fn)}),ql=ol?El[0]:rs,nu=Fs?El[1]:rs,Gl=Qs?El[2]:rs,iu=Js?El[3]:rs,Al=ul?El[4]:rs,Wl=pl?El[5]:rs,Fl=ol?Ks[0].params.length:-1,Hl=Fs?Ks[1].params.length:-1,Jl=Qs?Ks[2].params.length:-1,au=Js?Ks[3].params.length:-1,Kl=ul?Ks[4].params.length:-1,xl=pl?Ks[5].params.length:-1,Zl=ml?6:0,su=Ks.length,ou=function(){for(var Cl=Zl;Cl<su;Cl++)if(fl[Cl](arguments))return El[Cl].apply(this,arguments);return us.onMismatch(qs,arguments,Ks)},$l=function Cl(wl,Dl){return arguments.length===Fl&&hl(wl)&&vl(Dl)?ql.apply(Cl,arguments):arguments.length===Hl&&yl(wl)&&Ml(Dl)?nu.apply(Cl,arguments):arguments.length===Jl&&bl(wl)&&Sl(Dl)?Gl.apply(Cl,arguments):arguments.length===au&&Tl(wl)&&jl(Dl)?iu.apply(Cl,arguments):arguments.length===Kl&&Nl(wl)&&du(Dl)?Al.apply(Cl,arguments):arguments.length===xl&&gl(wl)&&Pl(Dl)?Wl.apply(Cl,arguments):ou.apply(Cl,arguments)};try{Object.defineProperty($l,"name",{value:qs})}catch{}return $l.signatures=_s(Ks),$l}function Hs(qs,Gs,Xs){throw Ds(qs,Gs,Xs)}function el(qs){return us.ignore.indexOf(qs)===-1}function Ys(qs){return qs.trim()}function il(qs){return!!qs}function al(qs){return qs!==null}function ll(qs){return qs.types.length===0}function nl(qs){return qs.slice(0,qs.length-1)}function cl(qs){return qs[qs.length-1]}function dl(qs,Gs,Xs){return Array.prototype.slice.call(qs,Gs,Xs)}function sl(qs,Gs){return qs.indexOf(Gs)!==-1}function js(qs,Gs){for(var Xs=0;Xs<qs.length;Xs++)if(sl(Gs,qs[Xs]))return!0;return!1}function Ls(qs,Gs){for(var Xs=0;Xs<qs.length;Xs++)if(Gs(qs[Xs]))return qs[Xs]}function Ws(qs){for(var Gs={},Xs=0;Xs<qs.length;Xs++)Gs[qs[Xs]]=!0;return Object.keys(Gs)}function Zs(qs,Gs){return Array.prototype.concat.apply([],qs.map(Gs))}function tl(qs){for(var Gs="",Xs=0;Xs<qs.length;Xs++){var Ks=qs[Xs];if((typeof Ks.signatures=="object"||typeof Ks.signature=="string")&&Ks.name!==""){if(Gs==="")Gs=Ks.name;else if(Gs!==Ks.name){var ol=new Error("Function names do not match (expected: "+Gs+", actual: "+Ks.name+")");throw ol.data={actual:Ks.name,expected:Gs},ol}}}return Gs}function rl(qs){var Gs,Xs={};function Ks(Js,ul){if(Xs.hasOwnProperty(Js)&&ul!==Xs[Js])throw(Gs=new Error('Signature "'+Js+'" is defined twice')).data={signature:Js},Gs}for(var ol=0;ol<qs.length;ol++){var Fs=qs[ol];if(typeof Fs.signatures=="object")for(var Qs in Fs.signatures)Fs.signatures.hasOwnProperty(Qs)&&(Ks(Qs,Fs.signatures[Qs]),Xs[Qs]=Fs.signatures[Qs]);else{if(typeof Fs.signature!="string")throw(Gs=new TypeError("Function is no typed-function (index: "+ol+")")).data={index:ol},Gs;Ks(Fs.signature,Fs),Xs[Fs.signature]=Fs}}return Xs}return us=zs("typed",{"string, Object":zs,Object:function(qs){var Gs=[];for(var Xs in qs)qs.hasOwnProperty(Xs)&&Gs.push(qs[Xs]);return zs(tl(Gs),qs)},"...Function":function(qs){return zs(tl(qs),rl(qs))},"string, ...Function":function(qs,Gs){return zs(qs,rl(Gs))}}),us.create=ns,us.types=is,us.conversions=ls,us.ignore=os,us.onMismatch=Hs,us.throwMismatchError=Hs,us.createError=Ds,us.convert=hs,us.find=fs,us.addType=function(qs,Gs){if(!qs||typeof qs.name!="string"||typeof qs.test!="function")throw new TypeError("Object with properties {name: string, test: function} expected");if(Gs!==!1){for(var Xs=0;Xs<us.types.length;Xs++)if(us.types[Xs].name==="Object")return void us.types.splice(Xs,0,qs)}us.types.push(qs)},us.addConversion=function(qs){if(!qs||typeof qs.from!="string"||typeof qs.to!="string"||typeof qs.convert!="function")throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");us.conversions.push(qs)},us}return ns()}();var typedFunction=typedFunction$1.exports;function isInteger$1(ss){return typeof ss=="boolean"||!!isFinite(ss)&&ss===Math.round(ss)}var sign$3=Math.sign||function(ss){return ss>0?1:ss<0?-1:0},log2$2=Math.log2||function(ss){return Math.log(ss)/Math.LN2},log10$3=Math.log10||function(ss){return Math.log(ss)/Math.LN10},log1p$1=Math.log1p||function(ss){return Math.log(ss+1)},cbrt$2=Math.cbrt||function(ss){if(ss===0)return ss;var ts,rs=ss<0;return rs&&(ss=-ss),ts=isFinite(ss)?(ss/((ts=Math.exp(Math.log(ss)/3))*ts)+2*ts)/3:ss,rs?-ts:ts},expm1$1=Math.expm1||function(ss){return ss>=2e-4||ss<=-2e-4?Math.exp(ss)-1:ss+ss*ss/2+ss*ss*ss/6};function formatNumberToBase(ss,ts,rs){var ns={2:"0b",8:"0o",16:"0x"}[ts],is="";if(rs){if(rs<1)throw new Error("size must be in greater than 0");if(!isInteger$1(rs))throw new Error("size must be an integer");if(ss>2**(rs-1)-1||ss<-(2**(rs-1)))throw new Error("Value must be in range [-2^".concat(rs-1,", 2^").concat(rs-1,"-1]"));if(!isInteger$1(ss))throw new Error("Value must be an integer");ss<0&&(ss+=2**rs),is="i".concat(rs)}var as="";return ss<0&&(ss=-ss,as="-"),"".concat(as).concat(ns).concat(ss.toString(ts)).concat(is)}function format$3(ss,ts){if(typeof ts=="function")return ts(ss);if(ss===1/0)return"Infinity";if(ss===-1/0)return"-Infinity";if(isNaN(ss))return"NaN";var rs,ns,is="auto";if(ts&&(ts.notation&&(is=ts.notation),isNumber$1(ts)?rs=ts:isNumber$1(ts.precision)&&(rs=ts.precision),ts.wordSize&&typeof(ns=ts.wordSize)!="number"))throw new Error('Option "wordSize" must be a number');switch(is){case"fixed":return toFixed$2(ss,rs);case"exponential":return toExponential$1(ss,rs);case"engineering":return toEngineering$1(ss,rs);case"bin":return formatNumberToBase(ss,2,ns);case"oct":return formatNumberToBase(ss,8,ns);case"hex":return formatNumberToBase(ss,16,ns);case"auto":return toPrecision(ss,rs,ts&&ts).replace(/((\.\d*?)(0+))($|e)/,function(){var as=arguments[2],os=arguments[4];return as!=="."?as+os:os});default:throw new Error('Unknown notation "'+is+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function splitNumber(ss){var ts=String(ss).toLowerCase().match(/^(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!ts)throw new SyntaxError("Invalid number "+ss);var rs=ts[1],ns=ts[2],is=parseFloat(ts[4]||"0"),as=ns.indexOf(".");is+=as!==-1?as-1:ns.length-1;var os=ns.replace(".","").replace(/^0*/,function(ls){return is-=ls.length,""}).replace(/0*$/,"").split("").map(function(ls){return parseInt(ls)});return os.length===0&&(os.push(0),is++),{sign:rs,coefficients:os,exponent:is}}function toEngineering$1(ss,ts){if(isNaN(ss)||!isFinite(ss))return String(ss);var rs=roundDigits(splitNumber(ss),ts),ns=rs.exponent,is=rs.coefficients,as=ns%3==0?ns:ns<0?ns-3-ns%3:ns-ns%3;if(isNumber$1(ts))for(;ts>is.length||ns-as+1>is.length;)is.push(0);else for(var os=Math.abs(ns-as)-(is.length-1),ls=0;ls<os;ls++)is.push(0);for(var us=Math.abs(ns-as),cs=1;us>0;)cs++,us--;var ps=is.slice(cs).join(""),ds=isNumber$1(ts)&&ps.length||ps.match(/[1-9]/)?"."+ps:"",fs=is.slice(0,cs).join("")+ds+"e"+(ns>=0?"+":"")+as.toString();return rs.sign+fs}function toFixed$2(ss,ts){if(isNaN(ss)||!isFinite(ss))return String(ss);var rs=splitNumber(ss),ns=typeof ts=="number"?roundDigits(rs,rs.exponent+1+ts):rs,is=ns.coefficients,as=ns.exponent+1,os=as+(ts||0);return is.length<os&&(is=is.concat(zeros$1(os-is.length))),as<0&&(is=zeros$1(1-as).concat(is),as=1),as<is.length&&is.splice(as,0,as===0?"0.":"."),ns.sign+is.join("")}function toExponential$1(ss,ts){if(isNaN(ss)||!isFinite(ss))return String(ss);var rs=splitNumber(ss),ns=ts?roundDigits(rs,ts):rs,is=ns.coefficients,as=ns.exponent;is.length<ts&&(is=is.concat(zeros$1(ts-is.length)));var os=is.shift();return ns.sign+os+(is.length>0?"."+is.join(""):"")+"e"+(as>=0?"+":"")+as}function toPrecision(ss,ts,rs){if(isNaN(ss)||!isFinite(ss))return String(ss);var ns=rs&&rs.lowerExp!==void 0?rs.lowerExp:-3,is=rs&&rs.upperExp!==void 0?rs.upperExp:5,as=splitNumber(ss),os=ts?roundDigits(as,ts):as;if(os.exponent<ns||os.exponent>=is)return toExponential$1(ss,ts);var ls=os.coefficients,us=os.exponent;ls.length<ts&&(ls=ls.concat(zeros$1(ts-ls.length))),ls=ls.concat(zeros$1(us-ls.length+1+(ls.length<ts?ts-ls.length:0)));var cs=us>0?us:0;return cs<(ls=zeros$1(-us).concat(ls)).length-1&&ls.splice(cs+1,0,"."),os.sign+ls.join("")}function roundDigits(ss,ts){for(var rs={sign:ss.sign,coefficients:ss.coefficients,exponent:ss.exponent},ns=rs.coefficients;ts<=0;)ns.unshift(0),rs.exponent++,ts++;if(ns.length>ts&&ns.splice(ts,ns.length-ts)[0]>=5){var is=ts-1;for(ns[is]++;ns[is]===10;)ns.pop(),is===0&&(ns.unshift(0),rs.exponent++,is++),ns[--is]++}return rs}function zeros$1(ss){for(var ts=[],rs=0;rs<ss;rs++)ts.push(0);return ts}function digits(ss){return ss.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length}var DBL_EPSILON=Number.EPSILON||2220446049250313e-31;function nearlyEqual$1(ss,ts,rs){if(rs==null)return ss===ts;if(ss===ts)return!0;if(isNaN(ss)||isNaN(ts))return!1;if(isFinite(ss)&&isFinite(ts)){var ns=Math.abs(ss-ts);return ns<DBL_EPSILON||ns<=Math.max(Math.abs(ss),Math.abs(ts))*rs}return!1}var acosh$3=Math.acosh||function(ss){return Math.log(Math.sqrt(ss*ss-1)+ss)},asinh$3=Math.asinh||function(ss){return Math.log(Math.sqrt(ss*ss+1)+ss)},atanh$3=Math.atanh||function(ss){return Math.log((1+ss)/(1-ss))/2},cosh$3=Math.cosh||function(ss){return(Math.exp(ss)+Math.exp(-ss))/2},sinh$3=Math.sinh||function(ss){return(Math.exp(ss)-Math.exp(-ss))/2},tanh$3=Math.tanh||function(ss){var ts=Math.exp(2*ss);return(ts-1)/(ts+1)};function copysign(ss,ts){return(ss>0||!(ss<0)&&1/ss==1/0)^(ts>0||!(ts<0)&&1/ts==1/0)?-ss:ss}function formatBigNumberToBase(ss,ts,rs){var ns=new ss.constructor(2),is="";if(rs){if(rs<1)throw new Error("size must be in greater than 0");if(!isInteger$1(rs))throw new Error("size must be an integer");if(ss.greaterThan(ns.pow(rs-1).sub(1))||ss.lessThan(ns.pow(rs-1).mul(-1)))throw new Error("Value must be in range [-2^".concat(rs-1,", 2^").concat(rs-1,"-1]"));if(!ss.isInteger())throw new Error("Value must be an integer");ss.lessThan(0)&&(ss=ss.add(ns.pow(rs))),is="i".concat(rs)}switch(ts){case 2:return"".concat(ss.toBinary()).concat(is);case 8:return"".concat(ss.toOctal()).concat(is);case 16:return"".concat(ss.toHexadecimal()).concat(is);default:throw new Error("Base ".concat(ts," not supported "))}}function format$2(ss,ts){if(typeof ts=="function")return ts(ss);if(!ss.isFinite())return ss.isNaN()?"NaN":ss.gt(0)?"Infinity":"-Infinity";var rs,ns,is="auto";if(ts!==void 0&&(ts.notation&&(is=ts.notation),typeof ts=="number"?rs=ts:ts.precision&&(rs=ts.precision),ts.wordSize&&typeof(ns=ts.wordSize)!="number"))throw new Error('Option "wordSize" must be a number');switch(is){case"fixed":return toFixed$1(ss,rs);case"exponential":return toExponential(ss,rs);case"engineering":return toEngineering(ss,rs);case"bin":return formatBigNumberToBase(ss,2,ns);case"oct":return formatBigNumberToBase(ss,8,ns);case"hex":return formatBigNumberToBase(ss,16,ns);case"auto":var as=ts&&ts.lowerExp!==void 0?ts.lowerExp:-3,os=ts&&ts.upperExp!==void 0?ts.upperExp:5;if(ss.isZero())return"0";var ls=ss.toSignificantDigits(rs),us=ls.e;return(us>=as&&us<os?ls.toFixed():toExponential(ss,rs)).replace(/((\.\d*?)(0+))($|e)/,function(){var cs=arguments[2],ps=arguments[4];return cs!=="."?cs+ps:ps});default:throw new Error('Unknown notation "'+is+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function toEngineering(ss,ts){var rs=ss.e,ns=rs%3==0?rs:rs<0?rs-3-rs%3:rs-rs%3,is=ss.mul(Math.pow(10,-ns)),as=is.toPrecision(ts);return as.indexOf("e")!==-1&&(as=is.toString()),as+"e"+(rs>=0?"+":"")+ns.toString()}function toExponential(ss,ts){return ts!==void 0?ss.toExponential(ts-1):ss.toExponential()}function toFixed$1(ss,ts){return ss.toFixed(ts)}function endsWith$1(ss,ts){var rs=ss.length-ts.length,ns=ss.length;return ss.substring(rs,ns)===ts}function format$1(ss,ts){var rs=_format(ss,ts);return ts&&typeof ts=="object"&&"truncate"in ts&&rs.length>ts.truncate?rs.substring(0,ts.truncate-3)+"...":rs}function _format(ss,ts){return typeof ss=="number"?format$3(ss,ts):isBigNumber(ss)?format$2(ss,ts):looksLikeFraction(ss)?ts&&ts.fraction==="decimal"?ss.toString():ss.s*ss.n+"/"+ss.d:Array.isArray(ss)?formatArray(ss,ts):isString$1$1(ss)?'"'+ss+'"':typeof ss=="function"?ss.syntax?String(ss.syntax):"function":ss&&typeof ss=="object"?typeof ss.format=="function"?ss.format(ts):ss&&ss.toString(ts)!=={}.toString()?ss.toString(ts):"{"+Object.keys(ss).map(rs=>'"'+rs+'": '+format$1(ss[rs],ts)).join(", ")+"}":String(ss)}function stringify(ss){for(var ts=String(ss),rs="",ns=0;ns<ts.length;){var is=ts.charAt(ns);is==="\\"?(rs+=is,ns++,(is=ts.charAt(ns))!==""&&'"\\/bfnrtu'.indexOf(is)!==-1||(rs+="\\"),rs+=is):rs+=is==='"'?'\\"':is,ns++}return'"'+rs+'"'}function escape$1(ss){var ts=String(ss);return ts=ts.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function formatArray(ss,ts){if(Array.isArray(ss)){for(var rs="[",ns=ss.length,is=0;is<ns;is++)is!==0&&(rs+=", "),rs+=formatArray(ss[is],ts);return rs+="]"}return format$1(ss,ts)}function looksLikeFraction(ss){return ss&&typeof ss=="object"&&typeof ss.s=="number"&&typeof ss.n=="number"&&typeof ss.d=="number"||!1}function compareText$1(ss,ts){if(!isString$1$1(ss))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+typeOf$1(ss)+", index: 0)");if(!isString$1$1(ts))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+typeOf$1(ts)+", index: 1)");return ss===ts?0:ss>ts?1:-1}function DimensionError(ss,ts,rs){if(!(this instanceof DimensionError))throw new SyntaxError("Constructor must be called with the new operator");this.actual=ss,this.expected=ts,this.relation=rs,this.message="Dimension mismatch ("+(Array.isArray(ss)?"["+ss.join(", ")+"]":ss)+" "+(this.relation||"!=")+" "+(Array.isArray(ts)?"["+ts.join(", ")+"]":ts)+")",this.stack=new Error().stack}function IndexError(ss,ts,rs){if(!(this instanceof IndexError))throw new SyntaxError("Constructor must be called with the new operator");this.index=ss,arguments.length<3?(this.min=0,this.max=ts):(this.min=ts,this.max=rs),this.min!==void 0&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":this.max!==void 0&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=new Error().stack}function arraySize(ss){for(var ts=[];Array.isArray(ss);)ts.push(ss.length),ss=ss[0];return ts}function _validate(ss,ts,rs){var ns,is=ss.length;if(is!==ts[rs])throw new DimensionError(is,ts[rs]);if(rs<ts.length-1){var as=rs+1;for(ns=0;ns<is;ns++){var os=ss[ns];if(!Array.isArray(os))throw new DimensionError(ts.length-1,ts.length,"<");_validate(ss[ns],ts,as)}}else for(ns=0;ns<is;ns++)if(Array.isArray(ss[ns]))throw new DimensionError(ts.length+1,ts.length,">")}function validate$1(ss,ts){if(ts.length===0){if(Array.isArray(ss))throw new DimensionError(ss.length,0)}else _validate(ss,ts,0)}function validateIndex(ss,ts){if(!isNumber$1(ss)||!isInteger$1(ss))throw new TypeError("Index must be an integer (value: "+ss+")");if(ss<0||typeof ts=="number"&&ss>=ts)throw new IndexError(ss,ts)}function resize$1(ss,ts,rs){if(!Array.isArray(ss)||!Array.isArray(ts))throw new TypeError("Array expected");if(ts.length===0)throw new Error("Resizing to scalar is not supported");return ts.forEach(function(ns){if(!isNumber$1(ns)||!isInteger$1(ns)||ns<0)throw new TypeError("Invalid size, must contain positive integers (size: "+format$1(ts)+")")}),_resize(ss,ts,0,rs!==void 0?rs:0),ss}function _resize(ss,ts,rs,ns){var is,as,os=ss.length,ls=ts[rs],us=Math.min(os,ls);if(ss.length=ls,rs<ts.length-1){var cs=rs+1;for(is=0;is<us;is++)as=ss[is],Array.isArray(as)||(as=[as],ss[is]=as),_resize(as,ts,cs,ns);for(is=us;is<ls;is++)as=[],ss[is]=as,_resize(as,ts,cs,ns)}else{for(is=0;is<us;is++)for(;Array.isArray(ss[is]);)ss[is]=ss[is][0];for(is=us;is<ls;is++)ss[is]=ns}}function reshape$1(ss,ts){var rs=flatten$4(ss),ns=rs.length;if(!Array.isArray(ss)||!Array.isArray(ts))throw new TypeError("Array expected");if(ts.length===0)throw new DimensionError(0,ns,"!=");var is=product$1(ts=processSizesWildcard(ts,ns));if(ns!==is)throw new DimensionError(is,ns,"!=");try{return _reshape(rs,ts)}catch(as){throw as instanceof DimensionError?new DimensionError(is,ns,"!="):as}}function processSizesWildcard(ss,ts){var rs=product$1(ss),ns=ss.slice(),is=ss.indexOf(-1);if(ss.indexOf(-1,is+1)>=0)throw new Error("More than one wildcard in sizes");if(is>=0){if(ts%rs!=0)throw new Error("Could not replace wildcard, since "+ts+" is no multiple of "+-rs);ns[is]=-ts/rs}return ns}function product$1(ss){return ss.reduce((ts,rs)=>ts*rs,1)}function _reshape(ss,ts){for(var rs,ns=ss,is=ts.length-1;is>0;is--){var as=ts[is];rs=[];for(var os=ns.length/as,ls=0;ls<os;ls++)rs.push(ns.slice(ls*as,(ls+1)*as));ns=rs}return ns}function squeeze$1(ss,ts){for(var rs=ts||arraySize(ss);Array.isArray(ss)&&ss.length===1;)ss=ss[0],rs.shift();for(var ns=rs.length;rs[ns-1]===1;)ns--;return ns<rs.length&&(ss=_squeeze(ss,ns,0),rs.length=ns),ss}function _squeeze(ss,ts,rs){var ns,is;if(rs<ts){var as=rs+1;for(ns=0,is=ss.length;ns<is;ns++)ss[ns]=_squeeze(ss[ns],ts,as)}else for(;Array.isArray(ss);)ss=ss[0];return ss}function unsqueeze(ss,ts,rs,ns){var is=ns||arraySize(ss);if(rs)for(var as=0;as<rs;as++)ss=[ss],is.unshift(1);for(ss=_unsqueeze(ss,ts,0);is.length<ts;)is.push(1);return ss}function _unsqueeze(ss,ts,rs){var ns,is;if(Array.isArray(ss)){var as=rs+1;for(ns=0,is=ss.length;ns<is;ns++)ss[ns]=_unsqueeze(ss[ns],ts,as)}else for(var os=rs;os<ts;os++)ss=[ss];return ss}function flatten$4(ss){if(!Array.isArray(ss))return ss;var ts=[];return ss.forEach(function rs(ns){Array.isArray(ns)?ns.forEach(rs):ts.push(ns)}),ts}function map$2(ss,ts){return Array.prototype.map.call(ss,ts)}function forEach$1$1(ss,ts){Array.prototype.forEach.call(ss,ts)}function filter$2(ss,ts){if(arraySize(ss).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(ss,ts)}function filterRegExp(ss,ts){if(arraySize(ss).length!==1)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(ss,rs=>ts.test(rs))}function join(ss,ts){return Array.prototype.join.call(ss,ts)}function identify(ss){if(!Array.isArray(ss))throw new TypeError("Array input expected");if(ss.length===0)return ss;var ts=[],rs=0;ts[0]={value:ss[0],identifier:0};for(var ns=1;ns<ss.length;ns++)ss[ns]===ss[ns-1]?rs++:rs=0,ts.push({value:ss[ns],identifier:rs});return ts}function generalize(ss){if(!Array.isArray(ss))throw new TypeError("Array input expected");if(ss.length===0)return ss;for(var ts=[],rs=0;rs<ss.length;rs++)ts.push(ss[rs].value);return ts}function getArrayDataType(ss,ts){for(var rs,ns=0,is=0;is<ss.length;is++){var as=ss[is],os=Array.isArray(as);if(is===0&&os&&(ns=as.length),os&&as.length!==ns)return;var ls=os?getArrayDataType(as,ts):ts(as);if(rs===void 0)rs=ls;else if(rs!==ls)return"mixed"}return rs}function contains$1(ss,ts){return ss.indexOf(ts)!==-1}function factory(ss,ts,rs,ns){function is(as){var os=pickShallow(as,ts.map(stripOptionalNotation));return assertDependencies(ss,ts,as),rs(os)}return is.isFactory=!0,is.fn=ss,is.dependencies=ts.slice().sort(),ns&&(is.meta=ns),is}function isFactory(ss){return typeof ss=="function"&&typeof ss.fn=="string"&&Array.isArray(ss.dependencies)}function assertDependencies(ss,ts,rs){if(!ts.filter(is=>!isOptionalDependency(is)).every(is=>rs[is]!==void 0)){var ns=ts.filter(is=>rs[is]===void 0);throw new Error('Cannot create function "'.concat(ss,'", ')+"some dependencies are missing: ".concat(ns.map(is=>'"'.concat(is,'"')).join(", "),"."))}}function isOptionalDependency(ss){return ss&&ss[0]==="?"}function stripOptionalNotation(ss){return ss&&ss[0]==="?"?ss.slice(1):ss}function getSafeProperty(ss,ts){if(isPlainObject$1(ss)&&isSafeProperty(ss,ts))return ss[ts];throw typeof ss[ts]=="function"&&isSafeMethod(ss,ts)?new Error('Cannot access method "'+ts+'" as a property'):new Error('No access to property "'+ts+'"')}function setSafeProperty(ss,ts,rs){if(isPlainObject$1(ss)&&isSafeProperty(ss,ts))return ss[ts]=rs,rs;throw new Error('No access to property "'+ts+'"')}function hasSafeProperty(ss,ts){return ts in ss}function isSafeProperty(ss,ts){return!(!ss||typeof ss!="object")&&(!!hasOwnProperty$2(safeNativeProperties,ts)||!(ts in Object.prototype)&&!(ts in Function.prototype))}function validateSafeMethod(ss,ts){if(!isSafeMethod(ss,ts))throw new Error('No access to method "'+ts+'"')}function isSafeMethod(ss,ts){return ss!=null&&typeof ss[ts]=="function"&&!(hasOwnProperty$2(ss,ts)&&Object.getPrototypeOf&&ts in Object.getPrototypeOf(ss))&&(!!hasOwnProperty$2(safeNativeMethods,ts)||!(ts in Object.prototype)&&!(ts in Function.prototype))}function isPlainObject$1(ss){return typeof ss=="object"&&ss&&ss.constructor===Object}DimensionError.prototype=new RangeError,DimensionError.prototype.constructor=RangeError,DimensionError.prototype.name="DimensionError",DimensionError.prototype.isDimensionError=!0,IndexError.prototype=new RangeError,IndexError.prototype.constructor=RangeError,IndexError.prototype.name="IndexError",IndexError.prototype.isIndexError=!0;var safeNativeProperties={length:!0,name:!0},safeNativeMethods={toString:!0,valueOf:!0,toLocaleString:!0};class ObjectWrappingMap{constructor(ts){this.wrappedObject=ts}keys(){return Object.keys(this.wrappedObject)}get(ts){return getSafeProperty(this.wrappedObject,ts)}set(ts,rs){return setSafeProperty(this.wrappedObject,ts,rs),this}has(ts){return hasSafeProperty(this.wrappedObject,ts)}}function createEmptyMap(){return new Map}function createMap$1(ss){if(!ss)return createEmptyMap();if(isMap$1(ss))return ss;if(isObject$1$1(ss))return new ObjectWrappingMap(ss);throw new Error("createMap can create maps from objects or Maps")}function toObject(ss){if(ss instanceof ObjectWrappingMap)return ss.wrappedObject;var ts={};for(var rs of ss.keys())setSafeProperty(ts,rs,ss.get(rs));return ts}function isMap$1(ss){return!!ss&&(ss instanceof Map||ss instanceof ObjectWrappingMap||typeof ss.set=="function"&&typeof ss.get=="function"&&typeof ss.keys=="function"&&typeof ss.has=="function")}function assign$2(ss){for(var ts=arguments.length,rs=new Array(ts>1?ts-1:0),ns=1;ns<ts;ns++)rs[ns-1]=arguments[ns];for(var is of rs)if(is){if(isMap$1(is))for(var as of is.keys())ss.set(as,is.get(as));else if(isObject$1$1(is))for(var os of Object.keys(is))ss.set(os,is[os])}return ss}var _createTyped2=function(){return _createTyped2=typedFunction.create,typedFunction},dependencies$4D=["?BigNumber","?Complex","?DenseMatrix","?Fraction"],createTyped=factory("typed",dependencies$4D,function(ss){var{BigNumber:ts,Complex:rs,DenseMatrix:ns,Fraction:is}=ss,as=_createTyped2();return as.types=[{name:"number",test:isNumber$1},{name:"Complex",test:isComplex},{name:"BigNumber",test:isBigNumber},{name:"Fraction",test:isFraction},{name:"Unit",test:isUnit},{name:"string",test:isString$1$1},{name:"Chain",test:isChain},{name:"Array",test:isArray$1$1},{name:"Matrix",test:isMatrix},{name:"DenseMatrix",test:isDenseMatrix},{name:"SparseMatrix",test:isSparseMatrix},{name:"Range",test:isRange},{name:"Index",test:isIndex},{name:"boolean",test:isBoolean$1$1},{name:"ResultSet",test:isResultSet},{name:"Help",test:isHelp},{name:"function",test:isFunction$2$1},{name:"Date",test:isDate$1},{name:"RegExp",test:isRegExp$1},{name:"null",test:isNull$1},{name:"undefined",test:isUndefined$1$1},{name:"AccessorNode",test:isAccessorNode},{name:"ArrayNode",test:isArrayNode},{name:"AssignmentNode",test:isAssignmentNode},{name:"BlockNode",test:isBlockNode},{name:"ConditionalNode",test:isConditionalNode},{name:"ConstantNode",test:isConstantNode},{name:"FunctionNode",test:isFunctionNode},{name:"FunctionAssignmentNode",test:isFunctionAssignmentNode},{name:"IndexNode",test:isIndexNode},{name:"Node",test:isNode$1},{name:"ObjectNode",test:isObjectNode},{name:"OperatorNode",test:isOperatorNode},{name:"ParenthesisNode",test:isParenthesisNode},{name:"RangeNode",test:isRangeNode},{name:"SymbolNode",test:isSymbolNode},{name:"Map",test:isMap$1},{name:"Object",test:isObject$1$1}],as.conversions=[{from:"number",to:"BigNumber",convert:function(os){if(ts||throwNoBignumber(os),digits(os)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+os+"). Use function bignumber(x) to convert to BigNumber.");return new ts(os)}},{from:"number",to:"Complex",convert:function(os){return rs||throwNoComplex(os),new rs(os,0)}},{from:"number",to:"string",convert:function(os){return os+""}},{from:"BigNumber",to:"Complex",convert:function(os){return rs||throwNoComplex(os),new rs(os.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(os){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(os){return rs||throwNoComplex(os),new rs(os.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(os){is||throwNoFraction(os);var ls=new is(os);if(ls.valueOf()!==os)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+os+"). Use function fraction(x) to convert to Fraction.");return ls}},{from:"string",to:"number",convert:function(os){var ls=Number(os);if(isNaN(ls))throw new Error('Cannot convert "'+os+'" to a number');return ls}},{from:"string",to:"BigNumber",convert:function(os){ts||throwNoBignumber(os);try{return new ts(os)}catch{throw new Error('Cannot convert "'+os+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(os){is||throwNoFraction(os);try{return new is(os)}catch{throw new Error('Cannot convert "'+os+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(os){rs||throwNoComplex(os);try{return new rs(os)}catch{throw new Error('Cannot convert "'+os+'" to Complex')}}},{from:"boolean",to:"number",convert:function(os){return+os}},{from:"boolean",to:"BigNumber",convert:function(os){return ts||throwNoBignumber(os),new ts(+os)}},{from:"boolean",to:"Fraction",convert:function(os){return is||throwNoFraction(os),new is(+os)}},{from:"boolean",to:"string",convert:function(os){return String(os)}},{from:"Array",to:"Matrix",convert:function(os){return ns||throwNoMatrix(),new ns(os)}},{from:"Matrix",to:"Array",convert:function(os){return os.valueOf()}}],as});function throwNoBignumber(ss){throw new Error("Cannot convert value ".concat(ss," into a BigNumber: no class 'BigNumber' provided"))}function throwNoComplex(ss){throw new Error("Cannot convert value ".concat(ss," into a Complex number: no class 'Complex' provided"))}function throwNoMatrix(){throw new Error("Cannot convert array into a Matrix: no class 'DenseMatrix' provided")}function throwNoFraction(ss){throw new Error("Cannot convert value ".concat(ss," into a Fraction, no class 'Fraction' provided."))}var name$4C="ResultSet",dependencies$4C=[],createResultSet=factory(name$4C,dependencies$4C,()=>{function ss(ts){if(!(this instanceof ss))throw new SyntaxError("Constructor must be called with the new operator");this.entries=ts||[]}return ss.prototype.type="ResultSet",ss.prototype.isResultSet=!0,ss.prototype.valueOf=function(){return this.entries},ss.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},ss.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},ss.fromJSON=function(ts){return new ss(ts.entries)},ss},{isClass:!0}),EXP_LIMIT=9e15,MAX_DIGITS=1e9,NUMERALS="0123456789abcdef",LN10$1="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",PI$1="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",DEFAULTS$1={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-EXP_LIMIT,maxE:EXP_LIMIT,crypto:!1},inexact,quadrant,external=!0,decimalError="[DecimalError] ",invalidArgument=decimalError+"Invalid argument: ",precisionLimitExceeded=decimalError+"Precision limit exceeded",cryptoUnavailable=decimalError+"crypto unavailable",tag="[object Decimal]",mathfloor=Math.floor,mathpow=Math.pow,isBinary=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,isHex=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,isOctal=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,isDecimal=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,BASE=1e7,LOG_BASE=7,MAX_SAFE_INTEGER=9007199254740991,LN10_PRECISION=LN10$1.length-1,PI_PRECISION=PI$1.length-1,P$1$1={toStringTag:tag};function digitsToString(ss){var ts,rs,ns,is=ss.length-1,as="",os=ss[0];if(is>0){for(as+=os,ts=1;ts<is;ts++)ns=ss[ts]+"",(rs=LOG_BASE-ns.length)&&(as+=getZeroString(rs)),as+=ns;os=ss[ts],(rs=LOG_BASE-(ns=os+"").length)&&(as+=getZeroString(rs))}else if(os===0)return"0";for(;os%10==0;)os/=10;return as+os}function checkInt32(ss,ts,rs){if(ss!==~~ss||ss<ts||ss>rs)throw Error(invalidArgument+ss)}function checkRoundingDigits(ss,ts,rs,ns){var is,as,os,ls;for(as=ss[0];as>=10;as/=10)--ts;return--ts<0?(ts+=LOG_BASE,is=0):(is=Math.ceil((ts+1)/LOG_BASE),ts%=LOG_BASE),as=mathpow(10,LOG_BASE-ts),ls=ss[is]%as|0,ns==null?ts<3?(ts==0?ls=ls/100|0:ts==1&&(ls=ls/10|0),os=rs<4&&ls==99999||rs>3&&ls==49999||ls==5e4||ls==0):os=(rs<4&&ls+1==as||rs>3&&ls+1==as/2)&&(ss[is+1]/as/100|0)==mathpow(10,ts-2)-1||(ls==as/2||ls==0)&&(ss[is+1]/as/100|0)==0:ts<4?(ts==0?ls=ls/1e3|0:ts==1?ls=ls/100|0:ts==2&&(ls=ls/10|0),os=(ns||rs<4)&&ls==9999||!ns&&rs>3&&ls==4999):os=((ns||rs<4)&&ls+1==as||!ns&&rs>3&&ls+1==as/2)&&(ss[is+1]/as/1e3|0)==mathpow(10,ts-3)-1,os}function convertBase(ss,ts,rs){for(var ns,is,as=[0],os=0,ls=ss.length;os<ls;){for(is=as.length;is--;)as[is]*=ts;for(as[0]+=NUMERALS.indexOf(ss.charAt(os++)),ns=0;ns<as.length;ns++)as[ns]>rs-1&&(as[ns+1]===void 0&&(as[ns+1]=0),as[ns+1]+=as[ns]/rs|0,as[ns]%=rs)}return as.reverse()}function cosine(ss,ts){var rs,ns,is;if(ts.isZero())return ts;(ns=ts.d.length)<32?is=(1/tinyPow(4,rs=Math.ceil(ns/3))).toString():(rs=16,is="2.3283064365386962890625e-10"),ss.precision+=rs,ts=taylorSeries(ss,1,ts.times(is),new ss(1));for(var as=rs;as--;){var os=ts.times(ts);ts=os.times(os).minus(os).times(8).plus(1)}return ss.precision-=rs,ts}P$1$1.absoluteValue=P$1$1.abs=function(){var ss=new this.constructor(this);return ss.s<0&&(ss.s=1),finalise(ss)},P$1$1.ceil=function(){return finalise(new this.constructor(this),this.e+1,2)},P$1$1.clampedTo=P$1$1.clamp=function(ss,ts){var rs=this,ns=rs.constructor;if(ss=new ns(ss),ts=new ns(ts),!ss.s||!ts.s)return new ns(NaN);if(ss.gt(ts))throw Error(invalidArgument+ts);return rs.cmp(ss)<0?ss:rs.cmp(ts)>0?ts:new ns(rs)},P$1$1.comparedTo=P$1$1.cmp=function(ss){var ts,rs,ns,is,as=this,os=as.d,ls=(ss=new as.constructor(ss)).d,us=as.s,cs=ss.s;if(!os||!ls)return us&&cs?us!==cs?us:os===ls?0:!os^us<0?1:-1:NaN;if(!os[0]||!ls[0])return os[0]?us:ls[0]?-cs:0;if(us!==cs)return us;if(as.e!==ss.e)return as.e>ss.e^us<0?1:-1;for(ts=0,rs=(ns=os.length)<(is=ls.length)?ns:is;ts<rs;++ts)if(os[ts]!==ls[ts])return os[ts]>ls[ts]^us<0?1:-1;return ns===is?0:ns>is^us<0?1:-1},P$1$1.cosine=P$1$1.cos=function(){var ss,ts,rs=this,ns=rs.constructor;return rs.d?rs.d[0]?(ss=ns.precision,ts=ns.rounding,ns.precision=ss+Math.max(rs.e,rs.sd())+LOG_BASE,ns.rounding=1,rs=cosine(ns,toLessThanHalfPi(ns,rs)),ns.precision=ss,ns.rounding=ts,finalise(quadrant==2||quadrant==3?rs.neg():rs,ss,ts,!0)):new ns(1):new ns(NaN)},P$1$1.cubeRoot=P$1$1.cbrt=function(){var ss,ts,rs,ns,is,as,os,ls,us,cs,ps=this,ds=ps.constructor;if(!ps.isFinite()||ps.isZero())return new ds(ps);for(external=!1,(as=ps.s*mathpow(ps.s*ps,1/3))&&Math.abs(as)!=1/0?ns=new ds(as.toString()):(rs=digitsToString(ps.d),(as=((ss=ps.e)-rs.length+1)%3)&&(rs+=as==1||as==-2?"0":"00"),as=mathpow(rs,1/3),ss=mathfloor((ss+1)/3)-(ss%3==(ss<0?-1:2)),(ns=new ds(rs=as==1/0?"5e"+ss:(rs=as.toExponential()).slice(0,rs.indexOf("e")+1)+ss)).s=ps.s),os=(ss=ds.precision)+3;;)if(cs=(us=(ls=ns).times(ls).times(ls)).plus(ps),ns=divide$2(cs.plus(ps).times(ls),cs.plus(us),os+2,1),digitsToString(ls.d).slice(0,os)===(rs=digitsToString(ns.d)).slice(0,os)){if((rs=rs.slice(os-3,os+1))!="9999"&&(is||rs!="4999")){+rs&&(+rs.slice(1)||rs.charAt(0)!="5")||(finalise(ns,ss+1,1),ts=!ns.times(ns).times(ns).eq(ps));break}if(!is&&(finalise(ls,ss+1,0),ls.times(ls).times(ls).eq(ps))){ns=ls;break}os+=4,is=1}return external=!0,finalise(ns,ss,ds.rounding,ts)},P$1$1.decimalPlaces=P$1$1.dp=function(){var ss,ts=this.d,rs=NaN;if(ts){if(rs=((ss=ts.length-1)-mathfloor(this.e/LOG_BASE))*LOG_BASE,ss=ts[ss])for(;ss%10==0;ss/=10)rs--;rs<0&&(rs=0)}return rs},P$1$1.dividedBy=P$1$1.div=function(ss){return divide$2(this,new this.constructor(ss))},P$1$1.dividedToIntegerBy=P$1$1.divToInt=function(ss){var ts=this.constructor;return finalise(divide$2(this,new ts(ss),0,1,1),ts.precision,ts.rounding)},P$1$1.equals=P$1$1.eq=function(ss){return this.cmp(ss)===0},P$1$1.floor=function(){return finalise(new this.constructor(this),this.e+1,3)},P$1$1.greaterThan=P$1$1.gt=function(ss){return this.cmp(ss)>0},P$1$1.greaterThanOrEqualTo=P$1$1.gte=function(ss){var ts=this.cmp(ss);return ts==1||ts===0},P$1$1.hyperbolicCosine=P$1$1.cosh=function(){var ss,ts,rs,ns,is,as=this,os=as.constructor,ls=new os(1);if(!as.isFinite())return new os(as.s?1/0:NaN);if(as.isZero())return ls;rs=os.precision,ns=os.rounding,os.precision=rs+Math.max(as.e,as.sd())+4,os.rounding=1,(is=as.d.length)<32?ts=(1/tinyPow(4,ss=Math.ceil(is/3))).toString():(ss=16,ts="2.3283064365386962890625e-10"),as=taylorSeries(os,1,as.times(ts),new os(1),!0);for(var us,cs=ss,ps=new os(8);cs--;)us=as.times(as),as=ls.minus(us.times(ps.minus(us.times(ps))));return finalise(as,os.precision=rs,os.rounding=ns,!0)},P$1$1.hyperbolicSine=P$1$1.sinh=function(){var ss,ts,rs,ns,is=this,as=is.constructor;if(!is.isFinite()||is.isZero())return new as(is);if(ts=as.precision,rs=as.rounding,as.precision=ts+Math.max(is.e,is.sd())+4,as.rounding=1,(ns=is.d.length)<3)is=taylorSeries(as,2,is,is,!0);else{ss=(ss=1.4*Math.sqrt(ns))>16?16:0|ss,is=taylorSeries(as,2,is=is.times(1/tinyPow(5,ss)),is,!0);for(var os,ls=new as(5),us=new as(16),cs=new as(20);ss--;)os=is.times(is),is=is.times(ls.plus(os.times(us.times(os).plus(cs))))}return as.precision=ts,as.rounding=rs,finalise(is,ts,rs,!0)},P$1$1.hyperbolicTangent=P$1$1.tanh=function(){var ss,ts,rs=this,ns=rs.constructor;return rs.isFinite()?rs.isZero()?new ns(rs):(ss=ns.precision,ts=ns.rounding,ns.precision=ss+7,ns.rounding=1,divide$2(rs.sinh(),rs.cosh(),ns.precision=ss,ns.rounding=ts)):new ns(rs.s)},P$1$1.inverseCosine=P$1$1.acos=function(){var ss,ts=this,rs=ts.constructor,ns=ts.abs().cmp(1),is=rs.precision,as=rs.rounding;return ns!==-1?ns===0?ts.isNeg()?getPi(rs,is,as):new rs(0):new rs(NaN):ts.isZero()?getPi(rs,is+4,as).times(.5):(rs.precision=is+6,rs.rounding=1,ts=ts.asin(),ss=getPi(rs,is+4,as).times(.5),rs.precision=is,rs.rounding=as,ss.minus(ts))},P$1$1.inverseHyperbolicCosine=P$1$1.acosh=function(){var ss,ts,rs=this,ns=rs.constructor;return rs.lte(1)?new ns(rs.eq(1)?0:NaN):rs.isFinite()?(ss=ns.precision,ts=ns.rounding,ns.precision=ss+Math.max(Math.abs(rs.e),rs.sd())+4,ns.rounding=1,external=!1,rs=rs.times(rs).minus(1).sqrt().plus(rs),external=!0,ns.precision=ss,ns.rounding=ts,rs.ln()):new ns(rs)},P$1$1.inverseHyperbolicSine=P$1$1.asinh=function(){var ss,ts,rs=this,ns=rs.constructor;return!rs.isFinite()||rs.isZero()?new ns(rs):(ss=ns.precision,ts=ns.rounding,ns.precision=ss+2*Math.max(Math.abs(rs.e),rs.sd())+6,ns.rounding=1,external=!1,rs=rs.times(rs).plus(1).sqrt().plus(rs),external=!0,ns.precision=ss,ns.rounding=ts,rs.ln())},P$1$1.inverseHyperbolicTangent=P$1$1.atanh=function(){var ss,ts,rs,ns,is=this,as=is.constructor;return is.isFinite()?is.e>=0?new as(is.abs().eq(1)?is.s/0:is.isZero()?is:NaN):(ss=as.precision,ts=as.rounding,ns=is.sd(),Math.max(ns,ss)<2*-is.e-1?finalise(new as(is),ss,ts,!0):(as.precision=rs=ns-is.e,is=divide$2(is.plus(1),new as(1).minus(is),rs+ss,1),as.precision=ss+4,as.rounding=1,is=is.ln(),as.precision=ss,as.rounding=ts,is.times(.5))):new as(NaN)},P$1$1.inverseSine=P$1$1.asin=function(){var ss,ts,rs,ns,is=this,as=is.constructor;return is.isZero()?new as(is):(ts=is.abs().cmp(1),rs=as.precision,ns=as.rounding,ts!==-1?ts===0?((ss=getPi(as,rs+4,ns).times(.5)).s=is.s,ss):new as(NaN):(as.precision=rs+6,as.rounding=1,is=is.div(new as(1).minus(is.times(is)).sqrt().plus(1)).atan(),as.precision=rs,as.rounding=ns,is.times(2)))},P$1$1.inverseTangent=P$1$1.atan=function(){var ss,ts,rs,ns,is,as,os,ls,us,cs=this,ps=cs.constructor,ds=ps.precision,fs=ps.rounding;if(cs.isFinite()){if(cs.isZero())return new ps(cs);if(cs.abs().eq(1)&&ds+4<=PI_PRECISION)return(os=getPi(ps,ds+4,fs).times(.25)).s=cs.s,os}else{if(!cs.s)return new ps(NaN);if(ds+4<=PI_PRECISION)return(os=getPi(ps,ds+4,fs).times(.5)).s=cs.s,os}for(ps.precision=ls=ds+10,ps.rounding=1,ss=rs=Math.min(28,ls/LOG_BASE+2|0);ss;--ss)cs=cs.div(cs.times(cs).plus(1).sqrt().plus(1));for(external=!1,ts=Math.ceil(ls/LOG_BASE),ns=1,us=cs.times(cs),os=new ps(cs),is=cs;ss!==-1;)if(is=is.times(us),as=os.minus(is.div(ns+=2)),is=is.times(us),(os=as.plus(is.div(ns+=2))).d[ts]!==void 0)for(ss=ts;os.d[ss]===as.d[ss]&&ss--;);return rs&&(os=os.times(2<<rs-1)),external=!0,finalise(os,ps.precision=ds,ps.rounding=fs,!0)},P$1$1.isFinite=function(){return!!this.d},P$1$1.isInteger=P$1$1.isInt=function(){return!!this.d&&mathfloor(this.e/LOG_BASE)>this.d.length-2},P$1$1.isNaN=function(){return!this.s},P$1$1.isNegative=P$1$1.isNeg=function(){return this.s<0},P$1$1.isPositive=P$1$1.isPos=function(){return this.s>0},P$1$1.isZero=function(){return!!this.d&&this.d[0]===0},P$1$1.lessThan=P$1$1.lt=function(ss){return this.cmp(ss)<0},P$1$1.lessThanOrEqualTo=P$1$1.lte=function(ss){return this.cmp(ss)<1},P$1$1.logarithm=P$1$1.log=function(ss){var ts,rs,ns,is,as,os,ls,us,cs=this,ps=cs.constructor,ds=ps.precision,fs=ps.rounding;if(ss==null)ss=new ps(10),ts=!0;else{if(rs=(ss=new ps(ss)).d,ss.s<0||!rs||!rs[0]||ss.eq(1))return new ps(NaN);ts=ss.eq(10)}if(rs=cs.d,cs.s<0||!rs||!rs[0]||cs.eq(1))return new ps(rs&&!rs[0]?-1/0:cs.s!=1?NaN:rs?0:1/0);if(ts)if(rs.length>1)as=!0;else{for(is=rs[0];is%10==0;)is/=10;as=is!==1}if(external=!1,os=naturalLogarithm(cs,ls=ds+5),ns=ts?getLn10(ps,ls+10):naturalLogarithm(ss,ls),checkRoundingDigits((us=divide$2(os,ns,ls,1)).d,is=ds,fs))do if(os=naturalLogarithm(cs,ls+=10),ns=ts?getLn10(ps,ls+10):naturalLogarithm(ss,ls),us=divide$2(os,ns,ls,1),!as){+digitsToString(us.d).slice(is+1,is+15)+1==1e14&&(us=finalise(us,ds+1,0));break}while(checkRoundingDigits(us.d,is+=10,fs));return external=!0,finalise(us,ds,fs)},P$1$1.minus=P$1$1.sub=function(ss){var ts,rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs=this,ys=hs.constructor;if(ss=new ys(ss),!hs.d||!ss.d)return hs.s&&ss.s?hs.d?ss.s=-ss.s:ss=new ys(ss.d||hs.s!==ss.s?hs:NaN):ss=new ys(NaN),ss;if(hs.s!=ss.s)return ss.s=-ss.s,hs.plus(ss);if(cs=hs.d,fs=ss.d,ls=ys.precision,us=ys.rounding,!cs[0]||!fs[0]){if(fs[0])ss.s=-ss.s;else{if(!cs[0])return new ys(us===3?-0:0);ss=new ys(hs)}return external?finalise(ss,ls,us):ss}if(rs=mathfloor(ss.e/LOG_BASE),ps=mathfloor(hs.e/LOG_BASE),cs=cs.slice(),as=ps-rs){for((ds=as<0)?(ts=cs,as=-as,os=fs.length):(ts=fs,rs=ps,os=cs.length),as>(ns=Math.max(Math.ceil(ls/LOG_BASE),os)+2)&&(as=ns,ts.length=1),ts.reverse(),ns=as;ns--;)ts.push(0);ts.reverse()}else{for((ds=(ns=cs.length)<(os=fs.length))&&(os=ns),ns=0;ns<os;ns++)if(cs[ns]!=fs[ns]){ds=cs[ns]<fs[ns];break}as=0}for(ds&&(ts=cs,cs=fs,fs=ts,ss.s=-ss.s),os=cs.length,ns=fs.length-os;ns>0;--ns)cs[os++]=0;for(ns=fs.length;ns>as;){if(cs[--ns]<fs[ns]){for(is=ns;is&&cs[--is]===0;)cs[is]=BASE-1;--cs[is],cs[ns]+=BASE}cs[ns]-=fs[ns]}for(;cs[--os]===0;)cs.pop();for(;cs[0]===0;cs.shift())--rs;return cs[0]?(ss.d=cs,ss.e=getBase10Exponent(cs,rs),external?finalise(ss,ls,us):ss):new ys(us===3?-0:0)},P$1$1.modulo=P$1$1.mod=function(ss){var ts,rs=this,ns=rs.constructor;return ss=new ns(ss),!rs.d||!ss.s||ss.d&&!ss.d[0]?new ns(NaN):!ss.d||rs.d&&!rs.d[0]?finalise(new ns(rs),ns.precision,ns.rounding):(external=!1,ns.modulo==9?(ts=divide$2(rs,ss.abs(),0,3,1)).s*=ss.s:ts=divide$2(rs,ss,0,ns.modulo,1),ts=ts.times(ss),external=!0,rs.minus(ts))},P$1$1.naturalExponential=P$1$1.exp=function(){return naturalExponential(this)},P$1$1.naturalLogarithm=P$1$1.ln=function(){return naturalLogarithm(this)},P$1$1.negated=P$1$1.neg=function(){var ss=new this.constructor(this);return ss.s=-ss.s,finalise(ss)},P$1$1.plus=P$1$1.add=function(ss){var ts,rs,ns,is,as,os,ls,us,cs,ps,ds=this,fs=ds.constructor;if(ss=new fs(ss),!ds.d||!ss.d)return ds.s&&ss.s?ds.d||(ss=new fs(ss.d||ds.s===ss.s?ds:NaN)):ss=new fs(NaN),ss;if(ds.s!=ss.s)return ss.s=-ss.s,ds.minus(ss);if(cs=ds.d,ps=ss.d,ls=fs.precision,us=fs.rounding,!cs[0]||!ps[0])return ps[0]||(ss=new fs(ds)),external?finalise(ss,ls,us):ss;if(as=mathfloor(ds.e/LOG_BASE),ns=mathfloor(ss.e/LOG_BASE),cs=cs.slice(),is=as-ns){for(is<0?(rs=cs,is=-is,os=ps.length):(rs=ps,ns=as,os=cs.length),is>(os=(as=Math.ceil(ls/LOG_BASE))>os?as+1:os+1)&&(is=os,rs.length=1),rs.reverse();is--;)rs.push(0);rs.reverse()}for((os=cs.length)-(is=ps.length)<0&&(is=os,rs=ps,ps=cs,cs=rs),ts=0;is;)ts=(cs[--is]=cs[is]+ps[is]+ts)/BASE|0,cs[is]%=BASE;for(ts&&(cs.unshift(ts),++ns),os=cs.length;cs[--os]==0;)cs.pop();return ss.d=cs,ss.e=getBase10Exponent(cs,ns),external?finalise(ss,ls,us):ss},P$1$1.precision=P$1$1.sd=function(ss){var ts,rs=this;if(ss!==void 0&&ss!==!!ss&&ss!==1&&ss!==0)throw Error(invalidArgument+ss);return rs.d?(ts=getPrecision(rs.d),ss&&rs.e+1>ts&&(ts=rs.e+1)):ts=NaN,ts},P$1$1.round=function(){var ss=this,ts=ss.constructor;return finalise(new ts(ss),ss.e+1,ts.rounding)},P$1$1.sine=P$1$1.sin=function(){var ss,ts,rs=this,ns=rs.constructor;return rs.isFinite()?rs.isZero()?new ns(rs):(ss=ns.precision,ts=ns.rounding,ns.precision=ss+Math.max(rs.e,rs.sd())+LOG_BASE,ns.rounding=1,rs=sine(ns,toLessThanHalfPi(ns,rs)),ns.precision=ss,ns.rounding=ts,finalise(quadrant>2?rs.neg():rs,ss,ts,!0)):new ns(NaN)},P$1$1.squareRoot=P$1$1.sqrt=function(){var ss,ts,rs,ns,is,as,os=this,ls=os.d,us=os.e,cs=os.s,ps=os.constructor;if(cs!==1||!ls||!ls[0])return new ps(!cs||cs<0&&(!ls||ls[0])?NaN:ls?os:1/0);for(external=!1,(cs=Math.sqrt(+os))==0||cs==1/0?(((ts=digitsToString(ls)).length+us)%2==0&&(ts+="0"),cs=Math.sqrt(ts),us=mathfloor((us+1)/2)-(us<0||us%2),ns=new ps(ts=cs==1/0?"5e"+us:(ts=cs.toExponential()).slice(0,ts.indexOf("e")+1)+us)):ns=new ps(cs.toString()),rs=(us=ps.precision)+3;;)if(ns=(as=ns).plus(divide$2(os,as,rs+2,1)).times(.5),digitsToString(as.d).slice(0,rs)===(ts=digitsToString(ns.d)).slice(0,rs)){if((ts=ts.slice(rs-3,rs+1))!="9999"&&(is||ts!="4999")){+ts&&(+ts.slice(1)||ts.charAt(0)!="5")||(finalise(ns,us+1,1),ss=!ns.times(ns).eq(os));break}if(!is&&(finalise(as,us+1,0),as.times(as).eq(os))){ns=as;break}rs+=4,is=1}return external=!0,finalise(ns,us,ps.rounding,ss)},P$1$1.tangent=P$1$1.tan=function(){var ss,ts,rs=this,ns=rs.constructor;return rs.isFinite()?rs.isZero()?new ns(rs):(ss=ns.precision,ts=ns.rounding,ns.precision=ss+10,ns.rounding=1,(rs=rs.sin()).s=1,rs=divide$2(rs,new ns(1).minus(rs.times(rs)).sqrt(),ss+10,0),ns.precision=ss,ns.rounding=ts,finalise(quadrant==2||quadrant==4?rs.neg():rs,ss,ts,!0)):new ns(NaN)},P$1$1.times=P$1$1.mul=function(ss){var ts,rs,ns,is,as,os,ls,us,cs,ps=this,ds=ps.constructor,fs=ps.d,hs=(ss=new ds(ss)).d;if(ss.s*=ps.s,!(fs&&fs[0]&&hs&&hs[0]))return new ds(!ss.s||fs&&!fs[0]&&!hs||hs&&!hs[0]&&!fs?NaN:fs&&hs?0*ss.s:ss.s/0);for(rs=mathfloor(ps.e/LOG_BASE)+mathfloor(ss.e/LOG_BASE),(us=fs.length)<(cs=hs.length)&&(as=fs,fs=hs,hs=as,os=us,us=cs,cs=os),as=[],ns=os=us+cs;ns--;)as.push(0);for(ns=cs;--ns>=0;){for(ts=0,is=us+ns;is>ns;)ls=as[is]+hs[ns]*fs[is-ns-1]+ts,as[is--]=ls%BASE|0,ts=ls/BASE|0;as[is]=(as[is]+ts)%BASE|0}for(;!as[--os];)as.pop();return ts?++rs:as.shift(),ss.d=as,ss.e=getBase10Exponent(as,rs),external?finalise(ss,ds.precision,ds.rounding):ss},P$1$1.toBinary=function(ss,ts){return toStringBinary(this,2,ss,ts)},P$1$1.toDecimalPlaces=P$1$1.toDP=function(ss,ts){var rs=this,ns=rs.constructor;return rs=new ns(rs),ss===void 0?rs:(checkInt32(ss,0,MAX_DIGITS),ts===void 0?ts=ns.rounding:checkInt32(ts,0,8),finalise(rs,ss+rs.e+1,ts))},P$1$1.toExponential=function(ss,ts){var rs,ns=this,is=ns.constructor;return ss===void 0?rs=finiteToString(ns,!0):(checkInt32(ss,0,MAX_DIGITS),ts===void 0?ts=is.rounding:checkInt32(ts,0,8),rs=finiteToString(ns=finalise(new is(ns),ss+1,ts),!0,ss+1)),ns.isNeg()&&!ns.isZero()?"-"+rs:rs},P$1$1.toFixed=function(ss,ts){var rs,ns,is=this,as=is.constructor;return ss===void 0?rs=finiteToString(is):(checkInt32(ss,0,MAX_DIGITS),ts===void 0?ts=as.rounding:checkInt32(ts,0,8),rs=finiteToString(ns=finalise(new as(is),ss+is.e+1,ts),!1,ss+ns.e+1)),is.isNeg()&&!is.isZero()?"-"+rs:rs},P$1$1.toFraction=function(ss){var ts,rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs=this,ys=hs.d,gs=hs.constructor;if(!ys)return new gs(hs);if(cs=rs=new gs(1),ns=us=new gs(0),os=(as=(ts=new gs(ns)).e=getPrecision(ys)-hs.e-1)%LOG_BASE,ts.d[0]=mathpow(10,os<0?LOG_BASE+os:os),ss==null)ss=as>0?ts:cs;else{if(!(ls=new gs(ss)).isInt()||ls.lt(cs))throw Error(invalidArgument+ls);ss=ls.gt(ts)?as>0?ts:cs:ls}for(external=!1,ls=new gs(digitsToString(ys)),ps=gs.precision,gs.precision=as=ys.length*LOG_BASE*2;ds=divide$2(ls,ts,0,1,1),(is=rs.plus(ds.times(ns))).cmp(ss)!=1;)rs=ns,ns=is,is=cs,cs=us.plus(ds.times(is)),us=is,is=ts,ts=ls.minus(ds.times(is)),ls=is;return is=divide$2(ss.minus(rs),ns,0,1,1),us=us.plus(is.times(cs)),rs=rs.plus(is.times(ns)),us.s=cs.s=hs.s,fs=divide$2(cs,ns,as,1).minus(hs).abs().cmp(divide$2(us,rs,as,1).minus(hs).abs())<1?[cs,ns]:[us,rs],gs.precision=ps,external=!0,fs},P$1$1.toHexadecimal=P$1$1.toHex=function(ss,ts){return toStringBinary(this,16,ss,ts)},P$1$1.toNearest=function(ss,ts){var rs=this,ns=rs.constructor;if(rs=new ns(rs),ss==null){if(!rs.d)return rs;ss=new ns(1),ts=ns.rounding}else{if(ss=new ns(ss),ts===void 0?ts=ns.rounding:checkInt32(ts,0,8),!rs.d)return ss.s?rs:ss;if(!ss.d)return ss.s&&(ss.s=rs.s),ss}return ss.d[0]?(external=!1,rs=divide$2(rs,ss,0,ts,1).times(ss),external=!0,finalise(rs)):(ss.s=rs.s,rs=ss),rs},P$1$1.toNumber=function(){return+this},P$1$1.toOctal=function(ss,ts){return toStringBinary(this,8,ss,ts)},P$1$1.toPower=P$1$1.pow=function(ss){var ts,rs,ns,is,as,os,ls=this,us=ls.constructor,cs=+(ss=new us(ss));if(!(ls.d&&ss.d&&ls.d[0]&&ss.d[0]))return new us(mathpow(+ls,cs));if((ls=new us(ls)).eq(1))return ls;if(ns=us.precision,as=us.rounding,ss.eq(1))return finalise(ls,ns,as);if((ts=mathfloor(ss.e/LOG_BASE))>=ss.d.length-1&&(rs=cs<0?-cs:cs)<=MAX_SAFE_INTEGER)return is=intPow(us,ls,rs,ns),ss.s<0?new us(1).div(is):finalise(is,ns,as);if((os=ls.s)<0){if(ts<ss.d.length-1)return new us(NaN);if(!(1&ss.d[ts])&&(os=1),ls.e==0&&ls.d[0]==1&&ls.d.length==1)return ls.s=os,ls}return(ts=(rs=mathpow(+ls,cs))!=0&&isFinite(rs)?new us(rs+"").e:mathfloor(cs*(Math.log("0."+digitsToString(ls.d))/Math.LN10+ls.e+1)))>us.maxE+1||ts<us.minE-1?new us(ts>0?os/0:0):(external=!1,us.rounding=ls.s=1,rs=Math.min(12,(ts+"").length),(is=naturalExponential(ss.times(naturalLogarithm(ls,ns+rs)),ns)).d&&checkRoundingDigits((is=finalise(is,ns+5,1)).d,ns,as)&&(ts=ns+10,+digitsToString((is=finalise(naturalExponential(ss.times(naturalLogarithm(ls,ts+rs)),ts),ts+5,1)).d).slice(ns+1,ns+15)+1==1e14&&(is=finalise(is,ns+1,0))),is.s=os,external=!0,us.rounding=as,finalise(is,ns,as))},P$1$1.toPrecision=function(ss,ts){var rs,ns=this,is=ns.constructor;return ss===void 0?rs=finiteToString(ns,ns.e<=is.toExpNeg||ns.e>=is.toExpPos):(checkInt32(ss,1,MAX_DIGITS),ts===void 0?ts=is.rounding:checkInt32(ts,0,8),rs=finiteToString(ns=finalise(new is(ns),ss,ts),ss<=ns.e||ns.e<=is.toExpNeg,ss)),ns.isNeg()&&!ns.isZero()?"-"+rs:rs},P$1$1.toSignificantDigits=P$1$1.toSD=function(ss,ts){var rs=this.constructor;return ss===void 0?(ss=rs.precision,ts=rs.rounding):(checkInt32(ss,1,MAX_DIGITS),ts===void 0?ts=rs.rounding:checkInt32(ts,0,8)),finalise(new rs(this),ss,ts)},P$1$1.toString=function(){var ss=this,ts=ss.constructor,rs=finiteToString(ss,ss.e<=ts.toExpNeg||ss.e>=ts.toExpPos);return ss.isNeg()&&!ss.isZero()?"-"+rs:rs},P$1$1.truncated=P$1$1.trunc=function(){return finalise(new this.constructor(this),this.e+1,1)},P$1$1.valueOf=P$1$1.toJSON=function(){var ss=this,ts=ss.constructor,rs=finiteToString(ss,ss.e<=ts.toExpNeg||ss.e>=ts.toExpPos);return ss.isNeg()?"-"+rs:rs};var divide$2=function(){function ss(ns,is,as){var os,ls=0,us=ns.length;for(ns=ns.slice();us--;)os=ns[us]*is+ls,ns[us]=os%as|0,ls=os/as|0;return ls&&ns.unshift(ls),ns}function ts(ns,is,as,os){var ls,us;if(as!=os)us=as>os?1:-1;else for(ls=us=0;ls<as;ls++)if(ns[ls]!=is[ls]){us=ns[ls]>is[ls]?1:-1;break}return us}function rs(ns,is,as,os){for(var ls=0;as--;)ns[as]-=ls,ls=ns[as]<is[as]?1:0,ns[as]=ls*os+ns[as]-is[as];for(;!ns[0]&&ns.length>1;)ns.shift()}return function(ns,is,as,os,ls,us){var cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds,Vs,Is,Os=ns.constructor,Ps=ns.s==is.s?1:-1,$s=ns.d,Rs=is.d;if(!($s&&$s[0]&&Rs&&Rs[0]))return new Os(ns.s&&is.s&&($s?!Rs||$s[0]!=Rs[0]:Rs)?$s&&$s[0]==0||!Rs?0*Ps:Ps/0:NaN);for(us?(hs=1,ps=ns.e-is.e):(us=BASE,hs=LOG_BASE,ps=mathfloor(ns.e/hs)-mathfloor(is.e/hs)),Vs=Rs.length,Ss=$s.length,Ns=(vs=new Os(Ps)).d=[],ds=0;Rs[ds]==($s[ds]||0);ds++);if(Rs[ds]>($s[ds]||0)&&ps--,as==null?(As=as=Os.precision,os=Os.rounding):As=ls?as+(ns.e-is.e)+1:as,As<0)Ns.push(1),ys=!0;else{if(As=As/hs+2|0,ds=0,Vs==1){for(fs=0,Rs=Rs[0],As++;(ds<Ss||fs)&&As--;ds++)ws=fs*us+($s[ds]||0),Ns[ds]=ws/Rs|0,fs=ws%Rs|0;ys=fs||ds<Ss}else{for((fs=us/(Rs[0]+1)|0)>1&&(Rs=ss(Rs,fs,us),$s=ss($s,fs,us),Vs=Rs.length,Ss=$s.length),Es=Vs,Cs=(Ts=$s.slice(0,Vs)).length;Cs<Vs;)Ts[Cs++]=0;(Is=Rs.slice()).unshift(0),Ds=Rs[0],Rs[1]>=us/2&&++Ds;do fs=0,(cs=ts(Rs,Ts,Vs,Cs))<0?(xs=Ts[0],Vs!=Cs&&(xs=xs*us+(Ts[1]||0)),(fs=xs/Ds|0)>1?(fs>=us&&(fs=us-1),(cs=ts(gs=ss(Rs,fs,us),Ts,bs=gs.length,Cs=Ts.length))==1&&(fs--,rs(gs,Vs<bs?Is:Rs,bs,us))):(fs==0&&(cs=fs=1),gs=Rs.slice()),(bs=gs.length)<Cs&&gs.unshift(0),rs(Ts,gs,Cs,us),cs==-1&&(cs=ts(Rs,Ts,Vs,Cs=Ts.length))<1&&(fs++,rs(Ts,Vs<Cs?Is:Rs,Cs,us)),Cs=Ts.length):cs===0&&(fs++,Ts=[0]),Ns[ds++]=fs,cs&&Ts[0]?Ts[Cs++]=$s[Es]||0:(Ts=[$s[Es]],Cs=1);while((Es++<Ss||Ts[0]!==void 0)&&As--);ys=Ts[0]!==void 0}Ns[0]||Ns.shift()}if(hs==1)vs.e=ps,inexact=ys;else{for(ds=1,fs=Ns[0];fs>=10;fs/=10)ds++;vs.e=ds+ps*hs-1,finalise(vs,ls?as+vs.e+1:as,os,ys)}return vs}}();function finalise(ss,ts,rs,ns){var is,as,os,ls,us,cs,ps,ds,fs,hs=ss.constructor;e:if(ts!=null){if(!(ds=ss.d))return ss;for(is=1,ls=ds[0];ls>=10;ls/=10)is++;if((as=ts-is)<0)as+=LOG_BASE,os=ts,us=(ps=ds[fs=0])/mathpow(10,is-os-1)%10|0;else if((fs=Math.ceil((as+1)/LOG_BASE))>=(ls=ds.length)){if(!ns)break e;for(;ls++<=fs;)ds.push(0);ps=us=0,is=1,os=(as%=LOG_BASE)-LOG_BASE+1}else{for(ps=ls=ds[fs],is=1;ls>=10;ls/=10)is++;us=(os=(as%=LOG_BASE)-LOG_BASE+is)<0?0:ps/mathpow(10,is-os-1)%10|0}if(ns=ns||ts<0||ds[fs+1]!==void 0||(os<0?ps:ps%mathpow(10,is-os-1)),cs=rs<4?(us||ns)&&(rs==0||rs==(ss.s<0?3:2)):us>5||us==5&&(rs==4||ns||rs==6&&(as>0?os>0?ps/mathpow(10,is-os):0:ds[fs-1])%10&1||rs==(ss.s<0?8:7)),ts<1||!ds[0])return ds.length=0,cs?(ts-=ss.e+1,ds[0]=mathpow(10,(LOG_BASE-ts%LOG_BASE)%LOG_BASE),ss.e=-ts||0):ds[0]=ss.e=0,ss;if(as==0?(ds.length=fs,ls=1,fs--):(ds.length=fs+1,ls=mathpow(10,LOG_BASE-as),ds[fs]=os>0?(ps/mathpow(10,is-os)%mathpow(10,os)|0)*ls:0),cs)for(;;){if(fs==0){for(as=1,os=ds[0];os>=10;os/=10)as++;for(os=ds[0]+=ls,ls=1;os>=10;os/=10)ls++;as!=ls&&(ss.e++,ds[0]==BASE&&(ds[0]=1));break}if(ds[fs]+=ls,ds[fs]!=BASE)break;ds[fs--]=0,ls=1}for(as=ds.length;ds[--as]===0;)ds.pop()}return external&&(ss.e>hs.maxE?(ss.d=null,ss.e=NaN):ss.e<hs.minE&&(ss.e=0,ss.d=[0])),ss}function finiteToString(ss,ts,rs){if(!ss.isFinite())return nonFiniteToString(ss);var ns,is=ss.e,as=digitsToString(ss.d),os=as.length;return ts?(rs&&(ns=rs-os)>0?as=as.charAt(0)+"."+as.slice(1)+getZeroString(ns):os>1&&(as=as.charAt(0)+"."+as.slice(1)),as=as+(ss.e<0?"e":"e+")+ss.e):is<0?(as="0."+getZeroString(-is-1)+as,rs&&(ns=rs-os)>0&&(as+=getZeroString(ns))):is>=os?(as+=getZeroString(is+1-os),rs&&(ns=rs-is-1)>0&&(as=as+"."+getZeroString(ns))):((ns=is+1)<os&&(as=as.slice(0,ns)+"."+as.slice(ns)),rs&&(ns=rs-os)>0&&(is+1===os&&(as+="."),as+=getZeroString(ns))),as}function getBase10Exponent(ss,ts){var rs=ss[0];for(ts*=LOG_BASE;rs>=10;rs/=10)ts++;return ts}function getLn10(ss,ts,rs){if(ts>LN10_PRECISION)throw external=!0,rs&&(ss.precision=rs),Error(precisionLimitExceeded);return finalise(new ss(LN10$1),ts,1,!0)}function getPi(ss,ts,rs){if(ts>PI_PRECISION)throw Error(precisionLimitExceeded);return finalise(new ss(PI$1),ts,rs,!0)}function getPrecision(ss){var ts=ss.length-1,rs=ts*LOG_BASE+1;if(ts=ss[ts]){for(;ts%10==0;ts/=10)rs--;for(ts=ss[0];ts>=10;ts/=10)rs++}return rs}function getZeroString(ss){for(var ts="";ss--;)ts+="0";return ts}function intPow(ss,ts,rs,ns){var is,as=new ss(1),os=Math.ceil(ns/LOG_BASE+4);for(external=!1;;){if(rs%2&&truncate((as=as.times(ts)).d,os)&&(is=!0),(rs=mathfloor(rs/2))===0){rs=as.d.length-1,is&&as.d[rs]===0&&++as.d[rs];break}truncate((ts=ts.times(ts)).d,os)}return external=!0,as}function isOdd(ss){return 1&ss.d[ss.d.length-1]}function maxOrMin(ss,ts,rs){for(var ns,is=new ss(ts[0]),as=0;++as<ts.length;){if(!(ns=new ss(ts[as])).s){is=ns;break}is[rs](ns)&&(is=ns)}return is}function naturalExponential(ss,ts){var rs,ns,is,as,os,ls,us,cs=0,ps=0,ds=0,fs=ss.constructor,hs=fs.rounding,ys=fs.precision;if(!ss.d||!ss.d[0]||ss.e>17)return new fs(ss.d?ss.d[0]?ss.s<0?0:1/0:1:ss.s?ss.s<0?0:ss:NaN);for(ts==null?(external=!1,us=ys):us=ts,ls=new fs(.03125);ss.e>-2;)ss=ss.times(ls),ds+=5;for(us+=ns=Math.log(mathpow(2,ds))/Math.LN10*2+5|0,rs=as=os=new fs(1),fs.precision=us;;){if(as=finalise(as.times(ss),us,1),rs=rs.times(++ps),digitsToString((ls=os.plus(divide$2(as,rs,us,1))).d).slice(0,us)===digitsToString(os.d).slice(0,us)){for(is=ds;is--;)os=finalise(os.times(os),us,1);if(ts!=null)return fs.precision=ys,os;if(!(cs<3&&checkRoundingDigits(os.d,us-ns,hs,cs)))return finalise(os,fs.precision=ys,hs,external=!0);fs.precision=us+=10,rs=as=ls=new fs(1),ps=0,cs++}os=ls}}function naturalLogarithm(ss,ts){var rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs=1,ys=ss,gs=ys.d,bs=ys.constructor,vs=bs.rounding,Ns=bs.precision;if(ys.s<0||!gs||!gs[0]||!ys.e&&gs[0]==1&&gs.length==1)return new bs(gs&&!gs[0]?-1/0:ys.s!=1?NaN:gs?0:ys);if(ts==null?(external=!1,ps=Ns):ps=ts,bs.precision=ps+=10,ns=(rs=digitsToString(gs)).charAt(0),!(Math.abs(as=ys.e)<15e14))return cs=getLn10(bs,ps+2,Ns).times(as+""),ys=naturalLogarithm(new bs(ns+"."+rs.slice(1)),ps-10).plus(cs),bs.precision=Ns,ts==null?finalise(ys,Ns,vs,external=!0):ys;for(;ns<7&&ns!=1||ns==1&&rs.charAt(1)>3;)ns=(rs=digitsToString((ys=ys.times(ss)).d)).charAt(0),hs++;for(as=ys.e,ns>1?(ys=new bs("0."+rs),as++):ys=new bs(ns+"."+rs.slice(1)),ds=ys,us=os=ys=divide$2(ys.minus(1),ys.plus(1),ps,1),fs=finalise(ys.times(ys),ps,1),is=3;;){if(os=finalise(os.times(fs),ps,1),digitsToString((cs=us.plus(divide$2(os,new bs(is),ps,1))).d).slice(0,ps)===digitsToString(us.d).slice(0,ps)){if(us=us.times(2),as!==0&&(us=us.plus(getLn10(bs,ps+2,Ns).times(as+""))),us=divide$2(us,new bs(hs),ps,1),ts!=null)return bs.precision=Ns,us;if(!checkRoundingDigits(us.d,ps-10,vs,ls))return finalise(us,bs.precision=Ns,vs,external=!0);bs.precision=ps+=10,cs=os=ys=divide$2(ds.minus(1),ds.plus(1),ps,1),fs=finalise(ys.times(ys),ps,1),is=ls=1}us=cs,is+=2}}function nonFiniteToString(ss){return String(ss.s*ss.s/0)}function parseDecimal(ss,ts){var rs,ns,is;for((rs=ts.indexOf("."))>-1&&(ts=ts.replace(".","")),(ns=ts.search(/e/i))>0?(rs<0&&(rs=ns),rs+=+ts.slice(ns+1),ts=ts.substring(0,ns)):rs<0&&(rs=ts.length),ns=0;ts.charCodeAt(ns)===48;ns++);for(is=ts.length;ts.charCodeAt(is-1)===48;--is);if(ts=ts.slice(ns,is)){if(is-=ns,ss.e=rs=rs-ns-1,ss.d=[],ns=(rs+1)%LOG_BASE,rs<0&&(ns+=LOG_BASE),ns<is){for(ns&&ss.d.push(+ts.slice(0,ns)),is-=LOG_BASE;ns<is;)ss.d.push(+ts.slice(ns,ns+=LOG_BASE));ts=ts.slice(ns),ns=LOG_BASE-ts.length}else ns-=is;for(;ns--;)ts+="0";ss.d.push(+ts),external&&(ss.e>ss.constructor.maxE?(ss.d=null,ss.e=NaN):ss.e<ss.constructor.minE&&(ss.e=0,ss.d=[0]))}else ss.e=0,ss.d=[0];return ss}function parseOther(ss,ts){var rs,ns,is,as,os,ls,us,cs,ps;if(ts.indexOf("_")>-1){if(ts=ts.replace(/(\d)_(?=\d)/g,"$1"),isDecimal.test(ts))return parseDecimal(ss,ts)}else if(ts==="Infinity"||ts==="NaN")return+ts||(ss.s=NaN),ss.e=NaN,ss.d=null,ss;if(isHex.test(ts))rs=16,ts=ts.toLowerCase();else if(isBinary.test(ts))rs=2;else{if(!isOctal.test(ts))throw Error(invalidArgument+ts);rs=8}for((as=ts.search(/p/i))>0?(us=+ts.slice(as+1),ts=ts.substring(2,as)):ts=ts.slice(2),os=(as=ts.indexOf("."))>=0,ns=ss.constructor,os&&(as=(ls=(ts=ts.replace(".","")).length)-as,is=intPow(ns,new ns(rs),as,2*as)),as=ps=(cs=convertBase(ts,rs,BASE)).length-1;cs[as]===0;--as)cs.pop();return as<0?new ns(0*ss.s):(ss.e=getBase10Exponent(cs,ps),ss.d=cs,external=!1,os&&(ss=divide$2(ss,is,4*ls)),us&&(ss=ss.times(Math.abs(us)<54?mathpow(2,us):Decimal.pow(2,us))),external=!0,ss)}function sine(ss,ts){var rs,ns=ts.d.length;if(ns<3)return ts.isZero()?ts:taylorSeries(ss,2,ts,ts);rs=(rs=1.4*Math.sqrt(ns))>16?16:0|rs,ts=taylorSeries(ss,2,ts=ts.times(1/tinyPow(5,rs)),ts);for(var is,as=new ss(5),os=new ss(16),ls=new ss(20);rs--;)is=ts.times(ts),ts=ts.times(as.plus(is.times(os.times(is).minus(ls))));return ts}function taylorSeries(ss,ts,rs,ns,is){var as,os,ls,us,cs=ss.precision,ps=Math.ceil(cs/LOG_BASE);for(external=!1,us=rs.times(rs),ls=new ss(ns);;){if(os=divide$2(ls.times(us),new ss(ts++*ts++),cs,1),ls=is?ns.plus(os):ns.minus(os),ns=divide$2(os.times(us),new ss(ts++*ts++),cs,1),(os=ls.plus(ns)).d[ps]!==void 0){for(as=ps;os.d[as]===ls.d[as]&&as--;);if(as==-1)break}as=ls,ls=ns,ns=os,os=as}return external=!0,os.d.length=ps+1,os}function tinyPow(ss,ts){for(var rs=ss;--ts;)rs*=ss;return rs}function toLessThanHalfPi(ss,ts){var rs,ns=ts.s<0,is=getPi(ss,ss.precision,1),as=is.times(.5);if((ts=ts.abs()).lte(as))return quadrant=ns?4:1,ts;if((rs=ts.divToInt(is)).isZero())quadrant=ns?3:2;else{if((ts=ts.minus(rs.times(is))).lte(as))return quadrant=isOdd(rs)?ns?2:3:ns?4:1,ts;quadrant=isOdd(rs)?ns?1:4:ns?3:2}return ts.minus(is).abs()}function toStringBinary(ss,ts,rs,ns){var is,as,os,ls,us,cs,ps,ds,fs,hs=ss.constructor,ys=rs!==void 0;if(ys?(checkInt32(rs,1,MAX_DIGITS),ns===void 0?ns=hs.rounding:checkInt32(ns,0,8)):(rs=hs.precision,ns=hs.rounding),ss.isFinite()){for(ys?(is=2,ts==16?rs=4*rs-3:ts==8&&(rs=3*rs-2)):is=ts,(os=(ps=finiteToString(ss)).indexOf("."))>=0&&(ps=ps.replace(".",""),(fs=new hs(1)).e=ps.length-os,fs.d=convertBase(finiteToString(fs),10,is),fs.e=fs.d.length),as=us=(ds=convertBase(ps,10,is)).length;ds[--us]==0;)ds.pop();if(ds[0]){if(os<0?as--:((ss=new hs(ss)).d=ds,ss.e=as,ds=(ss=divide$2(ss,fs,rs,ns,0,is)).d,as=ss.e,cs=inexact),os=ds[rs],ls=is/2,cs=cs||ds[rs+1]!==void 0,cs=ns<4?(os!==void 0||cs)&&(ns===0||ns===(ss.s<0?3:2)):os>ls||os===ls&&(ns===4||cs||ns===6&&1&ds[rs-1]||ns===(ss.s<0?8:7)),ds.length=rs,cs)for(;++ds[--rs]>is-1;)ds[rs]=0,rs||(++as,ds.unshift(1));for(us=ds.length;!ds[us-1];--us);for(os=0,ps="";os<us;os++)ps+=NUMERALS.charAt(ds[os]);if(ys){if(us>1)if(ts==16||ts==8){for(os=ts==16?4:3,--us;us%os;us++)ps+="0";for(us=(ds=convertBase(ps,is,ts)).length;!ds[us-1];--us);for(os=1,ps="1.";os<us;os++)ps+=NUMERALS.charAt(ds[os])}else ps=ps.charAt(0)+"."+ps.slice(1);ps=ps+(as<0?"p":"p+")+as}else if(as<0){for(;++as;)ps="0"+ps;ps="0."+ps}else if(++as>us)for(as-=us;as--;)ps+="0";else as<us&&(ps=ps.slice(0,as)+"."+ps.slice(as))}else ps=ys?"0p+0":"0";ps=(ts==16?"0x":ts==2?"0b":ts==8?"0o":"")+ps}else ps=nonFiniteToString(ss);return ss.s<0?"-"+ps:ps}function truncate(ss,ts){if(ss.length>ts)return ss.length=ts,!0}function abs$2(ss){return new this(ss).abs()}function acos$2(ss){return new this(ss).acos()}function acosh$2(ss){return new this(ss).acosh()}function add$2(ss,ts){return new this(ss).plus(ts)}function asin$2(ss){return new this(ss).asin()}function asinh$2(ss){return new this(ss).asinh()}function atan$2(ss){return new this(ss).atan()}function atanh$2(ss){return new this(ss).atanh()}function atan2$2(ss,ts){ss=new this(ss),ts=new this(ts);var rs,ns=this.precision,is=this.rounding,as=ns+4;return ss.s&&ts.s?ss.d||ts.d?!ts.d||ss.isZero()?(rs=ts.s<0?getPi(this,ns,is):new this(0)).s=ss.s:!ss.d||ts.isZero()?(rs=getPi(this,as,1).times(.5)).s=ss.s:ts.s<0?(this.precision=as,this.rounding=1,rs=this.atan(divide$2(ss,ts,as,1)),ts=getPi(this,as,1),this.precision=ns,this.rounding=is,rs=ss.s<0?rs.minus(ts):rs.plus(ts)):rs=this.atan(divide$2(ss,ts,as,1)):(rs=getPi(this,as,1).times(ts.s>0?.25:.75)).s=ss.s:rs=new this(NaN),rs}function cbrt$1(ss){return new this(ss).cbrt()}function ceil$1(ss){return finalise(ss=new this(ss),ss.e+1,2)}function clamp$1(ss,ts,rs){return new this(ss).clamp(ts,rs)}function config$1(ss){if(!ss||typeof ss!="object")throw Error(decimalError+"Object expected");var ts,rs,ns,is=ss.defaults===!0,as=["precision",1,MAX_DIGITS,"rounding",0,8,"toExpNeg",-EXP_LIMIT,0,"toExpPos",0,EXP_LIMIT,"maxE",0,EXP_LIMIT,"minE",-EXP_LIMIT,0,"modulo",0,9];for(ts=0;ts<as.length;ts+=3)if(rs=as[ts],is&&(this[rs]=DEFAULTS$1[rs]),(ns=ss[rs])!==void 0){if(!(mathfloor(ns)===ns&&ns>=as[ts+1]&&ns<=as[ts+2]))throw Error(invalidArgument+rs+": "+ns);this[rs]=ns}if(rs="crypto",is&&(this[rs]=DEFAULTS$1[rs]),(ns=ss[rs])!==void 0){if(ns!==!0&&ns!==!1&&ns!==0&&ns!==1)throw Error(invalidArgument+rs+": "+ns);if(ns){if(typeof crypto>"u"||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(cryptoUnavailable);this[rs]=!0}else this[rs]=!1}return this}function cos$2(ss){return new this(ss).cos()}function cosh$2(ss){return new this(ss).cosh()}function clone$2(ss){var ts,rs,ns;function is(as){var os,ls,us,cs=this;if(!(cs instanceof is))return new is(as);if(cs.constructor=is,isDecimalInstance(as))return cs.s=as.s,void(external?!as.d||as.e>is.maxE?(cs.e=NaN,cs.d=null):as.e<is.minE?(cs.e=0,cs.d=[0]):(cs.e=as.e,cs.d=as.d.slice()):(cs.e=as.e,cs.d=as.d?as.d.slice():as.d));if((us=typeof as)=="number"){if(as===0)return cs.s=1/as<0?-1:1,cs.e=0,void(cs.d=[0]);if(as<0?(as=-as,cs.s=-1):cs.s=1,as===~~as&&as<1e7){for(os=0,ls=as;ls>=10;ls/=10)os++;return void(external?os>is.maxE?(cs.e=NaN,cs.d=null):os<is.minE?(cs.e=0,cs.d=[0]):(cs.e=os,cs.d=[as]):(cs.e=os,cs.d=[as]))}return 0*as!=0?(as||(cs.s=NaN),cs.e=NaN,void(cs.d=null)):parseDecimal(cs,as.toString())}if(us!=="string")throw Error(invalidArgument+as);return(ls=as.charCodeAt(0))===45?(as=as.slice(1),cs.s=-1):(ls===43&&(as=as.slice(1)),cs.s=1),isDecimal.test(as)?parseDecimal(cs,as):parseOther(cs,as)}if(is.prototype=P$1$1,is.ROUND_UP=0,is.ROUND_DOWN=1,is.ROUND_CEIL=2,is.ROUND_FLOOR=3,is.ROUND_HALF_UP=4,is.ROUND_HALF_DOWN=5,is.ROUND_HALF_EVEN=6,is.ROUND_HALF_CEIL=7,is.ROUND_HALF_FLOOR=8,is.EUCLID=9,is.config=is.set=config$1,is.clone=clone$2,is.isDecimal=isDecimalInstance,is.abs=abs$2,is.acos=acos$2,is.acosh=acosh$2,is.add=add$2,is.asin=asin$2,is.asinh=asinh$2,is.atan=atan$2,is.atanh=atanh$2,is.atan2=atan2$2,is.cbrt=cbrt$1,is.ceil=ceil$1,is.clamp=clamp$1,is.cos=cos$2,is.cosh=cosh$2,is.div=div$1,is.exp=exp$2,is.floor=floor$1,is.hypot=hypot$1,is.ln=ln$2,is.log=log$2,is.log10=log10$2,is.log2=log2$1,is.max=max$2,is.min=min$2,is.mod=mod$2,is.mul=mul$1,is.pow=pow$2,is.random=random$2,is.round=round$2,is.sign=sign$2,is.sin=sin$2,is.sinh=sinh$2,is.sqrt=sqrt$2,is.sub=sub$1,is.sum=sum$1,is.tan=tan$2,is.tanh=tanh$2,is.trunc=trunc,ss===void 0&&(ss={}),ss&&ss.defaults!==!0)for(ns=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],ts=0;ts<ns.length;)ss.hasOwnProperty(rs=ns[ts++])||(ss[rs]=this[rs]);return is.config(ss),is}function div$1(ss,ts){return new this(ss).div(ts)}function exp$2(ss){return new this(ss).exp()}function floor$1(ss){return finalise(ss=new this(ss),ss.e+1,3)}function hypot$1(){var ss,ts,rs=new this(0);for(external=!1,ss=0;ss<arguments.length;)if((ts=new this(arguments[ss++])).d)rs.d&&(rs=rs.plus(ts.times(ts)));else{if(ts.s)return external=!0,new this(1/0);rs=ts}return external=!0,rs.sqrt()}function isDecimalInstance(ss){return ss instanceof Decimal||ss&&ss.toStringTag===tag||!1}function ln$2(ss){return new this(ss).ln()}function log$2(ss,ts){return new this(ss).log(ts)}function log2$1(ss){return new this(ss).log(2)}function log10$2(ss){return new this(ss).log(10)}function max$2(){return maxOrMin(this,arguments,"lt")}function min$2(){return maxOrMin(this,arguments,"gt")}function mod$2(ss,ts){return new this(ss).mod(ts)}function mul$1(ss,ts){return new this(ss).mul(ts)}function pow$2(ss,ts){return new this(ss).pow(ts)}function random$2(ss){var ts,rs,ns,is,as=0,os=new this(1),ls=[];if(ss===void 0?ss=this.precision:checkInt32(ss,1,MAX_DIGITS),ns=Math.ceil(ss/LOG_BASE),this.crypto)if(crypto.getRandomValues)for(ts=crypto.getRandomValues(new Uint32Array(ns));as<ns;)(is=ts[as])>=429e7?ts[as]=crypto.getRandomValues(new Uint32Array(1))[0]:ls[as++]=is%1e7;else{if(!crypto.randomBytes)throw Error(cryptoUnavailable);for(ts=crypto.randomBytes(ns*=4);as<ns;)(is=ts[as]+(ts[as+1]<<8)+(ts[as+2]<<16)+((127&ts[as+3])<<24))>=214e7?crypto.randomBytes(4).copy(ts,as):(ls.push(is%1e7),as+=4);as=ns/4}else for(;as<ns;)ls[as++]=1e7*Math.random()|0;for(ns=ls[--as],ss%=LOG_BASE,ns&&ss&&(is=mathpow(10,LOG_BASE-ss),ls[as]=(ns/is|0)*is);ls[as]===0;as--)ls.pop();if(as<0)rs=0,ls=[0];else{for(rs=-1;ls[0]===0;rs-=LOG_BASE)ls.shift();for(ns=1,is=ls[0];is>=10;is/=10)ns++;ns<LOG_BASE&&(rs-=LOG_BASE-ns)}return os.e=rs,os.d=ls,os}function round$2(ss){return finalise(ss=new this(ss),ss.e+1,this.rounding)}function sign$2(ss){return(ss=new this(ss)).d?ss.d[0]?ss.s:0*ss.s:ss.s||NaN}function sin$2(ss){return new this(ss).sin()}function sinh$2(ss){return new this(ss).sinh()}function sqrt$2(ss){return new this(ss).sqrt()}function sub$1(ss,ts){return new this(ss).sub(ts)}function sum$1(){var ss=0,ts=arguments,rs=new this(ts[ss]);for(external=!1;rs.s&&++ss<ts.length;)rs=rs.plus(ts[ss]);return external=!0,finalise(rs,this.precision,this.rounding)}function tan$2(ss){return new this(ss).tan()}function tanh$2(ss){return new this(ss).tanh()}function trunc(ss){return finalise(ss=new this(ss),ss.e+1,1)}P$1$1[Symbol.for("nodejs.util.inspect.custom")]=P$1$1.toString,P$1$1[Symbol.toStringTag]="Decimal";var Decimal=P$1$1.constructor=clone$2(DEFAULTS$1);LN10$1=new Decimal(LN10$1),PI$1=new Decimal(PI$1);var name$4B="BigNumber",dependencies$4B=["?on","config"],createBigNumberClass=factory(name$4B,dependencies$4B,ss=>{var{on:ts,config:rs}=ss,ns=Decimal.clone({precision:rs.precision,modulo:Decimal.EUCLID});return ns.prototype=Object.create(ns.prototype),ns.prototype.type="BigNumber",ns.prototype.isBigNumber=!0,ns.prototype.toJSON=function(){return{mathjs:"BigNumber",value:this.toString()}},ns.fromJSON=function(is){return new ns(is.value)},ts&&ts("config",function(is,as){is.precision!==as.precision&&ns.config({precision:is.precision})}),ns},{isClass:!0}),complex$1={exports:{}},module;/**
 * @license Complex.js v2.1.1 12/05/2020
 *
 * Copyright (c) 2020, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/module=complex$1,function(ss){var ts=Math.cosh||function(ls){return Math.abs(ls)<1e-9?1-ls:.5*(Math.exp(ls)+Math.exp(-ls))},rs=Math.sinh||function(ls){return Math.abs(ls)<1e-9?ls:.5*(Math.exp(ls)-Math.exp(-ls))},ns=function(){throw SyntaxError("Invalid Param")};function is(ls,us){var cs=Math.abs(ls),ps=Math.abs(us);return ls===0?Math.log(ps):us===0?Math.log(cs):cs<3e3&&ps<3e3?.5*Math.log(ls*ls+us*us):(ls/=2,us/=2,.5*Math.log(ls*ls+us*us)+Math.LN2)}var as=function(ls,us){var cs={re:0,im:0};if(ls==null)cs.re=cs.im=0;else if(us!==void 0)cs.re=ls,cs.im=us;else switch(typeof ls){case"object":if("im"in ls&&"re"in ls)cs.re=ls.re,cs.im=ls.im;else if("abs"in ls&&"arg"in ls){if(!Number.isFinite(ls.abs)&&Number.isFinite(ls.arg))return os.INFINITY;cs.re=ls.abs*Math.cos(ls.arg),cs.im=ls.abs*Math.sin(ls.arg)}else if("r"in ls&&"phi"in ls){if(!Number.isFinite(ls.r)&&Number.isFinite(ls.phi))return os.INFINITY;cs.re=ls.r*Math.cos(ls.phi),cs.im=ls.r*Math.sin(ls.phi)}else ls.length===2?(cs.re=ls[0],cs.im=ls[1]):ns();break;case"string":cs.im=cs.re=0;var ps=ls.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),ds=1,fs=0;ps===null&&ns();for(var hs=0;hs<ps.length;hs++){var ys=ps[hs];ys===" "||ys==="	"||ys===`
`||(ys==="+"?ds++:ys==="-"?fs++:ys==="i"||ys==="I"?(ds+fs===0&&ns(),ps[hs+1]===" "||isNaN(ps[hs+1])?cs.im+=parseFloat((fs%2?"-":"")+"1"):(cs.im+=parseFloat((fs%2?"-":"")+ps[hs+1]),hs++),ds=fs=0):((ds+fs===0||isNaN(ys))&&ns(),ps[hs+1]==="i"||ps[hs+1]==="I"?(cs.im+=parseFloat((fs%2?"-":"")+ys),hs++):cs.re+=parseFloat((fs%2?"-":"")+ys),ds=fs=0))}ds+fs>0&&ns();break;case"number":cs.im=0,cs.re=ls;break;default:ns()}return isNaN(cs.re)||isNaN(cs.im),cs};function os(ls,us){if(!(this instanceof os))return new os(ls,us);var cs=as(ls,us);this.re=cs.re,this.im=cs.im}os.prototype={re:0,im:0,sign:function(){var ls=this.abs();return new os(this.re/ls,this.im/ls)},add:function(ls,us){var cs=new os(ls,us);return this.isInfinite()&&cs.isInfinite()?os.NAN:this.isInfinite()||cs.isInfinite()?os.INFINITY:new os(this.re+cs.re,this.im+cs.im)},sub:function(ls,us){var cs=new os(ls,us);return this.isInfinite()&&cs.isInfinite()?os.NAN:this.isInfinite()||cs.isInfinite()?os.INFINITY:new os(this.re-cs.re,this.im-cs.im)},mul:function(ls,us){var cs=new os(ls,us);return this.isInfinite()&&cs.isZero()||this.isZero()&&cs.isInfinite()?os.NAN:this.isInfinite()||cs.isInfinite()?os.INFINITY:cs.im===0&&this.im===0?new os(this.re*cs.re,0):new os(this.re*cs.re-this.im*cs.im,this.re*cs.im+this.im*cs.re)},div:function(ls,us){var cs=new os(ls,us);if(this.isZero()&&cs.isZero()||this.isInfinite()&&cs.isInfinite())return os.NAN;if(this.isInfinite()||cs.isZero())return os.INFINITY;if(this.isZero()||cs.isInfinite())return os.ZERO;ls=this.re,us=this.im;var ps,ds,fs=cs.re,hs=cs.im;return hs===0?new os(ls/fs,us/fs):Math.abs(fs)<Math.abs(hs)?new os((ls*(ds=fs/hs)+us)/(ps=fs*ds+hs),(us*ds-ls)/ps):new os((ls+us*(ds=hs/fs))/(ps=hs*ds+fs),(us-ls*ds)/ps)},pow:function(ls,us){var cs=new os(ls,us);if(ls=this.re,us=this.im,cs.isZero())return os.ONE;if(cs.im===0){if(us===0&&ls>0)return new os(Math.pow(ls,cs.re),0);if(ls===0)switch((cs.re%4+4)%4){case 0:return new os(Math.pow(us,cs.re),0);case 1:return new os(0,Math.pow(us,cs.re));case 2:return new os(-Math.pow(us,cs.re),0);case 3:return new os(0,-Math.pow(us,cs.re))}}if(ls===0&&us===0&&cs.re>0&&cs.im>=0)return os.ZERO;var ps=Math.atan2(us,ls),ds=is(ls,us);return ls=Math.exp(cs.re*ds-cs.im*ps),us=cs.im*ds+cs.re*ps,new os(ls*Math.cos(us),ls*Math.sin(us))},sqrt:function(){var ls,us,cs=this.re,ps=this.im,ds=this.abs();if(cs>=0){if(ps===0)return new os(Math.sqrt(cs),0);ls=.5*Math.sqrt(2*(ds+cs))}else ls=Math.abs(ps)/Math.sqrt(2*(ds-cs));return us=cs<=0?.5*Math.sqrt(2*(ds-cs)):Math.abs(ps)/Math.sqrt(2*(ds+cs)),new os(ls,ps<0?-us:us)},exp:function(){var ls=Math.exp(this.re);return this.im,new os(ls*Math.cos(this.im),ls*Math.sin(this.im))},expm1:function(){var ls=this.re,us=this.im;return new os(Math.expm1(ls)*Math.cos(us)+function(cs){var ps=Math.PI/4;if(-ps>cs||cs>ps)return Math.cos(cs)-1;var ds=cs*cs;return ds*(ds*(ds*(ds*(ds*(ds*(ds*(ds/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-.5)}(us),Math.exp(ls)*Math.sin(us))},log:function(){var ls=this.re,us=this.im;return new os(is(ls,us),Math.atan2(us,ls))},abs:function(){return function(ls,us){var cs=Math.abs(ls),ps=Math.abs(us);return cs<3e3&&ps<3e3?Math.sqrt(cs*cs+ps*ps):(cs<ps?(cs=ps,ps=ls/us):ps=us/ls,cs*Math.sqrt(1+ps*ps))}(this.re,this.im)},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var ls=this.re,us=this.im;return new os(Math.sin(ls)*ts(us),Math.cos(ls)*rs(us))},cos:function(){var ls=this.re,us=this.im;return new os(Math.cos(ls)*ts(us),-Math.sin(ls)*rs(us))},tan:function(){var ls=2*this.re,us=2*this.im,cs=Math.cos(ls)+ts(us);return new os(Math.sin(ls)/cs,rs(us)/cs)},cot:function(){var ls=2*this.re,us=2*this.im,cs=Math.cos(ls)-ts(us);return new os(-Math.sin(ls)/cs,rs(us)/cs)},sec:function(){var ls=this.re,us=this.im,cs=.5*ts(2*us)+.5*Math.cos(2*ls);return new os(Math.cos(ls)*ts(us)/cs,Math.sin(ls)*rs(us)/cs)},csc:function(){var ls=this.re,us=this.im,cs=.5*ts(2*us)-.5*Math.cos(2*ls);return new os(Math.sin(ls)*ts(us)/cs,-Math.cos(ls)*rs(us)/cs)},asin:function(){var ls=this.re,us=this.im,cs=new os(us*us-ls*ls+1,-2*ls*us).sqrt(),ps=new os(cs.re-us,cs.im+ls).log();return new os(ps.im,-ps.re)},acos:function(){var ls=this.re,us=this.im,cs=new os(us*us-ls*ls+1,-2*ls*us).sqrt(),ps=new os(cs.re-us,cs.im+ls).log();return new os(Math.PI/2-ps.im,ps.re)},atan:function(){var ls=this.re,us=this.im;if(ls===0){if(us===1)return new os(0,1/0);if(us===-1)return new os(0,-1/0)}var cs=ls*ls+(1-us)*(1-us),ps=new os((1-us*us-ls*ls)/cs,-2*ls/cs).log();return new os(-.5*ps.im,.5*ps.re)},acot:function(){var ls=this.re,us=this.im;if(us===0)return new os(Math.atan2(1,ls),0);var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).atan():new os(ls!==0?ls/0:0,us!==0?-us/0:0).atan()},asec:function(){var ls=this.re,us=this.im;if(ls===0&&us===0)return new os(0,1/0);var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).acos():new os(ls!==0?ls/0:0,us!==0?-us/0:0).acos()},acsc:function(){var ls=this.re,us=this.im;if(ls===0&&us===0)return new os(Math.PI/2,1/0);var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).asin():new os(ls!==0?ls/0:0,us!==0?-us/0:0).asin()},sinh:function(){var ls=this.re,us=this.im;return new os(rs(ls)*Math.cos(us),ts(ls)*Math.sin(us))},cosh:function(){var ls=this.re,us=this.im;return new os(ts(ls)*Math.cos(us),rs(ls)*Math.sin(us))},tanh:function(){var ls=2*this.re,us=2*this.im,cs=ts(ls)+Math.cos(us);return new os(rs(ls)/cs,Math.sin(us)/cs)},coth:function(){var ls=2*this.re,us=2*this.im,cs=ts(ls)-Math.cos(us);return new os(rs(ls)/cs,-Math.sin(us)/cs)},csch:function(){var ls=this.re,us=this.im,cs=Math.cos(2*us)-ts(2*ls);return new os(-2*rs(ls)*Math.cos(us)/cs,2*ts(ls)*Math.sin(us)/cs)},sech:function(){var ls=this.re,us=this.im,cs=Math.cos(2*us)+ts(2*ls);return new os(2*ts(ls)*Math.cos(us)/cs,-2*rs(ls)*Math.sin(us)/cs)},asinh:function(){var ls=this.im;this.im=-this.re,this.re=ls;var us=this.asin();return this.re=-this.im,this.im=ls,ls=us.re,us.re=-us.im,us.im=ls,us},acosh:function(){var ls=this.acos();if(ls.im<=0){var us=ls.re;ls.re=-ls.im,ls.im=us}else us=ls.im,ls.im=-ls.re,ls.re=us;return ls},atanh:function(){var ls=this.re,us=this.im,cs=ls>1&&us===0,ps=1-ls,ds=1+ls,fs=ps*ps+us*us,hs=fs!==0?new os((ds*ps-us*us)/fs,(us*ps+ds*us)/fs):new os(ls!==-1?ls/0:0,us!==0?us/0:0),ys=hs.re;return hs.re=is(hs.re,hs.im)/2,hs.im=Math.atan2(hs.im,ys)/2,cs&&(hs.im=-hs.im),hs},acoth:function(){var ls=this.re,us=this.im;if(ls===0&&us===0)return new os(0,Math.PI/2);var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).atanh():new os(ls!==0?ls/0:0,us!==0?-us/0:0).atanh()},acsch:function(){var ls=this.re,us=this.im;if(us===0)return new os(ls!==0?Math.log(ls+Math.sqrt(ls*ls+1)):1/0,0);var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).asinh():new os(ls!==0?ls/0:0,us!==0?-us/0:0).asinh()},asech:function(){var ls=this.re,us=this.im;if(this.isZero())return os.INFINITY;var cs=ls*ls+us*us;return cs!==0?new os(ls/cs,-us/cs).acosh():new os(ls!==0?ls/0:0,us!==0?-us/0:0).acosh()},inverse:function(){if(this.isZero())return os.INFINITY;if(this.isInfinite())return os.ZERO;var ls=this.re,us=this.im,cs=ls*ls+us*us;return new os(ls/cs,-us/cs)},conjugate:function(){return new os(this.re,-this.im)},neg:function(){return new os(-this.re,-this.im)},ceil:function(ls){return ls=Math.pow(10,ls||0),new os(Math.ceil(this.re*ls)/ls,Math.ceil(this.im*ls)/ls)},floor:function(ls){return ls=Math.pow(10,ls||0),new os(Math.floor(this.re*ls)/ls,Math.floor(this.im*ls)/ls)},round:function(ls){return ls=Math.pow(10,ls||0),new os(Math.round(this.re*ls)/ls,Math.round(this.im*ls)/ls)},equals:function(ls,us){var cs=new os(ls,us);return Math.abs(cs.re-this.re)<=os.EPSILON&&Math.abs(cs.im-this.im)<=os.EPSILON},clone:function(){return new os(this.re,this.im)},toString:function(){var ls=this.re,us=this.im,cs="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(ls)<os.EPSILON&&(ls=0),Math.abs(us)<os.EPSILON&&(us=0),us===0?cs+ls:(ls!==0?(cs+=ls,cs+=" ",us<0?(us=-us,cs+="-"):cs+="+",cs+=" "):us<0&&(us=-us,cs+="-"),us!==1&&(cs+=us),cs+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return this.im===0?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return this.im===0&&this.re===0},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},os.ZERO=new os(0,0),os.ONE=new os(1,0),os.I=new os(0,1),os.PI=new os(Math.PI,0),os.E=new os(Math.E,0),os.INFINITY=new os(1/0,1/0),os.NAN=new os(NaN,NaN),os.EPSILON=1e-15,Object.defineProperty(os,"__esModule",{value:!0}),os.default=os,os.Complex=os,module.exports=os}();var Complex$1=getDefaultExportFromCjs$1(complex$1.exports),name$4A="Complex",dependencies$4A=[],createComplexClass=factory(name$4A,dependencies$4A,()=>(Complex$1.prototype.type="Complex",Complex$1.prototype.isComplex=!0,Complex$1.prototype.toJSON=function(){return{mathjs:"Complex",re:this.re,im:this.im}},Complex$1.prototype.toPolar=function(){return{r:this.abs(),phi:this.arg()}},Complex$1.prototype.format=function(ss){var ts=this.im,rs=this.re,ns=format$3(this.re,ss),is=format$3(this.im,ss),as=isNumber$1(ss)?ss:ss?ss.precision:null;if(as!==null){var os=Math.pow(10,-as);Math.abs(rs/ts)<os&&(rs=0),Math.abs(ts/rs)<os&&(ts=0)}return ts===0?ns:rs===0?ts===1?"i":ts===-1?"-i":is+"i":ts<0?ts===-1?ns+" - i":ns+" - "+is.substring(1)+"i":ts===1?ns+" + i":ns+" + "+is+"i"},Complex$1.fromPolar=function(ss){switch(arguments.length){case 1:var ts=arguments[0];if(typeof ts=="object")return Complex$1(ts);throw new TypeError("Input has to be an object with r and phi keys.");case 2:var rs=arguments[0],ns=arguments[1];if(isNumber$1(rs)){if(isUnit(ns)&&ns.hasBase("ANGLE")&&(ns=ns.toNumber("rad")),isNumber$1(ns))return new Complex$1({r:rs,phi:ns});throw new TypeError("Phi is not a number nor an angle unit.")}throw new TypeError("Radius r is not a number.");default:throw new SyntaxError("Wrong number of arguments in function fromPolar")}},Complex$1.prototype.valueOf=Complex$1.prototype.toString,Complex$1.fromJSON=function(ss){return new Complex$1(ss)},Complex$1.compare=function(ss,ts){return ss.re>ts.re?1:ss.re<ts.re?-1:ss.im>ts.im?1:ss.im<ts.im?-1:0},Complex$1),{isClass:!0}),fraction$1={exports:{}};/**
 * @license Fraction.js v4.2.0 05/03/2022
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2021, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/(function(ss,ts){(function(rs){var ns=2e3,is={s:1,n:0,d:1};function as(ds,fs){if(isNaN(ds=parseInt(ds,10)))throw ps.InvalidParameter;return ds*fs}function os(ds,fs){if(fs===0)throw ps.DivisionByZero;var hs=Object.create(ps.prototype);hs.s=ds<0?-1:1;var ys=cs(ds=ds<0?-ds:ds,fs);return hs.n=ds/ys,hs.d=fs/ys,hs}function ls(ds){for(var fs={},hs=ds,ys=2,gs=4;gs<=hs;){for(;hs%ys==0;)hs/=ys,fs[ys]=(fs[ys]||0)+1;gs+=1+2*ys++}return hs!==ds?hs>1&&(fs[hs]=(fs[hs]||0)+1):fs[ds]=(fs[ds]||0)+1,fs}var us=function(ds,fs){var hs,ys=0,gs=1,bs=1,vs=0,Ns=0,Ts=0,Cs=1,xs=1,As=0,ws=1,Es=1,Ss=1,Ds=1e7;if(ds!=null)if(fs!==void 0){if(bs=(ys=ds)*(gs=fs),ys%1!=0||gs%1!=0)throw ps.NonIntegerParameter}else switch(typeof ds){case"object":if("d"in ds&&"n"in ds)ys=ds.n,gs=ds.d,"s"in ds&&(ys*=ds.s);else{if(!(0 in ds))throw ps.InvalidParameter;ys=ds[0],1 in ds&&(gs=ds[1])}bs=ys*gs;break;case"number":if(ds<0&&(bs=ds,ds=-ds),ds%1==0)ys=ds;else if(ds>0){for(ds>=1&&(ds/=xs=Math.pow(10,Math.floor(1+Math.log(ds)/Math.LN10)));ws<=Ds&&Ss<=Ds;){if(ds===(hs=(As+Es)/(ws+Ss))){ws+Ss<=Ds?(ys=As+Es,gs=ws+Ss):Ss>ws?(ys=Es,gs=Ss):(ys=As,gs=ws);break}ds>hs?(As+=Es,ws+=Ss):(Es+=As,Ss+=ws),ws>Ds?(ys=Es,gs=Ss):(ys=As,gs=ws)}ys*=xs}else(isNaN(ds)||isNaN(fs))&&(gs=ys=NaN);break;case"string":if((ws=ds.match(/\d+|./g))===null)throw ps.InvalidParameter;if(ws[As]==="-"?(bs=-1,As++):ws[As]==="+"&&As++,ws.length===As+1?Ns=as(ws[As++],bs):ws[As+1]==="."||ws[As]==="."?(ws[As]!=="."&&(vs=as(ws[As++],bs)),(++As+1===ws.length||ws[As+1]==="("&&ws[As+3]===")"||ws[As+1]==="'"&&ws[As+3]==="'")&&(Ns=as(ws[As],bs),Cs=Math.pow(10,ws[As].length),As++),(ws[As]==="("&&ws[As+2]===")"||ws[As]==="'"&&ws[As+2]==="'")&&(Ts=as(ws[As+1],bs),xs=Math.pow(10,ws[As+1].length)-1,As+=3)):ws[As+1]==="/"||ws[As+1]===":"?(Ns=as(ws[As],bs),Cs=as(ws[As+2],1),As+=3):ws[As+3]==="/"&&ws[As+1]===" "&&(vs=as(ws[As],bs),Ns=as(ws[As+2],bs),Cs=as(ws[As+4],1),As+=5),ws.length<=As){bs=ys=Ts+(gs=Cs*xs)*vs+xs*Ns;break}default:throw ps.InvalidParameter}if(gs===0)throw ps.DivisionByZero;is.s=bs<0?-1:1,is.n=Math.abs(ys),is.d=Math.abs(gs)};function cs(ds,fs){if(!ds)return fs;if(!fs)return ds;for(;;){if(!(ds%=fs))return fs;if(!(fs%=ds))return ds}}function ps(ds,fs){if(us(ds,fs),!(this instanceof ps))return os(is.s*is.n,is.d);ds=cs(is.d,is.n),this.s=is.s,this.n=is.n/ds,this.d=is.d/ds}ps.DivisionByZero=new Error("Division by Zero"),ps.InvalidParameter=new Error("Invalid argument"),ps.NonIntegerParameter=new Error("Parameters must be integer"),ps.prototype={s:1,n:0,d:1,abs:function(){return os(this.n,this.d)},neg:function(){return os(-this.s*this.n,this.d)},add:function(ds,fs){return us(ds,fs),os(this.s*this.n*is.d+is.s*this.d*is.n,this.d*is.d)},sub:function(ds,fs){return us(ds,fs),os(this.s*this.n*is.d-is.s*this.d*is.n,this.d*is.d)},mul:function(ds,fs){return us(ds,fs),os(this.s*is.s*this.n*is.n,this.d*is.d)},div:function(ds,fs){return us(ds,fs),os(this.s*is.s*this.n*is.d,this.d*is.n)},clone:function(){return os(this.s*this.n,this.d)},mod:function(ds,fs){if(isNaN(this.n)||isNaN(this.d))return new ps(NaN);if(ds===void 0)return os(this.s*this.n%this.d,1);if(us(ds,fs),is.n===0&&this.d===0)throw ps.DivisionByZero;return os(this.s*(is.d*this.n)%(is.n*this.d),is.d*this.d)},gcd:function(ds,fs){return us(ds,fs),os(cs(is.n,this.n)*cs(is.d,this.d),is.d*this.d)},lcm:function(ds,fs){return us(ds,fs),is.n===0&&this.n===0?os(0,1):os(is.n*this.n,cs(is.n,this.n)*cs(is.d,this.d))},ceil:function(ds){return ds=Math.pow(10,ds||0),isNaN(this.n)||isNaN(this.d)?new ps(NaN):os(Math.ceil(ds*this.s*this.n/this.d),ds)},floor:function(ds){return ds=Math.pow(10,ds||0),isNaN(this.n)||isNaN(this.d)?new ps(NaN):os(Math.floor(ds*this.s*this.n/this.d),ds)},round:function(ds){return ds=Math.pow(10,ds||0),isNaN(this.n)||isNaN(this.d)?new ps(NaN):os(Math.round(ds*this.s*this.n/this.d),ds)},inverse:function(){return os(this.s*this.d,this.n)},pow:function(ds,fs){if(us(ds,fs),is.d===1)return is.s<0?os(Math.pow(this.s*this.d,is.n),Math.pow(this.n,is.n)):os(Math.pow(this.s*this.n,is.n),Math.pow(this.d,is.n));if(this.s<0)return null;var hs=ls(this.n),ys=ls(this.d),gs=1,bs=1;for(var vs in hs)if(vs!=="1"){if(vs==="0"){gs=0;break}if(hs[vs]*=is.n,hs[vs]%is.d!=0)return null;hs[vs]/=is.d,gs*=Math.pow(vs,hs[vs])}for(var vs in ys)if(vs!=="1"){if(ys[vs]*=is.n,ys[vs]%is.d!=0)return null;ys[vs]/=is.d,bs*=Math.pow(vs,ys[vs])}return is.s<0?os(bs,gs):os(gs,bs)},equals:function(ds,fs){return us(ds,fs),this.s*this.n*is.d==is.s*is.n*this.d},compare:function(ds,fs){us(ds,fs);var hs=this.s*this.n*is.d-is.s*is.n*this.d;return(0<hs)-(hs<0)},simplify:function(ds){if(isNaN(this.n)||isNaN(this.d))return this;ds=ds||.001;for(var fs=this.abs(),hs=fs.toContinued(),ys=1;ys<hs.length;ys++){for(var gs=os(hs[ys-1],1),bs=ys-2;bs>=0;bs--)gs=gs.inverse().add(hs[bs]);if(gs.sub(fs).abs().valueOf()<ds)return gs.mul(this.s)}return this},divisible:function(ds,fs){return us(ds,fs),!(!(is.n*this.d)||this.n*is.d%(is.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(ds){var fs,hs="",ys=this.n,gs=this.d;return this.s<0&&(hs+="-"),gs===1?hs+=ys:(ds&&(fs=Math.floor(ys/gs))>0&&(hs+=fs,hs+=" ",ys%=gs),hs+=ys,hs+="/",hs+=gs),hs},toLatex:function(ds){var fs,hs="",ys=this.n,gs=this.d;return this.s<0&&(hs+="-"),gs===1?hs+=ys:(ds&&(fs=Math.floor(ys/gs))>0&&(hs+=fs,ys%=gs),hs+="\\frac{",hs+=ys,hs+="}{",hs+=gs,hs+="}"),hs},toContinued:function(){var ds,fs=this.n,hs=this.d,ys=[];if(isNaN(fs)||isNaN(hs))return ys;do ys.push(Math.floor(fs/hs)),ds=fs%hs,fs=hs,hs=ds;while(fs!==1);return ys},toString:function(ds){var fs=this.n,hs=this.d;if(isNaN(fs)||isNaN(hs))return"NaN";ds=ds||15;var ys=function(Ns,Ts){for(;Ts%2==0;Ts/=2);for(;Ts%5==0;Ts/=5);if(Ts===1)return 0;for(var Cs=10%Ts,xs=1;Cs!==1;xs++)if(Cs=10*Cs%Ts,xs>ns)return 0;return xs}(0,hs),gs=function(Ns,Ts,Cs){for(var xs=1,As=function(Es,Ss,Ds){for(var Vs=1;Ss>0;Es=Es*Es%Ds,Ss>>=1)1&Ss&&(Vs=Vs*Es%Ds);return Vs}(10,Cs,Ts),ws=0;ws<300;ws++){if(xs===As)return ws;xs=10*xs%Ts,As=10*As%Ts}return 0}(0,hs,ys),bs=this.s<0?"-":"";if(bs+=fs/hs|0,fs%=hs,(fs*=10)&&(bs+="."),ys){for(var vs=gs;vs--;)bs+=fs/hs|0,fs%=hs,fs*=10;for(bs+="(",vs=ys;vs--;)bs+=fs/hs|0,fs%=hs,fs*=10;bs+=")"}else for(vs=ds;fs&&vs--;)bs+=fs/hs|0,fs%=hs,fs*=10;return bs}},Object.defineProperty(ps,"__esModule",{value:!0}),ps.default=ps,ps.Fraction=ps,ss.exports=ps})()})(fraction$1);var Fraction$1=getDefaultExportFromCjs$1(fraction$1.exports),name$4z="Fraction",dependencies$4z=[],createFractionClass=factory(name$4z,dependencies$4z,()=>(Fraction$1.prototype.type="Fraction",Fraction$1.prototype.isFraction=!0,Fraction$1.prototype.toJSON=function(){return{mathjs:"Fraction",n:this.s*this.n,d:this.d}},Fraction$1.fromJSON=function(ss){return new Fraction$1(ss)},Fraction$1),{isClass:!0}),name$4y="Range",dependencies$4y=[],createRangeClass=factory(name$4y,dependencies$4y,()=>{function ss(ts,rs,ns){if(!(this instanceof ss))throw new SyntaxError("Constructor must be called with the new operator");var is=ts!=null,as=rs!=null,os=ns!=null;if(is){if(isBigNumber(ts))ts=ts.toNumber();else if(typeof ts!="number")throw new TypeError("Parameter start must be a number")}if(as){if(isBigNumber(rs))rs=rs.toNumber();else if(typeof rs!="number")throw new TypeError("Parameter end must be a number")}if(os){if(isBigNumber(ns))ns=ns.toNumber();else if(typeof ns!="number")throw new TypeError("Parameter step must be a number")}this.start=is?parseFloat(ts):0,this.end=as?parseFloat(rs):0,this.step=os?parseFloat(ns):1}return ss.prototype.type="Range",ss.prototype.isRange=!0,ss.parse=function(ts){if(typeof ts!="string")return null;var rs=ts.split(":").map(function(ns){return parseFloat(ns)});if(rs.some(function(ns){return isNaN(ns)}))return null;switch(rs.length){case 2:return new ss(rs[0],rs[1]);case 3:return new ss(rs[0],rs[2],rs[1]);default:return null}},ss.prototype.clone=function(){return new ss(this.start,this.end,this.step)},ss.prototype.size=function(){var ts=0,rs=this.start,ns=this.step,is=this.end-rs;return sign$3(ns)===sign$3(is)?ts=Math.ceil(is/ns):is===0&&(ts=0),isNaN(ts)&&(ts=0),[ts]},ss.prototype.min=function(){var ts=this.size()[0];return ts>0?this.step>0?this.start:this.start+(ts-1)*this.step:void 0},ss.prototype.max=function(){var ts=this.size()[0];return ts>0?this.step>0?this.start+(ts-1)*this.step:this.start:void 0},ss.prototype.forEach=function(ts){var rs=this.start,ns=this.step,is=this.end,as=0;if(ns>0)for(;rs<is;)ts(rs,[as],this),rs+=ns,as++;else if(ns<0)for(;rs>is;)ts(rs,[as],this),rs+=ns,as++},ss.prototype.map=function(ts){var rs=[];return this.forEach(function(ns,is,as){rs[is[0]]=ts(ns,is,as)}),rs},ss.prototype.toArray=function(){var ts=[];return this.forEach(function(rs,ns){ts[ns[0]]=rs}),ts},ss.prototype.valueOf=function(){return this.toArray()},ss.prototype.format=function(ts){var rs=format$3(this.start,ts);return this.step!==1&&(rs+=":"+format$3(this.step,ts)),rs+=":"+format$3(this.end,ts)},ss.prototype.toString=function(){return this.format()},ss.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},ss.fromJSON=function(ts){return new ss(ts.start,ts.end,ts.step)},ss},{isClass:!0}),name$4x="Matrix",dependencies$4x=[],createMatrixClass=factory(name$4x,dependencies$4x,()=>{function ss(){if(!(this instanceof ss))throw new SyntaxError("Constructor must be called with the new operator")}return ss.prototype.type="Matrix",ss.prototype.isMatrix=!0,ss.prototype.storage=function(){throw new Error("Cannot invoke storage on a Matrix interface")},ss.prototype.datatype=function(){throw new Error("Cannot invoke datatype on a Matrix interface")},ss.prototype.create=function(ts,rs){throw new Error("Cannot invoke create on a Matrix interface")},ss.prototype.subset=function(ts,rs,ns){throw new Error("Cannot invoke subset on a Matrix interface")},ss.prototype.get=function(ts){throw new Error("Cannot invoke get on a Matrix interface")},ss.prototype.set=function(ts,rs,ns){throw new Error("Cannot invoke set on a Matrix interface")},ss.prototype.resize=function(ts,rs){throw new Error("Cannot invoke resize on a Matrix interface")},ss.prototype.reshape=function(ts,rs){throw new Error("Cannot invoke reshape on a Matrix interface")},ss.prototype.clone=function(){throw new Error("Cannot invoke clone on a Matrix interface")},ss.prototype.size=function(){throw new Error("Cannot invoke size on a Matrix interface")},ss.prototype.map=function(ts,rs){throw new Error("Cannot invoke map on a Matrix interface")},ss.prototype.forEach=function(ts){throw new Error("Cannot invoke forEach on a Matrix interface")},ss.prototype[Symbol.iterator]=function(){throw new Error("Cannot iterate a Matrix interface")},ss.prototype.toArray=function(){throw new Error("Cannot invoke toArray on a Matrix interface")},ss.prototype.valueOf=function(){throw new Error("Cannot invoke valueOf on a Matrix interface")},ss.prototype.format=function(ts){throw new Error("Cannot invoke format on a Matrix interface")},ss.prototype.toString=function(){throw new Error("Cannot invoke toString on a Matrix interface")},ss},{isClass:!0}),name$4w="DenseMatrix",dependencies$4w=["Matrix"],createDenseMatrixClass=factory(name$4w,dependencies$4w,ss=>{var{Matrix:ts}=ss;function rs(us,cs){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(cs&&!isString$1$1(cs))throw new Error("Invalid datatype: "+cs);if(isMatrix(us))us.type==="DenseMatrix"?(this._data=clone$3(us._data),this._size=clone$3(us._size),this._datatype=cs||us._datatype):(this._data=us.toArray(),this._size=us.size(),this._datatype=cs||us._datatype);else if(us&&isArray$1$1(us.data)&&isArray$1$1(us.size))this._data=us.data,this._size=us.size,validate$1(this._data,this._size),this._datatype=cs||us.datatype;else if(isArray$1$1(us))this._data=ls(us),this._size=arraySize(this._data),validate$1(this._data,this._size),this._datatype=cs;else{if(us)throw new TypeError("Unsupported type of data ("+typeOf$1(us)+")");this._data=[],this._size=[0],this._datatype=cs}}function ns(us,cs,ps,ds){var fs=ds===ps-1,hs=cs.dimension(ds);return fs?hs.map(function(ys){return validateIndex(ys,us.length),us[ys]}).valueOf():hs.map(function(ys){return validateIndex(ys,us.length),ns(us[ys],cs,ps,ds+1)}).valueOf()}function is(us,cs,ps,ds,fs){var hs=fs===ds-1,ys=cs.dimension(fs);hs?ys.forEach(function(gs,bs){validateIndex(gs),us[gs]=ps[bs[0]]}):ys.forEach(function(gs,bs){validateIndex(gs),is(us[gs],cs,ps[bs[0]],ds,fs+1)})}function as(us,cs,ps){if(cs.length===0){for(var ds=us._data;isArray$1$1(ds);)ds=ds[0];return ds}return us._size=cs.slice(0),us._data=resize$1(us._data,us._size,ps),us}function os(us,cs,ps){for(var ds=us._size.slice(0),fs=!1;ds.length<cs.length;)ds.push(0),fs=!0;for(var hs=0,ys=cs.length;hs<ys;hs++)cs[hs]>ds[hs]&&(ds[hs]=cs[hs],fs=!0);fs&&as(us,ds,ps)}function ls(us){for(var cs=0,ps=us.length;cs<ps;cs++){var ds=us[cs];isArray$1$1(ds)?us[cs]=ls(ds):ds&&ds.isMatrix===!0&&(us[cs]=ls(ds.valueOf()))}return us}return rs.prototype=new ts,rs.prototype.createDenseMatrix=function(us,cs){return new rs(us,cs)},rs.prototype.type="DenseMatrix",rs.prototype.isDenseMatrix=!0,rs.prototype.getDataType=function(){return getArrayDataType(this._data,typeOf$1)},rs.prototype.storage=function(){return"dense"},rs.prototype.datatype=function(){return this._datatype},rs.prototype.create=function(us,cs){return new rs(us,cs)},rs.prototype.subset=function(us,cs,ps){switch(arguments.length){case 1:return function(ds,fs){if(!isIndex(fs))throw new TypeError("Invalid index");var hs=fs.isScalar();if(hs)return ds.get(fs.min());var ys=fs.size();if(ys.length!==ds._size.length)throw new DimensionError(ys.length,ds._size.length);for(var gs=fs.min(),bs=fs.max(),vs=0,Ns=ds._size.length;vs<Ns;vs++)validateIndex(gs[vs],ds._size[vs]),validateIndex(bs[vs],ds._size[vs]);return new rs(ns(ds._data,fs,ys.length,0),ds._datatype)}(this,us);case 2:case 3:return function(ds,fs,hs,ys){if(!fs||fs.isIndex!==!0)throw new TypeError("Invalid index");var gs,bs=fs.size(),vs=fs.isScalar();if(isMatrix(hs)?(gs=hs.size(),hs=hs.valueOf()):gs=arraySize(hs),vs){if(gs.length!==0)throw new TypeError("Scalar expected");ds.set(fs.min(),hs,ys)}else{if(bs.length<ds._size.length)throw new DimensionError(bs.length,ds._size.length,"<");if(gs.length<bs.length){for(var Ns=0,Ts=0;bs[Ns]===1&&gs[Ns]===1;)Ns++;for(;bs[Ns]===1;)Ts++,Ns++;hs=unsqueeze(hs,bs.length,Ts,gs)}if(!deepStrictEqual(bs,gs))throw new DimensionError(bs,gs,">");var Cs=fs.max().map(function(ws){return ws+1});os(ds,Cs,ys);var xs=bs.length,As=0;is(ds._data,fs,hs,xs,As)}return ds}(this,us,cs,ps);default:throw new SyntaxError("Wrong number of arguments")}},rs.prototype.get=function(us){if(!isArray$1$1(us))throw new TypeError("Array expected");if(us.length!==this._size.length)throw new DimensionError(us.length,this._size.length);for(var cs=0;cs<us.length;cs++)validateIndex(us[cs],this._size[cs]);for(var ps=this._data,ds=0,fs=us.length;ds<fs;ds++){var hs=us[ds];validateIndex(hs,ps.length),ps=ps[hs]}return ps},rs.prototype.set=function(us,cs,ps){if(!isArray$1$1(us))throw new TypeError("Array expected");if(us.length<this._size.length)throw new DimensionError(us.length,this._size.length,"<");var ds,fs,hs,ys=us.map(function(bs){return bs+1});os(this,ys,ps);var gs=this._data;for(ds=0,fs=us.length-1;ds<fs;ds++)validateIndex(hs=us[ds],gs.length),gs=gs[hs];return validateIndex(hs=us[us.length-1],gs.length),gs[hs]=cs,this},rs.prototype.resize=function(us,cs,ps){if(!isCollection(us))throw new TypeError("Array or Matrix expected");var ds=us.valueOf().map(fs=>Array.isArray(fs)&&fs.length===1?fs[0]:fs);return as(ps?this.clone():this,ds,cs)},rs.prototype.reshape=function(us,cs){var ps=cs?this.clone():this;ps._data=reshape$1(ps._data,us);var ds=ps._size.reduce((fs,hs)=>fs*hs);return ps._size=processSizesWildcard(us,ds),ps},rs.prototype.clone=function(){return new rs({data:clone$3(this._data),size:clone$3(this._size),datatype:this._datatype})},rs.prototype.size=function(){return this._size.slice(0)},rs.prototype.map=function(us){var cs=this,ps=function ds(fs,hs){return isArray$1$1(fs)?fs.map(function(ys,gs){return ds(ys,hs.concat(gs))}):us(fs,hs,cs)}(this._data,[]);return new rs(ps,this._datatype!==void 0?getArrayDataType(ps,typeOf$1):void 0)},rs.prototype.forEach=function(us){var cs=this;(function ps(ds,fs){isArray$1$1(ds)?ds.forEach(function(hs,ys){ps(hs,fs.concat(ys))}):us(ds,fs,cs)})(this._data,[])},rs.prototype[Symbol.iterator]=function*(){yield*function*us(cs,ps){if(isArray$1$1(cs))for(var ds=0;ds<cs.length;ds++)yield*us(cs[ds],ps.concat(ds));else yield{value:cs,index:ps}}(this._data,[])},rs.prototype.rows=function(){var us=[];if(this.size().length!==2)throw new TypeError("Rows can only be returned for a 2D matrix.");var cs=this._data;for(var ps of cs)us.push(new rs([ps],this._datatype));return us},rs.prototype.columns=function(){var us=this,cs=[],ps=this.size();if(ps.length!==2)throw new TypeError("Rows can only be returned for a 2D matrix.");for(var ds=this._data,fs=function(ys){var gs=ds.map(bs=>[bs[ys]]);cs.push(new rs(gs,us._datatype))},hs=0;hs<ps[1];hs++)fs(hs);return cs},rs.prototype.toArray=function(){return clone$3(this._data)},rs.prototype.valueOf=function(){return this._data},rs.prototype.format=function(us){return format$1(this._data,us)},rs.prototype.toString=function(){return format$1(this._data)},rs.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},rs.prototype.diagonal=function(us){if(us){if(isBigNumber(us)&&(us=us.toNumber()),!isNumber$1(us)||!isInteger$1(us))throw new TypeError("The parameter k must be an integer number")}else us=0;for(var cs=us>0?us:0,ps=us<0?-us:0,ds=this._size[0],fs=this._size[1],hs=Math.min(ds-ps,fs-cs),ys=[],gs=0;gs<hs;gs++)ys[gs]=this._data[gs+ps][gs+cs];return new rs({data:ys,size:[hs],datatype:this._datatype})},rs.diagonal=function(us,cs,ps,ds){if(!isArray$1$1(us))throw new TypeError("Array expected, size parameter");if(us.length!==2)throw new Error("Only two dimensions matrix are supported");if(us=us.map(function(xs){if(isBigNumber(xs)&&(xs=xs.toNumber()),!isNumber$1(xs)||!isInteger$1(xs)||xs<1)throw new Error("Size values must be positive integers");return xs}),ps){if(isBigNumber(ps)&&(ps=ps.toNumber()),!isNumber$1(ps)||!isInteger$1(ps))throw new TypeError("The parameter k must be an integer number")}else ps=0;var fs,hs=ps>0?ps:0,ys=ps<0?-ps:0,gs=us[0],bs=us[1],vs=Math.min(gs-ys,bs-hs);if(isArray$1$1(cs)){if(cs.length!==vs)throw new Error("Invalid value array length");fs=function(xs){return cs[xs]}}else if(isMatrix(cs)){var Ns=cs.size();if(Ns.length!==1||Ns[0]!==vs)throw new Error("Invalid matrix length");fs=function(xs){return cs.get([xs])}}else fs=function(){return cs};ds||(ds=isBigNumber(fs(0))?fs(0).mul(0):0);var Ts=[];if(us.length>0){Ts=resize$1(Ts,us,ds);for(var Cs=0;Cs<vs;Cs++)Ts[Cs+ys][Cs+hs]=fs(Cs)}return new rs({data:Ts,size:[gs,bs]})},rs.fromJSON=function(us){return new rs(us)},rs.prototype.swapRows=function(us,cs){if(!(isNumber$1(us)&&isInteger$1(us)&&isNumber$1(cs)&&isInteger$1(cs)))throw new Error("Row index must be positive integers");if(this._size.length!==2)throw new Error("Only two dimensional matrix is supported");return validateIndex(us,this._size[0]),validateIndex(cs,this._size[0]),rs._swapRows(us,cs,this._data),this},rs._swapRows=function(us,cs,ps){var ds=ps[us];ps[us]=ps[cs],ps[cs]=ds},rs},{isClass:!0}),name$4v="clone",dependencies$4v=["typed"],createClone=factory(name$4v,dependencies$4v,ss=>{var{typed:ts}=ss;return ts(name$4v,{any:clone$3})});function _switch$1(ss){var ts,rs,ns=ss.length,is=ss[0].length,as=[];for(rs=0;rs<is;rs++){var os=[];for(ts=0;ts<ns;ts++)os.push(ss[ts][rs]);as.push(os)}return as}function containsCollections(ss){for(var ts=0;ts<ss.length;ts++)if(isCollection(ss[ts]))return!0;return!1}function deepForEach(ss,ts){isMatrix(ss)&&(ss=ss.valueOf());for(var rs=0,ns=ss.length;rs<ns;rs++){var is=ss[rs];Array.isArray(is)?deepForEach(is,ts):ts(is)}}function deepMap(ss,ts,rs){return ss&&typeof ss.map=="function"?ss.map(function(ns){return deepMap(ns,ts)}):ts(ss)}function reduce$2(ss,ts,rs){var ns=Array.isArray(ss)?arraySize(ss):ss.size();if(ts<0||ts>=ns.length)throw new IndexError(ts,ns.length);return isMatrix(ss)?ss.create(_reduce(ss.valueOf(),ts,rs)):_reduce(ss,ts,rs)}function _reduce(ss,ts,rs){var ns,is,as,os;if(ts<=0){if(Array.isArray(ss[0])){for(os=_switch$1(ss),is=[],ns=0;ns<os.length;ns++)is[ns]=_reduce(os[ns],ts-1,rs);return is}for(as=ss[0],ns=1;ns<ss.length;ns++)as=rs(as,ss[ns]);return as}for(is=[],ns=0;ns<ss.length;ns++)is[ns]=_reduce(ss[ns],ts-1,rs);return is}function scatter(ss,ts,rs,ns,is,as,os,ls,us,cs,ps){var ds,fs,hs,ys,gs=ss._values,bs=ss._index,vs=ss._ptr;if(ns)for(fs=vs[ts],hs=vs[ts+1],ds=fs;ds<hs;ds++)rs[ys=bs[ds]]!==as?(rs[ys]=as,os.push(ys),cs?(ns[ys]=us?ls(gs[ds],ps):ls(ps,gs[ds]),is[ys]=as):ns[ys]=gs[ds]):(ns[ys]=us?ls(gs[ds],ns[ys]):ls(ns[ys],gs[ds]),is[ys]=as);else for(fs=vs[ts],hs=vs[ts+1],ds=fs;ds<hs;ds++)rs[ys=bs[ds]]!==as?(rs[ys]=as,os.push(ys)):is[ys]=as}var name$4u="isInteger",dependencies$4u=["typed"],createIsInteger=factory(name$4u,dependencies$4u,ss=>{var{typed:ts}=ss;return ts(name$4u,{number:isInteger$1,BigNumber:function(rs){return rs.isInt()},Fraction:function(rs){return rs.d===1&&isFinite(rs.n)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),n1$4="number",n2$2="number, number";function absNumber(ss){return Math.abs(ss)}function addNumber(ss,ts){return ss+ts}function multiplyNumber(ss,ts){return ss*ts}function unaryMinusNumber(ss){return-ss}function unaryPlusNumber(ss){return ss}function cbrtNumber(ss){return cbrt$2(ss)}function cubeNumber(ss){return ss*ss*ss}function expNumber(ss){return Math.exp(ss)}function expm1Number(ss){return expm1$1(ss)}function gcdNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Parameters in function gcd must be integer numbers");for(var rs;ts!==0;)rs=ss%ts,ss=ts,ts=rs;return ss<0?-ss:ss}function lcmNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Parameters in function lcm must be integer numbers");if(ss===0||ts===0)return 0;for(var rs,ns=ss*ts;ts!==0;)ts=ss%(rs=ts),ss=rs;return Math.abs(ns/ss)}function logNumber(ss,ts){return ts?Math.log(ss)/Math.log(ts):Math.log(ss)}function log10Number(ss){return log10$3(ss)}function log2Number(ss){return log2$2(ss)}function modNumber(ss,ts){if(ts>0)return ss-ts*Math.floor(ss/ts);if(ts===0)return ss;throw new Error("Cannot calculate mod for a negative divisor")}function nthRootNumber(ss){var ts=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,rs=ts<0;if(rs&&(ts=-ts),ts===0)throw new Error("Root must be non-zero");if(ss<0&&Math.abs(ts)%2!=1)throw new Error("Root must be odd when a is negative.");if(ss===0)return rs?1/0:0;if(!isFinite(ss))return rs?0:ss;var ns=Math.pow(Math.abs(ss),1/ts);return ns=ss<0?-ns:ns,rs?1/ns:ns}function signNumber(ss){return sign$3(ss)}function squareNumber(ss){return ss*ss}function xgcdNumber(ss,ts){var rs,ns,is,as=0,os=1,ls=1,us=0;if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Parameters in function xgcd must be integer numbers");for(;ts;)is=ss-(ns=Math.floor(ss/ts))*ts,rs=as,as=os-ns*as,os=rs,rs=ls,ls=us-ns*ls,us=rs,ss=ts,ts=is;return ss<0?[-ss,-os,-us]:[ss,ss?os:0,us]}function powNumber(ss,ts){return ss*ss<1&&ts===1/0||ss*ss>1&&ts===-1/0?0:Math.pow(ss,ts)}function roundNumber(ss){var ts=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!isInteger$1(ts)||ts<0||ts>15)throw new Error("Number of decimals in function round must be an integer from 0 to 15 inclusive");return parseFloat(toFixed$2(ss,ts))}absNumber.signature=n1$4,addNumber.signature=n2$2,multiplyNumber.signature=n2$2,unaryMinusNumber.signature=n1$4,unaryPlusNumber.signature=n1$4,cbrtNumber.signature=n1$4,cubeNumber.signature=n1$4,expNumber.signature=n1$4,expm1Number.signature=n1$4,gcdNumber.signature=n2$2,lcmNumber.signature=n2$2,log10Number.signature=n1$4,log2Number.signature=n1$4,modNumber.signature=n2$2,signNumber.signature=n1$4,squareNumber.signature=n1$4,xgcdNumber.signature=n2$2,powNumber.signature=n2$2;var n1$3="number",n2$1="number, number";function bitAndNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function bitAnd");return ss&ts}function bitNotNumber(ss){if(!isInteger$1(ss))throw new Error("Integer expected in function bitNot");return~ss}function bitOrNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function bitOr");return ss|ts}function bitXorNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function bitXor");return ss^ts}function leftShiftNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function leftShift");return ss<<ts}function rightArithShiftNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function rightArithShift");return ss>>ts}function rightLogShiftNumber(ss,ts){if(!isInteger$1(ss)||!isInteger$1(ts))throw new Error("Integers expected in function rightLogShift");return ss>>>ts}function product$2(ss,ts){if(ts<ss)return 1;if(ts===ss)return ts;var rs=ts+ss>>1;return product$2(ss,rs)*product$2(rs+1,ts)}function combinationsNumber(ss,ts){if(!isInteger$1(ss)||ss<0)throw new TypeError("Positive integer value expected in function combinations");if(!isInteger$1(ts)||ts<0)throw new TypeError("Positive integer value expected in function combinations");if(ts>ss)throw new TypeError("k must be less than or equal to n");for(var rs=ss-ts,ns=1,is=2,as=ts<rs?ts:rs,os=ts<rs?rs+1:ts+1;os<=ss;++os)for(ns*=os;is<=as&&ns%is==0;)ns/=is,++is;return is<=as&&(ns/=product$2(is,as)),ns}bitAndNumber.signature=n2$1,bitNotNumber.signature=n1$3,bitOrNumber.signature=n2$1,bitXorNumber.signature=n2$1,leftShiftNumber.signature=n2$1,rightArithShiftNumber.signature=n2$1,rightLogShiftNumber.signature=n2$1,combinationsNumber.signature="number, number";var pi$1=Math.PI,tau$1=2*Math.PI,e$1$1=Math.E,phi$1=1.618033988749895,n1$2="number",n2="number, number";function notNumber(ss){return!ss}function orNumber(ss,ts){return!(!ss&&!ts)}function xorNumber(ss,ts){return!!ss!=!!ts}function andNumber(ss,ts){return!(!ss||!ts)}function gammaNumber(ss){var ts;if(isInteger$1(ss))return ss<=0?isFinite(ss)?1/0:NaN:ss>171?1/0:product$2(1,ss-1);if(ss<.5)return Math.PI/(Math.sin(Math.PI*ss)*gammaNumber(1-ss));if(ss>=171.35)return 1/0;if(ss>85){var rs=ss*ss,ns=rs*ss,is=ns*ss,as=is*ss;return Math.sqrt(2*Math.PI/ss)*Math.pow(ss/Math.E,ss)*(1+1/(12*ss)+1/(288*rs)-139/(51840*ns)-571/(2488320*is)+163879/(209018880*as)+5246819/(75246796800*as*ss))}--ss,ts=gammaP[0];for(var os=1;os<gammaP.length;++os)ts+=gammaP[os]/(ss+os);var ls=ss+gammaG+.5;return Math.sqrt(2*Math.PI)*Math.pow(ls,ss+.5)*Math.exp(-ls)*ts}notNumber.signature=n1$2,orNumber.signature=n2,xorNumber.signature=n2,andNumber.signature=n2,gammaNumber.signature="number";var gammaG=4.7421875,gammaP=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],lnSqrt2PI=.9189385332046728,lgammaG=5,lgammaN=7,lgammaSeries=[1.000000000190015,76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];function lgammaNumber(ss){if(ss<0)return NaN;if(ss===0)return 1/0;if(!isFinite(ss))return ss;if(ss<.5)return Math.log(Math.PI/Math.sin(Math.PI*ss))-lgammaNumber(1-ss);for(var ts=(ss-=1)+lgammaG+.5,rs=lgammaSeries[0],ns=lgammaN-1;ns>=1;ns--)rs+=lgammaSeries[ns]/(ss+ns);return lnSqrt2PI+(ss+.5)*Math.log(ts)-ts+Math.log(rs)}lgammaNumber.signature="number";var n1$1="number";function acoshNumber(ss){return acosh$3(ss)}function acotNumber(ss){return Math.atan(1/ss)}function acothNumber(ss){return isFinite(ss)?(Math.log((ss+1)/ss)+Math.log(ss/(ss-1)))/2:0}function acscNumber(ss){return Math.asin(1/ss)}function acschNumber(ss){var ts=1/ss;return Math.log(ts+Math.sqrt(ts*ts+1))}function asecNumber(ss){return Math.acos(1/ss)}function asechNumber(ss){var ts=1/ss,rs=Math.sqrt(ts*ts-1);return Math.log(rs+ts)}function asinhNumber(ss){return asinh$3(ss)}function atanhNumber(ss){return atanh$3(ss)}function cotNumber(ss){return 1/Math.tan(ss)}function cothNumber(ss){var ts=Math.exp(2*ss);return(ts+1)/(ts-1)}function cscNumber(ss){return 1/Math.sin(ss)}function cschNumber(ss){return ss===0?Number.POSITIVE_INFINITY:Math.abs(2/(Math.exp(ss)-Math.exp(-ss)))*sign$3(ss)}function secNumber(ss){return 1/Math.cos(ss)}function sechNumber(ss){return 2/(Math.exp(ss)+Math.exp(-ss))}function sinhNumber(ss){return sinh$3(ss)}acoshNumber.signature=n1$1,acotNumber.signature=n1$1,acothNumber.signature=n1$1,acscNumber.signature=n1$1,acschNumber.signature=n1$1,asecNumber.signature=n1$1,asechNumber.signature=n1$1,asinhNumber.signature=n1$1,atanhNumber.signature=n1$1,cotNumber.signature=n1$1,cothNumber.signature=n1$1,cscNumber.signature=n1$1,cschNumber.signature=n1$1,secNumber.signature=n1$1,sechNumber.signature=n1$1,sinhNumber.signature=n1$1;var n1="number";function isNegativeNumber(ss){return ss<0}function isPositiveNumber(ss){return ss>0}function isZeroNumber(ss){return ss===0}function isNaNNumber(ss){return Number.isNaN(ss)}isNegativeNumber.signature=n1,isPositiveNumber.signature=n1,isZeroNumber.signature=n1,isNaNNumber.signature=n1;var name$4t="isNegative",dependencies$4t=["typed"],createIsNegative=factory(name$4t,dependencies$4t,ss=>{var{typed:ts}=ss;return ts(name$4t,{number:isNegativeNumber,BigNumber:function(rs){return rs.isNeg()&&!rs.isZero()&&!rs.isNaN()},Fraction:function(rs){return rs.s<0},Unit:function(rs){return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$4s="isNumeric",dependencies$4s=["typed"],createIsNumeric=factory(name$4s,dependencies$4s,ss=>{var{typed:ts}=ss;return ts(name$4s,{"number | BigNumber | Fraction | boolean":function(){return!0},"Complex | Unit | string | null | undefined | Node":function(){return!1},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$4r="hasNumericValue",dependencies$4r=["typed","isNumeric"],createHasNumericValue=factory(name$4r,dependencies$4r,ss=>{var{typed:ts,isNumeric:rs}=ss;return ts(name$4r,{string:function(ns){return ns.trim().length>0&&!isNaN(Number(ns))},any:function(ns){return rs(ns)}})}),name$4q="isPositive",dependencies$4q=["typed"],createIsPositive=factory(name$4q,dependencies$4q,ss=>{var{typed:ts}=ss;return ts(name$4q,{number:isPositiveNumber,BigNumber:function(rs){return!rs.isNeg()&&!rs.isZero()&&!rs.isNaN()},Fraction:function(rs){return rs.s>0&&rs.n>0},Unit:function(rs){return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$4p="isZero",dependencies$4p=["typed"],createIsZero=factory(name$4p,dependencies$4p,ss=>{var{typed:ts}=ss;return ts(name$4p,{number:isZeroNumber,BigNumber:function(rs){return rs.isZero()},Complex:function(rs){return rs.re===0&&rs.im===0},Fraction:function(rs){return rs.d===1&&rs.n===0},Unit:function(rs){return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$4o="isNaN",dependencies$4o=["typed"],createIsNaN=factory(name$4o,dependencies$4o,ss=>{var{typed:ts}=ss;return ts(name$4o,{number:isNaNNumber,BigNumber:function(rs){return rs.isNaN()},Fraction:function(rs){return!1},Complex:function(rs){return rs.isNaN()},Unit:function(rs){return Number.isNaN(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,Number.isNaN)}})}),name$4n="typeOf",dependencies$4n=["typed"],createTypeOf=factory(name$4n,dependencies$4n,ss=>{var{typed:ts}=ss;return ts(name$4n,{any:typeOf$1})});function nearlyEqual(ss,ts,rs){if(rs==null)return ss.eq(ts);if(ss.eq(ts))return!0;if(ss.isNaN()||ts.isNaN())return!1;if(ss.isFinite()&&ts.isFinite()){var ns=ss.minus(ts).abs();if(ns.isZero())return!0;var is=ss.constructor.max(ss.abs(),ts.abs());return ns.lte(is.times(rs))}return!1}function complexEquals(ss,ts,rs){return nearlyEqual$1(ss.re,ts.re,rs)&&nearlyEqual$1(ss.im,ts.im,rs)}var name$4m="equalScalar",dependencies$4m=["typed","config"],createEqualScalar=factory(name$4m,dependencies$4m,ss=>{var{typed:ts,config:rs}=ss;return ts(name$4m,{"boolean, boolean":function(ns,is){return ns===is},"number, number":function(ns,is){return nearlyEqual$1(ns,is,rs.epsilon)},"BigNumber, BigNumber":function(ns,is){return ns.eq(is)||nearlyEqual(ns,is,rs.epsilon)},"Fraction, Fraction":function(ns,is){return ns.equals(is)},"Complex, Complex":function(ns,is){return complexEquals(ns,is,rs.epsilon)},"Unit, Unit":function(ns,is){if(!ns.equalBase(is))throw new Error("Cannot compare units with different base");return this(ns.value,is.value)}})});factory(name$4m,["typed","config"],ss=>{var{typed:ts,config:rs}=ss;return ts(name$4m,{"number, number":function(ns,is){return nearlyEqual$1(ns,is,rs.epsilon)}})});var name$4l="SparseMatrix",dependencies$4l=["typed","equalScalar","Matrix"],createSparseMatrixClass=factory(name$4l,dependencies$4l,ss=>{var{typed:ts,equalScalar:rs,Matrix:ns}=ss;function is(ps,ds){if(!(this instanceof is))throw new SyntaxError("Constructor must be called with the new operator");if(ds&&!isString$1$1(ds))throw new Error("Invalid datatype: "+ds);if(isMatrix(ps))(function(fs,hs,ys){hs.type==="SparseMatrix"?(fs._values=hs._values?clone$3(hs._values):void 0,fs._index=clone$3(hs._index),fs._ptr=clone$3(hs._ptr),fs._size=clone$3(hs._size),fs._datatype=ys||hs._datatype):as(fs,hs.valueOf(),ys||hs._datatype)})(this,ps,ds);else if(ps&&isArray$1$1(ps.index)&&isArray$1$1(ps.ptr)&&isArray$1$1(ps.size))this._values=ps.values,this._index=ps.index,this._ptr=ps.ptr,this._size=ps.size,this._datatype=ds||ps.datatype;else if(isArray$1$1(ps))as(this,ps,ds);else{if(ps)throw new TypeError("Unsupported type of data ("+typeOf$1(ps)+")");this._values=[],this._index=[],this._ptr=[0],this._size=[0,0],this._datatype=ds}}function as(ps,ds,fs){ps._values=[],ps._index=[],ps._ptr=[],ps._datatype=fs;var hs=ds.length,ys=0,gs=rs,bs=0;if(isString$1$1(fs)&&(gs=ts.find(rs,[fs,fs])||rs,bs=ts.convert(0,fs)),hs>0){var vs=0;do{ps._ptr.push(ps._index.length);for(var Ns=0;Ns<hs;Ns++){var Ts=ds[Ns];if(isArray$1$1(Ts)){if(vs===0&&ys<Ts.length&&(ys=Ts.length),vs<Ts.length){var Cs=Ts[vs];gs(Cs,bs)||(ps._values.push(Cs),ps._index.push(Ns))}}else vs===0&&ys<1&&(ys=1),gs(Ts,bs)||(ps._values.push(Ts),ps._index.push(Ns))}vs++}while(vs<ys)}ps._ptr.push(ps._index.length),ps._size=[hs,ys]}function os(ps,ds,fs,hs){if(fs-ds==0)return fs;for(var ys=ds;ys<fs;ys++)if(hs[ys]===ps)return ys;return ds}function ls(ps,ds,fs,hs,ys,gs,bs){ys.splice(ps,0,hs),gs.splice(ps,0,ds);for(var vs=fs+1;vs<bs.length;vs++)bs[vs]++}function us(ps,ds,fs,hs){var ys=hs||0,gs=rs,bs=0;isString$1$1(ps._datatype)&&(gs=ts.find(rs,[ps._datatype,ps._datatype])||rs,bs=ts.convert(0,ps._datatype),ys=ts.convert(ys,ps._datatype));var vs,Ns,Ts,Cs=!gs(ys,bs),xs=ps._size[0],As=ps._size[1];if(fs>As){for(Ns=As;Ns<fs;Ns++)if(ps._ptr[Ns]=ps._values.length,Cs)for(vs=0;vs<xs;vs++)ps._values.push(ys),ps._index.push(vs);ps._ptr[fs]=ps._values.length}else fs<As&&(ps._ptr.splice(fs+1,As-fs),ps._values.splice(ps._ptr[fs],ps._values.length),ps._index.splice(ps._ptr[fs],ps._index.length));if(As=fs,ds>xs){if(Cs){var ws=0;for(Ns=0;Ns<As;Ns++){ps._ptr[Ns]=ps._ptr[Ns]+ws,Ts=ps._ptr[Ns+1]+ws;var Es=0;for(vs=xs;vs<ds;vs++,Es++)ps._values.splice(Ts+Es,0,ys),ps._index.splice(Ts+Es,0,vs),ws++}ps._ptr[As]=ps._values.length}}else if(ds<xs){var Ss=0;for(Ns=0;Ns<As;Ns++){ps._ptr[Ns]=ps._ptr[Ns]-Ss;var Ds=ps._ptr[Ns],Vs=ps._ptr[Ns+1]-Ss;for(Ts=Ds;Ts<Vs;Ts++)(vs=ps._index[Ts])>ds-1&&(ps._values.splice(Ts,1),ps._index.splice(Ts,1),Ss++)}ps._ptr[Ns]=ps._values.length}return ps._size[0]=ds,ps._size[1]=fs,ps}function cs(ps,ds,fs,hs,ys){var gs,bs,vs=hs[0],Ns=hs[1],Ts=[];for(gs=0;gs<vs;gs++)for(Ts[gs]=[],bs=0;bs<Ns;bs++)Ts[gs][bs]=0;for(bs=0;bs<Ns;bs++)for(var Cs=fs[bs],xs=fs[bs+1],As=Cs;As<xs;As++)Ts[gs=ds[As]][bs]=ps?ys?clone$3(ps[As]):ps[As]:1;return Ts}return is.prototype=new ns,is.prototype.createSparseMatrix=function(ps,ds){return new is(ps,ds)},is.prototype.type="SparseMatrix",is.prototype.isSparseMatrix=!0,is.prototype.getDataType=function(){return getArrayDataType(this._values,typeOf$1)},is.prototype.storage=function(){return"sparse"},is.prototype.datatype=function(){return this._datatype},is.prototype.create=function(ps,ds){return new is(ps,ds)},is.prototype.density=function(){var ps=this._size[0],ds=this._size[1];return ps!==0&&ds!==0?this._index.length/(ps*ds):0},is.prototype.subset=function(ps,ds,fs){if(!this._values)throw new Error("Cannot invoke subset on a Pattern only matrix");switch(arguments.length){case 1:return function(hs,ys){if(!isIndex(ys))throw new TypeError("Invalid index");if(ys.isScalar())return hs.get(ys.min());var gs,bs,vs,Ns,Ts=ys.size();if(Ts.length!==hs._size.length)throw new DimensionError(Ts.length,hs._size.length);var Cs=ys.min(),xs=ys.max();for(gs=0,bs=hs._size.length;gs<bs;gs++)validateIndex(Cs[gs],hs._size[gs]),validateIndex(xs[gs],hs._size[gs]);var As=hs._values,ws=hs._index,Es=hs._ptr,Ss=ys.dimension(0),Ds=ys.dimension(1),Vs=[],Is=[];Ss.forEach(function(Rs,ks){Is[Rs]=ks[0],Vs[Rs]=!0});var Os=As?[]:void 0,Ps=[],$s=[];return Ds.forEach(function(Rs){for($s.push(Ps.length),vs=Es[Rs],Ns=Es[Rs+1];vs<Ns;vs++)gs=ws[vs],Vs[gs]===!0&&(Ps.push(Is[gs]),Os&&Os.push(As[vs]))}),$s.push(Ps.length),new is({values:Os,index:Ps,ptr:$s,size:Ts,datatype:hs._datatype})}(this,ps);case 2:case 3:return function(hs,ys,gs,bs){if(!ys||ys.isIndex!==!0)throw new TypeError("Invalid index");var vs,Ns=ys.size(),Ts=ys.isScalar();if(isMatrix(gs)?(vs=gs.size(),gs=gs.toArray()):vs=arraySize(gs),Ts){if(vs.length!==0)throw new TypeError("Scalar expected");hs.set(ys.min(),gs,bs)}else{if(Ns.length!==1&&Ns.length!==2)throw new DimensionError(Ns.length,hs._size.length,"<");if(vs.length<Ns.length){for(var Cs=0,xs=0;Ns[Cs]===1&&vs[Cs]===1;)Cs++;for(;Ns[Cs]===1;)xs++,Cs++;gs=unsqueeze(gs,Ns.length,xs,vs)}if(!deepStrictEqual(Ns,vs))throw new DimensionError(Ns,vs,">");if(Ns.length===1)ys.dimension(0).forEach(function(Es,Ss){validateIndex(Es),hs.set([Es,0],gs[Ss[0]],bs)});else{var As=ys.dimension(0),ws=ys.dimension(1);As.forEach(function(Es,Ss){validateIndex(Es),ws.forEach(function(Ds,Vs){validateIndex(Ds),hs.set([Es,Ds],gs[Ss[0]][Vs[0]],bs)})})}}return hs}(this,ps,ds,fs);default:throw new SyntaxError("Wrong number of arguments")}},is.prototype.get=function(ps){if(!isArray$1$1(ps))throw new TypeError("Array expected");if(ps.length!==this._size.length)throw new DimensionError(ps.length,this._size.length);if(!this._values)throw new Error("Cannot invoke get on a Pattern only matrix");var ds=ps[0],fs=ps[1];validateIndex(ds,this._size[0]),validateIndex(fs,this._size[1]);var hs=os(ds,this._ptr[fs],this._ptr[fs+1],this._index);return hs<this._ptr[fs+1]&&this._index[hs]===ds?this._values[hs]:0},is.prototype.set=function(ps,ds,fs){if(!isArray$1$1(ps))throw new TypeError("Array expected");if(ps.length!==this._size.length)throw new DimensionError(ps.length,this._size.length);if(!this._values)throw new Error("Cannot invoke set on a Pattern only matrix");var hs=ps[0],ys=ps[1],gs=this._size[0],bs=this._size[1],vs=rs,Ns=0;isString$1$1(this._datatype)&&(vs=ts.find(rs,[this._datatype,this._datatype])||rs,Ns=ts.convert(0,this._datatype)),(hs>gs-1||ys>bs-1)&&(us(this,Math.max(hs+1,gs),Math.max(ys+1,bs),fs),gs=this._size[0],bs=this._size[1]),validateIndex(hs,gs),validateIndex(ys,bs);var Ts=os(hs,this._ptr[ys],this._ptr[ys+1],this._index);return Ts<this._ptr[ys+1]&&this._index[Ts]===hs?vs(ds,Ns)?function(Cs,xs,As,ws,Es){As.splice(Cs,1),ws.splice(Cs,1);for(var Ss=xs+1;Ss<Es.length;Ss++)Es[Ss]--}(Ts,ys,this._values,this._index,this._ptr):this._values[Ts]=ds:ls(Ts,hs,ys,ds,this._values,this._index,this._ptr),this},is.prototype.resize=function(ps,ds,fs){if(!isCollection(ps))throw new TypeError("Array or Matrix expected");var hs=ps.valueOf().map(ys=>Array.isArray(ys)&&ys.length===1?ys[0]:ys);if(hs.length!==2)throw new Error("Only two dimensions matrix are supported");return hs.forEach(function(ys){if(!isNumber$1(ys)||!isInteger$1(ys)||ys<0)throw new TypeError("Invalid size, must contain positive integers (size: "+format$1(hs)+")")}),us(fs?this.clone():this,hs[0],hs[1],ds)},is.prototype.reshape=function(ps,ds){if(!isArray$1$1(ps))throw new TypeError("Array expected");if(ps.length!==2)throw new Error("Sparse matrices can only be reshaped in two dimensions");ps.forEach(function(Is){if(!isNumber$1(Is)||!isInteger$1(Is)||Is<=-2||Is===0)throw new TypeError("Invalid size, must contain positive integers or -1 (size: "+format$1(ps)+")")});var fs=this._size[0]*this._size[1];if(fs!==(ps=processSizesWildcard(ps,fs))[0]*ps[1])throw new Error("Reshaping sparse matrix will result in the wrong number of elements");var hs=ds?this.clone():this;if(this._size[0]===ps[0]&&this._size[1]===ps[1])return hs;for(var ys=[],gs=0;gs<hs._ptr.length;gs++)for(var bs=0;bs<hs._ptr[gs+1]-hs._ptr[gs];bs++)ys.push(gs);for(var vs=hs._values.slice(),Ns=hs._index.slice(),Ts=0;Ts<hs._index.length;Ts++){var Cs=Ns[Ts],xs=ys[Ts],As=Cs*hs._size[1]+xs;ys[Ts]=As%ps[1],Ns[Ts]=Math.floor(As/ps[1])}hs._values.length=0,hs._index.length=0,hs._ptr.length=ps[1]+1,hs._size=ps.slice();for(var ws=0;ws<hs._ptr.length;ws++)hs._ptr[ws]=0;for(var Es=0;Es<vs.length;Es++){var Ss=Ns[Es],Ds=ys[Es],Vs=vs[Es];ls(os(Ss,hs._ptr[Ds],hs._ptr[Ds+1],hs._index),Ss,Ds,Vs,hs._values,hs._index,hs._ptr)}return hs},is.prototype.clone=function(){return new is({values:this._values?clone$3(this._values):void 0,index:clone$3(this._index),ptr:clone$3(this._ptr),size:clone$3(this._size),datatype:this._datatype})},is.prototype.size=function(){return this._size.slice(0)},is.prototype.map=function(ps,ds){if(!this._values)throw new Error("Cannot invoke map on a Pattern only matrix");var fs=this;return function(hs,ys,gs,bs,vs,Ns,Ts){var Cs=[],xs=[],As=[],ws=rs,Es=0;isString$1$1(hs._datatype)&&(ws=ts.find(rs,[hs._datatype,hs._datatype])||rs,Es=ts.convert(0,hs._datatype));for(var Ss=function(_s,Bs,Us){_s=Ns(_s,Bs,Us),ws(_s,Es)||(Cs.push(_s),xs.push(Bs))},Ds=bs;Ds<=vs;Ds++){As.push(Cs.length);var Vs=hs._ptr[Ds],Is=hs._ptr[Ds+1];if(Ts)for(var Os=Vs;Os<Is;Os++){var Ps=hs._index[Os];Ps>=ys&&Ps<=gs&&Ss(hs._values[Os],Ps-ys,Ds-bs)}else{for(var $s={},Rs=Vs;Rs<Is;Rs++)$s[hs._index[Rs]]=hs._values[Rs];for(var ks=ys;ks<=gs;ks++)Ss(ks in $s?$s[ks]:0,ks-ys,Ds-bs)}}return As.push(Cs.length),new is({values:Cs,index:xs,ptr:As,size:[gs-ys+1,vs-bs+1]})}(this,0,this._size[0]-1,0,this._size[1]-1,function(hs,ys,gs){return ps(hs,[ys,gs],fs)},ds)},is.prototype.forEach=function(ps,ds){if(!this._values)throw new Error("Cannot invoke forEach on a Pattern only matrix");for(var fs=this._size[0],hs=this._size[1],ys=0;ys<hs;ys++){var gs=this._ptr[ys],bs=this._ptr[ys+1];if(ds)for(var vs=gs;vs<bs;vs++){var Ns=this._index[vs];ps(this._values[vs],[Ns,ys],this)}else{for(var Ts={},Cs=gs;Cs<bs;Cs++)Ts[this._index[Cs]]=this._values[Cs];for(var xs=0;xs<fs;xs++)ps(xs in Ts?Ts[xs]:0,[xs,ys],this)}}},is.prototype[Symbol.iterator]=function*(){if(!this._values)throw new Error("Cannot iterate a Pattern only matrix");for(var ps=this._size[1],ds=0;ds<ps;ds++)for(var fs=this._ptr[ds],hs=this._ptr[ds+1],ys=fs;ys<hs;ys++){var gs=this._index[ys];yield{value:this._values[ys],index:[gs,ds]}}},is.prototype.toArray=function(){return cs(this._values,this._index,this._ptr,this._size,!0)},is.prototype.valueOf=function(){return cs(this._values,this._index,this._ptr,this._size,!1)},is.prototype.format=function(ps){for(var ds=this._size[0],fs=this._size[1],hs=this.density(),ys="Sparse Matrix ["+format$1(ds,ps)+" x "+format$1(fs,ps)+"] density: "+format$1(hs,ps)+`
`,gs=0;gs<fs;gs++)for(var bs=this._ptr[gs],vs=this._ptr[gs+1],Ns=bs;Ns<vs;Ns++)ys+=`
    (`+format$1(this._index[Ns],ps)+", "+format$1(gs,ps)+") ==> "+(this._values?format$1(this._values[Ns],ps):"X");return ys},is.prototype.toString=function(){return format$1(this.toArray())},is.prototype.toJSON=function(){return{mathjs:"SparseMatrix",values:this._values,index:this._index,ptr:this._ptr,size:this._size,datatype:this._datatype}},is.prototype.diagonal=function(ps){if(ps){if(isBigNumber(ps)&&(ps=ps.toNumber()),!isNumber$1(ps)||!isInteger$1(ps))throw new TypeError("The parameter k must be an integer number")}else ps=0;var ds=ps>0?ps:0,fs=ps<0?-ps:0,hs=this._size[0],ys=this._size[1],gs=Math.min(hs-fs,ys-ds),bs=[],vs=[],Ns=[];Ns[0]=0;for(var Ts=ds;Ts<ys&&bs.length<gs;Ts++)for(var Cs=this._ptr[Ts],xs=this._ptr[Ts+1],As=Cs;As<xs;As++){var ws=this._index[As];if(ws===Ts-ds+fs){bs.push(this._values[As]),vs[bs.length-1]=ws-fs;break}}return Ns.push(bs.length),new is({values:bs,index:vs,ptr:Ns,size:[gs,1]})},is.fromJSON=function(ps){return new is(ps)},is.diagonal=function(ps,ds,fs,hs,ys){if(!isArray$1$1(ps))throw new TypeError("Array expected, size parameter");if(ps.length!==2)throw new Error("Only two dimensions matrix are supported");if(ps=ps.map(function(Ps){if(isBigNumber(Ps)&&(Ps=Ps.toNumber()),!isNumber$1(Ps)||!isInteger$1(Ps)||Ps<1)throw new Error("Size values must be positive integers");return Ps}),fs){if(isBigNumber(fs)&&(fs=fs.toNumber()),!isNumber$1(fs)||!isInteger$1(fs))throw new TypeError("The parameter k must be an integer number")}else fs=0;var gs=rs,bs=0;isString$1$1(ys)&&(gs=ts.find(rs,[ys,ys])||rs,bs=ts.convert(0,ys));var vs,Ns=fs>0?fs:0,Ts=fs<0?-fs:0,Cs=ps[0],xs=ps[1],As=Math.min(Cs-Ts,xs-Ns);if(isArray$1$1(ds)){if(ds.length!==As)throw new Error("Invalid value array length");vs=function(Ps){return ds[Ps]}}else if(isMatrix(ds)){var ws=ds.size();if(ws.length!==1||ws[0]!==As)throw new Error("Invalid matrix length");vs=function(Ps){return ds.get([Ps])}}else vs=function(){return ds};for(var Es=[],Ss=[],Ds=[],Vs=0;Vs<xs;Vs++){Ds.push(Es.length);var Is=Vs-Ns;if(Is>=0&&Is<As){var Os=vs(Is);gs(Os,bs)||(Ss.push(Is+Ts),Es.push(Os))}}return Ds.push(Es.length),new is({values:Es,index:Ss,ptr:Ds,size:[Cs,xs]})},is.prototype.swapRows=function(ps,ds){if(!(isNumber$1(ps)&&isInteger$1(ps)&&isNumber$1(ds)&&isInteger$1(ds)))throw new Error("Row index must be positive integers");if(this._size.length!==2)throw new Error("Only two dimensional matrix is supported");return validateIndex(ps,this._size[0]),validateIndex(ds,this._size[0]),is._swapRows(ps,ds,this._size[1],this._values,this._index,this._ptr),this},is._forEachRow=function(ps,ds,fs,hs,ys){for(var gs=hs[ps],bs=hs[ps+1],vs=gs;vs<bs;vs++)ys(fs[vs],ds[vs])},is._swapRows=function(ps,ds,fs,hs,ys,gs){for(var bs=0;bs<fs;bs++){var vs=gs[bs],Ns=gs[bs+1],Ts=os(ps,vs,Ns,ys),Cs=os(ds,vs,Ns,ys);if(Ts<Ns&&Cs<Ns&&ys[Ts]===ps&&ys[Cs]===ds){if(hs){var xs=hs[Ts];hs[Ts]=hs[Cs],hs[Cs]=xs}}else if(Ts<Ns&&ys[Ts]===ps&&(Cs>=Ns||ys[Cs]!==ds)){var As=hs?hs[Ts]:void 0;ys.splice(Cs,0,ds),hs&&hs.splice(Cs,0,As),ys.splice(Cs<=Ts?Ts+1:Ts,1),hs&&hs.splice(Cs<=Ts?Ts+1:Ts,1)}else if(Cs<Ns&&ys[Cs]===ds&&(Ts>=Ns||ys[Ts]!==ps)){var ws=hs?hs[Cs]:void 0;ys.splice(Ts,0,ps),hs&&hs.splice(Ts,0,ws),ys.splice(Ts<=Cs?Cs+1:Cs,1),hs&&hs.splice(Ts<=Cs?Cs+1:Cs,1)}}},is},{isClass:!0}),name$4k="number",dependencies$4k=["typed"];function getNonDecimalNumberParts(ss){var ts=ss.match(/(0[box])([0-9a-fA-F]*)\.([0-9a-fA-F]*)/);return ts?{input:ss,radix:{"0b":2,"0o":8,"0x":16}[ts[1]],integerPart:ts[2],fractionalPart:ts[3]}:null}function makeNumberFromNonDecimalParts(ss){for(var ts=parseInt(ss.integerPart,ss.radix),rs=0,ns=0;ns<ss.fractionalPart.length;ns++)rs+=parseInt(ss.fractionalPart[ns],ss.radix)/Math.pow(ss.radix,ns+1);var is=ts+rs;if(isNaN(is))throw new SyntaxError('String "'+ss.input+'" is no valid number');return is}var createNumber=factory(name$4k,dependencies$4k,ss=>{var{typed:ts}=ss,rs=ts("number",{"":function(){return 0},number:function(ns){return ns},string:function(ns){if(ns==="NaN")return NaN;var is=getNonDecimalNumberParts(ns);if(is)return makeNumberFromNonDecimalParts(is);var as=0,os=ns.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);os&&(as=Number(os[2]),ns=os[1]);var ls=Number(ns);if(isNaN(ls))throw new SyntaxError('String "'+ns+'" is no valid number');if(os){if(ls>2**as-1)throw new SyntaxError('String "'.concat(ns,'" is out of range'));ls>=2**(as-1)&&(ls-=2**as)}return ls},BigNumber:function(ns){return ns.toNumber()},Fraction:function(ns){return ns.valueOf()},Unit:function(ns){throw new Error("Second argument with valueless unit expected")},null:function(ns){return 0},"Unit, string | Unit":function(ns,is){return ns.toNumber(is)},"Array | Matrix":function(ns){return deepMap(ns,this)}});return rs.fromJSON=function(ns){return parseFloat(ns.value)},rs}),name$4j="string",dependencies$4j=["typed"],createString=factory(name$4j,dependencies$4j,ss=>{var{typed:ts}=ss;return ts(name$4j,{"":function(){return""},number:format$3,null:function(rs){return"null"},boolean:function(rs){return rs+""},string:function(rs){return rs},"Array | Matrix":function(rs){return deepMap(rs,this)},any:function(rs){return String(rs)}})}),name$4i="boolean",dependencies$4i=["typed"],createBoolean=factory(name$4i,dependencies$4i,ss=>{var{typed:ts}=ss;return ts(name$4i,{"":function(){return!1},boolean:function(rs){return rs},number:function(rs){return!!rs},null:function(rs){return!1},BigNumber:function(rs){return!rs.isZero()},string:function(rs){var ns=rs.toLowerCase();if(ns==="true")return!0;if(ns==="false")return!1;var is=Number(rs);if(rs!==""&&!isNaN(is))return!!is;throw new Error('Cannot convert "'+rs+'" to a boolean')},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$4h="bignumber",dependencies$4h=["typed","BigNumber"],createBignumber=factory(name$4h,dependencies$4h,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts("bignumber",{"":function(){return new rs(0)},number:function(ns){return new rs(ns+"")},string:function(ns){var is=ns.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);if(is){var as=is[2],os=rs(is[1]),ls=new rs(2).pow(Number(as));if(os.gt(ls.sub(1)))throw new SyntaxError('String "'.concat(ns,'" is out of range'));var us=new rs(2).pow(Number(as)-1);return os.gte(us)?os.sub(ls):os}return new rs(ns)},BigNumber:function(ns){return ns},Fraction:function(ns){return new rs(ns.n).div(ns.d).times(ns.s)},null:function(ns){return new rs(0)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$4g="complex",dependencies$4g=["typed","Complex"],createComplex=factory(name$4g,dependencies$4g,ss=>{var{typed:ts,Complex:rs}=ss;return ts("complex",{"":function(){return rs.ZERO},number:function(ns){return new rs(ns,0)},"number, number":function(ns,is){return new rs(ns,is)},"BigNumber, BigNumber":function(ns,is){return new rs(ns.toNumber(),is.toNumber())},Fraction:function(ns){return new rs(ns.valueOf(),0)},Complex:function(ns){return ns.clone()},string:function(ns){return rs(ns)},null:function(ns){return rs(0)},Object:function(ns){if("re"in ns&&"im"in ns)return new rs(ns.re,ns.im);if("r"in ns&&"phi"in ns||"abs"in ns&&"arg"in ns)return new rs(ns);throw new Error("Expected object with properties (re and im) or (r and phi) or (abs and arg)")},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$4f="fraction",dependencies$4f=["typed","Fraction"],createFraction=factory(name$4f,dependencies$4f,ss=>{var{typed:ts,Fraction:rs}=ss;return ts("fraction",{number:function(ns){if(!isFinite(ns)||isNaN(ns))throw new Error(ns+" cannot be represented as a fraction");return new rs(ns)},string:function(ns){return new rs(ns)},"number, number":function(ns,is){return new rs(ns,is)},null:function(ns){return new rs(0)},BigNumber:function(ns){return new rs(ns.toString())},Fraction:function(ns){return ns},Object:function(ns){return new rs(ns)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$4e="matrix",dependencies$4e=["typed","Matrix","DenseMatrix","SparseMatrix"],createMatrix=factory(name$4e,dependencies$4e,ss=>{var{typed:ts,Matrix:rs,DenseMatrix:ns,SparseMatrix:is}=ss;return ts(name$4e,{"":function(){return as([])},string:function(os){return as([],os)},"string, string":function(os,ls){return as([],os,ls)},Array:function(os){return as(os)},Matrix:function(os){return as(os,os.storage())},"Array | Matrix, string":as,"Array | Matrix, string, string":as});function as(os,ls,us){if(ls==="dense"||ls==="default"||ls===void 0)return new ns(os,us);if(ls==="sparse")return new is(os,us);throw new TypeError("Unknown matrix type "+JSON.stringify(ls)+".")}}),name$4d="matrixFromFunction",dependencies$4d=["typed","matrix","isZero"],createMatrixFromFunction=factory(name$4d,dependencies$4d,ss=>{var{typed:ts,matrix:rs,isZero:ns}=ss;return ts(name$4d,{"Array | Matrix, function, string, string":function(as,os,ls,us){return is(as,os,ls,us)},"Array | Matrix, function, string":function(as,os,ls){return is(as,os,ls)},"Matrix, function":function(as,os){return is(as,os,"dense")},"Array, function":function(as,os){return is(as,os,"dense").toArray()},"Array | Matrix, string, function":function(as,os,ls){return is(as,ls,os)},"Array | Matrix, string, string, function":function(as,os,ls,us){return is(as,us,os,ls)}});function is(as,os,ls,us){var cs;return(cs=us!==void 0?rs(ls,us):rs(ls)).resize(as),cs.forEach(function(ps,ds){var fs=os(ds);ns(fs)||cs.set(ds,fs)}),cs}}),name$4c="matrixFromRows",dependencies$4c=["typed","matrix","flatten","size"],createMatrixFromRows=factory(name$4c,dependencies$4c,ss=>{var{typed:ts,matrix:rs,flatten:ns,size:is}=ss;return ts(name$4c,{"...Array":function(ls){return as(ls)},"...Matrix":function(ls){return rs(as(ls.map(us=>us.toArray())))}});function as(ls){if(ls.length===0)throw new TypeError("At least one row is needed to construct a matrix.");var us=os(ls[0]),cs=[];for(var ps of ls){var ds=os(ps);if(ds!==us)throw new TypeError("The vectors had different length: "+(0|us)+"  "+(0|ds));cs.push(ns(ps))}return cs}function os(ls){var us=is(ls);if(us.length===1)return us[0];if(us.length===2){if(us[0]===1)return us[1];if(us[1]===1)return us[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}}),name$4b="matrixFromColumns",dependencies$4b=["typed","matrix","flatten","size"],createMatrixFromColumns=factory(name$4b,dependencies$4b,ss=>{var{typed:ts,matrix:rs,flatten:ns,size:is}=ss;return ts(name$4b,{"...Array":function(ls){return as(ls)},"...Matrix":function(ls){return rs(as(ls.map(us=>us.toArray())))}});function as(ls){if(ls.length===0)throw new TypeError("At least one column is needed to construct a matrix.");for(var us=os(ls[0]),cs=[],ps=0;ps<us;ps++)cs[ps]=[];for(var ds of ls){var fs=os(ds);if(fs!==us)throw new TypeError("The vectors had different length: "+(0|us)+"  "+(0|fs));for(var hs=ns(ds),ys=0;ys<us;ys++)cs[ys].push(hs[ys])}return cs}function os(ls){var us=is(ls);if(us.length===1)return us[0];if(us.length===2){if(us[0]===1)return us[1];if(us[1]===1)return us[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}}),name$4a="splitUnit",dependencies$4a=["typed"],createSplitUnit=factory(name$4a,dependencies$4a,ss=>{var{typed:ts}=ss;return ts(name$4a,{"Unit, Array":function(rs,ns){return rs.splitUnit(ns)}})}),name$49="unaryMinus",dependencies$49=["typed"],createUnaryMinus=factory(name$49,dependencies$49,ss=>{var{typed:ts}=ss;return ts(name$49,{number:unaryMinusNumber,Complex:function(rs){return rs.neg()},BigNumber:function(rs){return rs.neg()},Fraction:function(rs){return rs.neg()},Unit:function(rs){var ns=rs.clone();return ns.value=this(rs.value),ns},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$48="unaryPlus",dependencies$48=["typed","config","BigNumber"],createUnaryPlus=factory(name$48,dependencies$48,ss=>{var{typed:ts,config:rs,BigNumber:ns}=ss;return ts(name$48,{number:unaryPlusNumber,Complex:function(is){return is},BigNumber:function(is){return is},Fraction:function(is){return is},Unit:function(is){return is.clone()},"Array | Matrix":function(is){return deepMap(is,this)},"boolean | string":function(is){return rs.number==="BigNumber"?new ns(+is):+is}})}),name$47="abs",dependencies$47=["typed"],createAbs=factory(name$47,dependencies$47,ss=>{var{typed:ts}=ss;return ts(name$47,{number:absNumber,Complex:function(rs){return rs.abs()},BigNumber:function(rs){return rs.abs()},Fraction:function(rs){return rs.abs()},"Array | Matrix":function(rs){return deepMap(rs,this)},Unit:function(rs){return rs.abs()}})}),name$46="apply",dependencies$46=["typed","isInteger"],createApply=factory(name$46,dependencies$46,ss=>{var{typed:ts,isInteger:rs}=ss;return ts(name$46,{"Array | Matrix, number | BigNumber, function":function(ns,is,as){if(!rs(is))throw new TypeError("Integer number expected for dimension");var os=Array.isArray(ns)?arraySize(ns):ns.size();if(is<0||is>=os.length)throw new IndexError(is,os.length);return isMatrix(ns)?ns.create(_apply(ns.valueOf(),is,as)):_apply(ns,is,as)}})});function _apply(ss,ts,rs){var ns,is,as;if(ts<=0){if(Array.isArray(ss[0])){for(as=_switch(ss),is=[],ns=0;ns<as.length;ns++)is[ns]=_apply(as[ns],ts-1,rs);return is}return rs(ss)}for(is=[],ns=0;ns<ss.length;ns++)is[ns]=_apply(ss[ns],ts-1,rs);return is}function _switch(ss){var ts,rs,ns=ss.length,is=ss[0].length,as=[];for(rs=0;rs<is;rs++){var os=[];for(ts=0;ts<ns;ts++)os.push(ss[ts][rs]);as.push(os)}return as}var name$45="addScalar",dependencies$45=["typed"],createAddScalar=factory(name$45,dependencies$45,ss=>{var{typed:ts}=ss;return ts(name$45,{"number, number":addNumber,"Complex, Complex":function(rs,ns){return rs.add(ns)},"BigNumber, BigNumber":function(rs,ns){return rs.plus(ns)},"Fraction, Fraction":function(rs,ns){return rs.add(ns)},"Unit, Unit":function(rs,ns){if(rs.value===null||rs.value===void 0)throw new Error("Parameter x contains a unit with undefined value");if(ns.value===null||ns.value===void 0)throw new Error("Parameter y contains a unit with undefined value");if(!rs.equalBase(ns))throw new Error("Units do not match");var is=rs.clone();return is.value=this(is.value,ns.value),is.fixPrefix=!1,is}})}),name$44="cbrt",dependencies$44=["config","typed","isNegative","unaryMinus","matrix","Complex","BigNumber","Fraction"],createCbrt=factory(name$44,dependencies$44,ss=>{var{config:ts,typed:rs,isNegative:ns,unaryMinus:is,matrix:as,Complex:os,BigNumber:ls,Fraction:us}=ss;return rs(name$44,{number:cbrtNumber,Complex:cs,"Complex, boolean":cs,BigNumber:function(ps){return ps.cbrt()},Unit:function(ps){if(ps.value&&isComplex(ps.value)){var ds=ps.clone();return ds.value=1,(ds=ds.pow(1/3)).value=cs(ps.value),ds}var fs,hs=ns(ps.value);hs&&(ps.value=is(ps.value)),fs=isBigNumber(ps.value)?new ls(1).div(3):isFraction(ps.value)?new us(1,3):1/3;var ys=ps.pow(fs);return hs&&(ys.value=is(ys.value)),ys},"Array | Matrix":function(ps){return deepMap(ps,this)}});function cs(ps,ds){var fs=ps.arg()/3,hs=ps.abs(),ys=new os(cbrtNumber(hs),0).mul(new os(0,fs).exp());if(ds){var gs=[ys,new os(cbrtNumber(hs),0).mul(new os(0,fs+2*Math.PI/3).exp()),new os(cbrtNumber(hs),0).mul(new os(0,fs-2*Math.PI/3).exp())];return ts.matrix==="Array"?gs:as(gs)}return ys}}),name$43="algorithm11",dependencies$43=["typed","equalScalar"],createAlgorithm11=factory(name$43,dependencies$43,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as,os){var ls=ns._values,us=ns._index,cs=ns._ptr,ps=ns._size,ds=ns._datatype;if(!ls)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var fs,hs=ps[0],ys=ps[1],gs=rs,bs=0,vs=as;typeof ds=="string"&&(fs=ds,gs=ts.find(rs,[fs,fs]),bs=ts.convert(0,fs),is=ts.convert(is,fs),vs=ts.find(as,[fs,fs]));for(var Ns=[],Ts=[],Cs=[],xs=0;xs<ys;xs++){Cs[xs]=Ts.length;for(var As=cs[xs],ws=cs[xs+1],Es=As;Es<ws;Es++){var Ss=us[Es],Ds=os?vs(is,ls[Es]):vs(ls[Es],is);gs(Ds,bs)||(Ts.push(Ss),Ns.push(Ds))}}return Cs[ys]=Ts.length,ns.createSparseMatrix({values:Ns,index:Ts,ptr:Cs,size:[hs,ys],datatype:fs})}}),name$42="algorithm12",dependencies$42=["typed","DenseMatrix"],createAlgorithm12=factory(name$42,dependencies$42,ss=>{var{typed:ts,DenseMatrix:rs}=ss;return function(ns,is,as,os){var ls=ns._values,us=ns._index,cs=ns._ptr,ps=ns._size,ds=ns._datatype;if(!ls)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var fs,hs=ps[0],ys=ps[1],gs=as;typeof ds=="string"&&(fs=ds,is=ts.convert(is,fs),gs=ts.find(as,[fs,fs]));for(var bs=[],vs=[],Ns=[],Ts=0;Ts<ys;Ts++){for(var Cs=Ts+1,xs=cs[Ts],As=cs[Ts+1],ws=xs;ws<As;ws++){var Es=us[ws];vs[Es]=ls[ws],Ns[Es]=Cs}for(var Ss=0;Ss<hs;Ss++)Ts===0&&(bs[Ss]=[]),Ns[Ss]===Cs?bs[Ss][Ts]=os?gs(is,vs[Ss]):gs(vs[Ss],is):bs[Ss][Ts]=os?gs(is,0):gs(0,is)}return new rs({data:bs,size:[hs,ys],datatype:fs})}}),name$41="algorithm14",dependencies$41=["typed"],createAlgorithm14=factory(name$41,dependencies$41,ss=>{var{typed:ts}=ss;return function(ns,is,as,os){var ls,us=ns._data,cs=ns._size,ps=ns._datatype,ds=as;typeof ps=="string"&&(ls=ps,is=ts.convert(is,ls),ds=ts.find(as,[ls,ls]));var fs=cs.length>0?rs(ds,0,cs,cs[0],us,is,os):[];return ns.createDenseMatrix({data:fs,size:clone$3(cs),datatype:ls})};function rs(ns,is,as,os,ls,us,cs){var ps=[];if(is===as.length-1)for(var ds=0;ds<os;ds++)ps[ds]=cs?ns(us,ls[ds]):ns(ls[ds],us);else for(var fs=0;fs<os;fs++)ps[fs]=rs(ns,is+1,as,as[is+1],ls[fs],us,cs);return ps}}),name$40="ceil",dependencies$40=["typed","config","round","matrix","equalScalar","zeros","DenseMatrix"],createCeilNumber=factory(name$40,["typed","config","round"],ss=>{var{typed:ts,config:rs,round:ns}=ss;return ts(name$40,{number:function(is){return nearlyEqual$1(is,ns(is),rs.epsilon)?ns(is):Math.ceil(is)},"number, number":function(is,as){if(nearlyEqual$1(is,ns(is,as),rs.epsilon))return ns(is,as);var[os,ls]="".concat(is,"e").split("e"),us=Math.ceil(Number("".concat(os,"e").concat(Number(ls)+as)));return[os,ls]="".concat(us,"e").split("e"),Number("".concat(os,"e").concat(Number(ls)-as))}})}),createCeil=factory(name$40,dependencies$40,ss=>{var{typed:ts,config:rs,round:ns,matrix:is,equalScalar:as,zeros:os,DenseMatrix:ls}=ss,us=createAlgorithm11({typed:ts,equalScalar:as}),cs=createAlgorithm12({typed:ts,DenseMatrix:ls}),ps=createAlgorithm14({typed:ts}),ds=createCeilNumber({typed:ts,config:rs,round:ns});return ts("ceil",{number:ds.signatures.number,"number,number":ds.signatures["number,number"],Complex:function(fs){return fs.ceil()},"Complex, number":function(fs,hs){return fs.ceil(hs)},"Complex, BigNumber":function(fs,hs){return fs.ceil(hs.toNumber())},BigNumber:function(fs){return nearlyEqual(fs,ns(fs),rs.epsilon)?ns(fs):fs.ceil()},"BigNumber, BigNumber":function(fs,hs){return nearlyEqual(fs,ns(fs,hs),rs.epsilon)?ns(fs,hs):fs.toDecimalPlaces(hs.toNumber(),Decimal.ROUND_CEIL)},Fraction:function(fs){return fs.ceil()},"Fraction, number":function(fs,hs){return fs.ceil(hs)},"Fraction, BigNumber":function(fs,hs){return fs.ceil(hs.toNumber())},"Array | Matrix":function(fs){return deepMap(fs,this)},"Array, number | BigNumber":function(fs,hs){return deepMap(fs,ys=>this(ys,hs))},"SparseMatrix, number | BigNumber":function(fs,hs){return us(fs,hs,this,!1)},"DenseMatrix, number | BigNumber":function(fs,hs){return ps(fs,hs,this,!1)},"number | Complex | Fraction | BigNumber, Array":function(fs,hs){return ps(is(hs),fs,this,!0).valueOf()},"number | Complex | Fraction | BigNumber, Matrix":function(fs,hs){return as(fs,0)?os(hs.size(),hs.storage()):hs.storage()==="dense"?ps(hs,fs,this,!0):cs(hs,fs,this,!0)}})}),name$3$="cube",dependencies$3$=["typed"],createCube=factory(name$3$,dependencies$3$,ss=>{var{typed:ts}=ss;return ts(name$3$,{number:cubeNumber,Complex:function(rs){return rs.mul(rs).mul(rs)},BigNumber:function(rs){return rs.times(rs).times(rs)},Fraction:function(rs){return rs.pow(3)},"Array | Matrix":function(rs){return deepMap(rs,this)},Unit:function(rs){return rs.pow(3)}})}),name$3_="exp",dependencies$3_=["typed"],createExp=factory(name$3_,dependencies$3_,ss=>{var{typed:ts}=ss;return ts(name$3_,{number:expNumber,Complex:function(rs){return rs.exp()},BigNumber:function(rs){return rs.exp()},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3Z="expm1",dependencies$3Z=["typed","Complex"],createExpm1=factory(name$3Z,dependencies$3Z,ss=>{var{typed:ts,Complex:rs}=ss;return ts(name$3Z,{number:expm1Number,Complex:function(ns){var is=Math.exp(ns.re);return new rs(is*Math.cos(ns.im)-1,is*Math.sin(ns.im))},BigNumber:function(ns){return ns.exp().minus(1)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$3Y="fix",dependencies$3Y=["typed","Complex","matrix","ceil","floor","equalScalar","zeros","DenseMatrix"],createFixNumber=factory(name$3Y,["typed","ceil","floor"],ss=>{var{typed:ts,ceil:rs,floor:ns}=ss;return ts(name$3Y,{number:function(is){return is>0?ns(is):rs(is)},"number, number":function(is,as){return is>0?ns(is,as):rs(is,as)}})}),createFix=factory(name$3Y,dependencies$3Y,ss=>{var{typed:ts,Complex:rs,matrix:ns,ceil:is,floor:as,equalScalar:os,zeros:ls,DenseMatrix:us}=ss,cs=createAlgorithm12({typed:ts,DenseMatrix:us}),ps=createAlgorithm14({typed:ts}),ds=createFixNumber({typed:ts,ceil:is,floor:as});return ts("fix",{number:ds.signatures.number,"number, number | BigNumber":ds.signatures["number,number"],Complex:function(fs){return new rs(fs.re>0?Math.floor(fs.re):Math.ceil(fs.re),fs.im>0?Math.floor(fs.im):Math.ceil(fs.im))},"Complex, number":function(fs,hs){return new rs(fs.re>0?as(fs.re,hs):is(fs.re,hs),fs.im>0?as(fs.im,hs):is(fs.im,hs))},"Complex, BigNumber":function(fs,hs){var ys=hs.toNumber();return new rs(fs.re>0?as(fs.re,ys):is(fs.re,ys),fs.im>0?as(fs.im,ys):is(fs.im,ys))},BigNumber:function(fs){return fs.isNegative()?is(fs):as(fs)},"BigNumber, number | BigNumber":function(fs,hs){return fs.isNegative()?is(fs,hs):as(fs,hs)},Fraction:function(fs){return fs.s<0?fs.ceil():fs.floor()},"Fraction, number | BigNumber":function(fs,hs){return fs.s<0?is(fs,hs):as(fs,hs)},"Array | Matrix":function(fs){return deepMap(fs,this)},"Array | Matrix, number | BigNumber":function(fs,hs){return deepMap(fs,ys=>this(ys,hs))},"number | Complex | Fraction | BigNumber, Array":function(fs,hs){return ps(ns(hs),fs,this,!0).valueOf()},"number | Complex | Fraction | BigNumber, Matrix":function(fs,hs){return os(fs,0)?ls(hs.size(),hs.storage()):hs.storage()==="dense"?ps(hs,fs,this,!0):cs(hs,fs,this,!0)}})}),name$3X="floor",dependencies$3X=["typed","config","round","matrix","equalScalar","zeros","DenseMatrix"],createFloorNumber=factory(name$3X,["typed","config","round"],ss=>{var{typed:ts,config:rs,round:ns}=ss;return ts(name$3X,{number:function(is){return nearlyEqual$1(is,ns(is),rs.epsilon)?ns(is):Math.floor(is)},"number, number":function(is,as){if(nearlyEqual$1(is,ns(is,as),rs.epsilon))return ns(is,as);var[os,ls]="".concat(is,"e").split("e"),us=Math.floor(Number("".concat(os,"e").concat(Number(ls)+as)));return[os,ls]="".concat(us,"e").split("e"),Number("".concat(os,"e").concat(Number(ls)-as))}})}),createFloor=factory(name$3X,dependencies$3X,ss=>{var{typed:ts,config:rs,round:ns,matrix:is,equalScalar:as,zeros:os,DenseMatrix:ls}=ss,us=createAlgorithm11({typed:ts,equalScalar:as}),cs=createAlgorithm12({typed:ts,DenseMatrix:ls}),ps=createAlgorithm14({typed:ts}),ds=createFloorNumber({typed:ts,config:rs,round:ns});return ts("floor",{number:ds.signatures.number,"number,number":ds.signatures["number,number"],Complex:function(fs){return fs.floor()},"Complex, number":function(fs,hs){return fs.floor(hs)},"Complex, BigNumber":function(fs,hs){return fs.floor(hs.toNumber())},BigNumber:function(fs){return nearlyEqual(fs,ns(fs),rs.epsilon)?ns(fs):fs.floor()},"BigNumber, BigNumber":function(fs,hs){return nearlyEqual(fs,ns(fs,hs),rs.epsilon)?ns(fs,hs):fs.toDecimalPlaces(hs.toNumber(),Decimal.ROUND_FLOOR)},Fraction:function(fs){return fs.floor()},"Fraction, number":function(fs,hs){return fs.floor(hs)},"Fraction, BigNumber":function(fs,hs){return fs.floor(hs.toNumber())},"Array | Matrix":function(fs){return deepMap(fs,this)},"Array, number | BigNumber":function(fs,hs){return deepMap(fs,ys=>this(ys,hs))},"SparseMatrix, number | BigNumber":function(fs,hs){return us(fs,hs,this,!1)},"DenseMatrix, number | BigNumber":function(fs,hs){return ps(fs,hs,this,!1)},"number | Complex | Fraction | BigNumber, Array":function(fs,hs){return ps(is(hs),fs,this,!0).valueOf()},"number | Complex | Fraction | BigNumber, Matrix":function(fs,hs){return as(fs,0)?os(hs.size(),hs.storage()):hs.storage()==="dense"?ps(hs,fs,this,!0):cs(hs,fs,this,!0)}})}),name$3W="algorithm01",dependencies$3W=["typed"],createAlgorithm01=factory(name$3W,dependencies$3W,ss=>{var{typed:ts}=ss;return function(rs,ns,is,as){var os=rs._data,ls=rs._size,us=rs._datatype,cs=ns._values,ps=ns._index,ds=ns._ptr,fs=ns._size,hs=ns._datatype;if(ls.length!==fs.length)throw new DimensionError(ls.length,fs.length);if(ls[0]!==fs[0]||ls[1]!==fs[1])throw new RangeError("Dimension mismatch. Matrix A ("+ls+") must match Matrix B ("+fs+")");if(!cs)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var ys,gs,bs=ls[0],vs=ls[1],Ns=typeof us=="string"&&us===hs?us:void 0,Ts=Ns?ts.find(is,[Ns,Ns]):is,Cs=[];for(ys=0;ys<bs;ys++)Cs[ys]=[];var xs=[],As=[];for(gs=0;gs<vs;gs++){for(var ws=gs+1,Es=ds[gs],Ss=ds[gs+1],Ds=Es;Ds<Ss;Ds++)xs[ys=ps[Ds]]=as?Ts(cs[Ds],os[ys][gs]):Ts(os[ys][gs],cs[Ds]),As[ys]=ws;for(ys=0;ys<bs;ys++)As[ys]===ws?Cs[ys][gs]=xs[ys]:Cs[ys][gs]=os[ys][gs]}return rs.createDenseMatrix({data:Cs,size:[bs,vs],datatype:Ns})}}),name$3V="algorithm04",dependencies$3V=["typed","equalScalar"],createAlgorithm04=factory(name$3V,dependencies$3V,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as){var os=ns._values,ls=ns._index,us=ns._ptr,cs=ns._size,ps=ns._datatype,ds=is._values,fs=is._index,hs=is._ptr,ys=is._size,gs=is._datatype;if(cs.length!==ys.length)throw new DimensionError(cs.length,ys.length);if(cs[0]!==ys[0]||cs[1]!==ys[1])throw new RangeError("Dimension mismatch. Matrix A ("+cs+") must match Matrix B ("+ys+")");var bs,vs=cs[0],Ns=cs[1],Ts=rs,Cs=0,xs=as;typeof ps=="string"&&ps===gs&&(bs=ps,Ts=ts.find(rs,[bs,bs]),Cs=ts.convert(0,bs),xs=ts.find(as,[bs,bs]));var As,ws,Es,Ss,Ds,Vs=os&&ds?[]:void 0,Is=[],Os=[],Ps=os&&ds?[]:void 0,$s=os&&ds?[]:void 0,Rs=[],ks=[];for(ws=0;ws<Ns;ws++){Os[ws]=Is.length;var _s=ws+1;for(Ss=us[ws],Ds=us[ws+1],Es=Ss;Es<Ds;Es++)As=ls[Es],Is.push(As),Rs[As]=_s,Ps&&(Ps[As]=os[Es]);for(Ss=hs[ws],Ds=hs[ws+1],Es=Ss;Es<Ds;Es++)if(Rs[As=fs[Es]]===_s){if(Ps){var Bs=xs(Ps[As],ds[Es]);Ts(Bs,Cs)?Rs[As]=null:Ps[As]=Bs}}else Is.push(As),ks[As]=_s,$s&&($s[As]=ds[Es]);if(Ps&&$s)for(Es=Os[ws];Es<Is.length;)Rs[As=Is[Es]]===_s?(Vs[Es]=Ps[As],Es++):ks[As]===_s?(Vs[Es]=$s[As],Es++):Is.splice(Es,1)}return Os[Ns]=Is.length,ns.createSparseMatrix({values:Vs,index:Is,ptr:Os,size:[vs,Ns],datatype:bs})}}),name$3U="algorithm10",dependencies$3U=["typed","DenseMatrix"],createAlgorithm10=factory(name$3U,dependencies$3U,ss=>{var{typed:ts,DenseMatrix:rs}=ss;return function(ns,is,as,os){var ls=ns._values,us=ns._index,cs=ns._ptr,ps=ns._size,ds=ns._datatype;if(!ls)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var fs,hs=ps[0],ys=ps[1],gs=as;typeof ds=="string"&&(fs=ds,is=ts.convert(is,fs),gs=ts.find(as,[fs,fs]));for(var bs=[],vs=[],Ns=[],Ts=0;Ts<ys;Ts++){for(var Cs=Ts+1,xs=cs[Ts],As=cs[Ts+1],ws=xs;ws<As;ws++){var Es=us[ws];vs[Es]=ls[ws],Ns[Es]=Cs}for(var Ss=0;Ss<hs;Ss++)Ts===0&&(bs[Ss]=[]),Ns[Ss]===Cs?bs[Ss][Ts]=os?gs(is,vs[Ss]):gs(vs[Ss],is):bs[Ss][Ts]=is}return new rs({data:bs,size:[hs,ys],datatype:fs})}}),name$3T="algorithm13",dependencies$3T=["typed"],createAlgorithm13=factory(name$3T,dependencies$3T,ss=>{var{typed:ts}=ss;return function(ns,is,as){var os,ls=ns._data,us=ns._size,cs=ns._datatype,ps=is._data,ds=is._size,fs=is._datatype,hs=[];if(us.length!==ds.length)throw new DimensionError(us.length,ds.length);for(var ys=0;ys<us.length;ys++){if(us[ys]!==ds[ys])throw new RangeError("Dimension mismatch. Matrix A ("+us+") must match Matrix B ("+ds+")");hs[ys]=us[ys]}var gs=as;typeof cs=="string"&&cs===fs&&(os=cs,gs=ts.find(as,[os,os]));var bs=hs.length>0?rs(gs,0,hs,hs[0],ls,ps):[];return ns.createDenseMatrix({data:bs,size:hs,datatype:os})};function rs(ns,is,as,os,ls,us){var cs=[];if(is===as.length-1)for(var ps=0;ps<os;ps++)cs[ps]=ns(ls[ps],us[ps]);else for(var ds=0;ds<os;ds++)cs[ds]=rs(ns,is+1,as,as[is+1],ls[ds],us[ds]);return cs}}),name$3S="gcd",dependencies$3S=["typed","matrix","equalScalar","BigNumber","DenseMatrix"],createGcd=factory(name$3S,dependencies$3S,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,BigNumber:is,DenseMatrix:as}=ss,os=createAlgorithm01({typed:ts}),ls=createAlgorithm04({typed:ts,equalScalar:ns}),us=createAlgorithm10({typed:ts,DenseMatrix:as}),cs=createAlgorithm13({typed:ts}),ps=createAlgorithm14({typed:ts});return ts(name$3S,{"number, number":gcdNumber,"BigNumber, BigNumber":function(ds,fs){if(!ds.isInt()||!fs.isInt())throw new Error("Parameters in function gcd must be integer numbers");for(var hs=new is(0);!fs.isZero();){var ys=ds.mod(fs);ds=fs,fs=ys}return ds.lt(hs)?ds.neg():ds},"Fraction, Fraction":function(ds,fs){return ds.gcd(fs)},"SparseMatrix, SparseMatrix":function(ds,fs){return ls(ds,fs,this)},"SparseMatrix, DenseMatrix":function(ds,fs){return os(fs,ds,this,!0)},"DenseMatrix, SparseMatrix":function(ds,fs){return os(ds,fs,this,!1)},"DenseMatrix, DenseMatrix":function(ds,fs){return cs(ds,fs,this)},"Array, Array":function(ds,fs){return this(rs(ds),rs(fs)).valueOf()},"Array, Matrix":function(ds,fs){return this(rs(ds),fs)},"Matrix, Array":function(ds,fs){return this(ds,rs(fs))},"SparseMatrix, number | BigNumber":function(ds,fs){return us(ds,fs,this,!1)},"DenseMatrix, number | BigNumber":function(ds,fs){return ps(ds,fs,this,!1)},"number | BigNumber, SparseMatrix":function(ds,fs){return us(fs,ds,this,!0)},"number | BigNumber, DenseMatrix":function(ds,fs){return ps(fs,ds,this,!0)},"Array, number | BigNumber":function(ds,fs){return ps(rs(ds),fs,this,!1).valueOf()},"number | BigNumber, Array":function(ds,fs){return ps(rs(fs),ds,this,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(ds,fs,hs){for(var ys=this(ds,fs),gs=0;gs<hs.length;gs++)ys=this(ys,hs[gs]);return ys}})}),name$3R="algorithm02",dependencies$3R=["typed","equalScalar"],createAlgorithm02=factory(name$3R,dependencies$3R,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as,os){var ls=ns._data,us=ns._size,cs=ns._datatype,ps=is._values,ds=is._index,fs=is._ptr,hs=is._size,ys=is._datatype;if(us.length!==hs.length)throw new DimensionError(us.length,hs.length);if(us[0]!==hs[0]||us[1]!==hs[1])throw new RangeError("Dimension mismatch. Matrix A ("+us+") must match Matrix B ("+hs+")");if(!ps)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var gs,bs=us[0],vs=us[1],Ns=rs,Ts=0,Cs=as;typeof cs=="string"&&cs===ys&&(gs=cs,Ns=ts.find(rs,[gs,gs]),Ts=ts.convert(0,gs),Cs=ts.find(as,[gs,gs]));for(var xs=[],As=[],ws=[],Es=0;Es<vs;Es++){ws[Es]=As.length;for(var Ss=fs[Es],Ds=fs[Es+1],Vs=Ss;Vs<Ds;Vs++){var Is=ds[Vs],Os=os?Cs(ps[Vs],ls[Is][Es]):Cs(ls[Is][Es],ps[Vs]);Ns(Os,Ts)||(As.push(Is),xs.push(Os))}}return ws[vs]=As.length,is.createSparseMatrix({values:xs,index:As,ptr:ws,size:[bs,vs],datatype:gs})}}),name$3Q="algorithm06",dependencies$3Q=["typed","equalScalar"],createAlgorithm06=factory(name$3Q,dependencies$3Q,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as){var os=ns._values,ls=ns._size,us=ns._datatype,cs=is._values,ps=is._size,ds=is._datatype;if(ls.length!==ps.length)throw new DimensionError(ls.length,ps.length);if(ls[0]!==ps[0]||ls[1]!==ps[1])throw new RangeError("Dimension mismatch. Matrix A ("+ls+") must match Matrix B ("+ps+")");var fs,hs=ls[0],ys=ls[1],gs=rs,bs=0,vs=as;typeof us=="string"&&us===ds&&(fs=us,gs=ts.find(rs,[fs,fs]),bs=ts.convert(0,fs),vs=ts.find(as,[fs,fs]));for(var Ns=os&&cs?[]:void 0,Ts=[],Cs=[],xs=Ns?[]:void 0,As=[],ws=[],Es=0;Es<ys;Es++){Cs[Es]=Ts.length;var Ss=Es+1;if(scatter(ns,Es,As,xs,ws,Ss,Ts,vs),scatter(is,Es,As,xs,ws,Ss,Ts,vs),xs)for(var Ds=Cs[Es];Ds<Ts.length;){var Vs=Ts[Ds];if(ws[Vs]===Ss){var Is=xs[Vs];gs(Is,bs)?Ts.splice(Ds,1):(Ns.push(Is),Ds++)}else Ts.splice(Ds,1)}else for(var Os=Cs[Es];Os<Ts.length;)ws[Ts[Os]]!==Ss?Ts.splice(Os,1):Os++}return Cs[ys]=Ts.length,ns.createSparseMatrix({values:Ns,index:Ts,ptr:Cs,size:[hs,ys],datatype:fs})}}),name$3P="lcm",dependencies$3P=["typed","matrix","equalScalar"],createLcm=factory(name$3P,dependencies$3P,ss=>{var{typed:ts,matrix:rs,equalScalar:ns}=ss,is=createAlgorithm02({typed:ts,equalScalar:ns}),as=createAlgorithm06({typed:ts,equalScalar:ns}),os=createAlgorithm11({typed:ts,equalScalar:ns}),ls=createAlgorithm13({typed:ts}),us=createAlgorithm14({typed:ts});return ts(name$3P,{"number, number":lcmNumber,"BigNumber, BigNumber":function(cs,ps){if(!cs.isInt()||!ps.isInt())throw new Error("Parameters in function lcm must be integer numbers");if(cs.isZero())return cs;if(ps.isZero())return ps;for(var ds=cs.times(ps);!ps.isZero();){var fs=ps;ps=cs.mod(fs),cs=fs}return ds.div(cs).abs()},"Fraction, Fraction":function(cs,ps){return cs.lcm(ps)},"SparseMatrix, SparseMatrix":function(cs,ps){return as(cs,ps,this)},"SparseMatrix, DenseMatrix":function(cs,ps){return is(ps,cs,this,!0)},"DenseMatrix, SparseMatrix":function(cs,ps){return is(cs,ps,this,!1)},"DenseMatrix, DenseMatrix":function(cs,ps){return ls(cs,ps,this)},"Array, Array":function(cs,ps){return this(rs(cs),rs(ps)).valueOf()},"Array, Matrix":function(cs,ps){return this(rs(cs),ps)},"Matrix, Array":function(cs,ps){return this(cs,rs(ps))},"SparseMatrix, number | BigNumber":function(cs,ps){return os(cs,ps,this,!1)},"DenseMatrix, number | BigNumber":function(cs,ps){return us(cs,ps,this,!1)},"number | BigNumber, SparseMatrix":function(cs,ps){return os(ps,cs,this,!0)},"number | BigNumber, DenseMatrix":function(cs,ps){return us(ps,cs,this,!0)},"Array, number | BigNumber":function(cs,ps){return us(rs(cs),ps,this,!1).valueOf()},"number | BigNumber, Array":function(cs,ps){return us(rs(ps),cs,this,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(cs,ps,ds){for(var fs=this(cs,ps),hs=0;hs<ds.length;hs++)fs=this(fs,ds[hs]);return fs}})}),name$3O="log10",dependencies$3O=["typed","config","Complex"],createLog10=factory(name$3O,dependencies$3O,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$3O,{number:function(is){return is>=0||rs.predictable?log10Number(is):new ns(is,0).log().div(Math.LN10)},Complex:function(is){return new ns(is).log().div(Math.LN10)},BigNumber:function(is){return!is.isNegative()||rs.predictable?is.log():new ns(is.toNumber(),0).log().div(Math.LN10)},"Array | Matrix":function(is){return deepMap(is,this)}})}),name$3N="log2",dependencies$3N=["typed","config","Complex"],createLog2=factory(name$3N,dependencies$3N,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$3N,{number:function(as){return as>=0||rs.predictable?log2Number(as):is(new ns(as,0))},Complex:is,BigNumber:function(as){return!as.isNegative()||rs.predictable?as.log(2):is(new ns(as.toNumber(),0))},"Array | Matrix":function(as){return deepMap(as,this)}});function is(as){var os=Math.sqrt(as.re*as.re+as.im*as.im);return new ns(Math.log2?Math.log2(os):Math.log(os)/Math.LN2,Math.atan2(as.im,as.re)/Math.LN2)}}),name$3M="algorithm03",dependencies$3M=["typed"],createAlgorithm03=factory(name$3M,dependencies$3M,ss=>{var{typed:ts}=ss;return function(rs,ns,is,as){var os=rs._data,ls=rs._size,us=rs._datatype,cs=ns._values,ps=ns._index,ds=ns._ptr,fs=ns._size,hs=ns._datatype;if(ls.length!==fs.length)throw new DimensionError(ls.length,fs.length);if(ls[0]!==fs[0]||ls[1]!==fs[1])throw new RangeError("Dimension mismatch. Matrix A ("+ls+") must match Matrix B ("+fs+")");if(!cs)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var ys,gs=ls[0],bs=ls[1],vs=0,Ns=is;typeof us=="string"&&us===hs&&(ys=us,vs=ts.convert(0,ys),Ns=ts.find(is,[ys,ys]));for(var Ts=[],Cs=0;Cs<gs;Cs++)Ts[Cs]=[];for(var xs=[],As=[],ws=0;ws<bs;ws++){for(var Es=ws+1,Ss=ds[ws],Ds=ds[ws+1],Vs=Ss;Vs<Ds;Vs++){var Is=ps[Vs];xs[Is]=as?Ns(cs[Vs],os[Is][ws]):Ns(os[Is][ws],cs[Vs]),As[Is]=Es}for(var Os=0;Os<gs;Os++)As[Os]===Es?Ts[Os][ws]=xs[Os]:Ts[Os][ws]=as?Ns(vs,os[Os][ws]):Ns(os[Os][ws],vs)}return rs.createDenseMatrix({data:Ts,size:[gs,bs],datatype:ys})}}),name$3L="algorithm05",dependencies$3L=["typed","equalScalar"],createAlgorithm05=factory(name$3L,dependencies$3L,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as){var os=ns._values,ls=ns._index,us=ns._ptr,cs=ns._size,ps=ns._datatype,ds=is._values,fs=is._index,hs=is._ptr,ys=is._size,gs=is._datatype;if(cs.length!==ys.length)throw new DimensionError(cs.length,ys.length);if(cs[0]!==ys[0]||cs[1]!==ys[1])throw new RangeError("Dimension mismatch. Matrix A ("+cs+") must match Matrix B ("+ys+")");var bs,vs=cs[0],Ns=cs[1],Ts=rs,Cs=0,xs=as;typeof ps=="string"&&ps===gs&&(bs=ps,Ts=ts.find(rs,[bs,bs]),Cs=ts.convert(0,bs),xs=ts.find(as,[bs,bs]));var As,ws,Es,Ss,Ds=os&&ds?[]:void 0,Vs=[],Is=[],Os=Ds?[]:void 0,Ps=Ds?[]:void 0,$s=[],Rs=[];for(ws=0;ws<Ns;ws++){Is[ws]=Vs.length;var ks=ws+1;for(Es=us[ws],Ss=us[ws+1];Es<Ss;Es++)As=ls[Es],Vs.push(As),$s[As]=ks,Os&&(Os[As]=os[Es]);for(Es=hs[ws],Ss=hs[ws+1];Es<Ss;Es++)$s[As=fs[Es]]!==ks&&Vs.push(As),Rs[As]=ks,Ps&&(Ps[As]=ds[Es]);if(Ds)for(Es=Is[ws];Es<Vs.length;){var _s=$s[As=Vs[Es]],Bs=Rs[As];if(_s===ks||Bs===ks){var Us=xs(_s===ks?Os[As]:Cs,Bs===ks?Ps[As]:Cs);Ts(Us,Cs)?Vs.splice(Es,1):(Ds.push(Us),Es++)}}}return Is[Ns]=Vs.length,ns.createSparseMatrix({values:Ds,index:Vs,ptr:Is,size:[vs,Ns],datatype:bs})}}),name$3K="mod",dependencies$3K=["typed","matrix","equalScalar","DenseMatrix"],createMod=factory(name$3K,dependencies$3K,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,DenseMatrix:is}=ss,as=createAlgorithm02({typed:ts,equalScalar:ns}),os=createAlgorithm03({typed:ts}),ls=createAlgorithm05({typed:ts,equalScalar:ns}),us=createAlgorithm11({typed:ts,equalScalar:ns}),cs=createAlgorithm12({typed:ts,DenseMatrix:is}),ps=createAlgorithm13({typed:ts}),ds=createAlgorithm14({typed:ts});return ts(name$3K,{"number, number":modNumber,"BigNumber, BigNumber":function(fs,hs){if(hs.isNeg())throw new Error("Cannot calculate mod for a negative divisor");return hs.isZero()?fs:fs.mod(hs)},"Fraction, Fraction":function(fs,hs){if(hs.compare(0)<0)throw new Error("Cannot calculate mod for a negative divisor");return fs.compare(0)>=0?fs.mod(hs):fs.mod(hs).add(hs).mod(hs)},"SparseMatrix, SparseMatrix":function(fs,hs){return ls(fs,hs,this,!1)},"SparseMatrix, DenseMatrix":function(fs,hs){return as(hs,fs,this,!0)},"DenseMatrix, SparseMatrix":function(fs,hs){return os(fs,hs,this,!1)},"DenseMatrix, DenseMatrix":function(fs,hs){return ps(fs,hs,this)},"Array, Array":function(fs,hs){return this(rs(fs),rs(hs)).valueOf()},"Array, Matrix":function(fs,hs){return this(rs(fs),hs)},"Matrix, Array":function(fs,hs){return this(fs,rs(hs))},"SparseMatrix, any":function(fs,hs){return us(fs,hs,this,!1)},"DenseMatrix, any":function(fs,hs){return ds(fs,hs,this,!1)},"any, SparseMatrix":function(fs,hs){return cs(hs,fs,this,!0)},"any, DenseMatrix":function(fs,hs){return ds(hs,fs,this,!0)},"Array, any":function(fs,hs){return ds(rs(fs),hs,this,!1).valueOf()},"any, Array":function(fs,hs){return ds(rs(hs),fs,this,!0).valueOf()}})}),name$3J="multiplyScalar",dependencies$3J=["typed"],createMultiplyScalar=factory(name$3J,dependencies$3J,ss=>{var{typed:ts}=ss;return ts("multiplyScalar",{"number, number":multiplyNumber,"Complex, Complex":function(rs,ns){return rs.mul(ns)},"BigNumber, BigNumber":function(rs,ns){return rs.times(ns)},"Fraction, Fraction":function(rs,ns){return rs.mul(ns)},"number | Fraction | BigNumber | Complex, Unit":function(rs,ns){var is=ns.clone();return is.value=is.value===null?is._normalize(rs):this(is.value,rs),is},"Unit, number | Fraction | BigNumber | Complex":function(rs,ns){var is=rs.clone();return is.value=is.value===null?is._normalize(ns):this(is.value,ns),is},"Unit, Unit":function(rs,ns){return rs.multiply(ns)}})}),name$3I="multiply",dependencies$3I=["typed","matrix","addScalar","multiplyScalar","equalScalar","dot"],createMultiply=factory(name$3I,dependencies$3I,ss=>{var{typed:ts,matrix:rs,addScalar:ns,multiplyScalar:is,equalScalar:as,dot:os}=ss,ls=createAlgorithm11({typed:ts,equalScalar:as}),us=createAlgorithm14({typed:ts});function cs(hs,ys){switch(hs.length){case 1:switch(ys.length){case 1:if(hs[0]!==ys[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(hs[0]!==ys[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+hs[0]+") must match Matrix rows ("+ys[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+ys.length+" dimensions)")}break;case 2:switch(ys.length){case 1:if(hs[1]!==ys[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+hs[1]+") must match Vector length ("+ys[0]+")");break;case 2:if(hs[1]!==ys[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+hs[1]+") must match Matrix B rows ("+ys[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+ys.length+" dimensions)")}break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+hs.length+" dimensions)")}}function ps(hs,ys){if(ys.storage()!=="dense")throw new Error("Support for SparseMatrix not implemented");return function(gs,bs){var vs,Ns=gs._data,Ts=gs._size,Cs=gs._datatype,xs=bs._data,As=bs._size,ws=bs._datatype,Es=Ts[0],Ss=As[1],Ds=ns,Vs=is;Cs&&ws&&Cs===ws&&typeof Cs=="string"&&(vs=Cs,Ds=ts.find(ns,[vs,vs]),Vs=ts.find(is,[vs,vs]));for(var Is=[],Os=0;Os<Ss;Os++){for(var Ps=Vs(Ns[0],xs[0][Os]),$s=1;$s<Es;$s++)Ps=Ds(Ps,Vs(Ns[$s],xs[$s][Os]));Is[Os]=Ps}return gs.createDenseMatrix({data:Is,size:[Ss],datatype:vs})}(hs,ys)}var ds=ts("_multiplyMatrixVector",{"DenseMatrix, any":function(hs,ys){var gs,bs=hs._data,vs=hs._size,Ns=hs._datatype,Ts=ys._data,Cs=ys._datatype,xs=vs[0],As=vs[1],ws=ns,Es=is;Ns&&Cs&&Ns===Cs&&typeof Ns=="string"&&(gs=Ns,ws=ts.find(ns,[gs,gs]),Es=ts.find(is,[gs,gs]));for(var Ss=[],Ds=0;Ds<xs;Ds++){for(var Vs=bs[Ds],Is=Es(Vs[0],Ts[0]),Os=1;Os<As;Os++)Is=ws(Is,Es(Vs[Os],Ts[Os]));Ss[Ds]=Is}return hs.createDenseMatrix({data:Ss,size:[xs],datatype:gs})},"SparseMatrix, any":function(hs,ys){var gs=hs._values,bs=hs._index,vs=hs._ptr,Ns=hs._datatype;if(!gs)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var Ts,Cs=ys._data,xs=ys._datatype,As=hs._size[0],ws=ys._size[0],Es=[],Ss=[],Ds=[],Vs=ns,Is=is,Os=as,Ps=0;Ns&&xs&&Ns===xs&&typeof Ns=="string"&&(Ts=Ns,Vs=ts.find(ns,[Ts,Ts]),Is=ts.find(is,[Ts,Ts]),Os=ts.find(as,[Ts,Ts]),Ps=ts.convert(0,Ts));var $s=[],Rs=[];Ds[0]=0;for(var ks=0;ks<ws;ks++){var _s=Cs[ks];if(!Os(_s,Ps))for(var Bs=vs[ks],Us=vs[ks+1],zs=Bs;zs<Us;zs++){var Hs=bs[zs];Rs[Hs]?$s[Hs]=Vs($s[Hs],Is(_s,gs[zs])):(Rs[Hs]=!0,Ss.push(Hs),$s[Hs]=Is(_s,gs[zs]))}}for(var el=Ss.length,Ys=0;Ys<el;Ys++){var il=Ss[Ys];Es[Ys]=$s[il]}return Ds[1]=Ss.length,hs.createSparseMatrix({values:Es,index:Ss,ptr:Ds,size:[As,1],datatype:Ts})}}),fs=ts("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(hs,ys){var gs,bs=hs._data,vs=hs._size,Ns=hs._datatype,Ts=ys._data,Cs=ys._size,xs=ys._datatype,As=vs[0],ws=vs[1],Es=Cs[1],Ss=ns,Ds=is;Ns&&xs&&Ns===xs&&typeof Ns=="string"&&(gs=Ns,Ss=ts.find(ns,[gs,gs]),Ds=ts.find(is,[gs,gs]));for(var Vs=[],Is=0;Is<As;Is++){var Os=bs[Is];Vs[Is]=[];for(var Ps=0;Ps<Es;Ps++){for(var $s=Ds(Os[0],Ts[0][Ps]),Rs=1;Rs<ws;Rs++)$s=Ss($s,Ds(Os[Rs],Ts[Rs][Ps]));Vs[Is][Ps]=$s}}return hs.createDenseMatrix({data:Vs,size:[As,Es],datatype:gs})},"DenseMatrix, SparseMatrix":function(hs,ys){var gs=hs._data,bs=hs._size,vs=hs._datatype,Ns=ys._values,Ts=ys._index,Cs=ys._ptr,xs=ys._size,As=ys._datatype;if(!Ns)throw new Error("Cannot multiply Dense Matrix times Pattern only Matrix");var ws,Es=bs[0],Ss=xs[1],Ds=ns,Vs=is,Is=as,Os=0;vs&&As&&vs===As&&typeof vs=="string"&&(ws=vs,Ds=ts.find(ns,[ws,ws]),Vs=ts.find(is,[ws,ws]),Is=ts.find(as,[ws,ws]),Os=ts.convert(0,ws));for(var Ps=[],$s=[],Rs=[],ks=ys.createSparseMatrix({values:Ps,index:$s,ptr:Rs,size:[Es,Ss],datatype:ws}),_s=0;_s<Ss;_s++){Rs[_s]=$s.length;var Bs=Cs[_s],Us=Cs[_s+1];if(Us>Bs)for(var zs=0,Hs=0;Hs<Es;Hs++){for(var el=Hs+1,Ys=void 0,il=Bs;il<Us;il++){var al=Ts[il];zs!==el?(Ys=Vs(gs[Hs][al],Ns[il]),zs=el):Ys=Ds(Ys,Vs(gs[Hs][al],Ns[il]))}zs!==el||Is(Ys,Os)||($s.push(Hs),Ps.push(Ys))}}return Rs[Ss]=$s.length,ks},"SparseMatrix, DenseMatrix":function(hs,ys){var gs=hs._values,bs=hs._index,vs=hs._ptr,Ns=hs._datatype;if(!gs)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var Ts,Cs=ys._data,xs=ys._datatype,As=hs._size[0],ws=ys._size[0],Es=ys._size[1],Ss=ns,Ds=is,Vs=as,Is=0;Ns&&xs&&Ns===xs&&typeof Ns=="string"&&(Ts=Ns,Ss=ts.find(ns,[Ts,Ts]),Ds=ts.find(is,[Ts,Ts]),Vs=ts.find(as,[Ts,Ts]),Is=ts.convert(0,Ts));for(var Os=[],Ps=[],$s=[],Rs=hs.createSparseMatrix({values:Os,index:Ps,ptr:$s,size:[As,Es],datatype:Ts}),ks=[],_s=[],Bs=0;Bs<Es;Bs++){$s[Bs]=Ps.length;for(var Us=Bs+1,zs=0;zs<ws;zs++){var Hs=Cs[zs][Bs];if(!Vs(Hs,Is))for(var el=vs[zs],Ys=vs[zs+1],il=el;il<Ys;il++){var al=bs[il];_s[al]!==Us?(_s[al]=Us,Ps.push(al),ks[al]=Ds(Hs,gs[il])):ks[al]=Ss(ks[al],Ds(Hs,gs[il]))}}for(var ll=$s[Bs],nl=Ps.length,cl=ll;cl<nl;cl++){var dl=Ps[cl];Os[cl]=ks[dl]}}return $s[Es]=Ps.length,Rs},"SparseMatrix, SparseMatrix":function(hs,ys){var gs,bs=hs._values,vs=hs._index,Ns=hs._ptr,Ts=hs._datatype,Cs=ys._values,xs=ys._index,As=ys._ptr,ws=ys._datatype,Es=hs._size[0],Ss=ys._size[1],Ds=bs&&Cs,Vs=ns,Is=is;Ts&&ws&&Ts===ws&&typeof Ts=="string"&&(gs=Ts,Vs=ts.find(ns,[gs,gs]),Is=ts.find(is,[gs,gs]));for(var Os,Ps,$s,Rs,ks,_s,Bs,Us,zs=Ds?[]:void 0,Hs=[],el=[],Ys=hs.createSparseMatrix({values:zs,index:Hs,ptr:el,size:[Es,Ss],datatype:gs}),il=Ds?[]:void 0,al=[],ll=0;ll<Ss;ll++){el[ll]=Hs.length;var nl=ll+1;for(ks=As[ll],_s=As[ll+1],Rs=ks;Rs<_s;Rs++)if(Us=xs[Rs],Ds)for(Ps=Ns[Us],$s=Ns[Us+1],Os=Ps;Os<$s;Os++)al[Bs=vs[Os]]!==nl?(al[Bs]=nl,Hs.push(Bs),il[Bs]=Is(Cs[Rs],bs[Os])):il[Bs]=Vs(il[Bs],Is(Cs[Rs],bs[Os]));else for(Ps=Ns[Us],$s=Ns[Us+1],Os=Ps;Os<$s;Os++)al[Bs=vs[Os]]!==nl&&(al[Bs]=nl,Hs.push(Bs));if(Ds)for(var cl=el[ll],dl=Hs.length,sl=cl;sl<dl;sl++){var js=Hs[sl];zs[sl]=il[js]}}return el[Ss]=Hs.length,Ys}});return ts(name$3I,extend$2({"Array, Array":function(hs,ys){cs(arraySize(hs),arraySize(ys));var gs=this(rs(hs),rs(ys));return isMatrix(gs)?gs.valueOf():gs},"Matrix, Matrix":function(hs,ys){var gs=hs.size(),bs=ys.size();return cs(gs,bs),gs.length===1?bs.length===1?function(vs,Ns,Ts){if(Ts===0)throw new Error("Cannot multiply two empty vectors");return os(vs,Ns)}(hs,ys,gs[0]):ps(hs,ys):bs.length===1?ds(hs,ys):fs(hs,ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"Array, Matrix":function(hs,ys){return this(rs(hs,ys.storage()),ys)},"SparseMatrix, any":function(hs,ys){return ls(hs,ys,is,!1)},"DenseMatrix, any":function(hs,ys){return us(hs,ys,is,!1)},"any, SparseMatrix":function(hs,ys){return ls(ys,hs,is,!0)},"any, DenseMatrix":function(hs,ys){return us(ys,hs,is,!0)},"Array, any":function(hs,ys){return us(rs(hs),ys,is,!1).valueOf()},"any, Array":function(hs,ys){return us(rs(ys),hs,is,!0).valueOf()},"any, any":is,"any, any, ...any":function(hs,ys,gs){for(var bs=this(hs,ys),vs=0;vs<gs.length;vs++)bs=this(bs,gs[vs]);return bs}},is.signatures))}),name$3H="nthRoot",dependencies$3H=["typed","matrix","equalScalar","BigNumber"],createNthRoot=factory(name$3H,dependencies$3H,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,BigNumber:is}=ss,as=createAlgorithm01({typed:ts}),os=createAlgorithm02({typed:ts,equalScalar:ns}),ls=createAlgorithm06({typed:ts,equalScalar:ns}),us=createAlgorithm11({typed:ts,equalScalar:ns}),cs=createAlgorithm13({typed:ts}),ps=createAlgorithm14({typed:ts}),ds="Complex number not supported in function nthRoot. Use nthRoots instead.";return ts(name$3H,{number:nthRootNumber,"number, number":nthRootNumber,BigNumber:function(hs){return fs(hs,new is(2))},Complex:function(hs){throw new Error(ds)},"Complex, number":function(hs,ys){throw new Error(ds)},"BigNumber, BigNumber":fs,"Array | Matrix":function(hs){return this(hs,2)},"SparseMatrix, SparseMatrix":function(hs,ys){if(ys.density()===1)return ls(hs,ys,this);throw new Error("Root must be non-zero")},"SparseMatrix, DenseMatrix":function(hs,ys){return os(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){if(ys.density()===1)return as(hs,ys,this,!1);throw new Error("Root must be non-zero")},"DenseMatrix, DenseMatrix":function(hs,ys){return cs(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, number | BigNumber":function(hs,ys){return us(hs,ys,this,!1)},"DenseMatrix, number | BigNumber":function(hs,ys){return ps(hs,ys,this,!1)},"number | BigNumber, SparseMatrix":function(hs,ys){if(ys.density()===1)return us(ys,hs,this,!0);throw new Error("Root must be non-zero")},"number | BigNumber, DenseMatrix":function(hs,ys){return ps(ys,hs,this,!0)},"Array, number | BigNumber":function(hs,ys){return this(rs(hs),ys).valueOf()},"number | BigNumber, Array":function(hs,ys){return this(hs,rs(ys)).valueOf()}});function fs(hs,ys){var gs=is.precision,bs=is.clone({precision:gs+2}),vs=new is(0),Ns=new bs(1),Ts=ys.isNegative();if(Ts&&(ys=ys.neg()),ys.isZero())throw new Error("Root must be non-zero");if(hs.isNegative()&&!ys.abs().mod(2).equals(1))throw new Error("Root must be odd when a is negative.");if(hs.isZero())return Ts?new bs(1/0):0;if(!hs.isFinite())return Ts?vs:hs;var Cs=hs.abs().pow(Ns.div(ys));return Cs=hs.isNeg()?Cs.neg():Cs,new is((Ts?Ns.div(Cs):Cs).toPrecision(gs))}}),name$3G="sign",dependencies$3G=["typed","BigNumber","Fraction","complex"],createSign=factory(name$3G,dependencies$3G,ss=>{var{typed:ts,BigNumber:rs,complex:ns,Fraction:is}=ss;return ts(name$3G,{number:signNumber,Complex:function(as){return as.im===0?ns(signNumber(as.re)):as.sign()},BigNumber:function(as){return new rs(as.cmp(0))},Fraction:function(as){return new is(as.s,1)},"Array | Matrix":function(as){return deepMap(as,this)},Unit:function(as){if(!as._isDerived()&&as.units[0].unit.offset!==0)throw new TypeError("sign is ambiguous for units with offset");return this(as.value)}})}),name$3F="sqrt",dependencies$3F=["config","typed","Complex"],createSqrt=factory(name$3F,dependencies$3F,ss=>{var{config:ts,typed:rs,Complex:ns}=ss;return rs("sqrt",{number:is,Complex:function(as){return as.sqrt()},BigNumber:function(as){return!as.isNegative()||ts.predictable?as.sqrt():is(as.toNumber())},"Array | Matrix":function(as){return deepMap(as,this)},Unit:function(as){return as.pow(.5)}});function is(as){return isNaN(as)?NaN:as>=0||ts.predictable?Math.sqrt(as):new ns(as,0).sqrt()}}),name$3E="square",dependencies$3E=["typed"],createSquare=factory(name$3E,dependencies$3E,ss=>{var{typed:ts}=ss;return ts(name$3E,{number:squareNumber,Complex:function(rs){return rs.mul(rs)},BigNumber:function(rs){return rs.times(rs)},Fraction:function(rs){return rs.mul(rs)},"Array | Matrix":function(rs){return deepMap(rs,this)},Unit:function(rs){return rs.pow(2)}})}),name$3D="subtract",dependencies$3D=["typed","matrix","equalScalar","addScalar","unaryMinus","DenseMatrix"],createSubtract=factory(name$3D,dependencies$3D,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,addScalar:is,unaryMinus:as,DenseMatrix:os}=ss,ls=createAlgorithm01({typed:ts}),us=createAlgorithm03({typed:ts}),cs=createAlgorithm05({typed:ts,equalScalar:ns}),ps=createAlgorithm10({typed:ts,DenseMatrix:os}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$3D,{"number, number":function(hs,ys){return hs-ys},"Complex, Complex":function(hs,ys){return hs.sub(ys)},"BigNumber, BigNumber":function(hs,ys){return hs.minus(ys)},"Fraction, Fraction":function(hs,ys){return hs.sub(ys)},"Unit, Unit":function(hs,ys){if(hs.value===null)throw new Error("Parameter x contains a unit with undefined value");if(ys.value===null)throw new Error("Parameter y contains a unit with undefined value");if(!hs.equalBase(ys))throw new Error("Units do not match");var gs=hs.clone();return gs.value=this(gs.value,ys.value),gs.fixPrefix=!1,gs},"SparseMatrix, SparseMatrix":function(hs,ys){return checkEqualDimensions(hs,ys),cs(hs,ys,this)},"SparseMatrix, DenseMatrix":function(hs,ys){return checkEqualDimensions(hs,ys),us(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return checkEqualDimensions(hs,ys),ls(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return checkEqualDimensions(hs,ys),ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, any":function(hs,ys){return ps(hs,as(ys),is)},"DenseMatrix, any":function(hs,ys){return fs(hs,ys,this)},"any, SparseMatrix":function(hs,ys){return ps(ys,hs,this,!0)},"any, DenseMatrix":function(hs,ys){return fs(ys,hs,this,!0)},"Array, any":function(hs,ys){return fs(rs(hs),ys,this,!1).valueOf()},"any, Array":function(hs,ys){return fs(rs(ys),hs,this,!0).valueOf()}})});function checkEqualDimensions(ss,ts){var rs=ss.size(),ns=ts.size();if(rs.length!==ns.length)throw new DimensionError(rs.length,ns.length)}var name$3C="xgcd",dependencies$3C=["typed","config","matrix","BigNumber"],createXgcd=factory(name$3C,dependencies$3C,ss=>{var{typed:ts,config:rs,matrix:ns,BigNumber:is}=ss;return ts(name$3C,{"number, number":function(as,os){var ls=xgcdNumber(as,os);return rs.matrix==="Array"?ls:ns(ls)},"BigNumber, BigNumber":function(as,os){var ls,us,cs,ps,ds=new is(0),fs=new is(1),hs=ds,ys=fs,gs=fs,bs=ds;if(!as.isInt()||!os.isInt())throw new Error("Parameters in function xgcd must be integer numbers");for(;!os.isZero();)us=as.div(os).floor(),cs=as.mod(os),ls=hs,hs=ys.minus(us.times(hs)),ys=ls,ls=gs,gs=bs.minus(us.times(gs)),bs=ls,as=os,os=cs;return ps=as.lt(ds)?[as.neg(),ys.neg(),bs.neg()]:[as,as.isZero()?0:ys,bs],rs.matrix==="Array"?ps:ns(ps)}})}),name$3B="invmod",dependencies$3B=["typed","config","BigNumber","xgcd","equal","smaller","mod","add","isInteger"],createInvmod=factory(name$3B,dependencies$3B,ss=>{var{typed:ts,config:rs,BigNumber:ns,xgcd:is,equal:as,smaller:os,mod:ls,add:us,isInteger:cs}=ss;return ts(name$3B,{"number, number":ps,"BigNumber, BigNumber":ps});function ps(ds,fs){if(!cs(ds)||!cs(fs))throw new Error("Parameters in function invmod must be integer numbers");if(ds=ls(ds,fs),as(fs,0))throw new Error("Divisor must be non zero");var hs=is(ds,fs);hs=hs.valueOf();var[ys,gs]=hs;return as(ys,ns(1))?(gs=ls(gs,fs),os(gs,ns(0))&&(gs=us(gs,fs)),gs):NaN}}),name$3A="algorithm09",dependencies$3A=["typed","equalScalar"],createAlgorithm09=factory(name$3A,dependencies$3A,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as){var os=ns._values,ls=ns._index,us=ns._ptr,cs=ns._size,ps=ns._datatype,ds=is._values,fs=is._index,hs=is._ptr,ys=is._size,gs=is._datatype;if(cs.length!==ys.length)throw new DimensionError(cs.length,ys.length);if(cs[0]!==ys[0]||cs[1]!==ys[1])throw new RangeError("Dimension mismatch. Matrix A ("+cs+") must match Matrix B ("+ys+")");var bs,vs=cs[0],Ns=cs[1],Ts=rs,Cs=0,xs=as;typeof ps=="string"&&ps===gs&&(bs=ps,Ts=ts.find(rs,[bs,bs]),Cs=ts.convert(0,bs),xs=ts.find(as,[bs,bs]));var As,ws,Es,Ss,Ds,Vs=os&&ds?[]:void 0,Is=[],Os=[],Ps=Vs?[]:void 0,$s=[];for(ws=0;ws<Ns;ws++){Os[ws]=Is.length;var Rs=ws+1;if(Ps)for(Ss=hs[ws],Ds=hs[ws+1],Es=Ss;Es<Ds;Es++)$s[As=fs[Es]]=Rs,Ps[As]=ds[Es];for(Ss=us[ws],Ds=us[ws+1],Es=Ss;Es<Ds;Es++)if(As=ls[Es],Ps){var ks=$s[As]===Rs?Ps[As]:Cs,_s=xs(os[Es],ks);Ts(_s,Cs)||(Is.push(As),Vs.push(_s))}else Is.push(As)}return Os[Ns]=Is.length,ns.createSparseMatrix({values:Vs,index:Is,ptr:Os,size:[vs,Ns],datatype:bs})}}),name$3z="dotMultiply",dependencies$3z=["typed","matrix","equalScalar","multiplyScalar"],createDotMultiply=factory(name$3z,dependencies$3z,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,multiplyScalar:is}=ss,as=createAlgorithm02({typed:ts,equalScalar:ns}),os=createAlgorithm09({typed:ts,equalScalar:ns}),ls=createAlgorithm11({typed:ts,equalScalar:ns}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$3z,{"any, any":is,"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,is,!1)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,is,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,is,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,is)},"Array, Array":function(ps,ds){return this(rs(ps),rs(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(rs(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,rs(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,is,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,is,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,is,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,is,!0)},"Array, any":function(ps,ds){return cs(rs(ps),ds,is,!1).valueOf()},"any, Array":function(ps,ds){return cs(rs(ds),ps,is,!0).valueOf()}})});function bitAndBigNumber(ss,ts){if(ss.isFinite()&&!ss.isInteger()||ts.isFinite()&&!ts.isInteger())throw new Error("Integers expected in function bitAnd");var rs=ss.constructor;if(ss.isNaN()||ts.isNaN())return new rs(NaN);if(ss.isZero()||ts.eq(-1)||ss.eq(ts))return ss;if(ts.isZero()||ss.eq(-1))return ts;if(!ss.isFinite()||!ts.isFinite()){if(!ss.isFinite()&&!ts.isFinite())return ss.isNegative()===ts.isNegative()?ss:new rs(0);if(!ss.isFinite())return ts.isNegative()?ss:ss.isNegative()?new rs(0):ts;if(!ts.isFinite())return ss.isNegative()?ts:ts.isNegative()?new rs(0):ss}return bitwise(ss,ts,function(ns,is){return ns&is})}function bitNotBigNumber(ss){if(ss.isFinite()&&!ss.isInteger())throw new Error("Integer expected in function bitNot");var ts=ss.constructor,rs=ts.precision;ts.config({precision:1e9});var ns=ss.plus(new ts(1));return ns.s=-ns.s||null,ts.config({precision:rs}),ns}function bitOrBigNumber(ss,ts){if(ss.isFinite()&&!ss.isInteger()||ts.isFinite()&&!ts.isInteger())throw new Error("Integers expected in function bitOr");var rs=ss.constructor;if(ss.isNaN()||ts.isNaN())return new rs(NaN);var ns=new rs(-1);return ss.isZero()||ts.eq(ns)||ss.eq(ts)?ts:ts.isZero()||ss.eq(ns)?ss:ss.isFinite()&&ts.isFinite()?bitwise(ss,ts,function(is,as){return is|as}):!ss.isFinite()&&!ss.isNegative()&&ts.isNegative()||ss.isNegative()&&!ts.isNegative()&&!ts.isFinite()?ns:ss.isNegative()&&ts.isNegative()?ss.isFinite()?ss:ts:ss.isFinite()?ts:ss}function bitwise(ss,ts,rs){var ns,is,as,os,ls,us=ss.constructor,cs=+(ss.s<0),ps=+(ts.s<0);if(cs){ns=decCoefficientToBinaryString(bitNotBigNumber(ss));for(var ds=0;ds<ns.length;++ds)ns[ds]^=1}else ns=decCoefficientToBinaryString(ss);if(ps){is=decCoefficientToBinaryString(bitNotBigNumber(ts));for(var fs=0;fs<is.length;++fs)is[fs]^=1}else is=decCoefficientToBinaryString(ts);ns.length<=is.length?(as=ns,os=is,ls=cs):(as=is,os=ns,ls=ps);var hs=as.length,ys=os.length,gs=1^rs(cs,ps),bs=new us(1^gs),vs=new us(1),Ns=new us(2),Ts=us.precision;for(us.config({precision:1e9});hs>0;)rs(as[--hs],os[--ys])===gs&&(bs=bs.plus(vs)),vs=vs.times(Ns);for(;ys>0;)rs(ls,os[--ys])===gs&&(bs=bs.plus(vs)),vs=vs.times(Ns);return us.config({precision:Ts}),gs===0&&(bs.s=-bs.s),bs}function decCoefficientToBinaryString(ss){for(var ts=ss.d,rs=ts[0]+"",ns=1;ns<ts.length;++ns){for(var is=ts[ns]+"",as=7-is.length;as--;)is="0"+is;rs+=is}for(var os=rs.length;rs.charAt(os)==="0";)os--;var ls=ss.e,us=rs.slice(0,os+1||1),cs=us.length;if(ls>0)if(++ls>cs)for(ls-=cs;ls--;)us+="0";else ls<cs&&(us=us.slice(0,ls)+"."+us.slice(ls));for(var ps=[0],ds=0;ds<us.length;){for(var fs=ps.length;fs--;)ps[fs]*=10;ps[0]+=parseInt(us.charAt(ds++));for(var hs=0;hs<ps.length;++hs)ps[hs]>1&&(ps[hs+1]!==null&&ps[hs+1]!==void 0||(ps[hs+1]=0),ps[hs+1]+=ps[hs]>>1,ps[hs]&=1)}return ps.reverse()}function bitXor$1(ss,ts){if(ss.isFinite()&&!ss.isInteger()||ts.isFinite()&&!ts.isInteger())throw new Error("Integers expected in function bitXor");var rs=ss.constructor;if(ss.isNaN()||ts.isNaN())return new rs(NaN);if(ss.isZero())return ts;if(ts.isZero())return ss;if(ss.eq(ts))return new rs(0);var ns=new rs(-1);return ss.eq(ns)?bitNotBigNumber(ts):ts.eq(ns)?bitNotBigNumber(ss):ss.isFinite()&&ts.isFinite()?bitwise(ss,ts,function(is,as){return is^as}):ss.isFinite()||ts.isFinite()?new rs(ss.isNegative()===ts.isNegative()?1/0:-1/0):ns}function leftShiftBigNumber(ss,ts){if(ss.isFinite()&&!ss.isInteger()||ts.isFinite()&&!ts.isInteger())throw new Error("Integers expected in function leftShift");var rs=ss.constructor;return ss.isNaN()||ts.isNaN()||ts.isNegative()&&!ts.isZero()?new rs(NaN):ss.isZero()||ts.isZero()?ss:ss.isFinite()||ts.isFinite()?ts.lt(55)?ss.times(Math.pow(2,ts.toNumber())+""):ss.times(new rs(2).pow(ts)):new rs(NaN)}function rightArithShiftBigNumber(ss,ts){if(ss.isFinite()&&!ss.isInteger()||ts.isFinite()&&!ts.isInteger())throw new Error("Integers expected in function rightArithShift");var rs=ss.constructor;return ss.isNaN()||ts.isNaN()||ts.isNegative()&&!ts.isZero()?new rs(NaN):ss.isZero()||ts.isZero()?ss:ts.isFinite()?ts.lt(55)?ss.div(Math.pow(2,ts.toNumber())+"").floor():ss.div(new rs(2).pow(ts)).floor():ss.isNegative()?new rs(-1):ss.isFinite()?new rs(0):new rs(NaN)}var name$3y="bitAnd",dependencies$3y=["typed","matrix","equalScalar"],createBitAnd=factory(name$3y,dependencies$3y,ss=>{var{typed:ts,matrix:rs,equalScalar:ns}=ss,is=createAlgorithm02({typed:ts,equalScalar:ns}),as=createAlgorithm06({typed:ts,equalScalar:ns}),os=createAlgorithm11({typed:ts,equalScalar:ns}),ls=createAlgorithm13({typed:ts}),us=createAlgorithm14({typed:ts});return ts(name$3y,{"number, number":bitAndNumber,"BigNumber, BigNumber":bitAndBigNumber,"SparseMatrix, SparseMatrix":function(cs,ps){return as(cs,ps,this,!1)},"SparseMatrix, DenseMatrix":function(cs,ps){return is(ps,cs,this,!0)},"DenseMatrix, SparseMatrix":function(cs,ps){return is(cs,ps,this,!1)},"DenseMatrix, DenseMatrix":function(cs,ps){return ls(cs,ps,this)},"Array, Array":function(cs,ps){return this(rs(cs),rs(ps)).valueOf()},"Array, Matrix":function(cs,ps){return this(rs(cs),ps)},"Matrix, Array":function(cs,ps){return this(cs,rs(ps))},"SparseMatrix, any":function(cs,ps){return os(cs,ps,this,!1)},"DenseMatrix, any":function(cs,ps){return us(cs,ps,this,!1)},"any, SparseMatrix":function(cs,ps){return os(ps,cs,this,!0)},"any, DenseMatrix":function(cs,ps){return us(ps,cs,this,!0)},"Array, any":function(cs,ps){return us(rs(cs),ps,this,!1).valueOf()},"any, Array":function(cs,ps){return us(rs(ps),cs,this,!0).valueOf()}})}),name$3x="bitNot",dependencies$3x=["typed"],createBitNot=factory(name$3x,dependencies$3x,ss=>{var{typed:ts}=ss;return ts(name$3x,{number:bitNotNumber,BigNumber:bitNotBigNumber,"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3w="bitOr",dependencies$3w=["typed","matrix","equalScalar","DenseMatrix"],createBitOr=factory(name$3w,dependencies$3w,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,DenseMatrix:is}=ss,as=createAlgorithm01({typed:ts}),os=createAlgorithm04({typed:ts,equalScalar:ns}),ls=createAlgorithm10({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$3w,{"number, number":bitOrNumber,"BigNumber, BigNumber":bitOrBigNumber,"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(rs(ps),rs(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(rs(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,rs(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(rs(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(rs(ds),ps,this,!0).valueOf()}})}),name$3v="algorithm07",dependencies$3v=["typed","DenseMatrix"],createAlgorithm07=factory(name$3v,dependencies$3v,ss=>{var{typed:ts,DenseMatrix:rs}=ss;return function(is,as,os){var ls=is._size,us=is._datatype,cs=as._size,ps=as._datatype;if(ls.length!==cs.length)throw new DimensionError(ls.length,cs.length);if(ls[0]!==cs[0]||ls[1]!==cs[1])throw new RangeError("Dimension mismatch. Matrix A ("+ls+") must match Matrix B ("+cs+")");var ds,fs,hs,ys=ls[0],gs=ls[1],bs=0,vs=os;typeof us=="string"&&us===ps&&(ds=us,bs=ts.convert(0,ds),vs=ts.find(os,[ds,ds]));var Ns=[];for(fs=0;fs<ys;fs++)Ns[fs]=[];var Ts=[],Cs=[],xs=[],As=[];for(hs=0;hs<gs;hs++){var ws=hs+1;for(ns(is,hs,xs,Ts,ws),ns(as,hs,As,Cs,ws),fs=0;fs<ys;fs++){var Es=xs[fs]===ws?Ts[fs]:bs,Ss=As[fs]===ws?Cs[fs]:bs;Ns[fs][hs]=vs(Es,Ss)}}return new rs({data:Ns,size:[ys,gs],datatype:ds})};function ns(is,as,os,ls,us){for(var cs=is._values,ps=is._index,ds=is._ptr,fs=ds[as],hs=ds[as+1];fs<hs;fs++){var ys=ps[fs];os[ys]=us,ls[ys]=cs[fs]}}}),name$3u="bitXor",dependencies$3u=["typed","matrix","DenseMatrix"],createBitXor=factory(name$3u,dependencies$3u,ss=>{var{typed:ts,matrix:rs,DenseMatrix:ns}=ss,is=createAlgorithm03({typed:ts}),as=createAlgorithm07({typed:ts,DenseMatrix:ns}),os=createAlgorithm12({typed:ts,DenseMatrix:ns}),ls=createAlgorithm13({typed:ts}),us=createAlgorithm14({typed:ts});return ts(name$3u,{"number, number":bitXorNumber,"BigNumber, BigNumber":bitXor$1,"SparseMatrix, SparseMatrix":function(cs,ps){return as(cs,ps,this)},"SparseMatrix, DenseMatrix":function(cs,ps){return is(ps,cs,this,!0)},"DenseMatrix, SparseMatrix":function(cs,ps){return is(cs,ps,this,!1)},"DenseMatrix, DenseMatrix":function(cs,ps){return ls(cs,ps,this)},"Array, Array":function(cs,ps){return this(rs(cs),rs(ps)).valueOf()},"Array, Matrix":function(cs,ps){return this(rs(cs),ps)},"Matrix, Array":function(cs,ps){return this(cs,rs(ps))},"SparseMatrix, any":function(cs,ps){return os(cs,ps,this,!1)},"DenseMatrix, any":function(cs,ps){return us(cs,ps,this,!1)},"any, SparseMatrix":function(cs,ps){return os(ps,cs,this,!0)},"any, DenseMatrix":function(cs,ps){return us(ps,cs,this,!0)},"Array, any":function(cs,ps){return us(rs(cs),ps,this,!1).valueOf()},"any, Array":function(cs,ps){return us(rs(ps),cs,this,!0).valueOf()}})}),name$3t="arg",dependencies$3t=["typed"],createArg=factory(name$3t,dependencies$3t,ss=>{var{typed:ts}=ss;return ts(name$3t,{number:function(rs){return Math.atan2(0,rs)},BigNumber:function(rs){return rs.constructor.atan2(0,rs)},Complex:function(rs){return rs.arg()},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3s="conj",dependencies$3s=["typed"],createConj=factory(name$3s,dependencies$3s,ss=>{var{typed:ts}=ss;return ts(name$3s,{number:function(rs){return rs},BigNumber:function(rs){return rs},Complex:function(rs){return rs.conjugate()},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3r="im",dependencies$3r=["typed"],createIm=factory(name$3r,dependencies$3r,ss=>{var{typed:ts}=ss;return ts(name$3r,{number:function(rs){return 0},BigNumber:function(rs){return rs.mul(0)},Fraction:function(rs){return rs.mul(0)},Complex:function(rs){return rs.im},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3q="re",dependencies$3q=["typed"],createRe=factory(name$3q,dependencies$3q,ss=>{var{typed:ts}=ss;return ts(name$3q,{number:function(rs){return rs},BigNumber:function(rs){return rs},Fraction:function(rs){return rs},Complex:function(rs){return rs.re},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3p="not",dependencies$3p=["typed"],createNot=factory(name$3p,dependencies$3p,ss=>{var{typed:ts}=ss;return ts(name$3p,{number:notNumber,Complex:function(rs){return rs.re===0&&rs.im===0},BigNumber:function(rs){return rs.isZero()||rs.isNaN()},Unit:function(rs){return rs.value===null||this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$3o="or",dependencies$3o=["typed","matrix","equalScalar","DenseMatrix"],createOr=factory(name$3o,dependencies$3o,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm05({typed:ts,equalScalar:ns}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$3o,{"number, number":orNumber,"Complex, Complex":function(ps,ds){return ps.re!==0||ps.im!==0||ds.re!==0||ds.im!==0},"BigNumber, BigNumber":function(ps,ds){return!ps.isZero()&&!ps.isNaN()||!ds.isZero()&&!ds.isNaN()},"Unit, Unit":function(ps,ds){return this(ps.value||0,ds.value||0)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(rs(ps),rs(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(rs(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,rs(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(rs(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(rs(ds),ps,this,!0).valueOf()}})}),name$3n="xor",dependencies$3n=["typed","matrix","DenseMatrix"],createXor=factory(name$3n,dependencies$3n,ss=>{var{typed:ts,matrix:rs,DenseMatrix:ns}=ss,is=createAlgorithm03({typed:ts}),as=createAlgorithm07({typed:ts,DenseMatrix:ns}),os=createAlgorithm12({typed:ts,DenseMatrix:ns}),ls=createAlgorithm13({typed:ts}),us=createAlgorithm14({typed:ts});return ts(name$3n,{"number, number":xorNumber,"Complex, Complex":function(cs,ps){return(cs.re!==0||cs.im!==0)!=(ps.re!==0||ps.im!==0)},"BigNumber, BigNumber":function(cs,ps){return(!cs.isZero()&&!cs.isNaN())!=(!ps.isZero()&&!ps.isNaN())},"Unit, Unit":function(cs,ps){return this(cs.value||0,ps.value||0)},"SparseMatrix, SparseMatrix":function(cs,ps){return as(cs,ps,this)},"SparseMatrix, DenseMatrix":function(cs,ps){return is(ps,cs,this,!0)},"DenseMatrix, SparseMatrix":function(cs,ps){return is(cs,ps,this,!1)},"DenseMatrix, DenseMatrix":function(cs,ps){return ls(cs,ps,this)},"Array, Array":function(cs,ps){return this(rs(cs),rs(ps)).valueOf()},"Array, Matrix":function(cs,ps){return this(rs(cs),ps)},"Matrix, Array":function(cs,ps){return this(cs,rs(ps))},"SparseMatrix, any":function(cs,ps){return os(cs,ps,this,!1)},"DenseMatrix, any":function(cs,ps){return us(cs,ps,this,!1)},"any, SparseMatrix":function(cs,ps){return os(ps,cs,this,!0)},"any, DenseMatrix":function(cs,ps){return us(ps,cs,this,!0)},"Array, any":function(cs,ps){return us(rs(cs),ps,this,!1).valueOf()},"any, Array":function(cs,ps){return us(rs(ps),cs,this,!0).valueOf()}})}),name$3m="concat",dependencies$3m=["typed","matrix","isInteger"],createConcat=factory(name$3m,dependencies$3m,ss=>{var{typed:ts,matrix:rs,isInteger:ns}=ss;return ts(name$3m,{"...Array | Matrix | number | BigNumber":function(is){var as,os,ls=is.length,us=-1,cs=!1,ps=[];for(as=0;as<ls;as++){var ds=is[as];if(isMatrix(ds)&&(cs=!0),isNumber$1(ds)||isBigNumber(ds)){if(as!==ls-1)throw new Error("Dimension must be specified as last argument");if(os=us,us=ds.valueOf(),!ns(us))throw new TypeError("Integer number expected for dimension");if(us<0||as>0&&us>os)throw new IndexError(us,os+1)}else{var fs=clone$3(ds).valueOf(),hs=arraySize(fs);if(ps[as]=fs,os=us,us=hs.length-1,as>0&&us!==os)throw new DimensionError(os+1,us+1)}}if(ps.length===0)throw new SyntaxError("At least one matrix expected");for(var ys=ps.shift();ps.length;)ys=_concat(ys,ps.shift(),us,0);return cs?rs(ys):ys},"...string":function(is){return is.join("")}})});function _concat(ss,ts,rs,ns){if(ns<rs){if(ss.length!==ts.length)throw new DimensionError(ss.length,ts.length);for(var is=[],as=0;as<ss.length;as++)is[as]=_concat(ss[as],ts[as],rs,ns+1);return is}return ss.concat(ts)}var name$3l="column",dependencies$3l=["typed","Index","matrix","range"],createColumn=factory(name$3l,dependencies$3l,ss=>{var{typed:ts,Index:rs,matrix:ns,range:is}=ss;return ts(name$3l,{"Matrix, number":as,"Array, number":function(os,ls){return as(ns(clone$3(os)),ls).valueOf()}});function as(os,ls){if(os.size().length!==2)throw new Error("Only two dimensional matrix is supported");validateIndex(ls,os.size()[1]);var us=is(0,os.size()[0]),cs=new rs(us,ls);return os.subset(cs)}}),name$3k="count",dependencies$3k=["typed","size","prod"],createCount=factory(name$3k,dependencies$3k,ss=>{var{typed:ts,size:rs,prod:ns}=ss;return ts(name$3k,{string:function(is){return is.length},"Matrix | Array":function(is){return ns(rs(is))}})}),name$3j="cross",dependencies$3j=["typed","matrix","subtract","multiply"],createCross=factory(name$3j,dependencies$3j,ss=>{var{typed:ts,matrix:rs,subtract:ns,multiply:is}=ss;return ts(name$3j,{"Matrix, Matrix":function(os,ls){return rs(as(os.toArray(),ls.toArray()))},"Matrix, Array":function(os,ls){return rs(as(os.toArray(),ls))},"Array, Matrix":function(os,ls){return rs(as(os,ls.toArray()))},"Array, Array":as});function as(os,ls){var us=Math.max(arraySize(os).length,arraySize(ls).length);os=squeeze$1(os),ls=squeeze$1(ls);var cs=arraySize(os),ps=arraySize(ls);if(cs.length!==1||ps.length!==1||cs[0]!==3||ps[0]!==3)throw new RangeError("Vectors with length 3 expected (Size A = ["+cs.join(", ")+"], B = ["+ps.join(", ")+"])");var ds=[ns(is(os[1],ls[2]),is(os[2],ls[1])),ns(is(os[2],ls[0]),is(os[0],ls[2])),ns(is(os[0],ls[1]),is(os[1],ls[0]))];return us>1?[ds]:ds}}),name$3i="diag",dependencies$3i=["typed","matrix","DenseMatrix","SparseMatrix"],createDiag=factory(name$3i,dependencies$3i,ss=>{var{typed:ts,matrix:rs,DenseMatrix:ns,SparseMatrix:is}=ss;return ts(name$3i,{Array:function(os){return as(os,0,arraySize(os),null)},"Array, number":function(os,ls){return as(os,ls,arraySize(os),null)},"Array, BigNumber":function(os,ls){return as(os,ls.toNumber(),arraySize(os),null)},"Array, string":function(os,ls){return as(os,0,arraySize(os),ls)},"Array, number, string":function(os,ls,us){return as(os,ls,arraySize(os),us)},"Array, BigNumber, string":function(os,ls,us){return as(os,ls.toNumber(),arraySize(os),us)},Matrix:function(os){return as(os,0,os.size(),os.storage())},"Matrix, number":function(os,ls){return as(os,ls,os.size(),os.storage())},"Matrix, BigNumber":function(os,ls){return as(os,ls.toNumber(),os.size(),os.storage())},"Matrix, string":function(os,ls){return as(os,0,os.size(),ls)},"Matrix, number, string":function(os,ls,us){return as(os,ls,os.size(),us)},"Matrix, BigNumber, string":function(os,ls,us){return as(os,ls.toNumber(),os.size(),us)}});function as(os,ls,us,cs){if(!isInteger$1(ls))throw new TypeError("Second parameter in function diag must be an integer");var ps=ls>0?ls:0,ds=ls<0?-ls:0;switch(us.length){case 1:return function(fs,hs,ys,gs,bs,vs){var Ns=[gs+bs,gs+vs];if(ys&&ys!=="sparse"&&ys!=="dense")throw new TypeError("Unknown matrix type ".concat(ys,'"'));var Ts=ys==="sparse"?is.diagonal(Ns,fs,hs):ns.diagonal(Ns,fs,hs);return ys!==null?Ts:Ts.valueOf()}(os,ls,cs,us[0],ds,ps);case 2:return function(fs,hs,ys,gs,bs,vs){if(isMatrix(fs)){var Ns=fs.diagonal(hs);return ys!==null?ys!==Ns.storage()?rs(Ns,ys):Ns:Ns.valueOf()}for(var Ts=Math.min(gs[0]-bs,gs[1]-vs),Cs=[],xs=0;xs<Ts;xs++)Cs[xs]=fs[xs+bs][xs+vs];return ys!==null?rs(Cs):Cs}(os,ls,cs,us,ds,ps)}throw new RangeError("Matrix for function diag must be 2 dimensional")}});function lruQueue(ss){var ts=0,rs=1,ns=Object.create(null),is=Object.create(null),as=0,os=function(ls){var us=is[ls];if(us&&(delete ns[us],delete is[ls],--ts,rs===us)){if(!ts)return as=0,void(rs=1);for(;!hasOwnProperty.call(ns,++rs););}};return ss=Math.abs(ss),{hit:function(ls){var us=is[ls],cs=++as;if(ns[cs]=ls,is[ls]=cs,!us)return++ts<=ss?void 0:(ls=ns[rs],os(ls),ls);if(delete ns[us],rs===us)for(;!hasOwnProperty.call(ns,++rs););},delete:os,clear:function(){ts=as=0,rs=1,ns=Object.create(null),is=Object.create(null)}}}function memoize$1(ss){var{hasher:ts,limit:rs}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return rs=rs??Number.POSITIVE_INFINITY,ts=ts??JSON.stringify,function ns(){typeof ns.cache!="object"&&(ns.cache={values:new Map,lru:lruQueue(rs||Number.POSITIVE_INFINITY)});for(var is=[],as=0;as<arguments.length;as++)is[as]=arguments[as];var os=ts(is);if(ns.cache.values.has(os))return ns.cache.lru.hit(os),ns.cache.values.get(os);var ls=ss.apply(ss,is);return ns.cache.values.set(os,ls),ns.cache.values.delete(ns.cache.lru.hit(os)),ls}}function maxArgumentCount(ss){return Object.keys(ss.signatures||{}).reduce(function(ts,rs){var ns=(rs.match(/,/g)||[]).length+1;return Math.max(ts,ns)},-1)}var name$3h="filter",dependencies$3h=["typed"],createFilter=factory(name$3h,dependencies$3h,ss=>{var{typed:ts}=ss;return ts("filter",{"Array, function":_filterCallback,"Matrix, function":function(rs,ns){return rs.create(_filterCallback(rs.toArray(),ns))},"Array, RegExp":filterRegExp,"Matrix, RegExp":function(rs,ns){return rs.create(filterRegExp(rs.toArray(),ns))}})});function _filterCallback(ss,ts){var rs=maxArgumentCount(ts);return filter$2(ss,function(ns,is,as){return rs===1?ts(ns):rs===2?ts(ns,[is]):ts(ns,[is],as)})}var name$3g="flatten",dependencies$3g=["typed","matrix"],createFlatten=factory(name$3g,dependencies$3g,ss=>{var{typed:ts,matrix:rs}=ss;return ts(name$3g,{Array:function(ns){return flatten$4(clone$3(ns))},Matrix:function(ns){var is=flatten$4(clone$3(ns.toArray()));return rs(is)}})}),name$3f="forEach",dependencies$3f=["typed"],createForEach=factory(name$3f,dependencies$3f,ss=>{var{typed:ts}=ss;return ts(name$3f,{"Array, function":_forEach,"Matrix, function":function(rs,ns){return rs.forEach(ns)}})});function _forEach(ss,ts){var rs=maxArgumentCount(ts);(function ns(is,as){Array.isArray(is)?forEach$1$1(is,function(os,ls){ns(os,as.concat(ls))}):rs===1?ts(is):rs===2?ts(is,as):ts(is,as,ss)})(ss,[])}var name$3e="getMatrixDataType",dependencies$3e=["typed"],createGetMatrixDataType=factory(name$3e,dependencies$3e,ss=>{var{typed:ts}=ss;return ts(name$3e,{Array:function(rs){return getArrayDataType(rs,typeOf$1)},Matrix:function(rs){return rs.getDataType()}})}),name$3d="identity",dependencies$3d=["typed","config","matrix","BigNumber","DenseMatrix","SparseMatrix"],createIdentity=factory(name$3d,dependencies$3d,ss=>{var{typed:ts,config:rs,matrix:ns,BigNumber:is,DenseMatrix:as,SparseMatrix:os}=ss;return ts(name$3d,{"":function(){return rs.matrix==="Matrix"?ns([]):[]},string:function(cs){return ns(cs)},"number | BigNumber":function(cs){return us(cs,cs,rs.matrix==="Matrix"?"dense":void 0)},"number | BigNumber, string":function(cs,ps){return us(cs,cs,ps)},"number | BigNumber, number | BigNumber":function(cs,ps){return us(cs,ps,rs.matrix==="Matrix"?"dense":void 0)},"number | BigNumber, number | BigNumber, string":function(cs,ps,ds){return us(cs,ps,ds)},Array:function(cs){return ls(cs)},"Array, string":function(cs,ps){return ls(cs,ps)},Matrix:function(cs){return ls(cs.valueOf(),cs.storage())},"Matrix, string":function(cs,ps){return ls(cs.valueOf(),ps)}});function ls(cs,ps){switch(cs.length){case 0:return ps?ns(ps):[];case 1:return us(cs[0],cs[0],ps);case 2:return us(cs[0],cs[1],ps);default:throw new Error("Vector containing two values expected")}}function us(cs,ps,ds){var fs=isBigNumber(cs)||isBigNumber(ps)?is:null;if(isBigNumber(cs)&&(cs=cs.toNumber()),isBigNumber(ps)&&(ps=ps.toNumber()),!isInteger$1(cs)||cs<1)throw new Error("Parameters in function identity must be positive integers");if(!isInteger$1(ps)||ps<1)throw new Error("Parameters in function identity must be positive integers");var hs=fs?new is(1):1,ys=fs?new fs(0):0,gs=[cs,ps];if(ds){if(ds==="sparse")return os.diagonal(gs,hs,0,ys);if(ds==="dense")return as.diagonal(gs,hs,0,ys);throw new TypeError('Unknown matrix type "'.concat(ds,'"'))}for(var bs=resize$1([],gs,ys),vs=cs<ps?cs:ps,Ns=0;Ns<vs;Ns++)bs[Ns][Ns]=hs;return bs}}),name$3c="kron",dependencies$3c=["typed","matrix","multiplyScalar"],createKron=factory(name$3c,dependencies$3c,ss=>{var{typed:ts,matrix:rs,multiplyScalar:ns}=ss;return ts(name$3c,{"Matrix, Matrix":function(as,os){return rs(is(as.toArray(),os.toArray()))},"Matrix, Array":function(as,os){return rs(is(as.toArray(),os))},"Array, Matrix":function(as,os){return rs(is(as,os.toArray()))},"Array, Array":is});function is(as,os){if(arraySize(as).length===1&&(as=[as]),arraySize(os).length===1&&(os=[os]),arraySize(as).length>2||arraySize(os).length>2)throw new RangeError("Vectors with dimensions greater then 2 are not supported expected (Size x = "+JSON.stringify(as.length)+", y = "+JSON.stringify(os.length)+")");var ls=[],us=[];return as.map(function(cs){return os.map(function(ps){return us=[],ls.push(us),cs.map(function(ds){return ps.map(function(fs){return us.push(ns(ds,fs))})})})})&&ls}}),name$3b="map",dependencies$3b=["typed"],createMap=factory(name$3b,dependencies$3b,ss=>{var{typed:ts}=ss;return ts(name$3b,{"Array, function":_map$1,"Matrix, function":function(rs,ns){return rs.map(ns)}})});function _map$1(ss,ts){var rs=maxArgumentCount(ts);return function ns(is,as){if(Array.isArray(is))return is.map(function(us,cs){return ns(us,as.concat(cs))});try{return rs===1?ts(is):rs===2?ts(is,as):ts(is,as,ss)}catch(us){if(us instanceof TypeError&&"data"in us&&us.data.category==="wrongType"){var os="map attempted to call '".concat(us.data.fn,"(").concat(is),ls=JSON.stringify(as);throw rs===2?os+=","+ls:rs!==1&&(os+=",".concat(ls,",").concat(ss)),os+=")' but argument ".concat(us.data.index+1," of type "),os+="".concat(us.data.actual," does not match expected type "),os+=us.data.expected.join(" or "),new TypeError(os)}throw us}}(ss,[])}var name$3a="diff",dependencies$3a=["typed","matrix","subtract","number"],createDiff=factory(name$3a,dependencies$3a,ss=>{var{typed:ts,matrix:rs,subtract:ns,number:is}=ss;return ts(name$3a,{"Array | Matrix":function(us){return isMatrix(us)?rs(os(us.toArray())):os(us)},"Array | Matrix, number":function(us,cs){if(!isInteger$1(cs))throw new RangeError("Dimension must be a whole number");return isMatrix(us)?rs(as(us.toArray(),cs)):as(us,cs)},"Array | Matrix, BigNumber":function(us,cs){return this(us,is(cs))}});function as(us,cs){if(isMatrix(us)&&(us=us.toArray()),!Array.isArray(us))throw RangeError("Array/Matrix does not have that many dimensions");if(cs>0){var ps=[];return us.forEach(ds=>{ps.push(as(ds,cs-1))}),ps}if(cs===0)return os(us);throw RangeError("Cannot have negative dimension")}function os(us){var cs=[],ps=us.length;if(ps<2)return us;for(var ds=1;ds<ps;ds++)cs.push(ls(us[ds-1],us[ds]));return cs}function ls(us,cs){isMatrix(us)&&(us=us.toArray()),isMatrix(cs)&&(cs=cs.toArray());var ps=Array.isArray(us),ds=Array.isArray(cs);if(ps&&ds)return function(fs,hs){if(fs.length!==hs.length)throw RangeError("Not all sub-arrays have the same length");for(var ys=[],gs=fs.length,bs=0;bs<gs;bs++)ys.push(ls(fs[bs],hs[bs]));return ys}(us,cs);if(!ps&&!ds)return ns(cs,us);throw TypeError("Cannot calculate difference between 1 array and 1 non-array")}}),name$39="ones",dependencies$39=["typed","config","matrix","BigNumber"],createOnes=factory(name$39,dependencies$39,ss=>{var{typed:ts,config:rs,matrix:ns,BigNumber:is}=ss;return ts("ones",{"":function(){return rs.matrix==="Array"?as([]):as([],"default")},"...number | BigNumber | string":function(os){if(typeof os[os.length-1]=="string"){var ls=os.pop();return as(os,ls)}return rs.matrix==="Array"?as(os):as(os,"default")},Array:as,Matrix:function(os){var ls=os.storage();return as(os.valueOf(),ls)},"Array | Matrix, string":function(os,ls){return as(os.valueOf(),ls)}});function as(os,ls){var us=function(fs){var hs=!1;return fs.forEach(function(ys,gs,bs){isBigNumber(ys)&&(hs=!0,bs[gs]=ys.toNumber())}),hs}(os),cs=us?new is(1):1;if(function(fs){fs.forEach(function(hs){if(typeof hs!="number"||!isInteger$1(hs)||hs<0)throw new Error("Parameters in function ones must be positive integers")})}(os),ls){var ps=ns(ls);return os.length>0?ps.resize(os,cs):ps}var ds=[];return os.length>0?resize$1(ds,os,cs):ds}});function noBignumber(){throw new Error('No "bignumber" implementation available')}function noFraction(){throw new Error('No "fraction" implementation available')}function noMatrix(){throw new Error('No "matrix" implementation available')}var name$38="range",dependencies$38=["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq"],createRange=factory(name$38,dependencies$38,ss=>{var{typed:ts,config:rs,matrix:ns,bignumber:is,smaller:as,smallerEq:os,larger:ls,largerEq:us}=ss;return ts(name$38,{string:ps,"string, boolean":ps,"number, number":function(gs,bs){return cs(ds(gs,bs,1))},"number, number, number":function(gs,bs,vs){return cs(ds(gs,bs,vs))},"number, number, boolean":function(gs,bs,vs){return cs(vs?fs(gs,bs,1):ds(gs,bs,1))},"number, number, number, boolean":function(gs,bs,vs,Ns){return cs(Ns?fs(gs,bs,vs):ds(gs,bs,vs))},"BigNumber, BigNumber":function(gs,bs){return cs(hs(gs,bs,new gs.constructor(1)))},"BigNumber, BigNumber, BigNumber":function(gs,bs,vs){return cs(hs(gs,bs,vs))},"BigNumber, BigNumber, boolean":function(gs,bs,vs){var Ns=gs.constructor;return cs(vs?ys(gs,bs,new Ns(1)):hs(gs,bs,new Ns(1)))},"BigNumber, BigNumber, BigNumber, boolean":function(gs,bs,vs,Ns){return cs(Ns?ys(gs,bs,vs):hs(gs,bs,vs))}});function cs(gs){return rs.matrix==="Matrix"?ns?ns(gs):noMatrix():gs}function ps(gs,bs){var vs=function(Ns){var Ts=Ns.split(":"),Cs=Ts.map(function(xs){return Number(xs)});if(Cs.some(function(xs){return isNaN(xs)}))return null;switch(Cs.length){case 2:return{start:Cs[0],end:Cs[1],step:1};case 3:return{start:Cs[0],end:Cs[2],step:Cs[1]};default:return null}}(gs);if(!vs)throw new SyntaxError('String "'+gs+'" is no valid range');return rs.number==="BigNumber"?(is===void 0&&noBignumber(),cs((bs?ys:hs)(is(vs.start),is(vs.end),is(vs.step)))):cs((bs?fs:ds)(vs.start,vs.end,vs.step))}function ds(gs,bs,vs){var Ns=[],Ts=gs;if(vs>0)for(;as(Ts,bs);)Ns.push(Ts),Ts+=vs;else if(vs<0)for(;ls(Ts,bs);)Ns.push(Ts),Ts+=vs;return Ns}function fs(gs,bs,vs){var Ns=[],Ts=gs;if(vs>0)for(;os(Ts,bs);)Ns.push(Ts),Ts+=vs;else if(vs<0)for(;us(Ts,bs);)Ns.push(Ts),Ts+=vs;return Ns}function hs(gs,bs,vs){var Ns=is(0),Ts=[],Cs=gs;if(vs.gt(Ns))for(;as(Cs,bs);)Ts.push(Cs),Cs=Cs.plus(vs);else if(vs.lt(Ns))for(;ls(Cs,bs);)Ts.push(Cs),Cs=Cs.plus(vs);return Ts}function ys(gs,bs,vs){var Ns=is(0),Ts=[],Cs=gs;if(vs.gt(Ns))for(;os(Cs,bs);)Ts.push(Cs),Cs=Cs.plus(vs);else if(vs.lt(Ns))for(;us(Cs,bs);)Ts.push(Cs),Cs=Cs.plus(vs);return Ts}}),name$37="reshape",dependencies$37=["typed","isInteger","matrix"],createReshape=factory(name$37,dependencies$37,ss=>{var{typed:ts,isInteger:rs}=ss;return ts(name$37,{"Matrix, Array":function(ns,is){return ns.reshape(is)},"Array, Array":function(ns,is){return is.forEach(function(as){if(!rs(as))throw new TypeError("Invalid size for dimension: "+as)}),reshape$1(ns,is)}})});function ArgumentsError(ss,ts,rs,ns){if(!(this instanceof ArgumentsError))throw new SyntaxError("Constructor must be called with the new operator");this.fn=ss,this.count=ts,this.min=rs,this.max=ns,this.message="Wrong number of arguments in function "+ss+" ("+ts+" provided, "+rs+(ns!=null?"-"+ns:"")+" expected)",this.stack=new Error().stack}ArgumentsError.prototype=new Error,ArgumentsError.prototype.constructor=Error,ArgumentsError.prototype.name="ArgumentsError",ArgumentsError.prototype.isArgumentsError=!0;var name$36="resize",dependencies$36=["config","matrix"],createResize=factory(name$36,dependencies$36,ss=>{var{config:ts,matrix:rs}=ss;return function(ns,is,as){if(arguments.length!==2&&arguments.length!==3)throw new ArgumentsError("resize",arguments.length,2,3);if(isMatrix(is)&&(is=is.valueOf()),isBigNumber(is[0])&&(is=is.map(function(us){return isBigNumber(us)?us.toNumber():us})),isMatrix(ns))return ns.resize(is,as,!0);if(typeof ns=="string")return function(us,cs,ps){if(ps!==void 0){if(typeof ps!="string"||ps.length!==1)throw new TypeError("Single character expected as defaultValue")}else ps=" ";if(cs.length!==1)throw new DimensionError(cs.length,1);var ds=cs[0];if(typeof ds!="number"||!isInteger$1(ds))throw new TypeError("Invalid size, must contain positive integers (size: "+format$1(cs)+")");if(us.length>ds)return us.substring(0,ds);if(us.length<ds){for(var fs=us,hs=0,ys=ds-us.length;hs<ys;hs++)fs+=ps;return fs}return us}(ns,is,as);var os=!Array.isArray(ns)&&ts.matrix!=="Array";if(is.length===0){for(;Array.isArray(ns);)ns=ns[0];return clone$3(ns)}Array.isArray(ns)||(ns=[ns]);var ls=resize$1(ns=clone$3(ns),is,as);return os?rs(ls):ls}}),name$35="rotate",dependencies$35=["typed","multiply","rotationMatrix"],createRotate=factory(name$35,dependencies$35,ss=>{var{typed:ts,multiply:rs,rotationMatrix:ns}=ss;return ts(name$35,{"Array , number | BigNumber | Complex | Unit":function(as,os){return is(as,2),rs(ns(os),as).toArray()},"Matrix , number | BigNumber | Complex | Unit":function(as,os){return is(as,2),rs(ns(os),as)},"Array, number | BigNumber | Complex | Unit, Array | Matrix":function(as,os,ls){return is(as,3),rs(ns(os,ls),as)},"Matrix, number | BigNumber | Complex | Unit, Array | Matrix":function(as,os,ls){return is(as,3),rs(ns(os,ls),as)}});function is(as,os){var ls=Array.isArray(as)?arraySize(as):as.size();if(ls.length>2)throw new RangeError("Vector must be of dimensions 1x".concat(os));if(ls.length===2&&ls[1]!==1)throw new RangeError("Vector must be of dimensions 1x".concat(os));if(ls[0]!==os)throw new RangeError("Vector must be of dimensions 1x".concat(os))}}),name$34="rotationMatrix",dependencies$34=["typed","config","multiplyScalar","addScalar","unaryMinus","norm","matrix","BigNumber","DenseMatrix","SparseMatrix","cos","sin"],createRotationMatrix=factory(name$34,dependencies$34,ss=>{var{typed:ts,config:rs,multiplyScalar:ns,addScalar:is,unaryMinus:as,norm:os,BigNumber:ls,matrix:us,DenseMatrix:cs,SparseMatrix:ps,cos:ds,sin:fs}=ss;return ts(name$34,{"":function(){return rs.matrix==="Matrix"?us([]):[]},string:function(Ns){return us(Ns)},"number | BigNumber | Complex | Unit":function(Ns){return hs(Ns,rs.matrix==="Matrix"?"dense":void 0)},"number | BigNumber | Complex | Unit, string":function(Ns,Ts){return hs(Ns,Ts)},"number | BigNumber | Complex | Unit, Array":function(Ns,Ts){var Cs=us(Ts);return ys(Cs),vs(Ns,Cs,void 0)},"number | BigNumber | Complex | Unit, Matrix":function(Ns,Ts){ys(Ts);var Cs=Ts.storage()||(rs.matrix==="Matrix"?"dense":void 0);return vs(Ns,Ts,Cs)},"number | BigNumber | Complex | Unit, Array, string":function(Ns,Ts,Cs){var xs=us(Ts);return ys(xs),vs(Ns,xs,Cs)},"number | BigNumber | Complex | Unit, Matrix, string":function(Ns,Ts,Cs){return ys(Ts),vs(Ns,Ts,Cs)}});function hs(Ns,Ts){var Cs=isBigNumber(Ns)?new ls(-1):-1,xs=ds(Ns),As=fs(Ns);return bs([[xs,ns(Cs,As)],[As,xs]],Ts)}function ys(Ns){var Ts=Ns.size();if(Ts.length<1||Ts[0]!==3)throw new RangeError("Vector must be of dimensions 1x3")}function gs(Ns){return Ns.reduce((Ts,Cs)=>ns(Ts,Cs))}function bs(Ns,Ts){if(Ts){if(Ts==="sparse")return new ps(Ns);if(Ts==="dense")return new cs(Ns);throw new TypeError('Unknown matrix type "'.concat(Ts,'"'))}return Ns}function vs(Ns,Ts,Cs){var xs=os(Ts);if(xs===0)throw new RangeError("Rotation around zero vector");var As=isBigNumber(Ns)?ls:null,ws=As?new As(1):1,Es=As?new As(-1):-1,Ss=As?new As(Ts.get([0])/xs):Ts.get([0])/xs,Ds=As?new As(Ts.get([1])/xs):Ts.get([1])/xs,Vs=As?new As(Ts.get([2])/xs):Ts.get([2])/xs,Is=ds(Ns),Os=is(ws,as(Is)),Ps=fs(Ns);return bs([[is(Is,gs([Ss,Ss,Os])),is(gs([Ss,Ds,Os]),gs([Es,Vs,Ps])),is(gs([Ss,Vs,Os]),gs([Ds,Ps]))],[is(gs([Ss,Ds,Os]),gs([Vs,Ps])),is(Is,gs([Ds,Ds,Os])),is(gs([Ds,Vs,Os]),gs([Es,Ss,Ps]))],[is(gs([Ss,Vs,Os]),gs([Es,Ds,Ps])),is(gs([Ds,Vs,Os]),gs([Ss,Ps])),is(Is,gs([Vs,Vs,Os]))]],Cs)}}),name$33="row",dependencies$33=["typed","Index","matrix","range"],createRow=factory(name$33,dependencies$33,ss=>{var{typed:ts,Index:rs,matrix:ns,range:is}=ss;return ts(name$33,{"Matrix, number":as,"Array, number":function(os,ls){return as(ns(clone$3(os)),ls).valueOf()}});function as(os,ls){if(os.size().length!==2)throw new Error("Only two dimensional matrix is supported");validateIndex(ls,os.size()[0]);var us=is(0,os.size()[1]),cs=new rs(ls,us);return os.subset(cs)}}),name$32="size",dependencies$32=["typed","config","?matrix"],createSize=factory(name$32,dependencies$32,ss=>{var{typed:ts,config:rs,matrix:ns}=ss;return ts(name$32,{Matrix:function(is){return is.create(is.size())},Array:arraySize,string:function(is){return rs.matrix==="Array"?[is.length]:ns([is.length])},"number | Complex | BigNumber | Unit | boolean | null":function(is){return rs.matrix==="Array"?[]:ns?ns([]):noMatrix()}})}),name$31="squeeze",dependencies$31=["typed","matrix"],createSqueeze=factory(name$31,dependencies$31,ss=>{var{typed:ts,matrix:rs}=ss;return ts(name$31,{Array:function(ns){return squeeze$1(clone$3(ns))},Matrix:function(ns){var is=squeeze$1(ns.toArray());return Array.isArray(is)?rs(is):is},any:function(ns){return clone$3(ns)}})}),name$30="subset",dependencies$30=["typed","matrix"],createSubset=factory(name$30,dependencies$30,ss=>{var{typed:ts,matrix:rs}=ss;return ts(name$30,{"Array, Index":function(ns,is){var as=rs(ns).subset(is);return is.isScalar()?as:as.valueOf()},"Matrix, Index":function(ns,is){return ns.subset(is)},"Object, Index":_getObjectProperty,"string, Index":_getSubstring,"Array, Index, any":function(ns,is,as){return rs(clone$3(ns)).subset(is,as,void 0).valueOf()},"Array, Index, any, any":function(ns,is,as,os){return rs(clone$3(ns)).subset(is,as,os).valueOf()},"Matrix, Index, any":function(ns,is,as){return ns.clone().subset(is,as)},"Matrix, Index, any, any":function(ns,is,as,os){return ns.clone().subset(is,as,os)},"string, Index, string":_setSubstring,"string, Index, string, string":_setSubstring,"Object, Index, any":_setObjectProperty})});function _getSubstring(ss,ts){if(!isIndex(ts))throw new TypeError("Index expected");if(ts.size().length!==1)throw new DimensionError(ts.size().length,1);var rs=ss.length;validateIndex(ts.min()[0],rs),validateIndex(ts.max()[0],rs);var ns=ts.dimension(0),is="";return ns.forEach(function(as){is+=ss.charAt(as)}),is}function _setSubstring(ss,ts,rs,ns){if(!ts||ts.isIndex!==!0)throw new TypeError("Index expected");if(ts.size().length!==1)throw new DimensionError(ts.size().length,1);if(ns!==void 0){if(typeof ns!="string"||ns.length!==1)throw new TypeError("Single character expected as defaultValue")}else ns=" ";var is=ts.dimension(0);if(is.size()[0]!==rs.length)throw new DimensionError(is.size()[0],rs.length);var as=ss.length;validateIndex(ts.min()[0]),validateIndex(ts.max()[0]);for(var os=[],ls=0;ls<as;ls++)os[ls]=ss.charAt(ls);if(is.forEach(function(ps,ds){os[ps]=rs.charAt(ds[0])}),os.length>as)for(var us=as-1,cs=os.length;us<cs;us++)os[us]||(os[us]=ns);return os.join("")}function _getObjectProperty(ss,ts){if(ts.size().length!==1)throw new DimensionError(ts.size(),1);var rs=ts.dimension(0);if(typeof rs!="string")throw new TypeError("String expected as index to retrieve an object property");return getSafeProperty(ss,rs)}function _setObjectProperty(ss,ts,rs){if(ts.size().length!==1)throw new DimensionError(ts.size(),1);var ns=ts.dimension(0);if(typeof ns!="string")throw new TypeError("String expected as index to retrieve an object property");var is=clone$3(ss);return setSafeProperty(is,ns,rs),is}var name$2$="transpose",dependencies$2$=["typed","matrix"],createTranspose=factory(name$2$,dependencies$2$,ss=>{var{typed:ts,matrix:rs}=ss;return ts("transpose",{Array:function(ns){return this(rs(ns)).valueOf()},Matrix:function(ns){var is,as=ns.size();switch(as.length){case 1:is=ns.clone();break;case 2:var os=as[0],ls=as[1];if(ls===0)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+format$1(as)+")");switch(ns.storage()){case"dense":is=function(us,cs,ps){for(var ds,fs=us._data,hs=[],ys=0;ys<ps;ys++){ds=hs[ys]=[];for(var gs=0;gs<cs;gs++)ds[gs]=clone$3(fs[gs][ys])}return us.createDenseMatrix({data:hs,size:[ps,cs],datatype:us._datatype})}(ns,os,ls);break;case"sparse":is=function(us,cs,ps){for(var ds,fs,hs,ys=us._values,gs=us._index,bs=us._ptr,vs=ys?[]:void 0,Ns=[],Ts=[],Cs=[],xs=0;xs<cs;xs++)Cs[xs]=0;for(ds=0,fs=gs.length;ds<fs;ds++)Cs[gs[ds]]++;for(var As=0,ws=0;ws<cs;ws++)Ts.push(As),As+=Cs[ws],Cs[ws]=Ts[ws];for(Ts.push(As),hs=0;hs<ps;hs++)for(var Es=bs[hs],Ss=bs[hs+1],Ds=Es;Ds<Ss;Ds++){var Vs=Cs[gs[Ds]]++;Ns[Vs]=hs,ys&&(vs[Vs]=clone$3(ys[Ds]))}return us.createSparseMatrix({values:vs,index:Ns,ptr:Ts,size:[ps,cs],datatype:us._datatype})}(ns,os,ls)}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+format$1(this._size)+")")}return is},any:function(ns){return clone$3(ns)}})}),name$2_="ctranspose",dependencies$2_=["typed","transpose","conj"],createCtranspose=factory(name$2_,dependencies$2_,ss=>{var{typed:ts,transpose:rs,conj:ns}=ss;return ts(name$2_,{any:function(is){return ns(rs(is))}})}),name$2Z="zeros",dependencies$2Z=["typed","config","matrix","BigNumber"],createZeros=factory(name$2Z,dependencies$2Z,ss=>{var{typed:ts,config:rs,matrix:ns,BigNumber:is}=ss;return ts(name$2Z,{"":function(){return rs.matrix==="Array"?as([]):as([],"default")},"...number | BigNumber | string":function(os){if(typeof os[os.length-1]=="string"){var ls=os.pop();return as(os,ls)}return rs.matrix==="Array"?as(os):as(os,"default")},Array:as,Matrix:function(os){var ls=os.storage();return as(os.valueOf(),ls)},"Array | Matrix, string":function(os,ls){return as(os.valueOf(),ls)}});function as(os,ls){var us=function(fs){var hs=!1;return fs.forEach(function(ys,gs,bs){isBigNumber(ys)&&(hs=!0,bs[gs]=ys.toNumber())}),hs}(os),cs=us?new is(0):0;if(function(fs){fs.forEach(function(hs){if(typeof hs!="number"||!isInteger$1(hs)||hs<0)throw new Error("Parameters in function zeros must be positive integers")})}(os),ls){var ps=ns(ls);return os.length>0?ps.resize(os,cs):ps}var ds=[];return os.length>0?resize$1(ds,os,cs):ds}}),name$2Y="fft",dependencies$2Y=["typed","matrix","addScalar","multiplyScalar","divideScalar","exp","tau","i"],createFft=factory(name$2Y,dependencies$2Y,ss=>{var{typed:ts,matrix:rs,addScalar:ns,multiplyScalar:is,divideScalar:as,exp:os,tau:ls,i:us}=ss;return ts(name$2Y,{Array:cs,Matrix:function(fs){return fs.create(cs(fs.toArray()))}});function cs(fs){var hs=arraySize(fs);return hs.length===1?ds(fs,hs[0]):ps(fs.map(ys=>cs(ys,hs.slice(1))),0)}function ps(fs,hs){var ys=arraySize(fs);if(hs!==0)return new Array(ys[0]).fill(0).map((bs,vs)=>ps(fs[vs],hs-1));if(ys.length===1)return ds(fs);function gs(bs){var vs=arraySize(bs);return new Array(vs[1]).fill(0).map((Ns,Ts)=>new Array(vs[0]).fill(0).map((Cs,xs)=>bs[xs][Ts]))}return gs(ps(gs(fs),1))}function ds(fs){var hs=fs.length;if(hs===1)return[fs[0]];if(hs%2==0){for(var ys=[...ds(fs.filter((Ns,Ts)=>Ts%2==0)),...ds(fs.filter((Ns,Ts)=>Ts%2==1))],gs=0;gs<hs/2;gs++){var bs=ys[gs],vs=is(ys[gs+hs/2],os(is(is(ls,us),as(-gs,hs))));ys[gs]=ns(bs,vs),ys[gs+hs/2]=ns(bs,is(-1,vs))}return ys}throw new Error("Can only calculate FFT of power-of-two size")}}),name$2X="ifft",dependencies$2X=["typed","fft","dotDivide","conj"],createIfft=factory(name$2X,dependencies$2X,ss=>{var{typed:ts,fft:rs,dotDivide:ns,conj:is}=ss;return ts(name$2X,{"Array | Matrix":function(as){var os=isMatrix(as)?as.size():arraySize(as);return ns(is(rs(is(as))),os.reduce((ls,us)=>ls*us,1))}})}),name$2W="erf",dependencies$2W=["typed"],createErf=factory(name$2W,dependencies$2W,ss=>{var{typed:ts}=ss;return ts("name",{number:function(rs){var ns=Math.abs(rs);return ns>=MAX_NUM?sign$3(rs):ns<=THRESH?sign$3(rs)*function(is){var as,os=is*is,ls=P$3[0][4]*os,us=os;for(as=0;as<3;as+=1)ls=(ls+P$3[0][as])*os,us=(us+Q$3[0][as])*os;return is*(ls+P$3[0][3])/(us+Q$3[0][3])}(ns):ns<=4?sign$3(rs)*(1-function(is){var as,os=P$3[1][8]*is,ls=is;for(as=0;as<7;as+=1)os=(os+P$3[1][as])*is,ls=(ls+Q$3[1][as])*is;var us=(os+P$3[1][7])/(ls+Q$3[1][7]),cs=parseInt(16*is)/16,ps=(is-cs)*(is+cs);return Math.exp(-cs*cs)*Math.exp(-ps)*us}(ns)):sign$3(rs)*(1-function(is){var as,os=1/(is*is),ls=P$3[2][5]*os,us=os;for(as=0;as<4;as+=1)ls=(ls+P$3[2][as])*os,us=(us+Q$3[2][as])*os;var cs=os*(ls+P$3[2][4])/(us+Q$3[2][4]);cs=(SQRPI-cs)/is,os=parseInt(16*is)/16;var ps=(is-os)*(is+os);return Math.exp(-os*os)*Math.exp(-ps)*cs}(ns))},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),THRESH=.46875,SQRPI=.5641895835477563,P$3=[[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,21531153547440383e-24],[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097]],Q$3=[[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918]],MAX_NUM=Math.pow(2,53),name$2V="mode",dependencies$2V=["typed","isNaN","isNumeric"],createMode=factory(name$2V,dependencies$2V,ss=>{var{typed:ts,isNaN:rs,isNumeric:ns}=ss;return ts(name$2V,{"Array | Matrix":is,"...":function(as){return is(as)}});function is(as){if((as=flatten$4(as.valueOf())).length===0)throw new Error("Cannot calculate mode of an empty array");for(var os={},ls=[],us=0,cs=0;cs<as.length;cs++){var ps=as[cs];if(ns(ps)&&rs(ps))throw new Error("Cannot calculate mode of an array containing NaN values");ps in os||(os[ps]=0),os[ps]++,os[ps]===us?ls.push(ps):os[ps]>us&&(us=os[ps],ls=[ps])}return ls}});function improveErrorMessage(ss,ts,rs){var ns;return String(ss).indexOf("Unexpected type")!==-1?(ns=arguments.length>2?" (type: "+typeOf$1(rs)+", value: "+JSON.stringify(rs)+")":" (type: "+ss.data.actual+")",new TypeError("Cannot calculate "+ts+", unexpected type of argument"+ns)):String(ss).indexOf("complex numbers")!==-1?(ns=arguments.length>2?" (type: "+typeOf$1(rs)+", value: "+JSON.stringify(rs)+")":"",new TypeError("Cannot calculate "+ts+", no ordering relation is defined for complex numbers"+ns)):ss}var name$2U="prod",dependencies$2U=["typed","config","multiplyScalar","numeric"],createProd=factory(name$2U,dependencies$2U,ss=>{var{typed:ts,config:rs,multiplyScalar:ns,numeric:is}=ss;return ts(name$2U,{"Array | Matrix":as,"Array | Matrix, number | BigNumber":function(os,ls){throw new Error("prod(A, dim) is not yet supported")},"...":function(os){return as(os)}});function as(os){var ls;if(deepForEach(os,function(us){try{ls=ls===void 0?us:ns(ls,us)}catch(cs){throw improveErrorMessage(cs,"prod",us)}}),typeof ls=="string"&&(ls=is(ls,rs.number)),ls===void 0)throw new Error("Cannot calculate prod of an empty array");return ls}}),name$2T="format",dependencies$2T=["typed"],createFormat=factory(name$2T,dependencies$2T,ss=>{var{typed:ts}=ss;return ts(name$2T,{any:format$1,"any, Object | function | number":format$1})}),name$2S="bin",dependencies$2S=["typed","format"],createBin=factory(name$2S,dependencies$2S,ss=>{var{typed:ts,format:rs}=ss;return ts(name$2S,{"number | BigNumber":function(ns){return rs(ns,{notation:"bin"})},"number | BigNumber, number":function(ns,is){return rs(ns,{notation:"bin",wordSize:is})}})}),name$2R="oct",dependencies$2R=["typed","format"],createOct=factory(name$2R,dependencies$2R,ss=>{var{typed:ts,format:rs}=ss;return ts(name$2R,{"number | BigNumber":function(ns){return rs(ns,{notation:"oct"})},"number | BigNumber, number":function(ns,is){return rs(ns,{notation:"oct",wordSize:is})}})}),name$2Q="hex",dependencies$2Q=["typed","format"],createHex=factory(name$2Q,dependencies$2Q,ss=>{var{typed:ts,format:rs}=ss;return ts(name$2Q,{"number | BigNumber":function(ns){return rs(ns,{notation:"hex"})},"number | BigNumber, number":function(ns,is){return rs(ns,{notation:"hex",wordSize:is})}})}),name$2P="print",dependencies$2P=["typed"],createPrint=factory(name$2P,dependencies$2P,ss=>{var{typed:ts}=ss;return ts(name$2P,{"string, Object | Array":_print,"string, Object | Array, number | Object":_print})});function _print(ss,ts,rs){return ss.replace(/\$([\w.]+)/g,function(ns,is){for(var as=is.split("."),os=ts[as.shift()];as.length&&os!==void 0;){var ls=as.shift();os=ls?os[ls]:os+"."}return os!==void 0?isString$1$1(os)?os:format$1(os,rs):ns})}var name$2O="to",dependencies$2O=["typed","matrix"],createTo=factory(name$2O,dependencies$2O,ss=>{var{typed:ts,matrix:rs}=ss,ns=createAlgorithm13({typed:ts}),is=createAlgorithm14({typed:ts});return ts(name$2O,{"Unit, Unit | string":function(as,os){return as.to(os)},"Matrix, Matrix":function(as,os){return ns(as,os,this)},"Array, Array":function(as,os){return this(rs(as),rs(os)).valueOf()},"Array, Matrix":function(as,os){return this(rs(as),os)},"Matrix, Array":function(as,os){return this(as,rs(os))},"Matrix, any":function(as,os){return is(as,os,this,!1)},"any, Matrix":function(as,os){return is(os,as,this,!0)},"Array, any":function(as,os){return is(rs(as),os,this,!1).valueOf()},"any, Array":function(as,os){return is(rs(os),as,this,!0).valueOf()}})}),name$2N="isPrime",dependencies$2N=["typed"],createIsPrime=factory(name$2N,dependencies$2N,ss=>{var{typed:ts}=ss;return ts(name$2N,{number:function(rs){if(0*rs!=0)return!1;if(rs<=3)return rs>1;if(rs%2==0||rs%3==0)return!1;for(var ns=5;ns*ns<=rs;ns+=6)if(rs%ns==0||rs%(ns+2)==0)return!1;return!0},BigNumber:function(rs){if(0*rs.toNumber()!=0)return!1;if(rs.lte(3))return rs.gt(1);if(rs.mod(2).eq(0)||rs.mod(3).eq(0))return!1;if(rs.lt(Math.pow(2,32))){for(var ns=rs.toNumber(),is=5;is*is<=ns;is+=6)if(ns%is==0||ns%(is+2)==0)return!1;return!0}function as(vs,Ns,Ts){for(var Cs=1;!Ns.eq(0);)Ns.mod(2).eq(0)?(Ns=Ns.div(2),vs=vs.mul(vs).mod(Ts)):(Ns=Ns.sub(1),Cs=vs.mul(Cs).mod(Ts));return Cs}for(var os=rs.constructor.clone({precision:2*rs.toFixed(0).length}),ls=0,us=(rs=new os(rs)).sub(1);us.mod(2).eq(0);)us=us.div(2),ls+=1;var cs=null;if(rs.lt("3317044064679887385961981"))cs=[2,3,5,7,11,13,17,19,23,29,31,37,41].filter(vs=>vs<rs);else{var ps=Math.min(rs.toNumber()-2,Math.floor(2*Math.pow(rs.toFixed(0).length*Math.log(10),2)));cs=[];for(var ds=2;ds<=ps;ds+=1)cs.push(ps)}for(var fs=0;fs<cs.length;fs+=1){var hs=cs[fs],ys=as(rs.sub(rs).add(hs),us,rs);if(!ys.eq(1)){for(var gs=0,bs=ys;!bs.eq(rs.sub(1));gs+=1,bs=bs.mul(bs).mod(rs))if(gs===ls-1)return!1}}return!0},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$2M="numeric",dependencies$2M=["number","?bignumber","?fraction"],createNumeric=factory(name$2M,dependencies$2M,ss=>{var{number:ts,bignumber:rs,fraction:ns}=ss,is={string:!0,number:!0,BigNumber:!0,Fraction:!0},as={number:os=>ts(os),BigNumber:rs?os=>rs(os):noBignumber,Fraction:ns?os=>ns(os):noFraction};return function(os,ls){var us=typeOf$1(os);if(!(us in is))throw new TypeError("Cannot convert "+os+' of type "'+us+'"; valid input types are '+Object.keys(is).join(", "));if(!(ls in as))throw new TypeError("Cannot convert "+os+' to type "'+ls+'"; valid output types are '+Object.keys(as).join(", "));return ls===us?os:as[ls](os)}}),name$2L="divideScalar",dependencies$2L=["typed","numeric"],createDivideScalar=factory(name$2L,dependencies$2L,ss=>{var{typed:ts,numeric:rs}=ss;return ts(name$2L,{"number, number":function(ns,is){return ns/is},"Complex, Complex":function(ns,is){return ns.div(is)},"BigNumber, BigNumber":function(ns,is){return ns.div(is)},"Fraction, Fraction":function(ns,is){return ns.div(is)},"Unit, number | Fraction | BigNumber":function(ns,is){var as=ns.clone(),os=rs(1,typeOf$1(is));return as.value=this(as.value===null?as._normalize(os):as.value,is),as},"number | Fraction | BigNumber, Unit":function(ns,is){var as=is.clone();as=as.pow(-1);var os=rs(1,typeOf$1(ns));return as.value=this(ns,is.value===null?is._normalize(os):is.value),as},"Unit, Unit":function(ns,is){return ns.divide(is)}})}),name$2K="pow",dependencies$2K=["typed","config","identity","multiply","matrix","inv","fraction","number","Complex"],createPow=factory(name$2K,dependencies$2K,ss=>{var{typed:ts,config:rs,identity:ns,multiply:is,matrix:as,inv:os,number:ls,fraction:us,Complex:cs}=ss;return ts(name$2K,{"number, number":ps,"Complex, Complex":function(hs,ys){return hs.pow(ys)},"BigNumber, BigNumber":function(hs,ys){return ys.isInteger()||hs>=0||rs.predictable?hs.pow(ys):new cs(hs.toNumber(),0).pow(ys.toNumber(),0)},"Fraction, Fraction":function(hs,ys){var gs=hs.pow(ys);if(gs!=null)return gs;if(rs.predictable)throw new Error("Result of pow is non-rational and cannot be expressed as a fraction");return ps(hs.valueOf(),ys.valueOf())},"Array, number":ds,"Array, BigNumber":function(hs,ys){return ds(hs,ys.toNumber())},"Matrix, number":fs,"Matrix, BigNumber":function(hs,ys){return fs(hs,ys.toNumber())},"Unit, number | BigNumber":function(hs,ys){return hs.pow(ys)}});function ps(hs,ys){if(rs.predictable&&!isInteger$1(ys)&&hs<0)try{var gs=us(ys),bs=ls(gs);if((ys===bs||Math.abs((ys-bs)/ys)<1e-14)&&gs.d%2==1)return(gs.n%2==0?1:-1)*Math.pow(-hs,ys)}catch{}return rs.predictable&&(hs<-1&&ys===1/0||hs>-1&&hs<0&&ys===-1/0)?NaN:isInteger$1(ys)||hs>=0||rs.predictable?powNumber(hs,ys):hs*hs<1&&ys===1/0||hs*hs>1&&ys===-1/0?0:new cs(hs,0).pow(ys,0)}function ds(hs,ys){if(!isInteger$1(ys))throw new TypeError("For A^b, b must be an integer (value is "+ys+")");var gs=arraySize(hs);if(gs.length!==2)throw new Error("For A^b, A must be 2 dimensional (A has "+gs.length+" dimensions)");if(gs[0]!==gs[1])throw new Error("For A^b, A must be square (size is "+gs[0]+"x"+gs[1]+")");if(ys<0)try{return ds(os(hs),-ys)}catch(Ns){throw Ns.message==="Cannot calculate inverse, determinant is zero"?new TypeError("For A^b, when A is not invertible, b must be a positive integer (value is "+ys+")"):Ns}for(var bs=ns(gs[0]).valueOf(),vs=hs;ys>=1;)(1&ys)==1&&(bs=is(vs,bs)),ys>>=1,vs=is(vs,vs);return bs}function fs(hs,ys){return as(ds(hs.valueOf(),ys))}}),NO_INT="Number of decimals in function round must be an integer",name$2J="round",dependencies$2J=["typed","matrix","equalScalar","zeros","BigNumber","DenseMatrix"],createRound=factory(name$2J,dependencies$2J,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,zeros:is,BigNumber:as,DenseMatrix:os}=ss,ls=createAlgorithm11({typed:ts,equalScalar:ns}),us=createAlgorithm12({typed:ts,DenseMatrix:os}),cs=createAlgorithm14({typed:ts});return ts(name$2J,{number:roundNumber,"number, number":roundNumber,"number, BigNumber":function(ps,ds){if(!ds.isInteger())throw new TypeError(NO_INT);return new as(ps).toDecimalPlaces(ds.toNumber())},Complex:function(ps){return ps.round()},"Complex, number":function(ps,ds){if(ds%1)throw new TypeError(NO_INT);return ps.round(ds)},"Complex, BigNumber":function(ps,ds){if(!ds.isInteger())throw new TypeError(NO_INT);var fs=ds.toNumber();return ps.round(fs)},BigNumber:function(ps){return ps.toDecimalPlaces(0)},"BigNumber, BigNumber":function(ps,ds){if(!ds.isInteger())throw new TypeError(NO_INT);return ps.toDecimalPlaces(ds.toNumber())},Fraction:function(ps){return ps.round()},"Fraction, number":function(ps,ds){if(ds%1)throw new TypeError(NO_INT);return ps.round(ds)},"Fraction, BigNumber":function(ps,ds){if(!ds.isInteger())throw new TypeError(NO_INT);return ps.round(ds.toNumber())},"Array | Matrix":function(ps){return deepMap(ps,this)},"SparseMatrix, number | BigNumber":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, number | BigNumber":function(ps,ds){return cs(ps,ds,this,!1)},"Array, number | BigNumber":function(ps,ds){return cs(rs(ps),ds,this,!1).valueOf()},"number | Complex | BigNumber | Fraction, SparseMatrix":function(ps,ds){return ns(ps,0)?is(ds.size(),ds.storage()):us(ds,ps,this,!0)},"number | Complex | BigNumber | Fraction, DenseMatrix":function(ps,ds){return ns(ps,0)?is(ds.size(),ds.storage()):cs(ds,ps,this,!0)},"number | Complex | BigNumber | Fraction, Array":function(ps,ds){return cs(rs(ds),ps,this,!0).valueOf()}})}),name$2I="log",dependencies$2I=["config","typed","divideScalar","Complex"],createLog=factory(name$2I,dependencies$2I,ss=>{var{typed:ts,config:rs,divideScalar:ns,Complex:is}=ss;return ts(name$2I,{number:function(as){return as>=0||rs.predictable?logNumber(as):new is(as,0).log()},Complex:function(as){return as.log()},BigNumber:function(as){return!as.isNegative()||rs.predictable?as.ln():new is(as.toNumber(),0).log()},"Array | Matrix":function(as){return deepMap(as,this)},"any, any":function(as,os){return ns(this(as),this(os))}})}),name$2H="log1p",dependencies$2H=["typed","config","divideScalar","log","Complex"],createLog1p=factory(name$2H,dependencies$2H,ss=>{var{typed:ts,config:rs,divideScalar:ns,log:is,Complex:as}=ss;return ts(name$2H,{number:function(ls){return ls>=-1||rs.predictable?log1p$1(ls):os(new as(ls,0))},Complex:os,BigNumber:function(ls){var us=ls.plus(1);return!us.isNegative()||rs.predictable?us.ln():os(new as(ls.toNumber(),0))},"Array | Matrix":function(ls){return deepMap(ls,this)},"any, any":function(ls,us){return ns(this(ls),is(us))}});function os(ls){var us=ls.re+1;return new as(Math.log(Math.sqrt(us*us+ls.im*ls.im)),Math.atan2(ls.im,us))}}),name$2G="nthRoots",dependencies$2G=["config","typed","divideScalar","Complex"],createNthRoots=factory(name$2G,dependencies$2G,ss=>{var{typed:ts,config:rs,divideScalar:ns,Complex:is}=ss,as=[function(ls){return new is(ls,0)},function(ls){return new is(0,ls)},function(ls){return new is(-ls,0)},function(ls){return new is(0,-ls)}];function os(ls,us){if(us<0)throw new Error("Root must be greater than zero");if(us===0)throw new Error("Root must be non-zero");if(us%1!=0)throw new Error("Root must be an integer");if(ls===0||ls.abs()===0)return[new is(0,0)];var cs,ps=typeof ls=="number";(ps||ls.re===0||ls.im===0)&&(cs=ps?2*+(ls<0):ls.im===0?2*+(ls.re<0):2*+(ls.im<0)+1);for(var ds=ls.arg(),fs=ls.abs(),hs=[],ys=Math.pow(fs,1/us),gs=0;gs<us;gs++){var bs=(cs+4*gs)/us;bs!==Math.round(bs)?hs.push(new is({r:ys,phi:(ds+2*Math.PI*gs)/us})):hs.push(as[bs%4](ys))}return hs}return ts(name$2G,{Complex:function(ls){return os(ls,2)},"Complex, number":os})}),name$2F="dotPow",dependencies$2F=["typed","equalScalar","matrix","pow","DenseMatrix"],createDotPow=factory(name$2F,dependencies$2F,ss=>{var{typed:ts,equalScalar:rs,matrix:ns,pow:is,DenseMatrix:as}=ss,os=createAlgorithm03({typed:ts}),ls=createAlgorithm07({typed:ts,DenseMatrix:as}),us=createAlgorithm11({typed:ts,equalScalar:rs}),cs=createAlgorithm12({typed:ts,DenseMatrix:as}),ps=createAlgorithm13({typed:ts}),ds=createAlgorithm14({typed:ts});return ts(name$2F,{"any, any":is,"SparseMatrix, SparseMatrix":function(fs,hs){return ls(fs,hs,is,!1)},"SparseMatrix, DenseMatrix":function(fs,hs){return os(hs,fs,is,!0)},"DenseMatrix, SparseMatrix":function(fs,hs){return os(fs,hs,is,!1)},"DenseMatrix, DenseMatrix":function(fs,hs){return ps(fs,hs,is)},"Array, Array":function(fs,hs){return this(ns(fs),ns(hs)).valueOf()},"Array, Matrix":function(fs,hs){return this(ns(fs),hs)},"Matrix, Array":function(fs,hs){return this(fs,ns(hs))},"SparseMatrix, any":function(fs,hs){return us(fs,hs,this,!1)},"DenseMatrix, any":function(fs,hs){return ds(fs,hs,this,!1)},"any, SparseMatrix":function(fs,hs){return cs(hs,fs,this,!0)},"any, DenseMatrix":function(fs,hs){return ds(hs,fs,this,!0)},"Array, any":function(fs,hs){return ds(ns(fs),hs,this,!1).valueOf()},"any, Array":function(fs,hs){return ds(ns(hs),fs,this,!0).valueOf()}})}),name$2E="dotDivide",dependencies$2E=["typed","matrix","equalScalar","divideScalar","DenseMatrix"],createDotDivide=factory(name$2E,dependencies$2E,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,divideScalar:is,DenseMatrix:as}=ss,os=createAlgorithm02({typed:ts,equalScalar:ns}),ls=createAlgorithm03({typed:ts}),us=createAlgorithm07({typed:ts,DenseMatrix:as}),cs=createAlgorithm11({typed:ts,equalScalar:ns}),ps=createAlgorithm12({typed:ts,DenseMatrix:as}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$2E,{"any, any":is,"SparseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,is,!1)},"SparseMatrix, DenseMatrix":function(hs,ys){return os(ys,hs,is,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return ls(hs,ys,is,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,is)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, any":function(hs,ys){return cs(hs,ys,is,!1)},"DenseMatrix, any":function(hs,ys){return fs(hs,ys,is,!1)},"any, SparseMatrix":function(hs,ys){return ps(ys,hs,is,!0)},"any, DenseMatrix":function(hs,ys){return fs(ys,hs,is,!0)},"Array, any":function(hs,ys){return fs(rs(hs),ys,is,!1).valueOf()},"any, Array":function(hs,ys){return fs(rs(ys),hs,is,!0).valueOf()}})});function createSolveValidation(ss){var{DenseMatrix:ts}=ss;return function(rs,ns,is){var as=rs.size();if(as.length!==2)throw new RangeError("Matrix must be two dimensional (size: "+format$1(as)+")");var os=as[0];if(os!==as[1])throw new RangeError("Matrix must be square (size: "+format$1(as)+")");var ls=[];if(isMatrix(ns)){var us=ns.size(),cs=ns._data;if(us.length===1){if(us[0]!==os)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var ps=0;ps<os;ps++)ls[ps]=[cs[ps]];return new ts({data:ls,size:[os,1],datatype:ns._datatype})}if(us.length===2){if(us[0]!==os||us[1]!==1)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");if(isDenseMatrix(ns)){if(is){ls=[];for(var ds=0;ds<os;ds++)ls[ds]=[cs[ds][0]];return new ts({data:ls,size:[os,1],datatype:ns._datatype})}return ns}if(isSparseMatrix(ns)){for(var fs=0;fs<os;fs++)ls[fs]=[0];for(var hs=ns._values,ys=ns._index,gs=ns._ptr,bs=gs[1],vs=gs[0];vs<bs;vs++)ls[ys[vs]][0]=hs[vs];return new ts({data:ls,size:[os,1],datatype:ns._datatype})}}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}if(isArray$1$1(ns)){var Ns=arraySize(ns);if(Ns.length===1){if(Ns[0]!==os)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var Ts=0;Ts<os;Ts++)ls[Ts]=[ns[Ts]];return new ts({data:ls,size:[os,1]})}if(Ns.length===2){if(Ns[0]!==os||Ns[1]!==1)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var Cs=0;Cs<os;Cs++)ls[Cs]=[ns[Cs][0]];return new ts({data:ls,size:[os,1]})}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}}}var name$2D="lsolve",dependencies$2D=["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],createLsolve=factory(name$2D,dependencies$2D,ss=>{var{typed:ts,matrix:rs,divideScalar:ns,multiplyScalar:is,subtract:as,equalScalar:os,DenseMatrix:ls}=ss,us=createSolveValidation({DenseMatrix:ls});return ts(name$2D,{"SparseMatrix, Array | Matrix":function(ps,ds){return function(fs,hs){for(var ys=(hs=us(fs,hs,!0))._data,gs=fs._size[0],bs=fs._size[1],vs=fs._values,Ns=fs._index,Ts=fs._ptr,Cs=[],xs=0;xs<bs;xs++){var As=ys[xs][0]||0;if(os(As,0))Cs[xs]=[0];else{for(var ws=0,Es=[],Ss=[],Ds=Ts[xs],Vs=Ts[xs+1],Is=Ds;Is<Vs;Is++){var Os=Ns[Is];Os===xs?ws=vs[Is]:Os>xs&&(Es.push(vs[Is]),Ss.push(Os))}if(os(ws,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var Ps=ns(As,ws),$s=0,Rs=Ss.length;$s<Rs;$s++){var ks=Ss[$s];ys[ks]=[as(ys[ks][0]||0,is(Ps,Es[$s]))]}Cs[xs]=[Ps]}}return new ls({data:Cs,size:[gs,1]})}(ps,ds)},"DenseMatrix, Array | Matrix":function(ps,ds){return cs(ps,ds)},"Array, Array | Matrix":function(ps,ds){return cs(rs(ps),ds).valueOf()}});function cs(ps,ds){for(var fs=(ds=us(ps,ds,!0))._data,hs=ps._size[0],ys=ps._size[1],gs=[],bs=ps._data,vs=0;vs<ys;vs++){var Ns=fs[vs][0]||0,Ts=void 0;if(os(Ns,0))Ts=0;else{var Cs=bs[vs][vs];if(os(Cs,0))throw new Error("Linear system cannot be solved since matrix is singular");Ts=ns(Ns,Cs);for(var xs=vs+1;xs<hs;xs++)fs[xs]=[as(fs[xs][0]||0,is(Ts,bs[xs][vs]))]}gs[vs]=[Ts]}return new ls({data:gs,size:[hs,1]})}}),name$2C="usolve",dependencies$2C=["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],createUsolve=factory(name$2C,dependencies$2C,ss=>{var{typed:ts,matrix:rs,divideScalar:ns,multiplyScalar:is,subtract:as,equalScalar:os,DenseMatrix:ls}=ss,us=createSolveValidation({DenseMatrix:ls});return ts(name$2C,{"SparseMatrix, Array | Matrix":function(ps,ds){return function(fs,hs){for(var ys=(hs=us(fs,hs,!0))._data,gs=fs._size[0],bs=fs._size[1],vs=fs._values,Ns=fs._index,Ts=fs._ptr,Cs=[],xs=bs-1;xs>=0;xs--){var As=ys[xs][0]||0;if(os(As,0))Cs[xs]=[0];else{for(var ws=0,Es=[],Ss=[],Ds=Ts[xs],Vs=Ts[xs+1]-1;Vs>=Ds;Vs--){var Is=Ns[Vs];Is===xs?ws=vs[Vs]:Is<xs&&(Es.push(vs[Vs]),Ss.push(Is))}if(os(ws,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var Os=ns(As,ws),Ps=0,$s=Ss.length;Ps<$s;Ps++){var Rs=Ss[Ps];ys[Rs]=[as(ys[Rs][0],is(Os,Es[Ps]))]}Cs[xs]=[Os]}}return new ls({data:Cs,size:[gs,1]})}(ps,ds)},"DenseMatrix, Array | Matrix":function(ps,ds){return cs(ps,ds)},"Array, Array | Matrix":function(ps,ds){return cs(rs(ps),ds).valueOf()}});function cs(ps,ds){for(var fs=(ds=us(ps,ds,!0))._data,hs=ps._size[0],ys=ps._size[1],gs=[],bs=ps._data,vs=ys-1;vs>=0;vs--){var Ns=fs[vs][0]||0,Ts=void 0;if(os(Ns,0))Ts=0;else{var Cs=bs[vs][vs];if(os(Cs,0))throw new Error("Linear system cannot be solved since matrix is singular");Ts=ns(Ns,Cs);for(var xs=vs-1;xs>=0;xs--)fs[xs]=[as(fs[xs][0]||0,is(Ts,bs[xs][vs]))]}gs[vs]=[Ts]}return new ls({data:gs,size:[hs,1]})}}),name$2B="lsolveAll",dependencies$2B=["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],createLsolveAll=factory(name$2B,dependencies$2B,ss=>{var{typed:ts,matrix:rs,divideScalar:ns,multiplyScalar:is,subtract:as,equalScalar:os,DenseMatrix:ls}=ss,us=createSolveValidation({DenseMatrix:ls});return ts(name$2B,{"SparseMatrix, Array | Matrix":function(ps,ds){return function(fs,hs){for(var ys=[us(fs,hs,!0)._data.map(Hs=>Hs[0])],gs=fs._size[0],bs=fs._size[1],vs=fs._values,Ns=fs._index,Ts=fs._ptr,Cs=0;Cs<bs;Cs++)for(var xs=ys.length,As=0;As<xs;As++){for(var ws=ys[As],Es=[],Ss=[],Ds=Ts[Cs],Vs=Ts[Cs+1],Is=0,Os=Ds;Os<Vs;Os++){var Ps=Ns[Os];Ps===Cs?Is=vs[Os]:Ps>Cs&&(Es.push(vs[Os]),Ss.push(Ps))}if(os(Is,0))if(os(ws[Cs],0)){if(As===0){var $s=[...ws];$s[Cs]=1;for(var Rs=0,ks=Ss.length;Rs<ks;Rs++){var _s=Ss[Rs];$s[_s]=as($s[_s],Es[Rs])}ys.push($s)}}else{if(As===0)return[];ys.splice(As,1),As-=1,xs-=1}else{ws[Cs]=ns(ws[Cs],Is);for(var Bs=0,Us=Ss.length;Bs<Us;Bs++){var zs=Ss[Bs];ws[zs]=as(ws[zs],is(ws[Cs],Es[Bs]))}}}return ys.map(Hs=>new ls({data:Hs.map(el=>[el]),size:[gs,1]}))}(ps,ds)},"DenseMatrix, Array | Matrix":function(ps,ds){return cs(ps,ds)},"Array, Array | Matrix":function(ps,ds){return cs(rs(ps),ds).map(fs=>fs.valueOf())}});function cs(ps,ds){for(var fs=[us(ps,ds,!0)._data.map(ws=>ws[0])],hs=ps._data,ys=ps._size[0],gs=ps._size[1],bs=0;bs<gs;bs++)for(var vs=fs.length,Ns=0;Ns<vs;Ns++){var Ts=fs[Ns];if(os(hs[bs][bs],0))if(os(Ts[bs],0)){if(Ns===0){var Cs=[...Ts];Cs[bs]=1;for(var xs=bs+1;xs<gs;xs++)Cs[xs]=as(Cs[xs],hs[xs][bs]);fs.push(Cs)}}else{if(Ns===0)return[];fs.splice(Ns,1),Ns-=1,vs-=1}else{Ts[bs]=ns(Ts[bs],hs[bs][bs]);for(var As=bs+1;As<gs;As++)Ts[As]=as(Ts[As],is(Ts[bs],hs[As][bs]))}}return fs.map(ws=>new ls({data:ws.map(Es=>[Es]),size:[ys,1]}))}}),name$2A="usolveAll",dependencies$2A=["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],createUsolveAll=factory(name$2A,dependencies$2A,ss=>{var{typed:ts,matrix:rs,divideScalar:ns,multiplyScalar:is,subtract:as,equalScalar:os,DenseMatrix:ls}=ss,us=createSolveValidation({DenseMatrix:ls});return ts(name$2A,{"SparseMatrix, Array | Matrix":function(ps,ds){return function(fs,hs){for(var ys=[us(fs,hs,!0)._data.map(zs=>zs[0])],gs=fs._size[0],bs=fs._size[1],vs=fs._values,Ns=fs._index,Ts=fs._ptr,Cs=bs-1;Cs>=0;Cs--)for(var xs=ys.length,As=0;As<xs;As++){for(var ws=ys[As],Es=[],Ss=[],Ds=Ts[Cs],Vs=0,Is=Ts[Cs+1]-1;Is>=Ds;Is--){var Os=Ns[Is];Os===Cs?Vs=vs[Is]:Os<Cs&&(Es.push(vs[Is]),Ss.push(Os))}if(os(Vs,0))if(os(ws[Cs],0)){if(As===0){var Ps=[...ws];Ps[Cs]=1;for(var $s=0,Rs=Ss.length;$s<Rs;$s++){var ks=Ss[$s];Ps[ks]=as(Ps[ks],Es[$s])}ys.push(Ps)}}else{if(As===0)return[];ys.splice(As,1),As-=1,xs-=1}else{ws[Cs]=ns(ws[Cs],Vs);for(var _s=0,Bs=Ss.length;_s<Bs;_s++){var Us=Ss[_s];ws[Us]=as(ws[Us],is(ws[Cs],Es[_s]))}}}return ys.map(zs=>new ls({data:zs.map(Hs=>[Hs]),size:[gs,1]}))}(ps,ds)},"DenseMatrix, Array | Matrix":function(ps,ds){return cs(ps,ds)},"Array, Array | Matrix":function(ps,ds){return cs(rs(ps),ds).map(fs=>fs.valueOf())}});function cs(ps,ds){for(var fs=[us(ps,ds,!0)._data.map(As=>As[0])],hs=ps._data,ys=ps._size[0],gs=ps._size[1]-1;gs>=0;gs--)for(var bs=fs.length,vs=0;vs<bs;vs++){var Ns=fs[vs];if(os(hs[gs][gs],0))if(os(Ns[gs],0)){if(vs===0){var Ts=[...Ns];Ts[gs]=1;for(var Cs=gs-1;Cs>=0;Cs--)Ts[Cs]=as(Ts[Cs],hs[Cs][gs]);fs.push(Ts)}}else{if(vs===0)return[];fs.splice(vs,1),vs-=1,bs-=1}else{Ns[gs]=ns(Ns[gs],hs[gs][gs]);for(var xs=gs-1;xs>=0;xs--)Ns[xs]=as(Ns[xs],is(Ns[gs],hs[xs][gs]))}}return fs.map(As=>new ls({data:As.map(ws=>[ws]),size:[ys,1]}))}}),name$2z="algorithm08",dependencies$2z=["typed","equalScalar"],createAlgorithm08=factory(name$2z,dependencies$2z,ss=>{var{typed:ts,equalScalar:rs}=ss;return function(ns,is,as){var os=ns._values,ls=ns._index,us=ns._ptr,cs=ns._size,ps=ns._datatype,ds=is._values,fs=is._index,hs=is._ptr,ys=is._size,gs=is._datatype;if(cs.length!==ys.length)throw new DimensionError(cs.length,ys.length);if(cs[0]!==ys[0]||cs[1]!==ys[1])throw new RangeError("Dimension mismatch. Matrix A ("+cs+") must match Matrix B ("+ys+")");if(!os||!ds)throw new Error("Cannot perform operation on Pattern Sparse Matrices");var bs,vs=cs[0],Ns=cs[1],Ts=rs,Cs=0,xs=as;typeof ps=="string"&&ps===gs&&(bs=ps,Ts=ts.find(rs,[bs,bs]),Cs=ts.convert(0,bs),xs=ts.find(as,[bs,bs]));for(var As,ws,Es,Ss,Ds=[],Vs=[],Is=[],Os=[],Ps=[],$s=0;$s<Ns;$s++){Is[$s]=Vs.length;var Rs=$s+1;for(ws=us[$s],Es=us[$s+1],As=ws;As<Es;As++)Ps[Ss=ls[As]]=Rs,Os[Ss]=os[As],Vs.push(Ss);for(ws=hs[$s],Es=hs[$s+1],As=ws;As<Es;As++)Ps[Ss=fs[As]]===Rs&&(Os[Ss]=xs(Os[Ss],ds[As]));for(As=Is[$s];As<Vs.length;){var ks=Os[Ss=Vs[As]];Ts(ks,Cs)?Vs.splice(As,1):(Ds.push(ks),As++)}}return Is[Ns]=Vs.length,ns.createSparseMatrix({values:Ds,index:Vs,ptr:Is,size:[vs,Ns],datatype:bs})}}),name$2y="leftShift",dependencies$2y=["typed","matrix","equalScalar","zeros","DenseMatrix"],createLeftShift=factory(name$2y,dependencies$2y,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,zeros:is,DenseMatrix:as}=ss,os=createAlgorithm01({typed:ts}),ls=createAlgorithm02({typed:ts,equalScalar:ns}),us=createAlgorithm08({typed:ts,equalScalar:ns}),cs=createAlgorithm10({typed:ts,DenseMatrix:as}),ps=createAlgorithm11({typed:ts,equalScalar:ns}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$2y,{"number, number":leftShiftNumber,"BigNumber, BigNumber":leftShiftBigNumber,"SparseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,this,!1)},"SparseMatrix, DenseMatrix":function(hs,ys){return ls(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return os(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():ps(hs,ys,this,!1)},"DenseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():fs(hs,ys,this,!1)},"number | BigNumber, SparseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):cs(ys,hs,this,!0)},"number | BigNumber, DenseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):fs(ys,hs,this,!0)},"Array, number | BigNumber":function(hs,ys){return this(rs(hs),ys).valueOf()},"number | BigNumber, Array":function(hs,ys){return this(hs,rs(ys)).valueOf()}})}),name$2x="rightArithShift",dependencies$2x=["typed","matrix","equalScalar","zeros","DenseMatrix"],createRightArithShift=factory(name$2x,dependencies$2x,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,zeros:is,DenseMatrix:as}=ss,os=createAlgorithm01({typed:ts}),ls=createAlgorithm02({typed:ts,equalScalar:ns}),us=createAlgorithm08({typed:ts,equalScalar:ns}),cs=createAlgorithm10({typed:ts,DenseMatrix:as}),ps=createAlgorithm11({typed:ts,equalScalar:ns}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$2x,{"number, number":rightArithShiftNumber,"BigNumber, BigNumber":rightArithShiftBigNumber,"SparseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,this,!1)},"SparseMatrix, DenseMatrix":function(hs,ys){return ls(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return os(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():ps(hs,ys,this,!1)},"DenseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():fs(hs,ys,this,!1)},"number | BigNumber, SparseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):cs(ys,hs,this,!0)},"number | BigNumber, DenseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):fs(ys,hs,this,!0)},"Array, number | BigNumber":function(hs,ys){return this(rs(hs),ys).valueOf()},"number | BigNumber, Array":function(hs,ys){return this(hs,rs(ys)).valueOf()}})}),name$2w="rightLogShift",dependencies$2w=["typed","matrix","equalScalar","zeros","DenseMatrix"],createRightLogShift=factory(name$2w,dependencies$2w,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,zeros:is,DenseMatrix:as}=ss,os=createAlgorithm01({typed:ts}),ls=createAlgorithm02({typed:ts,equalScalar:ns}),us=createAlgorithm08({typed:ts,equalScalar:ns}),cs=createAlgorithm10({typed:ts,DenseMatrix:as}),ps=createAlgorithm11({typed:ts,equalScalar:ns}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$2w,{"number, number":rightLogShiftNumber,"SparseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,this,!1)},"SparseMatrix, DenseMatrix":function(hs,ys){return ls(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return os(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():ps(hs,ys,this,!1)},"DenseMatrix, number | BigNumber":function(hs,ys){return ns(ys,0)?hs.clone():fs(hs,ys,this,!1)},"number | BigNumber, SparseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):cs(ys,hs,this,!0)},"number | BigNumber, DenseMatrix":function(hs,ys){return ns(hs,0)?is(ys.size(),ys.storage()):fs(ys,hs,this,!0)},"Array, number | BigNumber":function(hs,ys){return this(rs(hs),ys).valueOf()},"number | BigNumber, Array":function(hs,ys){return this(hs,rs(ys)).valueOf()}})}),name$2v="and",dependencies$2v=["typed","matrix","equalScalar","zeros","not"],createAnd=factory(name$2v,dependencies$2v,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,zeros:is,not:as}=ss,os=createAlgorithm02({typed:ts,equalScalar:ns}),ls=createAlgorithm06({typed:ts,equalScalar:ns}),us=createAlgorithm11({typed:ts,equalScalar:ns}),cs=createAlgorithm13({typed:ts}),ps=createAlgorithm14({typed:ts});return ts(name$2v,{"number, number":andNumber,"Complex, Complex":function(ds,fs){return!(ds.re===0&&ds.im===0||fs.re===0&&fs.im===0)},"BigNumber, BigNumber":function(ds,fs){return!(ds.isZero()||fs.isZero()||ds.isNaN()||fs.isNaN())},"Unit, Unit":function(ds,fs){return this(ds.value||0,fs.value||0)},"SparseMatrix, SparseMatrix":function(ds,fs){return ls(ds,fs,this,!1)},"SparseMatrix, DenseMatrix":function(ds,fs){return os(fs,ds,this,!0)},"DenseMatrix, SparseMatrix":function(ds,fs){return os(ds,fs,this,!1)},"DenseMatrix, DenseMatrix":function(ds,fs){return cs(ds,fs,this)},"Array, Array":function(ds,fs){return this(rs(ds),rs(fs)).valueOf()},"Array, Matrix":function(ds,fs){return this(rs(ds),fs)},"Matrix, Array":function(ds,fs){return this(ds,rs(fs))},"SparseMatrix, any":function(ds,fs){return as(fs)?is(ds.size(),ds.storage()):us(ds,fs,this,!1)},"DenseMatrix, any":function(ds,fs){return as(fs)?is(ds.size(),ds.storage()):ps(ds,fs,this,!1)},"any, SparseMatrix":function(ds,fs){return as(ds)?is(ds.size(),ds.storage()):us(fs,ds,this,!0)},"any, DenseMatrix":function(ds,fs){return as(ds)?is(ds.size(),ds.storage()):ps(fs,ds,this,!0)},"Array, any":function(ds,fs){return this(rs(ds),fs).valueOf()},"any, Array":function(ds,fs){return this(ds,rs(fs)).valueOf()}})}),name$2u="compare",dependencies$2u=["typed","config","matrix","equalScalar","BigNumber","Fraction","DenseMatrix"],createCompare=factory(name$2u,dependencies$2u,ss=>{var{typed:ts,config:rs,equalScalar:ns,matrix:is,BigNumber:as,Fraction:os,DenseMatrix:ls}=ss,us=createAlgorithm03({typed:ts}),cs=createAlgorithm05({typed:ts,equalScalar:ns}),ps=createAlgorithm12({typed:ts,DenseMatrix:ls}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$2u,{"boolean, boolean":function(hs,ys){return hs===ys?0:hs>ys?1:-1},"number, number":function(hs,ys){return nearlyEqual$1(hs,ys,rs.epsilon)?0:hs>ys?1:-1},"BigNumber, BigNumber":function(hs,ys){return nearlyEqual(hs,ys,rs.epsilon)?new as(0):new as(hs.cmp(ys))},"Fraction, Fraction":function(hs,ys){return new os(hs.compare(ys))},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(hs,ys){if(!hs.equalBase(ys))throw new Error("Cannot compare units with different base");return this(hs.value,ys.value)},"SparseMatrix, SparseMatrix":function(hs,ys){return cs(hs,ys,this)},"SparseMatrix, DenseMatrix":function(hs,ys){return us(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(is(hs),is(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(is(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,is(ys))},"SparseMatrix, any":function(hs,ys){return ps(hs,ys,this,!1)},"DenseMatrix, any":function(hs,ys){return fs(hs,ys,this,!1)},"any, SparseMatrix":function(hs,ys){return ps(ys,hs,this,!0)},"any, DenseMatrix":function(hs,ys){return fs(ys,hs,this,!0)},"Array, any":function(hs,ys){return fs(is(hs),ys,this,!1).valueOf()},"any, Array":function(hs,ys){return fs(is(ys),hs,this,!0).valueOf()}})}),naturalSort=function ss(ts,rs){var ns,is,as=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,os=/(^[ ]*|[ ]*$)/g,ls=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,us=/^0x[0-9a-f]+$/i,cs=/^0/,ps=function(Ts){return ss.insensitive&&(""+Ts).toLowerCase()||""+Ts},ds=ps(ts).replace(os,"")||"",fs=ps(rs).replace(os,"")||"",hs=ds.replace(as,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),ys=fs.replace(as,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),gs=parseInt(ds.match(us),16)||hs.length!==1&&ds.match(ls)&&Date.parse(ds),bs=parseInt(fs.match(us),16)||gs&&fs.match(ls)&&Date.parse(fs)||null;if(bs){if(gs<bs)return-1;if(gs>bs)return 1}for(var vs=0,Ns=Math.max(hs.length,ys.length);vs<Ns;vs++){if(ns=!(hs[vs]||"").match(cs)&&parseFloat(hs[vs])||hs[vs]||0,is=!(ys[vs]||"").match(cs)&&parseFloat(ys[vs])||ys[vs]||0,isNaN(ns)!==isNaN(is))return isNaN(ns)?1:-1;if(typeof ns!=typeof is&&(ns+="",is+=""),ns<is)return-1;if(ns>is)return 1}return 0},name$2t="compareNatural",dependencies$2t=["typed","compare"],createCompareNatural=factory(name$2t,dependencies$2t,ss=>{var{typed:ts,compare:rs}=ss,ns=rs.signatures["boolean,boolean"];return ts(name$2t,{"any, any":function(os,ls){var us,cs=typeOf$1(os),ps=typeOf$1(ls);if(!(cs!=="number"&&cs!=="BigNumber"&&cs!=="Fraction"||ps!=="number"&&ps!=="BigNumber"&&ps!=="Fraction"))return(us=rs(os,ls)).toString()!=="0"?us>0?1:-1:naturalSort(cs,ps);if(cs==="Array"||cs==="Matrix"||ps==="Array"||ps==="Matrix")return(us=is(this,os,ls))!==0?us:naturalSort(cs,ps);if(cs!==ps)return naturalSort(cs,ps);if(cs==="Complex")return compareComplexNumbers(os,ls);if(cs==="Unit")return os.equalBase(ls)?this(os.value,ls.value):as(this,os.formatUnits(),ls.formatUnits());if(cs==="boolean")return ns(os,ls);if(cs==="string")return naturalSort(os,ls);if(cs==="Object")return function(ds,fs,hs){var ys=Object.keys(fs),gs=Object.keys(hs);ys.sort(naturalSort),gs.sort(naturalSort);var bs=as(ds,ys,gs);if(bs!==0)return bs;for(var vs=0;vs<ys.length;vs++){var Ns=ds(fs[ys[vs]],hs[gs[vs]]);if(Ns!==0)return Ns}return 0}(this,os,ls);if(cs==="null"||cs==="undefined")return 0;throw new TypeError('Unsupported type of value "'+cs+'"')}});function is(os,ls,us){return isSparseMatrix(ls)&&isSparseMatrix(us)?as(os,ls.toJSON().values,us.toJSON().values):isSparseMatrix(ls)?is(os,ls.toArray(),us):isSparseMatrix(us)?is(os,ls,us.toArray()):isDenseMatrix(ls)?is(os,ls.toJSON().data,us):isDenseMatrix(us)?is(os,ls,us.toJSON().data):Array.isArray(ls)?Array.isArray(us)?as(os,ls,us):is(os,ls,[us]):is(os,[ls],us)}function as(os,ls,us){for(var cs=0,ps=Math.min(ls.length,us.length);cs<ps;cs++){var ds=os(ls[cs],us[cs]);if(ds!==0)return ds}return ls.length>us.length?1:ls.length<us.length?-1:0}});function compareComplexNumbers(ss,ts){return ss.re>ts.re?1:ss.re<ts.re?-1:ss.im>ts.im?1:ss.im<ts.im?-1:0}var name$2s="compareText",dependencies$2s=["typed","matrix"],createCompareText=factory(name$2s,dependencies$2s,ss=>{var{typed:ts,matrix:rs}=ss,ns=createAlgorithm13({typed:ts}),is=createAlgorithm14({typed:ts});return ts(name$2s,{"any, any":compareText$1,"DenseMatrix, DenseMatrix":function(as,os){return ns(as,os,compareText$1)},"Array, Array":function(as,os){return this(rs(as),rs(os)).valueOf()},"Array, Matrix":function(as,os){return this(rs(as),os)},"Matrix, Array":function(as,os){return this(as,rs(os))},"DenseMatrix, any":function(as,os){return is(as,os,compareText$1,!1)},"any, DenseMatrix":function(as,os){return is(os,as,compareText$1,!0)},"Array, any":function(as,os){return is(rs(as),os,compareText$1,!1).valueOf()},"any, Array":function(as,os){return is(rs(os),as,compareText$1,!0).valueOf()}})}),name$2r="equal",dependencies$2r=["typed","matrix","equalScalar","DenseMatrix"],createEqual=factory(name$2r,dependencies$2r,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm07({typed:ts,DenseMatrix:is}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$2r,{"any, any":function(ps,ds){return ps===null?ds===null:ds===null?ps===null:ps===void 0?ds===void 0:ds===void 0?ps===void 0:ns(ps,ds)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,ns)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,ns,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,ns,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,ns)},"Array, Array":function(ps,ds){return this(rs(ps),rs(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(rs(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,rs(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,ns,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,ns,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,ns,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,ns,!0)},"Array, any":function(ps,ds){return cs(rs(ps),ds,ns,!1).valueOf()},"any, Array":function(ps,ds){return cs(rs(ds),ps,ns,!0).valueOf()}})});factory(name$2r,["typed","equalScalar"],ss=>{var{typed:ts,equalScalar:rs}=ss;return ts(name$2r,{"any, any":function(ns,is){return ns===null?is===null:is===null?ns===null:ns===void 0?is===void 0:is===void 0?ns===void 0:rs(ns,is)}})});var name$2q="equalText",dependencies$2q=["typed","compareText","isZero"],createEqualText=factory(name$2q,dependencies$2q,ss=>{var{typed:ts,compareText:rs,isZero:ns}=ss;return ts(name$2q,{"any, any":function(is,as){return ns(rs(is,as))}})}),name$2p="smaller",dependencies$2p=["typed","config","matrix","DenseMatrix"],createSmaller=factory(name$2p,dependencies$2p,ss=>{var{typed:ts,config:rs,matrix:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm07({typed:ts,DenseMatrix:is}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$2p,{"boolean, boolean":function(ps,ds){return ps<ds},"number, number":function(ps,ds){return ps<ds&&!nearlyEqual$1(ps,ds,rs.epsilon)},"BigNumber, BigNumber":function(ps,ds){return ps.lt(ds)&&!nearlyEqual(ps,ds,rs.epsilon)},"Fraction, Fraction":function(ps,ds){return ps.compare(ds)===-1},"Complex, Complex":function(ps,ds){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(ps,ds){if(!ps.equalBase(ds))throw new Error("Cannot compare units with different base");return this(ps.value,ds.value)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(ns(ps),ns(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(ns(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,ns(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(ns(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(ns(ds),ps,this,!0).valueOf()}})}),name$2o="smallerEq",dependencies$2o=["typed","config","matrix","DenseMatrix"],createSmallerEq=factory(name$2o,dependencies$2o,ss=>{var{typed:ts,config:rs,matrix:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm07({typed:ts,DenseMatrix:is}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$2o,{"boolean, boolean":function(ps,ds){return ps<=ds},"number, number":function(ps,ds){return ps<=ds||nearlyEqual$1(ps,ds,rs.epsilon)},"BigNumber, BigNumber":function(ps,ds){return ps.lte(ds)||nearlyEqual(ps,ds,rs.epsilon)},"Fraction, Fraction":function(ps,ds){return ps.compare(ds)!==1},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(ps,ds){if(!ps.equalBase(ds))throw new Error("Cannot compare units with different base");return this(ps.value,ds.value)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(ns(ps),ns(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(ns(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,ns(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(ns(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(ns(ds),ps,this,!0).valueOf()}})}),name$2n="larger",dependencies$2n=["typed","config","matrix","DenseMatrix"],createLarger=factory(name$2n,dependencies$2n,ss=>{var{typed:ts,config:rs,matrix:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm07({typed:ts,DenseMatrix:is}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$2n,{"boolean, boolean":function(ps,ds){return ps>ds},"number, number":function(ps,ds){return ps>ds&&!nearlyEqual$1(ps,ds,rs.epsilon)},"BigNumber, BigNumber":function(ps,ds){return ps.gt(ds)&&!nearlyEqual(ps,ds,rs.epsilon)},"Fraction, Fraction":function(ps,ds){return ps.compare(ds)===1},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(ps,ds){if(!ps.equalBase(ds))throw new Error("Cannot compare units with different base");return this(ps.value,ds.value)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(ns(ps),ns(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(ns(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,ns(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(ns(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(ns(ds),ps,this,!0).valueOf()}})}),name$2m="largerEq",dependencies$2m=["typed","config","matrix","DenseMatrix"],createLargerEq=factory(name$2m,dependencies$2m,ss=>{var{typed:ts,config:rs,matrix:ns,DenseMatrix:is}=ss,as=createAlgorithm03({typed:ts}),os=createAlgorithm07({typed:ts,DenseMatrix:is}),ls=createAlgorithm12({typed:ts,DenseMatrix:is}),us=createAlgorithm13({typed:ts}),cs=createAlgorithm14({typed:ts});return ts(name$2m,{"boolean, boolean":function(ps,ds){return ps>=ds},"number, number":function(ps,ds){return ps>=ds||nearlyEqual$1(ps,ds,rs.epsilon)},"BigNumber, BigNumber":function(ps,ds){return ps.gte(ds)||nearlyEqual(ps,ds,rs.epsilon)},"Fraction, Fraction":function(ps,ds){return ps.compare(ds)!==-1},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(ps,ds){if(!ps.equalBase(ds))throw new Error("Cannot compare units with different base");return this(ps.value,ds.value)},"SparseMatrix, SparseMatrix":function(ps,ds){return os(ps,ds,this)},"SparseMatrix, DenseMatrix":function(ps,ds){return as(ds,ps,this,!0)},"DenseMatrix, SparseMatrix":function(ps,ds){return as(ps,ds,this,!1)},"DenseMatrix, DenseMatrix":function(ps,ds){return us(ps,ds,this)},"Array, Array":function(ps,ds){return this(ns(ps),ns(ds)).valueOf()},"Array, Matrix":function(ps,ds){return this(ns(ps),ds)},"Matrix, Array":function(ps,ds){return this(ps,ns(ds))},"SparseMatrix, any":function(ps,ds){return ls(ps,ds,this,!1)},"DenseMatrix, any":function(ps,ds){return cs(ps,ds,this,!1)},"any, SparseMatrix":function(ps,ds){return ls(ds,ps,this,!0)},"any, DenseMatrix":function(ps,ds){return cs(ds,ps,this,!0)},"Array, any":function(ps,ds){return cs(ns(ps),ds,this,!1).valueOf()},"any, Array":function(ps,ds){return cs(ns(ds),ps,this,!0).valueOf()}})}),name$2l="deepEqual",dependencies$2l=["typed","equal"],createDeepEqual=factory(name$2l,dependencies$2l,ss=>{var{typed:ts,equal:rs}=ss;return ts(name$2l,{"any, any":function(is,as){return ns(is.valueOf(),as.valueOf())}});function ns(is,as){if(Array.isArray(is)){if(Array.isArray(as)){var os=is.length;if(os!==as.length)return!1;for(var ls=0;ls<os;ls++)if(!ns(is[ls],as[ls]))return!1;return!0}return!1}return!Array.isArray(as)&&rs(is,as)}}),name$2k="unequal",dependencies$2k=["typed","config","equalScalar","matrix","DenseMatrix"],createUnequal=factory(name$2k,dependencies$2k,ss=>{var{typed:ts,config:rs,equalScalar:ns,matrix:is,DenseMatrix:as}=ss,os=createAlgorithm03({typed:ts}),ls=createAlgorithm07({typed:ts,DenseMatrix:as}),us=createAlgorithm12({typed:ts,DenseMatrix:as}),cs=createAlgorithm13({typed:ts}),ps=createAlgorithm14({typed:ts});return ts("unequal",{"any, any":function(fs,hs){return fs===null?hs!==null:hs===null?fs!==null:fs===void 0?hs!==void 0:hs===void 0?fs!==void 0:ds(fs,hs)},"SparseMatrix, SparseMatrix":function(fs,hs){return ls(fs,hs,ds)},"SparseMatrix, DenseMatrix":function(fs,hs){return os(hs,fs,ds,!0)},"DenseMatrix, SparseMatrix":function(fs,hs){return os(fs,hs,ds,!1)},"DenseMatrix, DenseMatrix":function(fs,hs){return cs(fs,hs,ds)},"Array, Array":function(fs,hs){return this(is(fs),is(hs)).valueOf()},"Array, Matrix":function(fs,hs){return this(is(fs),hs)},"Matrix, Array":function(fs,hs){return this(fs,is(hs))},"SparseMatrix, any":function(fs,hs){return us(fs,hs,ds,!1)},"DenseMatrix, any":function(fs,hs){return ps(fs,hs,ds,!1)},"any, SparseMatrix":function(fs,hs){return us(hs,fs,ds,!0)},"any, DenseMatrix":function(fs,hs){return ps(hs,fs,ds,!0)},"Array, any":function(fs,hs){return ps(is(fs),hs,ds,!1).valueOf()},"any, Array":function(fs,hs){return ps(is(hs),fs,ds,!0).valueOf()}});function ds(fs,hs){return!ns(fs,hs)}});factory(name$2k,["typed","equalScalar"],ss=>{var{typed:ts,equalScalar:rs}=ss;return ts(name$2k,{"any, any":function(ns,is){return ns===null?is!==null:is===null?ns!==null:ns===void 0?is!==void 0:is===void 0?ns!==void 0:!rs(ns,is)}})});var name$2j="partitionSelect",dependencies$2j=["typed","isNumeric","isNaN","compare"],createPartitionSelect=factory(name$2j,dependencies$2j,ss=>{var{typed:ts,isNumeric:rs,isNaN:ns,compare:is}=ss,as=is,os=(cs,ps)=>-is(cs,ps);return ts(name$2j,{"Array | Matrix, number":function(cs,ps){return ls(cs,ps,as)},"Array | Matrix, number, string":function(cs,ps,ds){if(ds==="asc")return ls(cs,ps,as);if(ds==="desc")return ls(cs,ps,os);throw new Error('Compare string must be "asc" or "desc"')},"Array | Matrix, number, function":ls});function ls(cs,ps,ds){if(!isInteger$1(ps)||ps<0)throw new Error("k must be a non-negative integer");if(isMatrix(cs)){if(cs.size().length>1)throw new Error("Only one dimensional matrices supported");return us(cs.valueOf(),ps,ds)}if(Array.isArray(cs))return us(cs,ps,ds)}function us(cs,ps,ds){if(ps>=cs.length)throw new Error("k out of bounds");for(var fs=0;fs<cs.length;fs++)if(rs(cs[fs])&&ns(cs[fs]))return cs[fs];for(var hs=0,ys=cs.length-1;hs<ys;){for(var gs=hs,bs=ys,vs=cs[Math.floor(Math.random()*(ys-hs+1))+hs];gs<bs;)if(ds(cs[gs],vs)>=0){var Ns=cs[bs];cs[bs]=cs[gs],cs[gs]=Ns,--bs}else++gs;ds(cs[gs],vs)>0&&--gs,ps<=gs?ys=gs:hs=gs+1}return cs[ps]}}),name$2i="sort",dependencies$2i=["typed","matrix","compare","compareNatural"],createSort=factory(name$2i,dependencies$2i,ss=>{var{typed:ts,matrix:rs,compare:ns,compareNatural:is}=ss,as=ns,os=(ps,ds)=>-ns(ps,ds);return ts(name$2i,{Array:function(ps){return us(ps),ps.sort(as)},Matrix:function(ps){return cs(ps),rs(ps.toArray().sort(as),ps.storage())},"Array, function":function(ps,ds){return us(ps),ps.sort(ds)},"Matrix, function":function(ps,ds){return cs(ps),rs(ps.toArray().sort(ds),ps.storage())},"Array, string":function(ps,ds){return us(ps),ps.sort(ls(ds))},"Matrix, string":function(ps,ds){return cs(ps),rs(ps.toArray().sort(ls(ds)),ps.storage())}});function ls(ps){if(ps==="asc")return as;if(ps==="desc")return os;if(ps==="natural")return is;throw new Error('String "asc", "desc", or "natural" expected')}function us(ps){if(arraySize(ps).length!==1)throw new Error("One dimensional array expected")}function cs(ps){if(ps.size().length!==1)throw new Error("One dimensional matrix expected")}}),name$2h="max",dependencies$2h=["typed","config","numeric","larger"],createMax=factory(name$2h,dependencies$2h,ss=>{var{typed:ts,config:rs,numeric:ns,larger:is}=ss;return ts(name$2h,{"Array | Matrix":os,"Array | Matrix, number | BigNumber":function(ls,us){return reduce$2(ls,us.valueOf(),as)},"...":function(ls){if(containsCollections(ls))throw new TypeError("Scalar values expected in function max");return os(ls)}});function as(ls,us){try{return is(ls,us)?ls:us}catch(cs){throw improveErrorMessage(cs,"max",us)}}function os(ls){var us;if(deepForEach(ls,function(cs){try{isNaN(cs)&&typeof cs=="number"?us=NaN:(us===void 0||is(cs,us))&&(us=cs)}catch(ps){throw improveErrorMessage(ps,"max",cs)}}),us===void 0)throw new Error("Cannot calculate max of an empty array");return typeof us=="string"&&(us=ns(us,rs.number)),us}}),name$2g="min",dependencies$2g=["typed","config","numeric","smaller"],createMin=factory(name$2g,dependencies$2g,ss=>{var{typed:ts,config:rs,numeric:ns,smaller:is}=ss;return ts(name$2g,{"Array | Matrix":os,"Array | Matrix, number | BigNumber":function(ls,us){return reduce$2(ls,us.valueOf(),as)},"...":function(ls){if(containsCollections(ls))throw new TypeError("Scalar values expected in function min");return os(ls)}});function as(ls,us){try{return is(ls,us)?ls:us}catch(cs){throw improveErrorMessage(cs,"min",us)}}function os(ls){var us;if(deepForEach(ls,function(cs){try{isNaN(cs)&&typeof cs=="number"?us=NaN:(us===void 0||is(cs,us))&&(us=cs)}catch(ps){throw improveErrorMessage(ps,"min",cs)}}),us===void 0)throw new Error("Cannot calculate min of an empty array");return typeof us=="string"&&(us=ns(us,rs.number)),us}}),name$2f="ImmutableDenseMatrix",dependencies$2f=["smaller","DenseMatrix"],createImmutableDenseMatrixClass=factory(name$2f,dependencies$2f,ss=>{var{smaller:ts,DenseMatrix:rs}=ss;function ns(is,as){if(!(this instanceof ns))throw new SyntaxError("Constructor must be called with the new operator");if(as&&!isString$1$1(as))throw new Error("Invalid datatype: "+as);if(isMatrix(is)||isArray$1$1(is)){var os=new rs(is,as);this._data=os._data,this._size=os._size,this._datatype=os._datatype,this._min=null,this._max=null}else if(is&&isArray$1$1(is.data)&&isArray$1$1(is.size))this._data=is.data,this._size=is.size,this._datatype=is.datatype,this._min=is.min!==void 0?is.min:null,this._max=is.max!==void 0?is.max:null;else{if(is)throw new TypeError("Unsupported type of data ("+typeOf$1(is)+")");this._data=[],this._size=[0],this._datatype=as,this._min=null,this._max=null}}return ns.prototype=new rs,ns.prototype.type="ImmutableDenseMatrix",ns.prototype.isImmutableDenseMatrix=!0,ns.prototype.subset=function(is){switch(arguments.length){case 1:var as=rs.prototype.subset.call(this,is);return isMatrix(as)?new ns({data:as._data,size:as._size,datatype:as._datatype}):as;case 2:case 3:throw new Error("Cannot invoke set subset on an Immutable Matrix instance");default:throw new SyntaxError("Wrong number of arguments")}},ns.prototype.set=function(){throw new Error("Cannot invoke set on an Immutable Matrix instance")},ns.prototype.resize=function(){throw new Error("Cannot invoke resize on an Immutable Matrix instance")},ns.prototype.reshape=function(){throw new Error("Cannot invoke reshape on an Immutable Matrix instance")},ns.prototype.clone=function(){return new ns({data:clone$3(this._data),size:clone$3(this._size),datatype:this._datatype})},ns.prototype.toJSON=function(){return{mathjs:"ImmutableDenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},ns.fromJSON=function(is){return new ns(is)},ns.prototype.swapRows=function(){throw new Error("Cannot invoke swapRows on an Immutable Matrix instance")},ns.prototype.min=function(){if(this._min===null){var is=null;this.forEach(function(as){(is===null||ts(as,is))&&(is=as)}),this._min=is!==null?is:void 0}return this._min},ns.prototype.max=function(){if(this._max===null){var is=null;this.forEach(function(as){(is===null||ts(is,as))&&(is=as)}),this._max=is!==null?is:void 0}return this._max},ns},{isClass:!0}),name$2e="Index",dependencies$2e=["ImmutableDenseMatrix"],createIndexClass=factory(name$2e,dependencies$2e,ss=>{var{ImmutableDenseMatrix:ts}=ss;function rs(is){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");this._dimensions=[],this._isScalar=!0;for(var as=0,os=arguments.length;as<os;as++){var ls=arguments[as];if(isRange(ls))this._dimensions.push(ls),this._isScalar=!1;else if(Array.isArray(ls)||isMatrix(ls)){var us=ns(ls.valueOf());this._dimensions.push(us);var cs=us.size();cs.length===1&&cs[0]===1||(this._isScalar=!1)}else if(typeof ls=="number")this._dimensions.push(ns([ls]));else{if(typeof ls!="string")throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");this._dimensions.push(ls)}}}function ns(is){for(var as=0,os=is.length;as<os;as++)if(typeof is[as]!="number"||!isInteger$1(is[as]))throw new TypeError("Index parameters must be positive integer numbers");return new ts(is)}return rs.prototype.type="Index",rs.prototype.isIndex=!0,rs.prototype.clone=function(){var is=new rs;return is._dimensions=clone$3(this._dimensions),is._isScalar=this._isScalar,is},rs.create=function(is){var as=new rs;return rs.apply(as,is),as},rs.prototype.size=function(){for(var is=[],as=0,os=this._dimensions.length;as<os;as++){var ls=this._dimensions[as];is[as]=typeof ls=="string"?1:ls.size()[0]}return is},rs.prototype.max=function(){for(var is=[],as=0,os=this._dimensions.length;as<os;as++){var ls=this._dimensions[as];is[as]=typeof ls=="string"?ls:ls.max()}return is},rs.prototype.min=function(){for(var is=[],as=0,os=this._dimensions.length;as<os;as++){var ls=this._dimensions[as];is[as]=typeof ls=="string"?ls:ls.min()}return is},rs.prototype.forEach=function(is){for(var as=0,os=this._dimensions.length;as<os;as++)is(this._dimensions[as],as,this)},rs.prototype.dimension=function(is){return this._dimensions[is]||null},rs.prototype.isObjectProperty=function(){return this._dimensions.length===1&&typeof this._dimensions[0]=="string"},rs.prototype.getObjectProperty=function(){return this.isObjectProperty()?this._dimensions[0]:null},rs.prototype.isScalar=function(){return this._isScalar},rs.prototype.toArray=function(){for(var is=[],as=0,os=this._dimensions.length;as<os;as++){var ls=this._dimensions[as];is.push(typeof ls=="string"?ls:ls.toArray())}return is},rs.prototype.valueOf=rs.prototype.toArray,rs.prototype.toString=function(){for(var is=[],as=0,os=this._dimensions.length;as<os;as++){var ls=this._dimensions[as];typeof ls=="string"?is.push(JSON.stringify(ls)):is.push(ls.toString())}return"["+is.join(", ")+"]"},rs.prototype.toJSON=function(){return{mathjs:"Index",dimensions:this._dimensions}},rs.fromJSON=function(is){return rs.create(is.dimensions)},rs},{isClass:!0}),name$2d="FibonacciHeap",dependencies$2d=["smaller","larger"],createFibonacciHeapClass=factory(name$2d,dependencies$2d,ss=>{var{smaller:ts,larger:rs}=ss,ns=1/Math.log((1+Math.sqrt(5))/2);function is(){if(!(this instanceof is))throw new SyntaxError("Constructor must be called with the new operator");this._minimum=null,this._size=0}function as(us,cs,ps){cs.left.right=cs.right,cs.right.left=cs.left,ps.degree--,ps.child===cs&&(ps.child=cs.right),ps.degree===0&&(ps.child=null),cs.left=us,cs.right=us.right,us.right=cs,cs.right.left=cs,cs.parent=null,cs.mark=!1}function os(us,cs){var ps=cs.parent;ps&&(cs.mark?(as(us,cs,ps),os(ps)):cs.mark=!0)}is.prototype.type="FibonacciHeap",is.prototype.isFibonacciHeap=!0,is.prototype.insert=function(us,cs){var ps={key:us,value:cs,degree:0};if(this._minimum){var ds=this._minimum;ps.left=ds,ps.right=ds.right,ds.right=ps,ps.right.left=ps,ts(us,ds.key)&&(this._minimum=ps)}else ps.left=ps,ps.right=ps,this._minimum=ps;return this._size++,ps},is.prototype.size=function(){return this._size},is.prototype.clear=function(){this._minimum=null,this._size=0},is.prototype.isEmpty=function(){return this._size===0},is.prototype.extractMinimum=function(){var us=this._minimum;if(us===null)return us;for(var cs=this._minimum,ps=us.degree,ds=us.child;ps>0;){var fs=ds.right;ds.left.right=ds.right,ds.right.left=ds.left,ds.left=cs,ds.right=cs.right,cs.right=ds,ds.right.left=ds,ds.parent=null,ds=fs,ps--}return us.left.right=us.right,us.right.left=us.left,cs=us===us.right?null:function(hs,ys){var gs,bs=Math.floor(Math.log(ys)*ns)+1,vs=new Array(bs),Ns=0,Ts=hs;if(Ts)for(Ns++,Ts=Ts.right;Ts!==hs;)Ns++,Ts=Ts.right;for(;Ns>0;){for(var Cs=Ts.degree,xs=Ts.right;gs=vs[Cs];){if(rs(Ts.key,gs.key)){var As=gs;gs=Ts,Ts=As}ls(gs,Ts),vs[Cs]=null,Cs++}vs[Cs]=Ts,Ts=xs,Ns--}hs=null;for(var ws=0;ws<bs;ws++)(gs=vs[ws])&&(hs?(gs.left.right=gs.right,gs.right.left=gs.left,gs.left=hs,gs.right=hs.right,hs.right=gs,gs.right.left=gs,ts(gs.key,hs.key)&&(hs=gs)):hs=gs);return hs}(cs=us.right,this._size),this._size--,this._minimum=cs,us},is.prototype.remove=function(us){this._minimum=function(cs,ps,ds){ps.key=ds;var fs=ps.parent;return fs&&ts(ps.key,fs.key)&&(as(cs,ps,fs),os(cs,fs)),ts(ps.key,cs.key)&&(cs=ps),cs}(this._minimum,us,-1),this.extractMinimum()};var ls=function(us,cs){us.left.right=us.right,us.right.left=us.left,us.parent=cs,cs.child?(us.left=cs.child,us.right=cs.child.right,cs.child.right=us,us.right.left=us):(cs.child=us,us.right=us,us.left=us),cs.degree++,us.mark=!1};return is},{isClass:!0}),name$2c="Spa",dependencies$2c=["addScalar","equalScalar","FibonacciHeap"],createSpaClass=factory(name$2c,dependencies$2c,ss=>{var{addScalar:ts,equalScalar:rs,FibonacciHeap:ns}=ss;function is(){if(!(this instanceof is))throw new SyntaxError("Constructor must be called with the new operator");this._values=[],this._heap=new ns}return is.prototype.type="Spa",is.prototype.isSpa=!0,is.prototype.set=function(as,os){if(this._values[as])this._values[as].value=os;else{var ls=this._heap.insert(as,os);this._values[as]=ls}},is.prototype.get=function(as){var os=this._values[as];return os?os.value:0},is.prototype.accumulate=function(as,os){var ls=this._values[as];ls?ls.value=ts(ls.value,os):(ls=this._heap.insert(as,os),this._values[as]=ls)},is.prototype.forEach=function(as,os,ls){var us=this._heap,cs=this._values,ps=[],ds=us.extractMinimum();for(ds&&ps.push(ds);ds&&ds.key<=os;)ds.key>=as&&(rs(ds.value,0)||ls(ds.key,ds.value,this)),(ds=us.extractMinimum())&&ps.push(ds);for(var fs=0;fs<ps.length;fs++){var hs=ps[fs];cs[(ds=us.insert(hs.key,hs.value)).key]=ds}},is.prototype.swap=function(as,os){var ls=this._values[as],us=this._values[os];if(!ls&&us)ls=this._heap.insert(as,us.value),this._heap.remove(us),this._values[as]=ls,this._values[os]=void 0;else if(ls&&!us)us=this._heap.insert(os,ls.value),this._heap.remove(ls),this._values[os]=us,this._values[as]=void 0;else if(ls&&us){var cs=ls.value;ls.value=us.value,us.value=cs}},is},{isClass:!0});function _typeof(ss){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ts){return typeof ts}:function(ts){return ts&&typeof Symbol=="function"&&ts.constructor===Symbol&&ts!==Symbol.prototype?"symbol":typeof ts},_typeof(ss)}function _toPrimitive(ss,ts){if(_typeof(ss)!=="object"||ss===null)return ss;var rs=ss[Symbol.toPrimitive];if(rs!==void 0){var ns=rs.call(ss,ts||"default");if(_typeof(ns)!=="object")return ns;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ts==="string"?String:Number)(ss)}function _toPropertyKey(ss){var ts=_toPrimitive(ss,"string");return _typeof(ts)==="symbol"?ts:String(ts)}function _defineProperty(ss,ts,rs){return(ts=_toPropertyKey(ts))in ss?Object.defineProperty(ss,ts,{value:rs,enumerable:!0,configurable:!0,writable:!0}):ss[ts]=rs,ss}var createBigNumberE=memoize$1(function(ss){return new ss(1).exp()},{hasher}),createBigNumberPhi=memoize$1(function(ss){return new ss(1).plus(new ss(5).sqrt()).div(2)},{hasher}),createBigNumberPi=memoize$1(function(ss){return ss.acos(-1)},{hasher}),createBigNumberTau=memoize$1(function(ss){return createBigNumberPi(ss).times(2)},{hasher});function hasher(ss){return ss[0].precision}function ownKeys$1(ss,ts){var rs=Object.keys(ss);if(Object.getOwnPropertySymbols){var ns=Object.getOwnPropertySymbols(ss);ts&&(ns=ns.filter(function(is){return Object.getOwnPropertyDescriptor(ss,is).enumerable})),rs.push.apply(rs,ns)}return rs}function _objectSpread$1(ss){for(var ts=1;ts<arguments.length;ts++){var rs=arguments[ts]!=null?arguments[ts]:{};ts%2?ownKeys$1(Object(rs),!0).forEach(function(ns){_defineProperty(ss,ns,rs[ns])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ss,Object.getOwnPropertyDescriptors(rs)):ownKeys$1(Object(rs)).forEach(function(ns){Object.defineProperty(ss,ns,Object.getOwnPropertyDescriptor(rs,ns))})}return ss}var name$2b="Unit",dependencies$2b=["?on","config","addScalar","subtract","multiplyScalar","divideScalar","pow","abs","fix","round","equal","isNumeric","format","number","Complex","BigNumber","Fraction"],createUnitClass=factory(name$2b,dependencies$2b,ss=>{var ts,rs,ns,{on:is,config:as,addScalar:os,subtract:ls,multiplyScalar:us,divideScalar:cs,pow:ps,abs:ds,fix:fs,round:hs,equal:ys,isNumeric:gs,format:bs,number:vs,Complex:Ns,BigNumber:Ts,Fraction:Cs}=ss,xs=vs;function As(js,Ls){if(!(this instanceof As))throw new Error("Constructor must be called with the new operator");if(js!=null&&!gs(js)&&!isComplex(js))throw new TypeError("First parameter in Unit constructor must be number, BigNumber, Fraction, Complex, or undefined");if(Ls!==void 0&&(typeof Ls!="string"||Ls===""))throw new TypeError("Second parameter in Unit constructor must be a string");if(Ls!==void 0){var Ws=As.parse(Ls);this.units=Ws.units,this.dimensions=Ws.dimensions}else{this.units=[{unit:Us,prefix:Rs.NONE,power:0}],this.dimensions=[];for(var Zs=0;Zs<ks.length;Zs++)this.dimensions[Zs]=0}this.value=js!=null?this._normalize(js):null,this.fixPrefix=!1,this.skipAutomaticSimplification=!0}function ws(){for(;ns===" "||ns==="	";)Ss()}function Es(js){return js>="0"&&js<="9"}function Ss(){rs++,ns=ts.charAt(rs)}function Ds(js){rs=js,ns=ts.charAt(rs)}function Vs(){var js="",Ls=rs;if(ns==="+"?Ss():ns==="-"&&(js+=ns,Ss()),!function(tl){return tl>="0"&&tl<="9"||tl==="."}(ns))return Ds(Ls),null;if(ns==="."){if(js+=ns,Ss(),!Es(ns))return Ds(Ls),null}else{for(;Es(ns);)js+=ns,Ss();ns==="."&&(js+=ns,Ss())}for(;Es(ns);)js+=ns,Ss();if(ns==="E"||ns==="e"){var Ws="",Zs=rs;if(Ws+=ns,Ss(),ns!=="+"&&ns!=="-"||(Ws+=ns,Ss()),!Es(ns))return Ds(Zs),js;for(js+=Ws;Es(ns);)js+=ns,Ss()}return js}function Is(){for(var js="";Es(ns)||As.isValidAlpha(ns);)js+=ns,Ss();var Ls=js.charAt(0);return As.isValidAlpha(Ls)?js:null}function Os(js){return ns===js?(Ss(),js):null}As.prototype.type="Unit",As.prototype.isUnit=!0,As.parse=function(js,Ls){if(Ls=Ls||{},rs=-1,ns="",typeof(ts=js)!="string")throw new TypeError("Invalid argument in Unit.parse, string expected");var Ws=new As;Ws.units=[];var Zs=1,tl=!1;Ss(),ws();var rl=Vs(),qs=null;if(rl){if(as.number==="BigNumber")qs=new Ts(rl);else if(as.number==="Fraction")try{qs=new Cs(rl)}catch{qs=parseFloat(rl)}else qs=parseFloat(rl);ws(),Os("*")?(Zs=1,tl=!0):Os("/")&&(Zs=-1,tl=!0)}for(var Gs=[],Xs=1;;){for(ws();ns==="(";)Gs.push(Zs),Xs*=Zs,Zs=1,Ss(),ws();var Ks=void 0;if(!ns)break;var ol=ns;if((Ks=Is())===null)throw new SyntaxError('Unexpected "'+ol+'" in "'+ts+'" at index '+rs.toString());var Fs=Ps(Ks);if(Fs===null)throw new SyntaxError('Unit "'+Ks+'" not found.');var Qs=Zs*Xs;if(ws(),Os("^")){ws();var Js=Vs();if(Js===null)throw new SyntaxError('In "'+js+'", "^" must be followed by a floating-point number');Qs*=Js}Ws.units.push({unit:Fs.unit,prefix:Fs.prefix,power:Qs});for(var ul=0;ul<ks.length;ul++)Ws.dimensions[ul]+=(Fs.unit.dimensions[ul]||0)*Qs;for(ws();ns===")";){if(Gs.length===0)throw new SyntaxError('Unmatched ")" in "'+ts+'" at index '+rs.toString());Xs/=Gs.pop(),Ss(),ws()}if(tl=!1,Os("*")?(Zs=1,tl=!0):Os("/")?(Zs=-1,tl=!0):Zs=1,Fs.unit.base){var pl=Fs.unit.base.key;Ys.auto[pl]={unit:Fs.unit,prefix:Fs.prefix}}}if(ws(),ns)throw new SyntaxError('Could not parse: "'+js+'"');if(tl)throw new SyntaxError('Trailing characters: "'+js+'"');if(Gs.length!==0)throw new SyntaxError('Unmatched "(" in "'+ts+'"');if(Ws.units.length===0&&!Ls.allowNoUnits)throw new SyntaxError('"'+js+'" contains no units');return Ws.value=qs!==void 0?Ws._normalize(qs):null,Ws},As.prototype.clone=function(){var js=new As;js.fixPrefix=this.fixPrefix,js.skipAutomaticSimplification=this.skipAutomaticSimplification,js.value=clone$3(this.value),js.dimensions=this.dimensions.slice(0),js.units=[];for(var Ls=0;Ls<this.units.length;Ls++)for(var Ws in js.units[Ls]={},this.units[Ls])hasOwnProperty$2(this.units[Ls],Ws)&&(js.units[Ls][Ws]=this.units[Ls][Ws]);return js},As.prototype._isDerived=function(){return this.units.length!==0&&(this.units.length>1||Math.abs(this.units[0].power-1)>1e-15)},As.prototype._normalize=function(js){if(js==null||this.units.length===0)return js;for(var Ls=js,Ws=As._getNumberConverter(typeOf$1(js)),Zs=0;Zs<this.units.length;Zs++){var tl=Ws(this.units[Zs].unit.value),rl=Ws(this.units[Zs].prefix.value),qs=Ws(this.units[Zs].power);Ls=us(Ls,ps(us(tl,rl),qs))}return Ls},As.prototype._denormalize=function(js,Ls){if(js==null||this.units.length===0)return js;for(var Ws=js,Zs=As._getNumberConverter(typeOf$1(js)),tl=0;tl<this.units.length;tl++){var rl=Zs(this.units[tl].unit.value),qs=Zs(this.units[tl].prefix.value),Gs=Zs(this.units[tl].power);Ws=cs(Ws,ps(us(rl,qs),Gs))}return Ws};var Ps=memoize$1(js=>{if(hasOwnProperty$2(zs,js)){var Ls=zs[js];return{unit:Ls,prefix:Ls.prefixes[""]}}for(var Ws in zs)if(hasOwnProperty$2(zs,Ws)&&endsWith$1(js,Ws)){var Zs=zs[Ws],tl=js.length-Ws.length,rl=js.substring(0,tl),qs=hasOwnProperty$2(Zs.prefixes,rl)?Zs.prefixes[rl]:void 0;if(qs!==void 0)return{unit:Zs,prefix:qs}}return null},{hasher:js=>js[0],limit:100});function $s(js){return js.equalBase(_s.NONE)&&js.value!==null&&!as.predictable?js.value:js}As.isValuelessUnit=function(js){return Ps(js)!==null},As.prototype.hasBase=function(js){if(typeof js=="string"&&(js=_s[js]),!js)return!1;for(var Ls=0;Ls<ks.length;Ls++)if(Math.abs((this.dimensions[Ls]||0)-(js.dimensions[Ls]||0))>1e-12)return!1;return!0},As.prototype.equalBase=function(js){for(var Ls=0;Ls<ks.length;Ls++)if(Math.abs((this.dimensions[Ls]||0)-(js.dimensions[Ls]||0))>1e-12)return!1;return!0},As.prototype.equals=function(js){return this.equalBase(js)&&ys(this.value,js.value)},As.prototype.multiply=function(js){for(var Ls=this.clone(),Ws=0;Ws<ks.length;Ws++)Ls.dimensions[Ws]=(this.dimensions[Ws]||0)+(js.dimensions[Ws]||0);for(var Zs=0;Zs<js.units.length;Zs++){var tl=_objectSpread$1({},js.units[Zs]);Ls.units.push(tl)}if(this.value!==null||js.value!==null){var rl=this.value===null?this._normalize(1):this.value,qs=js.value===null?js._normalize(1):js.value;Ls.value=us(rl,qs)}else Ls.value=null;return Ls.skipAutomaticSimplification=!1,$s(Ls)},As.prototype.divide=function(js){for(var Ls=this.clone(),Ws=0;Ws<ks.length;Ws++)Ls.dimensions[Ws]=(this.dimensions[Ws]||0)-(js.dimensions[Ws]||0);for(var Zs=0;Zs<js.units.length;Zs++){var tl=_objectSpread$1(_objectSpread$1({},js.units[Zs]),{},{power:-js.units[Zs].power});Ls.units.push(tl)}if(this.value!==null||js.value!==null){var rl=this.value===null?this._normalize(1):this.value,qs=js.value===null?js._normalize(1):js.value;Ls.value=cs(rl,qs)}else Ls.value=null;return Ls.skipAutomaticSimplification=!1,$s(Ls)},As.prototype.pow=function(js){for(var Ls=this.clone(),Ws=0;Ws<ks.length;Ws++)Ls.dimensions[Ws]=(this.dimensions[Ws]||0)*js;for(var Zs=0;Zs<Ls.units.length;Zs++)Ls.units[Zs].power*=js;return Ls.value!==null?Ls.value=ps(Ls.value,js):Ls.value=null,Ls.skipAutomaticSimplification=!1,$s(Ls)},As.prototype.abs=function(){var js=this.clone();if(js.value!==null)if(js._isDerived()||js.units[0].unit.offset===0)js.value=ds(js.value);else{var Ls=As._getNumberConverter(typeOf$1(js.value)),Ws=Ls(js.units[0].unit.value),Zs=Ls(js.units[0].unit.offset),tl=us(Ws,Zs);js.value=ls(ds(os(js.value,tl)),tl)}for(var rl in js.units)js.units[rl].unit.name!=="VA"&&js.units[rl].unit.name!=="VAR"||(js.units[rl].unit=zs.W);return js},As.prototype.to=function(js){var Ls,Ws=this.value===null?this._normalize(1):this.value;if(typeof js=="string")Ls=As.parse(js);else{if(!isUnit(js))throw new Error("String or Unit expected as parameter");Ls=js.clone()}if(!this.equalBase(Ls))throw new Error("Units do not match ('".concat(Ls.toString(),"' != '").concat(this.toString(),"')"));if(Ls.value!==null)throw new Error("Cannot convert to a unit with a value");if(this.value===null||this._isDerived()||this.units[0].unit.offset===Ls.units[0].unit.offset)Ls.value=clone$3(Ws);else{var Zs=As._getNumberConverter(typeOf$1(Ws)),tl=Zs(this.units[0].unit.value),rl=Zs(this.units[0].unit.offset),qs=us(tl,rl),Gs=Zs(Ls.units[0].unit.value),Xs=Zs(Ls.units[0].unit.offset),Ks=us(Gs,Xs);Ls.value=ls(os(Ws,qs),Ks)}return Ls.fixPrefix=!0,Ls.skipAutomaticSimplification=!0,Ls},As.prototype.toNumber=function(js){return xs(this.toNumeric(js))},As.prototype.toNumeric=function(js){var Ls;return(Ls=js?this.to(js):this.clone())._isDerived()||Ls.units.length===0?Ls._denormalize(Ls.value):Ls._denormalize(Ls.value,Ls.units[0].prefix.value)},As.prototype.toString=function(){return this.format()},As.prototype.toJSON=function(){return{mathjs:"Unit",value:this._denormalize(this.value),unit:this.formatUnits(),fixPrefix:this.fixPrefix}},As.fromJSON=function(js){var Ls=new As(js.value,js.unit);return Ls.fixPrefix=js.fixPrefix||!1,Ls},As.prototype.valueOf=As.prototype.toString,As.prototype.simplify=function(){var js,Ls,Ws=this.clone(),Zs=[];for(var tl in il)if(hasOwnProperty$2(il,tl)&&Ws.hasBase(_s[tl])){js=tl;break}if(js==="NONE")Ws.units=[];else if(js&&hasOwnProperty$2(il,js)&&(Ls=il[js]),Ls)Ws.units=[{unit:Ls.unit,prefix:Ls.prefix,power:1}];else{for(var rl=!1,qs=0;qs<ks.length;qs++){var Gs=ks[qs];Math.abs(Ws.dimensions[qs]||0)>1e-12&&(hasOwnProperty$2(il,Gs)?Zs.push({unit:il[Gs].unit,prefix:il[Gs].prefix,power:Ws.dimensions[qs]||0}):rl=!0)}Zs.length<Ws.units.length&&!rl&&(Ws.units=Zs)}return Ws},As.prototype.toSI=function(){for(var js=this.clone(),Ls=[],Ws=0;Ws<ks.length;Ws++){var Zs=ks[Ws];if(Math.abs(js.dimensions[Ws]||0)>1e-12){if(!hasOwnProperty$2(Ys.si,Zs))throw new Error("Cannot express custom unit "+Zs+" in SI units");Ls.push({unit:Ys.si[Zs].unit,prefix:Ys.si[Zs].prefix,power:js.dimensions[Ws]||0})}}return js.units=Ls,js.fixPrefix=!0,js.skipAutomaticSimplification=!0,js},As.prototype.formatUnits=function(){for(var js="",Ls="",Ws=0,Zs=0,tl=0;tl<this.units.length;tl++)this.units[tl].power>0?(Ws++,js+=" "+this.units[tl].prefix.name+this.units[tl].unit.name,Math.abs(this.units[tl].power-1)>1e-15&&(js+="^"+this.units[tl].power)):this.units[tl].power<0&&Zs++;if(Zs>0)for(var rl=0;rl<this.units.length;rl++)this.units[rl].power<0&&(Ws>0?(Ls+=" "+this.units[rl].prefix.name+this.units[rl].unit.name,Math.abs(this.units[rl].power+1)>1e-15&&(Ls+="^"+-this.units[rl].power)):(Ls+=" "+this.units[rl].prefix.name+this.units[rl].unit.name,Ls+="^"+this.units[rl].power));js=js.substr(1),Ls=Ls.substr(1),Ws>1&&Zs>0&&(js="("+js+")"),Zs>1&&Ws>0&&(Ls="("+Ls+")");var qs=js;return Ws>0&&Zs>0&&(qs+=" / "),qs+=Ls},As.prototype.format=function(js){var Ls=this.skipAutomaticSimplification||this.value===null?this.clone():this.simplify(),Ws=!1;for(var Zs in Ls.value!==void 0&&Ls.value!==null&&isComplex(Ls.value)&&(Ws=Math.abs(Ls.value.re)<1e-14),Ls.units)hasOwnProperty$2(Ls.units,Zs)&&Ls.units[Zs].unit&&(Ls.units[Zs].unit.name==="VA"&&Ws?Ls.units[Zs].unit=zs.VAR:Ls.units[Zs].unit.name!=="VAR"||Ws||(Ls.units[Zs].unit=zs.VA));Ls.units.length!==1||Ls.fixPrefix||Math.abs(Ls.units[0].power-Math.round(Ls.units[0].power))<1e-14&&(Ls.units[0].prefix=Ls._bestPrefix());var tl=Ls._denormalize(Ls.value),rl=Ls.value!==null?bs(tl,js||{}):"",qs=Ls.formatUnits();return Ls.value&&isComplex(Ls.value)&&(rl="("+rl+")"),qs.length>0&&rl.length>0&&(rl+=" "),rl+=qs},As.prototype._bestPrefix=function(){if(this.units.length!==1)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");if(Math.abs(this.units[0].power-Math.round(this.units[0].power))>=1e-14)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");var js=this.value!==null?ds(this.value):0,Ls=ds(this.units[0].unit.value),Ws=this.units[0].prefix;if(js===0)return Ws;var Zs=this.units[0].power,tl=Math.log(js/Math.pow(Ws.value*Ls,Zs))/Math.LN10-1.2;if(tl>-2.200001&&tl<1.800001)return Ws;tl=Math.abs(tl);var rl=this.units[0].unit.prefixes;for(var qs in rl)if(hasOwnProperty$2(rl,qs)){var Gs=rl[qs];if(Gs.scientific){var Xs=Math.abs(Math.log(js/Math.pow(Gs.value*Ls,Zs))/Math.LN10-1.2);(Xs<tl||Xs===tl&&Gs.name.length<Ws.name.length)&&(Ws=Gs,tl=Xs)}}return Ws},As.prototype.splitUnit=function(js){for(var Ls=this.clone(),Ws=[],Zs=0;Zs<js.length&&(Ls=Ls.to(js[Zs]),Zs!==js.length-1);Zs++){var tl=Ls.toNumeric(),rl=hs(tl),qs=new As(ys(rl,tl)?rl:fs(Ls.toNumeric()),js[Zs].toString());Ws.push(qs),Ls=ls(Ls,qs)}for(var Gs=0,Xs=0;Xs<Ws.length;Xs++)Gs=os(Gs,Ws[Xs].value);return ys(Gs,this.value)&&(Ls.value=0),Ws.push(Ls),Ws};var Rs={NONE:{"":{name:"",value:1,scientific:!0}},SHORT:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:10,scientific:!1},h:{name:"h",value:100,scientific:!1},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},d:{name:"d",value:.1,scientific:!1},c:{name:"c",value:.01,scientific:!1},m:{name:"m",value:.001,scientific:!0},u:{name:"u",value:1e-6,scientific:!0},n:{name:"n",value:1e-9,scientific:!0},p:{name:"p",value:1e-12,scientific:!0},f:{name:"f",value:1e-15,scientific:!0},a:{name:"a",value:1e-18,scientific:!0},z:{name:"z",value:1e-21,scientific:!0},y:{name:"y",value:1e-24,scientific:!0}},LONG:{"":{name:"",value:1,scientific:!0},deca:{name:"deca",value:10,scientific:!1},hecto:{name:"hecto",value:100,scientific:!1},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},deci:{name:"deci",value:.1,scientific:!1},centi:{name:"centi",value:.01,scientific:!1},milli:{name:"milli",value:.001,scientific:!0},micro:{name:"micro",value:1e-6,scientific:!0},nano:{name:"nano",value:1e-9,scientific:!0},pico:{name:"pico",value:1e-12,scientific:!0},femto:{name:"femto",value:1e-15,scientific:!0},atto:{name:"atto",value:1e-18,scientific:!0},zepto:{name:"zepto",value:1e-21,scientific:!0},yocto:{name:"yocto",value:1e-24,scientific:!0}},SQUARED:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:100,scientific:!1},h:{name:"h",value:1e4,scientific:!1},k:{name:"k",value:1e6,scientific:!0},M:{name:"M",value:1e12,scientific:!0},G:{name:"G",value:1e18,scientific:!0},T:{name:"T",value:1e24,scientific:!0},P:{name:"P",value:1e30,scientific:!0},E:{name:"E",value:1e36,scientific:!0},Z:{name:"Z",value:1e42,scientific:!0},Y:{name:"Y",value:1e48,scientific:!0},d:{name:"d",value:.01,scientific:!1},c:{name:"c",value:1e-4,scientific:!1},m:{name:"m",value:1e-6,scientific:!0},u:{name:"u",value:1e-12,scientific:!0},n:{name:"n",value:1e-18,scientific:!0},p:{name:"p",value:1e-24,scientific:!0},f:{name:"f",value:1e-30,scientific:!0},a:{name:"a",value:1e-36,scientific:!0},z:{name:"z",value:1e-42,scientific:!0},y:{name:"y",value:1e-48,scientific:!0}},CUBIC:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:1e3,scientific:!1},h:{name:"h",value:1e6,scientific:!1},k:{name:"k",value:1e9,scientific:!0},M:{name:"M",value:1e18,scientific:!0},G:{name:"G",value:1e27,scientific:!0},T:{name:"T",value:1e36,scientific:!0},P:{name:"P",value:1e45,scientific:!0},E:{name:"E",value:1e54,scientific:!0},Z:{name:"Z",value:1e63,scientific:!0},Y:{name:"Y",value:1e72,scientific:!0},d:{name:"d",value:.001,scientific:!1},c:{name:"c",value:1e-6,scientific:!1},m:{name:"m",value:1e-9,scientific:!0},u:{name:"u",value:1e-18,scientific:!0},n:{name:"n",value:1e-27,scientific:!0},p:{name:"p",value:1e-36,scientific:!0},f:{name:"f",value:1e-45,scientific:!0},a:{name:"a",value:1e-54,scientific:!0},z:{name:"z",value:1e-63,scientific:!0},y:{name:"y",value:1e-72,scientific:!0}},BINARY_SHORT_SI:{"":{name:"",value:1,scientific:!0},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0}},BINARY_SHORT_IEC:{"":{name:"",value:1,scientific:!0},Ki:{name:"Ki",value:1024,scientific:!0},Mi:{name:"Mi",value:Math.pow(1024,2),scientific:!0},Gi:{name:"Gi",value:Math.pow(1024,3),scientific:!0},Ti:{name:"Ti",value:Math.pow(1024,4),scientific:!0},Pi:{name:"Pi",value:Math.pow(1024,5),scientific:!0},Ei:{name:"Ei",value:Math.pow(1024,6),scientific:!0},Zi:{name:"Zi",value:Math.pow(1024,7),scientific:!0},Yi:{name:"Yi",value:Math.pow(1024,8),scientific:!0}},BINARY_LONG_SI:{"":{name:"",value:1,scientific:!0},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0}},BINARY_LONG_IEC:{"":{name:"",value:1,scientific:!0},kibi:{name:"kibi",value:1024,scientific:!0},mebi:{name:"mebi",value:Math.pow(1024,2),scientific:!0},gibi:{name:"gibi",value:Math.pow(1024,3),scientific:!0},tebi:{name:"tebi",value:Math.pow(1024,4),scientific:!0},pebi:{name:"pebi",value:Math.pow(1024,5),scientific:!0},exi:{name:"exi",value:Math.pow(1024,6),scientific:!0},zebi:{name:"zebi",value:Math.pow(1024,7),scientific:!0},yobi:{name:"yobi",value:Math.pow(1024,8),scientific:!0}},BTU:{"":{name:"",value:1,scientific:!0},MM:{name:"MM",value:1e6,scientific:!0}}};Rs.SHORTLONG=_extends$1({},Rs.SHORT,Rs.LONG),Rs.BINARY_SHORT=_extends$1({},Rs.BINARY_SHORT_SI,Rs.BINARY_SHORT_IEC),Rs.BINARY_LONG=_extends$1({},Rs.BINARY_LONG_SI,Rs.BINARY_LONG_IEC);var ks=["MASS","LENGTH","TIME","CURRENT","TEMPERATURE","LUMINOUS_INTENSITY","AMOUNT_OF_SUBSTANCE","ANGLE","BIT"],_s={NONE:{dimensions:[0,0,0,0,0,0,0,0,0]},MASS:{dimensions:[1,0,0,0,0,0,0,0,0]},LENGTH:{dimensions:[0,1,0,0,0,0,0,0,0]},TIME:{dimensions:[0,0,1,0,0,0,0,0,0]},CURRENT:{dimensions:[0,0,0,1,0,0,0,0,0]},TEMPERATURE:{dimensions:[0,0,0,0,1,0,0,0,0]},LUMINOUS_INTENSITY:{dimensions:[0,0,0,0,0,1,0,0,0]},AMOUNT_OF_SUBSTANCE:{dimensions:[0,0,0,0,0,0,1,0,0]},FORCE:{dimensions:[1,1,-2,0,0,0,0,0,0]},SURFACE:{dimensions:[0,2,0,0,0,0,0,0,0]},VOLUME:{dimensions:[0,3,0,0,0,0,0,0,0]},ENERGY:{dimensions:[1,2,-2,0,0,0,0,0,0]},POWER:{dimensions:[1,2,-3,0,0,0,0,0,0]},PRESSURE:{dimensions:[1,-1,-2,0,0,0,0,0,0]},ELECTRIC_CHARGE:{dimensions:[0,0,1,1,0,0,0,0,0]},ELECTRIC_CAPACITANCE:{dimensions:[-1,-2,4,2,0,0,0,0,0]},ELECTRIC_POTENTIAL:{dimensions:[1,2,-3,-1,0,0,0,0,0]},ELECTRIC_RESISTANCE:{dimensions:[1,2,-3,-2,0,0,0,0,0]},ELECTRIC_INDUCTANCE:{dimensions:[1,2,-2,-2,0,0,0,0,0]},ELECTRIC_CONDUCTANCE:{dimensions:[-1,-2,3,2,0,0,0,0,0]},MAGNETIC_FLUX:{dimensions:[1,2,-2,-1,0,0,0,0,0]},MAGNETIC_FLUX_DENSITY:{dimensions:[1,0,-2,-1,0,0,0,0,0]},FREQUENCY:{dimensions:[0,0,-1,0,0,0,0,0,0]},ANGLE:{dimensions:[0,0,0,0,0,0,0,1,0]},BIT:{dimensions:[0,0,0,0,0,0,0,0,1]}};for(var Bs in _s)hasOwnProperty$2(_s,Bs)&&(_s[Bs].key=Bs);var Us={name:"",base:{},value:1,offset:0,dimensions:ks.map(js=>0)},zs={meter:{name:"meter",base:_s.LENGTH,prefixes:Rs.LONG,value:1,offset:0},inch:{name:"inch",base:_s.LENGTH,prefixes:Rs.NONE,value:.0254,offset:0},foot:{name:"foot",base:_s.LENGTH,prefixes:Rs.NONE,value:.3048,offset:0},yard:{name:"yard",base:_s.LENGTH,prefixes:Rs.NONE,value:.9144,offset:0},mile:{name:"mile",base:_s.LENGTH,prefixes:Rs.NONE,value:1609.344,offset:0},link:{name:"link",base:_s.LENGTH,prefixes:Rs.NONE,value:.201168,offset:0},rod:{name:"rod",base:_s.LENGTH,prefixes:Rs.NONE,value:5.0292,offset:0},chain:{name:"chain",base:_s.LENGTH,prefixes:Rs.NONE,value:20.1168,offset:0},angstrom:{name:"angstrom",base:_s.LENGTH,prefixes:Rs.NONE,value:1e-10,offset:0},m:{name:"m",base:_s.LENGTH,prefixes:Rs.SHORT,value:1,offset:0},in:{name:"in",base:_s.LENGTH,prefixes:Rs.NONE,value:.0254,offset:0},ft:{name:"ft",base:_s.LENGTH,prefixes:Rs.NONE,value:.3048,offset:0},yd:{name:"yd",base:_s.LENGTH,prefixes:Rs.NONE,value:.9144,offset:0},mi:{name:"mi",base:_s.LENGTH,prefixes:Rs.NONE,value:1609.344,offset:0},li:{name:"li",base:_s.LENGTH,prefixes:Rs.NONE,value:.201168,offset:0},rd:{name:"rd",base:_s.LENGTH,prefixes:Rs.NONE,value:5.02921,offset:0},ch:{name:"ch",base:_s.LENGTH,prefixes:Rs.NONE,value:20.1168,offset:0},mil:{name:"mil",base:_s.LENGTH,prefixes:Rs.NONE,value:254e-7,offset:0},m2:{name:"m2",base:_s.SURFACE,prefixes:Rs.SQUARED,value:1,offset:0},sqin:{name:"sqin",base:_s.SURFACE,prefixes:Rs.NONE,value:64516e-8,offset:0},sqft:{name:"sqft",base:_s.SURFACE,prefixes:Rs.NONE,value:.09290304,offset:0},sqyd:{name:"sqyd",base:_s.SURFACE,prefixes:Rs.NONE,value:.83612736,offset:0},sqmi:{name:"sqmi",base:_s.SURFACE,prefixes:Rs.NONE,value:2589988110336e-6,offset:0},sqrd:{name:"sqrd",base:_s.SURFACE,prefixes:Rs.NONE,value:25.29295,offset:0},sqch:{name:"sqch",base:_s.SURFACE,prefixes:Rs.NONE,value:404.6873,offset:0},sqmil:{name:"sqmil",base:_s.SURFACE,prefixes:Rs.NONE,value:64516e-14,offset:0},acre:{name:"acre",base:_s.SURFACE,prefixes:Rs.NONE,value:4046.86,offset:0},hectare:{name:"hectare",base:_s.SURFACE,prefixes:Rs.NONE,value:1e4,offset:0},m3:{name:"m3",base:_s.VOLUME,prefixes:Rs.CUBIC,value:1,offset:0},L:{name:"L",base:_s.VOLUME,prefixes:Rs.SHORT,value:.001,offset:0},l:{name:"l",base:_s.VOLUME,prefixes:Rs.SHORT,value:.001,offset:0},litre:{name:"litre",base:_s.VOLUME,prefixes:Rs.LONG,value:.001,offset:0},cuin:{name:"cuin",base:_s.VOLUME,prefixes:Rs.NONE,value:16387064e-12,offset:0},cuft:{name:"cuft",base:_s.VOLUME,prefixes:Rs.NONE,value:.028316846592,offset:0},cuyd:{name:"cuyd",base:_s.VOLUME,prefixes:Rs.NONE,value:.764554857984,offset:0},teaspoon:{name:"teaspoon",base:_s.VOLUME,prefixes:Rs.NONE,value:5e-6,offset:0},tablespoon:{name:"tablespoon",base:_s.VOLUME,prefixes:Rs.NONE,value:15e-6,offset:0},drop:{name:"drop",base:_s.VOLUME,prefixes:Rs.NONE,value:5e-8,offset:0},gtt:{name:"gtt",base:_s.VOLUME,prefixes:Rs.NONE,value:5e-8,offset:0},minim:{name:"minim",base:_s.VOLUME,prefixes:Rs.NONE,value:6161152e-14,offset:0},fluiddram:{name:"fluiddram",base:_s.VOLUME,prefixes:Rs.NONE,value:36966911e-13,offset:0},fluidounce:{name:"fluidounce",base:_s.VOLUME,prefixes:Rs.NONE,value:2957353e-11,offset:0},gill:{name:"gill",base:_s.VOLUME,prefixes:Rs.NONE,value:.0001182941,offset:0},cc:{name:"cc",base:_s.VOLUME,prefixes:Rs.NONE,value:1e-6,offset:0},cup:{name:"cup",base:_s.VOLUME,prefixes:Rs.NONE,value:.0002365882,offset:0},pint:{name:"pint",base:_s.VOLUME,prefixes:Rs.NONE,value:.0004731765,offset:0},quart:{name:"quart",base:_s.VOLUME,prefixes:Rs.NONE,value:.0009463529,offset:0},gallon:{name:"gallon",base:_s.VOLUME,prefixes:Rs.NONE,value:.003785412,offset:0},beerbarrel:{name:"beerbarrel",base:_s.VOLUME,prefixes:Rs.NONE,value:.1173478,offset:0},oilbarrel:{name:"oilbarrel",base:_s.VOLUME,prefixes:Rs.NONE,value:.1589873,offset:0},hogshead:{name:"hogshead",base:_s.VOLUME,prefixes:Rs.NONE,value:.238481,offset:0},fldr:{name:"fldr",base:_s.VOLUME,prefixes:Rs.NONE,value:36966911e-13,offset:0},floz:{name:"floz",base:_s.VOLUME,prefixes:Rs.NONE,value:2957353e-11,offset:0},gi:{name:"gi",base:_s.VOLUME,prefixes:Rs.NONE,value:.0001182941,offset:0},cp:{name:"cp",base:_s.VOLUME,prefixes:Rs.NONE,value:.0002365882,offset:0},pt:{name:"pt",base:_s.VOLUME,prefixes:Rs.NONE,value:.0004731765,offset:0},qt:{name:"qt",base:_s.VOLUME,prefixes:Rs.NONE,value:.0009463529,offset:0},gal:{name:"gal",base:_s.VOLUME,prefixes:Rs.NONE,value:.003785412,offset:0},bbl:{name:"bbl",base:_s.VOLUME,prefixes:Rs.NONE,value:.1173478,offset:0},obl:{name:"obl",base:_s.VOLUME,prefixes:Rs.NONE,value:.1589873,offset:0},g:{name:"g",base:_s.MASS,prefixes:Rs.SHORT,value:.001,offset:0},gram:{name:"gram",base:_s.MASS,prefixes:Rs.LONG,value:.001,offset:0},ton:{name:"ton",base:_s.MASS,prefixes:Rs.SHORT,value:907.18474,offset:0},t:{name:"t",base:_s.MASS,prefixes:Rs.SHORT,value:1e3,offset:0},tonne:{name:"tonne",base:_s.MASS,prefixes:Rs.LONG,value:1e3,offset:0},grain:{name:"grain",base:_s.MASS,prefixes:Rs.NONE,value:6479891e-11,offset:0},dram:{name:"dram",base:_s.MASS,prefixes:Rs.NONE,value:.0017718451953125,offset:0},ounce:{name:"ounce",base:_s.MASS,prefixes:Rs.NONE,value:.028349523125,offset:0},poundmass:{name:"poundmass",base:_s.MASS,prefixes:Rs.NONE,value:.45359237,offset:0},hundredweight:{name:"hundredweight",base:_s.MASS,prefixes:Rs.NONE,value:45.359237,offset:0},stick:{name:"stick",base:_s.MASS,prefixes:Rs.NONE,value:.115,offset:0},stone:{name:"stone",base:_s.MASS,prefixes:Rs.NONE,value:6.35029318,offset:0},gr:{name:"gr",base:_s.MASS,prefixes:Rs.NONE,value:6479891e-11,offset:0},dr:{name:"dr",base:_s.MASS,prefixes:Rs.NONE,value:.0017718451953125,offset:0},oz:{name:"oz",base:_s.MASS,prefixes:Rs.NONE,value:.028349523125,offset:0},lbm:{name:"lbm",base:_s.MASS,prefixes:Rs.NONE,value:.45359237,offset:0},cwt:{name:"cwt",base:_s.MASS,prefixes:Rs.NONE,value:45.359237,offset:0},s:{name:"s",base:_s.TIME,prefixes:Rs.SHORT,value:1,offset:0},min:{name:"min",base:_s.TIME,prefixes:Rs.NONE,value:60,offset:0},h:{name:"h",base:_s.TIME,prefixes:Rs.NONE,value:3600,offset:0},second:{name:"second",base:_s.TIME,prefixes:Rs.LONG,value:1,offset:0},sec:{name:"sec",base:_s.TIME,prefixes:Rs.LONG,value:1,offset:0},minute:{name:"minute",base:_s.TIME,prefixes:Rs.NONE,value:60,offset:0},hour:{name:"hour",base:_s.TIME,prefixes:Rs.NONE,value:3600,offset:0},day:{name:"day",base:_s.TIME,prefixes:Rs.NONE,value:86400,offset:0},week:{name:"week",base:_s.TIME,prefixes:Rs.NONE,value:604800,offset:0},month:{name:"month",base:_s.TIME,prefixes:Rs.NONE,value:2629800,offset:0},year:{name:"year",base:_s.TIME,prefixes:Rs.NONE,value:31557600,offset:0},decade:{name:"decade",base:_s.TIME,prefixes:Rs.NONE,value:315576e3,offset:0},century:{name:"century",base:_s.TIME,prefixes:Rs.NONE,value:315576e4,offset:0},millennium:{name:"millennium",base:_s.TIME,prefixes:Rs.NONE,value:315576e5,offset:0},hertz:{name:"Hertz",base:_s.FREQUENCY,prefixes:Rs.LONG,value:1,offset:0,reciprocal:!0},Hz:{name:"Hz",base:_s.FREQUENCY,prefixes:Rs.SHORT,value:1,offset:0,reciprocal:!0},rad:{name:"rad",base:_s.ANGLE,prefixes:Rs.SHORT,value:1,offset:0},radian:{name:"radian",base:_s.ANGLE,prefixes:Rs.LONG,value:1,offset:0},deg:{name:"deg",base:_s.ANGLE,prefixes:Rs.SHORT,value:null,offset:0},degree:{name:"degree",base:_s.ANGLE,prefixes:Rs.LONG,value:null,offset:0},grad:{name:"grad",base:_s.ANGLE,prefixes:Rs.SHORT,value:null,offset:0},gradian:{name:"gradian",base:_s.ANGLE,prefixes:Rs.LONG,value:null,offset:0},cycle:{name:"cycle",base:_s.ANGLE,prefixes:Rs.NONE,value:null,offset:0},arcsec:{name:"arcsec",base:_s.ANGLE,prefixes:Rs.NONE,value:null,offset:0},arcmin:{name:"arcmin",base:_s.ANGLE,prefixes:Rs.NONE,value:null,offset:0},A:{name:"A",base:_s.CURRENT,prefixes:Rs.SHORT,value:1,offset:0},ampere:{name:"ampere",base:_s.CURRENT,prefixes:Rs.LONG,value:1,offset:0},K:{name:"K",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1,offset:0},degC:{name:"degC",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1,offset:273.15},degF:{name:"degF",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1/1.8,offset:459.67},degR:{name:"degR",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1/1.8,offset:0},kelvin:{name:"kelvin",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1,offset:0},celsius:{name:"celsius",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1,offset:273.15},fahrenheit:{name:"fahrenheit",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1/1.8,offset:459.67},rankine:{name:"rankine",base:_s.TEMPERATURE,prefixes:Rs.NONE,value:1/1.8,offset:0},mol:{name:"mol",base:_s.AMOUNT_OF_SUBSTANCE,prefixes:Rs.SHORT,value:1,offset:0},mole:{name:"mole",base:_s.AMOUNT_OF_SUBSTANCE,prefixes:Rs.LONG,value:1,offset:0},cd:{name:"cd",base:_s.LUMINOUS_INTENSITY,prefixes:Rs.SHORT,value:1,offset:0},candela:{name:"candela",base:_s.LUMINOUS_INTENSITY,prefixes:Rs.LONG,value:1,offset:0},N:{name:"N",base:_s.FORCE,prefixes:Rs.SHORT,value:1,offset:0},newton:{name:"newton",base:_s.FORCE,prefixes:Rs.LONG,value:1,offset:0},dyn:{name:"dyn",base:_s.FORCE,prefixes:Rs.SHORT,value:1e-5,offset:0},dyne:{name:"dyne",base:_s.FORCE,prefixes:Rs.LONG,value:1e-5,offset:0},lbf:{name:"lbf",base:_s.FORCE,prefixes:Rs.NONE,value:4.4482216152605,offset:0},poundforce:{name:"poundforce",base:_s.FORCE,prefixes:Rs.NONE,value:4.4482216152605,offset:0},kip:{name:"kip",base:_s.FORCE,prefixes:Rs.LONG,value:4448.2216,offset:0},kilogramforce:{name:"kilogramforce",base:_s.FORCE,prefixes:Rs.NONE,value:9.80665,offset:0},J:{name:"J",base:_s.ENERGY,prefixes:Rs.SHORT,value:1,offset:0},joule:{name:"joule",base:_s.ENERGY,prefixes:Rs.SHORT,value:1,offset:0},erg:{name:"erg",base:_s.ENERGY,prefixes:Rs.NONE,value:1e-7,offset:0},Wh:{name:"Wh",base:_s.ENERGY,prefixes:Rs.SHORT,value:3600,offset:0},BTU:{name:"BTU",base:_s.ENERGY,prefixes:Rs.BTU,value:1055.05585262,offset:0},eV:{name:"eV",base:_s.ENERGY,prefixes:Rs.SHORT,value:1602176565e-28,offset:0},electronvolt:{name:"electronvolt",base:_s.ENERGY,prefixes:Rs.LONG,value:1602176565e-28,offset:0},W:{name:"W",base:_s.POWER,prefixes:Rs.SHORT,value:1,offset:0},watt:{name:"watt",base:_s.POWER,prefixes:Rs.LONG,value:1,offset:0},hp:{name:"hp",base:_s.POWER,prefixes:Rs.NONE,value:745.6998715386,offset:0},VAR:{name:"VAR",base:_s.POWER,prefixes:Rs.SHORT,value:Ns.I,offset:0},VA:{name:"VA",base:_s.POWER,prefixes:Rs.SHORT,value:1,offset:0},Pa:{name:"Pa",base:_s.PRESSURE,prefixes:Rs.SHORT,value:1,offset:0},psi:{name:"psi",base:_s.PRESSURE,prefixes:Rs.NONE,value:6894.75729276459,offset:0},atm:{name:"atm",base:_s.PRESSURE,prefixes:Rs.NONE,value:101325,offset:0},bar:{name:"bar",base:_s.PRESSURE,prefixes:Rs.SHORTLONG,value:1e5,offset:0},torr:{name:"torr",base:_s.PRESSURE,prefixes:Rs.NONE,value:133.322,offset:0},mmHg:{name:"mmHg",base:_s.PRESSURE,prefixes:Rs.NONE,value:133.322,offset:0},mmH2O:{name:"mmH2O",base:_s.PRESSURE,prefixes:Rs.NONE,value:9.80665,offset:0},cmH2O:{name:"cmH2O",base:_s.PRESSURE,prefixes:Rs.NONE,value:98.0665,offset:0},coulomb:{name:"coulomb",base:_s.ELECTRIC_CHARGE,prefixes:Rs.LONG,value:1,offset:0},C:{name:"C",base:_s.ELECTRIC_CHARGE,prefixes:Rs.SHORT,value:1,offset:0},farad:{name:"farad",base:_s.ELECTRIC_CAPACITANCE,prefixes:Rs.LONG,value:1,offset:0},F:{name:"F",base:_s.ELECTRIC_CAPACITANCE,prefixes:Rs.SHORT,value:1,offset:0},volt:{name:"volt",base:_s.ELECTRIC_POTENTIAL,prefixes:Rs.LONG,value:1,offset:0},V:{name:"V",base:_s.ELECTRIC_POTENTIAL,prefixes:Rs.SHORT,value:1,offset:0},ohm:{name:"ohm",base:_s.ELECTRIC_RESISTANCE,prefixes:Rs.SHORTLONG,value:1,offset:0},henry:{name:"henry",base:_s.ELECTRIC_INDUCTANCE,prefixes:Rs.LONG,value:1,offset:0},H:{name:"H",base:_s.ELECTRIC_INDUCTANCE,prefixes:Rs.SHORT,value:1,offset:0},siemens:{name:"siemens",base:_s.ELECTRIC_CONDUCTANCE,prefixes:Rs.LONG,value:1,offset:0},S:{name:"S",base:_s.ELECTRIC_CONDUCTANCE,prefixes:Rs.SHORT,value:1,offset:0},weber:{name:"weber",base:_s.MAGNETIC_FLUX,prefixes:Rs.LONG,value:1,offset:0},Wb:{name:"Wb",base:_s.MAGNETIC_FLUX,prefixes:Rs.SHORT,value:1,offset:0},tesla:{name:"tesla",base:_s.MAGNETIC_FLUX_DENSITY,prefixes:Rs.LONG,value:1,offset:0},T:{name:"T",base:_s.MAGNETIC_FLUX_DENSITY,prefixes:Rs.SHORT,value:1,offset:0},b:{name:"b",base:_s.BIT,prefixes:Rs.BINARY_SHORT,value:1,offset:0},bits:{name:"bits",base:_s.BIT,prefixes:Rs.BINARY_LONG,value:1,offset:0},B:{name:"B",base:_s.BIT,prefixes:Rs.BINARY_SHORT,value:8,offset:0},bytes:{name:"bytes",base:_s.BIT,prefixes:Rs.BINARY_LONG,value:8,offset:0}},Hs={meters:"meter",inches:"inch",feet:"foot",yards:"yard",miles:"mile",links:"link",rods:"rod",chains:"chain",angstroms:"angstrom",lt:"l",litres:"litre",liter:"litre",liters:"litre",teaspoons:"teaspoon",tablespoons:"tablespoon",minims:"minim",fluiddrams:"fluiddram",fluidounces:"fluidounce",gills:"gill",cups:"cup",pints:"pint",quarts:"quart",gallons:"gallon",beerbarrels:"beerbarrel",oilbarrels:"oilbarrel",hogsheads:"hogshead",gtts:"gtt",grams:"gram",tons:"ton",tonnes:"tonne",grains:"grain",drams:"dram",ounces:"ounce",poundmasses:"poundmass",hundredweights:"hundredweight",sticks:"stick",lb:"lbm",lbs:"lbm",kips:"kip",kgf:"kilogramforce",acres:"acre",hectares:"hectare",sqfeet:"sqft",sqyard:"sqyd",sqmile:"sqmi",sqmiles:"sqmi",mmhg:"mmHg",mmh2o:"mmH2O",cmh2o:"cmH2O",seconds:"second",secs:"second",minutes:"minute",mins:"minute",hours:"hour",hr:"hour",hrs:"hour",days:"day",weeks:"week",months:"month",years:"year",decades:"decade",centuries:"century",millennia:"millennium",hertz:"hertz",radians:"radian",degrees:"degree",gradians:"gradian",cycles:"cycle",arcsecond:"arcsec",arcseconds:"arcsec",arcminute:"arcmin",arcminutes:"arcmin",BTUs:"BTU",watts:"watt",joules:"joule",amperes:"ampere",coulombs:"coulomb",volts:"volt",ohms:"ohm",farads:"farad",webers:"weber",teslas:"tesla",electronvolts:"electronvolt",moles:"mole",bit:"bits",byte:"bytes"};function el(js){if(js.number==="BigNumber"){var Ls=createBigNumberPi(Ts);zs.rad.value=new Ts(1),zs.deg.value=Ls.div(180),zs.grad.value=Ls.div(200),zs.cycle.value=Ls.times(2),zs.arcsec.value=Ls.div(648e3),zs.arcmin.value=Ls.div(10800)}else zs.rad.value=1,zs.deg.value=Math.PI/180,zs.grad.value=Math.PI/200,zs.cycle.value=2*Math.PI,zs.arcsec.value=Math.PI/648e3,zs.arcmin.value=Math.PI/10800;zs.radian.value=zs.rad.value,zs.degree.value=zs.deg.value,zs.gradian.value=zs.grad.value}el(as),is&&is("config",function(js,Ls){js.number!==Ls.number&&el(js)});var Ys={si:{NONE:{unit:Us,prefix:Rs.NONE[""]},LENGTH:{unit:zs.m,prefix:Rs.SHORT[""]},MASS:{unit:zs.g,prefix:Rs.SHORT.k},TIME:{unit:zs.s,prefix:Rs.SHORT[""]},CURRENT:{unit:zs.A,prefix:Rs.SHORT[""]},TEMPERATURE:{unit:zs.K,prefix:Rs.SHORT[""]},LUMINOUS_INTENSITY:{unit:zs.cd,prefix:Rs.SHORT[""]},AMOUNT_OF_SUBSTANCE:{unit:zs.mol,prefix:Rs.SHORT[""]},ANGLE:{unit:zs.rad,prefix:Rs.SHORT[""]},BIT:{unit:zs.bits,prefix:Rs.SHORT[""]},FORCE:{unit:zs.N,prefix:Rs.SHORT[""]},ENERGY:{unit:zs.J,prefix:Rs.SHORT[""]},POWER:{unit:zs.W,prefix:Rs.SHORT[""]},PRESSURE:{unit:zs.Pa,prefix:Rs.SHORT[""]},ELECTRIC_CHARGE:{unit:zs.C,prefix:Rs.SHORT[""]},ELECTRIC_CAPACITANCE:{unit:zs.F,prefix:Rs.SHORT[""]},ELECTRIC_POTENTIAL:{unit:zs.V,prefix:Rs.SHORT[""]},ELECTRIC_RESISTANCE:{unit:zs.ohm,prefix:Rs.SHORT[""]},ELECTRIC_INDUCTANCE:{unit:zs.H,prefix:Rs.SHORT[""]},ELECTRIC_CONDUCTANCE:{unit:zs.S,prefix:Rs.SHORT[""]},MAGNETIC_FLUX:{unit:zs.Wb,prefix:Rs.SHORT[""]},MAGNETIC_FLUX_DENSITY:{unit:zs.T,prefix:Rs.SHORT[""]},FREQUENCY:{unit:zs.Hz,prefix:Rs.SHORT[""]}}};Ys.cgs=JSON.parse(JSON.stringify(Ys.si)),Ys.cgs.LENGTH={unit:zs.m,prefix:Rs.SHORT.c},Ys.cgs.MASS={unit:zs.g,prefix:Rs.SHORT[""]},Ys.cgs.FORCE={unit:zs.dyn,prefix:Rs.SHORT[""]},Ys.cgs.ENERGY={unit:zs.erg,prefix:Rs.NONE[""]},Ys.us=JSON.parse(JSON.stringify(Ys.si)),Ys.us.LENGTH={unit:zs.ft,prefix:Rs.NONE[""]},Ys.us.MASS={unit:zs.lbm,prefix:Rs.NONE[""]},Ys.us.TEMPERATURE={unit:zs.degF,prefix:Rs.NONE[""]},Ys.us.FORCE={unit:zs.lbf,prefix:Rs.NONE[""]},Ys.us.ENERGY={unit:zs.BTU,prefix:Rs.BTU[""]},Ys.us.POWER={unit:zs.hp,prefix:Rs.NONE[""]},Ys.us.PRESSURE={unit:zs.psi,prefix:Rs.NONE[""]},Ys.auto=JSON.parse(JSON.stringify(Ys.si));var il=Ys.auto;for(var al in As.setUnitSystem=function(js){if(!hasOwnProperty$2(Ys,js))throw new Error("Unit system "+js+" does not exist. Choices are: "+Object.keys(Ys).join(", "));il=Ys[js]},As.getUnitSystem=function(){for(var js in Ys)if(hasOwnProperty$2(Ys,js)&&Ys[js]===il)return js},As.typeConverters={BigNumber:function(js){return new Ts(js+"")},Fraction:function(js){return new Cs(js)},Complex:function(js){return js},number:function(js){return js}},As._getNumberConverter=function(js){if(!As.typeConverters[js])throw new TypeError('Unsupported type "'+js+'"');return As.typeConverters[js]},zs)if(hasOwnProperty$2(zs,al)){var ll=zs[al];ll.dimensions=ll.base.dimensions}for(var nl in Hs)if(hasOwnProperty$2(Hs,nl)){var cl=zs[Hs[nl]],dl={};for(var sl in cl)hasOwnProperty$2(cl,sl)&&(dl[sl]=cl[sl]);dl.name=nl,zs[nl]=dl}return As.isValidAlpha=function(js){return/^[a-zA-Z]$/.test(js)},As.createUnit=function(js,Ls){if(typeof js!="object")throw new TypeError("createUnit expects first parameter to be of type 'Object'");if(Ls&&Ls.override){for(var Ws in js)if(hasOwnProperty$2(js,Ws)&&As.deleteUnit(Ws),js[Ws].aliases)for(var Zs=0;Zs<js[Ws].aliases.length;Zs++)As.deleteUnit(js[Ws].aliases[Zs])}var tl;for(var rl in js)hasOwnProperty$2(js,rl)&&(tl=As.createUnitSingle(rl,js[rl]));return tl},As.createUnitSingle=function(js,Ls,Ws){if(Ls==null&&(Ls={}),typeof js!="string")throw new TypeError("createUnitSingle expects first parameter to be of type 'string'");if(hasOwnProperty$2(zs,js))throw new Error('Cannot create unit "'+js+'": a unit with that name already exists');(function(gl){for(var vl=0;vl<gl.length;vl++){if(ns=gl.charAt(vl),vl===0&&!As.isValidAlpha(ns))throw new Error('Invalid unit name (must begin with alpha character): "'+gl+'"');if(vl>0&&!As.isValidAlpha(ns)&&!Es(ns))throw new Error('Invalid unit name (only alphanumeric characters are allowed): "'+gl+'"')}})(js);var Zs,tl,rl,qs=null,Gs=[],Xs=0;if(Ls&&Ls.type==="Unit")qs=Ls.clone();else if(typeof Ls=="string")Ls!==""&&(Zs=Ls);else{if(typeof Ls!="object")throw new TypeError('Cannot create unit "'+js+'" from "'+Ls.toString()+'": expecting "string" or "Unit" or "Object"');Zs=Ls.definition,tl=Ls.prefixes,Xs=Ls.offset,rl=Ls.baseName,Ls.aliases&&(Gs=Ls.aliases.valueOf())}if(Gs){for(var Ks=0;Ks<Gs.length;Ks++)if(hasOwnProperty$2(zs,Gs[Ks]))throw new Error('Cannot create alias "'+Gs[Ks]+'": a unit with that name already exists')}if(Zs&&typeof Zs=="string"&&!qs)try{qs=As.parse(Zs,{allowNoUnits:!0})}catch(gl){throw gl.message='Could not create unit "'+js+'" from "'+Zs+'": '+gl.message,gl}else Zs&&Zs.type==="Unit"&&(qs=Zs.clone());Gs=Gs||[],Xs=Xs||0,tl=tl&&tl.toUpperCase&&Rs[tl.toUpperCase()]||Rs.NONE;var ol={};if(qs){ol={name:js,value:qs.value,dimensions:qs.dimensions.slice(0),prefixes:tl,offset:Xs};var Fs=!1;for(var Qs in _s)if(hasOwnProperty$2(_s,Qs)){for(var Js=!0,ul=0;ul<ks.length;ul++)if(Math.abs((ol.dimensions[ul]||0)-(_s[Qs].dimensions[ul]||0))>1e-12){Js=!1;break}if(Js){Fs=!0,ol.base=_s[Qs];break}}if(!Fs){rl=rl||js+"_STUFF";var pl={dimensions:qs.dimensions.slice(0)};pl.key=rl,_s[rl]=pl,il[rl]={unit:ol,prefix:Rs.NONE[""]},ol.base=_s[rl]}}else{if(rl=rl||js+"_STUFF",ks.indexOf(rl)>=0)throw new Error('Cannot create new base unit "'+js+'": a base unit with that name already exists (and cannot be overridden)');for(var ml in ks.push(rl),_s)hasOwnProperty$2(_s,ml)&&(_s[ml].dimensions[ks.length-1]=0);for(var fl={dimensions:[]},hl=0;hl<ks.length;hl++)fl.dimensions[hl]=0;fl.dimensions[ks.length-1]=1,fl.key=rl,_s[rl]=fl,ol={name:js,value:1,dimensions:_s[rl].dimensions.slice(0),prefixes:tl,offset:Xs,base:_s[rl]},il[rl]={unit:ol,prefix:Rs.NONE[""]}}As.UNITS[js]=ol;for(var yl=0;yl<Gs.length;yl++){var bl=Gs[yl],Tl={};for(var Nl in ol)hasOwnProperty$2(ol,Nl)&&(Tl[Nl]=ol[Nl]);Tl.name=bl,As.UNITS[bl]=Tl}return delete Ps.cache,new As(null,js)},As.deleteUnit=function(js){delete As.UNITS[js]},As.PREFIXES=Rs,As.BASE_DIMENSIONS=ks,As.BASE_UNITS=_s,As.UNIT_SYSTEMS=Ys,As.UNITS=zs,As},{isClass:!0}),name$2a="unit",dependencies$2a=["typed","Unit"],createUnitFunction=factory(name$2a,dependencies$2a,ss=>{var{typed:ts,Unit:rs}=ss;return ts(name$2a,{Unit:function(ns){return ns.clone()},string:function(ns){return rs.isValuelessUnit(ns)?new rs(null,ns):rs.parse(ns,{allowNoUnits:!0})},"number | BigNumber | Fraction | Complex, string":function(ns,is){return new rs(ns,is)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$29="sparse",dependencies$29=["typed","SparseMatrix"],createSparse=factory(name$29,dependencies$29,ss=>{var{typed:ts,SparseMatrix:rs}=ss;return ts(name$29,{"":function(){return new rs([])},string:function(ns){return new rs([],ns)},"Array | Matrix":function(ns){return new rs(ns)},"Array | Matrix, string":function(ns,is){return new rs(ns,is)}})}),name$28="createUnit",dependencies$28=["typed","Unit"],createCreateUnit=factory(name$28,dependencies$28,ss=>{var{typed:ts,Unit:rs}=ss;return ts(name$28,{"Object, Object":function(ns,is){return rs.createUnit(ns,is)},Object:function(ns){return rs.createUnit(ns,{})},"string, Unit | string | Object, Object":function(ns,is,as){var os={};return os[ns]=is,rs.createUnit(os,as)},"string, Unit | string | Object":function(ns,is){var as={};return as[ns]=is,rs.createUnit(as,{})},string:function(ns){var is={};return is[ns]={},rs.createUnit(is,{})}})}),name$27="acos",dependencies$27=["typed","config","Complex"],createAcos=factory(name$27,dependencies$27,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$27,{number:function(is){return is>=-1&&is<=1||rs.predictable?Math.acos(is):new ns(is,0).acos()},Complex:function(is){return is.acos()},BigNumber:function(is){return is.acos()},"Array | Matrix":function(is){return deepMap(is,this)}})}),name$26="acosh",dependencies$26=["typed","config","Complex"],createAcosh=factory(name$26,dependencies$26,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$26,{number:function(is){return is>=1||rs.predictable?acoshNumber(is):is<=-1?new ns(Math.log(Math.sqrt(is*is-1)-is),Math.PI):new ns(is,0).acosh()},Complex:function(is){return is.acosh()},BigNumber:function(is){return is.acosh()},"Array | Matrix":function(is){return deepMap(is,this)}})}),name$25="acot",dependencies$25=["typed","BigNumber"],createAcot=factory(name$25,dependencies$25,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$25,{number:acotNumber,Complex:function(ns){return ns.acot()},BigNumber:function(ns){return new rs(1).div(ns).atan()},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$24="acoth",dependencies$24=["typed","config","Complex","BigNumber"],createAcoth=factory(name$24,dependencies$24,ss=>{var{typed:ts,config:rs,Complex:ns,BigNumber:is}=ss;return ts(name$24,{number:function(as){return as>=1||as<=-1||rs.predictable?acothNumber(as):new ns(as,0).acoth()},Complex:function(as){return as.acoth()},BigNumber:function(as){return new is(1).div(as).atanh()},"Array | Matrix":function(as){return deepMap(as,this)}})}),name$23="acsc",dependencies$23=["typed","config","Complex","BigNumber"],createAcsc=factory(name$23,dependencies$23,ss=>{var{typed:ts,config:rs,Complex:ns,BigNumber:is}=ss;return ts(name$23,{number:function(as){return as<=-1||as>=1||rs.predictable?acscNumber(as):new ns(as,0).acsc()},Complex:function(as){return as.acsc()},BigNumber:function(as){return new is(1).div(as).asin()},"Array | Matrix":function(as){return deepMap(as,this)}})}),name$22="acsch",dependencies$22=["typed","BigNumber"],createAcsch=factory(name$22,dependencies$22,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$22,{number:acschNumber,Complex:function(ns){return ns.acsch()},BigNumber:function(ns){return new rs(1).div(ns).asinh()},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$21="asec",dependencies$21=["typed","config","Complex","BigNumber"],createAsec=factory(name$21,dependencies$21,ss=>{var{typed:ts,config:rs,Complex:ns,BigNumber:is}=ss;return ts(name$21,{number:function(as){return as<=-1||as>=1||rs.predictable?asecNumber(as):new ns(as,0).asec()},Complex:function(as){return as.asec()},BigNumber:function(as){return new is(1).div(as).acos()},"Array | Matrix":function(as){return deepMap(as,this)}})}),name$20="asech",dependencies$20=["typed","config","Complex","BigNumber"],createAsech=factory(name$20,dependencies$20,ss=>{var{typed:ts,config:rs,Complex:ns,BigNumber:is}=ss;return ts(name$20,{number:function(as){if(as<=1&&as>=-1||rs.predictable){var os=1/as;if(os>0||rs.predictable)return asechNumber(as);var ls=Math.sqrt(os*os-1);return new ns(Math.log(ls-os),Math.PI)}return new ns(as,0).asech()},Complex:function(as){return as.asech()},BigNumber:function(as){return new is(1).div(as).acosh()},"Array | Matrix":function(as){return deepMap(as,this)}})}),name$1$="asin",dependencies$1$=["typed","config","Complex"],createAsin=factory(name$1$,dependencies$1$,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$1$,{number:function(is){return is>=-1&&is<=1||rs.predictable?Math.asin(is):new ns(is,0).asin()},Complex:function(is){return is.asin()},BigNumber:function(is){return is.asin()},"Array | Matrix":function(is){return deepMap(is,this)}})}),name$1_="asinh",dependencies$1_=["typed"],createAsinh=factory(name$1_,dependencies$1_,ss=>{var{typed:ts}=ss;return ts("asinh",{number:asinhNumber,Complex:function(rs){return rs.asinh()},BigNumber:function(rs){return rs.asinh()},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1Z="atan",dependencies$1Z=["typed"],createAtan=factory(name$1Z,dependencies$1Z,ss=>{var{typed:ts}=ss;return ts("atan",{number:function(rs){return Math.atan(rs)},Complex:function(rs){return rs.atan()},BigNumber:function(rs){return rs.atan()},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1Y="atan2",dependencies$1Y=["typed","matrix","equalScalar","BigNumber","DenseMatrix"],createAtan2=factory(name$1Y,dependencies$1Y,ss=>{var{typed:ts,matrix:rs,equalScalar:ns,BigNumber:is,DenseMatrix:as}=ss,os=createAlgorithm02({typed:ts,equalScalar:ns}),ls=createAlgorithm03({typed:ts}),us=createAlgorithm09({typed:ts,equalScalar:ns}),cs=createAlgorithm11({typed:ts,equalScalar:ns}),ps=createAlgorithm12({typed:ts,DenseMatrix:as}),ds=createAlgorithm13({typed:ts}),fs=createAlgorithm14({typed:ts});return ts(name$1Y,{"number, number":Math.atan2,"BigNumber, BigNumber":function(hs,ys){return is.atan2(hs,ys)},"SparseMatrix, SparseMatrix":function(hs,ys){return us(hs,ys,this,!1)},"SparseMatrix, DenseMatrix":function(hs,ys){return os(ys,hs,this,!0)},"DenseMatrix, SparseMatrix":function(hs,ys){return ls(hs,ys,this,!1)},"DenseMatrix, DenseMatrix":function(hs,ys){return ds(hs,ys,this)},"Array, Array":function(hs,ys){return this(rs(hs),rs(ys)).valueOf()},"Array, Matrix":function(hs,ys){return this(rs(hs),ys)},"Matrix, Array":function(hs,ys){return this(hs,rs(ys))},"SparseMatrix, number | BigNumber":function(hs,ys){return cs(hs,ys,this,!1)},"DenseMatrix, number | BigNumber":function(hs,ys){return fs(hs,ys,this,!1)},"number | BigNumber, SparseMatrix":function(hs,ys){return ps(ys,hs,this,!0)},"number | BigNumber, DenseMatrix":function(hs,ys){return fs(ys,hs,this,!0)},"Array, number | BigNumber":function(hs,ys){return fs(rs(hs),ys,this,!1).valueOf()},"number | BigNumber, Array":function(hs,ys){return fs(rs(ys),hs,this,!0).valueOf()}})}),name$1X="atanh",dependencies$1X=["typed","config","Complex"],createAtanh=factory(name$1X,dependencies$1X,ss=>{var{typed:ts,config:rs,Complex:ns}=ss;return ts(name$1X,{number:function(is){return is<=1&&is>=-1||rs.predictable?atanhNumber(is):new ns(is,0).atanh()},Complex:function(is){return is.atanh()},BigNumber:function(is){return is.atanh()},"Array | Matrix":function(is){return deepMap(is,this)}})}),name$1W="cos",dependencies$1W=["typed"],createCos=factory(name$1W,dependencies$1W,ss=>{var{typed:ts}=ss;return ts(name$1W,{number:Math.cos,Complex:function(rs){return rs.cos()},BigNumber:function(rs){return rs.cos()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1V="cosh",dependencies$1V=["typed"],createCosh=factory(name$1V,dependencies$1V,ss=>{var{typed:ts}=ss;return ts(name$1V,{number:cosh$3,Complex:function(rs){return rs.cosh()},BigNumber:function(rs){return rs.cosh()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cosh is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1U="cot",dependencies$1U=["typed","BigNumber"],createCot=factory(name$1U,dependencies$1U,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1U,{number:cotNumber,Complex:function(ns){return ns.cot()},BigNumber:function(ns){return new rs(1).div(ns.tan())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cot is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1T="coth",dependencies$1T=["typed","BigNumber"],createCoth=factory(name$1T,dependencies$1T,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1T,{number:cothNumber,Complex:function(ns){return ns.coth()},BigNumber:function(ns){return new rs(1).div(ns.tanh())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function coth is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1S="csc",dependencies$1S=["typed","BigNumber"],createCsc=factory(name$1S,dependencies$1S,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1S,{number:cscNumber,Complex:function(ns){return ns.csc()},BigNumber:function(ns){return new rs(1).div(ns.sin())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csc is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1R="csch",dependencies$1R=["typed","BigNumber"],createCsch=factory(name$1R,dependencies$1R,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1R,{number:cschNumber,Complex:function(ns){return ns.csch()},BigNumber:function(ns){return new rs(1).div(ns.sinh())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csch is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1Q="sec",dependencies$1Q=["typed","BigNumber"],createSec=factory(name$1Q,dependencies$1Q,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1Q,{number:secNumber,Complex:function(ns){return ns.sec()},BigNumber:function(ns){return new rs(1).div(ns.cos())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sec is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1P="sech",dependencies$1P=["typed","BigNumber"],createSech=factory(name$1P,dependencies$1P,ss=>{var{typed:ts,BigNumber:rs}=ss;return ts(name$1P,{number:sechNumber,Complex:function(ns){return ns.sech()},BigNumber:function(ns){return new rs(1).div(ns.cosh())},Unit:function(ns){if(!ns.hasBase(ns.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sech is no angle");return this(ns.value)},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$1O="sin",dependencies$1O=["typed"],createSin=factory(name$1O,dependencies$1O,ss=>{var{typed:ts}=ss;return ts(name$1O,{number:Math.sin,Complex:function(rs){return rs.sin()},BigNumber:function(rs){return rs.sin()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1N="sinh",dependencies$1N=["typed"],createSinh=factory(name$1N,dependencies$1N,ss=>{var{typed:ts}=ss;return ts(name$1N,{number:sinhNumber,Complex:function(rs){return rs.sinh()},BigNumber:function(rs){return rs.sinh()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sinh is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1M="tan",dependencies$1M=["typed"],createTan=factory(name$1M,dependencies$1M,ss=>{var{typed:ts}=ss;return ts(name$1M,{number:Math.tan,Complex:function(rs){return rs.tan()},BigNumber:function(rs){return rs.tan()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tan is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1L="tanh",dependencies$1L=["typed"],createTanh=factory(name$1L,dependencies$1L,ss=>{var{typed:ts}=ss;return ts("tanh",{number:tanh$3,Complex:function(rs){return rs.tanh()},BigNumber:function(rs){return rs.tanh()},Unit:function(rs){if(!rs.hasBase(rs.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tanh is no angle");return this(rs.value)},"Array | Matrix":function(rs){return deepMap(rs,this)}})}),name$1K="setCartesian",dependencies$1K=["typed","size","subset","compareNatural","Index","DenseMatrix"],createSetCartesian=factory(name$1K,dependencies$1K,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as,DenseMatrix:os}=ss;return ts(name$1K,{"Array | Matrix, Array | Matrix":function(ls,us){var cs=[];if(ns(rs(ls),new as(0))!==0&&ns(rs(us),new as(0))!==0){var ps=flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is),ds=flatten$4(Array.isArray(us)?us:us.toArray()).sort(is);cs=[];for(var fs=0;fs<ps.length;fs++)for(var hs=0;hs<ds.length;hs++)cs.push([ps[fs],ds[hs]])}return Array.isArray(ls)&&Array.isArray(us)?cs:new os(cs)}})}),name$1J="setDifference",dependencies$1J=["typed","size","subset","compareNatural","Index","DenseMatrix"],createSetDifference=factory(name$1J,dependencies$1J,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as,DenseMatrix:os}=ss;return ts(name$1J,{"Array | Matrix, Array | Matrix":function(ls,us){var cs;if(ns(rs(ls),new as(0))===0)cs=[];else{if(ns(rs(us),new as(0))===0)return flatten$4(ls.toArray());var ps,ds=identify(flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is)),fs=identify(flatten$4(Array.isArray(us)?us:us.toArray()).sort(is));cs=[];for(var hs=0;hs<ds.length;hs++){ps=!1;for(var ys=0;ys<fs.length;ys++)if(is(ds[hs].value,fs[ys].value)===0&&ds[hs].identifier===fs[ys].identifier){ps=!0;break}ps||cs.push(ds[hs])}}return Array.isArray(ls)&&Array.isArray(us)?generalize(cs):new os(generalize(cs))}})}),name$1I="setDistinct",dependencies$1I=["typed","size","subset","compareNatural","Index","DenseMatrix"],createSetDistinct=factory(name$1I,dependencies$1I,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as,DenseMatrix:os}=ss;return ts(name$1I,{"Array | Matrix":function(ls){var us;if(ns(rs(ls),new as(0))===0)us=[];else{var cs=flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is);(us=[]).push(cs[0]);for(var ps=1;ps<cs.length;ps++)is(cs[ps],cs[ps-1])!==0&&us.push(cs[ps])}return Array.isArray(ls)?us:new os(us)}})}),name$1H="setIntersect",dependencies$1H=["typed","size","subset","compareNatural","Index","DenseMatrix"],createSetIntersect=factory(name$1H,dependencies$1H,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as,DenseMatrix:os}=ss;return ts(name$1H,{"Array | Matrix, Array | Matrix":function(ls,us){var cs;if(ns(rs(ls),new as(0))===0||ns(rs(us),new as(0))===0)cs=[];else{var ps=identify(flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is)),ds=identify(flatten$4(Array.isArray(us)?us:us.toArray()).sort(is));cs=[];for(var fs=0;fs<ps.length;fs++)for(var hs=0;hs<ds.length;hs++)if(is(ps[fs].value,ds[hs].value)===0&&ps[fs].identifier===ds[hs].identifier){cs.push(ps[fs]);break}}return Array.isArray(ls)&&Array.isArray(us)?generalize(cs):new os(generalize(cs))}})}),name$1G="setIsSubset",dependencies$1G=["typed","size","subset","compareNatural","Index"],createSetIsSubset=factory(name$1G,dependencies$1G,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as}=ss;return ts(name$1G,{"Array | Matrix, Array | Matrix":function(os,ls){if(ns(rs(os),new as(0))===0)return!0;if(ns(rs(ls),new as(0))===0)return!1;for(var us,cs=identify(flatten$4(Array.isArray(os)?os:os.toArray()).sort(is)),ps=identify(flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is)),ds=0;ds<cs.length;ds++){us=!1;for(var fs=0;fs<ps.length;fs++)if(is(cs[ds].value,ps[fs].value)===0&&cs[ds].identifier===ps[fs].identifier){us=!0;break}if(us===!1)return!1}return!0}})}),name$1F="setMultiplicity",dependencies$1F=["typed","size","subset","compareNatural","Index"],createSetMultiplicity=factory(name$1F,dependencies$1F,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as}=ss;return ts(name$1F,{"number | BigNumber | Fraction | Complex, Array | Matrix":function(os,ls){if(ns(rs(ls),new as(0))===0)return 0;for(var us=flatten$4(Array.isArray(ls)?ls:ls.toArray()),cs=0,ps=0;ps<us.length;ps++)is(us[ps],os)===0&&cs++;return cs}})}),name$1E="setPowerset",dependencies$1E=["typed","size","subset","compareNatural","Index"],createSetPowerset=factory(name$1E,dependencies$1E,ss=>{var{typed:ts,size:rs,subset:ns,compareNatural:is,Index:as}=ss;return ts(name$1E,{"Array | Matrix":function(ls){if(ns(rs(ls),new as(0))===0)return[];for(var us=flatten$4(Array.isArray(ls)?ls:ls.toArray()).sort(is),cs=[],ps=0;ps.toString(2).length<=us.length;)cs.push(os(us,ps.toString(2).split("").reverse())),ps++;return function(ds){for(var fs=[],hs=ds.length-1;hs>0;hs--)for(var ys=0;ys<hs;ys++)ds[ys].length>ds[ys+1].length&&(fs=ds[ys],ds[ys]=ds[ys+1],ds[ys+1]=fs);return ds}(cs)}});function os(ls,us){for(var cs=[],ps=0;ps<us.length;ps++)us[ps]==="1"&&cs.push(ls[ps]);return cs}}),name$1D="setSize",dependencies$1D=["typed","compareNatural"],createSetSize=factory(name$1D,dependencies$1D,ss=>{var{typed:ts,compareNatural:rs}=ss;return ts(name$1D,{"Array | Matrix":function(ns){return Array.isArray(ns)?flatten$4(ns).length:flatten$4(ns.toArray()).length},"Array | Matrix, boolean":function(ns,is){if(is===!1||ns.length===0)return Array.isArray(ns)?flatten$4(ns).length:flatten$4(ns.toArray()).length;for(var as=flatten$4(Array.isArray(ns)?ns:ns.toArray()).sort(rs),os=1,ls=1;ls<as.length;ls++)rs(as[ls],as[ls-1])!==0&&os++;return os}})}),name$1C="setSymDifference",dependencies$1C=["typed","size","concat","subset","setDifference","Index"],createSetSymDifference=factory(name$1C,dependencies$1C,ss=>{var{typed:ts,size:rs,concat:ns,subset:is,setDifference:as,Index:os}=ss;return ts(name$1C,{"Array | Matrix, Array | Matrix":function(ls,us){if(is(rs(ls),new os(0))===0)return flatten$4(us);if(is(rs(us),new os(0))===0)return flatten$4(ls);var cs=flatten$4(ls),ps=flatten$4(us);return ns(as(cs,ps),as(ps,cs))}})}),name$1B="setUnion",dependencies$1B=["typed","size","concat","subset","setIntersect","setSymDifference","Index"],createSetUnion=factory(name$1B,dependencies$1B,ss=>{var{typed:ts,size:rs,concat:ns,subset:is,setIntersect:as,setSymDifference:os,Index:ls}=ss;return ts(name$1B,{"Array | Matrix, Array | Matrix":function(us,cs){if(is(rs(us),new ls(0))===0)return flatten$4(cs);if(is(rs(cs),new ls(0))===0)return flatten$4(us);var ps=flatten$4(us),ds=flatten$4(cs);return ns(os(ps,ds),as(ps,ds))}})}),name$1A="add",dependencies$1A=["typed","matrix","addScalar","equalScalar","DenseMatrix","SparseMatrix"],createAdd=factory(name$1A,dependencies$1A,ss=>{var{typed:ts,matrix:rs,addScalar:ns,equalScalar:is,DenseMatrix:as,SparseMatrix:os}=ss,ls=createAlgorithm01({typed:ts}),us=createAlgorithm04({typed:ts,equalScalar:is}),cs=createAlgorithm10({typed:ts,DenseMatrix:as}),ps=createAlgorithm13({typed:ts}),ds=createAlgorithm14({typed:ts});return ts(name$1A,extend$2({"DenseMatrix, DenseMatrix":function(fs,hs){return ps(fs,hs,ns)},"DenseMatrix, SparseMatrix":function(fs,hs){return ls(fs,hs,ns,!1)},"SparseMatrix, DenseMatrix":function(fs,hs){return ls(hs,fs,ns,!0)},"SparseMatrix, SparseMatrix":function(fs,hs){return us(fs,hs,ns)},"Array, Array":function(fs,hs){return this(rs(fs),rs(hs)).valueOf()},"Array, Matrix":function(fs,hs){return this(rs(fs),hs)},"Matrix, Array":function(fs,hs){return this(fs,rs(hs))},"DenseMatrix, any":function(fs,hs){return ds(fs,hs,ns,!1)},"SparseMatrix, any":function(fs,hs){return cs(fs,hs,ns,!1)},"any, DenseMatrix":function(fs,hs){return ds(hs,fs,ns,!0)},"any, SparseMatrix":function(fs,hs){return cs(hs,fs,ns,!0)},"Array, any":function(fs,hs){return ds(rs(fs),hs,ns,!1).valueOf()},"any, Array":function(fs,hs){return ds(rs(hs),fs,ns,!0).valueOf()},"any, any":ns,"any, any, ...any":function(fs,hs,ys){for(var gs=this(fs,hs),bs=0;bs<ys.length;bs++)gs=this(gs,ys[bs]);return gs}},ns.signatures))}),name$1z="hypot",dependencies$1z=["typed","abs","addScalar","divideScalar","multiplyScalar","sqrt","smaller","isPositive"],createHypot=factory(name$1z,dependencies$1z,ss=>{var{typed:ts,abs:rs,addScalar:ns,divideScalar:is,multiplyScalar:as,sqrt:os,smaller:ls,isPositive:us}=ss;return ts(name$1z,{"... number | BigNumber":function(cs){for(var ps=0,ds=0,fs=0;fs<cs.length;fs++){var hs=rs(cs[fs]);ls(ds,hs)?(ps=as(ps,as(is(ds,hs),is(ds,hs))),ps=ns(ps,1),ds=hs):ps=ns(ps,us(hs)?as(is(hs,ds),is(hs,ds)):hs)}return as(ds,os(ps))},Array:function(cs){return this.apply(this,flatten$4(cs))},Matrix:function(cs){return this.apply(this,flatten$4(cs.toArray()))}})}),name$1y="norm",dependencies$1y=["typed","abs","add","pow","conj","sqrt","multiply","equalScalar","larger","smaller","matrix","ctranspose","eigs"],createNorm=factory(name$1y,dependencies$1y,ss=>{var{typed:ts,abs:rs,add:ns,pow:is,conj:as,sqrt:os,multiply:ls,equalScalar:us,larger:cs,smaller:ps,matrix:ds,ctranspose:fs,eigs:hs}=ss;return ts(name$1y,{number:Math.abs,Complex:function(vs){return vs.abs()},BigNumber:function(vs){return vs.abs()},boolean:function(vs){return Math.abs(vs)},Array:function(vs){return bs(ds(vs),2)},Matrix:function(vs){return bs(vs,2)},"number | Complex | BigNumber | boolean, number | BigNumber | string":function(vs){return this(vs)},"Array, number | BigNumber | string":function(vs,Ns){return bs(ds(vs),Ns)},"Matrix, number | BigNumber | string":function(vs,Ns){return bs(vs,Ns)}});function ys(vs,Ns){if(Ns===Number.POSITIVE_INFINITY||Ns==="inf")return function(Cs){var xs=0;return Cs.forEach(function(As){var ws=rs(As);cs(ws,xs)&&(xs=ws)},!0),xs}(vs);if(Ns===Number.NEGATIVE_INFINITY||Ns==="-inf")return function(Cs){var xs;return Cs.forEach(function(As){var ws=rs(As);xs&&!ps(ws,xs)||(xs=ws)},!0),xs||0}(vs);if(Ns==="fro")return bs(vs,2);if(typeof Ns=="number"&&!isNaN(Ns)){if(!us(Ns,0)){var Ts=0;return vs.forEach(function(Cs){Ts=ns(is(rs(Cs),Ns),Ts)},!0),is(Ts,1/Ns)}return Number.POSITIVE_INFINITY}throw new Error("Unsupported parameter value")}function gs(vs,Ns){if(Ns===1)return function(Ts){var Cs=[],xs=0;return Ts.forEach(function(As,ws){var Es=ws[1],Ss=ns(Cs[Es]||0,rs(As));cs(Ss,xs)&&(xs=Ss),Cs[Es]=Ss},!0),xs}(vs);if(Ns===Number.POSITIVE_INFINITY||Ns==="inf")return function(Ts){var Cs=[],xs=0;return Ts.forEach(function(As,ws){var Es=ws[0],Ss=ns(Cs[Es]||0,rs(As));cs(Ss,xs)&&(xs=Ss),Cs[Es]=Ss},!0),xs}(vs);if(Ns==="fro")return function(Ts){var Cs=0;return Ts.forEach(function(xs,As){Cs=ns(Cs,ls(xs,as(xs)))}),rs(os(Cs))}(vs);if(Ns===2)return function(Ts){var Cs=Ts.size();if(Cs[0]!==Cs[1])throw new RangeError("Invalid matrix dimensions");var xs=fs(Ts),As=ls(xs,Ts),ws=hs(As).values.toArray(),Es=ws[ws.length-1];return rs(os(Es))}(vs);throw new Error("Unsupported parameter value "+Ns)}function bs(vs,Ns){var Ts=vs.size();if(Ts.length===1)return ys(vs,Ns);if(Ts.length===2){if(Ts[0]&&Ts[1])return gs(vs,Ns);throw new RangeError("Invalid matrix dimensions")}}}),name$1x="dot",dependencies$1x=["typed","addScalar","multiplyScalar","conj","size"],createDot=factory(name$1x,dependencies$1x,ss=>{var{typed:ts,addScalar:rs,multiplyScalar:ns,conj:is,size:as}=ss;return ts(name$1x,{"Array | DenseMatrix, Array | DenseMatrix":function(us,cs){var ps=os(us,cs),ds=isMatrix(us)?us._data:us,fs=isMatrix(us)?us._datatype:void 0,hs=isMatrix(cs)?cs._data:cs,ys=isMatrix(cs)?cs._datatype:void 0,gs=ls(us).length===2,bs=ls(cs).length===2,vs=rs,Ns=ns;if(fs&&ys&&fs===ys&&typeof fs=="string"){var Ts=fs;vs=ts.find(rs,[Ts,Ts]),Ns=ts.find(ns,[Ts,Ts])}if(!gs&&!bs){for(var Cs=Ns(is(ds[0]),hs[0]),xs=1;xs<ps;xs++)Cs=vs(Cs,Ns(is(ds[xs]),hs[xs]));return Cs}if(!gs&&bs){for(var As=Ns(is(ds[0]),hs[0][0]),ws=1;ws<ps;ws++)As=vs(As,Ns(is(ds[ws]),hs[ws][0]));return As}if(gs&&!bs){for(var Es=Ns(is(ds[0][0]),hs[0]),Ss=1;Ss<ps;Ss++)Es=vs(Es,Ns(is(ds[Ss][0]),hs[Ss]));return Es}if(gs&&bs){for(var Ds=Ns(is(ds[0][0]),hs[0][0]),Vs=1;Vs<ps;Vs++)Ds=vs(Ds,Ns(is(ds[Vs][0]),hs[Vs][0]));return Ds}},"SparseMatrix, SparseMatrix":function(us,cs){os(us,cs);for(var ps=us._index,ds=us._values,fs=cs._index,hs=cs._values,ys=0,gs=rs,bs=ns,vs=0,Ns=0;vs<ps.length&&Ns<fs.length;){var Ts=ps[vs],Cs=fs[Ns];Ts<Cs?vs++:Ts>Cs?Ns++:Ts===Cs&&(ys=gs(ys,bs(ds[vs],hs[Ns])),vs++,Ns++)}return ys}});function os(us,cs){var ps,ds,fs=ls(us),hs=ls(cs);if(fs.length===1)ps=fs[0];else{if(fs.length!==2||fs[1]!==1)throw new RangeError("Expected a column vector, instead got a matrix of size ("+fs.join(", ")+")");ps=fs[0]}if(hs.length===1)ds=hs[0];else{if(hs.length!==2||hs[1]!==1)throw new RangeError("Expected a column vector, instead got a matrix of size ("+hs.join(", ")+")");ds=hs[0]}if(ps!==ds)throw new RangeError("Vectors must have equal length ("+ps+" != "+ds+")");if(ps===0)throw new RangeError("Cannot calculate the dot product of empty vectors");return ps}function ls(us){return isMatrix(us)?us.size():as(us)}}),name$1w="trace",dependencies$1w=["typed","matrix","add"],createTrace=factory(name$1w,dependencies$1w,ss=>{var{typed:ts,matrix:rs,add:ns}=ss;return ts("trace",{Array:function(as){return is(rs(as))},SparseMatrix:function(as){var os=as._values,ls=as._index,us=as._ptr,cs=as._size,ps=cs[0],ds=cs[1];if(ps===ds){var fs=0;if(os.length>0)for(var hs=0;hs<ds;hs++)for(var ys=us[hs],gs=us[hs+1],bs=ys;bs<gs;bs++){var vs=ls[bs];if(vs===hs){fs=ns(fs,os[bs]);break}if(vs>hs)break}return fs}throw new RangeError("Matrix must be square (size: "+format$1(cs)+")")},DenseMatrix:is,any:clone$3});function is(as){var os=as._size,ls=as._data;switch(os.length){case 1:if(os[0]===1)return clone$3(ls[0]);throw new RangeError("Matrix must be square (size: "+format$1(os)+")");case 2:var us=os[0];if(us===os[1]){for(var cs=0,ps=0;ps<us;ps++)cs=ns(cs,ls[ps][ps]);return cs}throw new RangeError("Matrix must be square (size: "+format$1(os)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+format$1(os)+")")}}}),name$1v="index",dependencies$1v=["typed","Index"],createIndex=factory(name$1v,dependencies$1v,ss=>{var{typed:ts,Index:rs}=ss;return ts(name$1v,{"...number | string | BigNumber | Range | Array | Matrix":function(ns){var is=ns.map(function(os){return isBigNumber(os)?os.toNumber():Array.isArray(os)||isMatrix(os)?os.map(function(ls){return isBigNumber(ls)?ls.toNumber():ls}):os}),as=new rs;return rs.apply(as,is),as}})}),keywords=new Set(["end"]),name$1u="Node",dependencies$1u=["mathWithTransform"],createNode=factory(name$1u,dependencies$1u,ss=>{var{mathWithTransform:ts}=ss;function rs(){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator")}return rs.prototype.evaluate=function(ns){return this.compile().evaluate(ns)},rs.prototype.type="Node",rs.prototype.isNode=!0,rs.prototype.comment="",rs.prototype.compile=function(){var ns=this._compile(ts,{}),is={},as=null;return{evaluate:function(os){var ls=createMap$1(os);return function(us){for(var cs of[...keywords])if(us.has(cs))throw new Error('Scope contains an illegal symbol, "'+cs+'" is a reserved keyword')}(ls),ns(ls,is,as)}}},rs.prototype._compile=function(ns,is){throw new Error("Method _compile should be implemented by type "+this.type)},rs.prototype.forEach=function(ns){throw new Error("Cannot run forEach on a Node interface")},rs.prototype.map=function(ns){throw new Error("Cannot run map on a Node interface")},rs.prototype._ifNode=function(ns){if(!isNode$1(ns))throw new TypeError("Callback function must return a Node");return ns},rs.prototype.traverse=function(ns){ns(this,null,null),function is(as,os){as.forEach(function(ls,us,cs){os(ls,us,cs),is(ls,os)})}(this,ns)},rs.prototype.transform=function(ns){return function is(as,os,ls){var us=ns(as,os,ls);return us!==as?us:as.map(is)}(this,null,null)},rs.prototype.filter=function(ns){var is=[];return this.traverse(function(as,os,ls){ns(as,os,ls)&&is.push(as)}),is},rs.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},rs.prototype.cloneDeep=function(){return this.map(function(ns){return ns.cloneDeep()})},rs.prototype.equals=function(ns){return!!ns&&deepStrictEqual(this,ns)},rs.prototype.toString=function(ns){var is=this._getCustomString(ns);return is!==void 0?is:this._toString(ns)},rs.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},rs.prototype.toHTML=function(ns){var is=this._getCustomString(ns);return is!==void 0?is:this.toHTML(ns)},rs.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},rs.prototype.toTex=function(ns){var is=this._getCustomString(ns);return is!==void 0?is:this._toTex(ns)},rs.prototype._toTex=function(ns){throw new Error("_toTex not implemented for "+this.type)},rs.prototype._getCustomString=function(ns){if(ns&&typeof ns=="object")switch(typeof ns.handler){case"object":case"undefined":return;case"function":return ns.handler(this,ns);default:throw new TypeError("Object or function expected as callback")}},rs.prototype.getIdentifier=function(){return this.type},rs.prototype.getContent=function(){return this},rs},{isClass:!0,isNode:!0});function errorTransform(ss){return ss&&ss.isIndexError?new IndexError(ss.index+1,ss.min+1,ss.max!==void 0?ss.max+1:void 0):ss}function accessFactory(ss){var{subset:ts}=ss;return function(rs,ns){try{if(Array.isArray(rs))return ts(rs,ns);if(rs&&typeof rs.subset=="function")return rs.subset(ns);if(typeof rs=="string")return ts(rs,ns);if(typeof rs=="object"){if(!ns.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return getSafeProperty(rs,ns.getObjectProperty())}throw new TypeError("Cannot apply index: unsupported type of object")}catch(is){throw errorTransform(is)}}}var name$1t="AccessorNode",dependencies$1t=["subset","Node"],createAccessorNode=factory(name$1t,dependencies$1t,ss=>{var{subset:ts,Node:rs}=ss,ns=accessFactory({subset:ts});function is(os,ls){if(!(this instanceof is))throw new SyntaxError("Constructor must be called with the new operator");if(!isNode$1(os))throw new TypeError('Node expected for parameter "object"');if(!isIndexNode(ls))throw new TypeError('IndexNode expected for parameter "index"');this.object=os||null,this.index=ls,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function as(os){return!(isAccessorNode(os)||isArrayNode(os)||isConstantNode(os)||isFunctionNode(os)||isObjectNode(os)||isParenthesisNode(os)||isSymbolNode(os))}return is.prototype=new rs,is.prototype.type="AccessorNode",is.prototype.isAccessorNode=!0,is.prototype._compile=function(os,ls){var us=this.object._compile(os,ls),cs=this.index._compile(os,ls);if(this.index.isObjectProperty()){var ps=this.index.getObjectProperty();return function(ds,fs,hs){return getSafeProperty(us(ds,fs,hs),ps)}}return function(ds,fs,hs){var ys=us(ds,fs,hs),gs=cs(ds,fs,ys);return ns(ys,gs)}},is.prototype.forEach=function(os){os(this.object,"object",this),os(this.index,"index",this)},is.prototype.map=function(os){return new is(this._ifNode(os(this.object,"object",this)),this._ifNode(os(this.index,"index",this)))},is.prototype.clone=function(){return new is(this.object,this.index)},is.prototype._toString=function(os){var ls=this.object.toString(os);return as(this.object)&&(ls="("+ls+")"),ls+this.index.toString(os)},is.prototype.toHTML=function(os){var ls=this.object.toHTML(os);return as(this.object)&&(ls='<span class="math-parenthesis math-round-parenthesis">(</span>'+ls+'<span class="math-parenthesis math-round-parenthesis">)</span>'),ls+this.index.toHTML(os)},is.prototype._toTex=function(os){var ls=this.object.toTex(os);return as(this.object)&&(ls="\\left(' + object + '\\right)"),ls+this.index.toTex(os)},is.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},is.fromJSON=function(os){return new is(os.object,os.index)},is},{isClass:!0,isNode:!0}),name$1s="ArrayNode",dependencies$1s=["Node"],createArrayNode=factory(name$1s,dependencies$1s,ss=>{var{Node:ts}=ss;function rs(ns){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=ns||[],!Array.isArray(this.items)||!this.items.every(isNode$1))throw new TypeError("Array containing Nodes expected")}return rs.prototype=new ts,rs.prototype.type="ArrayNode",rs.prototype.isArrayNode=!0,rs.prototype._compile=function(ns,is){var as=map$2(this.items,function(ls){return ls._compile(ns,is)});if(ns.config.matrix!=="Array"){var os=ns.matrix;return function(ls,us,cs){return os(map$2(as,function(ps){return ps(ls,us,cs)}))}}return function(ls,us,cs){return map$2(as,function(ps){return ps(ls,us,cs)})}},rs.prototype.forEach=function(ns){for(var is=0;is<this.items.length;is++)ns(this.items[is],"items["+is+"]",this)},rs.prototype.map=function(ns){for(var is=[],as=0;as<this.items.length;as++)is[as]=this._ifNode(ns(this.items[as],"items["+as+"]",this));return new rs(is)},rs.prototype.clone=function(){return new rs(this.items.slice(0))},rs.prototype._toString=function(ns){return"["+this.items.map(function(is){return is.toString(ns)}).join(", ")+"]"},rs.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},rs.fromJSON=function(ns){return new rs(ns.items)},rs.prototype.toHTML=function(ns){return'<span class="math-parenthesis math-square-parenthesis">[</span>'+this.items.map(function(is){return is.toHTML(ns)}).join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},rs.prototype._toTex=function(ns){return function is(as,os){var ls=as.some(isArrayNode)&&!as.every(isArrayNode),us=os||ls,cs=us?"&":"\\\\",ps=as.map(function(ds){return ds.items?is(ds.items,!os):ds.toTex(ns)}).join(cs);return ls||!us||us&&!os?"\\begin{bmatrix}"+ps+"\\end{bmatrix}":ps}(this.items,!1)},rs},{isClass:!0,isNode:!0});function assignFactory(ss){var{subset:ts,matrix:rs}=ss;return function(ns,is,as){try{if(Array.isArray(ns))return rs(ns).subset(is,as).valueOf();if(ns&&typeof ns.subset=="function")return ns.subset(is,as);if(typeof ns=="string")return ts(ns,is,as);if(typeof ns=="object"){if(!is.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return setSafeProperty(ns,is.getObjectProperty(),as),ns}throw new TypeError("Cannot apply index: unsupported type of object")}catch(os){throw errorTransform(os)}}}var properties=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function getPrecedence(ss,ts){var rs=ss;ts!=="keep"&&(rs=ss.getContent());for(var ns=rs.getIdentifier(),is=0;is<properties.length;is++)if(ns in properties[is])return is;return null}function getAssociativity(ss,ts){var rs=ss;ts!=="keep"&&(rs=ss.getContent());var ns=rs.getIdentifier(),is=getPrecedence(rs,ts);if(is===null)return null;var as=properties[is][ns];if(hasOwnProperty$2(as,"associativity")){if(as.associativity==="left")return"left";if(as.associativity==="right")return"right";throw Error("'"+ns+"' has the invalid associativity '"+as.associativity+"'.")}return null}function isAssociativeWith(ss,ts,rs){var ns=rs!=="keep"?ss.getContent():ss,is=rs!=="keep"?ss.getContent():ts,as=ns.getIdentifier(),os=is.getIdentifier(),ls=getPrecedence(ns,rs);if(ls===null)return null;var us=properties[ls][as];if(hasOwnProperty$2(us,"associativeWith")&&us.associativeWith instanceof Array){for(var cs=0;cs<us.associativeWith.length;cs++)if(us.associativeWith[cs]===os)return!0;return!1}return null}var name$1r="AssignmentNode",dependencies$1r=["subset","?matrix","Node"],createAssignmentNode=factory(name$1r,dependencies$1r,ss=>{var{subset:ts,matrix:rs,Node:ns}=ss,is=accessFactory({subset:ts}),as=assignFactory({subset:ts,matrix:rs});function os(us,cs,ps){if(!(this instanceof os))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=us,this.index=ps?cs:null,this.value=ps||cs,!isSymbolNode(us)&&!isAccessorNode(us))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(isSymbolNode(us)&&us.name==="end")throw new Error('Cannot assign to symbol "end"');if(this.index&&!isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!isNode$1(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function ls(us,cs){cs||(cs="keep");var ps=getPrecedence(us,cs),ds=getPrecedence(us.value,cs);return cs==="all"||ds!==null&&ds<=ps}return os.prototype=new ns,os.prototype.type="AssignmentNode",os.prototype.isAssignmentNode=!0,os.prototype._compile=function(us,cs){var ps=this.object._compile(us,cs),ds=this.index?this.index._compile(us,cs):null,fs=this.value._compile(us,cs),hs=this.object.name;if(this.index){if(this.index.isObjectProperty()){var ys=this.index.getObjectProperty();return function(Ns,Ts,Cs){var xs=ps(Ns,Ts,Cs),As=fs(Ns,Ts,Cs);return setSafeProperty(xs,ys,As),As}}if(isSymbolNode(this.object))return function(Ns,Ts,Cs){var xs=ps(Ns,Ts,Cs),As=fs(Ns,Ts,Cs),ws=ds(Ns,Ts,xs);return Ns.set(hs,as(xs,ws,As)),As};var gs=this.object.object._compile(us,cs);if(this.object.index.isObjectProperty()){var bs=this.object.index.getObjectProperty();return function(Ns,Ts,Cs){var xs=gs(Ns,Ts,Cs),As=getSafeProperty(xs,bs),ws=ds(Ns,Ts,As),Es=fs(Ns,Ts,Cs);return setSafeProperty(xs,bs,as(As,ws,Es)),Es}}var vs=this.object.index._compile(us,cs);return function(Ns,Ts,Cs){var xs=gs(Ns,Ts,Cs),As=vs(Ns,Ts,xs),ws=is(xs,As),Es=ds(Ns,Ts,ws),Ss=fs(Ns,Ts,Cs);return as(xs,As,as(ws,Es,Ss)),Ss}}if(!isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(Ns,Ts,Cs){var xs=fs(Ns,Ts,Cs);return Ns.set(hs,xs),xs}},os.prototype.forEach=function(us){us(this.object,"object",this),this.index&&us(this.index,"index",this),us(this.value,"value",this)},os.prototype.map=function(us){return new os(this._ifNode(us(this.object,"object",this)),this.index?this._ifNode(us(this.index,"index",this)):null,this._ifNode(us(this.value,"value",this)))},os.prototype.clone=function(){return new os(this.object,this.index,this.value)},os.prototype._toString=function(us){var cs=this.object.toString(us),ps=this.index?this.index.toString(us):"",ds=this.value.toString(us);return ls(this,us&&us.parenthesis)&&(ds="("+ds+")"),cs+ps+" = "+ds},os.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},os.fromJSON=function(us){return new os(us.object,us.index,us.value)},os.prototype.toHTML=function(us){var cs=this.object.toHTML(us),ps=this.index?this.index.toHTML(us):"",ds=this.value.toHTML(us);return ls(this,us&&us.parenthesis)&&(ds='<span class="math-paranthesis math-round-parenthesis">(</span>'+ds+'<span class="math-paranthesis math-round-parenthesis">)</span>'),cs+ps+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+ds},os.prototype._toTex=function(us){var cs=this.object.toTex(us),ps=this.index?this.index.toTex(us):"",ds=this.value.toTex(us);return ls(this,us&&us.parenthesis)&&(ds="\\left(".concat(ds,"\\right)")),cs+ps+":="+ds},os},{isClass:!0,isNode:!0}),name$1q="BlockNode",dependencies$1q=["ResultSet","Node"],createBlockNode=factory(name$1q,dependencies$1q,ss=>{var{ResultSet:ts,Node:rs}=ss;function ns(is){if(!(this instanceof ns))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(is))throw new Error("Array expected");this.blocks=is.map(function(as){var os=as&&as.node,ls=!as||as.visible===void 0||as.visible;if(!isNode$1(os))throw new TypeError('Property "node" must be a Node');if(typeof ls!="boolean")throw new TypeError('Property "visible" must be a boolean');return{node:os,visible:ls}})}return ns.prototype=new rs,ns.prototype.type="BlockNode",ns.prototype.isBlockNode=!0,ns.prototype._compile=function(is,as){var os=map$2(this.blocks,function(ls){return{evaluate:ls.node._compile(is,as),visible:ls.visible}});return function(ls,us,cs){var ps=[];return forEach$1$1(os,function(ds){var fs=ds.evaluate(ls,us,cs);ds.visible&&ps.push(fs)}),new ts(ps)}},ns.prototype.forEach=function(is){for(var as=0;as<this.blocks.length;as++)is(this.blocks[as].node,"blocks["+as+"].node",this)},ns.prototype.map=function(is){for(var as=[],os=0;os<this.blocks.length;os++){var ls=this.blocks[os],us=this._ifNode(is(ls.node,"blocks["+os+"].node",this));as[os]={node:us,visible:ls.visible}}return new ns(as)},ns.prototype.clone=function(){return new ns(this.blocks.map(function(is){return{node:is.node,visible:is.visible}}))},ns.prototype._toString=function(is){return this.blocks.map(function(as){return as.node.toString(is)+(as.visible?"":";")}).join(`
`)},ns.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},ns.fromJSON=function(is){return new ns(is.blocks)},ns.prototype.toHTML=function(is){return this.blocks.map(function(as){return as.node.toHTML(is)+(as.visible?"":'<span class="math-separator">;</span>')}).join('<span class="math-separator"><br /></span>')},ns.prototype._toTex=function(is){return this.blocks.map(function(as){return as.node.toTex(is)+(as.visible?"":";")}).join(`\\;\\;
`)},ns},{isClass:!0,isNode:!0}),name$1p="ConditionalNode",dependencies$1p=["Node"],createConditionalNode=factory(name$1p,dependencies$1p,ss=>{var{Node:ts}=ss;function rs(ns,is,as){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(!isNode$1(ns))throw new TypeError("Parameter condition must be a Node");if(!isNode$1(is))throw new TypeError("Parameter trueExpr must be a Node");if(!isNode$1(as))throw new TypeError("Parameter falseExpr must be a Node");this.condition=ns,this.trueExpr=is,this.falseExpr=as}return rs.prototype=new ts,rs.prototype.type="ConditionalNode",rs.prototype.isConditionalNode=!0,rs.prototype._compile=function(ns,is){var as=this.condition._compile(ns,is),os=this.trueExpr._compile(ns,is),ls=this.falseExpr._compile(ns,is);return function(us,cs,ps){return function(ds){if(typeof ds=="number"||typeof ds=="boolean"||typeof ds=="string")return!!ds;if(ds){if(isBigNumber(ds))return!ds.isZero();if(isComplex(ds))return!(!ds.re&&!ds.im);if(isUnit(ds))return!!ds.value}if(ds==null)return!1;throw new TypeError('Unsupported type of condition "'+typeOf$1(ds)+'"')}(as(us,cs,ps))?os(us,cs,ps):ls(us,cs,ps)}},rs.prototype.forEach=function(ns){ns(this.condition,"condition",this),ns(this.trueExpr,"trueExpr",this),ns(this.falseExpr,"falseExpr",this)},rs.prototype.map=function(ns){return new rs(this._ifNode(ns(this.condition,"condition",this)),this._ifNode(ns(this.trueExpr,"trueExpr",this)),this._ifNode(ns(this.falseExpr,"falseExpr",this)))},rs.prototype.clone=function(){return new rs(this.condition,this.trueExpr,this.falseExpr)},rs.prototype._toString=function(ns){var is=ns&&ns.parenthesis?ns.parenthesis:"keep",as=getPrecedence(this,is),os=this.condition.toString(ns),ls=getPrecedence(this.condition,is);(is==="all"||this.condition.type==="OperatorNode"||ls!==null&&ls<=as)&&(os="("+os+")");var us=this.trueExpr.toString(ns),cs=getPrecedence(this.trueExpr,is);(is==="all"||this.trueExpr.type==="OperatorNode"||cs!==null&&cs<=as)&&(us="("+us+")");var ps=this.falseExpr.toString(ns),ds=getPrecedence(this.falseExpr,is);return(is==="all"||this.falseExpr.type==="OperatorNode"||ds!==null&&ds<=as)&&(ps="("+ps+")"),os+" ? "+us+" : "+ps},rs.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},rs.fromJSON=function(ns){return new rs(ns.condition,ns.trueExpr,ns.falseExpr)},rs.prototype.toHTML=function(ns){var is=ns&&ns.parenthesis?ns.parenthesis:"keep",as=getPrecedence(this,is),os=this.condition.toHTML(ns),ls=getPrecedence(this.condition,is);(is==="all"||this.condition.type==="OperatorNode"||ls!==null&&ls<=as)&&(os='<span class="math-parenthesis math-round-parenthesis">(</span>'+os+'<span class="math-parenthesis math-round-parenthesis">)</span>');var us=this.trueExpr.toHTML(ns),cs=getPrecedence(this.trueExpr,is);(is==="all"||this.trueExpr.type==="OperatorNode"||cs!==null&&cs<=as)&&(us='<span class="math-parenthesis math-round-parenthesis">(</span>'+us+'<span class="math-parenthesis math-round-parenthesis">)</span>');var ps=this.falseExpr.toHTML(ns),ds=getPrecedence(this.falseExpr,is);return(is==="all"||this.falseExpr.type==="OperatorNode"||ds!==null&&ds<=as)&&(ps='<span class="math-parenthesis math-round-parenthesis">(</span>'+ps+'<span class="math-parenthesis math-round-parenthesis">)</span>'),os+'<span class="math-operator math-conditional-operator">?</span>'+us+'<span class="math-operator math-conditional-operator">:</span>'+ps},rs.prototype._toTex=function(ns){return"\\begin{cases} {"+this.trueExpr.toTex(ns)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(ns)+"}\\\\{"+this.falseExpr.toTex(ns)+"}, &\\quad{\\text{otherwise}}\\end{cases}"},rs},{isClass:!0,isNode:!0}),_extends=Object.assign||function(ss){for(var ts=1;ts<arguments.length;ts++){var rs=arguments[ts];for(var ns in rs)Object.prototype.hasOwnProperty.call(rs,ns)&&(ss[ns]=rs[ns])}return ss},defaultEscapes={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},formatEscapes={"":"\\--","":"\\---"," ":"~","	":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},defaultEscapeMapFn=function(ss,ts){return _extends({},ss,ts)},dist$1=function(ss){for(var ts=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},rs=ts.preserveFormatting,ns=rs!==void 0&&rs,is=ts.escapeMapFn,as=is===void 0?defaultEscapeMapFn:is,os=String(ss),ls="",us=as(_extends({},defaultEscapes),ns?_extends({},formatEscapes):{}),cs=Object.keys(us),ps=function(){var ds=!1;cs.forEach(function(fs,hs){ds||os.length>=fs.length&&os.slice(0,fs.length)===fs&&(ls+=us[cs[hs]],os=os.slice(fs.length,os.length),ds=!0)}),ds||(ls+=os.slice(0,1),os=os.slice(1,os.length))};os;)ps();return ls},latexSymbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},latexOperators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},latexFunctions={abs:{1:"\\left|${args[0]}\\right|"},add:{2:"\\left(${args[0]}".concat(latexOperators.add,"${args[1]}\\right)")},cbrt:{1:"\\sqrt[3]{${args[0]}}"},ceil:{1:"\\left\\lceil${args[0]}\\right\\rceil"},cube:{1:"\\left(${args[0]}\\right)^3"},divide:{2:"\\frac{${args[0]}}{${args[1]}}"},dotDivide:{2:"\\left(${args[0]}".concat(latexOperators.dotDivide,"${args[1]}\\right)")},dotMultiply:{2:"\\left(${args[0]}".concat(latexOperators.dotMultiply,"${args[1]}\\right)")},dotPow:{2:"\\left(${args[0]}".concat(latexOperators.dotPow,"${args[1]}\\right)")},exp:{1:"\\exp\\left(${args[0]}\\right)"},expm1:"\\left(e".concat(latexOperators.pow,"{${args[0]}}-1\\right)"),fix:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},floor:{1:"\\left\\lfloor${args[0]}\\right\\rfloor"},gcd:"\\gcd\\left(${args}\\right)",hypot:"\\hypot\\left(${args}\\right)",log:{1:"\\ln\\left(${args[0]}\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}\\right)"},log10:{1:"\\log_{10}\\left(${args[0]}\\right)"},log1p:{1:"\\ln\\left(${args[0]}+1\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}+1\\right)"},log2:"\\log_{2}\\left(${args[0]}\\right)",mod:{2:"\\left(${args[0]}".concat(latexOperators.mod,"${args[1]}\\right)")},multiply:{2:"\\left(${args[0]}".concat(latexOperators.multiply,"${args[1]}\\right)")},norm:{1:"\\left\\|${args[0]}\\right\\|",2:void 0},nthRoot:{2:"\\sqrt[${args[1]}]{${args[0]}}"},nthRoots:{2:"\\{y : $y^{args[1]} = {${args[0]}}\\}"},pow:{2:"\\left(${args[0]}\\right)".concat(latexOperators.pow,"{${args[1]}}")},round:{1:"\\left\\lfloor${args[0]}\\right\\rceil",2:void 0},sign:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},sqrt:{1:"\\sqrt{${args[0]}}"},square:{1:"\\left(${args[0]}\\right)^2"},subtract:{2:"\\left(${args[0]}".concat(latexOperators.subtract,"${args[1]}\\right)")},unaryMinus:{1:"".concat(latexOperators.unaryMinus,"\\left(${args[0]}\\right)")},unaryPlus:{1:"".concat(latexOperators.unaryPlus,"\\left(${args[0]}\\right)")},bitAnd:{2:"\\left(${args[0]}".concat(latexOperators.bitAnd,"${args[1]}\\right)")},bitNot:{1:latexOperators.bitNot+"\\left(${args[0]}\\right)"},bitOr:{2:"\\left(${args[0]}".concat(latexOperators.bitOr,"${args[1]}\\right)")},bitXor:{2:"\\left(${args[0]}".concat(latexOperators.bitXor,"${args[1]}\\right)")},leftShift:{2:"\\left(${args[0]}".concat(latexOperators.leftShift,"${args[1]}\\right)")},rightArithShift:{2:"\\left(${args[0]}".concat(latexOperators.rightArithShift,"${args[1]}\\right)")},rightLogShift:{2:"\\left(${args[0]}".concat(latexOperators.rightLogShift,"${args[1]}\\right)")},bellNumbers:{1:"\\mathrm{B}_{${args[0]}}"},catalan:{1:"\\mathrm{C}_{${args[0]}}"},stirlingS2:{2:"\\mathrm{S}\\left(${args}\\right)"},arg:{1:"\\arg\\left(${args[0]}\\right)"},conj:{1:"\\left(${args[0]}\\right)^*"},im:{1:"\\Im\\left\\lbrace${args[0]}\\right\\rbrace"},re:{1:"\\Re\\left\\lbrace${args[0]}\\right\\rbrace"},and:{2:"\\left(${args[0]}".concat(latexOperators.and,"${args[1]}\\right)")},not:{1:latexOperators.not+"\\left(${args[0]}\\right)"},or:{2:"\\left(${args[0]}".concat(latexOperators.or,"${args[1]}\\right)")},xor:{2:"\\left(${args[0]}".concat(latexOperators.xor,"${args[1]}\\right)")},cross:{2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"},ctranspose:{1:"\\left(${args[0]}\\right)".concat(latexOperators.ctranspose)},det:{1:"\\det\\left(${args[0]}\\right)"},dot:{2:"\\left(${args[0]}\\cdot${args[1]}\\right)"},expm:{1:"\\exp\\left(${args[0]}\\right)"},inv:{1:"\\left(${args[0]}\\right)^{-1}"},pinv:{1:"\\left(${args[0]}\\right)^{+}"},sqrtm:{1:"{${args[0]}}".concat(latexOperators.pow,"{\\frac{1}{2}}")},trace:{1:"\\mathrm{tr}\\left(${args[0]}\\right)"},transpose:{1:"\\left(${args[0]}\\right)".concat(latexOperators.transpose)},combinations:{2:"\\binom{${args[0]}}{${args[1]}}"},combinationsWithRep:{2:"\\left(\\!\\!{\\binom{${args[0]}}{${args[1]}}}\\!\\!\\right)"},factorial:{1:"\\left(${args[0]}\\right)".concat(latexOperators.factorial)},gamma:{1:"\\Gamma\\left(${args[0]}\\right)"},lgamma:{1:"\\ln\\Gamma\\left(${args[0]}\\right)"},equal:{2:"\\left(${args[0]}".concat(latexOperators.equal,"${args[1]}\\right)")},larger:{2:"\\left(${args[0]}".concat(latexOperators.larger,"${args[1]}\\right)")},largerEq:{2:"\\left(${args[0]}".concat(latexOperators.largerEq,"${args[1]}\\right)")},smaller:{2:"\\left(${args[0]}".concat(latexOperators.smaller,"${args[1]}\\right)")},smallerEq:{2:"\\left(${args[0]}".concat(latexOperators.smallerEq,"${args[1]}\\right)")},unequal:{2:"\\left(${args[0]}".concat(latexOperators.unequal,"${args[1]}\\right)")},erf:{1:"erf\\left(${args[0]}\\right)"},max:"\\max\\left(${args}\\right)",min:"\\min\\left(${args}\\right)",variance:"\\mathrm{Var}\\left(${args}\\right)",acos:{1:"\\cos^{-1}\\left(${args[0]}\\right)"},acosh:{1:"\\cosh^{-1}\\left(${args[0]}\\right)"},acot:{1:"\\cot^{-1}\\left(${args[0]}\\right)"},acoth:{1:"\\coth^{-1}\\left(${args[0]}\\right)"},acsc:{1:"\\csc^{-1}\\left(${args[0]}\\right)"},acsch:{1:"\\mathrm{csch}^{-1}\\left(${args[0]}\\right)"},asec:{1:"\\sec^{-1}\\left(${args[0]}\\right)"},asech:{1:"\\mathrm{sech}^{-1}\\left(${args[0]}\\right)"},asin:{1:"\\sin^{-1}\\left(${args[0]}\\right)"},asinh:{1:"\\sinh^{-1}\\left(${args[0]}\\right)"},atan:{1:"\\tan^{-1}\\left(${args[0]}\\right)"},atan2:{2:"\\mathrm{atan2}\\left(${args}\\right)"},atanh:{1:"\\tanh^{-1}\\left(${args[0]}\\right)"},cos:{1:"\\cos\\left(${args[0]}\\right)"},cosh:{1:"\\cosh\\left(${args[0]}\\right)"},cot:{1:"\\cot\\left(${args[0]}\\right)"},coth:{1:"\\coth\\left(${args[0]}\\right)"},csc:{1:"\\csc\\left(${args[0]}\\right)"},csch:{1:"\\mathrm{csch}\\left(${args[0]}\\right)"},sec:{1:"\\sec\\left(${args[0]}\\right)"},sech:{1:"\\mathrm{sech}\\left(${args[0]}\\right)"},sin:{1:"\\sin\\left(${args[0]}\\right)"},sinh:{1:"\\sinh\\left(${args[0]}\\right)"},tan:{1:"\\tan\\left(${args[0]}\\right)"},tanh:{1:"\\tanh\\left(${args[0]}\\right)"},to:{2:"\\left(${args[0]}".concat(latexOperators.to,"${args[1]}\\right)")},numeric:function(ss,ts){return ss.args[0].toTex()},number:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},string:{0:'\\mathtt{""}',1:"\\mathrm{string}\\left(${args[0]}\\right)"},bignumber:{0:"0",1:"\\left(${args[0]}\\right)"},complex:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)+".concat(latexSymbols.i,"\\cdot\\left(${args[1]}\\right)\\right)")},matrix:{0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},sparse:{0:"\\begin{bsparse}\\end{bsparse}",1:"\\left(${args[0]}\\right)"},unit:{1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"}},defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)",latexUnits={deg:"^\\circ"};function escapeLatex(ss){return dist$1(ss,{preserveFormatting:!0})}function toSymbol(ss,ts){return(ts=ts!==void 0&&ts)?hasOwnProperty$2(latexUnits,ss)?latexUnits[ss]:"\\mathrm{"+escapeLatex(ss)+"}":hasOwnProperty$2(latexSymbols,ss)?latexSymbols[ss]:escapeLatex(ss)}var name$1o="ConstantNode",dependencies$1o=["Node"],createConstantNode=factory(name$1o,dependencies$1o,ss=>{var{Node:ts}=ss;function rs(ns){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");this.value=ns}return rs.prototype=new ts,rs.prototype.type="ConstantNode",rs.prototype.isConstantNode=!0,rs.prototype._compile=function(ns,is){var as=this.value;return function(){return as}},rs.prototype.forEach=function(ns){},rs.prototype.map=function(ns){return this.clone()},rs.prototype.clone=function(){return new rs(this.value)},rs.prototype._toString=function(ns){return format$1(this.value,ns)},rs.prototype.toHTML=function(ns){var is=this._toString(ns);switch(typeOf$1(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+is+"</span>";case"string":return'<span class="math-string">'+is+"</span>";case"boolean":return'<span class="math-boolean">'+is+"</span>";case"null":return'<span class="math-null-symbol">'+is+"</span>";case"undefined":return'<span class="math-undefined">'+is+"</span>";default:return'<span class="math-symbol">'+is+"</span>"}},rs.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},rs.fromJSON=function(ns){return new rs(ns.value)},rs.prototype._toTex=function(ns){var is=this._toString(ns);switch(typeOf$1(this.value)){case"string":return"\\mathtt{"+escapeLatex(is)+"}";case"number":case"BigNumber":if(!isFinite(this.value))return this.value.valueOf()<0?"-\\infty":"\\infty";var as=is.toLowerCase().indexOf("e");return as!==-1?is.substring(0,as)+"\\cdot10^{"+is.substring(as+1)+"}":is;case"Fraction":return this.value.toLatex();default:return is}},rs},{isClass:!0,isNode:!0}),name$1n="FunctionAssignmentNode",dependencies$1n=["typed","Node"],createFunctionAssignmentNode=factory(name$1n,dependencies$1n,ss=>{var{typed:ts,Node:rs}=ss;function ns(as,os,ls){if(!(this instanceof ns))throw new SyntaxError("Constructor must be called with the new operator");if(typeof as!="string")throw new TypeError('String expected for parameter "name"');if(!Array.isArray(os))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!isNode$1(ls))throw new TypeError('Node expected for parameter "expr"');if(keywords.has(as))throw new Error('Illegal function name, "'+as+'" is a reserved keyword');this.name=as,this.params=os.map(function(us){return us&&us.name||us}),this.types=os.map(function(us){return us&&us.type||"any"}),this.expr=ls}function is(as,os){var ls=getPrecedence(as,os),us=getPrecedence(as.expr,os);return os==="all"||us!==null&&us<=ls}return ns.prototype=new rs,ns.prototype.type="FunctionAssignmentNode",ns.prototype.isFunctionAssignmentNode=!0,ns.prototype._compile=function(as,os){var ls=Object.create(os);forEach$1$1(this.params,function(hs){ls[hs]=!0});var us=this.expr._compile(as,ls),cs=this.name,ps=this.params,ds=join(this.types,","),fs=cs+"("+join(this.params,", ")+")";return function(hs,ys,gs){var bs={};bs[ds]=function(){for(var Ns=Object.create(ys),Ts=0;Ts<ps.length;Ts++)Ns[ps[Ts]]=arguments[Ts];return us(hs,Ns,gs)};var vs=ts(cs,bs);return vs.syntax=fs,hs.set(cs,vs),vs}},ns.prototype.forEach=function(as){as(this.expr,"expr",this)},ns.prototype.map=function(as){var os=this._ifNode(as(this.expr,"expr",this));return new ns(this.name,this.params.slice(0),os)},ns.prototype.clone=function(){return new ns(this.name,this.params.slice(0),this.expr)},ns.prototype._toString=function(as){var os=as&&as.parenthesis?as.parenthesis:"keep",ls=this.expr.toString(as);return is(this,os)&&(ls="("+ls+")"),this.name+"("+this.params.join(", ")+") = "+ls},ns.prototype.toJSON=function(){var as=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map(function(os,ls){return{name:os,type:as[ls]}}),expr:this.expr}},ns.fromJSON=function(as){return new ns(as.name,as.params,as.expr)},ns.prototype.toHTML=function(as){for(var os=as&&as.parenthesis?as.parenthesis:"keep",ls=[],us=0;us<this.params.length;us++)ls.push('<span class="math-symbol math-parameter">'+escape$1(this.params[us])+"</span>");var cs=this.expr.toHTML(as);return is(this,os)&&(cs='<span class="math-parenthesis math-round-parenthesis">(</span>'+cs+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+escape$1(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+ls.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+cs},ns.prototype._toTex=function(as){var os=as&&as.parenthesis?as.parenthesis:"keep",ls=this.expr.toTex(as);return is(this,os)&&(ls="\\left(".concat(ls,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(toSymbol).join(",")+"\\right):="+ls},ns},{isClass:!0,isNode:!0}),name$1m="IndexNode",dependencies$1m=["Node","size"],createIndexNode=factory(name$1m,dependencies$1m,ss=>{var{Node:ts,size:rs}=ss;function ns(is,as){if(!(this instanceof ns))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=is,this.dotNotation=as||!1,!Array.isArray(is)||!is.every(isNode$1))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties")}return ns.prototype=new ts,ns.prototype.type="IndexNode",ns.prototype.isIndexNode=!0,ns.prototype._compile=function(is,as){var os=map$2(this.dimensions,function(us,cs){if(us.filter(fs=>fs.isSymbolNode&&fs.name==="end").length>0){var ps=Object.create(as);ps.end=!0;var ds=us._compile(is,ps);return function(fs,hs,ys){if(!isMatrix(ys)&&!isArray$1$1(ys)&&!isString$1$1(ys))throw new TypeError('Cannot resolve "end": context must be a Matrix, Array, or string but is '+typeOf$1(ys));var gs=rs(ys).valueOf(),bs=Object.create(hs);return bs.end=gs[cs],ds(fs,bs,ys)}}return us._compile(is,as)}),ls=getSafeProperty(is,"index");return function(us,cs,ps){var ds=map$2(os,function(fs){return fs(us,cs,ps)});return ls(...ds)}},ns.prototype.forEach=function(is){for(var as=0;as<this.dimensions.length;as++)is(this.dimensions[as],"dimensions["+as+"]",this)},ns.prototype.map=function(is){for(var as=[],os=0;os<this.dimensions.length;os++)as[os]=this._ifNode(is(this.dimensions[os],"dimensions["+os+"]",this));return new ns(as,this.dotNotation)},ns.prototype.clone=function(){return new ns(this.dimensions.slice(0),this.dotNotation)},ns.prototype.isObjectProperty=function(){return this.dimensions.length===1&&isConstantNode(this.dimensions[0])&&typeof this.dimensions[0].value=="string"},ns.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},ns.prototype._toString=function(is){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},ns.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},ns.fromJSON=function(is){return new ns(is.dimensions,is.dotNotation)},ns.prototype.toHTML=function(is){for(var as=[],os=0;os<this.dimensions.length;os++)as[os]=this.dimensions[os].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+escape$1(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+as.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},ns.prototype._toTex=function(is){var as=this.dimensions.map(function(os){return os.toTex(is)});return this.dotNotation?"."+this.getObjectProperty():"_{"+as.join(",")+"}"},ns},{isClass:!0,isNode:!0}),name$1l="ObjectNode",dependencies$1l=["Node"],createObjectNode=factory(name$1l,dependencies$1l,ss=>{var{Node:ts}=ss;function rs(ns){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=ns||{},ns&&(typeof ns!="object"||!Object.keys(ns).every(function(is){return isNode$1(ns[is])})))throw new TypeError("Object containing Nodes expected")}return rs.prototype=new ts,rs.prototype.type="ObjectNode",rs.prototype.isObjectNode=!0,rs.prototype._compile=function(ns,is){var as={};for(var os in this.properties)if(hasOwnProperty$2(this.properties,os)){var ls=stringify(os),us=JSON.parse(ls);if(!isSafeProperty(this.properties,us))throw new Error('No access to property "'+us+'"');as[us]=this.properties[os]._compile(ns,is)}return function(cs,ps,ds){var fs={};for(var hs in as)hasOwnProperty$2(as,hs)&&(fs[hs]=as[hs](cs,ps,ds));return fs}},rs.prototype.forEach=function(ns){for(var is in this.properties)hasOwnProperty$2(this.properties,is)&&ns(this.properties[is],"properties["+stringify(is)+"]",this)},rs.prototype.map=function(ns){var is={};for(var as in this.properties)hasOwnProperty$2(this.properties,as)&&(is[as]=this._ifNode(ns(this.properties[as],"properties["+stringify(as)+"]",this)));return new rs(is)},rs.prototype.clone=function(){var ns={};for(var is in this.properties)hasOwnProperty$2(this.properties,is)&&(ns[is]=this.properties[is]);return new rs(ns)},rs.prototype._toString=function(ns){var is=[];for(var as in this.properties)hasOwnProperty$2(this.properties,as)&&is.push(stringify(as)+": "+this.properties[as].toString(ns));return"{"+is.join(", ")+"}"},rs.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},rs.fromJSON=function(ns){return new rs(ns.properties)},rs.prototype.toHTML=function(ns){var is=[];for(var as in this.properties)hasOwnProperty$2(this.properties,as)&&is.push('<span class="math-symbol math-property">'+escape$1(as)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[as].toHTML(ns));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+is.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},rs.prototype._toTex=function(ns){var is=[];for(var as in this.properties)hasOwnProperty$2(this.properties,as)&&is.push("\\mathbf{"+as+":} & "+this.properties[as].toTex(ns)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(is.join(`
`),"\\end{array}\\right\\}")},rs},{isClass:!0,isNode:!0}),name$1k="OperatorNode",dependencies$1k=["Node"],createOperatorNode=factory(name$1k,dependencies$1k,ss=>{var{Node:ts}=ss;function rs(is,as,os,ls,us){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(typeof is!="string")throw new TypeError('string expected for parameter "op"');if(typeof as!="string")throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(os)||!os.every(isNode$1))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=ls===!0,this.isPercentage=us===!0,this.op=is,this.fn=as,this.args=os||[]}function ns(is,as,os,ls,us){var cs,ps=getPrecedence(is,as),ds=getAssociativity(is,as);if(as==="all"||ls.length>2&&is.getIdentifier()!=="OperatorNode:add"&&is.getIdentifier()!=="OperatorNode:multiply")return ls.map(function(Es){switch(Es.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}});switch(ls.length){case 0:cs=[];break;case 1:var fs=getPrecedence(ls[0],as);if(us&&fs!==null){var hs,ys;if(as==="keep"?(hs=ls[0].getIdentifier(),ys=is.getIdentifier()):(hs=ls[0].getContent().getIdentifier(),ys=is.getContent().getIdentifier()),properties[ps][ys].latexLeftParens===!1){cs=[!1];break}if(properties[fs][hs].latexParens===!1){cs=[!1];break}}if(fs===null){cs=[!1];break}if(fs<=ps){cs=[!0];break}cs=[!1];break;case 2:var gs,bs,vs=getPrecedence(ls[0],as),Ns=isAssociativeWith(is,ls[0],as);gs=vs!==null&&(vs===ps&&ds==="right"&&!Ns||vs<ps);var Ts,Cs,xs,As=getPrecedence(ls[1],as),ws=isAssociativeWith(is,ls[1],as);bs=As!==null&&(As===ps&&ds==="left"&&!ws||As<ps),us&&(as==="keep"?(Ts=is.getIdentifier(),Cs=is.args[0].getIdentifier(),xs=is.args[1].getIdentifier()):(Ts=is.getContent().getIdentifier(),Cs=is.args[0].getContent().getIdentifier(),xs=is.args[1].getContent().getIdentifier()),vs!==null&&(properties[ps][Ts].latexLeftParens===!1&&(gs=!1),properties[vs][Cs].latexParens===!1&&(gs=!1)),As!==null&&(properties[ps][Ts].latexRightParens===!1&&(bs=!1),properties[As][xs].latexParens===!1&&(bs=!1))),cs=[gs,bs];break;default:is.getIdentifier()!=="OperatorNode:add"&&is.getIdentifier()!=="OperatorNode:multiply"||(cs=ls.map(function(Es){var Ss=getPrecedence(Es,as),Ds=isAssociativeWith(is,Es,as),Vs=getAssociativity(Es,as);return Ss!==null&&(ps===Ss&&ds===Vs&&!Ds||Ss<ps)}))}return ls.length>=2&&is.getIdentifier()==="OperatorNode:multiply"&&is.implicit&&as==="auto"&&os==="hide"&&(cs=ls.map(function(Es,Ss){var Ds=Es.getIdentifier()==="ParenthesisNode";return!(!cs[Ss]&&!Ds)})),cs}return rs.prototype=new ts,rs.prototype.type="OperatorNode",rs.prototype.isOperatorNode=!0,rs.prototype._compile=function(is,as){if(typeof this.fn!="string"||!isSafeMethod(is,this.fn))throw is[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var os=getSafeProperty(is,this.fn),ls=map$2(this.args,function(ds){return ds._compile(is,as)});if(ls.length===1){var us=ls[0];return function(ds,fs,hs){return os(us(ds,fs,hs))}}if(ls.length===2){var cs=ls[0],ps=ls[1];return function(ds,fs,hs){return os(cs(ds,fs,hs),ps(ds,fs,hs))}}return function(ds,fs,hs){return os.apply(null,map$2(ls,function(ys){return ys(ds,fs,hs)}))}},rs.prototype.forEach=function(is){for(var as=0;as<this.args.length;as++)is(this.args[as],"args["+as+"]",this)},rs.prototype.map=function(is){for(var as=[],os=0;os<this.args.length;os++)as[os]=this._ifNode(is(this.args[os],"args["+os+"]",this));return new rs(this.op,this.fn,as,this.implicit,this.isPercentage)},rs.prototype.clone=function(){return new rs(this.op,this.fn,this.args.slice(0),this.implicit,this.isPercentage)},rs.prototype.isUnary=function(){return this.args.length===1},rs.prototype.isBinary=function(){return this.args.length===2},rs.prototype._toString=function(is){var as=is&&is.parenthesis?is.parenthesis:"keep",os=is&&is.implicit?is.implicit:"hide",ls=this.args,us=ns(this,as,os,ls,!1);if(ls.length===1){var cs=getAssociativity(this,as),ps=ls[0].toString(is);us[0]&&(ps="("+ps+")");var ds=/[a-zA-Z]+/.test(this.op);return cs==="right"?this.op+(ds?" ":"")+ps:cs==="left"?ps+(ds?" ":"")+this.op:ps+this.op}if(ls.length===2){var fs=ls[0].toString(is),hs=ls[1].toString(is);return us[0]&&(fs="("+fs+")"),us[1]&&(hs="("+hs+")"),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&os==="hide"?fs+" "+hs:fs+" "+this.op+" "+hs}if(ls.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var ys=ls.map(function(gs,bs){return gs=gs.toString(is),us[bs]&&(gs="("+gs+")"),gs});return this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&os==="hide"?ys.join(" "):ys.join(" "+this.op+" ")}return this.fn+"("+this.args.join(", ")+")"},rs.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit,isPercentage:this.isPercentage}},rs.fromJSON=function(is){return new rs(is.op,is.fn,is.args,is.implicit,is.isPercentage)},rs.prototype.toHTML=function(is){var as=is&&is.parenthesis?is.parenthesis:"keep",os=is&&is.implicit?is.implicit:"hide",ls=this.args,us=ns(this,as,os,ls,!1);if(ls.length===1){var cs=getAssociativity(this,as),ps=ls[0].toHTML(is);return us[0]&&(ps='<span class="math-parenthesis math-round-parenthesis">(</span>'+ps+'<span class="math-parenthesis math-round-parenthesis">)</span>'),cs==="right"?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+escape$1(this.op)+"</span>"+ps:ps+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+escape$1(this.op)+"</span>"}if(ls.length===2){var ds=ls[0].toHTML(is),fs=ls[1].toHTML(is);return us[0]&&(ds='<span class="math-parenthesis math-round-parenthesis">(</span>'+ds+'<span class="math-parenthesis math-round-parenthesis">)</span>'),us[1]&&(fs='<span class="math-parenthesis math-round-parenthesis">(</span>'+fs+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&os==="hide"?ds+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+fs:ds+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape$1(this.op)+"</span>"+fs}var hs=ls.map(function(ys,gs){return ys=ys.toHTML(is),us[gs]&&(ys='<span class="math-parenthesis math-round-parenthesis">(</span>'+ys+'<span class="math-parenthesis math-round-parenthesis">)</span>'),ys});return ls.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")?this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&os==="hide"?hs.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):hs.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape$1(this.op)+"</span>"):'<span class="math-function">'+escape$1(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+hs.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'},rs.prototype._toTex=function(is){var as=is&&is.parenthesis?is.parenthesis:"keep",os=is&&is.implicit?is.implicit:"hide",ls=this.args,us=ns(this,as,os,ls,!0),cs=latexOperators[this.fn];if(cs=cs===void 0?this.op:cs,ls.length===1){var ps=getAssociativity(this,as),ds=ls[0].toTex(is);return us[0]&&(ds="\\left(".concat(ds,"\\right)")),ps==="right"?cs+ds:ds+cs}if(ls.length===2){var fs=ls[0],hs=fs.toTex(is);us[0]&&(hs="\\left(".concat(hs,"\\right)"));var ys,gs=ls[1].toTex(is);switch(us[1]&&(gs="\\left(".concat(gs,"\\right)")),ys=as==="keep"?fs.getIdentifier():fs.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return cs+"{"+hs+"}{"+gs+"}";case"OperatorNode:pow":switch(hs="{"+hs+"}",gs="{"+gs+"}",ys){case"ConditionalNode":case"OperatorNode:divide":hs="\\left(".concat(hs,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&os==="hide")return hs+"~"+gs}return hs+cs+gs}if(ls.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var bs=ls.map(function(vs,Ns){return vs=vs.toTex(is),us[Ns]&&(vs="\\left(".concat(vs,"\\right)")),vs});return this.getIdentifier()==="OperatorNode:multiply"&&this.implicit?bs.join("~"):bs.join(cs)}return"\\mathrm{"+this.fn+"}\\left("+ls.map(function(vs){return vs.toTex(is)}).join(",")+"\\right)"},rs.prototype.getIdentifier=function(){return this.type+":"+this.fn},rs},{isClass:!0,isNode:!0}),name$1j="ParenthesisNode",dependencies$1j=["Node"],createParenthesisNode=factory(name$1j,dependencies$1j,ss=>{var{Node:ts}=ss;function rs(ns){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(!isNode$1(ns))throw new TypeError('Node expected for parameter "content"');this.content=ns}return rs.prototype=new ts,rs.prototype.type="ParenthesisNode",rs.prototype.isParenthesisNode=!0,rs.prototype._compile=function(ns,is){return this.content._compile(ns,is)},rs.prototype.getContent=function(){return this.content.getContent()},rs.prototype.forEach=function(ns){ns(this.content,"content",this)},rs.prototype.map=function(ns){return new rs(ns(this.content,"content",this))},rs.prototype.clone=function(){return new rs(this.content)},rs.prototype._toString=function(ns){return!ns||ns&&!ns.parenthesis||ns&&ns.parenthesis==="keep"?"("+this.content.toString(ns)+")":this.content.toString(ns)},rs.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},rs.fromJSON=function(ns){return new rs(ns.content)},rs.prototype.toHTML=function(ns){return!ns||ns&&!ns.parenthesis||ns&&ns.parenthesis==="keep"?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(ns)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(ns)},rs.prototype._toTex=function(ns){return!ns||ns&&!ns.parenthesis||ns&&ns.parenthesis==="keep"?"\\left(".concat(this.content.toTex(ns),"\\right)"):this.content.toTex(ns)},rs},{isClass:!0,isNode:!0}),name$1i="RangeNode",dependencies$1i=["Node"],createRangeNode=factory(name$1i,dependencies$1i,ss=>{var{Node:ts}=ss;function rs(is,as,os){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(!isNode$1(is))throw new TypeError("Node expected");if(!isNode$1(as))throw new TypeError("Node expected");if(os&&!isNode$1(os))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=is,this.end=as,this.step=os||null}function ns(is,as){var os=getPrecedence(is,as),ls={},us=getPrecedence(is.start,as);if(ls.start=us!==null&&us<=os||as==="all",is.step){var cs=getPrecedence(is.step,as);ls.step=cs!==null&&cs<=os||as==="all"}var ps=getPrecedence(is.end,as);return ls.end=ps!==null&&ps<=os||as==="all",ls}return rs.prototype=new ts,rs.prototype.type="RangeNode",rs.prototype.isRangeNode=!0,rs.prototype.needsEnd=function(){return this.filter(function(is){return isSymbolNode(is)&&is.name==="end"}).length>0},rs.prototype._compile=function(is,as){var os=is.range,ls=this.start._compile(is,as),us=this.end._compile(is,as);if(this.step){var cs=this.step._compile(is,as);return function(ps,ds,fs){return os(ls(ps,ds,fs),us(ps,ds,fs),cs(ps,ds,fs))}}return function(ps,ds,fs){return os(ls(ps,ds,fs),us(ps,ds,fs))}},rs.prototype.forEach=function(is){is(this.start,"start",this),is(this.end,"end",this),this.step&&is(this.step,"step",this)},rs.prototype.map=function(is){return new rs(this._ifNode(is(this.start,"start",this)),this._ifNode(is(this.end,"end",this)),this.step&&this._ifNode(is(this.step,"step",this)))},rs.prototype.clone=function(){return new rs(this.start,this.end,this.step&&this.step)},rs.prototype._toString=function(is){var as,os=ns(this,is&&is.parenthesis?is.parenthesis:"keep"),ls=this.start.toString(is);if(os.start&&(ls="("+ls+")"),as=ls,this.step){var us=this.step.toString(is);os.step&&(us="("+us+")"),as+=":"+us}var cs=this.end.toString(is);return os.end&&(cs="("+cs+")"),as+=":"+cs},rs.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},rs.fromJSON=function(is){return new rs(is.start,is.end,is.step)},rs.prototype.toHTML=function(is){var as,os=ns(this,is&&is.parenthesis?is.parenthesis:"keep"),ls=this.start.toHTML(is);if(os.start&&(ls='<span class="math-parenthesis math-round-parenthesis">(</span>'+ls+'<span class="math-parenthesis math-round-parenthesis">)</span>'),as=ls,this.step){var us=this.step.toHTML(is);os.step&&(us='<span class="math-parenthesis math-round-parenthesis">(</span>'+us+'<span class="math-parenthesis math-round-parenthesis">)</span>'),as+='<span class="math-operator math-range-operator">:</span>'+us}var cs=this.end.toHTML(is);return os.end&&(cs='<span class="math-parenthesis math-round-parenthesis">(</span>'+cs+'<span class="math-parenthesis math-round-parenthesis">)</span>'),as+='<span class="math-operator math-range-operator">:</span>'+cs},rs.prototype._toTex=function(is){var as=ns(this,is&&is.parenthesis?is.parenthesis:"keep"),os=this.start.toTex(is);if(as.start&&(os="\\left(".concat(os,"\\right)")),this.step){var ls=this.step.toTex(is);as.step&&(ls="\\left(".concat(ls,"\\right)")),os+=":"+ls}var us=this.end.toTex(is);return as.end&&(us="\\left(".concat(us,"\\right)")),os+=":"+us},rs},{isClass:!0,isNode:!0}),name$1h="RelationalNode",dependencies$1h=["Node"],createRelationalNode=factory(name$1h,dependencies$1h,ss=>{var{Node:ts}=ss;function rs(ns,is){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(ns))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(is))throw new TypeError("Parameter params must be an array");if(ns.length!==is.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=ns,this.params=is}return rs.prototype=new ts,rs.prototype.type="RelationalNode",rs.prototype.isRelationalNode=!0,rs.prototype._compile=function(ns,is){var as=this,os=this.params.map(ls=>ls._compile(ns,is));return function(ls,us,cs){for(var ps,ds=os[0](ls,us,cs),fs=0;fs<as.conditionals.length;fs++)if(ps=ds,ds=os[fs+1](ls,us,cs),!getSafeProperty(ns,as.conditionals[fs])(ps,ds))return!1;return!0}},rs.prototype.forEach=function(ns){this.params.forEach((is,as)=>ns(is,"params["+as+"]",this),this)},rs.prototype.map=function(ns){return new rs(this.conditionals.slice(),this.params.map((is,as)=>this._ifNode(ns(is,"params["+as+"]",this)),this))},rs.prototype.clone=function(){return new rs(this.conditionals,this.params)},rs.prototype._toString=function(ns){for(var is=ns&&ns.parenthesis?ns.parenthesis:"keep",as=getPrecedence(this,is),os=this.params.map(function(ps,ds){var fs=getPrecedence(ps,is);return is==="all"||fs!==null&&fs<=as?"("+ps.toString(ns)+")":ps.toString(ns)}),ls={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},us=os[0],cs=0;cs<this.conditionals.length;cs++)us+=" "+ls[this.conditionals[cs]]+" "+os[cs+1];return us},rs.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},rs.fromJSON=function(ns){return new rs(ns.conditionals,ns.params)},rs.prototype.toHTML=function(ns){for(var is=ns&&ns.parenthesis?ns.parenthesis:"keep",as=getPrecedence(this,is),os=this.params.map(function(ps,ds){var fs=getPrecedence(ps,is);return is==="all"||fs!==null&&fs<=as?'<span class="math-parenthesis math-round-parenthesis">(</span>'+ps.toHTML(ns)+'<span class="math-parenthesis math-round-parenthesis">)</span>':ps.toHTML(ns)}),ls={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},us=os[0],cs=0;cs<this.conditionals.length;cs++)us+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape$1(ls[this.conditionals[cs]])+"</span>"+os[cs+1];return us},rs.prototype._toTex=function(ns){for(var is=ns&&ns.parenthesis?ns.parenthesis:"keep",as=getPrecedence(this,is),os=this.params.map(function(cs,ps){var ds=getPrecedence(cs,is);return is==="all"||ds!==null&&ds<=as?"\\left("+cs.toTex(ns)+"\right)":cs.toTex(ns)}),ls=os[0],us=0;us<this.conditionals.length;us++)ls+=latexOperators[this.conditionals[us]]+os[us+1];return ls},rs},{isClass:!0,isNode:!0}),name$1g="SymbolNode",dependencies$1g=["math","?Unit","Node"],createSymbolNode=factory(name$1g,dependencies$1g,ss=>{var{math:ts,Unit:rs,Node:ns}=ss;function is(os){return!!rs&&rs.isValuelessUnit(os)}function as(os){if(!(this instanceof as))throw new SyntaxError("Constructor must be called with the new operator");if(typeof os!="string")throw new TypeError('String expected for parameter "name"');this.name=os}return as.prototype=new ns,as.prototype.type="SymbolNode",as.prototype.isSymbolNode=!0,as.prototype._compile=function(os,ls){var us=this.name;if(ls[us]===!0)return function(ps,ds,fs){return ds[us]};if(us in os)return function(ps,ds,fs){return ps.has(us)?ps.get(us):getSafeProperty(os,us)};var cs=is(us);return function(ps,ds,fs){return ps.has(us)?ps.get(us):cs?new rs(null,us):as.onUndefinedSymbol(us)}},as.prototype.forEach=function(os){},as.prototype.map=function(os){return this.clone()},as.onUndefinedSymbol=function(os){throw new Error("Undefined symbol "+os)},as.prototype.clone=function(){return new as(this.name)},as.prototype._toString=function(os){return this.name},as.prototype.toHTML=function(os){var ls=escape$1(this.name);return ls==="true"||ls==="false"?'<span class="math-symbol math-boolean">'+ls+"</span>":ls==="i"?'<span class="math-symbol math-imaginary-symbol">'+ls+"</span>":ls==="Infinity"?'<span class="math-symbol math-infinity-symbol">'+ls+"</span>":ls==="NaN"?'<span class="math-symbol math-nan-symbol">'+ls+"</span>":ls==="null"?'<span class="math-symbol math-null-symbol">'+ls+"</span>":ls==="undefined"?'<span class="math-symbol math-undefined-symbol">'+ls+"</span>":'<span class="math-symbol">'+ls+"</span>"},as.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},as.fromJSON=function(os){return new as(os.name)},as.prototype._toTex=function(os){var ls=!1;ts[this.name]===void 0&&is(this.name)&&(ls=!0);var us=toSymbol(this.name,ls);return us[0]==="\\"?us:" "+us},as},{isClass:!0,isNode:!0});function createSubScope(ss){for(var ts=arguments.length,rs=new Array(ts>1?ts-1:0),ns=1;ns<ts;ns++)rs[ns-1]=arguments[ns];return typeof ss.createSubScope=="function"?assign$2(ss.createSubScope(),...rs):assign$2(createEmptyMap(),ss,...rs)}var name$1f="FunctionNode",dependencies$1f=["math","Node","SymbolNode"],createFunctionNode=factory(name$1f,dependencies$1f,ss=>{var{math:ts,Node:rs,SymbolNode:ns}=ss;function is(cs,ps){if(!(this instanceof is))throw new SyntaxError("Constructor must be called with the new operator");if(typeof cs=="string"&&(cs=new ns(cs)),!isNode$1(cs))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(ps)||!ps.every(isNode$1))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=cs,this.args=ps||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}is.prototype=new rs,is.prototype.type="FunctionNode",is.prototype.isFunctionNode=!0;var as=cs=>format$1(cs,{truncate:78});is.prototype._compile=function(cs,ps){if(!(this instanceof is))throw new TypeError("No valid FunctionNode");var ds=this.args.map(Es=>Es._compile(cs,ps));if(!isSymbolNode(this.fn)){if(isAccessorNode(this.fn)&&isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var fs=this.fn.object._compile(cs,ps),hs=this.fn.index.getObjectProperty(),ys=this.args;return function(Es,Ss,Ds){var Vs=fs(Es,Ss,Ds);if(validateSafeMethod(Vs,hs),Vs[hs]&&Vs[hs].rawArgs)return Vs[hs](ys,cs,createSubScope(Es,Ss),Es);var Is=ds.map(Os=>Os(Es,Ss,Ds));return Vs[hs].apply(Vs,Is)}}var gs=this.fn.toString(),bs=this.fn._compile(cs,ps),vs=this.args;return function(Es,Ss,Ds){var Vs=bs(Es,Ss,Ds);if(typeof Vs!="function")throw new TypeError("Expression '".concat(gs,"' did not evaluate to a function; value is:")+`
  `.concat(as(Vs)));if(Vs.rawArgs)return Vs(vs,cs,createSubScope(Es,Ss),Es);var Is=ds.map(Os=>Os(Es,Ss,Ds));return Vs.apply(Vs,Is)}}var Ns=this.fn.name;if(ps[Ns]){var Ts=this.args;return function(Es,Ss,Ds){var Vs=Ss[Ns];if(typeof Vs!="function")throw new TypeError("Argument '".concat(Ns,"' was not a function; received: ").concat(as(Vs)));if(Vs.rawArgs)return Vs(Ts,cs,createSubScope(Es,Ss),Es);var Is=ds.map(Os=>Os(Es,Ss,Ds));return Vs.apply(Vs,Is)}}var Cs=Ns in cs?getSafeProperty(cs,Ns):void 0,xs=typeof Cs=="function"&&Cs.rawArgs===!0,As=Es=>{var Ss;if(Es.has(Ns))Ss=Es.get(Ns);else{if(!(Ns in cs))return is.onUndefinedFunction(Ns);Ss=getSafeProperty(cs,Ns)}if(typeof Ss=="function")return Ss;throw new TypeError("'".concat(Ns,`' is not a function; its value is:
  `).concat(as(Ss)))};if(xs){var ws=this.args;return function(Es,Ss,Ds){return As(Es)(ws,cs,createSubScope(Es,Ss),Es)}}switch(ds.length){case 0:return function(Es,Ss,Ds){return As(Es)()};case 1:return function(Es,Ss,Ds){return As(Es)((0,ds[0])(Es,Ss,Ds))};case 2:return function(Es,Ss,Ds){var Vs=As(Es),Is=ds[0],Os=ds[1];return Vs(Is(Es,Ss,Ds),Os(Es,Ss,Ds))};default:return function(Es,Ss,Ds){return As(Es)(...ds.map(Vs=>Vs(Es,Ss,Ds)))}}},is.prototype.forEach=function(cs){cs(this.fn,"fn",this);for(var ps=0;ps<this.args.length;ps++)cs(this.args[ps],"args["+ps+"]",this)},is.prototype.map=function(cs){for(var ps=this._ifNode(cs(this.fn,"fn",this)),ds=[],fs=0;fs<this.args.length;fs++)ds[fs]=this._ifNode(cs(this.args[fs],"args["+fs+"]",this));return new is(ps,ds)},is.prototype.clone=function(){return new is(this.fn,this.args.slice(0))},is.onUndefinedFunction=function(cs){throw new Error("Undefined function "+cs)};var os=is.prototype.toString;function ls(cs,ps,ds){for(var fs,hs="",ys=/\$(?:\{([a-z_][a-z_0-9]*)(?:\[([0-9]+)\])?\}|\$)/gi,gs=0;(fs=ys.exec(cs))!==null;)if(hs+=cs.substring(gs,fs.index),gs=fs.index,fs[0]==="$$")hs+="$",gs++;else{gs+=fs[0].length;var bs=ps[fs[1]];if(!bs)throw new ReferenceError("Template: Property "+fs[1]+" does not exist.");if(fs[2]===void 0)switch(typeof bs){case"string":hs+=bs;break;case"object":if(isNode$1(bs))hs+=bs.toTex(ds);else{if(!Array.isArray(bs))throw new TypeError("Template: "+fs[1]+" has to be a Node, String or array of Nodes");hs+=bs.map(function(vs,Ns){if(isNode$1(vs))return vs.toTex(ds);throw new TypeError("Template: "+fs[1]+"["+Ns+"] is not a Node.")}).join(",")}break;default:throw new TypeError("Template: "+fs[1]+" has to be a Node, String or array of Nodes")}else{if(!isNode$1(bs[fs[2]]&&bs[fs[2]]))throw new TypeError("Template: "+fs[1]+"["+fs[2]+"] is not a Node.");hs+=bs[fs[2]].toTex(ds)}}return hs+=cs.slice(gs)}is.prototype.toString=function(cs){var ps,ds=this.fn.toString(cs);return cs&&typeof cs.handler=="object"&&hasOwnProperty$2(cs.handler,ds)&&(ps=cs.handler[ds](this,cs)),ps!==void 0?ps:os.call(this,cs)},is.prototype._toString=function(cs){var ps=this.args.map(function(ds){return ds.toString(cs)});return(isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(cs)+")":this.fn.toString(cs))+"("+ps.join(", ")+")"},is.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},is.fromJSON=function(cs){return new is(cs.fn,cs.args)},is.prototype.toHTML=function(cs){var ps=this.args.map(function(ds){return ds.toHTML(cs)});return'<span class="math-function">'+escape$1(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+ps.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};var us=is.prototype.toTex;return is.prototype.toTex=function(cs){var ps;return cs&&typeof cs.handler=="object"&&hasOwnProperty$2(cs.handler,this.name)&&(ps=cs.handler[this.name](this,cs)),ps!==void 0?ps:us.call(this,cs)},is.prototype._toTex=function(cs){var ps,ds,fs=this.args.map(function(hs){return hs.toTex(cs)});switch(latexFunctions[this.name]&&(ps=latexFunctions[this.name]),!ts[this.name]||typeof ts[this.name].toTex!="function"&&typeof ts[this.name].toTex!="object"&&typeof ts[this.name].toTex!="string"||(ps=ts[this.name].toTex),typeof ps){case"function":ds=ps(this,cs);break;case"string":ds=ls(ps,this,cs);break;case"object":switch(typeof ps[fs.length]){case"function":ds=ps[fs.length](this,cs);break;case"string":ds=ls(ps[fs.length],this,cs)}}return ds!==void 0?ds:ls(defaultTemplate,this,cs)},is.prototype.getIdentifier=function(){return this.type+":"+this.name},is},{isClass:!0,isNode:!0}),name$1e="parse",dependencies$1e=["typed","numeric","config","AccessorNode","ArrayNode","AssignmentNode","BlockNode","ConditionalNode","ConstantNode","FunctionAssignmentNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","RangeNode","RelationalNode","SymbolNode"],createParse=factory(name$1e,dependencies$1e,ss=>{var{typed:ts,numeric:rs,config:ns,AccessorNode:is,ArrayNode:as,AssignmentNode:os,BlockNode:ls,ConditionalNode:us,ConstantNode:cs,FunctionAssignmentNode:ps,FunctionNode:ds,IndexNode:fs,ObjectNode:hs,OperatorNode:ys,ParenthesisNode:gs,RangeNode:bs,RelationalNode:vs,SymbolNode:Ns}=ss,Ts=ts(name$1e,{string:function(Fs){return Bs(Fs,{})},"Array | Matrix":function(Fs){return Cs(Fs,{})},"string, Object":function(Fs,Qs){return Bs(Fs,Qs.nodes!==void 0?Qs.nodes:{})},"Array | Matrix, Object":Cs});function Cs(Fs){var Qs=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Js=Qs.nodes!==void 0?Qs.nodes:{};return deepMap(Fs,function(ul){if(typeof ul!="string")throw new TypeError("String expected");return Bs(ul,Js)})}var xs={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},As={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},ws={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},Es={true:!0,false:!1,null:null,undefined:void 0},Ss=["NaN","Infinity"];function Ds(Fs,Qs){return Fs.expression.substr(Fs.index,Qs)}function Vs(Fs){return Ds(Fs,1)}function Is(Fs){Fs.index++}function Os(Fs){return Fs.expression.charAt(Fs.index-1)}function Ps(Fs){return Fs.expression.charAt(Fs.index+1)}function $s(Fs){for(Fs.tokenType=xs.NULL,Fs.token="",Fs.comment="";;){if(Vs(Fs)==="#")for(;Vs(Fs)!==`
`&&Vs(Fs)!=="";)Fs.comment+=Vs(Fs),Is(Fs);if(!Ts.isWhitespace(Vs(Fs),Fs.nestingLevel))break;Is(Fs)}if(Vs(Fs)!==""){if(Vs(Fs)===`
`&&!Fs.nestingLevel)return Fs.tokenType=xs.DELIMITER,Fs.token=Vs(Fs),void Is(Fs);var Qs=Vs(Fs),Js=Ds(Fs,2),ul=Ds(Fs,3);if(ul.length===3&&As[ul])return Fs.tokenType=xs.DELIMITER,Fs.token=ul,Is(Fs),Is(Fs),void Is(Fs);if(Js.length===2&&As[Js])return Fs.tokenType=xs.DELIMITER,Fs.token=Js,Is(Fs),void Is(Fs);if(As[Qs])return Fs.tokenType=xs.DELIMITER,Fs.token=Qs,void Is(Fs);if(Ts.isDigitDot(Qs)){Fs.tokenType=xs.NUMBER;var pl=Ds(Fs,2);if(pl==="0b"||pl==="0o"||pl==="0x"){for(Fs.token+=Vs(Fs),Is(Fs),Fs.token+=Vs(Fs),Is(Fs);Ts.isHexDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);if(Vs(Fs)===".")for(Fs.token+=".",Is(Fs);Ts.isHexDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);else if(Vs(Fs)==="i")for(Fs.token+="i",Is(Fs);Ts.isDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);return}if(Vs(Fs)==="."){if(Fs.token+=Vs(Fs),Is(Fs),!Ts.isDigit(Vs(Fs)))return void(Fs.tokenType=xs.DELIMITER)}else{for(;Ts.isDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);Ts.isDecimalMark(Vs(Fs),Ps(Fs))&&(Fs.token+=Vs(Fs),Is(Fs))}for(;Ts.isDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);if(Vs(Fs)==="E"||Vs(Fs)==="e"){if(Ts.isDigit(Ps(Fs))||Ps(Fs)==="-"||Ps(Fs)==="+"){if(Fs.token+=Vs(Fs),Is(Fs),Vs(Fs)!=="+"&&Vs(Fs)!=="-"||(Fs.token+=Vs(Fs),Is(Fs)),!Ts.isDigit(Vs(Fs)))throw Ks(Fs,'Digit expected, got "'+Vs(Fs)+'"');for(;Ts.isDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);if(Ts.isDecimalMark(Vs(Fs),Ps(Fs)))throw Ks(Fs,'Digit expected, got "'+Vs(Fs)+'"')}else if(Ps(Fs)===".")throw Is(Fs),Ks(Fs,'Digit expected, got "'+Vs(Fs)+'"')}}else{if(!Ts.isAlpha(Vs(Fs),Os(Fs),Ps(Fs))){for(Fs.tokenType=xs.UNKNOWN;Vs(Fs)!=="";)Fs.token+=Vs(Fs),Is(Fs);throw Ks(Fs,'Syntax error in part "'+Fs.token+'"')}for(;Ts.isAlpha(Vs(Fs),Os(Fs),Ps(Fs))||Ts.isDigit(Vs(Fs));)Fs.token+=Vs(Fs),Is(Fs);hasOwnProperty$2(ws,Fs.token)?Fs.tokenType=xs.DELIMITER:Fs.tokenType=xs.SYMBOL}}else Fs.tokenType=xs.DELIMITER}function Rs(Fs){do $s(Fs);while(Fs.token===`
`)}function ks(Fs){Fs.nestingLevel++}function _s(Fs){Fs.nestingLevel--}function Bs(Fs,Qs){var Js={extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:xs.NULL,nestingLevel:0,conditionalLevel:null};_extends$1(Js,{expression:Fs,extraNodes:Qs}),$s(Js);var ul=function(pl){var ml,fl,hl=[];for(pl.token!==""&&pl.token!==`
`&&pl.token!==";"&&((ml=Us(pl)).comment=pl.comment);pl.token===`
`||pl.token===";";)hl.length===0&&ml&&(fl=pl.token!==";",hl.push({node:ml,visible:fl})),$s(pl),pl.token!==`
`&&pl.token!==";"&&pl.token!==""&&((ml=Us(pl)).comment=pl.comment,fl=pl.token!==";",hl.push({node:ml,visible:fl}));return hl.length>0?new ls(hl):(ml||((ml=new cs(void 0)).comment=pl.comment),ml)}(Js);if(Js.token!=="")throw Js.tokenType===xs.DELIMITER?ol(Js,"Unexpected operator "+Js.token):Ks(Js,'Unexpected part "'+Js.token+'"');return ul}function Us(Fs){var Qs,Js,ul,pl,ml=function(fl){for(var hl=function(gl){for(var vl=zs(gl);gl.token==="or";)Rs(gl),vl=new ys("or","or",[vl,zs(gl)]);return vl}(fl);fl.token==="?";){var yl=fl.conditionalLevel;fl.conditionalLevel=fl.nestingLevel,Rs(fl);var bl=hl,Tl=Us(fl);if(fl.token!==":")throw Ks(fl,"False part of conditional expression expected");fl.conditionalLevel=null,Rs(fl);var Nl=Us(fl);hl=new us(bl,Tl,Nl),fl.conditionalLevel=yl}return hl}(Fs);if(Fs.token==="="){if(isSymbolNode(ml))return Qs=ml.name,Rs(Fs),ul=Us(Fs),new os(new Ns(Qs),ul);if(isAccessorNode(ml))return Rs(Fs),ul=Us(Fs),new os(ml.object,ml.index,ul);if(isFunctionNode(ml)&&isSymbolNode(ml.fn)&&(pl=!0,Js=[],Qs=ml.name,ml.args.forEach(function(fl,hl){isSymbolNode(fl)?Js[hl]=fl.name:pl=!1}),pl))return Rs(Fs),ul=Us(Fs),new ps(Qs,Js,ul);throw Ks(Fs,"Invalid left hand side of assignment operator =")}return ml}function zs(Fs){for(var Qs=Hs(Fs);Fs.token==="xor";)Rs(Fs),Qs=new ys("xor","xor",[Qs,Hs(Fs)]);return Qs}function Hs(Fs){for(var Qs=el(Fs);Fs.token==="and";)Rs(Fs),Qs=new ys("and","and",[Qs,el(Fs)]);return Qs}function el(Fs){for(var Qs=Ys(Fs);Fs.token==="|";)Rs(Fs),Qs=new ys("|","bitOr",[Qs,Ys(Fs)]);return Qs}function Ys(Fs){for(var Qs=il(Fs);Fs.token==="^|";)Rs(Fs),Qs=new ys("^|","bitXor",[Qs,il(Fs)]);return Qs}function il(Fs){for(var Qs=al(Fs);Fs.token==="&";)Rs(Fs),Qs=new ys("&","bitAnd",[Qs,al(Fs)]);return Qs}function al(Fs){for(var Qs=[ll(Fs)],Js=[],ul={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};hasOwnProperty$2(ul,Fs.token);){var pl={name:Fs.token,fn:ul[Fs.token]};Js.push(pl),Rs(Fs),Qs.push(ll(Fs))}return Qs.length===1?Qs[0]:Qs.length===2?new ys(Js[0].name,Js[0].fn,Qs):new vs(Js.map(ml=>ml.fn),Qs)}function ll(Fs){var Qs,Js,ul,pl;Qs=nl(Fs);for(var ml={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};hasOwnProperty$2(ml,Fs.token);)ul=ml[Js=Fs.token],Rs(Fs),pl=[Qs,nl(Fs)],Qs=new ys(Js,ul,pl);return Qs}function nl(Fs){var Qs,Js,ul,pl;Qs=cl(Fs);for(var ml={to:"to",in:"to"};hasOwnProperty$2(ml,Fs.token);)ul=ml[Js=Fs.token],Rs(Fs),Js==="in"&&Fs.token===""?Qs=new ys("*","multiply",[Qs,new Ns("in")],!0):(pl=[Qs,cl(Fs)],Qs=new ys(Js,ul,pl));return Qs}function cl(Fs){var Qs,Js=[];if(Qs=Fs.token===":"?new cs(1):dl(Fs),Fs.token===":"&&Fs.conditionalLevel!==Fs.nestingLevel){for(Js.push(Qs);Fs.token===":"&&Js.length<3;)Rs(Fs),Fs.token===")"||Fs.token==="]"||Fs.token===","||Fs.token===""?Js.push(new Ns("end")):Js.push(dl(Fs));Qs=Js.length===3?new bs(Js[0],Js[2],Js[1]):new bs(Js[0],Js[1])}return Qs}function dl(Fs){var Qs,Js,ul,pl;Qs=sl(Fs);for(var ml={"+":"add","-":"subtract"};hasOwnProperty$2(ml,Fs.token);){ul=ml[Js=Fs.token],Rs(Fs);var fl=sl(Fs);pl=fl.isPercentage?[Qs,new ys("*","multiply",[Qs,fl])]:[Qs,fl],Qs=new ys(Js,ul,pl)}return Qs}function sl(Fs){var Qs,Js,ul,pl;Js=Qs=js(Fs);for(var ml={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide"};hasOwnProperty$2(ml,Fs.token);)pl=ml[ul=Fs.token],Rs(Fs),Js=js(Fs),Qs=new ys(ul,pl,[Qs,Js]);return Qs}function js(Fs){var Qs,Js;for(Js=Qs=Ls(Fs);Fs.tokenType===xs.SYMBOL||Fs.token==="in"&&isConstantNode(Qs)||!(Fs.tokenType!==xs.NUMBER||isConstantNode(Js)||isOperatorNode(Js)&&Js.op!=="!")||Fs.token==="(";)Js=Ls(Fs),Qs=new ys("*","multiply",[Qs,Js],!0);return Qs}function Ls(Fs){for(var Qs=Ws(Fs),Js=Qs,ul=[];Fs.token==="/"&&isConstantNode(Js);){if(ul.push(_extends$1({},Fs)),Rs(Fs),Fs.tokenType!==xs.NUMBER){_extends$1(Fs,ul.pop());break}if(ul.push(_extends$1({},Fs)),Rs(Fs),Fs.tokenType!==xs.SYMBOL&&Fs.token!=="("){ul.pop(),_extends$1(Fs,ul.pop());break}_extends$1(Fs,ul.pop()),ul.pop(),Js=Ws(Fs),Qs=new ys("/","divide",[Qs,Js])}return Qs}function Ws(Fs){var Qs,Js,ul,pl;Qs=Zs(Fs);for(var ml={"%":"mod",mod:"mod"};hasOwnProperty$2(ml,Fs.token);)ul=ml[Js=Fs.token],Rs(Fs),Js==="%"&&Fs.tokenType===xs.DELIMITER&&Fs.token!=="("?Qs=new ys("/","divide",[Qs,new cs(100)],!1,!0):(pl=[Qs,Zs(Fs)],Qs=new ys(Js,ul,pl));return Qs}function Zs(Fs){var Qs,Js,ul,pl={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return hasOwnProperty$2(pl,Fs.token)?(ul=pl[Fs.token],Qs=Fs.token,Rs(Fs),Js=[Zs(Fs)],new ys(Qs,ul,Js)):function(ml){var fl,hl,yl,bl;return fl=function(Tl){var Nl,gl,vl;Nl=function(Sl){var jl=[];if(Sl.tokenType===xs.SYMBOL&&hasOwnProperty$2(Sl.extraNodes,Sl.token)){var du=Sl.extraNodes[Sl.token];if($s(Sl),Sl.token==="("){if(jl=[],ks(Sl),$s(Sl),Sl.token!==")")for(jl.push(Us(Sl));Sl.token===",";)$s(Sl),jl.push(Us(Sl));if(Sl.token!==")")throw Ks(Sl,"Parenthesis ) expected");_s(Sl),$s(Sl)}return new du(jl)}return function(Pl){var El;return Pl.tokenType===xs.SYMBOL||Pl.tokenType===xs.DELIMITER&&Pl.token in ws?(El=Pl.token,$s(Pl),tl(Pl,hasOwnProperty$2(Es,El)?new cs(Es[El]):Ss.indexOf(El)!==-1?new cs(rs(El,"number")):new Ns(El))):function(ql){var nu;return ql.token==='"'?(nu=rl(ql),tl(ql,new cs(nu))):function(Gl){var iu;return Gl.token==="'"?(iu=qs(Gl),tl(Gl,new cs(iu))):function(Al){var Wl,Fl,Hl,Jl;if(Al.token==="["){if(ks(Al),$s(Al),Al.token!=="]"){var au=Gs(Al);if(Al.token===";"){for(Hl=1,Fl=[au];Al.token===";";)$s(Al),Fl[Hl]=Gs(Al),Hl++;if(Al.token!=="]")throw Ks(Al,"End of matrix ] expected");_s(Al),$s(Al),Jl=Fl[0].items.length;for(var Kl=1;Kl<Hl;Kl++)if(Fl[Kl].items.length!==Jl)throw ol(Al,"Column dimensions mismatch ("+Fl[Kl].items.length+" !== "+Jl+")");Wl=new as(Fl)}else{if(Al.token!=="]")throw Ks(Al,"End of matrix ] expected");_s(Al),$s(Al),Wl=au}}else _s(Al),$s(Al),Wl=new as([]);return tl(Al,Wl)}return function(xl){if(xl.token==="{"){var Zl;ks(xl);var su={};do if($s(xl),xl.token!=="}"){if(xl.token==='"')Zl=rl(xl);else if(xl.token==="'")Zl=qs(xl);else{if(!(xl.tokenType===xs.SYMBOL||xl.tokenType===xs.DELIMITER&&xl.token in ws))throw Ks(xl,"Symbol or string expected as object key");Zl=xl.token,$s(xl)}if(xl.token!==":")throw Ks(xl,"Colon : expected after object key");$s(xl),su[Zl]=Us(xl)}while(xl.token===",");if(xl.token!=="}")throw Ks(xl,"Comma , or bracket } expected after object value");_s(xl),$s(xl);var ou=new hs(su);return ou=tl(xl,ou)}return function($l){var Cl;return $l.tokenType===xs.NUMBER?(Cl=$l.token,$s($l),new cs(rs(Cl,ns.number))):function(wl){var Dl;if(wl.token==="("){if(ks(wl),$s(wl),Dl=Us(wl),wl.token!==")")throw Ks(wl,"Parenthesis ) expected");return _s(wl),$s(wl),Dl=tl(wl,Dl=new gs(Dl))}return function(mu){throw mu.token===""?Ks(mu,"Unexpected end of expression"):Ks(mu,"Value expected")}(wl)}($l)}(xl)}(Al)}(Gl)}(ql)}(Pl)}(Sl)}(Tl);for(var Ml={"!":"factorial","'":"ctranspose"};hasOwnProperty$2(Ml,Tl.token);)vl=Ml[gl=Tl.token],$s(Tl),Nl=tl(Tl,Nl=new ys(gl,vl,[Nl]));return Nl}(ml),(ml.token==="^"||ml.token===".^")&&(yl=(hl=ml.token)==="^"?"pow":"dotPow",Rs(ml),bl=[fl,Zs(ml)],fl=new ys(hl,yl,bl)),fl}(Fs)}function tl(Fs,Qs,Js){for(var ul;!(Fs.token!=="("&&Fs.token!=="["&&Fs.token!=="."||Js&&Js.indexOf(Fs.token)===-1);)if(ul=[],Fs.token==="("){if(!isSymbolNode(Qs)&&!isAccessorNode(Qs))return Qs;if(ks(Fs),$s(Fs),Fs.token!==")")for(ul.push(Us(Fs));Fs.token===",";)$s(Fs),ul.push(Us(Fs));if(Fs.token!==")")throw Ks(Fs,"Parenthesis ) expected");_s(Fs),$s(Fs),Qs=new ds(Qs,ul)}else if(Fs.token==="["){if(ks(Fs),$s(Fs),Fs.token!=="]")for(ul.push(Us(Fs));Fs.token===",";)$s(Fs),ul.push(Us(Fs));if(Fs.token!=="]")throw Ks(Fs,"Parenthesis ] expected");_s(Fs),$s(Fs),Qs=new is(Qs,new fs(ul))}else{if($s(Fs),Fs.tokenType!==xs.SYMBOL)throw Ks(Fs,"Property name expected after dot");ul.push(new cs(Fs.token)),$s(Fs),Qs=new is(Qs,new fs(ul,!0))}return Qs}function rl(Fs){for(var Qs="";Vs(Fs)!==""&&Vs(Fs)!=='"';)Vs(Fs)==="\\"&&(Qs+=Vs(Fs),Is(Fs)),Qs+=Vs(Fs),Is(Fs);if($s(Fs),Fs.token!=='"')throw Ks(Fs,'End of string " expected');return $s(Fs),JSON.parse('"'+Qs+'"')}function qs(Fs){for(var Qs="";Vs(Fs)!==""&&Vs(Fs)!=="'";)Vs(Fs)==="\\"&&(Qs+=Vs(Fs),Is(Fs)),Qs+=Vs(Fs),Is(Fs);if($s(Fs),Fs.token!=="'")throw Ks(Fs,"End of string ' expected");return $s(Fs),JSON.parse('"'+Qs+'"')}function Gs(Fs){for(var Qs=[Us(Fs)],Js=1;Fs.token===",";)$s(Fs),Qs[Js]=Us(Fs),Js++;return new as(Qs)}function Xs(Fs){return Fs.index-Fs.token.length+1}function Ks(Fs,Qs){var Js=Xs(Fs),ul=new SyntaxError(Qs+" (char "+Js+")");return ul.char=Js,ul}function ol(Fs,Qs){var Js=Xs(Fs),ul=new SyntaxError(Qs+" (char "+Js+")");return ul.char=Js,ul}return Ts.isAlpha=function(Fs,Qs,Js){return Ts.isValidLatinOrGreek(Fs)||Ts.isValidMathSymbol(Fs,Js)||Ts.isValidMathSymbol(Qs,Fs)},Ts.isValidLatinOrGreek=function(Fs){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(Fs)},Ts.isValidMathSymbol=function(Fs,Qs){return/^[\uD835]$/.test(Fs)&&/^[\uDC00-\uDFFF]$/.test(Qs)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(Qs)},Ts.isWhitespace=function(Fs,Qs){return Fs===" "||Fs==="	"||Fs===`
`&&Qs>0},Ts.isDecimalMark=function(Fs,Qs){return Fs==="."&&Qs!=="/"&&Qs!=="*"&&Qs!=="^"},Ts.isDigitDot=function(Fs){return Fs>="0"&&Fs<="9"||Fs==="."},Ts.isDigit=function(Fs){return Fs>="0"&&Fs<="9"},Ts.isHexDigit=function(Fs){return Fs>="0"&&Fs<="9"||Fs>="a"&&Fs<="f"||Fs>="A"&&Fs<="F"},Ts}),name$1d="compile",dependencies$1d=["typed","parse"],createCompile=factory(name$1d,dependencies$1d,ss=>{var{typed:ts,parse:rs}=ss;return ts(name$1d,{string:function(ns){return rs(ns).compile()},"Array | Matrix":function(ns){return deepMap(ns,function(is){return rs(is).compile()})}})}),name$1c="evaluate",dependencies$1c=["typed","parse"],createEvaluate=factory(name$1c,dependencies$1c,ss=>{var{typed:ts,parse:rs}=ss;return ts(name$1c,{string:function(ns){var is=createEmptyMap();return rs(ns).compile().evaluate(is)},"string, Map | Object":function(ns,is){return rs(ns).compile().evaluate(is)},"Array | Matrix":function(ns){var is=createEmptyMap();return deepMap(ns,function(as){return rs(as).compile().evaluate(is)})},"Array | Matrix, Map | Object":function(ns,is){return deepMap(ns,function(as){return rs(as).compile().evaluate(is)})}})}),name$1b="Parser",dependencies$1b=["evaluate"],createParserClass=factory(name$1b,dependencies$1b,ss=>{var{evaluate:ts}=ss;function rs(){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");Object.defineProperty(this,"scope",{value:createEmptyMap(),writable:!1})}return rs.prototype.type="Parser",rs.prototype.isParser=!0,rs.prototype.evaluate=function(ns){return ts(ns,this.scope)},rs.prototype.get=function(ns){if(this.scope.has(ns))return this.scope.get(ns)},rs.prototype.getAll=function(){return toObject(this.scope)},rs.prototype.getAllAsMap=function(){return this.scope},rs.prototype.set=function(ns,is){return this.scope.set(ns,is),is},rs.prototype.remove=function(ns){this.scope.delete(ns)},rs.prototype.clear=function(){this.scope.clear()},rs},{isClass:!0}),name$1a="parser",dependencies$1a=["typed","Parser"],createParser=factory(name$1a,dependencies$1a,ss=>{var{typed:ts,Parser:rs}=ss;return ts(name$1a,{"":function(){return new rs}})}),name$19="lup",dependencies$19=["typed","matrix","abs","addScalar","divideScalar","multiplyScalar","subtract","larger","equalScalar","unaryMinus","DenseMatrix","SparseMatrix","Spa"],createLup=factory(name$19,dependencies$19,ss=>{var{typed:ts,matrix:rs,abs:ns,addScalar:is,divideScalar:as,multiplyScalar:os,subtract:ls,larger:us,equalScalar:cs,unaryMinus:ps,DenseMatrix:ds,SparseMatrix:fs,Spa:hs}=ss;return ts(name$19,{DenseMatrix:function(bs){return ys(bs)},SparseMatrix:function(bs){return gs(bs)},Array:function(bs){var vs=ys(rs(bs));return{L:vs.L.valueOf(),U:vs.U.valueOf(),p:vs.p}}});function ys(bs){var vs,Ns,Ts,Cs=bs._size[0],xs=bs._size[1],As=Math.min(Cs,xs),ws=clone$3(bs._data),Es=[],Ss=[Cs,As],Ds=[],Vs=[As,xs],Is=[];for(vs=0;vs<Cs;vs++)Is[vs]=vs;for(Ns=0;Ns<xs;Ns++){if(Ns>0)for(vs=0;vs<Cs;vs++){var Os=Math.min(vs,Ns),Ps=0;for(Ts=0;Ts<Os;Ts++)Ps=is(Ps,os(ws[vs][Ts],ws[Ts][Ns]));ws[vs][Ns]=ls(ws[vs][Ns],Ps)}var $s=Ns,Rs=0,ks=0;for(vs=Ns;vs<Cs;vs++){var _s=ws[vs][Ns],Bs=ns(_s);us(Bs,Rs)&&($s=vs,Rs=Bs,ks=_s)}if(Ns!==$s&&(Is[Ns]=[Is[$s],Is[$s]=Is[Ns]][0],ds._swapRows(Ns,$s,ws)),Ns<Cs)for(vs=Ns+1;vs<Cs;vs++){var Us=ws[vs][Ns];cs(Us,0)||(ws[vs][Ns]=as(ws[vs][Ns],ks))}}for(Ns=0;Ns<xs;Ns++)for(vs=0;vs<Cs;vs++)Ns===0&&(vs<xs&&(Ds[vs]=[]),Es[vs]=[]),vs<Ns?(vs<xs&&(Ds[vs][Ns]=ws[vs][Ns]),Ns<Cs&&(Es[vs][Ns]=0)):vs!==Ns?(vs<xs&&(Ds[vs][Ns]=0),Ns<Cs&&(Es[vs][Ns]=ws[vs][Ns])):(vs<xs&&(Ds[vs][Ns]=ws[vs][Ns]),Ns<Cs&&(Es[vs][Ns]=1));var zs=new ds({data:Es,size:Ss}),Hs=new ds({data:Ds,size:Vs}),el=[];for(vs=0,As=Is.length;vs<As;vs++)el[Is[vs]]=vs;return{L:zs,U:Hs,p:el,toString:function(){return"L: "+this.L.toString()+`
U: `+this.U.toString()+`
P: `+this.p}}}function gs(bs){var vs,Ns,Ts,Cs=bs._size[0],xs=bs._size[1],As=Math.min(Cs,xs),ws=bs._values,Es=bs._index,Ss=bs._ptr,Ds=[],Vs=[],Is=[],Os=[Cs,As],Ps=[],$s=[],Rs=[],ks=[As,xs],_s=[],Bs=[];for(vs=0;vs<Cs;vs++)_s[vs]=vs,Bs[vs]=vs;var Us=function(){var zs=new hs;Ns<Cs&&(Is.push(Ds.length),Ds.push(1),Vs.push(Ns)),Rs.push(Ps.length);var Hs=Ss[Ns],el=Ss[Ns+1];for(Ts=Hs;Ts<el;Ts++)vs=Es[Ts],zs.set(_s[vs],ws[Ts]);Ns>0&&zs.forEach(0,Ns-1,function(ll,nl){fs._forEachRow(ll,Ds,Vs,Is,function(cl,dl){cl>ll&&zs.accumulate(cl,ps(os(dl,nl)))})});var Ys=Ns,il=zs.get(Ns),al=ns(il);zs.forEach(Ns+1,Cs-1,function(ll,nl){var cl=ns(nl);us(cl,al)&&(Ys=ll,al=cl,il=nl)}),Ns!==Ys&&(fs._swapRows(Ns,Ys,Os[1],Ds,Vs,Is),fs._swapRows(Ns,Ys,ks[1],Ps,$s,Rs),zs.swap(Ns,Ys),function(ll,nl){var cl=Bs[ll],dl=Bs[nl];_s[cl]=nl,_s[dl]=ll,Bs[ll]=dl,Bs[nl]=cl}(Ns,Ys)),zs.forEach(0,Cs-1,function(ll,nl){ll<=Ns?(Ps.push(nl),$s.push(ll)):(nl=as(nl,il),cs(nl,0)||(Ds.push(nl),Vs.push(ll)))})};for(Ns=0;Ns<xs;Ns++)Us();return Rs.push(Ps.length),Is.push(Ds.length),{L:new fs({values:Ds,index:Vs,ptr:Is,size:Os}),U:new fs({values:Ps,index:$s,ptr:Rs,size:ks}),p:_s,toString:function(){return"L: "+this.L.toString()+`
U: `+this.U.toString()+`
P: `+this.p}}}}),name$18="qr",dependencies$18=["typed","matrix","zeros","identity","isZero","equal","sign","sqrt","conj","unaryMinus","addScalar","divideScalar","multiplyScalar","subtract","complex"],createQr=factory(name$18,dependencies$18,ss=>{var{typed:ts,matrix:rs,zeros:ns,identity:is,isZero:as,equal:os,sign:ls,sqrt:us,conj:cs,unaryMinus:ps,addScalar:ds,divideScalar:fs,multiplyScalar:hs,subtract:ys,complex:gs}=ss;return _extends$1(ts(name$18,{DenseMatrix:function(Ns){return vs(Ns)},SparseMatrix:function(Ns){return function(Ts){throw new Error("qr not implemented for sparse matrices yet")}()},Array:function(Ns){var Ts=vs(rs(Ns));return{Q:Ts.Q.valueOf(),R:Ts.R.valueOf()}}}),{_denseQRimpl:bs});function bs(Ns){var Ts,Cs,xs,As=Ns._size[0],ws=Ns._size[1],Es=is([As],"dense"),Ss=Es._data,Ds=Ns.clone(),Vs=Ds._data,Is=ns([As],"");for(xs=0;xs<Math.min(ws,As);++xs){var Os=Vs[xs][xs],Ps=ps(os(Os,0)?1:ls(Os)),$s=cs(Ps),Rs=0;for(Ts=xs;Ts<As;Ts++)Rs=ds(Rs,hs(Vs[Ts][xs],cs(Vs[Ts][xs])));var ks=hs(Ps,us(Rs));if(!as(ks)){var _s=ys(Os,ks);for(Is[xs]=1,Ts=xs+1;Ts<As;Ts++)Is[Ts]=fs(Vs[Ts][xs],_s);var Bs=ps(cs(fs(_s,ks))),Us=void 0;for(Cs=xs;Cs<ws;Cs++){for(Us=0,Ts=xs;Ts<As;Ts++)Us=ds(Us,hs(cs(Is[Ts]),Vs[Ts][Cs]));for(Us=hs(Us,Bs),Ts=xs;Ts<As;Ts++)Vs[Ts][Cs]=hs(ys(Vs[Ts][Cs],hs(Is[Ts],Us)),$s)}for(Ts=0;Ts<As;Ts++){for(Us=0,Cs=xs;Cs<As;Cs++)Us=ds(Us,hs(Ss[Ts][Cs],Is[Cs]));for(Us=hs(Us,Bs),Cs=xs;Cs<As;++Cs)Ss[Ts][Cs]=fs(ys(Ss[Ts][Cs],hs(Us,cs(Is[Cs]))),$s)}}}return{Q:Es,R:Ds,toString:function(){return"Q: "+this.Q.toString()+`
R: `+this.R.toString()}}}function vs(Ns){var Ts=bs(Ns),Cs=Ts.R._data;if(Ns._data.length>0)for(var xs=Cs[0][0].type==="Complex"?gs(0):0,As=0;As<Cs.length;++As)for(var ws=0;ws<As&&ws<(Cs[0]||[]).length;++ws)Cs[As][ws]=xs;return Ts}});function csPermute(ss,ts,rs,ns){for(var is=ss._values,as=ss._index,os=ss._ptr,ls=ss._size,us=ss._datatype,cs=ls[0],ps=ls[1],ds=ns&&ss._values?[]:null,fs=[],hs=[],ys=0,gs=0;gs<ps;gs++){hs[gs]=ys;for(var bs=rs?rs[gs]:gs,vs=os[bs],Ns=os[bs+1],Ts=vs;Ts<Ns;Ts++){var Cs=ts?ts[as[Ts]]:as[Ts];fs[ys]=Cs,ds&&(ds[ys]=is[Ts]),ys++}}return hs[ps]=ys,ss.createSparseMatrix({values:ds,index:fs,ptr:hs,size:[cs,ps],datatype:us})}function csTdfs(ss,ts,rs,ns,is,as,os){var ls=0;for(rs[os]=ss;ls>=0;){var us=rs[os+ls],cs=rs[ns+us];cs===-1?(ls--,as[ts++]=us):(rs[ns+us]=rs[is+cs],rs[os+ ++ls]=cs)}return ts}function csPost(ss,ts){if(!ss)return null;var rs,ns=0,is=[],as=[],os=ts,ls=2*ts;for(rs=0;rs<ts;rs++)as[0+rs]=-1;for(rs=ts-1;rs>=0;rs--)ss[rs]!==-1&&(as[os+rs]=as[0+ss[rs]],as[0+ss[rs]]=rs);for(rs=0;rs<ts;rs++)ss[rs]===-1&&(ns=csTdfs(rs,ns,as,0,os,is,ls));return is}function csEtree(ss,ts){if(!ss)return null;var rs,ns,is=ss._index,as=ss._ptr,os=ss._size,ls=os[0],us=os[1],cs=[],ps=[],ds=us;if(ts)for(rs=0;rs<ls;rs++)ps[ds+rs]=-1;for(var fs=0;fs<us;fs++){cs[fs]=-1,ps[0+fs]=-1;for(var hs=as[fs],ys=as[fs+1],gs=hs;gs<ys;gs++){var bs=is[gs];for(rs=ts?ps[ds+bs]:bs;rs!==-1&&rs<fs;rs=ns)ns=ps[0+rs],ps[0+rs]=fs,ns===-1&&(cs[rs]=fs);ts&&(ps[ds+bs]=fs)}}return cs}function csFkeep(ss,ts,rs){for(var ns=ss._values,is=ss._index,as=ss._ptr,os=ss._size[1],ls=0,us=0;us<os;us++){var cs=as[us];for(as[us]=ls;cs<as[us+1];cs++)ts(is[cs],us,ns?ns[cs]:1,rs)&&(is[ls]=is[cs],ns&&(ns[ls]=ns[cs]),ls++)}return as[os]=ls,is.splice(ls,is.length-ls),ns&&ns.splice(ls,ns.length-ls),ls}function csFlip(ss){return-ss-2}var name$17="csAmd",dependencies$17=["add","multiply","transpose"],createCsAmd=factory(name$17,dependencies$17,ss=>{var{add:ts,multiply:rs,transpose:ns}=ss;return function(os,ls){if(!ls||os<=0||os>3)return null;var us=ls._size,cs=us[0],ps=us[1],ds=0,fs=Math.max(16,10*Math.sqrt(ps)),hs=function(Fs,Qs,Js,ul,pl){var ml=ns(Qs);if(Fs===1&&ul===Js)return ts(Qs,ml);if(Fs===2){for(var fl=ml._index,hl=ml._ptr,yl=0,bl=0;bl<Js;bl++){var Tl=hl[bl];if(hl[bl]=yl,!(hl[bl+1]-Tl>pl))for(var Nl=hl[bl+1];Tl<Nl;Tl++)fl[yl++]=fl[Tl]}return hl[Js]=yl,Qs=ns(ml),rs(ml,Qs)}return rs(ml,Qs)}(os,ls,cs,ps,fs=Math.min(ps-2,fs));csFkeep(hs,as,null);for(var ys,gs,bs,vs,Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds,Vs,Is,Os,Ps=hs._index,$s=hs._ptr,Rs=$s[ps],ks=[],_s=[],Bs=ps+1,Us=2*(ps+1),zs=3*(ps+1),Hs=4*(ps+1),el=5*(ps+1),Ys=6*(ps+1),il=7*(ps+1),al=ks,ll=function(Fs,Qs,Js,ul,pl,ml,fl,hl,yl,bl,Tl,Nl){for(var gl=0;gl<Fs;gl++)Js[ul+gl]=Qs[gl+1]-Qs[gl];Js[ul+Fs]=0;for(var vl=0;vl<=Fs;vl++)Js[pl+vl]=-1,ml[vl]=-1,Js[fl+vl]=-1,Js[hl+vl]=-1,Js[yl+vl]=1,Js[bl+vl]=1,Js[Tl+vl]=0,Js[Nl+vl]=Js[ul+vl];var Ml=is(0,0,Js,bl,Fs);return Js[Tl+Fs]=-2,Qs[Fs]=-1,Js[bl+Fs]=0,Ml}(ps,$s,_s,0,zs,al,Us,il,Bs,Ys,Hs,el),nl=function(Fs,Qs,Js,ul,pl,ml,fl,hl,yl,bl,Tl){for(var Nl=0,gl=0;gl<Fs;gl++){var vl=Js[ul+gl];if(vl===0)Js[pl+gl]=-2,Nl++,Qs[gl]=-1,Js[ml+gl]=0;else if(vl>fl)Js[hl+gl]=0,Js[pl+gl]=-1,Nl++,Qs[gl]=csFlip(Fs),Js[hl+Fs]++;else{var Ml=Js[yl+vl];Ml!==-1&&(bl[Ml]=gl),Js[Tl+gl]=Js[yl+vl],Js[yl+vl]=gl}}return Nl}(ps,$s,_s,el,Hs,Ys,fs,Bs,zs,al,Us),cl=0;nl<ps;){for(bs=-1;cl<ps&&(bs=_s[zs+cl])===-1;cl++);_s[Us+bs]!==-1&&(al[_s[Us+bs]]=-1),_s[zs+cl]=_s[Us+bs];var dl=_s[Hs+bs],sl=_s[Bs+bs];nl+=sl;var js=0;_s[Bs+bs]=-sl;var Ls=$s[bs],Ws=dl===0?Ls:Rs,Zs=Ws;for(vs=1;vs<=dl+1;vs++){for(vs>dl?(Ts=bs,Cs=Ls,xs=_s[0+bs]-dl):(Cs=$s[Ts=Ps[Ls++]],xs=_s[0+Ts]),Ns=1;Ns<=xs;Ns++)(As=_s[Bs+(ys=Ps[Cs++])])<=0||(js+=As,_s[Bs+ys]=-As,Ps[Zs++]=ys,_s[Us+ys]!==-1&&(al[_s[Us+ys]]=al[ys]),al[ys]!==-1?_s[Us+al[ys]]=_s[Us+ys]:_s[zs+_s[el+ys]]=_s[Us+ys]);Ts!==bs&&($s[Ts]=csFlip(bs),_s[Ys+Ts]=0)}for(dl!==0&&(Rs=Zs),_s[el+bs]=js,$s[bs]=Ws,_s[0+bs]=Zs-Ws,_s[Hs+bs]=-2,ll=is(ll,ds,_s,Ys,ps),ws=Ws;ws<Zs;ws++)if(!((Es=_s[Hs+(ys=Ps[ws])])<=0)){var tl=ll-(As=-_s[Bs+ys]);for(Ls=$s[ys],Ss=$s[ys]+Es-1;Ls<=Ss;Ls++)_s[Ys+(Ts=Ps[Ls])]>=ll?_s[Ys+Ts]-=As:_s[Ys+Ts]!==0&&(_s[Ys+Ts]=_s[el+Ts]+tl)}for(ws=Ws;ws<Zs;ws++){for(Ds=(Ss=$s[ys=Ps[ws]])+_s[Hs+ys]-1,Vs=Ss,Is=0,Os=0,Ls=Ss;Ls<=Ds;Ls++)if(_s[Ys+(Ts=Ps[Ls])]!==0){var rl=_s[Ys+Ts]-ll;rl>0?(Os+=rl,Ps[Vs++]=Ts,Is+=Ts):($s[Ts]=csFlip(bs),_s[Ys+Ts]=0)}_s[Hs+ys]=Vs-Ss+1;var qs=Vs,Gs=Ss+_s[0+ys];for(Ls=Ds+1;Ls<Gs;Ls++){var Xs=_s[Bs+(gs=Ps[Ls])];Xs<=0||(Os+=Xs,Ps[Vs++]=gs,Is+=gs)}Os===0?($s[ys]=csFlip(bs),js-=As=-_s[Bs+ys],sl+=As,nl+=As,_s[Bs+ys]=0,_s[Hs+ys]=-1):(_s[el+ys]=Math.min(_s[el+ys],Os),Ps[Vs]=Ps[qs],Ps[qs]=Ps[Ss],Ps[Ss]=bs,_s[0+ys]=Vs-Ss+1,Is=(Is<0?-Is:Is)%ps,_s[Us+ys]=_s[il+Is],_s[il+Is]=ys,al[ys]=Is)}for(_s[el+bs]=js,ll=is(ll+(ds=Math.max(ds,js)),ds,_s,Ys,ps),ws=Ws;ws<Zs;ws++)if(!(_s[Bs+(ys=Ps[ws])]>=0))for(ys=_s[il+(Is=al[ys])],_s[il+Is]=-1;ys!==-1&&_s[Us+ys]!==-1;ys=_s[Us+ys],ll++){for(xs=_s[0+ys],Es=_s[Hs+ys],Ls=$s[ys]+1;Ls<=$s[ys]+xs-1;Ls++)_s[Ys+Ps[Ls]]=ll;var Ks=ys;for(gs=_s[Us+ys];gs!==-1;){var ol=_s[0+gs]===xs&&_s[Hs+gs]===Es;for(Ls=$s[gs]+1;ol&&Ls<=$s[gs]+xs-1;Ls++)_s[Ys+Ps[Ls]]!==ll&&(ol=0);ol?($s[gs]=csFlip(ys),_s[Bs+ys]+=_s[Bs+gs],_s[Bs+gs]=0,_s[Hs+gs]=-1,gs=_s[Us+gs],_s[Us+Ks]=gs):(Ks=gs,gs=_s[Us+gs])}}for(Ls=Ws,ws=Ws;ws<Zs;ws++)(As=-_s[Bs+(ys=Ps[ws])])<=0||(_s[Bs+ys]=As,Os=_s[el+ys]+js-As,_s[zs+(Os=Math.min(Os,ps-nl-As))]!==-1&&(al[_s[zs+Os]]=ys),_s[Us+ys]=_s[zs+Os],al[ys]=-1,_s[zs+Os]=ys,cl=Math.min(cl,Os),_s[el+ys]=Os,Ps[Ls++]=ys);_s[Bs+bs]=sl,(_s[0+bs]=Ls-Ws)==0&&($s[bs]=-1,_s[Ys+bs]=0),dl!==0&&(Rs=Ls)}for(ys=0;ys<ps;ys++)$s[ys]=csFlip($s[ys]);for(gs=0;gs<=ps;gs++)_s[zs+gs]=-1;for(gs=ps;gs>=0;gs--)_s[Bs+gs]>0||(_s[Us+gs]=_s[zs+$s[gs]],_s[zs+$s[gs]]=gs);for(Ts=ps;Ts>=0;Ts--)_s[Bs+Ts]<=0||$s[Ts]!==-1&&(_s[Us+Ts]=_s[zs+$s[Ts]],_s[zs+$s[Ts]]=Ts);for(bs=0,ys=0;ys<=ps;ys++)$s[ys]===-1&&(bs=csTdfs(ys,bs,_s,zs,Us,ks,Ys));return ks.splice(ks.length-1,1),ks};function is(os,ls,us,cs,ps){if(os<2||os+ls<0){for(var ds=0;ds<ps;ds++)us[cs+ds]!==0&&(us[cs+ds]=1);os=2}return os}function as(os,ls){return os!==ls}});function csLeaf(ss,ts,rs,ns,is,as,os){var ls,us,cs,ps=0;if(ss<=ts||rs[ns+ts]<=rs[is+ss])return-1;rs[is+ss]=rs[ns+ts];var ds=rs[as+ss];if(rs[as+ss]=ts,ds===-1)ps=1,cs=ss;else{for(ps=2,cs=ds;cs!==rs[os+cs];cs=rs[os+cs]);for(ls=ds;ls!==cs;ls=us)us=rs[os+ls],rs[os+ls]=cs}return{jleaf:ps,q:cs}}var name$16="csCounts",dependencies$16=["transpose"],createCsCounts=factory(name$16,dependencies$16,ss=>{var{transpose:ts}=ss;return function(rs,ns,is,as){if(!rs||!ns||!is)return null;var os,ls,us,cs,ps,ds,fs,hs=rs._size,ys=hs[0],gs=hs[1],bs=4*gs+(as?gs+ys+1:0),vs=[],Ns=gs,Ts=2*gs,Cs=3*gs,xs=4*gs,As=5*gs+1;for(us=0;us<bs;us++)vs[us]=-1;var ws=[],Es=ts(rs),Ss=Es._index,Ds=Es._ptr;for(us=0;us<gs;us++)for(ws[ls=is[us]]=vs[Cs+ls]===-1?1:0;ls!==-1&&vs[Cs+ls]===-1;ls=ns[ls])vs[Cs+ls]=us;if(as){for(us=0;us<gs;us++)vs[is[us]]=us;for(os=0;os<ys;os++){for(us=gs,ds=Ds[os],fs=Ds[os+1],ps=ds;ps<fs;ps++)us=Math.min(us,vs[Ss[ps]]);vs[As+os]=vs[xs+us],vs[xs+us]=os}}for(os=0;os<gs;os++)vs[0+os]=os;for(us=0;us<gs;us++){for(ns[ls=is[us]]!==-1&&ws[ns[ls]]--,cs=as?vs[xs+us]:ls;cs!==-1;cs=as?vs[As+cs]:-1)for(ps=Ds[cs];ps<Ds[cs+1];ps++){var Vs=csLeaf(os=Ss[ps],ls,vs,Cs,Ns,Ts,0);Vs.jleaf>=1&&ws[ls]++,Vs.jleaf===2&&ws[Vs.q]--}ns[ls]!==-1&&(vs[0+ls]=ns[ls])}for(ls=0;ls<gs;ls++)ns[ls]!==-1&&(ws[ns[ls]]+=ws[ls]);return ws}}),name$15="csSqr",dependencies$15=["add","multiply","transpose"],createCsSqr=factory(name$15,dependencies$15,ss=>{var{add:ts,multiply:rs,transpose:ns}=ss,is=createCsAmd({add:ts,multiply:rs,transpose:ns}),as=createCsCounts({transpose:ns});return function(os,ls,us){var cs,ps=ls._ptr,ds=ls._size[1],fs={};if(fs.q=is(os,ls),os&&!fs.q)return null;if(us){var hs=os?csPermute(ls,null,fs.q,0):ls;fs.parent=csEtree(hs,1);var ys=csPost(fs.parent,ds);if(fs.cp=as(hs,fs.parent,ys,1),hs&&fs.parent&&fs.cp&&function(gs,bs){var vs=gs._ptr,Ns=gs._index,Ts=gs._size,Cs=Ts[0],xs=Ts[1];bs.pinv=[],bs.leftmost=[];var As,ws,Es,Ss,Ds,Vs=bs.parent,Is=bs.pinv,Os=bs.leftmost,Ps=[],$s=0,Rs=Cs,ks=Cs+xs,_s=Cs+2*xs;for(ws=0;ws<xs;ws++)Ps[Rs+ws]=-1,Ps[ks+ws]=-1,Ps[_s+ws]=0;for(As=0;As<Cs;As++)Os[As]=-1;for(ws=xs-1;ws>=0;ws--)for(Ss=vs[ws],Ds=vs[ws+1],Es=Ss;Es<Ds;Es++)Os[Ns[Es]]=ws;for(As=Cs-1;As>=0;As--)Is[As]=-1,(ws=Os[As])!==-1&&(Ps[_s+ws]++==0&&(Ps[ks+ws]=As),Ps[$s+As]=Ps[Rs+ws],Ps[Rs+ws]=As);for(bs.lnz=0,bs.m2=Cs,ws=0;ws<xs;ws++)if(As=Ps[Rs+ws],bs.lnz++,As<0&&(As=bs.m2++),Is[As]=ws,!(--_s[ws]<=0)){bs.lnz+=Ps[_s+ws];var Bs=Vs[ws];Bs!==-1&&(Ps[_s+Bs]===0&&(Ps[ks+Bs]=Ps[ks+ws]),Ps[$s+Ps[ks+ws]]=Ps[Rs+Bs],Ps[Rs+Bs]=Ps[$s+As],Ps[_s+Bs]+=Ps[_s+ws])}for(As=0;As<Cs;As++)Is[As]<0&&(Is[As]=ws++);return!0}(hs,fs))for(fs.unz=0,cs=0;cs<ds;cs++)fs.unz+=fs.cp[cs]}else fs.unz=4*ps[ds]+ds,fs.lnz=fs.unz;return fs}});function csMarked(ss,ts){return ss[ts]<0}function csMark(ss,ts){ss[ts]=csFlip(ss[ts])}function csUnflip(ss){return ss<0?csFlip(ss):ss}function csDfs(ss,ts,rs,ns,is){var as,os,ls,us=ts._index,cs=ts._ptr,ps=ts._size[1],ds=0;for(ns[0]=ss;ds>=0;){ss=ns[ds];var fs=is?is[ss]:ss;csMarked(cs,ss)||(csMark(cs,ss),ns[ps+ds]=fs<0?0:csUnflip(cs[fs]));var hs=1;for(os=ns[ps+ds],ls=fs<0?0:csUnflip(cs[fs+1]);os<ls;os++)if(!csMarked(cs,as=us[os])){ns[ps+ds]=os,ns[++ds]=as,hs=0;break}hs&&(ds--,ns[--rs]=ss)}return rs}function csReach(ss,ts,rs,ns,is){var as,os,ls,us=ss._ptr,cs=ss._size,ps=ts._index,ds=ts._ptr,fs=cs[1],hs=fs;for(os=ds[rs],ls=ds[rs+1],as=os;as<ls;as++){var ys=ps[as];csMarked(us,ys)||(hs=csDfs(ys,ss,hs,ns,is))}for(as=hs;as<fs;as++)csMark(us,ns[as]);return hs}var name$14="csSpsolve",dependencies$14=["divideScalar","multiply","subtract"],createCsSpsolve=factory(name$14,dependencies$14,ss=>{var{divideScalar:ts,multiply:rs,subtract:ns}=ss;return function(is,as,os,ls,us,cs,ps){var ds,fs,hs,ys,gs=is._values,bs=is._index,vs=is._ptr,Ns=is._size[1],Ts=as._values,Cs=as._index,xs=as._ptr,As=csReach(is,as,os,ls,cs);for(ds=As;ds<Ns;ds++)us[ls[ds]]=0;for(fs=xs[os],hs=xs[os+1],ds=fs;ds<hs;ds++)us[Cs[ds]]=Ts[ds];for(var ws=As;ws<Ns;ws++){var Es=ls[ws],Ss=cs?cs[Es]:Es;if(!(Ss<0))for(fs=vs[Ss],hs=vs[Ss+1],us[Es]=ts(us[Es],gs[ps?fs:hs-1]),ds=ps?fs+1:fs,ys=ps?hs:hs-1;ds<ys;ds++){var Ds=bs[ds];us[Ds]=ns(us[Ds],rs(gs[ds],us[Es]))}}return As}}),name$13="csLu",dependencies$13=["abs","divideScalar","multiply","subtract","larger","largerEq","SparseMatrix"],createCsLu=factory(name$13,dependencies$13,ss=>{var{abs:ts,divideScalar:rs,multiply:ns,subtract:is,larger:as,largerEq:os,SparseMatrix:ls}=ss,us=createCsSpsolve({divideScalar:rs,multiply:ns,subtract:is});return function(cs,ps,ds){if(!cs)return null;var fs,hs=cs._size[1],ys=100,gs=100;ps&&(fs=ps.q,ys=ps.lnz||ys,gs=ps.unz||gs);var bs,vs,Ns=[],Ts=[],Cs=[],xs=new ls({values:Ns,index:Ts,ptr:Cs,size:[hs,hs]}),As=[],ws=[],Es=[],Ss=new ls({values:As,index:ws,ptr:Es,size:[hs,hs]}),Ds=[],Vs=[],Is=[];for(bs=0;bs<hs;bs++)Vs[bs]=0,Ds[bs]=-1,Cs[bs+1]=0;ys=0,gs=0;for(var Os=0;Os<hs;Os++){Cs[Os]=ys,Es[Os]=gs;var Ps=fs?fs[Os]:Os,$s=us(xs,cs,Ps,Is,Vs,Ds,1),Rs=-1,ks=-1;for(vs=$s;vs<hs;vs++)if(Ds[bs=Is[vs]]<0){var _s=ts(Vs[bs]);as(_s,ks)&&(ks=_s,Rs=bs)}else ws[gs]=Ds[bs],As[gs++]=Vs[bs];if(Rs===-1||ks<=0)return null;Ds[Ps]<0&&os(ts(Vs[Ps]),ns(ks,ds))&&(Rs=Ps);var Bs=Vs[Rs];for(ws[gs]=Os,As[gs++]=Bs,Ds[Rs]=Os,Ts[ys]=Rs,Ns[ys++]=1,vs=$s;vs<hs;vs++)Ds[bs=Is[vs]]<0&&(Ts[ys]=bs,Ns[ys++]=rs(Vs[bs],Bs)),Vs[bs]=0}for(Cs[hs]=ys,Es[hs]=gs,vs=0;vs<ys;vs++)Ts[vs]=Ds[Ts[vs]];return Ns.splice(ys,Ns.length-ys),Ts.splice(ys,Ts.length-ys),As.splice(gs,As.length-gs),ws.splice(gs,ws.length-gs),{L:xs,U:Ss,pinv:Ds}}}),name$12="slu",dependencies$12=["typed","abs","add","multiply","transpose","divideScalar","subtract","larger","largerEq","SparseMatrix"],createSlu=factory(name$12,dependencies$12,ss=>{var{typed:ts,abs:rs,add:ns,multiply:is,transpose:as,divideScalar:os,subtract:ls,larger:us,largerEq:cs,SparseMatrix:ps}=ss,ds=createCsSqr({add:ns,multiply:is,transpose:as}),fs=createCsLu({abs:rs,divideScalar:os,multiply:is,subtract:ls,larger:us,largerEq:cs,SparseMatrix:ps});return ts(name$12,{"SparseMatrix, number, number":function(hs,ys,gs){if(!isInteger$1(ys)||ys<0||ys>3)throw new Error("Symbolic Ordering and Analysis order must be an integer number in the interval [0, 3]");if(gs<0||gs>1)throw new Error("Partial pivoting threshold must be a number from 0 to 1");var bs=ds(ys,hs,!1),vs=fs(hs,bs,gs);return{L:vs.L,U:vs.U,p:vs.pinv,q:bs.q,toString:function(){return"L: "+this.L.toString()+`
U: `+this.U.toString()+`
p: `+this.p.toString()+(this.q?`
q: `+this.q.toString():"")+`
`}}}})});function csIpvec(ss,ts){var rs,ns=ts.length,is=[];if(ss)for(rs=0;rs<ns;rs++)is[ss[rs]]=ts[rs];else for(rs=0;rs<ns;rs++)is[rs]=ts[rs];return is}var name$11="lusolve",dependencies$11=["typed","matrix","lup","slu","usolve","lsolve","DenseMatrix"],createLusolve=factory(name$11,dependencies$11,ss=>{var{typed:ts,matrix:rs,lup:ns,slu:is,usolve:as,lsolve:os,DenseMatrix:ls}=ss,us=createSolveValidation({DenseMatrix:ls});return ts(name$11,{"Array, Array | Matrix":function(ds,fs){ds=rs(ds);var hs=ns(ds);return ps(hs.L,hs.U,hs.p,null,fs).valueOf()},"DenseMatrix, Array | Matrix":function(ds,fs){var hs=ns(ds);return ps(hs.L,hs.U,hs.p,null,fs)},"SparseMatrix, Array | Matrix":function(ds,fs){var hs=ns(ds);return ps(hs.L,hs.U,hs.p,null,fs)},"SparseMatrix, Array | Matrix, number, number":function(ds,fs,hs,ys){var gs=is(ds,hs,ys);return ps(gs.L,gs.U,gs.p,gs.q,fs)},"Object, Array | Matrix":function(ds,fs){return ps(ds.L,ds.U,ds.p,ds.q,fs)}});function cs(ds){if(isMatrix(ds))return ds;if(isArray$1$1(ds))return rs(ds);throw new TypeError("Invalid Matrix LU decomposition")}function ps(ds,fs,hs,ys,gs){ds=cs(ds),fs=cs(fs),hs&&((gs=us(ds,gs,!0))._data=csIpvec(hs,gs._data));var bs=os(ds,gs),vs=as(fs,bs);return ys&&(vs._data=csIpvec(ys,vs._data)),vs}}),name$10="Help",dependencies$10=["parse"],createHelpClass=factory(name$10,dependencies$10,ss=>{var{parse:ts}=ss;function rs(ns){if(!(this instanceof rs))throw new SyntaxError("Constructor must be called with the new operator");if(!ns)throw new Error('Argument "doc" missing');this.doc=ns}return rs.prototype.type="Help",rs.prototype.isHelp=!0,rs.prototype.toString=function(){var ns=this.doc||{},is=`
`;if(ns.name&&(is+="Name: "+ns.name+`

`),ns.category&&(is+="Category: "+ns.category+`

`),ns.description&&(is+=`Description:
    `+ns.description+`

`),ns.syntax&&(is+=`Syntax:
    `+ns.syntax.join(`
    `)+`

`),ns.examples){is+=`Examples:
`;for(var as={},os=0;os<ns.examples.length;os++){var ls=ns.examples[os];is+="    "+ls+`
`;var us=void 0;try{us=ts(ls).compile().evaluate(as)}catch(cs){us=cs}us===void 0||isHelp(us)||(is+="        "+format$1(us,{precision:14})+`
`)}is+=`
`}return ns.mayThrow&&ns.mayThrow.length&&(is+="Throws: "+ns.mayThrow.join(", ")+`

`),ns.seealso&&ns.seealso.length&&(is+="See also: "+ns.seealso.join(", ")+`
`),is},rs.prototype.toJSON=function(){var ns=clone$3(this.doc);return ns.mathjs="Help",ns},rs.fromJSON=function(ns){var is={};return Object.keys(ns).filter(as=>as!=="mathjs").forEach(as=>{is[as]=ns[as]}),new rs(is)},rs.prototype.valueOf=rs.prototype.toString,rs},{isClass:!0}),name$$="Chain",dependencies$$=["?on","math"],createChainClass=factory(name$$,dependencies$$,ss=>{var{on:ts,math:rs}=ss;function ns(ls){if(!(this instanceof ns))throw new SyntaxError("Constructor must be called with the new operator");isChain(ls)?this.value=ls.value:this.value=ls}function is(ls,us){lazy(ns.prototype,ls,function(){var cs=us();if(typeof cs=="function")return as(cs)})}function as(ls){return function(){for(var us=[this.value],cs=0;cs<arguments.length;cs++)us[cs+1]=arguments[cs];return new ns(ls.apply(ls,us))}}ns.prototype.type="Chain",ns.prototype.isChain=!0,ns.prototype.done=function(){return this.value},ns.prototype.valueOf=function(){return this.value},ns.prototype.toString=function(){return format$1(this.value)},ns.prototype.toJSON=function(){return{mathjs:"Chain",value:this.value}},ns.fromJSON=function(ls){return new ns(ls.value)},ns.createProxy=function(ls,us){if(typeof ls=="string")(function(ds,fs){typeof fs=="function"&&(ns.prototype[ds]=as(fs))})(ls,us);else{var cs=function(ds){hasOwnProperty$2(ls,ds)&&os[ds]===void 0&&is(ds,()=>ls[ds])};for(var ps in ls)cs(ps)}};var os={expression:!0,docs:!0,type:!0,classes:!0,json:!0,error:!0,isChain:!0};return ns.createProxy(rs),ts&&ts("import",function(ls,us,cs){cs||is(ls,us)}),ns},{isClass:!0}),eDocs={name:"e",category:"Constants",syntax:["e"],description:"Euler's number, the base of the natural logarithm. Approximately equal to 2.71828",examples:["e","e ^ 2","exp(2)","log(e)"],seealso:["exp"]},falseDocs={name:"false",category:"Constants",syntax:["false"],description:"Boolean value false",examples:["false"],seealso:["true"]},iDocs={name:"i",category:"Constants",syntax:["i"],description:"Imaginary unit, defined as i*i=-1. A complex number is described as a + b*i, where a is the real part, and b is the imaginary part.",examples:["i","i * i","sqrt(-1)"],seealso:[]},InfinityDocs={name:"Infinity",category:"Constants",syntax:["Infinity"],description:"Infinity, a number which is larger than the maximum number that can be handled by a floating point number.",examples:["Infinity","1 / 0"],seealso:[]},LN10Docs={name:"LN10",category:"Constants",syntax:["LN10"],description:"Returns the natural logarithm of 10, approximately equal to 2.302",examples:["LN10","log(10)"],seealso:[]},LN2Docs={name:"LN2",category:"Constants",syntax:["LN2"],description:"Returns the natural logarithm of 2, approximately equal to 0.693",examples:["LN2","log(2)"],seealso:[]},LOG10EDocs={name:"LOG10E",category:"Constants",syntax:["LOG10E"],description:"Returns the base-10 logarithm of E, approximately equal to 0.434",examples:["LOG10E","log(e, 10)"],seealso:[]},LOG2EDocs={name:"LOG2E",category:"Constants",syntax:["LOG2E"],description:"Returns the base-2 logarithm of E, approximately equal to 1.442",examples:["LOG2E","log(e, 2)"],seealso:[]},NaNDocs={name:"NaN",category:"Constants",syntax:["NaN"],description:"Not a number",examples:["NaN","0 / 0"],seealso:[]},nullDocs={name:"null",category:"Constants",syntax:["null"],description:"Value null",examples:["null"],seealso:["true","false"]},phiDocs={name:"phi",category:"Constants",syntax:["phi"],description:"Phi is the golden ratio. Two quantities are in the golden ratio if their ratio is the same as the ratio of their sum to the larger of the two quantities. Phi is defined as `(1 + sqrt(5)) / 2` and is approximately 1.618034...",examples:["phi"],seealso:[]},piDocs={name:"pi",category:"Constants",syntax:["pi"],description:"The number pi is a mathematical constant that is the ratio of a circle's circumference to its diameter, and is approximately equal to 3.14159",examples:["pi","sin(pi/2)"],seealso:["tau"]},SQRT12Docs={name:"SQRT1_2",category:"Constants",syntax:["SQRT1_2"],description:"Returns the square root of 1/2, approximately equal to 0.707",examples:["SQRT1_2","sqrt(1/2)"],seealso:[]},SQRT2Docs={name:"SQRT2",category:"Constants",syntax:["SQRT2"],description:"Returns the square root of 2, approximately equal to 1.414",examples:["SQRT2","sqrt(2)"],seealso:[]},tauDocs={name:"tau",category:"Constants",syntax:["tau"],description:"Tau is the ratio constant of a circle's circumference to radius, equal to 2 * pi, approximately 6.2832.",examples:["tau","2 * pi"],seealso:["pi"]},trueDocs={name:"true",category:"Constants",syntax:["true"],description:"Boolean value true",examples:["true"],seealso:["false"]},versionDocs={name:"version",category:"Constants",syntax:["version"],description:"A string with the version number of math.js",examples:["version"],seealso:[]},bignumberDocs={name:"bignumber",category:"Construction",syntax:["bignumber(x)"],description:"Create a big number from a number or string.",examples:["0.1 + 0.2","bignumber(0.1) + bignumber(0.2)",'bignumber("7.2")','bignumber("7.2e500")',"bignumber([0.1, 0.2, 0.3])"],seealso:["boolean","complex","fraction","index","matrix","string","unit"]},booleanDocs={name:"boolean",category:"Construction",syntax:["x","boolean(x)"],description:"Convert a string or number into a boolean.",examples:["boolean(0)","boolean(1)","boolean(3)",'boolean("true")','boolean("false")',"boolean([1, 0, 1, 1])"],seealso:["bignumber","complex","index","matrix","number","string","unit"]},complexDocs={name:"complex",category:"Construction",syntax:["complex()","complex(re, im)","complex(string)"],description:"Create a complex number.",examples:["complex()","complex(2, 3)",'complex("7 - 2i")'],seealso:["bignumber","boolean","index","matrix","number","string","unit"]},createUnitDocs={name:"createUnit",category:"Construction",syntax:["createUnit(definitions)","createUnit(name, definition)"],description:"Create a user-defined unit and register it with the Unit type.",examples:['createUnit("foo")','createUnit("knot", {definition: "0.514444444 m/s", aliases: ["knots", "kt", "kts"]})','createUnit("mph", "1 mile/hour")'],seealso:["unit","splitUnit"]},fractionDocs={name:"fraction",category:"Construction",syntax:["fraction(num)","fraction(matrix)","fraction(num,den)","fraction({n: num, d: den})"],description:"Create a fraction from a number or from integer numerator and denominator.",examples:["fraction(0.125)","fraction(1, 3) + fraction(2, 5)","fraction({n: 333, d: 53})","fraction([sqrt(9), sqrt(10), sqrt(11)])"],seealso:["bignumber","boolean","complex","index","matrix","string","unit"]},indexDocs={name:"index",category:"Construction",syntax:["[start]","[start:end]","[start:step:end]","[start1, start 2, ...]","[start1:end1, start2:end2, ...]","[start1:step1:end1, start2:step2:end2, ...]"],description:"Create an index to get or replace a subset of a matrix",examples:["[]","[1, 2, 3]","A = [1, 2, 3; 4, 5, 6]","A[1, :]","A[1, 2] = 50","A[0:2, 0:2] = ones(2, 2)"],seealso:["bignumber","boolean","complex","matrix,","number","range","string","unit"]},matrixDocs={name:"matrix",category:"Construction",syntax:["[]","[a1, b1, ...; a2, b2, ...]","matrix()",'matrix("dense")',"matrix([...])"],description:"Create a matrix.",examples:["[]","[1, 2, 3]","[1, 2, 3; 4, 5, 6]","matrix()","matrix([3, 4])",'matrix([3, 4; 5, 6], "sparse")','matrix([3, 4; 5, 6], "sparse", "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","sparse"]},numberDocs={name:"number",category:"Construction",syntax:["x","number(x)","number(unit, valuelessUnit)"],description:"Create a number or convert a string or boolean into a number.",examples:["2","2e3","4.05","number(2)",'number("7.2")',"number(true)","number([true, false, true, true])",'number(unit("52cm"), "m")'],seealso:["bignumber","boolean","complex","fraction","index","matrix","string","unit"]},sparseDocs={name:"sparse",category:"Construction",syntax:["sparse()","sparse([a1, b1, ...; a1, b2, ...])",'sparse([a1, b1, ...; a1, b2, ...], "number")'],description:"Create a sparse matrix.",examples:["sparse()","sparse([3, 4; 5, 6])",'sparse([3, 0; 5, 0], "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","matrix"]},splitUnitDocs={name:"splitUnit",category:"Construction",syntax:["splitUnit(unit: Unit, parts: Unit[])"],description:"Split a unit in an array of units whose sum is equal to the original unit.",examples:['splitUnit(1 m, ["feet", "inch"])'],seealso:["unit","createUnit"]},stringDocs={name:"string",category:"Construction",syntax:['"text"',"string(x)"],description:"Create a string or convert a value to a string",examples:['"Hello World!"',"string(4.2)","string(3 + 2i)"],seealso:["bignumber","boolean","complex","index","matrix","number","unit"]},unitDocs={name:"unit",category:"Construction",syntax:["value unit","unit(value, unit)","unit(string)"],description:"Create a unit.",examples:["5.5 mm","3 inch",'unit(7.1, "kilogram")','unit("23 deg")'],seealso:["bignumber","boolean","complex","index","matrix","number","string"]},configDocs={name:"config",category:"Core",syntax:["config()","config(options)"],description:"Get configuration or change configuration.",examples:["config()","1/3 + 1/4",'config({number: "Fraction"})',"1/3 + 1/4"],seealso:[]},importDocs={name:"import",category:"Core",syntax:["import(functions)","import(functions, options)"],description:"Import functions or constants from an object.",examples:["import({myFn: f(x)=x^2, myConstant: 32 })","myFn(2)","myConstant"],seealso:[]},typedDocs={name:"typed",category:"Core",syntax:["typed(signatures)","typed(name, signatures)"],description:"Create a typed function.",examples:['double = typed({ "number": f(x)=x+x })',"double(2)",'double("hello")'],seealso:[]},derivativeDocs={name:"derivative",category:"Algebra",syntax:["derivative(expr, variable)","derivative(expr, variable, {simplify: boolean})"],description:"Takes the derivative of an expression expressed in parser Nodes. The derivative will be taken over the supplied variable in the second parameter. If there are multiple variables in the expression, it will return a partial derivative.",examples:['derivative("2x^3", "x")','derivative("2x^3", "x", {simplify: false})','derivative("2x^2 + 3x + 4", "x")','derivative("sin(2x)", "x")','f = parse("x^2 + x")','x = parse("x")',"df = derivative(f, x)","df.evaluate({x: 3})"],seealso:["simplify","parse","evaluate"]},leafCountDocs={name:"leafCount",category:"Algebra",syntax:["leafCount(expr)"],description:"Computes the number of leaves in the parse tree of the given expression",examples:['leafCount("e^(i*pi)-1")','leafCount(parse("{a: 22/7, b: 10^(1/2)}"))'],seealso:["simplify"]},lsolveDocs={name:"lsolve",category:"Algebra",syntax:["x=lsolve(L, b)"],description:"Finds one solution of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolveAll","lup","lusolve","usolve","matrix","sparse"]},lsolveAllDocs={name:"lsolveAll",category:"Algebra",syntax:["x=lsolveAll(L, b)"],description:"Finds all solutions of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolve","lup","lusolve","usolve","matrix","sparse"]},lupDocs={name:"lup",category:"Algebra",syntax:["lup(m)"],description:"Calculate the Matrix LU decomposition with partial pivoting. Matrix A is decomposed in three matrices (L, U, P) where P * A = L * U",examples:["lup([[2, 1], [1, 4]])","lup(matrix([[2, 1], [1, 4]]))","lup(sparse([[2, 1], [1, 4]]))"],seealso:["lusolve","lsolve","usolve","matrix","sparse","slu","qr"]},lusolveDocs={name:"lusolve",category:"Algebra",syntax:["x=lusolve(A, b)","x=lusolve(lu, b)"],description:"Solves the linear system A * x = b where A is an [n x n] matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lusolve(a, b)"],seealso:["lup","slu","lsolve","usolve","matrix","sparse"]},qrDocs={name:"qr",category:"Algebra",syntax:["qr(A)"],description:"Calculates the Matrix QR decomposition. Matrix `A` is decomposed in two matrices (`Q`, `R`) where `Q` is an orthogonal matrix and `R` is an upper triangular matrix.",examples:["qr([[1, -1,  4], [1,  4, -2], [1,  4,  2], [1,  -1, 0]])"],seealso:["lup","slu","matrix"]},rationalizeDocs={name:"rationalize",category:"Algebra",syntax:["rationalize(expr)","rationalize(expr, scope)","rationalize(expr, scope, detailed)"],description:"Transform a rationalizable expression in a rational fraction. If rational fraction is one variable polynomial then converts the numerator and denominator in canonical form, with decreasing exponents, returning the coefficients of numerator.",examples:['rationalize("2x/y - y/(x+1)")','rationalize("2x/y - y/(x+1)", true)'],seealso:["simplify"]},resolveDocs={name:"resolve",category:"Algebra",syntax:["resolve(node, scope)"],description:"Recursively substitute variables in an expression tree.",examples:['resolve(parse("1 + x"), { x: 7 })','resolve(parse("size(text)"), { text: "Hello World" })','resolve(parse("x + y"), { x: parse("3z") })','resolve(parse("3x"), { x: parse("y+z"), z: parse("w^y") })'],seealso:["simplify","evaluate"],mayThrow:["ReferenceError"]},simplifyDocs={name:"simplify",category:"Algebra",syntax:["simplify(expr)","simplify(expr, rules)"],description:"Simplify an expression tree.",examples:['simplify("3 + 2 / 4")','simplify("2x + x")','f = parse("x * (x + 2 + x)")',"simplified = simplify(f)","simplified.evaluate({x: 2})"],seealso:["simplifyCore","derivative","evaluate","parse","rationalize","resolve"]},simplifyCoreDocs={name:"simplifyCore",category:"Algebra",syntax:["simplifyCore(node)"],description:"Perform simple one-pass simplifications on an expression tree.",examples:['simplifyCore(parse("0*x"))','simplifyCore(parse("(x+0)*2"))'],seealso:["simplify","evaluate"]},sluDocs={name:"slu",category:"Algebra",syntax:["slu(A, order, threshold)"],description:"Calculate the Matrix LU decomposition with full pivoting. Matrix A is decomposed in two matrices (L, U) and two permutation vectors (pinv, q) where P * A * Q = L * U",examples:["slu(sparse([4.5, 0, 3.2, 0; 3.1, 2.9, 0, 0.9; 0, 1.7, 3, 0; 3.5, 0.4, 0, 1]), 1, 0.001)"],seealso:["lusolve","lsolve","usolve","matrix","sparse","lup","qr"]},symbolicEqualDocs={name:"symbolicEqual",category:"Algebra",syntax:["symbolicEqual(expr1, expr2)","symbolicEqual(expr1, expr2, options)"],description:"Returns true if the difference of the expressions simplifies to 0",examples:['symbolicEqual("x*y","y*x")','symbolicEqual("abs(x^2)", "x^2")','symbolicEqual("abs(x)", "x", {context: {abs: {trivial: true}}})'],seealso:["simplify","evaluate"]},usolveDocs={name:"usolve",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds one solution of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolveAll","lup","lusolve","lsolve","matrix","sparse"]},usolveAllDocs={name:"usolveAll",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds all solutions of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolve","lup","lusolve","lsolve","matrix","sparse"]},absDocs={name:"abs",category:"Arithmetic",syntax:["abs(x)"],description:"Compute the absolute value.",examples:["abs(3.5)","abs(-4.2)"],seealso:["sign"]},addDocs={name:"add",category:"Operators",syntax:["x + y","add(x, y)"],description:"Add two values.",examples:["a = 2.1 + 3.6","a - 3.6","3 + 2i","3 cm + 2 inch",'"2.3" + "4"'],seealso:["subtract"]},cbrtDocs={name:"cbrt",category:"Arithmetic",syntax:["cbrt(x)","cbrt(x, allRoots)"],description:"Compute the cubic root value. If x = y * y * y, then y is the cubic root of x. When `x` is a number or complex number, an optional second argument `allRoots` can be provided to return all three cubic roots. If not provided, the principal root is returned",examples:["cbrt(64)","cube(4)","cbrt(-8)","cbrt(2 + 3i)","cbrt(8i)","cbrt(8i, true)","cbrt(27 m^3)"],seealso:["square","sqrt","cube","multiply"]},ceilDocs={name:"ceil",category:"Arithmetic",syntax:["ceil(x)"],description:"Round a value towards plus infinity. If x is complex, both real and imaginary part are rounded towards plus infinity.",examples:["ceil(3.2)","ceil(3.8)","ceil(-4.2)"],seealso:["floor","fix","round"]},cubeDocs={name:"cube",category:"Arithmetic",syntax:["cube(x)"],description:"Compute the cube of a value. The cube of x is x * x * x.",examples:["cube(2)","2^3","2 * 2 * 2"],seealso:["multiply","square","pow"]},divideDocs={name:"divide",category:"Operators",syntax:["x / y","divide(x, y)"],description:"Divide two values.",examples:["a = 2 / 3","a * 3","4.5 / 2","3 + 4 / 2","(3 + 4) / 2","18 km / 4.5"],seealso:["multiply"]},dotDivideDocs={name:"dotDivide",category:"Operators",syntax:["x ./ y","dotDivide(x, y)"],description:"Divide two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a ./ b"],seealso:["multiply","dotMultiply","divide"]},dotMultiplyDocs={name:"dotMultiply",category:"Operators",syntax:["x .* y","dotMultiply(x, y)"],description:"Multiply two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a .* b"],seealso:["multiply","divide","dotDivide"]},dotPowDocs={name:"dotPow",category:"Operators",syntax:["x .^ y","dotPow(x, y)"],description:"Calculates the power of x to y element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","a .^ 2"],seealso:["pow"]},expDocs={name:"exp",category:"Arithmetic",syntax:["exp(x)"],description:"Calculate the exponent of a value.",examples:["exp(1.3)","e ^ 1.3","log(exp(1.3))","x = 2.4","(exp(i*x) == cos(x) + i*sin(x))   # Euler's formula"],seealso:["expm","expm1","pow","log"]},expmDocs={name:"expm",category:"Arithmetic",syntax:["exp(x)"],description:"Compute the matrix exponential, expm(A) = e^A. The matrix must be square. Not to be confused with exp(a), which performs element-wise exponentiation.",examples:["expm([[0,2],[0,0]])"],seealso:["exp"]},expm1Docs={name:"expm1",category:"Arithmetic",syntax:["expm1(x)"],description:"Calculate the value of subtracting 1 from the exponential value.",examples:["expm1(2)","pow(e, 2) - 1","log(expm1(2) + 1)"],seealso:["exp","pow","log"]},fixDocs={name:"fix",category:"Arithmetic",syntax:["fix(x)"],description:"Round a value towards zero. If x is complex, both real and imaginary part are rounded towards zero.",examples:["fix(3.2)","fix(3.8)","fix(-4.2)","fix(-4.8)"],seealso:["ceil","floor","round"]},floorDocs={name:"floor",category:"Arithmetic",syntax:["floor(x)"],description:"Round a value towards minus infinity.If x is complex, both real and imaginary part are rounded towards minus infinity.",examples:["floor(3.2)","floor(3.8)","floor(-4.2)"],seealso:["ceil","fix","round"]},gcdDocs={name:"gcd",category:"Arithmetic",syntax:["gcd(a, b)","gcd(a, b, c, ...)"],description:"Compute the greatest common divisor.",examples:["gcd(8, 12)","gcd(-4, 6)","gcd(25, 15, -10)"],seealso:["lcm","xgcd"]},hypotDocs={name:"hypot",category:"Arithmetic",syntax:["hypot(a, b, c, ...)","hypot([a, b, c, ...])"],description:"Calculate the hypotenusa of a list with values. ",examples:["hypot(3, 4)","sqrt(3^2 + 4^2)","hypot(-2)","hypot([3, 4, 5])"],seealso:["abs","norm"]},invmodDocs={name:"invmod",category:"Arithmetic",syntax:["invmod(a, b)"],description:"Calculate the (modular) multiplicative inverse of a modulo b. Solution to the equation ax  1 (mod b)",examples:["invmod(8, 12)=NaN","invmod(7, 13)=2","math.invmod(15151, 15122)=10429"],seealso:["gcd","xgcd"]},lcmDocs={name:"lcm",category:"Arithmetic",syntax:["lcm(x, y)"],description:"Compute the least common multiple.",examples:["lcm(4, 6)","lcm(6, 21)","lcm(6, 21, 5)"],seealso:["gcd"]},logDocs={name:"log",category:"Arithmetic",syntax:["log(x)","log(x, base)"],description:"Compute the logarithm of a value. If no base is provided, the natural logarithm of x is calculated. If base if provided, the logarithm is calculated for the specified base. log(x, base) is defined as log(x) / log(base).",examples:["log(3.5)","a = log(2.4)","exp(a)","10 ^ 4","log(10000, 10)","log(10000) / log(10)","b = log(1024, 2)","2 ^ b"],seealso:["exp","log1p","log2","log10"]},log10Docs={name:"log10",category:"Arithmetic",syntax:["log10(x)"],description:"Compute the 10-base logarithm of a value.",examples:["log10(0.00001)","log10(10000)","10 ^ 4","log(10000) / log(10)","log(10000, 10)"],seealso:["exp","log"]},log1pDocs={name:"log1p",category:"Arithmetic",syntax:["log1p(x)","log1p(x, base)"],description:"Calculate the logarithm of a `value+1`",examples:["log1p(2.5)","exp(log1p(1.4))","pow(10, 4)","log1p(9999, 10)","log1p(9999) / log(10)"],seealso:["exp","log","log2","log10"]},log2Docs={name:"log2",category:"Arithmetic",syntax:["log2(x)"],description:"Calculate the 2-base of a value. This is the same as calculating `log(x, 2)`.",examples:["log2(0.03125)","log2(16)","log2(16) / log2(2)","pow(2, 4)"],seealso:["exp","log1p","log","log10"]},modDocs={name:"mod",category:"Operators",syntax:["x % y","x mod y","mod(x, y)"],description:"Calculates the modulus, the remainder of an integer division.",examples:["7 % 3","11 % 2","10 mod 4","isOdd(x) = x % 2","isOdd(2)","isOdd(3)"],seealso:["divide"]},multiplyDocs={name:"multiply",category:"Operators",syntax:["x * y","multiply(x, y)"],description:"multiply two values.",examples:["a = 2.1 * 3.4","a / 3.4","2 * 3 + 4","2 * (3 + 4)","3 * 2.1 km"],seealso:["divide"]},normDocs={name:"norm",category:"Arithmetic",syntax:["norm(x)","norm(x, p)"],description:"Calculate the norm of a number, vector or matrix.",examples:["abs(-3.5)","norm(-3.5)","norm(3 - 4i)","norm([1, 2, -3], Infinity)","norm([1, 2, -3], -Infinity)","norm([3, 4], 2)","norm([[1, 2], [3, 4]], 1)",'norm([[1, 2], [3, 4]], "inf")','norm([[1, 2], [3, 4]], "fro")']},nthRootDocs={name:"nthRoot",category:"Arithmetic",syntax:["nthRoot(a)","nthRoot(a, root)"],description:'Calculate the nth root of a value. The principal nth root of a positive real number A, is the positive real solution of the equation "x^root = A".',examples:["4 ^ 3","nthRoot(64, 3)","nthRoot(9, 2)","sqrt(9)"],seealso:["nthRoots","pow","sqrt"]},nthRootsDocs={name:"nthRoots",category:"Arithmetic",syntax:["nthRoots(A)","nthRoots(A, root)"],description:'Calculate the nth roots of a value. An nth root of a positive real number A, is a positive real solution of the equation "x^root = A". This function returns an array of complex values.',examples:["nthRoots(1)","nthRoots(1, 3)"],seealso:["sqrt","pow","nthRoot"]},powDocs={name:"pow",category:"Operators",syntax:["x ^ y","pow(x, y)"],description:"Calculates the power of x to y, x^y.",examples:["2^3","2*2*2","1 + e ^ (pi * i)","math.pow([[1, 2], [4, 3]], 2)","math.pow([[1, 2], [4, 3]], -1)"],seealso:["multiply","nthRoot","nthRoots","sqrt"]},roundDocs={name:"round",category:"Arithmetic",syntax:["round(x)","round(x, n)"],description:"round a value towards the nearest integer.If x is complex, both real and imaginary part are rounded towards the nearest integer. When n is specified, the value is rounded to n decimals.",examples:["round(3.2)","round(3.8)","round(-4.2)","round(-4.8)","round(pi, 3)","round(123.45678, 2)"],seealso:["ceil","floor","fix"]},signDocs={name:"sign",category:"Arithmetic",syntax:["sign(x)"],description:"Compute the sign of a value. The sign of a value x is 1 when x>1, -1 when x<0, and 0 when x=0.",examples:["sign(3.5)","sign(-4.2)","sign(0)"],seealso:["abs"]},sqrtDocs={name:"sqrt",category:"Arithmetic",syntax:["sqrt(x)"],description:"Compute the square root value. If x = y * y, then y is the square root of x.",examples:["sqrt(25)","5 * 5","sqrt(-1)"],seealso:["square","sqrtm","multiply","nthRoot","nthRoots","pow"]},sqrtmDocs={name:"sqrtm",category:"Arithmetic",syntax:["sqrtm(x)"],description:"Calculate the principal square root of a square matrix. The principal square root matrix `X` of another matrix `A` is such that `X * X = A`.",examples:["sqrtm([[1, 2], [3, 4]])"],seealso:["sqrt","abs","square","multiply"]},squareDocs={name:"square",category:"Arithmetic",syntax:["square(x)"],description:"Compute the square of a value. The square of x is x * x.",examples:["square(3)","sqrt(9)","3^2","3 * 3"],seealso:["multiply","pow","sqrt","cube"]},subtractDocs={name:"subtract",category:"Operators",syntax:["x - y","subtract(x, y)"],description:"subtract two values.",examples:["a = 5.3 - 2","a + 2","2/3 - 1/6","2 * 3 - 3","2.1 km - 500m"],seealso:["add"]},unaryMinusDocs={name:"unaryMinus",category:"Operators",syntax:["-x","unaryMinus(x)"],description:"Inverse the sign of a value. Converts booleans and strings to numbers.",examples:["-4.5","-(-5.6)",'-"22"'],seealso:["add","subtract","unaryPlus"]},unaryPlusDocs={name:"unaryPlus",category:"Operators",syntax:["+x","unaryPlus(x)"],description:"Converts booleans and strings to numbers.",examples:["+true",'+"2"'],seealso:["add","subtract","unaryMinus"]},xgcdDocs={name:"xgcd",category:"Arithmetic",syntax:["xgcd(a, b)"],description:"Calculate the extended greatest common divisor for two values. The result is an array [d, x, y] with 3 entries, where d is the greatest common divisor, and d = x * a + y * b.",examples:["xgcd(8, 12)","gcd(8, 12)","xgcd(36163, 21199)"],seealso:["gcd","lcm"]},bitAndDocs={name:"bitAnd",category:"Bitwise",syntax:["x & y","bitAnd(x, y)"],description:"Bitwise AND operation. Performs the logical AND operation on each pair of the corresponding bits of the two given values by multiplying them. If both bits in the compared position are 1, the bit in the resulting binary representation is 1, otherwise, the result is 0",examples:["5 & 3","bitAnd(53, 131)","[1, 12, 31] & 42"],seealso:["bitNot","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitNotDocs={name:"bitNot",category:"Bitwise",syntax:["~x","bitNot(x)"],description:"Bitwise NOT operation. Performs a logical negation on each bit of the given value. Bits that are 0 become 1, and those that are 1 become 0.",examples:["~1","~2","bitNot([2, -3, 4])"],seealso:["bitAnd","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitOrDocs={name:"bitOr",category:"Bitwise",syntax:["x | y","bitOr(x, y)"],description:"Bitwise OR operation. Performs the logical inclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if the first bit is 1 or the second bit is 1 or both bits are 1, otherwise, the result is 0.",examples:["5 | 3","bitOr([1, 2, 3], 4)"],seealso:["bitAnd","bitNot","bitXor","leftShift","rightArithShift","rightLogShift"]},bitXorDocs={name:"bitXor",category:"Bitwise",syntax:["bitXor(x, y)"],description:"Bitwise XOR operation, exclusive OR. Performs the logical exclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if only the first bit is 1 or only the second bit is 1, but will be 0 if both are 0 or both are 1.",examples:["bitOr(1, 2)","bitXor([2, 3, 4], 4)"],seealso:["bitAnd","bitNot","bitOr","leftShift","rightArithShift","rightLogShift"]},leftShiftDocs={name:"leftShift",category:"Bitwise",syntax:["x << y","leftShift(x, y)"],description:"Bitwise left logical shift of a value x by y number of bits.",examples:["4 << 1","8 >> 1"],seealso:["bitAnd","bitNot","bitOr","bitXor","rightArithShift","rightLogShift"]},rightArithShiftDocs={name:"rightArithShift",category:"Bitwise",syntax:["x >> y","rightArithShift(x, y)"],description:"Bitwise right arithmetic shift of a value x by y number of bits.",examples:["8 >> 1","4 << 1","-12 >> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightLogShift"]},rightLogShiftDocs={name:"rightLogShift",category:"Bitwise",syntax:["x >>> y","rightLogShift(x, y)"],description:"Bitwise right logical shift of a value x by y number of bits.",examples:["8 >>> 1","4 << 1","-12 >>> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightArithShift"]},bellNumbersDocs={name:"bellNumbers",category:"Combinatorics",syntax:["bellNumbers(n)"],description:"The Bell Numbers count the number of partitions of a set. A partition is a pairwise disjoint subset of S whose union is S. `bellNumbers` only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["bellNumbers(3)","bellNumbers(8)"],seealso:["stirlingS2"]},catalanDocs={name:"catalan",category:"Combinatorics",syntax:["catalan(n)"],description:"The Catalan Numbers enumerate combinatorial structures of many different types. catalan only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["catalan(3)","catalan(8)"],seealso:["bellNumbers"]},compositionDocs={name:"composition",category:"Combinatorics",syntax:["composition(n, k)"],description:"The composition counts of n into k parts. composition only takes integer arguments. The following condition must be enforced: k <= n.",examples:["composition(5, 3)"],seealso:["combinations"]},stirlingS2Docs={name:"stirlingS2",category:"Combinatorics",syntax:["stirlingS2(n, k)"],description:"he Stirling numbers of the second kind, counts the number of ways to partition a set of n labelled objects into k nonempty unlabelled subsets. `stirlingS2` only takes integer arguments. The following condition must be enforced: k <= n. If n = k or k = 1, then s(n,k) = 1.",examples:["stirlingS2(5, 3)"],seealso:["bellNumbers"]},argDocs={name:"arg",category:"Complex",syntax:["arg(x)"],description:"Compute the argument of a complex value. If x = a+bi, the argument is computed as atan2(b, a).",examples:["arg(2 + 2i)","atan2(3, 2)","arg(2 + 3i)"],seealso:["re","im","conj","abs"]},conjDocs={name:"conj",category:"Complex",syntax:["conj(x)"],description:"Compute the complex conjugate of a complex value. If x = a+bi, the complex conjugate is a-bi.",examples:["conj(2 + 3i)","conj(2 - 3i)","conj(-5.2i)"],seealso:["re","im","abs","arg"]},imDocs={name:"im",category:"Complex",syntax:["im(x)"],description:"Get the imaginary part of a complex number.",examples:["im(2 + 3i)","re(2 + 3i)","im(-5.2i)","im(2.4)"],seealso:["re","conj","abs","arg"]},reDocs={name:"re",category:"Complex",syntax:["re(x)"],description:"Get the real part of a complex number.",examples:["re(2 + 3i)","im(2 + 3i)","re(-5.2i)","re(2.4)"],seealso:["im","conj","abs","arg"]},evaluateDocs={name:"evaluate",category:"Expression",syntax:["evaluate(expression)","evaluate([expr1, expr2, expr3, ...])"],description:"Evaluate an expression or an array with expressions.",examples:['evaluate("2 + 3")','evaluate("sqrt(" + 4 + ")")'],seealso:[]},helpDocs={name:"help",category:"Expression",syntax:["help(object)","help(string)"],description:"Display documentation on a function or data type.",examples:["help(sqrt)",'help("complex")'],seealso:[]},distanceDocs={name:"distance",category:"Geometry",syntax:["distance([x1, y1], [x2, y2])","distance([[x1, y1], [x2, y2]])"],description:"Calculates the Euclidean distance between two points.",examples:["distance([0,0], [4,4])","distance([[0,0], [4,4]])"],seealso:[]},intersectDocs={name:"intersect",category:"Geometry",syntax:["intersect(expr1, expr2, expr3, expr4)","intersect(expr1, expr2, expr3)"],description:"Computes the intersection point of lines and/or planes.",examples:["intersect([0, 0], [10, 10], [10, 0], [0, 10])","intersect([1, 0, 1],  [4, -2, 2], [1, 1, 1, 6])"],seealso:[]},andDocs={name:"and",category:"Logical",syntax:["x and y","and(x, y)"],description:"Logical and. Test whether two values are both defined with a nonzero/nonempty value.",examples:["true and false","true and true","2 and 4"],seealso:["not","or","xor"]},notDocs={name:"not",category:"Logical",syntax:["not x","not(x)"],description:"Logical not. Flips the boolean value of given argument.",examples:["not true","not false","not 2","not 0"],seealso:["and","or","xor"]},orDocs={name:"or",category:"Logical",syntax:["x or y","or(x, y)"],description:"Logical or. Test if at least one value is defined with a nonzero/nonempty value.",examples:["true or false","false or false","0 or 4"],seealso:["not","and","xor"]},xorDocs={name:"xor",category:"Logical",syntax:["x xor y","xor(x, y)"],description:"Logical exclusive or, xor. Test whether one and only one value is defined with a nonzero/nonempty value.",examples:["true xor false","false xor false","true xor true","0 xor 4"],seealso:["not","and","or"]},columnDocs={name:"column",category:"Matrix",syntax:["column(x, index)"],description:"Return a column from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","column(A, 1)","column(A, 2)"],seealso:["row","matrixFromColumns"]},concatDocs={name:"concat",category:"Matrix",syntax:["concat(A, B, C, ...)","concat(A, B, C, ..., dim)"],description:"Concatenate matrices. By default, the matrices are concatenated by the last dimension. The dimension on which to concatenate can be provided as last argument.",examples:["A = [1, 2; 5, 6]","B = [3, 4; 7, 8]","concat(A, B)","concat(A, B, 1)","concat(A, B, 2)"],seealso:["det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},countDocs={name:"count",category:"Matrix",syntax:["count(x)"],description:"Count the number of elements of a matrix, array or string.",examples:["a = [1, 2; 3, 4; 5, 6]","count(a)","size(a)",'count("hello world")'],seealso:["size"]},crossDocs={name:"cross",category:"Matrix",syntax:["cross(A, B)"],description:"Calculate the cross product for two vectors in three dimensional space.",examples:["cross([1, 1, 0],  [0, 1, 1])","cross([3, -3, 1], [4, 9, 2])","cross([2, 3, 4],  [5, 6, 7])"],seealso:["multiply","dot"]},ctransposeDocs={name:"ctranspose",category:"Matrix",syntax:["x'","ctranspose(x)"],description:"Complex Conjugate and Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","ctranspose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},detDocs={name:"det",category:"Matrix",syntax:["det(x)"],description:"Calculate the determinant of a matrix",examples:["det([1, 2; 3, 4])","det([-2, 2, 3; -1, 1, 3; 2, 0, -1])"],seealso:["concat","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diagDocs={name:"diag",category:"Matrix",syntax:["diag(x)","diag(x, k)"],description:"Create a diagonal matrix or retrieve the diagonal of a matrix. When x is a vector, a matrix with the vector values on the diagonal will be returned. When x is a matrix, a vector with the diagonal values of the matrix is returned. When k is provided, the k-th diagonal will be filled in or retrieved, if k is positive, the values are placed on the super diagonal. When k is negative, the values are placed on the sub diagonal.",examples:["diag(1:3)","diag(1:3, 1)","a = [1, 2, 3; 4, 5, 6; 7, 8, 9]","diag(a)"],seealso:["concat","det","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diffDocs={name:"diff",category:"Matrix",syntax:["diff(arr)","diff(arr, dim)"],description:["Create a new matrix or array with the difference of the passed matrix or array.","Dim parameter is optional and used to indicant the dimension of the array/matrix to apply the difference","If no dimension parameter is passed it is assumed as dimension 0","Dimension is zero-based in javascript and one-based in the parser","Arrays must be 'rectangular' meaning arrays like [1, 2]","If something is passed as a matrix it will be returned as a matrix but other than that all matrices are converted to arrays"],examples:["diff([1, 2, 4, 7, 0])","diff([1, 2, 4, 7, 0], 0)","diff(matrix([1, 2, 4, 7, 0]))","diff([[1, 2], [3, 4]])","diff([[1, 2], [3, 4]], 0)","diff([[1, 2], [3, 4]], 1)","diff([[1, 2], [3, 4]], bignumber(1))","diff(matrix([[1, 2], [3, 4]]), 1)","diff([[1, 2], matrix([3, 4])], 1)"],seealso:["subtract","partitionSelect"]},dotDocs={name:"dot",category:"Matrix",syntax:["dot(A, B)","A * B"],description:"Calculate the dot product of two vectors. The dot product of A = [a1, a2, a3, ..., an] and B = [b1, b2, b3, ..., bn] is defined as dot(A, B) = a1 * b1 + a2 * b2 + a3 * b3 + ... + an * bn",examples:["dot([2, 4, 1], [2, 2, 3])","[2, 4, 1] * [2, 2, 3]"],seealso:["multiply","cross"]},eigsDocs={name:"eigs",category:"Matrix",syntax:["eigs(x)"],description:"Calculate the eigenvalues and eigenvectors of a real symmetric matrix",examples:["eigs([[5, 2.3], [2.3, 1]])"],seealso:["inv"]},filterDocs={name:"filter",category:"Matrix",syntax:["filter(x, test)"],description:"Filter items in a matrix.",examples:["isPositive(x) = x > 0","filter([6, -2, -1, 4, 3], isPositive)","filter([6, -2, 0, 1, 0], x != 0)"],seealso:["sort","map","forEach"]},flattenDocs={name:"flatten",category:"Matrix",syntax:["flatten(x)"],description:"Flatten a multi dimensional matrix into a single dimensional matrix.",examples:["a = [1, 2, 3; 4, 5, 6]","size(a)","b = flatten(a)","size(b)"],seealso:["concat","resize","size","squeeze"]},forEachDocs={name:"forEach",category:"Matrix",syntax:["forEach(x, callback)"],description:"Iterates over all elements of a matrix/array, and executes the given callback function.",examples:["numberOfPets = {}","addPet(n) = numberOfPets[n] = (numberOfPets[n] ? numberOfPets[n]:0 ) + 1;",'forEach(["Dog","Cat","Cat"], addPet)',"numberOfPets"],seealso:["map","sort","filter"]},getMatrixDataTypeDocs={name:"getMatrixDataType",category:"Matrix",syntax:["getMatrixDataType(x)"],description:'Find the data type of all elements in a matrix or array, for example "number" if all items are a number and "Complex" if all values are complex numbers. If a matrix contains more than one data type, it will return "mixed".',examples:["getMatrixDataType([1, 2, 3])","getMatrixDataType([[5 cm], [2 inch]])",'getMatrixDataType([1, "text"])',"getMatrixDataType([1, bignumber(4)])"],seealso:["matrix","sparse","typeOf"]},identityDocs={name:"identity",category:"Matrix",syntax:["identity(n)","identity(m, n)","identity([m, n])"],description:"Returns the identity matrix with size m-by-n. The matrix has ones on the diagonal and zeros elsewhere.",examples:["identity(3)","identity(3, 5)","a = [1, 2, 3; 4, 5, 6]","identity(size(a))"],seealso:["concat","det","diag","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},invDocs={name:"inv",category:"Matrix",syntax:["inv(x)"],description:"Calculate the inverse of a matrix",examples:["inv([1, 2; 3, 4])","inv(4)","1 / 4"],seealso:["concat","det","diag","identity","ones","range","size","squeeze","subset","trace","transpose","zeros"]},pinvDocs={name:"pinv",category:"Matrix",syntax:["pinv(x)"],description:"Calculate the MoorePenrose inverse of a matrix",examples:["pinv([1, 2; 3, 4])","pinv([[1, 0], [0, 1], [0, 1]])","pinv(4)"],seealso:["inv"]},kronDocs={name:"kron",category:"Matrix",syntax:["kron(x, y)"],description:"Calculates the kronecker product of 2 matrices or vectors.",examples:["kron([[1, 0], [0, 1]], [[1, 2], [3, 4]])","kron([1,1], [2,3,4])"],seealso:["multiply","dot","cross"]},mapDocs={name:"map",category:"Matrix",syntax:["map(x, callback)"],description:"Create a new matrix or array with the results of the callback function executed on each entry of the matrix/array.",examples:["map([1, 2, 3], square)"],seealso:["filter","forEach"]},matrixFromColumnsDocs={name:"matrixFromColumns",category:"Matrix",syntax:["math.matrixFromColumns(...arr)","math.matrixFromColumns(row1, row2)","math.matrixFromColumns(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual columns.",examples:["matrixFromColumns([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromRows","matrixFromFunction","zeros"]},matrixFromFunctionDocs={name:"matrixFromFunction",category:"Matrix",syntax:["math.matrixFromFunction(size, fn)","math.matrixFromFunction(size, fn, format)","math.matrixFromFunction(size, fn, format, datatype)","math.matrixFromFunction(size, format, fn)","math.matrixFromFunction(size, format, datatype, fn)"],description:"Create a matrix by evaluating a generating function at each index.",examples:["f(I) = I[1] - I[2]","matrixFromFunction([3,3], f)","g(I) = I[1] - I[2] == 1 ? 4 : 0",'matrixFromFunction([100, 100], "sparse", g)',"matrixFromFunction([5], random)"],seealso:["matrix","matrixFromRows","matrixFromColumns","zeros"]},matrixFromRowsDocs={name:"matrixFromRows",category:"Matrix",syntax:["math.matrixFromRows(...arr)","math.matrixFromRows(row1, row2)","math.matrixFromRows(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual rows.",examples:["matrixFromRows([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromColumns","matrixFromFunction","zeros"]},onesDocs={name:"ones",category:"Matrix",syntax:["ones(m)","ones(m, n)","ones(m, n, p, ...)","ones([m])","ones([m, n])","ones([m, n, p, ...])"],description:"Create a matrix containing ones.",examples:["ones(3)","ones(3, 5)","ones([2,3]) * 4.5","a = [1, 2, 3; 4, 5, 6]","ones(size(a))"],seealso:["concat","det","diag","identity","inv","range","size","squeeze","subset","trace","transpose","zeros"]},partitionSelectDocs={name:"partitionSelect",category:"Matrix",syntax:["partitionSelect(x, k)","partitionSelect(x, k, compare)"],description:"Partition-based selection of an array or 1D matrix. Will find the kth smallest value, and mutates the input array. Uses Quickselect.",examples:["partitionSelect([5, 10, 1], 2)",'partitionSelect(["C", "B", "A", "D"], 1)'],seealso:["sort"]},rangeDocs={name:"range",category:"Type",syntax:["start:end","start:step:end","range(start, end)","range(start, end, step)","range(string)"],description:"Create a range. Lower bound of the range is included, upper bound is excluded.",examples:["1:5","3:-1:-3","range(3, 7)","range(0, 12, 2)",'range("4:10")',"a = [1, 2, 3, 4; 5, 6, 7, 8]","a[1:2, 1:2]"],seealso:["concat","det","diag","identity","inv","ones","size","squeeze","subset","trace","transpose","zeros"]},reshapeDocs={name:"reshape",category:"Matrix",syntax:["reshape(x, sizes)"],description:"Reshape a multi dimensional array to fit the specified dimensions.",examples:["reshape([1, 2, 3, 4, 5, 6], [2, 3])","reshape([[1, 2], [3, 4]], [1, 4])","reshape([[1, 2], [3, 4]], [4])"],seealso:["size","squeeze","resize"]},resizeDocs={name:"resize",category:"Matrix",syntax:["resize(x, size)","resize(x, size, defaultValue)"],description:"Resize a matrix.",examples:["resize([1,2,3,4,5], [3])","resize([1,2,3], [5])","resize([1,2,3], [5], -1)","resize(2, [2, 3])",'resize("hello", [8], "!")'],seealso:["size","subset","squeeze","reshape"]},rotateDocs={name:"rotate",category:"Matrix",syntax:["rotate(w, theta)","rotate(w, theta, v)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotate([1, 0], math.pi / 2)",'rotate(matrix([1, 0]), unit("35deg"))','rotate([1, 0, 0], unit("90deg"), [0, 0, 1])','rotate(matrix([1, 0, 0]), unit("90deg"), matrix([0, 0, 1]))'],seealso:["matrix","rotationMatrix"]},rotationMatrixDocs={name:"rotationMatrix",category:"Matrix",syntax:["rotationMatrix(theta)","rotationMatrix(theta, v)","rotationMatrix(theta, v, format)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotationMatrix(pi / 2)",'rotationMatrix(unit("45deg"), [0, 0, 1])','rotationMatrix(1, matrix([0, 0, 1]), "sparse")'],seealso:["cos","sin"]},rowDocs={name:"row",category:"Matrix",syntax:["row(x, index)"],description:"Return a row from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","row(A, 1)","row(A, 2)"],seealso:["column","matrixFromRows"]},sizeDocs={name:"size",category:"Matrix",syntax:["size(x)"],description:"Calculate the size of a matrix.",examples:["size(2.3)",'size("hello world")',"a = [1, 2; 3, 4; 5, 6]","size(a)","size(1:6)"],seealso:["concat","count","det","diag","identity","inv","ones","range","squeeze","subset","trace","transpose","zeros"]},sortDocs={name:"sort",category:"Matrix",syntax:["sort(x)","sort(x, compare)"],description:'Sort the items in a matrix. Compare can be a string "asc", "desc", "natural", or a custom sort function.',examples:["sort([5, 10, 1])",'sort(["C", "B", "A", "D"])',"sortByLength(a, b) = size(a)[1] - size(b)[1]",'sort(["Langdon", "Tom", "Sara"], sortByLength)','sort(["10", "1", "2"], "natural")'],seealso:["map","filter","forEach"]},squeezeDocs={name:"squeeze",category:"Matrix",syntax:["squeeze(x)"],description:"Remove inner and outer singleton dimensions from a matrix.",examples:["a = zeros(3,2,1)","size(squeeze(a))","b = zeros(1,1,3)","size(squeeze(b))"],seealso:["concat","det","diag","identity","inv","ones","range","size","subset","trace","transpose","zeros"]},subsetDocs={name:"subset",category:"Matrix",syntax:["value(index)","value(index) = replacement","subset(value, [index])","subset(value, [index], replacement)"],description:"Get or set a subset of the entries of a matrix or characters of a string. Indexes are one-based. There should be one index specification for each dimension of the target. Each specification can be a single index, a list of indices, or a range in colon notation `l:u`. In a range, both the lower bound l and upper bound u are included; and if a bound is omitted it defaults to the most extreme valid value. The cartesian product of the indices specified in each dimension determines the target of the operation.",examples:["d = [1, 2; 3, 4]","e = []","e[1, 1:2] = [5, 6]","e[2, :] = [7, 8]","f = d * e","f[2, 1]","f[:, 1]","f[[1,2], [1,3]] = [9, 10; 11, 12]","f"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","trace","transpose","zeros"]},traceDocs={name:"trace",category:"Matrix",syntax:["trace(A)"],description:"Calculate the trace of a matrix: the sum of the elements on the main diagonal of a square matrix.",examples:["A = [1, 2, 3; -1, 2, 3; 2, 0, 3]","trace(A)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","transpose","zeros"]},transposeDocs={name:"transpose",category:"Matrix",syntax:["x'","transpose(x)"],description:"Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","transpose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},zerosDocs={name:"zeros",category:"Matrix",syntax:["zeros(m)","zeros(m, n)","zeros(m, n, p, ...)","zeros([m])","zeros([m, n])","zeros([m, n, p, ...])"],description:"Create a matrix containing zeros.",examples:["zeros(3)","zeros(3, 5)","a = [1, 2, 3; 4, 5, 6]","zeros(size(a))"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose"]},fftDocs={name:"fft",category:"Matrix",syntax:["fft(x)"],description:"Calculate N-dimensional fourier transform",examples:["fft([[1, 0], [1, 0]])"],seealso:["ifft"]},ifftDocs={name:"ifft",category:"Matrix",syntax:["ifft(x)"],description:"Calculate N-dimensional inverse fourier transform",examples:["ifft([[2, 2], [0, 0]])"],seealso:["fft"]},combinationsDocs={name:"combinations",category:"Probability",syntax:["combinations(n, k)"],description:"Compute the number of combinations of n items taken k at a time",examples:["combinations(7, 5)"],seealso:["combinationsWithRep","permutations","factorial"]},combinationsWithRepDocs={name:"combinationsWithRep",category:"Probability",syntax:["combinationsWithRep(n, k)"],description:"Compute the number of combinations of n items taken k at a time with replacements.",examples:["combinationsWithRep(7, 5)"],seealso:["combinations","permutations","factorial"]},factorialDocs={name:"factorial",category:"Probability",syntax:["n!","factorial(n)"],description:"Compute the factorial of a value",examples:["5!","5 * 4 * 3 * 2 * 1","3!"],seealso:["combinations","combinationsWithRep","permutations","gamma"]},gammaDocs={name:"gamma",category:"Probability",syntax:["gamma(n)"],description:"Compute the gamma function. For small values, the Lanczos approximation is used, and for large values the extended Stirling approximation.",examples:["gamma(4)","3!","gamma(1/2)","sqrt(pi)"],seealso:["factorial"]},lgammaDocs={name:"lgamma",category:"Probability",syntax:["lgamma(n)"],description:"Logarithm of the gamma function for real, positive numbers and complex numbers, using Lanczos approximation for numbers and Stirling series for complex numbers.",examples:["lgamma(4)","lgamma(1/2)","lgamma(math.i)","lgamma(complex(1.1, 2))"],seealso:["gamma"]},kldivergenceDocs={name:"kldivergence",category:"Probability",syntax:["kldivergence(x, y)"],description:"Calculate the Kullback-Leibler (KL) divergence  between two distributions.",examples:["kldivergence([0.7,0.5,0.4], [0.2,0.9,0.5])"],seealso:[]},multinomialDocs={name:"multinomial",category:"Probability",syntax:["multinomial(A)"],description:"Multinomial Coefficients compute the number of ways of picking a1, a2, ..., ai unordered outcomes from `n` possibilities. multinomial takes one array of integers as an argument. The following condition must be enforced: every ai > 0.",examples:["multinomial([1, 2, 1])"],seealso:["combinations","factorial"]},permutationsDocs={name:"permutations",category:"Probability",syntax:["permutations(n)","permutations(n, k)"],description:"Compute the number of permutations of n items taken k at a time",examples:["permutations(5)","permutations(5, 3)"],seealso:["combinations","combinationsWithRep","factorial"]},pickRandomDocs={name:"pickRandom",category:"Probability",syntax:["pickRandom(array)","pickRandom(array, number)","pickRandom(array, weights)","pickRandom(array, number, weights)","pickRandom(array, weights, number)"],description:"Pick a random entry from a given array.",examples:["pickRandom(0:10)","pickRandom([1, 3, 1, 6])","pickRandom([1, 3, 1, 6], 2)","pickRandom([1, 3, 1, 6], [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], 2, [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], [2, 3, 2, 1], 2)"],seealso:["random","randomInt"]},randomDocs={name:"random",category:"Probability",syntax:["random()","random(max)","random(min, max)","random(size)","random(size, max)","random(size, min, max)"],description:"Return a random number.",examples:["random()","random(10, 20)","random([2, 3])"],seealso:["pickRandom","randomInt"]},randomIntDocs={name:"randomInt",category:"Probability",syntax:["randomInt(max)","randomInt(min, max)","randomInt(size)","randomInt(size, max)","randomInt(size, min, max)"],description:"Return a random integer number",examples:["randomInt(10, 20)","randomInt([2, 3], 10)"],seealso:["pickRandom","random"]},compareDocs={name:"compare",category:"Relational",syntax:["compare(x, y)"],description:"Compare two values. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compare(2, 3)","compare(3, 2)","compare(2, 2)","compare(5cm, 40mm)","compare(2, [1, 2, 3])"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compareNatural","compareText"]},compareNaturalDocs={name:"compareNatural",category:"Relational",syntax:["compareNatural(x, y)"],description:"Compare two values of any type in a deterministic, natural way. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compareNatural(2, 3)","compareNatural(3, 2)","compareNatural(2, 2)","compareNatural(5cm, 40mm)",'compareNatural("2", "10")',"compareNatural(2 + 3i, 2 + 4i)","compareNatural([1, 2, 4], [1, 2, 3])","compareNatural([1, 5], [1, 2, 3])","compareNatural([1, 2], [1, 2])","compareNatural({a: 2}, {a: 4})"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare","compareText"]},compareTextDocs={name:"compareText",category:"Relational",syntax:["compareText(x, y)"],description:"Compare two strings lexically. Comparison is case sensitive. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:['compareText("B", "A")','compareText("A", "B")','compareText("A", "A")','compareText("2", "10")','compare("2", "10")',"compare(2, 10)",'compareNatural("2", "10")','compareText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural"]},deepEqualDocs={name:"deepEqual",category:"Relational",syntax:["deepEqual(x, y)"],description:"Check equality of two matrices element wise. Returns true if the size of both matrices is equal and when and each of the elements are equal.",examples:["deepEqual([1,3,4], [1,3,4])","deepEqual([1,3,4], [1,3])"],seealso:["equal","unequal","smaller","larger","smallerEq","largerEq","compare"]},equalDocs={name:"equal",category:"Relational",syntax:["x == y","equal(x, y)"],description:"Check equality of two values. Returns true if the values are equal, and false if not.",examples:["2+2 == 3","2+2 == 4","a = 3.2","b = 6-2.8","a == b","50cm == 0.5m"],seealso:["unequal","smaller","larger","smallerEq","largerEq","compare","deepEqual","equalText"]},equalTextDocs={name:"equalText",category:"Relational",syntax:["equalText(x, y)"],description:"Check equality of two strings. Comparison is case sensitive. Returns true if the values are equal, and false if not.",examples:['equalText("Hello", "Hello")','equalText("a", "A")','equal("2e3", "2000")','equalText("2e3", "2000")','equalText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural","compareText","equal"]},largerDocs={name:"larger",category:"Relational",syntax:["x > y","larger(x, y)"],description:"Check if value x is larger than y. Returns true if x is larger than y, and false if not.",examples:["2 > 3","5 > 2*2","a = 3.3","b = 6-2.8","(a > b)","(b < a)","5 cm > 2 inch"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare"]},largerEqDocs={name:"largerEq",category:"Relational",syntax:["x >= y","largerEq(x, y)"],description:"Check if value x is larger or equal to y. Returns true if x is larger or equal to y, and false if not.",examples:["2 >= 1+1","2 > 1+1","a = 3.2","b = 6-2.8","(a >= b)"],seealso:["equal","unequal","smallerEq","smaller","compare"]},smallerDocs={name:"smaller",category:"Relational",syntax:["x < y","smaller(x, y)"],description:"Check if value x is smaller than value y. Returns true if x is smaller than y, and false if not.",examples:["2 < 3","5 < 2*2","a = 3.3","b = 6-2.8","(a < b)","5 cm < 2 inch"],seealso:["equal","unequal","larger","smallerEq","largerEq","compare"]},smallerEqDocs={name:"smallerEq",category:"Relational",syntax:["x <= y","smallerEq(x, y)"],description:"Check if value x is smaller or equal to value y. Returns true if x is smaller than y, and false if not.",examples:["2 <= 1+1","2 < 1+1","a = 3.2","b = 6-2.8","(a <= b)"],seealso:["equal","unequal","larger","smaller","largerEq","compare"]},unequalDocs={name:"unequal",category:"Relational",syntax:["x != y","unequal(x, y)"],description:"Check unequality of two values. Returns true if the values are unequal, and false if they are equal.",examples:["2+2 != 3","2+2 != 4","a = 3.2","b = 6-2.8","a != b","50cm != 0.5m","5 cm != 2 inch"],seealso:["equal","smaller","larger","smallerEq","largerEq","compare","deepEqual"]},setCartesianDocs={name:"setCartesian",category:"Set",syntax:["setCartesian(set1, set2)"],description:"Create the cartesian product of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays and the values will be sorted in ascending order before the operation.",examples:["setCartesian([1, 2], [3, 4])"],seealso:["setUnion","setIntersect","setDifference","setPowerset"]},setDifferenceDocs={name:"setDifference",category:"Set",syntax:["setDifference(set1, set2)"],description:"Create the difference of two (multi)sets: every element of set1, that is not the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setDifference([1, 2, 3, 4], [3, 4, 5, 6])","setDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setSymDifference"]},setDistinctDocs={name:"setDistinct",category:"Set",syntax:["setDistinct(set)"],description:"Collect the distinct elements of a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setDistinct([1, 1, 1, 2, 2, 3])"],seealso:["setMultiplicity"]},setIntersectDocs={name:"setIntersect",category:"Set",syntax:["setIntersect(set1, set2)"],description:"Create the intersection of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIntersect([1, 2, 3, 4], [3, 4, 5, 6])","setIntersect([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setDifference"]},setIsSubsetDocs={name:"setIsSubset",category:"Set",syntax:["setIsSubset(set1, set2)"],description:"Check whether a (multi)set is a subset of another (multi)set: every element of set1 is the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIsSubset([1, 2], [3, 4, 5, 6])","setIsSubset([3, 4], [3, 4, 5, 6])"],seealso:["setUnion","setIntersect","setDifference"]},setMultiplicityDocs={name:"setMultiplicity",category:"Set",syntax:["setMultiplicity(element, set)"],description:"Count the multiplicity of an element in a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setMultiplicity(1, [1, 2, 2, 4])","setMultiplicity(2, [1, 2, 2, 4])"],seealso:["setDistinct","setSize"]},setPowersetDocs={name:"setPowerset",category:"Set",syntax:["setPowerset(set)"],description:"Create the powerset of a (multi)set: the powerset contains very possible subsets of a (multi)set. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setPowerset([1, 2, 3])"],seealso:["setCartesian"]},setSizeDocs={name:"setSize",category:"Set",syntax:["setSize(set)","setSize(set, unique)"],description:'Count the number of elements of a (multi)set. When the second parameter "unique" is true, count only the unique values. A multi-dimension array will be converted to a single-dimension array before the operation.',examples:["setSize([1, 2, 2, 4])","setSize([1, 2, 2, 4], true)"],seealso:["setUnion","setIntersect","setDifference"]},setSymDifferenceDocs={name:"setSymDifference",category:"Set",syntax:["setSymDifference(set1, set2)"],description:"Create the symmetric difference of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setSymDifference([1, 2, 3, 4], [3, 4, 5, 6])","setSymDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setDifference"]},setUnionDocs={name:"setUnion",category:"Set",syntax:["setUnion(set1, set2)"],description:"Create the union of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setUnion([1, 2, 3, 4], [3, 4, 5, 6])","setUnion([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setIntersect","setDifference"]},erfDocs={name:"erf",category:"Special",syntax:["erf(x)"],description:"Compute the erf function of a value using a rational Chebyshev approximations for different intervals of x",examples:["erf(0.2)","erf(-0.5)","erf(4)"],seealso:[]},madDocs={name:"mad",category:"Statistics",syntax:["mad(a, b, c, ...)","mad(A)"],description:"Compute the median absolute deviation of a matrix or a list with values. The median absolute deviation is defined as the median of the absolute deviations from the median.",examples:["mad(10, 20, 30)","mad([1, 2, 3])"],seealso:["mean","median","std","abs"]},maxDocs={name:"max",category:"Statistics",syntax:["max(a, b, c, ...)","max(A)","max(A, dim)"],description:"Compute the maximum value of a list of values.",examples:["max(2, 3, 4, 1)","max([2, 3, 4, 1])","max([2, 5; 4, 3])","max([2, 5; 4, 3], 1)","max([2, 5; 4, 3], 2)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["mean","median","min","prod","std","sum","variance"]},meanDocs={name:"mean",category:"Statistics",syntax:["mean(a, b, c, ...)","mean(A)","mean(A, dim)"],description:"Compute the arithmetic mean of a list of values.",examples:["mean(2, 3, 4, 1)","mean([2, 3, 4, 1])","mean([2, 5; 4, 3])","mean([2, 5; 4, 3], 1)","mean([2, 5; 4, 3], 2)","mean([1.0, 2.7, 3.2, 4.0])"],seealso:["max","median","min","prod","std","sum","variance"]},medianDocs={name:"median",category:"Statistics",syntax:["median(a, b, c, ...)","median(A)"],description:"Compute the median of all values. The values are sorted and the middle value is returned. In case of an even number of values, the average of the two middle values is returned.",examples:["median(5, 2, 7)","median([3, -1, 5, 7])"],seealso:["max","mean","min","prod","std","sum","variance","quantileSeq"]},minDocs={name:"min",category:"Statistics",syntax:["min(a, b, c, ...)","min(A)","min(A, dim)"],description:"Compute the minimum value of a list of values.",examples:["min(2, 3, 4, 1)","min([2, 3, 4, 1])","min([2, 5; 4, 3])","min([2, 5; 4, 3], 1)","min([2, 5; 4, 3], 2)","min(2.7, 7.1, -4.5, 2.0, 4.1)","max(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["max","mean","median","prod","std","sum","variance"]},modeDocs={name:"mode",category:"Statistics",syntax:["mode(a, b, c, ...)","mode(A)","mode(A, a, b, B, c, ...)"],description:"Computes the mode of all values as an array. In case mode being more than one, multiple values are returned in an array.",examples:["mode(2, 1, 4, 3, 1)","mode([1, 2.7, 3.2, 4, 2.7])","mode(1, 4, 6, 1, 6)"],seealso:["max","mean","min","median","prod","std","sum","variance"]},prodDocs={name:"prod",category:"Statistics",syntax:["prod(a, b, c, ...)","prod(A)"],description:"Compute the product of all values.",examples:["prod(2, 3, 4)","prod([2, 3, 4])","prod([2, 5; 4, 3])"],seealso:["max","mean","min","median","min","std","sum","variance"]},quantileSeqDocs={name:"quantileSeq",category:"Statistics",syntax:["quantileSeq(A, prob[, sorted])","quantileSeq(A, [prob1, prob2, ...][, sorted])","quantileSeq(A, N[, sorted])"],description:`Compute the prob order quantile of a matrix or a list with values. The sequence is sorted and the middle value is returned. Supported types of sequence values are: Number, BigNumber, Unit Supported types of probablity are: Number, BigNumber. 

In case of a (multi dimensional) array or matrix, the prob order quantile of all elements will be calculated.`,examples:["quantileSeq([3, -1, 5, 7], 0.5)","quantileSeq([3, -1, 5, 7], [1/3, 2/3])","quantileSeq([3, -1, 5, 7], 2)","quantileSeq([-1, 3, 5, 7], 0.5, true)"],seealso:["mean","median","min","max","prod","std","sum","variance"]},stdDocs={name:"std",category:"Statistics",syntax:["std(a, b, c, ...)","std(A)","std(A, normalization)"],description:'Compute the standard deviation of all values, defined as std(A) = sqrt(variance(A)). Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["std(2, 4, 6)","std([2, 4, 6, 8])",'std([2, 4, 6, 8], "uncorrected")','std([2, 4, 6, 8], "biased")',"std([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","prod","sum","variance"]},cumSumDocs={name:"cumsum",category:"Statistics",syntax:["cumsum(a, b, c, ...)","cumsum(A)"],description:"Compute the cumulative sum of all values.",examples:["cumsum(2, 3, 4, 1)","cumsum([2, 3, 4, 1])","cumsum([1, 2; 3, 4])","cumsum([1, 2; 3, 4], 1)","cumsum([1, 2; 3, 4], 2)"],seealso:["max","mean","median","min","prod","std","sum","variance"]},sumDocs={name:"sum",category:"Statistics",syntax:["sum(a, b, c, ...)","sum(A)"],description:"Compute the sum of all values.",examples:["sum(2, 3, 4, 1)","sum([2, 3, 4, 1])","sum([2, 5; 4, 3])"],seealso:["max","mean","median","min","prod","std","sum","variance"]},varianceDocs={name:"variance",category:"Statistics",syntax:["variance(a, b, c, ...)","variance(A)","variance(A, normalization)"],description:'Compute the variance of all values. Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["variance(2, 4, 6)","variance([2, 4, 6, 8])",'variance([2, 4, 6, 8], "uncorrected")','variance([2, 4, 6, 8], "biased")',"variance([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","min","prod","std","sum"]},acosDocs={name:"acos",category:"Trigonometry",syntax:["acos(x)"],description:"Compute the inverse cosine of a value in radians.",examples:["acos(0.5)","acos(cos(2.3))"],seealso:["cos","atan","asin"]},acoshDocs={name:"acosh",category:"Trigonometry",syntax:["acosh(x)"],description:"Calculate the hyperbolic arccos of a value, defined as `acosh(x) = ln(sqrt(x^2 - 1) + x)`.",examples:["acosh(1.5)"],seealso:["cosh","asinh","atanh"]},acotDocs={name:"acot",category:"Trigonometry",syntax:["acot(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acot(0.5)","acot(cot(0.5))","acot(2)"],seealso:["cot","atan"]},acothDocs={name:"acoth",category:"Trigonometry",syntax:["acoth(x)"],description:"Calculate the hyperbolic arccotangent of a value, defined as `acoth(x) = (ln((x+1)/x) + ln(x/(x-1))) / 2`.",examples:["acoth(2)","acoth(0.5)"],seealso:["acsch","asech"]},acscDocs={name:"acsc",category:"Trigonometry",syntax:["acsc(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acsc(2)","acsc(csc(0.5))","acsc(0.5)"],seealso:["csc","asin","asec"]},acschDocs={name:"acsch",category:"Trigonometry",syntax:["acsch(x)"],description:"Calculate the hyperbolic arccosecant of a value, defined as `acsch(x) = ln(1/x + sqrt(1/x^2 + 1))`.",examples:["acsch(0.5)"],seealso:["asech","acoth"]},asecDocs={name:"asec",category:"Trigonometry",syntax:["asec(x)"],description:"Calculate the inverse secant of a value.",examples:["asec(0.5)","asec(sec(0.5))","asec(2)"],seealso:["acos","acot","acsc"]},asechDocs={name:"asech",category:"Trigonometry",syntax:["asech(x)"],description:"Calculate the inverse secant of a value.",examples:["asech(0.5)"],seealso:["acsch","acoth"]},asinDocs={name:"asin",category:"Trigonometry",syntax:["asin(x)"],description:"Compute the inverse sine of a value in radians.",examples:["asin(0.5)","asin(sin(0.5))"],seealso:["sin","acos","atan"]},asinhDocs={name:"asinh",category:"Trigonometry",syntax:["asinh(x)"],description:"Calculate the hyperbolic arcsine of a value, defined as `asinh(x) = ln(x + sqrt(x^2 + 1))`.",examples:["asinh(0.5)"],seealso:["acosh","atanh"]},atanDocs={name:"atan",category:"Trigonometry",syntax:["atan(x)"],description:"Compute the inverse tangent of a value in radians.",examples:["atan(0.5)","atan(tan(0.5))"],seealso:["tan","acos","asin"]},atan2Docs={name:"atan2",category:"Trigonometry",syntax:["atan2(y, x)"],description:"Computes the principal value of the arc tangent of y/x in radians.",examples:["atan2(2, 2) / pi","angle = 60 deg in rad","x = cos(angle)","y = sin(angle)","atan2(y, x)"],seealso:["sin","cos","tan"]},atanhDocs={name:"atanh",category:"Trigonometry",syntax:["atanh(x)"],description:"Calculate the hyperbolic arctangent of a value, defined as `atanh(x) = ln((1 + x)/(1 - x)) / 2`.",examples:["atanh(0.5)"],seealso:["acosh","asinh"]},cosDocs={name:"cos",category:"Trigonometry",syntax:["cos(x)"],description:"Compute the cosine of x in radians.",examples:["cos(2)","cos(pi / 4) ^ 2","cos(180 deg)","cos(60 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["acos","sin","tan"]},coshDocs={name:"cosh",category:"Trigonometry",syntax:["cosh(x)"],description:"Compute the hyperbolic cosine of x in radians.",examples:["cosh(0.5)"],seealso:["sinh","tanh","coth"]},cotDocs={name:"cot",category:"Trigonometry",syntax:["cot(x)"],description:"Compute the cotangent of x in radians. Defined as 1/tan(x)",examples:["cot(2)","1 / tan(2)"],seealso:["sec","csc","tan"]},cothDocs={name:"coth",category:"Trigonometry",syntax:["coth(x)"],description:"Compute the hyperbolic cotangent of x in radians.",examples:["coth(2)","1 / tanh(2)"],seealso:["sech","csch","tanh"]},cscDocs={name:"csc",category:"Trigonometry",syntax:["csc(x)"],description:"Compute the cosecant of x in radians. Defined as 1/sin(x)",examples:["csc(2)","1 / sin(2)"],seealso:["sec","cot","sin"]},cschDocs={name:"csch",category:"Trigonometry",syntax:["csch(x)"],description:"Compute the hyperbolic cosecant of x in radians. Defined as 1/sinh(x)",examples:["csch(2)","1 / sinh(2)"],seealso:["sech","coth","sinh"]},secDocs={name:"sec",category:"Trigonometry",syntax:["sec(x)"],description:"Compute the secant of x in radians. Defined as 1/cos(x)",examples:["sec(2)","1 / cos(2)"],seealso:["cot","csc","cos"]},sechDocs={name:"sech",category:"Trigonometry",syntax:["sech(x)"],description:"Compute the hyperbolic secant of x in radians. Defined as 1/cosh(x)",examples:["sech(2)","1 / cosh(2)"],seealso:["coth","csch","cosh"]},sinDocs={name:"sin",category:"Trigonometry",syntax:["sin(x)"],description:"Compute the sine of x in radians.",examples:["sin(2)","sin(pi / 4) ^ 2","sin(90 deg)","sin(30 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["asin","cos","tan"]},sinhDocs={name:"sinh",category:"Trigonometry",syntax:["sinh(x)"],description:"Compute the hyperbolic sine of x in radians.",examples:["sinh(0.5)"],seealso:["cosh","tanh"]},tanDocs={name:"tan",category:"Trigonometry",syntax:["tan(x)"],description:"Compute the tangent of x in radians.",examples:["tan(0.5)","sin(0.5) / cos(0.5)","tan(pi / 4)","tan(45 deg)"],seealso:["atan","sin","cos"]},tanhDocs={name:"tanh",category:"Trigonometry",syntax:["tanh(x)"],description:"Compute the hyperbolic tangent of x in radians.",examples:["tanh(0.5)","sinh(0.5) / cosh(0.5)"],seealso:["sinh","cosh"]},toDocs={name:"to",category:"Units",syntax:["x to unit","to(x, unit)"],description:"Change the unit of a value.",examples:["5 inch to cm","3.2kg to g","16 bytes in bits"],seealso:[]},binDocs={name:"bin",category:"Utils",syntax:["bin(value)"],description:"Format a number as binary",examples:["bin(2)"],seealso:["oct","hex"]},cloneDocs={name:"clone",category:"Utils",syntax:["clone(x)"],description:"Clone a variable. Creates a copy of primitive variables,and a deep copy of matrices",examples:["clone(3.5)","clone(2 - 4i)","clone(45 deg)","clone([1, 2; 3, 4])",'clone("hello world")'],seealso:[]},formatDocs={name:"format",category:"Utils",syntax:["format(value)","format(value, precision)"],description:"Format a value of any type as string.",examples:["format(2.3)","format(3 - 4i)","format([])","format(pi, 3)"],seealso:["print"]},hasNumericValueDocs={name:"hasNumericValue",category:"Utils",syntax:["hasNumericValue(x)"],description:"Test whether a value is an numeric value. In case of a string, true is returned if the string contains a numeric value.",examples:["hasNumericValue(2)",'hasNumericValue("2")','isNumeric("2")',"hasNumericValue(0)","hasNumericValue(bignumber(500))","hasNumericValue(fraction(0.125))","hasNumericValue(2 + 3i)",'hasNumericValue([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","isNumeric"]},hexDocs={name:"hex",category:"Utils",syntax:["hex(value)"],description:"Format a number as hexadecimal",examples:["hex(240)"],seealso:["bin","oct"]},isIntegerDocs={name:"isInteger",category:"Utils",syntax:["isInteger(x)"],description:"Test whether a value is an integer number.",examples:["isInteger(2)","isInteger(3.5)","isInteger([3, 0.5, -2])"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isNaNDocs={name:"isNaN",category:"Utils",syntax:["isNaN(x)"],description:"Test whether a value is NaN (not a number)",examples:["isNaN(2)","isNaN(0 / 0)","isNaN(NaN)","isNaN(Infinity)"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isNegativeDocs={name:"isNegative",category:"Utils",syntax:["isNegative(x)"],description:"Test whether a value is negative: smaller than zero.",examples:["isNegative(2)","isNegative(0)","isNegative(-4)","isNegative([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isPositive","isZero"]},isNumericDocs={name:"isNumeric",category:"Utils",syntax:["isNumeric(x)"],description:"Test whether a value is a numeric value. Returns true when the input is a number, BigNumber, Fraction, or boolean.",examples:["isNumeric(2)",'isNumeric("2")','hasNumericValue("2")',"isNumeric(0)","isNumeric(bignumber(500))","isNumeric(fraction(0.125))","isNumeric(2 + 3i)",'isNumeric([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","hasNumericValue"]},isPositiveDocs={name:"isPositive",category:"Utils",syntax:["isPositive(x)"],description:"Test whether a value is positive: larger than zero.",examples:["isPositive(2)","isPositive(0)","isPositive(-4)","isPositive([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isPrimeDocs={name:"isPrime",category:"Utils",syntax:["isPrime(x)"],description:"Test whether a value is prime: has no divisors other than itself and one.",examples:["isPrime(3)","isPrime(-2)","isPrime([2, 17, 100])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isZeroDocs={name:"isZero",category:"Utils",syntax:["isZero(x)"],description:"Test whether a value is zero.",examples:["isZero(2)","isZero(0)","isZero(-4)","isZero([3, 0, -2, 0])"],seealso:["isInteger","isNumeric","isNegative","isPositive"]},numericDocs={name:"numeric",category:"Utils",syntax:["numeric(x)"],description:"Convert a numeric input to a specific numeric type: number, BigNumber, or Fraction.",examples:['numeric("4")','numeric("4", "number")','numeric("4", "BigNumber")','numeric("4", "Fraction)','numeric(4, "Fraction")','numeric(fraction(2, 5), "number)'],seealso:["number","fraction","bignumber","string","format"]},octDocs={name:"oct",category:"Utils",syntax:["oct(value)"],description:"Format a number as octal",examples:["oct(56)"],seealso:["bin","hex"]},printDocs={name:"print",category:"Utils",syntax:["print(template, values)","print(template, values, precision)"],description:"Interpolate values into a string template.",examples:['print("Lucy is $age years old", {age: 5})','print("The value of pi is $pi", {pi: pi}, 3)','print("Hello, $user.name!", {user: {name: "John"}})','print("Values: $0, $1, $2", [6, 9, 4])'],seealso:["format"]},typeOfDocs={name:"typeOf",category:"Utils",syntax:["typeOf(x)"],description:"Get the type of a variable.",examples:["typeOf(3.5)","typeOf(2 - 4i)","typeOf(45 deg)",'typeOf("hello world")'],seealso:["getMatrixDataType"]},embeddedDocs={bignumber:bignumberDocs,boolean:booleanDocs,complex:complexDocs,createUnit:createUnitDocs,fraction:fractionDocs,index:indexDocs,matrix:matrixDocs,number:numberDocs,sparse:sparseDocs,splitUnit:splitUnitDocs,string:stringDocs,unit:unitDocs,e:eDocs,E:eDocs,false:falseDocs,i:iDocs,Infinity:InfinityDocs,LN2:LN2Docs,LN10:LN10Docs,LOG2E:LOG2EDocs,LOG10E:LOG10EDocs,NaN:NaNDocs,null:nullDocs,pi:piDocs,PI:piDocs,phi:phiDocs,SQRT1_2:SQRT12Docs,SQRT2:SQRT2Docs,tau:tauDocs,true:trueDocs,version:versionDocs,speedOfLight:{description:"Speed of light in vacuum",examples:["speedOfLight"]},gravitationConstant:{description:"Newtonian constant of gravitation",examples:["gravitationConstant"]},planckConstant:{description:"Planck constant",examples:["planckConstant"]},reducedPlanckConstant:{description:"Reduced Planck constant",examples:["reducedPlanckConstant"]},magneticConstant:{description:"Magnetic constant (vacuum permeability)",examples:["magneticConstant"]},electricConstant:{description:"Electric constant (vacuum permeability)",examples:["electricConstant"]},vacuumImpedance:{description:"Characteristic impedance of vacuum",examples:["vacuumImpedance"]},coulomb:{description:"Coulomb's constant",examples:["coulomb"]},elementaryCharge:{description:"Elementary charge",examples:["elementaryCharge"]},bohrMagneton:{description:"Borh magneton",examples:["bohrMagneton"]},conductanceQuantum:{description:"Conductance quantum",examples:["conductanceQuantum"]},inverseConductanceQuantum:{description:"Inverse conductance quantum",examples:["inverseConductanceQuantum"]},magneticFluxQuantum:{description:"Magnetic flux quantum",examples:["magneticFluxQuantum"]},nuclearMagneton:{description:"Nuclear magneton",examples:["nuclearMagneton"]},klitzing:{description:"Von Klitzing constant",examples:["klitzing"]},bohrRadius:{description:"Borh radius",examples:["bohrRadius"]},classicalElectronRadius:{description:"Classical electron radius",examples:["classicalElectronRadius"]},electronMass:{description:"Electron mass",examples:["electronMass"]},fermiCoupling:{description:"Fermi coupling constant",examples:["fermiCoupling"]},fineStructure:{description:"Fine-structure constant",examples:["fineStructure"]},hartreeEnergy:{description:"Hartree energy",examples:["hartreeEnergy"]},protonMass:{description:"Proton mass",examples:["protonMass"]},deuteronMass:{description:"Deuteron Mass",examples:["deuteronMass"]},neutronMass:{description:"Neutron mass",examples:["neutronMass"]},quantumOfCirculation:{description:"Quantum of circulation",examples:["quantumOfCirculation"]},rydberg:{description:"Rydberg constant",examples:["rydberg"]},thomsonCrossSection:{description:"Thomson cross section",examples:["thomsonCrossSection"]},weakMixingAngle:{description:"Weak mixing angle",examples:["weakMixingAngle"]},efimovFactor:{description:"Efimov factor",examples:["efimovFactor"]},atomicMass:{description:"Atomic mass constant",examples:["atomicMass"]},avogadro:{description:"Avogadro's number",examples:["avogadro"]},boltzmann:{description:"Boltzmann constant",examples:["boltzmann"]},faraday:{description:"Faraday constant",examples:["faraday"]},firstRadiation:{description:"First radiation constant",examples:["firstRadiation"]},loschmidt:{description:"Loschmidt constant at T=273.15 K and p=101.325 kPa",examples:["loschmidt"]},gasConstant:{description:"Gas constant",examples:["gasConstant"]},molarPlanckConstant:{description:"Molar Planck constant",examples:["molarPlanckConstant"]},molarVolume:{description:"Molar volume of an ideal gas at T=273.15 K and p=101.325 kPa",examples:["molarVolume"]},sackurTetrode:{description:"Sackur-Tetrode constant at T=1 K and p=101.325 kPa",examples:["sackurTetrode"]},secondRadiation:{description:"Second radiation constant",examples:["secondRadiation"]},stefanBoltzmann:{description:"Stefan-Boltzmann constant",examples:["stefanBoltzmann"]},wienDisplacement:{description:"Wien displacement law constant",examples:["wienDisplacement"]},molarMass:{description:"Molar mass constant",examples:["molarMass"]},molarMassC12:{description:"Molar mass constant of carbon-12",examples:["molarMassC12"]},gravity:{description:"Standard acceleration of gravity (standard acceleration of free-fall on Earth)",examples:["gravity"]},planckLength:{description:"Planck length",examples:["planckLength"]},planckMass:{description:"Planck mass",examples:["planckMass"]},planckTime:{description:"Planck time",examples:["planckTime"]},planckCharge:{description:"Planck charge",examples:["planckCharge"]},planckTemperature:{description:"Planck temperature",examples:["planckTemperature"]},derivative:derivativeDocs,lsolve:lsolveDocs,lsolveAll:lsolveAllDocs,lup:lupDocs,lusolve:lusolveDocs,leafCount:leafCountDocs,resolve:resolveDocs,simplify:simplifyDocs,simplifyCore:simplifyCoreDocs,symbolicEqual:symbolicEqualDocs,rationalize:rationalizeDocs,slu:sluDocs,usolve:usolveDocs,usolveAll:usolveAllDocs,qr:qrDocs,abs:absDocs,add:addDocs,cbrt:cbrtDocs,ceil:ceilDocs,cube:cubeDocs,divide:divideDocs,dotDivide:dotDivideDocs,dotMultiply:dotMultiplyDocs,dotPow:dotPowDocs,exp:expDocs,expm:expmDocs,expm1:expm1Docs,fix:fixDocs,floor:floorDocs,gcd:gcdDocs,hypot:hypotDocs,lcm:lcmDocs,log:logDocs,log2:log2Docs,log1p:log1pDocs,log10:log10Docs,mod:modDocs,multiply:multiplyDocs,norm:normDocs,nthRoot:nthRootDocs,nthRoots:nthRootsDocs,pow:powDocs,round:roundDocs,sign:signDocs,sqrt:sqrtDocs,sqrtm:sqrtmDocs,square:squareDocs,subtract:subtractDocs,unaryMinus:unaryMinusDocs,unaryPlus:unaryPlusDocs,xgcd:xgcdDocs,invmod:invmodDocs,bitAnd:bitAndDocs,bitNot:bitNotDocs,bitOr:bitOrDocs,bitXor:bitXorDocs,leftShift:leftShiftDocs,rightArithShift:rightArithShiftDocs,rightLogShift:rightLogShiftDocs,bellNumbers:bellNumbersDocs,catalan:catalanDocs,composition:compositionDocs,stirlingS2:stirlingS2Docs,config:configDocs,import:importDocs,typed:typedDocs,arg:argDocs,conj:conjDocs,re:reDocs,im:imDocs,evaluate:evaluateDocs,help:helpDocs,distance:distanceDocs,intersect:intersectDocs,and:andDocs,not:notDocs,or:orDocs,xor:xorDocs,concat:concatDocs,count:countDocs,cross:crossDocs,column:columnDocs,ctranspose:ctransposeDocs,det:detDocs,diag:diagDocs,diff:diffDocs,dot:dotDocs,getMatrixDataType:getMatrixDataTypeDocs,identity:identityDocs,filter:filterDocs,flatten:flattenDocs,forEach:forEachDocs,inv:invDocs,pinv:pinvDocs,eigs:eigsDocs,kron:kronDocs,matrixFromFunction:matrixFromFunctionDocs,matrixFromRows:matrixFromRowsDocs,matrixFromColumns:matrixFromColumnsDocs,map:mapDocs,ones:onesDocs,partitionSelect:partitionSelectDocs,range:rangeDocs,resize:resizeDocs,reshape:reshapeDocs,rotate:rotateDocs,rotationMatrix:rotationMatrixDocs,row:rowDocs,size:sizeDocs,sort:sortDocs,squeeze:squeezeDocs,subset:subsetDocs,trace:traceDocs,transpose:transposeDocs,zeros:zerosDocs,fft:fftDocs,ifft:ifftDocs,combinations:combinationsDocs,combinationsWithRep:combinationsWithRepDocs,factorial:factorialDocs,gamma:gammaDocs,kldivergence:kldivergenceDocs,lgamma:lgammaDocs,multinomial:multinomialDocs,permutations:permutationsDocs,pickRandom:pickRandomDocs,random:randomDocs,randomInt:randomIntDocs,compare:compareDocs,compareNatural:compareNaturalDocs,compareText:compareTextDocs,deepEqual:deepEqualDocs,equal:equalDocs,equalText:equalTextDocs,larger:largerDocs,largerEq:largerEqDocs,smaller:smallerDocs,smallerEq:smallerEqDocs,unequal:unequalDocs,setCartesian:setCartesianDocs,setDifference:setDifferenceDocs,setDistinct:setDistinctDocs,setIntersect:setIntersectDocs,setIsSubset:setIsSubsetDocs,setMultiplicity:setMultiplicityDocs,setPowerset:setPowersetDocs,setSize:setSizeDocs,setSymDifference:setSymDifferenceDocs,setUnion:setUnionDocs,erf:erfDocs,cumsum:cumSumDocs,mad:madDocs,max:maxDocs,mean:meanDocs,median:medianDocs,min:minDocs,mode:modeDocs,prod:prodDocs,quantileSeq:quantileSeqDocs,std:stdDocs,sum:sumDocs,variance:varianceDocs,acos:acosDocs,acosh:acoshDocs,acot:acotDocs,acoth:acothDocs,acsc:acscDocs,acsch:acschDocs,asec:asecDocs,asech:asechDocs,asin:asinDocs,asinh:asinhDocs,atan:atanDocs,atanh:atanhDocs,atan2:atan2Docs,cos:cosDocs,cosh:coshDocs,cot:cotDocs,coth:cothDocs,csc:cscDocs,csch:cschDocs,sec:secDocs,sech:sechDocs,sin:sinDocs,sinh:sinhDocs,tan:tanDocs,tanh:tanhDocs,to:toDocs,clone:cloneDocs,format:formatDocs,bin:binDocs,oct:octDocs,hex:hexDocs,isNaN:isNaNDocs,isInteger:isIntegerDocs,isNegative:isNegativeDocs,isNumeric:isNumericDocs,hasNumericValue:hasNumericValueDocs,isPositive:isPositiveDocs,isPrime:isPrimeDocs,isZero:isZeroDocs,print:printDocs,typeOf:typeOfDocs,numeric:numericDocs},name$_="help",dependencies$_=["typed","mathWithTransform","Help"],createHelp=factory(name$_,dependencies$_,ss=>{var{typed:ts,mathWithTransform:rs,Help:ns}=ss;return ts(name$_,{any:function(is){var as,os=is;if(typeof is!="string"){for(as in rs)if(hasOwnProperty$2(rs,as)&&is===rs[as]){os=as;break}}var ls=getSafeProperty(embeddedDocs,os);if(!ls){var us=typeof os=="function"?os.name:os;throw new Error('No documentation found on "'+us+'"')}return new ns(ls)}})}),name$Z="chain",dependencies$Z=["typed","Chain"],createChain=factory(name$Z,dependencies$Z,ss=>{var{typed:ts,Chain:rs}=ss;return ts(name$Z,{"":function(){return new rs},any:function(ns){return new rs(ns)}})}),name$Y="det",dependencies$Y=["typed","matrix","subtract","multiply","divideScalar","isZero","unaryMinus"],createDet=factory(name$Y,dependencies$Y,ss=>{var{typed:ts,matrix:rs,subtract:ns,multiply:is,divideScalar:as,isZero:os,unaryMinus:ls}=ss;return ts(name$Y,{any:function(us){return clone$3(us)},"Array | Matrix":function(us){var cs;switch((cs=isMatrix(us)?us.size():Array.isArray(us)?(us=rs(us)).size():[]).length){case 0:return clone$3(us);case 1:if(cs[0]===1)return clone$3(us.valueOf()[0]);throw new RangeError("Matrix must be square (size: "+format$1(cs)+")");case 2:var ps=cs[0];if(ps===cs[1])return function(ds,fs,hs){if(fs===1)return clone$3(ds[0][0]);if(fs===2)return ns(is(ds[0][0],ds[1][1]),is(ds[1][0],ds[0][1]));for(var ys=!1,gs=new Array(fs).fill(0).map((Ss,Ds)=>Ds),bs=0;bs<fs;bs++){var vs=gs[bs];if(os(ds[vs][bs])){var Ns=void 0;for(Ns=bs+1;Ns<fs;Ns++)if(!os(ds[gs[Ns]][bs])){vs=gs[Ns],gs[Ns]=gs[bs],gs[bs]=vs,ys=!ys;break}if(Ns===fs)return ds[vs][bs]}for(var Ts=ds[vs][bs],Cs=bs===0?1:ds[gs[bs-1]][bs-1],xs=bs+1;xs<fs;xs++)for(var As=gs[xs],ws=bs+1;ws<fs;ws++)ds[As][ws]=as(ns(is(ds[As][ws],Ts),is(ds[As][bs],ds[vs][ws])),Cs)}var Es=ds[gs[fs-1]][fs-1];return ys?ls(Es):Es}(us.clone().valueOf(),ps);throw new RangeError("Matrix must be square (size: "+format$1(cs)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+format$1(cs)+")")}}})}),name$X="inv",dependencies$X=["typed","matrix","divideScalar","addScalar","multiply","unaryMinus","det","identity","abs"],createInv=factory(name$X,dependencies$X,ss=>{var{typed:ts,matrix:rs,divideScalar:ns,addScalar:is,multiply:as,unaryMinus:os,det:ls,identity:us,abs:cs}=ss;return ts(name$X,{"Array | Matrix":function(ds){var fs=isMatrix(ds)?ds.size():arraySize(ds);switch(fs.length){case 1:if(fs[0]===1)return isMatrix(ds)?rs([ns(1,ds.valueOf()[0])]):[ns(1,ds[0])];throw new RangeError("Matrix must be square (size: "+format$1(fs)+")");case 2:var hs=fs[0],ys=fs[1];if(hs===ys)return isMatrix(ds)?rs(ps(ds.valueOf(),hs,ys),ds.storage()):ps(ds,hs,ys);throw new RangeError("Matrix must be square (size: "+format$1(fs)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+format$1(fs)+")")}},any:function(ds){return ns(1,ds)}});function ps(ds,fs,hs){var ys,gs,bs,vs,Ns;if(fs===1){if((vs=ds[0][0])===0)throw Error("Cannot calculate inverse, determinant is zero");return[[ns(1,vs)]]}if(fs===2){var Ts=ls(ds);if(Ts===0)throw Error("Cannot calculate inverse, determinant is zero");return[[ns(ds[1][1],Ts),ns(os(ds[0][1]),Ts)],[ns(os(ds[1][0]),Ts),ns(ds[0][0],Ts)]]}var Cs=ds.concat();for(ys=0;ys<fs;ys++)Cs[ys]=Cs[ys].concat();for(var xs=us(fs).valueOf(),As=0;As<hs;As++){var ws=cs(Cs[As][As]),Es=As;for(ys=As+1;ys<fs;)cs(Cs[ys][As])>ws&&(ws=cs(Cs[ys][As]),Es=ys),ys++;if(ws===0)throw Error("Cannot calculate inverse, determinant is zero");(ys=Es)!==As&&(Ns=Cs[As],Cs[As]=Cs[ys],Cs[ys]=Ns,Ns=xs[As],xs[As]=xs[ys],xs[ys]=Ns);var Ss=Cs[As],Ds=xs[As];for(ys=0;ys<fs;ys++){var Vs=Cs[ys],Is=xs[ys];if(ys!==As){if(Vs[As]!==0){for(bs=ns(os(Vs[As]),Ss[As]),gs=As;gs<hs;gs++)Vs[gs]=is(Vs[gs],as(bs,Ss[gs]));for(gs=0;gs<hs;gs++)Is[gs]=is(Is[gs],as(bs,Ds[gs]))}}else{for(bs=Ss[As],gs=As;gs<hs;gs++)Vs[gs]=ns(Vs[gs],bs);for(gs=0;gs<hs;gs++)Is[gs]=ns(Is[gs],bs)}}}return xs}}),name$W="pinv",dependencies$W=["typed","matrix","inv","deepEqual","equal","dotDivide","dot","ctranspose","divideScalar","multiply","add","Complex"],createPinv=factory(name$W,dependencies$W,ss=>{var{typed:ts,matrix:rs,inv:ns,deepEqual:is,equal:as,dotDivide:os,dot:ls,ctranspose:us,divideScalar:cs,multiply:ps,add:ds,Complex:fs}=ss;return ts(name$W,{"Array | Matrix":function(bs){var vs=isMatrix(bs)?bs.size():arraySize(bs);switch(vs.length){case 1:return gs(bs)?us(bs):vs[0]===1?ns(bs):os(us(bs),ls(bs,bs));case 2:if(gs(bs))return us(bs);var Ns=vs[0],Ts=vs[1];if(Ns===Ts)try{return ns(bs)}catch(Cs){if(!(Cs instanceof Error&&Cs.message.match(/Cannot calculate inverse, determinant is zero/)))throw Cs}return isMatrix(bs)?rs(hs(bs.valueOf(),Ns,Ts),bs.storage()):hs(bs,Ns,Ts);default:throw new RangeError("Matrix must be two dimensional (size: "+format$1(vs)+")")}},any:function(bs){return as(bs,0)?clone$3(bs):cs(1,bs)}});function hs(bs,vs,Ns){var{C:Ts,F:Cs}=function(ws,Es,Ss){var Ds=function(Os,Ps,$s){for(var Rs=clone$3(Os),ks=0,_s=0;_s<Ps;_s++){if($s<=ks)return Rs;for(var Bs=_s;ys(Rs[Bs][ks]);)if(Ps===++Bs&&(Bs=_s,$s===++ks))return Rs;[Rs[Bs],Rs[_s]]=[Rs[_s],Rs[Bs]];for(var Us=Rs[_s][ks],zs=0;zs<$s;zs++)Rs[_s][zs]=os(Rs[_s][zs],Us);for(var Hs=0;Hs<Ps;Hs++)if(Hs!==_s){Us=Rs[Hs][ks];for(var el=0;el<$s;el++)Rs[Hs][el]=ds(Rs[Hs][el],ps(-1,ps(Us,Rs[_s][el])))}ks++}return Rs}(ws,Es,Ss),Vs=ws.map((Os,Ps)=>Os.filter(($s,Rs)=>Rs<Es&&!ys(ls(Ds[Rs],Ds[Rs])))),Is=Ds.filter((Os,Ps)=>!ys(ls(Ds[Ps],Ds[Ps])));return{C:Vs,F:Is}}(bs,vs,Ns),xs=ps(ns(ps(us(Ts),Ts)),us(Ts)),As=ps(us(Cs),ns(ps(Cs,us(Cs))));return ps(As,xs)}function ys(bs){return as(ds(bs,fs(1,1)),ds(0,fs(1,1)))}function gs(bs){return is(ds(bs,fs(1,1)),ds(ps(bs,0),fs(1,1)))}});function createComplexEigs(ss){var{addScalar:ts,subtract:rs,flatten:ns,multiply:is,multiplyScalar:as,divideScalar:os,sqrt:ls,abs:us,bignumber:cs,diag:ps,inv:ds,qr:fs,usolve:hs,usolveAll:ys,equal:gs,complex:bs,larger:vs,smaller:Ns,matrixFromColumns:Ts,dot:Cs}=ss;function xs(Ps,$s,Rs,ks){var _s=ts(Ps,ks),Bs=rs(as(Ps,ks),as($s,Rs)),Us=as(_s,.5),zs=as(ls(rs(as(_s,_s),as(4,Bs))),.5);return[ts(Us,zs),rs(Us,zs)]}function As(Ps,$s,Rs,ks,_s,Bs,Us,zs){var Hs=zs==="BigNumber",el=zs==="Complex",Ys=Hs?cs(0):el?bs(0):0,il=Hs?cs(1):el?bs(1):1;if(Ns(us(Rs),Us))return[[il,Ys],[Ys,il]];if(vs(us(rs(_s,Bs)),Us))return[[rs(_s,ks),rs(Bs,ks)],[Rs,Rs]];var al=rs(Ps,_s),ll=rs($s,_s),nl=rs(Rs,_s),cl=rs(ks,_s);return Ns(us(ll),Us)?[[al,il],[nl,Ys]]:[[ll,Ys],[cl,il]]}function ws(Ps,$s){for(var Rs=0;Rs<Ps.length;Rs++)Ps[Rs].push(...Array($s-Ps[Rs].length).fill(0));for(var ks=Ps.length;ks<$s;ks++)Ps.push(Array($s).fill(0)),Ps[ks][ks]=1;return Ps}function Es(Ps,$s,Rs){for(var ks=0;ks<Ps.length;ks++)if(Rs(Ps[ks],$s))return ks;return-1}function Ss(Ps,$s,Rs,ks,_s){for(var Bs,Us=_s==="BigNumber"?cs(1e3):1e3,zs=0;Bs=Ds($s,Rs,_s),Bs=hs(Ps,Bs),!vs(Is(Bs),Us);)if(++zs>=5)return null;for(zs=0;;){var Hs=hs(Ps,Bs);if(Ns(Is(Vs(Bs,[Hs])),ks))break;if(++zs>=10)return null;Bs=Os(Hs)}return Bs}function Ds(Ps,$s,Rs){var ks=Rs==="BigNumber",_s=Rs==="Complex",Bs=Array(Ps).fill(0).map(Us=>2*Math.random()-1);return ks&&(Bs=Bs.map(Us=>cs(Us))),_s&&(Bs=Bs.map(Us=>bs(Us))),Os(Bs=Vs(Bs,$s),Rs)}function Vs(Ps,$s){for(var Rs of $s)Ps=rs(Ps,is(os(Cs(Rs,Ps),Cs(Rs,Rs)),Rs));return Ps}function Is(Ps){return us(ls(Cs(Ps,Ps)))}function Os(Ps,$s){var Rs=$s==="Complex",ks=$s==="BigNumber"?cs(1):Rs?bs(1):1;return is(os(ks,Is(Ps)),Ps)}return function(Ps,$s,Rs,ks,_s){_s===void 0&&(_s=!0);var Bs=function(el,Ys,il,al,ll){var nl,cl=al==="BigNumber",dl=al==="Complex",sl=cl?cs(0):0,js=cl?cs(1):dl?bs(1):1,Ls=cl?cs(1):1,Ws=cl?cs(10):2,Zs=as(Ws,Ws);ll&&(nl=Array(Ys).fill(js));for(var tl=!1;!tl;){tl=!0;for(var rl=0;rl<Ys;rl++){for(var qs=sl,Gs=sl,Xs=0;Xs<Ys;Xs++)if(rl!==Xs){var Ks=us(el[rl][Xs]);qs=ts(qs,Ks),Gs=ts(Gs,Ks)}if(!gs(qs,0)&&!gs(Gs,0)){for(var ol=Ls,Fs=qs,Qs=os(Gs,Ws),Js=as(Gs,Ws);Ns(Fs,Qs);)Fs=as(Fs,Zs),ol=as(ol,Ws);for(;vs(Fs,Js);)Fs=os(Fs,Zs),ol=os(ol,Ws);if(Ns(os(ts(Fs,Gs),ol),as(ts(qs,Gs),.95))){tl=!1;for(var ul=os(1,ol),pl=0;pl<Ys;pl++)rl!==pl&&(el[rl][pl]=as(el[rl][pl],ol),el[pl][rl]=as(el[pl][rl],ul));ll&&(nl[rl]=as(nl[rl],ol))}}}}return ps(nl)}(Ps,$s,0,ks,_s);(function(el,Ys,il,al,ll,nl){var cl=al==="BigNumber",dl=al==="Complex",sl=cl?cs(0):dl?bs(0):0;cl&&(il=cs(il));for(var js=0;js<Ys-2;js++){for(var Ls=0,Ws=sl,Zs=js+1;Zs<Ys;Zs++){var tl=el[Zs][js];Ns(us(Ws),us(tl))&&(Ws=tl,Ls=Zs)}if(!Ns(us(Ws),il)){if(Ls!==js+1){var rl=el[Ls];el[Ls]=el[js+1],el[js+1]=rl;for(var qs=0;qs<Ys;qs++){var Gs=el[qs][Ls];el[qs][Ls]=el[qs][js+1],el[qs][js+1]=Gs}if(ll){var Xs=nl[Ls];nl[Ls]=nl[js+1],nl[js+1]=Xs}}for(var Ks=js+2;Ks<Ys;Ks++){var ol=os(el[Ks][js],Ws);if(ol!==0){for(var Fs=0;Fs<Ys;Fs++)el[Ks][Fs]=rs(el[Ks][Fs],as(ol,el[js+1][Fs]));for(var Qs=0;Qs<Ys;Qs++)el[Qs][js+1]=ts(el[Qs][js+1],as(ol,el[Qs][Ks]));if(ll)for(var Js=0;Js<Ys;Js++)nl[Ks][Js]=rs(nl[Ks][Js],as(ol,nl[js+1][Js]))}}}}})(Ps,$s,Rs,ks,_s,Bs);var Us,{values:zs,C:Hs}=function(el,Ys,il,al,ll){var nl=al==="BigNumber",cl=al==="Complex",dl=nl?cs(1):cl?bs(1):1;nl&&(il=cs(il));for(var sl=clone$3(el),js=[],Ls=Ys,Ws=[],Zs=ll?ps(Array(Ys).fill(dl)):void 0,tl=ll?ps(Array(Ls).fill(dl)):void 0,rl=0;rl<=100;){rl+=1;for(var qs=0,Gs=0;Gs<Ls;Gs++)sl[Gs][Gs]=rs(sl[Gs][Gs],qs);var{Q:Xs,R:Ks}=fs(sl);sl=is(Ks,Xs);for(var ol=0;ol<Ls;ol++)sl[ol][ol]=ts(sl[ol][ol],qs);if(ll&&(tl=is(tl,Xs)),Ls===1||Ns(us(sl[Ls-1][Ls-2]),il)){rl=0,js.push(sl[Ls-1][Ls-1]),ll&&(Ws.unshift([[1]]),ws(tl,Ys),Zs=is(Zs,tl),Ls>1&&(tl=ps(Array(Ls-1).fill(dl)))),Ls-=1,sl.pop();for(var Fs=0;Fs<Ls;Fs++)sl[Fs].pop()}else if(Ls===2||Ns(us(sl[Ls-2][Ls-3]),il)){rl=0;var Qs=xs(sl[Ls-2][Ls-2],sl[Ls-2][Ls-1],sl[Ls-1][Ls-2],sl[Ls-1][Ls-1]);js.push(...Qs),ll&&(Ws.unshift(As(sl[Ls-2][Ls-2],sl[Ls-2][Ls-1],sl[Ls-1][Ls-2],sl[Ls-1][Ls-1],Qs[0],Qs[1],il,al)),ws(tl,Ys),Zs=is(Zs,tl),Ls>2&&(tl=ps(Array(Ls-2).fill(dl)))),Ls-=2,sl.pop(),sl.pop();for(var Js=0;Js<Ls;Js++)sl[Js].pop(),sl[Js].pop()}if(Ls===0)break}if(js.sort((ml,fl)=>+rs(us(ml),us(fl))),rl>100){var ul=Error("The eigenvalues failed to converge. Only found these eigenvalues: "+js.join(", "));throw ul.values=js,ul.vectors=[],ul}var pl=ll?is(Zs,function(ml,fl){for(var hl=[],yl=0;yl<fl;yl++)hl[yl]=Array(fl).fill(0);var bl=0;for(var Tl of ml){for(var Nl=Tl.length,gl=0;gl<Nl;gl++)for(var vl=0;vl<Nl;vl++)hl[bl+gl][bl+vl]=Tl[gl][vl];bl+=Nl}return hl}(Ws,Ys)):void 0;return{values:js,C:pl}}(Ps,$s,Rs,ks,_s);return _s&&(Us=function(el,Ys,il,al,ll,nl,cl){var dl=ds(il),sl=is(dl,el,il),js=cl==="BigNumber",Ls=cl==="Complex",Ws=js?cs(0):Ls?bs(0):0,Zs=js?cs(1):Ls?bs(1):1,tl=[],rl=[];for(var qs of ll){var Gs=Es(tl,qs,gs);Gs===-1?(tl.push(qs),rl.push(1)):rl[Gs]+=1}for(var Xs=[],Ks=tl.length,ol=Array(Ys).fill(Ws),Fs=ps(Array(Ys).fill(Zs)),Qs=[],Js=function(ml){var fl=tl[ml],hl=rs(sl,is(fl,Fs)),yl=ys(hl,ol);for(yl.shift();yl.length<rl[ml];){var bl=Ss(hl,Ys,yl,nl,cl);if(bl==null){Qs.push(fl);break}yl.push(bl)}var Tl=is(ds(al),il);yl=yl.map(Nl=>is(Tl,Nl)),Xs.push(...yl.map(Nl=>ns(Nl)))},ul=0;ul<Ks;ul++)Js(ul);if(Qs.length!==0){var pl=new Error("Failed to find eigenvectors for the following eigenvalues: "+Qs.join(", "));throw pl.values=ll,pl.vectors=Xs,pl}return Xs}(Ps,$s,Hs,Bs,zs,Rs,ks),Us=Ts(...Us)),{values:zs,vectors:Us}}}function createRealSymmetric(ss){var{config:ts,addScalar:rs,subtract:ns,abs:is,atan:as,cos:os,sin:ls,multiplyScalar:us,inv:cs,bignumber:ps,multiply:ds,add:fs}=ss;function hs(ws,Es,Ss){var Ds=Es-ws;return Math.abs(Ds)<=ts.epsilon?Math.PI/4:.5*Math.atan(2*Ss/(Es-ws))}function ys(ws,Es,Ss){var Ds=ns(Es,ws);return is(Ds)<=ts.epsilon?ps(-1).acos().div(4):us(.5,as(ds(2,Ss,cs(Ds))))}function gs(ws,Es,Ss,Ds){for(var Vs=ws.length,Is=Math.cos(Es),Os=Math.sin(Es),Ps=As(Vs,0),$s=As(Vs,0),Rs=0;Rs<Vs;Rs++)Ps[Rs]=Is*ws[Rs][Ss]-Os*ws[Rs][Ds],$s[Rs]=Os*ws[Rs][Ss]+Is*ws[Rs][Ds];for(var ks=0;ks<Vs;ks++)ws[ks][Ss]=Ps[ks],ws[ks][Ds]=$s[ks];return ws}function bs(ws,Es,Ss,Ds){for(var Vs=ws.length,Is=os(Es),Os=ls(Es),Ps=As(Vs,ps(0)),$s=As(Vs,ps(0)),Rs=0;Rs<Vs;Rs++)Ps[Rs]=ns(us(Is,ws[Rs][Ss]),us(Os,ws[Rs][Ds])),$s[Rs]=rs(us(Os,ws[Rs][Ss]),us(Is,ws[Rs][Ds]));for(var ks=0;ks<Vs;ks++)ws[ks][Ss]=Ps[ks],ws[ks][Ds]=$s[ks];return ws}function vs(ws,Es,Ss,Ds){for(var Vs=ws.length,Is=ps(os(Es)),Os=ps(ls(Es)),Ps=us(Is,Is),$s=us(Os,Os),Rs=As(Vs,ps(0)),ks=As(Vs,ps(0)),_s=ds(ps(2),Is,Os,ws[Ss][Ds]),Bs=rs(ns(us(Ps,ws[Ss][Ss]),_s),us($s,ws[Ds][Ds])),Us=fs(us($s,ws[Ss][Ss]),_s,us(Ps,ws[Ds][Ds])),zs=0;zs<Vs;zs++)Rs[zs]=ns(us(Is,ws[Ss][zs]),us(Os,ws[Ds][zs])),ks[zs]=rs(us(Os,ws[Ss][zs]),us(Is,ws[Ds][zs]));ws[Ss][Ss]=Bs,ws[Ds][Ds]=Us,ws[Ss][Ds]=ps(0),ws[Ds][Ss]=ps(0);for(var Hs=0;Hs<Vs;Hs++)Hs!==Ss&&Hs!==Ds&&(ws[Ss][Hs]=Rs[Hs],ws[Hs][Ss]=Rs[Hs],ws[Ds][Hs]=ks[Hs],ws[Hs][Ds]=ks[Hs]);return ws}function Ns(ws,Es,Ss,Ds){for(var Vs=ws.length,Is=Math.cos(Es),Os=Math.sin(Es),Ps=Is*Is,$s=Os*Os,Rs=As(Vs,0),ks=As(Vs,0),_s=Ps*ws[Ss][Ss]-2*Is*Os*ws[Ss][Ds]+$s*ws[Ds][Ds],Bs=$s*ws[Ss][Ss]+2*Is*Os*ws[Ss][Ds]+Ps*ws[Ds][Ds],Us=0;Us<Vs;Us++)Rs[Us]=Is*ws[Ss][Us]-Os*ws[Ds][Us],ks[Us]=Os*ws[Ss][Us]+Is*ws[Ds][Us];ws[Ss][Ss]=_s,ws[Ds][Ds]=Bs,ws[Ss][Ds]=0,ws[Ds][Ss]=0;for(var zs=0;zs<Vs;zs++)zs!==Ss&&zs!==Ds&&(ws[Ss][zs]=Rs[zs],ws[zs][Ss]=Rs[zs],ws[Ds][zs]=ks[zs],ws[zs][Ds]=ks[zs]);return ws}function Ts(ws){for(var Es=ws.length,Ss=0,Ds=[0,1],Vs=0;Vs<Es;Vs++)for(var Is=Vs+1;Is<Es;Is++)Math.abs(Ss)<Math.abs(ws[Vs][Is])&&(Ss=Math.abs(ws[Vs][Is]),Ds=[Vs,Is]);return[Ds,Ss]}function Cs(ws){for(var Es=ws.length,Ss=0,Ds=[0,1],Vs=0;Vs<Es;Vs++)for(var Is=Vs+1;Is<Es;Is++)is(Ss)<is(ws[Vs][Is])&&(Ss=is(ws[Vs][Is]),Ds=[Vs,Is]);return[Ds,Ss]}function xs(ws,Es){for(var Ss=ws.length,Ds=Array(Ss),Vs=Array(Ss),Is=0;Is<Ss;Is++)Vs[Is]=Array(Ss);for(var Os=0;Os<Ss;Os++){for(var Ps=0,$s=ws[0],Rs=0;Rs<ws.length;Rs++)is(ws[Rs])<is($s)&&($s=ws[Ps=Rs]);Ds[Os]=ws.splice(Ps,1)[0];for(var ks=0;ks<Ss;ks++)Vs[ks][Os]=Es[ks][Ps],Es[ks].splice(Ps,1)}return{values:Ds,vectors:Vs}}function As(ws,Es){for(var Ss=new Array(ws),Ds=0;Ds<ws;Ds++)Ss[Ds]=Es;return Ss}return function(ws,Es){var Ss=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ts.epsilon,Ds=arguments.length>3?arguments[3]:void 0;if(Ds==="number")return function(Vs,Is){for(var Os,Ps=Vs.length,$s=Math.abs(Is/Ps),Rs=new Array(Ps),ks=0;ks<Ps;ks++)Rs[ks]=As(Ps,0),Rs[ks][ks]=1;for(var _s=Ts(Vs);Math.abs(_s[1])>=Math.abs($s);){var Bs=_s[0][0],Us=_s[0][1];Vs=Ns(Vs,Os=hs(Vs[Bs][Bs],Vs[Us][Us],Vs[Bs][Us]),Bs,Us),Rs=gs(Rs,Os,Bs,Us),_s=Ts(Vs)}for(var zs=As(Ps,0),Hs=0;Hs<Ps;Hs++)zs[Hs]=Vs[Hs][Hs];return xs(clone$3(zs),clone$3(Rs))}(ws,Ss);if(Ds==="BigNumber")return function(Vs,Is){for(var Os,Ps=Vs.length,$s=is(Is/Ps),Rs=new Array(Ps),ks=0;ks<Ps;ks++)Rs[ks]=As(Ps,0),Rs[ks][ks]=1;for(var _s=Cs(Vs);is(_s[1])>=is($s);){var Bs=_s[0][0],Us=_s[0][1];Vs=vs(Vs,Os=ys(Vs[Bs][Bs],Vs[Us][Us],Vs[Bs][Us]),Bs,Us),Rs=bs(Rs,Os,Bs,Us),_s=Cs(Vs)}for(var zs=As(Ps,0),Hs=0;Hs<Ps;Hs++)zs[Hs]=Vs[Hs][Hs];return xs(clone$3(zs),clone$3(Rs))}(ws,Ss);throw TypeError("Unsupported data type: "+Ds)}}var name$V="eigs",dependencies$V=["config","typed","matrix","addScalar","equal","subtract","abs","atan","cos","sin","multiplyScalar","divideScalar","inv","bignumber","multiply","add","larger","column","flatten","number","complex","sqrt","diag","qr","usolve","usolveAll","im","re","smaller","matrixFromColumns","dot"],createEigs=factory(name$V,dependencies$V,ss=>{var{config:ts,typed:rs,matrix:ns,addScalar:is,subtract:as,equal:os,abs:ls,atan:us,cos:cs,sin:ps,multiplyScalar:ds,divideScalar:fs,inv:hs,bignumber:ys,multiply:gs,add:bs,larger:vs,column:Ns,flatten:Ts,number:Cs,complex:xs,sqrt:As,diag:ws,qr:Es,usolve:Ss,usolveAll:Ds,im:Vs,re:Is,smaller:Os,matrixFromColumns:Ps,dot:$s}=ss,Rs=createRealSymmetric({config:ts,addScalar:is,subtract:as,column:Ns,flatten:Ts,equal:os,abs:ls,atan:us,cos:cs,sin:ps,multiplyScalar:ds,inv:hs,bignumber:ys,complex:xs,multiply:gs,add:bs}),ks=createComplexEigs({config:ts,addScalar:is,subtract:as,multiply:gs,multiplyScalar:ds,flatten:Ts,divideScalar:fs,sqrt:As,abs:ls,bignumber:ys,diag:ws,qr:Es,inv:hs,usolve:Ss,usolveAll:Ds,equal:os,complex:xs,larger:vs,smaller:Os,matrixFromColumns:Ps,dot:$s});return rs("eigs",{Array:function(Us){return _s(ns(Us))},"Array, number|BigNumber":function(Us,zs){return _s(ns(Us),zs)},Matrix:function(Us){var{values:zs,vectors:Hs}=_s(Us);return{values:ns(zs),vectors:ns(Hs)}},"Matrix, number|BigNumber":function(Us,zs){var{values:Hs,vectors:el}=_s(Us,zs);return{values:ns(Hs),vectors:ns(el)}}});function _s(Us,zs){zs===void 0&&(zs=ts.epsilon);var Hs=Us.size();if(Hs.length!==2||Hs[0]!==Hs[1])throw new RangeError("Matrix must be square (size: "+format$1(Hs)+")");var el=Us.toArray(),Ys=Hs[0];if(function(ll,nl,cl){for(var dl=0;dl<nl;dl++)for(var sl=0;sl<nl;sl++)if(vs(ys(ls(Vs(ll[dl][sl]))),cl))return!1;return!0}(el,Ys,zs)&&(function(ll,nl){for(var cl=0;cl<nl;cl++)for(var dl=0;dl<nl;dl++)ll[cl][dl]=Is(ll[cl][dl])}(el,Ys),function(ll,nl,cl){for(var dl=0;dl<nl;dl++)for(var sl=dl;sl<nl;sl++)if(vs(ys(ls(as(ll[dl][sl],ll[sl][dl]))),cl))return!1;return!0}(el,Ys,zs))){var il=Bs(Us,el,Ys);return Rs(el,Ys,zs,il)}var al=Bs(Us,el,Ys);return ks(el,Ys,zs,al)}function Bs(Us,zs,Hs){var el=Us.datatype();if(el==="number"||el==="BigNumber"||el==="Complex")return el;for(var Ys=!1,il=!1,al=!1,ll=0;ll<Hs;ll++)for(var nl=0;nl<Hs;nl++){var cl=zs[ll][nl];if(isNumber$1(cl)||isFraction(cl))Ys=!0;else if(isBigNumber(cl))il=!0;else{if(!isComplex(cl))throw TypeError("Unsupported type in Matrix: "+typeOf$1(cl));al=!0}}if(il&&al&&console.warn("Complex BigNumbers not supported, this operation will lose precission."),al){for(var dl=0;dl<Hs;dl++)for(var sl=0;sl<Hs;sl++)zs[dl][sl]=xs(zs[dl][sl]);return"Complex"}if(il){for(var js=0;js<Hs;js++)for(var Ls=0;Ls<Hs;Ls++)zs[js][Ls]=ys(zs[js][Ls]);return"BigNumber"}if(Ys){for(var Ws=0;Ws<Hs;Ws++)for(var Zs=0;Zs<Hs;Zs++)zs[Ws][Zs]=Cs(zs[Ws][Zs]);return"number"}throw TypeError("Matrix contains unsupported types only.")}}),name$U="expm",dependencies$U=["typed","abs","add","identity","inv","multiply"],createExpm=factory(name$U,dependencies$U,ss=>{var{typed:ts,abs:rs,add:ns,identity:is,inv:as,multiply:os}=ss;return ts(name$U,{Matrix:function(us){var cs=us.size();if(cs.length!==2||cs[0]!==cs[1])throw new RangeError("Matrix must be square (size: "+format$1(cs)+")");for(var ps=cs[0],ds=function(Es){for(var Ss=Es.size()[0],Ds=0,Vs=0;Vs<Ss;Vs++){for(var Is=0,Os=0;Os<Ss;Os++)Is+=rs(Es.get([Vs,Os]));Ds=Math.max(Is,Ds)}return Ds}(us),fs=function(Es,Ss){for(var Ds=30,Vs=0;Vs<Ds;Vs++)for(var Is=0;Is<=Vs;Is++){var Os=Vs-Is;if(ls(Es,Is,Os)<Ss)return{q:Is,j:Os}}throw new Error("Could not find acceptable parameters to compute the matrix exponential (try increasing maxSearchSize in expm.js)")}(ds,1e-15),hs=fs.q,ys=fs.j,gs=os(us,Math.pow(2,-ys)),bs=is(ps),vs=is(ps),Ns=1,Ts=gs,Cs=-1,xs=1;xs<=hs;xs++)xs>1&&(Ts=os(Ts,gs),Cs=-Cs),bs=ns(bs,os(Ns=Ns*(hs-xs+1)/((2*hs-xs+1)*xs),Ts)),vs=ns(vs,os(Ns*Cs,Ts));for(var As=os(as(vs),bs),ws=0;ws<ys;ws++)As=os(As,As);return isSparseMatrix(us)?us.createSparseMatrix(As):As}});function ls(us,cs,ps){for(var ds=1,fs=2;fs<=cs;fs++)ds*=fs;for(var hs=ds,ys=cs+1;ys<=2*cs;ys++)hs*=ys;var gs=hs*(2*cs+1);return 8*Math.pow(us/Math.pow(2,ps),2*cs)*ds*ds/(hs*gs)}}),name$T="sqrtm",dependencies$T=["typed","abs","add","multiply","sqrt","subtract","inv","size","max","identity"],createSqrtm=factory(name$T,dependencies$T,ss=>{var{typed:ts,abs:rs,add:ns,multiply:is,sqrt:as,subtract:os,inv:ls,size:us,max:cs,identity:ps}=ss,ds=1e3,fs=1e-6;function hs(ys){var gs,bs=0,vs=ys,Ns=ps(us(ys));do{var Ts=vs;if(vs=is(.5,ns(Ts,ls(Ns))),Ns=is(.5,ns(Ns,ls(Ts))),(gs=cs(rs(os(vs,Ts))))>fs&&++bs>ds)throw new Error("computing square root of matrix: iterative method could not converge")}while(gs>fs);return vs}return ts(name$T,{"Array | Matrix":function(ys){var gs=isMatrix(ys)?ys.size():arraySize(ys);switch(gs.length){case 1:if(gs[0]===1)return as(ys);throw new RangeError("Matrix must be square (size: "+format$1(gs)+")");case 2:if(gs[0]===gs[1])return hs(ys);throw new RangeError("Matrix must be square (size: "+format$1(gs)+")");default:throw new RangeError("Matrix must be at most two dimensional (size: "+format$1(gs)+")")}}})}),name$S="divide",dependencies$S=["typed","matrix","multiply","equalScalar","divideScalar","inv"],createDivide=factory(name$S,dependencies$S,ss=>{var{typed:ts,matrix:rs,multiply:ns,equalScalar:is,divideScalar:as,inv:os}=ss,ls=createAlgorithm11({typed:ts,equalScalar:is}),us=createAlgorithm14({typed:ts});return ts("divide",extend$2({"Array | Matrix, Array | Matrix":function(cs,ps){return ns(cs,os(ps))},"DenseMatrix, any":function(cs,ps){return us(cs,ps,as,!1)},"SparseMatrix, any":function(cs,ps){return ls(cs,ps,as,!1)},"Array, any":function(cs,ps){return us(rs(cs),ps,as,!1).valueOf()},"any, Array | Matrix":function(cs,ps){return ns(cs,os(ps))}},as.signatures))}),name$R="distance",dependencies$R=["typed","addScalar","subtract","divideScalar","multiplyScalar","unaryMinus","sqrt","abs"],createDistance=factory(name$R,dependencies$R,ss=>{var{typed:ts,addScalar:rs,subtract:ns,multiplyScalar:is,divideScalar:as,unaryMinus:os,sqrt:ls,abs:us}=ss;return ts(name$R,{"Array, Array, Array":function(Ns,Ts,Cs){if(Ns.length===2&&Ts.length===2&&Cs.length===2){if(!ps(Ns))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!ps(Ts))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!ps(Cs))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");var xs=as(ns(Cs[1],Cs[0]),ns(Ts[1],Ts[0])),As=is(is(xs,xs),Ts[0]),ws=os(is(xs,Ts[0])),Es=Ns[1];return gs(Ns[0],Ns[1],As,ws,Es)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object, Object":function(Ns,Ts,Cs){if(Object.keys(Ns).length===2&&Object.keys(Ts).length===2&&Object.keys(Cs).length===2){if(!ps(Ns))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!ps(Ts))throw new TypeError("Values of lineOnePtX and lineOnePtY should be numbers or BigNumbers");if(!ps(Cs))throw new TypeError("Values of lineTwoPtX and lineTwoPtY should be numbers or BigNumbers");if("pointX"in Ns&&"pointY"in Ns&&"lineOnePtX"in Ts&&"lineOnePtY"in Ts&&"lineTwoPtX"in Cs&&"lineTwoPtY"in Cs){var xs=as(ns(Cs.lineTwoPtY,Cs.lineTwoPtX),ns(Ts.lineOnePtY,Ts.lineOnePtX)),As=is(is(xs,xs),Ts.lineOnePtX),ws=os(is(xs,Ts.lineOnePtX)),Es=Ns.pointX;return gs(Ns.pointX,Ns.pointY,As,ws,Es)}throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},"Array, Array":function(Ns,Ts){if(Ns.length===2&&Ts.length===3){if(!ps(Ns))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!ds(Ts))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");return gs(Ns[0],Ns[1],Ts[0],Ts[1],Ts[2])}if(Ns.length===3&&Ts.length===6){if(!ds(Ns))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!hs(Ts))throw new TypeError("Array with 6 numbers or BigNumbers expected for second argument");return bs(Ns[0],Ns[1],Ns[2],Ts[0],Ts[1],Ts[2],Ts[3],Ts[4],Ts[5])}if(Ns.length===Ts.length&&Ns.length>0){if(!fs(Ns))throw new TypeError("All values of an array should be numbers or BigNumbers");if(!fs(Ts))throw new TypeError("All values of an array should be numbers or BigNumbers");return vs(Ns,Ts)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object":function(Ns,Ts){if(Object.keys(Ns).length===2&&Object.keys(Ts).length===3){if(!ps(Ns))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!ds(Ts))throw new TypeError("Values of xCoeffLine, yCoeffLine and constant should be numbers or BigNumbers");if("pointX"in Ns&&"pointY"in Ns&&"xCoeffLine"in Ts&&"yCoeffLine"in Ts&&"constant"in Ts)return gs(Ns.pointX,Ns.pointY,Ts.xCoeffLine,Ts.yCoeffLine,Ts.constant);throw new TypeError("Key names do not match")}if(Object.keys(Ns).length===3&&Object.keys(Ts).length===6){if(!ds(Ns))throw new TypeError("Values of pointX, pointY and pointZ should be numbers or BigNumbers");if(!hs(Ts))throw new TypeError("Values of x0, y0, z0, a, b and c should be numbers or BigNumbers");if("pointX"in Ns&&"pointY"in Ns&&"x0"in Ts&&"y0"in Ts&&"z0"in Ts&&"a"in Ts&&"b"in Ts&&"c"in Ts)return bs(Ns.pointX,Ns.pointY,Ns.pointZ,Ts.x0,Ts.y0,Ts.z0,Ts.a,Ts.b,Ts.c);throw new TypeError("Key names do not match")}if(Object.keys(Ns).length===2&&Object.keys(Ts).length===2){if(!ps(Ns))throw new TypeError("Values of pointOneX and pointOneY should be numbers or BigNumbers");if(!ps(Ts))throw new TypeError("Values of pointTwoX and pointTwoY should be numbers or BigNumbers");if("pointOneX"in Ns&&"pointOneY"in Ns&&"pointTwoX"in Ts&&"pointTwoY"in Ts)return vs([Ns.pointOneX,Ns.pointOneY],[Ts.pointTwoX,Ts.pointTwoY]);throw new TypeError("Key names do not match")}if(Object.keys(Ns).length===3&&Object.keys(Ts).length===3){if(!ds(Ns))throw new TypeError("Values of pointOneX, pointOneY and pointOneZ should be numbers or BigNumbers");if(!ds(Ts))throw new TypeError("Values of pointTwoX, pointTwoY and pointTwoZ should be numbers or BigNumbers");if("pointOneX"in Ns&&"pointOneY"in Ns&&"pointOneZ"in Ns&&"pointTwoX"in Ts&&"pointTwoY"in Ts&&"pointTwoZ"in Ts)return vs([Ns.pointOneX,Ns.pointOneY,Ns.pointOneZ],[Ts.pointTwoX,Ts.pointTwoY,Ts.pointTwoZ]);throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},Array:function(Ns){if(!function(Ts){if(Ts[0].length===2&&cs(Ts[0][0])&&cs(Ts[0][1])){if(Ts.some(Cs=>Cs.length!==2||!cs(Cs[0])||!cs(Cs[1])))return!1}else if(!(Ts[0].length===3&&cs(Ts[0][0])&&cs(Ts[0][1])&&cs(Ts[0][2]))||Ts.some(Cs=>Cs.length!==3||!cs(Cs[0])||!cs(Cs[1])||!cs(Cs[2])))return!1;return!0}(Ns))throw new TypeError("Incorrect array format entered for pairwise distance calculation");return function(Ts){for(var Cs=[],xs=[],As=[],ws=0;ws<Ts.length-1;ws++)for(var Es=ws+1;Es<Ts.length;Es++)Ts[0].length===2?(xs=[Ts[ws][0],Ts[ws][1]],As=[Ts[Es][0],Ts[Es][1]]):Ts[0].length===3&&(xs=[Ts[ws][0],Ts[ws][1],Ts[ws][2]],As=[Ts[Es][0],Ts[Es][1],Ts[Es][2]]),Cs.push(vs(xs,As));return Cs}(Ns)}});function cs(Ns){return typeof Ns=="number"||isBigNumber(Ns)}function ps(Ns){return Ns.constructor!==Array&&(Ns=ys(Ns)),cs(Ns[0])&&cs(Ns[1])}function ds(Ns){return Ns.constructor!==Array&&(Ns=ys(Ns)),cs(Ns[0])&&cs(Ns[1])&&cs(Ns[2])}function fs(Ns){return Array.isArray(Ns)||(Ns=ys(Ns)),Ns.every(cs)}function hs(Ns){return Ns.constructor!==Array&&(Ns=ys(Ns)),cs(Ns[0])&&cs(Ns[1])&&cs(Ns[2])&&cs(Ns[3])&&cs(Ns[4])&&cs(Ns[5])}function ys(Ns){for(var Ts=Object.keys(Ns),Cs=[],xs=0;xs<Ts.length;xs++)Cs.push(Ns[Ts[xs]]);return Cs}function gs(Ns,Ts,Cs,xs,As){var ws=us(rs(rs(is(Cs,Ns),is(xs,Ts)),As)),Es=ls(rs(is(Cs,Cs),is(xs,xs)));return as(ws,Es)}function bs(Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds){var Vs=[ns(is(ns(As,Ts),Ds),is(ns(ws,Cs),Ss)),ns(is(ns(ws,Cs),Es),is(ns(xs,Ns),Ds)),ns(is(ns(xs,Ns),Ss),is(ns(As,Ts),Es))];Vs=ls(rs(rs(is(Vs[0],Vs[0]),is(Vs[1],Vs[1])),is(Vs[2],Vs[2])));var Is=ls(rs(rs(is(Es,Es),is(Ss,Ss)),is(Ds,Ds)));return as(Vs,Is)}function vs(Ns,Ts){for(var Cs=Ns.length,xs=0,As=0,ws=0;ws<Cs;ws++)As=ns(Ns[ws],Ts[ws]),xs=rs(is(As,As),xs);return ls(xs)}}),name$Q="intersect",dependencies$Q=["typed","config","abs","add","addScalar","matrix","multiply","multiplyScalar","divideScalar","subtract","smaller","equalScalar","flatten","isZero","isNumeric"],createIntersect=factory(name$Q,dependencies$Q,ss=>{var{typed:ts,config:rs,abs:ns,add:is,addScalar:as,matrix:os,multiply:ls,multiplyScalar:us,divideScalar:cs,subtract:ps,smaller:ds,equalScalar:fs,flatten:hs,isZero:ys,isNumeric:gs}=ss;return ts("intersect",{"Array, Array, Array":bs,"Array, Array, Array, Array":vs,"Matrix, Matrix, Matrix":function(As,ws,Es){var Ss=bs(As.valueOf(),ws.valueOf(),Es.valueOf());return Ss===null?null:os(Ss)},"Matrix, Matrix, Matrix, Matrix":function(As,ws,Es,Ss){var Ds=vs(As.valueOf(),ws.valueOf(),Es.valueOf(),Ss.valueOf());return Ds===null?null:os(Ds)}});function bs(As,ws,Es){if(As=Ns(As),ws=Ns(ws),Es=Ns(Es),!Cs(As))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!Cs(ws))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!function(Ss){return Ss.length===4&&gs(Ss[0])&&gs(Ss[1])&&gs(Ss[2])&&gs(Ss[3])}(Es))throw new TypeError("Array with 4 numbers expected as third argument");return function(Ss,Ds,Vs,Is,Os,Ps,$s,Rs,ks,_s){var Bs=us(Ss,$s),Us=us(Is,$s),zs=us(Ds,Rs),Hs=us(Os,Rs),el=us(Vs,ks),Ys=us(Ps,ks),il=ps(ps(ps(_s,Bs),zs),el),al=ps(ps(ps(as(as(Us,Hs),Ys),Bs),zs),el),ll=cs(il,al),nl=as(Ss,us(ll,ps(Is,Ss))),cl=as(Ds,us(ll,ps(Os,Ds))),dl=as(Vs,us(ll,ps(Ps,Vs)));return[nl,cl,dl]}(As[0],As[1],As[2],ws[0],ws[1],ws[2],Es[0],Es[1],Es[2],Es[3])}function vs(As,ws,Es,Ss){if(As=Ns(As),ws=Ns(ws),Es=Ns(Es),Ss=Ns(Ss),As.length===2){if(!Ts(As))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!Ts(ws))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!Ts(Es))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");if(!Ts(Ss))throw new TypeError("Array with 2 numbers or BigNumbers expected for fourth argument");return function(Ds,Vs,Is,Os){var Ps=Ds,$s=Is,Rs=ps(Ps,Vs),ks=ps($s,Os),_s=ps(us(Rs[0],ks[1]),us(ks[0],Rs[1]));if(ys(_s)||ds(ns(_s),rs.epsilon))return null;var Bs=us(ks[0],Ps[1]),Us=us(ks[1],Ps[0]),zs=us(ks[0],$s[1]),Hs=us(ks[1],$s[0]),el=cs(as(ps(ps(Bs,Us),zs),Hs),_s);return is(ls(Rs,el),Ps)}(As,ws,Es,Ss)}if(As.length===3){if(!Cs(As))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!Cs(ws))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!Cs(Es))throw new TypeError("Array with 3 numbers or BigNumbers expected for third argument");if(!Cs(Ss))throw new TypeError("Array with 3 numbers or BigNumbers expected for fourth argument");return function(Ds,Vs,Is,Os,Ps,$s,Rs,ks,_s,Bs,Us,zs){var Hs=xs(Ds,Rs,Bs,Rs,Vs,ks,Us,ks,Is,_s,zs,_s),el=xs(Bs,Rs,Os,Ds,Us,ks,Ps,Vs,zs,_s,$s,Is),Ys=xs(Ds,Rs,Os,Ds,Vs,ks,Ps,Vs,Is,_s,$s,Is),il=xs(Bs,Rs,Bs,Rs,Us,ks,Us,ks,zs,_s,zs,_s),al=xs(Os,Ds,Os,Ds,Ps,Vs,Ps,Vs,$s,Is,$s,Is),ll=ps(us(Hs,el),us(Ys,il)),nl=ps(us(al,il),us(el,el));if(ys(nl))return null;var cl=cs(ll,nl),dl=cs(as(Hs,us(cl,el)),il),sl=as(Ds,us(cl,ps(Os,Ds))),js=as(Vs,us(cl,ps(Ps,Vs))),Ls=as(Is,us(cl,ps($s,Is))),Ws=as(Rs,us(dl,ps(Bs,Rs))),Zs=as(ks,us(dl,ps(Us,ks))),tl=as(_s,us(dl,ps(zs,_s)));return fs(sl,Ws)&&fs(js,Zs)&&fs(Ls,tl)?[sl,js,Ls]:null}(As[0],As[1],As[2],ws[0],ws[1],ws[2],Es[0],Es[1],Es[2],Ss[0],Ss[1],Ss[2])}throw new TypeError("Arrays with two or thee dimensional points expected")}function Ns(As){return As.length===1?As[0]:As.length>1&&Array.isArray(As[0])&&As.every(ws=>Array.isArray(ws)&&ws.length===1)?hs(As):As}function Ts(As){return As.length===2&&gs(As[0])&&gs(As[1])}function Cs(As){return As.length===3&&gs(As[0])&&gs(As[1])&&gs(As[2])}function xs(As,ws,Es,Ss,Ds,Vs,Is,Os,Ps,$s,Rs,ks){var _s=us(ps(As,ws),ps(Es,Ss)),Bs=us(ps(Ds,Vs),ps(Is,Os)),Us=us(ps(Ps,$s),ps(Rs,ks));return as(as(_s,Bs),Us)}}),name$P="sum",dependencies$P=["typed","config","add","numeric"],createSum=factory(name$P,dependencies$P,ss=>{var{typed:ts,config:rs,add:ns,numeric:is}=ss;return ts(name$P,{"Array | Matrix":as,"Array | Matrix, number | BigNumber":function(os,ls){try{return reduce$2(os,ls,ns)}catch(us){throw improveErrorMessage(us,"sum")}},"...":function(os){if(containsCollections(os))throw new TypeError("Scalar values expected in function sum");return as(os)}});function as(os){var ls;return deepForEach(os,function(us){try{ls=ls===void 0?us:ns(ls,us)}catch(cs){throw improveErrorMessage(cs,"sum",us)}}),ls===void 0&&(ls=is(0,rs.number)),typeof ls=="string"&&(ls=is(ls,rs.number)),ls}}),name$O="cumsum",dependencies$O=["typed","add","unaryPlus"],createCumSum=factory(name$O,dependencies$O,ss=>{var{typed:ts,add:rs,unaryPlus:ns}=ss;return ts(name$O,{Array:is,Matrix:function(us){return us.create(is(us.valueOf()))},"Array, number | BigNumber":os,"Matrix, number | BigNumber":function(us,cs){return us.create(os(us.valueOf(),cs))},"...":function(us){if(containsCollections(us))throw new TypeError("All values expected to be scalar in function cumsum");return is(us)}});function is(us){try{return as(us)}catch(cs){throw improveErrorMessage(cs,name$O)}}function as(us){if(us.length===0)return[];for(var cs=[ns(us[0])],ps=1;ps<us.length;++ps)cs.push(rs(cs[ps-1],us[ps]));return cs}function os(us,cs){var ps=arraySize(us);if(cs<0||cs>=ps.length)throw new IndexError(cs,ps.length);try{return ls(us,cs)}catch(ds){throw improveErrorMessage(ds,name$O)}}function ls(us,cs){var ps,ds,fs;if(cs<=0){var hs=us[0][0];if(Array.isArray(hs)){for(fs=_switch$1(us),ds=[],ps=0;ps<fs.length;ps++)ds[ps]=ls(fs[ps],cs-1);return ds}return as(us)}for(ds=[],ps=0;ps<us.length;ps++)ds[ps]=ls(us[ps],cs-1);return ds}}),name$N="mean",dependencies$N=["typed","add","divide"],createMean=factory(name$N,dependencies$N,ss=>{var{typed:ts,add:rs,divide:ns}=ss;return ts(name$N,{"Array | Matrix":is,"Array | Matrix, number | BigNumber":function(as,os){try{var ls=reduce$2(as,os,rs),us=Array.isArray(as)?arraySize(as):as.size();return ns(ls,us[os])}catch(cs){throw improveErrorMessage(cs,"mean")}},"...":function(as){if(containsCollections(as))throw new TypeError("Scalar values expected in function mean");return is(as)}});function is(as){var os,ls=0;if(deepForEach(as,function(us){try{os=os===void 0?us:rs(os,us),ls++}catch(cs){throw improveErrorMessage(cs,"mean",us)}}),ls===0)throw new Error("Cannot calculate the mean of an empty array");return ns(os,ls)}}),name$M="median",dependencies$M=["typed","add","divide","compare","partitionSelect"],createMedian=factory(name$M,dependencies$M,ss=>{var{typed:ts,add:rs,divide:ns,compare:is,partitionSelect:as}=ss;function os(cs){try{var ps=(cs=flatten$4(cs.valueOf())).length;if(ps===0)throw new Error("Cannot calculate median of an empty array");if(ps%2==0){for(var ds=ps/2-1,fs=as(cs,ds+1),hs=cs[ds],ys=0;ys<ds;++ys)is(cs[ys],hs)>0&&(hs=cs[ys]);return us(hs,fs)}var gs=as(cs,(ps-1)/2);return ls(gs)}catch(bs){throw improveErrorMessage(bs,"median")}}var ls=ts({"number | BigNumber | Complex | Unit":function(cs){return cs}}),us=ts({"number | BigNumber | Complex | Unit, number | BigNumber | Complex | Unit":function(cs,ps){return ns(rs(cs,ps),2)}});return ts(name$M,{"Array | Matrix":os,"Array | Matrix, number | BigNumber":function(cs,ps){throw new Error("median(A, dim) is not yet supported")},"...":function(cs){if(containsCollections(cs))throw new TypeError("Scalar values expected in function median");return os(cs)}})}),name$L="mad",dependencies$L=["typed","abs","map","median","subtract"],createMad=factory(name$L,dependencies$L,ss=>{var{typed:ts,abs:rs,map:ns,median:is,subtract:as}=ss;return ts(name$L,{"Array | Matrix":os,"...":function(ls){return os(ls)}});function os(ls){if((ls=flatten$4(ls.valueOf())).length===0)throw new Error("Cannot calculate median absolute deviation (mad) of an empty array");try{var us=is(ls);return is(ns(ls,function(cs){return rs(as(cs,us))}))}catch(cs){throw cs instanceof TypeError&&cs.message.indexOf("median")!==-1?new TypeError(cs.message.replace("median","mad")):improveErrorMessage(cs,"mad")}}}),DEFAULT_NORMALIZATION="unbiased",name$K="variance",dependencies$K=["typed","add","subtract","multiply","divide","apply","isNaN"],createVariance=factory(name$K,dependencies$K,ss=>{var{typed:ts,add:rs,subtract:ns,multiply:is,divide:as,apply:os,isNaN:ls}=ss;return ts(name$K,{"Array | Matrix":function(ps){return us(ps,DEFAULT_NORMALIZATION)},"Array | Matrix, string":us,"Array | Matrix, number | BigNumber":function(ps,ds){return cs(ps,ds,DEFAULT_NORMALIZATION)},"Array | Matrix, number | BigNumber, string":cs,"...":function(ps){return us(ps,DEFAULT_NORMALIZATION)}});function us(ps,ds){var fs,hs=0;if(ps.length===0)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");if(deepForEach(ps,function(bs){try{fs=fs===void 0?bs:rs(fs,bs),hs++}catch(vs){throw improveErrorMessage(vs,"variance",bs)}}),hs===0)throw new Error("Cannot calculate variance of an empty array");var ys=as(fs,hs);if(fs=void 0,deepForEach(ps,function(bs){var vs=ns(bs,ys);fs=fs===void 0?is(vs,vs):rs(fs,is(vs,vs))}),ls(fs))return fs;switch(ds){case"uncorrected":return as(fs,hs);case"biased":return as(fs,hs+1);case"unbiased":var gs=isBigNumber(fs)?fs.mul(0):0;return hs===1?gs:as(fs,hs-1);default:throw new Error('Unknown normalization "'+ds+'". Choose "unbiased" (default), "uncorrected", or "biased".')}}function cs(ps,ds,fs){try{if(ps.length===0)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");return os(ps,ds,hs=>us(hs,fs))}catch(hs){throw improveErrorMessage(hs,"variance")}}}),name$J="quantileSeq",dependencies$J=["typed","add","multiply","partitionSelect","compare"],createQuantileSeq=factory(name$J,dependencies$J,ss=>{var{typed:ts,add:rs,multiply:ns,partitionSelect:is,compare:as}=ss;function os(us,cs,ps){var ds=flatten$4(us),fs=ds.length;if(fs===0)throw new Error("Cannot calculate quantile of an empty sequence");if(isNumber$1(cs)){var hs=cs*(fs-1),ys=hs%1;if(ys===0){var gs=ps?ds[hs]:is(ds,hs);return ls(gs),gs}var bs,vs,Ns=Math.floor(hs);if(ps)bs=ds[Ns],vs=ds[Ns+1];else{vs=is(ds,Ns+1),bs=ds[Ns];for(var Ts=0;Ts<Ns;++Ts)as(ds[Ts],bs)>0&&(bs=ds[Ts])}return ls(bs),ls(vs),rs(ns(bs,1-ys),ns(vs,ys))}var Cs=cs.times(fs-1);if(Cs.isInteger()){Cs=Cs.toNumber();var xs=ps?ds[Cs]:is(ds,Cs);return ls(xs),xs}var As,ws,Es=Cs.floor(),Ss=Cs.minus(Es),Ds=Es.toNumber();if(ps)As=ds[Ds],ws=ds[Ds+1];else{ws=is(ds,Ds+1),As=ds[Ds];for(var Vs=0;Vs<Ds;++Vs)as(ds[Vs],As)>0&&(As=ds[Vs])}ls(As),ls(ws);var Is=new Ss.constructor(1);return rs(ns(As,Is.minus(Ss)),ns(ws,Ss))}var ls=ts({"number | BigNumber | Unit":function(us){return us}});return function(us,cs,ps){var ds,fs,hs;if(arguments.length<2||arguments.length>3)throw new SyntaxError("Function quantileSeq requires two or three parameters");if(isCollection(us)){if(typeof(ps=ps||!1)=="boolean"){if(fs=us.valueOf(),isNumber$1(cs)){if(cs<0)throw new Error("N/prob must be non-negative");if(cs<=1)return os(fs,cs,ps);if(cs>1){if(!isInteger$1(cs))throw new Error("N must be a positive integer");var ys=cs+1;ds=new Array(cs);for(var gs=0;gs<cs;)ds[gs]=os(fs,++gs/ys,ps);return ds}}if(isBigNumber(cs)){var bs=cs.constructor;if(cs.isNegative())throw new Error("N/prob must be non-negative");if(hs=new bs(1),cs.lte(hs))return new bs(os(fs,cs,ps));if(cs.gt(hs)){if(!cs.isInteger())throw new Error("N must be a positive integer");var vs=cs.toNumber();if(vs>4294967295)throw new Error("N must be less than or equal to 2^32-1, as that is the maximum length of an Array");var Ns=new bs(vs+1);ds=new Array(vs);for(var Ts=0;Ts<vs;)ds[Ts]=new bs(os(fs,new bs(++Ts).div(Ns),ps));return ds}}if(Array.isArray(cs)){ds=new Array(cs.length);for(var Cs=0;Cs<ds.length;++Cs){var xs=cs[Cs];if(isNumber$1(xs)){if(xs<0||xs>1)throw new Error("Probability must be between 0 and 1, inclusive")}else{if(!isBigNumber(xs))throw new TypeError("Unexpected type of argument in function quantileSeq");if(hs=new xs.constructor(1),xs.isNegative()||xs.gt(hs))throw new Error("Probability must be between 0 and 1, inclusive")}ds[Cs]=os(fs,xs,ps)}return ds}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}}),name$I="std",dependencies$I=["typed","sqrt","variance"],createStd=factory(name$I,dependencies$I,ss=>{var{typed:ts,sqrt:rs,variance:ns}=ss;return ts(name$I,{"Array | Matrix":is,"Array | Matrix, string":is,"Array | Matrix, number | BigNumber":is,"Array | Matrix, number | BigNumber, string":is,"...":function(as){return is(as)}});function is(as,os){if(as.length===0)throw new SyntaxError("Function std requires one or more parameters (0 provided)");try{return rs(ns.apply(null,arguments))}catch(ls){throw ls instanceof TypeError&&ls.message.indexOf(" variance")!==-1?new TypeError(ls.message.replace(" variance"," std")):ls}}}),name$H="combinations",dependencies$H=["typed"],createCombinations=factory(name$H,dependencies$H,ss=>{var{typed:ts}=ss;return ts(name$H,{"number, number":combinationsNumber,"BigNumber, BigNumber":function(rs,ns){var is,as,os=rs.constructor,ls=rs.minus(ns),us=new os(1);if(!isPositiveInteger$2(rs)||!isPositiveInteger$2(ns))throw new TypeError("Positive integer value expected in function combinations");if(ns.gt(rs))throw new TypeError("k must be less than n in function combinations");if(is=us,ns.lt(ls))for(as=us;as.lte(ls);as=as.plus(us))is=is.times(ns.plus(as)).dividedBy(as);else for(as=us;as.lte(ns);as=as.plus(us))is=is.times(ls.plus(as)).dividedBy(as);return is}})});function isPositiveInteger$2(ss){return ss.isInteger()&&ss.gte(0)}var name$G="combinationsWithRep",dependencies$G=["typed"],createCombinationsWithRep=factory(name$G,dependencies$G,ss=>{var{typed:ts}=ss;return ts(name$G,{"number, number":function(rs,ns){if(!isInteger$1(rs)||rs<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(!isInteger$1(ns)||ns<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(rs<1)throw new TypeError("k must be less than or equal to n + k - 1");return ns<rs-1?product$2(rs,rs+ns-1)/product$2(1,ns):product$2(ns+1,rs+ns-1)/product$2(1,rs-1)},"BigNumber, BigNumber":function(rs,ns){var is,as,os=new rs.constructor(1),ls=rs.minus(os);if(!isPositiveInteger$1$1(rs)||!isPositiveInteger$1$1(ns))throw new TypeError("Positive integer value expected in function combinationsWithRep");if(rs.lt(os))throw new TypeError("k must be less than or equal to n + k - 1 in function combinationsWithRep");if(is=os,ns.lt(ls))for(as=os;as.lte(ls);as=as.plus(os))is=is.times(ns.plus(as)).dividedBy(as);else for(as=os;as.lte(ns);as=as.plus(os))is=is.times(ls.plus(as)).dividedBy(as);return is}})});function isPositiveInteger$1$1(ss){return ss.isInteger()&&ss.gte(0)}var name$F="gamma",dependencies$F=["typed","config","multiplyScalar","pow","BigNumber","Complex"],createGamma=factory(name$F,dependencies$F,ss=>{var{typed:ts,config:rs,multiplyScalar:ns,pow:is,BigNumber:as,Complex:os}=ss;return ts(name$F,{number:gammaNumber,Complex:function(us){if(us.im===0)return this(us.re);if(us.re<.5){var cs=new os(1-us.re,-us.im),ps=new os(Math.PI*us.re,Math.PI*us.im);return new os(Math.PI).div(ps.sin()).div(this(cs))}us=new os(us.re-1,us.im);for(var ds=new os(gammaP[0],0),fs=1;fs<gammaP.length;++fs){var hs=new os(gammaP[fs],0);ds=ds.add(hs.div(us.add(fs)))}var ys=new os(us.re+gammaG+.5,us.im),gs=Math.sqrt(2*Math.PI),bs=ys.pow(us.add(.5)),vs=ys.neg().exp();return ds.mul(gs).mul(bs).mul(vs)},BigNumber:function(us){if(us.isInteger())return us.isNegative()||us.isZero()?new as(1/0):ls(us.minus(1));if(!us.isFinite())return new as(us.isNegative()?NaN:1/0);throw new Error("Integer BigNumber expected")},"Array | Matrix":function(us){return deepMap(us,this)}});function ls(us){if(us<8)return new as([1,1,2,6,24,120,720,5040][us]);var cs=rs.precision+(0|Math.log(us.toNumber())),ps=as.clone({precision:cs});if(us%2==1)return us.times(ls(new as(us-1)));for(var ds=us,fs=new ps(us),hs=us.toNumber();ds>2;)hs+=ds-=2,fs=fs.times(hs);return new as(fs.toPrecision(as.precision))}}),name$E="lgamma",dependencies$E=["Complex","typed"],createLgamma=factory(name$E,dependencies$E,ss=>{var{Complex:ts,typed:rs}=ss,ns=7,is=[-.029550653594771242,.00641025641025641,-.0019175269175269176,.0008417508417508417,-.0005952380952380953,.0007936507936507937,-.002777777777777778,.08333333333333333];return rs(name$E,{number:lgammaNumber,Complex:function(ls){if(ls.isNaN())return new ts(NaN,NaN);if(ls.im===0)return new ts(lgammaNumber(ls.re),0);if(ls.re>=ns||Math.abs(ls.im)>=7)return as(ls);if(ls.re<=.1){var us=copysign(6.283185307179586,ls.im)*Math.floor(.5*ls.re+.25),cs=ls.mul(Math.PI).sin().log(),ps=this(new ts(1-ls.re,-ls.im));return new ts(1.1447298858494002,us).sub(cs).sub(ps)}return ls.im>=0?os(ls):os(ls.conjugate()).conjugate()},BigNumber:function(){throw new Error("mathjs doesn't yet provide an implementation of the algorithm lgamma for BigNumber")}});function as(ls){for(var us=ls.sub(.5).mul(ls.log()).sub(ls).add(lnSqrt2PI),cs=new ts(1,0).div(ls),ps=cs.div(ls),ds=is[0],fs=is[1],hs=2*ps.re,ys=ps.re*ps.re+ps.im*ps.im,gs=2;gs<8;gs++){var bs=fs;fs=-ys*ds+is[gs],ds=hs*ds+bs}var vs=cs.mul(ps.mul(ds).add(fs));return us.add(vs)}function os(ls){var us=0,cs=0,ps=ls;for(ls=ls.add(1);ls.re<=ns;){var ds=(ps=ps.mul(ls)).im<0?1:0;ds!==0&&cs===0&&us++,cs=ds,ls=ls.add(1)}return as(ls).sub(ps.log()).sub(new ts(0,2*us*Math.PI*1))}}),name$D="factorial",dependencies$D=["typed","gamma"],createFactorial=factory(name$D,dependencies$D,ss=>{var{typed:ts,gamma:rs}=ss;return ts(name$D,{number:function(ns){if(ns<0)throw new Error("Value must be non-negative");return rs(ns+1)},BigNumber:function(ns){if(ns.isNegative())throw new Error("Value must be non-negative");return rs(ns.plus(1))},"Array | Matrix":function(ns){return deepMap(ns,this)}})}),name$C="kldivergence",dependencies$C=["typed","matrix","divide","sum","multiply","dotDivide","log","isNumeric"],createKldivergence=factory(name$C,dependencies$C,ss=>{var{typed:ts,matrix:rs,divide:ns,sum:is,multiply:as,dotDivide:os,log:ls,isNumeric:us}=ss;return ts(name$C,{"Array, Array":function(ps,ds){return cs(rs(ps),rs(ds))},"Matrix, Array":function(ps,ds){return cs(ps,rs(ds))},"Array, Matrix":function(ps,ds){return cs(rs(ps),ds)},"Matrix, Matrix":function(ps,ds){return cs(ps,ds)}});function cs(ps,ds){var fs=ds.size().length,hs=ps.size().length;if(fs>1)throw new Error("first object must be one dimensional");if(hs>1)throw new Error("second object must be one dimensional");if(fs!==hs)throw new Error("Length of two vectors must be equal");if(is(ps)===0)throw new Error("Sum of elements in first object must be non zero");if(is(ds)===0)throw new Error("Sum of elements in second object must be non zero");var ys=ns(ps,is(ps)),gs=ns(ds,is(ds)),bs=is(as(ys,ls(os(ys,gs))));return us(bs)?bs:Number.NaN}}),name$B="multinomial",dependencies$B=["typed","add","divide","multiply","factorial","isInteger","isPositive"],createMultinomial=factory(name$B,dependencies$B,ss=>{var{typed:ts,add:rs,divide:ns,multiply:is,factorial:as,isInteger:os,isPositive:ls}=ss;return ts(name$B,{"Array | Matrix":function(us){var cs=0,ps=1;return deepForEach(us,function(ds){if(!os(ds)||!ls(ds))throw new TypeError("Positive integer value expected in function multinomial");cs=rs(cs,ds),ps=is(ps,as(ds))}),ns(as(cs),ps)}})}),name$A="permutations",dependencies$A=["typed","factorial"],createPermutations=factory(name$A,dependencies$A,ss=>{var{typed:ts,factorial:rs}=ss;return ts(name$A,{"number | BigNumber":rs,"number, number":function(ns,is){if(!isInteger$1(ns)||ns<0)throw new TypeError("Positive integer value expected in function permutations");if(!isInteger$1(is)||is<0)throw new TypeError("Positive integer value expected in function permutations");if(is>ns)throw new TypeError("second argument k must be less than or equal to first argument n");return product$2(ns-is+1,ns)},"BigNumber, BigNumber":function(ns,is){var as,os;if(!isPositiveInteger$3(ns)||!isPositiveInteger$3(is))throw new TypeError("Positive integer value expected in function permutations");if(is.gt(ns))throw new TypeError("second argument k must be less than or equal to first argument n");for(as=ns.mul(0).add(1),os=ns.minus(is).plus(1);os.lte(ns);os=os.plus(1))as=as.times(os);return as}})});function isPositiveInteger$3(ss){return ss.isInteger()&&ss.gte(0)}var alea$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this,us=function(){var cs=4022871197,ps=function(ds){ds=String(ds);for(var fs=0;fs<ds.length;fs++){var hs=.02519603282416938*(cs+=ds.charCodeAt(fs));hs-=cs=hs>>>0,cs=(hs*=cs)>>>0,cs+=4294967296*(hs-=cs)}return 23283064365386963e-26*(cs>>>0)};return ps}();ls.next=function(){var cs=2091639*ls.s0+23283064365386963e-26*ls.c;return ls.s0=ls.s1,ls.s1=ls.s2,ls.s2=cs-(ls.c=0|cs)},ls.c=1,ls.s0=us(" "),ls.s1=us(" "),ls.s2=us(" "),ls.s0-=us(os),ls.s0<0&&(ls.s0+=1),ls.s1-=us(os),ls.s1<0&&(ls.s1+=1),ls.s2-=us(os),ls.s2<0&&(ls.s2+=1),us=null}function is(os,ls){return ls.c=os.c,ls.s0=os.s0,ls.s1=os.s1,ls.s2=os.s2,ls}function as(os,ls){var us=new ns(os),cs=ls&&ls.state,ps=us.next;return ps.int32=function(){return 4294967296*us.next()|0},ps.double=function(){return ps()+11102230246251565e-32*(2097152*ps()|0)},ps.quick=ps,cs&&(typeof cs=="object"&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.alea=as})(0,alea$1,!1);var xor128$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this,us="";ls.x=0,ls.y=0,ls.z=0,ls.w=0,ls.next=function(){var ps=ls.x^ls.x<<11;return ls.x=ls.y,ls.y=ls.z,ls.z=ls.w,ls.w^=ls.w>>>19^ps^ps>>>8},os===(0|os)?ls.x=os:us+=os;for(var cs=0;cs<us.length+64;cs++)ls.x^=0|us.charCodeAt(cs),ls.next()}function is(os,ls){return ls.x=os.x,ls.y=os.y,ls.z=os.z,ls.w=os.w,ls}function as(os,ls){var us=new ns(os),cs=ls&&ls.state,ps=function(){return(us.next()>>>0)/4294967296};return ps.double=function(){do var ds=((us.next()>>>11)+(us.next()>>>0)/4294967296)/2097152;while(ds===0);return ds},ps.int32=us.next,ps.quick=ps,cs&&(typeof cs=="object"&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.xor128=as})(0,xor128$1,!1);var xorwow$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this,us="";ls.next=function(){var ps=ls.x^ls.x>>>2;return ls.x=ls.y,ls.y=ls.z,ls.z=ls.w,ls.w=ls.v,(ls.d=ls.d+362437|0)+(ls.v=ls.v^ls.v<<4^ps^ps<<1)|0},ls.x=0,ls.y=0,ls.z=0,ls.w=0,ls.v=0,os===(0|os)?ls.x=os:us+=os;for(var cs=0;cs<us.length+64;cs++)ls.x^=0|us.charCodeAt(cs),cs==us.length&&(ls.d=ls.x<<10^ls.x>>>4),ls.next()}function is(os,ls){return ls.x=os.x,ls.y=os.y,ls.z=os.z,ls.w=os.w,ls.v=os.v,ls.d=os.d,ls}function as(os,ls){var us=new ns(os),cs=ls&&ls.state,ps=function(){return(us.next()>>>0)/4294967296};return ps.double=function(){do var ds=((us.next()>>>11)+(us.next()>>>0)/4294967296)/2097152;while(ds===0);return ds},ps.int32=us.next,ps.quick=ps,cs&&(typeof cs=="object"&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.xorwow=as})(0,xorwow$1,!1);var xorshift7$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this;ls.next=function(){var us,cs,ps=ls.x,ds=ls.i;return us=ps[ds],cs=(us^=us>>>7)^us<<24,cs^=(us=ps[ds+1&7])^us>>>10,cs^=(us=ps[ds+3&7])^us>>>3,cs^=(us=ps[ds+4&7])^us<<7,us=ps[ds+7&7],cs^=(us^=us<<13)^us<<9,ps[ds]=cs,ls.i=ds+1&7,cs},function(us,cs){var ps,ds=[];if(cs===(0|cs))ds[0]=cs;else for(cs=""+cs,ps=0;ps<cs.length;++ps)ds[7&ps]=ds[7&ps]<<15^cs.charCodeAt(ps)+ds[ps+1&7]<<13;for(;ds.length<8;)ds.push(0);for(ps=0;ps<8&&ds[ps]===0;++ps);for(ps==8?ds[7]=-1:ds[ps],us.x=ds,us.i=0,ps=256;ps>0;--ps)us.next()}(ls,os)}function is(os,ls){return ls.x=os.x.slice(),ls.i=os.i,ls}function as(os,ls){os==null&&(os=+new Date);var us=new ns(os),cs=ls&&ls.state,ps=function(){return(us.next()>>>0)/4294967296};return ps.double=function(){do var ds=((us.next()>>>11)+(us.next()>>>0)/4294967296)/2097152;while(ds===0);return ds},ps.int32=us.next,ps.quick=ps,cs&&(cs.x&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.xorshift7=as})(0,xorshift7$1,!1);var xor4096$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this;ls.next=function(){var us,cs,ps=ls.w,ds=ls.X,fs=ls.i;return ls.w=ps=ps+1640531527|0,cs=ds[fs+34&127],us=ds[fs=fs+1&127],cs^=cs<<13,us^=us<<17,cs^=cs>>>15,us^=us>>>12,cs=ds[fs]=cs^us,ls.i=fs,cs+(ps^ps>>>16)|0},function(us,cs){var ps,ds,fs,hs,ys,gs=[],bs=128;for(cs===(0|cs)?(ds=cs,cs=null):(cs+="\0",ds=0,bs=Math.max(bs,cs.length)),fs=0,hs=-32;hs<bs;++hs)cs&&(ds^=cs.charCodeAt((hs+32)%cs.length)),hs===0&&(ys=ds),ds^=ds<<10,ds^=ds>>>15,ds^=ds<<4,ds^=ds>>>13,hs>=0&&(ys=ys+1640531527|0,fs=(ps=gs[127&hs]^=ds+ys)==0?fs+1:0);for(fs>=128&&(gs[127&(cs&&cs.length||0)]=-1),fs=127,hs=512;hs>0;--hs)ds=gs[fs+34&127],ps=gs[fs=fs+1&127],ds^=ds<<13,ps^=ps<<17,ds^=ds>>>15,ps^=ps>>>12,gs[fs]=ds^ps;us.w=ys,us.X=gs,us.i=fs}(ls,os)}function is(os,ls){return ls.i=os.i,ls.w=os.w,ls.X=os.X.slice(),ls}function as(os,ls){os==null&&(os=+new Date);var us=new ns(os),cs=ls&&ls.state,ps=function(){return(us.next()>>>0)/4294967296};return ps.double=function(){do var ds=((us.next()>>>11)+(us.next()>>>0)/4294967296)/2097152;while(ds===0);return ds},ps.int32=us.next,ps.quick=ps,cs&&(cs.X&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.xor4096=as})(0,xor4096$1,!1);var tychei$1={exports:{}};(function(ss,ts,rs){function ns(os){var ls=this,us="";ls.next=function(){var ps=ls.b,ds=ls.c,fs=ls.d,hs=ls.a;return ps=ps<<25^ps>>>7^ds,ds=ds-fs|0,fs=fs<<24^fs>>>8^hs,hs=hs-ps|0,ls.b=ps=ps<<20^ps>>>12^ds,ls.c=ds=ds-fs|0,ls.d=fs<<16^ds>>>16^hs,ls.a=hs-ps|0},ls.a=0,ls.b=0,ls.c=-1640531527,ls.d=1367130551,os===Math.floor(os)?(ls.a=os/4294967296|0,ls.b=0|os):us+=os;for(var cs=0;cs<us.length+20;cs++)ls.b^=0|us.charCodeAt(cs),ls.next()}function is(os,ls){return ls.a=os.a,ls.b=os.b,ls.c=os.c,ls.d=os.d,ls}function as(os,ls){var us=new ns(os),cs=ls&&ls.state,ps=function(){return(us.next()>>>0)/4294967296};return ps.double=function(){do var ds=((us.next()>>>11)+(us.next()>>>0)/4294967296)/2097152;while(ds===0);return ds},ps.int32=us.next,ps.quick=ps,cs&&(typeof cs=="object"&&is(cs,us),ps.state=function(){return is(us,{})}),ps}ts&&ts.exports?ts.exports=as:rs&&rs.amd?rs(function(){return as}):this.tychei=as})(0,tychei$1,!1);var seedrandom$2={exports:{}},_nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),require$$0=getAugmentedNamespace(_nodeResolve_empty$1);(function(ss){(function(ts,rs,ns){var is,as=256,os=6,ls="random",us=ns.pow(as,os),cs=ns.pow(2,52),ps=2*cs,ds=as-1;function fs(Ns,Ts,Cs){var xs=[],As=bs(gs((Ts=Ts==1?{entropy:!0}:Ts||{}).entropy?[Ns,vs(rs)]:Ns??function(){try{var Ss;return is&&(Ss=is.randomBytes)?Ss=Ss(as):(Ss=new Uint8Array(as),(ts.crypto||ts.msCrypto).getRandomValues(Ss)),vs(Ss)}catch{var Ds=ts.navigator,Vs=Ds&&Ds.plugins;return[+new Date,ts,Vs,ts.screen,vs(rs)]}}(),3),xs),ws=new hs(xs),Es=function(){for(var Ss=ws.g(os),Ds=us,Vs=0;Ss<cs;)Ss=(Ss+Vs)*as,Ds*=as,Vs=ws.g(1);for(;Ss>=ps;)Ss/=2,Ds/=2,Vs>>>=1;return(Ss+Vs)/Ds};return Es.int32=function(){return 0|ws.g(4)},Es.quick=function(){return ws.g(4)/4294967296},Es.double=Es,bs(vs(ws.S),rs),(Ts.pass||Cs||function(Ss,Ds,Vs,Is){return Is&&(Is.S&&ys(Is,ws),Ss.state=function(){return ys(ws,{})}),Vs?(ns[ls]=Ss,Ds):Ss})(Es,As,"global"in Ts?Ts.global:this==ns,Ts.state)}function hs(Ns){var Ts,Cs=Ns.length,xs=this,As=0,ws=xs.i=xs.j=0,Es=xs.S=[];for(Cs||(Ns=[Cs++]);As<as;)Es[As]=As++;for(As=0;As<as;As++)Es[As]=Es[ws=ds&ws+Ns[As%Cs]+(Ts=Es[As])],Es[ws]=Ts;(xs.g=function(Ss){for(var Ds,Vs=0,Is=xs.i,Os=xs.j,Ps=xs.S;Ss--;)Ds=Ps[Is=ds&Is+1],Vs=Vs*as+Ps[ds&(Ps[Is]=Ps[Os=ds&Os+Ds])+(Ps[Os]=Ds)];return xs.i=Is,xs.j=Os,Vs})(as)}function ys(Ns,Ts){return Ts.i=Ns.i,Ts.j=Ns.j,Ts.S=Ns.S.slice(),Ts}function gs(Ns,Ts){var Cs,xs=[],As=typeof Ns;if(Ts&&As=="object")for(Cs in Ns)try{xs.push(gs(Ns[Cs],Ts-1))}catch{}return xs.length?xs:As=="string"?Ns:Ns+"\0"}function bs(Ns,Ts){for(var Cs,xs=Ns+"",As=0;As<xs.length;)Ts[ds&As]=ds&(Cs^=19*Ts[ds&As])+xs.charCodeAt(As++);return vs(Ts)}function vs(Ns){return String.fromCharCode.apply(0,Ns)}if(bs(ns.random(),rs),ss.exports){ss.exports=fs;try{is=require$$0}catch{}}else ns["seed"+ls]=fs})(typeof self<"u"?self:commonjsGlobal$1,[],Math)})(seedrandom$2);var alea=alea$1.exports,xor128=xor128$1.exports,xorwow=xorwow$1.exports,xorshift7=xorshift7$1.exports,xor4096=xor4096$1.exports,tychei=tychei$1.exports,sr$1=seedrandom$2.exports;sr$1.alea=alea,sr$1.xor128=xor128,sr$1.xorwow=xorwow,sr$1.xorshift7=xorshift7,sr$1.xor4096=xor4096,sr$1.tychei=tychei;var seedrandom$1=sr$1,singletonRandom=seedrandom$1(Date.now());function createRng(ss){var ts,rs;return ts=(rs=ss)===null?singletonRandom:seedrandom$1(String(rs)),function(){return ts()}}var name$z="pickRandom",dependencies$z=["typed","config","?on"],createPickRandom=factory(name$z,dependencies$z,ss=>{var{typed:ts,config:rs,on:ns}=ss,is=createRng(rs.randomSeed);return ns&&ns("config",function(os,ls){os.randomSeed!==ls.randomSeed&&(is=createRng(os.randomSeed))}),ts(name$z,{"Array | Matrix":function(os){return as(os,{})},"Array | Matrix, Object":function(os,ls){return as(os,ls)},"Array | Matrix, number":function(os,ls){return as(os,{number:ls})},"Array | Matrix, Array | Matrix":function(os,ls){return as(os,{weights:ls})},"Array | Matrix, Array | Matrix, number":function(os,ls,us){return as(os,{number:us,weights:ls})},"Array | Matrix, number, Array | Matrix":function(os,ls,us){return as(os,{number:ls,weights:us})}});function as(os,ls){var{number:us,weights:cs,elementWise:ps=!0}=ls,ds=us===void 0;ds&&(us=1);var fs=isMatrix(os)?os.create:isMatrix(cs)?cs.create:null;os=os.valueOf(),cs&&(cs=cs.valueOf()),ps===!0&&(os=flatten$4(os),cs=flatten$4(cs));var hs=0;if(cs!==void 0){if(cs.length!==os.length)throw new Error("Weights must have the same length as possibles");for(var ys=0,gs=cs.length;ys<gs;ys++){if(!isNumber$1(cs[ys])||cs[ys]<0)throw new Error("Weights must be an array of positive numbers");hs+=cs[ys]}}for(var bs,vs=os.length,Ns=[];Ns.length<us;){if(cs===void 0)bs=os[Math.floor(is()*vs)];else for(var Ts=is()*hs,Cs=0,xs=os.length;Cs<xs;Cs++)if((Ts-=cs[Cs])<0){bs=os[Cs];break}Ns.push(bs)}return ds?Ns[0]:fs?fs(Ns):Ns}});function randomMatrix(ss,ts){var rs=[];if((ss=ss.slice(0)).length>1)for(var ns=0,is=ss.shift();ns<is;ns++)rs.push(randomMatrix(ss,ts));else for(var as=0,os=ss.shift();as<os;as++)rs.push(ts());return rs}var name$y="random",dependencies$y=["typed","config","?on"],createRandom=factory(name$y,dependencies$y,ss=>{var{typed:ts,config:rs,on:ns}=ss,is=createRng(rs.randomSeed);return ns&&ns("config",function(ls,us){ls.randomSeed!==us.randomSeed&&(is=createRng(ls.randomSeed))}),ts(name$y,{"":()=>os(0,1),number:ls=>os(0,ls),"number, number":(ls,us)=>os(ls,us),"Array | Matrix":ls=>as(ls,0,1),"Array | Matrix, number":(ls,us)=>as(ls,0,us),"Array | Matrix, number, number":(ls,us,cs)=>as(ls,us,cs)});function as(ls,us,cs){var ps=randomMatrix(ls.valueOf(),()=>os(us,cs));return isMatrix(ls)?ls.create(ps):ps}function os(ls,us){return ls+is()*(us-ls)}}),name$x="randomInt",dependencies$x=["typed","config","?on"],createRandomInt=factory(name$x,dependencies$x,ss=>{var{typed:ts,config:rs,on:ns}=ss,is=createRng(rs.randomSeed);return ns&&ns("config",function(ls,us){ls.randomSeed!==us.randomSeed&&(is=createRng(ls.randomSeed))}),ts(name$x,{"":()=>os(0,1),number:ls=>os(0,ls),"number, number":(ls,us)=>os(ls,us),"Array | Matrix":ls=>as(ls,0,1),"Array | Matrix, number":(ls,us)=>as(ls,0,us),"Array | Matrix, number, number":(ls,us,cs)=>as(ls,us,cs)});function as(ls,us,cs){var ps=randomMatrix(ls.valueOf(),()=>os(us,cs));return isMatrix(ls)?ls.create(ps):ps}function os(ls,us){return Math.floor(ls+is()*(us-ls))}}),name$w="stirlingS2",dependencies$w=["typed","addScalar","subtract","multiplyScalar","divideScalar","pow","factorial","combinations","isNegative","isInteger","number","?bignumber","larger"],createStirlingS2=factory(name$w,dependencies$w,ss=>{var{typed:ts,addScalar:rs,subtract:ns,multiplyScalar:is,divideScalar:as,pow:os,factorial:ls,combinations:us,isNegative:cs,isInteger:ps,number:ds,bignumber:fs,larger:hs}=ss,ys=[],gs=[];return ts(name$w,{"number | BigNumber, number | BigNumber":function(bs,vs){if(!ps(bs)||cs(bs)||!ps(vs)||cs(vs))throw new TypeError("Non-negative integer value expected in function stirlingS2");if(hs(vs,bs))throw new TypeError("k must be less than or equal to n in function stirlingS2");var Ns=!(isNumber$1(bs)&&isNumber$1(vs)),Ts=Ns?gs:ys,Cs=Ns?fs:ds,xs=ds(bs),As=ds(vs);if(Ts[xs]&&Ts[xs].length>As)return Ts[xs][As];for(var ws=0;ws<=xs;++ws)if(Ts[ws]||(Ts[ws]=[Cs(ws===0?1:0)]),ws!==0)for(var Es=Ts[ws],Ss=Ts[ws-1],Ds=Es.length;Ds<=ws&&Ds<=As;++Ds)Es[Ds]=Ds===ws?1:rs(is(Cs(Ds),Ss[Ds]),Ss[Ds-1]);return Ts[xs][As]}})}),name$v="bellNumbers",dependencies$v=["typed","addScalar","isNegative","isInteger","stirlingS2"],createBellNumbers=factory(name$v,dependencies$v,ss=>{var{typed:ts,addScalar:rs,isNegative:ns,isInteger:is,stirlingS2:as}=ss;return ts(name$v,{"number | BigNumber":function(os){if(!is(os)||ns(os))throw new TypeError("Non-negative integer value expected in function bellNumbers");for(var ls=0,us=0;us<=os;us++)ls=rs(ls,as(os,us));return ls}})}),name$u="catalan",dependencies$u=["typed","addScalar","divideScalar","multiplyScalar","combinations","isNegative","isInteger"],createCatalan=factory(name$u,dependencies$u,ss=>{var{typed:ts,addScalar:rs,divideScalar:ns,multiplyScalar:is,combinations:as,isNegative:os,isInteger:ls}=ss;return ts(name$u,{"number | BigNumber":function(us){if(!ls(us)||os(us))throw new TypeError("Non-negative integer value expected in function catalan");return ns(as(is(us,2),us),rs(us,1))}})}),name$t="composition",dependencies$t=["typed","addScalar","combinations","isNegative","isPositive","isInteger","larger"],createComposition=factory(name$t,dependencies$t,ss=>{var{typed:ts,addScalar:rs,combinations:ns,isPositive:is,isNegative:as,isInteger:os,larger:ls}=ss;return ts(name$t,{"number | BigNumber, number | BigNumber":function(us,cs){if(!(os(us)&&is(us)&&os(cs)&&is(cs)))throw new TypeError("Positive integer value expected in function composition");if(ls(cs,us))throw new TypeError("k must be less than or equal to n in function composition");return ns(rs(us,-1),rs(cs,-1))}})}),name$s="leafCount",dependencies$s=["parse","typed"],createLeafCount=factory(name$s,dependencies$s,ss=>{var{parse:ts,typed:rs}=ss;function ns(is){var as=0;return is.forEach(os=>{as+=ns(os)}),as||1}return rs(name$s,{string:function(is){return this(ts(is))},Node:function(is){return ns(is)}})});function ownKeys(ss,ts){var rs=Object.keys(ss);if(Object.getOwnPropertySymbols){var ns=Object.getOwnPropertySymbols(ss);ts&&(ns=ns.filter(function(is){return Object.getOwnPropertyDescriptor(ss,is).enumerable})),rs.push.apply(rs,ns)}return rs}function _objectSpread(ss){for(var ts=1;ts<arguments.length;ts++){var rs=arguments[ts]!=null?arguments[ts]:{};ts%2?ownKeys(Object(rs),!0).forEach(function(ns){_defineProperty(ss,ns,rs[ns])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ss,Object.getOwnPropertyDescriptors(rs)):ownKeys(Object(rs)).forEach(function(ns){Object.defineProperty(ss,ns,Object.getOwnPropertyDescriptor(rs,ns))})}return ss}var name$r="simplifyUtil",dependencies$r=["FunctionNode","OperatorNode","SymbolNode"],createUtil=factory(name$r,dependencies$r,ss=>{var{FunctionNode:ts,OperatorNode:rs,SymbolNode:ns}=ss,is=!0,as=!1,os="defaultF",ls={add:{trivial:is,total:is,commutative:is,associative:is},unaryPlus:{trivial:is,total:is,commutative:is,associative:is},subtract:{trivial:as,total:is,commutative:as,associative:as},multiply:{trivial:is,total:is,commutative:is,associative:is},divide:{trivial:as,total:is,commutative:as,associative:as},paren:{trivial:is,total:is,commutative:is,associative:as},defaultF:{trivial:as,total:is,commutative:as,associative:as}};function us(fs,hs){var ys=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ls,gs=os;if(typeof fs=="string"?gs=fs:isOperatorNode(fs)?gs=fs.fn.toString():isFunctionNode(fs)?gs=fs.name:isParenthesisNode(fs)&&(gs="paren"),hasOwnProperty$2(ys,gs)){var bs=ys[gs];if(hasOwnProperty$2(bs,hs))return bs[hs];if(hasOwnProperty$2(ls,gs))return ls[gs][hs]}if(hasOwnProperty$2(ys,os)){var vs=ys[os];return hasOwnProperty$2(vs,hs)?vs[hs]:ls[os][hs]}if(hasOwnProperty$2(ls,gs)){var Ns=ls[gs];if(hasOwnProperty$2(Ns,hs))return Ns[hs]}return ls[os][hs]}function cs(fs){return us(fs,"associative",arguments.length>1&&arguments[1]!==void 0?arguments[1]:ls)}function ps(fs,hs){var ys,gs=[];return cs(fs,hs)?(ys=fs.op,function bs(vs){for(var Ns=0;Ns<vs.args.length;Ns++){var Ts=vs.args[Ns];isOperatorNode(Ts)&&ys===Ts.op?bs(Ts):gs.push(Ts)}}(fs),gs):fs.args}function ds(fs){return isOperatorNode(fs)?function(hs){try{return new rs(fs.op,fs.fn,hs,fs.implicit)}catch(ys){return console.error(ys),[]}}:function(hs){return new ts(new ns(fs.name),hs)}}return{createMakeNodeFunction:ds,hasProperty:us,isCommutative:function(fs){return us(fs,"commutative",arguments.length>1&&arguments[1]!==void 0?arguments[1]:ls)},isAssociative:cs,mergeContext:function(fs,hs){var ys=_objectSpread({},fs);for(var gs in hs)hasOwnProperty$2(fs,gs)?ys[gs]=_objectSpread(_objectSpread({},hs[gs]),fs[gs]):ys[gs]=hs[gs];return ys},flatten:function fs(hs,ys){if(!hs.args||hs.args.length===0)return hs;hs.args=ps(hs,ys);for(var gs=0;gs<hs.args.length;gs++)fs(hs.args[gs],ys)},allChildren:ps,unflattenr:function fs(hs,ys){if(hs.args&&hs.args.length!==0){for(var gs=ds(hs),bs=hs.args.length,vs=0;vs<bs;vs++)fs(hs.args[vs],ys);if(bs>2&&cs(hs,ys)){for(var Ns=hs.args.pop();hs.args.length>0;)Ns=gs([hs.args.pop(),Ns]);hs.args=Ns.args}}},unflattenl:function fs(hs,ys){if(hs.args&&hs.args.length!==0){for(var gs=ds(hs),bs=hs.args.length,vs=0;vs<bs;vs++)fs(hs.args[vs],ys);if(bs>2&&cs(hs,ys)){for(var Ns=hs.args.shift();hs.args.length>0;)Ns=gs([Ns,hs.args.shift()]);hs.args=Ns.args}}},defaultContext:ls,realContext:{divide:{total:as},log:{total:as}},positiveContext:{subtract:{total:as},abs:{trivial:is},log:{total:is}}}}),name$q="simplifyConstant",dependencies$q=["typed","config","mathWithTransform","matrix","?fraction","?bignumber","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode"],createSimplifyConstant=factory(name$q,dependencies$q,ss=>{var{typed:ts,config:rs,mathWithTransform:ns,matrix:is,fraction:as,bignumber:os,AccessorNode:ls,ArrayNode:us,ConstantNode:cs,FunctionNode:ps,IndexNode:ds,ObjectNode:fs,OperatorNode:hs,SymbolNode:ys}=ss,{isCommutative:gs,isAssociative:bs,allChildren:vs,createMakeNodeFunction:Ns}=createUtil({FunctionNode:ps,OperatorNode:hs,SymbolNode:ys});function Ts(Os,Ps){return ws(Is(Os,Ps))}function Cs(Os){return isFraction(Os)?Os.valueOf():Os instanceof Array?Os.map(Cs):isMatrix(Os)?is(Cs(Os.valueOf())):Os}function xs(Os,Ps,$s){try{return ns[Os].apply(null,Ps)}catch{return Ps=Ps.map(Cs),Ss(ns[Os].apply(null,Ps),$s)}}var As=ts({Fraction:function(Os){var Ps,$s=Os.s*Os.n;return Ps=$s<0?new hs("-","unaryMinus",[new cs(-$s)]):new cs($s),Os.d===1?Ps:new hs("/","divide",[Ps,new cs(Os.d)])},number:function(Os){return Os<0?Ds(new cs(-Os)):new cs(Os)},BigNumber:function(Os){return Os<0?Ds(new cs(-Os)):new cs(Os)},Complex:function(Os){throw new Error("Cannot convert Complex number to Node")},string:function(Os){return new cs(Os)},Matrix:function(Os){return new us(Os.valueOf().map(Ps=>As(Ps)))}});function ws(Os){return isNode$1(Os)?Os:As(Os)}function Es(Os,Ps){if(Ps&&Ps.exactFractions!==!1&&isFinite(Os)&&as){var $s=as(Os),Rs=Ps&&typeof Ps.fractionsLimit=="number"?Ps.fractionsLimit:1/0;if($s.valueOf()===Os&&$s.n<Rs&&$s.d<Rs)return $s}return Os}var Ss=ts({"string, Object":function(Os,Ps){return rs.number==="BigNumber"?(os===void 0&&noBignumber(),os(Os)):rs.number==="Fraction"?(as===void 0&&noFraction(),as(Os)):Es(parseFloat(Os),Ps)},"Fraction, Object":function(Os,Ps){return Os},"BigNumber, Object":function(Os,Ps){return Os},"number, Object":function(Os,Ps){return Es(Os,Ps)},"Complex, Object":function(Os,Ps){return Os.im!==0?Os:Es(Os.re,Ps)},"Matrix, Object":function(Os,Ps){return is(Es(Os.valueOf()))},"Array, Object":function(Os,Ps){return Os.map(Es)}});function Ds(Os){return new hs("-","unaryMinus",[Os])}function Vs(Os,Ps,$s,Rs){return Ps.reduce(function(ks,_s){if(isNode$1(ks)||isNode$1(_s))isNode$1(ks)?isNode$1(_s)||(_s=As(_s)):ks=As(ks);else{try{return xs(Os,[ks,_s],Rs)}catch{}ks=As(ks),_s=As(_s)}return $s([ks,_s])})}function Is(Os,Ps){switch(Os.type){case"SymbolNode":return Os;case"ConstantNode":switch(typeof Os.value){case"number":return Ss(Os.value,Ps);case"string":return Os.value;default:if(!isNaN(Os.value))return Ss(Os.value,Ps)}return Os;case"FunctionNode":if(ns[Os.name]&&ns[Os.name].rawArgs)return Os;if(["add","multiply"].indexOf(Os.name)===-1){var $s=Os.args.map(nl=>Is(nl,Ps));if(!$s.some(isNode$1))try{return xs(Os.name,$s,Ps)}catch{}if(Os.name==="size"&&$s.length===1&&isArrayNode($s[0])){for(var Rs=[],ks=$s[0];isArrayNode(ks);)Rs.push(ks.items.length),ks=ks.items[0];return is(Rs)}return new ps(Os.name,$s.map(ws))}case"OperatorNode":var _s,Bs,Us=Os.fn.toString(),zs=Ns(Os);if(isOperatorNode(Os)&&Os.isUnary())Bs=isNode$1((_s=[Is(Os.args[0],Ps)])[0])?zs(_s):xs(Us,_s,Ps);else if(bs(Os,Ps.context))if(_s=(_s=vs(Os,Ps.context)).map(nl=>Is(nl,Ps)),gs(Us,Ps.context)){for(var Hs=[],el=[],Ys=0;Ys<_s.length;Ys++)isNode$1(_s[Ys])?el.push(_s[Ys]):Hs.push(_s[Ys]);Hs.length>1?(Bs=Vs(Us,Hs,zs,Ps),el.unshift(Bs),Bs=Vs(Us,el,zs,Ps)):Bs=Vs(Us,_s,zs,Ps)}else Bs=Vs(Us,_s,zs,Ps);else _s=Os.args.map(nl=>Is(nl,Ps)),Bs=Vs(Us,_s,zs,Ps);return Bs;case"ParenthesisNode":return Is(Os.content,Ps);case"AccessorNode":return function(nl,cl,dl){if(!isIndexNode(cl))return new ls(ws(nl),ws(cl));if(isArrayNode(nl)||isMatrix(nl)){for(var sl=Array.from(cl.dimensions);sl.length>0;)if(isConstantNode(sl[0])&&typeof sl[0].value!="string"){var js=Ss(sl.shift().value,dl);isArrayNode(nl)?nl=nl.items[js-1]:(nl=nl.valueOf()[js-1])instanceof Array&&(nl=is(nl))}else{if(!(sl.length>1&&isConstantNode(sl[1])&&typeof sl[1].value!="string"))break;var Ls=Ss(sl[1].value,dl),Ws=[],Zs=isArrayNode(nl)?nl.items:nl.valueOf();for(var tl of Zs)if(isArrayNode(tl))Ws.push(tl.items[Ls-1]);else{if(!isMatrix(nl))break;Ws.push(tl[Ls-1])}if(Ws.length!==Zs.length)break;nl=isArrayNode(nl)?new us(Ws):is(Ws),sl.splice(1,1)}return sl.length===cl.dimensions.length?new ls(ws(nl),cl):sl.length>0?(cl=new ds(sl),new ls(ws(nl),cl)):nl}if(isObjectNode(nl)&&cl.dimensions.length===1&&isConstantNode(cl.dimensions[0])){var rl=cl.dimensions[0].value;return rl in nl.properties?nl.properties[rl]:new cs}return new ls(ws(nl),cl)}(Is(Os.object,Ps),Is(Os.index,Ps),Ps);case"ArrayNode":var il=Os.items.map(nl=>Is(nl,Ps));return il.some(isNode$1)?new us(il.map(ws)):is(il);case"IndexNode":return new ds(Os.dimensions.map(nl=>Ts(nl,Ps)));case"ObjectNode":var al={};for(var ll in Os.properties)al[ll]=Ts(Os.properties[ll],Ps);return new fs(al);default:throw new Error("Unimplemented node type in simplifyConstant: ".concat(Os.type))}}return Ts}),name$p="simplify",dependencies$p=["config","typed","parse","add","subtract","multiply","divide","pow","isZero","equal","resolve","simplifyCore","?fraction","?bignumber","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","SymbolNode"],createSimplify=factory(name$p,dependencies$p,ss=>{var{config:ts,typed:rs,parse:ns,add:is,subtract:as,multiply:os,divide:ls,pow:us,isZero:cs,equal:ps,resolve:ds,simplifyCore:fs,fraction:hs,bignumber:ys,mathWithTransform:gs,matrix:bs,AccessorNode:vs,ArrayNode:Ns,ConstantNode:Ts,FunctionNode:Cs,IndexNode:xs,ObjectNode:As,OperatorNode:ws,ParenthesisNode:Es,SymbolNode:Ss}=ss,Ds=createSimplifyConstant({typed:rs,config:ts,mathWithTransform:gs,matrix:bs,fraction:hs,bignumber:ys,AccessorNode:vs,ArrayNode:Ns,ConstantNode:Ts,FunctionNode:Cs,IndexNode:xs,ObjectNode:As,OperatorNode:ws,SymbolNode:Ss}),{hasProperty:Vs,isCommutative:Is,isAssociative:Os,mergeContext:Ps,flatten:$s,unflattenr:Rs,unflattenl:ks,createMakeNodeFunction:_s,defaultContext:Bs,realContext:Us,positiveContext:zs}=createUtil({FunctionNode:Cs,OperatorNode:ws,SymbolNode:Ss}),Hs=rs("simplify",{string:function(Ls){return this(ns(Ls),this.rules,createEmptyMap(),{})},"string, Map | Object":function(Ls,Ws){return this(ns(Ls),this.rules,Ws,{})},"string, Map | Object, Object":function(Ls,Ws,Zs){return this(ns(Ls),this.rules,Ws,Zs)},"string, Array":function(Ls,Ws){return this(ns(Ls),Ws,createEmptyMap(),{})},"string, Array, Map | Object":function(Ls,Ws,Zs){return this(ns(Ls),Ws,Zs,{})},"string, Array, Map | Object, Object":function(Ls,Ws,Zs,tl){return this(ns(Ls),Ws,Zs,tl)},"Node, Map | Object":function(Ls,Ws){return this(Ls,this.rules,Ws,{})},"Node, Map | Object, Object":function(Ls,Ws,Zs){return this(Ls,this.rules,Ws,Zs)},Node:function(Ls){return this(Ls,this.rules,createEmptyMap(),{})},"Node, Array":function(Ls,Ws){return this(Ls,Ws,createEmptyMap(),{})},"Node, Array, Map | Object":function(Ls,Ws,Zs){return this(Ls,Ws,Zs,{})},"Node, Array, Object, Object":function(Ls,Ws,Zs,tl){return this(Ls,Ws,createMap$1(Zs),tl)},"Node, Array, Map, Object":function(Ls,Ws,Zs,tl){var rl=tl.consoleDebug;Ws=function(Js,ul){for(var pl=[],ml=0;ml<Js.length;ml++){var fl=Js[ml],hl=void 0,yl=typeof fl;switch(yl){case"string":fl={s:fl};case"object":hl=il(fl,ul);break;case"function":hl=fl;break;default:throw TypeError("Unsupported type of rule: "+yl)}pl.push(hl)}return pl}(Ws,tl.context);for(var qs=ds(Ls,Zs),Gs={},Xs=(qs=el(qs)).toString({parenthesis:"all"});!Gs[Xs];){Gs[Xs]=!0,al=0;var Ks=Xs;rl&&console.log("Working on: ",Xs);for(var ol=0;ol<Ws.length;ol++){var Fs="";if(typeof Ws[ol]=="function"?(qs=Ws[ol](qs,tl),rl&&(Fs=Ws[ol].name)):($s(qs,tl.context),qs=nl(qs,Ws[ol],tl.context),rl&&(Fs="".concat(Ws[ol].l.toString()," -> ").concat(Ws[ol].r.toString()))),rl){var Qs=qs.toString({parenthesis:"all"});Qs!==Ks&&(console.log("Applying",Fs,"produced",Qs),Ks=Qs)}ks(qs,tl.context)}Xs=qs.toString({parenthesis:"all"})}return qs}});function el(Ls){return Ls.transform(function(Ws,Zs,tl){return isParenthesisNode(Ws)?el(Ws.content):Ws})}Hs.defaultContext=Bs,Hs.realContext=Us,Hs.positiveContext=zs;var Ys={true:!0,false:!0,e:!0,i:!0,Infinity:!0,LN2:!0,LN10:!0,LOG2E:!0,LOG10E:!0,NaN:!0,phi:!0,pi:!0,SQRT1_2:!0,SQRT2:!0,tau:!0};function il(Ls,Ws){var Zs={};if(Ls.s){var tl=Ls.s.split("->");if(tl.length!==2)throw SyntaxError("Could not parse rule: "+Ls.s);Zs.l=tl[0],Zs.r=tl[1]}else Zs.l=Ls.l,Zs.r=Ls.r;for(var rl of(Zs.l=el(ns(Zs.l)),Zs.r=el(ns(Zs.r)),["imposeContext","repeat","assuming"]))rl in Ls&&(Zs[rl]=Ls[rl]);if(Ls.evaluate&&(Zs.evaluate=ns(Ls.evaluate)),Os(Zs.l,Ws)){var qs=_s(Zs.l),Gs=new Ss("_p"+al++);Zs.expanded={},Zs.expanded.l=qs([Zs.l.clone(),Gs]),$s(Zs.expanded.l,Ws),Rs(Zs.expanded.l,Ws),Zs.expanded.r=qs([Zs.r,Gs])}return Zs}Hs.rules=[fs,{l:"log(e)",r:"1"},{s:"n-n1 -> n+-n1",assuming:{subtract:{total:!0}}},{s:"n-n -> 0",assuming:{subtract:{total:!1}}},{s:"-(c*v) -> v * (-c)",assuming:{multiply:{commutative:!0},subtract:{total:!0}}},{s:"-(c*v) -> (-c) * v",assuming:{multiply:{commutative:!1},subtract:{total:!0}}},{s:"-(v*c) -> v * (-c)",assuming:{multiply:{commutative:!1},subtract:{total:!0}}},{l:"-(n1/n2)",r:"-n1/n2"},{l:"-v",r:"v * (-1)"},{l:"(n1 + n2)*(-1)",r:"n1*(-1) + n2*(-1)",repeat:!0},{l:"n/n1^n2",r:"n*n1^-n2"},{l:"n/n1",r:"n*n1^-1"},{s:"(n1*n2)^n3 -> n1^n3 * n2^n3",assuming:{multiply:{commutative:!0}}},{s:"(n1*n2)^(-1) -> n2^(-1) * n1^(-1)",assuming:{multiply:{commutative:!1}}},{s:"(n ^ n1) ^ n2 -> n ^ (n1 * n2)",assuming:{divide:{total:!0}}},{l:" v   * ( v   * n1 + n2)",r:"v^2       * n1 +  v   * n2"},{s:" v   * (v^n4 * n1 + n2)   ->  v^(1+n4)  * n1 +  v   * n2",assuming:{divide:{total:!0}}},{s:"v^n3 * ( v   * n1 + n2)   ->  v^(n3+1)  * n1 + v^n3 * n2",assuming:{divide:{total:!0}}},{s:"v^n3 * (v^n4 * n1 + n2)   ->  v^(n3+n4) * n1 + v^n3 * n2",assuming:{divide:{total:!0}}},{l:"n*n",r:"n^2"},{s:"n * n^n1 -> n^(n1+1)",assuming:{divide:{total:!0}}},{s:"n^n1 * n^n2 -> n^(n1+n2)",assuming:{divide:{total:!0}}},Ds,{s:"n+n -> 2*n",assuming:{add:{total:!0}}},{l:"n+-n",r:"0"},{l:"v*n + v",r:"v*(n+1)"},{l:"n3*n1 + n3*n2",r:"n3*(n1+n2)"},{l:"n3^(-n4)*n1 +   n3  * n2",r:"n3^(-n4)*(n1 + n3^(n4+1) *n2)"},{l:"n3^(-n4)*n1 + n3^n5 * n2",r:"n3^(-n4)*(n1 + n3^(n4+n5)*n2)"},{s:"n*v + v -> (n+1)*v",assuming:{multiply:{commutative:!1}}},{s:"n1*n3 + n2*n3 -> (n1+n2)*n3",assuming:{multiply:{commutative:!1}}},{s:"n1*n3^(-n4) + n2 * n3    -> (n1 + n2*n3^(n4 +  1))*n3^(-n4)",assuming:{multiply:{commutative:!1}}},{s:"n1*n3^(-n4) + n2 * n3^n5 -> (n1 + n2*n3^(n4 + n5))*n3^(-n4)",assuming:{multiply:{commutative:!1}}},{l:"n*c + c",r:"(n+1)*c"},{s:"c*n + c -> c*(n+1)",assuming:{multiply:{commutative:!1}}},Ds,{s:"(-n)*n1 -> -(n*n1)",assuming:{subtract:{total:!0}}},{s:"n1*(-n) -> -(n1*n)",assuming:{subtract:{total:!0},multiply:{commutative:!1}}},{s:"c+v -> v+c",assuming:{add:{commutative:!0}},imposeContext:{add:{commutative:!1}}},{s:"v*c -> c*v",assuming:{multiply:{commutative:!0}},imposeContext:{multiply:{commutative:!1}}},{l:"n+-n1",r:"n-n1"},{s:"n*(n1^-1) -> n/n1",assuming:{multiply:{commutative:!0}}},{s:"n*n1^-n2 -> n/n1^n2",assuming:{multiply:{commutative:!0}}},{s:"n^-1 -> 1/n",assuming:{multiply:{commutative:!0}}},{l:"n^1",r:"n"},{s:"n*(n1/n2) -> (n*n1)/n2",assuming:{multiply:{associative:!0}}},{s:"n-(n1+n2) -> n-n1-n2",assuming:{addition:{associative:!0,commutative:!0}}},{l:"1*n",r:"n",imposeContext:{multiply:{commutative:!0}}},{s:"n1/(n2/n3) -> (n1*n3)/n2",assuming:{multiply:{associative:!0}}},{l:"n1/(-n2)",r:"-n1/n2"}];var al=0;function ll(Ls,Ws,Zs){var tl=Ls;if(Ls)for(var rl=0;rl<Ls.length;++rl){var qs=nl(Ls[rl],Ws,Zs);qs!==Ls[rl]&&(tl===Ls&&(tl=Ls.slice()),tl[rl]=qs)}return tl}function nl(Ls,Ws,Zs){if(Ws.assuming){for(var tl in Ws.assuming)for(var rl in Ws.assuming[tl])if(Vs(tl,rl,Zs)!==Ws.assuming[tl][rl])return Ls}var qs=Ps(Ws.imposeContext,Zs),Gs=Ls;if(Gs instanceof ws||Gs instanceof Cs){var Xs=ll(Gs.args,Ws,Zs);Xs!==Gs.args&&((Gs=Gs.clone()).args=Xs)}else if(Gs instanceof Es){if(Gs.content){var Ks=nl(Gs.content,Ws,Zs);Ks!==Gs.content&&(Gs=new Es(Ks))}}else if(Gs instanceof Ns){var ol=ll(Gs.items,Ws,Zs);ol!==Gs.items&&(Gs=new Ns(ol))}else if(Gs instanceof vs){var Fs=Gs.object;Gs.object&&(Fs=nl(Gs.object,Ws,Zs));var Qs=Gs.index;Gs.index&&(Qs=nl(Gs.index,Ws,Zs)),Fs===Gs.object&&Qs===Gs.index||(Gs=new vs(Fs,Qs))}else if(Gs instanceof xs){var Js=ll(Gs.dimensions,Ws,Zs);Js!==Gs.dimensions&&(Gs=new xs(Js))}else if(Gs instanceof As){var ul=!1,pl={};for(var ml in Gs.properties)pl[ml]=nl(Gs.properties[ml],Ws,Zs),pl[ml]!==Gs.properties[ml]&&(ul=!0);ul&&(Gs=new As(pl))}var fl=Ws.r,hl=sl(Ws.l,Gs,qs)[0];if(!hl&&Ws.expanded&&(fl=Ws.expanded.r,hl=sl(Ws.expanded.l,Gs,qs)[0]),hl){var yl=Gs.implicit;Gs=fl.clone(),yl&&"implicit"in fl&&(Gs.implicit=!0),Gs=Gs.transform(function(bl){return bl.isSymbolNode&&hasOwnProperty$2(hl.placeholders,bl.name)?hl.placeholders[bl.name].clone():bl})}return Ws.repeat&&Gs!==Ls&&(Gs=nl(Gs,Ws,Zs)),Gs}function cl(Ls,Ws){var Zs={placeholders:{}};if(!Ls.placeholders&&!Ws.placeholders)return Zs;if(!Ls.placeholders)return Ws;if(!Ws.placeholders)return Ls;for(var tl in Ls.placeholders)if(hasOwnProperty$2(Ls.placeholders,tl)&&(Zs.placeholders[tl]=Ls.placeholders[tl],hasOwnProperty$2(Ws.placeholders,tl)&&!js(Ls.placeholders[tl],Ws.placeholders[tl])))return null;for(var rl in Ws.placeholders)hasOwnProperty$2(Ws.placeholders,rl)&&(Zs.placeholders[rl]=Ws.placeholders[rl]);return Zs}function dl(Ls,Ws){var Zs,tl=[];if(Ls.length===0||Ws.length===0)return tl;for(var rl=0;rl<Ls.length;rl++)for(var qs=0;qs<Ws.length;qs++)(Zs=cl(Ls[rl],Ws[qs]))&&tl.push(Zs);return tl}function sl(Ls,Ws,Zs,tl){var rl=[{placeholders:{}}];if(Ls instanceof ws&&Ws instanceof ws||Ls instanceof Cs&&Ws instanceof Cs){if(Ls instanceof ws){if(Ls.op!==Ws.op||Ls.fn!==Ws.fn)return[]}else if(Ls instanceof Cs&&Ls.name!==Ws.name)return[];if(!(Ws.args.length===1&&Ls.args.length===1||!Os(Ws,Zs)&&Ws.args.length===Ls.args.length||tl)){if(Ws.args.length>=2&&Ls.args.length===2){for(var qs=function(pl,ml){var fl,hl,yl=[],bl=_s(pl);if(Is(pl,ml))for(var Tl=0;Tl<pl.args.length;Tl++)(hl=pl.args.slice(0)).splice(Tl,1),fl=hl.length===1?hl[0]:bl(hl),yl.push(bl([pl.args[Tl],fl]));else for(var Nl=1;Nl<pl.args.length;Nl++){var gl=pl.args[0];Nl>1&&(gl=bl(pl.args.slice(0,Nl))),fl=(hl=pl.args.slice(Nl)).length===1?hl[0]:bl(hl),yl.push(bl([gl,fl]))}return yl}(Ws,Zs),Gs=[],Xs=0;Xs<qs.length;Xs++){var Ks=sl(Ls,qs[Xs],Zs,!0);Gs=Gs.concat(Ks)}return Gs}if(Ls.args.length>2)throw Error("Unexpected non-binary associative function: "+Ls.toString());return[]}for(var ol=[],Fs=0;Fs<Ls.args.length;Fs++){var Qs=sl(Ls.args[Fs],Ws.args[Fs],Zs);if(Qs.length===0)break;ol.push(Qs)}if(ol.length!==Ls.args.length){if(!Is(Ws,Zs)||Ls.args.length===1)return[];if(Ls.args.length>2)throw new Error("permuting >2 commutative non-associative rule arguments not yet implemented");var Js=sl(Ls.args[0],Ws.args[1],Zs);if(Js.length===0)return[];var ul=sl(Ls.args[1],Ws.args[0],Zs);if(ul.length===0)return[];ol=[Js,ul]}rl=function(pl){if(pl.length===0)return pl;for(var ml=pl.reduce(dl),fl=[],hl={},yl=0;yl<ml.length;yl++){var bl=JSON.stringify(ml[yl]);hl[bl]||(hl[bl]=!0,fl.push(ml[yl]))}return fl}(ol)}else if(Ls instanceof Ss){if(Ls.name.length===0)throw new Error("Symbol in rule has 0 length...!?");if(Ys[Ls.name]){if(Ls.name!==Ws.name)return[]}else if(Ls.name[0]==="n"||Ls.name.substring(0,2)==="_p")rl[0].placeholders[Ls.name]=Ws;else if(Ls.name[0]==="v"){if(isConstantNode(Ws))return[];rl[0].placeholders[Ls.name]=Ws}else{if(Ls.name[0]!=="c")throw new Error("Invalid symbol in rule: "+Ls.name);if(!(Ws instanceof Ts))return[];rl[0].placeholders[Ls.name]=Ws}}else{if(!(Ls instanceof Ts))return[];if(!ps(Ls.value,Ws.value))return[]}return rl}function js(Ls,Ws){if(Ls instanceof Ts&&Ws instanceof Ts){if(!ps(Ls.value,Ws.value))return!1}else if(Ls instanceof Ss&&Ws instanceof Ss){if(Ls.name!==Ws.name)return!1}else{if(!(Ls instanceof ws&&Ws instanceof ws||Ls instanceof Cs&&Ws instanceof Cs))return!1;if(Ls instanceof ws){if(Ls.op!==Ws.op||Ls.fn!==Ws.fn)return!1}else if(Ls instanceof Cs&&Ls.name!==Ws.name)return!1;if(Ls.args.length!==Ws.args.length)return!1;for(var Zs=0;Zs<Ls.args.length;Zs++)if(!js(Ls.args[Zs],Ws.args[Zs]))return!1}return!0}return Hs}),name$o="simplifyCore",dependencies$o=["equal","isZero","add","subtract","multiply","divide","pow","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","SymbolNode"],createSimplifyCore=factory(name$o,dependencies$o,ss=>{var{equal:ts,isZero:rs,add:ns,subtract:is,multiply:as,divide:os,pow:ls,AccessorNode:us,ArrayNode:cs,ConstantNode:ps,FunctionNode:ds,IndexNode:fs,ObjectNode:hs,OperatorNode:ys,ParenthesisNode:gs,SymbolNode:bs}=ss,vs=new ps(0),Ns=new ps(1),{hasProperty:Ts,isCommutative:Cs}=createUtil({FunctionNode:ds,OperatorNode:ys,SymbolNode:bs});return function xs(As,ws){var Es=ws?ws.context:void 0;if(Ts(As,"trivial",Es)){if(isFunctionNode(As)&&As.args.length===1)return xs(As.args[0],ws);var Ss=!1,Ds=0;if(As.forEach(Bs=>{++Ds===1&&(Ss=xs(Bs,ws))}),Ds===1)return Ss}if(isOperatorNode(As)&&As.isUnary()){var Vs=xs(As.args[0],ws);if(As.op==="-"){if(isOperatorNode(Vs)){if(Vs.isUnary()&&Vs.op==="-")return Vs.args[0];if(Vs.isBinary()&&Vs.fn==="subtract")return new ys("-","subtract",[Vs.args[1],Vs.args[0]])}return new ys(As.op,As.fn,[Vs])}}else{if(isOperatorNode(As)&&As.isBinary()){var Is=xs(As.args[0],ws),Os=xs(As.args[1],ws);if(As.op==="+"){if(isConstantNode(Is)){if(rs(Is.value))return Os;if(isConstantNode(Os))return new ps(ns(Is.value,Os.value))}return isConstantNode(Os)&&rs(Os.value)?Is:isOperatorNode(Os)&&Os.isUnary()&&Os.op==="-"?new ys("-","subtract",[Is,Os.args[0]]):new ys(As.op,As.fn,Os?[Is,Os]:[Is])}if(As.op==="-"){if(isConstantNode(Is)&&Os){if(isConstantNode(Os))return new ps(is(Is.value,Os.value));if(rs(Is.value))return new ys("-","unaryMinus",[Os])}if(As.fn==="subtract")return isConstantNode(Os)&&rs(Os.value)?Is:isOperatorNode(Os)&&Os.isUnary()&&Os.op==="-"?xs(new ys("+","add",[Is,Os.args[0]]),ws):new ys(As.op,As.fn,[Is,Os])}else{if(As.op==="*"){if(isConstantNode(Is)){if(rs(Is.value))return vs;if(ts(Is.value,1))return Os;if(isConstantNode(Os))return new ps(as(Is.value,Os.value))}if(isConstantNode(Os)){if(rs(Os.value))return vs;if(ts(Os.value,1))return Is;if(isOperatorNode(Is)&&Is.isBinary()&&Is.op===As.op&&Cs(As,Es)){var Ps=Is.args[0];if(isConstantNode(Ps)){var $s=new ps(as(Ps.value,Os.value));return new ys(As.op,As.fn,[$s,Is.args[1]],As.implicit)}}return Cs(As,Es)?new ys(As.op,As.fn,[Os,Is],As.implicit):new ys(As.op,As.fn,[Is,Os],As.implicit)}return new ys(As.op,As.fn,[Is,Os],As.implicit)}if(As.op==="/"){if(isConstantNode(Is)){if(rs(Is.value))return vs;if(isConstantNode(Os)&&(ts(Os.value,1)||ts(Os.value,2)||ts(Os.value,4)))return new ps(os(Is.value,Os.value))}return new ys(As.op,As.fn,[Is,Os])}if(As.op==="^"&&isConstantNode(Os)){if(rs(Os.value))return Ns;if(ts(Os.value,1))return Is;if(isConstantNode(Is))return new ps(ls(Is.value,Os.value));if(isOperatorNode(Is)&&Is.isBinary()&&Is.op==="^"){var Rs=Is.args[1];if(isConstantNode(Rs))return new ys(As.op,As.fn,[Is.args[0],new ps(as(Rs.value,Os.value))])}}}return new ys(As.op,As.fn,[Is,Os])}if(isFunctionNode(As))return new ds(xs(As.fn),As.args.map(Bs=>xs(Bs,ws)));if(isArrayNode(As))return new cs(As.items.map(Bs=>xs(Bs,ws)));if(isAccessorNode(As))return new us(xs(As.object,ws),xs(As.index,ws));if(isIndexNode(As))return new fs(As.dimensions.map(Bs=>xs(Bs,ws)));if(isObjectNode(As)){var ks={};for(var _s in As.properties)ks[_s]=xs(As.properties[_s],ws);return new hs(ks)}}return As}}),name$n="resolve",dependencies$n=["parse","ConstantNode","FunctionNode","OperatorNode","ParenthesisNode"],createResolve=factory(name$n,dependencies$n,ss=>{var{parse:ts,ConstantNode:rs,FunctionNode:ns,OperatorNode:is,ParenthesisNode:as}=ss;return function os(ls,us){var cs=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set;if(!us)return ls;if(isMap$1(us)||(us=createMap$1(us)),isSymbolNode(ls)){if(cs.has(ls.name)){var ps=Array.from(cs).join(", ");throw new ReferenceError("recursive loop of variable definitions among {".concat(ps,"}"))}var ds=us.get(ls.name);if(isNode$1(ds)){var fs=new Set(cs);return fs.add(ls.name),os(ds,us,fs)}return typeof ds=="number"?ts(String(ds)):ds!==void 0?new rs(ds):ls}if(isOperatorNode(ls)){var hs=ls.args.map(function(gs){return os(gs,us,cs)});return new is(ls.op,ls.fn,hs,ls.implicit)}if(isParenthesisNode(ls))return new as(os(ls.content,us,cs));if(isFunctionNode(ls)){var ys=ls.args.map(function(gs){return os(gs,us,cs)});return new ns(ls.name,ys)}return ls.map(gs=>os(gs,us,cs))}}),name$m="symbolicEqual",dependencies$m=["parse","simplify","typed","OperatorNode"],createSymbolicEqual=factory(name$m,dependencies$m,ss=>{var{parse:ts,simplify:rs,typed:ns,OperatorNode:is}=ss;return ns(name$m,{"string, string":function(as,os){return this(ts(as),ts(os),{})},"string, string, Object":function(as,os,ls){return this(ts(as),ts(os),ls)},"Node, string":function(as,os){return this(as,ts(os),{})},"Node, string, Object":function(as,os,ls){return this(as,ts(os),ls)},"string, Node":function(as,os){return this(ts(as),os,{})},"string, Node, Object":function(as,os,ls){return this(ts(as),os,ls)},"Node, Node":function(as,os){return this(as,os,{})},"Node, Node, Object":function(as,os,ls){var us=new is("-","subtract",[as,os]),cs=rs(us,{},ls);return isConstantNode(cs)&&!cs.value}})}),name$l="derivative",dependencies$l=["typed","config","parse","simplify","equal","isZero","numeric","ConstantNode","FunctionNode","OperatorNode","ParenthesisNode","SymbolNode"],createDerivative=factory(name$l,dependencies$l,ss=>{var{typed:ts,config:rs,parse:ns,simplify:is,equal:as,isZero:os,numeric:ls,ConstantNode:us,FunctionNode:cs,OperatorNode:ps,ParenthesisNode:ds,SymbolNode:fs}=ss,hs=ts("derivative",{"Node, SymbolNode, Object":function(Ns,Ts,Cs){var xs={};gs(xs,Ns,Ts.name);var As=bs(Ns,xs);return Cs.simplify?is(As):As},"Node, SymbolNode":function(Ns,Ts){return this(Ns,Ts,{simplify:!0})},"string, SymbolNode":function(Ns,Ts){return this(ns(Ns),Ts)},"string, SymbolNode, Object":function(Ns,Ts,Cs){return this(ns(Ns),Ts,Cs)},"string, string":function(Ns,Ts){return this(ns(Ns),ns(Ts))},"string, string, Object":function(Ns,Ts,Cs){return this(ns(Ns),ns(Ts),Cs)},"Node, string":function(Ns,Ts){return this(Ns,ns(Ts))},"Node, string, Object":function(Ns,Ts,Cs){return this(Ns,ns(Ts),Cs)}});hs._simplify=!0,hs.toTex=function(Ns){return ys.apply(null,Ns.args)};var ys=ts("_derivTex",{"Node, SymbolNode":function(Ns,Ts){return isConstantNode(Ns)&&typeOf$1(Ns.value)==="string"?ys(ns(Ns.value).toString(),Ts.toString(),1):ys(Ns.toTex(),Ts.toString(),1)},"Node, ConstantNode":function(Ns,Ts){if(typeOf$1(Ts.value)==="string")return ys(Ns,ns(Ts.value));throw new Error("The second parameter to 'derivative' is a non-string constant")},"Node, SymbolNode, ConstantNode":function(Ns,Ts,Cs){return ys(Ns.toString(),Ts.name,Cs.value)},"string, string, number":function(Ns,Ts,Cs){return(Cs===1?"{d\\over d"+Ts+"}":"{d^{"+Cs+"}\\over d"+Ts+"^{"+Cs+"}}")+"\\left[".concat(Ns,"\\right]")}}),gs=ts("constTag",{"Object, ConstantNode, string":function(Ns,Ts){return Ns[Ts]=!0,!0},"Object, SymbolNode, string":function(Ns,Ts,Cs){return Ts.name!==Cs&&(Ns[Ts]=!0,!0)},"Object, ParenthesisNode, string":function(Ns,Ts,Cs){return gs(Ns,Ts.content,Cs)},"Object, FunctionAssignmentNode, string":function(Ns,Ts,Cs){return Ts.params.indexOf(Cs)===-1?(Ns[Ts]=!0,!0):gs(Ns,Ts.expr,Cs)},"Object, FunctionNode | OperatorNode, string":function(Ns,Ts,Cs){if(Ts.args.length>0){for(var xs=gs(Ns,Ts.args[0],Cs),As=1;As<Ts.args.length;++As)xs=gs(Ns,Ts.args[As],Cs)&&xs;if(xs)return Ns[Ts]=!0,!0}return!1}}),bs=ts("_derivative",{"ConstantNode, Object":function(Ns){return vs(0)},"SymbolNode, Object":function(Ns,Ts){return Ts[Ns]!==void 0?vs(0):vs(1)},"ParenthesisNode, Object":function(Ns,Ts){return new ds(bs(Ns.content,Ts))},"FunctionAssignmentNode, Object":function(Ns,Ts){return Ts[Ns]!==void 0?vs(0):bs(Ns.expr,Ts)},"FunctionNode, Object":function(Ns,Ts){if(Ns.args.length!==1&&function(Is){if(!((Is.name==="log"||Is.name==="nthRoot"||Is.name==="pow")&&Is.args.length===2)){for(var Os=0;Os<Is.args.length;++Os)Is.args[Os]=vs(0);throw Is.compile().evaluate(),new Error("Expected TypeError, but none found")}}(Ns),Ts[Ns]!==void 0)return vs(0);var Cs,xs,As,ws,Es=Ns.args[0],Ss=!1,Ds=!1;switch(Ns.name){case"cbrt":Ss=!0,xs=new ps("*","multiply",[vs(3),new ps("^","pow",[Es,new ps("/","divide",[vs(2),vs(3)])])]);break;case"sqrt":case"nthRoot":if(Ns.args.length===1)Ss=!0,xs=new ps("*","multiply",[vs(2),new cs("sqrt",[Es])]);else if(Ns.args.length===2)return Ts[Cs=new ps("/","divide",[vs(1),Ns.args[1]])]=Ts[Ns.args[1]],bs(new ps("^","pow",[Es,Cs]),Ts);break;case"log10":Cs=vs(10);case"log":if(Cs||Ns.args.length!==1){if(Ns.args.length===1&&Cs||Ns.args.length===2&&Ts[Ns.args[1]]!==void 0)xs=new ps("*","multiply",[Es.clone(),new cs("log",[Cs||Ns.args[1]])]),Ss=!0;else if(Ns.args.length===2)return bs(new ps("/","divide",[new cs("log",[Es]),new cs("log",[Ns.args[1]])]),Ts)}else xs=Es.clone(),Ss=!0;break;case"pow":return Ts[Cs]=Ts[Ns.args[1]],bs(new ps("^","pow",[Es,Ns.args[1]]),Ts);case"exp":xs=new cs("exp",[Es.clone()]);break;case"sin":xs=new cs("cos",[Es.clone()]);break;case"cos":xs=new ps("-","unaryMinus",[new cs("sin",[Es.clone()])]);break;case"tan":xs=new ps("^","pow",[new cs("sec",[Es.clone()]),vs(2)]);break;case"sec":xs=new ps("*","multiply",[Ns,new cs("tan",[Es.clone()])]);break;case"csc":Ds=!0,xs=new ps("*","multiply",[Ns,new cs("cot",[Es.clone()])]);break;case"cot":Ds=!0,xs=new ps("^","pow",[new cs("csc",[Es.clone()]),vs(2)]);break;case"asin":Ss=!0,xs=new cs("sqrt",[new ps("-","subtract",[vs(1),new ps("^","pow",[Es.clone(),vs(2)])])]);break;case"acos":Ss=!0,Ds=!0,xs=new cs("sqrt",[new ps("-","subtract",[vs(1),new ps("^","pow",[Es.clone(),vs(2)])])]);break;case"atan":Ss=!0,xs=new ps("+","add",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)]);break;case"asec":Ss=!0,xs=new ps("*","multiply",[new cs("abs",[Es.clone()]),new cs("sqrt",[new ps("-","subtract",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)])])]);break;case"acsc":Ss=!0,Ds=!0,xs=new ps("*","multiply",[new cs("abs",[Es.clone()]),new cs("sqrt",[new ps("-","subtract",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)])])]);break;case"acot":Ss=!0,Ds=!0,xs=new ps("+","add",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)]);break;case"sinh":xs=new cs("cosh",[Es.clone()]);break;case"cosh":xs=new cs("sinh",[Es.clone()]);break;case"tanh":xs=new ps("^","pow",[new cs("sech",[Es.clone()]),vs(2)]);break;case"sech":Ds=!0,xs=new ps("*","multiply",[Ns,new cs("tanh",[Es.clone()])]);break;case"csch":Ds=!0,xs=new ps("*","multiply",[Ns,new cs("coth",[Es.clone()])]);break;case"coth":Ds=!0,xs=new ps("^","pow",[new cs("csch",[Es.clone()]),vs(2)]);break;case"asinh":Ss=!0,xs=new cs("sqrt",[new ps("+","add",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)])]);break;case"acosh":Ss=!0,xs=new cs("sqrt",[new ps("-","subtract",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)])]);break;case"atanh":Ss=!0,xs=new ps("-","subtract",[vs(1),new ps("^","pow",[Es.clone(),vs(2)])]);break;case"asech":Ss=!0,Ds=!0,xs=new ps("*","multiply",[Es.clone(),new cs("sqrt",[new ps("-","subtract",[vs(1),new ps("^","pow",[Es.clone(),vs(2)])])])]);break;case"acsch":Ss=!0,Ds=!0,xs=new ps("*","multiply",[new cs("abs",[Es.clone()]),new cs("sqrt",[new ps("+","add",[new ps("^","pow",[Es.clone(),vs(2)]),vs(1)])])]);break;case"acoth":Ss=!0,Ds=!0,xs=new ps("-","subtract",[vs(1),new ps("^","pow",[Es.clone(),vs(2)])]);break;case"abs":xs=new ps("/","divide",[new cs(new fs("abs"),[Es.clone()]),Es.clone()]);break;default:throw new Error('Function "'+Ns.name+'" is not supported by derivative, or a wrong number of arguments is passed')}Ss?(As="/",ws="divide"):(As="*",ws="multiply");var Vs=bs(Es,Ts);return Ds&&(Vs=new ps("-","unaryMinus",[Vs])),new ps(As,ws,[Vs,xs])},"OperatorNode, Object":function(Ns,Ts){if(Ts[Ns]!==void 0)return vs(0);if(Ns.op==="+")return new ps(Ns.op,Ns.fn,Ns.args.map(function(Os){return bs(Os,Ts)}));if(Ns.op==="-"){if(Ns.isUnary())return new ps(Ns.op,Ns.fn,[bs(Ns.args[0],Ts)]);if(Ns.isBinary())return new ps(Ns.op,Ns.fn,[bs(Ns.args[0],Ts),bs(Ns.args[1],Ts)])}if(Ns.op==="*"){var Cs=Ns.args.filter(function(Os){return Ts[Os]!==void 0});if(Cs.length>0){var xs=Ns.args.filter(function(Os){return Ts[Os]===void 0}),As=xs.length===1?xs[0]:new ps("*","multiply",xs),ws=Cs.concat(bs(As,Ts));return new ps("*","multiply",ws)}return new ps("+","add",Ns.args.map(function(Os){return new ps("*","multiply",Ns.args.map(function(Ps){return Ps===Os?bs(Ps,Ts):Ps.clone()}))}))}if(Ns.op==="/"&&Ns.isBinary()){var Es=Ns.args[0],Ss=Ns.args[1];return Ts[Ss]!==void 0?new ps("/","divide",[bs(Es,Ts),Ss]):Ts[Es]!==void 0?new ps("*","multiply",[new ps("-","unaryMinus",[Es]),new ps("/","divide",[bs(Ss,Ts),new ps("^","pow",[Ss.clone(),vs(2)])])]):new ps("/","divide",[new ps("-","subtract",[new ps("*","multiply",[bs(Es,Ts),Ss.clone()]),new ps("*","multiply",[Es.clone(),bs(Ss,Ts)])]),new ps("^","pow",[Ss.clone(),vs(2)])])}if(Ns.op==="^"&&Ns.isBinary()){var Ds=Ns.args[0],Vs=Ns.args[1];if(Ts[Ds]!==void 0)return isConstantNode(Ds)&&(os(Ds.value)||as(Ds.value,1))?vs(0):new ps("*","multiply",[Ns,new ps("*","multiply",[new cs("log",[Ds.clone()]),bs(Vs.clone(),Ts)])]);if(Ts[Vs]!==void 0){if(isConstantNode(Vs)){if(os(Vs.value))return vs(0);if(as(Vs.value,1))return bs(Ds,Ts)}var Is=new ps("^","pow",[Ds.clone(),new ps("-","subtract",[Vs,vs(1)])]);return new ps("*","multiply",[Vs.clone(),new ps("*","multiply",[bs(Ds,Ts),Is])])}return new ps("*","multiply",[new ps("^","pow",[Ds.clone(),Vs.clone()]),new ps("+","add",[new ps("*","multiply",[bs(Ds,Ts),new ps("/","divide",[Vs.clone(),Ds.clone()])]),new ps("*","multiply",[bs(Vs,Ts),new cs("log",[Ds.clone()])])])])}throw new Error('Operator "'+Ns.op+'" is not supported by derivative, or a wrong number of arguments is passed')}});function vs(Ns,Ts){return new us(ls(Ns,Ts||rs.number))}return hs}),name$k="rationalize",dependencies$k=["config","typed","equal","isZero","add","subtract","multiply","divide","pow","parse","simplifyCore","simplify","?bignumber","?fraction","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode","ParenthesisNode"],createRationalize=factory(name$k,dependencies$k,ss=>{var{config:ts,typed:rs,equal:ns,isZero:is,add:as,subtract:os,multiply:ls,divide:us,pow:cs,parse:ps,simplifyCore:ds,simplify:fs,fraction:hs,bignumber:ys,mathWithTransform:gs,matrix:bs,AccessorNode:vs,ArrayNode:Ns,ConstantNode:Ts,FunctionNode:Cs,IndexNode:xs,ObjectNode:As,OperatorNode:ws,SymbolNode:Es,ParenthesisNode:Ss}=ss,Ds=createSimplifyConstant({typed:rs,config:ts,mathWithTransform:gs,matrix:bs,fraction:hs,bignumber:ys,AccessorNode:vs,ArrayNode:Ns,ConstantNode:Ts,FunctionNode:Cs,IndexNode:xs,ObjectNode:As,OperatorNode:ws,SymbolNode:Es});return rs(name$k,{string:function(Os){return this(ps(Os),{},!1)},"string, boolean":function(Os,Ps){return this(ps(Os),{},Ps)},"string, Object":function(Os,Ps){return this(ps(Os),Ps,!1)},"string, Object, boolean":function(Os,Ps,$s){return this(ps(Os),Ps,$s)},Node:function(Os){return this(Os,{},!1)},"Node, boolean":function(Os,Ps){return this(Os,{},Ps)},"Node, Object":function(Os,Ps){return this(Os,Ps,!1)},"Node, Object, boolean":function(Os,Ps,$s){var Rs=function(){var nl=[ds,{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},Ds,{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"1*n",r:"n"}],cl=[{l:"(-n1)/(-n2)",r:"n1/n2"},{l:"(-n1)*(-n2)",r:"n1*n2"},{l:"n1--n2",r:"n1+n2"},{l:"n1-n2",r:"n1+(-n2)"},{l:"(n1+n2)*n3",r:"(n1*n3 + n2*n3)"},{l:"n1*(n2+n3)",r:"(n1*n2+n1*n3)"},{l:"c1*n + c2*n",r:"(c1+c2)*n"},{l:"c1*n + n",r:"(c1+1)*n"},{l:"c1*n - c2*n",r:"(c1-c2)*n"},{l:"c1*n - n",r:"(c1-1)*n"},{l:"v/c",r:"(1/c)*v"},{l:"v/-c",r:"-(1/c)*v"},{l:"-v*-c",r:"c*v"},{l:"-v*c",r:"-c*v"},{l:"v*-c",r:"-c*v"},{l:"v*c",r:"c*v"},{l:"-(-n1*n2)",r:"(n1*n2)"},{l:"-(n1*n2)",r:"(-n1*n2)"},{l:"-(-n1+n2)",r:"(n1-n2)"},{l:"-(n1+n2)",r:"(-n1-n2)"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"},{l:"-(-n1/n2)",r:"(n1/n2)"},{l:"-(n1/n2)",r:"(-n1/n2)"}],dl=[{l:"(n1/n2 + n3/n4)",r:"((n1*n4 + n3*n2)/(n2*n4))"},{l:"(n1/n2 + n3)",r:"((n1 + n3*n2)/n2)"},{l:"(n1 + n2/n3)",r:"((n1*n3 + n2)/n3)"}],sl=[{l:"(n1/(n2/n3))",r:"((n1*n3)/n2)"},{l:"(n1/n2/n3)",r:"(n1/(n2*n3))"}],js={};return js.firstRules=nl.concat(cl,sl),js.distrDivRules=dl,js.sucDivRules=sl,js.firstRulesAgain=nl.concat(cl),js.finalRules=[ds,{l:"n*-n",r:"-n^2"},{l:"n*n",r:"n^2"},Ds,{l:"n*-n^n1",r:"-n^(n1+1)"},{l:"n*n^n1",r:"n^(n1+1)"},{l:"n^n1*-n^n2",r:"-n^(n1+n2)"},{l:"n^n1*n^n2",r:"n^(n1+n2)"},{l:"n^n1*-n",r:"-n^(n1+1)"},{l:"n^n1*n",r:"n^(n1+1)"},{l:"n^n1/-n",r:"-n^(n1-1)"},{l:"n^n1/n",r:"n^(n1-1)"},{l:"n/-n^n1",r:"-n^(1-n1)"},{l:"n/n^n1",r:"n^(1-n1)"},{l:"n^n1/-n^n2",r:"n^(n1-n2)"},{l:"n^n1/n^n2",r:"n^(n1-n2)"},{l:"n1+(-n2*n3)",r:"n1-n2*n3"},{l:"v*(-c)",r:"-c*v"},{l:"n1+-n2",r:"n1-n2"},{l:"v*c",r:"c*v"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"}],js}(),ks=function(nl,cl,dl,sl){var js=[],Ls=fs(nl,sl,cl,{exactFractions:!1}),Ws="+-*"+((dl=!!dl)?"/":"");tl(Ls);var Zs={};return Zs.expression=Ls,Zs.variables=js,Zs;function tl(rl){var qs=rl.type;if(qs==="FunctionNode")throw new Error("There is an unsolved function call");if(qs==="OperatorNode")if(rl.op==="^"){if(rl.args[1].type!=="ConstantNode"||!isInteger$1(parseFloat(rl.args[1].value)))throw new Error("There is a non-integer exponent");tl(rl.args[0])}else{if(Ws.indexOf(rl.op)===-1)throw new Error("Operator "+rl.op+" invalid in polynomial expression");for(var Gs=0;Gs<rl.args.length;Gs++)tl(rl.args[Gs])}else if(qs==="SymbolNode"){var Xs=rl.name;js.indexOf(Xs)===-1&&js.push(Xs)}else if(qs==="ParenthesisNode")tl(rl.content);else if(qs!=="ConstantNode")throw new Error("type "+qs+" is not allowed in polynomial expression")}}(Os,Ps,!0,Rs.firstRules),_s=ks.variables.length,Bs={exactFractions:!1},Us={exactFractions:!0};if(Os=ks.expression,_s>=1){var zs,Hs;Os=Vs(Os);var el,Ys=!0,il=!1;for(Os=fs(Os,Rs.firstRules,{},Bs);Hs=Ys?Rs.distrDivRules:Rs.sucDivRules,Ys=!Ys,(el=(Os=fs(Os,Hs,{},Us)).toString())!==zs;)il=!0,zs=el;il&&(Os=fs(Os,Rs.firstRulesAgain,{},Bs)),Os=fs(Os,Rs.finalRules,{},Bs)}var al=[],ll={};return Os.type==="OperatorNode"&&Os.isBinary()&&Os.op==="/"?(_s===1&&(Os.args[0]=Is(Os.args[0],al),Os.args[1]=Is(Os.args[1])),$s&&(ll.numerator=Os.args[0],ll.denominator=Os.args[1])):(_s===1&&(Os=Is(Os,al)),$s&&(ll.numerator=Os,ll.denominator=null)),$s?(ll.coefficients=al,ll.variables=ks.variables,ll.expression=Os,ll):Os}});function Vs(Os,Ps,$s){var Rs=Os.type,ks=arguments.length>1;if(Rs==="OperatorNode"&&Os.isBinary()){var _s,Bs=!1;if(Os.op==="^"&&(Os.args[0].type!=="ParenthesisNode"&&Os.args[0].type!=="OperatorNode"||Os.args[1].type!=="ConstantNode"||(Bs=(_s=parseFloat(Os.args[1].value))>=2&&isInteger$1(_s))),Bs){if(_s>2){var Us=Os.args[0],zs=new ws("^","pow",[Os.args[0].cloneDeep(),new Ts(_s-1)]);Os=new ws("*","multiply",[Us,zs])}else Os=new ws("*","multiply",[Os.args[0],Os.args[0].cloneDeep()]);ks&&($s==="content"?Ps.content=Os:Ps.args[$s]=Os)}}if(Rs==="ParenthesisNode")Vs(Os.content,Os,"content");else if(Rs!=="ConstantNode"&&Rs!=="SymbolNode")for(var Hs=0;Hs<Os.args.length;Hs++)Vs(Os.args[Hs],Os,Hs);if(!ks)return Os}function Is(Os,Ps){Ps===void 0&&(Ps=[]),Ps[0]=0;var $s={cte:1,oper:"+",fire:""},Rs=0,ks="";(function il(al,ll,nl){var cl=al.type;if(cl==="FunctionNode")throw new Error("There is an unsolved function call");if(cl==="OperatorNode"){if("+-*^".indexOf(al.op)===-1)throw new Error("Operator "+al.op+" invalid");if(ll!==null){if((al.fn==="unaryMinus"||al.fn==="pow")&&ll.fn!=="add"&&ll.fn!=="subtract"&&ll.fn!=="multiply")throw new Error("Invalid "+al.op+" placing");if((al.fn==="subtract"||al.fn==="add"||al.fn==="multiply")&&ll.fn!=="add"&&ll.fn!=="subtract")throw new Error("Invalid "+al.op+" placing");if((al.fn==="subtract"||al.fn==="add"||al.fn==="unaryMinus")&&nl.noFil!==0)throw new Error("Invalid "+al.op+" placing")}al.op!=="^"&&al.op!=="*"||(nl.fire=al.op);for(var dl=0;dl<al.args.length;dl++)al.fn==="unaryMinus"&&(nl.oper="-"),al.op!=="+"&&al.fn!=="subtract"||(nl.fire="",nl.cte=1,nl.oper=dl===0?"+":al.op),nl.noFil=dl,il(al.args[dl],al,nl)}else if(cl==="SymbolNode"){if(al.name!==ks&&ks!=="")throw new Error("There is more than one variable");if(ks=al.name,ll===null)return void(Ps[1]=1);if(ll.op==="^"&&nl.noFil!==0)throw new Error("In power the variable should be the first parameter");if(ll.op==="*"&&nl.noFil!==1)throw new Error("In multiply the variable should be the second parameter");nl.fire!==""&&nl.fire!=="*"||(Rs<1&&(Ps[1]=0),Ps[1]+=nl.cte*(nl.oper==="+"?1:-1),Rs=Math.max(1,Rs))}else{if(cl!=="ConstantNode")throw new Error("Type "+cl+" is not allowed");var sl=parseFloat(al.value);if(ll===null)return void(Ps[0]=sl);if(ll.op==="^"){if(nl.noFil!==1)throw new Error("Constant cannot be powered");if(!isInteger$1(sl)||sl<=0)throw new Error("Non-integer exponent is not allowed");for(var js=Rs+1;js<sl;js++)Ps[js]=0;return sl>Rs&&(Ps[sl]=0),Ps[sl]+=nl.cte*(nl.oper==="+"?1:-1),void(Rs=Math.max(sl,Rs))}nl.cte=sl,nl.fire===""&&(Ps[0]+=nl.cte*(nl.oper==="+"?1:-1))}})(Os,null,$s);for(var _s,Bs=!0,Us=Rs=Ps.length-1;Us>=0;Us--)if(Ps[Us]!==0){var zs=new Ts(Bs?Ps[Us]:Math.abs(Ps[Us])),Hs=Ps[Us]<0?"-":"+";if(Us>0){var el=new Es(ks);if(Us>1){var Ys=new Ts(Us);el=new ws("^","pow",[el,Ys])}zs=Ps[Us]===-1&&Bs?new ws("-","unaryMinus",[el]):Math.abs(Ps[Us])===1?el:new ws("*","multiply",[zs,el])}_s=Bs?zs:Hs==="+"?new ws("+","add",[_s,zs]):new ws("-","subtract",[_s,zs]),Bs=!1}return Bs?new Ts(0):_s}}),name$j="reviver",dependencies$j=["classes"],createReviver=factory(name$j,dependencies$j,ss=>{var{classes:ts}=ss;return function(rs,ns){var is=ts[ns&&ns.mathjs];return is&&typeof is.fromJSON=="function"?is.fromJSON(ns):ns}}),name$i="replacer",dependencies$i=[],createReplacer=factory(name$i,dependencies$i,()=>function(ss,ts){return typeof ts!="number"||isFinite(ts)&&!isNaN(ts)?ts:{mathjs:"number",value:String(ts)}}),version$2="10.6.4",createTrue=factory("true",[],()=>!0),createFalse=factory("false",[],()=>!1),createNull=factory("null",[],()=>null),createInfinity=recreateFactory("Infinity",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(1/0):1/0}),createNaN=recreateFactory("NaN",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(NaN):NaN}),createPi=recreateFactory("pi",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?createBigNumberPi(rs):pi$1}),createTau=recreateFactory("tau",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?createBigNumberTau(rs):tau$1}),createE=recreateFactory("e",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?createBigNumberE(rs):e$1$1}),createPhi=recreateFactory("phi",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?createBigNumberPhi(rs):phi$1}),createLN2=recreateFactory("LN2",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(2).ln():Math.LN2}),createLN10=recreateFactory("LN10",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(10).ln():Math.LN10}),createLOG2E=recreateFactory("LOG2E",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(1).div(new rs(2).ln()):Math.LOG2E}),createLOG10E=recreateFactory("LOG10E",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(1).div(new rs(10).ln()):Math.LOG10E}),createSQRT1_2=recreateFactory("SQRT1_2",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs("0.5").sqrt():Math.SQRT1_2}),createSQRT2=recreateFactory("SQRT2",["config","?BigNumber"],ss=>{var{config:ts,BigNumber:rs}=ss;return ts.number==="BigNumber"?new rs(2).sqrt():Math.SQRT2}),createI=recreateFactory("i",["Complex"],ss=>{var{Complex:ts}=ss;return ts.I}),createUppercasePi=factory("PI",["pi"],ss=>{var{pi:ts}=ss;return ts}),createUppercaseE=factory("E",["e"],ss=>{var{e:ts}=ss;return ts}),createVersion=factory("version",[],()=>version$2);function recreateFactory(ss,ts,rs){return factory(ss,ts,rs,{recreateOnConfigChange:!0})}var createSpeedOfLight=unitFactory("speedOfLight","299792458","m s^-1"),createGravitationConstant=unitFactory("gravitationConstant","6.67430e-11","m^3 kg^-1 s^-2"),createPlanckConstant=unitFactory("planckConstant","6.62607015e-34","J s"),createReducedPlanckConstant=unitFactory("reducedPlanckConstant","1.0545718176461565e-34","J s"),createMagneticConstant=unitFactory("magneticConstant","1.25663706212e-6","N A^-2"),createElectricConstant=unitFactory("electricConstant","8.8541878128e-12","F m^-1"),createVacuumImpedance=unitFactory("vacuumImpedance","376.730313667","ohm"),createCoulomb=unitFactory("coulomb","8.987551792261171e9","N m^2 C^-2"),createElementaryCharge=unitFactory("elementaryCharge","1.602176634e-19","C"),createBohrMagneton=unitFactory("bohrMagneton","9.2740100783e-24","J T^-1"),createConductanceQuantum=unitFactory("conductanceQuantum","7.748091729863649e-5","S"),createInverseConductanceQuantum=unitFactory("inverseConductanceQuantum","12906.403729652257","ohm"),createMagneticFluxQuantum=unitFactory("magneticFluxQuantum","2.0678338484619295e-15","Wb"),createNuclearMagneton=unitFactory("nuclearMagneton","5.0507837461e-27","J T^-1"),createKlitzing=unitFactory("klitzing","25812.807459304513","ohm"),createBohrRadius=unitFactory("bohrRadius","5.29177210903e-11","m"),createClassicalElectronRadius=unitFactory("classicalElectronRadius","2.8179403262e-15","m"),createElectronMass=unitFactory("electronMass","9.1093837015e-31","kg"),createFermiCoupling=unitFactory("fermiCoupling","1.1663787e-5","GeV^-2"),createFineStructure=numberFactory("fineStructure",.0072973525693),createHartreeEnergy=unitFactory("hartreeEnergy","4.3597447222071e-18","J"),createProtonMass=unitFactory("protonMass","1.67262192369e-27","kg"),createDeuteronMass=unitFactory("deuteronMass","3.3435830926e-27","kg"),createNeutronMass=unitFactory("neutronMass","1.6749271613e-27","kg"),createQuantumOfCirculation=unitFactory("quantumOfCirculation","3.6369475516e-4","m^2 s^-1"),createRydberg=unitFactory("rydberg","10973731.568160","m^-1"),createThomsonCrossSection=unitFactory("thomsonCrossSection","6.6524587321e-29","m^2"),createWeakMixingAngle=numberFactory("weakMixingAngle",.2229),createEfimovFactor=numberFactory("efimovFactor",22.7),createAtomicMass=unitFactory("atomicMass","1.66053906660e-27","kg"),createAvogadro=unitFactory("avogadro","6.02214076e23","mol^-1"),createBoltzmann=unitFactory("boltzmann","1.380649e-23","J K^-1"),createFaraday=unitFactory("faraday","96485.33212331001","C mol^-1"),createFirstRadiation=unitFactory("firstRadiation","3.7417718521927573e-16","W m^2"),createLoschmidt=unitFactory("loschmidt","2.686780111798444e25","m^-3"),createGasConstant=unitFactory("gasConstant","8.31446261815324","J K^-1 mol^-1"),createMolarPlanckConstant=unitFactory("molarPlanckConstant","3.990312712893431e-10","J s mol^-1"),createMolarVolume=unitFactory("molarVolume","0.022413969545014137","m^3 mol^-1"),createSackurTetrode=numberFactory("sackurTetrode",-1.16487052358),createSecondRadiation=unitFactory("secondRadiation","0.014387768775039337","m K"),createStefanBoltzmann=unitFactory("stefanBoltzmann","5.67037441918443e-8","W m^-2 K^-4"),createWienDisplacement=unitFactory("wienDisplacement","2.897771955e-3","m K"),createMolarMass=unitFactory("molarMass","0.99999999965e-3","kg mol^-1"),createMolarMassC12=unitFactory("molarMassC12","11.9999999958e-3","kg mol^-1"),createGravity=unitFactory("gravity","9.80665","m s^-2"),createPlanckLength=unitFactory("planckLength","1.616255e-35","m"),createPlanckMass=unitFactory("planckMass","2.176435e-8","kg"),createPlanckTime=unitFactory("planckTime","5.391245e-44","s"),createPlanckCharge=unitFactory("planckCharge","1.87554603778e-18","C"),createPlanckTemperature=unitFactory("planckTemperature","1.416785e+32","K");function unitFactory(ss,ts,rs){return factory(ss,["config","Unit","BigNumber"],ns=>{var{config:is,Unit:as,BigNumber:os}=ns,ls=new as(is.number==="BigNumber"?new os(ts):parseFloat(ts),rs);return ls.fixPrefix=!0,ls})}function numberFactory(ss,ts){return factory(ss,["config","BigNumber"],rs=>{var{config:ns,BigNumber:is}=rs;return ns.number==="BigNumber"?new is(ts):ts})}var name$h="apply",dependencies$h=["typed","isInteger"],createApplyTransform=factory(name$h,dependencies$h,ss=>{var{typed:ts,isInteger:rs}=ss,ns=createApply({typed:ts,isInteger:rs});return ts("apply",{"...any":function(is){var as=is[1];isNumber$1(as)?is[1]=as-1:isBigNumber(as)&&(is[1]=as.minus(1));try{return ns.apply(null,is)}catch(os){throw errorTransform(os)}}})},{isTransformFunction:!0}),name$g="column",dependencies$g=["typed","Index","matrix","range"],createColumnTransform=factory(name$g,dependencies$g,ss=>{var{typed:ts,Index:rs,matrix:ns,range:is}=ss,as=createColumn({typed:ts,Index:rs,matrix:ns,range:is});return ts("column",{"...any":function(os){var ls=os.length-1,us=os[ls];isNumber$1(us)&&(os[ls]=us-1);try{return as.apply(null,os)}catch(cs){throw errorTransform(cs)}}})},{isTransformFunction:!0});function compileInlineExpression(ss,ts,rs){var ns=ss.filter(function(ls){return isSymbolNode(ls)&&!(ls.name in ts)&&!rs.has(ls.name)})[0];if(!ns)throw new Error('No undefined variable found in inline expression "'+ss+'"');var is=ns.name,as=createSubScope(rs),os=ss.compile();return function(ls){return as.set(is,ls),os.evaluate(as)}}var name$f="filter",dependencies$f=["typed"],createFilterTransform=factory(name$f,dependencies$f,ss=>{var{typed:ts}=ss;function rs(is,as,os){var ls,us;return is[0]&&(ls=is[0].compile().evaluate(os)),is[1]&&(us=isSymbolNode(is[1])||isFunctionAssignmentNode(is[1])?is[1].compile().evaluate(os):compileInlineExpression(is[1],as,os)),ns(ls,us)}rs.rawArgs=!0;var ns=ts("filter",{"Array, function":_filter,"Matrix, function":function(is,as){return is.create(_filter(is.toArray(),as))},"Array, RegExp":filterRegExp,"Matrix, RegExp":function(is,as){return is.create(filterRegExp(is.toArray(),as))}});return rs},{isTransformFunction:!0});function _filter(ss,ts){var rs=maxArgumentCount(ts);return filter$2(ss,function(ns,is,as){return rs===1?ts(ns):rs===2?ts(ns,[is+1]):ts(ns,[is+1],as)})}var name$e="forEach",dependencies$e=["typed"],createForEachTransform=factory(name$e,dependencies$e,ss=>{var{typed:ts}=ss;function rs(is,as,os){var ls,us;return is[0]&&(ls=is[0].compile().evaluate(os)),is[1]&&(us=isSymbolNode(is[1])||isFunctionAssignmentNode(is[1])?is[1].compile().evaluate(os):compileInlineExpression(is[1],as,os)),ns(ls,us)}rs.rawArgs=!0;var ns=ts("forEach",{"Array | Matrix, function":function(is,as){var os=maxArgumentCount(as);(function ls(us,cs){Array.isArray(us)?forEach$1$1(us,function(ps,ds){ls(ps,cs.concat(ds+1))}):os===1?as(us):os===2?as(us,cs):as(us,cs,is)})(is.valueOf(),[])}});return rs},{isTransformFunction:!0}),name$d="index",dependencies$d=["Index"],createIndexTransform=factory(name$d,dependencies$d,ss=>{var{Index:ts}=ss;return function(){for(var rs=[],ns=0,is=arguments.length;ns<is;ns++){var as=arguments[ns];if(isRange(as))as.start--,as.end-=as.step>0?0:2;else if(as&&as.isSet===!0)as=as.map(function(ls){return ls-1});else if(isArray$1$1(as)||isMatrix(as))as=as.map(function(ls){return ls-1});else if(isNumber$1(as))as--;else if(isBigNumber(as))as=as.toNumber()-1;else if(typeof as!="string")throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");rs[ns]=as}var os=new ts;return ts.apply(os,rs),os}},{isTransformFunction:!0}),name$c="map",dependencies$c=["typed"],createMapTransform=factory(name$c,dependencies$c,ss=>{var{typed:ts}=ss;function rs(is,as,os){var ls,us;return is[0]&&(ls=is[0].compile().evaluate(os)),is[1]&&(us=isSymbolNode(is[1])||isFunctionAssignmentNode(is[1])?is[1].compile().evaluate(os):compileInlineExpression(is[1],as,os)),ns(ls,us)}rs.rawArgs=!0;var ns=ts("map",{"Array, function":function(is,as){return _map(is,as,is)},"Matrix, function":function(is,as){return is.create(_map(is.valueOf(),as,is))}});return rs},{isTransformFunction:!0});function _map(ss,ts,rs){var ns=maxArgumentCount(ts);return function is(as,os){return Array.isArray(as)?map$2(as,function(ls,us){return is(ls,os.concat(us+1))}):ns===1?ts(as):ns===2?ts(as,os):ts(as,os,rs)}(ss,[])}function lastDimToZeroBase(ss){if(ss.length===2&&isCollection(ss[0])){var ts=(ss=ss.slice())[1];isNumber$1(ts)?ss[1]=ts-1:isBigNumber(ts)&&(ss[1]=ts.minus(1))}return ss}var name$b="max",dependencies$b=["typed","config","numeric","larger"],createMaxTransform=factory(name$b,dependencies$b,ss=>{var{typed:ts,config:rs,numeric:ns,larger:is}=ss,as=createMax({typed:ts,config:rs,numeric:ns,larger:is});return ts("max",{"...any":function(os){os=lastDimToZeroBase(os);try{return as.apply(null,os)}catch(ls){throw errorTransform(ls)}}})},{isTransformFunction:!0}),name$a="mean",dependencies$a=["typed","add","divide"],createMeanTransform=factory(name$a,dependencies$a,ss=>{var{typed:ts,add:rs,divide:ns}=ss,is=createMean({typed:ts,add:rs,divide:ns});return ts("mean",{"...any":function(as){as=lastDimToZeroBase(as);try{return is.apply(null,as)}catch(os){throw errorTransform(os)}}})},{isTransformFunction:!0}),name$9="min",dependencies$9=["typed","config","numeric","smaller"],createMinTransform=factory(name$9,dependencies$9,ss=>{var{typed:ts,config:rs,numeric:ns,smaller:is}=ss,as=createMin({typed:ts,config:rs,numeric:ns,smaller:is});return ts("min",{"...any":function(os){os=lastDimToZeroBase(os);try{return as.apply(null,os)}catch(ls){throw errorTransform(ls)}}})},{isTransformFunction:!0}),name$8="range",dependencies$8=["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq"],createRangeTransform=factory(name$8,dependencies$8,ss=>{var{typed:ts,config:rs,matrix:ns,bignumber:is,smaller:as,smallerEq:os,larger:ls,largerEq:us}=ss,cs=createRange({typed:ts,config:rs,matrix:ns,bignumber:is,smaller:as,smallerEq:os,larger:ls,largerEq:us});return ts("range",{"...any":function(ps){return typeof ps[ps.length-1]!="boolean"&&ps.push(!0),cs.apply(null,ps)}})},{isTransformFunction:!0}),name$7="row",dependencies$7=["typed","Index","matrix","range"],createRowTransform=factory(name$7,dependencies$7,ss=>{var{typed:ts,Index:rs,matrix:ns,range:is}=ss,as=createRow({typed:ts,Index:rs,matrix:ns,range:is});return ts("row",{"...any":function(os){var ls=os.length-1,us=os[ls];isNumber$1(us)&&(os[ls]=us-1);try{return as.apply(null,os)}catch(cs){throw errorTransform(cs)}}})},{isTransformFunction:!0}),name$6="subset",dependencies$6=["typed","matrix"],createSubsetTransform=factory(name$6,dependencies$6,ss=>{var{typed:ts,matrix:rs}=ss,ns=createSubset({typed:ts,matrix:rs});return ts("subset",{"...any":function(is){try{return ns.apply(null,is)}catch(as){throw errorTransform(as)}}})},{isTransformFunction:!0}),name$5="concat",dependencies$5=["typed","matrix","isInteger"],createConcatTransform=factory(name$5,dependencies$5,ss=>{var{typed:ts,matrix:rs,isInteger:ns}=ss,is=createConcat({typed:ts,matrix:rs,isInteger:ns});return ts("concat",{"...any":function(as){var os=as.length-1,ls=as[os];isNumber$1(ls)?as[os]=ls-1:isBigNumber(ls)&&(as[os]=ls.minus(1));try{return is.apply(null,as)}catch(us){throw errorTransform(us)}}})},{isTransformFunction:!0}),name$4="diff",dependencies$4=["typed","matrix","subtract","number","bignumber"],createDiffTransform=factory(name$4,dependencies$4,ss=>{var{typed:ts,matrix:rs,subtract:ns,number:is,bignumber:as}=ss,os=createDiff({typed:ts,matrix:rs,subtract:ns,number:is,bignumber:as});return ts(name$4,{"...any":function(ls){ls=lastDimToZeroBase(ls);try{return os.apply(null,ls)}catch(us){throw errorTransform(us)}}})},{isTransformFunction:!0}),name$3="std",dependencies$3=["typed","sqrt","variance"],createStdTransform=factory(name$3,dependencies$3,ss=>{var{typed:ts,sqrt:rs,variance:ns}=ss,is=createStd({typed:ts,sqrt:rs,variance:ns});return ts("std",{"...any":function(as){as=lastDimToZeroBase(as);try{return is.apply(null,as)}catch(os){throw errorTransform(os)}}})},{isTransformFunction:!0}),name$2="sum",dependencies$2=["typed","config","add","numeric"],createSumTransform=factory(name$2,dependencies$2,ss=>{var{typed:ts,config:rs,add:ns,numeric:is}=ss,as=createSum({typed:ts,config:rs,add:ns,numeric:is});return ts(name$2,{"...any":function(os){os=lastDimToZeroBase(os);try{return as.apply(null,os)}catch(ls){throw errorTransform(ls)}}})},{isTransformFunction:!0}),name$1="cumsum",dependencies$1=["typed","add","unaryPlus"],createCumSumTransform=factory(name$1,dependencies$1,ss=>{var{typed:ts,add:rs,unaryPlus:ns}=ss,is=createCumSum({typed:ts,add:rs,unaryPlus:ns});return ts(name$1,{"...any":function(as){if(as.length===2&&isCollection(as[0])){var os=as[1];isNumber$1(os)?as[1]=os-1:isBigNumber(os)&&(as[1]=os.minus(1))}try{return is.apply(null,as)}catch(ls){throw errorTransform(ls)}}})},{isTransformFunction:!0}),name="variance",dependencies=["typed","add","subtract","multiply","divide","apply","isNaN"],createVarianceTransform=factory(name,dependencies,ss=>{var{typed:ts,add:rs,subtract:ns,multiply:is,divide:as,apply:os,isNaN:ls}=ss,us=createVariance({typed:ts,add:rs,subtract:ns,multiply:is,divide:as,apply:os,isNaN:ls});return ts(name,{"...any":function(cs){cs=lastDimToZeroBase(cs);try{return us.apply(null,cs)}catch(ps){throw errorTransform(ps)}}})},{isTransformFunction:!0}),allFactories=Object.freeze({__proto__:null,createTyped,createResultSet,createBigNumberClass,createComplexClass,createFractionClass,createRangeClass,createMatrixClass,createDenseMatrixClass,createClone,createIsInteger,createIsNegative,createIsNumeric,createHasNumericValue,createIsPositive,createIsZero,createIsNaN,createTypeOf,createEqualScalar,createSparseMatrixClass,createNumber,createString,createBoolean,createBignumber,createComplex,createFraction,createMatrix,createMatrixFromFunction,createMatrixFromRows,createMatrixFromColumns,createSplitUnit,createUnaryMinus,createUnaryPlus,createAbs,createApply,createAddScalar,createCbrt,createCeil,createCube,createExp,createExpm1,createFix,createFloor,createGcd,createLcm,createLog10,createLog2,createMod,createMultiplyScalar,createMultiply,createNthRoot,createSign,createSqrt,createSquare,createSubtract,createXgcd,createInvmod,createDotMultiply,createBitAnd,createBitNot,createBitOr,createBitXor,createArg,createConj,createIm,createRe,createNot,createOr,createXor,createConcat,createColumn,createCount,createCross,createDiag,createFilter,createFlatten,createForEach,createGetMatrixDataType,createIdentity,createKron,createMap,createDiff,createOnes,createRange,createReshape,createResize,createRotate,createRotationMatrix,createRow,createSize,createSqueeze,createSubset,createTranspose,createCtranspose,createZeros,createFft,createIfft,createErf,createMode,createProd,createFormat,createBin,createOct,createHex,createPrint,createTo,createIsPrime,createNumeric,createDivideScalar,createPow,createRound,createLog,createLog1p,createNthRoots,createDotPow,createDotDivide,createLsolve,createUsolve,createLsolveAll,createUsolveAll,createLeftShift,createRightArithShift,createRightLogShift,createAnd,createCompare,createCompareNatural,createCompareText,createEqual,createEqualText,createSmaller,createSmallerEq,createLarger,createLargerEq,createDeepEqual,createUnequal,createPartitionSelect,createSort,createMax,createMin,createImmutableDenseMatrixClass,createIndexClass,createFibonacciHeapClass,createSpaClass,createUnitClass,createUnitFunction,createSparse,createCreateUnit,createAcos,createAcosh,createAcot,createAcoth,createAcsc,createAcsch,createAsec,createAsech,createAsin,createAsinh,createAtan,createAtan2,createAtanh,createCos,createCosh,createCot,createCoth,createCsc,createCsch,createSec,createSech,createSin,createSinh,createTan,createTanh,createSetCartesian,createSetDifference,createSetDistinct,createSetIntersect,createSetIsSubset,createSetMultiplicity,createSetPowerset,createSetSize,createSetSymDifference,createSetUnion,createAdd,createHypot,createNorm,createDot,createTrace,createIndex,createNode,createAccessorNode,createArrayNode,createAssignmentNode,createBlockNode,createConditionalNode,createConstantNode,createFunctionAssignmentNode,createIndexNode,createObjectNode,createOperatorNode,createParenthesisNode,createRangeNode,createRelationalNode,createSymbolNode,createFunctionNode,createParse,createCompile,createEvaluate,createParserClass,createParser,createLup,createQr,createSlu,createLusolve,createHelpClass,createChainClass,createHelp,createChain,createDet,createInv,createPinv,createEigs,createExpm,createSqrtm,createDivide,createDistance,createIntersect,createSum,createCumSum,createMean,createMedian,createMad,createVariance,createQuantileSeq,createStd,createCombinations,createCombinationsWithRep,createGamma,createLgamma,createFactorial,createKldivergence,createMultinomial,createPermutations,createPickRandom,createRandom,createRandomInt,createStirlingS2,createBellNumbers,createCatalan,createComposition,createLeafCount,createSimplify,createSimplifyCore,createResolve,createSymbolicEqual,createDerivative,createRationalize,createReviver,createReplacer,createE,createUppercaseE,createFalse,createI,createInfinity,createLN10,createLN2,createLOG10E,createLOG2E,createNaN,createNull,createPhi,createPi,createUppercasePi,createSQRT1_2,createSQRT2,createTau,createTrue,createVersion,createAtomicMass,createAvogadro,createBohrMagneton,createBohrRadius,createBoltzmann,createClassicalElectronRadius,createConductanceQuantum,createCoulomb,createDeuteronMass,createEfimovFactor,createElectricConstant,createElectronMass,createElementaryCharge,createFaraday,createFermiCoupling,createFineStructure,createFirstRadiation,createGasConstant,createGravitationConstant,createGravity,createHartreeEnergy,createInverseConductanceQuantum,createKlitzing,createLoschmidt,createMagneticConstant,createMagneticFluxQuantum,createMolarMass,createMolarMassC12,createMolarPlanckConstant,createMolarVolume,createNeutronMass,createNuclearMagneton,createPlanckCharge,createPlanckConstant,createPlanckLength,createPlanckMass,createPlanckTemperature,createPlanckTime,createProtonMass,createQuantumOfCirculation,createReducedPlanckConstant,createRydberg,createSackurTetrode,createSecondRadiation,createSpeedOfLight,createStefanBoltzmann,createThomsonCrossSection,createVacuumImpedance,createWeakMixingAngle,createWienDisplacement,createApplyTransform,createColumnTransform,createFilterTransform,createForEachTransform,createIndexTransform,createMapTransform,createMaxTransform,createMeanTransform,createMinTransform,createRangeTransform,createRowTransform,createSubsetTransform,createConcatTransform,createDiffTransform,createStdTransform,createSumTransform,createCumSumTransform,createVarianceTransform}),BigNumber=createBigNumberClass({config:config$2}),Complex=createComplexClass({}),e$2=createE({BigNumber,config:config$2}),_false=createFalse({}),fineStructure=createFineStructure({BigNumber,config:config$2}),Fraction=createFractionClass({}),i$2=createI({Complex}),_Infinity=createInfinity({BigNumber,config:config$2}),LN10=createLN10({BigNumber,config:config$2}),LOG10E=createLOG10E({BigNumber,config:config$2}),Matrix$1=createMatrixClass({}),_NaN=createNaN({BigNumber,config:config$2}),_null$1=createNull({}),phi=createPhi({BigNumber,config:config$2}),Range$1=createRangeClass({}),ResultSet=createResultSet({}),SQRT1_2=createSQRT1_2({BigNumber,config:config$2}),sackurTetrode=createSackurTetrode({BigNumber,config:config$2}),tau=createTau({BigNumber,config:config$2}),_true=createTrue({}),version$1=createVersion({}),DenseMatrix=createDenseMatrixClass({Matrix:Matrix$1}),efimovFactor=createEfimovFactor({BigNumber,config:config$2}),LN2=createLN2({BigNumber,config:config$2}),pi$2=createPi({BigNumber,config:config$2}),replacer$1=createReplacer({}),SQRT2=createSQRT2({BigNumber,config:config$2}),typed=createTyped({BigNumber,Complex,DenseMatrix,Fraction}),unaryPlus=createUnaryPlus({BigNumber,config:config$2,typed}),weakMixingAngle=createWeakMixingAngle({BigNumber,config:config$2}),abs$1=createAbs({typed}),acos$1=createAcos({Complex,config:config$2,typed}),acot$1=createAcot({BigNumber,typed}),acsc$1=createAcsc({BigNumber,Complex,config:config$2,typed}),addScalar=createAddScalar({typed}),arg=createArg({typed}),asech$1=createAsech({BigNumber,Complex,config:config$2,typed}),asinh$1=createAsinh({typed}),atan$1=createAtan({typed}),atanh$1=createAtanh({Complex,config:config$2,typed}),bignumber=createBignumber({BigNumber,typed}),bitNot=createBitNot({typed}),boolean=createBoolean({typed}),clone$1=createClone({typed}),combinations=createCombinations({typed}),complex=createComplex({Complex,typed}),conj$1=createConj({typed}),cosh$1=createCosh({typed}),coth$1=createCoth({BigNumber,typed}),csc$1=createCsc({BigNumber,typed}),cube=createCube({typed}),equalScalar=createEqualScalar({config:config$2,typed}),erf$1=createErf({typed}),exp$1=createExp({typed}),expm1=createExpm1({Complex,typed}),filter$1=createFilter({typed}),forEach$2=createForEach({typed}),format$4=createFormat({typed}),getMatrixDataType=createGetMatrixDataType({typed}),hex=createHex({format:format$4,typed}),im$1=createIm({typed}),isInteger=createIsInteger({typed}),isNegative=createIsNegative({typed}),isPositive=createIsPositive({typed}),isZero=createIsZero({typed}),LOG2E=createLOG2E({BigNumber,config:config$2}),lgamma=createLgamma({Complex,typed}),log10$1=createLog10({Complex,config:config$2,typed}),log2=createLog2({Complex,config:config$2,typed}),map$1=createMap({typed}),multiplyScalar=createMultiplyScalar({typed}),not=createNot({typed}),number=createNumber({typed}),oct=createOct({format:format$4,typed}),pickRandom=createPickRandom({config:config$2,typed}),print=createPrint({typed}),random$1=createRandom({config:config$2,typed}),re$1$1=createRe({typed}),sec$1=createSec({BigNumber,typed}),sign$1=createSign({BigNumber,Fraction,complex,typed}),sin$1=createSin({typed}),SparseMatrix=createSparseMatrixClass({Matrix:Matrix$1,equalScalar,typed}),splitUnit=createSplitUnit({typed}),square=createSquare({typed}),string=createString({typed}),tan$1=createTan({typed}),typeOf=createTypeOf({typed}),acosh$1=createAcosh({Complex,config:config$2,typed}),acsch$1=createAcsch({BigNumber,typed}),apply=createApply({isInteger,typed}),asec$1=createAsec({BigNumber,Complex,config:config$2,typed}),bin=createBin({format:format$4,typed}),combinationsWithRep=createCombinationsWithRep({typed}),cos$1=createCos({typed}),csch$1=createCsch({BigNumber,typed}),isNaN$2=createIsNaN({typed}),isPrime=createIsPrime({typed}),randomInt=createRandomInt({config:config$2,typed}),sech$1=createSech({BigNumber,typed}),sinh$1=createSinh({typed}),sparse=createSparse({SparseMatrix,typed}),sqrt$1=createSqrt({Complex,config:config$2,typed}),tanh$1=createTanh({typed}),unaryMinus=createUnaryMinus({typed}),acoth$1=createAcoth({BigNumber,Complex,config:config$2,typed}),cot$1=createCot({BigNumber,typed}),fraction=createFraction({Fraction,typed}),isNumeric=createIsNumeric({typed}),matrix$2=createMatrix({DenseMatrix,Matrix:Matrix$1,SparseMatrix,typed}),matrixFromFunction=createMatrixFromFunction({isZero,matrix:matrix$2,typed}),mod$1=createMod({DenseMatrix,equalScalar,matrix:matrix$2,typed}),nthRoot=createNthRoot({BigNumber,equalScalar,matrix:matrix$2,typed}),numeric=createNumeric({bignumber,fraction,number}),or$1=createOr({DenseMatrix,equalScalar,matrix:matrix$2,typed}),prod=createProd({config:config$2,multiplyScalar,numeric,typed}),reshape=createReshape({isInteger,matrix:matrix$2,typed}),size$1=createSize({matrix:matrix$2,config:config$2,typed}),smaller=createSmaller({DenseMatrix,config:config$2,matrix:matrix$2,typed}),squeeze=createSqueeze({matrix:matrix$2,typed}),subset=createSubset({matrix:matrix$2,typed}),subtract$1=createSubtract({DenseMatrix,addScalar,equalScalar,matrix:matrix$2,typed,unaryMinus}),to$1=createTo({matrix:matrix$2,typed}),transpose=createTranspose({matrix:matrix$2,typed}),xgcd=createXgcd({BigNumber,config:config$2,matrix:matrix$2,typed}),zeros=createZeros({BigNumber,config:config$2,matrix:matrix$2,typed}),and=createAnd({equalScalar,matrix:matrix$2,not,typed,zeros}),bitAnd=createBitAnd({equalScalar,matrix:matrix$2,typed}),bitXor=createBitXor({DenseMatrix,matrix:matrix$2,typed}),cbrt=createCbrt({BigNumber,Complex,Fraction,config:config$2,isNegative,matrix:matrix$2,typed,unaryMinus}),compare$1=createCompare({BigNumber,DenseMatrix,Fraction,config:config$2,equalScalar,matrix:matrix$2,typed}),compareText=createCompareText({matrix:matrix$2,typed}),concat=createConcat({isInteger,matrix:matrix$2,typed}),count=createCount({prod,size:size$1,typed}),ctranspose=createCtranspose({conj:conj$1,transpose,typed}),diag=createDiag({DenseMatrix,SparseMatrix,matrix:matrix$2,typed}),divideScalar=createDivideScalar({numeric,typed}),dotDivide=createDotDivide({DenseMatrix,divideScalar,equalScalar,matrix:matrix$2,typed}),equal$1=createEqual({DenseMatrix,equalScalar,matrix:matrix$2,typed}),fft=createFft({addScalar,divideScalar,exp:exp$1,i:i$2,matrix:matrix$2,multiplyScalar,tau,typed}),flatten$3=createFlatten({matrix:matrix$2,typed}),gcd$1=createGcd({BigNumber,DenseMatrix,equalScalar,matrix:matrix$2,typed}),hasNumericValue=createHasNumericValue({isNumeric,typed}),hypot=createHypot({abs:abs$1,addScalar,divideScalar,isPositive,multiplyScalar,smaller,sqrt:sqrt$1,typed}),ifft=createIfft({conj:conj$1,dotDivide,fft,typed}),kron=createKron({matrix:matrix$2,multiplyScalar,typed}),largerEq=createLargerEq({DenseMatrix,config:config$2,matrix:matrix$2,typed}),leftShift=createLeftShift({DenseMatrix,equalScalar,matrix:matrix$2,typed,zeros}),lsolve=createLsolve({DenseMatrix,divideScalar,equalScalar,matrix:matrix$2,multiplyScalar,subtract:subtract$1,typed}),matrixFromColumns=createMatrixFromColumns({flatten:flatten$3,matrix:matrix$2,size:size$1,typed}),min$1=createMin({config:config$2,numeric,smaller,typed}),mode=createMode({isNaN:isNaN$2,isNumeric,typed}),nthRoots=createNthRoots({Complex,config:config$2,divideScalar,typed}),ones=createOnes({BigNumber,config:config$2,matrix:matrix$2,typed}),partitionSelect=createPartitionSelect({compare:compare$1,isNaN:isNaN$2,isNumeric,typed}),resize=createResize({config:config$2,matrix:matrix$2}),rightArithShift=createRightArithShift({DenseMatrix,equalScalar,matrix:matrix$2,typed,zeros}),round$1=createRound({BigNumber,DenseMatrix,equalScalar,matrix:matrix$2,typed,zeros}),smallerEq=createSmallerEq({DenseMatrix,config:config$2,matrix:matrix$2,typed}),unequal=createUnequal({DenseMatrix,config:config$2,equalScalar,matrix:matrix$2,typed}),usolve=createUsolve({DenseMatrix,divideScalar,equalScalar,matrix:matrix$2,multiplyScalar,subtract:subtract$1,typed}),xor=createXor({DenseMatrix,matrix:matrix$2,typed}),add$1=createAdd({DenseMatrix,SparseMatrix,addScalar,equalScalar,matrix:matrix$2,typed}),atan2$1=createAtan2({BigNumber,DenseMatrix,equalScalar,matrix:matrix$2,typed}),bitOr=createBitOr({DenseMatrix,equalScalar,matrix:matrix$2,typed}),catalan=createCatalan({addScalar,combinations,divideScalar,isInteger,isNegative,multiplyScalar,typed}),compareNatural=createCompareNatural({compare:compare$1,typed}),cumsum=createCumSum({add:add$1,typed,unaryPlus}),deepEqual=createDeepEqual({equal:equal$1,typed}),diff=createDiff({matrix:matrix$2,number,subtract:subtract$1,typed}),dot=createDot({addScalar,conj:conj$1,multiplyScalar,size:size$1,typed}),equalText=createEqualText({compareText,isZero,typed}),floor=createFloor({DenseMatrix,config:config$2,equalScalar,matrix:matrix$2,round:round$1,typed,zeros}),identity$1=createIdentity({BigNumber,DenseMatrix,SparseMatrix,config:config$2,matrix:matrix$2,typed}),invmod=createInvmod({BigNumber,add:add$1,config:config$2,equal:equal$1,isInteger,mod:mod$1,smaller,typed,xgcd}),larger=createLarger({DenseMatrix,config:config$2,matrix:matrix$2,typed}),log$1=createLog({Complex,config:config$2,divideScalar,typed}),lsolveAll=createLsolveAll({DenseMatrix,divideScalar,equalScalar,matrix:matrix$2,multiplyScalar,subtract:subtract$1,typed}),matrixFromRows=createMatrixFromRows({flatten:flatten$3,matrix:matrix$2,size:size$1,typed}),multiply$1=createMultiply({addScalar,dot,equalScalar,matrix:matrix$2,multiplyScalar,typed}),qr$1=createQr({addScalar,complex,conj:conj$1,divideScalar,equal:equal$1,identity:identity$1,isZero,matrix:matrix$2,multiplyScalar,sign:sign$1,sqrt:sqrt$1,subtract:subtract$1,typed,unaryMinus,zeros}),range$1=createRange({bignumber,matrix:matrix$2,config:config$2,larger,largerEq,smaller,smallerEq,typed}),rightLogShift=createRightLogShift({DenseMatrix,equalScalar,matrix:matrix$2,typed,zeros}),setSize=createSetSize({compareNatural,typed}),slu=createSlu({SparseMatrix,abs:abs$1,add:add$1,divideScalar,larger,largerEq,multiply:multiply$1,subtract:subtract$1,transpose,typed}),sum$2=createSum({add:add$1,config:config$2,numeric,typed}),trace=createTrace({add:add$1,matrix:matrix$2,typed}),usolveAll=createUsolveAll({DenseMatrix,divideScalar,equalScalar,matrix:matrix$2,multiplyScalar,subtract:subtract$1,typed}),asin$1=createAsin({Complex,config:config$2,typed}),ceil=createCeil({DenseMatrix,config:config$2,equalScalar,matrix:matrix$2,round:round$1,typed,zeros}),composition=createComposition({addScalar,combinations,isInteger,isNegative,isPositive,larger,typed}),cross=createCross({matrix:matrix$2,multiply:multiply$1,subtract:subtract$1,typed}),det=createDet({divideScalar,isZero,matrix:matrix$2,multiply:multiply$1,subtract:subtract$1,typed,unaryMinus}),distance=createDistance({abs:abs$1,addScalar,divideScalar,multiplyScalar,sqrt:sqrt$1,subtract:subtract$1,typed,unaryMinus}),dotMultiply=createDotMultiply({equalScalar,matrix:matrix$2,multiplyScalar,typed}),FibonacciHeap=createFibonacciHeapClass({larger,smaller}),fix=createFix({Complex,DenseMatrix,ceil,equalScalar,floor,matrix:matrix$2,typed,zeros}),ImmutableDenseMatrix=createImmutableDenseMatrixClass({DenseMatrix,smaller}),Index=createIndexClass({ImmutableDenseMatrix}),intersect=createIntersect({abs:abs$1,add:add$1,addScalar,config:config$2,divideScalar,equalScalar,flatten:flatten$3,isNumeric,isZero,matrix:matrix$2,multiply:multiply$1,multiplyScalar,smaller,subtract:subtract$1,typed}),lcm=createLcm({equalScalar,matrix:matrix$2,typed}),log1p=createLog1p({Complex,config:config$2,divideScalar,log:log$1,typed}),max$1=createMax({config:config$2,larger,numeric,typed}),quantileSeq=createQuantileSeq({add:add$1,compare:compare$1,multiply:multiply$1,partitionSelect,typed}),row=createRow({Index,matrix:matrix$2,range:range$1,typed}),setCartesian=createSetCartesian({DenseMatrix,Index,compareNatural,size:size$1,subset,typed}),setDistinct=createSetDistinct({DenseMatrix,Index,compareNatural,size:size$1,subset,typed}),setIsSubset=createSetIsSubset({Index,compareNatural,size:size$1,subset,typed}),setPowerset=createSetPowerset({Index,compareNatural,size:size$1,subset,typed}),sort=createSort({compare:compare$1,compareNatural,matrix:matrix$2,typed}),column=createColumn({Index,matrix:matrix$2,range:range$1,typed}),index=createIndex({Index,typed}),inv=createInv({abs:abs$1,addScalar,det,divideScalar,identity:identity$1,matrix:matrix$2,multiply:multiply$1,typed,unaryMinus}),pinv=createPinv({Complex,add:add$1,ctranspose,deepEqual,divideScalar,dot,dotDivide,equal:equal$1,inv,matrix:matrix$2,multiply:multiply$1,typed}),pow$1=createPow({Complex,config:config$2,fraction,identity:identity$1,inv,matrix:matrix$2,multiply:multiply$1,number,typed}),setDifference=createSetDifference({DenseMatrix,Index,compareNatural,size:size$1,subset,typed}),setMultiplicity=createSetMultiplicity({Index,compareNatural,size:size$1,subset,typed}),Spa=createSpaClass({FibonacciHeap,addScalar,equalScalar}),sqrtm=createSqrtm({abs:abs$1,add:add$1,identity:identity$1,inv,max:max$1,multiply:multiply$1,size:size$1,sqrt:sqrt$1,subtract:subtract$1,typed}),Unit=createUnitClass({BigNumber,Complex,Fraction,abs:abs$1,addScalar,config:config$2,divideScalar,equal:equal$1,fix,format:format$4,isNumeric,multiplyScalar,number,pow:pow$1,round:round$1,subtract:subtract$1}),vacuumImpedance=createVacuumImpedance({BigNumber,Unit,config:config$2}),wienDisplacement=createWienDisplacement({BigNumber,Unit,config:config$2}),atomicMass=createAtomicMass({BigNumber,Unit,config:config$2}),bohrMagneton=createBohrMagneton({BigNumber,Unit,config:config$2}),boltzmann=createBoltzmann({BigNumber,Unit,config:config$2}),conductanceQuantum=createConductanceQuantum({BigNumber,Unit,config:config$2}),createUnit=createCreateUnit({Unit,typed}),deuteronMass=createDeuteronMass({BigNumber,Unit,config:config$2}),dotPow=createDotPow({DenseMatrix,equalScalar,matrix:matrix$2,pow:pow$1,typed}),electricConstant=createElectricConstant({BigNumber,Unit,config:config$2}),elementaryCharge=createElementaryCharge({BigNumber,Unit,config:config$2}),expm=createExpm({abs:abs$1,add:add$1,identity:identity$1,inv,multiply:multiply$1,typed}),faraday=createFaraday({BigNumber,Unit,config:config$2}),firstRadiation=createFirstRadiation({BigNumber,Unit,config:config$2}),gamma$1=createGamma({BigNumber,Complex,config:config$2,multiplyScalar,pow:pow$1,typed}),gravitationConstant=createGravitationConstant({BigNumber,Unit,config:config$2}),hartreeEnergy=createHartreeEnergy({BigNumber,Unit,config:config$2}),klitzing=createKlitzing({BigNumber,Unit,config:config$2}),loschmidt=createLoschmidt({BigNumber,Unit,config:config$2}),magneticConstant=createMagneticConstant({BigNumber,Unit,config:config$2}),molarMass=createMolarMass({BigNumber,Unit,config:config$2}),molarPlanckConstant=createMolarPlanckConstant({BigNumber,Unit,config:config$2}),neutronMass=createNeutronMass({BigNumber,Unit,config:config$2}),nuclearMagneton=createNuclearMagneton({BigNumber,Unit,config:config$2}),planckCharge=createPlanckCharge({BigNumber,Unit,config:config$2}),planckLength=createPlanckLength({BigNumber,Unit,config:config$2}),planckTemperature=createPlanckTemperature({BigNumber,Unit,config:config$2}),protonMass=createProtonMass({BigNumber,Unit,config:config$2}),reducedPlanckConstant=createReducedPlanckConstant({BigNumber,Unit,config:config$2}),rydberg=createRydberg({BigNumber,Unit,config:config$2}),setIntersect=createSetIntersect({DenseMatrix,Index,compareNatural,size:size$1,subset,typed}),speedOfLight=createSpeedOfLight({BigNumber,Unit,config:config$2}),stefanBoltzmann=createStefanBoltzmann({BigNumber,Unit,config:config$2}),thomsonCrossSection=createThomsonCrossSection({BigNumber,Unit,config:config$2}),avogadro=createAvogadro({BigNumber,Unit,config:config$2}),bohrRadius=createBohrRadius({BigNumber,Unit,config:config$2}),coulomb=createCoulomb({BigNumber,Unit,config:config$2}),divide$1=createDivide({divideScalar,equalScalar,inv,matrix:matrix$2,multiply:multiply$1,typed}),electronMass=createElectronMass({BigNumber,Unit,config:config$2}),factorial$1=createFactorial({gamma:gamma$1,typed}),gravity=createGravity({BigNumber,Unit,config:config$2}),inverseConductanceQuantum=createInverseConductanceQuantum({BigNumber,Unit,config:config$2}),lup=createLup({DenseMatrix,Spa,SparseMatrix,abs:abs$1,addScalar,divideScalar,equalScalar,larger,matrix:matrix$2,multiplyScalar,subtract:subtract$1,typed,unaryMinus}),magneticFluxQuantum=createMagneticFluxQuantum({BigNumber,Unit,config:config$2}),molarMassC12=createMolarMassC12({BigNumber,Unit,config:config$2}),multinomial=createMultinomial({add:add$1,divide:divide$1,factorial:factorial$1,isInteger,isPositive,multiply:multiply$1,typed}),permutations=createPermutations({factorial:factorial$1,typed}),planckMass=createPlanckMass({BigNumber,Unit,config:config$2}),quantumOfCirculation=createQuantumOfCirculation({BigNumber,Unit,config:config$2}),secondRadiation=createSecondRadiation({BigNumber,Unit,config:config$2}),stirlingS2=createStirlingS2({bignumber,addScalar,combinations,divideScalar,factorial:factorial$1,isInteger,isNegative,larger,multiplyScalar,number,pow:pow$1,subtract:subtract$1,typed}),unit=createUnitFunction({Unit,typed}),bellNumbers=createBellNumbers({addScalar,isInteger,isNegative,stirlingS2,typed}),eigs=createEigs({abs:abs$1,add:add$1,addScalar,atan:atan$1,bignumber,column,complex,config:config$2,cos:cos$1,diag,divideScalar,dot,equal:equal$1,flatten:flatten$3,im:im$1,inv,larger,matrix:matrix$2,matrixFromColumns,multiply:multiply$1,multiplyScalar,number,qr:qr$1,re:re$1$1,sin:sin$1,smaller,sqrt:sqrt$1,subtract:subtract$1,typed,usolve,usolveAll}),fermiCoupling=createFermiCoupling({BigNumber,Unit,config:config$2}),mean$1=createMean({add:add$1,divide:divide$1,typed}),molarVolume=createMolarVolume({BigNumber,Unit,config:config$2}),planckConstant=createPlanckConstant({BigNumber,Unit,config:config$2}),setSymDifference=createSetSymDifference({Index,concat,setDifference,size:size$1,subset,typed}),classicalElectronRadius=createClassicalElectronRadius({BigNumber,Unit,config:config$2}),lusolve=createLusolve({DenseMatrix,lsolve,lup,matrix:matrix$2,slu,typed,usolve}),median=createMedian({add:add$1,compare:compare$1,divide:divide$1,partitionSelect,typed}),setUnion=createSetUnion({Index,concat,setIntersect,setSymDifference,size:size$1,subset,typed}),variance$1=createVariance({add:add$1,apply,divide:divide$1,isNaN:isNaN$2,multiply:multiply$1,subtract:subtract$1,typed}),kldivergence=createKldivergence({divide:divide$1,dotDivide,isNumeric,log:log$1,matrix:matrix$2,multiply:multiply$1,sum:sum$2,typed}),norm=createNorm({abs:abs$1,add:add$1,conj:conj$1,ctranspose,eigs,equalScalar,larger,matrix:matrix$2,multiply:multiply$1,pow:pow$1,smaller,sqrt:sqrt$1,typed}),planckTime=createPlanckTime({BigNumber,Unit,config:config$2}),rotationMatrix=createRotationMatrix({BigNumber,DenseMatrix,SparseMatrix,addScalar,config:config$2,cos:cos$1,matrix:matrix$2,multiplyScalar,norm,sin:sin$1,typed,unaryMinus}),gasConstant=createGasConstant({BigNumber,Unit,config:config$2}),std=createStd({sqrt:sqrt$1,typed,variance:variance$1}),mad=createMad({abs:abs$1,map:map$1,median,subtract:subtract$1,typed}),rotate=createRotate({multiply:multiply$1,rotationMatrix,typed}),math$2={},mathWithTransform={},classes={},Chain=createChainClass({math:math$2}),Node=createNode({mathWithTransform}),ObjectNode=createObjectNode({Node}),OperatorNode=createOperatorNode({Node}),ParenthesisNode=createParenthesisNode({Node}),RelationalNode=createRelationalNode({Node}),ArrayNode=createArrayNode({Node}),BlockNode=createBlockNode({Node,ResultSet}),ConditionalNode=createConditionalNode({Node}),ConstantNode=createConstantNode({Node}),RangeNode=createRangeNode({Node}),reviver=createReviver({classes}),chain$1=createChain({Chain,typed}),FunctionAssignmentNode=createFunctionAssignmentNode({Node,typed}),AccessorNode=createAccessorNode({Node,subset}),AssignmentNode=createAssignmentNode({matrix:matrix$2,Node,subset}),IndexNode=createIndexNode({Node,size:size$1}),SymbolNode=createSymbolNode({Unit,Node,math:math$2}),FunctionNode=createFunctionNode({Node,SymbolNode,math:math$2}),parse$2=createParse({AccessorNode,ArrayNode,AssignmentNode,BlockNode,ConditionalNode,ConstantNode,FunctionAssignmentNode,FunctionNode,IndexNode,ObjectNode,OperatorNode,ParenthesisNode,RangeNode,RelationalNode,SymbolNode,config:config$2,numeric,typed}),resolve=createResolve({ConstantNode,FunctionNode,OperatorNode,ParenthesisNode,parse:parse$2}),simplifyCore=createSimplifyCore({AccessorNode,ArrayNode,ConstantNode,FunctionNode,IndexNode,ObjectNode,OperatorNode,ParenthesisNode,SymbolNode,add:add$1,divide:divide$1,equal:equal$1,isZero,multiply:multiply$1,pow:pow$1,subtract:subtract$1}),compile=createCompile({parse:parse$2,typed}),Help=createHelpClass({parse:parse$2}),leafCount=createLeafCount({parse:parse$2,typed}),simplify$2=createSimplify({bignumber,fraction,AccessorNode,ArrayNode,ConstantNode,FunctionNode,IndexNode,ObjectNode,OperatorNode,ParenthesisNode,SymbolNode,add:add$1,config:config$2,divide:divide$1,equal:equal$1,isZero,mathWithTransform,matrix:matrix$2,multiply:multiply$1,parse:parse$2,pow:pow$1,resolve,simplifyCore,subtract:subtract$1,typed}),symbolicEqual=createSymbolicEqual({OperatorNode,parse:parse$2,simplify:simplify$2,typed}),evaluate$1=createEvaluate({parse:parse$2,typed}),help=createHelp({Help,mathWithTransform,typed}),Parser$2=createParserClass({evaluate:evaluate$1}),rationalize=createRationalize({bignumber,fraction,AccessorNode,ArrayNode,ConstantNode,FunctionNode,IndexNode,ObjectNode,OperatorNode,ParenthesisNode,SymbolNode,add:add$1,config:config$2,divide:divide$1,equal:equal$1,isZero,mathWithTransform,matrix:matrix$2,multiply:multiply$1,parse:parse$2,pow:pow$1,simplify:simplify$2,simplifyCore,subtract:subtract$1,typed}),derivative$1=createDerivative({ConstantNode,FunctionNode,OperatorNode,ParenthesisNode,SymbolNode,config:config$2,equal:equal$1,isZero,numeric,parse:parse$2,simplify:simplify$2,typed}),parser$1=createParser({Parser:Parser$2,typed});_extends$1(math$2,{e:e$2,false:_false,fineStructure,i:i$2,Infinity:_Infinity,LN10,LOG10E,NaN:_NaN,null:_null$1,phi,SQRT1_2,sackurTetrode,tau,true:_true,E:e$2,version:version$1,efimovFactor,LN2,pi:pi$2,replacer:replacer$1,reviver,SQRT2,typed,unaryPlus,PI:pi$2,weakMixingAngle,abs:abs$1,acos:acos$1,acot:acot$1,acsc:acsc$1,addScalar,arg,asech:asech$1,asinh:asinh$1,atan:atan$1,atanh:atanh$1,bignumber,bitNot,boolean,chain:chain$1,clone:clone$1,combinations,complex,conj:conj$1,cosh:cosh$1,coth:coth$1,csc:csc$1,cube,equalScalar,erf:erf$1,exp:exp$1,expm1,filter:filter$1,forEach:forEach$2,format:format$4,getMatrixDataType,hex,im:im$1,isInteger,isNegative,isPositive,isZero,LOG2E,lgamma,log10:log10$1,log2,map:map$1,multiplyScalar,not,number,oct,pickRandom,print,random:random$1,re:re$1$1,sec:sec$1,sign:sign$1,sin:sin$1,splitUnit,square,string,tan:tan$1,typeOf,acosh:acosh$1,acsch:acsch$1,apply,asec:asec$1,bin,combinationsWithRep,cos:cos$1,csch:csch$1,isNaN:isNaN$2,isPrime,randomInt,sech:sech$1,sinh:sinh$1,sparse,sqrt:sqrt$1,tanh:tanh$1,unaryMinus,acoth:acoth$1,cot:cot$1,fraction,isNumeric,matrix:matrix$2,matrixFromFunction,mod:mod$1,nthRoot,numeric,or:or$1,prod,reshape,size:size$1,smaller,squeeze,subset,subtract:subtract$1,to:to$1,transpose,xgcd,zeros,and,bitAnd,bitXor,cbrt,compare:compare$1,compareText,concat,count,ctranspose,diag,divideScalar,dotDivide,equal:equal$1,fft,flatten:flatten$3,gcd:gcd$1,hasNumericValue,hypot,ifft,kron,largerEq,leftShift,lsolve,matrixFromColumns,min:min$1,mode,nthRoots,ones,partitionSelect,resize,rightArithShift,round:round$1,smallerEq,unequal,usolve,xor,add:add$1,atan2:atan2$1,bitOr,catalan,compareNatural,cumsum,deepEqual,diff,dot,equalText,floor,identity:identity$1,invmod,larger,log:log$1,lsolveAll,matrixFromRows,multiply:multiply$1,qr:qr$1,range:range$1,rightLogShift,setSize,slu,sum:sum$2,trace,usolveAll,asin:asin$1,ceil,composition,cross,det,distance,dotMultiply,fix,intersect,lcm,log1p,max:max$1,quantileSeq,row,setCartesian,setDistinct,setIsSubset,setPowerset,sort,column,index,inv,pinv,pow:pow$1,setDifference,setMultiplicity,sqrtm,vacuumImpedance,wienDisplacement,atomicMass,bohrMagneton,boltzmann,conductanceQuantum,createUnit,deuteronMass,dotPow,electricConstant,elementaryCharge,expm,faraday,firstRadiation,gamma:gamma$1,gravitationConstant,hartreeEnergy,klitzing,loschmidt,magneticConstant,molarMass,molarPlanckConstant,neutronMass,nuclearMagneton,planckCharge,planckLength,planckTemperature,protonMass,reducedPlanckConstant,rydberg,setIntersect,speedOfLight,stefanBoltzmann,thomsonCrossSection,avogadro,bohrRadius,coulomb,divide:divide$1,electronMass,factorial:factorial$1,gravity,inverseConductanceQuantum,lup,magneticFluxQuantum,molarMassC12,multinomial,parse:parse$2,permutations,planckMass,quantumOfCirculation,resolve,secondRadiation,simplifyCore,stirlingS2,unit,bellNumbers,compile,eigs,fermiCoupling,leafCount,mean:mean$1,molarVolume,planckConstant,setSymDifference,simplify:simplify$2,symbolicEqual,classicalElectronRadius,evaluate:evaluate$1,help,lusolve,median,rationalize,setUnion,variance:variance$1,derivative:derivative$1,kldivergence,norm,planckTime,rotationMatrix,gasConstant,parser:parser$1,std,mad,rotate,config:config$2}),_extends$1(mathWithTransform,math$2,{filter:createFilterTransform({typed}),forEach:createForEachTransform({typed}),map:createMapTransform({typed}),apply:createApplyTransform({isInteger,typed}),diff:createDiffTransform({bignumber,matrix:matrix$2,number,subtract:subtract$1,typed}),subset:createSubsetTransform({matrix:matrix$2,typed}),concat:createConcatTransform({isInteger,matrix:matrix$2,typed}),max:createMaxTransform({config:config$2,larger,numeric,typed}),min:createMinTransform({config:config$2,numeric,smaller,typed}),range:createRangeTransform({bignumber,matrix:matrix$2,config:config$2,larger,largerEq,smaller,smallerEq,typed}),sum:createSumTransform({add:add$1,config:config$2,numeric,typed}),cumsum:createCumSumTransform({add:add$1,typed,unaryPlus}),row:createRowTransform({Index,matrix:matrix$2,range:range$1,typed}),column:createColumnTransform({Index,matrix:matrix$2,range:range$1,typed}),index:createIndexTransform({Index}),mean:createMeanTransform({add:add$1,divide:divide$1,typed}),variance:createVarianceTransform({add:add$1,apply,divide:divide$1,isNaN:isNaN$2,multiply:multiply$1,subtract:subtract$1,typed}),std:createStdTransform({sqrt:sqrt$1,typed,variance:variance$1})}),_extends$1(classes,{BigNumber,Chain,Complex,Fraction,Matrix:Matrix$1,Node,ObjectNode,OperatorNode,ParenthesisNode,Range:Range$1,RelationalNode,ResultSet,ArrayNode,BlockNode,ConditionalNode,ConstantNode,DenseMatrix,RangeNode,FunctionAssignmentNode,SparseMatrix,AccessorNode,AssignmentNode,IndexNode,FibonacciHeap,ImmutableDenseMatrix,Index,Spa,Unit,SymbolNode,FunctionNode,Help,Parser:Parser$2}),Chain.createProxy(math$2);var all=allFactories;Number.isFinite=Number.isFinite||function(ss){return typeof ss=="number"&&isFinite(ss)},Number.isNaN=Number.isNaN||function(ss){return ss!=ss};var tinyEmitter$1={exports:{}};function E$3(){}function mixin$1(ss){var ts=new tinyEmitter$1.exports;return ss.on=ts.on.bind(ts),ss.off=ts.off.bind(ts),ss.once=ts.once.bind(ts),ss.emit=ts.emit.bind(ts),ss}function importFactory(ss,ts,rs,ns){function is(ys,gs,bs){var vs;if(bs.wrap&&typeof gs=="function"&&(gs=function(Ns){var Ts=function(){for(var Cs=[],xs=0,As=arguments.length;xs<As;xs++){var ws=arguments[xs];Cs[xs]=ws&&ws.valueOf()}return Ns.apply(rs,Cs)};return Ns.transform&&(Ts.transform=Ns.transform),Ts}(gs)),typeof(vs=gs)=="function"&&typeof vs.signature=="string"&&(gs=ss(ys,{[gs.signature]:gs})),cs(rs[ys])&&cs(gs))return gs=bs.override?ss(ys,gs.signatures):ss(rs[ys],gs),rs[ys]=gs,delete ns[ys],as(ys,gs),void rs.emit("import",ys,function(){return gs});if(rs[ys]===void 0||bs.override)return rs[ys]=gs,delete ns[ys],as(ys,gs),void rs.emit("import",ys,function(){return gs});if(!bs.silent)throw new Error('Cannot import "'+ys+'": already exists')}function as(ys,gs){gs&&typeof gs.transform=="function"?(rs.expression.transform[ys]=gs.transform,ps(ys)&&(rs.expression.mathWithTransform[ys]=gs.transform)):(delete rs.expression.transform[ys],ps(ys)&&(rs.expression.mathWithTransform[ys]=gs))}function os(ys){delete rs.expression.transform[ys],ps(ys)?rs.expression.mathWithTransform[ys]=rs[ys]:delete rs.expression.mathWithTransform[ys]}function ls(ys,gs){var bs=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ys.fn;if(contains$1(bs,"."))throw new Error("Factory name should not contain a nested path. Name: "+JSON.stringify(bs));var vs=fs(ys)?rs.expression.transform:rs,Ns=bs in rs.expression.transform,Ts=hasOwnProperty$2(vs,bs)?vs[bs]:void 0,Cs=function(){var xs={};ys.dependencies.map(stripOptionalNotation).forEach(ws=>{if(contains$1(ws,"."))throw new Error("Factory dependency should not contain a nested path. Name: "+JSON.stringify(ws));ws==="math"?xs.math=rs:ws==="mathWithTransform"?xs.mathWithTransform=rs.expression.mathWithTransform:ws==="classes"?xs.classes=rs:xs[ws]=rs[ws]});var As=ys(xs);if(As&&typeof As.transform=="function")throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(Ts===void 0||gs.override)return As;if(cs(Ts)&&cs(As))return ss(Ts,As);if(gs.silent)return Ts;throw new Error('Cannot import "'+bs+'": already exists')};ys.meta&&ys.meta.lazy===!1?(vs[bs]=Cs(),Ts&&Ns?os(bs):(fs(ys)||ds(ys))&&lazy(rs.expression.mathWithTransform,bs,()=>vs[bs])):(lazy(vs,bs,Cs),Ts&&Ns?os(bs):(fs(ys)||ds(ys))&&lazy(rs.expression.mathWithTransform,bs,()=>vs[bs])),ns[bs]=ys,rs.emit("import",bs,Cs)}function us(ys){return typeof ys=="function"||typeof ys=="number"||typeof ys=="string"||typeof ys=="boolean"||ys===null||isUnit(ys)||isComplex(ys)||isBigNumber(ys)||isFraction(ys)||isMatrix(ys)||Array.isArray(ys)}function cs(ys){return typeof ys=="function"&&typeof ys.signatures=="object"}function ps(ys){return!hasOwnProperty$2(hs,ys)}function ds(ys){return!(ys.fn.indexOf(".")!==-1||hasOwnProperty$2(hs,ys.fn)||ys.meta&&ys.meta.isClass)}function fs(ys){return ys!==void 0&&ys.meta!==void 0&&ys.meta.isTransformFunction===!0||!1}var hs={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return function(ys,gs){var bs=arguments.length;if(bs!==1&&bs!==2)throw new ArgumentsError("import",bs,1,2);gs||(gs={});var vs={};for(var Ns in function Cs(xs,As,ws){if(Array.isArray(As))As.forEach(Ds=>Cs(xs,Ds));else if(typeof As=="object")for(var Es in As)hasOwnProperty$2(As,Es)&&Cs(xs,As[Es],Es);else if(isFactory(As)||ws!==void 0){var Ss=isFactory(As)?fs(As)?As.fn+".transform":As.fn:ws;if(hasOwnProperty$2(xs,Ss)&&xs[Ss]!==As&&!gs.silent)throw new Error('Cannot import "'+Ss+'" twice');xs[Ss]=As}else if(!gs.silent)throw new TypeError("Factory, Object, or Array expected")}(vs,ys),vs)if(hasOwnProperty$2(vs,Ns)){var Ts=vs[Ns];if(isFactory(Ts))ls(Ts,gs);else if(us(Ts))is(Ns,Ts,gs);else if(!gs.silent)throw new TypeError("Factory, Object, or Array expected")}}}function create$1(ss,ts){var rs=_extends$1({},DEFAULT_CONFIG,ts);if(typeof Object.create!="function")throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var ns=mixin$1({isNumber:isNumber$1,isComplex,isBigNumber,isFraction,isUnit,isString:isString$1$1,isArray:isArray$1$1,isMatrix,isCollection,isDenseMatrix,isSparseMatrix,isRange,isIndex,isBoolean:isBoolean$1$1,isResultSet,isHelp,isFunction:isFunction$2$1,isDate:isDate$1,isRegExp:isRegExp$1,isObject:isObject$1$1,isNull:isNull$1,isUndefined:isUndefined$1$1,isAccessorNode,isArrayNode,isAssignmentNode,isBlockNode,isConditionalNode,isConstantNode,isFunctionAssignmentNode,isFunctionNode,isIndexNode,isNode:isNode$1,isObjectNode,isOperatorNode,isParenthesisNode,isRangeNode,isSymbolNode,isChain});ns.config=configFactory(rs,ns.emit),ns.expression={transform:{},mathWithTransform:{config:ns.config}};var is=[],as=[],os={},ls=importFactory(function(){for(var us=arguments.length,cs=new Array(us),ps=0;ps<us;ps++)cs[ps]=arguments[ps];return ns.typed.apply(ns.typed,cs)},function us(cs){if(isFactory(cs))return cs(ns);var ps=cs[Object.keys(cs)[0]];if(isFactory(ps))return ps(ns);if(!isLegacyFactory(cs))throw console.warn("Factory object with properties `type`, `name`, and `factory` expected",cs),new Error("Factory object with properties `type`, `name`, and `factory` expected");var ds,fs=is.indexOf(cs);return fs===-1?(ds=cs.math===!0?cs.factory(ns.type,rs,us,ns.typed,ns):cs.factory(ns.type,rs,us,ns.typed),is.push(cs),as.push(ds)):ds=as[fs],ds},ns,os);return ns.import=ls,ns.on("config",()=>{values$1(os).forEach(us=>{us&&us.meta&&us.meta.recreateOnConfigChange&&ls(us,{override:!0})})}),ns.create=create$1.bind(null,ss),ns.factory=factory,ns.import(values$1(deepFlatten(ss))),ns.ArgumentsError=ArgumentsError,ns.DimensionError=DimensionError,ns.IndexError=IndexError,ns}E$3.prototype={on:function(ss,ts,rs){var ns=this.e||(this.e={});return(ns[ss]||(ns[ss]=[])).push({fn:ts,ctx:rs}),this},once:function(ss,ts,rs){var ns=this;function is(){ns.off(ss,is),ts.apply(rs,arguments)}return is._=ts,this.on(ss,is,rs)},emit:function(ss){for(var ts=[].slice.call(arguments,1),rs=((this.e||(this.e={}))[ss]||[]).slice(),ns=0,is=rs.length;ns<is;ns++)rs[ns].fn.apply(rs[ns].ctx,ts);return this},off:function(ss,ts){var rs=this.e||(this.e={}),ns=rs[ss],is=[];if(ns&&ts)for(var as=0,os=ns.length;as<os;as++)ns[as].fn!==ts&&ns[as].fn._!==ts&&is.push(ns[as]);return is.length?rs[ss]=is:delete rs[ss],this}},tinyEmitter$1.exports=E$3,tinyEmitter$1.exports.TinyEmitter=E$3;var numeric1_2_6={};function createInstance$1({define_e:ss=!0,define_pi:ts=!0,define_i:rs=!0,pow_strict:ns=!0}={}){let is={...all};delete is.createTau,delete is.createPhi,ss||delete is.createE,ts||delete is.createPi,rs||delete is.createI;let as=create$1(is);as.import(numeric1_2_6,{wrap:!0,silent:!0});var os=as.pow;return ns?as.import({pow:function(ls,us){return us!==0||typeof ls!="number"||ls!==0&&Number.isFinite(ls)?os(ls,us):NaN}},{override:!0}):as.import({pow:os},{override:!0}),as.define_e=ss,as.define_pi=ts,as.define_i=rs,as.pow_strict=ns,as}(function(exports){var numeric=exports;commonjsGlobal$1!==void 0&&(commonjsGlobal$1.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(ss,ts){var rs,ns,is;for(ts===void 0&&(ts=15),ns=.5,rs=new Date;;){for(is=ns*=2;is>3;is-=4)ss(),ss(),ss(),ss();for(;is>0;)ss(),is--;if(new Date-rs>ts)break}for(is=ns;is>3;is-=4)ss(),ss(),ss(),ss();for(;is>0;)ss(),is--;return 1e3*(3*ns-1)/(new Date-rs)},numeric._myIndexOf=function(ss){var ts,rs=this.length;for(ts=0;ts<rs;++ts)if(this[ts]===ss)return ts;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(ss){function ts(ns){if(ns===0)return"0";if(isNaN(ns))return"NaN";if(ns<0)return"-"+ts(-ns);if(isFinite(ns)){var is=Math.floor(Math.log(ns)/Math.log(10)),as=ns/Math.pow(10,is),os=as.toPrecision(numeric.precision);return parseFloat(os)===10&&(is++,os=(as=1).toPrecision(numeric.precision)),parseFloat(os).toString()+"e"+is.toString()}return"Infinity"}var rs=[];return function ns(is){var as;if(is===void 0)return rs.push(Array(numeric.precision+8).join(" ")),!1;if(typeof is=="string")return rs.push('"'+is+'"'),!1;if(typeof is=="boolean")return rs.push(is.toString()),!1;if(typeof is=="number"){var os=ts(is),ls=is.toPrecision(numeric.precision),us=parseFloat(is.toString()).toString(),cs=[os,ls,us,parseFloat(ls).toString(),parseFloat(us).toString()];for(as=1;as<cs.length;as++)cs[as].length<os.length&&(os=cs[as]);return rs.push(Array(numeric.precision+8-os.length).join(" ")+os),!1}if(is===null)return rs.push("null"),!1;if(typeof is=="function"){rs.push(is.toString());var ps=!1;for(as in is)is.hasOwnProperty(as)&&(ps?rs.push(`,
`):rs.push(`
{`),ps=!0,rs.push(as),rs.push(`: 
`),ns(is[as]));return ps&&rs.push(`}
`),!0}if(is instanceof Array){if(is.length>numeric.largeArray)return rs.push("...Large Array..."),!0;for(ps=!1,rs.push("["),as=0;as<is.length;as++)as>0&&(rs.push(","),ps&&rs.push(`
 `)),ps=ns(is[as]);return rs.push("]"),!0}for(as in rs.push("{"),ps=!1,is)is.hasOwnProperty(as)&&(ps&&rs.push(`,
`),ps=!0,rs.push(as),rs.push(`: 
`),ns(is[as]));return rs.push("}"),!0}(ss),rs.join("")},numeric.parseDate=function(ss){return function ts(rs){if(typeof rs=="string")return Date.parse(rs.replace(/-/g,"/"));if(!(rs instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var ns,is=[];for(ns=0;ns<rs.length;ns++)is[ns]=ts(rs[ns]);return is}(ss)},numeric.parseFloat=function(ss){return function ts(rs){if(typeof rs=="string")return parseFloat(rs);if(!(rs instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var ns,is=[];for(ns=0;ns<rs.length;ns++)is[ns]=ts(rs[ns]);return is}(ss)},numeric.parseCSV=function(ss){var ts,rs,ns,is=ss.split(`
`),as=[],os=/(([^'",]*)|('[^']*')|("[^"]*")),/g,ls=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,us=0;for(rs=0;rs<is.length;rs++){var cs,ps=(is[rs]+",").match(os);if(ps.length>0){for(as[us]=[],ts=0;ts<ps.length;ts++)cs=(ns=ps[ts]).substr(0,ns.length-1),ls.test(cs)?as[us][ts]=parseFloat(cs):as[us][ts]=cs;us++}}return as},numeric.toCSV=function(ss){var ts,rs,ns,is,as,os=numeric.dim(ss);for(ns=os[0],os[1],as=[],ts=0;ts<ns;ts++){for(is=[],rs=0;rs<ns;rs++)is[rs]=ss[ts][rs].toString();as[ts]=is.join(", ")}return as.join(`
`)+`
`},numeric.getURL=function(ss){var ts=new XMLHttpRequest;return ts.open("GET",ss,!1),ts.send(),ts},numeric.imageURL=function(ss){function ts(gs,bs,vs){bs===void 0&&(bs=0),vs===void 0&&(vs=gs.length);var Ns,Ts=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],Cs=-1;for(gs.length,Ns=bs;Ns<vs;Ns++)Cs=Cs>>>8^Ts[255&(Cs^gs[Ns])];return-1^Cs}var rs,ns,is,as,os,ls,us,cs,ps,ds,fs=ss[0].length,hs=ss[0][0].length,ys=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,hs>>24&255,hs>>16&255,hs>>8&255,255&hs,fs>>24&255,fs>>16&255,fs>>8&255,255&fs,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(ds=ts(ys,12,29),ys[29]=ds>>24&255,ys[30]=ds>>16&255,ys[31]=ds>>8&255,ys[32]=255&ds,rs=1,ns=0,us=0;us<fs;us++){for(us<fs-1?ys.push(0):ys.push(1),os=3*hs+1+(us===0)&255,ls=3*hs+1+(us===0)>>8&255,ys.push(os),ys.push(ls),ys.push(255&~os),ys.push(255&~ls),us===0&&ys.push(0),cs=0;cs<hs;cs++)for(is=0;is<3;is++)ns=(ns+(rs=(rs+(os=(os=ss[is][us][cs])>255?255:os<0?0:Math.round(os)))%65521))%65521,ys.push(os);ys.push(0)}return ps=(ns<<16)+rs,ys.push(ps>>24&255),ys.push(ps>>16&255),ys.push(ps>>8&255),ys.push(255&ps),as=ys.length-41,ys[33]=as>>24&255,ys[34]=as>>16&255,ys[35]=as>>8&255,ys[36]=255&as,ds=ts(ys,37),ys.push(ds>>24&255),ys.push(ds>>16&255),ys.push(ds>>8&255),ys.push(255&ds),ys.push(0),ys.push(0),ys.push(0),ys.push(0),ys.push(73),ys.push(69),ys.push(78),ys.push(68),ys.push(174),ys.push(66),ys.push(96),ys.push(130),"data:image/png;base64,"+function(gs){var bs,vs,Ns,Ts,Cs,xs,As,ws=gs.length,Es="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ss="";for(bs=0;bs<ws;bs+=3)Cs=((3&(vs=gs[bs]))<<4)+((Ns=gs[bs+1])>>4),xs=((15&Ns)<<2)+((Ts=gs[bs+2])>>6),As=63&Ts,bs+1>=ws?xs=As=64:bs+2>=ws&&(As=64),Ss+=Es.charAt(vs>>2)+Es.charAt(Cs)+Es.charAt(xs)+Es.charAt(As);return Ss}(ys)},numeric._dim=function(ss){for(var ts=[];typeof ss=="object";)ts.push(ss.length),ss=ss[0];return ts},numeric.dim=function(ss){var ts;return typeof ss=="object"?typeof(ts=ss[0])=="object"?typeof ts[0]=="object"?numeric._dim(ss):[ss.length,ts.length]:[ss.length]:[]},numeric.mapreduce=function(ss,ts){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+ts+`;
if(typeof x === "number") { var xi = x; `+ss+`; return accum; }
if(typeof _s === "undefined") _s = numeric.dim(x);
if(typeof _k === "undefined") _k = 0;
var _n = _s[_k];
var i,xi;
if(_k < _s.length-1) {
    for(i=_n-1;i>=0;i--) {
        accum = arguments.callee(x[i],accum,_s,_k+1);
    }    return accum;
}
for(i=_n-1;i>=1;i-=2) { 
    xi = x[i];
    `+ss+`;
    xi = x[i-1];
    `+ss+`;
}
if(i === 0) {
    xi = x[i];
    `+ss+`
}
return accum;`)},numeric.mapreduce2=function(ss,ts){return Function("x",`var n = x.length;
var i,xi;
`+ts+`;
for(i=n-1;i!==-1;--i) { 
    xi = x[i];
    `+ss+`;
}
return accum;`)},numeric.same=function ss(ts,rs){var ns,is;if(!(ts instanceof Array&&rs instanceof Array)||(is=ts.length)!==rs.length)return!1;for(ns=0;ns<is;ns++)if(ts[ns]!==rs[ns]&&(typeof ts[ns]!="object"||!ss(ts[ns],rs[ns])))return!1;return!0},numeric.rep=function(ss,ts,rs){rs===void 0&&(rs=0);var ns,is=ss[rs],as=Array(is);if(rs===ss.length-1){for(ns=is-2;ns>=0;ns-=2)as[ns+1]=ts,as[ns]=ts;return ns===-1&&(as[0]=ts),as}for(ns=is-1;ns>=0;ns--)as[ns]=numeric.rep(ss,ts,rs+1);return as},numeric.dotMMsmall=function(ss,ts){var rs,ns,is,as,os,ls,us,cs,ps,ds,fs;for(as=ss.length,os=ts.length,ls=ts[0].length,us=Array(as),rs=as-1;rs>=0;rs--){for(cs=Array(ls),ps=ss[rs],is=ls-1;is>=0;is--){for(ds=ps[os-1]*ts[os-1][is],ns=os-2;ns>=1;ns-=2)fs=ns-1,ds+=ps[ns]*ts[ns][is]+ps[fs]*ts[fs][is];ns===0&&(ds+=ps[0]*ts[0][is]),cs[is]=ds}us[rs]=cs}return us},numeric._getCol=function(ss,ts,rs){var ns;for(ns=ss.length-1;ns>0;--ns)rs[ns]=ss[ns][ts],rs[--ns]=ss[ns][ts];ns===0&&(rs[0]=ss[0][ts])},numeric.dotMMbig=function(ss,ts){var rs,ns,is,as=numeric._getCol,os=ts.length,ls=Array(os),us=ss.length,cs=ts[0].length,ps=new Array(us),ds=numeric.dotVV;for(--os,ns=--us;ns!==-1;--ns)ps[ns]=Array(cs);for(ns=--cs;ns!==-1;--ns)for(as(ts,ns,ls),is=us;is!==-1;--is)rs=ss[is],ps[is][ns]=ds(rs,ls);return ps},numeric.dotMV=function(ss,ts){var rs,ns=ss.length;ts.length;var is=Array(ns),as=numeric.dotVV;for(rs=ns-1;rs>=0;rs--)is[rs]=as(ss[rs],ts);return is},numeric.dotVM=function(ss,ts){var rs,ns,is,as,os,ls,us;for(is=ss.length,as=ts[0].length,os=Array(as),ns=as-1;ns>=0;ns--){for(ls=ss[is-1]*ts[is-1][ns],rs=is-2;rs>=1;rs-=2)us=rs-1,ls+=ss[rs]*ts[rs][ns]+ss[us]*ts[us][ns];rs===0&&(ls+=ss[0]*ts[0][ns]),os[ns]=ls}return os},numeric.dotVV=function(ss,ts){var rs,ns,is=ss.length,as=ss[is-1]*ts[is-1];for(rs=is-2;rs>=1;rs-=2)ns=rs-1,as+=ss[rs]*ts[rs]+ss[ns]*ts[ns];return rs===0&&(as+=ss[0]*ts[0]),as},numeric.dot=function(ss,ts){var rs=numeric.dim;switch(1e3*rs(ss).length+rs(ts).length){case 2002:return ts.length<10?numeric.dotMMsmall(ss,ts):numeric.dotMMbig(ss,ts);case 2001:return numeric.dotMV(ss,ts);case 1002:return numeric.dotVM(ss,ts);case 1001:return numeric.dotVV(ss,ts);case 1e3:return numeric.mulVS(ss,ts);case 1:return numeric.mulSV(ss,ts);case 0:return ss*ts;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(ss){var ts,rs,ns,is,as=ss.length,os=Array(as);for(ts=as-1;ts>=0;ts--){for(is=Array(as),rs=ts+2,ns=as-1;ns>=rs;ns-=2)is[ns]=0,is[ns-1]=0;for(ns>ts&&(is[ns]=0),is[ts]=ss[ts],ns=ts-1;ns>=1;ns-=2)is[ns]=0,is[ns-1]=0;ns===0&&(is[0]=0),os[ts]=is}return os},numeric.getDiag=function(ss){var ts,rs=Math.min(ss.length,ss[0].length),ns=Array(rs);for(ts=rs-1;ts>=1;--ts)ns[ts]=ss[ts][ts],ns[--ts]=ss[ts][ts];return ts===0&&(ns[0]=ss[0][0]),ns},numeric.identity=function(ss){return numeric.diag(numeric.rep([ss],1))},numeric.pointwise=function(ss,ts,rs){rs===void 0&&(rs="");var ns,is,as=[],os=/\[i\]$/,ls="",us=!1;for(ns=0;ns<ss.length;ns++)os.test(ss[ns])?ls=is=ss[ns].substring(0,ss[ns].length-3):is=ss[ns],is==="ret"&&(us=!0),as.push(is);return as[ss.length]="_s",as[ss.length+1]="_k",as[ss.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+ls+`);
if(typeof _k === "undefined") _k = 0;
var _n = _s[_k];
var i`+(us?"":", ret = Array(_n)")+`;
if(_k < _s.length-1) {
    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee(`+ss.join(",")+`,_s,_k+1);
    return ret;
}
`+rs+`
for(i=_n-1;i!==-1;--i) {
    `+ts+`
}
return ret;`,Function.apply(null,as)},numeric.pointwise2=function(ss,ts,rs){rs===void 0&&(rs="");var ns,is,as=[],os=/\[i\]$/,ls="",us=!1;for(ns=0;ns<ss.length;ns++)os.test(ss[ns])?ls=is=ss[ns].substring(0,ss[ns].length-3):is=ss[ns],is==="ret"&&(us=!0),as.push(is);return as[ss.length]="var _n = "+ls+`.length;
var i`+(us?"":", ret = Array(_n)")+`;
`+rs+`
for(i=_n-1;i!==-1;--i) {
`+ts+`
}
return ret;`,Function.apply(null,as)},numeric._biforeach=function ss(ts,rs,ns,is,as){var os;if(is!==ns.length-1)for(os=ns[is]-1;os>=0;os--)ss(typeof ts=="object"?ts[os]:ts,typeof rs=="object"?rs[os]:rs,ns,is+1,as);else as(ts,rs)},numeric._biforeach2=function ss(ts,rs,ns,is,as){if(is===ns.length-1)return as(ts,rs);var os,ls=ns[is],us=Array(ls);for(os=ls-1;os>=0;--os)us[os]=ss(typeof ts=="object"?ts[os]:ts,typeof rs=="object"?rs[os]:rs,ns,is+1,as);return us},numeric._foreach=function ss(ts,rs,ns,is){var as;if(ns!==rs.length-1)for(as=rs[ns]-1;as>=0;as--)ss(ts[as],rs,ns+1,is);else is(ts)},numeric._foreach2=function ss(ts,rs,ns,is){if(ns===rs.length-1)return is(ts);var as,os=rs[ns],ls=Array(os);for(as=os-1;as>=0;as--)ls[as]=ss(ts[as],rs,ns+1,is);return ls},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var ss,ts;for(ss=0;ss<numeric.mathfuns2.length;++ss)ts=numeric.mathfuns2[ss],numeric.ops2[ts]=ts;for(ss in numeric.ops2)if(numeric.ops2.hasOwnProperty(ss)){ts=numeric.ops2[ss];var rs,ns,is="";numeric.myIndexOf.call(numeric.mathfuns2,ss)!==-1?(is="var "+ts+" = Math."+ts+`;
`,rs=function(as,os,ls){return as+" = "+ts+"("+os+","+ls+")"},ns=function(as,os){return as+" = "+ts+"("+as+","+os+")"}):(rs=function(as,os,ls){return as+" = "+os+" "+ts+" "+ls},ns=numeric.opseq.hasOwnProperty(ss+"eq")?function(as,os){return as+" "+ts+"= "+os}:function(as,os){return as+" = "+as+" "+ts+" "+os}),numeric[ss+"VV"]=numeric.pointwise2(["x[i]","y[i]"],rs("ret[i]","x[i]","y[i]"),is),numeric[ss+"SV"]=numeric.pointwise2(["x","y[i]"],rs("ret[i]","x","y[i]"),is),numeric[ss+"VS"]=numeric.pointwise2(["x[i]","y"],rs("ret[i]","x[i]","y"),is),numeric[ss]=Function(`var n = arguments.length, i, x = arguments[0], y;
var VV = numeric.`+ss+"VV, VS = numeric."+ss+"VS, SV = numeric."+ss+`SV;
var dim = numeric.dim;
for(i=1;i!==n;++i) { 
  y = arguments[i];
  if(typeof x === "object") {
      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);
      else x = numeric._biforeach2(x,y,dim(x),0,VS);
  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);
  else `+ns("x","y")+`
}
return x;
`),numeric[ts]=numeric[ss],numeric[ss+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],ns("ret[i]","x[i]"),is),numeric[ss+"eqS"]=numeric.pointwise2(["ret[i]","x"],ns("ret[i]","x"),is),numeric[ss+"eq"]=Function(`var n = arguments.length, i, x = arguments[0], y;
var V = numeric.`+ss+"eqV, S = numeric."+ss+`eqS
var s = numeric.dim(x);
for(i=1;i!==n;++i) { 
  y = arguments[i];
  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);
  else numeric._biforeach(x,y,s,0,S);
}
return x;
`)}for(ss=0;ss<numeric.mathfuns2.length;++ss)ts=numeric.mathfuns2[ss],delete numeric.ops2[ts];for(ss=0;ss<numeric.mathfuns.length;++ss)ts=numeric.mathfuns[ss],numeric.ops1[ts]=ts;for(ss in numeric.ops1)numeric.ops1.hasOwnProperty(ss)&&(is="",ts=numeric.ops1[ss],numeric.myIndexOf.call(numeric.mathfuns,ss)!==-1&&Math.hasOwnProperty(ts)&&(is="var "+ts+" = Math."+ts+`;
`),numeric[ss+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+ts+"(ret[i]);",is),numeric[ss+"eq"]=Function("x",'if(typeof x !== "object") return '+ts+`x
var i;
var V = numeric.`+ss+`eqV;
var s = numeric.dim(x);
numeric._foreach(x,s,0,V);
return x;
`),numeric[ss+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+ts+"(x[i]);",is),numeric[ss]=Function("x",'if(typeof x !== "object") return '+ts+`(x)
var i;
var V = numeric.`+ss+`V;
var s = numeric.dim(x);
return numeric._foreach2(x,s,0,V);
`));for(ss=0;ss<numeric.mathfuns.length;++ss)ts=numeric.mathfuns[ss],delete numeric.ops1[ts];for(ss in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(ss)&&(ts=numeric.mapreducers[ss],numeric[ss+"V"]=numeric.mapreduce2(ts[0],ts[1]),numeric[ss]=Function("x","s","k",ts[1]+`if(typeof x !== "object") {    xi = x;
`+ts[0]+`;
    return accum;
}if(typeof s === "undefined") s = numeric.dim(x);
if(typeof k === "undefined") k = 0;
if(k === s.length-1) return numeric.`+ss+`V(x);
var xi;
var n = x.length, i;
for(i=n-1;i!==-1;--i) {
   xi = arguments.callee(x[i]);
`+ts[0]+`;
}
return accum;
`))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(ss,ts){return typeof ss=="object"?typeof ts=="object"?numeric.truncVV(ss,ts):numeric.truncVS(ss,ts):typeof ts=="object"?numeric.truncSV(ss,ts):Math.round(ss/ts)*ts},numeric.inv=function(ss){var ts,rs,ns,is,as,os,ls,us=numeric.dim(ss),cs=Math.abs,ps=us[0],ds=us[1],fs=numeric.clone(ss),hs=numeric.identity(ps);for(os=0;os<ds;++os){var ys=-1,gs=-1;for(as=os;as!==ps;++as)(ls=cs(fs[as][os]))>gs&&(ys=as,gs=ls);for(rs=fs[ys],fs[ys]=fs[os],fs[os]=rs,is=hs[ys],hs[ys]=hs[os],hs[os]=is,ss=rs[os],ls=os;ls!==ds;++ls)rs[ls]/=ss;for(ls=ds-1;ls!==-1;--ls)is[ls]/=ss;for(as=ps-1;as!==-1;--as)if(as!==os){for(ts=fs[as],ns=hs[as],ss=ts[os],ls=os+1;ls!==ds;++ls)ts[ls]-=rs[ls]*ss;for(ls=ds-1;ls>0;--ls)ns[ls]-=is[ls]*ss,ns[--ls]-=is[ls]*ss;ls===0&&(ns[0]-=is[0]*ss)}}return hs},numeric.det=function(ss){var ts=numeric.dim(ss);if(ts.length!==2||ts[0]!==ts[1])throw new Error("numeric: det() only works on square matrices");var rs,ns,is,as,os,ls,us,cs,ps=ts[0],ds=1,fs=numeric.clone(ss);for(ns=0;ns<ps-1;ns++){for(is=ns,rs=ns+1;rs<ps;rs++)Math.abs(fs[rs][ns])>Math.abs(fs[is][ns])&&(is=rs);for(is!==ns&&(us=fs[is],fs[is]=fs[ns],fs[ns]=us,ds*=-1),as=fs[ns],rs=ns+1;rs<ps;rs++){for(ls=(os=fs[rs])[ns]/as[ns],is=ns+1;is<ps-1;is+=2)cs=is+1,os[is]-=as[is]*ls,os[cs]-=as[cs]*ls;is!==ps&&(os[is]-=as[is]*ls)}if(as[ns]===0)return 0;ds*=as[ns]}return ds*fs[ns][ns]},numeric.transpose=function(ss){var ts,rs,ns,is,as,os=ss.length,ls=ss[0].length,us=Array(ls);for(rs=0;rs<ls;rs++)us[rs]=Array(os);for(ts=os-1;ts>=1;ts-=2){for(is=ss[ts],ns=ss[ts-1],rs=ls-1;rs>=1;--rs)(as=us[rs])[ts]=is[rs],as[ts-1]=ns[rs],(as=us[--rs])[ts]=is[rs],as[ts-1]=ns[rs];rs===0&&((as=us[0])[ts]=is[0],as[ts-1]=ns[0])}if(ts===0){for(ns=ss[0],rs=ls-1;rs>=1;--rs)us[rs][0]=ns[rs],us[--rs][0]=ns[rs];rs===0&&(us[0][0]=ns[0])}return us},numeric.negtranspose=function(ss){var ts,rs,ns,is,as,os=ss.length,ls=ss[0].length,us=Array(ls);for(rs=0;rs<ls;rs++)us[rs]=Array(os);for(ts=os-1;ts>=1;ts-=2){for(is=ss[ts],ns=ss[ts-1],rs=ls-1;rs>=1;--rs)(as=us[rs])[ts]=-is[rs],as[ts-1]=-ns[rs],(as=us[--rs])[ts]=-is[rs],as[ts-1]=-ns[rs];rs===0&&((as=us[0])[ts]=-is[0],as[ts-1]=-ns[0])}if(ts===0){for(ns=ss[0],rs=ls-1;rs>=1;--rs)us[rs][0]=-ns[rs],us[--rs][0]=-ns[rs];rs===0&&(us[0][0]=-ns[0])}return us},numeric._random=function ss(ts,rs){var ns,is,as=ts[rs],os=Array(as);if(rs===ts.length-1){for(is=Math.random,ns=as-1;ns>=1;ns-=2)os[ns]=is(),os[ns-1]=is();return ns===0&&(os[0]=is()),os}for(ns=as-1;ns>=0;ns--)os[ns]=ss(ts,rs+1);return os},numeric.random=function(ss){return numeric._random(ss,0)},numeric.norm2=function(ss){return Math.sqrt(numeric.norm2Squared(ss))},numeric.linspace=function(ss,ts,rs){if(rs===void 0&&(rs=Math.max(Math.round(ts-ss)+1,1)),rs<2)return rs===1?[ss]:[];var ns,is=Array(rs);for(ns=--rs;ns>=0;ns--)is[ns]=(ns*ts+(rs-ns)*ss)/rs;return is},numeric.getBlock=function(ss,ts,rs){var ns=numeric.dim(ss);return function is(as,os){var ls,us=ts[os],cs=rs[os]-us,ps=Array(cs);if(os===ns.length-1){for(ls=cs;ls>=0;ls--)ps[ls]=as[ls+us];return ps}for(ls=cs;ls>=0;ls--)ps[ls]=is(as[ls+us],os+1);return ps}(ss,0)},numeric.setBlock=function(ss,ts,rs,ns){var is=numeric.dim(ss);return function as(os,ls,us){var cs,ps=ts[us],ds=rs[us]-ps;if(us===is.length-1)for(cs=ds;cs>=0;cs--)os[cs+ps]=ls[cs];for(cs=ds;cs>=0;cs--)as(os[cs+ps],ls[cs],us+1)}(ss,ns,0),ss},numeric.getRange=function(ss,ts,rs){var ns,is,as,os,ls=ts.length,us=rs.length,cs=Array(ls);for(ns=ls-1;ns!==-1;--ns)for(cs[ns]=Array(us),as=cs[ns],os=ss[ts[ns]],is=us-1;is!==-1;--is)as[is]=os[rs[is]];return cs},numeric.blockMatrix=function(ss){var ts=numeric.dim(ss);if(ts.length<4)return numeric.blockMatrix([ss]);var rs,ns,is,as,os,ls=ts[0],us=ts[1];for(rs=0,ns=0,is=0;is<ls;++is)rs+=ss[is][0].length;for(as=0;as<us;++as)ns+=ss[0][as][0].length;var cs=Array(rs);for(is=0;is<rs;++is)cs[is]=Array(ns);var ps,ds,fs,hs,ys,gs=0;for(is=0;is<ls;++is){for(ps=ns,as=us-1;as!==-1;--as)for(ps-=(os=ss[is][as])[0].length,fs=os.length-1;fs!==-1;--fs)for(ys=os[fs],ds=cs[gs+fs],hs=ys.length-1;hs!==-1;--hs)ds[ps+hs]=ys[hs];gs+=ss[is][0].length}return cs},numeric.tensor=function(ss,ts){if(typeof ss=="number"||typeof ts=="number")return numeric.mul(ss,ts);var rs=numeric.dim(ss),ns=numeric.dim(ts);if(rs.length!==1||ns.length!==1)throw new Error("numeric: tensor product is only defined for vectors");var is,as,os,ls,us=rs[0],cs=ns[0],ps=Array(us);for(as=us-1;as>=0;as--){for(is=Array(cs),ls=ss[as],os=cs-1;os>=3;--os)is[os]=ls*ts[os],is[--os]=ls*ts[os],is[--os]=ls*ts[os],is[--os]=ls*ts[os];for(;os>=0;)is[os]=ls*ts[os],--os;ps[as]=is}return ps},numeric.T=function(ss,ts){this.x=ss,this.y=ts},numeric.t=function(ss,ts){return new numeric.T(ss,ts)},numeric.Tbinop=function(ss,ts,rs,ns,is){var as;if(numeric.indexOf,typeof is!="string")for(as in is="",numeric)numeric.hasOwnProperty(as)&&(ss.indexOf(as)>=0||ts.indexOf(as)>=0||rs.indexOf(as)>=0||ns.indexOf(as)>=0)&&as.length>1&&(is+="var "+as+" = numeric."+as+`;
`);return Function(["y"],`var x = this;
if(!(y instanceof numeric.T)) { y = new numeric.T(y); }
`+is+`
if(x.y) {  if(y.y) {    return new numeric.T(`+ns+`);
  }
  return new numeric.T(`+rs+`);
}
if(y.y) {
  return new numeric.T(`+ts+`);
}
return new numeric.T(`+ss+`);
`)},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var ss=numeric.mul,ts=numeric.div;if(this.y){var rs=numeric.add(ss(this.x,this.x),ss(this.y,this.y));return new numeric.T(ts(this.x,rs),ts(numeric.neg(this.y),rs))}return new T(ts(1,this.x))},numeric.T.prototype.div=function(ss){if(ss instanceof numeric.T||(ss=new numeric.T(ss)),ss.y)return this.mul(ss.reciprocal());var ts=numeric.div;return this.y?new numeric.T(ts(this.x,ss.x),ts(this.y,ss.x)):new numeric.T(ts(this.x,ss.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var ss=numeric.transpose,ts=this.x,rs=this.y;return rs?new numeric.T(ss(ts),ss(rs)):new numeric.T(ss(ts))},numeric.T.prototype.transjugate=function(){var ss=numeric.transpose,ts=this.x,rs=this.y;return rs?new numeric.T(ss(ts),numeric.negtranspose(rs)):new numeric.T(ss(ts))},numeric.Tunop=function(ss,ts,rs){return typeof rs!="string"&&(rs=""),Function(`var x = this;
`+rs+`
if(x.y) {  `+ts+`;
}
`+ss+`;
`)},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));",`var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();
return new numeric.T(numeric.log(r.x),theta.x);`),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);",`var f = numeric.norm2Squared;
return Math.sqrt(f(x.x)+f(x.y));`),numeric.T.prototype.inv=function(){var ss=this;if(ss.y===void 0)return new numeric.T(numeric.inv(ss.x));var ts,rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts=ss.x.length,Cs=numeric.identity(Ts),xs=numeric.rep([Ts,Ts],0),As=numeric.clone(ss.x),ws=numeric.clone(ss.y);for(cs=0;cs<Ts;cs++){for(fs=(ys=As[cs][cs])*ys+(gs=ws[cs][cs])*gs,ds=cs,ps=cs+1;ps<Ts;ps++)(hs=(ys=As[ps][cs])*ys+(gs=ws[ps][cs])*gs)>fs&&(ds=ps,fs=hs);for(ds!==cs&&(Ns=As[cs],As[cs]=As[ds],As[ds]=Ns,Ns=ws[cs],ws[cs]=ws[ds],ws[ds]=Ns,Ns=Cs[cs],Cs[cs]=Cs[ds],Cs[ds]=Ns,Ns=xs[cs],xs[cs]=xs[ds],xs[ds]=Ns),ts=As[cs],rs=ws[cs],as=Cs[cs],os=xs[cs],ys=ts[cs],gs=rs[cs],ps=cs+1;ps<Ts;ps++)bs=ts[ps],vs=rs[ps],ts[ps]=(bs*ys+vs*gs)/fs,rs[ps]=(vs*ys-bs*gs)/fs;for(ps=0;ps<Ts;ps++)bs=as[ps],vs=os[ps],as[ps]=(bs*ys+vs*gs)/fs,os[ps]=(vs*ys-bs*gs)/fs;for(ps=cs+1;ps<Ts;ps++){for(ns=As[ps],is=ws[ps],ls=Cs[ps],us=xs[ps],ys=ns[cs],gs=is[cs],ds=cs+1;ds<Ts;ds++)bs=ts[ds],vs=rs[ds],ns[ds]-=bs*ys-vs*gs,is[ds]-=vs*ys+bs*gs;for(ds=0;ds<Ts;ds++)bs=as[ds],vs=os[ds],ls[ds]-=bs*ys-vs*gs,us[ds]-=vs*ys+bs*gs}}for(cs=Ts-1;cs>0;cs--)for(as=Cs[cs],os=xs[cs],ps=cs-1;ps>=0;ps--)for(ls=Cs[ps],us=xs[ps],ys=As[ps][cs],gs=ws[ps][cs],ds=Ts-1;ds>=0;ds--)bs=as[ds],vs=os[ds],ls[ds]-=ys*bs-gs*vs,us[ds]-=ys*vs+gs*bs;return new numeric.T(Cs,xs)},numeric.T.prototype.get=function(ss){var ts,rs=this.x,ns=this.y,is=0,as=ss.length;if(ns){for(;is<as;)rs=rs[ts=ss[is]],ns=ns[ts],is++;return new numeric.T(rs,ns)}for(;is<as;)rs=rs[ts=ss[is]],is++;return new numeric.T(rs)},numeric.T.prototype.set=function(ss,ts){var rs,ns=this.x,is=this.y,as=0,os=ss.length,ls=ts.x,us=ts.y;if(os===0)return us?this.y=us:is&&(this.y=void 0),this.x=ns,this;if(us){for(is||(is=numeric.rep(numeric.dim(ns),0),this.y=is);as<os-1;)ns=ns[rs=ss[as]],is=is[rs],as++;return ns[rs=ss[as]]=ls,is[rs]=us,this}if(is){for(;as<os-1;)ns=ns[rs=ss[as]],is=is[rs],as++;return ns[rs=ss[as]]=ls,is[rs]=ls instanceof Array?numeric.rep(numeric.dim(ls),0):0,this}for(;as<os-1;)ns=ns[rs=ss[as]],as++;return ns[rs=ss[as]]=ls,this},numeric.T.prototype.getRows=function(ss,ts){var rs,ns,is=ts-ss+1,as=Array(is),os=this.x,ls=this.y;for(rs=ss;rs<=ts;rs++)as[rs-ss]=os[rs];if(ls){for(ns=Array(is),rs=ss;rs<=ts;rs++)ns[rs-ss]=ls[rs];return new numeric.T(as,ns)}return new numeric.T(as)},numeric.T.prototype.setRows=function(ss,ts,rs){var ns,is=this.x,as=this.y,os=rs.x,ls=rs.y;for(ns=ss;ns<=ts;ns++)is[ns]=os[ns-ss];if(ls)for(as||(as=numeric.rep(numeric.dim(is),0),this.y=as),ns=ss;ns<=ts;ns++)as[ns]=ls[ns-ss];else if(as)for(ns=ss;ns<=ts;ns++)as[ns]=numeric.rep([os[ns-ss].length],0);return this},numeric.T.prototype.getRow=function(ss){var ts=this.x,rs=this.y;return rs?new numeric.T(ts[ss],rs[ss]):new numeric.T(ts[ss])},numeric.T.prototype.setRow=function(ss,ts){var rs=this.x,ns=this.y,is=ts.x,as=ts.y;return rs[ss]=is,as?(ns||(ns=numeric.rep(numeric.dim(rs),0),this.y=ns),ns[ss]=as):ns&&(ns=numeric.rep([is.length],0)),this},numeric.T.prototype.getBlock=function(ss,ts){var rs=this.x,ns=this.y,is=numeric.getBlock;return ns?new numeric.T(is(rs,ss,ts),is(ns,ss,ts)):new numeric.T(is(rs,ss,ts))},numeric.T.prototype.setBlock=function(ss,ts,rs){rs instanceof numeric.T||(rs=new numeric.T(rs));var ns=this.x,is=this.y,as=numeric.setBlock,os=rs.x,ls=rs.y;if(ls)return is||(this.y=numeric.rep(numeric.dim(this),0),is=this.y),as(ns,ss,ts,os),as(is,ss,ts,ls),this;as(ns,ss,ts,os),is&&as(is,ss,ts,numeric.rep(numeric.dim(os),0))},numeric.T.rep=function(ss,ts){var rs=numeric.T;ts instanceof rs||(ts=new rs(ts));var ns=ts.x,is=ts.y,as=numeric.rep;return is?new rs(as(ss,ns),as(ss,is)):new rs(as(ss,ns))},numeric.T.diag=function(ss){ss instanceof numeric.T||(ss=new numeric.T(ss));var ts=ss.x,rs=ss.y,ns=numeric.diag;return rs?new numeric.T(ns(ts),ns(rs)):new numeric.T(ns(ts))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(ss){return new numeric.T(numeric.identity(ss))},numeric.T.prototype.getDiag=function(){var ss=numeric,ts=this.x,rs=this.y;return rs?new ss.T(ss.getDiag(ts),ss.getDiag(rs)):new ss.T(ss.getDiag(ts))},numeric.house=function(ss){var ts=numeric.clone(ss),rs=(ss[0]>=0?1:-1)*numeric.norm2(ss);ts[0]+=rs;var ns=numeric.norm2(ts);if(ns===0)throw new Error("eig: internal error");return numeric.div(ts,ns)},numeric.toUpperHessenberg=function(ss){var ts=numeric.dim(ss);if(ts.length!==2||ts[0]!==ts[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var rs,ns,is,as,os,ls,us,cs,ps,ds,fs=ts[0],hs=numeric.clone(ss),ys=numeric.identity(fs);for(ns=0;ns<fs-2;ns++){for(as=Array(fs-ns-1),rs=ns+1;rs<fs;rs++)as[rs-ns-1]=hs[rs][ns];if(numeric.norm2(as)>0){for(os=numeric.house(as),ls=numeric.getBlock(hs,[ns+1,ns],[fs-1,fs-1]),us=numeric.tensor(os,numeric.dot(os,ls)),rs=ns+1;rs<fs;rs++)for(cs=hs[rs],ps=us[rs-ns-1],is=ns;is<fs;is++)cs[is]-=2*ps[is-ns];for(ls=numeric.getBlock(hs,[0,ns+1],[fs-1,fs-1]),us=numeric.tensor(numeric.dot(ls,os),os),rs=0;rs<fs;rs++)for(cs=hs[rs],ps=us[rs],is=ns+1;is<fs;is++)cs[is]-=2*ps[is-ns-1];for(ls=Array(fs-ns-1),rs=ns+1;rs<fs;rs++)ls[rs-ns-1]=ys[rs];for(us=numeric.tensor(os,numeric.dot(os,ls)),rs=ns+1;rs<fs;rs++)for(ds=ys[rs],ps=us[rs-ns-1],is=0;is<fs;is++)ds[is]-=2*ps[is]}}return{H:hs,Q:ys}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(ss,ts){ts===void 0&&(ts=1e4),ss=numeric.clone(ss),numeric.clone(ss);var rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs=numeric.dim(ss)[0],xs=numeric.identity(Cs);if(Cs<3)return{Q:xs,B:[[0,Cs-1]]};var As=numeric.epsilon;for(Ts=0;Ts<ts;Ts++){for(vs=0;vs<Cs-1;vs++)if(Math.abs(ss[vs+1][vs])<As*(Math.abs(ss[vs][vs])+Math.abs(ss[vs+1][vs+1]))){var ws=numeric.QRFrancis(numeric.getBlock(ss,[0,0],[vs,vs]),ts),Es=numeric.QRFrancis(numeric.getBlock(ss,[vs+1,vs+1],[Cs-1,Cs-1]),ts);for(hs=Array(vs+1),bs=0;bs<=vs;bs++)hs[bs]=xs[bs];for(ys=numeric.dot(ws.Q,hs),bs=0;bs<=vs;bs++)xs[bs]=ys[bs];for(hs=Array(Cs-vs-1),bs=vs+1;bs<Cs;bs++)hs[bs-vs-1]=xs[bs];for(ys=numeric.dot(Es.Q,hs),bs=vs+1;bs<Cs;bs++)xs[bs]=ys[bs-vs-1];return{Q:xs,B:ws.B.concat(numeric.add(Es.B,vs+1))}}var Ss,Ds,Vs;for(is=ss[Cs-2][Cs-2],as=ss[Cs-2][Cs-1],os=ss[Cs-1][Cs-2],cs=is+(ls=ss[Cs-1][Cs-1]),us=is*ls-as*os,ps=numeric.getBlock(ss,[0,0],[2,2]),cs*cs>=4*us?(Ss=.5*(cs+Math.sqrt(cs*cs-4*us)),Ds=.5*(cs-Math.sqrt(cs*cs-4*us)),ps=numeric.add(numeric.sub(numeric.dot(ps,ps),numeric.mul(ps,Ss+Ds)),numeric.diag(numeric.rep([3],Ss*Ds)))):ps=numeric.add(numeric.sub(numeric.dot(ps,ps),numeric.mul(ps,cs)),numeric.diag(numeric.rep([3],us))),rs=[ps[0][0],ps[1][0],ps[2][0]],ns=numeric.house(rs),hs=[ss[0],ss[1],ss[2]],ys=numeric.tensor(ns,numeric.dot(ns,hs)),bs=0;bs<3;bs++)for(fs=ss[bs],gs=ys[bs],Ns=0;Ns<Cs;Ns++)fs[Ns]-=2*gs[Ns];for(hs=numeric.getBlock(ss,[0,0],[Cs-1,2]),ys=numeric.tensor(numeric.dot(hs,ns),ns),bs=0;bs<Cs;bs++)for(fs=ss[bs],gs=ys[bs],Ns=0;Ns<3;Ns++)fs[Ns]-=2*gs[Ns];for(hs=[xs[0],xs[1],xs[2]],ys=numeric.tensor(ns,numeric.dot(ns,hs)),bs=0;bs<3;bs++)for(ds=xs[bs],gs=ys[bs],Ns=0;Ns<Cs;Ns++)ds[Ns]-=2*gs[Ns];for(vs=0;vs<Cs-2;vs++){for(Ns=vs;Ns<=vs+1;Ns++)if(Math.abs(ss[Ns+1][Ns])<As*(Math.abs(ss[Ns][Ns])+Math.abs(ss[Ns+1][Ns+1]))){for(ws=numeric.QRFrancis(numeric.getBlock(ss,[0,0],[Ns,Ns]),ts),Es=numeric.QRFrancis(numeric.getBlock(ss,[Ns+1,Ns+1],[Cs-1,Cs-1]),ts),hs=Array(Ns+1),bs=0;bs<=Ns;bs++)hs[bs]=xs[bs];for(ys=numeric.dot(ws.Q,hs),bs=0;bs<=Ns;bs++)xs[bs]=ys[bs];for(hs=Array(Cs-Ns-1),bs=Ns+1;bs<Cs;bs++)hs[bs-Ns-1]=xs[bs];for(ys=numeric.dot(Es.Q,hs),bs=Ns+1;bs<Cs;bs++)xs[bs]=ys[bs-Ns-1];return{Q:xs,B:ws.B.concat(numeric.add(Es.B,Ns+1))}}for(Vs=Math.min(Cs-1,vs+3),rs=Array(Vs-vs),bs=vs+1;bs<=Vs;bs++)rs[bs-vs-1]=ss[bs][vs];for(ns=numeric.house(rs),hs=numeric.getBlock(ss,[vs+1,vs],[Vs,Cs-1]),ys=numeric.tensor(ns,numeric.dot(ns,hs)),bs=vs+1;bs<=Vs;bs++)for(fs=ss[bs],gs=ys[bs-vs-1],Ns=vs;Ns<Cs;Ns++)fs[Ns]-=2*gs[Ns-vs];for(hs=numeric.getBlock(ss,[0,vs+1],[Cs-1,Vs]),ys=numeric.tensor(numeric.dot(hs,ns),ns),bs=0;bs<Cs;bs++)for(fs=ss[bs],gs=ys[bs],Ns=vs+1;Ns<=Vs;Ns++)fs[Ns]-=2*gs[Ns-vs-1];for(hs=Array(Vs-vs),bs=vs+1;bs<=Vs;bs++)hs[bs-vs-1]=xs[bs];for(ys=numeric.tensor(ns,numeric.dot(ns,hs)),bs=vs+1;bs<=Vs;bs++)for(ds=xs[bs],gs=ys[bs-vs-1],Ns=0;Ns<Cs;Ns++)ds[Ns]-=2*gs[Ns]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(ss,ts){var rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns=numeric.toUpperHessenberg(ss),Ts=numeric.QRFrancis(Ns.H,ts),Cs=numeric.T,xs=ss.length,As=Ts.B,ws=numeric.dot(Ts.Q,numeric.dot(Ns.H,numeric.transpose(Ts.Q))),Es=new Cs(numeric.dot(Ts.Q,Ns.Q)),Ss=As.length,Ds=Math.sqrt;for(ns=0;ns<Ss;ns++)if((rs=As[ns][0])!==As[ns][1]){if(as=rs+1,os=ws[rs][rs],ls=ws[rs][as],us=ws[as][rs],cs=ws[as][as],ls===0&&us===0)continue;(ds=(ps=-os-cs)*ps-4*(os*cs-ls*us))>=0?((bs=(os-(fs=ps<0?-.5*(ps-Ds(ds)):-.5*(ps+Ds(ds))))*(os-fs)+ls*ls)>(vs=us*us+(cs-fs)*(cs-fs))?(ys=(os-fs)/(bs=Ds(bs)),gs=ls/bs):(ys=us/(vs=Ds(vs)),gs=(cs-fs)/vs),is=new Cs([[gs,-ys],[ys,gs]]),Es.setRows(rs,as,is.dot(Es.getRows(rs,as)))):(fs=-.5*ps,hs=.5*Ds(-ds),(bs=(os-fs)*(os-fs)+ls*ls)>(vs=us*us+(cs-fs)*(cs-fs))?(ys=(os-fs)/(bs=Ds(bs+hs*hs)),gs=ls/bs,fs=0,hs/=bs):(ys=us/(vs=Ds(vs+hs*hs)),gs=(cs-fs)/vs,fs=hs/vs,hs=0),is=new Cs([[gs,-ys],[ys,gs]],[[fs,hs],[hs,-fs]]),Es.setRows(rs,as,is.dot(Es.getRows(rs,as))))}var Vs=Es.dot(ss).dot(Es.transjugate()),Is=(xs=ss.length,numeric.T.identity(xs));for(as=0;as<xs;as++)if(as>0)for(ns=as-1;ns>=0;ns--){var Os=Vs.get([ns,ns]),Ps=Vs.get([as,as]);numeric.neq(Os.x,Ps.x)||numeric.neq(Os.y,Ps.y)?(fs=Vs.getRow(ns).getBlock([ns],[as-1]),hs=Is.getRow(as).getBlock([ns],[as-1]),Is.set([as,ns],Vs.get([ns,as]).neg().sub(fs.dot(hs)).div(Os.sub(Ps)))):Is.setRow(as,Is.getRow(ns))}for(as=0;as<xs;as++)fs=Is.getRow(as),Is.setRow(as,fs.div(fs.norm2()));return Is=Is.transpose(),Is=Es.transjugate().dot(Is),{lambda:Vs.getDiag(),E:Is}},numeric.ccsSparse=function(ss){var ts,rs,ns,is=ss.length,as=[];for(rs=is-1;rs!==-1;--rs)for(ns in ts=ss[rs]){for(ns=parseInt(ns);ns>=as.length;)as[as.length]=0;ts[ns]!==0&&as[ns]++}var os=as.length,ls=Array(os+1);for(ls[0]=0,rs=0;rs<os;++rs)ls[rs+1]=ls[rs]+as[rs];var us=Array(ls[os]),cs=Array(ls[os]);for(rs=is-1;rs!==-1;--rs)for(ns in ts=ss[rs])ts[ns]!==0&&(as[ns]--,us[ls[ns]+as[ns]]=rs,cs[ls[ns]+as[ns]]=ts[ns]);return[ls,us,cs]},numeric.ccsFull=function(ss){var ts,rs,ns,is,as=ss[0],os=ss[1],ls=ss[2],us=numeric.ccsDim(ss),cs=us[0],ps=us[1],ds=numeric.rep([cs,ps],0);for(ts=0;ts<ps;ts++)for(ns=as[ts],is=as[ts+1],rs=ns;rs<is;++rs)ds[os[rs]][ts]=ls[rs];return ds},numeric.ccsTSolve=function(ss,ts,rs,ns,is){var as,os,ls,us,cs,ps,ds,fs=ss[0],hs=ss[1],ys=ss[2],gs=fs.length-1,bs=Math.max,vs=0;function Ns(Ts){var Cs;if(rs[Ts]===0){for(rs[Ts]=1,Cs=fs[Ts];Cs<fs[Ts+1];++Cs)Ns(hs[Cs]);is[vs]=Ts,++vs}}for(ns===void 0&&(rs=numeric.rep([gs],0)),ns===void 0&&(ns=numeric.linspace(0,rs.length-1)),is===void 0&&(is=[]),as=ns.length-1;as!==-1;--as)Ns(ns[as]);for(is.length=vs,as=is.length-1;as!==-1;--as)rs[is[as]]=0;for(as=ns.length-1;as!==-1;--as)os=ns[as],rs[os]=ts[os];for(as=is.length-1;as!==-1;--as){for(os=is[as],ls=fs[os],us=bs(fs[os+1],ls),cs=ls;cs!==us;++cs)if(hs[cs]===os){rs[os]/=ys[cs];break}for(ds=rs[os],cs=ls;cs!==us;++cs)(ps=hs[cs])!==os&&(rs[ps]-=ds*ys[cs])}return rs},numeric.ccsDFS=function(ss){this.k=Array(ss),this.k1=Array(ss),this.j=Array(ss)},numeric.ccsDFS.prototype.dfs=function(ss,ts,rs,ns,is,as){var os,ls,us,cs=0,ps=is.length,ds=this.k,fs=this.k1,hs=this.j;if(ns[ss]===0)for(ns[ss]=1,hs[0]=ss,ds[0]=ls=ts[ss],fs[0]=us=ts[ss+1];;)if(ls>=us){if(is[ps]=hs[cs],cs===0)return;++ps,ls=ds[--cs],us=fs[cs]}else ns[os=as[rs[ls]]]===0?(ns[os]=1,ds[cs]=ls,hs[++cs]=os,ls=ts[os],fs[cs]=us=ts[os+1]):++ls},numeric.ccsLPSolve=function(ss,ts,rs,ns,is,as,os){var ls=ss[0],us=ss[1],cs=ss[2];ls.length;var ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts=ts[0],Cs=ts[1],xs=ts[2];for(ds=Ts[is],fs=Ts[is+1],ns.length=0,ps=ds;ps<fs;++ps)os.dfs(as[Cs[ps]],ls,us,rs,ns,as);for(ps=ns.length-1;ps!==-1;--ps)rs[ns[ps]]=0;for(ps=ds;ps!==fs;++ps)rs[hs=as[Cs[ps]]]=xs[ps];for(ps=ns.length-1;ps!==-1;--ps){for(ys=ls[hs=ns[ps]],gs=ls[hs+1],bs=ys;bs<gs;++bs)if(as[us[bs]]===hs){rs[hs]/=cs[bs];break}for(Ns=rs[hs],bs=ys;bs<gs;++bs)(vs=as[us[bs]])!==hs&&(rs[vs]-=Ns*cs[bs])}return rs},numeric.ccsLUP1=function(ss,ts){var rs,ns,is,as,os,ls,us,cs=ss[0].length-1,ps=[numeric.rep([cs+1],0),[],[]],ds=[numeric.rep([cs+1],0),[],[]],fs=ps[0],hs=ps[1],ys=ps[2],gs=ds[0],bs=ds[1],vs=ds[2],Ns=numeric.rep([cs],0),Ts=numeric.rep([cs],0),Cs=numeric.ccsLPSolve,xs=Math.abs,As=numeric.linspace(0,cs-1),ws=numeric.linspace(0,cs-1),Es=new numeric.ccsDFS(cs);for(ts===void 0&&(ts=1),rs=0;rs<cs;++rs){for(Cs(ps,ss,Ns,Ts,rs,ws,Es),as=-1,os=-1,ns=Ts.length-1;ns!==-1;--ns)(is=Ts[ns])<=rs||(ls=xs(Ns[is]))>as&&(os=is,as=ls);for(xs(Ns[rs])<ts*as&&(ns=As[rs],as=As[os],As[rs]=as,ws[as]=rs,As[os]=ns,ws[ns]=os,as=Ns[rs],Ns[rs]=Ns[os],Ns[os]=as),as=fs[rs],os=gs[rs],us=Ns[rs],hs[as]=As[rs],ys[as]=1,++as,ns=Ts.length-1;ns!==-1;--ns)ls=Ns[is=Ts[ns]],Ts[ns]=0,Ns[is]=0,is<=rs?(bs[os]=is,vs[os]=ls,++os):(hs[as]=As[is],ys[as]=ls/us,++as);fs[rs+1]=as,gs[rs+1]=os}for(ns=hs.length-1;ns!==-1;--ns)hs[ns]=ws[hs[ns]];return{L:ps,U:ds,P:As,Pinv:ws}},numeric.ccsDFS0=function(ss){this.k=Array(ss),this.k1=Array(ss),this.j=Array(ss)},numeric.ccsDFS0.prototype.dfs=function(ss,ts,rs,ns,is,as,os){var ls,us,cs,ps=0,ds=is.length,fs=this.k,hs=this.k1,ys=this.j;if(ns[ss]===0)for(ns[ss]=1,ys[0]=ss,fs[0]=us=ts[as[ss]],hs[0]=cs=ts[as[ss]+1];;){if(isNaN(us))throw new Error("Ow!");if(us>=cs){if(is[ds]=as[ys[ps]],ps===0)return;++ds,us=fs[--ps],cs=hs[ps]}else ns[ls=rs[us]]===0?(ns[ls]=1,fs[ps]=us,ys[++ps]=ls,us=ts[ls=as[ls]],hs[ps]=cs=ts[ls+1]):++us}},numeric.ccsLPSolve0=function(ss,ts,rs,ns,is,as,os,ls){var us=ss[0],cs=ss[1],ps=ss[2];us.length;var ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs=ts[0],xs=ts[1],As=ts[2];for(fs=Cs[is],hs=Cs[is+1],ns.length=0,ds=fs;ds<hs;++ds)ls.dfs(xs[ds],us,cs,rs,ns,as,os);for(ds=ns.length-1;ds!==-1;--ds)rs[os[ys=ns[ds]]]=0;for(ds=fs;ds!==hs;++ds)rs[ys=xs[ds]]=As[ds];for(ds=ns.length-1;ds!==-1;--ds){for(Ns=os[ys=ns[ds]],gs=us[ys],bs=us[ys+1],vs=gs;vs<bs;++vs)if(cs[vs]===Ns){rs[Ns]/=ps[vs];break}for(Ts=rs[Ns],vs=gs;vs<bs;++vs)rs[cs[vs]]-=Ts*ps[vs];rs[Ns]=Ts}},numeric.ccsLUP0=function(ss,ts){var rs,ns,is,as,os,ls,us,cs=ss[0].length-1,ps=[numeric.rep([cs+1],0),[],[]],ds=[numeric.rep([cs+1],0),[],[]],fs=ps[0],hs=ps[1],ys=ps[2],gs=ds[0],bs=ds[1],vs=ds[2],Ns=numeric.rep([cs],0),Ts=numeric.rep([cs],0),Cs=numeric.ccsLPSolve0,xs=Math.abs,As=numeric.linspace(0,cs-1),ws=numeric.linspace(0,cs-1),Es=new numeric.ccsDFS0(cs);for(ts===void 0&&(ts=1),rs=0;rs<cs;++rs){for(Cs(ps,ss,Ns,Ts,rs,ws,As,Es),as=-1,os=-1,ns=Ts.length-1;ns!==-1;--ns)(is=Ts[ns])<=rs||(ls=xs(Ns[As[is]]))>as&&(os=is,as=ls);for(xs(Ns[As[rs]])<ts*as&&(ns=As[rs],as=As[os],As[rs]=as,ws[as]=rs,As[os]=ns,ws[ns]=os),as=fs[rs],os=gs[rs],us=Ns[As[rs]],hs[as]=As[rs],ys[as]=1,++as,ns=Ts.length-1;ns!==-1;--ns)ls=Ns[As[is=Ts[ns]]],Ts[ns]=0,Ns[As[is]]=0,is<=rs?(bs[os]=is,vs[os]=ls,++os):(hs[as]=As[is],ys[as]=ls/us,++as);fs[rs+1]=as,gs[rs+1]=os}for(ns=hs.length-1;ns!==-1;--ns)hs[ns]=ws[hs[ns]];return{L:ps,U:ds,P:As,Pinv:ws}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(ss){return[numeric.sup(ss[1])+1,ss[0].length-1]},numeric.ccsGetBlock=function(ss,ts,rs){var ns=numeric.ccsDim(ss),is=ns[0],as=ns[1];ts===void 0?ts=numeric.linspace(0,is-1):typeof ts=="number"&&(ts=[ts]),rs===void 0?rs=numeric.linspace(0,as-1):typeof rs=="number"&&(rs=[rs]);var os,ls,us,cs,ps=ts.length,ds=rs.length,fs=numeric.rep([as],0),hs=[],ys=[],gs=[fs,hs,ys],bs=ss[0],vs=ss[1],Ns=ss[2],Ts=numeric.rep([is],0),Cs=0,xs=numeric.rep([is],0);for(ls=0;ls<ds;++ls){var As=bs[cs=rs[ls]],ws=bs[cs+1];for(os=As;os<ws;++os)xs[us=vs[os]]=1,Ts[us]=Ns[os];for(os=0;os<ps;++os)xs[ts[os]]&&(hs[Cs]=os,ys[Cs]=Ts[ts[os]],++Cs);for(os=As;os<ws;++os)xs[us=vs[os]]=0;fs[ls+1]=Cs}return gs},numeric.ccsDot=function(ss,ts){var rs=ss[0],ns=ss[1],is=ss[2],as=ts[0],os=ts[1],ls=ts[2],us=numeric.ccsDim(ss),cs=numeric.ccsDim(ts),ps=us[0];us[1];var ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs,xs,As=cs[1],ws=numeric.rep([ps],0),Es=numeric.rep([ps],0),Ss=Array(ps),Ds=numeric.rep([As],0),Vs=[],Is=[],Os=[Ds,Vs,Is];for(hs=0;hs!==As;++hs){for(ys=as[hs],gs=as[hs+1],Ts=0,fs=ys;fs<gs;++fs)for(Cs=os[fs],xs=ls[fs],bs=rs[Cs],vs=rs[Cs+1],ds=bs;ds<vs;++ds)Es[Ns=ns[ds]]===0&&(Ss[Ts]=Ns,Es[Ns]=1,Ts+=1),ws[Ns]=ws[Ns]+is[ds]*xs;for(gs=(ys=Ds[hs])+Ts,Ds[hs+1]=gs,fs=Ts-1;fs!==-1;--fs)xs=ys+fs,ds=Ss[fs],Vs[xs]=ds,Is[xs]=ws[ds],Es[ds]=0,ws[ds]=0;Ds[hs+1]=Ds[hs]+Ts}return Os},numeric.ccsLUPSolve=function(ss,ts){var rs=ss.L,ns=ss.U;ss.P;var is=ts[0],as=!1;typeof is!="object"&&(is=(ts=[[0,ts.length],numeric.linspace(0,ts.length-1),ts])[0],as=!0);var os,ls,us,cs,ps,ds,fs=ts[1],hs=ts[2],ys=rs[0].length-1,gs=is.length-1,bs=numeric.rep([ys],0),vs=Array(ys),Ns=numeric.rep([ys],0),Ts=Array(ys),Cs=numeric.rep([gs+1],0),xs=[],As=[],ws=numeric.ccsTSolve,Es=0;for(os=0;os<gs;++os){for(ps=0,us=is[os],cs=is[os+1],ls=us;ls<cs;++ls)ds=ss.Pinv[fs[ls]],Ts[ps]=ds,Ns[ds]=hs[ls],++ps;for(Ts.length=ps,ws(rs,Ns,bs,Ts,vs),ls=Ts.length-1;ls!==-1;--ls)Ns[Ts[ls]]=0;if(ws(ns,bs,Ns,vs,Ts),as)return Ns;for(ls=vs.length-1;ls!==-1;--ls)bs[vs[ls]]=0;for(ls=Ts.length-1;ls!==-1;--ls)ds=Ts[ls],xs[Es]=ds,As[Es]=Ns[ds],Ns[ds]=0,++Es;Cs[os+1]=Es}return[Cs,xs,As]},numeric.ccsbinop=function(ss,ts){return ts===void 0&&(ts=""),Function("X","Y",`var Xi = X[0], Xj = X[1], Xv = X[2];
var Yi = Y[0], Yj = Y[1], Yv = Y[2];
var n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;
var Zi = numeric.rep([n+1],0), Zj = [], Zv = [];
var x = numeric.rep([m],0),y = numeric.rep([m],0);
var xk,yk,zk;
var i,j,j0,j1,k,p=0;
`+ts+`for(i=0;i<n;++i) {
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Xj[j];
    x[k] = 1;
    Zj[p] = k;
    ++p;
  }
  j0 = Yi[i]; j1 = Yi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Yj[j];
    y[k] = Yv[j];
    if(x[k] === 0) {
      Zj[p] = k;
      ++p;
    }
  }
  Zi[i+1] = p;
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];
  j0 = Zi[i]; j1 = Zi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Zj[j];
    xk = x[k];
    yk = y[k];
`+ss+`
    Zv[j] = zk;
  }
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;
  j0 = Yi[i]; j1 = Yi[i+1];
  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;
}
return [Zi,Zj,Zv];`)},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+`;
if(typeof Y === "number") return `+B+`;
return `+C+`;
`)}(),numeric.ccsScatter=function(ss){var ts,rs=ss[0],ns=ss[1],is=ss[2],as=numeric.sup(ns)+1,os=rs.length,ls=numeric.rep([as],0),us=Array(os),cs=Array(os),ps=numeric.rep([as],0);for(ts=0;ts<os;++ts)ps[ns[ts]]++;for(ts=0;ts<as;++ts)ls[ts+1]=ls[ts]+ps[ts];var ds,fs,hs=ls.slice(0);for(ts=0;ts<os;++ts)us[ds=hs[fs=ns[ts]]]=rs[ts],cs[ds]=is[ts],hs[fs]=hs[fs]+1;return[ls,us,cs]},numeric.ccsGather=function(ss){var ts,rs,ns,is,as,os=ss[0],ls=ss[1],us=ss[2],cs=os.length-1,ps=ls.length,ds=Array(ps),fs=Array(ps),hs=Array(ps);for(as=0,ts=0;ts<cs;++ts)for(ns=os[ts],is=os[ts+1],rs=ns;rs!==is;++rs)fs[as]=ts,ds[as]=ls[rs],hs[as]=us[rs],++as;return[ds,fs,hs]},numeric.sdim=function ss(ts,rs,ns){if(rs===void 0&&(rs=[]),typeof ts!="object")return rs;var is;for(is in ns===void 0&&(ns=0),ns in rs||(rs[ns]=0),ts.length>rs[ns]&&(rs[ns]=ts.length),ts)ts.hasOwnProperty(is)&&ss(ts[is],rs,ns+1);return rs},numeric.sclone=function ss(ts,rs,ns){rs===void 0&&(rs=0),ns===void 0&&(ns=numeric.sdim(ts).length);var is,as=Array(ts.length);if(rs===ns-1){for(is in ts)ts.hasOwnProperty(is)&&(as[is]=ts[is]);return as}for(is in ts)ts.hasOwnProperty(is)&&(as[is]=ss(ts[is],rs+1,ns));return as},numeric.sdiag=function(ss){var ts,rs,ns=ss.length,is=Array(ns);for(ts=ns-1;ts>=1;ts-=2)rs=ts-1,is[ts]=[],is[ts][ts]=ss[ts],is[rs]=[],is[rs][rs]=ss[rs];return ts===0&&(is[0]=[],is[0][0]=ss[ts]),is},numeric.sidentity=function(ss){return numeric.sdiag(numeric.rep([ss],1))},numeric.stranspose=function(ss){var ts,rs,ns,is=[];for(ts in ss.length,ss)if(ss.hasOwnProperty(ts))for(rs in ns=ss[ts])ns.hasOwnProperty(rs)&&(typeof is[rs]!="object"&&(is[rs]=[]),is[rs][ts]=ns[rs]);return is},numeric.sLUP=function(ss,ts){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(ss,ts){var rs=ss.length;ts.length;var ns,is,as,os,ls,us,cs,ps=numeric.stranspose(ts),ds=ps.length,fs=Array(rs);for(as=rs-1;as>=0;as--){for(cs=[],ns=ss[as],ls=ds-1;ls>=0;ls--){for(os in us=0,is=ps[ls],ns)ns.hasOwnProperty(os)&&os in is&&(us+=ns[os]*is[os]);us&&(cs[ls]=us)}fs[as]=cs}return fs},numeric.sdotMV=function(ss,ts){var rs,ns,is,as,os=ss.length,ls=Array(os);for(ns=os-1;ns>=0;ns--){for(is in as=0,rs=ss[ns])rs.hasOwnProperty(is)&&ts[is]&&(as+=rs[is]*ts[is]);as&&(ls[ns]=as)}return ls},numeric.sdotVM=function(ss,ts){var rs,ns,is,as,os=[];for(rs in ss)if(ss.hasOwnProperty(rs))for(ns in is=ts[rs],as=ss[rs],is)is.hasOwnProperty(ns)&&(os[ns]||(os[ns]=0),os[ns]+=as*is[ns]);return os},numeric.sdotVV=function(ss,ts){var rs,ns=0;for(rs in ss)ss[rs]&&ts[rs]&&(ns+=ss[rs]*ts[rs]);return ns},numeric.sdot=function(ss,ts){var rs=numeric.sdim(ss).length,ns=numeric.sdim(ts).length;switch(1e3*rs+ns){case 0:return ss*ts;case 1001:return numeric.sdotVV(ss,ts);case 2001:return numeric.sdotMV(ss,ts);case 1002:return numeric.sdotVM(ss,ts);case 2002:return numeric.sdotMM(ss,ts);default:throw new Error("numeric.sdot not implemented for tensors of order "+rs+" and "+ns)}},numeric.sscatter=function(ss){var ts,rs,ns,is,as=ss[0].length,os=ss.length,ls=[];for(rs=as-1;rs>=0;--rs)if(ss[os-1][rs]){for(is=ls,ns=0;ns<os-2;ns++)is[ts=ss[ns][rs]]||(is[ts]=[]),is=is[ts];is[ss[ns][rs]]=ss[ns+1][rs]}return ls},numeric.sgather=function ss(ts,rs,ns){var is,as,os;for(as in rs===void 0&&(rs=[]),ns===void 0&&(ns=[]),is=ns.length,ts)if(ts.hasOwnProperty(as))if(ns[is]=parseInt(as),typeof(os=ts[as])=="number"){if(os){if(rs.length===0)for(as=is+1;as>=0;--as)rs[as]=[];for(as=is;as>=0;--as)rs[as].push(ns[as]);rs[is+1].push(os)}}else ss(os,rs,ns);return ns.length>is&&ns.pop(),rs},numeric.cLU=function(ss){var ts,rs,ns,is,as,os,ls=ss[0],us=ss[1],cs=ss[2],ps=ls.length,ds=0;for(ts=0;ts<ps;ts++)ls[ts]>ds&&(ds=ls[ts]);ds++;var fs,hs=Array(ds),ys=Array(ds),gs=numeric.rep([ds],1/0),bs=numeric.rep([ds],-1/0);for(ns=0;ns<ps;ns++)ts=ls[ns],(rs=us[ns])<gs[ts]&&(gs[ts]=rs),rs>bs[ts]&&(bs[ts]=rs);for(ts=0;ts<ds-1;ts++)bs[ts]>bs[ts+1]&&(bs[ts+1]=bs[ts]);for(ts=ds-1;ts>=1;ts--)gs[ts]<gs[ts-1]&&(gs[ts-1]=gs[ts]);for(ts=0;ts<ds;ts++)ys[ts]=numeric.rep([bs[ts]-gs[ts]+1],0),hs[ts]=numeric.rep([ts-gs[ts]],0),ts-gs[ts]+1,bs[ts]-ts+1;for(ns=0;ns<ps;ns++)ys[ts=ls[ns]][us[ns]-gs[ts]]=cs[ns];for(ts=0;ts<ds-1;ts++)for(is=ts-gs[ts],Ts=ys[ts],rs=ts+1;gs[rs]<=ts&&rs<ds;rs++)if(as=ts-gs[rs],os=bs[ts]-ts,fs=(Cs=ys[rs])[as]/Ts[is]){for(ns=1;ns<=os;ns++)Cs[ns+as]-=fs*Ts[ns+is];hs[rs][ts-gs[rs]]=fs}var vs,Ns,Ts=[],Cs=[],xs=[],As=[],ws=[],Es=[];for(ps=0,vs=0,ts=0;ts<ds;ts++){for(is=gs[ts],as=bs[ts],Ns=ys[ts],rs=ts;rs<=as;rs++)Ns[rs-is]&&(Ts[ps]=ts,Cs[ps]=rs,xs[ps]=Ns[rs-is],ps++);for(Ns=hs[ts],rs=is;rs<ts;rs++)Ns[rs-is]&&(As[vs]=ts,ws[vs]=rs,Es[vs]=Ns[rs-is],vs++);As[vs]=ts,ws[vs]=ts,Es[vs]=1,vs++}return{U:[Ts,Cs,xs],L:[As,ws,Es]}},numeric.cLUsolve=function(ss,ts){var rs=ss.L,ns=ss.U,is=numeric.clone(ts),as=rs[0],os=rs[1],ls=rs[2],us=ns[0],cs=ns[1],ps=ns[2],ds=us.length;as.length;var fs,hs,ys=is.length;for(hs=0,fs=0;fs<ys;fs++){for(;os[hs]<fs;)is[fs]-=ls[hs]*is[os[hs]],hs++;hs++}for(hs=ds-1,fs=ys-1;fs>=0;fs--){for(;cs[hs]>fs;)is[fs]-=ps[hs]*is[cs[hs]],hs--;is[fs]/=ps[hs],hs--}return is},numeric.cgrid=function(ss,ts){typeof ss=="number"&&(ss=[ss,ss]);var rs,ns,is,as=numeric.rep(ss,-1);for(typeof ts!="function"&&(ts==="L"?ts=function(os,ls){return os>=ss[0]/2||ls<ss[1]/2}:ts=function(os,ls){return!0}),is=0,rs=1;rs<ss[0]-1;rs++)for(ns=1;ns<ss[1]-1;ns++)ts(rs,ns)&&(as[rs][ns]=is,is++);return as},numeric.cdelsq=function(ss){var ts,rs,ns,is,as,os=[[-1,0],[0,-1],[0,1],[1,0]],ls=numeric.dim(ss),us=ls[0],cs=ls[1],ps=[],ds=[],fs=[];for(ts=1;ts<us-1;ts++)for(rs=1;rs<cs-1;rs++)if(!(ss[ts][rs]<0)){for(ns=0;ns<4;ns++)is=ts+os[ns][0],as=rs+os[ns][1],ss[is][as]<0||(ps.push(ss[ts][rs]),ds.push(ss[is][as]),fs.push(-1));ps.push(ss[ts][rs]),ds.push(ss[ts][rs]),fs.push(4)}return[ps,ds,fs]},numeric.cdotMV=function(ss,ts){var rs,ns,is,as=ss[0],os=ss[1],ls=ss[2],us=as.length;for(is=0,ns=0;ns<us;ns++)as[ns]>is&&(is=as[ns]);for(is++,rs=numeric.rep([is],0),ns=0;ns<us;ns++)rs[as[ns]]+=ls[ns]*ts[os[ns]];return rs},numeric.Spline=function(ss,ts,rs,ns,is){this.x=ss,this.yl=ts,this.yr=rs,this.kl=ns,this.kr=is},numeric.Spline.prototype._at=function(ss,ts){var rs,ns,is,as=this.x,os=this.yl,ls=this.yr,us=this.kl,cs=this.kr,ps=numeric.add,ds=numeric.sub,fs=numeric.mul;rs=ds(fs(us[ts],as[ts+1]-as[ts]),ds(ls[ts+1],os[ts])),ns=ps(fs(cs[ts+1],as[ts]-as[ts+1]),ds(ls[ts+1],os[ts]));var hs=(is=(ss-as[ts])/(as[ts+1]-as[ts]))*(1-is);return ps(ps(ps(fs(1-is,os[ts]),fs(is,ls[ts+1])),fs(rs,hs*(1-is))),fs(ns,hs*is))},numeric.Spline.prototype.at=function(ss){if(typeof ss=="number"){var ts,rs,ns,is=this.x,as=is.length,os=Math.floor;for(ts=0,rs=as-1;rs-ts>1;)is[ns=os((ts+rs)/2)]<=ss?ts=ns:rs=ns;return this._at(ss,ts)}as=ss.length;var ls,us=Array(as);for(ls=as-1;ls!==-1;--ls)us[ls]=this.at(ss[ls]);return us},numeric.Spline.prototype.diff=function(){var ss,ts,rs,ns=this.x,is=this.yl,as=this.yr,os=this.kl,ls=this.kr,us=is.length,cs=os,ps=ls,ds=Array(us),fs=Array(us),hs=numeric.add,ys=numeric.mul,gs=numeric.div,bs=numeric.sub;for(ss=us-1;ss!==-1;--ss)ts=ns[ss+1]-ns[ss],rs=bs(as[ss+1],is[ss]),ds[ss]=gs(hs(ys(rs,6),ys(os[ss],-4*ts),ys(ls[ss+1],-2*ts)),ts*ts),fs[ss+1]=gs(hs(ys(rs,-6),ys(os[ss],2*ts),ys(ls[ss+1],4*ts)),ts*ts);return new numeric.Spline(ns,cs,ps,ds,fs)},numeric.Spline.prototype.roots=function(){function ss(_s){return _s*_s}var ts=[],rs=this.x,ns=this.yl,is=this.yr,as=this.kl,os=this.kr;typeof ns[0]=="number"&&(ns=[ns],is=[is],as=[as],os=[os]);var ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds,Vs,Is,Os,Ps=ns.length,$s=rs.length-1,Rs=(ts=Array(Ps),Math.sqrt);for(ls=0;ls!==Ps;++ls){for(ps=ns[ls],ds=is[ls],fs=as[ls],hs=os[ls],ys=[],us=0;us!==$s;us++){for(us>0&&ds[us]*ps[us]<0&&ys.push(rs[us]),As=rs[us+1]-rs[us],rs[us],vs=ps[us],Ns=ds[us+1],gs=fs[us]/As,Ts=(bs=hs[us+1]/As)+3*vs+2*gs-3*Ns,Cs=3*(bs+gs+2*(vs-Ns)),(xs=ss(gs-bs+3*(vs-Ns))+12*bs*vs)<=0?ws=(Es=Ts/Cs)>rs[us]&&Es<rs[us+1]?[rs[us],Es,rs[us+1]]:[rs[us],rs[us+1]]:(Es=(Ts-Rs(xs))/Cs,Ss=(Ts+Rs(xs))/Cs,ws=[rs[us]],Es>rs[us]&&Es<rs[us+1]&&ws.push(Es),Ss>rs[us]&&Ss<rs[us+1]&&ws.push(Ss),ws.push(rs[us+1])),Vs=ws[0],Es=this._at(Vs,us),cs=0;cs<ws.length-1;cs++)if(Is=ws[cs+1],Ss=this._at(Is,us),Es!==0)if(Ss===0||Es*Ss>0)Vs=Is,Es=Ss;else{for(var ks=0;!((Os=(Es*Is-Ss*Vs)/(Es-Ss))<=Vs||Os>=Is);)if((Ds=this._at(Os,us))*Ss>0)Is=Os,Ss=Ds,ks===-1&&(Es*=.5),ks=-1;else{if(!(Ds*Es>0))break;Vs=Os,Es=Ds,ks===1&&(Ss*=.5),ks=1}ys.push(Os),Vs=ws[cs+1],Es=this._at(Vs,us)}else ys.push(Vs),Vs=Is,Es=Ss;Ss===0&&ys.push(Is)}ts[ls]=ys}return typeof this.yl[0]=="number"?ts[0]:ts},numeric.spline=function(ss,ts,rs,ns){var is,as=ss.length,os=[],ls=[],us=[],cs=numeric.sub,ps=numeric.mul,ds=numeric.add;for(is=as-2;is>=0;is--)ls[is]=ss[is+1]-ss[is],us[is]=cs(ts[is+1],ts[is]);typeof rs!="string"&&typeof ns!="string"||(rs=ns="periodic");var fs=[[],[],[]];switch(typeof rs){case"undefined":os[0]=ps(3/(ls[0]*ls[0]),us[0]),fs[0].push(0,0),fs[1].push(0,1),fs[2].push(2/ls[0],1/ls[0]);break;case"string":os[0]=ds(ps(3/(ls[as-2]*ls[as-2]),us[as-2]),ps(3/(ls[0]*ls[0]),us[0])),fs[0].push(0,0,0),fs[1].push(as-2,0,1),fs[2].push(1/ls[as-2],2/ls[as-2]+2/ls[0],1/ls[0]);break;default:os[0]=rs,fs[0].push(0),fs[1].push(0),fs[2].push(1)}for(is=1;is<as-1;is++)os[is]=ds(ps(3/(ls[is-1]*ls[is-1]),us[is-1]),ps(3/(ls[is]*ls[is]),us[is])),fs[0].push(is,is,is),fs[1].push(is-1,is,is+1),fs[2].push(1/ls[is-1],2/ls[is-1]+2/ls[is],1/ls[is]);switch(typeof ns){case"undefined":os[as-1]=ps(3/(ls[as-2]*ls[as-2]),us[as-2]),fs[0].push(as-1,as-1),fs[1].push(as-2,as-1),fs[2].push(1/ls[as-2],2/ls[as-2]);break;case"string":fs[1][fs[1].length-1]=0;break;default:os[as-1]=ns,fs[0].push(as-1),fs[1].push(as-1),fs[2].push(1)}os=typeof os[0]!="number"?numeric.transpose(os):[os];var hs=Array(os.length);if(typeof rs=="string")for(is=hs.length-1;is!==-1;--is)hs[is]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(fs)),os[is]),hs[is][as-1]=hs[is][0];else for(is=hs.length-1;is!==-1;--is)hs[is]=numeric.cLUsolve(numeric.cLU(fs),os[is]);return hs=typeof ts[0]=="number"?hs[0]:numeric.transpose(hs),new numeric.Spline(ss,ts,ts,hs,hs)},numeric.fftpow2=function ss(ts,rs){var ns=ts.length;if(ns!==1){var is,as,os=Math.cos,ls=Math.sin,us=Array(ns/2),cs=Array(ns/2),ps=Array(ns/2),ds=Array(ns/2);for(as=ns/2,is=ns-1;is!==-1;--is)ps[--as]=ts[is],ds[as]=rs[is],--is,us[as]=ts[is],cs[as]=rs[is];ss(us,cs),ss(ps,ds),as=ns/2;var fs,hs,ys,gs=-6.283185307179586/ns;for(is=ns-1;is!==-1;--is)--as===-1&&(as=ns/2-1),hs=os(fs=gs*is),ys=ls(fs),ts[is]=us[as]+hs*ps[as]-ys*ds[as],rs[is]=cs[as]+hs*ds[as]+ys*ps[as]}},numeric._ifftpow2=function ss(ts,rs){var ns=ts.length;if(ns!==1){var is,as,os=Math.cos,ls=Math.sin,us=Array(ns/2),cs=Array(ns/2),ps=Array(ns/2),ds=Array(ns/2);for(as=ns/2,is=ns-1;is!==-1;--is)ps[--as]=ts[is],ds[as]=rs[is],--is,us[as]=ts[is],cs[as]=rs[is];ss(us,cs),ss(ps,ds),as=ns/2;var fs,hs,ys,gs=6.283185307179586/ns;for(is=ns-1;is!==-1;--is)--as===-1&&(as=ns/2-1),hs=os(fs=gs*is),ys=ls(fs),ts[is]=us[as]+hs*ps[as]-ys*ds[as],rs[is]=cs[as]+hs*ds[as]+ys*ps[as]}},numeric.ifftpow2=function(ss,ts){numeric._ifftpow2(ss,ts),numeric.diveq(ss,ss.length),numeric.diveq(ts,ts.length)},numeric.convpow2=function(ss,ts,rs,ns){var is,as,os,ls,us;for(numeric.fftpow2(ss,ts),numeric.fftpow2(rs,ns),is=ss.length-1;is!==-1;--is)as=ss[is],ls=ts[is],os=rs[is],us=ns[is],ss[is]=as*os-ls*us,ts[is]=as*us+ls*os;numeric.ifftpow2(ss,ts)},numeric.T.prototype.fft=function(){var ss,ts,rs=this.x,ns=this.y,is=rs.length,as=Math.log,os=as(2),ls=Math.ceil(as(2*is-1)/os),us=Math.pow(2,ls),cs=numeric.rep([us],0),ps=numeric.rep([us],0),ds=Math.cos,fs=Math.sin,hs=-3.141592653589793/is,ys=numeric.rep([us],0),gs=numeric.rep([us],0);for(ss=0;ss<is;ss++)ys[ss]=rs[ss];if(ns!==void 0)for(ss=0;ss<is;ss++)gs[ss]=ns[ss];for(cs[0]=1,ss=1;ss<=us/2;ss++)ts=hs*ss*ss,cs[ss]=ds(ts),ps[ss]=fs(ts),cs[us-ss]=ds(ts),ps[us-ss]=fs(ts);var bs=new numeric.T(ys,gs),vs=new numeric.T(cs,ps);return bs=bs.mul(vs),numeric.convpow2(bs.x,bs.y,numeric.clone(vs.x),numeric.neg(vs.y)),(bs=bs.mul(vs)).x.length=is,bs.y.length=is,bs},numeric.T.prototype.ifft=function(){var ss,ts,rs=this.x,ns=this.y,is=rs.length,as=Math.log,os=as(2),ls=Math.ceil(as(2*is-1)/os),us=Math.pow(2,ls),cs=numeric.rep([us],0),ps=numeric.rep([us],0),ds=Math.cos,fs=Math.sin,hs=3.141592653589793/is,ys=numeric.rep([us],0),gs=numeric.rep([us],0);for(ss=0;ss<is;ss++)ys[ss]=rs[ss];if(ns!==void 0)for(ss=0;ss<is;ss++)gs[ss]=ns[ss];for(cs[0]=1,ss=1;ss<=us/2;ss++)ts=hs*ss*ss,cs[ss]=ds(ts),ps[ss]=fs(ts),cs[us-ss]=ds(ts),ps[us-ss]=fs(ts);var bs=new numeric.T(ys,gs),vs=new numeric.T(cs,ps);return bs=bs.mul(vs),numeric.convpow2(bs.x,bs.y,numeric.clone(vs.x),numeric.neg(vs.y)),(bs=bs.mul(vs)).x.length=is,bs.y.length=is,bs.div(is)},numeric.gradient=function(ss,ts){var rs=ts.length,ns=ss(ts);if(isNaN(ns))throw new Error("gradient: f(x) is a NaN!");var is,as,os,ls=Math.max,us=numeric.clone(ts),cs=Array(rs);numeric.div,numeric.sub,ls=Math.max;var ps,ds,fs,hs,ys,gs,bs=Math.abs,vs=Math.min,Ns=0;for(is=0;is<rs;is++)for(var Ts=ls(1e-6*ns,1e-8);;){if(++Ns>20)throw new Error("Numerical gradient fails");if(us[is]=ts[is]+Ts,as=ss(us),us[is]=ts[is]-Ts,os=ss(us),us[is]=ts[is],isNaN(as)||isNaN(os))Ts/=16;else{if(cs[is]=(as-os)/(2*Ts),ps=ts[is]-Ts,ds=ts[is],fs=ts[is]+Ts,hs=(as-ns)/Ts,ys=(ns-os)/Ts,gs=ls(bs(cs[is]),bs(ns),bs(as),bs(os),bs(ps),bs(ds),bs(fs),1e-8),!(vs(ls(bs(hs-cs[is]),bs(ys-cs[is]),bs(hs-ys))/gs,Ts/gs)>.001))break;Ts/=16}}return cs},numeric.uncmin=function(ss,ts,rs,ns,is,as,os){var ls=numeric.gradient;os===void 0&&(os={}),rs===void 0&&(rs=1e-8),ns===void 0&&(ns=function(Us){return ls(ss,Us)}),is===void 0&&(is=1e3);var us,cs,ps=(ts=numeric.clone(ts)).length,ds=ss(ts);if(isNaN(ds))throw new Error("uncmin: f(x0) is a NaN!");var fs=Math.max,hs=numeric.norm2;rs=fs(rs,numeric.epsilon);var ys,gs,bs,vs=os.Hinv||numeric.identity(ps),Ns=numeric.dot;numeric.inv;var Ts,Cs,xs,As,ws,Es,Ss,Ds=numeric.sub,Vs=numeric.add,Is=numeric.tensor,Os=numeric.div,Ps=numeric.mul,$s=numeric.all,Rs=numeric.isFinite,ks=numeric.neg,_s=0,Bs="";for(gs=ns(ts);_s<is;){if(typeof as=="function"&&as(_s,ts,ds,gs,vs)){Bs="Callback returned true";break}if(!$s(Rs(gs))){Bs="Gradient has Infinity or NaN";break}if(!$s(Rs(ys=ks(Ns(vs,gs))))){Bs="Search direction has Infinity or NaN";break}if((Ss=hs(ys))<rs){Bs="Newton step smaller than tol";break}for(Es=1,cs=Ns(gs,ys),Cs=ts;_s<is&&!(Es*Ss<rs)&&(Cs=Vs(ts,Ts=Ps(ys,Es)),(us=ss(Cs))-ds>=.1*Es*cs||isNaN(us));)Es*=.5,++_s;if(Es*Ss<rs){Bs="Line search step size smaller than tol";break}if(_s===is){Bs="maxit reached during line search";break}ws=Ns(xs=Ds(bs=ns(Cs),gs),Ts),As=Ns(vs,xs),vs=Ds(Vs(vs,Ps((ws+Ns(xs,As))/(ws*ws),Is(Ts,Ts))),Os(Vs(Is(As,Ts),Is(Ts,As)),ws)),ts=Cs,ds=us,gs=bs,++_s}return{solution:ts,f:ds,gradient:gs,invHessian:vs,iterations:_s,message:Bs}},numeric.Dopri=function(ss,ts,rs,ns,is,as,os){this.x=ss,this.y=ts,this.f=rs,this.ymid=ns,this.iterations=is,this.events=os,this.message=as},numeric.Dopri.prototype._at=function(ss,ts){function rs(Cs){return Cs*Cs}var ns,is,as,os,ls,us,cs=this,ps=cs.x,ds=cs.y,fs=cs.f,hs=cs.ymid;ps.length;var ys,gs,bs,vs=numeric.add,Ns=numeric.mul,Ts=numeric.sub;return ns=ps[ts],is=ps[ts+1],os=ds[ts],ls=ds[ts+1],as=ns+.5*(is-ns),us=hs[ts],ys=Ts(fs[ts],Ns(os,1/(ns-as)+2/(ns-is))),gs=Ts(fs[ts+1],Ns(ls,1/(is-as)+2/(is-ns))),vs(vs(vs(vs(Ns(os,(bs=[rs(ss-is)*(ss-as)/rs(ns-is)/(ns-as),rs(ss-ns)*rs(ss-is)/rs(ns-as)/rs(is-as),rs(ss-ns)*(ss-as)/rs(is-ns)/(is-as),(ss-ns)*rs(ss-is)*(ss-as)/rs(ns-is)/(ns-as),(ss-is)*rs(ss-ns)*(ss-as)/rs(ns-is)/(is-as)])[0]),Ns(us,bs[1])),Ns(ls,bs[2])),Ns(ys,bs[3])),Ns(gs,bs[4]))},numeric.Dopri.prototype.at=function(ss){var ts,rs,ns,is=Math.floor;if(typeof ss!="number"){var as=ss.length,os=Array(as);for(ts=as-1;ts!==-1;--ts)os[ts]=this.at(ss[ts]);return os}var ls=this.x;for(ts=0,rs=ls.length-1;rs-ts>1;)ls[ns=is(.5*(ts+rs))]<=ss?ts=ns:rs=ns;return this._at(ss,ts)},numeric.dopri=function(ss,ts,rs,ns,is,as,os){is===void 0&&(is=1e-6),as===void 0&&(as=1e3);var ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts,Cs=[ss],xs=[rs],As=[ns(ss,rs)],ws=[],Es=[3/40,9/40],Ss=[44/45,-56/15,32/9],Ds=[19372/6561,-25360/2187,64448/6561,-212/729],Vs=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],Is=[35/384,0,500/1113,125/192,-2187/6784,11/84],Os=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,56185495e-1/235043384],Ps=[.2,.3,.8,8/9,1,1],$s=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],Rs=0,ks=(ts-ss)/10,_s=0,Bs=numeric.add,Us=numeric.mul,zs=Math.min,Hs=Math.abs,el=numeric.norminf,Ys=Math.pow,il=numeric.any,al=numeric.lt,ll=numeric.and;numeric.sub;var nl=new numeric.Dopri(Cs,xs,As,ws,-1,"");for(typeof os=="function"&&(vs=os(ss,rs));ss<ts&&_s<as;)if(++_s,ss+ks>ts&&(ks=ts-ss),ls=ns(ss+Ps[0]*ks,Bs(rs,Us(.2*ks,As[Rs]))),us=ns(ss+Ps[1]*ks,Bs(Bs(rs,Us(Es[0]*ks,As[Rs])),Us(Es[1]*ks,ls))),cs=ns(ss+Ps[2]*ks,Bs(Bs(Bs(rs,Us(Ss[0]*ks,As[Rs])),Us(Ss[1]*ks,ls)),Us(Ss[2]*ks,us))),ps=ns(ss+Ps[3]*ks,Bs(Bs(Bs(Bs(rs,Us(Ds[0]*ks,As[Rs])),Us(Ds[1]*ks,ls)),Us(Ds[2]*ks,us)),Us(Ds[3]*ks,cs))),ds=ns(ss+Ps[4]*ks,Bs(Bs(Bs(Bs(Bs(rs,Us(Vs[0]*ks,As[Rs])),Us(Vs[1]*ks,ls)),Us(Vs[2]*ks,us)),Us(Vs[3]*ks,cs)),Us(Vs[4]*ks,ps))),fs=ns(ss+ks,gs=Bs(Bs(Bs(Bs(Bs(rs,Us(As[Rs],ks*Is[0])),Us(us,ks*Is[2])),Us(cs,ks*Is[3])),Us(ps,ks*Is[4])),Us(ds,ks*Is[5]))),(bs=typeof(hs=Bs(Bs(Bs(Bs(Bs(Us(As[Rs],ks*$s[0]),Us(us,ks*$s[2])),Us(cs,ks*$s[3])),Us(ps,ks*$s[4])),Us(ds,ks*$s[5])),Us(fs,ks*$s[6])))=="number"?Hs(hs):el(hs))>is){if(ss+(ks=.2*ks*Ys(is/bs,.25))===ss){nl.msg="Step size became too small";break}}else{if(ws[Rs]=Bs(Bs(Bs(Bs(Bs(Bs(rs,Us(As[Rs],ks*Os[0])),Us(us,ks*Os[2])),Us(cs,ks*Os[3])),Us(ps,ks*Os[4])),Us(ds,ks*Os[5])),Us(fs,ks*Os[6])),Cs[++Rs]=ss+ks,xs[Rs]=gs,As[Rs]=fs,typeof os=="function"){var cl,dl,sl=ss,js=ss+.5*ks;if(Ns=os(js,ws[Rs-1]),il(Ts=ll(al(vs,0),al(0,Ns)))||(sl=js,vs=Ns,Ns=os(js=ss+ks,gs),Ts=ll(al(vs,0),al(0,Ns))),il(Ts)){for(var Ls,Ws,Zs=0,tl=1,rl=1;;){if(typeof vs=="number")dl=(rl*Ns*sl-tl*vs*js)/(rl*Ns-tl*vs);else for(dl=js,ys=vs.length-1;ys!==-1;--ys)vs[ys]<0&&Ns[ys]>0&&(dl=zs(dl,(rl*Ns[ys]*sl-tl*vs[ys]*js)/(rl*Ns[ys]-tl*vs[ys])));if(dl<=sl||dl>=js)break;Ws=os(dl,cl=nl._at(dl,Rs-1)),il(Ls=ll(al(vs,0),al(0,Ws)))?(js=dl,Ns=Ws,Ts=Ls,rl=1,Zs===-1?tl*=.5:tl=1,Zs=-1):(sl=dl,vs=Ws,tl=1,Zs===1?rl*=.5:rl=1,Zs=1)}return gs=nl._at(.5*(ss+dl),Rs-1),nl.f[Rs]=ns(dl,cl),nl.x[Rs]=dl,nl.y[Rs]=cl,nl.ymid[Rs-1]=gs,nl.events=Ts,nl.iterations=_s,nl}}ss+=ks,rs=gs,vs=Ns,ks=zs(.8*ks*Ys(is/bs,.25),4*ks)}return nl.iterations=_s,nl},numeric.LU=function(ss,ts){ts=ts||!1;var rs,ns,is,as,os,ls,us,cs,ps,ds=Math.abs,fs=ss.length,hs=fs-1,ys=new Array(fs);for(ts||(ss=numeric.clone(ss)),is=0;is<fs;++is){for(us=is,ps=ds((ls=ss[is])[is]),ns=is+1;ns<fs;++ns)ps<(as=ds(ss[ns][is]))&&(ps=as,us=ns);for(ys[is]=us,us!=is&&(ss[is]=ss[us],ss[us]=ls,ls=ss[is]),os=ls[is],rs=is+1;rs<fs;++rs)ss[rs][is]/=os;for(rs=is+1;rs<fs;++rs){for(cs=ss[rs],ns=is+1;ns<hs;++ns)cs[ns]-=cs[is]*ls[ns],cs[++ns]-=cs[is]*ls[ns];ns===hs&&(cs[ns]-=cs[is]*ls[ns])}}return{LU:ss,P:ys}},numeric.LUsolve=function(ss,ts){var rs,ns,is,as,os,ls=ss.LU,us=ls.length,cs=numeric.clone(ts),ps=ss.P;for(rs=us-1;rs!==-1;--rs)cs[rs]=ts[rs];for(rs=0;rs<us;++rs)for(is=ps[rs],ps[rs]!==rs&&(os=cs[rs],cs[rs]=cs[is],cs[is]=os),as=ls[rs],ns=0;ns<rs;++ns)cs[rs]-=cs[ns]*as[ns];for(rs=us-1;rs>=0;--rs){for(as=ls[rs],ns=rs+1;ns<us;++ns)cs[rs]-=cs[ns]*as[ns];cs[rs]/=as[rs]}return cs},numeric.solve=function(ss,ts,rs){return numeric.LUsolve(numeric.LU(ss,rs),ts)},numeric.echelonize=function(ss){var ts,rs,ns,is,as,os,ls,us,cs=numeric.dim(ss),ps=cs[0],ds=cs[1],fs=numeric.identity(ps),hs=Array(ps),ys=Math.abs,gs=numeric.diveq;for(ss=numeric.clone(ss),ts=0;ts<ps;++ts){for(ns=0,as=ss[ts],os=fs[ts],rs=1;rs<ds;++rs)ys(as[ns])<ys(as[rs])&&(ns=rs);for(hs[ts]=ns,gs(os,as[ns]),gs(as,as[ns]),rs=0;rs<ps;++rs)if(rs!==ts){for(us=(ls=ss[rs])[ns],is=ds-1;is!==-1;--is)ls[is]-=as[is]*us;for(ls=fs[rs],is=ps-1;is!==-1;--is)ls[is]-=os[is]*us}}return{I:fs,A:ss,P:hs}},numeric.__solveLP=function(ss,ts,rs,ns,is,as,os){var ls=numeric.sum;numeric.log;var us,cs=numeric.mul,ps=numeric.sub,ds=numeric.dot,fs=numeric.div,hs=numeric.add,ys=ss.length,gs=rs.length,bs=!1,vs=1;numeric.transpose(ts),numeric.svd;var Ns=numeric.transpose;numeric.leq;var Ts=Math.sqrt,Cs=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var xs,As=Math.min,ws=numeric.all,Es=numeric.gt,Ss=Array(ys),Ds=Array(gs);numeric.rep([gs],1);var Vs,Is,Os=numeric.solve,Ps=ps(rs,ds(ts,as)),$s=ds(ss,ss);for(Vs=0;Vs<is;++Vs){var Rs,ks;for(Rs=gs-1;Rs!==-1;--Rs)Ds[Rs]=fs(ts[Rs],Ps[Rs]);var _s=Ns(Ds);for(Rs=ys-1;Rs!==-1;--Rs)Ss[Rs]=ls(_s[Rs]);vs=.25*Cs($s/ds(ss,Ss));var Bs=100*Ts($s/ds(Ss,Ss));for((!isFinite(vs)||vs>Bs)&&(vs=Bs),Is=hs(ss,cs(vs,Ss)),xs=ds(_s,Ds),Rs=ys-1;Rs!==-1;--Rs)xs[Rs][Rs]+=1;ks=Os(xs,fs(Is,vs),!0);var Us=fs(Ps,ds(ts,ks)),zs=1;for(Rs=gs-1;Rs!==-1;--Rs)Us[Rs]<0&&(zs=As(zs,-.999*Us[Rs]));if(us=ps(as,cs(ks,zs)),!ws(Es(Ps=ps(rs,ds(ts,us)),0)))return{solution:as,message:"",iterations:Vs};if(as=us,vs<ns)return{solution:us,message:"",iterations:Vs};if(os){var Hs=ds(ss,Is),el=ds(ts,Is);for(bs=!0,Rs=gs-1;Rs!==-1;--Rs)if(Hs*el[Rs]<0){bs=!1;break}}else bs=!(as[ys-1]>=0);if(bs)return{solution:us,message:"Unbounded",iterations:Vs}}return{solution:as,message:"maximum iteration count exceeded",iterations:Vs}},numeric._solveLP=function(ss,ts,rs,ns,is){var as=ss.length,os=rs.length;numeric.sum,numeric.log,numeric.mul;var ls=numeric.sub,us=numeric.dot;numeric.div,numeric.add;var cs=numeric.rep([as],0).concat([1]),ps=numeric.rep([os,1],-1),ds=numeric.blockMatrix([[ts,ps]]),fs=rs,hs=numeric.rep([as],0).concat(Math.max(0,numeric.sup(numeric.neg(rs)))+1),ys=numeric.__solveLP(cs,ds,fs,ns,is,hs,!1),gs=numeric.clone(ys.solution);if(gs.length=as,numeric.inf(ls(rs,us(ts,gs)))<0)return{solution:NaN,message:"Infeasible",iterations:ys.iterations};var bs=numeric.__solveLP(ss,ts,rs,ns,is-ys.iterations,gs,!0);return bs.iterations+=ys.iterations,bs},numeric.solveLP=function(ss,ts,rs,ns,is,as,os){if(os===void 0&&(os=1e3),as===void 0&&(as=numeric.epsilon),ns===void 0)return numeric._solveLP(ss,ts,rs,as,os);var ls,us=ns.length,cs=ns[0].length,ps=ts.length,ds=numeric.echelonize(ns),fs=numeric.rep([cs],0),hs=ds.P,ys=[];for(ls=hs.length-1;ls!==-1;--ls)fs[hs[ls]]=1;for(ls=cs-1;ls!==-1;--ls)fs[ls]===0&&ys.push(ls);var gs=numeric.getRange,bs=numeric.linspace(0,us-1),vs=numeric.linspace(0,ps-1),Ns=gs(ns,bs,ys),Ts=gs(ts,vs,hs),Cs=gs(ts,vs,ys),xs=numeric.dot,As=numeric.sub,ws=xs(Ts,ds.I),Es=As(Cs,xs(ws,Ns)),Ss=As(rs,xs(ws,is)),Ds=Array(hs.length),Vs=Array(ys.length);for(ls=hs.length-1;ls!==-1;--ls)Ds[ls]=ss[hs[ls]];for(ls=ys.length-1;ls!==-1;--ls)Vs[ls]=ss[ys[ls]];var Is=As(Vs,xs(Ds,xs(ds.I,Ns))),Os=numeric._solveLP(Is,Es,Ss,as,os),Ps=Os.solution;if(Ps!=Ps)return Os;var $s=xs(ds.I,As(is,xs(Ns,Ps))),Rs=Array(ss.length);for(ls=hs.length-1;ls!==-1;--ls)Rs[hs[ls]]=$s[ls];for(ls=ys.length-1;ls!==-1;--ls)Rs[ys[ls]]=Ps[ls];return{solution:Rs,message:Os.message,iterations:Os.iterations}},numeric.MPStoLP=function(ss){ss instanceof String&&ss.split(`
`);var ts,rs,ns,is,as=0,os=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],ls=ss.length,us=0,cs={},ps=[],ds=0,fs={},hs=0,ys=[],gs=[],bs=[];function vs(As){throw new Error("MPStoLP: "+As+`
Line `+ts+": "+ss[ts]+`
Current state: `+os[as]+`
`)}for(ts=0;ts<ls;++ts){var Ns=(ns=ss[ts]).match(/\S*/g),Ts=[];for(rs=0;rs<Ns.length;++rs)Ns[rs]!==""&&Ts.push(Ns[rs]);if(Ts.length!==0){for(rs=0;rs<os.length&&ns.substr(0,os[rs].length)!==os[rs];++rs);if(rs<os.length){if(as=rs,rs===1&&(is=Ts[1]),rs===6)return{name:is,c:ys,A:numeric.transpose(gs),b:bs,rows:cs,vars:fs}}else switch(as){case 0:case 1:vs("Unexpected line");case 2:switch(Ts[0]){case"N":us===0?us=Ts[1]:vs("Two or more N rows");break;case"L":cs[Ts[1]]=ds,ps[ds]=1,bs[ds]=0,++ds;break;case"G":cs[Ts[1]]=ds,ps[ds]=-1,bs[ds]=0,++ds;break;case"E":cs[Ts[1]]=ds,ps[ds]=0,bs[ds]=0,++ds;break;default:vs("Parse error "+numeric.prettyPrint(Ts))}break;case 3:fs.hasOwnProperty(Ts[0])||(fs[Ts[0]]=hs,ys[hs]=0,gs[hs]=numeric.rep([ds],0),++hs);var Cs=fs[Ts[0]];for(rs=1;rs<Ts.length;rs+=2)if(Ts[rs]!==us){var xs=cs[Ts[rs]];gs[Cs][xs]=(ps[xs]<0?-1:1)*parseFloat(Ts[rs+1])}else ys[Cs]=parseFloat(Ts[rs+1]);break;case 4:for(rs=1;rs<Ts.length;rs+=2)bs[cs[Ts[rs]]]=(ps[cs[Ts[rs]]]<0?-1:1)*parseFloat(Ts[rs+1]);break;case 5:break;case 6:vs("Internal error")}}}vs("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(ss,ts,rs,ns,is,as,os){function ls(ds){var fs,hs,ys=this,gs=ds.length,bs=0,vs=ys.i=ys.j=ys.m=0;for(ys.S=[],ys.c=[],gs||(ds=[gs++]);bs<rs;)ys.S[bs]=bs++;for(bs=0;bs<rs;bs++)vs=ps(vs+(fs=ys.S[bs])+ds[bs%gs]),hs=ys.S[vs],ys.S[bs]=hs,ys.S[vs]=fs;ys.g=function(Ns){var Ts=ys.S,Cs=ps(ys.i+1),xs=Ts[Cs],As=ps(ys.j+xs),ws=Ts[As];Ts[Cs]=ws,Ts[As]=xs;for(var Es=Ts[ps(xs+ws)];--Ns;)Cs=ps(Cs+1),ws=Ts[As=ps(As+(xs=Ts[Cs]))],Ts[Cs]=ws,Ts[As]=xs,Es=Es*rs+Ts[ps(xs+ws)];return ys.i=Cs,ys.j=As,Es},ys.g(rs)}function us(ds,fs,hs,ys,gs){if(hs=[],gs=typeof ds,fs&&gs=="object"){for(ys in ds)if(ys.indexOf("S")<5)try{hs.push(us(ds[ys],fs-1))}catch{}}return hs.length?hs:ds+(gs!="string"?"\0":"")}function cs(ds,fs,hs,ys){for(ds+="",hs=0,ys=0;ys<ds.length;ys++)fs[ps(ys)]=ps((hs^=19*fs[ps(ys)])+ds.charCodeAt(ys));for(ys in ds="",fs)ds+=String.fromCharCode(fs[ys]);return ds}function ps(ds){return ds&rs-1}ts.seedrandom=function(ds,fs){var hs,ys=[];return ds=cs(us(fs?[ds,ss]:arguments.length?ds:[new Date().getTime(),ss,window],3),ys),cs((hs=new ls(ys)).S,ss),ts.random=function(){for(var gs=hs.g(ns),bs=os,vs=0;gs<is;)gs=(gs+vs)*rs,bs*=rs,vs=hs.g(1);for(;gs>=as;)gs/=2,bs/=2,vs>>>=1;return(gs+vs)/bs},ds},os=ts.pow(rs,ns),is=ts.pow(2,is),as=2*is,cs(ts.random(),ss)}([],numeric.seedrandom,256,6,52),function(ss){function ts(is){if(typeof is!="object")return is;var as,os=[],ls=is.length;for(as=0;as<ls;as++)os[as+1]=ts(is[as]);return os}function rs(is){if(typeof is!="object")return is;var as,os=[],ls=is.length;for(as=1;as<ls;as++)os[as-1]=rs(is[as]);return os}function ns(is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns,Ts){var Cs,xs,As,ws,Es,Ss,Ds,Vs,Is,Os,Ps,$s,Rs,ks,_s,Bs,Us,zs,Hs,el,Ys,il,al,ll,nl,cl,dl;Rs=Math.min(ls,hs),As=2*ls+Rs*(Rs+5)/2+2*hs+1,ll=1e-60;do nl=1+.1*(ll+=ll),cl=1+.2*ll;while(nl<=1||cl<=1);for(Cs=1;Cs<=ls;Cs+=1)Ns[Cs]=as[Cs];for(Cs=ls+1;Cs<=As;Cs+=1)Ns[Cs]=0;for(Cs=1;Cs<=hs;Cs+=1)gs[Cs]=0;if(Es=[],Ts[1]===0){if(function(tl,rl,qs,Gs){var Xs,Ks,ol,Fs,Qs,Js;for(Ks=1;Ks<=qs;Ks+=1){if(Gs[1]=Ks,Js=0,(ol=Ks-1)<1){if((Js=tl[Ks][Ks]-Js)<=0)break;tl[Ks][Ks]=Math.sqrt(Js)}else{for(Fs=1;Fs<=ol;Fs+=1){for(Qs=tl[Fs][Ks],Xs=1;Xs<Fs;Xs+=1)Qs-=tl[Xs][Ks]*tl[Xs][Fs];Qs/=tl[Fs][Fs],tl[Fs][Ks]=Qs,Js+=Qs*Qs}if((Js=tl[Ks][Ks]-Js)<=0)break;tl[Ks][Ks]=Math.sqrt(Js)}Gs[1]=0}}(is,0,ls,Es),Es[1]!==0)return void(Ts[1]=2);(function(tl,rl,qs,Gs){var Xs,Ks,ol,Fs;for(Ks=1;Ks<=qs;Ks+=1){for(Fs=0,Xs=1;Xs<Ks;Xs+=1)Fs+=tl[Xs][Ks]*Gs[Xs];Gs[Ks]=(Gs[Ks]-Fs)/tl[Ks][Ks]}for(ol=1;ol<=qs;ol+=1)for(Gs[Ks=qs+1-ol]=Gs[Ks]/tl[Ks][Ks],Fs=-Gs[Ks],Xs=1;Xs<Ks;Xs+=1)Gs[Xs]=Gs[Xs]+Fs*tl[Xs][Ks]})(is,0,ls,as),function(tl,rl,qs){var Gs,Xs,Ks,ol,Fs;for(Ks=1;Ks<=qs;Ks+=1){for(tl[Ks][Ks]=1/tl[Ks][Ks],Fs=-tl[Ks][Ks],Gs=1;Gs<Ks;Gs+=1)tl[Gs][Ks]=Fs*tl[Gs][Ks];if(qs<(ol=Ks+1))break;for(Xs=ol;Xs<=qs;Xs+=1)for(Fs=tl[Ks][Xs],tl[Ks][Xs]=0,Gs=1;Gs<=Ks;Gs+=1)tl[Gs][Xs]=tl[Gs][Xs]+Fs*tl[Gs][Ks]}}(is,0,ls)}else{for(xs=1;xs<=ls;xs+=1)for(us[xs]=0,Cs=1;Cs<=xs;Cs+=1)us[xs]=us[xs]+is[Cs][xs]*as[Cs];for(xs=1;xs<=ls;xs+=1)for(as[xs]=0,Cs=xs;Cs<=ls;Cs+=1)as[xs]=as[xs]+is[xs][Cs]*us[Cs]}for(cs[1]=0,xs=1;xs<=ls;xs+=1)for(us[xs]=as[xs],cs[1]=cs[1]+Ns[xs]*us[xs],Ns[xs]=0,Cs=xs+1;Cs<=ls;Cs+=1)is[Cs][xs]=0;for(cs[1]=-cs[1]/2,Ts[1]=0,ks=(Os=(Is=(Ps=(Vs=(Ds=ls)+ls)+Rs)+Rs+1)+Rs*(Rs+1)/2)+hs,Cs=1;Cs<=hs;Cs+=1){for(Bs=0,xs=1;xs<=ls;xs+=1)Bs+=ps[xs][Cs]*ps[xs][Cs];Ns[ks+Cs]=Math.sqrt(Bs)}function sl(){for(vs[1]=vs[1]+1,As=Os,Cs=1;Cs<=hs;Cs+=1){for(As+=1,Bs=-ds[Cs],xs=1;xs<=ls;xs+=1)Bs+=ps[xs][Cs]*us[xs];if(Math.abs(Bs)<ll&&(Bs=0),Cs>ys)Ns[As]=Bs;else if(Ns[As]=-Math.abs(Bs),Bs>0){for(xs=1;xs<=ls;xs+=1)ps[xs][Cs]=-ps[xs][Cs];ds[Cs]=-ds[Cs]}}for(Cs=1;Cs<=bs;Cs+=1)Ns[Os+gs[Cs]]=0;for($s=0,_s=0,Cs=1;Cs<=hs;Cs+=1)Ns[Os+Cs]<_s*Ns[ks+Cs]&&($s=Cs,_s=Ns[Os+Cs]/Ns[ks+Cs]);return $s===0?999:0}function js(){for(Cs=1;Cs<=ls;Cs+=1){for(Bs=0,xs=1;xs<=ls;xs+=1)Bs+=is[xs][Cs]*ps[xs][$s];Ns[Cs]=Bs}for(ws=Ds,Cs=1;Cs<=ls;Cs+=1)Ns[ws+Cs]=0;for(xs=bs+1;xs<=ls;xs+=1)for(Cs=1;Cs<=ls;Cs+=1)Ns[ws+Cs]=Ns[ws+Cs]+is[Cs][xs]*Ns[xs];for(il=!0,Cs=bs;Cs>=1;Cs-=1){for(Bs=Ns[Cs],ws=(As=Is+Cs*(Cs+3)/2)-Cs,xs=Cs+1;xs<=bs;xs+=1)Bs-=Ns[As]*Ns[Vs+xs],As+=xs;if(Bs/=Ns[ws],Ns[Vs+Cs]=Bs,gs[Cs]<ys||Bs<0)break;il=!1,Ss=Cs}if(!il)for(Us=Ns[Ps+Ss]/Ns[Vs+Ss],Cs=1;Cs<=bs&&!(gs[Cs]<ys)&&!(Ns[Vs+Cs]<0);Cs+=1)(_s=Ns[Ps+Cs]/Ns[Vs+Cs])<Us&&(Us=_s,Ss=Cs);for(Bs=0,Cs=Ds+1;Cs<=Ds+ls;Cs+=1)Bs+=Ns[Cs]*Ns[Cs];if(Math.abs(Bs)<=ll){if(il)return Ts[1]=1,999;for(Cs=1;Cs<=bs;Cs+=1)Ns[Ps+Cs]=Ns[Ps+Cs]-Us*Ns[Vs+Cs];return Ns[Ps+bs+1]=Ns[Ps+bs+1]+Us,700}for(Bs=0,Cs=1;Cs<=ls;Cs+=1)Bs+=Ns[Ds+Cs]*ps[Cs][$s];for(zs=-Ns[Os+$s]/Bs,al=!0,il||Us<zs&&(zs=Us,al=!1),Cs=1;Cs<=ls;Cs+=1)us[Cs]=us[Cs]+zs*Ns[Ds+Cs],Math.abs(us[Cs])<ll&&(us[Cs]=0);for(cs[1]=cs[1]+zs*Bs*(zs/2+Ns[Ps+bs+1]),Cs=1;Cs<=bs;Cs+=1)Ns[Ps+Cs]=Ns[Ps+Cs]-zs*Ns[Vs+Cs];if(Ns[Ps+bs+1]=Ns[Ps+bs+1]+zs,!al){for(Bs=-ds[$s],xs=1;xs<=ls;xs+=1)Bs+=us[xs]*ps[xs][$s];if($s>ys)Ns[Os+$s]=Bs;else if(Ns[Os+$s]=-Math.abs(Bs),Bs>0){for(xs=1;xs<=ls;xs+=1)ps[xs][$s]=-ps[xs][$s];ds[$s]=-ds[$s]}return 700}for(gs[bs+=1]=$s,As=Is+(bs-1)*bs/2+1,Cs=1;Cs<=bs-1;Cs+=1)Ns[As]=Ns[Cs],As+=1;if(bs===ls)Ns[As]=Ns[ls];else{for(Cs=ls;Cs>=bs+1&&Ns[Cs]!==0&&(Hs=Math.max(Math.abs(Ns[Cs-1]),Math.abs(Ns[Cs])),el=Math.min(Math.abs(Ns[Cs-1]),Math.abs(Ns[Cs])),_s=Ns[Cs-1]>=0?Math.abs(Hs*Math.sqrt(1+el*el/(Hs*Hs))):-Math.abs(Hs*Math.sqrt(1+el*el/(Hs*Hs))),Hs=Ns[Cs-1]/_s,el=Ns[Cs]/_s,Hs!==1);Cs-=1)if(Hs===0)for(Ns[Cs-1]=el*_s,xs=1;xs<=ls;xs+=1)_s=is[xs][Cs-1],is[xs][Cs-1]=is[xs][Cs],is[xs][Cs]=_s;else for(Ns[Cs-1]=_s,Ys=el/(1+Hs),xs=1;xs<=ls;xs+=1)_s=Hs*is[xs][Cs-1]+el*is[xs][Cs],is[xs][Cs]=Ys*(is[xs][Cs-1]+_s)-is[xs][Cs],is[xs][Cs-1]=_s;Ns[As]=Ns[bs]}return 0}function Ls(){if(Ns[ws=(As=Is+Ss*(Ss+1)/2+1)+Ss]===0||(Hs=Math.max(Math.abs(Ns[ws-1]),Math.abs(Ns[ws])),el=Math.min(Math.abs(Ns[ws-1]),Math.abs(Ns[ws])),_s=Ns[ws-1]>=0?Math.abs(Hs*Math.sqrt(1+el*el/(Hs*Hs))):-Math.abs(Hs*Math.sqrt(1+el*el/(Hs*Hs))),Hs=Ns[ws-1]/_s,el=Ns[ws]/_s,Hs===1))return 798;if(Hs===0){for(Cs=Ss+1;Cs<=bs;Cs+=1)_s=Ns[ws-1],Ns[ws-1]=Ns[ws],Ns[ws]=_s,ws+=Cs;for(Cs=1;Cs<=ls;Cs+=1)_s=is[Cs][Ss],is[Cs][Ss]=is[Cs][Ss+1],is[Cs][Ss+1]=_s}else{for(Ys=el/(1+Hs),Cs=Ss+1;Cs<=bs;Cs+=1)_s=Hs*Ns[ws-1]+el*Ns[ws],Ns[ws]=Ys*(Ns[ws-1]+_s)-Ns[ws],Ns[ws-1]=_s,ws+=Cs;for(Cs=1;Cs<=ls;Cs+=1)_s=Hs*is[Cs][Ss]+el*is[Cs][Ss+1],is[Cs][Ss+1]=Ys*(is[Cs][Ss]+_s)-is[Cs][Ss+1],is[Cs][Ss]=_s}return 0}function Ws(){for(ws=As-Ss,Cs=1;Cs<=Ss;Cs+=1)Ns[ws]=Ns[As],As+=1,ws+=1;return Ns[Ps+Ss]=Ns[Ps+Ss+1],gs[Ss]=gs[Ss+1],(Ss+=1)<bs?797:0}function Zs(){return Ns[Ps+bs]=Ns[Ps+bs+1],Ns[Ps+bs+1]=0,gs[bs]=0,bs-=1,vs[2]=vs[2]+1,0}for(bs=0,vs[1]=0,vs[2]=0,dl=0;;){if((dl=sl())===999)return;for(;(dl=js())!==0;){if(dl===999)return;if(dl===700)if(Ss===bs)Zs();else{for(;Ls(),(dl=Ws())===797;);Zs()}}}}ss.solveQP=function(is,as,os,ls,us,cs){is=ts(is),as=ts(as),os=ts(os);var ps,ds,fs,hs,ys,gs=[],bs=[],vs=[],Ns=[],Ts=[];if(us=us||0,cs=cs?ts(cs):[void 0,0],ls=ls?ts(ls):[],ds=is.length-1,fs=os[1].length-1,!ls)for(ps=1;ps<=fs;ps+=1)ls[ps]=0;for(ps=1;ps<=fs;ps+=1)bs[ps]=0;for(hs=Math.min(ds,fs),ps=1;ps<=ds;ps+=1)vs[ps]=0;for(gs[1]=0,ps=1;ps<=2*ds+hs*(hs+5)/2+2*fs+1;ps+=1)Ns[ps]=0;for(ps=1;ps<=2;ps+=1)Ts[ps]=0;return ns(is,as,0,ds,vs,gs,os,ls,0,fs,us,bs,0,Ts,Ns,cs),ys="",cs[1]===1&&(ys="constraints are inconsistent, no solution!"),cs[1]===2&&(ys="matrix D in quadratic function is not positive definite!"),{solution:rs(vs),value:rs(gs),unconstrained_solution:rs(as),iterations:rs(Ts),iact:rs(bs),message:ys}}}(numeric),numeric.svd=function(ss){var ts,rs=numeric.epsilon,ns=1e-64/rs,is=0,as=0,os=0,ls=0,us=0,cs=numeric.clone(ss),ps=cs.length,ds=cs[0].length;if(ps<ds)throw"Need more rows than columns";var fs=new Array(ds),hs=new Array(ds);for(as=0;as<ds;as++)fs[as]=hs[as]=0;var ys=numeric.rep([ds,ds],0);function gs(Ds,Vs){return(Ds=Math.abs(Ds))>(Vs=Math.abs(Vs))?Ds*Math.sqrt(1+Vs*Vs/Ds/Ds):Vs==0?Ds:Vs*Math.sqrt(1+Ds*Ds/Vs/Vs)}var bs=0,vs=0,Ns=0,Ts=0,Cs=0,xs=0,As=0;for(as=0;as<ds;as++){for(fs[as]=vs,As=0,us=as+1,os=as;os<ps;os++)As+=cs[os][as]*cs[os][as];if(As<=ns)vs=0;else for(bs=cs[as][as],vs=Math.sqrt(As),bs>=0&&(vs=-vs),Ns=bs*vs-As,cs[as][as]=bs-vs,os=us;os<ds;os++){for(As=0,ls=as;ls<ps;ls++)As+=cs[ls][as]*cs[ls][os];for(bs=As/Ns,ls=as;ls<ps;ls++)cs[ls][os]+=bs*cs[ls][as]}for(hs[as]=vs,As=0,os=us;os<ds;os++)As+=cs[as][os]*cs[as][os];if(As<=ns)vs=0;else{for(bs=cs[as][as+1],vs=Math.sqrt(As),bs>=0&&(vs=-vs),Ns=bs*vs-As,cs[as][as+1]=bs-vs,os=us;os<ds;os++)fs[os]=cs[as][os]/Ns;for(os=us;os<ps;os++){for(As=0,ls=us;ls<ds;ls++)As+=cs[os][ls]*cs[as][ls];for(ls=us;ls<ds;ls++)cs[os][ls]+=As*fs[ls]}}(Cs=Math.abs(hs[as])+Math.abs(fs[as]))>Ts&&(Ts=Cs)}for(as=ds-1;as!=-1;as+=-1){if(vs!=0){for(Ns=vs*cs[as][as+1],os=us;os<ds;os++)ys[os][as]=cs[as][os]/Ns;for(os=us;os<ds;os++){for(As=0,ls=us;ls<ds;ls++)As+=cs[as][ls]*ys[ls][os];for(ls=us;ls<ds;ls++)ys[ls][os]+=As*ys[ls][as]}}for(os=us;os<ds;os++)ys[as][os]=0,ys[os][as]=0;ys[as][as]=1,vs=fs[as],us=as}for(as=ds-1;as!=-1;as+=-1){for(us=as+1,vs=hs[as],os=us;os<ds;os++)cs[as][os]=0;if(vs!=0){for(Ns=cs[as][as]*vs,os=us;os<ds;os++){for(As=0,ls=us;ls<ps;ls++)As+=cs[ls][as]*cs[ls][os];for(bs=As/Ns,ls=as;ls<ps;ls++)cs[ls][os]+=bs*cs[ls][as]}for(os=as;os<ps;os++)cs[os][as]=cs[os][as]/vs}else for(os=as;os<ps;os++)cs[os][as]=0;cs[as][as]+=1}for(rs*=Ts,ls=ds-1;ls!=-1;ls+=-1)for(var ws=0;ws<50;ws++){var Es=!1;for(us=ls;us!=-1;us+=-1){if(Math.abs(fs[us])<=rs){Es=!0;break}if(Math.abs(hs[us-1])<=rs)break}if(!Es){is=0,As=1;var Ss=us-1;for(as=us;as<ls+1&&(bs=As*fs[as],fs[as]=is*fs[as],!(Math.abs(bs)<=rs));as++)for(Ns=gs(bs,vs=hs[as]),hs[as]=Ns,is=vs/Ns,As=-bs/Ns,os=0;os<ps;os++)Cs=cs[os][Ss],xs=cs[os][as],cs[os][Ss]=Cs*is+xs*As,cs[os][as]=-Cs*As+xs*is}if(xs=hs[ls],us==ls){if(xs<0)for(hs[ls]=-xs,os=0;os<ds;os++)ys[os][ls]=-ys[os][ls];break}if(ws>=49)throw"Error: no convergence.";for(Ts=hs[us],vs=gs(bs=(((Cs=hs[ls-1])-xs)*(Cs+xs)+((vs=fs[ls-1])-(Ns=fs[ls]))*(vs+Ns))/(2*Ns*Cs),1),bs=bs<0?((Ts-xs)*(Ts+xs)+Ns*(Cs/(bs-vs)-Ns))/Ts:((Ts-xs)*(Ts+xs)+Ns*(Cs/(bs+vs)-Ns))/Ts,is=1,As=1,as=us+1;as<ls+1;as++){for(vs=fs[as],Cs=hs[as],Ns=As*vs,vs*=is,xs=gs(bs,Ns),fs[as-1]=xs,bs=Ts*(is=bs/xs)+vs*(As=Ns/xs),vs=-Ts*As+vs*is,Ns=Cs*As,Cs*=is,os=0;os<ds;os++)Ts=ys[os][as-1],xs=ys[os][as],ys[os][as-1]=Ts*is+xs*As,ys[os][as]=-Ts*As+xs*is;for(xs=gs(bs,Ns),hs[as-1]=xs,bs=(is=bs/xs)*vs+(As=Ns/xs)*Cs,Ts=-As*vs+is*Cs,os=0;os<ps;os++)Cs=cs[os][as-1],xs=cs[os][as],cs[os][as-1]=Cs*is+xs*As,cs[os][as]=-Cs*As+xs*is}fs[us]=0,fs[ls]=bs,hs[ls]=Ts}for(as=0;as<hs.length;as++)hs[as]<rs&&(hs[as]=0);for(as=0;as<ds;as++)for(os=as-1;os>=0;os--)if(hs[os]<hs[as]){for(is=hs[os],hs[os]=hs[as],hs[as]=is,ls=0;ls<cs.length;ls++)ts=cs[ls][as],cs[ls][as]=cs[ls][os],cs[ls][os]=ts;for(ls=0;ls<ys.length;ls++)ts=ys[ls][as],ys[ls][as]=ys[ls][os],ys[ls][os]=ts;as=os}return{U:cs,S:hs,V:ys}}})(numeric1_2_6);var math$1=createInstance$1();function leaves(ss,ts){if(!Array.isArray(ss))return[ss];var rs=ss[0],ns=ss.slice(1);return!ts||rs!=="_"||typeof ns[0]!="string"||typeof ns[1]!="string"&&typeof ns[1]!="number"?(rs==="apply"&&(ns=ss.slice(2)),ns.length===0?[]:ns.map(function(is,as){return leaves(is,ts)}).reduce(function(is,as){return is.concat(as)})):[ns[0]+"_"+ns[1]]}function variables(ss,ts=!1){var rs=leaves(get_tree(ss),ts);return rs=(rs=rs.filter(function(ns,is){return typeof ns=="string"&&(math$1.define_e||ns!=="e")&&(math$1.define_pi||ns!=="pi")&&(math$1.define_i||ns!=="i")})).filter(function(ns,is,as){return is===rs.indexOf(ns)}),rs}function operators_list(ss){if(!Array.isArray(ss))return[];var ts=ss[0],rs=ss.slice(1);return ts==="apply"&&(rs=ss.slice(2)),rs.length===0?[ts]:[ts].concat(rs.map(function(ns,is){return operators_list(ns)}).reduce(function(ns,is){return ns.concat(is)}))}function operators$3(ss){var ts=operators_list(get_tree(ss));return ts=(ts=ts.filter(function(rs,ns){return rs!=="apply"})).filter(function(rs,ns,is){return ns===ts.indexOf(rs)}),ts}function functions_list(ss){if(!Array.isArray(ss))return[];var ts=ss[0],rs=ss.slice(1),ns=[];return ts==="apply"&&(ns=[rs[0]],rs=ss.slice(2)),ns.concat(rs.map(function(is,as){return functions_list(is)}).reduce(function(is,as){return is.concat(as)}))}function functions$2(ss){var ts=functions_list(get_tree(ss));return ts=ts.filter(function(rs,ns,is){return ns===ts.indexOf(rs)}),ts}var variables$1=Object.freeze({__proto__:null,variables,operators:operators$3,functions:functions$2}),global$1=typeof global$2<"u"?global$2:typeof self<"u"?self:typeof window<"u"?window:{},VERSION$1="1.13.6",root=typeof self=="object"&&self.self===self&&self||typeof global$1=="object"&&global$1.global===global$1&&global$1||Function("return this")()||{},ArrayProto=Array.prototype,ObjProto=Object.prototype,SymbolProto=typeof Symbol<"u"?Symbol.prototype:null,push=ArrayProto.push,slice=ArrayProto.slice,toString$1$1=ObjProto.toString,hasOwnProperty$1=ObjProto.hasOwnProperty,supportsArrayBuffer=typeof ArrayBuffer<"u",supportsDataView=typeof DataView<"u",nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create,nativeIsView=supportsArrayBuffer&&ArrayBuffer.isView,_isNaN=isNaN,_isFinite=isFinite,hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],MAX_ARRAY_INDEX=Math.pow(2,53)-1;function restArguments(ss,ts){return ts=ts==null?ss.length-1:+ts,function(){for(var rs=Math.max(arguments.length-ts,0),ns=Array(rs),is=0;is<rs;is++)ns[is]=arguments[is+ts];switch(ts){case 0:return ss.call(this,ns);case 1:return ss.call(this,arguments[0],ns);case 2:return ss.call(this,arguments[0],arguments[1],ns)}var as=Array(ts+1);for(is=0;is<ts;is++)as[is]=arguments[is];return as[ts]=ns,ss.apply(this,as)}}function isObject$3(ss){var ts=typeof ss;return ts==="function"||ts==="object"&&!!ss}function isNull(ss){return ss===null}function isUndefined$2(ss){return ss===void 0}function isBoolean$2(ss){return ss===!0||ss===!1||toString$1$1.call(ss)==="[object Boolean]"}function isElement(ss){return!(!ss||ss.nodeType!==1)}function tagTester(ss){var ts="[object "+ss+"]";return function(rs){return toString$1$1.call(rs)===ts}}var isString$2=tagTester("String"),isNumber$2=tagTester("Number"),isDate$2=tagTester("Date"),isRegExp$2=tagTester("RegExp"),isError$1=tagTester("Error"),isSymbol=tagTester("Symbol"),isArrayBuffer$1=tagTester("ArrayBuffer"),isFunction$3=tagTester("Function"),nodelist=root.document&&root.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof nodelist!="function"&&(isFunction$3=function(ss){return typeof ss=="function"||!1});var isFunction$1$1=isFunction$3,hasObjectTag=tagTester("Object"),hasStringTagBug=supportsDataView&&hasObjectTag(new DataView(new ArrayBuffer(8))),isIE11=typeof Map<"u"&&hasObjectTag(new Map),isDataView=tagTester("DataView");function ie10IsDataView(ss){return ss!=null&&isFunction$1$1(ss.getInt8)&&isArrayBuffer$1(ss.buffer)}var isDataView$1=hasStringTagBug?ie10IsDataView:isDataView,isArray$4=nativeIsArray||tagTester("Array");function has$1(ss,ts){return ss!=null&&hasOwnProperty$1.call(ss,ts)}var isArguments=tagTester("Arguments");(function(){isArguments(arguments)||(isArguments=function(ss){return has$1(ss,"callee")})})();var isArguments$1=isArguments;function isFinite$1(ss){return!isSymbol(ss)&&_isFinite(ss)&&!isNaN(parseFloat(ss))}function isNaN$1(ss){return isNumber$2(ss)&&_isNaN(ss)}function constant(ss){return function(){return ss}}function createSizePropertyCheck(ss){return function(ts){var rs=ss(ts);return typeof rs=="number"&&rs>=0&&rs<=MAX_ARRAY_INDEX}}function shallowProperty(ss){return function(ts){return ts==null?void 0:ts[ss]}}var getByteLength=shallowProperty("byteLength"),isBufferLike=createSizePropertyCheck(getByteLength),typedArrayPattern=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function isTypedArray$1(ss){return nativeIsView?nativeIsView(ss)&&!isDataView$1(ss):isBufferLike(ss)&&typedArrayPattern.test(toString$1$1.call(ss))}var isTypedArray$1$1=supportsArrayBuffer?isTypedArray$1:constant(!1),getLength=shallowProperty("length");function emulatedSet(ss){for(var ts={},rs=ss.length,ns=0;ns<rs;++ns)ts[ss[ns]]=!0;return{contains:function(is){return ts[is]===!0},push:function(is){return ts[is]=!0,ss.push(is)}}}function collectNonEnumProps(ss,ts){ts=emulatedSet(ts);var rs=nonEnumerableProps.length,ns=ss.constructor,is=isFunction$1$1(ns)&&ns.prototype||ObjProto,as="constructor";for(has$1(ss,as)&&!ts.contains(as)&&ts.push(as);rs--;)(as=nonEnumerableProps[rs])in ss&&ss[as]!==is[as]&&!ts.contains(as)&&ts.push(as)}function keys$2(ss){if(!isObject$3(ss))return[];if(nativeKeys)return nativeKeys(ss);var ts=[];for(var rs in ss)has$1(ss,rs)&&ts.push(rs);return hasEnumBug&&collectNonEnumProps(ss,ts),ts}function isEmpty$1(ss){if(ss==null)return!0;var ts=getLength(ss);return typeof ts=="number"&&(isArray$4(ss)||isString$2(ss)||isArguments$1(ss))?ts===0:getLength(keys$2(ss))===0}function isMatch(ss,ts){var rs=keys$2(ts),ns=rs.length;if(ss==null)return!ns;for(var is=Object(ss),as=0;as<ns;as++){var os=rs[as];if(ts[os]!==is[os]||!(os in is))return!1}return!0}function _$1$1(ss){return ss instanceof _$1$1?ss:this instanceof _$1$1?void(this._wrapped=ss):new _$1$1(ss)}function toBufferView(ss){return new Uint8Array(ss.buffer||ss,ss.byteOffset||0,getByteLength(ss))}_$1$1.VERSION=VERSION$1,_$1$1.prototype.value=function(){return this._wrapped},_$1$1.prototype.valueOf=_$1$1.prototype.toJSON=_$1$1.prototype.value,_$1$1.prototype.toString=function(){return String(this._wrapped)};var tagDataView="[object DataView]";function eq(ss,ts,rs,ns){if(ss===ts)return ss!==0||1/ss==1/ts;if(ss==null||ts==null)return!1;if(ss!=ss)return ts!=ts;var is=typeof ss;return(is==="function"||is==="object"||typeof ts=="object")&&deepEq(ss,ts,rs,ns)}function deepEq(ss,ts,rs,ns){ss instanceof _$1$1&&(ss=ss._wrapped),ts instanceof _$1$1&&(ts=ts._wrapped);var is=toString$1$1.call(ss);if(is!==toString$1$1.call(ts))return!1;if(hasStringTagBug&&is=="[object Object]"&&isDataView$1(ss)){if(!isDataView$1(ts))return!1;is=tagDataView}switch(is){case"[object RegExp]":case"[object String]":return""+ss==""+ts;case"[object Number]":return+ss!=+ss?+ts!=+ts:+ss==0?1/+ss==1/ts:+ss==+ts;case"[object Date]":case"[object Boolean]":return+ss==+ts;case"[object Symbol]":return SymbolProto.valueOf.call(ss)===SymbolProto.valueOf.call(ts);case"[object ArrayBuffer]":case tagDataView:return deepEq(toBufferView(ss),toBufferView(ts),rs,ns)}var as=is==="[object Array]";if(!as&&isTypedArray$1$1(ss)){if(getByteLength(ss)!==getByteLength(ts))return!1;if(ss.buffer===ts.buffer&&ss.byteOffset===ts.byteOffset)return!0;as=!0}if(!as){if(typeof ss!="object"||typeof ts!="object")return!1;var os=ss.constructor,ls=ts.constructor;if(os!==ls&&!(isFunction$1$1(os)&&os instanceof os&&isFunction$1$1(ls)&&ls instanceof ls)&&"constructor"in ss&&"constructor"in ts)return!1}ns=ns||[];for(var us=(rs=rs||[]).length;us--;)if(rs[us]===ss)return ns[us]===ts;if(rs.push(ss),ns.push(ts),as){if((us=ss.length)!==ts.length)return!1;for(;us--;)if(!eq(ss[us],ts[us],rs,ns))return!1}else{var cs,ps=keys$2(ss);if(us=ps.length,keys$2(ts).length!==us)return!1;for(;us--;)if(!has$1(ts,cs=ps[us])||!eq(ss[cs],ts[cs],rs,ns))return!1}return rs.pop(),ns.pop(),!0}function isEqual(ss,ts){return eq(ss,ts)}function allKeys(ss){if(!isObject$3(ss))return[];var ts=[];for(var rs in ss)ts.push(rs);return hasEnumBug&&collectNonEnumProps(ss,ts),ts}function ie11fingerprint(ss){var ts=getLength(ss);return function(rs){if(rs==null)return!1;var ns=allKeys(rs);if(getLength(ns))return!1;for(var is=0;is<ts;is++)if(!isFunction$1$1(rs[ss[is]]))return!1;return ss!==weakMapMethods||!isFunction$1$1(rs[forEachName])}}var forEachName="forEach",hasName="has",commonInit=["clear","delete"],mapTail=["get",hasName,"set"],mapMethods=commonInit.concat(forEachName,mapTail),weakMapMethods=commonInit.concat(mapTail),setMethods=["add"].concat(commonInit,forEachName,hasName),isMap=isIE11?ie11fingerprint(mapMethods):tagTester("Map"),isWeakMap=isIE11?ie11fingerprint(weakMapMethods):tagTester("WeakMap"),isSet=isIE11?ie11fingerprint(setMethods):tagTester("Set"),isWeakSet=tagTester("WeakSet");function values$2(ss){for(var ts=keys$2(ss),rs=ts.length,ns=Array(rs),is=0;is<rs;is++)ns[is]=ss[ts[is]];return ns}function pairs(ss){for(var ts=keys$2(ss),rs=ts.length,ns=Array(rs),is=0;is<rs;is++)ns[is]=[ts[is],ss[ts[is]]];return ns}function invert(ss){for(var ts={},rs=keys$2(ss),ns=0,is=rs.length;ns<is;ns++)ts[ss[rs[ns]]]=rs[ns];return ts}function functions$1(ss){var ts=[];for(var rs in ss)isFunction$1$1(ss[rs])&&ts.push(rs);return ts.sort()}function createAssigner(ss,ts){return function(rs){var ns=arguments.length;if(ts&&(rs=Object(rs)),ns<2||rs==null)return rs;for(var is=1;is<ns;is++)for(var as=arguments[is],os=ss(as),ls=os.length,us=0;us<ls;us++){var cs=os[us];ts&&rs[cs]!==void 0||(rs[cs]=as[cs])}return rs}}var extend$1=createAssigner(allKeys),extendOwn=createAssigner(keys$2),defaults$6=createAssigner(allKeys,!0);function ctor(){return function(){}}function baseCreate(ss){if(!isObject$3(ss))return{};if(nativeCreate)return nativeCreate(ss);var ts=ctor();ts.prototype=ss;var rs=new ts;return ts.prototype=null,rs}function create(ss,ts){var rs=baseCreate(ss);return ts&&extendOwn(rs,ts),rs}function clone(ss){return isObject$3(ss)?isArray$4(ss)?ss.slice():extend$1({},ss):ss}function tap(ss,ts){return ts(ss),ss}function toPath$1(ss){return isArray$4(ss)?ss:[ss]}function toPath(ss){return _$1$1.toPath(ss)}function deepGet(ss,ts){for(var rs=ts.length,ns=0;ns<rs;ns++){if(ss==null)return;ss=ss[ts[ns]]}return rs?ss:void 0}function get(ss,ts,rs){var ns=deepGet(ss,toPath(ts));return isUndefined$2(ns)?rs:ns}function has$2(ss,ts){for(var rs=(ts=toPath(ts)).length,ns=0;ns<rs;ns++){var is=ts[ns];if(!has$1(ss,is))return!1;ss=ss[is]}return!!rs}function identity(ss){return ss}function matcher(ss){return ss=extendOwn({},ss),function(ts){return isMatch(ts,ss)}}function property(ss){return ss=toPath(ss),function(ts){return deepGet(ts,ss)}}function optimizeCb(ss,ts,rs){if(ts===void 0)return ss;switch(rs??3){case 1:return function(ns){return ss.call(ts,ns)};case 3:return function(ns,is,as){return ss.call(ts,ns,is,as)};case 4:return function(ns,is,as,os){return ss.call(ts,ns,is,as,os)}}return function(){return ss.apply(ts,arguments)}}function baseIteratee(ss,ts,rs){return ss==null?identity:isFunction$1$1(ss)?optimizeCb(ss,ts,rs):isObject$3(ss)&&!isArray$4(ss)?matcher(ss):property(ss)}function iteratee(ss,ts){return baseIteratee(ss,ts,1/0)}function cb(ss,ts,rs){return _$1$1.iteratee!==iteratee?_$1$1.iteratee(ss,ts):baseIteratee(ss,ts,rs)}function mapObject(ss,ts,rs){ts=cb(ts,rs);for(var ns=keys$2(ss),is=ns.length,as={},os=0;os<is;os++){var ls=ns[os];as[ls]=ts(ss[ls],ls,ss)}return as}function noop$1(){}function propertyOf(ss){return ss==null?noop$1:function(ts){return get(ss,ts)}}function times(ss,ts,rs){var ns=Array(Math.max(0,ss));ts=optimizeCb(ts,rs,1);for(var is=0;is<ss;is++)ns[is]=ts(is);return ns}function random(ss,ts){return ts==null&&(ts=ss,ss=0),ss+Math.floor(Math.random()*(ts-ss+1))}_$1$1.toPath=toPath$1,_$1$1.iteratee=iteratee;var now=Date.now||function(){return new Date().getTime()};function createEscaper(ss){var ts=function(as){return ss[as]},rs="(?:"+keys$2(ss).join("|")+")",ns=RegExp(rs),is=RegExp(rs,"g");return function(as){return as=as==null?"":""+as,ns.test(as)?as.replace(is,ts):as}}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},escape$2=createEscaper(escapeMap),unescapeMap=invert(escapeMap),unescape$1=createEscaper(unescapeMap),templateSettings=_$1$1.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeRegExp$1=/\\|'|\r|\n|\u2028|\u2029/g;function escapeChar(ss){return"\\"+escapes[ss]}var bareIdentifier=/^\s*(\w|\$)+\s*$/;function template(ss,ts,rs){!ts&&rs&&(ts=rs),ts=defaults$6({},ts,_$1$1.templateSettings);var ns=RegExp([(ts.escape||noMatch).source,(ts.interpolate||noMatch).source,(ts.evaluate||noMatch).source].join("|")+"|$","g"),is=0,as="__p+='";ss.replace(ns,function(cs,ps,ds,fs,hs){return as+=ss.slice(is,hs).replace(escapeRegExp$1,escapeChar),is=hs+cs.length,ps?as+=`'+
((__t=(`+ps+`))==null?'':_.escape(__t))+
'`:ds?as+=`'+
((__t=(`+ds+`))==null?'':__t)+
'`:fs&&(as+=`';
`+fs+`
__p+='`),cs}),as+=`';
`;var os,ls=ts.variable;if(ls){if(!bareIdentifier.test(ls))throw new Error("variable is not a bare identifier: "+ls)}else as=`with(obj||{}){
`+as+`}
`,ls="obj";as=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+as+`return __p;
`;try{os=new Function(ls,"_",as)}catch(cs){throw cs.source=as,cs}var us=function(cs){return os.call(this,cs,_$1$1)};return us.source="function("+ls+`){
`+as+"}",us}function result(ss,ts,rs){var ns=(ts=toPath(ts)).length;if(!ns)return isFunction$1$1(rs)?rs.call(ss):rs;for(var is=0;is<ns;is++){var as=ss==null?void 0:ss[ts[is]];as===void 0&&(as=rs,is=ns),ss=isFunction$1$1(as)?as.call(ss):as}return ss}var idCounter=0;function uniqueId(ss){var ts=++idCounter+"";return ss?ss+ts:ts}function chain(ss){var ts=_$1$1(ss);return ts._chain=!0,ts}function executeBound(ss,ts,rs,ns,is){if(!(ns instanceof ts))return ss.apply(rs,is);var as=baseCreate(ss.prototype),os=ss.apply(as,is);return isObject$3(os)?os:as}var partial=restArguments(function(ss,ts){var rs=partial.placeholder,ns=function(){for(var is=0,as=ts.length,os=Array(as),ls=0;ls<as;ls++)os[ls]=ts[ls]===rs?arguments[is++]:ts[ls];for(;is<arguments.length;)os.push(arguments[is++]);return executeBound(ss,ns,this,this,os)};return ns});partial.placeholder=_$1$1;var bind$3=restArguments(function(ss,ts,rs){if(!isFunction$1$1(ss))throw new TypeError("Bind must be called on a function");var ns=restArguments(function(is){return executeBound(ss,ns,ts,this,rs.concat(is))});return ns}),isArrayLike=createSizePropertyCheck(getLength);function flatten$2(ss,ts,rs,ns){if(ns=ns||[],ts||ts===0){if(ts<=0)return ns.concat(ss)}else ts=1/0;for(var is=ns.length,as=0,os=getLength(ss);as<os;as++){var ls=ss[as];if(isArrayLike(ls)&&(isArray$4(ls)||isArguments$1(ls)))if(ts>1)flatten$2(ls,ts-1,rs,ns),is=ns.length;else for(var us=0,cs=ls.length;us<cs;)ns[is++]=ls[us++];else rs||(ns[is++]=ls)}return ns}var bindAll=restArguments(function(ss,ts){var rs=(ts=flatten$2(ts,!1,!1)).length;if(rs<1)throw new Error("bindAll must be passed function names");for(;rs--;){var ns=ts[rs];ss[ns]=bind$3(ss[ns],ss)}return ss});function memoize(ss,ts){var rs=function(ns){var is=rs.cache,as=""+(ts?ts.apply(this,arguments):ns);return has$1(is,as)||(is[as]=ss.apply(this,arguments)),is[as]};return rs.cache={},rs}var delay=restArguments(function(ss,ts,rs){return setTimeout(function(){return ss.apply(null,rs)},ts)}),defer=partial(delay,_$1$1,1);function throttle(ss,ts,rs){var ns,is,as,os,ls=0;rs||(rs={});var us=function(){ls=rs.leading===!1?0:now(),ns=null,os=ss.apply(is,as),ns||(is=as=null)},cs=function(){var ps=now();ls||rs.leading!==!1||(ls=ps);var ds=ts-(ps-ls);return is=this,as=arguments,ds<=0||ds>ts?(ns&&(clearTimeout(ns),ns=null),ls=ps,os=ss.apply(is,as),ns||(is=as=null)):ns||rs.trailing===!1||(ns=setTimeout(us,ds)),os};return cs.cancel=function(){clearTimeout(ns),ls=0,ns=is=as=null},cs}function debounce(ss,ts,rs){var ns,is,as,os,ls,us=function(){var ps=now()-is;ts>ps?ns=setTimeout(us,ts-ps):(ns=null,rs||(os=ss.apply(ls,as)),ns||(as=ls=null))},cs=restArguments(function(ps){return ls=this,as=ps,is=now(),ns||(ns=setTimeout(us,ts),rs&&(os=ss.apply(ls,as))),os});return cs.cancel=function(){clearTimeout(ns),ns=as=ls=null},cs}function wrap(ss,ts){return partial(ts,ss)}function negate(ss){return function(){return!ss.apply(this,arguments)}}function compose(){var ss=arguments,ts=ss.length-1;return function(){for(var rs=ts,ns=ss[ts].apply(this,arguments);rs--;)ns=ss[rs].call(this,ns);return ns}}function after(ss,ts){return function(){if(--ss<1)return ts.apply(this,arguments)}}function before(ss,ts){var rs;return function(){return--ss>0&&(rs=ts.apply(this,arguments)),ss<=1&&(ts=null),rs}}var once$1=partial(before,2);function findKey(ss,ts,rs){ts=cb(ts,rs);for(var ns,is=keys$2(ss),as=0,os=is.length;as<os;as++)if(ts(ss[ns=is[as]],ns,ss))return ns}function createPredicateIndexFinder(ss){return function(ts,rs,ns){rs=cb(rs,ns);for(var is=getLength(ts),as=ss>0?0:is-1;as>=0&&as<is;as+=ss)if(rs(ts[as],as,ts))return as;return-1}}var findIndex=createPredicateIndexFinder(1),findLastIndex=createPredicateIndexFinder(-1);function sortedIndex(ss,ts,rs,ns){for(var is=(rs=cb(rs,ns,1))(ts),as=0,os=getLength(ss);as<os;){var ls=Math.floor((as+os)/2);rs(ss[ls])<is?as=ls+1:os=ls}return as}function createIndexFinder(ss,ts,rs){return function(ns,is,as){var os=0,ls=getLength(ns);if(typeof as=="number")ss>0?os=as>=0?as:Math.max(as+ls,os):ls=as>=0?Math.min(as+1,ls):as+ls+1;else if(rs&&as&&ls)return ns[as=rs(ns,is)]===is?as:-1;if(is!=is)return(as=ts(slice.call(ns,os,ls),isNaN$1))>=0?as+os:-1;for(as=ss>0?os:ls-1;as>=0&&as<ls;as+=ss)if(ns[as]===is)return as;return-1}}var indexOf$1=createIndexFinder(1,findIndex,sortedIndex),lastIndexOf=createIndexFinder(-1,findLastIndex);function find$1(ss,ts,rs){var ns=(isArrayLike(ss)?findIndex:findKey)(ss,ts,rs);if(ns!==void 0&&ns!==-1)return ss[ns]}function findWhere(ss,ts){return find$1(ss,matcher(ts))}function each(ss,ts,rs){var ns,is;if(ts=optimizeCb(ts,rs),isArrayLike(ss))for(ns=0,is=ss.length;ns<is;ns++)ts(ss[ns],ns,ss);else{var as=keys$2(ss);for(ns=0,is=as.length;ns<is;ns++)ts(ss[as[ns]],as[ns],ss)}return ss}function map$3(ss,ts,rs){ts=cb(ts,rs);for(var ns=!isArrayLike(ss)&&keys$2(ss),is=(ns||ss).length,as=Array(is),os=0;os<is;os++){var ls=ns?ns[os]:os;as[os]=ts(ss[ls],ls,ss)}return as}function createReduce(ss){var ts=function(rs,ns,is,as){var os=!isArrayLike(rs)&&keys$2(rs),ls=(os||rs).length,us=ss>0?0:ls-1;for(as||(is=rs[os?os[us]:us],us+=ss);us>=0&&us<ls;us+=ss){var cs=os?os[us]:us;is=ns(is,rs[cs],cs,rs)}return is};return function(rs,ns,is,as){var os=arguments.length>=3;return ts(rs,optimizeCb(ns,as,4),is,os)}}var reduce$1=createReduce(1),reduceRight=createReduce(-1);function filter$3(ss,ts,rs){var ns=[];return ts=cb(ts,rs),each(ss,function(is,as,os){ts(is,as,os)&&ns.push(is)}),ns}function reject$1(ss,ts,rs){return filter$3(ss,negate(cb(ts)),rs)}function every$1(ss,ts,rs){ts=cb(ts,rs);for(var ns=!isArrayLike(ss)&&keys$2(ss),is=(ns||ss).length,as=0;as<is;as++){var os=ns?ns[as]:as;if(!ts(ss[os],os,ss))return!1}return!0}function some$1(ss,ts,rs){ts=cb(ts,rs);for(var ns=!isArrayLike(ss)&&keys$2(ss),is=(ns||ss).length,as=0;as<is;as++){var os=ns?ns[as]:as;if(ts(ss[os],os,ss))return!0}return!1}function contains$3(ss,ts,rs,ns){return isArrayLike(ss)||(ss=values$2(ss)),(typeof rs!="number"||ns)&&(rs=0),indexOf$1(ss,ts,rs)>=0}var invoke=restArguments(function(ss,ts,rs){var ns,is;return isFunction$1$1(ts)?is=ts:(ts=toPath(ts),ns=ts.slice(0,-1),ts=ts[ts.length-1]),map$3(ss,function(as){var os=is;if(!os){if(ns&&ns.length&&(as=deepGet(as,ns)),as==null)return;os=as[ts]}return os==null?os:os.apply(as,rs)})});function pluck(ss,ts){return map$3(ss,property(ts))}function where(ss,ts){return filter$3(ss,matcher(ts))}function max(ss,ts,rs){var ns,is,as=-1/0,os=-1/0;if(ts==null||typeof ts=="number"&&typeof ss[0]!="object"&&ss!=null)for(var ls=0,us=(ss=isArrayLike(ss)?ss:values$2(ss)).length;ls<us;ls++)(ns=ss[ls])!=null&&ns>as&&(as=ns);else ts=cb(ts,rs),each(ss,function(cs,ps,ds){((is=ts(cs,ps,ds))>os||is===-1/0&&as===-1/0)&&(as=cs,os=is)});return as}function min(ss,ts,rs){var ns,is,as=1/0,os=1/0;if(ts==null||typeof ts=="number"&&typeof ss[0]!="object"&&ss!=null)for(var ls=0,us=(ss=isArrayLike(ss)?ss:values$2(ss)).length;ls<us;ls++)(ns=ss[ls])!=null&&ns<as&&(as=ns);else ts=cb(ts,rs),each(ss,function(cs,ps,ds){((is=ts(cs,ps,ds))<os||is===1/0&&as===1/0)&&(as=cs,os=is)});return as}var reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function toArray$1(ss){return ss?isArray$4(ss)?slice.call(ss):isString$2(ss)?ss.match(reStrSymbol):isArrayLike(ss)?map$3(ss,identity):values$2(ss):[]}function sample(ss,ts,rs){if(ts==null||rs)return isArrayLike(ss)||(ss=values$2(ss)),ss[random(ss.length-1)];var ns=toArray$1(ss),is=getLength(ns);ts=Math.max(Math.min(ts,is),0);for(var as=is-1,os=0;os<ts;os++){var ls=random(os,as),us=ns[os];ns[os]=ns[ls],ns[ls]=us}return ns.slice(0,ts)}function shuffle(ss){return sample(ss,1/0)}function sortBy(ss,ts,rs){var ns=0;return ts=cb(ts,rs),pluck(map$3(ss,function(is,as,os){return{value:is,index:ns++,criteria:ts(is,as,os)}}).sort(function(is,as){var os=is.criteria,ls=as.criteria;if(os!==ls){if(os>ls||os===void 0)return 1;if(os<ls||ls===void 0)return-1}return is.index-as.index}),"value")}function group(ss,ts){return function(rs,ns,is){var as=ts?[[],[]]:{};return ns=cb(ns,is),each(rs,function(os,ls){var us=ns(os,ls,rs);ss(as,os,us)}),as}}var groupBy$1=group(function(ss,ts,rs){has$1(ss,rs)?ss[rs].push(ts):ss[rs]=[ts]}),indexBy=group(function(ss,ts,rs){ss[rs]=ts}),countBy=group(function(ss,ts,rs){has$1(ss,rs)?ss[rs]++:ss[rs]=1}),partition=group(function(ss,ts,rs){ss[rs?0:1].push(ts)},!0);function size(ss){return ss==null?0:isArrayLike(ss)?ss.length:keys$2(ss).length}function keyInObj(ss,ts,rs){return ts in rs}var pick$1=restArguments(function(ss,ts){var rs={},ns=ts[0];if(ss==null)return rs;isFunction$1$1(ns)?(ts.length>1&&(ns=optimizeCb(ns,ts[1])),ts=allKeys(ss)):(ns=keyInObj,ts=flatten$2(ts,!1,!1),ss=Object(ss));for(var is=0,as=ts.length;is<as;is++){var os=ts[is],ls=ss[os];ns(ls,os,ss)&&(rs[os]=ls)}return rs}),omit=restArguments(function(ss,ts){var rs,ns=ts[0];return isFunction$1$1(ns)?(ns=negate(ns),ts.length>1&&(rs=ts[1])):(ts=map$3(flatten$2(ts,!1,!1),String),ns=function(is,as){return!contains$3(ts,as)}),pick$1(ss,ns,rs)});function initial(ss,ts,rs){return slice.call(ss,0,Math.max(0,ss.length-(ts==null||rs?1:ts)))}function first$2(ss,ts,rs){return ss==null||ss.length<1?ts==null||rs?void 0:[]:ts==null||rs?ss[0]:initial(ss,ss.length-ts)}function rest(ss,ts,rs){return slice.call(ss,ts==null||rs?1:ts)}function last$1(ss,ts,rs){return ss==null||ss.length<1?ts==null||rs?void 0:[]:ts==null||rs?ss[ss.length-1]:rest(ss,Math.max(0,ss.length-ts))}function compact$1(ss){return filter$3(ss,Boolean)}function flatten$1(ss,ts){return flatten$2(ss,ts,!1)}var difference$1=restArguments(function(ss,ts){return ts=flatten$2(ts,!0,!0),filter$3(ss,function(rs){return!contains$3(ts,rs)})}),without=restArguments(function(ss,ts){return difference$1(ss,ts)});function uniq$1(ss,ts,rs,ns){isBoolean$2(ts)||(ns=rs,rs=ts,ts=!1),rs!=null&&(rs=cb(rs,ns));for(var is=[],as=[],os=0,ls=getLength(ss);os<ls;os++){var us=ss[os],cs=rs?rs(us,os,ss):us;ts&&!rs?(os&&as===cs||is.push(us),as=cs):rs?contains$3(as,cs)||(as.push(cs),is.push(us)):contains$3(is,us)||is.push(us)}return is}var union=restArguments(function(ss){return uniq$1(flatten$2(ss,!0,!0))});function intersection(ss){for(var ts=[],rs=arguments.length,ns=0,is=getLength(ss);ns<is;ns++){var as=ss[ns];if(!contains$3(ts,as)){var os;for(os=1;os<rs&&contains$3(arguments[os],as);os++);os===rs&&ts.push(as)}}return ts}function unzip(ss){for(var ts=ss&&max(ss,getLength).length||0,rs=Array(ts),ns=0;ns<ts;ns++)rs[ns]=pluck(ss,ns);return rs}var zip$1=restArguments(unzip);function object(ss,ts){for(var rs={},ns=0,is=getLength(ss);ns<is;ns++)ts?rs[ss[ns]]=ts[ns]:rs[ss[ns][0]]=ss[ns][1];return rs}function range(ss,ts,rs){ts==null&&(ts=ss||0,ss=0),rs||(rs=ts<ss?-1:1);for(var ns=Math.max(Math.ceil((ts-ss)/rs),0),is=Array(ns),as=0;as<ns;as++,ss+=rs)is[as]=ss;return is}function chunk(ss,ts){if(ts==null||ts<1)return[];for(var rs=[],ns=0,is=ss.length;ns<is;)rs.push(slice.call(ss,ns,ns+=ts));return rs}function chainResult(ss,ts){return ss._chain?_$1$1(ts).chain():ts}function mixin(ss){return each(functions$1(ss),function(ts){var rs=_$1$1[ts]=ss[ts];_$1$1.prototype[ts]=function(){var ns=[this._wrapped];return push.apply(ns,arguments),chainResult(this,rs.apply(_$1$1,ns))}}),_$1$1}each(["pop","push","reverse","shift","sort","splice","unshift"],function(ss){var ts=ArrayProto[ss];_$1$1.prototype[ss]=function(){var rs=this._wrapped;return rs!=null&&(ts.apply(rs,arguments),ss!=="shift"&&ss!=="splice"||rs.length!==0||delete rs[0]),chainResult(this,rs)}}),each(["concat","join","slice"],function(ss){var ts=ArrayProto[ss];_$1$1.prototype[ss]=function(){var rs=this._wrapped;return rs!=null&&(rs=ts.apply(rs,arguments)),chainResult(this,rs)}});var allExports=Object.freeze({__proto__:null,VERSION:VERSION$1,restArguments,isObject:isObject$3,isNull,isUndefined:isUndefined$2,isBoolean:isBoolean$2,isElement,isString:isString$2,isNumber:isNumber$2,isDate:isDate$2,isRegExp:isRegExp$2,isError:isError$1,isSymbol,isArrayBuffer:isArrayBuffer$1,isDataView:isDataView$1,isArray:isArray$4,isFunction:isFunction$1$1,isArguments:isArguments$1,isFinite:isFinite$1,isNaN:isNaN$1,isTypedArray:isTypedArray$1$1,isEmpty:isEmpty$1,isMatch,isEqual,isMap,isWeakMap,isSet,isWeakSet,keys:keys$2,allKeys,values:values$2,pairs,invert,functions:functions$1,methods:functions$1,extend:extend$1,extendOwn,assign:extendOwn,defaults:defaults$6,create,clone,tap,get,has:has$2,mapObject,identity,constant,noop:noop$1,toPath:toPath$1,property,propertyOf,matcher,matches:matcher,times,random,now,escape:escape$2,unescape:unescape$1,templateSettings,template,result,uniqueId,chain,iteratee,partial,bind:bind$3,bindAll,memoize,delay,defer,throttle,debounce,wrap,negate,compose,after,before,once:once$1,findKey,findIndex,findLastIndex,sortedIndex,indexOf:indexOf$1,lastIndexOf,find:find$1,detect:find$1,findWhere,each,forEach:each,map:map$3,collect:map$3,reduce:reduce$1,foldl:reduce$1,inject:reduce$1,reduceRight,foldr:reduceRight,filter:filter$3,select:filter$3,reject:reject$1,every:every$1,all:every$1,some:some$1,any:some$1,contains:contains$3,includes:contains$3,include:contains$3,invoke,pluck,where,max,min,shuffle,sample,sortBy,groupBy:groupBy$1,indexBy,countBy,partition,toArray:toArray$1,size,pick:pick$1,omit,first:first$2,head:first$2,take:first$2,initial,last:last$1,rest,tail:rest,drop:rest,compact:compact$1,flatten:flatten$1,without,uniq:uniq$1,unique:uniq$1,union,intersection,difference:difference$1,unzip,transpose:unzip,zip:zip$1,object,range,chunk,mixin,default:_$1$1}),_$2=mixin(allExports);function handleNaNInfinityStringify(ss,ts){return ts!=ts?"0/0":ts===1/0?"1/0":ts===-1/0?"-1/0":ts}function handleNaNInfinityParse(ss,ts){return ts==="0/0"?NaN:ts==="1/0"?1/0:ts==="-1/0"?-1/0:ts}function deepClone$1(ss){return JSON.parse(JSON.stringify(ss,handleNaNInfinityStringify),handleNaNInfinityParse)}_$2._=_$2;const equal=function(ss,ts,{allowed_error_in_numbers:rs=0,include_error_in_number_exponents:ns=!1,allowed_error_is_absolute:is=!1}={}){if(!Array.isArray(ss)||!Array.isArray(ts)){if(typeof ss!=typeof ts)return!1;if(typeof ss=="number"&&Number.isFinite(ss)){let cs=1e-14,ps=Math.min(Math.abs(ss),Math.abs(ts));return is?(cs*=ps,rs>cs&&(cs=rs)):(rs>cs&&(cs=rs),cs*=ps),Math.abs(ss-ts)<=cs}return ss===ts}var as=ss[0],os=ss.slice(1),ls=ts[0],us=ts.slice(1);return as!==ls||os.length!==us.length?!1:rs>0&&!ns&&as==="^"?!!equal(os[0],us[0],{allowed_error_in_numbers:rs,include_error_in_number_exponents:ns,allowed_error_is_absolute:is})&&equal(os[1],us[1]):_$2.every(_$2.zip(os,us),function(cs){return equal(cs[0],cs[1],{allowed_error_in_numbers:rs,include_error_in_number_exponents:ns,allowed_error_is_absolute:is})})},match$2=function(ss,ts,rs){var ns=!1;rs===void 0?rs={}:rs.allow_extended_match&&(ns=!0,delete(rs=Object.assign({},rs)).allow_extended_match);var is=rs.variables;if(is===void 0){is={};let cs=variables(ts);for(let ps=0;ps<cs.length;ps++)is[cs[ps]]=!0;(rs=Object.assign({},rs)).variables=is}if(ts in is){let cs=is[ts];if(cs!==!0){if(cs instanceof RegExp){if(typeof ss=="string"){if(!ss.match(cs))return!1}else if(!JSON.stringify(ss).match(cs))return!1}else if(typeof is[ts]!="function"||!is[ts](ss))return!1}let ps={};return ps[ts]=ss,ps}if(rs.allow_permutations&&(ss=default_order(ss),ts=default_order(ts)),!Array.isArray(ts))return ss===ts&&{};var as=allChildren(ss),os=ts[0],ls=ts.slice(1);if(!Array.isArray(ss)||ss[0]!==os||as.length<ls.length){if(Array.isArray(rs.allow_implicit_identities)){let cs=matchImplicitIdentity(ss,ts,rs);if(cs)return cs}if(os!=="*"||!Array.isArray(ss)||ss[0]!=="-"||!Array.isArray(ss[1])||ss[1][0]!=="*")return!1;(as=allChildren(ss[1]))[0]=["-",as[0]]}return matchOperands(os,as,ls,rs,ns)||!!Array.isArray(rs.allow_implicit_identities)&&matchImplicitIdentity([os].concat(as),ts,rs)};function matchOperands(ss,ts,rs,ns,is){var as=rs.map(ds=>Object()),os=rs.length,ls=!1;function us(ds,fs,hs){let ys,gs=1,bs=1;if((is_associative$1[ss]||["tuple","vector","altvector"].includes(ss))&&(gs=ds.length-(os-fs-1),bs=ds.length),ns.max_group!==void 0&&(gs=ns.max_group<gs?ns.max_group:gs),ns.max_last_group!==void 0&&(bs=ns.max_last_group<bs?ns.max_last_group:bs),is||fs!==os-1)if(ls)ys=subsets(ds,gs);else{ys=[];for(let vs=1;vs<=gs;vs++)ys.push(ds.slice(0,vs))}else{if(!(ds.length<=bs))return!1;ys=[ds]}for(let vs of ys){let Ns=as[fs][vs];if(Ns===void 0){let As=vs.reduce(function(ws,Es){return ws.concat([ts[Es]])},[]);As=As.length>1?[ss].concat(As):As[0],Ns=match$2(As,rs[fs],ns),as[fs][vs]=Ns}if(!Ns||!_$2.every(_$2.intersection(Object.keys(hs),Object.keys(Ns)),function(As){return equal(hs[As],Ns[As])}))continue;let Ts=Object.assign({},Ns);Object.assign(Ts,hs);let Cs=ds.filter(As=>!vs.includes(As));if(fs===os-1)return{matches:Ts,skipped:Cs.reduce(function(As,ws){return As.concat([ts[ws]])},[])};let xs=us(Cs,fs+1,Ts);if(xs)return xs}return!1}ns.allow_permutations&&(ss==="*"?ls=![...ts,...rs].some(ds=>["tuple","list","vector","altvector","interval","set","array","matrix"].includes(ds[0])):ss!=="+"&&ss!=="="&&ss!=="and"&&ss!=="or"&&ss!=="ne"&&ss!=="union"&&ss!=="intersect"||(ls=!0));var cs={},ps=[...Array(ts.length).keys()];if(ls){let ds=us(ps,0,{});return!!ds&&(cs=ds.matches,ds.skipped.length>0&&(cs._skipped=ds.skipped),cs)}{let ds,fs=is?ts.length-os:0,hs=[];for(let ys=0;ys<=fs&&(ds=us(ps,0,{}),!ds);ys++)ps=ps.slice(1),hs.push(ts[ys]);return!!ds&&(cs=ds.matches,ds.skipped.length>0&&(cs._skipped=ds.skipped),hs.length>0&&(cs._skipped_before=hs),cs)}}function matchImplicitIdentity(ss,ts,rs){var ns=ts[0],is=ts.slice(1);if(ns!=="+"&&ns!=="*"&&ns!=="^")return!1;var as=[];for(let os=0;os<is.length;os++){let ls=is[os];typeof ls=="string"&&rs.allow_implicit_identities.includes(ls)&&as.push(ls)}if(as.length===0)return!1;for(let os of as){let ls=match_one_implicit_identity(ss,ts,rs,os);if(ls)return ls}return!1}function match_one_implicit_identity(ss,ts,rs,ns){var is=ts[0],as=ts.slice(1),os={};os[ns]=is==="+"?0:1,is==="*"&&as.includes(ns)&&Array.isArray(ss)&&ss[0]==="-"&&(os[ns]=-1,ss=ss[1]);var ls=as.indexOf(ns);if(as.splice(ls,1),is==="^"&&ls===0)return!1;ts=as.length===1?as[0]:[is].concat(as);var us=match$2(ss,ts,rs);return!!us&&!(ns in us&&!equal(us[ns],os[ns]))&&(Object.assign(os,us),os)}const substitute$1=function(ss,ts){return typeof ss=="number"||typeof ss=="boolean"?ss:typeof ss=="string"?ts[ss]!==void 0?deepClone$1(ts[ss]):ss:Array.isArray(ss)?[ss[0]].concat(ss.slice(1).map(function(rs){return substitute$1(rs,ts)})):[]},transform=function(ss,ts){if(Array.isArray(ss)){let rs=[ss[0]];for(let ns=1;ns<ss.length;ns++)rs.push(transform(ss[ns],ts));return ts(rs)}return ts(ss)},applyAllTransformations=function(ss,ts,rs){rs===void 0&&(rs=5);for(var ns,is=ss;rs>0;rs--){ns=is;for(let as=0;as<ts.length;as++){let os=ts[as][0],ls=ts[as][1],us=ts[as][2];us===void 0&&(us={}),is=transform(is,function(cs){let ps=match$2(cs,os,us);if(ps){let ds=substitute$1(ls,ps);us.evaluate_numbers&&(ds=evaluate_numbers(ds,{max_digits:us.max_digits}));let fs=[],hs=[];return ps._skipped&&(fs=ps._skipped),ps._skipped_before&&(hs=ps._skipped_before),(hs.length>0||fs.length>0)&&(Array.isArray(ds)&&(ds=ds[0]===os[0]?ds.slice(1):[ds]),ds=[os[0]].concat(hs,ds,fs)),us.evaluate_numbers&&(ds=evaluate_numbers(ds,{max_digits:us.max_digits})),ds}return cs})}if(equal(ns,is))return is}return is};var math=math$1;const operators$2={"+":function(ss){return ss.length===1?ss[0]:new math.OperatorNode("+","add",ss)},"*":function(ss){return new math.OperatorNode("*","multiply",ss)},"/":function(ss){return new math.OperatorNode("/","divide",ss)},"-":function(ss){return new math.OperatorNode("-","unaryMinus",[ss[0]])},"^":function(ss){return new math.OperatorNode("^","pow",ss)},vector:function(ss){return new math.ArrayNode(ss)},altvector:function(ss){return new math.ArrayNode(ss)},and:function(ss){return new math.OperatorNode("and","and",ss)},or:function(ss){return new math.OperatorNode("or","or",ss)},not:function(ss){return new math.OperatorNode("not","not",[ss[0]])},"<":function(ss){return new math.OperatorNode("<","smaller",ss)},">":function(ss){return new math.OperatorNode(">","larger",ss)},le:function(ss){return new math.OperatorNode("<=","smallerEq",ss)},ge:function(ss){return new math.OperatorNode(">=","largerEq",ss)},ne:function(ss){return new math.OperatorNode("!=","unequal",ss)},binom:function(ss){const ts=new math.SymbolNode("combinations");return new math.FunctionNode(ts,ss)}},functionConverstions={nCr:"combinations",nPr:"permutations",binom:"combinations"};class astToMathjs$1{constructor({mathjs:ts=null}={}){ts&&(math=ts)}convert(ts){if(typeof ts=="number")return Number.isFinite(ts)?new math.ConstantNode(ts):Number.isNaN(ts)?new math.SymbolNode("NaN"):ts<0?operators$2["-"]([new math.SymbolNode("Infinity")]):new math.SymbolNode("Infinity");if(typeof ts=="string")return new math.SymbolNode(ts);if(typeof ts=="boolean")throw Error("no support for boolean");if(!Array.isArray(ts))throw Error("Invalid ast");const rs=ts[0],ns=ts.slice(1);if(rs==="apply"){if(typeof ns[0]!="string")throw Error("Non string functions not implemented for conversion to mathjs");if(ns[0]==="factorial")return new math.OperatorNode("!","factorial",[this.convert(ns[1])]);let is=functionConverstions[ns[0]];is||(is=ns[0]);const as=new math.SymbolNode(is),os=ns[1];let ls;return ls=os[0]==="tuple"?os.slice(1).map(function(us,cs){return this.convert(us)}.bind(this)):[this.convert(os)],new math.FunctionNode(as,ls)}if(rs==="lts"||rs==="gts"){const is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");const os=is.slice(1).map(function(cs,ps){return this.convert(cs)}.bind(this));let ls=[];for(let cs=1;cs<is.length-1;cs++)as[cs]?rs==="lts"?ls.push(new math.OperatorNode("<","smaller",os.slice(cs-1,cs+1))):ls.push(new math.OperatorNode(">","larger",os.slice(cs-1,cs+1))):rs==="lts"?ls.push(new math.OperatorNode("<=","smallerEq",os.slice(cs-1,cs+1))):ls.push(new math.OperatorNode(">=","largerEq",os.slice(cs-1,cs+1)));let us=new math.OperatorNode("and","and",ls.slice(0,2));for(let cs=2;cs<ls.length;cs++)us=new math.OperatorNode("and","and",[us,ls[cs]]);return us}if(rs==="="){let is=ns.map(function(ls,us){return this.convert(ls)}.bind(this)),as=[];for(let ls=1;ls<is.length;ls++)as.push(new math.OperatorNode("==","equal",is.slice(ls-1,ls+1)));if(as.length===1)return as[0];let os=new math.OperatorNode("and","and",as.slice(0,2));for(let ls=2;ls<as.length;ls++)os=new math.OperatorNode("and","and",[os,as[ls]]);return os}if(rs==="in"||rs==="notin"||rs==="ni"||rs==="notni"){let is,as;if(rs==="in"||rs==="notin"?(is=ns[0],as=ns[1]):(is=ns[1],as=ns[0]),typeof is!="number"&&typeof is!="string")throw Error("Set membership non-string variables not implemented for conversion to mathjs");if(is=this.convert(is),as[0]!=="interval")throw Error("Set membership in non-intervals not implemented for conversion to mathjs");let os=as[1],ls=as[2];if(os[0]!=="tuple"||ls[0]!=="tuple")throw new Error("Badly formed ast");let us=this.convert(os[1]),cs=this.convert(os[2]),ps=[];ls[1]?ps.push(new math.OperatorNode(">=","largerEq",[is,us])):ps.push(new math.OperatorNode(">","larger",[is,us])),ls[2]?ps.push(new math.OperatorNode("<=","smallerEq",[is,cs])):ps.push(new math.OperatorNode("<","smaller",[is,cs]));let ds=new math.OperatorNode("and","and",ps);return rs!=="notin"&&rs!=="notni"||(ds=new math.OperatorNode("not","not",[ds])),ds}if(rs==="subset"||rs==="notsubset"||rs==="superset"||rs==="notsuperset"){let is,as;if(rs==="subset"||rs==="notsubset"?(as=ns[0],is=ns[1]):(as=ns[1],is=ns[0]),as[0]!=="interval"||is[0]!=="interval")throw Error("Set containment of non-intervals not implemented for conversion to mathjs");let os=as[1],ls=as[2],us=is[1],cs=is[2];if(os[0]!=="tuple"||ls[0]!=="tuple"||us[0]!=="tuple"||cs[0]!=="tuple")throw Error("Badly formed ast");let ps=this.convert(os[1]),ds=this.convert(os[2]),fs=this.convert(us[1]),hs=this.convert(us[2]),ys=[];ls[1]&&!cs[1]?ys.push(new math.OperatorNode(">","larger",[ps,fs])):ys.push(new math.OperatorNode(">=","largerEq",[ps,fs])),ls[2]&&!cs[2]?ys.push(new math.OperatorNode("<","smaller",[ds,hs])):ys.push(new math.OperatorNode("<=","smallerEq",[ds,hs]));let gs=new math.OperatorNode("and","and",ys);return rs!=="notsubset"&&rs!=="notsuperset"||(gs=new math.OperatorNode("not","not",[gs])),gs}if(rs==="matrix"){let is=ns[0],as=is[1],os=is[2],ls=ns[1];if(!Number.isInteger(as)||!Number.isInteger(os))throw Error("Matrix must have integer dimensions");let us=[];for(let cs=1;cs<=as;cs++){let ps=[];for(let ds=1;ds<=os;ds++)ps.push(this.convert(ls[cs][ds]));us.push(new math.ArrayNode(ps))}return new math.ArrayNode(us)}if(rs in operators$2)return operators$2[rs](ns.map(function(is,as){return this.convert(is)}.bind(this)));throw Error("Operator "+rs+" not implemented for conversion to mathjs")}}var function_normalizations={ln:"log",arccos:"acos",arccosh:"acosh",arcsin:"asin",arcsinh:"asinh",arctan:"atan",arctanh:"atanh",arcsec:"asec",arcsech:"asech",arccsc:"acsc",arccsch:"acsch",arccot:"acot",arccoth:"acoth",cosec:"csc"},create_trig_inverses_for=["cos","cosh","sin","sinh","tan","tanh","sec","sech","csc","csch","cot","coth"],move_exponents_outside_for=["cos","cosh","sin","sinh","tan","tanh","sec","sech","csc","csch","cot","coth"];function normalize_function_names(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(rs==="apply"){if(ns[0]==="sqrt")return["^",normalize_function_names(ns[1]),.5];var is=normalize_function_names_sub(ns[0]);is=["apply",is];var as=ns.slice(1).map(function(os){return normalize_function_names(os)});return as=as.length>1?["tuple"].concat(as):as[0],is.push(as),is}return rs==="^"&&ns[0]==="e"&&math$1.define_e?["apply","exp",normalize_function_names(ns[1])]:rs==="binom"?["apply","nCr",["tuple",normalize_function_names(ns[0]),normalize_function_names(ns[1])]]:[rs].concat(ns.map(function(os){return normalize_function_names(os)}))}function normalize_function_names_sub(ss){if(typeof ss=="string")return ss in function_normalizations?function_normalizations[ss]:ss;if(!Array.isArray(ss))return ss;var ts=ss[0],rs=ss.slice(1);if(ts==="^"&&rs.length===2&&rs[1]===-1){let ns=normalize_function_names_sub(rs[0]);if(create_trig_inverses_for.includes(ns))return"a"+ns}return[ts].concat(rs.map(function(ns){return normalize_function_names_sub(ns)}))}function normalize_applied_functions(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(rs==="apply"){let is=ns[0];if(is[0]==="^"){let ls=is[1],us=is[2];return us!==-1&&move_exponents_outside_for.includes(ls)?["^",["apply",ls,normalize_applied_functions(ns[1])],us]:["apply",is,normalize_applied_functions(ns[1])]}let as=0;for(;is[0]==="prime";)as+=1,is=is[1];let os=["apply",is,normalize_applied_functions(ns[1])];for(let ls=0;ls<as;ls++)os=["prime",os];return os}return[rs].concat(ns.map(function(is,as){return normalize_applied_functions(is)}))}function log_subscript_to_two_arg_log(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);if(rs==="apply"&&ns.length===2){let is=ns[0];if(Array.isArray(is)&&is.length===3&&is[0]==="_"&&is[1]==="log")return["apply","log",["tuple",ns[1],is[2]]]}return[rs,...ns.map(log_subscript_to_two_arg_log)]}function substitute_abs(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);return rs==="apply"&&ns[0]==="abs"?["^",["^",substitute_abs(ns[1]),2],.5]:[rs].concat(ns.map(function(is){return substitute_abs(is)}))}function constants_to_floats(ss){var ts=get_tree(ss);if(!math$1.define_e&&!math$1.define_pi)return ts;if(typeof ts=="string"){if(ts==="e"){if(math$1.define_e)return math$1.e}else if(ts==="pi"&&math$1.define_pi)return math$1.pi;return ts}if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);return rs==="^"&&ns[0]==="e"?["^","e",constants_to_floats(ns[1])]:[rs,...ns.map(constants_to_floats)]}function normalize_angle_linesegment_arg_order(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);return rs==="angle"&&ns.length===3&&compare_function(ns[0],ns[2])===1||rs==="linesegment"&&ns.length===2&&compare_function(ns[0],ns[1])===1?(ns.reverse(),[rs,...ns]):ts}var astToMathjs=new astToMathjs$1({mathjs:math$1});const f$2=function(ss){var ts=get_tree(ss),rs=factorial_to_gamma_function(astToMathjs.convert(log_subscript_to_two_arg_log(normalize_function_names(normalize_applied_functions(ts)))));return rs.evaluate.bind(rs)},evaluate=function(ss,ts){return f$2(ss)(ts)},evaluate_to_constant=function(ss,ts=!0,rs=!0){var ns=get_tree(ss);if(ts&&(ns=remove_units(ns,rs)),typeof ns=="number")return ns;if(typeof ns=="string")return ns==="pi"&&math$1.define_pi?Math.PI:ns==="e"&&math$1.define_e?Math.E:ns==="i"&&math$1.define_i?{re:0,im:1}:null;if(!Array.isArray(ns))return null;var is=null;try{is=f$2(ns)()}catch{}return is};function factorial_to_gamma_function(ss){return ss.transform(function(ts,rs,ns){if(ts.isOperatorNode&&ts.op==="!"&&ts.fn==="factorial"){var is=[new math$1.OperatorNode("+","add",[ts.args[0],new math$1.ConstantNode(1)])];return new math$1.FunctionNode(new math$1.SymbolNode("gamma"),is)}return ts})}var evaluation=Object.freeze({__proto__:null,f:f$2,evaluate,evaluate_to_constant}),functions={C:{},R:{},nonzeroC:{},nonneg:{},pos:{}};function negate_adjust(ss,ts){return ss?!ts:ss===!1?ts:void 0}function narrow_assumptions(ss,ts){if(!Array.isArray(ts))return[];var rs=ts[0],ns=ts.slice(1);if(rs!=="and")return[];for(var is=[],as=0;as<ns.length;as++)equal(ns[as],ss)||is.push(ns[as]);return is.length===0?[]:is.legnth===1?is[0]:[rs].concat(is)}function simple_assumption_combination(ss,ts,rs){return ss==="and"?ts===void 0?rs:rs===void 0?ts:ts||rs:ts!==void 0&&rs!==void 0&&ts===rs?ts:void 0}function is_integer_ast(ss,ts,rs){if(typeof ts!="object"&&(ts=[]),rs===void 0&&(rs=ts),typeof ss=="number")return Number.isInteger(ss);var ns=evaluate_to_constant(ss,!1);if(ns!==null)return Number.isInteger(ns);if(typeof ss=="string"){let is;if(is=Array.isArray(ts)?ts:ts.get_assumptions(ss),!Array.isArray(is))return;let as=is,os=is[0],ls=is.slice(1),us=!1;for(;os==="not";){if(us=!us,is=ls[0],!Array.isArray(is))return;os=is[0],ls=is.slice(1)}if(os==="in"&&ls[0]===ss&&ls[1]==="Z")return negate_adjust(!0,us);if(os==="notin"&&ls[0]===ss&&ls[1]==="Z")return negate_adjust(!1,us);if(us===!1){if(os==="notin"&&(ls[0]===ss&&ls[1]==="R"||ls[0]===ss&&ls[1]==="C"))return!1}else if(os==="in"&&(ls[0]===ss&&ls[1]==="R"||ls[0]===ss&&ls[1]==="Z"))return!1;if(os==="="&&!us||os==="ne"&&us){let cs=narrow_assumptions(as,rs);if(ls[0]===ss)return is_integer_ast(ls[1],cs);if(ls[1]===ss)return is_integer_ast(ls[0],cs)}return os!=="and"&&os!=="or"||us?void 0:(ls.length>2&&(is=unflattenRight(is),ls=is.slice(1)),simple_assumption_combination(os,is_integer_ast(ss,ls[0],rs),is_integer_ast(ss,ls[1],rs)))}if(Array.isArray(ss)){let is;is=Array.isArray(ts)?ts:ts.get_assumptions([variables(ss)]);let as=ss[0],os=ss.slice(1);if(as==="-")return is_integer_ast(os[0],is,rs);if(as==="*")return!!os.every(function(ls){return is_integer_ast(ls,is,rs)})||void 0;if(as==="^"){let ls=is_nonzero_ast(os[0],is,rs);if(ls){if(is_nonzero_ast(os[1],is,rs)===!1)return os[0]!==1/0&&os[0]!==-1/0}else{if(Number.isNaN(os[0]))return!1;if(!is_positive_ast(os[1],is,!0,rs))return;if(ls===!1)return!0}let us=is_integer_ast(os[0],is,rs),cs=is_integer_ast(os[1],is,rs);return us&&(cs&&!!is_positive_ast(os[1],is,!1,rs)||void 0)}if(as==="+"){let ls=0;for(let us=0;us<os.length;us++){let cs=is_integer_ast(os[us],is,rs);if(cs===!1){if(ls>0)return;ls+=1}if(cs===void 0)return}return ls===0}return as==="apply"?!!(functions.C.Z&&functions.C.Z.includes(os[0])&&is_complex_ast(os[1],is,rs))||!!(functions.R.Z&&functions.R.Z.includes(os[0])&&is_real_ast(os[1],is,rs))||!!(functions.nonzeroC.Z&&functions.nonzeroC.Z.includes(os[0])&&is_nonzero_ast(os[1],is,rs)&&is_complex_ast(os[1],is,rs))||!!(functions.nonneg.Z&&functions.nonneg.Z.includes(os[0])&&is_positive_ast(os[1],is,!1,rs))||!!(functions.pos.Z&&functions.pos.Z.includes(os[0])&&is_positive_ast(os[1],is,!0,rs))||void 0:as==="/"||as==="prime"?void 0:!1}return!1}function is_real_ast(ss,ts,rs){if(typeof ts!="object"&&(ts=[]),rs===void 0&&(rs=ts),typeof ss=="number")return Number.isFinite(ss);var ns=evaluate_to_constant(ss,!1);if(ns!==null)return typeof ns=="number"&&Number.isFinite(ns);if(typeof ss=="string"){let is;if(is=Array.isArray(ts)?ts:ts.get_assumptions(ss),!Array.isArray(is))return;let as=is,os=is[0],ls=is.slice(1),us=!1;for(;os==="not";){if(us=!us,is=ls[0],!Array.isArray(is))return;os=is[0],ls=is.slice(1)}if(os==="in"&&ls[0]===ss&&ls[1]==="R")return negate_adjust(!0,us);if(os==="notin"&&ls[0]===ss&&ls[1]==="R")return negate_adjust(!1,us);if(us===!1){if(os==="in"&&ls[0]===ss&&ls[1]==="Z")return!0}else if(os==="notin"&&ls[0]===ss&&ls[1]==="Z")return!0;if(os==="<"||os==="le"){let cs=variables(is),ps=functions$2(is);if(cs.indexOf(ss)!==-1&&ps.length===0)return!0}if(os==="="&&!us||os==="ne"&&us){let cs=narrow_assumptions(as,rs);if(ls[0]===ss)return is_real_ast(ls[1],cs);if(ls[1]===ss)return is_real_ast(ls[0],cs)}return os!=="and"&&os!=="or"||us?void 0:(ls.length>2&&(is=unflattenRight(is),ls=is.slice(1)),simple_assumption_combination(os,is_real_ast(ss,ls[0],rs),is_real_ast(ss,ls[1],rs)))}if(Array.isArray(ss)){let is;is=Array.isArray(ts)?ts:ts.get_assumptions([variables(ss)]);let as=ss[0],os=ss.slice(1);if(as==="-")return is_real_ast(os[0],is,rs);if(as==="*"||as==="+"){if(os.length>2&&(os=(ss=unflattenRight(ss)).slice(1)),as==="*"&&(is_nonzero_ast(os[0],is,rs)===!1||is_nonzero_ast(os[1],is,rs)===!1))return!0;let ls=is_real_ast(os[0],is,rs),us=is_real_ast(os[1],is,rs);return!(!ls||!us)||!(ls&&us===!1||us&&ls===!1)&&void 0}if(as==="^"){let ls=is_nonzero_ast(os[0],is,rs),us=is_positive_ast(os[1],is,!0,rs);if(ls){if(is_nonzero_ast(os[1],is,rs)===!1)return os[0]!==1/0&&os[0]!==-1/0}else{if(Number.isNaN(os[0]))return!1;if(!us)return;if(ls===!1)return!0}let cs=is_real_ast(os[0],is,rs),ps=is_real_ast(os[1],is,rs);return!cs||!ps?void 0:is_positive_ast(os[0],is,!1,rs)?!!is_positive_ast(os[0],is,!0,rs)||!!us||void 0:!!is_integer_ast(os[1],is,rs)||void 0}return as==="/"?is_nonzero_ast(os[1],is,rs)?is_nonzero_ast(os[0],is,rs)===!1?!0:!is_real_ast(os[0],is,rs)||!is_real_ast(os[1],is,rs)?void 0:!0:void 0:as==="apply"?!!(functions.C.R&&functions.C.R.includes(os[0])&&is_complex_ast(os[1],is,rs))||!!(functions.R.R&&functions.R.R.includes(os[0])&&is_real_ast(os[1],is,rs))||!!(functions.nonzeroC.R&&functions.nonzeroC.R.includes(os[0])&&is_nonzero_ast(os[1],is,rs)&&is_complex_ast(os[1],is,rs))||!!(functions.nonneg.R&&functions.nonneg.R.includes(os[0])&&is_positive_ast(os[1],is,!1,rs))||!!(functions.pos.R&&functions.pos.R.includes(os[0])&&is_positive_ast(os[1],is,!0,rs))||void 0:as==="prime"?void 0:!1}return!1}function is_complex_ast(ss,ts,rs){if(typeof ts!="object"&&(ts=[]),rs===void 0&&(rs=ts),typeof ss=="number")return Number.isFinite(ss);var ns=evaluate_to_constant(ss,!1);if(ns!==null)return typeof ns=="number"?Number.isFinite(ns):!(ns.re===void 0||!Number.isFinite(ns.re)||ns.im===void 0||!Number.isFinite(ns.im));if(typeof ss=="string"){let is;if(is=Array.isArray(ts)?ts:ts.get_assumptions(ss),!Array.isArray(is))return;let as=is,os=is[0],ls=is.slice(1),us=!1;for(;os==="not";){if(us=!us,is=ls[0],!Array.isArray(is))return;os=is[0],ls=is.slice(1)}if(os==="in"&&ls[0]===ss&&ls[1]==="C")return negate_adjust(!0,us);if(os==="notin"&&ls[0]===ss&&ls[1]==="C")return negate_adjust(!1,us);if(us===!1){if(os==="in"&&(ls[0]===ss&&ls[1]==="Z"||ls[0]===ss&&ls[1]==="R"))return!0}else if(os==="notin"&&(ls[0]===ss&&ls[1]==="Z"||ls[0]===ss&&ls[1]==="R"))return!0;if(os==="<"||os==="le"){let cs=variables(is),ps=functions$2(is);if(cs.indexOf(ss)!==-1&&ps.length===0)return!0}if(os==="="&&!us||os==="ne"&&us){let cs=narrow_assumptions(as,rs);if(ls[0]===ss)return is_complex_ast(ls[1],cs);if(ls[1]===ss)return is_complex_ast(ls[0],cs)}return os!=="and"&&os!=="or"||us?void 0:(ls.length>2&&(is=unflattenRight(is),ls=is.slice(1)),simple_assumption_combination(os,is_complex_ast(ss,ls[0],rs),is_complex_ast(ss,ls[1],rs)))}if(Array.isArray(ss)){let is;is=Array.isArray(ts)?ts:ts.get_assumptions([variables(ss)]);let as=ss[0],os=ss.slice(1);if(as==="-")return is_complex_ast(os[0],is,rs);if(as==="*"||as==="+")return as==="*"&&!os.every(ls=>is_nonzero_ast(ls,is,rs)!==!1)?!0:!!os.every(ls=>is_complex_ast(ls,is,rs))||void 0;if(as==="^"){let ls=is_nonzero_ast(os[0],is,rs),us=is_positive_ast(os[1],is,!0,rs);if(ls){if(is_nonzero_ast(os[1],is,rs)===!1)return os[0]!==1/0&&os[0]!==-1/0}else{if(Number.isNaN(os[0]))return!1;if(!us)return;if(ls===!1)return!0}let cs=is_complex_ast(os[0],is,rs),ps=is_complex_ast(os[1],is,rs);return!(!cs||!ps)||void 0}return as==="/"?is_nonzero_ast(os[1],is,rs)?is_nonzero_ast(os[0],is,rs)===!1?!0:!is_complex_ast(os[0],is,rs)||!is_complex_ast(os[1],is,rs)?void 0:!0:void 0:as==="apply"?!!(functions.C.C&&functions.C.C.includes(os[0])&&is_complex_ast(os[1],is,rs))||!!(functions.R.C&&functions.R.C.includes(os[0])&&is_real_ast(os[1],is,rs))||!!(functions.nonzeroC.C&&functions.nonzeroC.C.includes(os[0])&&is_nonzero_ast(os[1],is,rs)&&is_complex_ast(os[1],is,rs))||!!(functions.nonneg.C&&functions.nonneg.C.includes(os[0])&&is_positive_ast(os[1],is,!1,rs))||!!(functions.pos.C&&functions.pos.C.includes(os[0])&&is_positive_ast(os[1],is,!0,rs))||void 0:as==="prime"?void 0:!1}return!1}function is_nonzero_ast(ss,ts,rs){if(typeof ts!="object"&&(ts=[]),rs===void 0&&(rs=ts),typeof ss=="number")return Number.isFinite(ss)?ss!==0:Number.isNaN(ss)?void 0:!0;var ns=evaluate_to_constant(ss,!1);if(ns!==null)return typeof ns=="number"?Number.isFinite(ns)?ns!==0:Number.isNaN(ns)?void 0:!0:ns.re!==void 0&&ns.im!==void 0&&(ns.re!==0||ns.im!==0)||void 0;if(typeof ss=="string"){let is;if(is=Array.isArray(ts)?ts:ts.get_assumptions(ss),!Array.isArray(is))return;let as=is,os=is[0],ls=is.slice(1),us=!1;for(;os==="not";){if(us=!us,is=ls[0],!Array.isArray(is))return;os=is[0],ls=is.slice(1)}let cs=narrow_assumptions(as,rs);if(os==="="&&!us||os==="ne"&&us){if(ls[0]===ss)return is_nonzero_ast(ls[1],cs);if(ls[1]===ss)return is_nonzero_ast(ls[0],cs)}if((os==="ne"&&!us||os==="="&&us)&&(ls[0]===ss&&is_nonzero_ast(ls[1],cs)===!1||ls[1]===ss&&is_nonzero_ast(ls[0],cs)===!1))return!0;if(os==="<"){if(us){if(ls[0]===ss&&is_positive_ast(ls[1],cs,!0)||ls[1]===ss&&is_negative_ast(ls[0],cs,!0))return!0}else if(ls[0]===ss&&is_negative_ast(ls[1],cs,!1)||ls[1]===ss&&is_positive_ast(ls[0],cs,!1))return!0}if(os==="le"){if(us){if(ls[0]===ss&&is_positive_ast(ls[1],cs,!1)||ls[1]===ss&&is_negative_ast(ls[0],cs,!1))return!0}else if(ls[0]===ss&&is_negative_ast(ls[1],cs,!0)||ls[1]===ss&&is_positive_ast(ls[0],cs,!0))return!0}return os!=="and"&&os!=="or"||us?void 0:(ls.length>2&&(is=unflattenRight(is),ls=is.slice(1)),simple_assumption_combination(os,is_nonzero_ast(ss,ls[0],rs),is_nonzero_ast(ss,ls[1],rs)))}if(Array.isArray(ss)){let is;is=Array.isArray(ts)?ts:ts.get_assumptions([variables(ss)]);let as=ss[0],os=ss.slice(1);if(as==="-")return is_nonzero_ast(os[0],is,rs);if(as==="+"){if(os.length>2&&(os=(ss=unflattenRight(ss)).slice(1)),equal(os[0],simplify(["-",os[1]],rs)))return!1;let ls=is_nonzero_ast(os[0],is,rs),us=is_nonzero_ast(os[1],is,rs);if(ls===!1)return us;if(us===!1)return ls;let cs=is_real_ast(os[0],is,rs),ps=is_real_ast(os[1],is,rs);if(!cs||!ps)return cs===!0?ps===!1||void 0:ps===!0&&cs===!1||void 0;let ds=is_positive_ast(os[0],is,!1,rs),fs=is_positive_ast(os[1],is,!1,rs),hs=is_positive_ast(os[0],is,!0,rs),ys=is_positive_ast(os[1],is,!0,rs);return!!(ds&&ys||hs&&fs)||ds===!1&&ys===!1||hs===!1&&fs===!1||void 0}if(as==="*"){let ls=!0;for(let us=0;us<os.length;us++){let cs=is_nonzero_ast(os[us],is,rs);if(cs===!1)return!1;cs===void 0&&(ls=!1)}return!!ls||void 0}if(as==="/"){let ls=is_nonzero_ast(os[0],is,rs);return is_nonzero_ast(os[1],is,rs)?ls:void 0}if(as==="^"){let ls=is_nonzero_ast(os[0],is,rs);return ls?(os[0]===1/0||os[0]===-1/0)&&is_nonzero_ast(os[1],is,rs)===!1?void 0:!0:(!is_positive_ast(os[1],is,!0,rs)||ls!==!1)&&void 0}return as==="apply"?!!(functions.C.nonzero&&functions.C.nonzero.includes(os[0])&&is_complex_ast(os[1],is,rs))||!!(functions.R.nonzero&&functions.R.nonzero.includes(os[0])&&is_real_ast(os[1],is,rs))||!!(functions.nonzeroC.nonzero&&functions.nonzeroC.nonzero.includes(os[0])&&is_nonzero_ast(os[1],is,rs)&&is_complex_ast(os[1],is,rs))||!!(functions.nonneg.nonzero&&functions.nonneg.nonzero.includes(os[0])&&is_positive_ast(os[1],is,!1,rs))||!!(functions.pos.nonzero&&functions.pos.nonzero.includes(os[0])&&is_positive_ast(os[1],is,!0,rs))||void 0:as==="prime"?void 0:!1}return!1}function is_positive_ast(ss,ts,rs,ns){if(typeof ts!="object"&&(ts=[]),ns===void 0&&(ns=ts),rs===void 0&&(rs=!0),typeof ss=="number")return!!Number.isFinite(ss)&&(rs?ss>0:ss>=0);var is=is_real_ast(ss,ts,ns);if(!is)return is;var as=evaluate_to_constant(ss,!1);if(as!==null)return typeof as=="number"&&!!Number.isFinite(as)&&(rs?as>0:as>=0);if(typeof ss=="string"){let os;if(os=Array.isArray(ts)?ts:ts.get_assumptions(ss),!Array.isArray(os))return;let ls=os,us=os[0],cs=os.slice(1),ps=!1;for(;us==="not";){if(ps=!ps,os=cs[0],!Array.isArray(os))return;us=os[0],cs=os.slice(1)}let ds=narrow_assumptions(ls,ns);if(us==="="&&!ps||us==="ne"&&ps){if(cs[0]===ss)return is_positive_ast(cs[1],ds,rs);if(cs[1]===ss)return is_positive_ast(cs[0],ds,rs)}if(us==="<")if(ps){if(cs[0]===ss&&is_positive_ast(cs[1],ds,rs))return!0;if(cs[1]===ss&&is_negative_ast(cs[0],ds,!rs))return!1}else{if(cs[0]===ss&&is_negative_ast(cs[1],ds,!1))return!1;if(cs[1]===ss&&is_positive_ast(cs[0],ds,!1))return!0}if(us==="le")if(ps){if(cs[0]===ss&&is_positive_ast(cs[1],ds,!1))return!0;if(cs[1]===ss&&is_negative_ast(cs[0],ds,!1))return!1}else{if(cs[0]===ss&&is_negative_ast(cs[1],ds,!rs))return!1;if(cs[1]===ss&&is_positive_ast(cs[0],ds,rs))return!0}return us!=="and"&&us!=="or"||ps?void 0:(cs.length>2&&(os=unflattenRight(os),cs=os.slice(1)),simple_assumption_combination(us,is_positive_ast(ss,cs[0],rs,ns),is_positive_ast(ss,cs[1],rs,ns)))}if(Array.isArray(ss)){let os;os=Array.isArray(ts)?ts:ts.get_assumptions([variables(ss)]);let ls=ss[0],us=ss.slice(1);if(ls==="-")return is_negative_ast(us[0],os,rs,ns);if(ls==="+"){us.length>2&&(us=(ss=unflattenRight(ss)).slice(1));let cs=is_positive_ast(us[0],os,!1,ns),ps=is_positive_ast(us[1],os,!1,ns),ds=is_positive_ast(us[0],os,!0,ns),fs=is_positive_ast(us[1],os,!0,ns);if(rs){if(cs&&fs||ds&&ps)return!0}else if(cs&&ps)return!0;if(rs){if(ds===!1&&fs===!1)return!1}else if(cs===!1&&fs===!1||ds===!1&&ps===!1)return!1;return}if(ls==="*"){if(!us.every(gs=>is_nonzero_ast(gs,os,ns)!==!1))return!rs;us.length>2&&(us=(ss=unflattenRight(ss)).slice(1));let cs=is_real_ast(us[0],os,ns),ps=is_real_ast(us[1],os,ns);if(cs===void 0||ps===void 0)return;if(cs===!1)return ps===!1&&void 0;if(ps===!1)return!1;let ds=is_positive_ast(us[0],os,!1,ns),fs=is_positive_ast(us[1],os,!1,ns),hs=is_positive_ast(us[0],os,!0,ns),ys=is_positive_ast(us[1],os,!0,ns);if(rs){if(hs&&ys||ds===!1&&fs===!1)return!0;if(hs===!1&&fs||ds&&ys===!1)return!1}else{if(ds&&fs||hs===!1&&ys===!1)return!0;if(hs&&fs===!1||ds===!1&&ys)return!1}return}if(ls==="/"){if(!is_nonzero_ast(us[1],os,ns))return;if(is_nonzero_ast(us[0],os,ns)===!1)return!rs;let cs=is_positive_ast(us[1],os,!0,ns);if(cs===void 0)return;let ps=cs?rs:!rs,ds=is_positive_ast(us[0],os,ps,ns);return ds===void 0?void 0:ds===!0?cs===!0:cs!==!0}if(ls==="^"){let cs=is_nonzero_ast(us[0],os,ns);if(cs){if(is_nonzero_ast(us[1],os,ns)===!1)return us[0]===1/0||us[0]===-1/0?void 0:!0}else{if(!is_positive_ast(us[1],os,!0,ns))return;if(cs===!1)return!rs;if(rs)return}return is_real_ast(us[0],os,ns)!==!0?void 0:is_positive_ast(us[0],os,rs,ns)?!!is_real_ast(us[1],os,ns)||void 0:!!is_integer_ast(simplify(["/",us[1],2],ns),os,ns)||void 0}return ls==="apply"&&!rs?!!(functions.C.nonneg&&functions.C.nonneg.includes(us[0])&&is_complex_ast(us[1],os,ns))||!!(functions.R.nonneg&&functions.R.nonneg.includes(us[0])&&is_real_ast(us[1],os,ns))||!!(functions.nonzeroC.nonneg&&functions.nonzeroC.nonneg.includes(us[0])&&is_nonzero_ast(us[1],os,ns)&&is_complex_ast(us[1],os,ns))||!!(functions.nonneg.nonneg&&functions.nonneg.nonneg.includes(us[0])&&is_positive_ast(us[1],os,!1,ns))||!!(functions.pos.nonneg&&functions.pos.nonneg.includes(us[0])&&is_positive_ast(us[1],os,!0,ns))||void 0:ls==="apply"&&rs?!!(functions.C.pos&&functions.C.pos.includes(us[0])&&is_complex_ast(us[1],os,ns))||!!(functions.R.pos&&functions.R.pos.includes(us[0])&&is_real_ast(us[1],os,ns))||!!(functions.nonzeroC.pos&&functions.nonzeroC.pos.includes(us[0])&&is_nonzero_ast(us[1],os,ns)&&is_complex_ast(us[1],os,ns))||!!(functions.nonneg.pos&&functions.nonneg.pos.includes(us[0])&&is_positive_ast(us[1],os,!1,ns))||!!(functions.pos.pos&&functions.pos.pos.includes(us[0])&&is_positive_ast(us[1],os,!0,ns))||void 0:ls==="prime"?void 0:!1}return!1}function is_negative_ast(ss,ts,rs,ns){rs===void 0&&(rs=!0);var is=is_real_ast(ss,ts,ns);if(is===!0){let as=is_positive_ast(ss,ts,!rs,ns);return as===!1||as!==!0&&void 0}return is}function tuples_to_vectors(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(rs==="tuple")return["vector"].concat(ns.map(function(is,as){return tuples_to_vectors(is)}));if(rs==="apply"){if(ns[1][0]==="tuple"){let is=tuples_to_vectors(ns[0]),as=ns[1].slice(1);return["apply",is,["tuple"].concat(as.map(function(os,ls){return tuples_to_vectors(os)}))]}}else if(rs==="gts"||rs==="lts"||rs==="interval"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");return[rs,["tuple"].concat(is.slice(1).map(function(os,ls){return tuples_to_vectors(os)})),as]}return[rs].concat(ns.map(function(is,as){return tuples_to_vectors(is)}))}function to_intervals(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(rs==="tuple"&&ns.length===2){let is=["tuple"].concat(ns.map(function(as,os){return to_intervals(as)}));return is=["interval",is,["tuple",!1,!1]],is}if(rs==="array"&&ns.length===2){let is=["tuple"].concat(ns.map(function(as,os){return to_intervals(as)}));return is=["interval",is,["tuple",!0,!0]],is}if(rs==="apply"){if(ns[1][0]==="tuple"){let is=to_intervals(ns[0]),as=ns[1].slice(1);return["apply",is,["tuple"].concat(as.map(function(os,ls){return to_intervals(os)}))]}}else if(rs==="gts"||rs==="lts"||rs==="interval"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");return[rs,["tuple"].concat(is.slice(1).map(function(os,ls){return to_intervals(os)})),as]}return[rs].concat(ns.map(function(is,as){return to_intervals(is)}))}function altvectors_to_vectors(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);return rs==="altvector"?["vector"].concat(ns.map(function(is,as){return altvectors_to_vectors(is)})):[rs].concat(ns.map(function(is,as){return altvectors_to_vectors(is)}))}function ParseError(ss,ts){this.name="ParseError",this.message=ss||"Error parsing input",this.stack=new Error().stack,this.location=ts}functions.C.nonneg=["abs"],functions.C.nonzero=["exp"],functions.C.R=["abs","arg"],functions.C.C=["abs","arg","exp","sign","cos","cosh","sin","sinh","erf","sqrt","log","ln","log10"],functions.R.pos=["exp"],functions.R.nonneg=["abs","exp","arg"],functions.R.R=["abs","arg","exp","sign","cos","cosh","sin","sinh","erf"],functions.R.Z=["sign"],functions.nonzeroC.pos=["abs"],functions.nonneg.nonneg=["abs","exp","arg","sqrt","erf"],functions.nonzeroC.nonzero=["abs"],functions.nonneg.R=[...new Set(functions.R.R.concat(functions.nonneg.nonneg))],functions.pos.pos=["abs","exp","sqrt","erf"],functions.pos.nonneg=functions.pos.pos,functions.pos.nonzero=["abs","exp","sqrt","erf"],functions.pos.R=functions.nonneg.R.concat(["log","ln","log10"]),ParseError.prototype=Object.create(Error.prototype),ParseError.prototype.constructor=ParseError;class lexer{constructor(ts,rs="\\s"){this.input="",this.location=0,this.token_rules=[],this.initial_whitespace=new RegExp("^("+rs+")+");for(let ns of ts)this.token_rules.push([new RegExp("^"+ns[0])].concat(ns.slice(1)))}set_input(ts){if(typeof ts!="string")throw new Error("Input must be a string");this.input=ts,this.location=0}return_state(){return{input:this.input,location:this.location}}set_state({input:ts=null,location:rs=0}={}){ts!==null&&(this.input=ts,this.location=rs)}advance({remove_initial_space:ts=!0}={}){let rs=this.initial_whitespace.exec(this.input);if(rs){let is=rs[0].length;if(this.input=this.input.slice(is),this.location+=is,!ts)return{token_type:"SPACE",token_text:rs[0],original_text:rs[0]}}if(this.input.length===0)return{token_type:"EOF",token_text:"",original_text:""};for(var ns of(rs=null,this.token_rules))if(rs=ns[0].exec(this.input),rs){let is=rs[0].length;this.input=this.input.slice(is),this.location+=is;break}return rs===null?{token_type:"INVALID",token_text:this.input[0],original_text:this.input[0]}:ns.length>2?{token_type:ns[1],token_text:ns[2],original_text:rs[0]}:{token_type:ns[1],token_text:rs[0],original_text:rs[0]}}unput(ts){if(typeof ts!="string")throw new Error("Input must be a string");this.location-=ts.length,this.input=ts+this.input}}var is_associative={"+":!0,"*":!0,and:!0,or:!0,union:!0,intersect:!0};function flatten$6(ss){if(!Array.isArray(ss))return ss;var ts=ss[0],rs=ss.slice(1);if(rs=rs.map(function(as,os){return flatten$6(as)}),is_associative[ts]){for(var ns=[],is=0;is<rs.length;is++)Array.isArray(rs[is])&&rs[is][0]===ts&&rs[is].length>2?ns=ns.concat(rs[is].slice(1)):ns.push(rs[is]);rs=ns}return[ts].concat(rs)}const sci_notat_exp_regex$1="(E[+\\-]?[0-9]+\\s*($|(?=\\,|\\||\\)|\\}|\\])))?",number_rules_sci$1=[["[0-9]+(\\.[0-9]*)?"+sci_notat_exp_regex$1,"NUMBER"],["\\.[0-9]+"+sci_notat_exp_regex$1,"NUMBER"]],number_rules_non_sci$1=[["[0-9]+(\\.[0-9]*)?","NUMBER"],["\\.[0-9]+","NUMBER"]],base_text_rules=[["\\*\\*","^"],["\\*","*"],["\\xB7","*"],["","*"],["","*"],["","*"],["","*"],["/","/"],["-","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["\\+","+"],["\\^","^"],["","^"],["","^"],["\\|","|"],["\\(","("],["\\)",")"],["\\[","["],["\\]","]"],["\\{","{"],["\\}","}"],["","LANGLE"],["","RANGLE"],["","LANGLE"],["","RANGLE"],[",",","],[":",":"],["","VARMULTICHAR","alpha"],["","VARMULTICHAR","beta"],["","VARMULTICHAR","beta"],["","VARMULTICHAR","Gamma"],["","VARMULTICHAR","gamma"],["","VARMULTICHAR","Delta"],["","VARMULTICHAR","delta"],["","VARMULTICHAR","epsilon"],["","VARMULTICHAR","epsilon"],["","VARMULTICHAR","zeta"],["","VARMULTICHAR","eta"],["","VARMULTICHAR","Theta"],["","VARMULTICHAR","Theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","iota"],["","VARMULTICHAR","kappa"],["","VARMULTICHAR","Lambda"],["","VARMULTICHAR","lambda"],["","VARMULTICHAR","mu"],["","VARMULTICHAR","mu"],["","VARMULTICHAR","nu"],["","VARMULTICHAR","Xi"],["","VARMULTICHAR","xi"],["","VARMULTICHAR","Pi"],["","VARMULTICHAR","pi"],["","VARMULTICHAR","pi"],["","VARMULTICHAR","rho"],["","VARMULTICHAR","rho"],["","VARMULTICHAR","Sigma"],["","VARMULTICHAR","sigma"],["","VARMULTICHAR","sigma"],["","VARMULTICHAR","tau"],["","VARMULTICHAR","Upsilon"],["","VARMULTICHAR","upsilon"],["","VARMULTICHAR","Phi"],["","VARMULTICHAR","phi"],["","VARMULTICHAR","phi"],["","VARMULTICHAR","Psi"],["","VARMULTICHAR","psi"],["","VARMULTICHAR","Omega"],["","VARMULTICHAR","omega"],["oo(?![a-zA-Z0-9])","INFINITY"],["OO(?![a-zA-Z0-9])","INFINITY"],["infty(?![a-zA-Z0-9])","INFINITY"],["infinity(?![a-zA-Z0-9])","INFINITY"],["Infinity(?![a-zA-Z0-9])","INFINITY"],["","INFINITY"],["","VAR","e"],["","VARMULTICHAR","spade"],["","VARMULTICHAR","heart"],["","VARMULTICHAR","diamond"],["","VARMULTICHAR","club"],["","VARMULTICHAR","bigstar"],["","VARMULTICHAR","bigcirc"],["","VARMULTICHAR","lozenge"],["","VARMULTICHAR","bigtriangleup"],["","VARMULTICHAR","bigtriangledown"],["","VARMULTICHAR","blacklozenge"],["","VARMULTICHAR","blacksquare"],["","VARMULTICHAR","blacktriangle"],["","VARMULTICHAR","blacktriangledown"],["","VARMULTICHAR","blacktriangleleft"],["","VARMULTICHAR","blacktriangleright"],["","VARMULTICHAR","Box"],["","VARMULTICHAR","circ"],["","VARMULTICHAR","star"],["and(?![a-zA-Z0-9])","AND"],["\\&\\&?","AND"],["","AND"],["or(?![a-zA-Z0-9])","OR"],["","OR"],["not(?![a-zA-Z0-9])","NOT"],["","NOT"],["=","="],["","="],["","="],["!=","NE"],["","NE"],["<=","LE"],["","LE"],[">=","GE"],["","GE"],["<","<"],[">",">"],["forall(?![a-zA-Z0-9])","FORALL"],["","FORALL"],["exists(?![a-zA-Z0-9])","EXISTS"],["","EXISTS"],["elementof(?![a-zA-Z0-9])","IN"],["","IN"],["notelementof(?![a-zA-Z0-9])","NOTIN"],["","NOTIN"],["containselement(?![a-zA-Z0-9])","NI"],["","NI"],["notcontainselement(?![a-zA-Z0-9])","NOTNI"],["","NOTNI"],["subset(?![a-zA-Z0-9])","SUBSET"],["","SUBSET"],["subseteq(?![a-zA-Z0-9])","SUBSETEQ"],["","SUBSETEQ"],["notsubset(?![a-zA-Z0-9])","NOTSUBSET"],["","NOTSUBSET"],["notsubseteq(?![a-zA-Z0-9])","NOTSUBSETEQ"],["","NOTSUBSETEQ"],["superset(?![a-zA-Z0-9])","SUPERSET"],["","SUPERSET"],["superseteq(?![a-zA-Z0-9])","SUPERSETEQ"],["","SUPERSETEQ"],["notsuperset(?![a-zA-Z0-9])","NOTSUPERSET"],["","NOTSUPERSET"],["notsuperseteq(?![a-zA-Z0-9])","NOTSUPERSETEQ"],["","NOTSUPERSETEQ"],["union(?![a-zA-Z0-9])","UNION"],["","UNION"],["intersect(?![a-zA-Z0-9])","INTERSECT"],["","INTERSECT"],["perp(?![a-zA-Z0-9])","PERP"],["","PERP"],["parallel(?![a-zA-Z0-9])","PARALLEL"],["","PARALLEL"],["angle(?![a-zA-Z0-9])","ANGLE"],["","ANGLE"],["int(?![a-zA-Z0-9])","INT"],["","INT"],["!","!"],["'","'"],["_","_"],["\\.\\.\\.","LDOTS"],["[a-zA-Z][a-zA-Z0-9]*","VAR"],["[$%]","VAR"]],allowSimplifiedFunctionApplicationDefault$1=!0,splitSymbolsDefault=!0,unsplitSymbolsDefault=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","angle","deg"],appliedFunctionSymbolsDefault$1=["abs","exp","log","ln","log10","sign","sqrt","erf","cos","cosh","acos","acosh","arccos","arccosh","cot","coth","acot","acoth","arccot","arccoth","csc","csch","acsc","acsch","arccsc","arccsch","sec","sech","asec","asech","arcsec","arcsech","sin","sinh","asin","asinh","arcsin","arcsinh","tan","tanh","atan","atan2","atanh","arctan","arctanh","arg","conj","re","im","det","trace","nPr","nCr","floor","ceil","round"],functionSymbolsDefault$1=["f","g"],operatorSymbolsDefault$1=["binom","vec","linesegment"],unitsDefault$1=get_all_units(),parseLeibnizNotationDefault$1=!0;class textToAst$4{constructor({allowSimplifiedFunctionApplication:ts=allowSimplifiedFunctionApplicationDefault$1,splitSymbols:rs=splitSymbolsDefault,unsplitSymbols:ns=unsplitSymbolsDefault,appliedFunctionSymbols:is=appliedFunctionSymbolsDefault$1,functionSymbols:as=functionSymbolsDefault$1,operatorSymbols:os=operatorSymbolsDefault$1,units:ls=unitsDefault$1,parseLeibnizNotation:us=parseLeibnizNotationDefault$1,parseScientificNotation:cs=!0}={}){this.allowSimplifiedFunctionApplication=ts,this.splitSymbols=rs,this.unsplitSymbols=ns,this.appliedFunctionSymbols=is,this.functionSymbols=as,this.operatorSymbols=os,this.units=ls,this.parseLeibnizNotation=us;let ps=base_text_rules;ps=cs?[...number_rules_sci$1,...ps]:[...number_rules_non_sci$1,...ps],this.lexer=new lexer(ps)}advance(ts){if(this.token=this.lexer.advance(ts),this.token.token_type==="INVALID")throw new ParseError("Invalid symbol '"+this.token.original_text+"'",this.lexer.location)}return_state(){return{lexer_state:this.lexer.return_state(),token:Object.assign({},this.token)}}set_state(ts){this.lexer.set_state(ts.lexer_state),this.token=Object.assign({},ts.token)}convert(ts){this.lexer.set_input(ts),this.advance();var rs=this.statement_list();if(this.token.token_type!=="EOF")throw new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return flatten$6(rs)}statement_list(){for(var ts=[this.statement()];this.token.token_type===",";)this.advance(),ts.push(this.statement());return ts=ts.length>1?["list"].concat(ts):ts[0]}statement({inside_absolute_value:ts=0}={}){if(this.token.token_type==="LDOTS")return this.advance(),["ldots"];var rs;try{rs=this.return_state();let ns=this.statement_a({inside_absolute_value:ts});return this.token.token_type!==":"?ns:(this.advance(),[":",ns,this.statement_a()])}catch(ns){try{this.set_state(rs);let is=this.statement_a({parse_absolute_value:!1});if(this.token.token_type!=="|")throw ns;return this.advance(),["|",is,this.statement_a({parse_absolute_value:!1})]}catch{throw ns}}}statement_a({inside_absolute_value:ts=0,parse_absolute_value:rs=!0}={}){for(var ns=this.statement_b({inside_absolute_value:ts,parse_absolute_value:rs});this.token.token_type==="OR";){let is=this.token.token_type.toLowerCase();this.advance(),ns=[is,ns,this.statement_b({inside_absolute_value:ts,parse_absolute_value:rs})]}return ns}statement_b(ts){for(var rs=this.relation(ts);this.token.token_type==="AND";){let ns=this.token.token_type.toLowerCase();this.advance(),rs=[ns,rs,this.relation(ts)]}return rs}relation(ts){if(this.token.token_type==="NOT"||this.token.token_type==="!")return this.advance(),["not",this.relation(ts)];if(this.token.token_type==="FORALL"||this.token.token_type==="EXISTS"){let ns=this.token.token_type.toLowerCase();return this.advance(),[ns,this.relation(ts)]}for(var rs=this.expression(ts);this.token.token_type==="="||this.token.token_type==="NE"||this.token.token_type==="<"||this.token.token_type===">"||this.token.token_type==="LE"||this.token.token_type==="GE"||this.token.token_type==="IN"||this.token.token_type==="NOTIN"||this.token.token_type==="NI"||this.token.token_type==="NOTNI"||this.token.token_type==="SUBSET"||this.token.token_type==="NOTSUBSET"||this.token.token_type==="SUBSETEQ"||this.token.token_type==="NOTSUBSETEQ"||this.token.token_type==="SUPERSET"||this.token.token_type==="NOTSUPERSET"||this.token.token_type==="SUPERSETEQ"||this.token.token_type==="NOTSUPERSETEQ";){let ns=this.token.token_type.toLowerCase(),is=0;this.token.token_type==="<"||this.token.token_type==="LE"?is=-1:this.token.token_type!==">"&&this.token.token_type!=="GE"||(is=1),this.advance();let as=this.expression(ts);if(is===-1)if(this.token.token_type==="<"||this.token.token_type==="LE"){let os=["tuple"];ns==="<"?os.push(!0):os.push(!1);let ls=["tuple",rs,as];for(;this.token.token_type==="<"||this.token.token_type==="LE";)this.token.token_type==="<"?os.push(!0):os.push(!1),this.advance(),ls.push(this.expression(ts));rs=["lts",ls,os]}else rs=[ns,rs,as];else if(is===1)if(this.token.token_type===">"||this.token.token_type==="GE"){let os=["tuple"];ns===">"?os.push(!0):os.push(!1);let ls=["tuple",rs,as];for(;this.token.token_type===">"||this.token.token_type==="GE";)this.token.token_type===">"?os.push(!0):os.push(!1),this.advance(),ls.push(this.expression(ts));rs=["gts",ls,os]}else rs=[ns,rs,as];else if(ns==="=")for(rs=["=",rs,as];this.token.token_type==="=";)this.advance(),rs.push(this.expression(ts));else rs=[ns,rs,as]}return rs}expression(ts){let rs=!1;this.token.token_type==="+"&&(rs=!0,this.advance());let ns=!1;this.token.token_type==="-"&&(ns=!0,this.advance());var is=this.term(ts);if(ns||rs){if(is===!1)return(rs?"+":"")+(ns?"-":"");if(typeof is=="string"&&[...is].every(as=>["+","-"].includes(as)))return(rs?"+":"")+(ns?"-":"")+is}for(is===!1&&(is=""),ns&&(is=is>0?-is:["-",is]),rs&&(is=["+",is]);["+","-","UNION","INTERSECT","PERP","PARALLEL"].includes(this.token.token_type);){let as=this.token.token_type.toLowerCase(),os=!1,ls=!1;this.token.token_type==="-"?(as="+",os=!0,this.advance()):(this.advance(),as==="+"&&this.token.token_type==="-"&&(os=!0,ls=!0,this.advance()));let us=this.term(ts);if(as==="+"){if(us===!1&&(typeof is=="number"||typeof is=="string"))return ls?is+"+-":os?is+"-":is+"+";if(typeof us=="string"&&[...us].every(cs=>["+","-"].includes(cs))&&(typeof is=="number"||typeof is=="string"))return ls?is+"+-"+us:os?is+"-"+us:is+"+"+us}us===!1&&(us=""),os&&(us=us>0?-us:["-",us]),is=[as,is,us]}return is}term(ts){var rs=this.factor(ts),ns=!1;do if(ns=!1,this.token.token_type==="*"){this.advance(),rs===!1&&(rs="");let is=this.factor(ts);is===!1&&(is=""),rs=["*",rs,is],ns=!0}else if(this.token.token_type==="/"){this.advance(),rs===!1&&(rs="");let is=this.factor(ts);is===!1&&(is=""),rs=["/",rs,is],ns=!0}else{let is=Object.assign({},ts);is.allow_absolute_value_closing=!0;let as=this.nonMinusFactor(is);as!==!1&&(rs===!1&&(rs=""),rs=["*",rs,as],ns=!0)}while(ns);return this.convert_units_in_term(flatten$6(rs))}convert_units_in_term(ts){if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);if(rs==="*"){let is=ns.length;for(let[as,os]of ns.entries()){let ls=this.units[os];if(ls){if(ls.prefix&&as<is-1){let us;us=as===is-2?ns[is-1]:this.convert_units_in_term(["*",...ns.slice(as+1)]);let cs=os;ls.substitute&&(cs=ls.substitute);let ps=["unit",cs,us];return as===0?ps:["*",...ns.slice(0,as),ps]}if(!ls.prefix&&as>0){let us,cs=os;return ls.substitute&&(cs=ls.substitute),us=as===1?["unit",ns[0],cs]:["unit",["*",...ns.slice(0,as)],cs],as===is-1?us:this.convert_units_in_term(["*",us,...ns.slice(as+1)])}}}return ts}return rs==="/"?["/",this.convert_units_in_term(ns[0]),this.convert_units_in_term(ns[1])]:ts}factor(ts){if(this.token.token_text==="+"){this.advance();let ns=this.factor(ts);return ns===!1?"+":typeof ns=="string"&&[...ns].every(is=>["+","-"].includes(is))?"+"+ns:["+",ns]}if(this.token.token_type==="-"){this.advance();let ns=this.factor(ts);return ns>0?-ns:ns===!1?"-":typeof ns=="string"&&[...ns].every(is=>["+","-"].includes(is))?"-"+ns:["-",ns]}let rs=this.nonMinusFactor(ts);return rs===!1&&this.token.token_type==="PERP"&&(rs="perp",this.advance()),rs}nonMinusFactor(ts){for(var rs=this.baseFactor(ts);this.token.token_type==="^"||this.token.token_type==="!"||this.token.token_type==="'";)rs===!1&&(rs=""),this.token.token_type==="^"?(this.advance(),rs=["^",rs,this.get_subsuperscript(ts)]):this.token.token_type==="!"?(rs=["apply","factorial",rs],this.advance()):(rs=["prime",rs],this.advance());return rs}get_subsuperscript({parse_absolute_value:ts}){if(["+","-","PERP"].includes(this.token.token_type)){let rs=this.token.token_type.toLowerCase();return this.advance(),rs}{let rs=this.baseFactor({parse_absolute_value:ts,in_subsuperscript_with_no_delimiters:!0});return rs===!1&&(rs=""),rs}}baseFactor({inside_absolute_value:ts=0,parse_absolute_value:rs=!0,allow_absolute_value_closing:ns=!1,in_subsuperscript_with_no_delimiters:is=!1}={}){var as=!1;if(this.token.token_type==="NUMBER")as=parseFloat(this.token.token_text),this.advance();else if(this.token.token_type==="INFINITY")as=1/0,this.advance();else if(this.token.token_type==="VAR"||this.token.token_type==="VARMULTICHAR"){if(as=this.token.token_text,this.appliedFunctionSymbols.includes(as)||this.functionSymbols.includes(as)){let os=!1;if(this.appliedFunctionSymbols.includes(as)&&(os=!0),this.advance(),this.token.token_type==="_"){this.advance();let ls=this.get_subsuperscript({parse_absolute_value:rs});as=as==="log"&&ls===10?"log10":["_",as,ls]}if(is)os&&(as=["apply",as,""]);else{for(;this.token.token_type==="'";)as=["prime",as],this.advance();for(;this.token.token_type==="^";)this.advance(),as=["^",as,this.get_subsuperscript({parse_absolute_value:rs})];if(this.token.token_type==="("){this.advance();let ls=this.statement_list();if(this.token.token_type!==")")throw new ParseError("Expecting )",this.lexer.location);this.advance(),ls[0]==="list"&&(ls[0]="tuple"),as=["apply",as,ls]}else if(os){if(!this.allowSimplifiedFunctionApplication)throw new ParseError("Expecting ( after function",this.lexer.location);let ls=this.factor({parse_absolute_value:rs});ls===!1&&(ls=""),as=["apply",as,ls]}}return as}if(this.operatorSymbols.includes(as))if(this.advance(),this.token.token_type==="("){this.advance();let os=this.statement_list();if(this.token.token_type!==")")throw new ParseError("Expecting )",this.lexer.location);this.advance(),as=os[0]==="list"?[as,...os.slice(1)]:[as,os]}else{let os=this.factor({parse_absolute_value:rs});os===!1&&(os=""),as=[as,os]}else{if(this.parseLeibnizNotation){let ls=this.return_state(),us=this.leibniz_notation();if(us)return us;this.set_state(ls)}let os=this.splitSymbols;if(os&&(this.token.token_type==="VARMULTICHAR"||this.unsplitSymbols.includes(as)||as.length===1||as.match(/[\d]/g))&&(os=!1),os){for(let ls=as.length-1;ls>=0;ls--)this.lexer.unput(" "),this.lexer.unput(as[ls]);return this.advance(),this.baseFactor({inside_absolute_value:ts,parse_absolute_value:rs,allow_absolute_value_closing:ns})}this.advance()}}else if(this.token.token_type==="("||this.token.token_type==="["||this.token.token_type==="{"||this.token.token_type==="LANGLE"){let os,ls,us=this.token.token_type;this.token.token_type==="("?(os=")",ls="]"):this.token.token_type==="["?(os="]",ls=")"):this.token.token_type==="{"?(os="}",ls=null):(os="RANGLE",ls=null),this.advance();let cs=1;if((as=this.statement_list())[0]==="list"&&(cs=as.length-1),this.token.token_type!==os){if(cs!==2||ls===null)throw new ParseError("Expecting "+os,this.lexer.location);if(this.token.token_type!==ls)throw new ParseError("Expecting ) or ]",this.lexer.location);let ps;as[0]="tuple",ps=us==="("?["tuple",!1,!0]:["tuple",!0,!1],(as=["interval",as]).push(ps)}else cs>=2?as[0]=us==="("?"tuple":us==="["?"array":us==="{"?"set":"altvector":us==="{"&&(as=(as[0]==="|"||as[0],["set",as]));this.advance()}else if(this.token.token_type!=="|"||!rs||ts!==0&&ns){if(this.token.token_type==="ANGLE")if(this.advance(),this.token.token_type==="("){this.advance();let os=this.statement_list();if(this.token.token_type!==")")throw new ParseError("Expecting )",this.lexer.location);this.advance(),os[0]==="list"?as=["angle",...os.slice(1)]:os[0]==="*"&&(as=["angle",os])}else{let os=[],ls=this.nonMinusFactor({parse_absolute_value:rs});for(;ls!==!1;)os.push(ls),ls=this.nonMinusFactor({parse_absolute_value:rs});as=os.length===0?"angle":["angle",...os]}else if(this.token.token_type==="INT"){this.advance();let os="int";this.token.token_type==="_"&&(this.advance(),os=["_",os,this.get_subsuperscript({parse_absolute_value:rs})]),this.token.token_type==="^"&&(this.advance(),os=["^",os,this.get_subsuperscript({parse_absolute_value:rs})]);let ls=flatten$6(this.term({parse_absolute_value:rs}));if(Array.isArray(ls)&&ls[0]==="*"){let us=[];for(let cs=0;cs<ls.length-1;cs++)if(ls[cs]==="d"){let ps=ls[cs+1];ls.splice(cs,2),us.push(["d",ps]),cs--}ls.push(...us)}return["apply",os,ls]}}else{if(ts+=1,this.advance(),as=["apply","abs",as=this.statement({inside_absolute_value:ts})],this.token.token_type!=="|")throw new ParseError("Expecting |",this.lexer.location);this.advance()}return this.token.token_type==="_"&&(as===!1&&(as=""),this.advance(),as=["_",as,this.get_subsuperscript({parse_absolute_value:rs})]),as}leibniz_notation(){var ts=this.token.token_text;if(this.token.token_type!=="VAR"||ts[0]!=="d"&&ts[0]!==""||!(ts.length===1||ts.length===2&&/[a-zA-Z]/.exec(ts[1])))return!1;let rs=ts[0],ns=1,is="",as=[],os=[];if(ts.length===2)is=ts[1];else if(this.advance(),this.token.token_type==="VARMULTICHAR"||this.token.token_type==="VAR"&&!this.token.token_text.includes(""))is=this.token.token_text;else{if(this.token.token_type!=="^"||(this.advance(),this.token.token_type!=="NUMBER")||(ns=parseFloat(this.token.token_text),!Number.isInteger(ns))||(this.advance(),(this.token.token_type!=="VAR"||this.token.token_text.includes(""))&&this.token.token_type!=="VARMULTICHAR"))return!1;is=this.token.token_text}if(this.advance(),this.token.token_type!=="/")return!1;let ls=0;for(this.advance();;){if(this.token.token_type!=="VAR"||this.token.token_text[0]!==rs)return!1;this.token.token_text.length>2&&(this.lexer.unput(this.token.token_text.slice(2)),this.token.token_text=this.token.token_text.slice(0,2));let us=this.token.token_text;if(us.length===2){if(!/[a-zA-Z]/.exec(us[1]))return!1;as.push(us[1])}else{if(this.advance(),(this.token.token_type!=="VAR"||this.token.token_text.includes(""))&&this.token.token_type!=="VARMULTICHAR")return!1;as.push(this.token.token_text)}let cs=1,ps=!1;if(this.advance({remove_initial_space:!1}),this.token.token_type==="SPACE"&&(ps=!0,this.advance()),this.token.token_type==="^"){if(this.advance(),this.token.token_type!=="NUMBER"||(cs=parseFloat(this.token.token_text),!Number.isInteger(cs)))return!1;ps=!1,this.advance({remove_initial_space:!1}),this.token.token_type==="SPACE"&&(ps=!0,this.advance())}if(os.push(cs),ls+=cs,ls>ns)return!1;if(ls===ns){if(!ps&&(this.token.token_type==="VAR"||this.token.token_type==="VARMULTICHAR"))return!1;this.token.token_type==="SPACE"&&this.advance();let ds="derivative_leibniz";rs===""&&(ds="partial_"+ds),ts=[ds],ns===1?ts.push(is):ts.push(["tuple",is,ns]);let fs=[];for(let hs=0;hs<as.length;hs+=1)os[hs]===1?fs.push(as[hs]):fs.push(["tuple",as[hs],os[hs]]);return fs=["tuple"].concat(fs),ts.push(fs),ts}}}}var textToAst$3=new textToAst$4;function expand(ss,ts){var rs=get_tree(ss);rs=perform_vector_matrix_additions_scalar_multiplications(rs=perform_matrix_multiplications(rs));var ns=[];return ns.push([textToAst$3.convert("a*(b+c)"),textToAst$3.convert("a*b+a*c")]),ns.push([textToAst$3.convert("(a+b)*c"),textToAst$3.convert("a*c+b*c")]),ts||ns.push([textToAst$3.convert("(a+b)/c"),textToAst$3.convert("a/c+b/c")]),ns.push([textToAst$3.convert("-(a+b)"),textToAst$3.convert("-a-b")]),ns.push([textToAst$3.convert("a(-b)"),textToAst$3.convert("-ab")]),ns.push([textToAst$3.convert("(a+b)^2"),textToAst$3.convert("a^2+2ab+b^2")]),ns.push([textToAst$3.convert("(a+b)^3"),textToAst$3.convert("a^3+3a^2b+3ab^2+b^3")]),ns.push([textToAst$3.convert("(a+b)^4"),textToAst$3.convert("a^4+4a^3b+6a^2b^2+4ab^3+b^4")]),ns.push([textToAst$3.convert("(-a)^2"),textToAst$3.convert("a^2")]),ns.push([textToAst$3.convert("(-a)^3"),textToAst$3.convert("-a^3")]),ns.push([textToAst$3.convert("(-a)^4"),textToAst$3.convert("a^4")]),ns.push([textToAst$3.convert("a*(b+c)*d"),textToAst$3.convert("(a*b+a*c)*d")]),rs=normalize_negatives(rs=collect_like_terms_factors(rs=evaluate_numbers(rs=flatten$5(rs=applyAllTransformations(rs,ns,20)))))}function perform_matrix_multiplications(ss,ts=!0,rs=!0){var ns=get_tree(ss);function is(us,cs){let ps=us[1][1],ds=us[1][2],fs=cs[1][2];if(cs[1][1]!==ds)return{success:!1};let hs=us[2],ys=cs[2],gs=["tuple"];for(let bs=0;bs<ps;bs++){let vs=hs[bs+1].slice(1),Ns=["tuple"];for(let Ts=0;Ts<fs;Ts++){let Cs=ys.slice(1).map(As=>As[Ts+1]);if(vs.length!==ds||Cs.length!==ds)return subtree;let xs=["+",...vs.map((As,ws)=>["*",As,Cs[ws]])];Ns.push(xs)}gs.push(Ns)}return{success:!0,newMatrix:["matrix",["tuple",ps,fs],gs]}}function as(us,cs){let ps=us[1][1],ds=us[1][2],fs=us[2],hs=["tuple"];for(let ys=0;ys<ps;ys++){let gs=["tuple"],bs=fs[ys+1];for(let vs=0;vs<ds;vs++)gs.push(["*",cs,bs[vs+1]]);hs.push(gs)}return["matrix",["tuple",ps,ds],hs]}let os=["*","a",["matrix","size","matrixData"],"b"],ls={allow_implicit_identities:["a","b"]};return ns=transform(ns,function(us){let cs=match$2(us,os,ls);if(cs){let ps=["matrix",cs.size,cs.matrixData],ds=[],fs=[];Array.isArray(cs.a)&&cs.a[0]==="*"?ds.push(...cs.a.slice(1)):ds.push(cs.a),Array.isArray(cs.b)&&cs.b[0]==="*"?fs.push(...cs.b.slice(1)):fs.push(cs.b);for(let hs=ds.length-1;hs>=0;hs--){let ys=ds[hs][0];if(ys==="matrix"){let gs=is(ds[hs],ps);if(!gs.success)break;ps=gs.newMatrix,ds.pop()}else{if(["tuple","list","vector","altvector","interval","set","array"].includes(ys))break;ds[hs]!==1&&(ps=as(ps,ds[hs])),ds.pop()}}for(;fs.length>0;){let hs=fs[0][0];if(hs==="matrix"){let ys=is(ps,fs[0]);if(!ys.success)break;ps=ys.newMatrix,fs.splice(0,1)}else{if(["tuple","list","vector","altvector","interval","set","array"].includes(hs))break;fs[0]!==1&&(ps=as(ps,fs[0])),fs.splice(0,1)}}return ds.length>0||fs.length>0?["*",...ds,ps,...fs]:ps}return us}),(ts||rs)&&(os=["*",["matrix",["tuple","m","n"],"matrixData"],"b"],ls={variables:{n:Number.isInteger,m:Number.isInteger,matrixData:!0,b:!0}},ns=transform(ns,function(us){let cs=match$2(us,os,ls);if(cs){let ps,ds=cs.m,fs=cs.n,hs=cs.b,ys=cs.matrixData,gs=[];ts&&(gs.push("vector"),gs.push("altvector")),rs&&gs.push("tuple");let bs=[];if(gs.includes(hs[0]))ps=hs;else{if(!Array.isArray(hs)||hs[0]!=="*"||!gs.includes(hs[1][0]))return us;ps=hs[1],bs=hs.slice(2)}let vs=ps.slice(1);if(vs.length!==fs)return us;let Ns=[ps[0]];for(let Ts=0;Ts<ds;Ts++){let Cs=["+",...ys[Ts+1].slice(1).map((xs,As)=>["*",xs,vs[As]])];Ns.push(Cs)}return bs.length>0?["*",Ns,...bs]:Ns}return us})),ns}function perform_vector_scalar_multiplications(ss,ts=!0){var rs=get_tree(ss);let ns=function(is,as){let os=["*","a",[as,"vectorData"],"b"],ls={allow_implicit_identities:["a","b"]};return is=transform(is,function(us){let cs=match$2(us,os,ls);if(cs){if(cs.a===1&&cs.b===1)return us;let ps=cs.vectorData;ps=Array.isArray(ps)&&ps[0]===as?ps.slice(1):[ps];let ds=[],fs=[];Array.isArray(cs.a)&&cs.a[0]==="*"?ds.push(...cs.a.slice(1)):ds.push(cs.a),Array.isArray(cs.b)&&cs.b[0]==="*"?fs.push(...cs.b.slice(1)):fs.push(cs.b);for(let ys=ds.length-1;ys>=0;ys--){let gs=ds[ys][0];if(["tuple","list","vector","altvector","interval","set","array","matrix"].includes(gs))break;ds[ys]!==1&&(ps=ps.map(bs=>["*",bs,ds[ys]])),ds.pop()}for(;fs.length>0;){let ys=fs[0][0];if(["tuple","list","vector","altvector","interval","set","array","matrix"].includes(ys))break;fs[0]!==1&&(ps=ps.map(gs=>["*",gs,fs[0]])),fs.splice(0,1)}let hs=[as,...ps];return ds.length>0||fs.length>0?["*",...ds,hs,...fs]:hs}return us}),is};return rs=ns(rs,"vector"),rs=ns(rs,"altvector"),ts&&(rs=ns(rs,"tuple")),rs}function perform_matrix_scalar_multiplications(ss){var ts=get_tree(ss);let rs=["*","a",["matrix","size","matrixData"],"b"],ns={allow_implicit_identities:["a","b"]};return ts=transform(ts,function(is){let as=match$2(is,rs,ns);if(as){if(as.a===1&&as.b===1)return is;let os=as.matrixData,ls=[],us=[];Array.isArray(as.a)&&as.a[0]==="*"?ls.push(...as.a.slice(1)):ls.push(as.a),Array.isArray(as.b)&&as.b[0]==="*"?us.push(...as.b.slice(1)):us.push(as.b);for(let ps=ls.length-1;ps>=0;ps--){let ds=ls[ps][0];if(["tuple","list","vector","altvector","interval","set","array","matrix"].includes(ds))break;ls[ps]!==1&&(os=os.map(fs=>fs==="tuple"?fs:fs.map(hs=>hs==="tuple"?hs:["*",hs,ls[ps]]))),ls.pop()}for(;us.length>0;){let ps=us[0][0];if(["tuple","list","vector","altvector","interval","set","array","matrix"].includes(ps))break;us[0]!==1&&(os=os.map(ds=>ds==="tuple"?ds:ds.map(fs=>fs==="tuple"?fs:["*",fs,us[0]]))),us.splice(0,1)}let cs=["matrix",as.size,os];return ls.length>0||us.length>0?["*",...ls,cs,...us]:cs}return is}),ts}function expand_relations(ss){var ts=get_tree(ss);return transform(ts,expand_relations_transform)}function expand_relations_transform(ss){if(!Array.isArray(ss))return ss;var ts=ss[0],rs=ss.slice(1);if(ts==="="){if(rs.length<=2)return ss;let ns=["and"];for(let is=0;is<rs.length-1;is++)ns.push(["=",rs[is],rs[is+1]]);return ns}if(ts==="gts"||ts==="lts"){let ns=rs[0],is=rs[1];if(ns[0]!=="tuple"||is[0]!=="tuple")throw new Error("Badly formed ast");let as=[];for(let ls=1;ls<ns.length-1;ls++){let us;us=is[ls]?ts==="lts"?"<":">":ts==="lts"?"le":"ge",as.push([us,ns[ls],ns[ls+1]])}let os=["and",as[0],as[1]];for(let ls=2;ls<as.length;ls++)os=["and",os,as[ls]];return os}if(ts==="in"||ts==="notin"||ts==="ni"||ts==="notni"){let ns,is,as=!1;if(ts!=="notin"&&ts!=="notni"||(as=!0),ts==="in"||ts==="notin"?(ns=rs[0],is=rs[1]):(ns=rs[1],is=rs[0]),is=to_intervals(is),is[0]!=="interval")return ss;let os=is[1],ls=is[2];if(os[0]!=="tuple"||ls[0]!=="tuple")throw new Error("Badly formed ast");let us,cs=os[1],ps=os[2],ds=[];return ls[1]?as?ds.push(["<",ns,cs]):ds.push(["ge",ns,cs]):as?ds.push(["le",ns,cs]):ds.push([">",ns,cs]),ls[2]?as?ds.push([">",ns,ps]):ds.push(["le",ns,ps]):as?ds.push(["ge",ns,ps]):ds.push(["<",ns,ps]),us=as?["or"].concat(ds):["and"].concat(ds),us}if(ts==="subset"||ts==="notsubset"||ts==="superset"||ts==="notsuperset"){let ns,is,as=!1;if(ts!=="notsubset"&&ts!=="notsuperset"||(as=!0),ts==="subset"||ts==="notsubset"?(ns=rs[0],is=rs[1]):(ns=rs[1],is=rs[0]),ns=to_intervals(ns),is=to_intervals(is),ns[0]!=="interval"||is[0]!=="interval")return ss;let os=ns[1],ls=ns[2],us=is[1],cs=is[2];if(os[0]!=="tuple"||ls[0]!=="tuple"||us[0]!=="tuple"||cs[0]!=="tuple")throw new Error("Badly formed ast");let ps,ds=os[1],fs=os[2],hs=us[1],ys=us[2],gs=[];return ls[1]&&!cs[1]?as?gs.push(["le",ds,hs]):gs.push([">",ds,hs]):as?gs.push(["<",ds,hs]):gs.push(["ge",ds,hs]),ls[2]&&!cs[2]?as?gs.push(["ge",fs,ys]):gs.push(["<",fs,ys]):as?gs.push([">",fs,ys]):gs.push(["le",fs,ys]),ps=as?["or"].concat(gs):["and"].concat(gs),ps}return ss}function substitute(ss,ts){var rs=get_tree(ss),ns={};for(let is in ts)ns[is]=get_tree(ts[is]);return substitute$1(rs,ns)}function substitute_component(ss,ts,rs){let ns=get_tree(ss);if(get_tree(rs),typeof ts=="number")ts=[ts];else if(!Array.isArray(ts))throw Error("Invalid substitute_component: "+ts);let is=["list","tuple","vector","altvector","array"];return function as(os,ls,us){if(ls.length===0)return rs;if(!Array.isArray(os))throw Error("Invalid substitute_component: expected list, tuple, vector, or array");let cs=os[0],ps=os.slice(1);if(!is.includes(cs))throw Error("Invalid substitute_component: expected list, tuple, vector, or array");let ds=ls[0];if(ds<0||ds>ps.length-1)throw Error("Invalid substitute_component: component out of range");let fs=ls.slice(1),hs=as(ps[ds],fs);return[cs,...ps.slice(0,ds),hs,...ps.slice(ds+1)]}(ns,ts)}function get_component(ss,ts){let rs=get_tree(ss);if(typeof ts=="number")ts=[ts];else if(!Array.isArray(ts))throw Error("Invalid get_component: "+ts);let ns=["list","tuple","vector","altvector","array"];return function is(as,os){if(os.length===0)return as;if(!Array.isArray(as))throw Error("Invalid get_component: expected list, tuple, vector, or array");let ls=as[0],us=as.slice(1);if(!ns.includes(ls))throw Error("Invalid get_component: expected list, tuple, vector, or array");let cs=os[0];if(cs<0||cs>us.length-1)throw Error("Invalid get_component: component out of range");let ps=os.slice(1);return is(us[cs],ps)}(rs,ts)}var transformation=Object.freeze({__proto__:null,expand,expand_relations,substitute,substitute_component,get_component,perform_vector_scalar_multiplications,perform_matrix_scalar_multiplications,perform_matrix_multiplications});function clean(ss){return flatten$5(get_tree(ss))}function evalf(ss,ts){return parseFloat(math$1.format(ss,{notation:"exponential",precision:ts}))}function collapse_unary_minus(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;var rs=ts[0],ns=ts.slice(1);if(ns=ns.map(is=>collapse_unary_minus(is)),rs==="-"){if(typeof ns[0]=="number")return-ns[0];if(Array.isArray(ns[0])&&ns[0][0]==="*"&&typeof ns[0][1]=="number")return["*",-ns[0][1]].concat(ns[0].slice(2));if(Array.isArray(ns[0])&&ns[0][0]==="/"){if(typeof ns[0][1]=="number")return["/",-ns[0][1],ns[0][2]];if(Array.isArray(ns[0][1])&&ns[0][1][0]==="*"&&typeof ns[0][1][1]=="number")return["/",["*",-ns[0][1][1]].concat(ns[0][1].slice(2)),ns[0][2]]}}return[rs].concat(ns)}function simplify(ss,ts,rs){var ns=get_tree(ss);return contains_blank(ns)?ns:(ts===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(ts=ss.context.get_assumptions([ss.variables()])),ns=evaluate_numbers(ns,{assumptions:ts,max_digits:rs,evaluate_functions:!0}),Array.isArray(ns)?ns=collect_like_terms_factors(ns=perform_vector_matrix_additions_scalar_multiplications(ns=simplify_logical(ns,ts)),ts,rs):ns)}function simplify_logical(ss,ts){var rs=get_tree(ss);if(contains_blank(rs))return rs;ts===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(ts=ss.context.get_assumptions([ss.variables()])),rs=evaluate_numbers(rs,{assumptions:ts}),rs=unflattenRight(rs);var ns=[];return ns.push([["not",["not","a"]],"a"]),ns.push([["not",["and","a","b"]],["or",["not","a"],["not","b"]]]),ns.push([["not",["or","a","b"]],["and",["not","a"],["not","b"]]]),ns.push([["not",["=","a","b"]],["ne","a","b"]]),ns.push([["not",["ne","a","b"]],["=","a","b"]]),ns.push([["not",["<","a","b"]],["le","b","a"]]),ns.push([["not",["le","a","b"]],["not",["le","a","b"]]]),ns.push([["not",["in","a","b"]],["notin","a","b"]]),ns.push([["not",["subset","a","b"]],["notsubset","a","b"]]),rs=flatten$5(rs=applyAllTransformations(rs,ns,20))}function perform_vector_matrix_additions_scalar_multiplications(ss,ts=!0){var rs=get_tree(ss);rs=perform_vector_scalar_multiplications(rs=perform_matrix_scalar_multiplications(rs),ts);let ns=["+","a","b"];return rs=transform(rs,function(is){let as=match$2(is,ns,{allow_permutations:!0});if(as){let os=["vector","altvector"];ts&&os.push("tuple");let ls={},us={},cs=[];if(os.includes(as.a[0])){let ds=as.a.length-1;ls[ds]||(ls[ds]=[]),ls[ds].push(as.a)}else if(as.a[0]==="matrix"){let ds=as.a[1].slice(1).toString();us[ds]||(us[ds]=[]),us[ds].push(as.a)}else cs.push(as.a);if(os.includes(as.b[0])){let ds=as.b.length-1;ls[ds]||(ls[ds]=[]),ls[ds].push(as.b)}else if(as.b[0]==="matrix"){let ds=as.b[1].slice(1).toString();us[ds]||(us[ds]=[]),us[ds].push(as.b)}else if(as.b[0]==="+")for(let ds of as.b.slice(1))if(os.includes(ds[0])){let fs=ds.length-1;ls[fs]||(ls[fs]=[]),ls[fs].push(ds)}else if(ds[0]==="matrix"){let fs=ds[1].slice(1).toString();us[fs]||(us[fs]=[]),us[fs].push(ds)}else cs.push(ds);else cs.push(as.b);if(Object.values(ls).every(ds=>ds.length<2)&&Object.values(us).every(ds=>ds.length<2))return is;let ps=cs;for(let ds in ls)if(ls[ds].length<2)ps.push(...ls[ds]);else{let fs,hs=ls[ds].some(bs=>bs[0]==="vector"),ys=ls[ds].some(bs=>bs[0]==="tuple"),gs=ls[ds].some(bs=>bs[0]==="altvector");fs=hs||ys&&gs?["vector"]:gs?["altvector"]:["tuple"];for(let bs=0;bs<ds;bs++)fs.push(["+",...ls[ds].map(vs=>vs[bs+1])]);ps.push(fs)}for(let ds in us)if(us[ds].length<2)ps.push(...us[ds]);else{let[fs,hs]=ds.split(",").map(Number),ys=["tuple"];for(let bs=0;bs<fs;bs++){let vs=["tuple"];for(let Ns=0;Ns<hs;Ns++)vs.push(["+",...us[ds].map(Ts=>Ts[2][bs+1][Ns+1])]);ys.push(vs)}let gs=["matrix",["tuple",fs,hs],ys];ps.push(gs)}return ps.length===1?ps[0]:["+",...ps]}return is}),rs}function contains_decimal_number(ss){return typeof ss!="string"&&(typeof ss=="number"?!(!Number.isFinite(ss)||Number.isInteger(ss)):!!Array.isArray(ss)&&ss.slice(1).some(ts=>contains_decimal_number(ts)))}function contains_only_numbers(ss,{include_number_symbols:ts=!1,evaluate_functions:rs=!1}={}){return typeof ss=="string"?ts&&(ss==="e"&&math$1.define_e||ss==="pi"&&math$1.define_pi)?!0:!(ss!=="i"||!math$1.define_i):typeof ss=="number"||!!Array.isArray(ss)&&(rs&&ss[0]==="apply"?ss.slice(2).every(ns=>contains_only_numbers(ns,{include_number_symbols:ts})):ss.slice(1).every(ns=>contains_only_numbers(ns,{include_number_symbols:ts})))}function try_evaluate_sum_of_numbers(ss,ts,rs){if(typeof ss=="number"){if(ss===0)return ts;if(typeof ts=="number")return ss+ts;if(Array.isArray(ts)&&ts[0]==="+"&&typeof ts[1]=="number")return["+",ss+ts[1],ts[2]];if(!rs&&Array.isArray(ts)&&ts[0]==="+"&&typeof ts[2]=="number")return["+",ss+ts[2],ts[1]]}return typeof ts=="number"&&ts===0?ss:null}function try_evaluate_negate_number(ss){if(typeof ss=="number")return-ss;if(Array.isArray(ss)&&ss[0]==="*"&&typeof ss[1]=="number")return["*",-ss[1]].concat(ss.slice(2));if(Array.isArray(ss)&&ss[0]==="/"){if(typeof ss[1]=="number")return["/",-ss[1],ss[2]];if(Array.isArray(ss[1])&&ss[1][0]==="*"&&typeof ss[1][1]=="number")return["/",["*",-ss[1][1]].concat(ss[1].slice(2)),ss[2]]}return null}function try_evaluate_product_of_numbers(ss,ts){if(typeof ss=="number"){if(isNaN(ss))return NaN;if(typeof ts=="number")return ss*ts;if(!isFinite(ss))return ss===1/0&&is_negative_ast(ts)||ss===-1/0&&is_positive_ast(ts)?-1/0:is_nonzero_ast(ts)===!1?NaN:1/0;if(ss===0)return 0;if(ss===1)return ts;if(ss===-1)return["-",ts];if(Array.isArray(ts)&&ts[0]==="*"&&typeof ts[1]=="number")return ss*=ts[1],ts=ts[2],ss===1?ts:ss===-1?["-",ts]:["*",ss,ts]}if(typeof ts=="number"){if(isNaN(ts))return NaN;if(!isFinite(ts))return ts===1/0&&is_negative_ast(ss)||ts===-1/0&&is_positive_ast(ss)?-1/0:is_nonzero_ast(ss)===!1?NaN:1/0;if(ts===0)return 0;if(ts===1)return ss;if(ts===-1)return["-",ss];if(Array.isArray(ss)&&ss[0]==="*"&&typeof ss[1]=="number")return ts*=ss[1],ss=ss[2],ts===1?ss:ts===-1?["-",ss]:["*",ss,ts]}if(math$1.define_i&&ss==="i"){if(ts==="i")return-1;if(Array.isArray(ts)&&ts[0]==="*"&&ts[1]==="i")return["-",ts[2]]}else if(math$1.define_i&&ts==="i"&&Array.isArray(ss)&&ss[0]==="*"&&ss[1]==="i")return["-",ss[2]];return null}function try_evaluate_quotient_of_numbers(ss,ts,rs,ns){if(typeof ss=="number"){if(ss===0){let is=is_nonzero_ast(ts,rs);if(is)return 0;if(is===!1)return NaN}if(typeof ts=="number"){let is=ss/ts;if(ns===1/0||math$1.round(is,ns)===is)return is;if(ts<0)return["/",-ss,-ts]}if(Array.isArray(ts)&&ts[0]==="*"&&typeof ts[1]=="number"){let is=ss/ts[1];if(ns===1/0||math$1.round(is,ns)===is)return["/",is,ts[2]]}}else if(typeof ts=="number"){if(Array.isArray(ss)&&ss[0]==="*"&&typeof ss[1]=="number"){let as=ss[1]/ts;if(ns===1/0||math$1.round(as,ns)===as)return as===1?ss[2]:["*",as,ss[2]];if(ts<0)return["/",["*",-ss[1],ss[2]],-ts]}let is=1/ts;if(ns===1/0||math$1.round(is,ns)===is)return["*",is,ss];if(ts<0)return Array.isArray(ss)&&ss[0]==="-"?["/",ss[1],-ts]:["-",["/",ss,-ts]]}return null}function evaluate_numbers_sub(ss,ts,rs,ns,is,as){if(ss===void 0)return ss;if(typeof ss=="number")return as>0&&math$1.abs(ss)<as?0:ss;if(contains_only_numbers(ss,{include_number_symbols:!0,evaluate_functions:is})){let cs=function(ps){if(as>0&&math$1.abs(ps)<as)return 0;if(rs===1/0||Number.isInteger(ps))return ps;let ds=evalf(ps,14),fs=evalf(ps,rs);if(rs===0&&(fs=math$1.round(ps)),fs===ds||contains_decimal_number(ss)&&contains_only_numbers(ss,{include_number_symbols:!0,evaluate_functions:is}))return ps;let hs=math$1.fraction(ps),ys=evalf(hs.d,3);return(hs.n<1e4||ys===hs.d)&&evalf(hs.s*hs.n/hs.d,14)===ds?hs.d===1?hs.s*hs.n:["/",hs.s*hs.n,hs.d]:null};var os=evaluate_to_constant(ss,!1);if(os!==null){if(typeof os=="number"){if(Number.isFinite(os)){let ps=cs(os);if(ps!==null)return ps}}else if(os&&Number.isFinite(os.re)&&Number.isFinite(os.im)){let ps=cs(os.re),ds=cs(os.im);if(ps!==null&&ds!==null){if(ds===0)return ps;{let fs;return fs=ds===1?"i":ds===-1?["-","i"]:["*",ds,"i"],ps===0?fs:["+",ps,fs]}}}}}if(!Array.isArray(ss))return ss;var ls=ss[0],us=ss.slice(1).map(cs=>evaluate_numbers_sub(cs,ts,rs,ns,is,as));if(ls==="+"){let cs=us[0],ps=us[1];if(ps===void 0)return cs;let ds=try_evaluate_sum_of_numbers(cs,ps,ns);if(ds!==null)return ds;if(cs[0]==="unit"&&ps[0]==="unit"){let fs=get_unit_of_tree(cs),hs=get_unit_of_tree(ps);if(fs&&fs===hs){let ys=try_evaluate_sum_of_numbers(remove_units(cs,!1),remove_units(ps,!1),ns);if(ys!==null)return add_unit(ys,fs)}}return[ls].concat(us)}if(ls==="-"){let cs=try_evaluate_negate_number(us[0]);if(cs!==null)return cs;if(us[0][0]==="unit"){let ps=get_unit_of_tree(us[0]);if(ps){let ds=try_evaluate_negate_number(remove_units(us[0],!1));if(ds!==null)return add_unit(ds,ps)}}return[ls].concat(us)}if(ls==="*"){let cs=us[0],ps=us[1];if(ps===void 0)return cs;let ds=try_evaluate_product_of_numbers(cs,ps);if(ds!==null)return ds;if(cs[0]==="unit"&&ps[0]!=="unit"){let fs=get_unit_of_tree(cs);if(fs){let hs=try_evaluate_product_of_numbers(remove_units(cs,!1),ps);if(hs!==null)return add_unit(hs,fs)}}if(cs[0]!=="unit"&&ps[0]==="unit"){let fs=get_unit_of_tree(ps);if(fs){let hs=try_evaluate_product_of_numbers(cs,remove_units(ps,!1));if(hs!==null)return add_unit(hs,fs)}}return[ls].concat(us)}if(ls==="/"){let cs=us[0],ps=us[1],ds=try_evaluate_quotient_of_numbers(cs,ps,ts,rs);if(ds!==null)return ds;if(cs[0]==="unit"&&ps[0]!=="unit"){let fs=get_unit_of_tree(cs);if(fs){let hs=try_evaluate_quotient_of_numbers(remove_units(cs,!1),ps,ts,rs);if(hs!==null)return add_unit(hs,fs)}}return[ls].concat(us)}if(ls==="^"){let cs=us[0],ps=us[1];if(typeof ps=="number")if(ps===0){if(!math$1.pow_strict)return 1;let ds=is_nonzero_ast(cs,ts);if(ds&&cs!==1/0&&cs!==-1/0)return 1;if(ds===!1)return NaN}else{if(ps===1)return cs;if(typeof cs=="number"){let ds=math$1.pow(cs,ps);if(rs===1/0||math$1.round(ds,rs)===ds)return ds}}else if(cs===1)return 1;return[ls].concat(us)}return[ls].concat(us)}function evaluate_numbers(ss,{assumptions:ts,max_digits:rs,skip_ordering:ns=!1,evaluate_functions:is=!1,set_small_zero:as=0}={}){(rs===void 0||!Number.isInteger(rs)&&rs!==1/0)&&(rs=0),as===!0&&(as=1e-14);var os,ls=get_tree(ss);return contains_blank(ls)?ls:(ts===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(ts=ss.context.get_assumptions([ss.variables()])),ns?os=evaluate_numbers_sub(ls=unflattenRight(flatten$5(ls)),ts,rs,ns,is,as):(ls=move_units_outside_products(ls),ls=unflattenRight(default_order(flatten$5(ls))),os=default_order(evaluate_numbers_sub(ls,ts,rs,ns,is,as)),os=default_order(evaluate_numbers_sub(unflattenRight(os),ts,rs,ns,is,as))),flatten$5(os=set_negative_zeros_to_zero(os)))}function set_negative_zeros_to_zero(ss){return ss===0?0:Array.isArray(ss)?[ss[0],...ss.slice(1).map(set_negative_zeros_to_zero)]:ss}function collect_like_terms_factors(ss,ts,rs){function ns(us){return typeof us=="number"||!(!Array.isArray(us)||us[0]!=="-"||typeof us[1]!="number")}function is(us){return typeof us=="number"&&us<0||!(!Array.isArray(us)||us[0]!=="-"||typeof us[1]!="number")}function as(us){if(typeof us=="number"||Array.isArray(us)&&us[0]==="-"&&typeof us[1]=="number")return!0;let cs=evaluate_to_constant(us,!1);return!(typeof cs!="number"||!Number.isFinite(cs))}var os=get_tree(ss);if(contains_blank(os))return os;ts===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(ts=ss.context.get_assumptions([ss.variables()])),os=evaluate_numbers(os,{assumptions:ts,max_digits:rs,evaluate_functions:!0});var ls=[];ls.push([["/","x",["^","y","a"]],["*","x",["^","y",["-","a"]]],{evaluate_numbers:!0,max_digits:rs}]),ls.push([["/","x",["apply","exp","a"]],["*","x",["apply","exp",["-","a"]]],{evaluate_numbers:!0,max_digits:rs,variables:{x:!0,a:!0}}]),ls.push([["/","x","y"],["*","x",["^","y",["-",1]]],{evaluate_numbers:!0,max_digits:rs}]),os=applyAllTransformations(os,ls,40),ls=[];for(let us in all_units)all_units[us].prefix?(ls.push([["+",["unit",us,"x"],["unit",us,"y"]],["unit",us,["+","x","y"]],{variables:{x:!0,y:!0},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["unit",us,"x"],["-",["unit",us,"y"]]],["unit",us,["+","x",["-","y"]]],{variables:{x:!0,y:!0},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}])):(ls.push([["+",["unit","x",us],["unit","y",us]],["unit",["+","x","y"],us],{variables:{x:!0,y:!0},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["unit","x",us],["-",["unit","y",us]]],["unit",["+","x",["-","y"]],us],{variables:{x:!0,y:!0},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]));return ls.push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:us=>is_nonzero_ast(us,ts),n:ns,m:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:!0,n:us=>ns(us)&&is_positive_ast(us,ts),m:us=>ns(us)&&is_positive_ast(us,ts)},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:!0,n:us=>ns(us)&&is_negative_ast(us,ts),m:us=>ns(us)&&is_negative_ast(us,ts)},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["*",["apply","exp","n"],["apply","exp","m"]],["apply","exp",["+","n","m"]],{variables:{n:ns,m:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*","n","x"],["*","m","x"]],["*",["+","n","m"],"x"],{variables:{x:!0,n:ns,m:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*","n1","x"],["*",["/","n2","m2"],"x"]],["*",["+","n1",["/","n2","m2"]],"x"],{variables:{x:!0,n1:ns,n2:ns,m2:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*","n1","x"],["*",["-",["/","n2","m2"]],"x"]],["*",["+","n1",["-",["/","n2","m2"]]],"x"],{variables:{x:!0,n1:ns,n2:ns,m2:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*",["/","n1","m1"],"x"],["*",["/","n2","m2"],"x"]],["*",["+",["/","n1","m1"],["/","n2","m2"]],"x"],{variables:{x:!0,n1:ns,m1:ns,n2:ns,m2:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m1","m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*",["/","n1","m1"],"x"],["*",["-",["/","n2","m2"]],"x"]],["*",["+",["/","n1","m1"],["-",["/","n2","m2"]]],"x"],{variables:{x:!0,n1:ns,m1:ns,n2:ns,m2:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m1","m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["+",["*","n","x"],["-",["*","m","x"]]],["*",["+","n",["-","m"]],"x"],{variables:{x:!0,n:ns,m:ns},evaluate_numbers:!0,max_digits:rs,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["^",["*","x","y"],"a"],["*",["^","x","a"],["^","y","a"]],{allow_permutations:!0}]),ls.push([["^",["^","x","n"],"m"],["^","x",["*","n","m"]],{variables:{x:!0,n:ns,m:ns},evaluate_numbers:!0,max_digits:rs,allow_permutations:!0}]),ls.push([["-",["+","a","b"]],["+",["-","a"],["-","b"]]]),ls.push([["*","x","y"],["*","x","y"],{variables:{x:as,y:as},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),os=applyAllTransformations(os,ls,40),(ls=[]).push([["*","x",["^","y",["-","a"]]],["/","x",["^","y","a"]],{allow_extended_match:!0,allow_permutations:!0,evaluate_numbers:!0,max_digits:rs,max_group:1}]),ls.push([["*","x",["apply","exp",["-","a"]]],["/","x",["apply","exp","a"]],{allow_extended_match:!0,allow_permutations:!0,evaluate_numbers:!0,max_digits:rs,max_group:1,variables:{x:!0,a:!0}}]),ls.push([["*","x",["^","y","n"]],["/","x",["^","y",["-","n"]]],{variables:{x:!0,y:!0,n:is},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["*","x",["apply","exp","n"]],["/","x",["apply","exp",["-","n"]]],{variables:{x:!0,n:is},evaluate_numbers:!0,max_digits:rs,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),os=applyAllTransformations(os,ls,40),(ls=[]).push([["^","y","n"],["/",1,["^","y",["-","n"]]],{variables:{y:!0,n:is},evaluate_numbers:!0,max_digits:rs}]),ls.push([["apply","exp","n"],["/",1,["apply","exp",["-","n"]]],{variables:{n:is},evaluate_numbers:!0,max_digits:rs}]),os=applyAllTransformations(os,ls,40),(ls=[]).push([["*","x",["/","y","z"]],["/",["*","x","y"],"z"],{allow_extended_match:!0,allow_permutations:!0,max_group:1}]),ls.push([["/",["/","x","y"],"z"],["/","x",["*","y","z"]],{allow_extended_match:!0,allow_permutations:!0}]),ls.push([["/","x",["/","y","z"]],["/",["*","x","z"],"y"],{allow_extended_match:!0,allow_permutations:!0}]),os=evaluate_numbers(os=applyAllTransformations(os,ls,40),{assumptions:ts,max_digits:rs})}function simplify_ratios(ss,ts){function rs(is){var as=1;return is=is.map(function(os){if(typeof os=="number")return os<0?(as*=-1,-os):os;if(!Array.isArray(os))return os;if(os[0]==="-")return as*=-1,os[1];if(os[0]!=="+")return os;var ls=!1;if((typeof os[1]=="number"&&os[1]<0||Array.isArray(os[1])&&os[1][0]==="-"||Array.isArray(os[1])&&os[1][0]==="*"&&Number(os[1][1])<0)&&(ls=!0),ls){as*=-1;var us=os.slice(1).map(cs=>["-",cs]);return evaluate_numbers(["+"].concat(us))}return os}),{factors:is,sign_change:as}}var ns=get_tree(ss);return contains_blank(ns)?ns:(ts===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(ts=ss.context.get_assumptions([ss.variables()])),function is(as,os){if(!Array.isArray(as))return os?["-",as]:as;var ls=as[0];if(ls==="-")return is(as[1],os=!0);var us=as.slice(1).map(gs=>is(gs));if(ls!=="/")return os?["-",[ls,...us]]:[ls,...us];var cs,ps=us[0],ds=us[1];ps=default_order(ps,{ignore_negatives:!0});var fs,hs=rs(cs=Array.isArray(ps)&&ps[0]==="*"?ps.slice(1):[ps]);cs=hs.factors,os&&(hs.sign_change*=-1),ds=default_order(ds,{ignore_negatives:!0});var ys=rs(fs=Array.isArray(ds)&&ds[0]==="*"?ds.slice(1):[ds]);return fs=ys.factors,hs.sign_change*ys.sign_change<0&&(cs[0]=["-",cs[0]]),["/",ps=cs.length===1?cs[0]:["*"].concat(cs),ds=fs.length===1?fs[0]:["*"].concat(fs)]}(ns))}function contains_blank(ss){return ss===""||!!Array.isArray(ss)&&ss.some(contains_blank)}let all_units=get_all_units();function remove_units(ss,ts=!0){var rs=get_tree(ss);if(!Array.isArray(rs))return rs;let ns=rs[0],is=rs.slice(1);if(ns==="unit"){let as=all_units[get_unit_of_tree(rs)];if(!as)return rs;let os=remove_units(as.prefix?is[1]:is[0],ts);return ts?as.scale(os):os}return[ns,...is.map(as=>remove_units(as,ts))]}function remove_scaling_units(ss){var ts=get_tree(ss);if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);if(rs==="unit"){let is=all_units[get_unit_of_tree(ts)];if(!is||!is.only_scales)return ts;let as=remove_scaling_units(is.prefix?ns[1]:ns[0]);return is.scale(as)}return[rs,...ns.map(is=>remove_scaling_units(is))]}function add_unit(ss,ts){var rs=get_tree(ss);let ns=all_units[ts];return ns?ns.prefix?["unit",ts,rs]:["unit",rs,ts]:rs}function move_units_outside_products(ss){if(!Array.isArray(ss))return ss;let ts=ss[0],rs=ss.slice(1);if(ts==="*"){let ns=[],is=[];for(let os of rs){let ls=get_unit_value_of_tree(os);ls?(ns.push(ls[0]),is.push(ls[1])):is.push(os)}let as=["*",...is];for(let os of ns)as=add_unit(as,os);return as}return[ts,...rs.map(move_units_outside_products)]}var simplify$1=Object.freeze({__proto__:null,clean,simplify,simplify_logical,evaluate_numbers,collect_like_terms_factors,collapse_unary_minus,simplify_ratios,default_order,perform_vector_matrix_additions_scalar_multiplications,remove_units,add_unit,remove_scaling_units});function solve_linear(ss,ts,rs){if(typeof ts=="string"){rs===void 0&&ss.context!==void 0&&ss.context.get_assumptions!==void 0&&(rs=ss.context.get_assumptions([ss.variables()]));var ns=simplify(get_tree(ss),rs);if(Array.isArray(ns)){var is=ns[0],as=ns.slice(1);if(is==="="||is==="ne"||is==="<"||is==="le"||is===">"||is==="ge"){var os=simplify(["+",as[0],["-",as[1]]],rs),ls=fs=>!variables(fs).includes(ts);if(variables(os=simplify(applyAllTransformations(os,[[["+",["*","_a",ts],["*","_b",ts]],["*",["+","_a","_b"],ts],{variables:{_a:ls,_b:ls},allow_permutations:!0,allow_extended_match:!0,allow_implicit_identities:["_a","_b"],evaluate_numbers:!0}]],20))).includes(ts)){var us=match$2(os,["+",["*","_a",ts],"_b"],{variables:{_a:ls,_b:ls},allow_permutations:!0,allow_implicit_identities:["_a","_b"]});if(us){var cs=simplify(us._a),ps=simplify(us._b);if(is_nonzero_ast(cs,rs)){if(is==="="||is==="ne"||is_positive_ast(cs,rs)){let fs=simplify(["/",["-",ps],cs]);return[is,ts,fs]}if(is_negative_ast(cs,rs)){var ds=simplify(["/",["-",ps],cs]);return[is=is==="<"?">":is==="le"?"ge":is===">"?"<":"le",ts,ds]}}}}}}}}var solve=Object.freeze({__proto__:null,solve_linear});function clean_assumptions(ss,ts){if(!Array.isArray(ss)||ss.length===0)return ss;var rs=(ss=flatten$5(default_order(simplify_logical(expand_relations(ss)))))[0],ns=ss.slice(1);if(rs==="and"||rs==="or"){if(ns=ns.reduce(function(is,as){return is.every(function(os){return!equal(os,as)})&&is.push(as),is},[]),rs==="and"&&ts&&Array.isArray(ts)){let is;is=ts[0]==="and"?ts.slice(1):[ts],ns=ns.filter(as=>is.every(os=>!equal(os,as)))}ss=ns.length===1?ns[0]:[rs].concat(ns)}if(rs!=="and"&&ts&&Array.isArray(ts)){let is;if(is=ts[0]==="and"?ts.slice(1):[ts],!is.every(as=>!equal(as,ss)))return}return ss}function calculate_derived_assumptions(ss,ts){if(ts===void 0){ts=[];for(let us in ss.byvar){let cs=ss.byvar[us];cs.length>0&&ts.push(cs)}if(ts.length===0)return{};ts=clean_assumptions(ts=ts.length===1?ts[0]:["and"].concat(ts))}if(!Array.isArray(ts)||ts.length===0)return{};var rs=ts[0],ns=ts.slice(1);if(rs==="and"||rs==="or"){let us=ns.map(function(ds){return calculate_derived_assumptions(ss,ds)}),cs=[...new Set(us.reduce((ds,fs)=>[...ds,...Object.keys(fs)],[]))],ps={};for(let ds of cs){let fs=us.reduce(function(hs,ys){return ys[ds]!==void 0&&hs.push(ys[ds]),hs},[]);if(rs==="and"||fs.length===us.length){let hs=ps[ds];hs=hs===void 0?fs.length>1?[rs].concat(fs):fs[0]:fs.length>1?["and",hs,[rs].concat(fs)]:["and",hs,fs[0]],ps[ds]=clean_assumptions(hs,get_assumptions(ss,ds,{omit_derived:!0}))}}return ps}let is={};if(rs==="="||rs==="ne"||rs==="<"||rs==="le"||rs==="in"||rs==="subset"||rs==="notin"||rs==="notsubset"){var as=!1;for(let us=0;us<2;us++){let cs=ns[us],ps=ns[1-us],ds=variables(ps);if(typeof cs!="string"||ds.length===0||ds.includes(cs))continue;as=!0;var os=rs;us===1&&(rs==="<"?os=">":rs==="le"?os="ge":rs==="in"?os="ni":rs==="subset"?os="superset":rs==="notin"?os="notni":rs==="notsubset"&&(os="notsuperset"));let fs=get_assumptions_for_expr(ss,ps,[cs]);if(fs=combine_assumptions(cs,os,ps,fs),fs!==void 0){let hs=is[cs];hs=hs===void 0?fs:["and",hs,fs],is[cs]=clean_assumptions(hs,get_assumptions(ss,cs,{omit_derived:!0}))}}if(as)return is}let ls=[];for(let us of ns){let cs=get_assumptions_for_expr(ss,us,[]);cs!==void 0&&ls.push(cs)}if(ls.length===0)return{};ls=ls.length===1?ls[0]:["and"].concat(ls);for(let us of variables(ts))is[us]=clean_assumptions(ls,get_assumptions(ss,us,{omit_derived:!0}));return is}function get_assumptions_for_expr(ss,ts,rs){let ns=variables(ts);if(ns=ns.filter(fs=>!rs.includes(fs)),ns.length===0)return;function is(fs){return typeof fs=="number"||!(!Array.isArray(fs)||fs[0]!=="-"||typeof fs[1]!="number")}var as=["_b"],os=["_b"],ls={_b:is},us={};for(let fs=0;fs<ns.length;fs++){let hs="_a"+fs;us[ns[fs]]=hs,as.push(["*",hs,ns[fs]]),os.push(hs),ls[hs]=is}as=["+"].concat(as);var cs=match$2(ts,as,{variables:ls,allow_permutations:!0,allow_extended_match:!1,allow_implicit_identities:os,max_group:1});if(!cs){let fs=[];for(let hs of variables(ts)){let ys=get_assumptions_for_expr(ss,hs,rs);ys!==void 0&&fs.push(ys)}return fs.length===0?void 0:fs.length===1?fs[0]:["and"].concat(fs)}for(let fs of ns)us[fs]=cs[us[fs]];let ps=!1;var ds;if(cs._b===0&&cs._a0===1&&ns.length===1&&(ps=!0),(ds=get_assumptions(ss,[ns],{exclude_variables:rs}))!==void 0)return clean_assumptions(function fs(hs){if(!Array.isArray(hs))return;var ys=hs[0],gs=hs.slice(1);if(ys==="and"||ys==="or"){let As=gs.map(fs).filter(ws=>ws!==void 0);return As.length===0?void 0:ys==="or"?As.length===gs.length?["or"].concat(As):void 0:As.length===1?As[0]:["and"].concat(As)}if(!(["=","ne","<","le"].includes(ys)||["in","notin","subset","notsubset"].includes(ys)&&ps)){let As=rs.concat(variables(ts)),ws=[];for(let Es of variables(hs)){if(As.includes(Es))continue;let Ss=get_assumptions_for_expr(ss,Es,As);Ss!==void 0&&ws.push(Ss)}return ws.length===0?hs:ws.length===1?["and",hs,ws[0]]:["and",hs].concat(ws)}let bs=[];for(let As=0;As<=1;As++){let ws=gs[As],Es=gs[1-As];if(typeof ws=="string"&&ns.includes(ws)){var vs={};vs[ws]=Es;var Ns=simplify(substitute$1(ts,vs)),Ts=!1,Cs=ys;(As===1&&us[ws]>0||As===0&&us[ws]<0)&&(ys==="<"?(Ts=!0,Cs=">"):ys==="le"?(Ts=!0,Cs="ge"):ys==="in"?(Ts=!0,Cs="ni"):ys==="subset"?(Ts=!0,Cs="superset"):ys==="notin"?(Ts=!0,Cs="notni"):ys==="notsubset"&&(Ts=!0,Cs="notsuperset")),Ts?bs.push([ys,Ns,ts]):bs.push([ys,ts,Ns]);let Ss=rs.concat([ws]),Ds=get_assumptions_for_expr(ss,Ns,Ss);Ds=combine_assumptions(ts,Cs,Ns,Ds),Ds!==void 0&&bs.push(Ds)}}if(bs.length===1)return bs[0];if(bs.length>1)return["and"].concat(bs);let xs=rs.concat(variables(ts));bs=[];for(let As of variables(hs)){if(xs.includes(As))continue;let ws=get_assumptions_for_expr(ss,As,xs);ws!==void 0&&bs.push(ws)}return bs.length===0?hs:bs.length===1?["and",hs,bs[0]]:["and",hs].concat(bs)}(ds))}function combine_assumptions(ss,ts,rs,ns){if(!["=","ne","<","le",">","ge","in","notin","ni","notni","subset","notsubset","superset","notsuperset"].includes(ts))return ns;if(Array.isArray(ns)){var is=ns[0],as=ns.slice(1);if(is==="and"||is==="or"){let cs=as.map(ps=>combine_assumptions(ss,ts,rs,ps)).filter(ps=>ps!==void 0);return cs.length===0?void 0:is==="or"?cs.length===as.length?[["or"].concat(cs)]:void 0:cs.length===1?cs[0]:["and"].concat(cs)}if(!["=","ne","<","le","in","notin","subset","notsubset"].includes(is))return ns;var os,ls,us=is;if(equal(as[0],rs))os=as[1];else{if(!equal(as[1],rs))return ns;os=as[0],is==="<"?us=">":is==="le"?us="ge":is==="in"?us="ni":is==="notin"?us="notni":is==="subset"?us="superset":is==="notsubset"&&(us="notsuperset")}if(ts==="=")ls=us;else if(us==="=")ls=ts;else if(ts==="<"){if(us!=="<"&&us!=="le")return us==="in"||us==="notin"?ns:void 0;ls="<"}else if(ts==="le")if(us==="<")ls="<";else{if(us!=="le")return us==="in"||us==="notin"?ns:void 0;ls="le"}else if(ts===">"){if(us!==">"&&us!=="ge")return us==="in"||us==="notin"?ns:void 0;ls=">"}else if(ts==="ge")if(us===">")ls=">";else{if(us!=="ge")return us==="in"||us==="notin"?ns:void 0;ls="ge"}else if(ts==="in"){if(us!=="subset")return;ls="in"}else if(ts==="notin"){if(us!=="superset")return;ls="notin"}else if(ts==="ni"){if(us!=="notin")return;ls="notsubset"}else if(ts==="notni"){if(us!=="in")return;ls="notsuperset"}else if(ts==="subset")if(us==="subset")ls="subset";else if(us==="notni")ls="notni";else{if(us!=="notsuperset")return;ls="notsuperset"}else if(ts==="notsubset"){if(us!=="superset")return;ls="notsubset"}else if(ts==="superset")if(us==="superset")ls="superset";else if(us==="ni")ls="ni";else{if(us!=="notsubset")return;ls="notsubset"}else{if(ts!=="notsuperset"||us!=="subset")return;ls="notsuperset"}return ls===">"?["<",os,ss]:ls==="ge"?["le",os,ss]:ls==="ni"?["in",os,ss]:ls==="notni"?["notin",os,ss]:ls==="superset"?["subset",os,ss]:ls==="notsuperset"?["notsubset",os,ss]:[ls,ss,os]}}function filter_assumptions_from_tree(ss,ts){if(Array.isArray(ss)&&ss.length!==0){Array.isArray(ts)||(ts=[ts]);var rs=ss[0],ns=ss.slice(1);if(rs==="and"){var is=ns.map(function(os){return filter_assumptions_from_tree(os,ts)});return(is=is.filter(os=>os!==void 0)).length===0?void 0:is.length===1?is[0]:["and"].concat(is)}var as=variables(ss);return ts.filter(os=>as.includes(os)).length>0?void 0:ss}}function get_assumptions_sub(ss,ts,rs,ns){Array.isArray(ts)||(ts=[ts]);var is=[];return ts.forEach(function(as){if(ss.byvar[as]||ss.derived[as]){if(ss.byvar[as]&&ss.byvar[as].length>0){var os=filter_assumptions_from_tree(ss.byvar[as],rs);os!==void 0&&is.push(os)}if(ss.derived[as]&&ss.derived[as].length>0&&!ns){var ls=filter_assumptions_from_tree(ss.derived[as],rs);ls!==void 0&&is.push(ls)}}else ss.generic.length>0&&(as!=="x"&&variables(ss.generic).includes(as)||is.push(substitute$1(ss.generic,{x:as})))}),is.length===1?is=is[0]:is.length>1&&(is=["and"].concat(is)),is.length>0?clean_assumptions(is):void 0}function get_assumptions(ss,ts,rs){rs===void 0&&(rs={});var ns,is=rs.exclude_variables;is===void 0?is=[]:Array.isArray(is)||(is=[is]);var as=get_tree(ts);if(typeof as=="string")ns=[as];else{if(!Array.isArray(as))return;Array.isArray(as[0])&&(ns=as[0])}return ns?get_assumptions_sub(ss,ns,is,rs.omit_derived):get_assumptions_for_expr(ss,as,is)}function add_assumption(ss,ts,rs){var ns=get_tree(ts);if(!Array.isArray(ns))return 0;var is=add_assumption_sub(ss,ns=clean_assumptions(simplify(ns,ss)),rs);return is&&(ss.derived=calculate_derived_assumptions(ss)),is}function add_assumption_sub(ss,ts,rs){if(ts[0]==="and")return ts.slice(1).map(as=>add_assumption_sub(ss,as,rs)).reduce(function(as,os){return as+os});var ns=variables(ts);if(ns.length===0)return 0;let is=0;!rs&&ss.generic.length>0&&ns.forEach(function(as){ss.byvar[as]===void 0&&(as!=="x"&&variables(ss.generic).includes(as)||(add_assumption_sub(ss,substitute$1(ss.generic,{x:as}),!0),is+=1))});for(let as of ns){let os=solve_linear(ts,as,ss),ls=ts;os&&(ls=os);let us=ss.byvar[as];us!==void 0&&us.length!==0&&(ls=["and",us,ls]),ls=clean_assumptions(ls),equal(ls,us)||(ss.byvar[as]=ls,is+=1)}return is}function add_generic_assumption(ss,ts){var rs=get_tree(ts);if(!Array.isArray(rs))return 0;var ns=add_generic_assumption_sub(ss,rs=clean_assumptions(simplify(rs,ss)));return ns&&(ss.derived=calculate_derived_assumptions(ss)),ns}function add_generic_assumption_sub(ss,ts){if(ts[0]==="and")return ts.slice(1).map(as=>add_generic_assumption_sub(ss,as)).reduce(function(as,os){return as+os});if(!variables(ts).includes("x"))return 0;let rs=solve_linear(ts,"x",ss),ns=ts;rs&&(ns=rs);let is=ss.generic;return is.length!==0&&(ns=["and",is,ns]),ns=clean_assumptions(ns),equal(ns,is)?0:(ss.generic=ns,1)}function remove_assumption(ss,ts){var rs=get_tree(ts);if(!Array.isArray(rs))return 0;var ns=remove_assumption_sub(ss,rs=clean_assumptions(simplify(rs,ss)));return ns&&(ss.derived=calculate_derived_assumptions(ss)),ns}function remove_assumption_sub(ss,ts){if(ts[0]==="and")return ts.slice(1).map(is=>remove_assumption_sub(ss,is)).reduce(function(is,as){return is+as});var rs=variables(ts);if(rs.length===0)return 0;var ns=0;for(let is of rs){let as=solve_linear(ts,is,ss),os=ss.byvar[is];if(!os||os.length===0)continue;let ls,us=os[0],cs=os.slice(1),ps=cs.length;if(us==="and")if(cs=cs.filter(ds=>!(equal(ds,ts)||equal(ds,as))),cs.length===0)ls=[];else if(cs.length===1)ls=cs[0];else{if(!(cs.length<ps))continue;ls=[us].concat(cs)}else{if(!equal(os,ts)&&!equal(os,as))continue;ls=[]}ns+=1,ss.byvar[is]=ls}return ns}function remove_generic_assumption(ss,ts){var rs=get_tree(ts);if(!Array.isArray(rs))return 0;var ns=remove_generic_assumption_sub(ss,rs=clean_assumptions(simplify(rs,ss)));return ns&&(ss.derived=calculate_derived_assumptions(ss)),ns}function remove_generic_assumption_sub(ss,ts){if(ts[0]==="and")return ts.slice(1).map(us=>remove_generic_assumption_sub(ss,us)).reduce(function(us,cs){return us+cs});if(!variables(ts).includes("x"))return 0;var rs=ss.generic;if(rs.length===0)return 0;let ns=solve_linear(ts,"x",ss);var is,as=rs[0],os=rs.slice(1),ls=os.length;if(as==="and")if((os=os.filter(us=>!(equal(us,ts)||equal(us,ns)))).length===0)is=[];else if(os.length===1)is=os[0];else{if(!(os.length<ls))return 0;is=[as].concat(os)}else{if(!equal(rs,ts)&&!equal(rs,ns))return 0;is=[]}return ss.generic=is,1}function initialize_assumptions(){var ss={byvar:{},derived:{},generic:[],not_commutative:[],get_assumptions:function(ts,rs){return get_assumptions(ss,ts,rs)},add_assumption:function(ts,rs){return add_assumption(ss,ts,rs)},add_generic_assumption:function(ts){return add_generic_assumption(ss,ts)},remove_assumption:function(ts){return remove_assumption(ss,ts)},remove_generic_assumption:function(ts){return remove_generic_assumption(ss,ts)}};return ss}function padNumberStringToDigits(ss,ts){let rs=Math.floor(ts);if(rs>0){if(ss.includes(".")){if(ss[0]!=="0"?rs++:rs+=ss.match(/^0\.0*/)[0].length,ss.length<rs){let ns=rs-ss.length;ss+="0".repeat(ns)}}else if(ss.length<rs){let ns=rs-ss.length;ss+="."+"0".repeat(ns)}}return ss}function padNumberStringToDecimals(ss,ts){let rs=Math.floor(ts);if(rs>0)if(ss.includes(".")){let ns=ss.match(/\.\d*$/)[0].length-1;ns<rs&&(ss+="0".repeat(rs-ns))}else ss+="."+"0".repeat(rs);return ss}const operators$1={"+":function(ss){return ss.join(" ")},"-":function(ss){return"-"+ss[0]},"*":function(ss){return ss.join(" ")},"/":function(ss){return"\\frac{"+ss[0]+"}{"+ss[1]+"}"},_:function(ss){return ss[0]+"_{"+ss[1]+"}"},"^":function(ss){return ss[0]+"^{"+ss[1]+"}"},prime:function(ss){return ss[0]+"'"},tuple:function(ss){return"\\left( "+ss.join(", ")+" \\right)"},array:function(ss){return"\\left[ "+ss.join(", ")+" \\right]"},list:function(ss){return ss.join(", ")},set:function(ss){return"\\left\\{ "+ss.join(", ")+" \\right\\}"},vector:function(ss){return"\\left( "+ss.join(", ")+" \\right)"},altvector:function(ss){return"\\left\\langle "+ss.join(", ")+" \\right\\rangle"},interval:function(ss){return"\\left( "+ss.join(", ")+" \\right)"},matrix:function(ss){return"\\left( "+ss.join(", ")+" \\right)"},and:function(ss){return ss.join(" \\land ")},or:function(ss){return ss.join(" \\lor ")},not:function(ss){return"\\lnot "+ss[0]},"=":function(ss){return ss.join(" = ")},"<":function(ss){return ss.join(" < ")},">":function(ss){return ss.join(" > ")},lts:function(ss){return ss.join(" < ")},gts:function(ss){return ss.join(" > ")},le:function(ss){return ss.join(" \\le ")},ge:function(ss){return ss.join(" \\ge ")},ne:function(ss){return ss.join(" \\ne ")},forall:function(ss){return"\\forall "+ss[0]},exists:function(ss){return"\\exists "+ss[0]},in:function(ss){return ss[0]+" \\in "+ss[1]},notin:function(ss){return ss[0]+" \\notin "+ss[1]},ni:function(ss){return ss[0]+" \\ni "+ss[1]},notni:function(ss){return ss[0]+" \\not\\ni "+ss[1]},subset:function(ss){return ss[0]+" \\subset "+ss[1]},subseteq:function(ss){return ss[0]+" \\subseteq "+ss[1]},notsubset:function(ss){return ss[0]+" \\not\\subset "+ss[1]},notsubseteq:function(ss){return ss[0]+" \\not\\subseteq "+ss[1]},superset:function(ss){return ss[0]+" \\supset "+ss[1]},superseteq:function(ss){return ss[0]+" \\supseteq "+ss[1]},notsuperset:function(ss){return ss[0]+" \\not\\supset "+ss[1]},notsuperseteq:function(ss){return ss[0]+" \\not\\supseteq "+ss[1]},union:function(ss){return ss.join(" \\cup ")},intersect:function(ss){return ss.join(" \\cap ")},perp:function(ss){return ss.join(" \\perp ")},parallel:function(ss){return ss.join(" \\parallel ")},derivative_leibniz:function(ss){return"\\frac{d"+ss[0]+"}{d"+ss[1]+"}"},partial_derivative_leibniz:function(ss){return"\\frac{d"+ss[0]+"}{d"+ss[1]+"}"},"|":function(ss){return ss[0]+" \\mid "+ss[1]},":":function(ss){return ss[0]+" : "+ss[1]},binom:function(ss){return"\\binom{"+ss[0]+"}{"+ss[1]+"}"},vec:function(ss){return"\\vec{"+ss[0]+"}"},linesegment:function(ss){return"\\overline{"+ss.join(" ")+"}"},angle:function(ss,ts){return ts?"\\angle "+ss.join(""):"\\angle\\left( "+ss.join(", ")+" \\right)"},unit:function(ss){return ss[1]==="\\circ"?ss[0]+"^{\\circ}":ss[0]+" "+ss[1]}},allowedLatexSymbolsDefault$1=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial","abs","exp","log","ln","log10","sign","sqrt","erf","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","arg","Re","Im","det","angle","perp","circ","%","$","int"],convertLatexSymbolsDefault={acos:"arccos",acosh:"arccosh",acot:"arccot",acoth:"arccoth",acsc:"arccsc",acsch:"arccsch",asec:"arcsec",asech:"arcsech",asin:"arcsin",asinh:"arcsinh",atan:"arctan",atanh:"arctanh",deg:"circ"},matrixEnvironmentDefault="bmatrix";class astToLatex$1{constructor({allowedLatexSymbols:ts=allowedLatexSymbolsDefault$1,convertLatexSymbols:rs=convertLatexSymbolsDefault,matrixEnvironment:ns=matrixEnvironmentDefault,padToDigits:is=null,padToDecimals:as=null,showBlanks:os=!0}={}){this.allowedLatexSymbols=ts,this.convertLatexSymbols=rs,this.matrixEnvironment=ns,this.padToDigits=is,this.padToDecimals=as,this.showBlanks=os}convert(ts){return this.statement(ts)}statement(ts){if(!Array.isArray(ts))return this.single_statement(ts);var rs=ts[0],ns=ts.slice(1);if(rs==="ldots")return"\\ldots";if(!(rs in operators$1)&&rs!=="apply")throw new Error("Badly formed ast: operator "+rs+" not recognized.");return rs==="and"||rs==="or"?operators$1[rs](ns.map(function(is,as){let os=this.single_statement(is);return os.match(/ /)&&!os.match(/^\\left\(.*\\right\)$/)?"\\left("+os+"\\right)":os}.bind(this))):this.single_statement(ts)}single_statement(ts){if(!Array.isArray(ts))return this.expression(ts);var rs=ts[0],ns=ts.slice(1);if(rs==="not")return operators$1[rs](ns.map(function(is,as){let os=this.single_statement(is);return os.match(/ /)&&!os.match(/^\\left\(.*\\right\)$/)?"\\left("+os+"\\right)":os}.bind(this)));if(rs==="exists"||rs==="forall")return operators$1[rs]([this.single_statement(ns[0])]);if(rs==="="||rs==="ne"||rs==="<"||rs===">"||rs==="le"||rs==="ge"||rs==="in"||rs==="notin"||rs==="ni"||rs==="notni"||rs==="subset"||rs==="notsubset"||rs==="subseteq"||rs==="notsubseteq"||rs==="superset"||rs==="notsuperset"||rs==="superseteq"||rs==="notsuperseteq")return operators$1[rs](ns.map(function(is,as){return this.expression(is)}.bind(this)));if(rs==="lts"||rs==="gts"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");let os=this.expression(is[1]);for(let ls=1;ls<is.length-1;ls++)as[ls]?os+=rs==="lts"?" < ":" > ":os+=rs==="lts"?" \\le ":" \\ge ",os+=this.expression(is[ls+1]);return os}return this.expression(ts)}expression(ts){if(!Array.isArray(ts))return this.term(ts);var rs=ts[0],ns=ts.slice(1);return rs==="+"?ns.length===1?"+"+this.term(ns[0]):operators$1[rs](ns.map(function(is,as){return as>0?this.termWithPlusIfNotNegated(is):this.term(is)}.bind(this))):["union","intersect","perp","parallel"].includes(rs)?operators$1[rs](ns.map(function(is,as){return this.term(is)}.bind(this))):this.term(ts)}term(ts){if(!Array.isArray(ts))return this.factor(ts);var rs=ts[0],ns=ts.slice(1);return rs==="-"?operators$1[rs](ns.map(function(is,as){return this.term(is)}.bind(this))):rs==="*"?operators$1[rs](ns.map(function(is,as){let os;return as>0?(os=this.factorWithParenthesesIfNegatedOrExplicitPlus(is),os.match(/^[0-9]/)?"\\cdot "+os:is[0]==="angle"&&ns.length>1?"\\left( "+os+" \\right)":os):(os=this.factor(is),is[0]==="angle"&&ns.length>1?"\\left( "+os+" \\right)":os)}.bind(this))):rs==="/"||rs==="unit"?operators$1[rs](ns.map(function(is,as){return this.expression(is)}.bind(this))):this.factor(ts)}simple_factor_or_function_or_parens(ts){var rs=this.factor(ts);return!!(rs.length<=1||typeof ts=="string"&&ts.match(/^\w+$/)||Array.isArray(ts)&&ts[0]==="apply"&&ts[1]!=="sqrt"||rs.match(/^\\left\(.*\\right\)$/)||rs.match(/^\\left\\langle.*\\right\\rangle$/))||typeof ts=="number"&&ts>=0&&!ts.toString().includes("e")}stringConvert(ts){return ts.length>1?(this.convertLatexSymbols[ts]&&(ts=this.convertLatexSymbols[ts]),this.allowedLatexSymbols.includes(ts)?"\\"+ts:"\\operatorname{"+ts+"}"):this.allowedLatexSymbols.includes(ts)?"\\"+ts:ts!==""||this.showBlanks?ts:""}factor(ts){if(typeof ts=="string")return this.stringConvert(ts);if(typeof ts=="number"){if(ts===1/0)return"\\infty";if(ts===-1/0)return"-\\infty";if(Number.isNaN(ts))return"NaN";{let is=ts.toString(),as=is.indexOf("e");if(as===-1)return this.padToDigits!==null?is=padNumberStringToDigits(is,this.padToDigits):this.padToDecimals!==null&&(is=padNumberStringToDecimals(is,this.padToDecimals)),is;let os=is.substring(0,as),ls=is.substring(as+1);if(ls[0]==="+"&&(ls=ls.slice(1)),this.padToDigits!==null)os=padNumberStringToDigits(os,this.padToDigits);else if(this.padToDecimals!==null){let us=Number(ls);if(us>0)return is=ts.toLocaleString("fullwide",{useGrouping:!1}),padNumberStringToDecimals(is,this.padToDecimals);os=padNumberStringToDecimals(os,this.padToDecimals+us)}return os+" \\cdot 10^{"+ls+"}"}}if(!Array.isArray(ts))return"";var rs=ts[0],ns=ts.slice(1);if(rs==="^"){if(Number.isInteger(ns[0])&&Number.isInteger(ns[1]))return ns[0]<0?"\\left("+ns[0].toString()+"\\right)^{"+ns[1].toString()+"}":ns[0].toString()+"^{"+ns[1].toString()+"}";let is=this.factor(ns[0]),as=ns[0];for(;as[0]==="prime";)as=as[1];return this.simple_factor_or_function_or_parens(as)||as[0]==="_"&&typeof as[1]=="string"||(is="\\left("+is.toString()+"\\right)"),is+"^{"+this.statement(ns[1])+"}"}if(rs==="_"){let is=this.factor(ns[0]);return this.simple_factor_or_function_or_parens(ns[0])||(is="\\left("+is.toString()+"\\right)"),is+"_{"+this.statement(ns[1])+"}"}if(rs==="prime"){let is=ns[0],as=1;for(;is[0]==="prime";)as+=1,is=is[1];let os=this.factor(is);this.simple_factor_or_function_or_parens(is)||is[0]==="_"&&typeof is[1]=="string"||(os="\\left("+os+"\\right)");for(let ls=0;ls<as;ls++)os+="'";return os}if(rs==="-")return operators$1[rs](ns.map(function(is,as){return this.factor(is)}.bind(this)));if(rs==="tuple"||rs==="array"||rs==="list"||rs==="set"||rs==="vector"||rs==="altvector"||rs==="|"||rs===":"||rs==="binom"||rs==="vec"||rs==="linesegment")return operators$1[rs](ns.map(function(is,as){return this.statement(is)}.bind(this)));if(rs==="interval"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");let os=this.statement(is[1])+", "+this.statement(is[2]);return os=as[1]?"\\left[ "+os:"\\left( "+os,as[2]?os+=" \\right]":os+=" \\right)",os}if(rs==="matrix"){let is=ns[0],as=ns[1],os="\\begin{"+this.matrixEnvironment+"} ";for(let ls=0;ls<is[1];ls+=1){for(let us=0;us<is[2];us+=1)os+=this.statement(as[ls+1][us+1]),us<is[2]-1&&(os+=" & ");ls<is[1]-1&&(os+=" \\\\ ")}return os=os+" \\end{"+this.matrixEnvironment+"}",os}if(rs==="derivative_leibniz"||rs==="partial_derivative_leibniz"){let is="d";rs==="partial_derivative_leibniz"&&(is="\\partial ");let as=ns[0],os=ns[1],ls=1,us="";Array.isArray(as)?(us=as[1],ls=as[2]):us=as;let cs=is;ls>1?cs=cs.trimRight()+"^{"+ls+"}"+this.stringConvert(us):cs+=this.stringConvert(us),cs="\\frac{ "+cs+" }{ ";let ps=1;Array.isArray(os)&&(ps=os.length-1);for(let ds=1;ds<=ps;ds++){let fs=os[ds],hs=1,ys="";Array.isArray(fs)?(ys=fs[1],hs=fs[2]):ys=fs,cs=cs+is+this.stringConvert(ys),hs>1&&(cs=cs+"^{"+hs+"}"),cs+=" "}return cs+="}",cs}if(rs==="apply"){if(ns[0]==="abs")return"\\left|"+this.statement(ns[1])+"\\right|";if(ns[0]==="floor")return"\\left\\lfloor "+this.statement(ns[1])+" \\right\\rfloor";if(ns[0]==="ceil")return"\\left\\lceil "+this.statement(ns[1])+" \\right\\rceil";if(ns[0]==="factorial"){let ls=this.factor(ns[1]);return this.simple_factor_or_function_or_parens(ns[1])||ns[1][0]==="_"&&typeof ns[1][1]=="string"?ls+"!":"\\left("+ls+"\\right)!"}if(ns[0]==="sqrt")return"\\sqrt{"+this.statement(ns[1])+"}";let is,as=ns[0];if(as[0]==="^"&&(as=as[1]),as[0]==="_"&&(as=as[1]),as==="int"){let ls,us=this.factor(ns[0]),cs=ns[1];if(Array.isArray(cs)&&cs[0]==="*"){let ps=[],ds=["*"];for(let fs=1;fs<cs.length;fs++){let hs=cs[fs];Array.isArray(hs)&&hs[0]==="d"?ps.push(hs):ds.push(hs)}ls=this.term(ds),ps.length>0&&(ls[ls.length-1].match(/[a-zA-Z]/)&&(ls+="\\,"),ls+=ps.map(fs=>"d"+this.factor(fs[1])).join("\\,"))}return ls||(ls=this.term(ns[1])),us+" "+ls}is=ns[0]==="log10"?"\\log_{10}":ns[0]==="re"?"\\Re":ns[0]==="im"?"\\Im":this.factor(ns[0]);let os=this.statement(ns[1]);return ns[1][0]!=="tuple"&&(os="\\left("+os+"\\right)"),is+os}if(rs==="angle"){let is=ns.every(as=>{if(typeof as=="string"&&as.length===1)return!0;if(!Array.isArray(as))return!1;let os=as[0];return os==="_"||os==="^"||os==="prime"});return operators$1[rs](ns.map(function(as,os){return this.statement(as)}.bind(this)),is)}return rs==="+"&&ts.length===2?"+ "+this.factor(ts[1]):"\\left("+this.statement(ts)+"\\right)"}factorWithParenthesesIfNegatedOrExplicitPlus(ts){var rs=this.factor(ts);return rs.match(/^-/)||rs.match(/^\+/)?"\\left("+rs+"\\right)":rs}termWithPlusIfNotNegated(ts){var rs=this.term(ts);return rs.match(/^-/)?rs.match(/^-[^ ]/)?"- "+rs.slice(1):rs:"+ "+rs}}const textToAst$2=new textToAst$4,astToLatex=new astToLatex$1;var derivatives={sin:textToAst$2.convert("cos x"),cos:textToAst$2.convert("-(sin x)"),tan:textToAst$2.convert("(sec x)^2"),cot:textToAst$2.convert("-((csc x)^2)"),sec:textToAst$2.convert("(sec x)*(tan x)"),csc:textToAst$2.convert("-(csc x)*(cot x)"),sqrt:textToAst$2.convert("1/(2*sqrt(x))"),log:textToAst$2.convert("1/x"),ln:textToAst$2.convert("1/x"),exp:textToAst$2.convert("exp(x)"),arcsin:textToAst$2.convert("1/sqrt(1 - x^2)"),arccos:textToAst$2.convert("-1/sqrt(1 - x^2)"),arctan:textToAst$2.convert("1/(1 + x^2)"),arccsc:textToAst$2.convert("-1/(sqrt(-1/x^2 + 1)*x^2)"),arcsec:textToAst$2.convert("1/(sqrt(-1/x^2 + 1)*x^2)"),arccot:textToAst$2.convert("-1/(1 + x^2)"),abs:textToAst$2.convert("abs(x)/x")};function derivative(ss,ts,rs=[]){var ns=get_tree(ss),is="\\frac{d}{d"+ts+"} ";if(typeof ns=="number"||variables(ns).indexOf(ts)<0)return rs.push("The derivative of a constant is zero, that is, \\("+is+astToLatex.convert(ns)+" = 0\\)."),0;if(typeof ns=="string")return ts===ns?(rs.push("We know the derivative of the identity function is one, that is, \\("+is+astToLatex.convert(ns)+" = 1\\)."),1):(rs.push("As far as \\("+astToLatex.convert(ts)+"\\) is concerned, \\("+astToLatex.convert(ns)+"\\) is constant, so "+is+astToLatex.convert(ns)+" = 0\\)."),0);if(!Array.isArray(ns))return null;var as=ns[0],os=ns.slice(1);if(as==="+"||as==="-"||as==="~"){rs.push("Using the sum rule, \\("+is+astToLatex.convert(ns)+" = "+os.map(function(us,cs){return is+astToLatex.convert(us)}).join(" + ")+"\\).");let ls=[as].concat(os.map(function(us,cs){return derivative(us,ts,rs)}));return ls=simplify(ls),rs.push("So using the sum rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ls)+"\\)."),ls}if(as==="*"){let ls=[],us=[];for(let ds=0;ds<os.length;ds++)typeof os[ds]=="number"||variables(os[ds]).indexOf(ts)<0?us.push(os[ds]):ls.push(os[ds]);if(us.length>0){if(ls.length===0)return rs.push("Since the derivative of a constant is zero, \\("+is+astToLatex.convert(ns)+" = 0.\\)"),0;let ds=["*"].concat(ls);if(ls.length===1&&(ds=ls[0]),ds===ts){rs.push("By the constant multiple rule, \\("+is+astToLatex.convert(ns)+" = "+us.map(function(gs,bs){return astToLatex.convert(gs)}).join(" \\cdot ")+"\\).");let ys=["*"].concat(us);return ys=simplify(ys),ys}rs.push("By the constant multiple rule, \\("+is+astToLatex.convert(ns)+" = "+us.map(function(ys,gs){return astToLatex.convert(ys)}).join(" \\cdot ")+" \\cdot "+is+"\\left("+astToLatex.convert(ds)+"\\right)\\).");let fs=derivative(ds,ts,rs),hs=["*"].concat(us.concat([fs]));return hs=simplify(hs),rs.push("And so \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(hs)+"\\)."),hs}rs.push("Using the product rule, \\("+is+astToLatex.convert(ns)+" = "+os.map(function(ds,fs){return os.map(function(hs,ys){return fs===ys?is+"\\left("+astToLatex.convert(ds)+"\\right)":astToLatex.convert(hs)}).join(" \\cdot ")}).join(" + ")+"\\).");let cs=os.slice(),ps=["+"].concat(os.map(function(ds,fs){return["*"].concat(cs.map(function(hs,ys){if(fs===ys){let gs=derivative(hs,ts,rs);return gs===1?null:gs}return hs}).filter(function(hs){return hs!=null}))}));return ps=simplify(ps),rs.push("So using the product rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ps)+"\\)."),ps}if(as==="/"){let ls=os[0],us=os[1];if(variables(us).indexOf(ts)<0){rs.push("By the constant multiple rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(["/",1,us])+" \\cdot "+is+"\\left("+astToLatex.convert(ls)+"\\right)\\).");let hs=derivative(ls,ts,rs),ys=textToAst$2.convert("(1/g)*d"),gs=substitute$1(ys,{d:hs,g:us});return gs=simplify(gs),rs.push("So \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(gs)+"\\)."),gs}if(variables(ls).indexOf(ts)<0){ls!==1&&rs.push("By the constant multiple rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ls)+" \\cdot "+is+"\\left("+astToLatex.convert(["/",1,us])+"\\right)\\)."),rs.push("Since \\(\\frac{d}{du} \\frac{1}{u}\\) is \\(\\frac{-1}{u^2}\\), the chain rule gives \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ls)+"\\cdot \\frac{-1}{ "+astToLatex.convert(us)+"^2} \\cdot "+is+astToLatex.convert(us)+"\\).");let hs=derivative(us,ts,rs),ys=textToAst$2.convert("f * (-a/(g^2))"),gs=substitute$1(ys,{f:ls,a:hs,g:us});return gs=simplify(gs),rs.push("So since \\(\\frac{d}{du} \\frac{1}{u}\\) is \\(\\frac{-1}{u^2}\\), the chain rule gives \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(gs)+"\\)."),gs}rs.push("Using the quotient rule, \\("+is+astToLatex.convert(ns)+" = \\frac{"+is+"\\left("+astToLatex.convert(ls)+"\\right) \\cdot "+astToLatex.convert(us)+" - "+astToLatex.convert(ls)+"\\cdot "+is+"\\left("+astToLatex.convert(us)+"\\right)}{ \\left( "+astToLatex.convert(us)+" \\right)^2} \\).");let cs=derivative(ls,ts,rs),ps=derivative(us,ts,rs),ds=textToAst$2.convert("(a * g - f * b)/(g^2)"),fs=substitute$1(ds,{a:cs,b:ps,f:ls,g:us});return fs=simplify(fs),rs.push("So using the quotient rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(fs)+"\\)."),fs}if(as==="^"){let ls=os[0],us=os[1];if(variables(us).indexOf(ts)<0){if(typeof ls=="string"&&ls==="x"){if(typeof us=="number"){let Cs=textToAst$2.convert("n * (f^m)"),xs=substitute$1(Cs,{n:us,m:us-1,f:ls});return xs=simplify(xs),rs.push("By the power rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(us)+" \\cdot \\left("+astToLatex.convert(ls)+"\\right)^{"+astToLatex.convert(["-",us,1])+"}\\)."),xs}let Ns=textToAst$2.convert("n * (f^(n-1))"),Ts=substitute$1(Ns,{n:us,f:ls});return Ts=simplify(Ts),rs.push("By the power rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(us)+" \\cdot \\left("+astToLatex.convert(ls)+"\\right)^{"+astToLatex.convert(["-",us,1])+"}\\)."),Ts}us!==1&&rs.push("By the power rule and the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(us)+" \\cdot \\left("+astToLatex.convert(ls)+"\\right)^{"+astToLatex.convert(["-",us,1])+"} \\cdot "+is+astToLatex.convert(ls)+"\\).");let gs=derivative(ls,ts,rs);if(us===1)return gs;if(typeof us=="number"){let Ns=textToAst$2.convert("n * (f^m) * a"),Ts=substitute$1(Ns,{n:us,m:us-1,f:ls,a:gs});return Ts=simplify(Ts),rs.push("So by the power rule and the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(Ts)+"\\)."),Ts}let bs=textToAst$2.convert("n * (f^(n-1)) * a"),vs=substitute$1(bs,{n:us,f:ls,a:gs});return vs=simplify(vs),rs.push("So by the power rule and the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(vs)+"\\)."),vs}if(ls==="e"&&math$1.define_e){if(typeof us=="string"&&us===ts){let Ns=textToAst$2.convert("e^(f)"),Ts=substitute$1(Ns,{f:us});return Ts=simplify(Ts),rs.push("The derivative of \\(e^"+astToLatex.convert(ts)+"\\) is itself, that is, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ns)+"\\)."),Ts}rs.push("Using the rule for \\(e^x\\) and the chain rule, we know \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ns)+" \\cdot "+is+astToLatex.convert(us)+"\\).");let gs=textToAst$2.convert("e^(f)*d"),bs=derivative(us,ts,rs),vs=substitute$1(gs,{f:us,d:bs});return vs=simplify(vs),rs.push("So using the rule for \\(e^x\\) and the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(vs)+"\\)."),vs}if(typeof ls=="number"){if(typeof us=="string"&&us===ts){let Cs=textToAst$2.convert("a^(f) * log(a)"),xs=substitute$1(Cs,{a:ls,f:us});return xs=simplify(xs),rs.push("The derivative of \\(a^"+astToLatex.convert(ts)+"\\) is \\(a^{"+astToLatex.convert(ts)+"} \\, \\log a\\), that is, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(xs)+"\\)."),xs}let gs=textToAst$2.convert("a^(f) * log(a)"),bs=substitute$1(gs,{a:ls,f:us});rs.push("Using the rule for \\(a^x\\) and the chain rule, we know \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(bs)+" \\cdot "+is+astToLatex.convert(us)+"\\).");let vs=textToAst$2.convert("a^(b)*log(a)*d"),Ns=derivative(us,ts,rs),Ts=substitute$1(vs,{a:ls,b:us,d:Ns});return Ts=simplify(Ts),rs.push("So using the rule for \\(a^x\\) and the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(Ts)+"\\)."),Ts}let cs=ls,ps=us;rs.push("Recall the general rule for exponents, namely that \\(\\frac{d}{dx} u(x)^{v(x)} = u(x)^{v(x)} \\cdot \\left( v'(x) \\cdot \\log u(x) + \\frac{v(x) \\cdot u'(x)}{u(x)} \\right)\\).  In this case, \\(u(x) = "+astToLatex.convert(cs)+"\\) and \\(v(x) = "+astToLatex.convert(ps)+"\\).");let ds=derivative(cs,ts,rs),fs=derivative(ps,ts,rs),hs=textToAst$2.convert("(f^g)*(b * log(f) + (g * a)/f)"),ys=substitute$1(hs,{a:ds,b:fs,f:cs,g:ps});return ys=simplify(ys),rs.push("So by the general rule for exponents, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ys)+"\\)."),ys}if(as==="apply"&&!(os[0]in derivatives)){let ls=os[1];rs.push("By the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(substitute$1(["apply",os[0]+"'","x"],{x:ls}))+" \\cdot "+is+astToLatex.convert(ls)+"\\).");let us=["*",substitute$1(["apply",os[0]+"'","x"],{x:ls}),derivative(ls,ts,rs)];return us=simplify(us),rs.push("So by the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(us)+"\\)."),us}if(as==="apply"&&os[0]in derivatives||as in derivatives){let ls=!1;as==="apply"&&(as=os[0],os=os.slice(1),ls=!0);let us=os[0];if(typeof us=="number"){let cs=0;return rs.push("The derivative of a constant is zero so \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(cs)+"\\)."),cs}if(typeof us=="string"&&us===ts){let cs=["*",substitute$1(derivatives[as],{x:us})];return cs=simplify(cs),rs.push("It is the case that \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(cs)+"\\)."),cs}if(typeof us=="string"&&us!==ts){let cs=0;return rs.push("Since the derivative of a constant is zero, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(cs)+"\\)."),cs}{let cs=[as,"u"];ls&&(cs=["apply"].concat(cs)),rs.push("Recall \\(\\frac{d}{du}"+astToLatex.convert(cs)+" = "+astToLatex.convert(derivative(cs,"u",[]))+"\\)."),rs.push("By the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(substitute$1(derivatives[as],{x:us}))+" \\cdot "+is+astToLatex.convert(us)+"\\).");let ps=["*",substitute$1(derivatives[as],{x:us}),derivative(us,ts,rs)];return ps=simplify(ps),rs.push("So by the chain rule, \\("+is+astToLatex.convert(ns)+" = "+astToLatex.convert(ps)+"\\)."),ps}}return 0}function lowercaseFirstLetter(ss){return ss.charAt(0).toLowerCase()+ss.slice(1)}function simplify_story(ss){for(let ts=ss.length-1;ts>=1;ts--)ss[ts]===ss[ts-1]&&ss.splice(ts,1);for(let ts=0;ts<ss.length;ts++)for(let rs=ts+1;rs<ss.length;rs++)ss[ts]===ss[rs]&&(ss[rs]="Again, "+lowercaseFirstLetter(ss[rs]));return ss}function derivative_story(ss,ts){var rs=[];return derivative(ss,ts,rs),rs=simplify_story(rs)}const derivativeStory=derivative_story;var differentiation=Object.freeze({__proto__:null,derivative,derivative_story,derivativeStory});const unicode_operators={"+":function(ss){return ss.join(" ")},"-":function(ss){return"-"+ss[0]},"*":function(ss){return ss.join(" ")},"/":function(ss){return ss[0]+"/"+ss[1]},_:function(ss){return ss[0]+"_"+ss[1]},"^":function(ss){return ss[0]+"^"+ss[1]},prime:function(ss){return ss[0]+"'"},tuple:function(ss){return"( "+ss.join(", ")+" )"},array:function(ss){return"[ "+ss.join(", ")+" ]"},list:function(ss){return ss.join(", ")},set:function(ss){return"{ "+ss.join(", ")+" }"},vector:function(ss){return"( "+ss.join(", ")+" )"},altvector:function(ss){return" "+ss.join(", ")+" "},interval:function(ss){return"( "+ss.join(", ")+" )"},matrix:function(ss){return"( "+ss.join(", ")+" )"},and:function(ss){return ss.join(" and ")},or:function(ss){return ss.join(" or ")},not:function(ss){return"not "+ss[0]},"=":function(ss){return ss.join(" = ")},"<":function(ss){return ss.join(" < ")},">":function(ss){return ss.join(" > ")},lts:function(ss){return ss.join(" < ")},gts:function(ss){return ss.join(" > ")},le:function(ss){return ss.join("  ")},ge:function(ss){return ss.join("  ")},ne:function(ss){return ss.join("  ")},forall:function(ss){return" "+ss[0]},exists:function(ss){return" "+ss[0]},in:function(ss){return ss[0]+"  "+ss[1]},notin:function(ss){return ss[0]+"  "+ss[1]},ni:function(ss){return ss[0]+"  "+ss[1]},notni:function(ss){return ss[0]+"  "+ss[1]},subset:function(ss){return ss[0]+"  "+ss[1]},subseteq:function(ss){return ss[0]+"  "+ss[1]},notsubset:function(ss){return ss[0]+"  "+ss[1]},notsubseteq:function(ss){return ss[0]+"  "+ss[1]},superset:function(ss){return ss[0]+"  "+ss[1]},superseteq:function(ss){return ss[0]+"  "+ss[1]},notsuperset:function(ss){return ss[0]+"  "+ss[1]},notsuperseteq:function(ss){return ss[0]+"  "+ss[1]},union:function(ss){return ss.join("  ")},intersect:function(ss){return ss.join("  ")},perp:function(ss){return ss.join("  ")},parallel:function(ss){return ss.join("  ")},derivative_leibniz:function(ss){return"d"+ss[0]+"/d"+ss[1]},partial_derivative_leibniz:function(ss){return""+ss[0]+"/"+ss[1]},"|":function(ss){return ss[0]+" | "+ss[1]},":":function(ss){return ss[0]+" : "+ss[1]},binom:function(ss){return"binom( "+ss[0]+", "+ss[1]+" )"},vec:function(ss){return"vec("+ss[0]+")"},linesegment:function(ss){return"linesegment( "+ss.join(", ")+" )"},angle:function(ss,ts){return ts?""+ss.join(""):"( "+ss.join(", ")+" )"},unit:function(ss){return ss[0]+" "+ss[1]}},nonunicode_operators={"+":function(ss){return ss.join(" ")},"-":function(ss){return"-"+ss[0]},"*":function(ss){return ss.join(" ")},"/":function(ss){return ss[0]+"/"+ss[1]},_:function(ss){return ss[0]+"_"+ss[1]},"^":function(ss){return ss[0]+"^"+ss[1]},prime:function(ss){return ss[0]+"'"},tuple:function(ss){return"( "+ss.join(", ")+" )"},array:function(ss){return"[ "+ss.join(", ")+" ]"},list:function(ss){return ss.join(", ")},set:function(ss){return"{ "+ss.join(", ")+" }"},vector:function(ss){return"( "+ss.join(", ")+" )"},altvector:function(ss){return"( "+ss.join(", ")+" )"},interval:function(ss){return"( "+ss.join(", ")+" )"},matrix:function(ss){return"( "+ss.join(", ")+" )"},and:function(ss){return ss.join(" and ")},or:function(ss){return ss.join(" or ")},not:function(ss){return"not "+ss[0]},"=":function(ss){return ss.join(" = ")},"<":function(ss){return ss.join(" < ")},">":function(ss){return ss.join(" > ")},lts:function(ss){return ss.join(" < ")},gts:function(ss){return ss.join(" > ")},le:function(ss){return ss.join(" <= ")},ge:function(ss){return ss.join(" >= ")},ne:function(ss){return ss.join(" ne ")},forall:function(ss){return"forall "+ss[0]},exists:function(ss){return"exists "+ss[0]},in:function(ss){return ss[0]+" elementof "+ss[1]},notin:function(ss){return ss[0]+" notelementof "+ss[1]},ni:function(ss){return ss[0]+" containselement "+ss[1]},notni:function(ss){return ss[0]+" notcontainselement "+ss[1]},subset:function(ss){return ss[0]+" subset "+ss[1]},subseteq:function(ss){return ss[0]+" subseteq "+ss[1]},notsubset:function(ss){return ss[0]+" notsubset "+ss[1]},notsubseteq:function(ss){return ss[0]+" notsubseteq "+ss[1]},superset:function(ss){return ss[0]+" superset "+ss[1]},superseteq:function(ss){return ss[0]+" superseteq "+ss[1]},notsuperset:function(ss){return ss[0]+" notsuperset "+ss[1]},notsuperseteq:function(ss){return ss[0]+" notsuperseteq "+ss[1]},union:function(ss){return ss.join(" union ")},intersect:function(ss){return ss.join(" intersect ")},perp:function(ss){return ss.join(" perp ")},parallel:function(ss){return ss.join(" parallel ")},derivative_leibniz:function(ss){return"d"+ss[0]+"/d"+ss[1]},partial_derivative_leibniz:function(ss){return""+ss[0]+"/"+ss[1]},"|":function(ss){return ss[0]+" | "+ss[1]},":":function(ss){return ss[0]+" : "+ss[1]},binom:function(ss){return"binom( "+ss[0]+", "+ss[1]+" )"},vec:function(ss){return"vec("+ss[0]+")"},linesegment:function(ss){return"linesegment( "+ss.join(", ")+" )"},angle:function(ss,ts){return ts?"angle "+ss.join(""):"angle( "+ss.join(", ")+" )"},unit:function(ss){return ss[0]+" "+ss[1]}},output_unicodeDefault=!0;class astToText$2{constructor({output_unicode:ts=output_unicodeDefault,padToDigits:rs=null,padToDecimals:ns=null,showBlanks:is=!0}={}){this.output_unicode=ts,this.operators=unicode_operators,ts||(this.operators=nonunicode_operators),this.padToDigits=rs,this.padToDecimals=ns,this.showBlanks=is}convert(ts){return this.statement(ts)}statement(ts){if(!Array.isArray(ts))return this.single_statement(ts);let rs=ts[0],ns=ts.slice(1);if(rs==="ldots")return"...";if(!(rs in this.operators)&&rs!=="apply")throw new Error("Badly formed ast: operator "+rs+" not recognized.");return rs==="and"||rs==="or"?this.operators[rs](ns.map(function(is,as){let os=this.single_statement(is);return os.match(/ /)&&!os.match(/^\(.*\)$/)?"("+os+")":os}.bind(this))):this.single_statement(ts)}single_statement(ts){if(!Array.isArray(ts))return this.expression(ts);let rs=ts[0],ns=ts.slice(1);if(rs==="not")return this.operators[rs](ns.map(function(is,as){let os=this.single_statement(is);return os.match(/ /)&&!os.match(/^\(.*\)$/)?"("+os+")":os}.bind(this)));if(rs==="exists"||rs==="forall")return this.operators[rs]([this.single_statement(ns[0])]);if(rs==="="||rs==="ne"||rs==="<"||rs===">"||rs==="le"||rs==="ge"||rs==="in"||rs==="notin"||rs==="ni"||rs==="notni"||rs==="subset"||rs==="notsubset"||rs==="subseteq"||rs==="notsubseteq"||rs==="superset"||rs==="notsuperset"||rs==="superseteq"||rs==="notsuperseteq")return this.operators[rs](ns.map(function(is,as){return this.expression(is)}.bind(this)));if(rs==="lts"||rs==="gts"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");let os=this.expression(is[1]);for(let ls=1;ls<is.length-1;ls++)as[ls]?os+=rs==="lts"?" < ":" > ":rs==="lts"?this.output_unicode?os+="  ":os+=" <= ":this.output_unicode?os+="  ":os+=" >= ",os+=this.expression(is[ls+1]);return os}return this.expression(ts)}expression(ts){if(!Array.isArray(ts))return this.term(ts);let rs=ts[0],ns=ts.slice(1);return rs==="+"?ns.length===1?"+"+this.term(ns[0]):this.operators[rs](ns.map(function(is,as){return as>0?this.termWithPlusIfNotNegated(is):this.term(is)}.bind(this))):["union","intersect","perp","parallel"].includes(rs)?this.operators[rs](ns.map(function(is,as){return this.term(is)}.bind(this))):this.term(ts)}term(ts){if(!Array.isArray(ts))return this.factor(ts);let rs=ts[0],ns=ts.slice(1);if(rs==="-")return this.operators[rs](ns.map(function(is,as){return this.term(is)}.bind(this)));if(rs==="*")return this.operators[rs](ns.map(function(is,as){let os;return as>0?(os=this.factorWithParenthesesIfNegatedOrExplicitPlus(is),os.match(/^[0-9]/)?"* "+os:is[0]==="angle"&&ns.length>1?"( "+os+" )":os):(os=this.factor(is),is[0]==="angle"&&ns.length>1?"( "+os+" )":os)}.bind(this)));if(rs==="/"){let is=this.factor(ns[0]),as=this.factor(ns[1]);return this.simple_factor_or_function_or_parens(ns[0])||(is="("+is+")"),this.simple_factor_or_function_or_parens(ns[1])||(as="("+as+")"),this.operators[rs]([is,as])}return rs==="unit"?this.operators[rs](ns.map(function(is,as){return this.expression(is)}.bind(this))):this.factor(ts)}symbolConvert(ts){let rs={alpha:"",beta:"",Gamma:"",gamma:"",Delta:"",delta:"",epsilon:"",zeta:"",eta:"",Theta:"",theta:"",iota:"",kappa:"",Lambda:"",lambda:"",mu:"",nu:"",Xi:"",xi:"",Pi:"",pi:"",rho:"",Sigma:"",sigma:"",tau:"",Upsilon:"",upsilon:"",Phi:"",phi:"",Psi:"",psi:"",Omega:"",omega:"",perp:"",int:""};return this.output_unicode&&ts in rs?rs[ts]:this.showBlanks||ts!==""?ts:""}simple_factor_or_function_or_parens(ts){let rs=this.factor(ts);return!!(rs.length<=1||typeof ts=="string"&&ts.match(/^\w+$/)||Array.isArray(ts)&&ts[0]==="apply"||rs.match(/^\(.*\)$/)||rs.match(/^.*$/))||typeof ts=="number"&&ts>=0&&!ts.toString().includes("e")}factor(ts){if(typeof ts=="string")return this.symbolConvert(ts);if(typeof ts=="number"){if(ts===1/0)return this.output_unicode?"":"infinity";if(ts===-1/0)return this.output_unicode?"-":"-infinity";if(Number.isNaN(ts))return"NaN";{let is=ts.toString(),as=is.indexOf("e");if(as===-1)return this.padToDigits!==null?is=padNumberStringToDigits(is,this.padToDigits):this.padToDecimals!==null&&(is=padNumberStringToDecimals(is,this.padToDecimals)),is;let os=is.substring(0,as),ls=is.substring(as+1);if(this.padToDigits!==null)os=padNumberStringToDigits(os,this.padToDigits);else if(this.padToDecimals!==null){let us=Number(ls);if(us>0)return is=ts.toLocaleString("fullwide",{useGrouping:!1}),padNumberStringToDecimals(is,this.padToDecimals);os=padNumberStringToDecimals(os,this.padToDecimals+us)}return ls[0]==="+"?os+" * 10^"+ls.substring(1):os+" * 10^("+ls+")"}}if(!Array.isArray(ts))return"";let rs=ts[0],ns=ts.slice(1);if(rs==="^"){if(Number.isInteger(ns[0])&&Number.isInteger(ns[1])){let ls;return ls=ns[0]<0?"("+ns[0].toString()+")":ns[0].toString(),ns[1]<0?ls+"^("+ns[1].toString()+")":ls+"^"+ns[1].toString()}let is=this.factor(ns[0]),as=ns[0];for(;as[0]==="prime";)as=as[1];this.simple_factor_or_function_or_parens(as)||as[0]==="_"&&typeof as[1]=="string"||(is="("+is.toString()+")");let os=this.factor(ns[1]);return this.simple_factor_or_function_or_parens(ns[1])||(os="("+os.toString()+")"),is+"^"+os}if(rs==="_")return this.operators[rs](ns.map(function(is,as){let os=this.factor(is);return this.simple_factor_or_function_or_parens(is)?os:"("+os+")"}.bind(this)));if(rs==="prime"){let is=ns[0],as=1;for(;is[0]==="prime";)as+=1,is=is[1];let os=this.factor(is);this.simple_factor_or_function_or_parens(is)||is[0]==="_"&&typeof is[1]=="string"||(os="("+os+")");for(let ls=0;ls<as;ls++)os+="'";return os}if(rs==="-")return this.operators[rs](ns.map(function(is,as){return this.factor(is)}.bind(this)));if(rs==="tuple"||rs==="array"||rs==="list"||rs==="set"||rs==="vector"||rs==="altvector"||rs==="|"||rs===":"||rs==="binom"||rs==="vec"||rs==="linesegment")return this.operators[rs](ns.map(function(is,as){return this.statement(is)}.bind(this)));if(rs==="interval"){let is=ns[0],as=ns[1];if(is[0]!=="tuple"||as[0]!=="tuple")throw new Error("Badly formed ast");let os=this.statement(is[1])+", "+this.statement(is[2]);return os=as[1]?"[ "+os:"( "+os,as[2]?os+=" ]":os+=" )",os}if(rs==="matrix"){let is=ns[0],as=ns[1],os="[ ";for(let ls=0;ls<is[1];ls+=1){os+="[ ";for(let us=0;us<is[2];us+=1)os+=this.statement(as[ls+1][us+1]),us<is[2]-1&&(os+=","),os+=" ";os+="]",ls<is[1]-1&&(os+=","),os+=" "}return os+="]",os}if(rs==="derivative_leibniz"||rs==="partial_derivative_leibniz"){let is="d";rs==="partial_derivative_leibniz"&&(is="");let as=ns[0],os=ns[1],ls=1,us="";Array.isArray(as)?(us=as[1],ls=as[2]):us=as;let cs=is;ls>1&&(cs=cs+"^"+ls),cs=cs+this.symbolConvert(us)+"/";let ps=1;Array.isArray(os)&&(ps=os.length-1);for(let ds=1;ds<=ps;ds++){let fs=os[ds],hs=1,ys="";Array.isArray(fs)?(ys=fs[1],hs=fs[2]):ys=fs,cs=cs+is+this.symbolConvert(ys),hs>1&&(cs=cs+"^"+hs)}return cs}if(rs==="apply"){if(ns[0]==="abs")return"|"+this.statement(ns[1])+"|";if(ns[0]==="factorial"){let ls=this.factor(ns[1]);return this.simple_factor_or_function_or_parens(ns[1])||ns[1][0]==="_"&&typeof ns[1][1]=="string"?ls+"!":"("+ls+")!"}let is=ns[0];if(is[0]==="^"&&(is=is[1]),is[0]==="_"&&(is=is[1]),is==="int"){let ls,us=this.factor(ns[0]),cs=ns[1];if(Array.isArray(cs)&&cs[0]==="*"){let ps=[],ds=["*"];for(let fs=1;fs<cs.length;fs++){let hs=cs[fs];Array.isArray(hs)&&hs[0]==="d"?ps.push(hs):ds.push(hs)}ls=this.term(ds),ps.length>0&&(ls+=" "+ps.map(fs=>"d"+this.factor(fs[1])).join(" "))}return ls||(ls=this.term(ns[1])),us+" "+ls}let as=this.factor(ns[0]),os=this.statement(ns[1]);return ns[1][0]!=="tuple"&&(os="("+os+")"),as+os}if(rs==="angle"){let is=ns.every(as=>{if(typeof as=="string"&&as.length===1)return!0;if(!Array.isArray(as))return!1;let os=as[0];return os==="_"||os==="^"||os==="prime"});return this.operators[rs](ns.map(function(as,os){return this.statement(as)}.bind(this)),is)}return rs==="+"&&ts.length===2?"+ "+this.factor(ts[1]):"("+this.statement(ts)+")"}factorWithParenthesesIfNegatedOrExplicitPlus(ts){var rs=this.factor(ts);return rs.match(/^-/)||rs.match(/^\+/)?"("+rs+")":rs}termWithPlusIfNotNegated(ts){let rs=this.term(ts);return rs.match(/^-/)?rs.match(/^-[^ ]/)?"- "+rs.slice(1):rs:"+ "+rs}}var astToText$1=new astToText$2;function subscripts_to_strings(ss,ts=!1){var rs=get_tree(ss);if(!Array.isArray(rs))return rs;let ns=rs[0],is=rs.slice(1);return ns==="_"&&(ts||is.every(as=>["number","string"].includes(typeof as)))?astToText$1.convert(rs):[ns].concat(is.map(as=>subscripts_to_strings(as,ts)))}function strings_to_subscripts(ss){var ts=get_tree(ss);if(typeof ts=="string"){let is=ts.match(/^([0-9a-zA-Z]+)_([a-zA-Z]+|[0-9]+)$/);if(is){let as=Number(is[1]);isNaN(as)&&(as=is[1]);let os=Number(is[2]);return isNaN(os)&&(os=is[2]),["_",as,os]}return ts}if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);return[rs].concat(ns.map(strings_to_subscripts))}var normalization=Object.freeze({__proto__:null,normalize_function_names,normalize_applied_functions,log_subscript_to_two_arg_log,substitute_abs,default_order,constants_to_floats,normalize_angle_linesegment_arg_order,tuples_to_vectors,to_intervals,altvectors_to_vectors,subscripts_to_strings,strings_to_subscripts}),astToText=new astToText$2;function generate_random_integer(ss,ts,rs){return ss=math$1.ceil(ss),ts=math$1.floor(ts),math$1.floor(rs()*(ts-ss+1))+ss}const equals$5=function({expr:ss,other:ts,randomBindings:rs,expr_context:ns,other_context:is,relative_tolerance:as=1e-12,absolute_tolerance:os=0,tolerance_for_zero:ls=1e-15,allowed_error_in_numbers:us=0,include_error_in_number_exponents:cs=!1,allowed_error_is_absolute:ps=!1,rng:ds}){if(Array.isArray(ss.tree)&&Array.isArray(ts.tree)){let fs=ss.tree[0],hs=ss.tree.slice(1),ys=ts.tree[0],gs=ts.tree.slice(1);if(fs==="tuple"||fs==="vector"||fs==="altvector"||fs==="list"||fs==="array"||fs==="matrix"||fs==="interval"){if(ys!==fs||gs.length!==hs.length)return!1;for(let bs=0;bs<hs.length;bs++)if(!equals$5({expr:ns.fromAst(hs[bs]),other:is.fromAst(gs[bs]),randomBindings:rs,expr_context:ns,other_context:is,relative_tolerance:as,absolute_tolerance:os,tolerance_for_zero:ls,allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,rng:ds}))return!1;return!0}if(hs.length===2&&["=",">","<","ge","le"].includes(fs)){if(gs.length!==2||(fs===">"?(fs="<",hs=[hs[1],hs[0]]):fs==="ge"&&(fs="le",hs=[hs[1],hs[0]]),ys===">"?(ys="<",gs=[gs[1],gs[0]]):ys==="ge"&&(ys="le",gs=[gs[1],gs[0]]),fs!==ys))return!1;let bs=["+",hs[0],["-",hs[1]]],vs=["+",gs[0],["-",gs[1]]],Ns=fs!=="=";return component_equals({expr:ns.fromAst(bs),other:is.fromAst(vs),randomBindings:rs,expr_context:ns,other_context:is,allow_proportional:!0,require_positive_proportion:Ns,relative_tolerance:as,absolute_tolerance:os,tolerance_for_zero:ls,allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,rng:ds})}}return component_equals({expr:ss,other:ts,randomBindings:rs,expr_context:ns,other_context:is,relative_tolerance:as,absolute_tolerance:os,tolerance_for_zero:ls,allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,rng:ds})},component_equals=function({expr:ss,other:ts,randomBindings:rs,expr_context:ns,other_context:is,allow_proportional:as=!1,require_positive_proportion:os=!1,relative_tolerance:ls,absolute_tolerance:us,tolerance_for_zero:cs,allowed_error_in_numbers:ps,include_error_in_number_exponents:ds,allowed_error_is_absolute:fs,rng:hs}){var ys=1e-20*Number.MAX_VALUE,gs=0,bs=10;ss=ss.normalize_function_names(),ts=ts.normalize_function_names(),ss=ss.log_subscript_to_two_arg_log(),ts=ts.log_subscript_to_two_arg_log(),ss=ss.subscripts_to_strings(),ts=ts.subscripts_to_strings(),ss=ss.normalize_applied_functions(),ts=ts.normalize_applied_functions();let vs=rename_functions_with_exponents(ss.tree),Ns=rename_functions_with_exponents(ts.tree);ss=ns.fromAst(rename_vecs(vs)),ts=is.fromAst(rename_vecs(Ns));var Ts=[...new Set([...ss.variables(),...ts.variables()])];math$1.define_pi&&(Ts=Ts.filter(function(Us){return Us!=="pi"})),math$1.define_i&&(Ts=Ts.filter(function(Us){return Us!=="i"})),math$1.define_e&&(Ts=Ts.filter(function(Us){return Us!=="e"}));var Cs=[];for(let Us=0;Us<Ts.length;Us++)(is_integer_ast(Ts[Us],ns.assumptions)||is_integer_ast(Ts[Us],is.assumptions))&&Cs.push(Ts[Us]);var xs=[...new Set([...ss.functions(),...ts.functions()])].filter(Us=>Us.length===1||Us.includes("_")||Us.includes("^")),As=xs.filter(Us=>Ts.includes(Us));if(xs=xs.filter(Us=>!Ts.includes(Us)),As.length>0){let Us=ss.tree,zs=ts.tree,Hs="x1";for(;[...xs,...Ts].includes(Hs);)Hs+="x1";let el="x2";for(;[...xs,...Ts].includes(el);)el+="x2";for(let Ys of As){let il=Ys+Ys;for(;[...xs,...Ts].includes(il);)il+=Ys;let al=[[["apply",Ys,Hs],["apply",il,Hs],{variables:{[Hs]:!0}}]];Us=applyAllTransformations(Us,al),zs=applyAllTransformations(zs,al),xs.push(il)}ss=ns.fromAst(Us),ts=is.fromAst(zs)}try{var ws=ss.f(),Es=ts.f()}catch{return ss.equalsViaSyntax(ts,{allow_blanks:!0})}let Ss,Ds,Vs;if(ps>0){let Us=replace_numbers_with_parameters({expr:ss,variables:Ts,include_exponents:ds});Ss=ns.fromAst(Us.expr_with_params),Ds=Us.parameters;let zs=Object.keys(Ds);if(zs.length>0){let Hs=Ss.derivative(zs[0]);if(fs||(Hs=Hs.multiply(Ds[zs[0]])),zs.length>1)for(let Ys of zs.slice(1)){let il=Ss.derivative(Ys);fs||(il=il.multiply(Ds[Ys])),Hs=Hs.add(il)}let el=Hs.multiply(ps);try{Vs=el.f()}catch{}}}var Is=1,Os=[10,1,100,.1,1e3,.01],Ps=0;let $s=0,Rs=!0,ks=0;for(let Us=0;Us<1e3;Us++){try{var _s=Bs(Os[Ps],hs)}catch{continue}if(_s.always_zero===!1&&(Rs=!1),!_s.equal&&!_s.out_of_bounds&&!_s.always_zero&&_s.sufficient_finite_values!==!1&&(ks++,ks>100))return!1;if(_s.equal){if(_s.always_zero){if(!Rs)continue;if($s+=1,$s>5&&(Ps+=1,$s=0),Ps>=Os.length)return!0;continue}return!0}}return!1;function Bs(Us,zs){var Hs,el=rs(zs,Ts,Us);for(let tl=0;tl<Cs.length;tl++)el[Cs[tl]]=generate_random_integer(-10,10,zs);for(let tl=0;tl<xs.length;tl++){let rl=1*(zs()-.5),qs=2*(zs()-.5),Gs=6*(zs()-.5),Xs=24*(zs()-.5);el[xs[tl]]=function(Ks){return math$1.add(math$1.multiply(math$1.add(math$1.multiply(math$1.add(math$1.multiply(rl,Ks),qs),Ks),Gs),Ks),Xs)}}Vs&&(Hs=Object.assign({},el,Ds));var Ys=ws(el),il=Es(el);if(typeof Ys=="boolean"||typeof il=="boolean")return{out_of_bounds:!0,always_zero:!1};var al=math$1.abs(Ys),ll=math$1.abs(il);if(!(al<ys&&ll<ys))return{out_of_bounds:!0,always_zero:!1};if(!(al===0||al>gs)||!(ll===0||ll>gs))return{out_of_bounds:!0,always_zero:!1};var nl=Math.min(al,ll),cl=Math.max(al,ll),dl=1;let sl=0;if(Vs){try{sl=math$1.abs(Vs(Hs))}catch{return{equal_at_start:!1,always_zero:!1}}if(!Number.isFinite(sl))return{equal_at_start:!1,always_zero:!1}}if(sl+=nl*ls,sl=Math.min(sl,.1*nl),sl+=sl!==0||Ys!==0&&il!==0?us:cs,!(cl===0||math$1.abs(math$1.subtract(Ys,il))<sl)){if(!as)return{equal_at_start:!1,always_zero:!1};if(al===0||ll===0)return{equal_at_start:!1,always_zero:!1};if(dl=math$1.divide(Ys,il),os&&!(dl>0))return{equal_at_start:!1,always_zero:!1}}var js=cl===0,Ls=0;for(let tl=0;tl<100;tl++){var Ws,Zs=rs(zs,Ts,Is/100,el);for(let rl=0;rl<Cs.length;rl++)Zs[Cs[rl]]=generate_random_integer(-10,10,zs);for(let rl=0;rl<xs.length;rl++){let qs=1*(zs()-.5),Gs=2*(zs()-.5),Xs=6*(zs()-.5),Ks=24*(zs()-.5);Zs[xs[rl]]=function(ol){return math$1.add(math$1.multiply(math$1.add(math$1.multiply(math$1.add(math$1.multiply(qs,ol),Gs),ol),Xs),ol),Ks)}}Vs&&(Ws=Object.assign({},Zs,Ds));try{Ys=ws(Zs),il=math$1.multiply(Es(Zs),dl)}catch{continue}if(al=math$1.abs(Ys),ll=math$1.abs(il),al<ys&&ll<ys){nl=Math.min(al,ll),cl=Math.max(al,ll),Ls++;let rl=0;if(Vs){try{rl=math$1.abs(Vs(Ws))}catch{continue}if(!Number.isFinite(rl))continue}if(rl+=nl*ls,rl=Math.min(rl,.1*nl),rl+=rl!==0||Ys!==0&&il!==0?us:cs,!(cl===0||math$1.abs(math$1.subtract(Ys,il))<rl))return{equality_in_middle:!1,always_zero:!1};if(js=js&&cl===0,Ls>=bs)return{equal:!0,always_zero:js}}}return{sufficient_finite_values:!1,always_zero:js}}};function replace_numbers_with_parameters({expr:ss,variables:ts,include_exponents:rs=!1}){let ns={},is=0;function as(){is++;let os="par"+is;for(;ts.includes(os);)is++,os="par"+is;return os}return{expr_with_params:function os(ls){if(typeof ls=="number"){if(ls===0)return ls;{let ps=as();return ns[ps]=ls,ps}}if(typeof ls=="string"){if(ls==="pi"){if(math$1.define_pi){let ps=as();return ns[ps]=math$1.PI,ps}}else if(ls==="e"&&math$1.define_e){let ps=as();return ns[ps]=math$1.e,ps}return ls}if(!Array.isArray(ls))return ls;let us=ls[0],cs=ls.slice(1);return us!=="^"||rs?[us,...cs.map(os)]:[us,os(cs[0]),cs[1]]}((ss=ss.evaluate_numbers({max_digits:1/0})).tree),parameters:ns}}function rename_functions_with_exponents(ss){if(!Array.isArray(ss))return ss;let ts=ss[0],rs=ss.slice(1);if(ts==="apply"){let ns=rs[0];return Array.isArray(ns)&&ns[0]==="^"&&ns.slice(1).every(is=>["number","string"].includes(typeof is))&&(ns=astToText.convert(ns)),["apply",ns,rs[1]]}return[ts,...rs.map(rename_functions_with_exponents)]}function rename_vecs(ss){if(!Array.isArray(ss))return ss;let ts=ss[0],rs=ss.slice(1);return ts==="vec"&&rs.length===1?"__vec_"+astToText.convert(rs[0]):[ts,...rs.map(rename_vecs)]}function randomComplexBindings(ss,ts,rs,ns){var is={};return ns===void 0?ts.forEach(function(as){is[as]=math$1.complex(2*ss()*rs-rs,2*ss()*rs-rs)}):ts.forEach(function(as){is[as]=math$1.complex(ns[as].re+2*ss()*rs-rs,ns[as].im+2*ss()*rs-rs)}),is}const equals$4=function(ss,ts,{relative_tolerance:rs=1e-12,absolute_tolerance:ns=0,tolerance_for_zero:is=1e-15,allowed_error_in_numbers:as=0,include_error_in_number_exponents:os=!1,allowed_error_is_absolute:ls=!1,allow_blanks:us=!1}={}){if(!us&&(ss.variables().includes("")||ts.variables().includes("")))return!1;let cs=seedrandom$1("complex_seed");return ss=ss.remove_scaling_units(),ts=ts.remove_scaling_units(),!(!ss.isAnalytic({allow_abs:!0,allow_arg:!0,allow_relation:!0})||!ts.isAnalytic({allow_abs:!0,allow_arg:!0,allow_relation:!0}))&&equals$5({expr:ss,other:ts,randomBindings:randomComplexBindings,expr_context:ss.context,other_context:ts.context,relative_tolerance:rs,absolute_tolerance:ns,tolerance_for_zero:is,allowed_error_in_numbers:as,include_error_in_number_exponents:os,allowed_error_is_absolute:ls,rng:cs})};function randomRealBindings(ss,ts,rs,ns){var is={};return ns===void 0?ts.forEach(function(as){is[as]=2*ss()*rs-rs}):ts.forEach(function(as){is[as]=ns[as]+2*ss()*rs-rs}),is}const equals$3=function(ss,ts,{relative_tolerance:rs=1e-12,absolute_tolerance:ns=0,tolerance_for_zero:is=1e-15,allowed_error_in_numbers:as=0,include_error_in_number_exponents:os=!1,allowed_error_is_absolute:ls=!1}={}){if(!ss.isAnalytic()||!ts.isAnalytic())return!1;let us=seedrandom("real_seed");return equals$5({expr:ss,other:ts,randomBindings:randomRealBindings,expr_context:ss.context,other_content:ts.context,relative_tolerance:rs,absolute_tolerance:ns,tolerance_for_zero:is,allowed_error_in_numbers:as,include_error_in_number_exponents:os,allowed_error_is_absolute:ls,rng:us})},equals$2=function(ss,ts,{allowed_error_in_numbers:rs=0,include_error_in_number_exponents:ns=!1,allowed_error_is_absolute:is=!1,allow_blanks:as=!1}={}){if(!as&&(ss.variables().includes("")||ts.variables().includes("")))return!1;let os=ss.normalize_function_names().normalize_applied_functions().normalize_angle_linesegment_arg_order(),ls=ts.normalize_function_names().normalize_applied_functions().normalize_angle_linesegment_arg_order();return equal(os.tree,ls.tree,{allowed_error_in_numbers:rs,include_error_in_number_exponents:ns,allowed_error_is_absolute:is})},equals$1=function(ss,ts,{min_elements_match:rs=3,match_partial:ns=!1}={}){if(!is_discrete_infinite_set(ss))return!1;if(is_discrete_infinite_set(ts)){var is=[];let as=ss.context.get_assumptions(ss);if(as!==void 0&&is.push(as),as=ts.context.get_assumptions(ts),as!==void 0&&is.push(as),is=is.length===0?void 0:is.length===1?is[0]:clean_assumptions(["and"].concat(is)),ns){let os=contained_in$1(ss.tree,ts.tree,is,ns);if(os===!1)return 0;let ls=contained_in$1(ts.tree,ss.tree,is,ns);return ls===!1?0:os===!0?ls===!0?1:ls:ls===!0?os:Math.min(os,ls)}return contained_in$1(ss.tree,ts.tree,is,ns)&&contained_in$1(ts.tree,ss.tree,is,ns)}{let as=ts.tree;if(as[0]!=="list")return!1;let os=as.length-2;if(as[os+1][0]!=="ldots"||os<rs)return!1;let ls=as.slice(0,os+1),us=sequence_from_discrete_infinite(ss,os);return!!us&&(us=["list"].concat(us),equals(ss.context.from(us),ts.context.from(ls)))}};function is_discrete_infinite_set(ss){var ts=ss.tree;if(!Array.isArray(ts)||ts[0]!=="discrete_infinite_set")return!1;var rs=ts.slice(1);for(var ns of rs)if(!Array.isArray(ns)||ns[0]!=="tuple"||ns.length!==5)return!1;return!0}function contained_in$1(ss,ts,rs,ns){if(ss[0]==="discrete_infinite_set"){if(ns){let fs=0;for(let ys of ss.slice(1)){let gs=contained_in$1(ys,ts,rs,ns);gs===!0?fs++:gs!==!1&&(fs+=gs)}let hs=ss.length-1;return fs===hs||fs!==0&&fs/hs}return ss.slice(1).every(fs=>contained_in$1(fs,ts,rs))}var is=ss[1],as=ss[2],os=ss[3],ls=ss[4];if(!Array.isArray(os)||os[0]!=="-"||os[1]!==1/0||ls!==1/0)return!1;is=simplify(["/",is,as],rs,1/0);var us=ts.slice(1),cs=[];for(let fs=0;fs<us.length;fs++){let hs=us[fs][3],ys=us[fs][4];if(!Array.isArray(hs)||hs[0]!=="-"||hs[1]!==1/0||ys!==1/0)return!1;let gs=simplify(["/",us[fs][1],as],rs,1/0),bs=simplify(["/",us[fs][2],as],rs,1/0);if(typeof bs!="number")return!1;let vs=math$1.fraction(bs),Ns=vs.n,Ts=vs.d;cs.push([Ns,Ts,gs,bs])}for(cs.sort();cs[0][0]===1;){let fs=cs[0][2],hs=cs[0][3],ys=simplify(expand(["+",fs,["-",is]]),rs,1/0);if(Number.isFinite(ys)&&Number.isFinite(hs)&&(ys=math$1.mod(ys,hs),math$1.min(ys,hs-ys)<1e-10*hs))return!0;if(cs.splice(0,1),cs.length===0)return!1}var ps=[...new Set(cs.map(fs=>fs[0]))];let ds=0;for(let fs of ps){let hs=cs.map(function(gs,bs){let vs=fs/gs[0];return Number.isInteger(vs)?[gs[0],vs,bs]:void 0}).filter(gs=>gs),ys=[];for(let gs of hs){let bs=gs[0],vs=gs[1],Ns=gs[2],Ts=cs[Ns][2],Cs=cs[Ns][3];for(let xs=0;xs<bs;xs++){let As=simplify(expand(["+",Ts,["-",["+",is,xs]]]),rs,1/0);if(Number.isFinite(As)&&Number.isFinite(Cs)&&(As=math$1.mod(As,Cs),math$1.min(As,Cs-As)<1e-10*Cs)){for(let Es=0;Es<vs;Es++)ys[xs+Es*bs]=!0;let ws=!0;for(let Es=0;Es<fs;Es++)if(!ys[Es]){ws=!1;break}if(ws)return!0;break}}}if(ns){let gs=0;for(let bs=0;bs<fs;bs++)ys[bs]&&gs++;gs/=fs,gs>ds&&(ds=gs)}}return!!(ns&&ds>0)&&ds}function sequence_from_discrete_infinite(ss,ts){var rs=ss.tree.slice(1);if(rs.length>1)return;let ns=rs[0][1],is=rs[0][2],as=evaluate_numbers(rs[0][3]),os=rs[0][4];if(!Number.isInteger(as)||os!==1/0)return;let ls=[];for(let us=0;us<ts;us++)ls.push(evaluate_numbers(["+",["*",is,as+us],ns]));return ls}const equals=function(ss,ts,{relative_tolerance:rs=1e-12,absolute_tolerance:ns=0,tolerance_for_zero:is=1e-15,allowed_error_in_numbers:as=0,include_error_in_number_exponents:os=!1,allowed_error_is_absolute:ls=!1,allow_blanks:us=!1}={}){if(!us&&(ss.variables().includes("")||ts.variables().includes("")))return!1;let cs=ss.evaluate_numbers({max_digits:1/0}).normalize_function_names().normalize_applied_functions().normalize_angle_linesegment_arg_order().remove_scaling_units().simplify(),ps=ts.evaluate_numbers({max_digits:1/0}).normalize_function_names().normalize_applied_functions().normalize_angle_linesegment_arg_order().remove_scaling_units().simplify();return!!cs.equalsViaSyntax(ps,{allowed_error_in_numbers:as,include_error_in_number_exponents:os,allowed_error_is_absolute:ls,allow_blanks:!0})||!!ss.equalsViaComplex(ts,{relative_tolerance:rs,absolute_tolerance:ns,tolerance_for_zero:is,allowed_error_in_numbers:as,include_error_in_number_exponents:os,allowed_error_is_absolute:ls,allow_blanks:!0})||!!equals$1(ss,ts)};var equality=Object.freeze({__proto__:null,equals,equalsViaComplex:equals$4,equalsViaReal:equals$3,equalsViaSyntax:equals$2,equalsDiscreteInfinite:equals$1});const equalWithSignErrors=function(ss,ts,{equalityFunction:rs=equals,max_sign_errors:ns=1}={}){if(rs(ss,ts))return{matched:!0,n_sign_errors:0};for(let is=1;is<=ns;is++)if(equalSpecifiedSignErrors(ss,ts,{equalityFunction:rs,n_sign_errors:is}))return{matched:!0,n_sign_errors:is};return{matched:!1}},equalSpecifiedSignErrors=function(ss,ts,{equalityFunction:rs=c,n_sign_errors:ns=1}={}){if(ns===0)return rs(ss,ts);if(!(Number.isInteger(ns)&&ns>0))throw Error(`Have not implemented equality check with ${ns} sign errors.`);if(ns>1){let ps=rs;rs=function(ds,fs){return equalSpecifiedSignErrors(ds,fs,{equalityFunction:ps,n_sign_errors:ns-1})}}var is,as,os=ss.tree,ls=[[os]],us=0;ss.tree=["-",os];var cs=rs(ss,ts);if(ss.tree=os,cs)return!0;for(;is=ls[us++];)if(is=is[0],Array.isArray(is)){for(as=1;as<is.length;as++)if(ls.push([is[as]]),is[as]=["-",is[as]],cs=rs(ss,ts),is[as]=is[as][1],cs)return!0}return!1};var sign_error=Object.freeze({__proto__:null,equalSpecifiedSignErrors,equalWithSignErrors});function add$3(ss,ts){return clean(["+",get_tree(ss),get_tree(ts)])}function subtract(ss,ts){return clean(["+",get_tree(ss),["-",get_tree(ts)]])}function multiply(ss,ts){return clean(["*",get_tree(ss),get_tree(ts)])}function divide(ss,ts){return clean(["/",get_tree(ss),get_tree(ts)])}function pow(ss,ts){return clean(["^",get_tree(ss),get_tree(ts)])}function mod(ss,ts){return clean(["apply","mod",["tuple",get_tree(ss),get_tree(ts)]])}function copy(ss){return get_tree(ss)}var arithmetic=Object.freeze({__proto__:null,add:add$3,subtract,multiply,divide,pow,mod,copy}),analytic_operators=["+","-","*","/","^","tuple","vector","altvector","list","array","matrix","interval","vec"],non_analytic_functions=["abs","sign","arg"],relation_operators=["=","le","ge","<",">"];function isAnalytic(ss,{allow_abs:ts=!1,allow_arg:rs=!1,allow_relation:ns=!1}={}){var is=normalize_applied_functions(normalize_function_names(ss)),as=operators$3(is=subscripts_to_strings(is));for(let ls=0;ls<as.length;ls++){let us=as[ls];if(analytic_operators.indexOf(us)===-1&&(!ns||relation_operators.indexOf(us)===-1))return!1}var os=functions$2(is);for(let ls=0;ls<os.length;ls++){let us=os[ls];if(non_analytic_functions.includes(us)&&!(ts&&us=="abs"||rs&&us=="arg"))return!1}return!0}var analytic=Object.freeze({__proto__:null,isAnalytic});function create_discrete_infinite_set({offsets:ss,periods:ts,min_index:rs=["-",1/0],max_index:ns=1/0}={}){if(ss=get_tree(ss),ts=get_tree(ts),rs=get_tree(rs),ns=get_tree(ns),ss===void 0||ts===void 0)return;let is=[];if(ss[0]==="list")if(ts[0]==="list"){if(ss.length!==ts.length||ss.length===1)return;for(let as=1;as<ss.length;as++)is.push(["tuple",ss[as],ts[as],rs,ns])}else for(let as=1;as<ss.length;as++)is.push(["tuple",ss[as],ts,rs,ns]);else is.push(["tuple",ss,ts,rs,ns]);return["discrete_infinite_set"].concat(is)}var sets=Object.freeze({__proto__:null,create_discrete_infinite_set});function tuple(ss){var ts=[];ts.push("tuple");var rs=ss.length;for(let ns=0;ns<rs;ns++)ts.push(ss[ns]);return ts}function matrix(ss){var ts=[];ts.push("matrix");var rs=ss.length,ns=ss[0].length;for(let as=1;as<rs;as++)if(ss[as].length!==ns)throw new Error("Matrix dimensions mismatch");ts.push(tuple([rs,ns]));let is=[];for(let as=0;as<rs;as++)is.push(tuple(ss[as].map(function(os){return os.tree})));return ts.push(tuple(is)),ts}function vector_add(ss,ts){if(ss=get_tree(ss),ts=get_tree(ts),ss.length!==ts.length||ss[0]!=="tuple"&&ss[0]!=="vector"&&ss[0]!=="altvector"||ts[0]!=="tuple"&&ts[0]!=="vector"&&ts[0]!=="altvector")throw new Error("Can't add. Those aren't vectors, or the dimensions don't match");var rs=ss[0]==="altvector"&&ts[0]==="altvector"?["altvector"]:["vector"],ns=ss.length;for(let is=1;is<ns;is+=1)rs.push(["+",ss[is],ts[is]]);return simplify(rs)}function scalar_mul(ss,ts){if((ts=get_tree(ts))[0]!=="tuple"&&ts[0]!=="vector"&&ts[0]!=="altvector")throw new Error("Can't scalar multiply. Isn't a vector");var rs=ts[0]==="altvector"?["altvector"]:["vector"],ns=ts.length;for(let is=1;is<ns;is+=1)rs.push(["*",ts[is],ss]);return simplify(rs)}function vector_sub(ss,ts){return vector_add(ss,scalar_mul(-1,ts))}function dot_prod(ss,ts){if(ss=get_tree(ss),ts=get_tree(ts),ss.length!==ts.length||ss[0]!=="tuple"&&ss[0]!=="vector"&&ss[0]!=="altvector"||ts[0]!=="tuple"&&ts[0]!=="vector"&&ts[0]!=="altvector")throw new Error("Can't take dot product. Those aren't vectors, or the dimensions don't match");var rs=0,ns=ss.length;for(let is=1;is<ns;is+=1)rs=["+",rs,["*",ss[is],ts[is]]];return simplify(rs)}function cross_prod(ss,ts){if(ss=get_tree(ss),ts=get_tree(ts),ss[0]!=="tuple"&&ss[0]!=="vector"&&ss[0]!=="altvector"||ts[0]!=="tuple"&&ts[0]!=="vector"&&ts[0]!=="altvector")throw new Error("Can't take cross product. Those aren't vectors");if(ss.length===3&&ts.length===3)return simplify(["+",["*",ss[1],ts[2]],["-",["*",ss[2],ts[1]]]]);if(ss.length===4&&ts.length===4){var rs=["+",["*",ss[2],ts[3]],["-",["*",ss[3],ts[2]]]],ns=["+",["*",ss[3],ts[1]],["-",["*",ss[1],ts[3]]]],is=["+",["*",ss[1],ts[2]],["-",["*",ss[2],ts[1]]]];return simplify([ss[0]==="altvector"&&ts[0]==="altvector"?"altvector":"vector",rs,ns,is])}throw new Error("Can't take cross product. The dimensions aren't both 2 or 3.")}var matrix$1=Object.freeze({__proto__:null,matrix,vector_add,scalar_mul,vector_sub,dot_prod,cross_prod});class astToGuppy$1{constructor(){this.operators={"+":function(ts){return ts.join("<e>+</e>")},"-":function(ts){return"<e>-"+ts.join("-")+"</e>"},"*":function(ts){return ts.join('<f type="*" group="operations" c="yes"><b p="latex">\\cdot</b><b p="text">*</b></f>')},"/":function(ts){return astToGuppy$1.dfrac(ts[0],ts[1])},"^":function(ts){return astToGuppy$1.power(ts[0],ts[1])},sin:function(ts){return astToGuppy$1.trig("sin",ts[0])},cos:function(ts){return astToGuppy$1.trig("cos",ts[0])},tan:function(ts){return astToGuppy$1.trig("tan",ts[0])},arcsin:function(ts){return astToGuppy$1.trig("arcsin",ts[0])},arccos:function(ts){return astToGuppy$1.trig("arccos",ts[0])},arctan:function(ts){return astToGuppy$1.trig("arctan",ts[0])},arccsc:function(ts){return astToGuppy$1.trig("arccsc",ts[0])},arcsec:function(ts){return astToGuppy$1.trig("arcsec",ts[0])},arccot:function(ts){return astToGuppy$1.trig("arccot",ts[0])},csc:function(ts){return astToGuppy$1.trig("csc",ts[0])},sec:function(ts){return astToGuppy$1.trig("sec",ts[0])},cot:function(ts){return astToGuppy$1.trig("cot",ts[0])},log:function(ts){return astToGuppy$1.trig("log",ts[0])},exp:function(ts){return astToGuppy$1.trig("exp",ts[0])},ln:function(ts){return astToGuppy$1.trig("ln",ts[0])},sqrt:function(ts){return astToGuppy$1.sqrt(ts[0])},abs:function(ts){return astToGuppy$1.abs(ts[0])}}}static dfrac(ts,rs){return'<f type="fraction" group="functions"><b p="latex">\\dfrac{<r ref="1"/>}{<r ref="2"/>}</b><b p="small_latex">\\frac{<r ref="1"/>}{<r ref="2"/>}</b><b p="text">(<r ref="1"/>)/(<r ref="2"/>)</b><c up="1" down="2" name="numerator"><e></e>'+ts+'<e></e></c><c up="1" down="2" name="denominator"><e></e>'+rs+"<e></e></c></f>"}static trig(ts,rs){return'<f type="'+ts+'" group="functions"><b p="latex">\\'+ts+'\\left(<r ref="1"/>\\right)</b><b p="text"> '+ts+'(<r ref="1"/>)</b><c delete="1"><e></e>'+rs+"<e></e></c></f>"}static sqrt(ts){return'<f type="square_root" group="functions"><b p="latex">\\sqrt{<r ref="1"/>}</b><b p="text">sqrt(<r ref="1"/>)</b><c delete="1"><e></e>'+ts+"<e></e></c></f>"}static power(ts,rs){return'<f type="exponential" group="functions"><b p="latex">{<r ref="1"/>}^{<r ref="2"/>}</b><b p="text">(<r ref="1"/>)^(<r ref="2"/>)</b><c up="2" bracket="yes" delete="1" name="base"><e></e>'+ts+'<e></e></c><c down="1" delete="1" name="exponent" small="yes"><e></e>'+rs+"<e></e></c></f>"}static abs(ts){return'<f type="absolute_value" group="functions"><b p="latex">\\left|<r ref="1"/>\\right|</b><b p="text">abs(<r ref="1"/>)</b><c delete="1"><e></e>'+ts+"<e></e></c></f>"}static paren(ts){return'<f type="bracket" group="functions"><b p="latex">\\left(<r ref="1"/>\\right)</b><b p="text">(<r ref="1"/>)</b><c delete="1" is_bracket="yes"><e></e>'+ts+"<e></e></c></f>"}static isFunctionSymbol(ts){return["sin","cos","tan","csc","sec","cot","arcsin","arccos","arctan","arccsc","arcsec","arccot","log","ln","exp","sqrt","abs","this.factorial"].indexOf(ts)!==-1}static isGreekLetterSymbol(ts){return["pi","theta","theta","Theta","alpha","nu","beta","xi","Xi","gamma","Gamma","delta","Delta","pi","Pi","epsilon","epsilon","rho","rho","zeta","sigma","Sigma","eta","tau","upsilon","Upsilon","iota","phi","phi","Phi","kappa","chi","lambda","Lambda","psi","Psi","omega","Omega"].indexOf(ts)!==-1}factorWithParenthesesIfNegated(ts){var rs=this.factor(ts);return rs.toString().match(/^<e>-/)?astToGuppy$1.paren(rs.toString()):rs}factor(ts){if(typeof ts=="string")return astToGuppy$1.isGreekLetterSymbol(ts)?'<f type="'+ts+'" group="greek" c="yes"><b p="latex">\\'+ts+'</b><b p="text"> $'+ts+"</b></f>":"<e>"+ts+"</e>";if(typeof ts=="number")return"<e>"+ts+"</e>";if(!Array.isArray(ts))return"<e></e>";var rs=ts[0],ns=ts.slice(1);return rs==="apply"&&(rs=ts[1],ns=ts.slice(2)),rs==="abs"?this.operators[rs](ns.map(function(is,as){return this.expression(is)}.bind(this))):astToGuppy$1.isFunctionSymbol(rs)?rs!=="this.factorial"||ns[0].toString().length!==1&&!ns[0].toString().match(/^[0-9]*$/)?this.operators[rs](ns.map(function(is,as){return this.factor(is)}.bind(this))):this.operators[rs](ns):rs==="^"||rs==="~"?this.operators[rs](ns.map(function(is,as){return this.factor(is)}.bind(this))):astToGuppy$1.paren(this.expression(ts))}term(ts){if(!Array.isArray(ts))return this.factor(ts);var rs=ts[0],ns=ts.slice(1);return rs==="*"?this.operators[rs](ns.map(function(is,as){var os=this.factorWithParenthesesIfNegated(is);return os.toString().match(/^[0-9]/)&&as>0?" * "+os:os}.bind(this))):rs==="/"?this.operators[rs](ns.map(function(is,as){return this.factor(is)}.bind(this))):this.factor(ts)}expression(ts){if(!Array.isArray(ts))return this.term(ts);var rs=ts[0],ns=ts.slice(1);return rs==="+"||rs==="-"?this.operators[rs](ns.map(function(is,as){return this.factorWithParenthesesIfNegated(is)}.bind(this))):this.term(ts)}convert(ts){return("<m><e></e>"+this.expression(ts)+"<e></e></m>").replace(/<\/e><e>/g,"")}}const glslOperators={"+":function(ss){var ts=ss[0];return ss.slice(1).forEach(function(rs){ts=ts+"+"+rs}),ts},"-":function(ss){var ts="-"+ss[0];return ss.slice(1).forEach(function(rs){ts=ts+"-"+rs}),ts},"~":function(ss){var ts="vec2(0.0,0.0)";return ss.forEach(function(rs){ts=ts+"-"+rs}),ts},"*":function(ss){var ts=ss[0];return ss.slice(1).forEach(function(rs){ts="cmul("+ts+","+rs+")"}),ts},"/":function(ss){var ts=ss[0];return ss.slice(1).forEach(function(rs){ts="cdiv("+ts+","+rs+")"}),ts},sin:function(ss){return"csin("+ss[0]+")"},cos:function(ss){return"ccos("+ss[0]+")"},tan:function(ss){return"ctan("+ss[0]+")"},sinh:function(ss){return"csinh("+ss[0]+")"},cosh:function(ss){return"ccosh("+ss[0]+")"},arcsin:function(ss){return"carcsin("+ss[0]+")"},arccos:function(ss){return"carccos("+ss[0]+")"},arctan:function(ss){return"carctan("+ss[0]+")"},arccsc:function(ss){return"carcsin(cdiv(vec2(1.0,0),"+ss[0]+"))"},arcsec:function(ss){return"carccos(cdiv(vec2(1.0,0),"+ss[0]+"))"},arccot:function(ss){return"carctan(cdiv(vec2(1.0,0),"+ss[0]+"))"},csc:function(ss){return"ccsc("+ss[0]+")"},sec:function(ss){return"csec("+ss[0]+")"},cot:function(ss){return"ccot("+ss[0]+")"},exp:function(ss){return"cexp("+ss[0]+")"},conj:function(ss){return"conjugate("+ss[0]+")"},sqrt:function(ss){return"cpower("+ss[0]+",vec2(0.5,0.0))"},log:function(ss){return"clog("+ss[0]+")"},ln:function(ss){return"clog("+ss[0]+")"},"^":function(ss){return"cpower("+ss[0]+","+ss[1]+")"},abs:function(ss){return"cabs("+ss[0]+")"},apply:function(ss){return"vec2(NaN,NaN)"}};class astToGLSL$1{constructor(){}convert(ts){if(typeof ts=="boolean")throw Error("no support for boolean");if(typeof ts=="string")return ts==="e"?"vec2(2.71828182845905,0.0)":ts==="pi"?"vec2(3.14159265358979,0.0)":ts==="i"?"vec2(0.0,1.0)":String(ts);if(typeof ts=="number")return"vec2("+String(ts)+",0.0)";if("real"in ts&&"imaginary"in ts)return ts;if(!Array.isArray(ts))throw Error("Invalid ast");var rs=ts[0],ns=ts.slice(1);if(rs==="apply"){if(typeof ns[0]!="string")throw Error("Non string functions not implemented for conversion to GLSL");return rs=ns[0],ns=ns.slice(1),glslOperators[rs](ns.map(function(is,as){return this.convert(is)}.bind(this)))}if(rs in glslOperators)return glslOperators[rs](ns.map(function(is,as){return this.convert(is)}.bind(this)));throw Error("Operator "+rs+" not implemented for conversion to mathjs")}}var astToGuppy=new astToGuppy$1,astToGLSL=new astToGLSL$1;const tex=function(ss,ts){return new astToLatex$1(ts).convert(ss.tree)},toLatex=tex,toString$2=function(ss,ts){return new astToText$2(ts).convert(ss.tree)},toGLSL=function(ss){return astToGLSL.convert(ss.tree)},toXML=function(ss){return astToGuppy.convert(ss.tree)};var printing=Object.freeze({__proto__:null,tex,toLatex,toString:toString$2,toXML,toGLSL});const integrateNumerically=function(ss,ts,rs,ns){for(var is=0,as={},os=0;os<100;os++){var ls=rs+(ns-rs)*(os+.5)/100;as[ts]=ls,is+=ss.evaluate(as)}return is*(ns-rs)/100};var integration=Object.freeze({__proto__:null,integrateNumerically});function expression_to_polynomial(ss){var ts=get_tree(ss);if(typeof ts=="string")return ts==="pi"&&math$1.define_pi||ts==="i"&&math$1.define_i||ts==="e"&&math$1.define_e?ts:["polynomial",ts,[[1,1]]];if(typeof ts=="number")return ts;let rs=evaluate_to_constant(ts,!1);if(rs!==null&&Number.isFinite(rs))return simplify(ts);if(!Array.isArray(ts)||!operators$3(ts).every(us=>["+","-","*","^","/","_","prime"].includes(us)))return!1;var ns=ts[0],is=ts.slice(1);if(ns==="+"){let us=is.map(expression_to_polynomial);return!!us.every(cs=>cs!==!1)&&us.reduce((cs,ps)=>polynomial_add(cs,ps))}if(ns==="-"){let us=expression_to_polynomial(is[0]);return!!us&&polynomial_neg(us)}if(ns==="*"){let us=is.map(expression_to_polynomial);return!!us.every(cs=>cs!==!1)&&us.reduce((cs,ps)=>polynomial_mul(cs,ps))}if(ns==="^"){let us=is[0],cs=expression_to_polynomial(us);if(cs===!1)return!1;let ps=simplify(is[1]);if(typeof ps!="number"||ps<0||!Number.isInteger(ps)){let ds=evaluate_to_constant(ps,!1);if(ds!==null||Number.isFinite(ds)){let fs=math$1.fraction(ds);if(fs.d<=100){us=fs.s<0?["^",us,["/",-1,fs.d]]:["^",us,["/",1,fs.d]];var as=["polynomial",simplify(us),[]];return as[2].push([fs.n,1]),as}}return["polynomial",ts,[[1,1]]]}return ps===0?1:ps===1?cs:polynomial_pow(cs,ps)}if(ns==="/"){var os=is[1],ls=evaluate_to_constant(os,!1);return ls!==null&&Number.isFinite(ls)?polynomial_mul(expression_to_polynomial(is[0]),["/",1,ls]):["polynomial",ts,[[1,1]]]}return["polynomial",ts,[[1,1]]]}function polynomials_in_same_leading_variable(ss,ts){return ss[1]!==ts[1]&&(compare_function(ss[1],ts[1])<0?ts=["polynomial",ss[1],[[0,ts]]]:ss=["polynomial",ts[1],[[0,ss]]]),[ss,ts]}function polynomial_add(ss,ts){if(ss[0]!=="polynomial"){if(ts[0]!=="polynomial")return simplify(["+",ss,ts]);ss=["polynomial",ts[1],[[0,ss]]]}else if(ts[0]!=="polynomial")ts=["polynomial",ss[1],[[0,ts]]];else{let ps=polynomials_in_same_leading_variable(ss,ts);ss=ps[0],ts=ps[1]}let rs=["polynomial",ss[1],[]],ns=ss[2],is=ts[2],as=rs[2],os=ns.length,ls=is.length,us=0,cs=0;for(;us<os||cs<ls;)if(us===os)is[cs][1]&&as.push(is[cs]),cs+=1;else if(cs===ls)ns[us][1]&&as.push(ns[us]),us+=1;else if(ns[us][0]===is[cs][0]){let ps=polynomial_add(ns[us][1],is[cs][1]);ps&&as.push([ns[us][0],ps]),us+=1,cs+=1}else ns[us][0]<is[cs][0]?(ns[us][1]&&as.push(ns[us]),us+=1):(is[cs][1]&&as.push(is[cs]),cs+=1);return as.length===0?0:as.length===1&&as[0][0]===0?as[0][1]:rs}function polynomial_neg(ss){if(ss[0]!=="polynomial")return simplify(["-",ss]);let ts=["polynomial",ss[1],[]],rs=ss[2],ns=ts[2],is=rs.length;for(var as=0;as<is;as+=1)ns.push([rs[as][0],polynomial_neg(rs[as][1])]);return ts}function polynomial_sub(ss,ts){return polynomial_add(ss,polynomial_neg(ts))}function polynomial_mul(ss,ts){if(ss[0]!=="polynomial"){if(ts[0]!=="polynomial")return simplify(["*",ss,ts]);if(ss){let ps=["polynomial",ts[1],[]],ds=ts[2],fs=ps[2];for(let hs of ds)hs[1]&&fs.push([hs[0],polynomial_mul(ss,hs[1])]);return ps}}else if(ts&&ts[0]!=="polynomial"){let ps=["polynomial",ss[1],[]],ds=ss[2],fs=ps[2];for(let hs of ds)hs[1]&&fs.push([hs[0],polynomial_mul(hs[1],ts)]);return ps}let rs=polynomials_in_same_leading_variable(ss,ts);ss=rs[0],ts=rs[1];let ns=ss[2],is=ts[2],as=["polynomial",ss[1],[]],os=as[2],ls=ns.length,us=is.length,cs=[];for(let ps of ns)for(let ds of is){let fs=!1,hs=ps[0]+ds[0];for(let ys of cs)if(hs===ys){fs=!0;break}fs||cs.push(hs)}cs.sort(function(ps,ds){return ps-ds});for(let ps of cs){let ds=0,fs=0;for(;fs<ls&&ns[fs][0]<=ps;){let hs=0;for(;hs<us&&is[hs][0]<=ps;){if(ns[fs][0]+is[hs][0]===ps){ds=polynomial_add(ds,polynomial_mul(ns[fs][1],is[hs][1]));break}hs+=1}fs+=1}ds&&os.push([ps,ds])}return as}function polynomial_pow(ss,ts){if(isNaN(ts)||ts<0||!Number.isInteger(ts))return;let rs=1;for(;ts>0;)1&ts&&(rs=polynomial_mul(rs,ss)),ss=polynomial_mul(ss,ss),ts>>=1;return rs}function polynomial_to_expression(ss){if(!Array.isArray(ss)||ss[0]!=="polynomial")return ss;let ts=ss[1],rs=ss[2],ns=[],is=rs.length;for(var as=0;as<is;as+=1)rs[as][1]&&(rs[as][0]===0?ns.push(polynomial_to_expression(rs[as][1])):rs[as][0]===1?ns.push(["*",polynomial_to_expression(rs[as][1]),ts]):ns.push(["*",polynomial_to_expression(rs[as][1]),["^",ts,rs[as][0]]]));return ns.length===0?0:(ns.length===1?ns=ns[0]:ns.unshift("+"),simplify(ns))}function initial_term(ss){if(!Array.isArray(ss)||ss[0]!=="polynomial")return ss;let ts=[];for(;Array.isArray(ss)&&ss[0]==="polynomial";){let rs=ss[1],ns=ss[2],is=ns[ns.length-1][0];ss=ns[ns.length-1][1],ts.push([rs,is])}return["monomial",ss,ts]}function mono_less_than(ss,ts){if(!Array.isArray(ts)||ts[0]!=="monomial")return!1;if(!Array.isArray(ss)||ss[0]!=="monomial")return!0;let rs=ss[2],ns=ts[2],is=rs.length,as=ns.length;var os;os=is<as?is:as;for(var ls=0;ls<os;ls++){if(rs[ls][0]!==ns[ls][0])return!(compare_function(rs[ls][0],ns[ls][0])<0);if(rs[ls][1]<ns[ls][1])return!0;if(rs[ls][1]>ns[ls][1])return!1}return is!==as&&os!==as}function mono_gcd(ss,ts){if(!Array.isArray(ss)||!Array.isArray(ts)||ss[0]!=="monomial"||ts[0]!=="monomial")return 1;let rs=ss[2],ns=ts[2],is=[],as=rs.length,os=ns.length,ls=0,us=0;for(;ls<as&&us<os;)rs[ls][0]===ns[us][0]?(rs[ls][1]<ns[us][1]?is.push(rs[ls]):is.push(ns[us]),ls+=1,us+=1):compare_function(rs[ls][0],ns[us][0])<0?ls+=1:compare_function(ns[us][0],rs[ls][0])<0&&(us+=1);return is.length===0?1:["monomial",1,is]}function mono_div(ss,ts){//!!This function should only be called if bottom has coefficient 1 and divides the top (e.g., bottom was computed using mono_gcd)!!
if(!Array.isArray(ts)||ts[0]!=="monomial")return ts===1?ss:Array.isArray(ss)&&ss[0]==="monomial"?[ss[0],evaluate_numbers(["/",ss[1],ts]),ss[2]]:evaluate_numbers(["/",ss,ts]);if(!Array.isArray(ss)||ss[0]!=="monomial")return;let rs=ss[2],ns=ts[2],is=[],as=rs.length,os=ns.length,ls=0,us=0;for(;ls<as&&us<os;)if(rs[ls][0]===ns[us][0]){if(rs[ls][1]<ns[us][1])return;{let cs=rs[ls][1]-ns[us][1];cs!==0&&is.push([rs[ls][0],cs])}ls+=1,us+=1}else if(compare_function(rs[ls][0],ns[us][0])<0)is.push(rs[ls]),ls+=1;else if(compare_function(ns[us][0],rs[ls][0])<0)return;if(!(us<os)){for(;ls<as;)is.push(rs[ls]),ls+=1;return is.length===0?ts[1]===1?ss[1]:evaluate_numbers(["/",ss[1],ts[1]]):ts[1]===1?["monomial",ss[1],is]:["monomial",evaluate_numbers(["/",ss[1],ts[1]]),is]}}function mono_is_div(ss,ts){if(ts===0)return!1;if(!Array.isArray(ts)||ts[0]!=="monomial")return!0;if(!Array.isArray(ss)||ss[0]!=="monomial")return!1;let rs=ss[2],ns=ts[2],is=[],as=rs.length,os=ns.length,ls=0,us=0;for(;ls<as&&us<os;)if(rs[ls][0]===ns[us][0]){if(rs[ls][1]<ns[us][1])return!1;{let cs=rs[ls][1]-ns[us][1];cs!==0&&is.push([rs[ls][0],cs])}ls+=1,us+=1}else if(compare_function(rs[ls][0],ns[us][0])<0)is.push(rs[ls]),ls+=1;else if(compare_function(ns[us][0],rs[ls][0])<0)return!1;return!(us<os)}function mono_to_poly(ss){if(!Array.isArray(ss)||ss[0]!=="monomial")return ss;let ts=ss[2].length-1,rs=ss[1];for(;ts>=0;){var ns=[];ns.push([ss[2][ts][1],rs]),rs=["polynomial",ss[2][ts][0],ns],ts-=1}return rs}function max_div_init(ss,ts){if(ss===0)return 0;let rs=ss,ns=[];for(;Array.isArray(rs)&&rs[0]==="polynomial";){let ls=rs[1],us=rs[2],cs=us[us.length-1][0];rs=us[us.length-1][1],ns.push([ls,cs])}let is=["monomial",rs,ns],as=ts.length;for(var os=0;os<as;os+=1)if(mono_is_div(is,ts[os]))return[is,os];return max_div_init(polynomial_sub(ss,mono_to_poly(is)),ts)}function poly_div(ss,ts){let rs=[],ns=[],is=[],as=[],os=ss;for(var ls of ts)rs.push(initial_term(ls));let us=max_div_init(os,rs);for(;us!==0;)is=us[1],as=mono_div(us[0],rs[is]),ns.push([is,as]),os=polynomial_sub(os,polynomial_mul(mono_to_poly(as),ts[is])),us=max_div_init(os,rs);return[ns,os]}function prereduce(ss){let ts=ss.length,rs=[];for(var ns=0;ns<ts;ns++){if(ss[ns]!==0&&(!Array.isArray(ss[ns])||ss[ns][0]!=="polynomial"))return[1];ss[ns]!==0&&rs.push(ss[ns])}return rs.length===0?[0]:rs}function reduce_ith(ss,ts){let rs=[],ns=[],is=[],as=ts[ss],os=ts.length;for(var ls=0;ls<os;ls+=1)ls===ss?rs.push(0):rs.push(initial_term(ts[ls]));let us=max_div_init(as,rs);for(;us!==0;)ns=us[1],is=mono_div(us[0],rs[ns]),as=polynomial_sub(as,polynomial_mul(mono_to_poly(is),ts[ns])),us=max_div_init(as,rs);return as}function reduce$3(ss){let ts=0,rs=[],ns=prereduce(ss),is=ns.length;if(is===1)return ns;let as=!0;for(;as;)for(as=!1,ns=prereduce(ns),is=ns.length,ts=0;ts<is;)rs=reduce_ith(ts,ns),_$2.isEqual(rs,ns[ts])||(ns[ts]=rs,as=!0),ts+=1;ts=0;let os=[],ls=0;for(;ts<is;)os=initial_term(ns[ts]),Array.isArray(os)&&os[0]==="monomial"?(ls=os[1],ls!==1&&(ns[ts]=polynomial_mul(ns[ts],["/",1,ls]))):ns[ts]=1,ts+=1;return ns}function hij(ss,ts,rs){let ns=initial_term(rs[ss]),is=initial_term(rs[ts]),as=mono_gcd(ns,is),os=mono_to_poly(mono_div(ns,as));return poly_div(polynomial_sub(polynomial_mul(mono_to_poly(mono_div(is,as)),rs[ss]),polynomial_mul(os,rs[ts])),rs)[1]}function build_hij_table(ss,ts){let rs=ts.length,ns=0,is=1,as=[];for(;is<rs;){for(;ns<is;)ss[[ns,is]]=hij(ns,is,ts),ss[[ns,is]]!==0&&as.push(ss[[ns,is]]),ns+=1;ns=0,is+=1}return as.length>0?choice_lowest_degree(as):0}function update_hij_table(ss,ts,rs){let ns=ts.length;ts.push(rs);let is=0,as=1,os=[];for(;as<ns;){for(;is<as;)ss[[is,as]]!==0&&(ss[[is,as]]=hij(is,as,ts),ss[[is,as]]!==0&&os.push(ss[[is,as]])),is+=1;is=0,as+=1}for(;is<ns;)ss[[is,ns]]=hij(is,ns,ts),ss[[is,ns]]!==0&&os.push(ss[[is,ns]]),is+=1;return os.length>0?choice_lowest_degree(os):0}function choice_lowest_degree(ss){let ts=[],rs=ss.length;for(is=0;is<rs;is+=1)ts.push(initial_term(ss[is]));let ns=0;for(var is=1;is<rs;is+=1){if(ts[is]===1)return 1;mono_less_than(ts[is],ts[ns])&&(ns=is)}return ss[ns]}function reduced_grobner(ss){let ts=reduce$3(ss),rs={},ns=build_hij_table(rs,ts);for(;ns!==0;)ns=update_hij_table(rs,ts,ns);return ts=reduce$3(ts),ts}function poly_lcm(ss,ts){let rs=reduced_grobner([polynomial_mul(["polynomial","_t",[[1,1]]],ss),polynomial_mul(["polynomial","_t",[[0,1],[1,-1]]],ts)]),ns=rs.length;for(var is=0;is<ns;is+=1){if(!Array.isArray(rs[is])||rs[is][0]!=="polynomial")return 1;if(rs[is][1]!=="_t")return rs[is]}}function poly_gcd(ss,ts){let rs=poly_lcm(ss,ts),ns=poly_div(polynomial_mul(ss,ts),[rs]),is=0,as=ns[0].length;for(var os=0;os<as;os+=1)is=polynomial_add(is,mono_to_poly(ns[0][os][1]));let ls=initial_term(is);if(Array.isArray(ls)&&ls[0]==="monomial"){let us=ls[1];us!==1&&(is=polynomial_mul(is,["/",1,us]))}else is=1;return is}function poly_by_divisor(ss,ts){//!!Only call if d evenly divides f!!
let rs=poly_div(ss,[ts]),ns=0,is=rs[0].length;for(var as=0;as<is;as+=1)ns=polynomial_add(ns,mono_to_poly(rs[0][as][1]));return ns}function reduce_rational_expression(ss,ts){let rs=stringify_vars(ss),ns=stringify_vars(ts),is=polynomial_mul(poly_gcd(ss=rs[0],ts=ns[0]),initial_term(ts)[1]),as=poly_by_divisor(ss,is),os=poly_by_divisor(ts,is);return[destringify_vars(destringify_vars(as,rs[1]),ns[1]),destringify_vars(destringify_vars(os,rs[1]),ns[1])]}function stringify_vars(ss){if(!Array.isArray(ss)||ss[0]!=="polynomial")return[ss,{}];let ts={},rs="z"+JSON.stringify(ss[1]);ts[rs]=ss[1],ss[1]=rs;let ns=ss[2],is=[];for(let as of ns){is=stringify_vars(as[1]),as[1]=is[0];for(let os in is[1])ts[os]=is[1][os]}return[ss,ts]}function destringify_vars(ss,ts){if(!Array.isArray(ss)||ss[0]!=="polynomial")return ss;ts[ss[1]]&&(ss[1]=ts[ss[1]]);let rs=ss[2];for(let ns of rs)ns[1]=destringify_vars(ns[1],ts);return ss}var textToAst$1=new textToAst$4;function common_denominator(ss,ts){ss=simplify(ss,ts);var rs=[];return rs.push([textToAst$1.convert("a/c+b/c"),textToAst$1.convert("(a+b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("a/c-b/c"),textToAst$1.convert("(a-b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("a+b/c"),textToAst$1.convert("(ac+b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("a-b/c"),textToAst$1.convert("(ac-b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("a/d+b/c"),textToAst$1.convert("(ac+bd)/(cd)"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("a/d-b/c"),textToAst$1.convert("(ac-bd)/(cd)"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("x*(y/z)"),textToAst$1.convert("(x*y)/z"),{allow_extended_match:!0,allow_permutations:!0,max_group:1}]),rs.push([textToAst$1.convert("(x/y)/z"),textToAst$1.convert("x/(y*z)"),{allow_extended_match:!0,allow_permutations:!0}]),rs.push([textToAst$1.convert("x/(y/z)"),textToAst$1.convert("xz/y"),{allow_extended_match:!0,allow_permutations:!0}]),ss=expand(ss=applyAllTransformations(ss,rs,40),!0)}function as_num_denom(ss){var ts=get_tree(ss);return(ts=common_denominator(ts))[0]==="/"?[ts[1],ts[2]]:[ts,1]}function reduce_rational(ss){var ts=get_tree(ss),rs=as_num_denom(ts);if(rs[1]===1)return ts;var ns=reduce_rational_expression(expression_to_polynomial(rs[0]),expression_to_polynomial(rs[1])),is=polynomial_to_expression(ns[0]),as=polynomial_to_expression(ns[1]);return as===1?is:["/",is,as]}const common_demoninator=common_denominator;var rational=Object.freeze({__proto__:null,reduce_rational,common_demoninator});function toFixed(ss,ts){return math$1.format(ss,{notation:"fixed",precision:ts})}function round_numbers_to_precision(ss,ts=14){var rs=get_tree(ss);if(ts<1)throw Error("For round_numbers_to_precision, digits must be positive");if(!Number.isFinite(ts))throw Error("For round_numbers_to_precision, digits must be a number");return ts>15?rs:(ts=Math.round(ts),round_numbers_to_precision_sub(rs,ts))}const round_numbers_to_precision_sub=function(ss,ts=14){if(typeof ss=="number"&&Number.isFinite(ss)&&ss!==0){const rs=math$1.floor(math$1.log10(math$1.abs(ss))),ns=ts-rs-1;return ns<0?parseFloat(toFixed(ss,ns)+"0".repeat(math$1.abs(ns))):parseFloat(toFixed(ss,ns))}return Array.isArray(ss)?[ss[0],...ss.slice(1).map(rs=>round_numbers_to_precision_sub(rs,ts))]:ss};function round_numbers_to_decimals(ss,ts=14){var rs=get_tree(ss);if(!Number.isFinite(ts))throw Error("For round_numbers_to_decimals, ndecimals must be a number");return ts=Math.round(ts),ts=Math.max(-330,Math.min(330,ts)),round_numbers_to_decimals_sub(rs,ts)}const round_numbers_to_decimals_sub=function(ss,ts=0){return typeof ss=="number"?ts<0?parseFloat(toFixed(ss,ts)+"0".repeat(math$1.abs(ts))):parseFloat(toFixed(ss,ts)):Array.isArray(ss)?[ss[0],...ss.slice(1).map(rs=>round_numbers_to_decimals_sub(rs,ts))]:ss};var round=Object.freeze({__proto__:null,round_numbers_to_precision,round_numbers_to_decimals});const match=function(ss,ts,rs){let ns=get_tree(ss),is=get_tree(ts);return match$2(ns,is,rs)};var match$1=Object.freeze({__proto__:null,match});const expression_to_tree$1=[simplify$1,differentiation,normalization,arithmetic,transformation,solve,sets,matrix$1,rational,round],expression_to_other=[variables$1,printing,equality,integration,evaluation,analytic,sign_error,match$1];function abs$3(ss){return["apply","abs",get_tree(ss)]}function exp$3(ss){return["apply","exp",get_tree(ss)]}function log(ss){return["apply","log",get_tree(ss)]}function log10(ss){return["apply","log10",get_tree(ss)]}function sign(ss){return["apply","sign",get_tree(ss)]}function sqrt(ss){return["apply","sqrt",get_tree(ss)]}function conj(ss){return["apply","conj",get_tree(ss)]}function im(ss){return["apply","im",get_tree(ss)]}function re$2(ss){return["apply","re",get_tree(ss)]}function factorial$2(ss){return["apply","factorial",get_tree(ss)]}function gamma$2(ss){return["apply","gamma",get_tree(ss)]}function erf$2(ss){return["apply","erf",get_tree(ss)]}function acos(ss){return["apply","acos",get_tree(ss)]}function acosh(ss){return["apply","acosh",get_tree(ss)]}function acot(ss){return["apply","acot",get_tree(ss)]}function acoth(ss){return["apply","acoth",get_tree(ss)]}function acsc(ss){return["apply","acsc",get_tree(ss)]}function acsch(ss){return["apply","acsch",get_tree(ss)]}function asec(ss){return["apply","asec",get_tree(ss)]}function asech(ss){return["apply","asech",get_tree(ss)]}function asin(ss){return["apply","asin",get_tree(ss)]}function asinh(ss){return["apply","asinh",get_tree(ss)]}function atan(ss){return["apply","atan",get_tree(ss)]}function atanh(ss){return["apply","atanh",get_tree(ss)]}function cos$3(ss){return["apply","cos",get_tree(ss)]}function cosh$4(ss){return["apply","cosh",get_tree(ss)]}function cot(ss){return["apply","cot",get_tree(ss)]}function coth(ss){return["apply","coth",get_tree(ss)]}function csc(ss){return["apply","csc",get_tree(ss)]}function csch(ss){return["apply","csch",get_tree(ss)]}function sec(ss){return["apply","sec",get_tree(ss)]}function sech(ss){return["apply","sech",get_tree(ss)]}function sin$3(ss){return["apply","sin",get_tree(ss)]}function sinh$4(ss){return["apply","sinh",get_tree(ss)]}function tan(ss){return["apply","tan",get_tree(ss)]}function tanh(ss){return["apply","tanh",get_tree(ss)]}function atan2(ss,ts){return["apply","atan2",["tuple",get_tree(ss),get_tree(ts)]]}var standard=Object.freeze({__proto__:null,abs:abs$3,exp:exp$3,log,log10,sign,sqrt,conj,im,re:re$2,factorial:factorial$2,gamma:gamma$2,erf:erf$2,acos,acosh,acot,acoth,acsc,acsch,asec,asech,asin,asinh,atan,atanh,cos:cos$3,cosh:cosh$4,cot,coth,csc,csch,sec,sech,sin:sin$3,sinh:sinh$4,tan,tanh,atan2});const expression_to_tree=[standard],whitespace_rule="\\s|\\\\,|\\\\!|\\\\ |\\\\>|\\\\;|\\\\:|\\\\quad\\b|\\\\qquad\\b",sci_notat_exp_regex="(E[+\\-]?[0-9]+\\s*($|(?=\\,|&|\\||\\\\\\||\\)|\\}|\\\\}|\\]|\\\\\\\\|\\\\end)))?",number_rules_sci=[["[0-9]+(\\.[0-9]*)?"+sci_notat_exp_regex,"NUMBER"],["\\.[0-9]+"+sci_notat_exp_regex,"NUMBER"]],number_rules_non_sci=[["[0-9]+(\\.[0-9]*)?","NUMBER"],["\\.[0-9]+","NUMBER"]],base_latex_rules=[["\\*","*"],["\\/","/"],["-","-"],["\\+","+"],["\\^","^"],["\\(","("],["\\\\left\\s*\\(","("],["\\\\bigl\\s*\\(","("],["\\\\Bigl\\s*\\(","("],["\\\\biggl\\s*\\(","("],["\\\\Biggl\\s*\\(","("],["\\)",")"],["\\\\right\\s*\\)",")"],["\\\\bigr\\s*\\)",")"],["\\\\Bigr\\s*\\)",")"],["\\\\biggr\\s*\\)",")"],["\\\\Biggr\\s*\\)",")"],["\\[","["],["\\\\left\\s*\\[","["],["\\\\bigl\\s*\\[","["],["\\\\Bigl\\s*\\[","["],["\\\\biggl\\s*\\[","["],["\\\\Biggl\\s*\\[","["],["\\]","]"],["\\\\right\\s*\\]","]"],["\\\\bigr\\s*\\]","]"],["\\\\Bigr\\s*\\]","]"],["\\\\biggr\\s*\\]","]"],["\\\\Biggr\\s*\\]","]"],["\\|","|"],["\\\\left\\s*\\|","|L"],["\\\\bigl\\s*\\|","|L"],["\\\\Bigl\\s*\\|","|L"],["\\\\biggl\\s*\\|","|L"],["\\\\Biggl\\s*\\|","|L"],["\\\\right\\s*\\|","|"],["\\\\bigr\\s*\\|","|"],["\\\\Bigr\\s*\\|","|"],["\\\\biggr\\s*\\|","|"],["\\\\Biggr\\s*\\|","|"],["\\\\big\\s*\\|","|"],["\\\\Big\\s*\\|","|"],["\\\\bigg\\s*\\|","|"],["\\\\Bigg\\s*\\|","|"],["{","{"],["}","}"],["\\\\{","LBRACE"],["\\\\left\\s*\\\\{","LBRACE"],["\\\\bigl\\s*\\\\{","LBRACE"],["\\\\Bigl\\s*\\\\{","LBRACE"],["\\\\biggl\\s*\\\\{","LBRACE"],["\\\\Biggl\\s*\\\\{","LBRACE"],["\\\\}","RBRACE"],["\\\\right\\s*\\\\}","RBRACE"],["\\\\bigr\\s*\\\\}","RBRACE"],["\\\\Bigr\\s*\\\\}","RBRACE"],["\\\\biggr\\s*\\\\}","RBRACE"],["\\\\Biggr\\s*\\\\}","RBRACE"],["\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\left\\s*\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\bigl\\s*\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\Bigl\\s*\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\biggl\\s*\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\Biggl\\s*\\\\lfloor(?![a-zA-Z])","LFLOOR"],["\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\right\\s*\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\bigr\\s*\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\Bigr\\s*\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\biggr\\s*\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\Biggr\\s*\\\\rfloor(?![a-zA-Z])","RFLOOR"],["\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\left\\s*\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\bigl\\s*\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\Bigl\\s*\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\biggl\\s*\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\Biggl\\s*\\\\lceil(?![a-zA-Z])","LCEIL"],["\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\right\\s*\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\bigr\\s*\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\Bigr\\s*\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\biggr\\s*\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\Biggr\\s*\\\\rceil(?![a-zA-Z])","RCEIL"],["\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\left\\s*\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\bigl\\s*\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\Bigl\\s*\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\biggl\\s*\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\Biggl\\s*\\\\langle(?![a-zA-Z])","LANGLE"],["\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\right\\s*\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\bigr\\s*\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\Bigr\\s*\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\biggr\\s*\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\Biggr\\s*\\\\rangle(?![a-zA-Z])","RANGLE"],["\\\\cdot(?![a-zA-Z])","*"],["\\\\div(?![a-zA-Z])","/"],["\\\\times(?![a-zA-Z])","*"],[",",","],[":",":"],["\\\\mid(?![a-zA-Z])","MID"],["\\\\vartheta(?![a-zA-Z])","LATEXCOMMAND","\\theta"],["\\\\varepsilon(?![a-zA-Z])","LATEXCOMMAND","\\epsilon"],["\\\\varrho(?![a-zA-Z])","LATEXCOMMAND","\\rho"],["\\\\varphi(?![a-zA-Z])","LATEXCOMMAND","\\phi"],["\\\\infty(?![a-zA-Z])","INFINITY"],["\\\\asin(?![a-zA-Z])","LATEXCOMMAND","\\arcsin"],["\\\\acos(?![a-zA-Z])","LATEXCOMMAND","\\arccos"],["\\\\atan(?![a-zA-Z])","LATEXCOMMAND","\\arctan"],["\\\\sqrt(?![a-zA-Z])","SQRT"],["\\\\land(?![a-zA-Z])","AND"],["\\\\wedge(?![a-zA-Z])","AND"],["\\\\lor(?![a-zA-Z])","OR"],["\\\\vee(?![a-zA-Z])","OR"],["\\\\lnot(?![a-zA-Z])","NOT"],["=","="],["\\\\neq(?![a-zA-Z])","NE"],["\\\\ne(?![a-zA-Z])","NE"],["\\\\not\\s*=","NE"],["\\\\leq(?![a-zA-Z])","LE"],["\\\\le(?![a-zA-Z])","LE"],["\\\\geq(?![a-zA-Z])","GE"],["\\\\ge(?![a-zA-Z])","GE"],["<","<"],["\\\\lt(?![a-zA-Z])","<"],[">",">"],["\\\\gt(?![a-zA-Z])",">"],["\\\\forall(?![a-zA-Z])","FORALL"],["\\\\exists(?![a-zA-Z])","EXISTS"],["\\\\in(?![a-zA-Z])","IN"],["\\\\notin(?![a-zA-Z])","NOTIN"],["\\\\not\\s*\\\\in(?![a-zA-Z])","NOTIN"],["\\\\ni(?![a-zA-Z])","NI"],["\\\\not\\s*\\\\ni(?![a-zA-Z])","NOTNI"],["\\\\subset(?![a-zA-Z])","SUBSET"],["\\\\subseteq(?![a-zA-Z])","SUBSETEQ"],["\\\\not\\s*\\\\subset(?![a-zA-Z])","NOTSUBSET"],["\\\\not\\s*\\\\subseteq(?![a-zA-Z])","NOTSUBSETEQ"],["\\\\supset(?![a-zA-Z])","SUPERSET"],["\\\\supseteq(?![a-zA-Z])","SUPERSETEQ"],["\\\\not\\s*\\\\supset(?![a-zA-Z])","NOTSUPERSET"],["\\\\not\\s*\\\\supseteq(?![a-zA-Z])","NOTSUPERSETEQ"],["\\\\cup(?![a-zA-Z])","UNION"],["\\\\cap(?![a-zA-Z])","INTERSECT"],["\\\\perp(?![a-zA-Z])","PERP"],["\\\\bot(?![a-zA-Z])","PERP"],["\\\\parallel(?![a-zA-Z])","PARALLEL"],["\\\\\\|","PARALLEL"],["\\\\angle(?![a-zA-Z])","ANGLE"],["\\\\int(?![a-zA-Z])","INT"],["!","!"],["'","'"],["_","_"],["&","&"],["\\\\ldots(?![a-zA-Z])","LDOTS"],["\\\\\\\\","LINEBREAK"],["\\\\begin\\s*{\\s*[a-zA-Z0-9]+\\s*}","BEGINENVIRONMENT"],["\\\\end\\s*{\\s*[a-zA-Z0-9]+\\s*}","ENDENVIRONMENT"],["\\\\operatorname\\s*{\\s*[a-zA-Z0-9\\+\\-]+\\s*}","VARMULTICHAR"],["\\\\[a-zA-Z]+(?![a-zA-Z])","LATEXCOMMAND"],["\\\\[$%]","LATEXCOMMAND"],["[a-zA-Z$%]","VAR"]],allowSimplifiedFunctionApplicationDefault=!0,allowedLatexSymbolsDefault=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial","angle","circ","%","$"],appliedFunctionSymbolsDefault$2=["abs","exp","log","ln","log10","sign","sqrt","erf","cos","cosh","acos","acosh","arccos","arccosh","cot","coth","acot","acoth","arccot","arccoth","csc","csch","acsc","acsch","arccsc","arccsch","sec","sech","asec","asech","arcsec","arcsech","sin","sinh","asin","asinh","arcsin","arcsinh","tan","tanh","atan","atan2","atanh","arctan","arctanh","arg","conj","Re","Im","det","trace","nPr","nCr","floor","ceil","round"],functionSymbolsDefault=["f","g"],operatorSymbolsDefault={frac:{nargs:2,substitute:"/"},binom:{nargs:2},vec:{nargs:1},overline:{nargs:1,substitute:"linesegment",remove_products:!0}},unitsDefault=get_all_units();unitsDefault.circ=unitsDefault.deg,unitsDefault.circ.substitute="deg",unitsDefault.circ.isExponent=!0,delete unitsDefault.deg;const parseLeibnizNotationDefault=!0;class latexToAst$1{constructor({allowSimplifiedFunctionApplication:ts=allowSimplifiedFunctionApplicationDefault,allowedLatexSymbols:rs=allowedLatexSymbolsDefault,appliedFunctionSymbols:ns=appliedFunctionSymbolsDefault$2,functionSymbols:is=functionSymbolsDefault,operatorSymbols:as=operatorSymbolsDefault,units:os=unitsDefault,parseLeibnizNotation:ls=parseLeibnizNotationDefault,parseScientificNotation:us=!0}={}){this.allowSimplifiedFunctionApplication=ts,this.allowedLatexSymbols=rs,this.appliedFunctionSymbols=ns,this.functionSymbols=is,this.operatorSymbols=as,this.units=os,this.parseLeibnizNotation=ls;let cs=base_latex_rules;cs=us?[...number_rules_sci,...cs]:[...number_rules_non_sci,...cs],this.lexer=new lexer(cs,whitespace_rule)}advance(ts){if(this.token=this.lexer.advance(ts),this.token.token_type==="INVALID")throw new ParseError("Invalid symbol '"+this.token.original_text+"'",this.lexer.location)}return_state(){return{lexer_state:this.lexer.return_state(),token:Object.assign({},this.token)}}set_state(ts){this.lexer.set_state(ts.lexer_state),this.token=Object.assign({},ts.token)}convert(ts){this.lexer.set_input(ts),this.advance();var rs=this.statement_list();if(this.token.token_type!=="EOF")throw new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return flatten$6(rs)}statement_list(){for(var ts=[this.statement()];this.token.token_type===",";)this.advance(),ts.push(this.statement());return ts=ts.length>1?["list"].concat(ts):ts[0]}statement({inside_absolute_value:ts=0}={}){if(this.token.token_type==="LDOTS")return this.advance(),["ldots"];var rs;try{rs=this.return_state();let ns=this.statement_a({inside_absolute_value:ts});if(this.token.token_type!==":"&&this.token.token_type!=="MID")return ns;let is=this.token.token_type===":"?":":"|";return this.advance(),[is,ns,this.statement_a()]}catch(ns){try{this.set_state(rs);let is=this.statement_a({parse_absolute_value:!1});if(this.token.token_type[0]!=="|")throw ns;return this.advance(),["|",is,this.statement_a({parse_absolute_value:!1})]}catch{throw ns}}}statement_a({inside_absolute_value:ts=0,parse_absolute_value:rs=!0}={}){for(var ns=this.statement_b({inside_absolute_value:ts,parse_absolute_value:rs});this.token.token_type==="OR";){let is=this.token.token_type.toLowerCase();this.advance(),ns=[is,ns,this.statement_b({inside_absolute_value:ts,parse_absolute_value:rs})]}return ns}statement_b(ts){for(var rs=this.relation(ts);this.token.token_type==="AND";){let ns=this.token.token_type.toLowerCase();this.advance(),rs=[ns,rs,this.relation(ts)]}return rs}relation(ts){if(this.token.token_type==="NOT"||this.token.token_type==="!")return this.advance(),["not",this.relation(ts)];if(this.token.token_type==="FORALL"||this.token.token_type==="EXISTS"){let ns=this.token.token_type.toLowerCase();return this.advance(),[ns,this.relation(ts)]}for(var rs=this.expression(ts);this.token.token_type==="="||this.token.token_type==="NE"||this.token.token_type==="<"||this.token.token_type===">"||this.token.token_type==="LE"||this.token.token_type==="GE"||this.token.token_type==="IN"||this.token.token_type==="NOTIN"||this.token.token_type==="NI"||this.token.token_type==="NOTNI"||this.token.token_type==="SUBSET"||this.token.token_type==="NOTSUBSET"||this.token.token_type==="SUBSETEQ"||this.token.token_type==="NOTSUBSETEQ"||this.token.token_type==="SUPERSET"||this.token.token_type==="NOTSUPERSET"||this.token.token_type==="SUPERSETEQ"||this.token.token_type==="NOTSUPERSETEQ";){let ns=this.token.token_type.toLowerCase(),is=0;this.token.token_type==="<"||this.token.token_type==="LE"?is=-1:this.token.token_type!==">"&&this.token.token_type!=="GE"||(is=1),this.advance();let as=this.expression(ts);if(is===-1)if(this.token.token_type==="<"||this.token.token_type==="LE"){let os=["tuple"];ns==="<"?os.push(!0):os.push(!1);let ls=["tuple",rs,as];for(;this.token.token_type==="<"||this.token.token_type==="LE";)this.token.token_type==="<"?os.push(!0):os.push(!1),this.advance(),ls.push(this.expression(ts));rs=["lts",ls,os]}else rs=[ns,rs,as];else if(is===1)if(this.token.token_type===">"||this.token.token_type==="GE"){let os=["tuple"];ns===">"?os.push(!0):os.push(!1);let ls=["tuple",rs,as];for(;this.token.token_type===">"||this.token.token_type==="GE";)this.token.token_type===">"?os.push(!0):os.push(!1),this.advance(),ls.push(this.expression(ts));rs=["gts",ls,os]}else rs=[ns,rs,as];else if(ns==="=")for(rs=["=",rs,as];this.token.token_type==="=";)this.advance(),rs.push(this.expression(ts));else rs=[ns,rs,as]}return rs}expression(ts){let rs=!1;this.token.token_type==="+"&&(rs=!0,this.advance());let ns=!1;this.token.token_type==="-"&&(ns=!0,this.advance());var is=this.term(ts);if(ns||rs){if(is===!1)return(rs?"+":"")+(ns?"-":"");if(typeof is=="string"&&[...is].every(as=>["+","-"].includes(as)))return(rs?"+":"")+(ns?"-":"")+is}for(is===!1&&(is=""),ns&&(is=is>0?-is:["-",is]),rs&&(is=["+",is]);["+","-","UNION","INTERSECT","PERP","PARALLEL"].includes(this.token.token_type);){let as=this.token.token_type.toLowerCase(),os=!1,ls=!1;this.token.token_type==="-"?(as="+",os=!0,this.advance()):(this.advance(),as==="+"&&this.token.token_type==="-"&&(os=!0,ls=!0,this.advance()));let us=this.term(ts);if(as==="+"){if(us===!1&&(typeof is=="number"||typeof is=="string"))return ls?is+"+-":os?is+"-":is+"+";if(typeof us=="string"&&[...us].every(cs=>["+","-"].includes(cs))&&(typeof is=="number"||typeof is=="string"))return ls?is+"+-"+us:os?is+"-"+us:is+"+"+us}us===!1&&(us=""),os&&(us=us>0?-us:["-",us]),is=[as,is,us]}return is}term(ts){var rs=this.factor(ts),ns=!1;do if(ns=!1,this.token.token_type==="*"){this.advance(),rs===!1&&(rs="");let is=this.factor(ts);is===!1&&(is=""),rs=["*",rs,is],ns=!0}else if(this.token.token_type==="/"){this.advance(),rs===!1&&(rs="");let is=this.factor(ts);is===!1&&(is=""),rs=["/",rs,is],ns=!0}else{let is=Object.assign({},ts);is.allow_absolute_value_closing=!0;let as=this.nonMinusFactor(is);as!==!1&&(rs===!1&&(rs=""),rs=["*",rs,as],ns=!0)}while(ns);return this.convert_units_in_term(flatten$6(rs))}convert_units_in_term(ts){if(!Array.isArray(ts))return ts;let rs=ts[0],ns=ts.slice(1);if(rs==="*"){let is=ns.length;for(let[as,os]of ns.entries()){let ls=this.units[os];if(ls){if(ls.prefix&&as<is-1){let us;us=as===is-2?ns[is-1]:this.convert_units_in_term(["*",...ns.slice(as+1)]);let cs=os;ls.substitute&&(cs=ls.substitute);let ps=["unit",cs,us];return as===0?ps:["*",...ns.slice(0,as).map(this.convert_units_in_term.bind(this)),ps]}if(!ls.prefix&&as>0){let us,cs=os;return ls.substitute&&(cs=ls.substitute),us=as===1?["unit",ns[0],cs]:["unit",["*",...ns.slice(0,as).map(this.convert_units_in_term.bind(this))],cs],as===is-1?us:this.convert_units_in_term(["*",us,...ns.slice(as+1)])}}}return[rs,...ns.map(this.convert_units_in_term.bind(this))]}if(rs==="/")return["/",this.convert_units_in_term(ns[0]),this.convert_units_in_term(ns[1])];if(rs==="^"){let is=this.units[ns[1]];if(is&&is.isExponent){let as=ns[1];return is.substitute&&(as=is.substitute),["unit",ns[0],as]}return[rs,...ns.map(this.convert_units_in_term.bind(this))]}return[rs,...ns.map(this.convert_units_in_term.bind(this))]}factor(ts){if(this.token.token_text==="+"){this.advance();let ns=this.factor(ts);return ns===!1?"+":typeof ns=="string"&&[...ns].every(is=>["+","-"].includes(is))?"+"+ns:["+",ns]}if(this.token.token_type==="-"){this.advance();let ns=this.factor(ts);return ns>0?-ns:ns===!1?"-":typeof ns=="string"&&[...ns].every(is=>["+","-"].includes(is))?"-"+ns:["-",ns]}let rs=this.nonMinusFactor(ts);return rs===!1&&this.token.token_type==="PERP"&&(rs="perp",this.advance()),rs}nonMinusFactor(ts){for(var rs=this.baseFactor(ts);this.token.token_type==="^"||this.token.token_type==="!"||this.token.token_type==="'";)rs===!1&&(rs=""),this.token.token_type==="^"?(this.advance(),rs=["^",rs,this.get_subsuperscript(ts)]):this.token.token_type==="!"?(rs=["apply","factorial",rs],this.advance()):(rs=["prime",rs],this.advance());return rs}get_single_digit_as_number(){if(this.token.token_type==="NUMBER"&&this.token.token_text[0]!=="."){let ts=Number(this.token.token_text[0]);return this.token.token_text.length>1&&this.lexer.unput(this.token.token_text.slice(1)),this.advance(),ts}return null}get_subsuperscript({parse_absolute_value:ts}){let rs=this.get_single_digit_as_number();if(rs!==null)return rs;if(["+","-","PERP"].includes(this.token.token_type)){let ns=this.token.token_type.toLowerCase();return this.advance(),ns}{let ns=this.baseFactor({parse_absolute_value:ts,in_subsuperscript_with_no_delimiters:!0});return ns===!1&&(ns=""),ns}}baseFactor({inside_absolute_value:ts=0,parse_absolute_value:rs=!0,allow_absolute_value_closing:ns=!1,in_subsuperscript_with_no_delimiters:is=!1}={}){var as=!1;if(this.token.token_type==="BEGINENVIRONMENT"){let os=/\\begin\s*{\s*([a-zA-Z0-9]+)\s*}/.exec(this.token.token_text)[1];if(["matrix","pmatrix","bmatrix"].includes(os)){let ls=0,us=0,cs=[],ps=[],ds=0,fs=this.token.token_type;for(this.advance();this.token.token_type!=="ENDENVIRONMENT";)this.token.token_type==="&"?(fs!=="&"&&fs!=="LINEBREAK"||(ps.push(0),ds+=1),fs=this.token.token_type,this.advance()):this.token.token_type==="LINEBREAK"?(fs!=="&"&&fs!=="LINEBREAK"||(ps.push(0),ds+=1),cs.push(ps),ds>us&&(us=ds),ls+=1,ds=0,ps=[],fs=this.token.token_type,this.advance()):(ps.push(this.statement({parse_absolute_value:rs})),ds+=1,fs=" ");if(/\\end\s*{\s*([a-zA-Z0-9]+)\s*}/.exec(this.token.token_text)[1]!==os)throw new ParseError("Expecting \\end{"+os+"}",this.lexer.location);fs==="&"&&(ps.push(0),ds+=1),cs.push(ps),ds>us&&(us=ds),ls+=1,this.advance(),as=["matrix",["tuple",ls,us]];let hs=["tuple"];for(let ys of cs){let gs=["tuple"].concat(ys);for(let bs=ys.length;bs<us;bs+=1)gs.push(0);hs.push(gs)}return as.push(hs),as}throw new ParseError("Unrecognized environment "+os,this.lexer.location)}if(this.token.token_type==="NUMBER")as=parseFloat(this.token.token_text),this.advance();else if(this.token.token_type==="INFINITY")as=1/0,this.advance();else if(this.token.token_type==="SQRT"){this.advance();let os=2;if(this.token.token_type==="["){this.advance();let us=this.statement({parse_absolute_value:rs});if(this.token.token_type!=="]")throw new ParseError("Expecting ]",this.lexer.location);this.advance(),os=us}if(this.token.token_type!=="{")throw new ParseError("Expecting {",this.lexer.location);this.advance();let ls=this.statement({parse_absolute_value:rs});if(this.token.token_type!=="}")throw new ParseError("Expecting }",this.lexer.location);this.advance(),as=os===2?["apply","sqrt",ls]:["^",ls,["/",1,os]]}else if(this.token.token_type==="VAR"||this.token.token_type==="LATEXCOMMAND"||this.token.token_type==="VARMULTICHAR"){if(as=this.token.token_text,this.token.token_type==="LATEXCOMMAND"){if(as=as.slice(1),!(this.appliedFunctionSymbols.includes(as)||this.functionSymbols.includes(as)||this.allowedLatexSymbols.includes(as)||as in this.operatorSymbols))throw new ParseError("Unrecognized latex command "+this.token.original_text,this.lexer.location)}else this.token.token_type==="VARMULTICHAR"&&(as=/\\operatorname\s*\{\s*([a-zA-Z0-9\+\-]+)\s*\}/.exec(as)[1]);if(this.appliedFunctionSymbols.includes(as)||this.functionSymbols.includes(as)){let os=!1;if(this.appliedFunctionSymbols.includes(as)&&(os=!0),["Re","Im"].includes(as)&&(as=as.toLowerCase()),this.advance(),this.token.token_type==="_"){this.advance();let ls=this.get_subsuperscript({parse_absolute_value:rs});as=as==="log"&&ls===10?"log10":["_",as,ls]}if(is)os&&(as=["apply",as,""]);else{for(;this.token.token_type==="'";)as=["prime",as],this.advance();for(;this.token.token_type==="^";)this.advance(),as=["^",as,this.get_subsuperscript({parse_absolute_value:rs})];if(this.token.token_type==="{"||this.token.token_type==="("){let ls;ls=this.token.token_type==="{"?"}":")",this.advance();let us=this.statement_list();if(this.token.token_type!==ls)throw new ParseError("Expecting "+ls,this.lexer.location);this.advance(),us[0]==="list"&&(us[0]="tuple"),as=["apply",as,us]}else if(os){if(!this.allowSimplifiedFunctionApplication)throw new ParseError("Expecting ( after function",this.lexer.location);let ls=this.factor({parse_absolute_value:rs});ls===!1&&(ls=""),as=["apply",as,ls]}}return as}if(as in this.operatorSymbols){if(this.advance(),as==="frac"&&this.parseLeibnizNotation){let ps=this.return_state(),ds=this.leibniz_notation();if(ds)return ds;this.set_state(ps)}let os=as;this.operatorSymbols[as].substitute&&(os=this.operatorSymbols[as].substitute);let ls=this.operatorSymbols[as].nargs,us=this.operatorSymbols[as].remove_products,cs=[];for(let ps=0;ps<ls;ps++)if(this.token.token_type==="{"){this.advance();let ds=this.statement({parse_absolute_value:rs});if(us&&Array.isArray(ds)&&ds[0]==="*"?cs.push(...ds.slice(1)):cs.push(ds),this.token.token_type!=="}")throw new ParseError("Expecting }",this.lexer.location);this.advance()}else{let ds=this.get_single_digit_as_number();if(ds===null){if(this.token.token_type!=="VAR")throw new ParseError("Expecting {",this.lexer.location);ds=this.token.token_text,this.advance()}cs.push(ds)}as=[os,...cs]}else this.advance()}else if(this.token.token_type==="("||this.token.token_type==="["||this.token.token_type==="{"||this.token.token_type==="LBRACE"||this.token.token_type==="LANGLE"){let os,ls,us=this.token.token_type;this.token.token_type==="("?(os=")",ls="]"):this.token.token_type==="["?(os="]",ls=")"):this.token.token_type==="{"?(os="}",ls=null):this.token.token_type==="LBRACE"?(os="RBRACE",ls=null):(os="RANGLE",ls=null),this.advance();let cs=1;if((as=this.statement_list())[0]==="list"&&(cs=as.length-1),this.token.token_type!==os){if(cs!==2||ls===null)throw new ParseError("Expecting "+os,this.lexer.location);if(this.token.token_type!==ls)throw new ParseError("Expecting ) or ]",this.lexer.location);let ps;as[0]="tuple",ps=us==="("?["tuple",!1,!0]:["tuple",!0,!1],(as=["interval",as]).push(ps)}else cs>=2?as[0]=us==="("||us==="{"?"tuple":us==="["?"array":us==="LBRACE"?"set":"altvector":us==="LBRACE"&&(as=(as[0]==="|"||as[0],["set",as]));this.advance()}else if(this.token.token_type[0]!=="|"||!rs||ts!==0&&ns&&this.token.token_type[1]!=="L"){if(this.token.token_type==="LFLOOR"||this.token.token_type==="LCEIL"){let os,ls;if(this.token.token_type==="LFLOOR"?(os="RFLOOR",ls="floor"):this.token.token_type==="LCEIL"&&(os="RCEIL",ls="ceil"),this.advance(),as=["apply",ls,as=this.statement()],this.token.token_type!==os)throw new ParseError("Expecting "+os,this.lexer.location);this.advance()}else if(this.token.token_type==="ANGLE")if(this.advance(),this.token.token_type==="{"||this.token.token_type==="("){let os;os=this.token.token_type==="{"?"}":")",this.advance();let ls=this.statement_list();if(this.token.token_type!==os)throw new ParseError("Expecting "+os,this.lexer.location);this.advance(),ls[0]==="list"?as=["angle",...ls.slice(1)]:ls[0]==="*"&&(as=["angle",ls])}else{let os=[],ls=this.nonMinusFactor({parse_absolute_value:rs});for(;ls!==!1;)os.push(ls),ls=this.nonMinusFactor({parse_absolute_value:rs});as=os.length===0?"angle":["angle",...os]}else if(this.token.token_type==="INT"){this.advance();let os="int";this.token.token_type==="_"&&(this.advance(),os=["_",os,this.get_subsuperscript({parse_absolute_value:rs})]),this.token.token_type==="^"&&(this.advance(),os=["^",os,this.get_subsuperscript({parse_absolute_value:rs})]);let ls=flatten$6(this.term({parse_absolute_value:rs}));if(Array.isArray(ls)&&ls[0]==="*"){let us=[];for(let cs=0;cs<ls.length-1;cs++)if(ls[cs]==="d"){let ps=ls[cs+1];ls.splice(cs,2),us.push(["d",ps]),cs--}ls.push(...us)}return["apply",os,ls]}}else{if(ts+=1,this.advance(),as=["apply","abs",as=this.statement({inside_absolute_value:ts})],this.token.token_type!=="|")throw new ParseError("Expecting |",this.lexer.location);this.advance()}return this.token.token_type==="_"&&(as===!1&&(as=""),this.advance(),as=["_",as,this.get_subsuperscript({parse_absolute_value:rs})]),as}leibniz_notation(){if(this.token.token_type!=="{")return!1;this.advance();var ts=this.token.token_text;let rs="",ns=1,is="",as=[],os=[];if(this.token.token_type==="LATEXCOMMAND"&&ts.slice(1)==="partial")rs="";else{if(this.token.token_type!=="VAR"||ts!=="d")return!1;rs="d"}if(this.advance(),this.token.token_type==="^"){this.advance();let us=!1;if(this.token.token_type==="{"&&(us=!0,this.advance()),this.token.token_type!=="NUMBER"||(ns=parseFloat(this.token.token_text),!Number.isInteger(ns))||us&&(this.advance(),this.token.token_type!=="}"))return!1;this.advance()}if(this.token.token_type==="VAR")is=this.token.token_text;else if(this.token.token_type==="VARMULTICHAR")is=/\\operatorname\s*\{\s*([a-zA-Z0-9\+\-]+)\s*\}/.exec(this.token.token_text)[1];else if(this.token.token_type==="LATEXCOMMAND"){if(ts=this.token.token_text.slice(1),!this.allowedLatexSymbols.includes(ts))return!1;is=ts}if(this.advance(),this.token.token_type!=="}"||(this.advance(),this.token.token_type!=="{"))return!1;this.advance();let ls=0;for(;;){if(!(rs==="d"&&this.token.token_type==="VAR"&&this.token.token_text==="d"||rs===""&&this.token.token_type==="LATEXCOMMAND"&&this.token.token_text.slice(1)==="partial"))return!1;if(this.advance(),this.token.token_type==="VAR")as.push(this.token.token_text);else if(this.token.token_type==="VARMULTICHAR")as.push(/\\operatorname\s*\{\s*([a-zA-Z0-9\+\-]+)\s*\}/.exec(this.token.token_text)[1]);else{if(this.token.token_type!=="LATEXCOMMAND")return!1;{let cs=this.token.token_text.slice(1);if(!this.allowedLatexSymbols.includes(cs))return!1;as.push(cs)}}let us=1;if(this.advance(),this.token.token_type==="^"){this.advance();let cs=!1;if(this.token.token_type==="{"&&(cs=!0,this.advance()),this.token.token_type!=="NUMBER"||(us=parseFloat(this.token.token_text),!Number.isInteger(us))||cs&&(this.advance(),this.token.token_type!=="}"))return!1;this.advance()}if(os.push(us),ls+=us,ls>ns)return!1;if(ls===ns){if(this.token.token_type!=="}")return!1;this.advance();let cs="derivative_leibniz";rs===""&&(cs="partial_"+cs),ts=[cs],ns===1?ts.push(is):ts.push(["tuple",is,ns]);let ps=[];for(let ds=0;ds<as.length;ds+=1)os[ds]===1?ps.push(as[ds]):ps.push(["tuple",as[ds],os[ds]]);return ps=["tuple"].concat(ps),ts.push(ps),ts}}}}class latexToGuppy{constructor(){this.latexToAst=new latexToAst$1,this.astToGuppy=new astToGuppy$1}convert(ts){return this.astToGuppy.convert(this.latexToAst.convert(ts))}}class latexToMathjs{constructor(){this.latexToAst=new latexToAst$1,this.astToMathjs=new astToMathjs$1}convert(ts){return this.astToMathjs.convert(this.latexToAst.convert(ts))}}class latexToText{constructor(){this.latexToAst=new latexToAst$1,this.astToText=new astToText$2}convert(ts){return this.astToText.convert(this.latexToAst.convert(ts))}}const operators={"+,add":function(ss){return["+"].concat(ss)},"*,multiply":function(ss){return["*"].concat(ss)},"/,divide":function(ss){return["/",ss[0],ss[1]]},"-,unaryMinus":function(ss){return["-",ss[0]]},"-,subtract":function(ss){return["+",ss[0],["-",ss[1]]]},"^,pow":function(ss){return["^",ss[0],ss[1]]},"and,and":function(ss){return["and"].concat(ss)},"or,or":function(ss){return["or"].concat(ss)},"not,not":function(ss){return["not",ss[0]]},"==,equal":function(ss){return["="].concat(ss)},"<,smaller":function(ss){return["<",ss[0],ss[1]]},">,larger":function(ss){return[">",ss[0],ss[1]]},"<=,smallerEq":function(ss){return["le",ss[0],ss[1]]},">=,largerEq":function(ss){return["ge",ss[0],ss[1]]},"!=,unequal":function(ss){return["ne",ss[0],ss[1]]},"!,factorial":function(ss){return["apply","factorial",ss[0]]}};class mathjsToAst{convert(ts){if(ts.isConstantNode)return ts.value;if(ts.isSymbolNode)return ts.name;if(ts.isOperatorNode){var rs=[ts.op,ts.fn].join(",");if(rs in operators)return operators[rs](ts.args.map(function(as,os){return this.convert(as)}.bind(this)));throw Error("Unsupported operator: "+ts.op+", "+ts.fn)}if(ts.isFunctionNode){var ns=ts.args.map(function(as,os){return this.convert(as)}.bind(this));ns=ns.length>1?["tuple"].concat(ns):ns[0];var is=["apply",ts.name];return is.push(ns),is}if(ts.isArrayNode)return["vector"].concat(ts.args.map(function(as,os){return this.convert(as)}.bind(this)));if(ts.isParenthesisNode)return this.convert(ts.content);throw Error("Unsupported node type: "+ts.type)}}class mathjsToGuppy{constructor(){this.mathjsToAst=new mathjsToAst,this.astToGuppy=new astToGuppy$1}convert(ts){return this.astToGuppy.convert(this.mathjsToAst.convert(ts))}}class mathjsToLatex{constructor(){this.mathjsToAst=new mathjsToAst,this.astToLatex=new astToLatex$1}convert(ts){return this.astToLatex.convert(this.mathjsToAst.convert(ts))}}class mathjsToText{constructor(){this.mathjsToAst=new mathjsToAst,this.astToText=new astToText$2}convert(ts){return this.astToText.convert(this.mathjsToAst.convert(ts))}}function defaultSetTimout$1(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout$1(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout$1=defaultSetTimout$1,cachedClearTimeout$1=defaultClearTimeout$1;function runTimeout$1(ss){if(cachedSetTimeout$1===setTimeout)return setTimeout(ss,0);if((cachedSetTimeout$1===defaultSetTimout$1||!cachedSetTimeout$1)&&setTimeout)return cachedSetTimeout$1=setTimeout,setTimeout(ss,0);try{return cachedSetTimeout$1(ss,0)}catch{try{return cachedSetTimeout$1.call(null,ss,0)}catch{return cachedSetTimeout$1.call(this,ss,0)}}}function runClearTimeout$1(ss){if(cachedClearTimeout$1===clearTimeout)return clearTimeout(ss);if((cachedClearTimeout$1===defaultClearTimeout$1||!cachedClearTimeout$1)&&clearTimeout)return cachedClearTimeout$1=clearTimeout,clearTimeout(ss);try{return cachedClearTimeout$1(ss)}catch{try{return cachedClearTimeout$1.call(null,ss)}catch{return cachedClearTimeout$1.call(this,ss)}}}typeof global$1.setTimeout=="function"&&(cachedSetTimeout$1=setTimeout),typeof global$1.clearTimeout=="function"&&(cachedClearTimeout$1=clearTimeout);var queue$1=[],draining$1=!1,currentQueue$1,queueIndex$1=-1;function cleanUpNextTick$1(){draining$1&&currentQueue$1&&(draining$1=!1,currentQueue$1.length?queue$1=currentQueue$1.concat(queue$1):queueIndex$1=-1,queue$1.length&&drainQueue$1())}function drainQueue$1(){if(!draining$1){var ss=runTimeout$1(cleanUpNextTick$1);draining$1=!0;for(var ts=queue$1.length;ts;){for(currentQueue$1=queue$1,queue$1=[];++queueIndex$1<ts;)currentQueue$1&&currentQueue$1[queueIndex$1].run();queueIndex$1=-1,ts=queue$1.length}currentQueue$1=null,draining$1=!1,runClearTimeout$1(ss)}}function nextTick$1(ss){var ts=new Array(arguments.length-1);if(arguments.length>1)for(var rs=1;rs<arguments.length;rs++)ts[rs-1]=arguments[rs];queue$1.push(new Item$1(ss,ts)),queue$1.length!==1||draining$1||runTimeout$1(drainQueue$1)}function Item$1(ss,ts){this.fun=ss,this.array=ts}Item$1.prototype.run=function(){this.fun.apply(null,this.array)};var title$1="browser",platform$1="browser",browser$1$1=!0,env$1={},argv$1=[],version$3="",versions$1={},release$1={},config$3={};function noop$2(){}var on$2=noop$2,addListener$1=noop$2,once$2=noop$2,off$1=noop$2,removeListener$1=noop$2,removeAllListeners$1=noop$2,emit$1=noop$2;function binding$1(ss){throw new Error("process.binding is not supported")}function cwd$1(){return"/"}function chdir$1(ss){throw new Error("process.chdir is not supported")}function umask$1(){return 0}var performance$1=global$1.performance||{},performanceNow$1=performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow||function(){return new Date().getTime()};function hrtime$1(ss){var ts=.001*performanceNow$1.call(performance$1),rs=Math.floor(ts),ns=Math.floor(ts%1*1e9);return ss&&(rs-=ss[0],(ns-=ss[1])<0&&(rs--,ns+=1e9)),[rs,ns]}var startTime$1=new Date;function uptime$1(){return(new Date-startTime$1)/1e3}var browser$1$1$1={nextTick:nextTick$1,title:title$1,browser:browser$1$1,env:env$1,argv:argv$1,version:version$3,versions:versions$1,on:on$2,addListener:addListener$1,once:once$2,off:off$1,removeListener:removeListener$1,removeAllListeners:removeAllListeners$1,emit:emit$1,binding:binding$1,cwd:cwd$1,chdir:chdir$1,umask:umask$1,hrtime:hrtime$1,platform:platform$1,release:release$1,config:config$3,uptime:uptime$1},browser$2={exports:{}},debug$1={exports:{}},s$2=1e3,m$2=60*s$2,h$2=60*m$2,d$2=24*h$2,y$2=365.25*d$2,ms=function(ss,ts){ts=ts||{};var rs=typeof ss;if(rs==="string"&&ss.length>0)return parse$1(ss);if(rs==="number"&&isNaN(ss)===!1)return ts.long?fmtLong(ss):fmtShort(ss);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(ss))};function parse$1(ss){if(!((ss=String(ss)).length>100)){var ts=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(ss);if(ts){var rs=parseFloat(ts[1]);switch((ts[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return rs*y$2;case"days":case"day":case"d":return rs*d$2;case"hours":case"hour":case"hrs":case"hr":case"h":return rs*h$2;case"minutes":case"minute":case"mins":case"min":case"m":return rs*m$2;case"seconds":case"second":case"secs":case"sec":case"s":return rs*s$2;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return rs;default:return}}}}function fmtShort(ss){return ss>=d$2?Math.round(ss/d$2)+"d":ss>=h$2?Math.round(ss/h$2)+"h":ss>=m$2?Math.round(ss/m$2)+"m":ss>=s$2?Math.round(ss/s$2)+"s":ss+"ms"}function fmtLong(ss){return plural(ss,d$2,"day")||plural(ss,h$2,"hour")||plural(ss,m$2,"minute")||plural(ss,s$2,"second")||ss+" ms"}function plural(ss,ts,rs){if(!(ss<ts))return ss<1.5*ts?Math.floor(ss/ts)+" "+rs:Math.ceil(ss/ts)+" "+rs+"s"}(function(ss,ts){var rs;function ns(is){function as(){if(as.enabled){var os=as,ls=+new Date,us=ls-(rs||ls);os.diff=us,os.prev=rs,os.curr=ls,rs=ls;for(var cs=new Array(arguments.length),ps=0;ps<cs.length;ps++)cs[ps]=arguments[ps];cs[0]=ts.coerce(cs[0]),typeof cs[0]!="string"&&cs.unshift("%O");var ds=0;cs[0]=cs[0].replace(/%([a-zA-Z%])/g,function(fs,hs){if(fs==="%%")return fs;ds++;var ys=ts.formatters[hs];if(typeof ys=="function"){var gs=cs[ds];fs=ys.call(os,gs),cs.splice(ds,1),ds--}return fs}),ts.formatArgs.call(os,cs),(as.log||ts.log||console.log.bind(console)).apply(os,cs)}}return as.namespace=is,as.enabled=ts.enabled(is),as.useColors=ts.useColors(),as.color=function(os){var ls,us=0;for(ls in os)us=(us<<5)-us+os.charCodeAt(ls),us|=0;return ts.colors[Math.abs(us)%ts.colors.length]}(is),typeof ts.init=="function"&&ts.init(as),as}(ts=ss.exports=ns.debug=ns.default=ns).coerce=function(is){return is instanceof Error?is.stack||is.message:is},ts.disable=function(){ts.enable("")},ts.enable=function(is){ts.save(is),ts.names=[],ts.skips=[];for(var as=(typeof is=="string"?is:"").split(/[\s,]+/),os=as.length,ls=0;ls<os;ls++)as[ls]&&((is=as[ls].replace(/\*/g,".*?"))[0]==="-"?ts.skips.push(new RegExp("^"+is.substr(1)+"$")):ts.names.push(new RegExp("^"+is+"$")))},ts.enabled=function(is){var as,os;for(as=0,os=ts.skips.length;as<os;as++)if(ts.skips[as].test(is))return!1;for(as=0,os=ts.names.length;as<os;as++)if(ts.names[as].test(is))return!0;return!1},ts.humanize=ms,ts.names=[],ts.skips=[],ts.formatters={}})(debug$1,debug$1.exports),function(ss,ts){function rs(){var ns;try{ns=ts.storage.debug}catch{}return!ns&&browser$1$1$1!==void 0&&"env"in browser$1$1$1&&(ns=browser$1$1$1.env.DEBUG),ns}(ts=ss.exports=debug$1.exports).log=function(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},ts.formatArgs=function(ns){var is=this.useColors;if(ns[0]=(is?"%c":"")+this.namespace+(is?" %c":" ")+ns[0]+(is?"%c ":" ")+"+"+ts.humanize(this.diff),!!is){var as="color: "+this.color;ns.splice(1,0,as,"color: inherit");var os=0,ls=0;ns[0].replace(/%[a-zA-Z%]/g,function(us){us!=="%%"&&(os++,us==="%c"&&(ls=os))}),ns.splice(ls,0,as)}},ts.save=function(ns){try{ns==null?ts.storage.removeItem("debug"):ts.storage.debug=ns}catch{}},ts.load=rs,ts.useColors=function(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},ts.storage=typeof chrome<"u"&&chrome.storage!==void 0?chrome.storage.local:function(){try{return window.localStorage}catch{}}(),ts.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],ts.formatters.j=function(ns){try{return JSON.stringify(ns)}catch(is){return"[UnexpectedJSONParseError]: "+is.message}},ts.enable(rs())}(browser$2,browser$2.exports);var debug=browser$2.exports("xml-parser"),xmlParser=parse$3;function parse$3(ss){return ss=(ss=ss.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:ts(),root:rs()};function ts(){if(is(/^<\?xml\s*/)){for(var ls={attributes:{}};!as()&&!os("?>");){var us=ns();if(!us)return ls;ls.attributes[us.name]=us.value}return is(/\?>\s*/),ls}}function rs(){debug("tag %j",ss);var ls=is(/^<([\w-:.]+)\s*/);if(ls){for(var us,cs={name:ls[1],attributes:{},children:[]};!(as()||os(">")||os("?>")||os("/>"));){var ps=ns();if(!ps)return cs;cs.attributes[ps.name]=ps.value}if(is(/^\s*\/>\s*/))return cs;for(is(/\??>\s*/),cs.content=function(){debug("content %j",ss);var ds=is(/^([^<]*)/);return ds?ds[1]:""}();us=rs();)cs.children.push(us);return is(/^<\/[\w-:.]+>\s*/),cs}}function ns(){debug("attribute %j",ss);var ls,us=is(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(us)return{name:us[1],value:(ls=us[2],ls.replace(/^['"]|['"]$/g,""))}}function is(ls){var us=ss.match(ls);if(us)return ss=ss.slice(us[0].length),us}function as(){return ss.length==0}function os(ls){return ss.indexOf(ls)==0}}const entities={"&#913;":"\\Alpha","&Alpha;":"\\Alpha","&#x0391;":"\\Alpha","\\u0391;":"\\Alpha","&#914;":"\\Beta","&Beta;":"\\Beta","&#x0392;":"\\Beta","\\u0392;":"\\Beta","&#915;":"\\Gamma","&Gamma;":"\\Gamma","&#x0393;":"\\Gamma","\\u0393;":"\\Gamma","&#916;":"\\Delta","&Delta;":"\\Delta","&#x0394;":"\\Delta","\\u0394;":"\\Delta","&#917;":"\\Epsilon","&Epsilon;":"\\Epsilon","&#x0395;":"\\Epsilon","\\u0395;":"\\Epsilon","&#918;":"\\Zeta","&Zeta;":"\\Zeta","&#x0396;":"\\Zeta","\\u0396;":"\\Zeta","&#919;":"\\Eta","&Eta;":"\\Eta","&#x0397;":"\\Eta","\\u0397;":"\\Eta","&#920;":"\\Theta","&Theta;":"\\Theta","&#x0398;":"\\Theta","\\u0398;":"\\Theta","&#921;":"\\Iota","&Iota;":"\\Iota","&#x0399;":"\\Iota","\\u0399;":"\\Iota","&#922;":"\\Kappa","&Kappa;":"\\Kappa","&#x039A;":"\\Kappa","\\u039A;":"\\Kappa","&#923;":"\\Lambda","&Lambda;":"\\Lambda","&#x039B;":"\\Lambda","\\u039B;":"\\Lambda","&#924;":"\\Mu","&Mu;":"\\Mu","&#x039C;":"\\Mu","\\u039C;":"\\Mu","&#925;":"\\Nu","&Nu;":"\\Nu","&#x039D;":"\\Nu","\\u039D;":"\\Nu","&#926;":"\\Xi","&Xi;":"\\Xi","&#x039E;":"\\Xi","\\u039E;":"\\Xi","&#927;":"\\Omicron","&Omicron;":"\\Omicron","&#x039F;":"\\Omicron","\\u039F;":"\\Omicron","&#928;":"\\Pi","&Pi;":"\\Pi","&#x03A0;":"\\Pi","\\u03A0;":"\\Pi","&#929;":"\\Rho","&Rho;":"\\Rho","&#x03A1;":"\\Rho","\\u03A1;":"\\Rho","&#931;":"\\Sigma","&Sigma;":"\\Sigma","&#x03A3;":"\\Sigma","\\u03A3;":"\\Sigma","&#932;":"\\Tau","&Tau;":"\\Tau","&#x03A4;":"\\Tau","\\u03A4;":"\\Tau","&#933;":"\\Upsilon","&Upsilon;":"\\Upsilon","&#x03A5;":"\\Upsilon","\\u03A5;":"\\Upsilon","&#934;":"\\Phi","&Phi;":"\\Phi","&#x03A6;":"\\Phi","\\u03A6;":"\\Phi","&#935;":"\\Chi","&Chi;":"\\Chi","&#x03A7;":"\\Chi","\\u03A7;":"\\Chi","&#936;":"\\Psi","&Psi;":"\\Psi","&#x03A8;":"\\Psi","\\u03A8;":"\\Psi","&#937;":"\\Omega","&Omega;":"\\Omega","&#x03A9;":"\\Omega","\\u03A9;":"\\Omega","&#945;":"\\alpha","&alpha;":"\\alpha","&#x03B1;":"\\alpha","\\u03B1;":"\\alpha","&#946;":"\\beta","&beta;":"\\beta","&#x03B2;":"\\beta","\\u03B2;":"\\beta","&#947;":"\\gamma","&gamma;":"\\gamma","&#x03B3;":"\\gamma","\\u03B3;":"\\gamma","&#948;":"\\delta","&delta;":"\\delta","&#x03B4;":"\\delta","\\u03B4;":"\\delta","&#949;":"\\epsilon","&epsilon;":"\\epsilon","&#x03B5;":"\\epsilon","\\u03B5;":"\\epsilon","&#950;":"\\zeta","&zeta;":"\\zeta","&#x03B6;":"\\zeta","\\u03B6;":"\\zeta","&#951;":"\\eta","&eta;":"\\eta","&#x03B7;":"\\eta","\\u03B7;":"\\eta","&#952;":"\\theta","&theta;":"\\theta","&#x03B8;":"\\theta","\\u03B8;":"\\theta","&#953;":"\\iota","&iota;":"\\iota","&#x03B9;":"\\iota","\\u03B9;":"\\iota","&#954;":"\\kappa","&kappa;":"\\kappa","&#x03BA;":"\\kappa","\\u03BA;":"\\kappa","&#955;":"\\lambda","&lambda;":"\\lambda","&#x03BB;":"\\lambda","\\u03BB;":"\\lambda","&#956;":"\\mu","&mu;":"\\mu","&#x03BC;":"\\mu","\\u03BC;":"\\mu","&#957;":"\\nu","&nu;":"\\nu","&#x03BD;":"\\nu","\\u03BD;":"\\nu","&#958;":"\\xi","&xi;":"\\xi","&#x03BE;":"\\xi","\\u03BE;":"\\xi","&#959;":"\\omicron","&omicron;":"\\omicron","&#x03BF;":"\\omicron","\\u03BF;":"\\omicron","&#960;":"\\pi","&pi;":"\\pi","&#x03C0;":"\\pi","\\u03C0;":"\\pi","&#961;":"\\rho","&rho;":"\\rho","&#x03C1;":"\\rho","\\u03C1;":"\\rho","&#962;":"\\sigma",";":"\\sigma","&#x03C2;":"\\sigma","\\u03C2;":"\\sigma","&#963;":"\\sigma","&sigma;":"\\sigma","&#x03C3;":"\\sigma","\\u03C3;":"\\sigma","&#964;":"\\tau","&tau;":"\\tau","&#x03C4;":"\\tau","\\u03C4;":"\\tau","&#965;":"\\upsilon","&upsilon;":"\\upsilon","&#x03C5;":"\\upsilon","\\u03C5;":"\\upsilon","&#966;":"\\phi","&phi;":"\\phi","&#x03C6;":"\\phi","\\u03C6;":"\\phi","&#967;":"\\chi","&chi;":"\\chi","&#x03C7;":"\\chi","\\u03C7;":"\\chi","&#968;":"\\psi","&psi;":"\\psi","&#x03C8;":"\\psi","\\u03C8;":"\\psi","&#969;":"\\omega","&omega;":"\\omega","&#x03C9;":"\\omega","\\u03C9;":"\\omega","&#x2212;":"-","&minus;":"-","&#x221E;":"\\infty","&#8734;":"\\infty","&infin;":"\\infty","&sdot;":"\\cdot","&#x22C5;":"\\cdot","&#8901;":"\\cdot","&times;":"\\times","&#x00D7;":"\\times","&#215;":"\\times"};class mmlToLatex{parse(ts){return ts.name==="mi"?entities[ts.content]?entities[ts.content]:ts.content.length>1?"\\"+ts.content:ts.content:ts.name==="mn"?ts.content:ts.name==="msup"?this.parse(ts.children[0])+"^{"+this.parse(ts.children[1])+"}":ts.name==="mroot"?"\\sqrt["+this.parse(ts.children[1])+"]{"+this.parse(ts.children[1])+"}":ts.name==="mfrac"?"\\frac{"+this.parse(ts.children[0])+"}{"+this.parse(ts.children[1])+"}":ts.name==="msqrt"?"\\sqrt{"+ts.children.map(function(rs,ns){return this.parse(rs)}.bind(this)).join(" ")+"}":ts.name==="mo"?entities[ts.content]?entities[ts.content]:ts.content==="&#x2061;"?" ":ts.content:ts.name==="mrow"&&ts.attributes.class==="MJX-TeXAtom-ORD"?ts.children.map(function(rs,ns){return this.parse(rs)}.bind(this)).join(" "):ts.name==="math"||ts.name==="mrow"?"("+ts.children.map(function(rs,ns){return this.parse(rs)}.bind(this)).join(" ")+")":void 0}convert(ts){return this.parse(xmlParser(ts).root)}}class mmlToAst$1{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1}convert(ts){return this.latexToAst.convert(this.mmlToLatex.convert(ts))}}class mmlToGuppy{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToGuppy=new astToGuppy$1}convert(ts){return this.astToGuppy.convert(this.latexToAst.convert(this.mmlToLatex.convert(ts)))}}class mmlToMathjs{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToMathjs=new astToMathjs$1}convert(ts){return this.astToMathjs.convert(this.latexToAst.convert(this.mmlToLatex.convert(ts)))}}class mmlToText{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToText=new astToText$2}convert(ts){return this.astToText.convert(this.latexToAst.convert(this.mmlToLatex.convert(ts)))}}class textToGuppy{constructor(){this.textToAst=new textToAst$4,this.astToGuppy=new astToGuppy$1}convert(ts){return this.astToGuppy.convert(this.textToAst.convert(ts))}}class textToLatex{constructor(){this.textToAst=new textToAst$4,this.astToLatex=new astToLatex$1}convert(ts){return this.astToLatex.convert(this.textToAst.convert(ts))}}class textToMathjs{constructor(){this.textToAst=new textToAst$4,this.astToMathjs=new astToMathjs$1}convert(ts){return this.astToMathjs.convert(this.textToAst.convert(ts))}}var converters=Object.freeze({__proto__:null,astToLatexObj:astToLatex$1,astToTextObj:astToText$2,astToGuppyObj:astToGuppy$1,astToMathjsObj:astToMathjs$1,latexToAstObj:latexToAst$1,latexToGuppyObj:latexToGuppy,latexToMathjsObj:latexToMathjs,latexToTextObj:latexToText,mathjsToAstObj:mathjsToAst,mathjsToGuppyObj:mathjsToGuppy,mathjsToLatexObj:mathjsToLatex,mathjsToTextObj:mathjsToText,mmlToAstObj:mmlToAst$1,mmlToGuppyObj:mmlToGuppy,mmlToLatexObj:mmlToLatex,mmlToMathjsObj:mmlToMathjs,mmlToTextObj:mmlToText,textToAstObj:textToAst$4,textToGuppyObj:textToGuppy,textToLatexObj:textToLatex,textToMathjsObj:textToMathjs,astToGLSL:astToGLSL$1}),textToAst$5=new textToAst$4,latexToAst$2=new latexToAst$1,mmlToAst=new mmlToAst$1,utils$c={match:match$2,flatten:flatten$5,unflattenLeft,unflattenRight};function Expression(ss,ts){this.tree=flatten$5(ss),this.context=ts,this.toJSON=function(){let rs={objectType:"math-expression",tree:this.tree},ns={};for(let is in this.context.assumptions)Object.keys(this.context.assumptions[is]).length>0&&(ns[is]=this.context.assumptions[is]);return Object.keys(ns).length>0&&(rs.assumptions=ns),rs}}function extend$3(ss,ts){return flatten_array(Array.prototype.slice.call(arguments,2)).forEach(function(rs){if(rs)for(var ns in rs)ts?function(){var is=ns;ss[is]=function(){return this.fromAst(rs[is].apply(null,arguments))}}():ss[ns]=rs[ns]}),ss}function extend_prototype(ss,ts){return flatten_array(Array.prototype.slice.call(arguments,2)).forEach(function(rs){if(rs)for(var ns in rs)(function(){var is=ns;ss[is]=function(){var as=[this].concat(Array.prototype.slice.call(arguments));return ts?this.context.fromAst(rs[is].apply(null,as)):rs[is].apply(null,as)}})()}),ss}function create_from_multiple(ss,ts){if(Array.isArray(ss)||typeof ss=="number")return new Expression(ss,Context);if(typeof ss=="string")try{return new Expression(textToAst$5.convert(ss),Context)}catch(rs){try{return new Expression(latexToAst$2.convert(ss),Context)}catch(ns){try{return new Expression(mmlToAst.convert(ss),Context)}catch(is){throw ss.indexOf("\\")!==-1?ns:ss.indexOf("</")!==-1?is:rs}}}}function parseText(ss,ts){return new Expression(textToAst$5.convert(ss),Context)}function parseLatex(ss,ts){return new Expression(latexToAst$2.convert(ss),Context)}function parseMml(ss,ts){return new Expression(mmlToAst.convert(ss),Context)}var Context={assumptions:initialize_assumptions(),parser_parameters:{},from:create_from_multiple,fromText:parseText,parse:parseText,fromLaTeX:parseLatex,fromLatex:parseLatex,fromTeX:parseLatex,fromTex:parseLatex,fromMml:parseMml,parse_tex:parseLatex,converters,utils:utils$c,fromAst:function(ss){return new Expression(ss,this)},set_to_default:function(){this.assumptions=initialize_assumptions()},get_assumptions:function(ss,ts){return get_assumptions(this.assumptions,ss,ts)},add_assumption:function(ss,ts){return add_assumption(this.assumptions,ss,ts)},add_generic_assumption:function(ss){return add_generic_assumption(this.assumptions,ss)},remove_assumption:function(ss){return remove_assumption(this.assumptions,ss)},remove_generic_assumption:function(ss){return remove_generic_assumption(this.assumptions,ss)},clear_assumptions:function(){this.assumptions=initialize_assumptions()},math:math$1,reviver:function(ss,ts){if(ts&&ts.objectType==="math-expression"&&ts.tree!==void 0){let rs=Context.fromAst(ts.tree);return ts.assumptions!==void 0&&(rs.assumptions=ts.assumptions),rs}return ts},class:Expression};function flatten_array(ss,ts){ts=ts===void 0?[]:ts;for(var rs=0;rs<ss.length;rs++)Array.isArray(ss[rs])?flatten_array(ss[rs],ts):ts.push(ss[rs]);return ts}Context.set_to_default(),extend$3(Context,!0,expression_to_tree$1,expression_to_tree),extend$3(Context,!1,expression_to_other),extend_prototype(Expression.prototype,!0,expression_to_tree$1),extend_prototype(Expression.prototype,!1,expression_to_other);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(ss){return ss&&ss.__esModule&&Object.prototype.hasOwnProperty.call(ss,"default")?ss.default:ss}var sha1Exports={},sha1={get exports(){return sha1Exports},set exports(ss){sha1Exports=ss}},coreExports={},core$1={get exports(){return coreExports},set exports(ss){coreExports=ss}},hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(ss,ts){(function(rs,ns){ss.exports=ns()})(commonjsGlobal,function(){var rs=rs||function(ns,is){var as=Object.create||function(){function bs(){}return function(vs){var Ns;return bs.prototype=vs,Ns=new bs,bs.prototype=null,Ns}}(),os={},ls=os.lib={},us=ls.Base=function(){return{extend:function(bs){var vs=as(this);return bs&&vs.mixIn(bs),(!vs.hasOwnProperty("init")||this.init===vs.init)&&(vs.init=function(){vs.$super.init.apply(this,arguments)}),vs.init.prototype=vs,vs.$super=this,vs},create:function(){var bs=this.extend();return bs.init.apply(bs,arguments),bs},init:function(){},mixIn:function(bs){for(var vs in bs)bs.hasOwnProperty(vs)&&(this[vs]=bs[vs]);bs.hasOwnProperty("toString")&&(this.toString=bs.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),cs=ls.WordArray=us.extend({init:function(bs,vs){bs=this.words=bs||[],vs!=is?this.sigBytes=vs:this.sigBytes=bs.length*4},toString:function(bs){return(bs||ds).stringify(this)},concat:function(bs){var vs=this.words,Ns=bs.words,Ts=this.sigBytes,Cs=bs.sigBytes;if(this.clamp(),Ts%4)for(var xs=0;xs<Cs;xs++){var As=Ns[xs>>>2]>>>24-xs%4*8&255;vs[Ts+xs>>>2]|=As<<24-(Ts+xs)%4*8}else for(var xs=0;xs<Cs;xs+=4)vs[Ts+xs>>>2]=Ns[xs>>>2];return this.sigBytes+=Cs,this},clamp:function(){var bs=this.words,vs=this.sigBytes;bs[vs>>>2]&=4294967295<<32-vs%4*8,bs.length=ns.ceil(vs/4)},clone:function(){var bs=us.clone.call(this);return bs.words=this.words.slice(0),bs},random:function(bs){for(var vs=[],Ns=function(ws){var ws=ws,Es=987654321,Ss=4294967295;return function(){Es=36969*(Es&65535)+(Es>>16)&Ss,ws=18e3*(ws&65535)+(ws>>16)&Ss;var Ds=(Es<<16)+ws&Ss;return Ds/=4294967296,Ds+=.5,Ds*(ns.random()>.5?1:-1)}},Ts=0,Cs;Ts<bs;Ts+=4){var xs=Ns((Cs||ns.random())*4294967296);Cs=xs()*987654071,vs.push(xs()*4294967296|0)}return new cs.init(vs,bs)}}),ps=os.enc={},ds=ps.Hex={stringify:function(bs){for(var vs=bs.words,Ns=bs.sigBytes,Ts=[],Cs=0;Cs<Ns;Cs++){var xs=vs[Cs>>>2]>>>24-Cs%4*8&255;Ts.push((xs>>>4).toString(16)),Ts.push((xs&15).toString(16))}return Ts.join("")},parse:function(bs){for(var vs=bs.length,Ns=[],Ts=0;Ts<vs;Ts+=2)Ns[Ts>>>3]|=parseInt(bs.substr(Ts,2),16)<<24-Ts%8*4;return new cs.init(Ns,vs/2)}},fs=ps.Latin1={stringify:function(bs){for(var vs=bs.words,Ns=bs.sigBytes,Ts=[],Cs=0;Cs<Ns;Cs++){var xs=vs[Cs>>>2]>>>24-Cs%4*8&255;Ts.push(String.fromCharCode(xs))}return Ts.join("")},parse:function(bs){for(var vs=bs.length,Ns=[],Ts=0;Ts<vs;Ts++)Ns[Ts>>>2]|=(bs.charCodeAt(Ts)&255)<<24-Ts%4*8;return new cs.init(Ns,vs)}},hs=ps.Utf8={stringify:function(bs){try{return decodeURIComponent(escape(fs.stringify(bs)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(bs){return fs.parse(unescape(encodeURIComponent(bs)))}},ys=ls.BufferedBlockAlgorithm=us.extend({reset:function(){this._data=new cs.init,this._nDataBytes=0},_append:function(bs){typeof bs=="string"&&(bs=hs.parse(bs)),this._data.concat(bs),this._nDataBytes+=bs.sigBytes},_process:function(bs){var vs=this._data,Ns=vs.words,Ts=vs.sigBytes,Cs=this.blockSize,xs=Cs*4,As=Ts/xs;bs?As=ns.ceil(As):As=ns.max((As|0)-this._minBufferSize,0);var ws=As*Cs,Es=ns.min(ws*4,Ts);if(ws){for(var Ss=0;Ss<ws;Ss+=Cs)this._doProcessBlock(Ns,Ss);var Ds=Ns.splice(0,ws);vs.sigBytes-=Es}return new cs.init(Ds,Es)},clone:function(){var bs=us.clone.call(this);return bs._data=this._data.clone(),bs},_minBufferSize:0});ls.Hasher=ys.extend({cfg:us.extend(),init:function(bs){this.cfg=this.cfg.extend(bs),this.reset()},reset:function(){ys.reset.call(this),this._doReset()},update:function(bs){return this._append(bs),this._process(),this},finalize:function(bs){bs&&this._append(bs);var vs=this._doFinalize();return vs},blockSize:16,_createHelper:function(bs){return function(vs,Ns){return new bs.init(Ns).finalize(vs)}},_createHmacHelper:function(bs){return function(vs,Ns){return new gs.HMAC.init(bs,Ns).finalize(vs)}}});var gs=os.algo={};return os}(Math);return rs})}(core$1)),coreExports}(function(ss,ts){(function(rs,ns){ss.exports=ns(requireCore())})(commonjsGlobal,function(rs){return function(){var ns=rs,is=ns.lib,as=is.WordArray,os=is.Hasher,ls=ns.algo,us=[],cs=ls.SHA1=os.extend({_doReset:function(){this._hash=new as.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(ps,ds){for(var fs=this._hash.words,hs=fs[0],ys=fs[1],gs=fs[2],bs=fs[3],vs=fs[4],Ns=0;Ns<80;Ns++){if(Ns<16)us[Ns]=ps[ds+Ns]|0;else{var Ts=us[Ns-3]^us[Ns-8]^us[Ns-14]^us[Ns-16];us[Ns]=Ts<<1|Ts>>>31}var Cs=(hs<<5|hs>>>27)+vs+us[Ns];Ns<20?Cs+=(ys&gs|~ys&bs)+1518500249:Ns<40?Cs+=(ys^gs^bs)+1859775393:Ns<60?Cs+=(ys&gs|ys&bs|gs&bs)-1894007588:Cs+=(ys^gs^bs)-899497514,vs=bs,bs=gs,gs=ys<<30|ys>>>2,ys=hs,hs=Cs}fs[0]=fs[0]+hs|0,fs[1]=fs[1]+ys|0,fs[2]=fs[2]+gs|0,fs[3]=fs[3]+bs|0,fs[4]=fs[4]+vs|0},_doFinalize:function(){var ps=this._data,ds=ps.words,fs=this._nDataBytes*8,hs=ps.sigBytes*8;return ds[hs>>>5]|=128<<24-hs%32,ds[(hs+64>>>9<<4)+14]=Math.floor(fs/4294967296),ds[(hs+64>>>9<<4)+15]=fs,ps.sigBytes=ds.length*4,this._process(),this._hash},clone:function(){var ps=os.clone.call(this);return ps._hash=this._hash.clone(),ps}});ns.SHA1=os._createHelper(cs),ns.HmacSHA1=os._createHmacHelper(cs)}(),rs.SHA1})})(sha1);var encBase64Exports={},encBase64={get exports(){return encBase64Exports},set exports(ss){encBase64Exports=ss}};(function(ss,ts){(function(rs,ns){ss.exports=ns(requireCore())})(commonjsGlobal,function(rs){return function(){var ns=rs,is=ns.lib,as=is.WordArray,os=ns.enc;os.Base64={stringify:function(us){var cs=us.words,ps=us.sigBytes,ds=this._map;us.clamp();for(var fs=[],hs=0;hs<ps;hs+=3)for(var ys=cs[hs>>>2]>>>24-hs%4*8&255,gs=cs[hs+1>>>2]>>>24-(hs+1)%4*8&255,bs=cs[hs+2>>>2]>>>24-(hs+2)%4*8&255,vs=ys<<16|gs<<8|bs,Ns=0;Ns<4&&hs+Ns*.75<ps;Ns++)fs.push(ds.charAt(vs>>>6*(3-Ns)&63));var Ts=ds.charAt(64);if(Ts)for(;fs.length%4;)fs.push(Ts);return fs.join("")},parse:function(us){var cs=us.length,ps=this._map,ds=this._reverseMap;if(!ds){ds=this._reverseMap=[];for(var fs=0;fs<ps.length;fs++)ds[ps.charCodeAt(fs)]=fs}var hs=ps.charAt(64);if(hs){var ys=us.indexOf(hs);ys!==-1&&(cs=ys)}return ls(us,cs,ds)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function ls(us,cs,ps){for(var ds=[],fs=0,hs=0;hs<cs;hs++)if(hs%4){var ys=ps[us.charCodeAt(hs-1)]<<hs%4*2,gs=ps[us.charCodeAt(hs)]>>>6-hs%4*2;ds[fs>>>2]|=(ys|gs)<<24-fs%4*8,fs++}return as.create(ds,fs)}}(),rs.enc.Base64})})(encBase64);let rePlus=/\+/g,reSlash=/\//g;function createUniqueName(ss,ts){let rs=encBase64Exports.stringify(sha1Exports(ts)).slice(0,10).replace(rePlus,"_").replace(reSlash,"-");return"__"+ss+"_"+rs}function getUniqueIdentifierFromBase(ss,ts){let rs=1,ns=ss+rs;for(;ts.includes(ns);)rs+=1,ns=ss+rs;return ts.push(ns),ns}function getNamespaceFromName(ss){let ts=ss.lastIndexOf("/");if(ts===-1)throw Error(`Encountered name ${ss} that doesn't include a slash`);return ss.slice(0,ts+1)}function flattenDeep(ss){return ss.reduce((ts,rs)=>Array.isArray(rs)?ts.concat(flattenDeep(rs)):ts.concat(rs),[])}function flattenLevels(ss,ts){return console.log(`levels: ${ts}`),ss.reduce((rs,ns)=>Array.isArray(ns)&&ts>1?rs.concat(flattenLevels(ns,ts-1)):rs.concat(ns),[])}class Subset{union(ts){return this.complement().intersect(ts.complement()).complement()}intersectWithOpenInterval(ts){return this.intersect(ts)}setMinus(ts){return this.intersect(ts.complement())}symmetricDifference(ts){return this.setMinus(ts).union(ts.setMinus(this))}equals(ts){return this.symmetricDifference(ts).isEmpty()}toJSON(){return{objectType:"subset",data:Object.assign({},this),subsetType:this.constructor.subsetType}}static reviver(ts,rs){if(rs&&rs.objectType==="subset"&&rs.subsetType!==void 0){if(rs.subsetType==="emptySet")return new EmptySet;if(rs.subsetType==="realLine")return new RealLine;if(rs.subsetType==="singleton")return new Singleton(rs.data.element);if(rs.subsetType==="union")return new Union(rs.data.subsets);if(rs.subsetType==="openInterval")return new OpenInterval(rs.data.left,rs.data.right)}return rs}copy(){return this.constructor.reviver(null,this.toJSON())}}const Il=class extends Subset{union(ts){return ts}intersect(){return new Il}contains(){return!1}isEmpty(){return!0}complement(){return new RealLine}toString(){return""}toMathExpression(){return Context.fromAst("")}};let EmptySet=Il;Ms(EmptySet,"subsetType","emptySet");const Vl=class extends Subset{union(){return new Vl}intersect(ts){return ts}contains(){return!0}complement(){return new EmptySet}isEmpty(){return!1}toString(){return""}toMathExpression(){return Context.fromAst("R")}};let RealLine=Vl;Ms(RealLine,"subsetType","realLine");const _l=class extends Subset{constructor(ts){if(super(),!Number.isFinite(ts))return new EmptySet;this.element=ts}union(ts){return ts.contains(this.element)?ts:new Union([ts,this])}intersect(ts){return ts.contains(this.element)?new _l(this.element):new EmptySet}isEmpty(){return!1}contains(ts){return ts===this.element}complement(){return new Union([new OpenInterval(-1/0,this.element),new OpenInterval(this.element,1/0)])}toString(){return`{${this.element}}`}toMathExpression(){return Context.fromAst(["set",this.element])}};let Singleton=_l;Ms(Singleton,"subsetType","singleton");const Ql=class extends Subset{intersect(ts){return new Ql(this.subsets.map(rs=>ts.intersect(rs)))}toString(){return this.subsets.map(ts=>ts.toString()).join(" U ")}toMathExpression(){return Context.fromAst(["union",...this.subsets.map(ts=>ts.toMathExpression().tree)])}constructor(ts){super();let rs=ts.filter(ns=>!ns.isEmpty());if(rs.length===0)return new EmptySet;rs=rs.reduce((ns,is)=>is instanceof Ql?ns.concat(is.subsets):ns.concat(is),[]),this.subsets=[];for(let ns=0;ns<rs.length;ns++){let is=rs[ns],as=!0;if(is instanceof RealLine)return new RealLine;if(is instanceof OpenInterval){let os=is.left,ls=is.right;for(let us=ns+1;us<rs.length;us++){let cs=rs[us];if(cs instanceof OpenInterval){if(os<cs.right&&cs.left<ls){os=Math.min(os,cs.left),ls=Math.max(ls,cs.right),rs.splice(us,1),us--,as=!1,ns--;break}else if(os===cs.right||ls===cs.left){let ps=os===cs.right?os:ls,ds=!1;for(let fs=0;fs<this.subsets.length;fs++){let hs=this.subsets[fs];if(hs instanceof Singleton&&hs.element===ps){this.subsets.splice(fs,1),ds=!0;break}}if(!ds)for(let fs=ns+1;fs<rs.length;fs++){let hs=rs[fs];if(hs instanceof Singleton&&hs.element===ps){rs.splice(fs,1),ds=!0;break}}if(ds){os=Math.min(os,cs.left),ls=Math.max(ls,cs.right),rs.splice(us,1),us--,as=!1,ns--;break}}}else cs.element>os&&cs.element<ls&&(rs.splice(us,1),us--)}if(is.left=os,is.right=ls,is.left===-1/0&&is.right===1/0)return new RealLine}else{let os=is.element;for(let ls=ns+1;ls<rs.length;ls++){let us=rs[ls];if(us instanceof OpenInterval){if(os>us.left&&os<us.right){rs.splice(ns,1),ns--,as=!1;break}}else us.element===os&&(rs.splice(ls,1),ls--)}}as&&this.subsets.push(is)}return this.subsets.length===1?this.subsets[0]:this}contains(ts){return this.subsets.some(rs=>rs.contains(ts))}isEmpty(){return this.subsets.every(ts=>ts.isEmpty())}complement(){return this.subsets.map(ts=>ts.complement()).reduce((ts,rs)=>ts.intersect(rs))}};let Union=Ql;Ms(Union,"subsetType","union");let Interval$1=class extends Subset{constructor(ts,rs){return super(),this.left=ts,this.right=rs,this.left<=this.right?this.left===-1/0&&this.right===1/0?new RealLine:this:new EmptySet}};const lu=class extends Interval$1{constructor(ts,rs){return super(ts,rs),ts===rs?new EmptySet:this}intersect(ts){return ts.intersectWithOpenInterval(this)}intersectWithOpenInterval(ts){return new lu(Math.max(this.left,ts.left),Math.min(this.right,ts.right))}complement(){return new Union([new OpenClosedInterval(-1/0,this.left),new ClosedOpenInterval(this.right,1/0)])}isEmpty(){return this.left>=this.right}contains(ts){return ts>this.left&&ts<this.right}toString(){return`(${this.left.toString()},${this.right.toString()})`}toMathExpression(){return Context.fromAst(["interval",["tuple",this.left,this.right],["tuple",!1,!1]])}};let OpenInterval=lu;Ms(OpenInterval,"subsetType","openInterval");class ClosedInterval extends Interval$1{constructor(ts,rs){if(super(ts,rs),!(ts<=rs))return new EmptySet;let ns=[new OpenInterval(ts,rs)];return Number.isFinite(ts)&&ns.push(new Singleton(ts)),Number.isFinite(rs)&&ns.push(new Singleton(rs)),new Union(ns)}}class OpenClosedInterval extends Interval$1{constructor(ts,rs){if(super(ts,rs),!(ts<rs))return new EmptySet;let ns=[new OpenInterval(ts,rs)];return Number.isFinite(rs)&&ns.push(new Singleton(rs)),new Union(ns)}}class ClosedOpenInterval extends Interval$1{constructor(ts,rs){if(super(ts,rs),!(ts<rs))return new EmptySet;let ns=[new OpenInterval(ts,rs)];return Number.isFinite(ts)&&ns.push(new Singleton(ts)),new Union(ns)}}const theModule={Subset,EmptySet,RealLine,Singleton,Union,Interval:Interval$1,OpenInterval,ClosedInterval,OpenClosedInterval,ClosedOpenInterval};function buildSubsetFromIntervals(ss,ts){if(!Array.isArray(ss))return Number.isFinite(ss)?new Singleton(ss):ss==="R"?new RealLine:ss==="varnothing"||ss==="emptyset"||ss===""?new EmptySet:new EmptySet;let rs=ss[0];if(rs==="interval"){let ns=ss[1],is=ss[2],as=ns[1];if(!Number.isFinite(as)&&(as=Context.fromAst(as).evaluate_to_constant(),!(Number.isFinite(as)||as===1/0||as===-1/0)))return new EmptySet;let os=ns[2];return!Number.isFinite(os)&&(os=Context.fromAst(os).evaluate_to_constant(),!(Number.isFinite(os)||os===1/0||os===-1/0))?new EmptySet:is[1]?is[2]?new ClosedInterval(as,os):new ClosedOpenInterval(as,os):is[2]?new OpenClosedInterval(as,os):new OpenInterval(as,os)}else if(rs==="union"||rs==="or"){let ns=ss.slice(1).map(is=>buildSubsetFromIntervals(is,ts)).filter(is=>is);return ns.length===0?new EmptySet:ns.length===1?ns[0]:new Union(ns)}else if(rs==="intersect"||rs==="and"){let ns=ss.slice(1).map(is=>buildSubsetFromIntervals(is,ts)).filter(is=>is);return ns.length===0?new RealLine:ns.reduce((is,as)=>is.intersect(as))}else if(rs==="set"){let ns=ss.slice(1).map(is=>buildSubsetFromIntervals(is,ts)).filter(is=>is);return ns.length===0?new EmptySet:ns.length===1?ns[0]:new Union(ns)}else if(["<","le",">","ge","=","ne"].includes(rs)){let ns=ss[1],is=!1;if(!Number.isFinite(ns)){if(deepCompare(ns,ts))is=!0;else if(ns=Context.fromAst(ns).evaluate_to_constant(),!(Number.isFinite(ns)||ns===1/0||ns===-1/0))return new EmptySet}let as=ss[2],os=!1;if(!Number.isFinite(as)){if(deepCompare(as,ts))os=!0;else if(as=Context.fromAst(as).evaluate_to_constant(),!(Number.isFinite(as)||as===1/0||as===-1/0))return new EmptySet}return is?os?new EmptySet:rs==="<"?new OpenInterval(-1/0,as):rs==="le"?new OpenClosedInterval(-1/0,as):rs===">"?new OpenInterval(as,1/0):rs==="ge"?new ClosedOpenInterval(as,1/0):rs==="="?Number.isFinite(as)?new Singleton(as):new EmptySet:Number.isFinite(as)?new Union([new OpenInterval(-1/0,as),new OpenInterval(as,1/0)]):new RealLine:os?rs==="<"?new OpenInterval(ns,1/0):rs==="le"?new ClosedOpenInterval(ns,1/0):rs===">"?new OpenInterval(-1/0,ns):rs==="ge"?new OpenClosedInterval(-1/0,ns):rs==="="?Number.isFinite(ns)?new Singleton(ns):new EmptySet:Number.isFinite(ns)?new Union([new OpenInterval(-1/0,ns),new OpenInterval(ns,1/0)]):new RealLine:new EmptySet}else if(["lts","gts"].includes(rs)){let ns=ss[1].slice(1),is=ss[2].slice(1);if(ns.length!==3||!deepCompare(ns[1],ts))return new EmptySet;rs==="gts"&&(ns.reverse(),is.reverse());let as=ns[0];if(!Number.isFinite(as)&&(as=Context.fromAst(as).evaluate_to_constant(),!(Number.isFinite(as)||as===1/0||as===-1/0)))return new EmptySet;let os=ns[2];return!Number.isFinite(os)&&(os=Context.fromAst(os).evaluate_to_constant(),!(Number.isFinite(os)||os===1/0||os===-1/0))?new EmptySet:is[0]?is[1]?new OpenInterval(as,os):new OpenClosedInterval(as,os):is[1]?new ClosedOpenInterval(as,os):new ClosedInterval(as,os)}else if(rs==="|"){let ns=ss[1];return buildSubsetFromIntervals(ss[2],ns)}else if(rs==="^"&&(ss[2]==="C"||ss[2]==="c")){let ns=buildSubsetFromIntervals(ss[1],ts);return ns?ns.complement():new EmptySet}else{if(rs==="in")return deepCompare(ss[1],ts)?buildSubsetFromIntervals(ss[2],ts):new EmptySet;if(rs==="ni")return deepCompare(ss[2],ts)?buildSubsetFromIntervals(ss[1],ts):new EmptySet;if(rs==="notin"){if(deepCompare(ss[1],ts)){let ns=buildSubsetFromIntervals(ss[2],ts);if(ns)return ns.complement()}return new EmptySet}else if(rs==="notni"){if(deepCompare(ss[2],ts)){let ns=buildSubsetFromIntervals(ss[1],ts);if(ns)return ns.complement()}return new EmptySet}else{let ns=Context.fromAst(ss).evaluate_to_constant();return Number.isFinite(ns)?new Singleton(ns):new EmptySet}}}function buildSubsetFromMathExpression(ss,ts){return buildSubsetFromIntervals(ss.to_intervals().tree,ts.tree)}function deepClone(ss,ts,rs){if(Object(ss)!==ss||ss instanceof Function||ts!==void 0&&ss instanceof ts)return ss;if(ss instanceof Context.class||ss instanceof theModule.Subset)return ss.copy();if(rs===void 0&&(rs=new WeakMap),Array.isArray(ss))return[...ss.map(is=>deepClone(is,ts,rs))];if(ss.constructor===Object&&Object.entries(ss).length===0)return{};if(rs.has(ss))return rs.get(ss);try{var ns=new ss.constructor}catch{ns=Object.create(Object.getPrototypeOf(ss))}return ss instanceof Map?Array.from(ss,([is,as])=>ns.set(deepClone(is,ts,rs),deepClone(as,ts,rs))):ss instanceof Set&&Array.from(ss,is=>ns.add(deepClone(is,ts,rs))),rs.set(ss,ns),Object.assign(ns,...Object.keys(ss).map(is=>({[is]:deepClone(ss[is],ts,rs)})))}function deepCompare(ss,ts,rs){var ns,is;function as(os,ls){var us;if(Number.isNaN(os)&&Number.isNaN(ls)||os===ls)return!0;if(rs!==void 0&&os instanceof rs&&ls instanceof rs)return os.componentName===ls.componentName;if(os instanceof Context.class&&ls instanceof Context.class)return as(os.tree,ls.tree);if(typeof os=="function"&&typeof ls=="function"||os instanceof Date&&ls instanceof Date||os instanceof RegExp&&ls instanceof RegExp||os instanceof String&&ls instanceof String||os instanceof Number&&ls instanceof Number)return os.toString()===ls.toString();if(!(os instanceof Object&&ls instanceof Object)||os.isPrototypeOf(ls)||ls.isPrototypeOf(os)||os.constructor!==ls.constructor||os.prototype!==ls.prototype||ns.indexOf(os)>-1||is.indexOf(ls)>-1)return!1;for(us in ls){if(ls.hasOwnProperty(us)!==os.hasOwnProperty(us))return!1;if(typeof ls[us]!=typeof os[us])return!1}for(us in os){if(ls.hasOwnProperty(us)!==os.hasOwnProperty(us))return!1;if(typeof ls[us]!=typeof os[us])return!1;switch(typeof os[us]){case"object":case"function":if(ns.push(os),is.push(ls),!as(os[us],ls[us]))return!1;ns.pop(),is.pop();break;default:if(os[us]!==ls[us]&&!(Number.isNaN(os[us])&&Number.isNaN(ls[us])))return!1;break}}return!0}return ns=[],is=[],as(ss,ts)}function breakStringsAndOthersIntoComponentsByStringCommas(ss){return null}function returnBreakStringsSugarFunction({childrenToComponentFunction:ss,mustStripOffOuterParentheses:ts=!1}){return function({matchedChildren:rs}){let ns=0,is=[],as=[],os=!1,ls=rs.length;if(ts){let cs=rs[0];if(typeof cs!="string"||cs.trimLeft()[0]!=="(")return{success:!1}}for(let[cs,ps]of rs.entries()){if(typeof ps!="string"){as.push(ps);continue}let ds=ps.trim();if(cs===0&&ts&&ds[0]==="("){let hs=rs[ls-1];if(typeof hs=="string"){let ys=hs.trimRight();ys[ys.length-1]===")"&&(os=!0,ds=ds.substring(1))}}let fs=0;for(let hs=0;hs<ds.length;hs++){let ys=ds[hs];if(ys==="("&&ns++,ys===")"){if(ns===0){if(os&&cs===ls-1&&hs===ds.length-1){ds=ds.substring(0,ds.length-1);break}return{success:!1}}ns--}ys===","&&ns===0&&(hs>fs&&as.push(ds.substring(fs,hs)),is.push(as),as=[],fs=hs+1)}ds.length>fs&&as.push(ds.substring(fs,ds.length))}return ns!==0?{success:!1}:(is.push(as),{success:!0,newChildren:is.map(ss)})}}function breakEmbeddedStringByCommas({childrenList:ss}){let ts=0,rs=[],ns=[];for(let is of ss){if(typeof is!="string"){ns.push(is);continue}let as=is.trim(),os=0;for(let ls=0;ls<as.length;ls++){let us=as[ls];if(us==="("&&ts++,us===")"){if(ts===0)return{success:!1};ts--}if(us===","&&ts===0){if(ls>os){let cs=as.substring(os,ls).trim();ns.push(cs)}rs.push(ns),ns=[],os=ls+1}}if(as.length>os){let ls=as.substring(os,as.length).trim();ns.push(ls)}}return ts!==0?{success:!1}:(rs.push(ns),{success:!0,pieces:rs})}function breakEmbeddedStringsIntoParensPieces({componentList:ss,removeParens:ts=!1}){let rs=0,ns=[],is=[];for(let as of ss){if(typeof as!="string"){rs===0?ns.push([as]):is.push(as);continue}let os=as.trim(),ls=0;for(let us=0;us<os.length;us++){let cs=os[us];if(cs==="(")rs===0&&ts&&(ls=us+1),rs++;else if(cs===")"){if(rs===0)return{success:!1};if(rs===1){if(us+1>ls){let ps=ts?us:us+1,ds=os.substring(ls,ps).trim();ds.length>0&&is.push(ds)}ns.push(is),is=[],ls=us+1}rs--}else if(rs===0&&!cs.match(/\s/))return{success:!1}}if(os.length>ls){let us=os.substring(ls,os.length).trim();is.push(us)}}return rs!==0?{success:!1}:(is.length>0&&ns.push(is),{success:!0,pieces:ns})}function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;typeof global$2.setTimeout=="function"&&(cachedSetTimeout=setTimeout),typeof global$2.clearTimeout=="function"&&(cachedClearTimeout=clearTimeout);function runTimeout(ss){if(cachedSetTimeout===setTimeout)return setTimeout(ss,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(ss,0);try{return cachedSetTimeout(ss,0)}catch{try{return cachedSetTimeout.call(null,ss,0)}catch{return cachedSetTimeout.call(this,ss,0)}}}function runClearTimeout(ss){if(cachedClearTimeout===clearTimeout)return clearTimeout(ss);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(ss);try{return cachedClearTimeout(ss)}catch{try{return cachedClearTimeout.call(null,ss)}catch{return cachedClearTimeout.call(this,ss)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var ss=runTimeout(cleanUpNextTick);draining=!0;for(var ts=queue.length;ts;){for(currentQueue=queue,queue=[];++queueIndex<ts;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,ts=queue.length}currentQueue=null,draining=!1,runClearTimeout(ss)}}function nextTick(ss){var ts=new Array(arguments.length-1);if(arguments.length>1)for(var rs=1;rs<arguments.length;rs++)ts[rs-1]=arguments[rs];queue.push(new Item(ss,ts)),queue.length===1&&!draining&&runTimeout(drainQueue)}function Item(ss,ts){this.fun=ss,this.array=ts}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on$1=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(ss){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(ss){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$2.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return new Date().getTime()};function hrtime(ss){var ts=performanceNow.call(performance)*.001,rs=Math.floor(ts),ns=Math.floor(ts%1*1e9);return ss&&(rs=rs-ss[0],ns=ns-ss[1],ns<0&&(rs--,ns+=1e9)),[rs,ns]}var startTime=new Date;function uptime(){var ss=new Date,ts=ss-startTime;return ts/1e3}var browser$1={nextTick,title,browser,env,argv,version,versions,on:on$1,addListener,once,off,removeListener,removeAllListeners,emit,binding,cwd,chdir,umask,hrtime,platform,release,config,uptime};const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(ts,rs){this.from=ts,this.to=rs}}class NodeProp{constructor(ts={}){this.id=nextPropID++,this.perNode=!!ts.perNode,this.deserialize=ts.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(ts){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof ts!="function"&&(ts=NodeType.match(ts)),rs=>{let ns=ts(rs);return ns===void 0?null:[this,ns]}}}NodeProp.closedBy=new NodeProp({deserialize:ss=>ss.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:ss=>ss.split(" ")}),NodeProp.group=new NodeProp({deserialize:ss=>ss.split(" ")}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(ts,rs,ns,is=0){this.name=ts,this.props=rs,this.id=ns,this.flags=is}static define(ts){let rs=ts.props&&ts.props.length?Object.create(null):noProps,ns=(ts.top?1:0)|(ts.skipped?2:0)|(ts.error?4:0)|(ts.name==null?8:0),is=new NodeType(ts.name||"",rs,ts.id,ns);if(ts.props){for(let as of ts.props)if(Array.isArray(as)||(as=as(is)),as){if(as[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");rs[as[0].id]=as[1]}}return is}prop(ts){return this.props[ts.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(ts){if(typeof ts=="string"){if(this.name==ts)return!0;let rs=this.prop(NodeProp.group);return rs?rs.indexOf(ts)>-1:!1}return this.id==ts}static match(ts){let rs=Object.create(null);for(let ns in ts)for(let is of ns.split(" "))rs[is]=ts[ns];return ns=>{for(let is=ns.prop(NodeProp.group),as=-1;as<(is?is.length:0);as++){let os=rs[as<0?ns.name:is[as]];if(os)return os}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(ts){this.types=ts;for(let rs=0;rs<ts.length;rs++)if(ts[rs].id!=rs)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...ts){let rs=[];for(let ns of this.types){let is=null;for(let as of ts){let os=as(ns);os&&(is||(is=Object.assign({},ns.props)),is[os[0].id]=os[1])}rs.push(is?new NodeType(ns.name,is,ns.id,ns.flags):ns)}return new NodeSet(rs)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;class Tree{constructor(ts,rs,ns,is,as){if(this.type=ts,this.children=rs,this.positions=ns,this.length=is,this.props=null,as&&as.length){this.props=Object.create(null);for(let[os,ls]of as)this.props[typeof os=="number"?os:os.id]=ls}}toString(){let ts=this.prop(NodeProp.mounted);if(ts&&!ts.overlay)return ts.tree.toString();let rs="";for(let ns of this.children){let is=ns.toString();is&&(rs&&(rs+=","),rs+=is)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(rs.length?"("+rs+")":""):rs}cursor(ts,rs=0){let ns=ts!=null&&CachedNode.get(this)||this.topNode,is=new TreeCursor(ns);return ts!=null&&(is.moveTo(ts,rs),CachedNode.set(this,is._tree)),is}fullCursor(){return new TreeCursor(this.topNode,1)}get topNode(){return new TreeNode(this,0,0,null)}resolve(ts,rs=0){let ns=resolveNode(CachedNode.get(this)||this.topNode,ts,rs,!1);return CachedNode.set(this,ns),ns}resolveInner(ts,rs=0){let ns=resolveNode(CachedInnerNode.get(this)||this.topNode,ts,rs,!0);return CachedInnerNode.set(this,ns),ns}iterate(ts){let{enter:rs,leave:ns,from:is=0,to:as=this.length}=ts;for(let os=this.cursor(),ls=()=>os.node;;){let us=!1;if(os.from<=as&&os.to>=is&&(os.type.isAnonymous||rs(os.type,os.from,os.to,ls)!==!1)){if(os.firstChild())continue;os.type.isAnonymous||(us=!0)}for(;us&&ns&&ns(os.type,os.from,os.to,ls),us=os.type.isAnonymous,!os.nextSibling();){if(!os.parent())return;us=!0}}}prop(ts){return ts.perNode?this.props?this.props[ts.id]:void 0:this.type.prop(ts)}get propValues(){let ts=[];if(this.props)for(let rs in this.props)ts.push([+rs,this.props[rs]]);return ts}balance(ts={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(rs,ns,is)=>new Tree(this.type,rs,ns,is,this.propValues),ts.makeTree||((rs,ns,is)=>new Tree(NodeType.none,rs,ns,is)))}static build(ts){return buildTree(ts)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(ts,rs){this.buffer=ts,this.index=rs}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(ts,rs,ns){this.buffer=ts,this.length=rs,this.set=ns}get type(){return NodeType.none}toString(){let ts=[];for(let rs=0;rs<this.buffer.length;)ts.push(this.childString(rs)),rs=this.buffer[rs+3];return ts.join(",")}childString(ts){let rs=this.buffer[ts],ns=this.buffer[ts+3],is=this.set.types[rs],as=is.name;if(/\W/.test(as)&&!is.isError&&(as=JSON.stringify(as)),ts+=4,ns==ts)return as;let os=[];for(;ts<ns;)os.push(this.childString(ts)),ts=this.buffer[ts+3];return as+"("+os.join(",")+")"}findChild(ts,rs,ns,is,as){let{buffer:os}=this,ls=-1;for(let us=ts;us!=rs&&!(checkSide(as,is,os[us+1],os[us+2])&&(ls=us,ns>0));us=os[us+3]);return ls}slice(ts,rs,ns,is){let as=this.buffer,os=new Uint16Array(rs-ts);for(let ls=ts,us=0;ls<rs;)os[us++]=as[ls++],os[us++]=as[ls++]-ns,os[us++]=as[ls++]-ns,os[us++]=as[ls++]-ts;return new TreeBuffer(os,is-ns,this.set)}}function checkSide(ss,ts,rs,ns){switch(ss){case-2:return rs<ts;case-1:return ns>=ts&&rs<ts;case 0:return rs<ts&&ns>ts;case 1:return rs<=ts&&ns>ts;case 2:return ns>ts;case 4:return!0}}function enterUnfinishedNodesBefore(ss,ts){let rs=ss.childBefore(ts);for(;rs;){let ns=rs.lastChild;if(!ns||ns.to!=rs.to)break;ns.type.isError&&ns.from==ns.to?(ss=rs,rs=ns.prevSibling):rs=ns}return ss}function resolveNode(ss,ts,rs,ns){for(var is;ss.from==ss.to||(rs<1?ss.from>=ts:ss.from>ts)||(rs>-1?ss.to<=ts:ss.to<ts);){let as=!ns&&ss instanceof TreeNode&&ss.index<0?null:ss.parent;if(!as)return ss;ss=as}if(ns)for(let as=ss,os=as.parent;os;as=os,os=as.parent)as instanceof TreeNode&&as.index<0&&((is=os.enter(ts,rs,!0))===null||is===void 0?void 0:is.from)!=as.from&&(ss=os);for(;;){let as=ss.enter(ts,rs,ns);if(!as)return ss;ss=as}}class TreeNode{constructor(ts,rs,ns,is){this.node=ts,this._from=rs,this.index=ns,this._parent=is}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(ts,rs,ns,is,as=0){for(let os=this;;){for(let{children:ls,positions:us}=os.node,cs=rs>0?ls.length:-1;ts!=cs;ts+=rs){let ps=ls[ts],ds=us[ts]+os._from;if(checkSide(is,ns,ds,ds+ps.length)){if(ps instanceof TreeBuffer){if(as&2)continue;let fs=ps.findChild(0,ps.buffer.length,rs,ns-ds,is);if(fs>-1)return new BufferNode(new BufferContext(os,ps,ts,ds),null,fs)}else if(as&1||!ps.type.isAnonymous||hasChild(ps)){let fs;if(!(as&1)&&ps.props&&(fs=ps.prop(NodeProp.mounted))&&!fs.overlay)return new TreeNode(fs.tree,ds,ts,os);let hs=new TreeNode(ps,ds,ts,os);return as&1||!hs.type.isAnonymous?hs:hs.nextChild(rs<0?ps.children.length-1:0,rs,ns,is)}}}if(as&1||!os.type.isAnonymous||(os.index>=0?ts=os.index+rs:ts=rs<0?-1:os._parent.node.children.length,os=os._parent,!os))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(ts){return this.nextChild(0,1,ts,2)}childBefore(ts){return this.nextChild(this.node.children.length-1,-1,ts,-2)}enter(ts,rs,ns=!0,is=!0){let as;if(ns&&(as=this.node.prop(NodeProp.mounted))&&as.overlay){let os=ts-this.from;for(let{from:ls,to:us}of as.overlay)if((rs>0?ls<=os:ls<os)&&(rs<0?us>=os:us>os))return new TreeNode(as.tree,as.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,ts,rs,is?0:2)}nextSignificantParent(){let ts=this;for(;ts.type.isAnonymous&&ts._parent;)ts=ts._parent;return ts}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new TreeCursor(this)}get tree(){return this.node}toTree(){return this.node}resolve(ts,rs=0){return resolveNode(this,ts,rs,!1)}resolveInner(ts,rs=0){return resolveNode(this,ts,rs,!0)}enterUnfinishedNodesBefore(ts){return enterUnfinishedNodesBefore(this,ts)}getChild(ts,rs=null,ns=null){let is=getChildren(this,ts,rs,ns);return is.length?is[0]:null}getChildren(ts,rs=null,ns=null){return getChildren(this,ts,rs,ns)}toString(){return this.node.toString()}}function getChildren(ss,ts,rs,ns){let is=ss.cursor,as=[];if(!is.firstChild())return as;if(rs!=null){for(;!is.type.is(rs);)if(!is.nextSibling())return as}for(;;){if(ns!=null&&is.type.is(ns))return as;if(is.type.is(ts)&&as.push(is.node),!is.nextSibling())return ns==null?as:[]}}class BufferContext{constructor(ts,rs,ns,is){this.parent=ts,this.buffer=rs,this.index=ns,this.start=is}}class BufferNode{constructor(ts,rs,ns){this.context=ts,this._parent=rs,this.index=ns,this.type=ts.buffer.set.types[ts.buffer.buffer[ns]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(ts,rs,ns){let{buffer:is}=this.context,as=is.findChild(this.index+4,is.buffer[this.index+3],ts,rs-this.context.start,ns);return as<0?null:new BufferNode(this.context,this,as)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(ts){return this.child(1,ts,2)}childBefore(ts){return this.child(-1,ts,-2)}enter(ts,rs,ns,is=!0){if(!is)return null;let{buffer:as}=this.context,os=as.findChild(this.index+4,as.buffer[this.index+3],rs>0?1:-1,ts-this.context.start,rs);return os<0?null:new BufferNode(this.context,this,os)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(ts){return this._parent?null:this.context.parent.nextChild(this.context.index+ts,ts,0,4)}get nextSibling(){let{buffer:ts}=this.context,rs=ts.buffer[this.index+3];return rs<(this._parent?ts.buffer[this._parent.index+3]:ts.buffer.length)?new BufferNode(this.context,this._parent,rs):this.externalSibling(1)}get prevSibling(){let{buffer:ts}=this.context,rs=this._parent?this._parent.index+4:0;return this.index==rs?this.externalSibling(-1):new BufferNode(this.context,this._parent,ts.findChild(rs,this.index,-1,0,4))}get cursor(){return new TreeCursor(this)}get tree(){return null}toTree(){let ts=[],rs=[],{buffer:ns}=this.context,is=this.index+4,as=ns.buffer[this.index+3];if(as>is){let os=ns.buffer[this.index+1],ls=ns.buffer[this.index+2];ts.push(ns.slice(is,as,os,ls)),rs.push(0)}return new Tree(this.type,ts,rs,this.to-this.from)}resolve(ts,rs=0){return resolveNode(this,ts,rs,!1)}resolveInner(ts,rs=0){return resolveNode(this,ts,rs,!0)}enterUnfinishedNodesBefore(ts){return enterUnfinishedNodesBefore(this,ts)}toString(){return this.context.buffer.childString(this.index)}getChild(ts,rs=null,ns=null){let is=getChildren(this,ts,rs,ns);return is.length?is[0]:null}getChildren(ts,rs=null,ns=null){return getChildren(this,ts,rs,ns)}}class TreeCursor{constructor(ts,rs=0){if(this.mode=rs,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,ts instanceof TreeNode)this.yieldNode(ts);else{this._tree=ts.context.parent,this.buffer=ts.context;for(let ns=ts._parent;ns;ns=ns._parent)this.stack.unshift(ns.index);this.bufferNode=ts,this.yieldBuf(ts.index)}}get name(){return this.type.name}yieldNode(ts){return ts?(this._tree=ts,this.type=ts.type,this.from=ts.from,this.to=ts.to,!0):!1}yieldBuf(ts,rs){this.index=ts;let{start:ns,buffer:is}=this.buffer;return this.type=rs||is.set.types[is.buffer[ts]],this.from=ns+is.buffer[ts+1],this.to=ns+is.buffer[ts+2],!0}yield(ts){return ts?ts instanceof TreeNode?(this.buffer=null,this.yieldNode(ts)):(this.buffer=ts.context,this.yieldBuf(ts.index,ts.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(ts,rs,ns){if(!this.buffer)return this.yield(this._tree.nextChild(ts<0?this._tree.node.children.length-1:0,ts,rs,ns,this.mode));let{buffer:is}=this.buffer,as=is.findChild(this.index+4,is.buffer[this.index+3],ts,rs-this.buffer.start,ns);return as<0?!1:(this.stack.push(this.index),this.yieldBuf(as))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(ts){return this.enterChild(1,ts,2)}childBefore(ts){return this.enterChild(-1,ts,-2)}enter(ts,rs,ns=!0,is=!0){return this.buffer?is?this.enterChild(1,ts,rs):!1:this.yield(this._tree.enter(ts,rs,ns&&!(this.mode&1),is))}parent(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let ts=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(ts)}sibling(ts){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+ts,ts,0,4,this.mode)):!1;let{buffer:rs}=this.buffer,ns=this.stack.length-1;if(ts<0){let is=ns<0?0:this.stack[ns]+4;if(this.index!=is)return this.yieldBuf(rs.findChild(is,this.index,-1,0,4))}else{let is=rs.buffer[this.index+3];if(is<(ns<0?rs.buffer.length:rs.buffer[this.stack[ns]+3]))return this.yieldBuf(is)}return ns<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+ts,ts,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(ts){let rs,ns,{buffer:is}=this;if(is){if(ts>0){if(this.index<is.buffer.buffer.length)return!1}else for(let as=0;as<this.index;as++)if(is.buffer.buffer[as+3]<this.index)return!1;({index:rs,parent:ns}=is)}else({index:rs,_parent:ns}=this._tree);for(;ns;{index:rs,_parent:ns}=ns)if(rs>-1)for(let as=rs+ts,os=ts<0?-1:ns.node.children.length;as!=os;as+=ts){let ls=ns.node.children[as];if(this.mode&1||ls instanceof TreeBuffer||!ls.type.isAnonymous||hasChild(ls))return!1}return!0}move(ts,rs){if(rs&&this.enterChild(ts,0,4))return!0;for(;;){if(this.sibling(ts))return!0;if(this.atLastNode(ts)||!this.parent())return!1}}next(ts=!0){return this.move(1,ts)}prev(ts=!0){return this.move(-1,ts)}moveTo(ts,rs=0){for(;(this.from==this.to||(rs<1?this.from>=ts:this.from>ts)||(rs>-1?this.to<=ts:this.to<ts))&&this.parent(););for(;this.enterChild(1,ts,rs););return this}get node(){if(!this.buffer)return this._tree;let ts=this.bufferNode,rs=null,ns=0;if(ts&&ts.context==this.buffer)e:for(let is=this.index,as=this.stack.length;as>=0;){for(let os=ts;os;os=os._parent)if(os.index==is){if(is==this.index)return os;rs=os,ns=as+1;break e}is=this.stack[--as]}for(let is=ns;is<this.stack.length;is++)rs=new BufferNode(this.buffer,rs,this.stack[is]);return this.bufferNode=new BufferNode(this.buffer,rs,this.index)}get tree(){return this.buffer?null:this._tree.node}}function hasChild(ss){return ss.children.some(ts=>ts instanceof TreeBuffer||!ts.type.isAnonymous||hasChild(ts))}function buildTree(ss){var ts;let{buffer:rs,nodeSet:ns,maxBufferLength:is=DefaultBufferLength,reused:as=[],minRepeatType:os=ns.types.length}=ss,ls=Array.isArray(rs)?new FlatBufferCursor(rs,rs.length):rs,us=ns.types,cs=0,ps=0;function ds(Cs,xs,As,ws,Es){let{id:Ss,start:Ds,end:Vs,size:Is}=ls,Os=ps;for(;Is<0;)if(ls.next(),Is==-1){let _s=as[Ss];As.push(_s),ws.push(Ds-Cs);return}else if(Is==-3){cs=Ss;return}else if(Is==-4){ps=Ss;return}else throw new RangeError(`Unrecognized record size: ${Is}`);let Ps=us[Ss],$s,Rs,ks=Ds-Cs;if(Vs-Ds<=is&&(Rs=gs(ls.pos-xs,Es))){let _s=new Uint16Array(Rs.size-Rs.skip),Bs=ls.pos-Rs.size,Us=_s.length;for(;ls.pos>Bs;)Us=bs(Rs.start,_s,Us);$s=new TreeBuffer(_s,Vs-Rs.start,ns),ks=Rs.start-Cs}else{let _s=ls.pos-Is;ls.next();let Bs=[],Us=[],zs=Ss>=os?Ss:-1,Hs=0,el=Vs;for(;ls.pos>_s;)zs>=0&&ls.id==zs&&ls.size>=0?(ls.end<=el-is&&(hs(Bs,Us,Ds,Hs,ls.end,el,zs,Os),Hs=Bs.length,el=ls.end),ls.next()):ds(Ds,_s,Bs,Us,zs);if(zs>=0&&Hs>0&&Hs<Bs.length&&hs(Bs,Us,Ds,Hs,Ds,el,zs,Os),Bs.reverse(),Us.reverse(),zs>-1&&Hs>0){let Ys=fs(Ps);$s=balanceRange(Ps,Bs,Us,0,Bs.length,0,Vs-Ds,Ys,Ys)}else $s=ys(Ps,Bs,Us,Vs-Ds,Os-Vs)}As.push($s),ws.push(ks)}function fs(Cs){return(xs,As,ws)=>{let Es=0,Ss=xs.length-1,Ds,Vs;if(Ss>=0&&(Ds=xs[Ss])instanceof Tree){if(!Ss&&Ds.type==Cs&&Ds.length==ws)return Ds;(Vs=Ds.prop(NodeProp.lookAhead))&&(Es=As[Ss]+Ds.length+Vs)}return ys(Cs,xs,As,ws,Es)}}function hs(Cs,xs,As,ws,Es,Ss,Ds,Vs){let Is=[],Os=[];for(;Cs.length>ws;)Is.push(Cs.pop()),Os.push(xs.pop()+As-Es);Cs.push(ys(ns.types[Ds],Is,Os,Ss-Es,Vs-Ss)),xs.push(Es-As)}function ys(Cs,xs,As,ws,Es=0,Ss){if(cs){let Ds=[NodeProp.contextHash,cs];Ss=Ss?[Ds].concat(Ss):[Ds]}if(Es>25){let Ds=[NodeProp.lookAhead,Es];Ss=Ss?[Ds].concat(Ss):[Ds]}return new Tree(Cs,xs,As,ws,Ss)}function gs(Cs,xs){let As=ls.fork(),ws=0,Es=0,Ss=0,Ds=As.end-is,Vs={size:0,start:0,skip:0};e:for(let Is=As.pos-Cs;As.pos>Is;){let Os=As.size;if(As.id==xs&&Os>=0){Vs.size=ws,Vs.start=Es,Vs.skip=Ss,Ss+=4,ws+=4,As.next();continue}let Ps=As.pos-Os;if(Os<0||Ps<Is||As.start<Ds)break;let $s=As.id>=os?4:0,Rs=As.start;for(As.next();As.pos>Ps;){if(As.size<0)if(As.size==-3)$s+=4;else break e;else As.id>=os&&($s+=4);As.next()}Es=Rs,ws+=Os,Ss+=$s}return(xs<0||ws==Cs)&&(Vs.size=ws,Vs.start=Es,Vs.skip=Ss),Vs.size>4?Vs:void 0}function bs(Cs,xs,As){let{id:ws,start:Es,end:Ss,size:Ds}=ls;if(ls.next(),Ds>=0&&ws<os){let Vs=As;if(Ds>4){let Is=ls.pos-(Ds-4);for(;ls.pos>Is;)As=bs(Cs,xs,As)}xs[--As]=Vs,xs[--As]=Ss-Cs,xs[--As]=Es-Cs,xs[--As]=ws}else Ds==-3?cs=ws:Ds==-4&&(ps=ws);return As}let vs=[],Ns=[];for(;ls.pos>0;)ds(ss.start||0,ss.bufferStart||0,vs,Ns,-1);let Ts=(ts=ss.length)!==null&&ts!==void 0?ts:vs.length?Ns[0]+vs[0].length:0;return new Tree(us[ss.topID],vs.reverse(),Ns.reverse(),Ts)}const nodeSizeCache=new WeakMap;function nodeSize(ss,ts){if(!ss.isAnonymous||ts instanceof TreeBuffer||ts.type!=ss)return 1;let rs=nodeSizeCache.get(ts);if(rs==null){rs=1;for(let ns of ts.children){if(ns.type!=ss||!(ns instanceof Tree)){rs=1;break}rs+=nodeSize(ss,ns)}nodeSizeCache.set(ts,rs)}return rs}function balanceRange(ss,ts,rs,ns,is,as,os,ls,us){let cs=0;for(let ys=ns;ys<is;ys++)cs+=nodeSize(ss,ts[ys]);let ps=Math.ceil(cs*1.5/8),ds=[],fs=[];function hs(ys,gs,bs,vs,Ns){for(let Ts=bs;Ts<vs;){let Cs=Ts,xs=gs[Ts],As=nodeSize(ss,ys[Ts]);for(Ts++;Ts<vs;Ts++){let ws=nodeSize(ss,ys[Ts]);if(As+ws>=ps)break;As+=ws}if(Ts==Cs+1){if(As>ps){let ws=ys[Cs];hs(ws.children,ws.positions,0,ws.children.length,gs[Cs]+Ns);continue}ds.push(ys[Cs])}else{let ws=gs[Ts-1]+ys[Ts-1].length-xs;ds.push(balanceRange(ss,ys,gs,Cs,Ts,xs,ws,null,us))}fs.push(xs+Ns-as)}}return hs(ts,rs,ns,is,0),(ls||us)(ds,fs,os)}let Parser$1=class{startParse(ts,rs,ns){return typeof ts=="string"&&(ts=new StringInput(ts)),ns=ns?ns.length?ns.map(is=>new Range(is.from,is.to)):[new Range(0,0)]:[new Range(0,ts.length)],this.createParse(ts,rs||[],ns)}parse(ts,rs,ns){let is=this.startParse(ts,rs,ns);for(;;){let as=is.advance();if(as)return as}}};class StringInput{constructor(ts){this.string=ts}get length(){return this.string.length}chunk(ts){return this.string.slice(ts)}get lineChunks(){return!1}read(ts,rs){return this.string.slice(ts,rs)}}new NodeProp({perNode:!0});let Stack$1=class fu{constructor(ts,rs,ns,is,as,os,ls,us,cs,ps=0,ds){this.p=ts,this.stack=rs,this.state=ns,this.reducePos=is,this.pos=as,this.score=os,this.buffer=ls,this.bufferBase=us,this.curContext=cs,this.lookAhead=ps,this.parent=ds}toString(){return`[${this.stack.filter((ts,rs)=>rs%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(ts,rs,ns=0){let is=ts.parser.context;return new fu(ts,[],rs,ns,ns,0,[],0,is?new StackContext(is,is.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(ts,rs){this.stack.push(this.state,rs,this.bufferBase+this.buffer.length),this.state=ts}reduce(ts){let rs=ts>>19,ns=ts&65535,{parser:is}=this.p,as=is.dynamicPrecedence(ns);if(as&&(this.score+=as),rs==0){this.pushState(is.getGoto(this.state,ns,!0),this.reducePos),ns<is.minRepeatTerm&&this.storeNode(ns,this.reducePos,this.reducePos,4,!0),this.reduceContext(ns,this.reducePos);return}let os=this.stack.length-(rs-1)*3-(ts&262144?6:0),ls=this.stack[os-2],us=this.stack[os-1],cs=this.bufferBase+this.buffer.length-us;if(ns<is.minRepeatTerm||ts&131072){let ps=is.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(ns,ls,ps,cs+4,!0)}if(ts&262144)this.state=this.stack[os];else{let ps=this.stack[os-3];this.state=is.getGoto(ps,ns,!0)}for(;this.stack.length>os;)this.stack.pop();this.reduceContext(ns,ls)}storeNode(ts,rs,ns,is=4,as=!1){if(ts==0){let os=this,ls=this.buffer.length;if(ls==0&&os.parent&&(ls=os.bufferBase-os.parent.bufferBase,os=os.parent),ls>0&&os.buffer[ls-4]==0&&os.buffer[ls-1]>-1){if(rs==ns)return;if(os.buffer[ls-2]>=rs){os.buffer[ls-2]=ns;return}}}if(!as||this.pos==ns)this.buffer.push(ts,rs,ns,is);else{let os=this.buffer.length;if(os>0&&this.buffer[os-4]!=0)for(;os>0&&this.buffer[os-2]>ns;)this.buffer[os]=this.buffer[os-4],this.buffer[os+1]=this.buffer[os-3],this.buffer[os+2]=this.buffer[os-2],this.buffer[os+3]=this.buffer[os-1],os-=4,is>4&&(is-=4);this.buffer[os]=ts,this.buffer[os+1]=rs,this.buffer[os+2]=ns,this.buffer[os+3]=is}}shift(ts,rs,ns){let is=this.pos;if(ts&131072)this.pushState(ts&65535,this.pos);else if(ts&262144)this.pos=ns,this.shiftContext(rs,is),rs<=this.p.parser.maxNode&&this.buffer.push(rs,is,ns,4);else{let as=ts,{parser:os}=this.p;(ns>this.pos||rs<=os.maxNode)&&(this.pos=ns,os.stateFlag(as,1)||(this.reducePos=ns)),this.pushState(as,is),this.shiftContext(rs,is),rs<=os.maxNode&&this.buffer.push(rs,is,ns,4)}}apply(ts,rs,ns){ts&65536?this.reduce(ts):this.shift(ts,rs,ns)}useNode(ts,rs){let ns=this.p.reused.length-1;(ns<0||this.p.reused[ns]!=ts)&&(this.p.reused.push(ts),ns++);let is=this.pos;this.reducePos=this.pos=is+ts.length,this.pushState(rs,is),this.buffer.push(ns,is,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,ts,this,this.p.stream.reset(this.pos-ts.length)))}split(){let ts=this,rs=ts.buffer.length;for(;rs>0&&ts.buffer[rs-2]>ts.reducePos;)rs-=4;let ns=ts.buffer.slice(rs),is=ts.bufferBase+rs;for(;ts&&is==ts.bufferBase;)ts=ts.parent;return new fu(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,ns,is,this.curContext,this.lookAhead,ts)}recoverByDelete(ts,rs){let ns=ts<=this.p.parser.maxNode;ns&&this.storeNode(ts,this.pos,rs,4),this.storeNode(0,this.pos,rs,ns?8:4),this.pos=this.reducePos=rs,this.score-=190}canShift(ts){for(let rs=new SimulatedStack(this);;){let ns=this.p.parser.stateSlot(rs.state,4)||this.p.parser.hasAction(rs.state,ts);if(!(ns&65536))return!0;if(ns==0)return!1;rs.reduce(ns)}}recoverByInsert(ts){if(this.stack.length>=300)return[];let rs=this.p.parser.nextStates(this.state);if(rs.length>4<<1||this.stack.length>=120){let is=[];for(let as=0,os;as<rs.length;as+=2)(os=rs[as+1])!=this.state&&this.p.parser.hasAction(os,ts)&&is.push(rs[as],os);if(this.stack.length<120)for(let as=0;is.length<4<<1&&as<rs.length;as+=2){let os=rs[as+1];is.some((ls,us)=>us&1&&ls==os)||is.push(rs[as],os)}rs=is}let ns=[];for(let is=0;is<rs.length&&ns.length<4;is+=2){let as=rs[is+1];if(as==this.state)continue;let os=this.split();os.storeNode(0,os.pos,os.pos,4,!0),os.pushState(as,this.pos),os.shiftContext(rs[is],this.pos),os.score-=200,ns.push(os)}return ns}forceReduce(){let ts=this.p.parser.stateSlot(this.state,5);if(!(ts&65536))return!1;let{parser:rs}=this.p;if(!rs.validAction(this.state,ts)){let ns=ts>>19,is=ts&65535,as=this.stack.length-ns*3;if(as<0||rs.getGoto(this.stack[as],is,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reduce(ts),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:ts}=this.p;return ts.data[ts.stateSlot(this.state,1)]==65535&&!ts.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(ts){if(this.state!=ts.state||this.stack.length!=ts.stack.length)return!1;for(let rs=0;rs<this.stack.length;rs+=3)if(this.stack[rs]!=ts.stack[rs])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(ts){return this.p.parser.dialect.flags[ts]}shiftContext(ts,rs){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,ts,this,this.p.stream.reset(rs)))}reduceContext(ts,rs){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,ts,this,this.p.stream.reset(rs)))}emitContext(){let ts=this.buffer.length-1;(ts<0||this.buffer[ts]!=-3)&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let ts=this.buffer.length-1;(ts<0||this.buffer[ts]!=-4)&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(ts){if(ts!=this.curContext.context){let rs=new StackContext(this.curContext.tracker,ts);rs.hash!=this.curContext.hash&&this.emitContext(),this.curContext=rs}}setLookAhead(ts){ts>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=ts)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}};class StackContext{constructor(ts,rs){this.tracker=ts,this.context=rs,this.hash=ts.strict?ts.hash(rs):0}}var Recover;(function(ss){ss[ss.Insert=200]="Insert",ss[ss.Delete=190]="Delete",ss[ss.Reduce=100]="Reduce",ss[ss.MaxNext=4]="MaxNext",ss[ss.MaxInsertStackDepth=300]="MaxInsertStackDepth",ss[ss.DampenInsertStackDepth=120]="DampenInsertStackDepth"})(Recover||(Recover={}));class SimulatedStack{constructor(ts){this.start=ts,this.state=ts.state,this.stack=ts.stack,this.base=this.stack.length}reduce(ts){let rs=ts&65535,ns=ts>>19;ns==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(ns-1)*3;let is=this.start.p.parser.getGoto(this.stack[this.base-3],rs,!0);this.state=is}}class StackBufferCursor{constructor(ts,rs,ns){this.stack=ts,this.pos=rs,this.index=ns,this.buffer=ts.buffer,this.index==0&&this.maybeNext()}static create(ts,rs=ts.bufferBase+ts.buffer.length){return new StackBufferCursor(ts,rs,rs-ts.bufferBase)}maybeNext(){let ts=this.stack.parent;ts!=null&&(this.index=this.stack.bufferBase-ts.bufferBase,this.stack=ts,this.buffer=ts.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(ts,rs){this.input=ts,this.ranges=rs,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=rs[0].from,this.range=rs[0],this.end=rs[rs.length-1].to,this.readNext()}resolveOffset(ts,rs){let ns=this.range,is=this.rangeIndex,as=this.pos+ts;for(;as<ns.from;){if(!is)return null;let os=this.ranges[--is];as-=ns.from-os.to,ns=os}for(;rs<0?as>ns.to:as>=ns.to;){if(is==this.ranges.length-1)return null;let os=this.ranges[++is];as+=os.from-ns.to,ns=os}return as}peek(ts){let rs=this.chunkOff+ts,ns,is;if(rs>=0&&rs<this.chunk.length)ns=this.pos+ts,is=this.chunk.charCodeAt(rs);else{let as=this.resolveOffset(ts,1);if(as==null)return-1;if(ns=as,ns>=this.chunk2Pos&&ns<this.chunk2Pos+this.chunk2.length)is=this.chunk2.charCodeAt(ns-this.chunk2Pos);else{let os=this.rangeIndex,ls=this.range;for(;ls.to<=ns;)ls=this.ranges[++os];this.chunk2=this.input.chunk(this.chunk2Pos=ns),ns+this.chunk2.length>ls.to&&(this.chunk2=this.chunk2.slice(0,ls.to-ns)),is=this.chunk2.charCodeAt(0)}}return ns>=this.token.lookAhead&&(this.token.lookAhead=ns+1),is}acceptToken(ts,rs=0){let ns=rs?this.resolveOffset(rs,-1):this.pos;if(ns==null||ns<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=ts,this.token.end=ns}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:ts,chunkPos:rs}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=ts,this.chunk2Pos=rs,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let ts=this.input.chunk(this.pos),rs=this.pos+ts.length;this.chunk=rs>this.range.to?ts.slice(0,this.range.to-this.pos):ts,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(ts=1){for(this.chunkOff+=ts;this.pos+ts>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();ts-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=ts,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(ts,rs){if(rs?(this.token=rs,rs.start=ts,rs.lookAhead=ts+1,rs.value=rs.extended=-1):this.token=nullToken,this.pos!=ts){if(this.pos=ts,ts==this.end)return this.setDone(),this;for(;ts<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;ts>=this.range.to;)this.range=this.ranges[++this.rangeIndex];ts>=this.chunkPos&&ts<this.chunkPos+this.chunk.length?this.chunkOff=ts-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(ts,rs){if(ts>=this.chunkPos&&rs<=this.chunkPos+this.chunk.length)return this.chunk.slice(ts-this.chunkPos,rs-this.chunkPos);if(ts>=this.chunk2Pos&&rs<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(ts-this.chunk2Pos,rs-this.chunk2Pos);if(ts>=this.range.from&&rs<=this.range.to)return this.input.read(ts,rs);let ns="";for(let is of this.ranges){if(is.from>=rs)break;is.to>ts&&(ns+=this.input.read(Math.max(is.from,ts),Math.min(is.to,rs)))}return ns}}class TokenGroup{constructor(ts,rs){this.data=ts,this.id=rs}token(ts,rs){readToken(this.data,ts,rs,this.id)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;class ExternalTokenizer{constructor(ts,rs={}){this.token=ts,this.contextual=!!rs.contextual,this.fallback=!!rs.fallback,this.extend=!!rs.extend}}function readToken(ss,ts,rs,ns){let is=0,as=1<<ns,{parser:os}=rs.p,{dialect:ls}=os;e:for(;as&ss[is];){let us=ss[is+1];for(let cs=is+3;cs<us;cs+=2)if((ss[cs+1]&as)>0){let ps=ss[cs];if(ls.allows(ps)&&(ts.token.value==-1||ts.token.value==ps||os.overrides(ps,ts.token.value))){ts.acceptToken(ps);break}}for(let cs=ts.next,ps=0,ds=ss[is+2];ps<ds;){let fs=ps+ds>>1,hs=us+fs+(fs<<1),ys=ss[hs],gs=ss[hs+1];if(cs<ys)ds=fs;else if(cs>=gs)ps=fs+1;else{is=ss[hs+2],ts.advance();continue e}}break}}function decodeArray(ss,ts=Uint16Array){if(typeof ss!="string")return ss;let rs=null;for(let ns=0,is=0;ns<ss.length;){let as=0;for(;;){let os=ss.charCodeAt(ns++),ls=!1;if(os==126){as=65535;break}os>=92&&os--,os>=34&&os--;let us=os-32;if(us>=46&&(us-=46,ls=!0),as+=us,ls)break;as*=46}rs?rs[is++]=as:rs=new ts(as)}return rs}const verbose=typeof browser$1<"u"&&/\bparse\b/.test({}.LOG);let stackIDs=null;var Safety;(function(ss){ss[ss.Margin=25]="Margin"})(Safety||(Safety={}));function cutAt(ss,ts,rs){let ns=ss.fullCursor();for(ns.moveTo(ts);;)if(!(rs<0?ns.childBefore(ts):ns.childAfter(ts)))for(;;){if((rs<0?ns.to<ts:ns.from>ts)&&!ns.type.isError)return rs<0?Math.max(0,Math.min(ns.to-1,ts-25)):Math.min(ss.length,Math.max(ns.from+1,ts+25));if(rs<0?ns.prevSibling():ns.nextSibling())break;if(!ns.parent())return rs<0?0:ss.length}}class FragmentCursor{constructor(ts,rs){this.fragments=ts,this.nodeSet=rs,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let ts=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(ts){for(this.safeFrom=ts.openStart?cutAt(ts.tree,ts.from+ts.offset,1)-ts.offset:ts.from,this.safeTo=ts.openEnd?cutAt(ts.tree,ts.to+ts.offset,-1)-ts.offset:ts.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(ts.tree),this.start.push(-ts.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(ts){if(ts<this.nextStart)return null;for(;this.fragment&&this.safeTo<=ts;)this.nextFragment();if(!this.fragment)return null;for(;;){let rs=this.trees.length-1;if(rs<0)return this.nextFragment(),null;let ns=this.trees[rs],is=this.index[rs];if(is==ns.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let as=ns.children[is],os=this.start[rs]+ns.positions[is];if(os>ts)return this.nextStart=os,null;if(as instanceof Tree){if(os==ts){if(os<this.safeFrom)return null;let ls=os+as.length;if(ls<=this.safeTo){let us=as.prop(NodeProp.lookAhead);if(!us||ls+us<this.fragment.to)return as}}this.index[rs]++,os+as.length>=Math.max(this.safeFrom,ts)&&(this.trees.push(as),this.start.push(os),this.index.push(0))}else this.index[rs]++,this.nextStart=os+as.length}}}class TokenCache{constructor(ts,rs){this.stream=rs,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=ts.tokenizers.map(ns=>new CachedToken)}getActions(ts){let rs=0,ns=null,{parser:is}=ts.p,{tokenizers:as}=is,os=is.stateSlot(ts.state,3),ls=ts.curContext?ts.curContext.hash:0,us=0;for(let cs=0;cs<as.length;cs++){if(!(1<<cs&os))continue;let ps=as[cs],ds=this.tokens[cs];if(!(ns&&!ps.fallback)&&((ps.contextual||ds.start!=ts.pos||ds.mask!=os||ds.context!=ls)&&(this.updateCachedToken(ds,ps,ts),ds.mask=os,ds.context=ls),ds.lookAhead>ds.end+25&&(us=Math.max(ds.lookAhead,us)),ds.value!=0)){let fs=rs;if(ds.extended>-1&&(rs=this.addActions(ts,ds.extended,ds.end,rs)),rs=this.addActions(ts,ds.value,ds.end,rs),!ps.extend&&(ns=ds,rs>fs))break}}for(;this.actions.length>rs;)this.actions.pop();return us&&ts.setLookAhead(us),!ns&&ts.pos==this.stream.end&&(ns=new CachedToken,ns.value=ts.p.parser.eofTerm,ns.start=ns.end=ts.pos,rs=this.addActions(ts,ns.value,ns.end,rs)),this.mainToken=ns,this.actions}getMainToken(ts){if(this.mainToken)return this.mainToken;let rs=new CachedToken,{pos:ns,p:is}=ts;return rs.start=ns,rs.end=Math.min(ns+1,is.stream.end),rs.value=ns==is.stream.end?is.parser.eofTerm:0,rs}updateCachedToken(ts,rs,ns){if(rs.token(this.stream.reset(ns.pos,ts),ns),ts.value>-1){let{parser:is}=ns.p;for(let as=0;as<is.specialized.length;as++)if(is.specialized[as]==ts.value){let os=is.specializers[as](this.stream.read(ts.start,ts.end),ns);if(os>=0&&ns.p.parser.dialect.allows(os>>1)){os&1?ts.extended=os>>1:ts.value=os>>1;break}}}else ts.value=0,ts.end=Math.min(ns.p.stream.end,ns.pos+1)}putAction(ts,rs,ns,is){for(let as=0;as<is;as+=3)if(this.actions[as]==ts)return is;return this.actions[is++]=ts,this.actions[is++]=rs,this.actions[is++]=ns,is}addActions(ts,rs,ns,is){let{state:as}=ts,{parser:os}=ts.p,{data:ls}=os;for(let us=0;us<2;us++)for(let cs=os.stateSlot(as,us?2:1);;cs+=3){if(ls[cs]==65535)if(ls[cs+1]==1)cs=pair(ls,cs+2);else{is==0&&ls[cs+1]==2&&(is=this.putAction(pair(ls,cs+2),rs,ns,is));break}ls[cs]==rs&&(is=this.putAction(pair(ls,cs+1),rs,ns,is))}return is}}var Rec;(function(ss){ss[ss.Distance=5]="Distance",ss[ss.MaxRemainingPerStep=3]="MaxRemainingPerStep",ss[ss.MinBufferLengthPrune=500]="MinBufferLengthPrune",ss[ss.ForceReduceLimit=10]="ForceReduceLimit",ss[ss.CutDepth=15e3]="CutDepth",ss[ss.CutTo=9e3]="CutTo"})(Rec||(Rec={}));class Parse{constructor(ts,rs,ns,is){this.parser=ts,this.input=rs,this.ranges=is,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new InputStream(rs,is),this.tokens=new TokenCache(ts,this.stream),this.topTerm=ts.top[1];let{from:as}=is[0];this.stacks=[Stack$1.start(this,ts.top[0],as)],this.fragments=ns.length&&this.stream.end-as>ts.bufferLength*4?new FragmentCursor(ns,ts.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let ts=this.stacks,rs=this.minStackPos,ns=this.stacks=[],is,as;for(let os=0;os<ts.length;os++){let ls=ts[os];for(;;){if(this.tokens.mainToken=null,ls.pos>rs)ns.push(ls);else{if(this.advanceStack(ls,ns,ts))continue;{is||(is=[],as=[]),is.push(ls);let us=this.tokens.getMainToken(ls);as.push(us.value,us.end)}}break}}if(!ns.length){let os=is&&findFinished(is);if(os)return this.stackToTree(os);if(this.parser.strict)throw verbose&&is&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+rs);this.recovering||(this.recovering=5)}if(this.recovering&&is){let os=this.stoppedAt!=null&&is[0].pos>this.stoppedAt?is[0]:this.runRecovery(is,as,ns);if(os)return this.stackToTree(os.forceAll())}if(this.recovering){let os=this.recovering==1?1:this.recovering*3;if(ns.length>os)for(ns.sort((ls,us)=>us.score-ls.score);ns.length>os;)ns.pop();ns.some(ls=>ls.reducePos>rs)&&this.recovering--}else if(ns.length>1)e:for(let os=0;os<ns.length-1;os++){let ls=ns[os];for(let us=os+1;us<ns.length;us++){let cs=ns[us];if(ls.sameState(cs)||ls.buffer.length>500&&cs.buffer.length>500)if((ls.score-cs.score||ls.buffer.length-cs.buffer.length)>0)ns.splice(us--,1);else{ns.splice(os--,1);continue e}}}this.minStackPos=ns[0].pos;for(let os=1;os<ns.length;os++)ns[os].pos<this.minStackPos&&(this.minStackPos=ns[os].pos);return null}stopAt(ts){if(this.stoppedAt!=null&&this.stoppedAt<ts)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=ts}advanceStack(ts,rs,ns){let is=ts.pos,{parser:as}=this,os=verbose?this.stackID(ts)+" -> ":"";if(this.stoppedAt!=null&&is>this.stoppedAt)return ts.forceReduce()?ts:null;if(this.fragments){let cs=ts.curContext&&ts.curContext.tracker.strict,ps=cs?ts.curContext.hash:0;for(let ds=this.fragments.nodeAt(is);ds;){let fs=this.parser.nodeSet.types[ds.type.id]==ds.type?as.getGoto(ts.state,ds.type.id):-1;if(fs>-1&&ds.length&&(!cs||(ds.prop(NodeProp.contextHash)||0)==ps))return ts.useNode(ds,fs),verbose&&console.log(os+this.stackID(ts)+` (via reuse of ${as.getName(ds.type.id)})`),!0;if(!(ds instanceof Tree)||ds.children.length==0||ds.positions[0]>0)break;let hs=ds.children[0];if(hs instanceof Tree&&ds.positions[0]==0)ds=hs;else break}}let ls=as.stateSlot(ts.state,4);if(ls>0)return ts.reduce(ls),verbose&&console.log(os+this.stackID(ts)+` (via always-reduce ${as.getName(ls&65535)})`),!0;if(ts.stack.length>=15e3)for(;ts.stack.length>9e3&&ts.forceReduce(););let us=this.tokens.getActions(ts);for(let cs=0;cs<us.length;){let ps=us[cs++],ds=us[cs++],fs=us[cs++],hs=cs==us.length||!ns,ys=hs?ts:ts.split();if(ys.apply(ps,ds,fs),verbose&&console.log(os+this.stackID(ys)+` (via ${ps&65536?`reduce of ${as.getName(ps&65535)}`:"shift"} for ${as.getName(ds)} @ ${is}${ys==ts?"":", split"})`),hs)return!0;ys.pos>is?rs.push(ys):ns.push(ys)}return!1}advanceFully(ts,rs){let ns=ts.pos;for(;;){if(!this.advanceStack(ts,null,null))return!1;if(ts.pos>ns)return pushStackDedup(ts,rs),!0}}runRecovery(ts,rs,ns){let is=null,as=!1;for(let os=0;os<ts.length;os++){let ls=ts[os],us=rs[os<<1],cs=rs[(os<<1)+1],ps=verbose?this.stackID(ls)+" -> ":"";if(ls.deadEnd&&(as||(as=!0,ls.restart(),verbose&&console.log(ps+this.stackID(ls)+" (restarted)"),this.advanceFully(ls,ns))))continue;let ds=ls.split(),fs=ps;for(let hs=0;ds.forceReduce()&&hs<10&&(verbose&&console.log(fs+this.stackID(ds)+" (via force-reduce)"),!this.advanceFully(ds,ns));hs++)verbose&&(fs=this.stackID(ds)+" -> ");for(let hs of ls.recoverByInsert(us))verbose&&console.log(ps+this.stackID(hs)+" (via recover-insert)"),this.advanceFully(hs,ns);this.stream.end>ls.pos?(cs==ls.pos&&(cs++,us=0),ls.recoverByDelete(us,cs),verbose&&console.log(ps+this.stackID(ls)+` (via recover-delete ${this.parser.getName(us)})`),pushStackDedup(ls,ns)):(!is||is.score<ls.score)&&(is=ls)}return is}stackToTree(ts){return ts.close(),Tree.build({buffer:StackBufferCursor.create(ts),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:ts.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(ts){let rs=(stackIDs||(stackIDs=new WeakMap)).get(ts);return rs||stackIDs.set(ts,rs=String.fromCodePoint(this.nextStackID++)),rs+ts}}function pushStackDedup(ss,ts){for(let rs=0;rs<ts.length;rs++){let ns=ts[rs];if(ns.pos==ss.pos&&ns.sameState(ss)){ts[rs].score<ss.score&&(ts[rs]=ss);return}}ts.push(ss)}class Dialect{constructor(ts,rs,ns){this.source=ts,this.flags=rs,this.disabled=ns}allows(ts){return!this.disabled||this.disabled[ts]==0}}const id=ss=>ss;class ContextTracker{constructor(ts){this.start=ts.start,this.shift=ts.shift||id,this.reduce=ts.reduce||id,this.reuse=ts.reuse||id,this.hash=ts.hash||(()=>0),this.strict=ts.strict!==!1}}class LRParser extends Parser$1{constructor(ts){if(super(),this.wrappers=[],ts.version!=13)throw new RangeError(`Parser version (${ts.version}) doesn't match runtime version (13)`);let rs=ts.nodeNames.split(" ");this.minRepeatTerm=rs.length;for(let ls=0;ls<ts.repeatNodeCount;ls++)rs.push("");let ns=Object.keys(ts.topRules).map(ls=>ts.topRules[ls][1]),is=[];for(let ls=0;ls<rs.length;ls++)is.push([]);function as(ls,us,cs){is[ls].push([us,us.deserialize(String(cs))])}if(ts.nodeProps)for(let ls of ts.nodeProps){let us=ls[0];for(let cs=1;cs<ls.length;){let ps=ls[cs++];if(ps>=0)as(ps,us,ls[cs++]);else{let ds=ls[cs+-ps];for(let fs=-ps;fs>0;fs--)as(ls[cs++],us,ds);cs++}}}this.nodeSet=new NodeSet(rs.map((ls,us)=>NodeType.define({name:us>=this.minRepeatTerm?void 0:ls,id:us,props:is[us],top:ns.indexOf(us)>-1,error:us==0,skipped:ts.skippedNodes&&ts.skippedNodes.indexOf(us)>-1}))),this.strict=!1,this.bufferLength=DefaultBufferLength;let os=decodeArray(ts.tokenData);if(this.context=ts.context,this.specialized=new Uint16Array(ts.specialized?ts.specialized.length:0),this.specializers=[],ts.specialized)for(let ls=0;ls<ts.specialized.length;ls++)this.specialized[ls]=ts.specialized[ls].term,this.specializers[ls]=ts.specialized[ls].get;this.states=decodeArray(ts.states,Uint32Array),this.data=decodeArray(ts.stateData),this.goto=decodeArray(ts.goto),this.maxTerm=ts.maxTerm,this.tokenizers=ts.tokenizers.map(ls=>typeof ls=="number"?new TokenGroup(os,ls):ls),this.topRules=ts.topRules,this.dialects=ts.dialects||{},this.dynamicPrecedences=ts.dynamicPrecedences||null,this.tokenPrecTable=ts.tokenPrec,this.termNames=ts.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(ts,rs,ns){let is=new Parse(this,ts,rs,ns);for(let as of this.wrappers)is=as(is,ts,rs,ns);return is}getGoto(ts,rs,ns=!1){let is=this.goto;if(rs>=is[0])return-1;for(let as=is[rs+1];;){let os=is[as++],ls=os&1,us=is[as++];if(ls&&ns)return us;for(let cs=as+(os>>1);as<cs;as++)if(is[as]==ts)return us;if(ls)return-1}}hasAction(ts,rs){let ns=this.data;for(let is=0;is<2;is++)for(let as=this.stateSlot(ts,is?2:1),os;;as+=3){if((os=ns[as])==65535)if(ns[as+1]==1)os=ns[as=pair(ns,as+2)];else{if(ns[as+1]==2)return pair(ns,as+2);break}if(os==rs||os==0)return pair(ns,as+1)}return 0}stateSlot(ts,rs){return this.states[ts*6+rs]}stateFlag(ts,rs){return(this.stateSlot(ts,0)&rs)>0}validAction(ts,rs){if(rs==this.stateSlot(ts,4))return!0;for(let ns=this.stateSlot(ts,1);;ns+=3){if(this.data[ns]==65535)if(this.data[ns+1]==1)ns=pair(this.data,ns+2);else return!1;if(rs==pair(this.data,ns+1))return!0}}nextStates(ts){let rs=[];for(let ns=this.stateSlot(ts,1);;ns+=3){if(this.data[ns]==65535)if(this.data[ns+1]==1)ns=pair(this.data,ns+2);else break;if(!(this.data[ns+2]&1)){let is=this.data[ns+1];rs.some((as,os)=>os&1&&as==is)||rs.push(this.data[ns],is)}}return rs}overrides(ts,rs){let ns=findOffset(this.data,this.tokenPrecTable,rs);return ns<0||findOffset(this.data,this.tokenPrecTable,ts)<ns}configure(ts){let rs=Object.assign(Object.create(LRParser.prototype),this);if(ts.props&&(rs.nodeSet=this.nodeSet.extend(...ts.props)),ts.top){let ns=this.topRules[ts.top];if(!ns)throw new RangeError(`Invalid top rule name ${ts.top}`);rs.top=ns}return ts.tokenizers&&(rs.tokenizers=this.tokenizers.map(ns=>{let is=ts.tokenizers.find(as=>as.from==ns);return is?is.to:ns})),ts.contextTracker&&(rs.context=ts.contextTracker),ts.dialect&&(rs.dialect=this.parseDialect(ts.dialect)),ts.strict!=null&&(rs.strict=ts.strict),ts.wrap&&(rs.wrappers=rs.wrappers.concat(ts.wrap)),ts.bufferLength!=null&&(rs.bufferLength=ts.bufferLength),rs}getName(ts){return this.termNames?this.termNames[ts]:String(ts<=this.maxNode&&this.nodeSet.types[ts].name||ts)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(ts){let rs=this.dynamicPrecedences;return rs==null?0:rs[ts]||0}parseDialect(ts){let rs=Object.keys(this.dialects),ns=rs.map(()=>!1);if(ts)for(let as of ts.split(" ")){let os=rs.indexOf(as);os>=0&&(ns[os]=!0)}let is=null;for(let as=0;as<rs.length;as++)if(!ns[as])for(let os=this.dialects[rs[as]],ls;(ls=this.data[os++])!=65535;)(is||(is=new Uint8Array(this.maxTerm+1)))[ls]=1;return new Dialect(ts,ns,is)}static deserialize(ts){return new LRParser(ts)}}function pair(ss,ts){return ss[ts]|ss[ts+1]<<16}function findOffset(ss,ts,rs){for(let ns=ts,is;(is=ss[ns])!=65535;ns++)if(is==rs)return ns-ts;return-1}function findFinished(ss){let ts=null;for(let rs of ss){let ns=rs.p.stoppedAt;(rs.pos==rs.p.stream.end||ns!=null&&rs.pos>ns)&&rs.p.parser.stateFlag(rs.state,2)&&(!ts||ts.score<rs.score)&&(ts=rs)}return ts}const StartTag=1,StartCloseTag=2,MissingCloseTag=3,mismatchedStartCloseTag=4,incompleteStartCloseTag=5,commentContent$1=27,Element=9,OpenTag=10;function nameChar(ss){return ss==45||ss==46||ss==58||ss>=65&&ss<=90||ss==95||ss>=97&&ss<=122||ss>=161}function isSpace(ss){return ss==9||ss==10||ss==13||ss==32}let cachedName=null,cachedInput=null,cachedPos=0;function tagNameAfter(ss,ts){let rs=ss.pos+ts;if(cachedInput==ss&&cachedPos==rs)return cachedName;for(;isSpace(ss.peek(ts));)ts++;let ns="";for(;;){let is=ss.peek(ts);if(!nameChar(is))break;ns+=String.fromCharCode(is),ts++}return cachedInput=ss,cachedPos=rs,cachedName=ns||null}function ElementContext(ss,ts){this.name=ss,this.parent=ts,this.hash=ts?ts.hash:0;for(let rs=0;rs<ss.length;rs++)this.hash+=(this.hash<<4)+ss.charCodeAt(rs)+(ss.charCodeAt(rs)<<8)}const elementContext=new ContextTracker({start:null,shift(ss,ts,rs,ns){return ts==StartTag?new ElementContext(tagNameAfter(ns,1)||"",ss):ss},reduce(ss,ts){return ts==Element&&ss?ss.parent:ss},reuse(ss,ts,rs,ns){let is=ts.type.id;return is==StartTag||is==OpenTag?new ElementContext(tagNameAfter(ns,1)||"",ss):ss},hash(ss){return ss?ss.hash:0},strict:!1}),startTag=new ExternalTokenizer((ss,ts)=>{if(ss.next==60){if(ss.advance(),ss.next==47){ss.advance();let rs=tagNameAfter(ss,0);if(!rs)return ss.acceptToken(incompleteStartCloseTag);if(ts.context&&rs.toLowerCase()==ts.context.name.toLowerCase())return ss.acceptToken(StartCloseTag);for(let ns=ts.context;ns;ns=ns.parent)if(ns.name==rs)return ss.acceptToken(MissingCloseTag,-2);ss.acceptToken(mismatchedStartCloseTag)}else if(ss.next!=33&&ss.next!=63&&!isSpace(ss.next))return ss.acceptToken(StartTag)}},{contextual:!0});function scanTo(ss,ts){return new ExternalTokenizer(rs=>{for(let ns=0,is=0;;is++){if(rs.next<0){is&&rs.acceptToken(ss);break}if(rs.next==ts.charCodeAt(ns)){if(ns++,ns==ts.length){is>ts.length&&rs.acceptToken(ss,1-ts.length);break}}else ns=0;rs.advance()}})}const commentContent=scanTo(commentContent$1,"-->"),parser=LRParser.deserialize({version:13,states:"*[OQOTOOO]OYO'#CdOeO`O'#CfO!OOTO'#CeOOOP'#Ce'#CeOOOP'#Cx'#CxOOOP'#Co'#CoQQOTOOOOOQ'#Cp'#CpO!VOYO,59OOOOP,59O,59OO!_OpO,59QO!mO`O'#ClOOOP'#DT'#DTOOOP'#Cu'#CuO!rOTO,59PO!yO`O'#CmOOOP,59P,59POOOP-E6m-E6mOOOQ-E6n-E6nOOOP1G.j1G.jOOOO'#Cq'#CqO#ROpO1G.lO#aOpO'#ChOOOO'#Cr'#CrO#rOpO1G.lOOOP1G.l1G.lOOOP1G.t1G.tO#}OWO,59WOOOP-E6s-E6sOOOP1G.k1G.kO$SO`O,59XO$[OWO,59XOOOO-E6o-E6oO$dOpO7+$WOOOP7+$W7+$WOOOP7+$`7+$`O$oOpO,59SO%QOWO,59SOOOO-E6p-E6pOOOP1G.r1G.rO%]OWO1G.sO%]OWO1G.sOOOP1G.s1G.sOOOP<<Gr<<GrOOOP<<Gz<<GzO%QOWO1G.nO%QOWO1G.nO%eO!bO'#C}O%mO#tO'#DQOOOO'#Ck'#CkO%uOpO1G.nO&TOWO7+$_OOOP7+$_7+$_O%QOWO7+$YO&]OpO7+$YOOOO'#Cs'#CsO&kO!bO,59iOOOO,59i,59iOOOO'#Ct'#CtO&sO#tO,59lOOOO,59l,59lO&]OpO7+$YOOOP<<Gy<<GyO&{OpO<<GtO&{OpO<<GtOOOO-E6q-E6qOOOO1G/T1G/TOOOO-E6r-E6rOOOO1G/W1G/WO'ZOpOAN=`",stateData:"'i~OPQOVTOnPO~OkWOmYO~OZZO~OPQOQ`OS[OT]OV]OnPO~ORaO~PjOkWOmdO~O]gOojOpeOxkO~OZlO~ORnO~PjOZpOpeO~O]gOosOpeOxtO~O^vOpeO][Xo[Xx[X~O]gOosOxtO~OoxO~OZyOpeO~Oo{OpeO~O]gOo|Ox}O~O^!OOpeO][ao[ax[a~OpeOr!QOu!RO~Oo!VOpeO~Or![Os!YO~Ou!_Ov!]O~OpeO][io[ix[i~Oo!aOpeO~OpeO][qo[qx[q~Or!eOs!YO~Ou!gOv!]O~OpeO][yo[yx[y~OpeO][!Ro[!Rx[!R~O",goto:"$yxPPPPPPPPyy!RP!XPP!_}!i!o!u!{#R#}$X$_$ePP$kPPPP$oPP$oPP$uSTOVT]R_XRORV_XhZfirQ!TvS!X!O!PR!b!WQaRRn_XSORV_QVORbVQXPRcXQfZQo`dqfouz!P!U!W!`!c!hQugQzpQ!PvQ!UyQ!W!OQ!`!TQ!c!XR!h!bQiZQrfTwirQ!Z!QR!d!ZQ!^!RR!f!^Q_RRm_TUOVX!Sv!O!P!WT^R_",nodeNames:" StartTag StartCloseTag MissingCloseTag StartCloseTag StartCloseTag Document Text Comment Element OpenTag TagName Attribute AttributeName Is AttributeValue MismatchedCloseTag CloseTag SelfClosingTag",maxTerm:40,context:elementContext,nodeProps:[[NodeProp.closedBy,1,"SelfCloseEndTag EndTag",10,"CloseTag MissingCloseTag"],[NodeProp.openedBy,17,"OpenTag"]],skippedNodes:[0],repeatNodeCount:7,tokenData:"6e!aRxOX#oX^({^p#opq({qr#ors*{sw#owx+ex}#o}!O+}!O!P#o!P!Q0}!Q![.y![!^#o!^!_2e!_!`5R!`!a5s!a!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o#y#o#y#z({#z$f#o$f$g({$g#BY#o#BY#BZ({#BZ$IS#o$IS$I_({$I_$I|#o$I|$JO({$JO$JT#o$JT$JU({$JU$KV#o$KV$KW({$KW&FU#o&FU&FV({&FV~#o!R#xVVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#oa$fTVPs`Ow$_wx$ux!^$_!^!_%a!_~$_P$zRVPO!^$u!^!_%T!_~$uP%WRYZ$upq$u!_!`$ua%fWs`OY&OYZ$_Zp&Opq$_qw&Ox!_&O!_!`$_!`~&O`&TQs`Ow&Ox~&Oq&bTVPvpOr&Zrs$us!^&Z!^!_&q!_~&Zq&vWvpOY'`YZ&ZZp'`pq&Zqr'`s!_'`!_!`&Z!`~'`p'eQvpOr'`s~'`!R'rZvps`OY(eYZ#oZp(epq#oqr(ers&Osw(ewx'`x!_(e!_!`#o!`~(e!Q(lTvps`Or(ers&Osw(ewx'`x~(e!a)WkVPvps`p^OX#oX^({^p#opq({qr#ors$_sw#owx&Zx!^#o!^!_'k!_#y#o#y#z({#z$f#o$f$g({$g#BY#o#BY#BZ({#BZ$IS#o$IS$I_({$I_$I|#o$I|$JO({$JO$JT#o$JT$JU({$JU$KV#o$KV$KW({$KW&FU#o&FU&FV({&FV~#o!T+UTurVPs`Ow$_wx$ux!^$_!^!_%a!_~$_!T+nTrbVPvpOr&Zrs$us!^&Z!^!_&q!_~&Z!a,[a]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O-a!O!Q#o!Q![.y![!^#o!^!_'k!_!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!a-nc]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O.y!O!Q#o!Q![.y![!^#o!^!_'k!_!`#o!`!a0]!a!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!_/Wa]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O.y!O!Q#o!Q![.y![!^#o!^!_'k!_!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!T0hVmQVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!Z1WXVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_!`#o!`!a1s!a~#o!Z2OVVPvps`xWOr#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!R2lZvps`OY(eYZ#oZp(epq#oqr3_rs&Osw(ewx'`x!_(e!_!`#o!`~(e!R3fVvps`Or(ers&Osw(ewx'`x}(e}!O3{!O~(e!R4SVvps`Or(ers&Osw(ewx'`x}(e}!O4i!O~(e!R4rTvps`nPOr(ers&Osw(ewx'`x~(e!Z5^V^WVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!]6OVVPvps`oYOr#ors$_sw#owx&Zx!^#o!^!_'k!_~#o",tokenizers:[startTag,commentContent,0,1,2,3,4,5],topRules:{Document:[0,6]},tokenPrec:0});function parse(ss){return parser.parse(ss).cursor()}function parseAndCompile(ss){function ts(os){if(os.name!=="Element")throw Error("compileElement() called on a non-Element");if(os.firstChild(),os.name==="OpenTag"){os.firstChild(),os.nextSibling();let ls=ss.substring(os.from,os.to),us=os.from,cs={};for(;os.nextSibling();){if(os.name!=="Attribute"){let hs=os.from,ys=os.to;for(;os.parent(););throw Error(`Invalid DoenetML at positions ${hs} to ${ys}. Error in opening <${ls}> tag.  Found ${ss.slice(us-1,ys)}`)}os.firstChild();let fs=ss.substring(os.from,os.to);if(os.nextSibling()===!1){if(fs in cs)throw Error(`Duplicate attribute ${fs}.  Found in component of type ${ls} at indices ${os.from}-${os.to}`);cs[fs]=!0}else{os.nextSibling();let hs=ss.substring(os.from+1,os.to-1);if(fs in cs)throw Error(`Duplicate attribute ${fs}.  Found in component of type ${ls} at indices ${os.from}-${os.to}`);cs[fs]=hs}os.parent()}os.parent();let ps=os.to,ds={componentType:ls,props:{...cs},children:[]};for(;os.nextSibling();)if(os.name==="Text"){let fs=ss.substring(os.from,os.to);fs!==""&&ds.children.push(fs)}else if(os.name==="Element")ds.children.push(ts(os.node.cursor));else{if(os.name==="CloseTag")break;if(os.name==="Comment")continue;throw os.name==="MismatchedCloseTag"?Error(`Invalid DoenetML at position ${os.from}. Mismatched closing tag.  Expected </${ls}>.  Found ${ss.slice(os.from,os.to)}.`):Error(`Invalid DoenetML at position ${os.from}. Expected a closing </${ls}> tag.  Instead found ${ss.slice(os.from,os.to)}.`)}return ds.range={openBegin:us,openEnd:ps,closeBegin:os.from,closeEnd:os.to},ds}else if(os.name==="SelfClosingTag"){os.firstChild(),os.nextSibling();let ls=ss.substring(os.from,os.to),us=os.from,cs={};for(;os.nextSibling();){if(os.name!=="Attribute")throw Error(`Invalid DoenetML at positions ${os.from} to ${os.to}. Error in self-closing <${ls}/> tag.`);os.firstChild();let ds=ss.substring(os.from,os.to);if(os.nextSibling()===!1){if(ds in cs)throw Error(`Duplicate attribute ${ds}.  Found in component of type ${ls} at indices ${os.from}-${os.to}`);cs[ds]=!0}else{if(os.nextSibling(),ds in cs)throw Error(`Duplicate attribute ${ds}.  Found in component of type ${ls} at indices ${os.from}-${os.to}`);let fs=ss.substring(os.from+1,os.to-1);cs[ds]=fs}os.parent()}let ps={selfCloseBegin:us,selfCloseEnd:os.to+3};return{componentType:ls,props:{...cs},children:[],range:ps}}else throw Error("Non SelfClosingTag/OpenTag in Element. How did you do that?")}function rs(os){if(os.node.name==="Element")return ts(os.node.cursor);if(os.node.name==="Comment")return null;if(os.node.name==="Text"){let ls=ss.substring(os.node.from,os.node.to);if(ls!=="")return ls}else throw Error(`Invalid DoenetML at positions ${os.node.from} to ${os.node.to}.  Found ${ss.substring(os.node.from,os.node.to)}`)}if(!ss)return[];let ns=parse(ss),is=[];if(!ns.firstChild())return is;let as=rs(ns);for(as!=null&&is.push(as);ns.nextSibling();){let os=rs(ns);os!=null&&is.push(os)}return is}var base32Exports={},base32$1={get exports(){return base32Exports},set exports(ss){base32Exports=ss}};(function(ss){(function(){var ts=typeof window=="object"?window:{},rs=!ts.HI_BASE32_NO_NODE_JS&&typeof browser$1=="object"&&browser$1.versions&&browser$1.versions.node;rs&&(ts=commonjsGlobal);var ns=!ts.HI_BASE32_NO_COMMON_JS&&!0&&ss.exports,is="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),as={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},os=[0,0,0,0,0,0,0,0],ls=function(bs,vs){vs.length>10&&(vs="..."+vs.substr(-10));var Ns=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+bs+" bytes: "+vs+" <-");throw Ns.position=bs,Ns},us=function(bs){for(var vs="",Ns=bs.length,Ts=0,Cs=0,xs,As;Ts<Ns;){if(xs=bs[Ts++],xs<=127){vs+=String.fromCharCode(xs);continue}else xs>191&&xs<=223?(As=xs&31,Cs=1):xs<=239?(As=xs&15,Cs=2):xs<=247?(As=xs&7,Cs=3):ls(Ts,vs);for(var ws=0;ws<Cs;++ws)xs=bs[Ts++],(xs<128||xs>191)&&ls(Ts,vs),As<<=6,As+=xs&63;As>=55296&&As<=57343&&ls(Ts,vs),As>1114111&&ls(Ts,vs),As<=65535?vs+=String.fromCharCode(As):(As-=65536,vs+=String.fromCharCode((As>>10)+55296),vs+=String.fromCharCode((As&1023)+56320))}return vs},cs=function(bs){if(bs==="")return[];if(!/^[A-Z2-7=]+$/.test(bs))throw new Error("Invalid base32 characters");bs=bs.replace(/=/g,"");for(var vs,Ns,Ts,Cs,xs,As,ws,Es,Ss=[],Ds=0,Vs=bs.length,Is=0,Os=Vs>>3<<3;Is<Os;)vs=as[bs.charAt(Is++)],Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],As=as[bs.charAt(Is++)],ws=as[bs.charAt(Is++)],Es=as[bs.charAt(Is++)],Ss[Ds++]=(vs<<3|Ns>>>2)&255,Ss[Ds++]=(Ns<<6|Ts<<1|Cs>>>4)&255,Ss[Ds++]=(Cs<<4|xs>>>1)&255,Ss[Ds++]=(xs<<7|As<<2|ws>>>3)&255,Ss[Ds++]=(ws<<5|Es)&255;var Ps=Vs-Os;return Ps===2?(vs=as[bs.charAt(Is++)],Ns=as[bs.charAt(Is++)],Ss[Ds++]=(vs<<3|Ns>>>2)&255):Ps===4?(vs=as[bs.charAt(Is++)],Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],Ss[Ds++]=(vs<<3|Ns>>>2)&255,Ss[Ds++]=(Ns<<6|Ts<<1|Cs>>>4)&255):Ps===5?(vs=as[bs.charAt(Is++)],Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],Ss[Ds++]=(vs<<3|Ns>>>2)&255,Ss[Ds++]=(Ns<<6|Ts<<1|Cs>>>4)&255,Ss[Ds++]=(Cs<<4|xs>>>1)&255):Ps===7&&(vs=as[bs.charAt(Is++)],Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],As=as[bs.charAt(Is++)],ws=as[bs.charAt(Is++)],Ss[Ds++]=(vs<<3|Ns>>>2)&255,Ss[Ds++]=(Ns<<6|Ts<<1|Cs>>>4)&255,Ss[Ds++]=(Cs<<4|xs>>>1)&255,Ss[Ds++]=(xs<<7|As<<2|ws>>>3)&255),Ss},ps=function(bs){for(var vs,Ns,Ts,Cs,xs,As="",ws=bs.length,Es=0,Ss=parseInt(ws/5)*5;Es<Ss;)vs=bs.charCodeAt(Es++),Ns=bs.charCodeAt(Es++),Ts=bs.charCodeAt(Es++),Cs=bs.charCodeAt(Es++),xs=bs.charCodeAt(Es++),As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[(Cs<<3|xs>>>5)&31]+is[xs&31];var Ds=ws-Ss;return Ds===1?(vs=bs.charCodeAt(Es),As+=is[vs>>>3]+is[vs<<2&31]+"======"):Ds===2?(vs=bs.charCodeAt(Es++),Ns=bs.charCodeAt(Es),As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[Ns<<4&31]+"===="):Ds===3?(vs=bs.charCodeAt(Es++),Ns=bs.charCodeAt(Es++),Ts=bs.charCodeAt(Es),As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[Ts<<1&31]+"==="):Ds===4&&(vs=bs.charCodeAt(Es++),Ns=bs.charCodeAt(Es++),Ts=bs.charCodeAt(Es++),Cs=bs.charCodeAt(Es),As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[Cs<<3&31]+"="),As},ds=function(bs){var vs,Ns,Ts,Cs,xs,As,ws=!1,Es="",Ss=0,Ds,Vs=0,Is=bs.length;if(bs==="")return Es;do{for(os[0]=os[5],os[1]=os[6],os[2]=os[7],Ds=Vs;Ss<Is&&Ds<5;++Ss)As=bs.charCodeAt(Ss),As<128?os[Ds++]=As:As<2048?(os[Ds++]=192|As>>6,os[Ds++]=128|As&63):As<55296||As>=57344?(os[Ds++]=224|As>>12,os[Ds++]=128|As>>6&63,os[Ds++]=128|As&63):(As=65536+((As&1023)<<10|bs.charCodeAt(++Ss)&1023),os[Ds++]=240|As>>18,os[Ds++]=128|As>>12&63,os[Ds++]=128|As>>6&63,os[Ds++]=128|As&63);Vs=Ds-5,Ss===Is&&++Ss,Ss>Is&&Ds<6&&(ws=!0),vs=os[0],Ds>4?(Ns=os[1],Ts=os[2],Cs=os[3],xs=os[4],Es+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[(Cs<<3|xs>>>5)&31]+is[xs&31]):Ds===1?Es+=is[vs>>>3]+is[vs<<2&31]+"======":Ds===2?(Ns=os[1],Es+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[Ns<<4&31]+"===="):Ds===3?(Ns=os[1],Ts=os[2],Es+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[Ts<<1&31]+"==="):(Ns=os[1],Ts=os[2],Cs=os[3],Es+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[Cs<<3&31]+"=")}while(!ws);return Es},fs=function(bs){for(var vs,Ns,Ts,Cs,xs,As="",ws=bs.length,Es=0,Ss=parseInt(ws/5)*5;Es<Ss;)vs=bs[Es++],Ns=bs[Es++],Ts=bs[Es++],Cs=bs[Es++],xs=bs[Es++],As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[(Cs<<3|xs>>>5)&31]+is[xs&31];var Ds=ws-Ss;return Ds===1?(vs=bs[Es],As+=is[vs>>>3]+is[vs<<2&31]+"======"):Ds===2?(vs=bs[Es++],Ns=bs[Es],As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[Ns<<4&31]+"===="):Ds===3?(vs=bs[Es++],Ns=bs[Es++],Ts=bs[Es],As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[Ts<<1&31]+"==="):Ds===4&&(vs=bs[Es++],Ns=bs[Es++],Ts=bs[Es++],Cs=bs[Es],As+=is[vs>>>3]+is[(vs<<2|Ns>>>6)&31]+is[Ns>>>1&31]+is[(Ns<<4|Ts>>>4)&31]+is[(Ts<<1|Cs>>>7)&31]+is[Cs>>>2&31]+is[Cs<<3&31]+"="),As},hs=function(bs,vs){var Ns=typeof bs!="string";return Ns&&bs.constructor===ArrayBuffer&&(bs=new Uint8Array(bs)),Ns?fs(bs):vs?ps(bs):ds(bs)},ys=function(bs,vs){if(!vs)return us(cs(bs));if(bs==="")return"";if(!/^[A-Z2-7=]+$/.test(bs))throw new Error("Invalid base32 characters");var Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds="",Vs=bs.indexOf("=");Vs===-1&&(Vs=bs.length);for(var Is=0,Os=Vs>>3<<3;Is<Os;)Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],As=as[bs.charAt(Is++)],ws=as[bs.charAt(Is++)],Es=as[bs.charAt(Is++)],Ss=as[bs.charAt(Is++)],Ds+=String.fromCharCode((Ns<<3|Ts>>>2)&255)+String.fromCharCode((Ts<<6|Cs<<1|xs>>>4)&255)+String.fromCharCode((xs<<4|As>>>1)&255)+String.fromCharCode((As<<7|ws<<2|Es>>>3)&255)+String.fromCharCode((Es<<5|Ss)&255);var Ps=Vs-Os;return Ps===2?(Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Ds+=String.fromCharCode((Ns<<3|Ts>>>2)&255)):Ps===4?(Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],Ds+=String.fromCharCode((Ns<<3|Ts>>>2)&255)+String.fromCharCode((Ts<<6|Cs<<1|xs>>>4)&255)):Ps===5?(Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],As=as[bs.charAt(Is++)],Ds+=String.fromCharCode((Ns<<3|Ts>>>2)&255)+String.fromCharCode((Ts<<6|Cs<<1|xs>>>4)&255)+String.fromCharCode((xs<<4|As>>>1)&255)):Ps===7&&(Ns=as[bs.charAt(Is++)],Ts=as[bs.charAt(Is++)],Cs=as[bs.charAt(Is++)],xs=as[bs.charAt(Is++)],As=as[bs.charAt(Is++)],ws=as[bs.charAt(Is++)],Es=as[bs.charAt(Is++)],Ds+=String.fromCharCode((Ns<<3|Ts>>>2)&255)+String.fromCharCode((Ts<<6|Cs<<1|xs>>>4)&255)+String.fromCharCode((xs<<4|As>>>1)&255)+String.fromCharCode((As<<7|ws<<2|Es>>>3)&255)),Ds},gs={encode:hs,decode:ys};ys.asBytes=cs,ns?ss.exports=gs:ts.base32=gs})()})(base32$1);var base32=base32Exports;async function cidFromText(ss){let rs=new TextEncoder().encode(ss);return await cidFromArrayBuffer(rs)}async function cidFromArrayBuffer(ss){let ts=await crypto.subtle.digest("SHA-256",ss),rs=new Uint8Array(36);return rs.set([1,85,18,32]),rs.set(new Uint8Array(ts),4),"b"+base32.encode(rs).toLowerCase().replace(/=+/,"")}const textByCid={};function retrieveTextFileForCid(ss,ts="doenet"){return textByCid[ss]!==void 0?Promise.resolve(textByCid[ss]):new Promise((rs,ns)=>{let is=retrieveTextFileFromIPFS(ss),as=is.promise,os=is.controller,ls,us=!1,cs=!1,ps;as.then(ds=>{clearTimeout(ps),ls&&!cs&&ls.abort(),textByCid[ss]=ds,rs(ds)}).catch(ds=>{us=!0,cs&&(clearTimeout(ps),ns(ds))}),ps=setTimeout(()=>{let ds=retrieveTextFileFromServer(ss,ts),fs=ds.promise;ls=ds.controller,fs.then(hs=>{us||os.abort(),textByCid[ss]=hs,rs(hs)}).catch(hs=>{cs=!0,us?ns(hs):ps=setTimeout(()=>{os.abort(),ns(hs)},5e3)})},100)})}function retrieveTextFileFromIPFS(ss){let ts=new AbortController,rs=ts.signal;return{promise:async function(){try{let as=await fetch(`https://${ss}.ipfs.dweb.link/`,{signal:rs});if(as.ok){let os=await as.text();return await cidFromText(os)===ss?os:Promise.reject(new Error("cid mismatch"))}else return Promise.reject(new Error(`cid not found: ${ss}`))}catch{return Promise.reject(new Error(`cid not found: ${ss}`))}}(),controller:ts}}function retrieveTextFileFromServer(ss,ts){let rs=new AbortController,ns=rs.signal;return{promise:async function(){try{let os=await fetch(`/media/${ss}.${ts}`,{signal:ns});if(os.ok){let ls=await os.text(),us=await cidFromText(ls);return us===ss?ls:(console.warn(`cid mismatch, ${ss}, ${us}`),Promise.reject(new Error("cid mismatch")))}else return Promise.reject(new Error(`cid not found: ${ss}`))}catch{return Promise.reject(new Error(`cid not found: ${ss}`))}}(),controller:rs}}async function expandDoenetMLsToFullSerializedComponents({cids:ss,doenetMLs:ts,componentInfoObjects:rs}){var os,ls;let ns=[],is={};for(let us of ts){let cs=parseAndCompile(us);cs=cleanIfHaveJustDocument(cs),substituteDeprecations(cs),temporarilyRenameSourceBackToTarget(cs),correctComponentTypeCapitalization(cs,rs.componentTypeLowerCaseMapping),copyTargetOrFromURIAttributeCreatesCopyComponent(cs,rs.isCompositeComponent),createAttributesFromProps(cs,rs),breakUpTargetIntoPropsAndIndices(cs,rs),applyMacros(cs,rs),removeBlankStringChildren(cs,rs),decodeXMLEntities(cs),applySugar({serializedComponents:cs,componentInfoObjects:rs}),ns.push(cs);let ps=findContentCopies({serializedComponents:cs});for(let ds in ps.cidComponents)is[ds]===void 0&&(is[ds]=[]),is[ds].push(...ps.cidComponents[ds])}let as=Object.keys(is);if(as.length>0){let{newDoenetMLs:us,newCids:cs}=await cidsToDoenetMLs(as);for(let[fs,hs]of as.entries())if(cs[fs]&&cs[fs].substring(0,hs.length)!==hs)return Promise.reject(new Error(`Requested cid ${hs} but got back ${cs[fs]}!`));let ps=as.length;for(let fs=0;fs<ps;fs++)cs[fs]||(console.warn(`Unable to retrieve content with cid = ${as[fs]}`),us[fs]="");let{fullSerializedComponents:ds}=await expandDoenetMLsToFullSerializedComponents({doenetMLs:us,cids:cs,componentInfoObjects:rs});for(let[fs,hs]of as.entries()){let ys=ds[fs];for(let gs of is[hs]){gs.children===void 0&&(gs.children=[]),gs.doenetAttributes||(gs.doenetAttributes={}),gs.doenetAttributes.copiedURI=!0;let vs=JSON.parse(JSON.stringify(ys)).filter(Cs=>typeof Cs!="string"||Cs.trim()),Ns=vs.length===1&&typeof vs[0]=="object",Ts=(os=gs.doenetAttributes)==null?void 0:os.fromCopyFromURI;if(Ts||Ns)if(Ts&&!Ns)console.warn("ignoring copyFromURI as it was not a single component");else{let Cs=vs[0];Cs.attributes||(Cs.attributes={}),gs.doenetAttributes||(gs.doenetAttributes={}),gs.doenetAttributes.keptNewNamespaceOfLastChild=!!((ls=Cs.attributes.newNamespace)!=null&&ls.primitive),Cs.attributes.newNamespace={primitive:!0},gs.children=[Cs,...gs.children],gs.doenetAttributes.nameFirstChildIndependently=!0}else{let Cs={componentType:"externalContent",children:JSON.parse(JSON.stringify(ys)),attributes:{newNamespace:{primitive:!0}},doenetAttributes:{createUniqueName:!0}};gs.children=[Cs,...gs.children]}}}}return{cids:ss,fullSerializedComponents:ns}}function cidsToDoenetMLs(ss){let ts=[],rs=ss;for(let ns of ss)ts.push(retrieveTextFileForCid(ns,"doenet"));return Promise.all(ts).then(ns=>Promise.resolve({newDoenetMLs:ns,newCids:rs})).catch(ns=>{let is;return rs.length===1?is=`Could not retrieve cid ${rs[0]}`:is=`Could not retrieve cids ${rs.join(",")}`,is+=": "+ns.message,console.error(is),Promise.reject(new Error(is))})}function removeBlankStringChildren(ss,ts){for(let rs of ss){if(rs.children){let ns=ts.allComponentClasses[rs.componentType];ns&&!ns.includeBlankStringChildren&&(rs.children=rs.children.filter(is=>typeof is!="string"||is.trim()!=="")),removeBlankStringChildren(rs.children,ts)}for(let ns in rs.attributes){let is=rs.attributes[ns].component;is&&is.children&&removeBlankStringChildren([is],ts)}}}function findContentCopies({serializedComponents:ss}){let ts={};for(let rs of ss)if(rs.componentType==="copy"){if(rs.attributes&&rs.attributes.uri){let ns=rs.attributes.uri.primitive;if(ns&&ns.substring(0,7).toLowerCase()==="doenet:"){let is=ns.match(/[:&]cid=([^&]+)/i);if(is){let as=is[1];ts[as]===void 0&&(ts[as]=[]),ts[as].push(rs)}}}}else if(rs.children!==void 0){let ns=findContentCopies({serializedComponents:rs.children});for(let is in ns.cidComponents)ts[is]===void 0&&(ts[is]=[]),ts[is].push(...ns.cidComponents[is])}return{cidComponents:ts}}function addDocumentIfItsMissing(ss){if(ss.length!==1||ss[0].componentType!=="document"){let ts=ss.splice(0);ss.push({componentType:"document",children:ts})}}function substituteDeprecations(ss){let ts={tname:"target",triggerwithtnames:"triggerWith",updatewithtname:"updateWith",paginatortname:"paginator",randomizeorder:"shuffleOrder",copytarget:"copySource",triggerwithtargets:"triggerWith",triggerwhentargetsclicked:"triggerWhenObjectsClicked",fortarget:"forObject",targetattributestoignore:"sourceAttributesToIgnore",targetattributestoignorerecursively:"sourceAttributesToIgnoreRecursively",targetsareresponses:"sourcesAreResponses",updatewithtarget:"updateWith",targetsarefunctionsymbols:"sourcesAreFunctionSymbols",selectforvariantnames:"selectForVariants"},rs={copy:{target:"source",tname:"source"},collect:{target:"source",tname:"source"},summarystatistics:{target:"source"}};for(let ns of ss)if(typeof ns=="object"){if(ns.props){let is=ns.componentType,as=rs[is.toLowerCase()];as||(as={});let os=!0;for(;os;){os=!1;for(let ls in ns.props){let us=ls.toLowerCase();if(us in as){let cs=as[us];console.warn(`Attribute ${ls} of component type ${is} is deprecated.  Use ${cs} instead.`),ns.props[cs]=ns.props[ls],delete ns.props[ls],os=!0;break}else if(us in ts){let cs=ts[us];console.warn(`Attribute ${ls} is deprecated.  Use ${cs} instead.`),ns.props[cs]=ns.props[ls],delete ns.props[ls],os=!0;break}}}}ns.children&&substituteDeprecations(ns.children)}}function temporarilyRenameSourceBackToTarget(ss){let ts={copysource:"copyTarget"},rs={copy:{source:"target"},collect:{source:"target"}};for(let ns of ss)if(typeof ns=="object"){if(ns.props){let is=ns.componentType,as=rs[is.toLowerCase()];as||(as={});let os=!0;for(;os;){os=!1;for(let ls in ns.props){let us=ls.toLowerCase();if(us in as){let cs=as[us];ns.props[cs]=ns.props[ls],delete ns.props[ls],os=!0;break}else if(us in ts){let cs=ts[us];ns.props[cs]=ns.props[ls],delete ns.props[ls],os=!0;break}}}}ns.children&&temporarilyRenameSourceBackToTarget(ns.children)}}function cleanIfHaveJustDocument(ss){let ts=ss.filter(rs=>typeof rs!="string"||rs.trim()!=="");return ts.length===1&&ts[0].componentType==="document"?ts:ss}function correctComponentTypeCapitalization(ss,ts){for(let rs of ss){if(typeof rs!="object")continue;let ns=ts[rs.componentType.toLowerCase()];if(ns)rs.componentType=ns;else throw Error(`Invalid component type${indexRangeString(rs)}: ${rs.componentType}`);rs.children&&correctComponentTypeCapitalization(rs.children,ts)}}function copyTargetOrFromURIAttributeCreatesCopyComponent(ss,ts){for(let rs of ss){if(rs.props){let ns=!1,is=!1,as=!1,os=rs.componentType,ls=ts({componentType:os,includeNonStandard:!1}),us=ts({componentType:os,includeNonStandard:!0});for(let cs of Object.keys(rs.props)){let ps=cs.toLowerCase();if(ps==="copytarget"){if(ns)throw Error(`Cannot repeat attribute ${cs}.  Found in component type ${os}${indexRangeString(rs)}`);if(is)throw Error(`Cannot combine copyTarget and copyFromURI attribiutes.  For in component of type ${os}${indexRangeString(rs)}`);if(as)throw Error(us?`A component of type ${os} cannot have both assignNames and copyTarget.  Found${indexRangeString(rs)}.`:`Invalid attribute assignNames for component of type ${os}${indexRangeString(rs)}`);if(ns=!0,rs.doenetAttributes||(rs.doenetAttributes={}),ls||(rs.props.createComponentOfType=os,rs.doenetAttributes.nameBecomesAssignNames=!0),rs.componentType="copy",rs.props.target=rs.props[cs],typeof rs.props.target!="string")throw Error(`Must specify value for copyTarget.  Found in component of type ${os}${indexRangeString(rs)}`);delete rs.props[cs],rs.doenetAttributes.fromCopyTarget=!0,rs.doenetAttributes.createNameFromComponentType=os,rs.props.assignNamesSkip="1"}else if(ps==="copyfromuri"){if(is)throw Error(`Cannot repeat attribute ${cs}.  Found in component type ${os}${indexRangeString(rs)}`);if(ns)throw Error(`Cannot combine copyTarget and copyFromURI attribiutes.  For in component of type ${os}${indexRangeString(rs)}`);if(as)throw Error(us?`A component of type ${os} cannot have both assignNames and copyFromURI.  Found${indexRangeString(rs)}.`:`Invalid attribute assignNames for component of type ${os}${indexRangeString(rs)}`);if(is=!0,rs.doenetAttributes||(rs.doenetAttributes={}),ls||(rs.props.createComponentOfType=os,rs.doenetAttributes.nameBecomesAssignNames=!0),rs.componentType="copy",rs.props.uri=rs.props[cs],typeof rs.props.uri!="string")throw Error(`Must specify value for copyFromURI.  Found in component of type ${os}${indexRangeString(rs)}`);delete rs.props[cs],rs.doenetAttributes.fromCopyFromURI=!0,rs.doenetAttributes.createNameFromComponentType=os,rs.props.assignNamesSkip="1"}else if(ps==="assignnames"&&!ls){if(ns||is)throw Error(us?`A component of type ${os} cannot have both assignNames and copyTarget.  Found${indexRangeString(rs)}.`:`Invalid attribute assignNames for component of type ${os}${indexRangeString(rs)}`);as=!0}}if(ns){for(let ps of Object.keys(rs.props))if(ps.toLowerCase()==="prop")throw Error(`Invalid attribute prop for component of type ${os}${indexRangeString(rs)}`);let cs=!1;for(let ps of Object.keys(rs.props))if(ps.toLowerCase()==="copyprop"){if(cs)throw Error(`Cannot repeat attribute ${ps}.  Found in component type ${os}${indexRangeString(rs)}`);rs.props.prop=rs.props[ps],delete rs.props[ps],cs=!0}}}rs.children&&copyTargetOrFromURIAttributeCreatesCopyComponent(rs.children,ts)}}function breakUpTargetIntoPropsAndIndices(ss,ts,rs=""){for(let[ns,is]of ss.entries()){if(is.props&&["copy","updateValue","animateFromSequence"].includes(is.componentType)){let as,os,ls,us,cs,ps,ds;for(let fs of Object.keys(is.props))if(fs.toLowerCase()==="target"){if(as)throw Error(`Cannot repeat attribute ${fs}.  Found in component type ${is.componentType}${indexRangeString(is)}`);as=fs,ds=is.props[fs];let ys=buildSourcePieces(ds,!0);ys.success&&ys.matchLength===ds.length&&(os=ys.sourceName,ls=ys.componentIndex,us=ys.componentAttributes,cs=ys.propArray,ps=ys.subNames)}if(as&&os)if(ls||us||cs.length>0){if(is.attributes.prop)throw Error(`Cannot combine the prop attribute with an extended source attribute.  Found in component type ${is.componentType}${indexRangeString(is)}`);if(is.attributes.propIndex)throw Error(`Cannot combine the propIndex attribute with an extended source attribute.  Found in component type ${is.componentType}${indexRangeString(is)}`);if(is.attributes.componentIndex)throw Error(`Cannot combine the componentIndex attribute with an extended source attribute.  Found in component type ${is.componentType}${indexRangeString(is)}`);let fs=createComponentFromExtendedSource({sourceName:os,componentIndex:ls,subNames:ps,componentAttributes:us,propArray:cs,componentInfoObjects:ts});if(fs.success){let hs=fs.newComponent;if(is.componentType==="copy")delete is.props[as],Object.assign(is.attributes,hs.attributes),is.doenetAttributes||(is.doenetAttributes={}),Object.assign(is.doenetAttributes,hs.doenetAttributes),is.doenetAttributes.createNameFromComponentType||(is.doenetAttributes.createNameFromComponentType=is.componentType),is.componentType=hs.componentType,cs.length===0&&!(is.attributes.prop||is.attributes.propIndex)&&(is.doenetAttributes.isPlainCopy=!0),hs.children&&(is.children=hs.children);else if(hs.componentType==="copy")delete is.props[as],Object.assign(is.attributes,hs.attributes),is.doenetAttributes||(is.doenetAttributes={}),Object.assign(is.doenetAttributes,hs.doenetAttributes);else{let ys="fromExtendedSource"+rs+"|"+ns,gs=createUniqueName("extract",ys);hs.doenetAttributes.prescribedName=gs,hs.doenetAttributes.createdFromMacro=!0;let bs={componentType:"setup",children:[hs],doenetAttributes:{createdFromMacro:!0}};ss.push(bs),delete is.props[as],is.doenetAttributes||(is.doenetAttributes={}),is.doenetAttributes.target=gs,is.doenetAttributes.allowDoubleUnderscoreTarget=!0}}else is.componentType==="copy"?console.warn(`invalid copy source: ${ds}`):console.warn(`invalid target: ${ds}`)}else is.componentType==="copy"&&!(is.attributes.prop||is.attributes.propIndex)&&(is.doenetAttributes||(is.doenetAttributes={}),is.doenetAttributes.isPlainCopy=!0)}is.children&&breakUpTargetIntoPropsAndIndices(is.children,ts,rs+"|"+ns)}}function createAttributesFromProps(ss,ts){for(let rs of ss){if(typeof rs!="object")continue;let ns=ts.allComponentClasses[rs.componentType],is=ns.createAttributesObject(),as={};for(let us in is)as[us.toLowerCase()]=us;let os={},ls=Object.assign({},rs.props);if(rs.props)for(let us in rs.props){let cs=as[us.toLowerCase()],ps=is[cs];if(ps){if(cs in os)throw Error(`Cannot repeat attribute ${cs}.  Found in component type ${rs.componentType}${indexRangeString(rs)}`);os[cs]=componentFromAttribute({attrObj:ps,value:rs.props[us],originalComponentProps:ls,componentInfoObjects:ts}),delete rs.props[us]}else if(!["name","assignnames","target"].includes(us.toLowerCase()))if(ns.acceptAnyAttribute)os[us]=componentFromAttribute({value:rs.props[us],originalComponentProps:ls,componentInfoObjects:ts}),delete rs.props[us];else throw Error(`Invalid attribute ${us} for component of type ${rs.componentType}${indexRangeString(rs)}`)}for(let us in is){let cs=is[us];cs.createPrimitiveOfType&&"defaultPrimitiveValue"in cs&&!(us in os)&&(os[us]=componentFromAttribute({attrObj:cs,originalComponentProps:ls,value:cs.defaultPrimitiveValue.toString(),componentInfoObjects:ts}))}rs.attributes=os,rs.children!==void 0&&createAttributesFromProps(rs.children,ts)}}function componentFromAttribute({attrObj:ss,value:ts,originalComponentProps:rs,componentInfoObjects:ns}){if(typeof ts!="object"?ts={rawString:ts.toString()}:ts===null&&(ts={rawString:""}),ss&&ss.createComponentOfType){let is,as=ts.rawString.trim().toLowerCase();if(as==="true"&&ss.valueForTrue!==void 0)is={componentType:ss.createComponentOfType,state:{value:ss.valueForTrue}};else if(as==="false"&&ss.valueForFalse!==void 0)is={componentType:ss.createComponentOfType,state:{value:ss.valueForFalse}};else if(ns.isInheritedComponentType({inheritedComponentType:ss.createComponentOfType,baseComponentType:"boolean"})&&["true","false"].includes(as))is={componentType:ss.createComponentOfType,state:{value:as==="true"}};else{let ls=ts.childrenForComponent;ls?ls=JSON.parse(JSON.stringify(ls)):ls=[ts.rawString],is={componentType:ss.createComponentOfType,children:ls},removeBlankStringChildren([is],ns)}if(ss.attributesForCreatedComponent||ss.copyComponentAttributesForCreatedComponent){if(ss.attributesForCreatedComponent?is.props=ss.attributesForCreatedComponent:is.props={},ss.copyComponentAttributesForCreatedComponent)for(let ls of ss.copyComponentAttributesForCreatedComponent)rs[ls]&&(is.props[ls]=JSON.parse(JSON.stringify(rs[ls])));createAttributesFromProps([is],ns)}let os={component:is};return ss.ignoreFixed&&(os.ignoreFixed=!0),os}else if(ss&&ss.createPrimitiveOfType){let is;return ss.createPrimitiveOfType==="boolean"?is=ts.rawString.trim().toLowerCase()==="true":ss.createPrimitiveOfType==="number"?is=Number(ts.rawString):ss.createPrimitiveOfType==="integer"?is=Math.round(Number(ts.rawString)):ss.createPrimitiveOfType==="stringArray"?is=ts.rawString.trim().split(/\s+/):ss.createPrimitiveOfType==="numberArray"?is=ts.rawString.trim().split(/\s+/).map(Number):is=ts.rawString,ss.validationFunction&&(is=ss.validationFunction(is)),{primitive:is}}else return ss&&ss.createTargetComponentNames?{targetComponentNames:ts.rawString.trim().split(/\s+/).map(as=>(as[0]==="$"&&as[1]!=="$"&&(as=as.slice(1),as[0]==="("&&as[as.length-1]===")"&&(as=as.slice(1,as.length-1))),{relativeName:as}))}:(ts.childrenForComponent||(ts.childrenForComponent=[ts.rawString]),ts)}function findPreSugarIndsAndMarkFromSugar(ss){let ts=[];for(let rs of ss)if(typeof rs=="object"){if(rs.preSugarInd!==void 0)ts.push(rs.preSugarInd);else if(rs.doenetAttributes||(rs.doenetAttributes={}),rs.doenetAttributes.createdFromSugar=!0,rs.children){let ns=findPreSugarIndsAndMarkFromSugar(rs.children);ts.push(...ns)}}return ts}function applyMacros(ss,ts){for(let rs of ss)if(rs.children&&applyMacros(rs.children,ts),rs.attributes)for(let ns in rs.attributes){let is=rs.attributes[ns];is.component?applyMacros([is.component],ts):is.childrenForComponent&&applyMacros(is.childrenForComponent,ts)}substituteMacros(ss,ts)}function substituteMacros(ss,ts){for(let rs=0;rs<ss.length;rs++){let ns=ss[rs];if(typeof ns=="string"){let is=0;for(;is<ns.length;){let as=ns,os=findFirstFullMacroInString(as.slice(is));if(!os.success)break;let ls=os.firstIndMatched+is,us=os.matchLength,cs=os.nDollarSigns,ps,ds=createComponentFromExtendedSource({sourceName:os.sourceName,componentIndex:os.componentIndex,subNames:os.subNames,componentAttributes:os.componentAttributes,propArray:os.propArray,componentInfoObjects:ts}),fs;if(ds.success)fs=ds.newComponent;else{let bs=as.slice(ls,ls+us),vs=ls;if(rs>0&&ss[rs-1].range){let Ns=ss[rs-1].range;Ns.closeEnd?vs+=Ns.closeEnd:Ns.selfCloseEnd&&(vs+=Ns.selfCloseBegin)}throw Error(`${ds.message}. At indices ${vs}-${vs+us}.  Found: ${bs}`)}markCreatedFromMacro([fs]),os.propArray.length===0&&(fs.doenetAttributes.isPlainMacro=!0),ps=[fs];let hs=1,ys=as.substring(ls+us);if(cs===2){let bs=as.slice(ls+us).match(/^\s*\(/);if(!bs){is=ls+2;continue}let vs=us+bs[0].length,Ns=[],Ts=!1;as.length>ls+vs&&(Ts=!0,Ns.push(as.substring(ls+vs))),Ns.push(...ss.slice(rs+1));let Cs=createEvaluateIfFindMatchedClosingParens({componentsFromMacro:ps,remainingComponents:Ns,includeFirstInRemaining:Ts,componentInfoObjects:ts});if(!Cs.success){is=ls+2;continue}ps=Cs.componentsFromMacro,hs=Cs.lastComponentIndMatched+1,Ts||hs++,ys=""}let gs=[];ls>0&&gs.push(as.substring(0,ls)),gs.push(...ps),ys.length>0&&gs.push(ys),ss.splice(rs,hs,...gs),ls>0&&rs++;break}}}}function createComponentFromExtendedSource({sourceName:ss,componentIndex:ts,componentAttributes:rs,propArray:ns,subNames:is,componentInfoObjects:as}){let os={componentType:"copy",doenetAttributes:{target:ss},attributes:{}};if(ts){let us=[ts];applyMacros(us,as),os.attributes.componentIndex={component:{componentType:"integer",children:us}}}if((is==null?void 0:is.length)>0){let us=[],cs=[];for(let ps of is)us.push(ps.subName),ps.subNameComponentIndex!==void 0&&(cs.length<us-1&&cs.push(...Array[us-1-cs.length].fill(NaN)),cs.push(ps.subNameComponentIndex));if(os.attributes.sourceSubnames={primitive:us},cs.length>0){let ps=[cs.join(" ")];applyMacros(ps,as),os.attributes.sourceSubnamesComponentIndex={component:{componentType:"numberList",children:ps}}}}let ls=!1;if(rs){ls=!0;let us=createAttributesFromString(rs,as);if(!us.success)return us;Object.assign(os.attributes,us.newAttributes),us.assignNames&&(os.props={assignNames:us.assignNames})}for(let us of ns){if(ls&&(os.doenetAttributes.createdFromMacro=!0,os={componentType:"extract",attributes:{},doenetAttributes:{},children:[os]}),os.attributes.prop={primitive:us.prop},us.propIndex){let cs=[us.propIndex.join(" ")];applyMacros(cs,as),os.attributes.propIndex={component:{componentType:"numberList",children:cs}}}if(us.attributes){let cs=createAttributesFromString(us.attributes,as);if(!cs.success)return cs;Object.assign(os.attributes,cs.newAttributes),cs.assignNames&&(os.props={assignNames:cs.assignNames})}ls=!0}return{success:!0,newComponent:os}}function createAttributesFromString(ss,ts){let rs=`<copy ${ss} />`,ns;try{ns=parseAndCompile(rs)}catch{return{success:!1,message:"Error in macro"}}createAttributesFromProps(ns,ts),markCreatedFromMacro(ns),applyMacros(ns,ts);let is=ns[0].attributes;if(is.prop||is.propIndex||is.componentIndex)return{success:!1,message:"Error in macro: macro cannot directly add attributes prop, propIndex, or componentIndex"};let as;if(ns[0].props){for(let os in ns[0].props)if(os.toLowerCase()==="assignnames"){if(as)return{success:!1,message:"Error in macro: cannot repeat assignNames"};as=ns[0].props[os]}}return{success:!0,newAttributes:is,assignNames:as}}function findFirstFullMacroInString(ss){let ts=0,rs;for(;;){let ns=ss.substring(ts).match(/(\$+)(.?)/);if(!ns)return{success:!1};if(rs=ns[1].length,ts+=ns.index+rs,rs<=2){let is=!1,as=ss.substring(ts),os=0,ls=findWordOrDelimitedGroup(as,is);ls.startDelim==="("&&(is=!0,as=ls.group,os=ls.group.length);let us=buildSourcePieces(as,is);if(us.success){if(is){if(us.matchLength!==os)return{success:!1};us.matchLength+=2}return us.nDollarSigns=rs,us.firstIndMatched=ts-rs,us.matchLength+=rs,us}}}}function buildSourcePieces(ss,ts){let rs=findWordOrDelimitedGroup(ss,ts),ns=0;if(rs.withPeriod||!rs.word)return{success:!1};let is={sourceName:(rs.withSlash?"/":"")+rs.word};ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts),rs.startDelim==="["&&(is.componentIndex=rs.group,ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts));let as=[];for(;rs.withSlash;){let ls={subName:rs.word};ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts),rs.startDelim==="["&&(ls.subNameComponentIndex=rs.group,ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts)),as.push(ls)}is.subNames=as,rs.startDelim==="{"&&(is.componentAttributes=rs.group,ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts));let os=[];for(;rs.withPeriod;){let ls={prop:rs.word};ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts);let us=[];for(;rs.startDelim==="[";)us.push(rs.group),ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts);us.length>0&&(ls.propIndex=us),rs.startDelim==="{"&&(ls.attributes=rs.group,ns+=rs.matchLength,ss=ss.substring(rs.matchLength),rs=findWordOrDelimitedGroup(ss,ts)),os.push(ls)}return is.propArray=os,is.matchLength=ns,is.success=!0,is}function findWordOrDelimitedGroup(ss,ts=!1){let rs=!1,ns=!1;ss[0]==="."&&ss[1]!=="."&&(rs=!0,ss=ss.substring(1));let is;ts?rs?is=/^[\w-]+/:(ss[0]==="/"&&ss[1].match(/\w/)&&(ns=!0,ss=ss.substring(1)),is=/^([\w\/-]|\.\.\/)+/):is=/^[a-zA-Z_]\w*/;let as=ss.match(is);if(as)return{success:!0,withPeriod:rs,withSlash:ns,word:as[0],matchLength:as[0].length+(rs?1:0)+(ns?1:0)};if(rs||ns)return{success:!1};let os=[],ls={"(":")","{":"}","[":"]"},us=Object.values(ls),cs=ss[0],ps=ls[cs];if(!ps)return{success:!1};os.push(ps);for(let ds=1;ds<ss.length;ds++){let fs=ss[ds];if(fs in ls)os.push(ls[fs]);else if(us.includes(fs)){if(fs!==os.pop())return{success:!1};if(os.length===0)return{success:!0,group:ss.substring(1,ds),startDelim:cs,matchLength:ds+1}}}return{success:!1}}function markCreatedFromMacro(ss){for(let ts of ss)ts.doenetAttributes||(ts.doenetAttributes={}),ts.doenetAttributes.createdFromMacro=!0,ts.children&&markCreatedFromMacro(ts.children)}function createEvaluateIfFindMatchedClosingParens({componentsFromMacro:ss,remainingComponents:ts,includeFirstInRemaining:rs,componentInfoObjects:ns}){let is=findFirstUnmatchedClosingParens(ts);if(!is.success)return is;let as=is.componentInd;ts=ts.slice(0,as+1);let os=ts[as],ls="";is.charInd+1<os.length&&(ls=os.substring(is.charInd+1)),is.charInd>0?ts[as]=os.substring(0,is.charInd):ts=ts.slice(0,as);let us=breakEmbeddedStringByCommas({childrenList:ts});us.pieces.forEach(fs=>applyMacros(fs,ns));let cs=us.pieces.map(fs=>fs.length===1&&typeof fs[0]!="string"?fs[0]:{componentType:"math",doenetAttributes:{createdFromMacro:!0},children:fs}),ds=[{componentType:"evaluate",doenetAttributes:{createdFromMacro:!0},attributes:{function:{component:{componentType:"function",doenetAttributes:{createdFromMacro:!0},children:ss}},input:{component:{componentType:"mathList",doenetAttributes:{createdFromMacro:!0},children:cs}}}}];return ls.length>0&&ds.push(ls),{success:!0,componentsFromMacro:ds,lastComponentIndMatched:as}}function findFirstUnmatchedClosingParens(ss){let ts=0;for(let[rs,ns]of ss.entries())if(typeof ns=="string"){let is=ns;for(let as=0;as<is.length;as++){let os=is[as];if(os==="(")ts++;else if(os===")"){if(ts===0)return{success:!0,componentInd:rs,charInd:as};ts--}}}return{success:!1}}function decodeXMLEntities(ss){function ts(rs){return rs.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&dollar;/g,"$").replace(/&amp;/g,"&")}for(let[rs,ns]of ss.entries())if(typeof ns=="string")ss[rs]=ts(ns);else if(ns.children&&decodeXMLEntities(ns.children),ns.attributes)for(let is in ns.attributes){let as=ns.attributes[is];as.component?decodeXMLEntities([as.component]):as.primitive?typeof as.primitive=="string"&&(as.primitive=ts(as.primitive)):(as.childrenForComponent&&decodeXMLEntities(as.childrenForComponent),as.rawString&&(as.rawString=ts(as.rawString)))}}function applySugar({serializedComponents:ss,parentParametersFromSugar:ts={},parentAttributes:rs={},componentInfoObjects:ns,parentUniqueId:is="",isAttributeComponent:as=!1}){for(let[os,ls]of ss.entries()){if(typeof ls!="object")continue;let us=ls.componentType,cs=ns.allComponentClasses[us];if(!cs)throw Error(`Unrecognized component type ${us}`);let ps=is+"|"+us+os,ds={};for(let fs in ls.attributes){let hs=ls.attributes[fs];hs.primitive!==void 0&&(ds[fs]=hs.primitive)}if(ls.children){let fs={};if(!ls.skipSugar)for(let[hs,ys]of cs.returnSugarInstructions().entries()){let gs=ls.children.map(Cs=>typeof Cs=="string"?"s":"n").join("");if(ys.childrenRegex){let Cs=gs.match(ys.childrenRegex);if(!Cs||Cs[0].length!==ls.children.length)continue}let bs=deepClone(ls.children),vs=0;for(let Cs of bs)typeof Cs!="string"&&(Cs.preSugarInd=vs,vs++);let Ns=!1;ls.doenetAttributes&&ls.doenetAttributes.createdFromMacro&&(Ns=!0);let Ts=ys.replacementFunction({matchedChildren:bs,parentParametersFromSugar:ts,parentAttributes:rs,componentAttributes:ds,uniqueId:ps+"|sugar"+hs,componentInfoObjects:ns,isAttributeComponent:as,createdFromMacro:Ns});if(Ts.success){let Cs=Ts.newChildren,xs=Ts.newAttributes,As=[],ws=[];if(Cs&&(As=findPreSugarIndsAndMarkFromSugar(Cs)),xs)for(let Ss in xs){let Ds=xs[Ss].component;Ds&&ws.push(...findPreSugarIndsAndMarkFromSugar(Ds.children))}let Es=[...As,...ws];if(Es.length!==vs||!Es.sort((Ss,Ds)=>Ss-Ds).every((Ss,Ds)=>Ss===Ds))throw Error(`Invalid sugar for ${us} as didn't return set of original components`);if(As.length>0&&![...As].sort((Ds,Vs)=>Ds-Vs).every((Ds,Vs)=>Ds===As[Vs]))throw Error(`Invalid sugar for ${us} as didn't return original components in order`);Ts.parametersForChildrenSugar&&Object.assign(fs,Ts.parametersForChildrenSugar),Cs?ls.children=Cs:ls.children=[],xs&&(ls.attributes||(ls.attributes={}),Object.assign(ls.attributes,xs))}}cs.removeBlankStringChildrenPostSugar&&(ls.children=ls.children.filter(hs=>typeof hs!="string"||/\S/.test(hs))),applySugar({serializedComponents:ls.children,parentParametersFromSugar:fs,parentAttributes:ds,componentInfoObjects:ns,parentUniqueId:ps})}if(ls.attributes)for(let fs in ls.attributes){let hs=ls.attributes[fs];hs.component&&applySugar({serializedComponents:[hs.component],parentAttributes:ds,componentInfoObjects:ns,parentUniqueId:ps,isAttributeComponent:!0})}}}function breakStringInPiecesBySpacesOrParens(ss){if(typeof ss!="string")return{success:!1};let ts=0,rs=[];ss=ss.trim();let ns=0;for(let as=0;as<ss.length;as++){let os=ss[as];if(os==="("){if(ts===0){let ls=ss.substring(ns,as).trim();ls.length>0&&rs.push(ls),ns=as}ts++}else if(os===")"){if(ts===0)return{success:!1};if(ts===1){let ls=ss.substring(ns+1,as).trim();if(ls.length>0){let us=breakStringInPiecesBySpacesOrParens(ls);us.success===!0?rs.push(us.pieces):rs.push(ls)}ns=as+1}ts--}else if(ts===0&&os.match(/\s/)){let ls=ss.substring(ns,as).trim();ls.length>0&&rs.push(ls),ns=as}}if(ts!==0)return{success:!1};let is=ss.substring(ns,ss.length).trim();return is.length>0&&rs.push(is),{success:!0,pieces:rs}}function countRegularComponentTypesInNamespace(ss,ts={}){var rs,ns;for(let is of ss)if(typeof is=="object"){let as=is.componentType,os=ts[as];os===void 0&&(os=0);let ls=is.doenetAttributes;ls!=null&&ls.isAttributeChild||ls!=null&&ls.createdFromSugar||ls!=null&&ls.createdFromMacro||(ts[as]=++os),is.children&&!((ns=(rs=is.attributes)==null?void 0:rs.newNamespace)!=null&&ns.primitive)&&(ts=countRegularComponentTypesInNamespace(is.children,ts))}return ts}function renameAutonameBasedOnNewCounts(ss,ts={}){var ns,is;let rs={...ts};for(let as of ss)if(typeof as=="object"){let os=as.componentType,ls=rs[os];ls===void 0&&(ls=0);let us=as.doenetAttributes;if(!(us!=null&&us.isAttributeChild||us!=null&&us.createdFromSugar||us!=null&&us.createdFromMacro)&&(rs[os]=++ls,as.componentName)){let cs=as.componentName.lastIndexOf("/"),ps=as.componentName.substring(cs+1),ds="_"+os.toLowerCase();ps.substring(0,ds.length)===ds&&(as.componentName=as.componentName.substring(0,cs+1)+ds+ls)}as.children&&!((is=(ns=as.attributes)==null?void 0:ns.newNamespace)!=null&&is.primitive)&&(rs=renameAutonameBasedOnNewCounts(as.children,rs))}return rs}function createComponentNames({serializedComponents:ss,namespaceStack:ts=[],componentInfoObjects:rs,parentDoenetAttributes:ns={},parentName:is,useOriginalNames:as=!1,attributesByTargetComponentName:os,indOffset:ls=0,createNameContext:us="",initWithoutShadowingComposite:cs=!1}){var fs,hs,ys;ts.length===0&&ts.push({namespace:"",componentCounts:{},namesUsed:{}});let ps=ts.length-1,ds=ts[ps];for(let[gs,bs]of ss.entries()){if(typeof bs!="object")continue;let vs=bs.componentType,Ns=rs.allComponentClasses[vs],Ts=bs.doenetAttributes;Ts===void 0&&(Ts=bs.doenetAttributes={});let Cs=bs.attributes;Cs||(Cs=bs.attributes={}),Ts.createNameFromComponentType&&(vs=Ts.createNameFromComponentType);let xs=Ts.prescribedName,As=Ts.assignNames,ws=Ts.target,Es=Ts.isAttributeChild||Ts.createdFromSugar||Ts.createdFromMacro||Ts.createUniqueName,Ss;((fs=Cs.newNamespace)!=null&&fs.primitive||as&&bs.originalAttributes&&bs.originalAttributes.newNamespace)&&(Ss=!0);let Ds=xs!==void 0,Vs=bs.props;if(Vs===void 0)Vs=bs.props={};else for(let Ps in Vs){let $s=Ps.toLowerCase();if($s==="name")if(xs===void 0)xs=Vs[Ps],delete Vs[Ps];else throw Error(`Cannot define name twice.  Found in component of type ${vs}${indexRangeString(bs)}`);else if($s==="assignnames")if(As===void 0){let Rs=breakStringInPiecesBySpacesOrParens(Vs[Ps]);if(Rs.success)As=Rs.pieces;else throw Error(`Invalid format for assignnames.  Found in component of type ${vs}${indexRangeString(bs)}`);delete Vs[Ps]}else throw Error(`Cannot define assignNames twice for a component.  Found in component of type ${vs}${indexRangeString(bs)}`);else if($s==="target")if(ws===void 0){if(typeof Vs[Ps]!="string")throw Error(`Must specify value for target.  Found in component of type ${vs}${indexRangeString(bs)}`);ws=Vs[Ps].trim(),delete Vs[Ps]}else throw Error(`Cannot define target twice for a component.  Found in component of type ${vs}${indexRangeString(bs)}`)}if(xs){if(!Ds&&!Ts.createdFromSugar){if(!/[a-zA-Z]/.test(xs.substring(0,1)))throw Error(`Invalid component name: ${xs}.  Component name must begin with a letter.  Found in component of type ${vs}${indexRangeString(bs)}`);if(!/^[a-zA-Z0-9_\-]+$/.test(xs))throw Error(`Invalid component name: ${xs}.  Component name can contain only letters, numbers, hyphens, and underscores.  Found in component of type ${vs}${indexRangeString(bs)}`)}Ts.prescribedName=xs}else if(Es){let Ps=is+"|createUniqueName|";bs.downstreamDependencies?Ps+=JSON.stringify(bs.downstreamDependencies):Ps+=gs+"|"+ls+"|"+us,xs=createUniqueName(vs.toLowerCase(),Ps)}if(!As&&as&&bs.originalDoenetAttributes&&bs.originalDoenetAttributes.assignNames&&(As=bs.originalDoenetAttributes.assignNames),As){if(!Ns.assignNamesToReplacements)throw Error(`Cannot assign names for component type ${vs}${indexRangeString(bs)}`);if(Ts.assignNames=As,!Ts.createUniqueAssignNames){let $s=flattenDeep(As);if(!Ts.fromCopyTarget&&!Ts.fromCopyFromURI)for(let Rs of $s){if(!/[a-zA-Z]/.test(Rs.substring(0,1)))throw Error(`All assigned names must begin with a letter.  Found in component of type ${vs}${indexRangeString(bs)}`);if(!/^[a-zA-Z0-9_\-]+$/.test(Rs))throw Error(`Assigned names can contain only letters, numbers, hyphens, and underscores.  Found in component of type ${vs}${indexRangeString(bs)}`)}if($s.length!==new Set($s).size)throw Error(`Duplicate assigned names.  Found in component of type ${vs}${indexRangeString(bs)}`)}}Ss&&(Cs.newNamespace={primitive:Ss});let Is=ds.componentCounts[vs];Is===void 0&&(Is=0),Ts.isAttributeChild||Ts.createdFromSugar||Ts.createdFromMacro||(ds.componentCounts[vs]=++Is);let Os="";for(let Ps=0;Ps<=ps;Ps++)Os+=ts[Ps].namespace+"/";if(!xs){if(as&&bs.originalName){let Ps=bs.originalName.lastIndexOf("/");xs=bs.originalName.substring(Ps+1)}xs||(xs="_"+vs.toLowerCase()+Is)}if(Ts.nameBecomesAssignNames){Ss&&(Cs.assignNewNamespaces={primitive:!0},delete Cs.newNamespace,Ss=!1),As=Ts.assignNames=[xs],delete Ts.nameBecomesAssignNames;let Ps=is+"|createUniqueName|";Ts.createUniqueName=!0,delete Ts.prescribedName,bs.downstreamDependencies?Ps+=JSON.stringify(bs.downstreamDependencies):Ps+=gs+"|"+ls+"|"+us,xs=createUniqueName("copy",Ps)}if(Os+=xs,bs.componentName=Os,xs){if(xs in ds.namesUsed)throw Error(`Duplicate component name ${Os}.  Found in component of type ${vs}${indexRangeString(bs)}`);ds.namesUsed[xs]=!0}if(!Ss&&As)for(let Ps of flattenDeep(As)){if(Ps in ds.namesUsed)throw Error(`Duplicate component name ${Ps} (from assignNames of ${Os}).  Found in component of type ${vs}${indexRangeString(bs)}`);ds.namesUsed[Ps]=!0}if(bs.doenetAttributes.createUniqueAssignNames&&bs.originalName){let Ps=bs.doenetAttributes.assignNames;Ps||(Ps=bs.doenetAttributes.originalAssignNames);let $s=Os+"|createUniqueName|assignNames|",Rs="",ks;if(Ss)Rs=Os+"/",ks=bs.originalName+"/";else{for(let Us=0;Us<=ps;Us++)Rs+=ts[Us].namespace+"/";let Bs=bs.originalName.lastIndexOf("/");ks=bs.originalName.slice(0,Bs+1)}let _s=createNewAssignNamesAndrenameMatchingTargetNames({originalAssignNames:Ps,longNameIdBase:$s,namespace:Rs,oldNamespace:ks,attributesByTargetComponentName:os});As=bs.doenetAttributes.assignNames=_s}if(renameMatchingTargetNames(bs,os),ws){if(!Ns.acceptTarget)throw Error(`Component type ${vs} does not accept a target attribute.   Found in component ${Os}${indexRangeString(bs)}`);if(ws.includes("|"))throw Error(`target cannot include |.  Found in component of type ${vs}${indexRangeString(bs)}`);Ts.target=ws,Ts.targetComponentName=convertComponentTarget({relativeName:ws,oldAbsoluteName:Ts.targetComponentName,namespaceStack:ts,acceptDoubleUnderscore:Ts.createdFromSugar||Ts.allowDoubleUnderscoreTarget})}for(let Ps in Cs){let $s=Cs[Ps];if($s.targetComponentNames)for(let Rs of $s.targetComponentNames)Rs.absoluteName=convertComponentTarget({relativeName:Rs.relativeName,oldAbsoluteName:Rs.absoluteName,namespaceStack:ts,acceptDoubleUnderscore:Ts.createdFromSugar||Ts.allowDoubleUnderscoreTarget})}if(bs.children)if(Ss||(hs=Cs.assignNewNamespaces)!=null&&hs.primitive){let Ps={};As&&flattenDeep(As).forEach(ks=>Ps[ks]=!0);let $s=bs.children;if(Ts.nameFirstChildIndependently&&bs.children.length>0){$s=$s.slice(1);let ks={namespace:xs,componentCounts:{},namesUsed:{}};ts.push(ks),createComponentNames({serializedComponents:[bs.children[0]],namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os}),ts.pop()}let Rs={namespace:xs,componentCounts:{},namesUsed:Ps};if(Ts.haveNewNamespaceOnlyFromShadow){let ks=!0,_s=[...$s];for(;_s.length>0;){let Bs=[];for(let Us of _s){if(!!((ys=Us.doenetAttributes)!=null&&ys.ignoreParentNewNamespace)===ks)break;Bs.push(Us)}_s.splice(0,Bs.length),ks?ts.push(Rs):cs&&Bs.forEach(Us=>Us.doenetAttributes.createUniqueName=!0),createComponentNames({serializedComponents:Bs,namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os}),ks&&ts.pop(),ks=!ks}}else ts.push(Rs),createComponentNames({serializedComponents:$s,namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os}),ts.pop()}else{let Ps=bs.children;if(Ts.nameFirstChildIndependently&&Ps.length>0){Ps=Ps.slice(1);let $s=ds.namesUsed,Rs=ds.componentCounts;ds.namesUsed={},ds.componentCounts={},createComponentNames({serializedComponents:[bs.children[0]],namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os}),ds.namesUsed=$s,ds.componentCounts=Rs}createComponentNames({serializedComponents:Ps,namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os})}if(bs.attributes)for(let Ps in bs.attributes){let $s=bs.attributes[Ps];if($s.component){let Rs=$s.component;Rs.doenetAttributes||(Rs.doenetAttributes={}),Rs.doenetAttributes.isAttributeChild=!0,$s.ignoreFixed&&(Rs.doenetAttributes.ignoreParentFixed=!0),createComponentNames({serializedComponents:[Rs],namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os,createNameContext:Ps})}else $s.childrenForComponent&&createComponentNames({serializedComponents:$s.childrenForComponent,namespaceStack:ts,componentInfoObjects:rs,parentDoenetAttributes:Ts,parentName:Os,useOriginalNames:as,attributesByTargetComponentName:os,createNameContext:Ps})}}return ss}function createNewAssignNamesAndrenameMatchingTargetNames({originalAssignNames:ss,longNameIdBase:ts,namespace:rs,oldNamespace:ns,attributesByTargetComponentName:is}){let as=[];for(let[os,ls]of ss.entries())if(Array.isArray(ls)){let us=createNewAssignNamesAndrenameMatchingTargetNames({originalAssignNames:ls,longNameIdBase:ts+os+"_",namespace:rs,oldNamespace:ns,attributesByTargetComponentName:is});as.push(us)}else{let us=ts+os,cs=createUniqueName("fromAssignNames",us);as.push(cs);let ps={componentName:rs+cs,originalName:ns+ls};renameMatchingTargetNames(ps,is,!0)}return as}function convertComponentTarget({relativeName:ss,oldAbsoluteName:ts,namespaceStack:rs,acceptDoubleUnderscore:ns}){if(!ts&&/__/.test(ss)&&!ns)throw Error("Invalid reference target: "+ss);let is;if(ss.substring(0,1)==="/")is=ss;else{let as=rs.length-1;for(;ss.substring(0,3)==="../";)ss=ss.substring(3),as--;as<0&&(as=0),is="";for(let os=0;os<=as;os++)is+=rs[os].namespace+"/";is+=ss}return is}function serializedComponentsReplacer(ss,ts){return ts!==ts?{objectType:"special-numeric",stringValue:"NaN"}:ts===1/0?{objectType:"special-numeric",stringValue:"Infinity"}:ts===-1/0?{objectType:"special-numeric",stringValue:"-Infinity"}:ts}let nanInfinityReviver=function(ss,ts){if(ts&&ts.objectType==="special-numeric"){if(ts.stringValue==="NaN")return NaN;if(ts.stringValue==="Infinity")return 1/0;if(ts.stringValue==="-Infinity")return-1/0}return ts};function serializedComponentsReviver(ss,ts){return Context.reviver(ss,theModule.Subset.reviver(ss,nanInfinityReviver(ss,ts)))}function processAssignNames({assignNames:ss=[],assignNewNamespaces:ts=!1,serializedComponents:rs,parentName:ns,parentCreatesNewNamespace:is,componentInfoObjects:as,indOffset:os=0,originalNamesAreConsistent:ls=!1,shadowingComposite:us=!1}){var ys,gs;let cs=rs.length;moveComponentNamesToOriginalNames(rs);let ps={},ds=null;if(ls){if(cs>0){let bs=rs.filter(vs=>typeof vs=="object")[0];if(bs&&bs.originalName){let vs=bs.originalName.lastIndexOf("/");ds=bs.originalName.substring(0,vs)}}if(ds!==null)for(let bs of rs)setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ds,components:[bs],attributesByTargetComponentName:ps})}else for(let bs=0;bs<cs;bs++){let vs=rs[bs];if(typeof vs=="object"){if(ds=null,cs>0&&vs.originalName){let Ns=vs.originalName.lastIndexOf("/");ds=vs.originalName.substring(0,Ns)}ds!==null&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ds,components:[vs],attributesByTargetComponentName:ps})}}let fs=[],hs=0;for(let bs=0;bs<cs;bs++){let vs=bs+os,Ns=rs[bs];if(typeof Ns!="object"){hs++,fs.push(Ns);continue}let Ts=ss[vs-hs];if(Ns.doenetAttributes||(Ns.doenetAttributes={}),!ls&&(ds=null,cs>0&&Ns.originalName)){let Cs=Ns.originalName.lastIndexOf("/");ds=Ns.originalName.substring(0,Cs)}if(Ts){if(as.allComponentClasses[Ns.componentType].assignNamesSkipOver)Ts=[Ts];else if((ys=Ns.attributes)!=null&&ys.assignNamesSkip){let Cs=Ns.attributes.assignNamesSkip.primitive;if(Cs>0)for(let xs=0;xs<Cs;xs++)Ts=[Ts]}}if(ts&&(Ns.attributes||(Ns.attributes={}),Ns.attributes.newNamespace={primitive:!0}),Array.isArray(Ts))if(as.allComponentClasses[Ns.componentType].assignNamesToReplacements){let Cs=ns+"|assignName|"+vs.toString();Ns.doenetAttributes.prescribedName=createUniqueName(Ns.componentType.toLowerCase(),Cs);let xs=ns;if(!is){let As=ns.lastIndexOf("/");xs=ns.substring(0,As)}xs+="/"+Ns.doenetAttributes.prescribedName,Ns.componentName=xs,Ns.doenetAttributes.assignNames=Ts,fs.push(Ns);continue}else console.warn(`Cannot assign names recursively to ${Ns.componentType}`),Ts=null;if(!Ts)if(ls&&Ns.originalName&&!((gs=Ns.doenetAttributes)!=null&&gs.createUniqueName))Ts=Ns.originalName.slice(ds.length+1);else{let Cs=ns+"|assignName|"+vs.toString();Ts=createUniqueName(Ns.componentType.toLowerCase(),Cs)}Ns.doenetAttributes.prescribedName=Ts,ls&&!Ns.doenetAttributes.assignNames&&Ns.originalDoenetAttributes&&Ns.originalDoenetAttributes.assignNames&&(Ns.doenetAttributes.assignNames=Ns.originalDoenetAttributes.assignNames),createComponentNamesFromParentName({parentName:ns,ind:vs,component:Ns,parentCreatesNewNamespace:is,componentInfoObjects:as,attributesByTargetComponentName:ps,originalNamesAreConsistent:ls,shadowingComposite:us}),fs.push(Ns)}return{serializedComponents:fs}}function createComponentNamesFromParentName({parentName:ss,component:ts,ind:rs,parentCreatesNewNamespace:ns,componentInfoObjects:is,attributesByTargetComponentName:as,originalNamesAreConsistent:os,shadowingComposite:ls}){var ds;let us=ss.split("/");ns||us.pop();let cs=us.map(fs=>({namespace:fs,componentCounts:{},namesUsed:{}}));ss[0]!=="/"&&cs.splice(0,0,{componentCounts:{},namesUsed:{},namespace:""}),ts.doenetAttributes||(ts.doenetAttributes={}),ts.attributes||(ts.attributes={});let ps;(ds=ts.attributes.newNamespace)!=null&&ds.primitive||os?ps=!0:(ps=!1,ts.children&&markToCreateAllUniqueNames(ts.children));for(let fs in ts.attributes){let hs=ts.attributes[fs];hs.component?markToCreateAllUniqueNames([hs.component]):hs.childrenForComponent&&markToCreateAllUniqueNames(hs.childrenForComponent)}createComponentNames({serializedComponents:[ts],namespaceStack:cs,componentInfoObjects:is,parentName:ss,useOriginalNames:ps,attributesByTargetComponentName:as,indOffset:rs,initWithoutShadowingComposite:!ls})}function setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ss,components:ts,attributesByTargetComponentName:rs}){let ns=ss.length;for(let is of ts)if(typeof is=="object"){if(is.doenetAttributes&&is.doenetAttributes.target){let as=is.doenetAttributes.targetComponentName;as!==void 0&&(as.substring(0,ns)!==ss&&(is.doenetAttributes.target=as),rs[as]||(rs[as]=[]),rs[as].push(is.doenetAttributes))}for(let as in is.attributes){let os=is.attributes[as];if(os.targetComponentNames)for(let ls of os.targetComponentNames){let us=ls.absoluteName;us!==void 0&&(us.substring(0,ns)!==ss&&(ls.relativeName=us),rs[us]||(rs[us]=[]),rs[us].push(ls))}}if(is.children&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ss,components:is.children,attributesByTargetComponentName:rs}),is.attributes)for(let as in is.attributes){let os=is.attributes[as];os.component?setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ss,components:[os.component],attributesByTargetComponentName:rs}):os.childrenForComponent&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:ss,components:os.childrenForComponent,attributesByTargetComponentName:rs})}}}function renameMatchingTargetNames(ss,ts,rs=!1){if(ss.originalName&&ts&&ss.componentName!==ss.originalName){if(ts[ss.originalName])for(let ns of ts[ss.originalName])ns.relativeName?(ns.relativeName=ss.componentName,ns.absoluteName=ss.componentName):(ns.target=ss.componentName,ns.targetComponentName=ss.componentName);if(rs){let ns=ss.originalName+"/",is=ns.length;for(let as in ts)if(as.substring(0,is)===ns){let os=as.substring(is);for(let ls of ts[as])ls.relativeName?(ls.relativeName=ss.componentName+"/"+os,ls.absoluteName=ss.componentName+"/"+os):(ls.target=ss.componentName+"/"+os,ls.targetComponentName=ss.componentName+"/"+os)}}}}function moveComponentNamesToOriginalNames(ss){for(let ts of ss)if(ts.componentName&&(ts.originalName=ts.componentName,delete ts.componentName),ts.children&&moveComponentNamesToOriginalNames(ts.children),ts.attributes)for(let rs in ts.attributes){let ns=ts.attributes[rs];ns.component?moveComponentNamesToOriginalNames([ns.component]):ns.childrenForComponent&&moveComponentNamesToOriginalNames(ns.childrenForComponent)}}function markToCreateAllUniqueNames(ss){var ts,rs;for(let ns of ss)if(typeof ns=="object"&&(ns.doenetAttributes||(ns.doenetAttributes={}),ns.doenetAttributes.createUniqueName=!0,delete ns.doenetAttributes.prescribedName,(rs=(ts=ns.attributes)==null?void 0:ts.newNamespace)!=null&&rs.primitive||(ns.doenetAttributes.assignNames?(ns.doenetAttributes.createUniqueAssignNames=!0,ns.doenetAttributes.originalAssignNames=ns.doenetAttributes.assignNames,delete ns.doenetAttributes.assignNames):ns.originalDoenetAttributes&&ns.originalDoenetAttributes.assignNames&&(ns.doenetAttributes.createUniqueAssignNames=!0,ns.doenetAttributes.originalAssignNames=ns.originalDoenetAttributes.assignNames),ns.children&&markToCreateAllUniqueNames(ns.children)),ns.attributes))for(let is in ns.attributes){let as=ns.attributes[is];as.component?markToCreateAllUniqueNames([as.component]):as.childrenForComponent&&markToCreateAllUniqueNames(as.childrenForComponent)}}function setTNamesToAbsolute(ss){for(let ts of ss){if(ts.doenetAttributes&&ts.doenetAttributes.target){let rs=ts.doenetAttributes.targetComponentName;rs!==void 0&&(ts.doenetAttributes.target=rs)}if(ts.children&&setTNamesToAbsolute(ts.children),ts.attributes)for(let rs in ts.attributes){let ns=ts.attributes[rs];ns.component?setTNamesToAbsolute([ns.component]):ns.childrenForComponent&&setTNamesToAbsolute(ns.childrenForComponent)}}}function restrictTNamesToNamespace({components:ss,namespace:ts,parentNamespace:rs,parentIsCopy:ns=!1,invalidateReferencesToBaseNamespace:is=!1}){var os;rs===void 0&&(rs=ts);let as=ts.length;for(let ls of ss){if(ls.doenetAttributes&&ls.doenetAttributes.target){let us=ls.doenetAttributes.target;if(us[0]==="/"){if(us.substring(0,as)!==ts){let cs=ts.split("/").slice(1),ps=us.split("/").slice(1),ds=!1,fs=ts+us.slice(1);for(;cs.length>0&&cs[0]===ps[0];)cs=cs.slice(1),ps=ps.slice(1),ds=!0;if(ds)fs=ts+ps.join("/");else{let hs=ts.split("/").slice(1);for(let ys=1;ys<hs.length;ys++){let gs="/"+hs.slice(ys).join("/");if(us.substring(0,gs.length)===gs){fs="/"+hs.slice(0,ys).join("/")+us;break}}}ls.doenetAttributes.target=fs,ls.doenetAttributes.targetComponentName=fs}else if(is){let cs=us.lastIndexOf("/");us.slice(0,cs+1)===ts&&(ls.doenetAttributes.target="",ls.doenetAttributes.targetComponentName="")}}else if(us.substring(0,3)==="../"){let cs=us,ps=rs;for(;cs.substring(0,3)==="../";){cs=cs.substring(3);let ds=ps.substring(0,ps.length-1).lastIndexOf("/");if(ps=ps.substring(0,ds+1),ps.substring(0,as)!==ts){for(;cs.substring(0,3)==="../";)cs=cs.substring(3);let fs=ts+cs;ls.doenetAttributes.target=fs,ls.doenetAttributes.targetComponentName=fs;break}}if(is){let ds=ls.doenetAttributes.targetComponentName,fs=ds.lastIndexOf("/");ds.slice(0,fs+1)===ts&&(ls.doenetAttributes.target="",ls.doenetAttributes.targetComponentName="")}}}if(ls.children){let us=ts;ns&&ls.componentType==="externalContent"&&(us=ls.componentName+"/");let cs=rs;ls.attributes&&((os=ls.attributes.newNamespace)!=null&&os.primitive)&&(cs=ls.componentName),restrictTNamesToNamespace({components:ls.children,namespace:us,parentNamespace:cs,parentIsCopy:ls.componentType==="copy",invalidateReferencesToBaseNamespace:is})}if(ls.attributes)for(let us in ls.attributes){let cs=ls.attributes[us];cs.component?restrictTNamesToNamespace({components:[cs.component],namespace:ts,parentNamespace:rs,invalidateReferencesToBaseNamespace:is}):cs.childrenForComponent&&restrictTNamesToNamespace({components:cs.childrenForComponent,namespace:ts,parentNamespace:rs,invalidateReferencesToBaseNamespace:is})}}}function indexRangeString(ss){let ts="";if(ss.range){let rs,ns;ss.range.selfCloseBegin!==void 0?(rs=ss.range.selfCloseBegin,ns=ss.range.selfCloseEnd):ss.range.openBegin!==void 0&&(rs=ss.range.openBegin,ns=ss.range.closeEnd),rs!==void 0&&(ts+=` at indices ${rs}-${ns}`)}return ts}function extractComponentNamesAndIndices(ss,ts={}){var ns;let rs=[];for(let is of ss)if(typeof is=="object"){let as=is.componentName;for(let ls in ts)as=as.replace(ls,ts[ls]);if((ns=is.doenetAttributes)!=null&&ns.fromCopyTarget){let ls=as.lastIndexOf("/"),us=as.slice(ls+1),cs=is.doenetAttributes.assignNames[0];as=as.replace(us,cs),ts[us]=cs}let os={componentName:as};is.range&&(is.range.selfCloseBegin!==void 0?(os.indBegin=is.range.selfCloseBegin,os.indEnd=is.range.selfCloseEnd):is.range.openBegin!==void 0&&(os.indBegin=is.range.openBegin,os.indEnd=is.range.closeEnd)),rs.push(os),is.children&&rs.push(...extractComponentNamesAndIndices(is.children,{...ts}))}return rs}function extractRangeIndexPieces({componentArray:ss,lastInd:ts=0,stopInd:rs=1/0,enclosingComponentName:ns}){let is=[],as=0,os=!1;for(;as<ss.length;){let ls=ss[as];if(ls.indBegin===void 0){as++;continue}if(ls.indBegin>rs){ns&&ts<=rs&&is.push({begin:ts,end:rs,componentName:ns}),os=!0;break}ns&&ls.indBegin>ts&&is.push({begin:ts,end:ls.indBegin-1,componentName:ns});let us=extractRangeIndexPieces({componentArray:ss.slice(as+1),lastInd:ls.indBegin,stopInd:ls.indEnd,enclosingComponentName:ls.componentName});as+=us.componentsConsumed+1,is.push(...us.rangePieces),ts=ls.indEnd+1}return!os&&Number.isFinite(rs)&&rs>=ts&&is.push({begin:ts,end:rs,componentName:ns}),{componentsConsumed:as,rangePieces:is}}function createStateProxyHandler(){return{get:function(ss,ts){let rs=ss[ts];return rs!==void 0&&(rs.isArray&&(rs.public||rs.trackChanges)?rs=new Proxy(rs.value,createArrayProxyHandler({variable:ts,nDimensions:rs.nDimensions})):rs=rs.value),rs},set:function(ss,ts,rs){throw Error("Property "+ts+" is read-only")},deleteProperty:function(ss,ts){throw Error("Property "+ts+" is read-only")}}}function createArrayProxyHandler({variable:ss,nDimensions:ts,indicesSoFar:rs=[]}){return{variable:ss,nDimensions:ts,indicesSoFar:rs,get:function(ns,is){if(is==="then"&&ns instanceof Promise)return os=>ns.then.bind(ns)(ls=>os(ls!==null&&typeof ls=="object"?new Proxy(ls,createArrayProxyHandler({variable:this.variable,nDimensions:this.nDimensions,indicesSoFar:this.indicesSoFar})):ls));let as=ns[is];return as!==null&&typeof as=="object"&&ts>1&&(as=new Proxy(as,createArrayProxyHandler({variable:this.variable,nDimensions:this.nDimensions-1,indicesSoFar:[...this.indicesSoFar,is]}))),as},set:function(ns,is,as){throw Error("Property "+is+" is read-only")},deleteProperty:function(ns,is){throw Error("Property "+is+" is read-only")}}}function postProcessCopy({serializedComponents:ss,componentName:ts,addShadowDependencies:rs=!0,markAsPrimaryShadow:ns=!1,uniqueIdentifiersUsed:is=[],identifierPrefix:as="",unlinkExternalCopies:os=!1,copiesByTargetComponentName:ls={},componentNamesFound:us=[],assignNamesFound:cs=[],activeAliases:ps=[],init:ds=!0}){var fs;for(let hs in ss){let ys=ss[hs];if(typeof ys!="object")continue;let gs;if(ys.originalName){if(os){if(us.push(ys.originalName),ys.originalDoenetAttributes&&ys.originalDoenetAttributes.assignNames){let bs;if((fs=ys.attributes.newNamespace)!=null&&fs.primitive)bs=ys.originalName;else{let vs=ys.originalName.lastIndexOf("/");bs=ys.originalName.substring(0,vs)}for(let vs of ys.originalDoenetAttributes.assignNames)us.push(bs+"/"+vs),cs.push(bs+"/"+vs)}ys.attributes&&(ys.attributes.alias&&ps.push(ys.attributes.alias.primitive),ys.attributes.indexAlias&&ps.push(ys.attributes.indexAlias.primitive))}if(gs=as+ys.originalName+"|shadow",!ys.originalNameFromSerializedComponent)if(rs){let bs={[ys.originalName]:[{dependencyType:"referenceShadow",compositeName:ts}]};if(ds&&(bs[ys.originalName][0].firstLevelReplacement=!0),ns&&(bs[ys.originalName][0].isPrimaryShadow=!0),ys.state){let vs=Object.keys(ys.state);bs[ys.originalName].downstreamStateVariables=vs,bs[ys.originalName].upstreamStateVariables=vs}ys.downstreamDependencies=bs}else ys.unlinkedCopySource=ys.originalName}else gs=as+ys.componentType+"|shadowUnnamed";if(ys.componentType==="copy"&&os){let bs=ys.doenetAttributes.targetComponentName;if(bs)ps.includes(ys.doenetAttributes.target)?ys.doenetAttributes.targetComponentName=ys.doenetAttributes.target:(ls[bs]===void 0&&(ls[bs]=[]),ls[bs].push(ys));else if(!ys.attributes.uri)throw Error("we need to create a targetComponentName here, then.")}ys.uniqueIdentifier=getUniqueIdentifierFromBase(gs,is)}for(let hs in ss){let ys=ss[hs];if(typeof ys=="object"){postProcessCopy({serializedComponents:ys.children,componentName:ts,addShadowDependencies:rs,markAsPrimaryShadow:ns,uniqueIdentifiersUsed:is,identifierPrefix:as,unlinkExternalCopies:os,copiesByTargetComponentName:ls,componentNamesFound:us,assignNamesFound:cs,activeAliases:[...ps],init:!1});for(let gs in ys.attributes){let bs=ys.attributes[gs];bs.component&&(bs.component=postProcessCopy({serializedComponents:[bs.component],componentName:ts,addShadowDependencies:rs,markAsPrimaryShadow:ns,uniqueIdentifiersUsed:is,identifierPrefix:as,unlinkExternalCopies:os,copiesByTargetComponentName:ls,componentNamesFound:us,assignNamesFound:cs,activeAliases:[...ps],init:!1})[0])}ys.replacements&&postProcessCopy({serializedComponents:ys.replacements,componentName:ts,addShadowDependencies:rs,markAsPrimaryShadow:ns,uniqueIdentifiersUsed:is,identifierPrefix:as,unlinkExternalCopies:os,copiesByTargetComponentName:ls,componentNamesFound:us,assignNamesFound:cs,activeAliases:[...ps],init:!1})}}if(ds&&os){for(let hs in ls)if(!us.includes(hs)){let ys=!1;for(let gs of cs){let bs=gs+"/",vs=bs.length;if(hs.substring(0,vs)===bs){ys=!0;break}}if(!ys)for(let gs of ls[hs])gs.attributes||(gs.attributes={}),gs.attributes.link={primitive:!1},gs.doenetAttributes.target=gs.doenetAttributes.targetComponentName}}return ss}function convertAttributesForComponentType({attributes:ss,componentType:ts,componentInfoObjects:rs,compositeAttributesObj:ns={},compositeCreatesNewNamespace:is,flags:as}){var ps;let os=rs.allComponentClasses[ts],ls=os.createAttributesObject(),us={};for(let ds in ls)us[ds.toLowerCase()]=ds;let cs={};for(let ds in ss){if(ds in ns&&!ns[ds].leaveRaw)continue;let fs=us[ds.toLowerCase()],hs=ls[fs];if(hs){if(fs in cs)throw Error(`Cannot repeat prop ${fs}`);if(cs[fs]=componentFromAttribute({attrObj:hs,value:JSON.parse(JSON.stringify(ss[ds])),componentInfoObjects:rs}),(ps=cs[fs].component)!=null&&ps.children){let ys=[cs[fs].component];if(applyMacros(ys,rs),removeBlankStringChildren(ys,rs),applySugar({serializedComponents:ys,componentInfoObjects:rs,isAttributeComponent:!0}),is){for(let gs of cs[fs].component.children)if(gs.componentType==="copy"){let bs=gs.doenetAttributes.target;/[a-zA-Z_]/.test(bs[0])&&(gs.doenetAttributes.target="../"+bs)}}}}else os.acceptAnyAttribute&&(cs[ds]=JSON.parse(JSON.stringify(ss[ds])))}return cs}async function verifyReplacementsMatchSpecifiedType({component:ss,replacements:ts,replacementChanges:rs,assignNames:ns,workspace:is={},componentInfoObjects:as,compositeAttributesObj:os,flags:ls}){var fs,hs,ys,gs,bs;if(!((fs=ss.attributes.createComponentOfType)!=null&&fs.primitive)&&!ss.sharedParameters.compositesMustHaveAReplacement)return{replacements:ts,replacementChanges:rs};let us=ss.replacementsToWithhold,cs;if(!rs)as.isInheritedComponentType({inheritedComponentType:ss.componentType,baseComponentType:"template"})&&(ts=ts.filter(vs=>vs.componentType||vs.trim().length>0)),cs=ts.map(vs=>vs.componentType),cs.length===1&&cs[0]==="externalContent"&&(cs=ts[0].children.filter(vs=>vs.componentType||vs.trim().length>0).map(vs=>vs.componentType));else{cs=ss.replacements.map(vs=>vs.componentType);for(let vs of rs)if(vs.changeType==="add"){if(vs.replacementsToWithhold!==void 0&&(us=vs.replacementsToWithhold),!vs.changeTopLevelReplacements)continue;if(vs.serializedReplacements){let Ns=vs.numberReplacementsToReplace;Ns>0||(Ns=0);let Ts=vs.firstReplacementInd,Cs=vs.serializedReplacements.map(xs=>xs.componentType);cs.splice(Ts,Ns,...Cs)}}else if(vs.changeType==="delete"){if(vs.replacementsToWithhold!==void 0&&(us=vs.replacementsToWithhold),vs.changeTopLevelReplacements){let Ns=vs.firstReplacementInd,Ts=vs.numberReplacementsToDelete;cs.splice(Ns,Ts)}}else vs.changeType==="changeReplacementsToWithhold"&&vs.replacementsToWithhold!==void 0&&(us=vs.replacementsToWithhold)}if(us>0&&(cs=cs.slice(0,cs.length-us)),!((hs=ss.attributes.createComponentOfType)!=null&&hs.primitive)&&ss.sharedParameters.compositesMustHaveAReplacement&&cs.length>0)return{replacements:ts,replacementChanges:rs};let ps=(ys=ss.attributes.createComponentOfType)==null?void 0:ys.primitive,ds=await ss.stateValues.nComponentsSpecified;if(!ps){if(ps=ss.sharedParameters.compositesDefaultReplacementType,!ps)throw Error("A component class specified descendantCompositesMustHaveAReplacement but didn't specify descendantCompositesDefaultReplacementType");ds=1}if(ps=as.componentTypeLowerCaseMapping[ps.toLowerCase()],cs.length!==ds||!cs.every(vs=>vs===ps)){if((ts==null?void 0:ts.length)===1&&as.isInheritedComponentType({inheritedComponentType:ts[0].componentType,baseComponentType:"template"}))return ts[0].attributes||(ts[0].attributes={}),ts[0].attributes.createComponentOfType={primitive:ps},ts[0].attributes.nComponents={primitive:ds},{replacements:ts,replacementChanges:rs};let vs=cs.length===ds&&!(us>0)&&((gs=is.sourceNames)==null?void 0:gs.length)===ds,Ns;vs&&rs&&(rs.length===1&&rs[0].numberReplacementsToReplace===ds?Ns=rs[0].serializedReplacements:vs=!1),vs?Ns||(Ns=ts):(is.numReplacementsBySource=[],is.numNonStringReplacementsBySource=[],is.propVariablesCopiedBySource=[],is.sourceNames=[],is.uniqueIdentifiersUsedBySource={},is.uniqueIdentifiersUsedBySource[0]=[]);let Ts=(bs=ss.attributes.newNamespace)==null?void 0:bs.primitive;ts=[];for(let xs=0;xs<ds;xs++){let As=convertAttributesForComponentType({attributes:ss.attributes,componentType:ps,componentInfoObjects:as,compositeAttributesObj:os,compositeCreatesNewNamespace:Ts,flags:ls}),ws=ps+"|empty"+xs,Es=getUniqueIdentifierFromBase(ws,is.uniqueIdentifiersUsedBySource[0]);ts.push({componentType:ps,attributes:As,uniqueIdentifier:Es})}if(vs)for(let[xs,As]of ts.entries())As.children=[Ns[xs]];if(ts=processAssignNames({assignNames:ns,serializedComponents:ts,parentName:ss.componentName,parentCreatesNewNamespace:Ts,componentInfoObjects:as}).serializedComponents,is.numReplacementsBySource.push(ts.length),is.numNonStringReplacementsBySource.push(ts.filter(xs=>typeof xs!="string").length),rs){rs=[],ss.replacementsToWithhold>0&&rs.push({changeType:"changeReplacementsToWithhold",replacementsToWithhold:0});let xs=0;ss.replacements&&(xs=ss.replacements.length),rs.push({changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:xs,serializedReplacements:ts})}}return{replacements:ts,replacementChanges:rs}}function gatherDescendants({ancestor:ss,descendantTypes:ts,recurseToMatchedChildren:rs=!0,useReplacementsForComposites:ns=!1,includeNonActiveChildren:is=!1,skipOverAdapters:as=!1,ignoreReplacementsOfMatchedComposites:os=!1,ignoreReplacementsOfEncounteredComposites:ls=!1,init:us=!0,componentInfoObjects:cs}){let ps=hs=>ts.some(ys=>cs.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:ys})),ds=[];if(ns&&cs.isInheritedComponentType({inheritedComponentType:ss.componentType,baseComponentType:"_composite"}))us&&ds.push(...replacementsForComposites({composite:ss,componentInfoObjects:cs,includeComposites:is}).filter(hs=>typeof hs=="object"));else for(let hs of ss.allChildrenOrdered){let ys=ss.allChildren[hs],gs,bs=!1,vs=!1;if(ys)gs=ys.component,gs.adaptedFrom&&(vs=!0),ss.activeChildren.includes(gs)&&(bs=!0);else for(let Ns of ss.activeChildren)if(Ns.placeholderInd===hs){gs=Ns,bs=!0,typeof hs=="string"&&hs.substring(hs.length-5,hs.length)==="adapt"&&(vs=!0);break}else if(Ns.adaptedFrom&&achild.adaptedFrom.placeholderInd===hs){gs=Ns.adaptedFrom;break}gs&&(vs&&as?ds.includes(gs.adaptedFrom)||ds.push(gs.adaptedFrom):(bs||is)&&ds.push(gs))}if(os||ls){let hs=[];for(let ys of ds){let gs=ps(ys);ls&&!gs&&(gs=!(ys.componentType==="copy"&&ys.doenetAttributes.copiedURI)),gs&&cs.isInheritedComponentType({inheritedComponentType:ys.componentType,baseComponentType:"_composite"})&&(hs=[...hs,...replacementsForComposites({composite:ys,componentInfoObjects:cs,includeComposites:!0}).filter(bs=>typeof bs=="object").map(bs=>bs.componentName?bs.componentName:bs.placeholderInd)])}hs.length>0&&(ds=ds.filter(ys=>!(hs.includes(ys.componentName)||hs.includes(ys.placeholderInd))))}let fs=[];for(let hs of ds){let ys=ps(hs);if(ys&&fs.push({componentName:hs.componentName?hs.componentName:hs.placeholderInd,componentType:hs.componentType}),(!ys||rs)&&hs.placeholderInd===void 0){let gs=gatherDescendants({ancestor:hs,descendantTypes:ts,recurseToMatchedChildren:rs,useReplacementsForComposites:ns,includeNonActiveChildren:is,skipOverAdapters:as,ignoreReplacementsOfMatchedComposites:os,ignoreReplacementsOfEncounteredComposites:ls,init:!1,componentInfoObjects:cs});fs.push(...gs)}}return fs}function replacementsForComposites({composite:ss,includeComposites:ts=!1,componentInfoObjects:rs}){let ns=[];if(ss.replacements){let is;if(ss.replacementsToWithhold){let as=ss.replacements.length-ss.replacementsToWithhold;is=ss.replacements.slice(0,as)}else is=ss.replacements;for(let as of is)rs.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"_composite"})?(ts&&ns.push(as),ns.push(...replacementsForComposites({composite:as,componentInfoObjects:rs,includeComposites:ts}))):ns.push(as)}return ns}function ancestorsIncludingComposites(ss,ts){if(ss.ancestors===void 0||ss.ancestors.length===0)return[];let rs=[ss.ancestors[0].componentName],ns=ts[ss.ancestors[0].componentName];if(ns&&rs.push(...ancestorsIncludingComposites(ns,ts)),ss.replacementOf){rs.push(ss.replacementOf.componentName);let is=ancestorsIncludingComposites(ss.replacementOf,ts);for(let as of is)rs.includes(as)||rs.push(as)}return rs}const dependencyTypeArray=[];class DependencyHandler{constructor({_components:ts,componentInfoObjects:rs,core:ns}){this.upstreamDependencies={},this.downstreamDependencies={},this.switchDependencies={},this.circularCheckPassed={},this.circularResolveBlockedCheckPassed={},this.dependencyTypes={},dependencyTypeArray.forEach(is=>this.dependencyTypes[is.dependencyType]=is),this.core=ns,this._components=ts,this.componentInfoObjects=rs,this.updateTriggers={descendantDependenciesByAncestor:{},ancestorDependenciesByPotentialAncestor:{},replacementDependenciesByComposite:{},childDependenciesByParent:{},parentDependenciesByParent:{},dependenciesMissingComponentBySpecifiedName:{},dependenciesBasedOnDependenciesOfStateVariables:{},primaryShadowDependencies:{}},this.resolveBlockers={neededToResolve:{},resolveBlockedBy:{}}}async setUpComponentDependencies(ts){this.downstreamDependencies[ts.componentName]&&this.deleteAllDownstreamDependencies({component:ts}),this.downstreamDependencies[ts.componentName]={},this.upstreamDependencies[ts.componentName]||(this.upstreamDependencies[ts.componentName]={});let rs=[],ns=[];for(let is in ts.state)ts.state[is].isArrayEntry||ts.state[is].isAlias||ns.includes(is)||(rs.push(is),ts.state[is].additionalStateVariablesDefined&&ns.push(...ts.state[is].additionalStateVariablesDefined));for(let is of rs){let as=[is];ts.state[is].additionalStateVariablesDefined&&as.push(...ts.state[is].additionalStateVariablesDefined),await this.setUpStateVariableDependencies({component:ts,stateVariable:is,allStateVariablesAffected:as})}}async setUpStateVariableDependencies({component:ts,stateVariable:rs,allStateVariablesAffected:ns}){let is=ts.state[rs],as;is.stateVariablesDeterminingDependencies?(as={},is.stateVariablesDeterminingDependencies&&(as.__determine_dependencies={dependencyType:"determineDependencies",variableNames:is.stateVariablesDeterminingDependencies})):as=await is.returnDependencies({componentInfoObjects:this.componentInfoObjects,sharedParameters:ts.sharedParameters});for(let os in as){let ls=as[os];if(!(ls.dependencyType in this.dependencyTypes))throw Error(`Unrecognized dependency type ${ls.dependencyType} for ${os} of ${rs} of ${ts.componentName}`);let us=new this.dependencyTypes[ls.dependencyType]({component:ts,stateVariable:rs,allStateVariablesAffected:ns,dependencyName:os,dependencyDefinition:ls,dependencyHandler:this,expandComposites:!1,forceExpandComposites:!1});await us.initialize(),us.checkForCircular()}}deleteAllDownstreamDependencies({component:ts,stateVariables:rs="__all__"}){let ns=ts.componentName,is;rs==="__all__"?is=Object.keys(this.downstreamDependencies[ns]):is=rs;for(let as of is){let os=this.downstreamDependencies[ns][as];for(let ls in os)os[ls].deleteDependency();delete this.downstreamDependencies[ns][as]}Object.keys(this.downstreamDependencies[ns]).length===0&&!this.components[ns]&&delete this.downstreamDependencies[ns]}async deleteAllUpstreamDependencies({component:ts,stateVariables:rs="__all__",completelyDelete:ns=!1}){let is=ts.componentName,as;rs==="__all__"?as=Object.keys(this.upstreamDependencies[is]):as=rs;for(let os of as){if(this.upstreamDependencies[is][os])for(let ls of[...this.upstreamDependencies[is][os]])if(ns){for(let us of ls.upstreamVariableNames)this._components[ls.upstreamComponentName].state[us].initiallyResolved&&await this.core.markStateVariableAndUpstreamDependentsStale({component:this.components[ls.upstreamComponentName],varName:us});ls.deleteDependency()}else await ls.removeDownstreamComponent({indexToRemove:ls.downstreamComponentNames.indexOf(is)});delete this.upstreamDependencies[is][os]}Object.keys(this.upstreamDependencies[is]).length===0&&!this._components[is]&&delete this.upstreamDependencies[is]}async addBlockersFromChangedStateVariableDependencies({componentName:ts,stateVariables:rs}){let ns=this.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[ts];if(ns)for(let is of rs){let as=ns[is];if(as)for(let os of as)if(os.gettingValue){let ls=os.varsWithUpdatedDeps[ts];ls||(ls=os.varsWithUpdatedDeps[ts]=[]),ls.includes(is)||ls.push(is)}else for(let ls of os.upstreamVariableNames)await this.addBlocker({blockerComponentName:os.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ls,blockerDependency:os.dependencyName,componentNameBlocked:os.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ls})}}async addBlockersFromChangedActiveChildren({parent:ts}){if(await this.collateCountersAndPropagateToAncestors(ts),this.updateTriggers.childDependenciesByParent[ts.componentName])for(let rs of this.updateTriggers.childDependenciesByParent[ts.componentName]){for(let ns of rs.upstreamVariableNames)await this.addBlocker({blockerComponentName:rs.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:rs.dependencyName,componentNameBlocked:rs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});await this.addBlockersFromChangedStateVariableDependencies({componentName:rs.upstreamComponentName,stateVariables:rs.upstreamVariableNames})}if(ts.ancestors){if(this.updateTriggers.parentDependenciesByParent[ts.componentName])for(let rs of this.updateTriggers.parentDependenciesByParent[ts.componentName]){for(let ns of rs.upstreamVariableNames)await this.addBlocker({blockerComponentName:rs.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:rs.dependencyName,componentNameBlocked:rs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});await this.addBlockersFromChangedStateVariableDependencies({componentName:rs.upstreamComponentName,stateVariables:rs.upstreamVariableNames})}for(let rs of[ts.componentName,...ancestorsIncludingComposites(ts,this.components)])await this.addDescendantBlockersToAncestor(rs);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[ts.componentName])for(let rs of this.updateTriggers.ancestorDependenciesByPotentialAncestor[ts.componentName]){for(let ns of rs.upstreamVariableNames)await this.addBlocker({blockerComponentName:rs.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:rs.dependencyName,componentNameBlocked:rs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});await this.addBlockersFromChangedStateVariableDependencies({componentName:rs.upstreamComponentName,stateVariables:rs.upstreamVariableNames})}}}async resolveBlockersFromChangedActiveChildren(ts,rs=!1){if(await this.collateCountersAndPropagateToAncestors(ts),this.updateTriggers.childDependenciesByParent[ts.componentName])for(let ns of this.updateTriggers.childDependenciesByParent[ts.componentName])await this.resolveIfReady({componentName:ns.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:ns.representativeStateVariable,dependency:ns.dependencyName,force:rs});if(ts.ancestors){if(this.updateTriggers.parentDependenciesByParent[ts.componentName])for(let ns of this.updateTriggers.parentDependenciesByParent[ts.componentName])await this.resolveIfReady({componentName:ns.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:ns.representativeStateVariable,dependency:ns.dependencyName,force:rs});for(let ns of[ts.componentName,...ancestorsIncludingComposites(ts,this.components)])await this.resolveDescendantBlockersToAncestor(ns,rs);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[ts.componentName])for(let ns of this.updateTriggers.ancestorDependenciesByPotentialAncestor[ts.componentName])await this.resolveIfReady({componentName:ns.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:ns.representativeStateVariable,dependency:ns.dependencyName,force:rs})}}async addDescendantBlockersToAncestor(ts){if(this.updateTriggers.descendantDependenciesByAncestor[ts])for(let rs of this.updateTriggers.descendantDependenciesByAncestor[ts]){for(let ns of rs.upstreamVariableNames)await this.addBlocker({blockerComponentName:rs.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:rs.dependencyName,componentNameBlocked:rs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});await this.addBlockersFromChangedStateVariableDependencies({componentName:rs.upstreamComponentName,stateVariables:rs.upstreamVariableNames})}}async resolveDescendantBlockersToAncestor(ts,rs=!1){if(this.updateTriggers.descendantDependenciesByAncestor[ts])for(let ns of this.updateTriggers.descendantDependenciesByAncestor[ts])await this.resolveIfReady({componentName:ns.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:ns.representativeStateVariable,dependency:ns.dependencyName,force:rs})}async addBlockersFromChangedReplacements(ts){if(this.updateTriggers.replacementDependenciesByComposite[ts.componentName])for(let rs of this.updateTriggers.replacementDependenciesByComposite[ts.componentName])for(let ns of rs.upstreamVariableNames)await this.addBlocker({blockerComponentName:rs.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:rs.dependencyName,componentNameBlocked:rs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});for(let rs of[ts.componentName,...ancestorsIncludingComposites(ts,this.components)])await this.addDescendantBlockersToAncestor(rs)}checkForCircularDependency({componentName:ts,varName:rs,previouslyVisited:ns=[]}){let is=ts+":"+rs;if(ns.includes(is)){console.log("found circular",is,ns);let as=/^(.*):/,os=ns.map(cs=>cs.match(as)[1]),ls=os.filter(cs=>cs.slice(0,2)!=="__").reduce((cs,ps)=>cs.includes(ps)?cs:[...cs,ps],[]);ls.length===0&&(ls=[os[0]]);let us;throw ls.length===1?us=ls[0]:ls.length===2?us=ls.join(" and "):(ls[ls.length-2]=ls.slice(ls.length-2).join(", and "),ls.pop(),us=ls.join(", ")),Error(`Circular dependency involving ${us}`)}else ns=[...ns,is];if(!this.circularCheckPassed[is]&&(this.circularCheckPassed[is]=!0,ts in this.downstreamDependencies)){let as=this.downstreamDependencies[ts][rs];for(let os in as){let ls=as[os],us=ls.downstreamComponentNames;if(!us)continue;let cs=ls.mappedDownstreamVariableNamesByComponent;if(cs)for(let[ps,ds]of us.entries()){let fs=cs[ps];for(let hs of fs)this.checkForCircularDependency({componentName:ds,varName:hs,previouslyVisited:ns})}}}}resetCircularCheckPassed(ts,rs){let ns=ts+":"+rs;if(this.circularCheckPassed[ns]){delete this.circularCheckPassed[ns];let is=this.upstreamDependencies[ts][rs];if(is)for(let as of is)for(let os of as.upstreamVariableNames)os!=="__identity"&&this.resetCircularCheckPassed(as.upstreamComponentName,os)}}async updateDependencies({componentName:ts,stateVariable:rs,dependency:ns}){let is=this._components[ts],as=is.state[rs],os=[rs];as.additionalStateVariablesDefined&&os.push(...as.additionalStateVariablesDefined);let ls=this.downstreamDependencies[ts][rs].__determine_dependencies,us;if(ls){let fs=!0;if(ls.originalDownstreamVariableNames.length>0)for(let[hs,ys]of ls.downstreamComponentNames.entries()){let gs=this._components[ys];for(let bs of ls.mappedDownstreamVariableNamesByComponent[hs]){let vs=gs.state[bs].isResolved;if(vs||(vs=(await this.resolveItem({componentName:ys,type:"stateVariable",stateVariable:bs})).success),!vs){fs=!1;for(let Ns of os)await this.addBlocker({blockerComponentName:ys,blockerType:"stateVariable",blockerStateVariable:bs,componentNameBlocked:ts,typeBlocked:"determineDependencies",stateVariableBlocked:Ns,dependencyBlocked:ns})}}}if(fs)us=await ls.getValue();else return{success:!1}}else us={changes:{},value:{stateValues:{}}};if(Object.keys(us.changes).length===0&&as._previousValue!==void 0)return{success:!0};let cs={stateValues:Object.assign({},us.value.stateValues),componentInfoObjects:this.componentInfoObjects,sharedParameters:is.sharedParameters},ps=await as.returnDependencies(cs);as.stateVariablesDeterminingDependencies&&(ps.__determine_dependencies={dependencyType:"determineDependencies",variableNames:as.stateVariablesDeterminingDependencies});let ds=await this.replaceDependenciesIfChanged({component:is,stateVariable:rs,newDependencies:ps,allStateVariablesAffected:os});if(!(ds.changedDependency||cs.changedDependency))return{success:!0};for(let fs of ds.newlyCreatedDependencies)fs.checkForCircular();for(let fs of os)this.checkForCircularDependency({componentName:is.componentName,varName:fs}),is.state[fs].forceRecalculation=!0;as.initiallyResolved&&await this.core.markStateVariableAndUpstreamDependentsStale({component:is,varName:rs});for(let fs of os)is.state[fs].initiallyResolved&&this.recordActualChangeInUpstreamDependencies({component:is,varName:fs});return await this.addBlockersFromChangedStateVariableDependencies({componentName:ts,stateVariables:os}),{success:!0}}async replaceDependenciesIfChanged({component:ts,stateVariable:rs,newDependencies:ns,allStateVariablesAffected:is}){let as=this.downstreamDependencies[ts.componentName][rs],os=!1,ls=[];for(let us in as)us in ns||(os=!0,as[us].deleteDependency());for(let us in ns)if(us in as){let cs=ns[us],ps=as[us];if(!deepCompare(cs,ps.definition)){os=!0,as[us].deleteDependency();let ds=ns[us],fs=new this.dependencyTypes[ds.dependencyType]({component:ts,stateVariable:rs,allStateVariablesAffected:is,dependencyName:us,dependencyDefinition:ds,dependencyHandler:this});await fs.initialize(),ls.push(fs)}}else{os=!0;let cs=ns[us],ps=new this.dependencyTypes[cs.dependencyType]({component:ts,stateVariable:rs,allStateVariablesAffected:is,dependencyName:us,dependencyDefinition:cs,dependencyHandler:this});await ps.initialize(),ls.push(ps)}return{changedDependency:os,newlyCreatedDependencies:ls}}async checkForDependenciesOnNewComponent(ts){let rs=[],ns={};if(this.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts]){for(let is of this.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts]){let as=this._components[is.upstreamComponentName];if(!as)continue;let os=!0;for(let us of is.upstreamVariableNames)if(!(us in as.state)){os=!1;break}if(!os)continue;for(let us of is.upstreamVariableNames)as.state[us].initiallyResolved&&(ns[is.upstreamComponentName]&&ns[is.upstreamComponentName][us]||rs.push({componentName:is.upstreamComponentName,varName:us}));for(let us of is.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:is.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:us,dependencyBlocked:is.dependencyName,blockerComponentName:ts,blockerType:"componentIdentity"});if((await this.resolveIfReady({componentName:is.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:is.representativeStateVariable,dependency:is.dependencyName,expandComposites:!1,recurseUpstream:!0})).success)for(let us of is.upstreamVariableNames)as.state[us].initiallyResolved||(ns[is.upstreamComponentName]||(ns[is.upstreamComponentName]={}),ns[is.upstreamComponentName][us]=!0);else for(let us of is.upstreamVariableNames)await this.addBlocker({blockerComponentName:is.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:us,blockerDependency:is.dependencyName,componentNameBlocked:is.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:us})}delete this.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts]}return rs}async getStateVariableDependencyValues({component:ts,stateVariable:rs}){let ns={},is={},as={},os=this.downstreamDependencies[ts.componentName][rs];for(let ls in os){let{value:us,changes:cs,usedDefault:ps}=await os[ls].getValue();ns[ls]=us,Object.keys(cs).length>0&&(is[ls]=cs),ps&&(as[ls]=ps)}return{dependencyValues:ns,changes:is,usedDefault:as}}recordActualChangeInUpstreamDependencies({component:ts,varName:rs,changes:ns}){let is=ts.componentName,as=this.upstreamDependencies[is][rs];if(as){for(let os of as)if(os.valuesChanged){let ls=os.downstreamComponentNames.indexOf(is),us=os.valuesChanged[ls][rs];if(!us&&ts.stateVarAliases)for(let cs in ts.stateVarAliases)ts.stateVarAliases[cs]===rs&&cs in upValuesChangedSub&&(us=upValuesChangedSub[cs]);if(!us){if(!ts.state[rs].isArrayEntry)throw Error(`Something is wrong, as a variable ${rs} of ${ts.componentName} actually changed, but wasn't marked with a potential change`);us=upValuesChangedSub[rs]={changed:{}}}ts.state[rs]&&ts.state[rs].isArray?(us.changed===void 0?us.changed={arrayKeysChanged:{}}:us.changed===!0&&(us.changed={allArrayKeysChanged:!0,arraySizeChanged:!0,arrayKeysChanged:{}}),ns&&(ns.allArrayKeysChanged&&(us.changed.allArrayKeysChanged=!0),ns.arraySizeChanged&&(us.changed.arraySizeChanged=!0),Object.assign(us.changed.arrayKeysChanged,ns.arrayKeysChanged))):us.changed=!0}}}async collateCountersAndPropagateToAncestors(ts){let rs=Object.keys(ts.counters);for(let os of ts.allChildrenOrdered){let ls=this._components[os];if(ls)for(let us in ls.counters)rs.includes(us)||rs.push(us)}let ns=!1;for(let os of rs){let ls=ts.counters[os];ls||(ls=ts.counters[os]={dependencies:[],componentList:[]});let us=[];ls.dependencies.length>0&&us.push(ts.componentName);for(let cs of ts.allChildrenOrdered){let ps=this._components[cs];if(ps){let ds=ps.counters[os];ds&&us.push(...ds.componentList)}}(us.length!==ls.componentList.length||ls.componentList.some((cs,ps)=>cs!=us[ps]))&&(ns=!0,ls.componentList=us)}if(!ns)return{foundChange:!1};if(!ts.ancestors[0]){for(let os of rs){let ls=ts.counters[os];for(let[us,cs]of ls.componentList.entries()){let ps=this._components[cs],ds=ps.counters[os];ds.value=us+1;for(let fs of ds.dependencies)if(ps.state[fs.representativeStateVariable].initiallyResolved){await this.core.markStateVariableAndUpstreamDependentsStale({component:ps,varName:fs.representativeStateVariable});for(let hs of fs.upstreamVariableNames)ps.state[hs].forceRecalculation=!0,this.recordActualChangeInUpstreamDependencies({component:ps,varName:hs})}}}return{foundChange:!0,finishedPropagation:!0}}let is=this._components[ts.ancestors[0].componentName];if(!(is&&is.allChildrenOrdered.includes(ts.componentName)))return{foundChange:!0,finishedPropagation:!1};let as=await this.collateCountersAndPropagateToAncestors(is);return as.foundChange||console.error(`we found a change in propagating counters for ${ts.componentName}, but no change for ancestors!`),{foundChange:!0,finishedPropagation:as.finishedPropagation}}getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is}){let as=this.resolveBlockers.neededToResolve[ts];as||(as=this.resolveBlockers.neededToResolve[ts]={});let os=as[rs];if(os||(os=as[rs]={}),ns){let ls=os;if(os=ls[ns],os||(os=ls[ns]={}),is){let us=os;os=us[is],os||(os=us[is]={})}}return os}deleteFromNeededToResolve({componentNameBlocked:ts,typeBlocked:rs,stateVariableBlocked:ns,dependencyBlocked:is,blockerType:as,blockerCode:os,deleteFromReciprocal:ls=!0}){let us=ts;ns&&(us+="|"+ns,is&&(us+="|"+is));let cs=function(ds){if(as){if(ds[as])if(os){let fs=ds[as].indexOf(os);if(fs!==-1&&ds[as].splice(fs,1),ds[as].length===0&&delete ds[as],ls){let[hs,ys,gs]=os.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:hs,blockerType:as,blockerStateVariable:ys,blockerDependency:gs,typeBlocked:rs,codeBlocked:us,deleteFromReciprocal:!1})}}else{if(ls)for(let fs of ds[as]){let[hs,ys,gs]=fs.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:hs,blockerType:as,blockerStateVariable:ys,blockerDependency:gs,typeBlocked:rs,codeBlocked:us,deleteFromReciprocal:!1})}delete ds[as]}}else if(ls)for(let fs in ds)for(let hs of ds[fs]){let[ys,gs,bs]=hs.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:ys,blockerType:fs,blockerStateVariable:gs,blockerDependency:bs,typeBlocked:rs,codeBlocked:us,deleteFromReciprocal:!1})}}.bind(this),ps=this.resolveBlockers.neededToResolve[ts];if(ps){let ds=ps[rs];if(ds)if(ns){let fs=ds[ns];if(fs)if(is){let hs=fs[is];hs&&(cs(hs),(!as||Object.keys(hs).length===0)&&delete fs[is]),Object.keys(fs).length===0&&delete ds[ns]}else cs(fs),(!as||Object.keys(fs).length===0)&&delete ds[ns];Object.keys(ds).length===0&&delete ps[rs]}else cs(ds),(!as||Object.keys(ds).length===0)&&delete ps[rs];Object.keys(ps).length===0&&delete this.resolveBlockers.neededToResolve[ts]}}checkIfHaveNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is}){let as=this.resolveBlockers.neededToResolve[ts];if(!as)return!1;let os=as[rs];return!os||ns&&(os=os[ns],!os||is&&(os=os[is],!os))?!1:Object.keys(os).length>0}getResolveBlockedBy({componentName:ts,type:rs,stateVariable:ns,dependency:is}){let as=this.resolveBlockers.resolveBlockedBy[ts];as||(as=this.resolveBlockers.resolveBlockedBy[ts]={});let os=as[rs];if(os||(os=as[rs]={}),ns){let ls=os;if(os=ls[ns],os||(os=ls[ns]={}),is){let us=os;os=us[is],os||(os=us[is]={})}}return os}deleteFromResolveBlockedBy({blockerComponentName:ts,blockerType:rs,blockerStateVariable:ns,blockerDependency:is,typeBlocked:as,codeBlocked:os,deleteFromReciprocal:ls=!0}){let us=ts;ns&&(us+="|"+ns,is&&(us+="|"+is));let cs=function(ds){if(as){if(ds[as])if(os){let fs=ds[as].indexOf(os);if(fs!==-1&&ds[as].splice(fs,1),ds[as].length===0&&delete ds[as],ls){let[hs,ys,gs]=os.split("|");this.deleteFromNeededToResolve({componentNameBlocked:hs,typeBlocked:as,stateVariableBlocked:ys,dependencyBlocked:gs,blockerType:rs,blockerCode:us,deleteFromReciprocal:!1})}}else{if(ls)for(let fs of ds[as]){let[hs,ys,gs]=fs.split("|");this.deleteFromNeededToResolve({componentNameBlocked:hs,typeBlocked:as,stateVariableBlocked:ys,dependencyBlocked:gs,blockerType:rs,blockerCode:us,deleteFromReciprocal:!1})}delete ds[as]}}else if(ls)for(let fs in ds)for(let hs of ds[fs]){let[ys,gs,bs]=hs.split("|");this.deleteFromNeededToResolve({componentNameBlocked:ys,typeBlocked:fs,stateVariableBlocked:gs,dependencyBlocked:bs,blockerType:rs,blockerCode:us,deleteFromReciprocal:!1})}}.bind(this),ps=this.resolveBlockers.resolveBlockedBy[ts];if(ps){let ds=ps[rs];if(ds)if(ns){let fs=ds[ns];if(fs)if(is){let hs=fs[is];hs&&(cs(hs),(!as||Object.keys(hs).length===0)&&delete fs[is]),Object.keys(fs).length===0&&delete ds[ns]}else cs(fs),(!as||Object.keys(fs).length===0)&&delete ds[ns];Object.keys(ds).length===0&&delete ps[rs]}else cs(ds),(!as||Object.keys(ds).length===0)&&delete ps[rs];Object.keys(ps).length===0&&delete this.resolveBlockers.resolveBlockedBy[ts]}}async addBlocker({blockerComponentName:ts,blockerType:rs,blockerStateVariable:ns,blockerDependency:is,componentNameBlocked:as,typeBlocked:os,stateVariableBlocked:ls,dependencyBlocked:us}){let cs=ts;ns&&(cs+="|"+ns,is&&(cs+="|"+is));let ps=as;ls&&(ps+="|"+ls,us&&(ps+="|"+us));let ds=this.getNeededToResolve({componentName:as,type:os,stateVariable:ls,dependency:us}),fs=ds[rs];if(fs||(fs=ds[rs]=[]),fs.includes(cs))return;if(fs.push(cs),os==="stateVariable"){let gs=this._components[as];if(gs){let bs=gs.state[ls];if(bs.isResolved=!1,bs.initiallyResolved){await this.core.markStateVariableAndUpstreamDependentsStale({component:gs,varName:ls});let vs=this.upstreamDependencies[as][ls];if(vs){for(let Ns of vs)if(this._components[Ns.upstreamComponentName])for(let Ts of Ns.upstreamVariableNames)await this.addBlocker({blockerComponentName:as,blockerType:"stateVariable",blockerStateVariable:ls,componentNameBlocked:Ns.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:Ts})}}}}let hs=this.getResolveBlockedBy({componentName:ts,type:rs,stateVariable:ns,dependency:is}),ys=hs[os];ys||(ys=hs[os]=[]),ys.includes(ps)||ys.push(ps),this.resetCircularResolveBlockerCheckPassed({componentName:as,type:os,stateVariable:ls,dependency:us}),this.checkForCircularResolveBlocker({componentName:as,type:os,stateVariable:ls,dependency:us})}async processNewlyResolved({componentNameNewlyResolved:ts,typeNewlyResolved:rs,stateVariableNewlyResolved:ns,dependencyNewlyResolved:is,expandComposites:as=!0,force:os=!1,recurseUpstream:ls=!1}){if(rs==="stateVariable"){let cs=this._components[ts];cs&&cs.state[ns]&&(cs.state[ns].isResolved=!0,cs.state[ns].initiallyResolved=!0)}else if(rs==="componentIdentity"){if(!(ts in this._components||os))return{success:!1}}else if(rs==="recalculateDownstreamComponents"){let cs;try{cs=this.downstreamDependencies[ts][ns][is]}catch{}if(cs){let ps=await cs.recalculateDownstreamComponents({force:os});if(!(ps.success||os))return ps;for(let ds of cs.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:cs.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ds,blockerType:"recalculateDownstreamComponents",blockerCode:cs.upstreamComponentName+"|"+ds+"|"+is});for(let ds of cs.upstreamVariableNames)await this.resolveIfReady({componentName:cs.upstreamComponentName,type:"stateVariable",stateVariable:ds,expandComposites:as,force:os,recurseUpstream:ls});return{success:!0}}}else if(rs==="determineDependencies"){let cs;try{cs=this.downstreamDependencies[ts][ns][is]}catch{}if(cs){let ps=this.getNeededToResolve({componentName:ts,type:"stateVariable",stateVariable:ns}),ds=!1,fs=[];if(ps.determineDependencies)for(let ys of ps.determineDependencies){let[gs,bs,vs]=ys.split("|");if(this.checkIfHaveNeededToResolve({componentName:ts,type:"determineDependency",stateVariable:ns,dependency:vs})){ds=!0;break}fs.push(vs)}if(ds)return{success:!0};if(!(await this.updateDependencies({componentName:ts,stateVariable:ns,dependency:is})).success)return{success:!1};for(let ys of cs.upstreamVariableNames){for(let gs of fs)this.deleteFromResolveBlockedBy({blockerComponentName:cs.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:ys,blockerDependency:gs});await this.resolveIfReady({componentName:ts,type:"stateVariable",stateVariable:ys,expandComposites:as,force:os,recurseUpstream:ls})}return{success:!0}}}else if(rs==="childMatches"){let cs=this._components[ts];if(cs&&!cs.childrenMatched&&!(await this.core.deriveChildResultsFromDefiningChildren({parent:cs,expandComposites:as,forceExpandComposites:os})).skipping&&!(cs.childrenMatchedWithPlaceholders||os))return{success:!1}}else if(rs==="expandComposite"){if(!this._components[ts].isExpanded){if(this.core.updateInfo.compositesBeingExpanded.includes(ts))return{success:!1};await this.core.expandCompositeComponent(this._components[ts])}}else throw Error(`Unrecognized type newly resolved: ${rs}`);let us=this.getResolveBlockedBy({componentName:ts,type:rs,stateVariable:ns,dependency:is});us=Object.assign({},us);for(let cs in us)for(let ps of[...us[cs]])if(this.deleteFromResolveBlockedBy({blockerComponentName:ts,blockerType:rs,blockerStateVariable:ns,blockerDependency:is,typeBlocked:cs,codeBlocked:ps}),ls){let[ds,fs,hs]=ps.split("|");await this.resolveIfReady({componentName:ds,type:cs,stateVariable:fs,dependency:hs,expandComposites:as,force:os,recurseUpstream:ls})}return{success:!0}}async resolveStateVariablesIfReady({component:ts,stateVariables:rs}){let ns=ts.componentName;rs||(await this.resolveIfReady({componentName:ns,type:"componentIdentity",expandComposites:!1}),rs=Object.keys(ts.state));for(let is of rs){let as=ts.state[is];if(as&&as.determineDependenciesImmediately){let ls=this.getNeededToResolve({componentName:ns,type:"stateVariable",stateVariable:is}).determineDependencies;if(ls)for(let us of ls){let[cs,ps,ds]=us.split("|");await this.resolveIfReady({componentName:cs,type:"determineDependencies",stateVariable:ps,dependency:ds,expandComposites:!0})}}await this.resolveIfReady({componentName:ns,type:"stateVariable",stateVariable:is,expandComposites:!1})}}async resolveIfReady({componentName:ts,type:rs,stateVariable:ns,dependency:is,expandComposites:as=!0,force:os=!1,recurseUpstream:ls=!1}){return this.checkIfHaveNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is})?{success:!1}:(this.deleteFromNeededToResolve({componentNameBlocked:ts,typeBlocked:rs,stateVariableBlocked:ns,dependencyBlocked:is}),await this.processNewlyResolved({componentNameNewlyResolved:ts,typeNewlyResolved:rs,stateVariableNewlyResolved:ns,dependencyNewlyResolved:is,expandComposites:as,force:os,recurseUpstream:ls}))}async resolveItem({componentName:ts,type:rs,stateVariable:ns,dependency:is,force:as=!1,recurseUpstream:os=!1,expandComposites:ls=!0,numPreviouslyNeeded:us}){let cs=this.getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is}),ps=cs.determineDependencies;if(ps&&ps.length>0)for(let gs of[...ps]){let[bs,vs,Ns]=gs.split("|"),Ts=await this.resolveItem({componentName:bs,type:"determineDependencies",stateVariable:vs,dependency:Ns,force:as,expandComposites:ls});if(!Ts.success)return Ts}let ds;rs==="stateVariable"&&this._components[ts]&&(ds=this._components[ts].state[ns],ds&&(ds.currentlyResolving=!0));let fs=1/0,hs=1/0;for(;(Object.keys(cs).length>0||hs>0)&&!(Number.isFinite(hs)&&hs>=fs);){hs>0&&(cs=this.getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is})),fs=hs,hs=0;for(let gs in cs){if(gs==="determineDependencies")throw Error(`Shouldn't have determine dependencies blocker after determining dependencies: ${ts}, ${rs}, ${ns}, ${is}`);for(let bs of[...cs[gs]]){let[vs,Ns,Ts]=bs.split("|"),Cs=await this.resolveItem({componentName:vs,type:gs,stateVariable:Ns,dependency:Ts,expandComposites:ls});if(!Cs.success)if(as)hs++;else return Cs}}}if(hs>0)for(cs=this.getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is});Object.keys(cs).length>0;)for(let gs in cs){if(gs==="determineDependencies")throw Error(`Shouldn't have determine dependencies blocker after determining dependencies: ${ts}, ${rs}, ${ns}, ${is}`);for(let bs of[...cs[gs]]){let[vs,Ns,Ts]=bs.split("|"),Cs=await this.resolveItem({componentName:vs,type:gs,stateVariable:Ns,dependency:Ts,force:as,expandComposites:ls});if(!Cs.success)return Cs}}ds&&(ds.currentlyResolving=!1);let ys=await this.resolveIfReady({componentName:ts,type:rs,stateVariable:ns,dependency:is,force:as,recurseUpstream:os,expandComposites:ls});if(!ys.success){let gs=this.getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is}),bs=Object.keys(gs).length;bs>0&&(us===void 0||bs<us)&&(ys=await this.resolveItem({componentName:ts,type:rs,stateVariable:ns,dependency:is,force:as,recurseUpstream:os,expandComposites:ls,numPreviouslyNeeded:bs}))}return ys}checkForCircularResolveBlocker({componentName:ts,type:rs,stateVariable:ns,dependency:is,previouslyVisited:as=[]}){var us;let os=ts;ns&&(os+="|"+ns,is&&(os+="|"+is));let ls=os+"|"+rs;if(as.includes(ls)){console.log("found circular",ls,as);let cs=/^([^\|]*)\|/,ps=as.map(vs=>vs.match(cs)[1]),ds=ps.filter(vs=>vs.slice(0,2)!=="__").reduce((vs,Ns)=>vs.includes(Ns)?vs:[...vs,Ns],[]);ds.length===0&&(ds=[ps[0]]);let fs;ds.length===1?fs=ds[0]:ds.length===2?fs=ds.join(" and "):(ds[ds.length-2]=ds.slice(ds.length-2).join(", and "),ds.pop(),fs=ds.join(", "));let hs=[],ys=[];for(let vs of as){let[Ns,Ts]=vs.split("|"),Cs=this._components[Ns];Cs&&this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:Cs.componentType,baseComponentType:"_composite"})&&!((us=Cs.attributes.createComponentOfType)!=null&&us.primitive)&&(Ts==="readyToExpandWhenResolved"?hs.push(Ns):Ts===Cs.constructor.stateVariableToEvaluateAfterReplacements&&ys.push(Ns))}let gs=!1;for(let vs of hs)if(ys.includes(vs)){gs=!0;break}let bs=`Circular dependency involving ${fs}.`;throw gs&&(bs+="  Specifying the type of a composite component may address this circular dependency."),Error(bs)}else as=[...as,ls];if(!this.circularResolveBlockedCheckPassed[ls]){this.circularResolveBlockedCheckPassed[ls]=!0;let cs=this.getNeededToResolve({componentName:ts,type:rs,stateVariable:ns,dependency:is});for(let ps in cs)for(let ds of cs[ps]){let[fs,hs,ys]=ds.split("|");this.checkForCircularResolveBlocker({componentName:fs,type:ps,stateVariable:hs,dependency:ys,previouslyVisited:as})}}}resetCircularResolveBlockerCheckPassed({componentName:ts,type:rs,stateVariable:ns,dependency:is}){let as=ts;ns&&(as+="|"+ns,is&&(as+="|"+is));let os=as+"|"+rs;if(this.circularResolveBlockedCheckPassed[os]){delete this.circularResolveBlockedCheckPassed[os];let ls=this.getResolveBlockedBy({componentName:ts,type:rs,stateVariable:ns,dependency:is});for(let us in ls)for(let cs of ls[us]){let[ps,ds,fs]=cs.split("|");this.resetCircularResolveBlockerCheckPassed({componentName:ps,type:us,stateVariable:ds,dependency:fs})}}}get components(){return this._components}set components(ts){return null}}class Dependency{constructor({component:ts,stateVariable:rs,allStateVariablesAffected:ns,dependencyName:is,dependencyDefinition:as,dependencyHandler:os}){Ms(this,"downstreamVariableNameIfNoVariables","__identity");this.dependencyName=is,this.dependencyHandler=os,this.upstreamComponentName=ts.componentName,this.upstreamVariableNames=ns,this.definition=Object.assign({},as),this.representativeStateVariable=rs,as.doNotProxy&&(this.doNotProxy=!0),as.variablesOptional&&(this.variablesOptional=!0),as.publicStateVariablesOnly&&(this.publicStateVariablesOnly=!0),as.caseInsensitiveVariableMatch&&(this.caseInsensitiveVariableMatch=!0),as.useMappedVariableNames&&(this.useMappedVariableNames=!0),as.propIndex&&(as.propIndex.every(Number.isFinite)?this.propIndex=as.propIndex.map(Math.round):this.propIndex=[]),this.returnSingleVariableValue=!1,this.returnSingleComponent=!1,this.originalDownstreamVariableNames=[]}static get rendererType(){return this.componentType}get dependencyType(){return this.constructor.dependencyType}setUpParameters(){}async determineDownstreamComponents(){return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}async initialize(){this.setUpParameters();let ts=await this.determineDownstreamComponents(),rs=ts.downstreamComponentNames,ns=ts.downstreamComponentTypes;this.componentIdentitiesChanged=!0;let is=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];is||(is=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName]={});for(let as of this.upstreamVariableNames)is[as]||(is[as]={}),is[as][this.dependencyName]=this;this.originalDownstreamVariableNames.length===0&&!this.originalVariablesByComponent?(delete this.mappedDownstreamVariableNamesByComponent,delete this.upValuesChanged):(this.mappedDownstreamVariableNamesByComponent=[],this.valuesChanged=[]),this.downstreamComponentNames=[],this.downstreamComponentTypes=[];for(let[as,os]of rs.entries())await this.addDownstreamComponent({downstreamComponentName:os,downstreamComponentType:ns[as],index:as})}async addDownstreamComponent({downstreamComponentName:ts,downstreamComponentType:rs,index:ns}){this.componentIdentitiesChanged=!0,this.downstreamComponentNames.splice(ns,0,ts),this.downstreamComponentTypes.splice(ns,0,rs);let is=this.dependencyHandler._components[ts];if(is){let as;this.originalVariablesByComponent?as=this.originalDownstreamVariableNamesByComponent[ns]:as=this.originalDownstreamVariableNames,this.caseInsensitiveVariableMatch&&(as=this.dependencyHandler.core.findCaseInsensitiveMatches({stateVariables:as,componentClass:is.constructor})),this.publicStateVariablesOnly&&(as=this.dependencyHandler.core.matchPublicStateVariables({stateVariables:as,componentClass:is.constructor}));let os=this.dependencyHandler.core.substituteAliases({stateVariables:as,componentClass:is.constructor});this.constructor.convertToArraySize&&(os=os.map(function(cs){let ps=is.state[cs];if(ps)return ps.arraySizeStateVariable?ps.arraySizeStateVariable:`__${cs}_is_not_an_array`;if(is.arrayEntryPrefixes){let ds=Object.keys(is.arrayEntryPrefixes).sort((fs,hs)=>hs.length-fs.length);for(let fs of ds)if(cs.substring(0,fs.length)===fs){let hs=is.arrayEntryPrefixes[fs],ys=is.state[hs];if(ys.getArrayKeysFromVarName({arrayEntryPrefix:fs,varEnding:cs.substring(fs.length),nDimensions:ys.nDimensions}).length>0)return is.state[hs].arraySizeStateVariable}}return`__${cs}_is_not_an_array`})),this.propIndex!==void 0&&(os=await this.dependencyHandler.core.arrayEntryNamesFromPropIndex({stateVariables:os,component:is,propIndex:this.propIndex}));let ls=os;if(as.length>0||this.originalVariablesByComponent){this.mappedDownstreamVariableNamesByComponent.splice(ns,0,os);let cs={};for(let ps of os)cs[ps]={changed:!0};this.valuesChanged.splice(ns,0,cs),this.variablesOptional&&(ls=ls.filter(ps=>ps in is.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:ps,component:is})));for(let ps of ls)if(is.state[ps]||await this.dependencyHandler.core.createFromArrayEntry({component:is,stateVariable:ps}),!is.state[ps].isResolved)for(let ds of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:ts,blockerType:"stateVariable",blockerStateVariable:ps,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ds}),this.dependencyType==="determineDependencies"&&await this.dependencyHandler.addBlocker({blockerComponentName:ts,blockerType:"stateVariable",blockerStateVariable:ps,componentNameBlocked:this.upstreamComponentName,typeBlocked:"determineDependencies",stateVariableBlocked:ds,dependencyBlocked:this.dependencyName})}ls.length===0&&(ls=[this.downstreamVariableNameIfNoVariables]);let us=this.dependencyHandler.upstreamDependencies[ts];us||(us=this.dependencyHandler.upstreamDependencies[ts]={});for(let cs of ls)if(us[cs]===void 0&&(us[cs]=[]),us[cs].push(this),cs!==this.downstreamVariableNameIfNoVariables)for(let ps of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,ps)}for(let as of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[as].initiallyResolved&&await this.dependencyHandler.core.markStateVariableAndUpstreamDependentsStale({component:this.dependencyHandler.components[this.upstreamComponentName],varName:as})}async removeDownstreamComponent({indexToRemove:ts,recordChange:rs=!0}){rs&&(this.componentIdentitiesChanged=!0);let ns=this.downstreamComponentNames[ts];if(this.downstreamComponentNames.splice(ts,1),this.downstreamComponentTypes.splice(ts,1),ns in this.dependencyHandler._components){let is;this.mappedDownstreamVariableNamesByComponent?(is=this.mappedDownstreamVariableNamesByComponent[ts],this.mappedDownstreamVariableNamesByComponent.splice(ts,1),this.valuesChanged.splice(ts,1),this.variablesOptional&&is.push(this.downstreamVariableNameIfNoVariables)):is=[this.downstreamVariableNameIfNoVariables];for(let as of is){let os=this.dependencyHandler.upstreamDependencies[ns][as];if(os){let ls=os.indexOf(this);ls!==-1&&(os.length===1?delete this.dependencyHandler.upstreamDependencies[ns][as]:os.splice(ls,1))}if(as!==this.downstreamVariableNameIfNoVariables)for(let ls of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,ls)}}if(rs)for(let is of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[is].initiallyResolved&&await this.dependencyHandler.core.markStateVariableAndUpstreamDependentsStale({component:this.dependencyHandler.components[this.upstreamComponentName],varName:is})}async swapDownstreamComponents(ts,rs){this.componentIdentitiesChanged=!0,[this.downstreamComponentNames[ts],this.downstreamComponentNames[rs]]=[this.downstreamComponentNames[rs],this.downstreamComponentNames[ts]],[this.downstreamComponentTypes[ts],this.downstreamComponentTypes[rs]]=[this.downstreamComponentTypes[rs],this.downstreamComponentTypes[ts]],(this.originalDownstreamVariableNames.length>0||this.originalVariablesByComponent)&&([this.mappedDownstreamVariableNamesByComponent[ts],this.mappedDownstreamVariableNamesByComponent[rs]]=[this.mappedDownstreamVariableNamesByComponent[rs],this.mappedDownstreamVariableNamesByComponent[ts]],[this.valuesChanged[ts],this.valuesChanged[rs]]=[this.valuesChanged[rs],this.valuesChanged[ts]]);for(let ns of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[ns].initiallyResolved&&await this.dependencyHandler.core.markStateVariableAndUpstreamDependentsStale({component:this.dependencyHandler.components[this.upstreamComponentName],varName:ns})}deleteDependency(){let ts=[];if(!this.mappedDownstreamVariableNamesByComponent)ts=Array(this.downstreamComponentNames.length).fill([this.downstreamVariableNameIfNoVariables]);else if(ts=this.mappedDownstreamVariableNamesByComponent,this.variablesOptional){let ns=[];for(let[is,as]of this.downstreamComponentNames.entries()){let os=[];for(let ls of ts[is])this.dependencyHandler.components[as].state[ls]&&os.push(ls);os.length>0?ns.push(os):ns.push([this.downstreamVariableNameIfNoVariables])}ts=ns}for(let[ns,is]of this.downstreamComponentNames.entries())for(let as of ts[ns]){let os=this.dependencyHandler.upstreamDependencies[is][as];if(os){let ls=os.indexOf(this);ls!==-1&&(os.length===1?delete this.dependencyHandler.upstreamDependencies[is][as]:os.splice(ls,1))}for(let ls of this.upstreamVariableNames)this.dependencyHandler.deleteFromNeededToResolve({componentNameBlocked:this.componentName,typeBlocked:"stateVariable",stateVariableBlocked:ls,blockerType:"stateVariable",blockerCode:is+"|"+as});if(as!==this.downstreamVariableNameIfNoVariables)for(let ls of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,ls)}this.deleteFromUpdateTriggers();let rs=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];for(let ns of this.upstreamVariableNames)delete rs[ns][this.dependencyName]}deleteFromUpdateTriggers(){}async getValue({verbose:ts=!1,skipProxy:rs=!1}={}){let ns=[],is={},as=[];this.componentIdentitiesChanged&&(is.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1);for(let[os,ls]of this.downstreamComponentNames.entries()){let us=this.dependencyHandler._components[ls];if(as[os]=!1,us){let cs={componentType:us.componentType};this.skipComponentNames||(cs.componentName=ls);let ps;if(this.originalVariablesByComponent?ps=this.originalDownstreamVariableNamesByComponent[os]:ps=this.originalDownstreamVariableNames,ps.length>0){cs.stateValues={};let ds={},fs=!1;for(let[hs,ys]of ps.entries()){let gs=this.mappedDownstreamVariableNamesByComponent[os][hs],bs=this.useMappedVariableNames?gs:ys;if(!this.variablesOptional||gs in us.state){let vs=us.state[gs];vs.deferred||(cs.stateValues[bs]=await vs.value,this.valuesChanged[os][gs].changed&&(is.valuesChanged||(is.valuesChanged={}),is.valuesChanged[os]||(is.valuesChanged[os]={}),is.valuesChanged[os][bs]=this.valuesChanged[os][gs]),this.valuesChanged[os][gs]={},(vs.usedDefault||vs.isArrayEntry&&vs.arrayKeys.length===1&&us.state[vs.arrayStateVariable].usedDefaultByArrayKey[vs.arrayKeys[0]])&&(ds[bs]=!0,fs=!0))}}fs&&(as[os]=ds)}ns.push(cs)}else ns.push({componentType:this.downstreamComponentTypes[os]})}if(!ts)if(this.returnSingleVariableValue)if(ns.length===1){ns=ns[0],is.valuesChanged&&is.valuesChanged[0]?is.valuesChanged=is.valuesChanged[0]:delete is.valuesChanged,as=as[0];let os=Object.keys(ns.stateValues);if(os.length===1){let ls=os[0];ns=ns.stateValues[ls],is.valuesChanged&&is.valuesChanged[ls]&&(is.valuesChanged=is.valuesChanged[ls]),as&&(as=as[ls])}else ns=null,is={},as=!1}else ns=null,is={},as=!1;else this.returnSingleComponent&&(ns.length===1?(ns=ns[0],is.valuesChanged&&is.valuesChanged[0]?is.valuesChanged=is.valuesChanged[0]:delete is.valuesChanged,as=as[0]):(ns=null,as=!1));return{value:ns,changes:is,usedDefault:as}}checkForCircular(){for(let ts of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,ts);for(let ts of this.upstreamVariableNames)this.dependencyHandler.checkForCircularDependency({componentName:this.upstreamComponentName,varName:ts})}async recalculateDownstreamComponents({force:ts=!1}={}){let rs=await this.determineDownstreamComponents({force:ts}),ns=rs.downstreamComponentNames;if(ns.length!==this.downstreamComponentNames.length||this.downstreamComponentNames.some((as,os)=>as!=ns[os])){this.componentIdentitiesChanged=!0;let as=0;for(let[os,ls]of[...this.downstreamComponentNames].entries())ns.includes(ls)||(await this.removeDownstreamComponent({indexToRemove:os-as}),as++);for(let[os,ls]of ns.entries()){let us=this.downstreamComponentNames.indexOf(ls);us!==-1?us!==os&&await this.swapDownstreamComponents(us,os):await this.addDownstreamComponent({downstreamComponentName:ls,downstreamComponentType:rs.downstreamComponentTypes[os],index:os})}}if(this.originalVariablesByComponent)for(let[as,os]of[...this.downstreamComponentNames].entries())(this.mappedDownstreamVariableNamesByComponent[as].length!==this.originalDownstreamVariableNamesByComponent[as].length||this.mappedDownstreamVariableNamesByComponent[as].some((ls,us)=>this.originalDownstreamVariableNamesByComponent[as][us]!==ls))&&(await this.removeDownstreamComponent({indexToRemove:as}),await this.addDownstreamComponent({downstreamComponentName:os,downstreamComponentType:rs.downstreamComponentTypes[as],index:as}));return{success:rs.success}}}Ms(Dependency,"dependencyType","_base");class StateVariableDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.returnAsComponentObject?this.returnSingleComponent=!0:this.returnSingleVariableValue=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(StateVariableDependency,"dependencyType","stateVariable"),dependencyTypeArray.push(StateVariableDependency);class MultipleStateVariablesDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames,this.returnSingleComponent=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(MultipleStateVariablesDependency,"dependencyType","multipleStateVariables"),dependencyTypeArray.push(MultipleStateVariablesDependency);class StateVariableComponentTypeDependency extends StateVariableDependency{async getValue({verbose:ts=!1}={}){var is,as,os;let rs=[],ns={};if(this.staticValue)rs=[this.staticValue];else if(this.componentIdentitiesChanged&&(ns.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1){let ls=this.downstreamComponentNames[0],us=this.dependencyHandler.components[ls],cs={componentName:us.componentName,componentType:us.componentType};cs.stateValues={};let ps=this.originalDownstreamVariableNames[0],ds=this.mappedDownstreamVariableNamesByComponent[0][0],fs=this.useMappedVariableNames?ds:ps;if((!this.variablesOptional||ds in us.state)&&!us.state[ds].deferred){let hs=us.state[ds];if(await hs.value,cs.stateValues[fs]=hs.componentType,hs.isArray&&((is=hs.wrappingComponents)==null?void 0:is.length)>0){let gs=hs.wrappingComponents[hs.wrappingComponents.length-1][0];typeof gs=="object"&&(gs=gs.componentType),cs.stateValues[fs]=gs}this.valuesChanged[0][ds].changed&&(ns.valuesChanged||(ns.valuesChanged={}),ns.valuesChanged[0]||(ns.valuesChanged[0]={}),ns.valuesChanged[0][fs]=this.valuesChanged[0][ds]),this.valuesChanged[0][ds]={};let ys=(as=hs.shadowingInstructions)==null?void 0:as.hasVariableComponentType;!ys&&hs.isArrayEntry&&(ys=(os=us.state[hs.arrayStateVariable].shadowingInstructions)==null?void 0:os.hasVariableComponentType),ys||(this.staticValue=cs,await this.removeDownstreamComponent({indexToRemove:0,recordChange:!1}))}rs=[cs]}if(!ts)if(this.returnSingleVariableValue)if(rs.length===1){rs=rs[0];let ls=Object.keys(rs.stateValues);ns.valuesChanged&&ns.valuesChanged[0]&&ns.valuesChanged[0][0]&&(ns.valuesChanged=ns.valuesChanged[0][0]),ls.length===1?rs=rs.stateValues[ls[0]]:rs=null}else rs=null;else this.returnSingleComponent&&(rs.length===1?(rs=rs[0],ns.valuesChanged&&ns.valuesChanged[0]&&(ns.valuesChanged=ns.valuesChanged[0])):rs=null);return{value:rs,changes:ns,usedDefault:!1}}}Ms(StateVariableComponentTypeDependency,"dependencyType","stateVariableComponentType"),dependencyTypeArray.push(StateVariableComponentTypeDependency);class StateVariableArraySizeDependency extends StateVariableDependency{}Ms(StateVariableArraySizeDependency,"dependencyType","stateVariableArraySize"),Ms(StateVariableArraySizeDependency,"convertToArraySize",!0),dependencyTypeArray.push(StateVariableArraySizeDependency);class RecursiveDependencyValuesDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableNames===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.startingVariableNames=this.definition.variableNames,this.originalVariablesByComponent=!0,this.includeImmediateValueWithValue=this.definition.includeImmediateValueWithValue,this.includeRawValueWithImmediateValue=this.definition.includeRawValueWithImmediateValue,this.includeOnlyEssentialValues=this.definition.includeOnlyEssentialValues,this.variablesOptional=!0}async determineDownstreamComponents({force:ts=!1}={}){var as,os;this.missingComponents=[],this.originalDownstreamVariableNamesByComponent=[];let rs=await this.getRecursiveDependencyVariables({componentName:this.componentName,variableNames:this.startingVariableNames,force:ts});if(!rs.success)return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]};let ns=[],is=[];for(let ls in rs.components)if(this.includeOnlyEssentialValues){let us=[],cs=this.dependencyHandler._components[ls];for(let ps of rs.components[ls].variableNames)((as=cs.state[ps])!=null&&as.hasEssential||(os=cs.state[ps])!=null&&os.isArrayEntry&&cs.state[cs.state[ps].arrayStateVariable].hasEssential)&&us.push(ps);us.length>0&&(ns.push(ls),is.push(rs.components[ls].componentType),this.originalDownstreamVariableNamesByComponent.push(us))}else ns.push(ls),is.push(rs.components[ls].componentType),this.originalDownstreamVariableNamesByComponent.push(rs.components[ls].variableNames);return{success:!0,downstreamComponentNames:ns,downstreamComponentTypes:is}}async getRecursiveDependencyVariables({componentName:ts,variableNames:rs,force:ns,components:is={}}){let as=this.dependencyHandler._components[ts];if(!as){if(!this.missingComponents.includes(ts)){let us=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts];us||(us=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts]=[]),us.includes(this)||us.push(this)}for(let us of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:ts,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:us,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:us,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:us});return{success:!1}}this.includeImmediateValueWithValue&&rs.includes("value")&&!rs.includes("immediateValue")&&"immediateValue"in as.state&&(rs=[...rs,"immediateValue"]),this.includeRawValueWithImmediateValue&&rs.includes("immediateValue")&&!rs.includes("rawRendererValue")&&"rawRendererValue"in as.state&&(rs=[...rs,"rawRendererValue"]);let os=is[ts];os||(os=is[ts]={componentName:ts,componentType:as.componentType,variableNames:[]});let ls=this.dependencyHandler.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[ts];ls||(ls=this.dependencyHandler.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[ts]={});for(let us of rs)if(!os.variableNames.includes(us)){os.variableNames.push(us);let cs=ls[us];cs||(cs=ls[us]=[]),cs.includes(this)||cs.push(this);let ps=as.state[us];if(ps){if(!ps.isResolved)if(ns)await ps.value;else{for(let fs of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:ts,blockerType:"stateVariable",blockerStateVariable:us,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:fs,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:fs,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:fs});return{success:!1}}let ds=this.dependencyHandler.downstreamDependencies[as.componentName][us];for(let fs in ds){let hs=ds[fs];for(let[ys,gs]of hs.downstreamComponentNames.entries()){let bs=[];if((hs.originalDownstreamVariableNames.length>0||hs.originalVariablesByComponent)&&(bs=hs.mappedDownstreamVariableNamesByComponent[ys]),!(await this.getRecursiveDependencyVariables({componentName:gs,variableNames:bs,force:ns,components:is})).success)return{success:!1}}}}}return{success:!0,components:is}}async getValue(){this.gettingValue=!0,this.varsWithUpdatedDeps={};let ts,rs={},ns=!0,is={};for(;ns;){if(ns=!1,ts=await super.getValue(),ts.changes.valuesChanged)if(!is.valuesChanged)is.valuesChanged=ts.changes.valuesChanged;else for(let as in ts.changes.valuesChanged){let os=ts.changes.valuesChanged[as];if(!is.valuesChanged[as])is.valuesChanged[as]=os;else for(let ls in os)is.valuesChanged[as][ls]=os[ls]}for(let as in this.varsWithUpdatedDeps){let os=rs[as];os||(os=rs[as]=[]);for(let ls of this.varsWithUpdatedDeps[as])os.includes(ls)||(os.push(ls),ns=!0)}ns&&await this.recalculateDownstreamComponents()}return this.gettingValue=!1,ts.changes=is,ts}deleteFromUpdateTriggers(){for(let ts of this.missingComponents){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[ts];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}}}Ms(RecursiveDependencyValuesDependency,"dependencyType","recursiveDependencyValues"),dependencyTypeArray.push(RecursiveDependencyValuesDependency);class ComponentIdentityDependency extends Dependency{setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.returnSingleComponent=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(ComponentIdentityDependency,"dependencyType","componentIdentity"),dependencyTypeArray.push(ComponentIdentityDependency);class AttributeComponentDependency extends Dependency{setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.attributeName=this.definition.attributeName,this.returnSingleComponent=!0,this.shadowDepth=0}async determineDownstreamComponents(){var is,as,os,ls;let ts=this.dependencyHandler._components[this.parentName];if(!ts){let us=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];us||(us=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),us.includes(this)||us.push(this);for(let cs of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:cs,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:cs,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:cs});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let rs=ts.attributes[this.attributeName];if(this.shadowDepth=0,rs!=null&&rs.component)return{success:!0,downstreamComponentNames:[rs.component.componentName],downstreamComponentTypes:[rs.component.componentType]};let ns=ts;for(;ns.shadows;){let us=ns.shadows,cs=ns.shadows.propVariable;if(ns=this.dependencyHandler._components[us.componentName],!ns)break;if(cs){if(!((os=(as=(is=ns.state[cs])==null?void 0:is.shadowingInstructions)==null?void 0:as.attributesToShadow)!=null&&os.includes(this.attributeName)||(ls=ns.constructor.createAttributesObject()[this.attributeName])!=null&&ls.propagateToProps))break}else{let ps=this.dependencyHandler._components[us.compositeName];if("sourceAttributesToIgnoreRecursively"in ps.state&&(await ps.stateValues.sourceAttributesToIgnoreRecursively).includes(this.attributeName)||us.firstLevelReplacement&&"sourceAttributesToIgnore"in ps.state&&(await ps.stateValues.sourceAttributesToIgnore).includes(this.attributeName))break}if(this.shadowDepth++,rs=ns.attributes[this.attributeName],rs!=null&&rs.component)return{success:!0,downstreamComponentNames:[rs.component.componentName],downstreamComponentTypes:[rs.component.componentType]}}return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}async getValue({verbose:ts}={}){let rs=await super.getValue({verbose:ts,skipProxy:!0});return rs.value&&(rs.value.shadowDepth=this.shadowDepth),rs}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(AttributeComponentDependency,"dependencyType","attributeComponent"),dependencyTypeArray.push(AttributeComponentDependency);class ChildDependency extends Dependency{setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];if(this.childGroups=this.definition.childGroups,!Array.isArray(this.childGroups))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childGroups must be an array`);this.definition.childIndices!==void 0&&(this.childIndices=this.definition.childIndices.map(ts=>Number(ts))),this.skipComponentNames=this.definition.skipComponentNames,this.skipPlaceholders=this.definition.skipPlaceholders,this.proceedIfAllChildrenNotMatched=this.definition.proceedIfAllChildrenNotMatched}async determineDownstreamComponents(){var ls,us;this.downstreamPrimitives?this.previousDownstreamPrimitives=[...this.downstreamPrimitives]:this.previousDownstreamPrimitives=[],this.downstreamPrimitives=[];let ts=this.dependencyHandler._components[this.parentName];if(!ts){let cs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];cs||(cs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),cs.includes(this)||cs.push(this);for(let ps of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ps,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ps,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ps});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let rs=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];rs||(rs=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),rs.includes(this)||rs.push(this);let ns=ts.returnMatchedChildIndices(this.childGroups);if(ns===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childGroups ${this.childGroups} does not exist.`);if(this.childIndices&&(ns=ns.filter((cs,ps)=>this.childIndices.includes(ps))),!ts.childrenMatched&&!this.proceedIfAllChildrenNotMatched){let cs=!1;if(ts.childrenMatchedWithPlaceholders&&(this.skipPlaceholders&&(ns=ns.filter(ps=>!ts.placeholderActiveChildrenIndices.includes(ps))),this.skipComponentNames&&this.originalDownstreamVariableNames.length===0?cs=!0:cs=ns.every(ps=>!ts.placeholderActiveChildrenIndices.includes(ps))),!cs){let ps=ts.unexpandedCompositesNotReady.length>0;if(!ps&&ts.unexpandedCompositesReady.length>0){for(let ds of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:ds,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ds,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ds,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ds});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(ps){for(let ys of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:ys,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ys,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ys,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ys});let ds=[],fs=[];for(let ys of ts.unexpandedCompositesNotReady){if(ts.childrenMatchedWithPlaceholders&&ts.placeholderActiveChildrenIndicesByComposite[ys].every(vs=>!ns.includes(vs)))continue;(ls=this.dependencyHandler._components[ys].attributes.createComponentOfType)!=null&&ls.primitive?ds.push(ys):fs.push(ys)}let hs=fs;hs.length===0&&(hs=ds);for(let ys of hs)for(let gs of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:ys,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childMatches",stateVariableBlocked:gs});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}}let is=ns.map(cs=>ts.activeChildren[cs]);if(this.compositeReplacementRange=[],ts.compositeReplacementActiveRange&&is.length>0){let cs=0;for(;cs<ns.length;){let ps=ns[cs];for(let ds of ts.compositeReplacementActiveRange)if(ds.firstInd<=ps&&ds.lastInd>=ps){let fs=cs,hs=cs;for(;ds.lastInd>ps&&cs<ns.length-1&&(cs++,ps=ns[cs],ds.lastInd>=ps);)hs=cs;if(this.compositeReplacementRange.push({compositeName:ds.compositeName,target:ds.target,firstInd:fs,lastInd:hs}),cs++,cs===ns.length)break;ps=ns[cs]}cs++}}this.shadowDepthByChild=[];for(let cs of is){let ps=0,ds=cs,fs=ts;for(;ds!=null&&ds.shadows&&ds.shadows.compositeName===((us=fs==null?void 0:fs.shadows)==null?void 0:us.compositeName);)ps++,fs=this.dependencyHandler._components[fs.shadows.componentName],ds=this.dependencyHandler._components[ds.shadows.componentName];this.shadowDepthByChild.push(ps)}this.activeChildrenIndices=ns;let as=[],os=[];for(let[cs,ps]of is.entries()){if(typeof ps!="object"){this.downstreamPrimitives.push(ps);continue}this.downstreamPrimitives.push(null),as.push(ps.componentName?ps.componentName:`__placeholder_${cs}`),os.push(ps.componentType)}return{success:!0,downstreamComponentNames:as,downstreamComponentTypes:os}}async getValue({verbose:ts}={}){let rs=await super.getValue({verbose:ts,skipProxy:!0}),ns=[],is=0;for(let[as,os]of this.downstreamPrimitives.entries())if(os===null){let ls=rs.value[is];ls.shadowDepth=this.shadowDepthByChild[as],ns.push(rs.value[is]),is++}else ns.push(os);return ns.compositeReplacementRange=this.compositeReplacementRange,rs.value=ns,(this.downstreamPrimitives.length!==this.previousDownstreamPrimitives.length||this.downstreamPrimitives.some((as,os)=>as!==this.previousDownstreamPrimitives[os]))&&(rs.changes.componentIdentitiesChanged=!0,this.previousDownstreamPrimitives=[...this.downstreamPrimitives]),rs}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}if(this.specifiedComponentName){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}}}Ms(ChildDependency,"dependencyType","child"),dependencyTypeArray.push(ChildDependency);class DescendantDependency extends Dependency{setUpParameters(){if(this.definition.ancestorName?(this.ancestorName=this.definition.ancestorName,this.specifiedComponentName=this.ancestorName):this.ancestorName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.componentTypes=this.definition.componentTypes,this.recurseToMatchedChildren=this.definition.recurseToMatchedChildren,this.useReplacementsForComposites=this.definition.useReplacementsForComposites,this.includeNonActiveChildren=this.definition.includeNonActiveChildren,this.includeAttributeChildren=this.definition.includeAttributeChildren,this.skipOverAdapters=this.definition.skipOverAdapters,this.ignoreReplacementsOfMatchedComposites=this.definition.ignoreReplacementsOfMatchedComposites,this.ignoreReplacementsOfEncounteredComposites=this.definition.ignoreReplacementsOfEncounteredComposites,this.definition.componentIndex!==null&&this.definition.componentIndex!==void 0&&(Number.isInteger(this.definition.componentIndex)?this.componentIndex=this.definition.componentIndex:this.componentIndex=NaN)}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.ancestorName];if(!ts){let as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName];as||(as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName]=[]),as.includes(this)||as.push(this);for(let os of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.ancestorName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let rs=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];rs||(rs=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName]=[]),rs.includes(this)||rs.push(this);let ns=this.gatherUnexpandedComposites(ts);if(ns.haveCompositesNotReady||ns.haveUnexpandedCompositeReady){for(let as of this.upstreamVariableNames){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});for(let os in ns.unexpandedCompositesReadyByParentName)await this.dependencyHandler.addBlocker({blockerComponentName:os,blockerType:"childMatches",blockerStateVariable:as,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName});for(let os in ns.unexpandedCompositesNotReadyByParentName)await this.dependencyHandler.addBlocker({blockerComponentName:os,blockerType:"childMatches",blockerStateVariable:as,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName})}return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let is=gatherDescendants({ancestor:ts,descendantTypes:this.componentTypes,recurseToMatchedChildren:this.recurseToMatchedChildren,useReplacementsForComposites:this.useReplacementsForComposites,includeNonActiveChildren:this.includeNonActiveChildren,skipOverAdapters:this.skipOverAdapters,ignoreReplacementsOfMatchedComposites:this.ignoreReplacementsOfMatchedComposites,ignoreReplacementsOfEncounteredComposites:this.ignoreReplacementsOfEncounteredComposites,componentInfoObjects:this.dependencyHandler.componentInfoObjects});if(this.componentIndex!==void 0){let as=is[this.componentIndex-1];as?is=[as]:is=[]}return{success:!0,downstreamComponentNames:is.map(as=>as.componentName),downstreamComponentTypes:is.map(as=>as.componentType)}}gatherUnexpandedComposites(ts){let rs={},ns={},is=!1,as=!1,os=this.skipComponentNames&&this.originalDownstreamVariableNames.length===0;if(!ts.childrenMatched)if(ts.childrenMatchedWithPlaceholders){if(ts.unexpandedCompositesReady.length>0){let ls=this.unexpandedCompositesAdjustedForPlacedholders(ts.unexpandedCompositesReady,os);ls.length>0&&(rs[ts.componentName]=ls,is=!0)}if(ts.unexpandedCompositesNotReady.length>0){let ls=this.unexpandedCompositesAdjustedForPlacedholders(ts.unexpandedCompositesNotReady,os);ls.length>0&&(ns[ts.componentName]=ls,as=!0)}}else ts.unexpandedCompositesReady.length>0&&(rs[ts.componentName]=ts.unexpandedCompositesReady,is=!0),ts.unexpandedCompositesNotReady.length>0&&(ns[ts.componentName]=ts.unexpandedCompositesNotReady,as=!0);for(let ls in ts.allChildren){let us=ts.allChildren[ls].component;if(typeof us=="object"){let cs=this.gatherUnexpandedComposites(us);cs.haveUnexpandedCompositeReady&&(Object.assign(rs,cs.unexpandedCompositesReadyByParentName),is=!0),cs.haveCompositesNotReady&&(Object.assign(ns,cs.unexpandedCompositesNotReadyByParentName),as=!0)}}return{unexpandedCompositesReadyByParentName:rs,haveUnexpandedCompositeReady:is,unexpandedCompositesNotReadyByParentName:ns,haveCompositesNotReady:as}}unexpandedCompositesAdjustedForPlacedholders(ts,rs){let ns=[];for(let is of ts){let as=this.dependencyHandler._components[is];if(as.attributes.createComponentOfType){let os=this.dependencyHandler.componentInfoObjects.componentTypeLowerCaseMapping[as.attributes.createComponentOfType.primitive.toLowerCase()];this.componentTypes.some(us=>this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:os,baseComponentType:us}))&&rs||ns.push(is)}else ns.push(is)}return ns}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}if(this.specifiedComponentName){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}}}Ms(DescendantDependency,"dependencyType","descendant"),dependencyTypeArray.push(DescendantDependency);class ParentDependency extends Dependency{setUpParameters(){if(this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.definition.parentComponentType&&(this.parentComponentType=this.definition.parentComponentType),this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.childName];if(!ts){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.childName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.parentName)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=ts.parentName;let rs=this.dependencyHandler._components[this.parentName];if(!rs){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(this.parentComponentType&&!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:rs.componentType,baseComponentType:this.parentComponentType}))return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let ns=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return ns||(ns=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),ns.includes(this)||ns.push(this),{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(ts){let ns=ts.indexOf(this);ns!==-1&&ts.splice(ns,1)}if(this.specifiedComponentName){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ns){let is=ns.indexOf(this);is!==-1&&ns.splice(is,1)}}let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}}Ms(ParentDependency,"dependencyType","parentStateVariable"),dependencyTypeArray.push(ParentDependency);class ParentIdentityDependency extends Dependency{setUpParameters(){this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,this.definition.parentComponentType&&(this.parentComponentType=this.definition.parentComponentType),this.returnSingleComponent=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.childName];if(!ts){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.childName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.parentName)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=ts.parentName;let rs=this.dependencyHandler._components[this.parentName];if(!rs){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(this.parentComponentType&&!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:rs.componentType,baseComponentType:this.parentComponentType}))return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let ns=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return ns||(ns=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),ns.includes(this)||ns.push(this),{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(ts){let ns=ts.indexOf(this);ns!==-1&&ts.splice(ns,1)}if(this.specifiedComponentName){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ns){let is=ns.indexOf(this);is!==-1&&ns.splice(is,1)}}let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}}Ms(ParentIdentityDependency,"dependencyType","parentIdentity"),dependencyTypeArray.push(ParentIdentityDependency);class AncestorDependency extends Dependency{setUpParameters(){if(this.definition.descendantName?(this.descendantName=this.definition.descendantName,this.specifiedComponentName=this.descendantName):this.descendantName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.definition.componentType&&(this.componentType=this.definition.componentType)}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.descendantName];if(!ts){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.descendantName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!(this.dependencyHandler.core.documentName in this.dependencyHandler._components)){for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns}),await this.dependencyHandler.addBlocker({blockerComponentName:this.dependencyHandler.core.documentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let rs=this.findMatchingAncestor(ts);if(rs.missingComponentName){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[rs.missingComponentName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[rs.missingComponentName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:rs.missingComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let ns of rs.ancestorsExamined){let is=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[ns];is||(is=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[ns]=[]),is.includes(this)||is.push(this)}return this.ancestorResults=rs,rs.ancestorFound?{success:!0,downstreamComponentNames:[rs.ancestorFound.componentName],downstreamComponentTypes:[rs.ancestorFound.componentClass.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}findMatchingAncestor(ts){let rs=[];if(this.componentType){for(let is of ts.ancestors){let as=this.dependencyHandler._components[is.componentName];if(!as)return{missingComponentName:is.componentName};if(rs.push(is.componentName),this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:this.componentType}))return{ancestorsExamined:rs,ancestorFound:is}}return{ancestorsExamined:rs}}if(this.originalDownstreamVariableNames.length===0)return console.warn(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must specify componentType or variableNames to find ancestor`),{ancestorsExamined:rs};let ns=this.originalDownstreamVariableNames;for(let is of ts.ancestors){let as=this.dependencyHandler._components[is.componentName];if(!as)return{missingComponentName:is.componentName};rs.push(is.componentName);let os=!0;for(let ls of ns)if(!(ls in as.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:ls,component:as}))){os=!1;break}if(os)return{ancestorsExamined:rs,ancestorFound:is}}return{ancestorsExamined:rs}}deleteFromUpdateTriggers(){for(let ts of this.ancestorResults.ancestorsExamined){let rs=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[ts];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}if(this.ancestorResults&&this.ancestorResults.missingComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorResults.missingComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(AncestorDependency,"dependencyType","ancestor"),dependencyTypeArray.push(AncestorDependency);class ReplacementDependency extends Dependency{setUpParameters(){if(this.definition.compositeName?(this.compositeName=this.definition.compositeName,this.specifiedComponentName=this.compositeName):this.compositeName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.recursive=this.definition.recursive,this.recurseNonStandardComposites=this.definition.recurseNonStandardComposites,this.definition.componentIndex!==null&&this.definition.componentIndex!==void 0&&(Number.isInteger(this.definition.componentIndex)?this.componentIndex=this.definition.componentIndex:this.componentIndex=NaN),this.definition.targetSubnames&&(this.targetSubnames=this.definition.targetSubnames),this.definition.targetSubnamesComponentIndex&&(this.definition.targetSubnamesComponentIndex.every(Number.isInteger)?this.targetSubnamesComponentIndex=this.definition.targetSubnamesComponentIndex:this.targetSubnamesComponentIndex=[NaN]),this.includeWithheldReplacements=this.definition.includeWithheldReplacements,this.expandReplacements=!0}async determineDownstreamComponents(){this.replacementPrimitives?this.previousReplacementPrimitives=[...this.replacementPrimitives]:this.previousReplacementPrimitives=[],this.replacementPrimitives=[];let ts=this.dependencyHandler._components[this.compositeName];if(!ts){let as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName];as||(as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName]=[]),as.includes(this)||as.push(this);for(let os of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.isExpanded){for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as}),await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName});return ts.state.readyToExpandWhenResolved.isResolved||await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.compositeName,typeBlocked:"expandComposite"}),{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}this.compositesFound=[this.compositeName];let rs=ts.replacements;if(!this.includeWithheldReplacements&&ts.replacementsToWithhold>0&&(rs=rs.slice(0,-ts.replacementsToWithhold)),this.recursive){let as=this.dependencyHandler.core.recursivelyReplaceCompositesWithReplacements({replacements:rs,recurseNonStandardComposites:this.recurseNonStandardComposites,includeWithheldReplacements:this.includeWithheldReplacements});if(as.unexpandedCompositesNotReady.length>0||as.unexpandedCompositesReady.length>0){for(let os of this.upstreamVariableNames){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});for(let ls of[...as.unexpandedCompositesReady,...as.unexpandedCompositesNotReady])await this.dependencyHandler.addBlocker({blockerComponentName:ls,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName})}for(let os of as.unexpandedCompositesNotReady)await this.dependencyHandler.addBlocker({blockerComponentName:os,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:os,typeBlocked:"expandComposite"});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}rs=as.newReplacements,this.compositesFound.push(...as.compositesFound)}for(let as of this.compositesFound){let os=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[as];os||(os=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[as]=[]),os.includes(this)||os.push(this)}if(this.componentIndex!==void 0){let as=rs[this.componentIndex-1];as?rs=[as]:rs=[]}this.targetSubnames&&(rs=function({components:os,subNames:ls,subNamesComponentIndex:us,dep:cs}){if(ls.length===0)return os;let ps=ls.slice(1),ds=[];for(let fs of os){let hs=fs.componentName+"/"+ls[0],ys=cs.dependencyHandler._components[hs];if(ys)cs.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:ys.componentType,baseComponentType:"_composite"})?console.warn("Have not yet implemented recursing subnames to multiple levels of composites"):ps.length===0&&(us!=null&&us.length||!0)&&ds.push(ys);else{let gs=cs.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[hs];gs||(gs=cs.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[hs]=[]),gs.includes(cs)||gs.push(cs)}}return ds}({components:rs,subNames:this.targetSubnames,subNamesComponentIndex:this.targetSubnamesComponentIndex,dep:this}));let ns=[],is=[];for(let as of rs){if(typeof as!="object"){this.replacementPrimitives.push(as);continue}this.replacementPrimitives.push(null),ns.push(as.componentName),is.push(as.componentType)}return{success:!0,downstreamComponentNames:ns,downstreamComponentTypes:is}}async getValue({verbose:ts}={}){let rs=await super.getValue({verbose:ts,skipProxy:!0}),ns=[],is=0;for(let as of this.replacementPrimitives)as===null?(ns.push(rs.value[is]),is++):ns.push(as);return rs.value=ns,(this.replacementPrimitives.length!==this.previousReplacementPrimitives.length||this.replacementPrimitives.some((as,os)=>as!==this.previousReplacementPrimitives[os]))&&(rs.changes.componentIdentitiesChanged=!0,this.previousReplacementPrimitives=[...this.replacementPrimitives]),rs}deleteFromUpdateTriggers(){if(this.compositesFound)for(let ts of this.compositesFound){let rs=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[ts];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(ReplacementDependency,"dependencyType","replacement"),dependencyTypeArray.push(ReplacementDependency);class SourceCompositeStateVariableDependency extends Dependency{setUpParameters(){if(this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.definition.compositeComponentType&&(this.compositeComponentType=this.definition.compositeComponentType),this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.replacementName];if(!ts){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.replacementName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.replacementOf;if(this.compositeComponentType)for(;!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:rs.componentType,baseComponentType:this.compositeComponentType});)if(rs.replacementOf)rs=rs.replacementOf;else return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};return{success:!0,downstreamComponentNames:[rs.componentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(SourceCompositeStateVariableDependency,"dependencyType","sourceCompositeStateVariable"),dependencyTypeArray.push(SourceCompositeStateVariableDependency);class SourceCompositeIdentityDependency extends Dependency{setUpParameters(){this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,this.returnSingleComponent=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.replacementName];if(!ts){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.replacementName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.replacementOf;return{success:!0,downstreamComponentNames:[rs.componentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(SourceCompositeIdentityDependency,"dependencyType","sourceCompositeIdentity"),dependencyTypeArray.push(SourceCompositeIdentityDependency);class ShadowSourceDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.shadows)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.shadows.componentName,ns=this.dependencyHandler._components[rs];return ns?{success:!0,downstreamComponentNames:[ns.componentName],downstreamComponentTypes:[ns.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(ShadowSourceDependency,"dependencyType","shadowSource"),dependencyTypeArray.push(ShadowSourceDependency);class UnlinkedCopySourceDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.unlinkedCopySource)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.unlinkedCopySource,ns=this.dependencyHandler._components[rs];return ns?{success:!0,downstreamComponentNames:[ns.componentName],downstreamComponentTypes:[ns.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(UnlinkedCopySourceDependency,"dependencyType","unlinkedCopySource"),dependencyTypeArray.push(UnlinkedCopySourceDependency);class PrimaryShadowDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];as||(as=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),as.includes(this)||as.push(this);for(let os of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let rs=this.dependencyHandler.updateTriggers.primaryShadowDependencies[this.componentName];if(rs||(rs=this.dependencyHandler.updateTriggers.primaryShadowDependencies[this.componentName]=[]),rs.includes(this)||rs.push(this),!ts.primaryShadow)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let ns=ts.primaryShadow,is=this.dependencyHandler._components[ns];return is?{success:!0,downstreamComponentNames:[is.componentName],downstreamComponentTypes:[is.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(PrimaryShadowDependency,"dependencyType","primaryShadow"),dependencyTypeArray.push(PrimaryShadowDependency);class AdapterSourceStateVariableDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.adaptedFrom)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.adaptedFrom;return{success:!0,downstreamComponentNames:[rs.componentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(AdapterSourceStateVariableDependency,"dependencyType","adapterSourceStateVariable"),dependencyTypeArray.push(AdapterSourceStateVariableDependency);class AdapterSourceDependency extends Dependency{setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];ns||(ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),ns.includes(this)||ns.push(this);for(let is of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:is,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:is,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:is});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.adaptedFrom)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let rs=ts.adaptedFrom;return{success:!0,downstreamComponentNames:[rs.componentName],downstreamComponentTypes:[rs.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(AdapterSourceDependency,"dependencyType","adapterSource"),dependencyTypeArray.push(AdapterSourceDependency);class CountAmongSiblingsDependency extends Dependency{setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!ts.parentName)return console.warn(`component ${this.componentName} does not have a parent for state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}.`),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=ts.parentName;let rs=this.dependencyHandler._components[this.parentName];if(!rs){let is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];is||(is=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),is.includes(this)||is.push(this);for(let as of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:as,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:as,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:as});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let ns=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(ns||(ns=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),ns.includes(this)||ns.push(this),!rs.childrenMatched&&!rs.childrenMatchedWithPlaceholders){let as=rs.unexpandedCompositesNotReady.length>0;if(!as&&rs.unexpandedCompositesReady.length>0){for(let os of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:os,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(as){for(let os of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:os,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:os,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:os,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:os});for(let os of rs.unexpandedCompositesNotReady)for(let ls of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:os,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childMatches",stateVariableBlocked:ls});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(ts){let ns=ts.indexOf(this);ns!==-1&&ts.splice(ns,1)}if(this.specifiedComponentName){let ns=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ns){let is=ns.indexOf(this);is!==-1&&ns.splice(is,1)}}let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(rs){let ns=rs.indexOf(this);ns!==-1&&rs.splice(ns,1)}}async getValue(){let ts=this.dependencyHandler.components[this.upstreamComponentName].componentType,ns=this.dependencyHandler.components[this.parentName].activeChildren.filter(is=>is.componentType===ts).map(is=>is.componentName).indexOf(this.upstreamComponentName)+1;if(this.parentName===this.dependencyHandler.core.documentName){let is=this.dependencyHandler.core.previousComponentTypeCounts[ts];is&&(ns+=is)}return{value:ns,changes:{}}}}Ms(CountAmongSiblingsDependency,"dependencyType","countAmongSiblingsOfSameType"),dependencyTypeArray.push(CountAmongSiblingsDependency);class AttributeTargetComponentNamesDependency extends StateVariableDependency{setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.parentName?(this.componentName=this.definition.parentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async getValue(){let ts=null,rs={};if(this.componentIdentitiesChanged&&(rs.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1){let ns=this.dependencyHandler.components[this.componentName];ns&&(ts=ns.attributes[this.attributeName],ts?ts=ts.targetComponentNames:ts=null)}return{value:ts,changes:rs}}}Ms(AttributeTargetComponentNamesDependency,"dependencyType","attributeTargetComponentNames"),dependencyTypeArray.push(AttributeTargetComponentNamesDependency);class TargetComponentDependency extends Dependency{setUpParameters(){let ts=this.dependencyHandler._components[this.upstreamComponentName];if(this.target=ts.doenetAttributes.target,this.target&&(this.targetComponentName=this.specifiedComponentName=ts.doenetAttributes.targetComponentName),this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0}async determineDownstreamComponents(){if(!this.target)return{downstreamComponentNames:[],downstreamComponentTypes:[]};let ts=this.dependencyHandler._components[this.targetComponentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.targetComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.targetComponentName],downstreamComponentTypes:[ts.componentType]}}deleteFromUpdateTriggers(){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}Ms(TargetComponentDependency,"dependencyType","targetComponent"),dependencyTypeArray.push(TargetComponentDependency);class ValueDependency extends Dependency{setUpParameters(){this.value=this.definition.value}async getValue(){return{value:this.value,changes:{}}}}Ms(ValueDependency,"dependencyType","value"),dependencyTypeArray.push(ValueDependency);class FlagDependency extends ValueDependency{setUpParameters(){this.flagName=this.definition.flagName,this.value=this.dependencyHandler.core.flags[this.flagName]}}Ms(FlagDependency,"dependencyType","flag"),dependencyTypeArray.push(FlagDependency);class DoenetAttributeDependency extends StateVariableDependency{setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async getValue(){let ts=null,rs={};return this.componentIdentitiesChanged&&(rs.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1&&(ts=this.dependencyHandler.components[this.downstreamComponentNames[0]].doenetAttributes[this.attributeName]),{value:ts,changes:rs}}}Ms(DoenetAttributeDependency,"dependencyType","doenetAttribute"),dependencyTypeArray.push(DoenetAttributeDependency);class AttributePrimitiveDependency extends StateVariableDependency{setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.parentName?(this.componentName=this.definition.parentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async getValue(){let ts=null,rs={};if(this.componentIdentitiesChanged&&(rs.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1){let ns=this.dependencyHandler.components[this.componentName];ns&&(ts=ns.attributes[this.attributeName],ts?ts=ts.primitive:ts=null)}return{value:ts,changes:rs}}}Ms(AttributePrimitiveDependency,"dependencyType","attributePrimitive"),dependencyTypeArray.push(AttributePrimitiveDependency);class SerializedChildrenDependency extends Dependency{setUpParameters(){this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.parentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[ts.componentType]}}async getValue(){return{value:this.dependencyHandler._components[this.parentName].serializedChildren,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(SerializedChildrenDependency,"dependencyType","serializedChildren"),dependencyTypeArray.push(SerializedChildrenDependency);class DoenetMLDependency extends Dependency{setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.displayOnlyChildren=this.definition.displayOnlyChildren}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}async getValue(){return{value:this.dependencyHandler.core.requestComponentDoenetML(this.componentName,this.displayOnlyChildren),changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(DoenetMLDependency,"dependencyType","doenetML"),dependencyTypeArray.push(DoenetMLDependency);class VariantsDependency extends Dependency{setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}async getValue(){return{value:this.dependencyHandler._components[this.componentName].variants,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}}Ms(VariantsDependency,"dependencyType","variants"),dependencyTypeArray.push(VariantsDependency);class CounterDependency extends Dependency{setUpParameters(){this.counterName=this.definition.counterName,this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName],rs=ts.counters[this.counterName];return rs||(rs=ts.counters[this.counterName]={dependencies:[],componentList:[],value:null}),rs.dependencies.includes(this)||rs.dependencies.push(this),await this.dependencyHandler.collateCountersAndPropagateToAncestors(ts),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}async getValue(){return{value:this.dependencyHandler._components[this.componentName].counters[this.counterName].value,changes:{}}}}Ms(CounterDependency,"dependencyType","counter"),dependencyTypeArray.push(CounterDependency);class DetermineDependenciesDependency extends Dependency{setUpParameters(){if(this.recalculateDependencies=!0,this.definition.componentName?this.componentName=this.definition.componentName:this.componentName=this.upstreamComponentName,this.definition.variableNames===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.originalDownstreamVariableNames=this.definition.variableNames,this.returnSingleComponent=!0}async determineDownstreamComponents(){let ts=this.dependencyHandler._components[this.componentName];if(!ts){let rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];rs||(rs=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),rs.includes(this)||rs.push(this);for(let ns of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:ns,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:ns,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:ns});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let rs of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:rs,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:rs});return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[ts.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let ts=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(ts){let rs=ts.indexOf(this);rs!==-1&&ts.splice(rs,1)}}}async markStale(){let ts=this.dependencyHandler._components[this.upstreamComponentName];for(let rs of this.upstreamVariableNames)if(!(ts&&ts.state[rs]&&ts.state[rs].currentlyResolving)){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:rs,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:rs});for(let ns in this.dependencyHandler.downstreamDependencies[this.upstreamComponentName][rs])this.dependencyHandler.downstreamDependencies[this.upstreamComponentName][rs][ns].dependencyType!=="determineDependencies"&&await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:rs,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:rs,dependencyBlocked:ns})}}}Ms(DetermineDependenciesDependency,"dependencyType","determineDependencies"),dependencyTypeArray.push(DetermineDependenciesDependency);class FileDependency extends Dependency{setUpParameters(){this.cid=this.definition.cid,this.uri=this.definition.uri,this.fileType=this.definition.fileType}async getValue(){let ts;if(this.cid){if(this.fileType.toLowerCase()==="csv")ts="csv";else return{value:null,changes:{}};return{value:await retrieveTextFileForCid(this.cid,ts),changes:{}}}else{let rs=await fetch(this.uri);return rs.ok?{value:await rs.text(),changes:{}}:{value:null,changes:{}}}}}Ms(FileDependency,"dependencyType","file"),dependencyTypeArray.push(FileDependency);var appliedFunctionSymbolsDefault=["abs","exp","log","ln","log10","sign","sqrt","erf","cos","cosh","acos","acosh","arccos","arccosh","cot","coth","acot","acoth","arccot","arccoth","csc","csch","acsc","acsch","arccsc","arccsch","sec","sech","asec","asech","arcsec","arcsech","sin","sinh","asin","asinh","arcsin","arcsinh","tan","tanh","atan","atan2","atanh","arctan","arctanh","arg","min","max","mean","median","floor","ceil","round","sum","prod","variance","std","count","mod","re","im","det","trace","nPr","nCr"],appliedFunctionSymbolsDefaultLatex=["abs","exp","log","ln","log10","sign","sqrt","erf","cos","cosh","acos","acosh","arccos","arccosh","cot","coth","acot","acoth","arccot","arccoth","csc","csch","acsc","acsch","arccsc","arccsch","sec","sech","asec","asech","arcsec","arcsech","sin","sinh","asin","asinh","arcsin","arcsinh","tan","tanh","atan","atan2","atanh","arctan","arctanh","arg","min","max","mean","median","floor","ceil","round","sum","prod","variance","std","count","mod","Re","Im","det","trace","nPr","nCr"];let allowedLatexSymbols=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial","varnothing","emptyset","angle","circ","$","%"];var textToAst=new Context.converters.textToAstObj({appliedFunctionSymbols:appliedFunctionSymbolsDefault});function getFromText({functionSymbols:ss,appliedFunctionSymbols:ts=appliedFunctionSymbolsDefault,splitSymbols:rs=!0,parseScientificNotation:ns=!1}){return is=>Context.fromAst(new Context.converters.textToAstObj({appliedFunctionSymbols:ts,functionSymbols:ss,splitSymbols:rs,parseScientificNotation:ns}).convert(is))}var latexToAst=new Context.converters.latexToAstObj({appliedFunctionSymbols:appliedFunctionSymbolsDefaultLatex,allowedLatexSymbols});function getFromLatex({functionSymbols:ss,appliedFunctionSymbols:ts=appliedFunctionSymbolsDefaultLatex,splitSymbols:rs=!0,parseScientificNotation:ns=!1}){return rs?is=>Context.fromAst(new Context.converters.latexToAstObj({appliedFunctionSymbols:ts,functionSymbols:ss,allowedLatexSymbols,parseScientificNotation:ns}).convert(wrapWordIncludingNumberWithVar(is,ns))):is=>Context.fromAst(new Context.converters.latexToAstObj({appliedFunctionSymbols:ts,functionSymbols:ss,allowedLatexSymbols,parseScientificNotation:ns}).convert(wrapWordWithVar(is,ns)))}function normalizeMathExpression({value:ss,simplify:ts,expand:rs=!1,createVectors:ns=!1,createIntervals:is=!1}){return ns&&(ss=ss.tuples_to_vectors()),is&&(ss=ss.to_intervals()),rs&&(ss=ss.expand()),ts==="full"?ss.simplify():ts==="numbers"?ss.evaluate_numbers():ts==="numberspreserveorder"?ss.evaluate_numbers({skip_ordering:!0}):ss}function findFiniteNumericalValue(ss){if(ss!==void 0)return Number.isFinite(ss)||ss.evaluate_to_constant!==void 0&&(ss=ss.evaluate_to_constant(),Number.isFinite(ss))?ss:null}function convertValueToMathExpression(ss){return ss instanceof Context.class?ss:typeof ss=="number"||typeof ss=="string"||Array.isArray(ss)?Context.fromAst(ss):Context.fromAst("")}function returnNVariables(ss,ts){if(!Number.isInteger(ss)||ss<1)return[];let rs=ts.length;if(rs===0){if(ss===1)return[Context.fromAst("x")];if(ss===2)return[Context.fromAst("x"),Context.fromAst("y")];if(ss===3)return[Context.fromAst("x"),Context.fromAst("y"),Context.fromAst("z")];{let as=[];for(let os=1;os<=ss;os++)as.push(Context.fromAst(textToAst.convert(`x_${os}`)));return as}}if(new Set(ts.map(as=>as.toString())).size<rs&&console.warn("Duplicate variables specified"),ss<=rs)return ts.slice(0,ss);let ns=[...ts.map(as=>as.toString())],is=[...ts];for(let as=rs+1;as<=ss;as++){let os;as==1?ss>3?os=["x_1"]:os=["x"]:as==2?ss>3?os=["x_2","y_2"]:os=["y","x_2"]:as==3?ss>3?os=["x_3","y_3","z_3"]:os=["z","x_3","z_3"]:os=["x","y","z","u","v","w","X","Y","Z"].map(us=>`${us}_${as}`);let ls=!1;for(let us of os)if(!ns.includes(us)){is.push(Context.fromAst(textToAst.convert(us))),ns.push(us),ls=!0;break}if(!ls){let us=os[0];is.push(Context.fromAst(textToAst.convert(us))),ns.push(us),console.warn("Variables added were not unique")}}return is}async function preprocessMathInverseDefinition({desiredValue:ss,stateValues:ts,variableName:rs="value",arrayKey:ns,workspace:is}){if(!vectorOperators.includes(ss.tree[0])||!ss.tree.includes())return{desiredValue:ss};let as,os=rs+"Ast";if(ns!==void 0&&(os+=`_${ns}`),is[os])as=is[os].slice(0,ss.tree.length);else{let ls=await ts[rs];ls&&ns!==void 0&&(ls=ls[ns]),ls&&vectorOperators.includes(ls.tree[0])&&(as=ls.tree.slice(0,ss.tree.length))}if(as){let ls=[],us=!1;for(let[cs,ps]of ss.tree.entries())ps===void 0?(us=!0,ls.push(cs)):as[cs]=ps;return ss=Context.fromAst(as),is[os]=as,us?{desiredValue:ss,vectorComponentsNotAffected:ls}:{desiredValue:ss}}else{let ls=[];for(let us of ss.tree.slice(1))us===void 0?ls.push(""):ls.push(us);return ss=Context.fromAst([ss.tree[0],...ls]),{desiredValue:ss}}}function normalizeLatexString(ss,{unionFromU:ts=!1}={}){let rs=[["","\\alpha "],["","\\beta "],["","\\beta "],["","\\Gamma "],["","\\gamma "],["","\\Delta "],["","\\delta "],["","\\epsilon "],["","\\epsilon "],["","\\zeta "],["","\\eta "],["","\\Theta "],["","\\Theta "],["","\\theta "],["","\\theta "],["","\\theta "],["","\\iota "],["","\\kappa "],["","\\Lambda "],["","\\lambda "],["","\\mu "],["","\\mu "],["","\\nu "],["","\\Xi "],["","\\xi "],["","\\Pi "],["","\\pi "],["","\\pi "],["","\\rho "],["","\\rho "],["","\\Sigma "],["","\\sigma "],["","\\sigma "],["","\\tau "],["","\\Upsilon "],["","\\upsilon "],["","\\Phi "],["","\\phi "],["","\\phi "],["","\\Psi "],["","\\psi "],["","\\Omega "],["","\\omega "],["","-"],[""," \\cdot "],[""," \\cdot "],[""," \\cup "],[""," \\cap "],[""," \\infty "],[""," \\emptyset "]];for(let as of rs)ss=ss.replaceAll(as[0],as[1]);let ns=ss.match(/^(\\ )*(\\ldots|\.(\\ )*\.(\\ )*\.)(\\ )*(.*)$/);if(ns){let as=ns[6];as[0]!==","?ss="\\ldots,"+as:ss="\\ldots"+as}let is=ss.match(/^(.*?)(\\ )*(\\ldots|\.(\\ )*\.(\\ )*\.)(\\ )*$/);if(is){let as=is[1];as[as.length-1]!==","?ss=as+",\\ldots":ss=as+"\\ldots"}return ss=ss.replaceAll(/(\b|\\ )or(\b|\\ )/g,"$1\\lor$2"),ss=ss.replaceAll(/(\b|\\ )and(\b|\\ )/g,"$1\\land$2"),ts&&(ss=ss.replaceAll(/(\b|\\ )U(\b|\\ )/g,"$1\\cup$2")),ss}function isValidVariable(ss){let ts=ss.tree,rs=!0;return typeof ts=="string"?ts===""&&(rs=!1):(!Array.isArray(ts)||ts[0]!=="_"||typeof ts[1]!="string"||typeof ts[2]!="string"&&typeof ts[2]!="number")&&(rs=!1),rs}function mathStateVariableFromNumberStateVariable({numberVariableName:ss="number",mathVariableName:ts="math",isPublic:rs=!1}={}){let ns={returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:ss}}),definition:function({dependencyValues:is}){return{setValue:{[ts]:numberToMathExpression(is.number)}}},inverseDefinition:function({desiredStateVariableValues:is}){return{success:!0,instructions:[{setDependency:"number",desiredValue:is[ts].evaluate_to_constant()}]}}};return rs&&(ns.public=!0,ns.shadowingInstructions={createComponentOfType:"math"}),ns}function numberToMathExpression(ss){let ts;if(typeof(ss==null?void 0:ss.re)=="number"&&typeof(ss==null?void 0:ss.im)=="number")if(ss.im===0)ts=ss.re;else{let rs;ss.im===1?rs="i":ss.im===-1?rs=["-","i"]:rs=["*",ss.im,"i"],ss.re===0?ts=rs:ts=["+",ss.re,rs]}else ts=ss;return Context.fromAst(ts)}function roundForDisplay({value:ss,dependencyValues:ts,usedDefault:rs}){let ns;return(rs.displayDigits||!(ts.displayDigits>=1))&&!rs.displayDecimals&&Number.isFinite(ts.displayDecimals)?ns=Context.round_numbers_to_decimals(ss,ts.displayDecimals):(ts.displayDigits>=1?ns=Context.round_numbers_to_precision(ss,ts.displayDigits):ns=Context.round_numbers_to_precision(ss,10),ts.displaySmallAsZero>0&&(ns=Context.evaluate_numbers(ns,{skip_ordering:!0,set_small_zero:ts.displaySmallAsZero}))),ns}function mergeListsWithOtherContainers(ss){if(!Array.isArray(ss))return ss;let ts=ss[0],rs=ss.slice(1);return[...vectorOperators,"list","set"].includes(ts)&&(rs=rs.reduce((ns,is)=>Array.isArray(is)&&is[0]==="list"?[...ns,...is.slice(1)]:[...ns,is],[])),rs=rs.map(ns=>mergeListsWithOtherContainers(ns)),[ts,...rs]}function wrapWordWithVar(ss,ts){let rs="",ns=/\\operatorname\s*{[^{}]*}/,is=ss.match(ns);for(;is;){let as=is.index,os=as+is[0].length;rs+=wrapWordWithVarSub(ss.substring(0,as),ts),rs+=ss.substring(as,os),ss=ss.substring(os),is=ss.match(ns)}return rs+=wrapWordWithVarSub(ss,ts),rs}function wrapWordWithVarSub(ss,ts){let rs="";const ns=/([^a-zA-Z0-9]?)([a-zA-Z][a-zA-Z0-9]+)([^a-zA-Z0-9]?)/;let is;if(ts){const os="(E[+\\-]?[0-9]+\\s*($|(?=\\,|&|\\||\\\\\\||\\)|\\}|\\\\}|\\]|\\\\\\\\|\\\\end)))";is=new RegExp("([0-9]+(\\.[0-9]*)?"+os+")|(\\.[0-9]+"+os+")")}let as=ss.match(ns);for(;as;){let os=as.index,ls=os+as[0].length-as[3].length;if(ts){let us=ss.match(is);if(us&&us.index<ls&&us.index+us[0].length>os){rs+=ss.substring(0,ls),ss=ss.substring(ls),as=ss.match(ns);continue}}if(as[1]==="\\")rs+=ss.substring(0,ls),ss=ss.substring(ls);else{let us=os+as[1].length;rs+=ss.substring(0,us),rs+=`\\operatorname{${as[2]}}`,ss=ss.substring(ls)}as=ss.match(ns)}return rs+=ss,rs}function wrapWordIncludingNumberWithVar(ss,ts){let rs="",ns=/\\operatorname\s*{[^{}]*}/,is=ss.match(ns);for(;is;){let as=is.index,os=as+is[0].length;rs+=wrapWordIncludingNumberWithVarSub(ss.substring(0,as),ts),rs+=ss.substring(as,os),ss=ss.substring(os),is=ss.match(ns)}return rs+=wrapWordIncludingNumberWithVarSub(ss,ts),rs}function wrapWordIncludingNumberWithVarSub(ss,ts){let rs="";const ns=/([^a-zA-Z0-9\s]?\s*)([a-zA-Z][a-zA-Z0-9]*[0-9][a-zA-Z0-9]*)([^a-zA-Z0-9]?)/;let is;if(ts){const os="(E[+\\-]?[0-9]+\\s*($|(?=\\,|&|\\||\\\\\\||\\)|\\}|\\\\}|\\]|\\\\\\\\|\\\\end)))";is=new RegExp("([0-9]+(\\.[0-9]*)?"+os+")|(\\.[0-9]+"+os+")")}let as=ss.match(ns);for(;as;){let os=as.index,ls=os+as[0].length-as[3].length;if(ts){let us=ss.match(is);if(us&&us.index<ls&&us.index+us[0].length>os){rs+=ss.substring(0,ls),ss=ss.substring(ls),as=ss.match(ns);continue}}if(as[1]==="\\"||as[1][0]==="^"||as[1][0]==="_")rs+=ss.substring(0,ls),ss=ss.substring(ls);else{let us=os+as[1].length;rs+=ss.substring(0,us),rs+=`\\operatorname{${as[2]}}`,ss=ss.substring(ls)}as=ss.match(ns)}return rs+=ss,rs}function stripLatex(ss){return ss.replaceAll("\\,","").replaceAll(/\\operatorname{([^{}]*)}/g,"$1")}function superSubscriptsToUnicode(ss){let ts={0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"","+":"","-":""," ":""},rs={0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"","+":"","-":""," ":""};function ns(as,os){let ls="";for(let us of os)ls+=ts[us];return ls}function is(as,os){let ls="";for(let us of os)ls+=rs[us];return ls}return ss=ss.replaceAll(/_(\d+)/g,ns),ss=ss.replaceAll(/_\(([\d +-]+)\)/g,ns),ss=ss.replaceAll(/\^(\d+)/g,is),ss=ss.replaceAll(/\^\(([\d +-]+)\)/g,is),ss}function unicodeToSuperSubscripts(ss){let ts={"":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"+","":"-"},rs={"":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"+","":"-"};function ns(as,os){let ls="";for(let us of os)ls+=ts[us];return"_("+ls+")"}function is(as,os){let ls="";for(let us of os)ls+=rs[us];return"^("+ls+")"}return ss=ss.replaceAll(/([\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u208A\u208B]+)/g,ns),ss=ss.replaceAll(/([\u2070\u00B9\u00B2\u00B3\u2074\u2075\u2076\u2077\u2078\u2079\u207A\u207B]+)/g,is),ss}const vectorOperators=["vector","altvector","tuple"];function renameStateVariable({stateVariableDefinitions:ss,oldName:ts,newName:rs}){let ns=ss[rs]=ss[ts];if(delete ss[ts],ns.additionalStateVariablesDefined){let us=ns.additionalStateVariablesDefined.indexOf(ts);us!==-1&&(ns.additionalStateVariablesDefined[us]=rs)}let is=ns.definition,as=["setValue","useEssentialOrDefaultValue","setEssentialValue"],os=["noChanges"];ns.definition=function(us){let cs=is(us);for(let ps of as)cs[ps]&&ts in cs[ps]&&(cs[ps][rs]=cs[ps][ts],delete cs[ps][ts]);for(let ps of os)if(cs[ps]){let ds=cs[ps].indexOf(ts);ds!==-1&&(cs[ps][ds]=rs)}return cs};let ls=ns.inverseDefinition;ls&&(ns.inverseDefinition=async function(us){let cs=us.desiredStateVariableValues;cs[ts]=cs[rs],delete cs[rs];let ps=await ls(us);if(ps.success)for(let ds of ps.instructions)ds.setEssentialValue===ts&&(ds.setEssentialValue=rs);return ps})}function returnDefaultGetArrayKeysFromVarName(ss){return ss>1?function({arrayEntryPrefix:ts,varEnding:rs,arraySize:ns,nDimensions:is}){let as=rs.split("_").map(os=>Number(os)-1);return as.length===is&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?ns?as.every((os,ls)=>os<ns[ls])?[String(as)]:[]:[String(as)]:[]}:function({arrayEntryPrefix:ts,varEnding:rs,arraySize:ns}){let is=Number(rs)-1;return Number.isInteger(is)&&is>=0?ns?is<ns[0]?[String(is)]:[]:[String(is)]:[]}}let nanoid=(ss=21)=>crypto.getRandomValues(new Uint8Array(ss)).reduce((ts,rs)=>(rs&=63,rs<36?ts+=rs.toString(36):rs<62?ts+=(rs-26).toString(36).toUpperCase():rs>62?ts+="-":ts+="_",ts),""),styleAttributes={lineColor:{componentType:"text"},lineColorWord:{componentType:"text"},lineColorDarkMode:{componentType:"text"},lineColorWordDarkMode:{componentType:"text"},lineOpacity:{componentType:"number"},lineWidth:{componentType:"number"},lineWidthWord:{componentType:"text"},lineStyle:{componentType:"text"},lineStyleWord:{componentType:"text"},markerColor:{componentType:"text"},markerColorWord:{componentType:"text"},markerColorDarkMode:{componentType:"text"},markerColorWordDarkMode:{componentType:"text"},markerStyle:{componentType:"text"},markerStyleWord:{componentType:"text"},markerSize:{componentType:"number"},fillColor:{componentType:"text"},fillColorWord:{componentType:"text"},fillColorDarkMode:{componentType:"text"},fillColorWordDarkMode:{componentType:"text"},fillOpacity:{componentType:"number"}},defaultStyle={lineColor:"#648FFF",lineColorWord:"blue",lineColorDarkMode:"#648FFF",lineColorWordDarkMode:"blue",lineOpacity:.7,lineWidth:4,lineWidthWord:"thick",lineStyle:"solid",lineStyleWord:"",markerColor:"#648FFF",markerColorWord:"blue",markerColorDarkMode:"#648FFF",markerColorWordDarkMode:"blue",markerStyle:"circle",markerStyleWord:"point",markerSize:5,fillColor:"#648FFF",fillColorWord:"blue",fillColorDarkMode:"#648FFF",fillColorWordDarkMode:"blue",fillOpacity:.3};function returnDefaultStyleDefinitions(){return{1:{lineColor:"#648FFF",lineColorWord:"blue",lineColorDarkMode:"#648FFF",lineColorWordDarkMode:"blue",lineOpacity:.7,lineWidth:4,lineWidthWord:"thick",lineStyle:"solid",lineStyleWord:"",markerColor:"#648FFF",markerColorWord:"blue",markerColorDarkMode:"#648FFF",markerColorWordDarkMode:"blue",markerStyle:"circle",markerStyleWord:"point",markerSize:5,fillColor:"#648FFF",fillColorWord:"blue",fillColorDarkMode:"#648FFF",fillColorWordDarkMode:"blue",fillOpacity:.3},2:{lineColor:"#D4042D",lineColorWord:"red",lineColorDarkMode:"#D4042D",lineColorWordDarkMode:"red",lineOpacity:.7,lineWidth:2,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#D4042D",markerColorWord:"red",markerColorDarkMode:"#D4042D",markerColorWordDarkMode:"red",markerStyle:"square",markerStyleWord:"square",markerSize:5,fillColor:"#D4042D",fillColorWord:"red",fillColorDarkMode:"#D4042D",fillColorWordDarkMode:"red",fillOpacity:.3},3:{lineColor:"#F19143",lineColorWord:"orange",lineColorDarkMode:"#F19143",lineColorWordDarkMode:"orange",lineOpacity:.7,lineWidth:3,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#F19143",markerColorWord:"orange",markerColorDarkMode:"#F19143",markerColorWordDarkMode:"orange",markerStyle:"triangle",markerStyleWord:"triangle",markerSize:5,fillColor:"#F19143",fillColorWord:"orange",fillColorDarkMode:"#F19143",fillColorWordDarkMode:"orange",fillOpacity:.3},4:{lineColor:"#644CD6",lineColorWord:"purple",lineColorDarkMode:"#644CD6",lineColorWordDarkMode:"purple",lineOpacity:.7,lineWidth:2,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#644CD6",markerColorWord:"purple",markerColorDarkMode:"#644CD6",markerColorWordDarkMode:"purple",markerStyle:"diamond",markerStyleWord:"diamond",markerSize:5,fillColor:"#644CD6",fillColorWord:"purple",fillColorDarkMode:"#644CD6",fillColorWordDarkMode:"purple",fillOpacity:.3},5:{lineColor:"black",lineColorWord:"black",lineColorDarkMode:"white",lineColorWordDarkMode:"white",lineOpacity:.7,lineWidth:1,lineWidthWord:"thin",lineStyle:"solid",lineStyleWord:"",markerColor:"black",markerColorWord:"black",markerColorDarkMode:"white",markerColorWordDarkMode:"white",markerStyle:"circle",markerStyleWord:"point",markerSize:5,fillColor:"black",fillColorWord:"black",fillColorDarkMode:"white",fillColorWordDarkMode:"white",fillOpacity:.3},6:{lineColor:"gray",lineColorWord:"gray",lineColorDarkMode:"gray",lineColorWordDarkMode:"gray",lineOpacity:.7,lineWidth:1,lineWidthWord:"thin",lineStyle:"dotted",lineStyleWord:"dotted",markerColor:"gray",markerColorWord:"gray",markerColorDarkMode:"gray",markerColorWordDarkMode:"gray",markerStyle:"circle",markerStyleWord:"point",markerSize:5,fillColor:"gray",fillColorWord:"gray",fillColorDarkMode:"gray",fillColorWordDarkMode:"gray",fillOpacity:.3}}}function returnStyleDefinitionStateVariables(){let ss={};return ss.setupChildren={returnDependencies:()=>({setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}}),definition({dependencyValues:ts}){return{setValue:{setupChildren:ts.setupChildren}}}},ss.styleDefinitions={stateVariablesDeterminingDependencies:["setupChildren"],returnDependencies({stateValues:ts}){let rs={ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]},setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}};for(let ns of ts.setupChildren)rs[`styleDefinitionsOf${ns.componentName}`]={dependencyType:"child",parentName:ns.componentName,childGroups:["styleDefinitions"],variableNames:["value"]};return rs},definition({dependencyValues:ts}){let rs={},ns;ts.ancestorWithStyle&&(ns=ts.ancestorWithStyle.stateValues.styleDefinitions),ns||(ns=returnDefaultStyleDefinitions());for(let as in ns)rs[as]=Object.assign({},ns[as]);let is=[];for(let as of ts.setupChildren)is.push(...ts[`styleDefinitionsOf${as.componentName}`]);for(let as of is){let os=as.stateValues.value;for(let ls in os){let us=rs[ls];us||(us=rs[ls]=Object.assign({},defaultStyle));let cs=Object.assign({},os[ls]);"markerColor"in cs&&!("markerColorWord"in cs)&&(cs.markerColorWord=cs.markerColor),"markerColorDarkMode"in cs&&!("markerColorWordDarkMode"in cs)&&(cs.markerColorWordDarkMode=cs.markerColorDarkMode),"markerColor"in cs&&!("markerColorDarkMode"in cs)&&(cs.markerColorDarkMode=cs.markerColor,cs.markerColorWordDarkMode=cs.markerWordColor),"markerStyle"in cs&&!("markerStyleWord"in cs)&&(cs.markerStyleWord=cs.markerStyle,cs.markerStyleWord==="circle"?cs.markerStyleWord="point":cs.markerStyleWord.slice(0,8)==="triangle"&&(cs.markerStyleWord="triangle")),"lineColor"in cs&&!("lineColorWord"in cs)&&(cs.lineColorWord=cs.lineColor),"lineColorDarkMode"in cs&&!("lineColorWordDarkMode"in cs)&&(cs.lineColorWordDarkMode=cs.lineColorDarkMode),"lineColor"in cs&&!("lineColorDarkMode"in cs)&&(cs.lineColorDarkMode=cs.lineColor,cs.lineColorWordDarkMode=cs.lineWordColor),"fillColor"in cs&&!("fillColorWord"in cs)&&(cs.fillColorWord=cs.fillColor),"fillColorDarkMode"in cs&&!("fillColorWordDarkMode"in cs)&&(cs.fillColorWordDarkMode=cs.fillColorDarkMode),"fillColor"in cs&&!("fillColorDarkMode"in cs)&&(cs.fillColorDarkMode=cs.fillColor,cs.fillColorWordDarkMode=cs.fillWordColor),"lineWidth"in cs&&!("lineWidthWord"in cs)&&(cs.lineWidth>=4?cs.lineWidthWord="thick":cs.lineWidth<=1?cs.lineWidthWord="thin":cs.lineWidthWord=""),"lineStyle"in cs&&!("lineStyleWord"in cs)&&(cs.lineStyle==="dashed"?cs.lineStyleWord="dashed":cs.lineStyle==="dotted"?cs.lineStyleWord="dotted":cs.lineStyleWord=""),Object.assign(us,cs)}}return{setValue:{styleDefinitions:rs}}}},ss}function returnSelectedStyleStateVariableDefinition(){return{selectedStyle:{forRenderer:!0,willNeverBeEssential:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:ss}){let ts=ss.ancestorWithStyle.stateValues.styleDefinitions;ts||(ts=returnDefaultStyleDefinitions());let rs=ts[ss.styleNumber];return rs===void 0&&(rs=defaultStyle),{setValue:{selectedStyle:rs}}}}}}function enumerateSelectionCombinations({numberOfIndices:ss,numberOfOptions:ts,maxNumber:rs=1/0,withReplacement:ns=!1,skipZero:is=!1}){if(ss===1){let us=[...Array(ts).keys()];return us=us.slice(1),is||(us=[...us,0]),us=us.slice(0,rs),us=us.map(cs=>[cs]),us}let as=enumerateSelectionCombinations({numberOfIndices:ss-1,numberOfOptions:ts,maxNumber:rs,withReplacement:ns,skipZero:!ns}),os=[],ls=0;for(let us of as)for(let cs=1;cs<=ts;cs++){let ps=[cs%ts,...us.map(ds=>(cs+ds)%ts)];if(!(is&&ps.includes(0))&&(os.push(ps),ls++,ls>=rs))return os}return os}function enumerateCombinations({numberOfOptionsByIndex:ss,maxNumber:ts=1/0}){let rs=ss.length;if(rs===0)return[];let ns=[];for(let ys=0;ys<rs;ys++){let gs=[];for(let bs=0;bs<ys;bs++)gs.push(Context.math.gcd(ss[ys],ss[bs]));ns.push(gs)}let is=ns.reduce((ys,gs)=>[...gs,...ys],[]).reduce((ys,gs)=>Math.max(ys,gs),1);if(is===1){let ys=ss.reduce((bs,vs)=>bs*vs);ys=Math.min(ys,ts);let gs=[];for(let bs=0;bs<ys;bs++){let vs=ss.map(Ns=>bs%Ns);gs.push(vs)}return gs}if(rs===2){let ys=is,gs=Context.math.lcm(...ss),bs=[],vs=0;for(let Ns=0;Ns<ys;Ns++)for(let Ts=0;Ts<gs;Ts++){let Cs=[Ts%ss[0],(Ts+Ns)%ss[1]];if(bs.push(Cs),vs++,vs>=ts)return bs}return bs}let as=[];for(let ys=0;ys<rs;ys++){let gs=[];for(let bs=0;bs<ys;bs++)ns[ys][bs]>1?gs.push(Context.math.lcm(ss[ys],ss[bs])):gs.push(null);as.push(gs)}let os=as.reduce((ys,gs)=>[...gs,...ys],[]).filter(ys=>ys!==null).reduce((ys,gs)=>Math.min(ys,gs),1/0),ls;for(let ys=0;ys<rs;ys++){for(let gs=0;gs<ys;gs++)if(as[ys][gs]===os){ls=[gs,ys];break}if(ls)break}let us=ss[ls[0]],cs=ss[ls[1]],ps=[us,cs],ds=[...ss];ds[ls[0]]=us*cs,ds.splice(ls[1],1);let fs=enumerateCombinations({numberOfOptionsByIndex:ds,maxNumber:ts}),hs=enumerateCombinations({numberOfOptionsByIndex:ps,maxNumber:ts});for(let ys of fs){let gs=hs[ys[ls[0]]];ys.splice(ls[0],1,gs[0]),ys.splice(ls[1],0,gs[1])}return fs}function enumeratePermutations({values:ss,maxNumber:ts}){let rs=[];const ns=(is,as=[])=>{if(is.length===0)rs.push(as);else for(let os=0;os<is.length;os++){let ls=is.slice(),us=ls.splice(os,1);if(ns(ls.slice(),as.concat(us)),rs.length>=ts)return}};return ns(ss),rs}function returnStandardSequenceAttributes(){return{type:{createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"number",toLowerCase:!0,validValues:["number","math","letters"]},from:{createComponentOfType:"_componentWithSelectableType"},to:{createComponentOfType:"_componentWithSelectableType"},step:{createComponentOfType:"math"},length:{createComponentOfType:"number"},exclude:{createComponentOfType:"_componentListWithSelectableType"}}}function returnStandardSequenceStateVariableDefinitions(){let ss={};return ss.specifiedFrom={returnDependencies:()=>({fromAttr:{dependencyType:"attributeComponent",attributeName:"from",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"from",definition:function({dependencyValues:ts}){return ts.fromAttr===null?{useEssentialOrDefaultValue:{specifiedFrom:!0}}:ts.fromAttr.stateValues.value===null?{setValue:{specifiedFrom:NaN}}:{setValue:{specifiedFrom:ts.fromAttr.stateValues.value}}}},ss.specifiedTo={returnDependencies:()=>({toAttr:{dependencyType:"attributeComponent",attributeName:"to",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"to",definition:function({dependencyValues:ts}){return ts.toAttr===null?{useEssentialOrDefaultValue:{specifiedTo:!0}}:ts.toAttr.stateValues.value===null?{setValue:{specifiedTo:NaN}}:{setValue:{specifiedTo:ts.toAttr.stateValues.value}}}},ss.specifiedLength={returnDependencies:()=>({lengthAttr:{dependencyType:"attributeComponent",attributeName:"length",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"length",definition:function({dependencyValues:ts}){return ts.lengthAttr===null?{useEssentialOrDefaultValue:{specifiedLength:!0}}:ts.lengthAttr.stateValues.value===null?{setValue:{specifiedLength:NaN}}:{setValue:{specifiedLength:ts.lengthAttr.stateValues.value}}}},ss.specifiedStep={returnDependencies:()=>({stepAttr:{dependencyType:"attributeComponent",attributeName:"step",variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"}}),defaultValue:null,hasEssential:!0,essentialVarName:"step",definition:function({dependencyValues:ts}){if(ts.stepAttr===null)return{useEssentialOrDefaultValue:{specifiedStep:!0}};let rs=ts.stepAttr.stateValues.value;return rs===null?{setValue:{specifiedStep:NaN}}:{setValue:{specifiedStep:rs}}}},ss.specifiedExclude={returnDependencies:()=>({excludeAttr:{dependencyType:"attributeComponent",attributeName:"exclude",variableNames:["values"]}}),defaultValue:[],hasEssential:!0,essentialVarName:"exclude",definition:function({dependencyValues:ts}){return ts.excludeAttr===null?{useEssentialOrDefaultValue:{specifiedExclude:!0}}:{setValue:{specifiedExclude:ts.excludeAttr.stateValues.values}}}},ss.lowercase={returnDependencies:()=>({specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"}}),definition:function({dependencyValues:ts}){let rs=/^[A-Z]*$/,ns=!0;return ts.specifiedFrom!==null?rs.test(ts.specifiedFrom)&&(ns=!1):ts.specifiedTo!==null&&rs.test(ts.specifiedTo)&&(ns=!1),{setValue:{lowercase:ns}}}},ss.validSequence={returnDependencies:()=>({specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition:function({dependencyValues:ts}){let rs=!0;if(ts.specifiedLength!==null&&(!Number.isInteger(ts.specifiedLength)||ts.specifiedLength<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),rs=!1),ts.specifiedStep!==null&&ts.type!=="math"){let ns=findFiniteNumericalValue(ts.specifiedStep);Number.isFinite(ns)||(console.warn("Invalid step of sequence.  Must be a number for sequence of type "+ts.type+"."),rs=!1)}if(ts.specifiedFrom!==null)if(ts.type==="number"){let ns=findFiniteNumericalValue(ts.specifiedFrom);Number.isFinite(ns)||(console.warn("Invalid from of number sequence.  Must be a number"),rs=!1)}else Number.isNaN(ts.specifiedFrom)&&(console.warn("Invalid from of sequence"),rs=!1);if(ts.specifiedTo!==null)if(ts.type==="number"){let ns=findFiniteNumericalValue(ts.specifiedTo);Number.isFinite(ns)||(console.warn("Invalid to of number sequence.  Must be a number"),rs=!1)}else Number.isNaN(ts.specifiedTo)&&(console.warn("Invalid to of sequence"),rs=!1);return{setValue:{validSequence:rs}}}},ss.from={additionalStateVariablesDefined:["step","length","exclude"],returnDependencies:()=>({specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},type:{dependencyType:"stateVariable",variableName:"type"},specifiedExclude:{dependencyType:"stateVariable",variableName:"specifiedExclude"},validSequence:{dependencyType:"stateVariable",variableName:"validSequence"}}),definition:function({dependencyValues:ts}){let rs=ts.specifiedFrom,ns=ts.specifiedTo,is=ts.specifiedStep,as=ts.specifiedLength,os=[...ts.specifiedExclude],ls=ts.type;if(ts.type==="math")ns!==null&&(ns instanceof Context.class||(ns=Context.fromAst(ns))),rs!==null&&(rs instanceof Context.class||(rs=Context.fromAst(rs))),is!==null&&(is instanceof Context.class||(is=Context.fromAst(is)));else if(is!==null&&is instanceof Context.class&&(is=is.evaluate_to_constant()),ts.type==="letters")rs!==null&&(rs=lettersToNumber$1(rs)),ns!==null&&(ns=lettersToNumber$1(ns)),os=os.map(lettersToNumber$1);else if(ts.type==="number"){ns!==null&&(ns instanceof Context.class?ns=ns.evaluate_to_constant():ns=Number(ns)),rs!==null&&(rs instanceof Context.class?rs=rs.evaluate_to_constant():rs=Number(rs));for(let[us,cs]of os.entries())cs instanceof Context.class?os[us]=cs.evaluate_to_constant():os[us]=Number(cs)}if(ts.validSequence){let us=calculateSequenceParameters({from:rs,to:ns,step:is,length:as,type:ls});return us.exclude=os,{setValue:us}}return(!Number.isInteger(as)||as<0)&&(as=0),{setValue:{from:rs,step:is,length:as,exclude:os}}}},ss}function calculateSequenceParameters({from:ss,to:ts,step:rs,length:ns,type:is}){if(ss===null)ts===null?(is==="math"?ss=Context.fromAst(1):ss=1,rs===null&&(is==="math"?rs=Context.fromAst(1):rs=1),ns===null&&(ns=10)):(rs===null&&(is==="math"?rs=Context.fromAst(1):rs=1),ns===null&&(is==="math"?ns=Math.floor((ts.subtract(1).divide(rs).evaluate_to_constant()+1)*(1+1e-14)):ns=Math.floor(((ts-1)/rs+1)*(1+1e-14))),is==="math"?ss=ts.subtract(rs.multiply(ns-1)).simplify():(ss=ts-rs*(ns-1),is==="letters"&&ss<1&&(ns=Math.floor(((ts-1)/rs+1)*(1+1e-14)),ss=ts-rs*(ns-1))));else if(ts===null)rs===null&&(is==="math"?rs=Context.fromAst(1):rs=1),ns===null&&(ns=10);else if(rs===null)ns===null?is==="math"?(rs=Context.fromAst(1),ns=Math.floor(ts.subtract(ss).add(1).evaluate_to_constant()*(1+1e-14))):(rs=1,ns=Math.floor((ts-ss+1)*(1+1e-14))):is==="math"?rs=ts.subtract(ss).divide(ns-1):(rs=(ts-ss)/(ns-1),is==="letters"&&(rs=Math.floor(rs)));else if(ns===null)is==="math"?ns=Math.floor(ts.subtract(ss).divide(rs).add(1).evaluate_to_constant()*(1+1e-14)):ns=Math.floor(((ts-ss)/rs+1)*(1+1e-14));else throw Error("Can't define from, to, step, and length for sequence");return(!Number.isInteger(ns)||ns<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),ns=0),{from:ss,step:rs,length:ns}}function returnSequenceValues({from:ss,step:ts,length:rs,exclude:ns,type:is,lowercase:as,maxNum:os},ls=!1){let us=[],cs=0;for(let ps=0;ps<rs;ps++){let ds=ss;if(ps>0&&(is==="math"?ds=ds.add(ts.multiply(Context.fromAst(ps))).expand().simplify():ds+=ts*ps),is==="math"){if(ns.some(fs=>fs&&fs.equals(ds)))continue}else if(is==="number"){if(ns.some(fs=>Math.abs(fs-ds)<=1e-14*Math.max(Math.abs(fs),Math.abs(ds))))continue}else if(ns.includes(ds))continue;if(is==="letters"&&(ds=numberToLetters(ds,as)),ls?us.push({value:ds,originalIndex:ps}):us.push(ds),cs++,cs===os)break}return us}function returnSequenceValueForIndex({index:ss,from:ts,step:rs,length:ns,exclude:is,type:as,lowercase:os}){if(!(ss>=0&&(ns===void 0||ss<ns)))return null;let ls=ts;if(ss>0&&(as==="math"?ls=ls.add(rs.multiply(Context.fromAst(ss))).expand().simplify():ls+=rs*ss),as==="math"){if(is.some(us=>us&&us.equals(ls)))return null}else if(as==="number"){if(is.some(us=>Math.abs(us-ls)<=1e-14*Math.max(Math.abs(us),Math.abs(ls))))return null}else if(is.includes(ls))return null;return as==="letters"&&(ls=numberToLetters(ls,os)),ls}function lettersToNumber$1(ss){try{ss=ss.toUpperCase()}catch{console.warn("Cannot convert "+ss+" to a number");return}let ts=0,rs=ss.length,ns=rs;for(;(ns-=1)>-1;){let is=ss.charCodeAt(ns)-64;if(is<1||is>26){console.warn("Cannot convert "+ss+" to a number");return}ts+=is*Math.pow(26,rs-1-ns)}return ts}function numberToLetters(ss,ts){ss--;let rs=65;ts&&(rs=97);let ns="";for(;;){let is=ss%26;if(ns=String.fromCharCode(rs+is)+ns,ss<26)break;ss=Math.floor(ss/26)-1}return ns}function getVariantsForDescendantsForUniqueVariants({variantIndex:ss,serializedComponent:ts,componentInfoObjects:rs}){var ls;let ns=(ls=ts.variants)==null?void 0:ls.descendantVariantComponents;if(ns===void 0)return{success:!1};let is=ns.map(us=>us.variants.numberOfVariants),as=enumerateCombinations({numberOfOptionsByIndex:is,maxNumber:ss})[ss-1],os=[];for(let[us,cs]of ns.entries()){let ds=rs.allComponentClasses[cs.componentType].getUniqueVariant({serializedComponent:cs,variantIndex:as[us]+1,componentInfoObjects:rs});if(ds.success)os.push(ds.desiredVariant);else return{succss:!1}}return{success:!0,desiredVariants:os}}function setUpVariantSeedAndRng({serializedComponent:ss,sharedParameters:ts,descendantVariantComponents:rs,useSubpartVariantRng:ns=!1}){let is,as;if(ss.variants&&(as=ss.variants.desiredVariant),(as==null?void 0:as.seed)!==void 0?is=as.seed.toString():ns?is=ts.subpartVariantRng().toString().slice(2):is=ts.variantRng().toString().slice(2),ts.variantSeed=is,ts.variantRng=new ts.rngClass(ts.variantSeed),ts.subpartVariantRng=new ts.rngClass(ts.variantSeed+"s"),as!=null&&as.subvariants&&rs)for(let os in as.subvariants){let ls=as.subvariants[os],us=rs[os];if(us===void 0)break;us.variants.desiredVariant=ls}}function gatherVariantComponents({serializedComponents:ss,componentInfoObjects:ts}){let rs=[];for(let ns of ss){if(typeof ns!="object")continue;if(ns.variants||(ns.variants={}),ns.variants.isVariantComponent){rs.push(ns);continue}if(ns.componentType in ts.componentTypesCreatingVariants){ns.variants.isVariantComponent=!0,rs.push(ns);continue}if(!ns.children)continue;if(ns.children.some(os=>os.componentType==="variantControl")){ns.variants.isVariantComponent=!0,rs.push(ns);continue}let as=gatherVariantComponents({serializedComponents:ns.children,componentInfoObjects:ts});as.length>0&&(ns.variants.descendantVariantComponents=as,rs.push(...as))}return rs}function getNumberOfVariants({serializedComponent:ss,componentInfoObjects:ts}){ss.variants||(ss.variants={});let rs;for(let is of ss.children)if(is.componentType==="variantControl"){rs=is;break}let ns=ss.componentType==="document";if(!rs){if(!ns)return{success:!1};let is=ss.children.filter(as=>as.componentType||as.trim()!=="");if(is.length===1&&ts.isInheritedComponentType({inheritedComponentType:is[0].componentType,baseComponentType:"_sectioningComponent"})){let as=is[0],os=getNumberOfVariants({serializedComponent:as,componentInfoObjects:ts});if(os.success)return ss.variants.descendantVariantComponents=gatherVariantComponents({serializedComponents:ss.children,componentInfoObjects:ts}),ss.variants.uniqueVariants=!0,ss.variants.numberOfVariants=as.variants.numberOfVariants,ss.variants.allPossibleVariants=as.variants.allPossibleVariants,ss.variants.allVariantNames=as.variants.allVariantNames,ss.variants.allPossibleVariantUniqueIndices=[...as.variants.allPossibleVariants.keys()].map(ls=>ls+1),ss.variants.allPossibleVariantSeeds=[...as.variants.allPossibleVariants.keys()].map(ls=>(ls+1).toString()),os}}return determineVariantsForSection({serializedComponent:ss,componentInfoObjects:ts,isDocument:ns})}function determineVariantsForSection({serializedComponent:ss,componentInfoObjects:ts,isDocument:rs=!1}){var Cs,xs,As,ws;ss.variants===void 0&&(ss.variants={});let ns;for(let Es of ss.children)if(Es.componentType==="variantControl"){ns=Es;break}if(!ns&&!rs)return ts.allComponentClasses._base.determineNumberOfUniqueVariants({serializedComponent:ss,componentInfoObjects:ts});let is=[];if(ns!=null&&ns.attributes.variantNames&&(is=ns.attributes.variantNames.component.children.map(Es=>Es.toLowerCase())),is.length!==[...new Set(is)].length)throw Error("Duplicate variant names specified");let as=(Cs=ns==null?void 0:ns.attributes.nVariants)==null?void 0:Cs.primitive;Number.isFinite(as)||(as=100),as=Math.min(Math.max(as,1),1e3);let os=[...is];if(os.length<as){let Es=os.length,Ss=Es,Ds;for(;Es<as;){for(Es++,Ss++,Ds=indexToLowercaseLetters(Ss);is.includes(Ds);)Ss++,Ds=indexToLowercaseLetters(Ss);os.push(Ds)}}else os=os.slice(0,as);let ls=(xs=ns==null?void 0:ns.attributes.variantsToInclude)==null?void 0:xs.component.children;if(ls){if(ls.length===0)throw Error("Cannot specify a blank variantsToInclude attribute of a variantControl");ls=ls.map(Es=>Es.toLowerCase()),ls=[...new Set(ls)];for(let Es of ls)if(!os.includes(Es))throw Error(`Cannot include variant ${Es} as ${Es} is a not variant name`)}let us=(As=ns==null?void 0:ns.attributes.variantsToExclude)==null?void 0:As.component.children;if(us){us=us.map(Es=>Es.toLowerCase());for(let Es of us)if(!os.includes(Es))throw Error(`Cannot exclude variant ${Es} as ${Es} is not a variant name`)}else us=[];ls?ls=ls.filter(Es=>!us.includes(Es)):ls=[...os].filter(Es=>!us.includes(Es));let cs=ls.map(Es=>os.indexOf(Es)+1),ps=[];ns!=null&&ns.attributes.seeds&&(ps=ns.attributes.seeds.component.children);let ds=[...ps];if(ds.length<as){let Es=ds.length,Ss=Es,Ds;for(;Es<as;){for(Es++,Ss++,Ds=Ss.toString();ps.includes(Ds);)Ss++,Ds=Ss.toString();ds.push(Ds)}}else ds=ds.slice(0,as);let fs=cs.map(Es=>ds[Es-1]),hs=(ns==null?void 0:ns.attributes.uniqueVariants)!==void 0,ys=(ws=ns==null?void 0:ns.attributes.uniqueVariants)==null?void 0:ws.primitive,gs;(ys||!hs)&&(gs=ts.allComponentClasses._base.determineNumberOfUniqueVariants({serializedComponent:ss,componentInfoObjects:ts}),gs.success?ys=ys||gs.numberOfVariants<=as:ys=!1);let bs=[],vs=[],Ns=[];if(ys)for(let[Es,Ss]of cs.entries())Ss<=gs.numberOfVariants&&(vs.push(Ss),bs.push(ls[Es]),Ns.push(fs[Es]));else bs=ls,vs=cs,Ns=fs;let Ts=bs.length;if(Ts===0)throw Error("No variants selected based on variantsToInclude, variantsToExclude, and the number of variants available");return ss.variants.uniqueVariants=ys,ss.variants.numberOfVariants=Ts,ss.variants.allPossibleVariants=bs,ss.variants.allVariantNames=os,ss.variants.allPossibleVariantUniqueIndices=vs,ss.variants.allPossibleVariantSeeds=Ns,{success:!0,numberOfVariants:Ts}}function indexToLowercaseLetters(ss){return numberToLetters(ss,!0)}class BaseComponent{constructor({componentName:ts,ancestors:rs,serializedComponent:ns,definingChildren:is,serializedChildren:as,attributes:os,stateVariableDefinitions:ls,componentInfoObjects:us,coreFunctions:cs,flags:ps,shadow:ds,numerics:fs,parentSharedParameters:hs,sharedParameters:ys}){this.numerics=fs,this.parentSharedParameters=hs,this.sharedParameters=ys,this.componentName=ts,this.ancestors=rs,this.counters={},this.componentInfoObjects=us,this.coreFunctions=cs,this.flags=ps,ds===!0&&(this.isShadow=!0),this.definingChildren=is,this.definingChildren===void 0&&(this.definingChildren=[]),this.serializedChildren=as,this.attributes=os,this.state={};for(let gs in ls)this.state[gs]=Object.assign({},ls[gs]);this.stateValues=new Proxy(this.state,createStateProxyHandler()),this.essentialState={},ns.state&&(this.essentialState=deepClone(ns.state)),this.doenetAttributes={},ns.doenetAttributes!==void 0&&Object.assign(this.doenetAttributes,ns.doenetAttributes),ns.variants!==void 0&&(this.variants=ns.variants),ns.range&&(this.doenetMLrange=ns.range),this.actions={copyDoenetMLToClipboard:this.copyDoenetMLToClipboard.bind(this)}}static get rendererType(){return this.componentType}get componentType(){return this.constructor.componentType}get componentOrAdaptedName(){return this.adaptedFrom?this.adaptedFrom.componentOrAdaptedName:this.componentName}get rendererType(){return this.constructor.rendererType}get allPotentialRendererTypes(){let ts=[];this.rendererType&&ts.push(this.rendererType);for(let rs in this.state){let ns=this.state[rs];if(ns.public){let is=ns.componentType;Array.isArray(is)||(is=[is]),ns.wrappingComponents&&is.push(...flattenDeep(ns.wrappingComponents).map(as=>typeof as=="object"?as.componentType:as));for(let as of is){let os=this.componentInfoObjects.allComponentClasses[as];if(os){let ls=os.rendererType;ls&&!ts.includes(ls)&&ts.push(ls)}}}}if(this.constructor.adapters)for(let rs of this.constructor.adapters){let ns;typeof rs=="string"?ns=rs:ns=rs.componentType;let is=this.componentInfoObjects.allComponentClasses[ns];if(is){let as=is.rendererType;as&&!ts.includes(as)&&ts.push(as)}}if(!this.rendererType)return ts;for(let rs in this.allChildren){let ns=this.allChildren[rs].component;if(typeof ns=="object")for(let is of ns.allPotentialRendererTypes)ts.includes(is)||ts.push(is)}return ts}potentialRendererTypesFromSerializedComponents(ts){var ns;let rs=[];for(let is of ts){let as=this.componentInfoObjects.allComponentClasses[is.componentType];if(as){let os=as.rendererType;os&&!rs.includes(os)&&rs.push(os);let ls=as.returnStateVariableInfo({onlyPublic:!0}).stateVariableDescriptions;for(let us in ls){let cs=ls[us],ps=(ns=cs.shadowingInstructions)==null?void 0:ns.createComponentOfType;Array.isArray(ps)||(ps=[ps]),cs.wrappingComponents&&ps.push(...flattenDeep(cs.wrappingComponents).map(ds=>typeof ds=="object"?ds.componentType:ds));for(let ds of ps){let fs=this.componentInfoObjects.allComponentClasses[ds];if(fs){let hs=fs.rendererType;hs&&!rs.includes(hs)&&rs.push(hs)}}}if(as.adapters)for(let us of as.adapters){let cs;typeof us=="string"?cs=us:cs=us.componentType;let ps=this.componentInfoObjects.allComponentClasses[cs];if(ps){let ds=ps.rendererType;ds&&!rs.includes(ds)&&rs.push(ds)}}}if(is.children){let os=this.potentialRendererTypesFromSerializedComponents(is.children);for(let ls of os)rs.includes(ls)||rs.push(ls)}}return rs}get childrenMatched(){return this.childrenMatchedWithPlaceholders&&!this.placeholderActiveChildrenIndices}static createAttributesObject(){return{hide:{createComponentOfType:"boolean",createStateVariable:"hide",defaultValue:!1,public:!0},disabled:{createComponentOfType:"boolean"},fixed:{createComponentOfType:"boolean",ignoreFixed:!0},modifyIndirectly:{createComponentOfType:"boolean",createStateVariable:"modifyIndirectly",defaultValue:!0,public:!0,propagateToProps:!0},styleNumber:{createComponentOfType:"number",createStateVariable:"styleNumber",defaultValue:1,public:!0,fallBackToParentStateVariable:"styleNumber"},isResponse:{createPrimitiveOfType:"boolean",createStateVariable:"isResponse",defaultValue:!1,public:!0},newNamespace:{createPrimitiveOfType:"boolean",createStateVariable:"newNamespace",defaultValue:!1,public:!0}}}static returnSugarInstructions(){return[]}static returnChildGroups(){return[]}static get childGroups(){return this.hasOwnProperty("childGroupsData")?this.childGroupsData:(this.childGroupsData=this.returnChildGroups(),this.childGroupsData)}static get childGroupOfComponentType(){return this.hasOwnProperty("childGroupOfComponentTypeData")?this.childGroupOfComponentTypeData:(this.childGroupOfComponentTypeData={},this.childGroupOfComponentTypeData)}static get childGroupIndsByName(){if(this.hasOwnProperty("childGroupIndsByNameData"))return Object.assign({},this.childGroupIndsByNameData);this.childGroupIndsByNameData={};for(let[ts,rs]of this.childGroups.entries()){if(rs.group in this.childGroupIndsByNameData)throw Error(`Invalid childGroups for componentClass ${this.componentType}: ${rs} is repeated`);this.childGroupIndsByNameData[rs.group]=ts}return Object.assign({},this.childGroupIndsByNameData)}returnMatchedChildIndices(ts){let rs=[];for(let ns of ts){let is=this.childMatchesByGroup[ns];if(!is)return;rs.push(...is)}return rs.sort((ns,is)=>ns-is)}static returnStateVariableDefinitions(){let ts={};return ts.hidden={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide",variablesOptional:!0},parentHidden:{dependencyType:"parentStateVariable",variableName:"hidden"},sourceCompositeHidden:{dependencyType:"sourceCompositeStateVariable",variableName:"hidden"},adapterSourceHidden:{dependencyType:"adapterSourceStateVariable",variableName:"hidden"}}),definition:({dependencyValues:rs})=>({setValue:{hidden:!!(rs.parentHidden||rs.sourceCompositeHidden||rs.adapterSourceHidden||rs.hide)}}),markStale:()=>({updateParentRenderedChildren:!0}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setDependency:"hide",desiredValue:rs.hidden}]}}},ts.disabled={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,hasEssential:!0,doNotShadowEssential:!0,defaultValue:!1,provideEssentialValuesInDefinition:!0,returnDependencies:()=>({disabledAttr:{dependencyType:"attributeComponent",attributeName:"disabled",variableNames:["value"]},readOnly:{dependencyType:"flag",flagName:"readOnly"},parentDisabled:{dependencyType:"parentStateVariable",variableName:"disabled"},sourceCompositeDisabled:{dependencyType:"sourceCompositeStateVariable",variableName:"disabled"},adapterSourceDisabled:{dependencyType:"adapterSourceStateVariable",variableName:"disabled"}}),definition({dependencyValues:rs,usedDefault:ns,essentialValues:is}){if(rs.readOnly)return{setValue:{disabled:!0}};if(rs.disabledAttr!==null)return{setValue:{disabled:rs.disabledAttr.stateValues.value}};if(is.disabled!==void 0)return{useEssentialOrDefaultValue:{disabled:!0}};let as=!1,os=!0;return rs.parentDisabled!==null&&!ns.parentDisabled&&(as=as||rs.parentDisabled,os=!1),rs.sourceCompositeDisabled!==null&&!ns.sourceCompositeDisabled&&(as=as||rs.sourceCompositeDisabled,os=!1),rs.adapterSourceDisabled!==null&&!ns.adapterSourceDisabled&&(as=as||rs.adapterSourceDisabled,os=!1),os?{useEssentialOrDefaultValue:{disabled:!0}}:{setValue:{disabled:as}}},inverseDefinition({dependencyValues:rs,desiredStateVariableValues:ns}){return rs.disabledAttr!==null?{success:!0,instructions:[{setDependency:"disabledAttr",desiredValue:ns.disabled,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"disabled",value:ns.disabled}]}}},ts.fixed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,doNotShadowEssential:!0,ignoreFixed:!0,provideEssentialValuesInDefinition:!0,returnDependencies:()=>({fixedAttr:{dependencyType:"attributeComponent",attributeName:"fixed",variableNames:["value"]},parentFixed:{dependencyType:"parentStateVariable",variableName:"fixed"},sourceCompositeFixed:{dependencyType:"sourceCompositeStateVariable",variableName:"fixed"},adapterSourceFixed:{dependencyType:"adapterSourceStateVariable",variableName:"fixed"},ignoreParentFixed:{dependencyType:"doenetAttribute",attributeName:"ignoreParentFixed"}}),definition({dependencyValues:rs,usedDefault:ns,essentialValues:is}){if(rs.fixedAttr!==null)return{setValue:{fixed:rs.fixedAttr.stateValues.value}};if(is.fixed!==void 0)return{useEssentialOrDefaultValue:{fixed:!0}};let as=!1,os=!0;return rs.parentFixed!==null&&!ns.parentFixed&&!rs.ignoreParentFixed&&(as=as||rs.parentFixed,os=!1),rs.sourceCompositeFixed!==null&&!ns.sourceCompositeFixed&&(as=as||rs.sourceCompositeFixed,os=!1),rs.adapterSourceFixed!==null&&!ns.adapterSourceFixed&&(as=as||rs.adapterSourceFixed,os=!1),os?{useEssentialOrDefaultValue:{fixed:!0}}:{setValue:{fixed:as}}},inverseDefinition({dependencyValues:rs,desiredStateVariableValues:ns}){return rs.fixedAttr!==null?{success:!0,instructions:[{setDependency:"fixedAttr",desiredValue:ns.fixed,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"fixed",value:ns.fixed}]}}},ts.isInactiveCompositeReplacement={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{isInactiveCompositeReplacement:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:{variableName:"isInactiveCompositeReplacement",value:rs.isInactiveCompositeReplacement}}]}}},ts.doenetML={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({doenetML:{dependencyType:"doenetML"}}),definition({dependencyValues:rs}){let ns=rs.doenetML;return ns||(ns=""),{setValue:{doenetML:ns}}}},ts}static returnNormalizedStateVariableDefinitions({attributeNames:ts,numerics:rs}){let ns=this.returnStateVariableDefinitions({attributeNames:ts,numerics:rs});if(!ns)throw Error(`Error in state variable definitions of ${this.componentType}: returnStateVariableDefinitions did not return anything`);let is=function(ls){for(let[us,cs]of ls.entries())typeof cs=="object"&&(ls[us]=cs.variableName)},as=["returnDependencies","definition","inverseDefinition","stateVariablesDeterminingDependencies","stateVariablesDeterminingArraySizeDependencies","isArray","nDimensions","returnArraySizeDependencies","returnArraySize","returnArrayDependenciesByKey","arrayDefinitionByKey","inverseArrayDefinitionByKey","basedOnArrayKeyStateVariables","markStale","getPreviousDependencyValuesForMarkStale","determineDependenciesImmediately","createWorkspace","workspace","provideEssentialValuesInDefinition","providePreviousValuesInDefinition"],os={};for(let ls in ns){let us=ns[ls];if(os[ls]=us,us.createWorkspace&&(us.workspace={}),us.additionalStateVariablesDefined){for(let[cs,ps]of us.additionalStateVariablesDefined.entries()){let ds={};for(let hs of as)hs in us&&(ds[hs]=us[hs]);ds.additionalStateVariablesDefined=[...us.additionalStateVariablesDefined],ds.additionalStateVariablesDefined[cs]=ls,is(ds.additionalStateVariablesDefined);let fs=ps;typeof ps=="object"&&(fs=ps.variableName,ps=Object.assign({},ps),delete ps.variableName,Object.assign(ds,ps)),os[fs]=ds}is(us.additionalStateVariablesDefined)}}return os}static returnStateVariableInfo({onlyPublic:ts=!1,onlyForRenderer:rs=!1}={}){var us,cs;let ns=this.createAttributesObject(),is={},as={},os={};for(let ps in ns){let ds=ns[ps],fs=ds.createStateVariable;if(fs&&(!ts||ds.public)&&(!rs||ds.forRenderer))if(ds.public){let hs=!ds.createComponentOfType,ys;hs?(ys=ds.createPrimitiveOfType,ys==="string"&&(ys="text")):ys=ds.createComponentOfType,is[fs]={createComponentOfType:ys,public:!0}}else is[fs]={}}let ls=this.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(is)});for(let ps in ls){let ds=ls[ps];if(ds.isAlias){os[ps]=ds.targetVariableName;continue}if((!ts||ds.public)&&(!rs||ds.forRenderer)&&(ds.public?is[ps]={createComponentOfType:ds.shadowingInstructions.createComponentOfType,public:!0}:is[ps]={},ds.isArray)){is[ps].isArray=!0,is[ps].nDimensions=ds.nDimensions===void 0?1:ds.nDimensions,is[ps].wrappingComponents=(us=ds.shadowingInstructions)!=null&&us.returnWrappingComponents?ds.shadowingInstructions.returnWrappingComponents():[];let fs;ds.entryPrefixes?fs=ds.entryPrefixes:fs=[ps];for(let hs of fs)as[hs]={arrayVariableName:ps,nDimensions:ds.returnEntryDimensions?ds.returnEntryDimensions(hs):1,wrappingComponents:(cs=ds.shadowingInstructions)!=null&&cs.returnWrappingComponents?ds.shadowingInstructions.returnWrappingComponents(hs):[]};ds.getArrayKeysFromVarName?is[ps].getArrayKeysFromVarName=ds.getArrayKeysFromVarName:is[ps].getArrayKeysFromVarName=returnDefaultGetArrayKeysFromVarName(is[ps].nDimensions)}}return{stateVariableDescriptions:is,arrayEntryPrefixes:as,aliases:os}}get parentName(){if(!(this.ancestors===void 0||this.ancestors.length===0))return this.ancestors[0].componentName}getAllChildrenDownstreamComponentNames(ts=!1){const rs=Object.keys(this.allChildren);let ns=Object.keys(this.downstreamDependencies);return ts!==!0&&(ns=ns.filter(is=>this.downstreamDependencies[is].inactive!==!0)),[...rs,...ns]}get allDescendants(){let ts=[];for(let rs in this.allChildren){let ns=this.allChildren[rs].component;ts=[...ts,rs,...ns.allDescendants]}return ts}async serialize(ts={}){let rs={componentType:this.componentType},ns=[],is={...ts},as;ts.sourceAttributesToIgnoreRecursively?as=[...ts.sourceAttributesToIgnoreRecursively]:as=[],ts.sourceAttributesToIgnore&&(as.push(...ts.sourceAttributesToIgnore),delete is.sourceAttributesToIgnore);{for(let os of this.definingChildren)typeof os!="object"?ns.push(os):ns.push(await os.serialize(is));if(this.serializedChildren!==void 0)for(let os of this.serializedChildren)ns.push(this.copySerializedComponent(os));ns.length>0&&(rs.children=ns)}rs.attributes={};for(let os in this.attributes){let ls=this.attributes[os];ls.component?ts.copyAll&&(rs.attributes[os]={component:await ls.component.serialize(is)}):(!as.includes(os)||ts.copyAll)&&(rs.attributes[os]=JSON.parse(JSON.stringify(ls)))}return this.essentialState&&Object.keys(this.essentialState).length>0&&(rs.state=deepClone(this.essentialState)),ts.copyVariants&&this.state.generatedVariantInfo&&(rs.variants={desiredVariant:await this.stateValues.generatedVariantInfo}),rs.originalName=this.componentName,rs.originalDoenetAttributes=deepClone(this.doenetAttributes),rs.doenetAttributes=deepClone(this.doenetAttributes),rs.originalAttributes=deepClone(rs.attributes),delete rs.doenetAttributes.prescribedName,delete rs.doenetAttributes.assignNames,rs}copySerializedComponent(ts){if(typeof ts!="object")return ts;let rs=[];if(ts.children!==void 0)for(let is of ts.children)rs.push(this.copySerializedComponent(is));let ns={componentType:ts.componentType,originalName:ts.componentName,originalNameFromSerializedComponent:!0,children:rs,state:{},doenetAttributes:{}};return ts.doenetAttributes!==void 0&&(ns.originalDoenetAttributes=deepClone(ts.doenetAttributes),ns.doenetAttributes=deepClone(ts.doenetAttributes),ns.originalAttributes=deepClone(ts.attributes),ns.attributes=deepClone(ts.attributes),delete ns.doenetAttributes.prescribedName,delete ns.doenetAttributes.assignNames),ts.state!==void 0&&Object.assign(ns.state,ts.state),ns}static get nAdapters(){return this.adapters.length}getAdapter(ts){if(ts>=this.constructor.adapters.length)return;let rs=this.constructor.adapters[ts],ns,is,as,os;typeof rs=="string"?ns=rs:(ns=rs.stateVariable,is=rs.componentType,as=rs.substituteForPrimaryStateVariable,os=rs.stateVariablesToShadow);let ls=this.state[ns];if(ls===void 0||!ls.public&&!is)throw Error("Invalid adapter "+ns+" in "+this.componentType);return is===void 0&&(is=ls.shadowingInstructions.createComponentOfType),{componentType:is,downstreamDependencies:{[this.componentName]:[{dependencyType:"adapter",adapterVariable:ns,adapterTargetIdentity:{componentName:this.componentName,componentType:this.componentType},substituteForPrimaryStateVariable:as,stateVariablesToShadow:os}]}}}static getAdapterComponentType(ts,rs){if(ts>=this.adapters.length)return;let ns=this.adapters[ts],is,as;if(typeof ns=="string"?is=ns:(is=ns.stateVariable,as=ns.componentType),as===void 0){let ls=rs[this.componentType].stateVariableDescriptions[is];if(!ls)throw Error("Invalid adapter "+is+" in "+this.componentType);if(as=ls.createComponentOfType,!as)throw Error(`Couldn't get adapter component type for ${is} of componentType ${this.componentType}`)}return as}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){var os;let ns=(os=ts.variants)==null?void 0:os.numberOfVariants;if(ns!==void 0)return{success:!0,numberOfVariants:ns};let is=[];ts.children&&(is=gatherVariantComponents({serializedComponents:ts.children,componentInfoObjects:rs})),ts.variants===void 0&&(ts.variants={}),ts.variants.descendantVariantComponents=is,ns=1;let as=[];for(let ls of is){let cs=rs.allComponentClasses[ls.componentType].determineNumberOfUniqueVariants({serializedComponent:ls,componentInfoObjects:rs});if(!cs.success)return{success:!1};as.push(cs.numberOfVariants),ns*=cs.numberOfVariants}return ts.variants.numberOfVariants=ns,ts.variants.uniqueVariantData={numberOfVariantsByDescendant:as},{success:!0,numberOfVariants:ns}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){var ps;let is=(ps=ts.variants)==null?void 0:ps.numberOfVariants;if(is===void 0)return{success:!1};if(!Number.isInteger(rs)||rs<1||rs>is)return{success:!1};let as=!1,os=ts.variants.uniqueVariantData.numberOfVariantsByDescendant,ls=ts.variants.descendantVariantComponents,us=[];if(ls.length>0){let ds=enumerateCombinations({numberOfOptionsByIndex:os,maxNumber:rs})[rs-1].map(fs=>fs+1);for(let fs=0;fs<os.length;fs++)if(os[fs]>1){let hs=ls[fs],gs=ns.allComponentClasses[hs.componentType].getUniqueVariant({serializedComponent:hs,variantIndex:ds[fs],componentInfoObjects:ns});if(!gs.success)return{success:!1};us.push(gs.desiredVariant),as=!0}else us.push({})}let cs={index:rs};return as&&(cs.subvariants=us),{success:!0,desiredVariant:cs}}async copyDoenetMLToClipboard({actionId:ts}){let rs=await this.stateValues.doenetML;rs?this.coreFunctions.copyToClipboard(rs,ts):this.coreFunctions.resolveAction({actionId:ts})}}Ms(BaseComponent,"componentType","_base"),Ms(BaseComponent,"childGroupOfComponentTypeData"),Ms(BaseComponent,"childGroupIndsByNameData"),Ms(BaseComponent,"adapters",[]);class InlineComponent extends BaseComponent{}Ms(InlineComponent,"componentType","_inline");class Text extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveText:this.moveText.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.styleNumber.defaultValue=0,ts}static returnChildGroups(){return[{group:"textLike",componentTypes:["string","text","_singleCharacterInline","_inlineRenderInlineChildren"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType,addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},hasEssential:!0,returnDependencies:()=>({textLikeChildren:{dependencyType:"child",childGroups:["textLike"],variableNames:["text"]}}),defaultValue:"",set:ns=>ns===null?"":String(ns),definition:function({dependencyValues:ns}){if(ns.textLikeChildren.length===0)return{useEssentialOrDefaultValue:{value:!0}};let is="";for(let as of ns.textLikeChildren)typeof as=="string"?is+=as:is+=as.stateValues.text;return{setValue:{value:is}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){let as=is.textLikeChildren.length;return as>1?{success:!1}:as===1?{success:!0,instructions:[{setDependency:"textLikeChildren",desiredValue:ns.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:ns.value===null?"":String(ns.value)}]}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:ns})=>({setValue:{text:ns.value}}),inverseDefinition:({desiredStateVariableValues:ns})=>({success:!0,instructions:[{setDependency:"value",desiredValue:ns.text}]})},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveText({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}}Ms(Text,"componentType","text"),Ms(Text,"includeBlankStringChildren",!0),Ms(Text,"variableForPlainMacro","value"),Ms(Text,"descendantCompositesMustHaveAReplacement",!1);class TextOrInline extends InlineComponent{static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns="";for(let is of rs.inlineChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"&&(ns+=is.stateValues.text);return{setValue:{value:ns}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.value}})},ts}}Ms(TextOrInline,"componentType","_textOrInline"),Ms(TextOrInline,"renderChildren",!0),Ms(TextOrInline,"rendererType","containerInline"),Ms(TextOrInline,"includeBlankStringChildren",!0);class CompositeComponent extends BaseComponent{constructor(rs){super(rs);Ms(this,"replacements",[]);Ms(this,"replacementsToWithhold",0);this.replacementsWorkspace={}}static returnStateVariableDefinitions(){let rs=super.returnStateVariableDefinitions();return rs.replacements={returnDependencies:()=>({replacements:{dependencyType:"replacement"}}),definition:({dependencyValues:ns})=>({setValue:{replacements:ns.replacements}})},rs.recursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0}}),definition:({dependencyValues:ns})=>({setValue:{recursiveReplacements:ns.recursiveReplacements}})},rs.fullRecursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0,recurseNonStandardComposites:!0}}),definition:({dependencyValues:ns})=>({setValue:{fullRecursiveReplacements:ns.recursiveReplacements}})},rs}static createSerializedReplacements(){return{replacements:[]}}static calculateReplacementChanges(){return[]}get allPotentialRendererTypes(){let rs=super.allPotentialRendererTypes;for(let ns in this.allChildren){let is=this.allChildren[ns].component;for(let as of is.allPotentialRendererTypes)rs.includes(as)||rs.push(as)}if(this.replacements){for(let ns of this.replacements)if(typeof ns=="object")for(let is of ns.allPotentialRendererTypes)rs.includes(is)||rs.push(is)}return rs}}Ms(CompositeComponent,"componentType","_composite"),Ms(CompositeComponent,"rendererType");class Template extends CompositeComponent{static keepChildrenSerialized({serializedComponent:ts}){return ts.children===void 0?[]:Object.keys(ts.children)}static createAttributesObject(){let ts=super.createAttributesObject();return ts.rendered={createComponentOfType:"boolean",createStateVariable:"rendered",defaultValue:this.renderedDefault,public:!0},ts.isResponse={leaveRaw:!0},ts.createComponentOfType={createPrimitiveOfType:"string"},ts.nComponents={createPrimitiveOfType:"number"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=this;return ts.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:ns}){return{setValue:{serializedChildren:ns.serializedChildren}}}},ts.newNamespace={returnDependencies:()=>({newNamespace:{dependencyType:"attributePrimitive",attributeName:"newNamespace"}}),definition({dependencyValues:ns}){return{setValue:{newNamespace:ns.newNamespace}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:ns,componentInfoObjects:is})=>({variantSeed:{dependencyType:"value",value:ns.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(is.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:ns,componentName:is}){let as={seed:ns.variantSeed,meta:{createdBy:is}},os=as.subvariants=[];for(let ls of ns.variantDescendants)ls.stateValues.isVariantComponent?os.push(ls.stateValues.generatedVariantInfo):ls.stateValues.generatedVariantInfo&&os.push(...ls.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:as}}}},ts.nComponentsSpecified={returnDependencies:()=>({nComponentsAttr:{dependencyType:"attributePrimitive",attributeName:"nComponents"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"}}),definition({dependencyValues:ns,componentInfoObjects:is}){let as;if(ns.typeAttr){if(!(is.componentTypeLowerCaseMapping[ns.typeAttr.toLowerCase()]in is.allComponentClasses))throw Error(`Invalid componentType ${ns.typeAttr} of copy.`);ns.nComponentsAttr!==null?as=ns.nComponentsAttr:as=1}else{if(ns.nComponentsAttr!==null)throw Error(`You must specify createComponentOfType when specifying nComponents for a ${rs.componentType}.`);as=null}return{setValue:{nComponentsSpecified:as}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,alwaysCreateReplacements:ns,flags:is}){var as;if(await ts.stateValues.nComponentsSpecified,await ts.stateValues.rendered||ns){let os=deepClone(await ts.state.serializedChildren.value),ls=(as=ts.attributes.newNamespace)==null?void 0:as.primitive;if("isResponse"in ts.attributes)for(let ps of os){if(typeof ps!="object")continue;let ds=convertAttributesForComponentType({attributes:{isResponse:ts.attributes.isResponse},componentType:ps.componentType,componentInfoObjects:rs,compositeCreatesNewNamespace:ls,flags:is});ps.attributes||(ps.attributes={}),Object.assign(ps.attributes,ds)}let us=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:os,parentName:ts.componentName,parentCreatesNewNamespace:ls,componentInfoObjects:rs,originalNamesAreConsistent:!0});return{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:us.serializedComponents,assignNames:ts.doenetAttributes.assignNames,componentInfoObjects:rs,compositeAttributesObj:this.createAttributesObject(),flags:is})).replacements}}else return{replacements:[]}}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns,useSubpartVariantRng:!0})}get allPotentialRendererTypes(){let ts=super.allPotentialRendererTypes,rs=this.potentialRendererTypesFromSerializedComponents(this.serializedChildren);for(let ns of rs)ts.includes(ns)||ts.push(ns);return ts}}Ms(Template,"componentType","template"),Ms(Template,"treatAsComponentForRecursiveReplacements",!0),Ms(Template,"includeBlankStringChildren",!0),Ms(Template,"renderedDefault",!1),Ms(Template,"assignNamesToReplacements",!0),Ms(Template,"createsVariants",!0);const vectorAndListOperators=["list",...vectorOperators];class MathComponent extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveMath:this.moveMath.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0,toLowerCase:!0,validValues:["text","latex"]},ts.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numberspreserveorder"]},ts.expand={createComponentOfType:"boolean",createStateVariable:"expand",defaultValue:!1,public:!0},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer"},ts.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},ts.padZeros={createComponentOfType:"boolean"},ts.renderMode={createComponentOfType:"text",createStateVariable:"renderMode",defaultValue:"inline",public:!0,forRenderer:!0},ts.unordered={createComponentOfType:"boolean"},ts.createVectors={createComponentOfType:"boolean",createStateVariable:"createVectors",defaultValue:!1,public:!0},ts.createIntervals={createComponentOfType:"boolean",createStateVariable:"createIntervals",defaultValue:!1,public:!0},ts.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},ts.sourcesAreFunctionSymbols={createComponentOfType:"textList",createStateVariable:"sourcesAreFunctionSymbols",defaultValue:[]},ts.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0,fallBackToParentStateVariable:"splitSymbols"},ts.parseScientificNotation={createComponentOfType:"boolean",createStateVariable:"parseScientificNotation",defaultValue:!1,public:!0,fallBackToParentStateVariable:"parseScientificNotation"},ts.groupCompositeReplacements={createPrimitiveOfType:"boolean",createStateVariable:"groupCompositeReplacements",defaultValue:!0},ts.displayBlanks={createComponentOfType:"boolean",createStateVariable:"displayBlanks",defaultValue:!0,public:!0},ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.styleNumber.defaultValue=0,ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"strings",componentTypes:["string"]},{group:"displayedMaths",componentTypes:["m","me","men"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displayDigits"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:ns,usedDefault:is}){let as=!1,os;if(ns.mathListParentDisplayDigits!==null)if(is.mathListParentDisplayDigits)as=!0,os=ns.mathListParentDisplayDigits;else return{setValue:{displayDigits:ns.mathListParentDisplayDigits}};if(ns.numberListParentDisplayDigits!==null)if(is.numberListParentDisplayDigits)as=!0,os=ns.numberListParentDisplayDigits;else return{setValue:{displayDigits:ns.numberListParentDisplayDigits}};let ls=ns.numberListParentDisplayDecimals!==null&&!is.numberListParentDisplayDecimals||ns.mathListParentDisplayDecimals!==null&&!is.mathListParentDisplayDecimals,us=ns.displayDigitsAttr===null||is.displayDigitsAttr,cs=ns.displayDecimalsAttr===null||is.displayDecimalsAttr;if(!(us||cs)){let ps=ns.displayDigitsAttr.shadowDepth;ns.displayDecimalsAttr.shadowDepth<ps&&(us=!0)}if(!ls&&ns.displayDigitsAttr!==null)if(us)as=!0,os=ns.displayDigitsAttr.stateValues.value;else return{setValue:{displayDigits:ns.displayDigitsAttr.stateValues.value}};if(!ls&&cs&&ns.mathChildren.length===1&&ns.stringChildren.length===0)if(is.mathChildren[0]&&is.mathChildren[0].displayDigits)as=!0,os=ns.mathChildren[0].stateValues.displayDigits;else return{setValue:{displayDigits:ns.mathChildren[0].stateValues.displayDigits}};return as?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:os}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displayDecimals"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:ns,usedDefault:is}){let as=!1,os;if(ns.mathListParentDisplayDecimals!==null)if(is.mathListParentDisplayDecimals)as=!0,os=ns.mathListParentDisplayDecimals;else return{setValue:{displayDecimals:ns.mathListParentDisplayDecimals}};if(ns.numberListParentDisplayDecimals!==null)if(is.numberListParentDisplayDecimals)as=!0,os=ns.numberListParentDisplayDecimals;else return{setValue:{displayDecimals:ns.numberListParentDisplayDecimals}};if(ns.displayDecimalsAttr!==null)if(is.displayDecimalsAttr)as=!0,os=ns.displayDecimalsAttr.stateValues.value;else return{setValue:{displayDecimals:ns.displayDecimalsAttr.stateValues.value}};if(ns.mathChildren.length===1&&ns.stringChildren.length===0)if(is.mathChildren[0]&&is.mathChildren[0].displayDecimals)as=!0,os=ns.mathChildren[0].stateValues.displayDecimals;else return{setValue:{displayDecimals:ns.mathChildren[0].stateValues.displayDecimals}};return as?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:os}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displaySmallAsZero"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:ns,usedDefault:is}){let as=!1,os;if(ns.mathListParentDisplaySmallAsZero!==null)if(is.mathListParentDisplaySmallAsZero)as=!0,os=ns.mathListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:ns.mathListParentDisplaySmallAsZero}};if(ns.numberListParentDisplaySmallAsZero!==null)if(is.numberListParentDisplaySmallAsZero)as=!0,os=ns.numberListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:ns.numberListParentDisplaySmallAsZero}};if(ns.displaySmallAsZeroAttr!==null)if(is.displaySmallAsZeroAttr)as=!0,os=ns.displaySmallAsZeroAttr.stateValues.value;else return{setValue:{displaySmallAsZero:ns.displaySmallAsZeroAttr.stateValues.value}};if(ns.mathChildren.length===1&&ns.stringChildren.length===0)if(is.mathChildren[0]&&is.mathChildren[0].displaySmallAsZero)as=!0,os=ns.mathChildren[0].stateValues.displaySmallAsZero;else return{setValue:{displaySmallAsZero:ns.mathChildren[0].stateValues.displaySmallAsZero}};return as?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:os}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["padZeros"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:ns,usedDefault:is}){let as=!1,os;if(ns.mathListParentPadZeros!==null)if(is.mathListParentPadZeros)as=!0,os=ns.mathListParentPadZeros;else return{setValue:{padZeros:ns.mathListParentPadZeros}};if(ns.numberListParentPadZeros!==null)if(is.numberListParentPadZeros)as=!0,os=ns.numberListParentPadZeros;else return{setValue:{padZeros:ns.numberListParentPadZeros}};if(ns.padZerosAttr!==null)if(is.padZerosAttr)as=!0,os=ns.padZerosAttr.stateValues.value;else return{setValue:{padZeros:ns.padZerosAttr.stateValues.value}};if(ns.mathChildren.length===1&&ns.stringChildren.length==0)if(is.mathChildren[0]&&is.mathChildren[0].padZeros)as=!0,os=ns.mathChildren[0].stateValues.padZeros;else return{setValue:{padZeros:ns.mathChildren[0].stateValues.padZeros}};return as?{useEssentialOrDefaultValue:{padZeros:{defaultValue:os}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.valueShadow={defaultValue:Context.fromAst(""),hasEssential:!0,essentialVarName:"value",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{valueShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setEssentialValue:"valueShadow",value:ns.valueShadow}]}}},ts.unordered={defaultValue:!1,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,returnDependencies:()=>({unorderedAttr:{dependencyType:"attributeComponent",attributeName:"unordered",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["unordered"]}}),definition({dependencyValues:ns}){return ns.unorderedAttr===null?ns.mathChildren.length>0?{setValue:{unordered:ns.mathChildren.every(as=>as.stateValues.unordered)}}:{useEssentialOrDefaultValue:{unordered:!0}}:{setValue:{unordered:ns.unorderedAttr.stateValues.value}}}},ts.codePre={returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:ns}){let is="math",as=!1;do{as=!1;for(let os of ns.stringChildren)if(os.includes(is)===!0){as=!0,is+="m";break}}while(as);return{setValue:{codePre:is}}}},ts.mathChildrenFunctionSymbols={returnDependencies:()=>({sourcesAreFunctionSymbols:{dependencyType:"stateVariable",variableName:"sourcesAreFunctionSymbols"},mathChildren:{dependencyType:"child",childGroups:["maths"]}}),definition({dependencyValues:ns}){let is=[];if(ns.mathChildren.compositeReplacementRange){for(let as of ns.mathChildren.compositeReplacementRange)if(ns.sourcesAreFunctionSymbols.includes(as.target))for(let os=as.firstInd;os<=as.lastInd;os++)is.push(os)}return{setValue:{mathChildrenFunctionSymbols:is}}}},ts.expressionWithCodes={hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childGroups:["strings","maths"]},stringChildren:{dependencyType:"child",childGroups:["strings"]},mathChildren:{dependencyType:"child",childGroups:["maths"]},displayedMathChildren:{dependencyType:"child",childGroups:["displayedMaths"],variableNames:["latex"]},format:{dependencyType:"stateVariable",variableName:"format"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},functionSymbols:{dependencyType:"stateVariable",variableName:"functionSymbols"},mathChildrenFunctionSymbols:{dependencyType:"stateVariable",variableName:"mathChildrenFunctionSymbols"},splitSymbols:{dependencyType:"stateVariable",variableName:"splitSymbols"},parseScientificNotation:{dependencyType:"stateVariable",variableName:"parseScientificNotation"},groupCompositeReplacements:{dependencyType:"stateVariable",variableName:"groupCompositeReplacements"}}),set:ns=>ns===null?null:convertValueToMathExpression(ns),definition:calculateExpressionWithCodes,async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as}){let os=ns.expressionWithCodes,ls=[{setEssentialValue:"expressionWithCodes",value:os}],us=is.stringChildren.length;if(us===0)return{success:!1};if(is.mathChildren.length===0){let cs;await as.format==="latex"?cs=os.toLatex():cs=os.toString(),ls.push({setDependency:"stringChildren",desiredValue:cs,childIndex:0,variableIndex:0,ignoreChildChangeForComponent:!0});for(let ps=1;ps<us;ps++)ls.push({setDependency:"stringChildren",desiredValue:"",childIndex:ps,variableIndex:0,ignoreChildChangeForComponent:!0})}else{let cs;await as.format==="latex"?cs=os.toLatex():cs=os.toString();for(let[ps,ds]of(await as.codesAdjacentToStrings).entries()){let fs=cs;Object.keys(ds).length===0?ls.push({setDependency:"stringChildren",desiredValue:"",childIndex:ps,variableIndex:0,ignoreChildChangeForComponent:!0}):(ds.prevCode&&(fs=fs.split(ds.prevCode)[1]),ds.nextCode&&(fs=fs.split(ds.nextCode)[0]),ls.push({setDependency:"stringChildren",desiredValue:fs,childIndex:ps,variableIndex:0,ignoreChildChangeForComponent:!0}))}}return{success:!0,instructions:ls}}},ts.mathChildrenWithCanBeModified={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value","canBeModified"]}}),definition:({dependencyValues:ns})=>({setValue:{mathChildrenWithCanBeModified:ns.mathChildren}})},ts.unnormalizedValue={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"}}),set:convertValueToMathExpression,defaultValue:Context.fromAst(""),definition:calculateMathValue,inverseDefinition:invertMath},ts.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType,attributesToShadow:["unordered","displayDigits","displayDecimals","displaySmallAsZero","padZeros","simplify","expand"],addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},returnDependencies:()=>({unnormalizedValue:{dependencyType:"stateVariable",variableName:"unnormalizedValue"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:function({dependencyValues:ns}){let is=ns.unnormalizedValue,{simplify:as,expand:os,createVectors:ls,createIntervals:us}=ns;return is=normalizeMathExpression({value:is,simplify:as,expand:os,createVectors:ls,createIntervals:us}),{setValue:{value:is}}},inverseDefinition:function({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"unnormalizedValue",desiredValue:ns.value}]}}},ts.number={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:ns}){return{setValue:{number:ns.value.evaluate_to_constant()}}},inverseDefinition:function({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"value",desiredValue:Context.fromAst(ns.number)}]}}},ts.isNumber={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:ns}){return{setValue:{isNumber:Number.isFinite(ns.value.tree)}}}},ts.isNumeric={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:"number"}}),definition:function({dependencyValues:ns}){return{setValue:{isNumeric:Number.isFinite(ns.number)}}}},ts.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"}}),definition:function({dependencyValues:ns,usedDefault:is}){let as=roundForDisplay({value:ns.value,dependencyValues:ns,usedDefault:is});return{setValue:{valueForDisplay:normalizeMathExpression({value:as,simplify:ns.simplify,expand:ns.expand})}}},inverseDefinition({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"value",desiredValue:ns.valueForDisplay}]}}},ts.latex={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displayBlanks:{dependencyType:"stateVariable",variableName:"displayBlanks"}}),definition:function({dependencyValues:ns,usedDefault:is}){let as,os={};ns.padZeros&&(is.displayDigits&&!is.displayDecimals?Number.isFinite(ns.displayDecimals)&&(os.padToDecimals=ns.displayDecimals):ns.displayDigits>=1&&(os.padToDigits=ns.displayDigits)),ns.displayBlanks||(os.showBlanks=!1);try{as=ns.valueForDisplay.toLatex(os)}catch{ns.displayBlanks?as="":as=""}return{setValue:{latex:as}}},inverseDefinition({desiredStateVariableValues:ns}){let is;try{is=Context.fromLatex(ns.latex)}catch{return{success:!1}}return{success:!0,instructions:[{setDependency:"valueForDisplay",desiredValue:is}]}}},ts.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns}){return{setValue:{latexWithInputChildren:[ns.latex]}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},value:{dependencyType:"stateVariable",variableName:"value"},displayBlanks:{dependencyType:"stateVariable",variableName:"displayBlanks"}}),definition:function({dependencyValues:ns,usedDefault:is}){let as,os={};ns.padZeros&&(is.displayDigits&&!is.displayDecimals?Number.isFinite(ns.displayDecimals)&&(os.padToDecimals=ns.displayDecimals):ns.displayDigits>=1&&(os.padToDigits=ns.displayDigits)),ns.displayBlanks||(os.showBlanks=!1);try{as=ns.valueForDisplay.toString(os)}catch{ns.displayBlanks?as="":as=""}return{setValue:{text:superSubscriptsToUnicode(as.toString())}}},async inverseDefinition({desiredStateVariableValues:ns,stateValues:is}){let as=getFromText({functionSymbols:await is.functionSymbols,splitSymbols:await is.splitSymbols,parseScientificNotation:await is.parseScientificNotation}),os;try{os=as(unicodeToSuperSubscripts(ns.text))}catch{return{success:!1}}return{success:!0,instructions:[{setDependency:"value",desiredValue:os}]}}},ts.codesAdjacentToStrings={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childGroups:["strings","maths"]},codePre:{dependencyType:"stateVariable",variableName:"codePre"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:calculateCodesAdjacentToStrings},ts.canBeModified={additionalStateVariablesDefined:["constantChildIndices","codeForExpression","inverseMaps","template","mathChildrenMapped"],returnDependencies:()=>({mathChildrenModifiable:{dependencyType:"child",childGroups:["maths"],variableNames:["canBeModified"]},displayedMathChildren:{dependencyType:"child",childGroups:["displayedMaths"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition:determineCanBeModified},ts.mathChildrenByVectorComponent={returnDependencies:()=>({codePre:{dependencyType:"stateVariable",variableName:"codePre"},mathChildren:{dependencyType:"child",childGroups:["maths"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"}}),definition:function({dependencyValues:ns}){if(ns.expressionWithCodes===null)return{setValue:{mathChildrenByVectorComponent:null}};let is=ns.expressionWithCodes.tree,as=ns.mathChildren.length;if(as===0||!Array.isArray(is)||!vectorOperators.includes(is[0]))return{setValue:{mathChildrenByVectorComponent:null}};let os={},ls=0,us=ns.codePre+ls;for(let cs=1;cs<is.length;cs++){let ps=is[cs],ds=os[cs]=[];if(Array.isArray(ps)){let fs=flattenDeep(ps);for(;fs.includes(us);)ds.push(ls),ls++,us=ns.codePre+ls}else ps===us&&(ds.push(ls),ls++,us=ns.codePre+ls);if(ls>=as)break}return{setValue:{mathChildrenByVectorComponent:os}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:ns}){let is=1,as=ns.value.tree;if(Array.isArray(as))if(vectorAndListOperators.includes(as[0]))is=as.length-1;else if(as[0]==="matrix"){let os=as[1].slice(1);os[0]===1?is=os[1]:os[1]===1&&(is=os[0])}else vectorOperators.includes(as[1][0])&&(as[0]==="^"&&as[2]==="T"||as[0]==="prime")&&(is=as[1].length-1);return{setValue:{nDimensions:is}}}},ts.vector={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(ns){return ns==="x"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:ns}){return[ns.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{value:{dependencyType:"stateVariable",variableName:"value"}}}},arrayDefinitionByKey({globalDependencyValues:ns,arraySize:is}){let as=ns.value.tree,os=!1,ls={};if(Array.isArray(as)){if(vectorAndListOperators.includes(as[0])){for(let us=0;us<is[0];us++)ls[us]=Context.fromAst(as[us+1]);os=!0}else if(as[0]==="matrix"){let us=as[1].slice(1);if(us[0]===1){for(let cs=0;cs<is[0];cs++)ls[cs]=Context.fromAst(as[2][1][cs+1]);os=!0}else if(us[1]===1){for(let cs=0;cs<is[0];cs++)ls[cs]=Context.fromAst(as[2][cs+1][1]);os=!0}}else if(vectorOperators.includes(as[1][0])&&(as[0]==="^"&&as[2]==="T"||as[0]==="prime")){for(let us=0;us<is[0];us++)ls[us]=Context.fromAst(as[1][us+1]);os=!0}}return os||(ls[0]=ns.value),{setValue:{vector:ls}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,globalDependencyValues:is,stateValues:as,workspace:os,arraySize:ls}){os.desiredVector||(os.desiredVector=[]);for(let ds=0;ds<ls[0];ds++)ns.vector[ds]!==void 0?os.desiredVector[ds]=convertValueToMathExpression(ns.vector[ds]):os.desiredVector[ds]===void 0&&(os.desiredVector[ds]=(await as.vector)[ds]);let us,cs=is.value.tree;if(Array.isArray(cs))if(vectorAndListOperators.includes(cs[0]))us=Context.fromAst([cs[0],...os.desiredVector.map(ds=>ds.tree)]);else if(cs[0]==="matrix"){let ds=cs[1].slice(1);if(ds[0]===1){let fs=["tuple"];for(let hs=0;hs<ls[0];hs++)fs.push(os.desiredVector[hs]);fs=["tuple",fs],us=Context.fromAst(["matrix",cs[1],fs])}else if(ds[1]===1){let fs=["tuple"];for(let hs=0;hs<ls[0];hs++)fs.push(["tuple",os.desiredVector[hs]]);us=Context.fromAst(["matrix",cs[1],fs])}}else vectorOperators.includes(cs[1][0])&&(cs[0]==="^"&&cs[2]==="T"||cs[0]==="prime")&&(us=[cs[0],[cs[1][0],...os.desiredVector.map(ds=>ds.tree)]],cs[2]&&us.push(cs[2]),us=Context.fromAst(us));return us||(us=os.desiredVector[0]),{success:!0,instructions:[{setDependency:"value",desiredValue:us}]}}},ts.x={isAlias:!0,targetVariableName:"x1"},ts.y={isAlias:!0,targetVariableName:"x2"},ts.z={isAlias:!0,targetVariableName:"x3"},ts.matrixSize={public:!0,shadowingInstructions:{createComponentOfType:"numberList"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:ns}){let is=[1,1],as=ns.value.tree;return Array.isArray(as)&&(vectorAndListOperators.includes(as[0])?is=[as.length-1,1]:as[0]==="matrix"?is=as[1].slice(1):vectorOperators.includes(as[1][0])&&(as[0]==="^"&&as[2]==="T"||as[0]==="prime")&&(is=[1,as[1].length-1])),{setValue:{matrixSize:is}}}},ts.nRows={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({matrixSize:{dependencyType:"stateVariable",variableName:"matrixSize"}}),definition({dependencyValues:ns}){return{setValue:{nRows:ns.matrixSize[0]}}}},ts.nColumns={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({matrixSize:{dependencyType:"stateVariable",variableName:"matrixSize"}}),definition({dependencyValues:ns}){return{setValue:{nColumns:ns.matrixSize[1]}}}},ts.matrix={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(ns){return ns==="matrixEntry"?[]:ns==="row"?[["matrix","matrixRow"]]:ns==="column"?[["matrix","matrixColumn"]]:[["matrixRow"],["matrix"]]}},isArray:!0,nDimensions:2,entryPrefixes:["matrixEntry","row","column","rows","columns"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="matrixEntry"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every(ls=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else if(ns==="row"){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}else if(ns==="column"){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[1]?Array.from(Array(as[0]),(ls,us)=>us+","+os):[]:["0,"+os]:[]}else if(ns==="rows"||ns==="columns"){if(!as)return["0,0"];let os=[];for(let ls=0;ls<as[0];ls++)os.push(...Array.from(Array(as[1]),(us,cs)=>ls+","+cs));return os}},arrayVarNameFromPropIndex(ns,is){if(is==="matrix"||is==="rows")return ns.length===1?"row"+ns[0]:`matrixEntry${ns[0]}_${ns[1]}`;if(is==="columns")return ns.length===1?"column"+ns[0]:`matrixEntry${ns[1]}_${ns[0]}`;if(is.slice(0,3)==="row"){let as=Number(is.slice(3));if(Number.isInteger(as)&&as>0)return`matrixEntry${as}_${ns[0]}`}if(is.slice(0,6)==="column"){let as=Number(is.slice(6));if(Number.isInteger(as)&&as>0)return`matrixEntry${ns[0]}_${as}`}return null},returnArraySizeDependencies:()=>({matrixSize:{dependencyType:"stateVariable",variableName:"matrixSize"}}),returnArraySize({dependencyValues:ns}){return ns.matrixSize},returnArrayDependenciesByKey(){return{globalDependencies:{value:{dependencyType:"stateVariable",variableName:"value"}}}},arrayDefinitionByKey({globalDependencyValues:ns,arraySize:is}){let as=ns.value.tree,os=!1,ls={};if(Array.isArray(as)){if(vectorAndListOperators.includes(as[0])){for(let us=0;us<is[0];us++)ls[us+",0"]=Context.fromAst(as[us+1]);os=!0}else if(as[0]==="matrix"){let us=as[2];for(let cs=0;cs<is[0];cs++)for(let ps=0;ps<is[1];ps++)ls[`${cs},${ps}`]=Context.fromAst(us[cs+1][ps+1]);os=!0}else if(vectorOperators.includes(as[1][0])&&(as[0]==="^"&&as[2]==="T"||as[0]==="prime")){for(let us=0;us<is[1];us++)ls["0,"+us]=Context.fromAst(as[1][us+1]);os=!0}}return os||(ls["0,0"]=ns.value),{setValue:{matrix:ls}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,globalDependencyValues:is,stateValues:as,workspace:os,arraySize:ls}){os.desiredMatrix||(os.desiredMatrix=[]);for(let ds=0;ds<ls[0];ds++)for(let fs=0;fs<ls[1];fs++){let hs=ds+","+fs;ns.matrix[hs]!==void 0?os.desiredMatrix[hs]=convertValueToMathExpression(ns.matrix[hs]):os.desiredMatrix[hs]===void 0&&(os.desiredMatrix[hs]=(await as.matrix)[ds][fs])}let us,cs=is.value.tree;if(Array.isArray(cs)){if(vectorAndListOperators.includes(cs[0])){us=[cs[0]];for(let ds=0;ds<ls[0];ds++)us.push(os.desiredMatrix[ds+",0"].tree)}else if(cs[0]==="matrix"){let ds=["tuple"];for(let fs=0;fs<ls[0];fs++){let hs=["tuple"];for(let ys=0;ys<ls[1];ys++)hs.push(os.desiredMatrix[`${fs},${ys}`].tree);ds.push(hs)}us=Context.fromAst(["matrix",cs[1],ds])}else if(vectorOperators.includes(cs[1][0])&&(cs[0]==="^"&&cs[2]==="T"||cs[0]==="prime")){us=[cs[0]];let ds=[cs[1][0]];for(let fs=0;fs<ls[1];fs++)ds.push(os.desiredMatrix["0,"+fs].tree);us=[cs[0],ds],cs[2]&&us.push(cs[2]),us=Context.fromAst(us)}}return us||(us=os.desiredMatrix[0]),{success:!0,instructions:[{setDependency:"value",desiredValue:us}]}}},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveMath({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}}Ms(MathComponent,"componentType","math"),Ms(MathComponent,"primaryStateVariableForDefinition","unnormalizedValue"),Ms(MathComponent,"primaryEssentialStateVariable","value"),Ms(MathComponent,"variableForPlainMacro","value"),Ms(MathComponent,"descendantCompositesMustHaveAReplacement",!0),Ms(MathComponent,"descendantCompositesDefaultReplacementType","math"),Ms(MathComponent,"adapters",[{stateVariable:"number",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text",{componentType:"subsetOfReals",stateVariable:"value",substituteForPrimaryStateVariable:"subsetValue"}]);function calculateExpressionWithCodes({dependencyValues:ss,changes:ts}){if(!("stringMathChildren"in ts&&ts.stringMathChildren.componentIdentitiesChanged||"displayedMathChildren"in ts||"format"in ts||"splitSymbols"in ts||"parseScientificNotation"in ts||"functionSymbols"in ts||"mathChildrenFunctionSymbols"in ts))return{useEssentialOrDefaultValue:{expressionWithCodes:!0}};if(ss.stringMathChildren.length===0)if(ss.displayedMathChildren.length>0){let fs;try{fs=Context.fromLatex(ss.displayedMathChildren[0].stateValues.latex)}catch{fs=Context.fromAst("")}return{setValue:{expressionWithCodes:fs},setEssentialValue:{expressionWithCodes:fs}}}else return{setValue:{expressionWithCodes:null},setEssentialValue:{expressionWithCodes:null}};let rs="",ns=0,is="",as=ss.stringMathChildren.compositeReplacementRange,os,ls,us,cs;ss.groupCompositeReplacements&&as.length>0&&(us=0,cs=as[us].firstInd);for(let[fs,hs]of ss.stringMathChildren.entries()){if(os===void 0&&fs===cs){os=us,ls=as[us].lastInd,is="";let ys=ls===fs;if(!ys){for(let gs=fs;gs<=ls;gs++)if(typeof ss.stringMathChildren[gs]=="string"){ys=!0;break}}ys&&(as.length>os+1?(us=os+1,cs=as[us].firstInd):(us=void 0,cs=void 0),os=void 0,ls=void 0)}if(typeof hs=="string")rs+=" "+hs+" ";else{let ys=ss.codePre+ns;ns++;let gs;ss.format==="latex"?gs="\\operatorname{"+ys+"}":gs=" "+ys+" ",os!==void 0?(is&&(is+=","),is+=gs):rs+=gs}if(fs===ls){let ys=rs.trimEnd(),gs=!1;if(ys.length===0)gs=!0;else{let bs=ys[ys.length-1];if(!["{","[","(","|",","].includes(bs))gs=!0;else{let vs=ss.stringMathChildren[fs+1];if(typeof vs!="string")gs=!0;else{let Ns=vs.trimStart();if(Ns.length===0)gs=!0;else{let Ts=Ns[0];ss.format==="latex"&&Ts==="\\"&&Ns.length>1&&(Ts=Ns[1]),["}","]",")","|",","].includes(Ts)||(gs=!0)}}}}gs&&(is="("+is+")"),rs+=is,is="",as.length>os+1?(us=os+1,cs=as[us].firstInd):(us=void 0,cs=void 0),os=void 0,ls=void 0}}let ps=null,ds=[...ss.functionSymbols];if(ds.push(...ss.mathChildrenFunctionSymbols.map(fs=>ss.codePre+fs)),rs==="")ps=Context.fromAst("");else if(ss.format==="text"){let fs=getFromText({functionSymbols:ds,splitSymbols:ss.splitSymbols,parseScientificNotation:ss.parseScientificNotation});try{ps=fs(rs)}catch{ps=Context.fromAst(""),console.log("Invalid value for a math of text format: "+rs)}}else if(ss.format==="latex"){let fs=getFromLatex({functionSymbols:ds,splitSymbols:ss.splitSymbols,parseScientificNotation:ss.parseScientificNotation});try{ps=fs(rs)}catch{ps=Context.fromAst(""),console.log("Invalid value for a math of latex format: "+rs)}}return{setValue:{expressionWithCodes:ps},setEssentialValue:{expressionWithCodes:ps}}}function calculateMathValue({dependencyValues:ss}={}){if(ss.expressionWithCodes===null)return{setValue:{unnormalizedValue:ss.valueShadow}};let ts={};for(let[ns,is]of ss.mathChildren.entries())ts[ss.codePre+ns]=is.stateValues.value;let rs=ss.expressionWithCodes;return ss.mathChildren.length>0&&(rs=rs.substitute(ts)),rs=Context.fromAst(mergeListsWithOtherContainers(rs.tree)),{setValue:{unnormalizedValue:rs}}}function calculateCodesAdjacentToStrings({dependencyValues:ss}){let ts=[],rs;for(let[ns,is]of ss.stringMathChildren.entries())if(typeof is=="string"){let as=ss.stringMathChildren[ns+1];if(as!==void 0&&typeof as=="string")continue;let os={};if(rs!==void 0&&(ss.format==="latex"?os.prevCode="\\operatorname{"+ss.codePre+rs+"}":os.prevCode=ss.codePre+rs),as!==void 0){let ls=0;rs!==void 0&&(ls=rs+1),ss.format==="latex"?os.nextCode="\\operatorname{"+ss.codePre+ls+"}":os.nextCode=ss.codePre+ls}ts.push(os)}else rs===void 0?rs=0:rs++;return{setValue:{codesAdjacentToStrings:ts}}}function determineCanBeModified({dependencyValues:ss}){if(!ss.modifyIndirectly||ss.fixed)return{setValue:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};if(ss.mathChildrenModifiable.length===0)return ss.displayedMathChildren.length>0?{setValue:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}}:{setValue:{canBeModified:!0,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};let ts=[],rs=[],ns=[],is={};for(let[us,cs]of ss.mathChildrenModifiable.entries()){let ps=ss.codePre+us;cs.stateValues.canBeModified===!0?(ts.push(us),rs.push(ps)):(ns.push(ps),is[ps]=us)}let as=ss.codePre+"expr",os=Context.utils.unflattenLeft(ss.expressionWithCodes.tree),ls=checkForLinearExpression(os,rs,as,ns);if(ls.foundLinear){let us={},cs=ls.template,ps=new Set;for(let ds in ls.mappings){us[ds]=ls.mappings[ds];let fs=us[ds].mathChildSub;if(fs){let hs=ts[rs.indexOf(fs)];us[ds].mathChildInd=hs,ps.add(Number(hs))}}return ps.has=ps.has.bind(ps),{setValue:{canBeModified:!0,constantChildIndices:is,codeForExpression:as,inverseMaps:us,template:cs,mathChildrenMapped:ps}}}return{setValue:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}}}function checkForLinearExpression(ss,ts,rs,ns=[],is=[]){let as=Context.variables(ss);if(as.every(us=>!ts.includes(us))&&as.every(us=>!ns.includes(us))){let us={},cs="x"+is.join("_");return us[cs]={result:Context.fromAst(rs).simplify(),components:is},{foundLinear:!0,mappings:us,template:cs}}if(!Array.isArray(ss))return checkForScalarLinearExpression(ss,ts,rs,is);let os=ss[0],ls=ss.slice(1);if(vectorAndListOperators.includes(os)){let us={mappings:{},template:[os]},cs=0;for(let ps=0;ps<ls.length;ps++){let ds=[...is,ps],fs=checkForLinearExpression(ls[ps],ts,rs,ns,ds);fs.foundLinear?(cs++,us.mappings=Object.assign(us.mappings,fs.mappings),us.template.push(fs.template)):us.template.push("x"+ds.join("_"))}return cs===0?{foundLinear:!1}:(us.foundLinear=!0,us)}else return checkForScalarLinearExpression(ss,ts,rs,is)}function checkForScalarLinearExpression(ss,ts,rs,ns=[]){if(typeof ss=="string"&&ts.includes(ss)){let os={},ls="x"+ns.join("_");return os[ls]={result:Context.fromAst(rs).simplify(),components:ns,mathChildSub:ss},{foundLinear:!0,mappings:os,template:ls}}if(!Array.isArray(ss))return{foundLinear:!1};let is=ss[0],as=ss.slice(1);return is==="-"?(rs=["-",rs],checkForScalarLinearExpression(as[0],ts,rs,ns)):is==="+"?Context.variables(as[0]).every(os=>!ts.includes(os))?(rs=["+",rs,["-",as[0]]],checkForScalarLinearExpression(as[1],ts,rs,ns)):Context.variables(as[1]).every(os=>!ts.includes(os))?(rs=["+",rs,["-",as[1]]],checkForScalarLinearExpression(as[0],ts,rs,ns)):{foundLinear:!1}:is==="*"?Context.variables(as[0]).every(os=>!ts.includes(os))?(rs=["/",rs,as[0]],checkForScalarLinearExpression(as[1],ts,rs,ns)):Context.variables(as[1]).every(os=>!ts.includes(os))?(rs=["/",rs,as[1]],checkForScalarLinearExpression(as[0],ts,rs,ns)):{foundLinear:!1}:is==="/"?Context.variables(as[1]).every(os=>!ts.includes(os))?(rs=["*",rs,as[1]],checkForScalarLinearExpression(as[0],ts,rs,ns)):{foundLinear:!1}:{foundLinear:!1}}async function invertMath({desiredStateVariableValues:ss,dependencyValues:ts,stateValues:rs,workspace:ns,overrideFixed:is}){if(!await rs.canBeModified&&!is)return{success:!1};let as=ts.mathChildren,os=ts.stringChildren.length;if(as.length===1&&os===0)return{success:!0,instructions:[{setDependency:"mathChildren",desiredValue:ss.unnormalizedValue,childIndex:0,variableIndex:0}]};let ls=convertValueToMathExpression(ss.unnormalizedValue),us=await preprocessMathInverseDefinition({desiredValue:ls,stateValues:rs,variableName:"value",workspace:ns}),cs=us.vectorComponentsNotAffected;if(ls=us.desiredValue,as.length===0){let ys=[];return os>0?ys.push({setDependency:"expressionWithCodes",desiredValue:ls}):ys.push({setDependency:"valueShadow",desiredValue:ls}),{success:!0,instructions:ys}}let ps=await getExpressionPieces({expression:ls,stateValues:rs});if(!ps)return{success:!1};let ds=[],fs=[];if(cs&&await rs.mathChildrenByVectorComponent){let ys=await rs.mathChildrenByVectorComponent;for(let gs of cs)ys[gs]&&fs.push(...ys[gs])}let hs=await rs.mathChildrenWithCanBeModified;for(let[ys,gs]of as.entries())if(rs.mathChildrenMapped.has(ys)&&hs[ys].stateValues.canBeModified){if(!fs.includes(ys)){let bs=ps[ys],vs={},Ns=!1,Ts=await rs.constantChildIndices;for(let Cs in Ts){let xs=Ts[Cs];vs[Cs]=as[xs].stateValues.value,Ns=!0}Ns&&(bs=bs.substitute(vs)),bs=bs.simplify(),ds.push({setDependency:"mathChildren",desiredValue:bs,childIndex:ys,variableIndex:0})}delete ps[ys]}if(os>0){let vs=function(Ts){return typeof Ts=="string"&&Ts.substring(0,bs)===gs},Ns=function(Ts){return Array.isArray(Ts)?flattenDeep(Ts.slice(1)).some(vs):vs(Ts)},ys=ts.expressionWithCodes,gs=ts.codePre,bs=gs.length;if(vectorAndListOperators.includes(ys.tree[0])&&!ys.tree.slice(1).every(Ns)){let Ts=await rs.inverseMaps;for(let Cs in ps){let xs=Ts[Cs];if(xs.mathChildInd!==void 0)continue;let As=xs.components;ys=ys.substitute_component(As,ps[Cs])}ds.push({setDependency:"expressionWithCodes",desiredValue:ys})}}return{success:!0,instructions:ds}}async function getExpressionPieces({expression:ss,stateValues:ts}){let rs=await ts.template,ns=Context.utils.match(ss.tree,rs);if(!ns&&(ns=Context.utils.match(ss.tuples_to_vectors().tree,Context.fromAst(rs).tuples_to_vectors().tree),!ns&&(ns=Context.utils.match(ss.to_intervals().tree,Context.fromAst(rs).to_intervals().tree),!ns&&(ns=Context.utils.match(ss.tuples_to_vectors().to_intervals().tree,Context.fromAst(rs).tuples_to_vectors().to_intervals().tree),!ns))))return!1;let is={};for(let as in ns){let os={};os[await ts.codeForExpression]=ns[as];let ls=(await ts.inverseMaps)[as];if(ls!==void 0){let us=as;ls.mathChildInd!==void 0&&(us=ls.mathChildInd),is[us]=ls.result.substitute(os),is[us]=normalizeMathExpression({value:is[us],simplify:await ts.simplify,expand:await ts.expand,createVectors:await ts.createVectors,createIntervals:await ts.createIntervals})}}return is}class Label extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveLabel:this.moveLabel.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.forObject={createTargetComponentNames:!0},ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.styleNumber.defaultValue=0,ts}static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.valueShadow={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{valueShadow:!0}}},inverseDefinition({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setEssentialValue:"valueShadow",value:ns.valueShadow}]}}},ts.hasLatex={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text","latex","value","hasLatex","renderAsMath"],variablesOptional:!0},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"}}),definition:function({dependencyValues:ns}){if(ns.inlineChildren.length===0&&ns.valueShadow!==null){let as=ns.valueShadow;return{setValue:{hasLatex:!!/\\\(.*\\\)/.exec(as)}}}let is=!1;for(let as of ns.inlineChildren)if(typeof as=="object"){if(typeof as.stateValues.hasLatex=="boolean"&&typeof as.stateValues.value=="string"&&typeof as.stateValues.text=="string"){if(as.stateValues.hasLatex)return{setValue:{hasLatex:!0}}}else if(typeof as.stateValues.renderAsMath=="boolean"&&typeof as.stateValues.latex=="string"&&typeof as.stateValues.text=="string"){if(as.stateValues.renderAsMath)return{setValue:{hasLatex:!0}}}else if(typeof as.stateValues.latex=="string")return{setValue:{hasLatex:!0}}}return{setValue:{hasLatex:is}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"latex",public:!0,shadowingInstructions:{createComponentOfType:"text"}},{variableName:"value",public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"label",addStateVariablesShadowingStateVariables:{hasLatex:{stateVariableToShadow:"hasLatex"}}}}],returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text","latex","value","hasLatex","renderAsMath"],variablesOptional:!0},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"},hasLatex:{dependencyType:"stateVariable",variableName:"hasLatex"}}),definition:function({dependencyValues:ns}){if(ns.inlineChildren.length===0&&ns.valueShadow!==null){let os=ns.valueShadow,ls=os;return ns.hasLatex&&(ls=ls.replace(/\\\(/g,""),ls=ls.replace(/\\\)/g,"")),{setValue:{text:ls,latex:ls,value:os}}}let is="",as="";for(let os of ns.inlineChildren)if(typeof os!="object"){let ls=os.toString();is+=ls,as+=ls}else typeof os.stateValues.hasLatex=="boolean"&&typeof os.stateValues.value=="string"&&typeof os.stateValues.text=="string"?(is+=os.stateValues.text,as+=os.stateValues.value):typeof os.stateValues.renderAsMath=="boolean"&&typeof os.stateValues.latex=="string"&&typeof os.stateValues.text=="string"?os.stateValues.renderAsMath?(is+=os.stateValues.latex,as+="\\("+os.stateValues.latex+"\\)"):(is+=os.stateValues.text,as+=os.stateValues.text):typeof os.stateValues.latex=="string"?(is+=os.stateValues.latex,as+="\\("+os.stateValues.latex+"\\)"):typeof os.stateValues.text=="string"&&(is+=os.stateValues.text,as+=os.stateValues.text);return{setValue:{text:is,latex:is,value:as}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){let as;if(typeof ns.value=="string")as=ns.value;else if(typeof ns.text=="string")as=ns.text;else if(typeof ns.latex=="string")as=ns.latex;else return{success:!1};if(is.inlineChildren.length===0&&is.valueShadow!==null)return{success:!0,instructions:[{setDependency:"valueShadow",desiredValue:as}]};if(is.inlineChildren.length===1){let os=is.inlineChildren[0],ls=ns.value;if(typeof os!="object")return{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0}]};if(typeof os.stateValues.hasLatex=="boolean"&&typeof os.stateValues.value=="string"&&typeof os.stateValues.text=="string")return{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0,variableIndex:2}]};if(typeof os.stateValues.renderAsMath=="boolean"&&typeof os.stateValues.latex=="string"&&typeof os.stateValues.text=="string")if(os.stateValues.renderAsMath){let us=ls.match(/^\\\((.*)\\\)/);return us&&(ls=us[1]),{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0,variableIndex:1}]}}else return{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0,variableIndex:0}]};else if(typeof os.stateValues.latex=="string"){let us=ls.match(/^\\\((.*)\\\)/);return us&&(ls=us[1]),{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0,variableIndex:1}]}}else return typeof os.stateValues.text=="string"?{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ls,childIndex:0,variableIndex:0}]}:{success:!1}}else return{success:!1}}},ts.forObjectComponentName={returnDependencies:()=>({forObject:{dependencyType:"attributeTargetComponentNames",attributeName:"forObject"}}),definition({dependencyValues:ns}){var as;let is;return((as=ns.forObject)==null?void 0:as.length)===1?is=ns.forObject[0].absoluteName:is=null,{setValue:{forObjectComponentName:is}}}},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveLabel({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}}Ms(Label,"componentType","label"),Ms(Label,"renderChildren",!0),Ms(Label,"rendererType","label"),Ms(Label,"includeBlankStringChildren",!0),Ms(Label,"primaryStateVariableForDefinition","valueShadow"),Ms(Label,"adapters",["text"]);function returnGroupIntoComponentTypeSeparatedBySpaces({componentType:ss,forceComponentType:ts=!1}){return function({matchedChildren:rs,componentInfoObjects:ns}){let is=[],as=[];function os(){var us;let ls=!1;if(ts){if(as.length===1){let cs=as[0],ps=cs.componentType;ps==="copy"&&((us=cs.attributes)!=null&&us.createComponentOfType)&&(!cs.attributes.nComponents||cs.attributes.nComponents.primitive===1)&&(ps=cs.attributes.createComponentOfType.primitive),ns.isInheritedComponentType({inheritedComponentType:ps,baseComponentType:ss})&&(is.push(cs),ls=!0)}}else as.length===1&&typeof as[0]!="string"&&(is.push(as[0]),ls=!0);!ls&&as.length>0&&is.push({componentType:ss,children:as}),as=[]}for(let ls of rs)if(typeof ls!="string")as.push(ls);else{let us=ls.split(/\s+/),cs=us[0];cs===""?os():as.push(cs);for(let ps of us.slice(1))os(),ps!==""&&as.push(ps)}return os(),{success:!0,newChildren:is}}}function returnBreakStringsIntoComponentTypeBySpaces({componentType:ss}){return function({matchedChildren:ts}){return{success:!0,newChildren:ts.reduce(function(ns,is){return typeof is=="string"?[...ns,...is.split(/\s+/).filter(as=>as).map(as=>({componentType:ss,children:[as]}))]:[...ns,is]},[])}}}class MathList extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},ts.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},ts.mergeMathLists={createComponentOfType:"boolean"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"math"}),ns=returnBreakStringsIntoComponentTypeBySpaces({componentType:"math"});return ts.push({replacementFunction:function({matchedChildren:is,isAttributeComponent:as=!1,createdFromMacro:os=!1}){return as&&!os?rs({matchedChildren:is}):ns({matchedChildren:is})}}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"mathLists",componentTypes:["mathList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.mathsShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{mathsShadow:!0}})},ts.mergeMathLists={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({mergeMathListsAttr:{dependencyType:"attributeComponent",attributeName:"mergeMathLists",variableNames:["value"]},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],skipComponentNames:!0},mathChildren:{dependencyType:"child",childGroups:["maths"],skipComponentNames:!0}}),definition({dependencyValues:rs}){var is;return{setValue:{mergeMathLists:((is=rs.mergeMathListsAttr)==null?void 0:is.stateValues.value)||rs.mathListChildren.length===0&&rs.mathChildren.length===1}}}},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["mergeMathLists"],additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies({stateValues:rs}){let ns={maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}};return rs.mergeMathLists?ns.mathAndMathListChildren={dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["value","nComponents"],variablesOptional:!0}:(ns.mathListChildren={dependencyType:"child",childGroups:["mathLists"],variableNames:["nComponents"]},ns.mathAndMathListChildren={dependencyType:"child",childGroups:["maths","mathLists"],skipComponentNames:!0}),ns},definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=0,as=[];if(rs.mathAndMathListChildren.length>0)if(rs.mergeMathLists)for(let[ls,us]of rs.mathAndMathListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:us.componentType,baseComponentType:"mathList"})){for(let cs=0;cs<us.stateValues.nComponents;cs++)as[is+cs]=[ls,cs];is+=us.stateValues.nComponents}else{let cs=us.stateValues.value;if(cs&&Array.isArray(cs.tree)&&cs.tree[0]==="list"){let ps=cs.tree.length-1;for(let ds=0;ds<ps;ds++)as[ds+is]=[ls,ds,ps];is+=ps}else as[is]=[ls,0],is+=1}else{let ls=0;for(let[us,cs]of rs.mathAndMathListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"mathList"})){let ps=rs.mathListChildren[ls];ls++;for(let ds=0;ds<ps.stateValues.nComponents;ds++)as[is+ds]=[us,ds];is+=ps.stateValues.nComponents}else as[is]=[us,0],is+=1}else rs.mathsShadow!==null&&(is=rs.mathsShadow.length);let os=rs.maximumNumber;return os!==null&&is>os&&(is=os,as=as.slice(0,os)),{setValue:{nComponents:is,childIndexByArrayKey:as},checkForActualChange:{nComponents:!0}}}},ts.maths={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["math"],stateVariablesDeterminingDependencies:["mergeMathLists","childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={},as={mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}};for(let os of rs){let ls=[],us="1";ns.childIndexByArrayKey[os]&&(ls=[ns.childIndexByArrayKey[os][0]],us=ns.childIndexByArrayKey[os][1]+1),is[os]={mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["value","math"+us],variablesOptional:!0,childIndices:ls}}}return{globalDependencies:as,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].mathAndMathListChildren[0];if(ls)if(ls.stateValues.value!==void 0){let us=ls.stateValues.value;if(rs.mergeMathLists&&Array.isArray(us.tree)&&us.tree[0]==="list"){let cs=rs.childIndexByArrayKey[os][1];as[os]=us.get_component(cs)}else as[os]=us}else{let us=rs.childIndexByArrayKey[os][1]+1;as[os]=ls.stateValues["math"+us]}else rs.mathsShadow!==null&&(as[os]=rs.mathsShadow[os])}return{setValue:{maths:as}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,stateValues:os,workspace:ls}){if(ns.mergeMathLists){let cs=[],ps=await os.childIndexByArrayKey,ds=[];for(let fs in rs.maths){if(!is[fs]||ds.includes(fs))continue;let hs;if(ps[fs][2]!==void 0){let gs=Number(fs)-ps[fs][1],bs=gs+ps[fs][2]-1;ls.desiredMaths||(ls.desiredMaths=[]);let vs=["list"];for(let Ns=gs;Ns<=bs;Ns++)rs.maths[Ns]!==void 0?ls.desiredMaths[Ns]=convertValueToMathExpression(rs.maths[Ns]):ls.desiredMaths[Ns]===void 0&&(ls.desiredMaths[Ns]=(await os.maths)[Ns]),vs.push(ls.desiredMaths[Ns].tree),ds.push(Ns.toString());hs=Context.fromAst(vs)}else hs=rs.maths[fs];let ys=is[fs].mathAndMathListChildren[0];ys&&(ys.stateValues.value!==void 0?cs.push({setDependency:as[fs].mathAndMathListChildren,desiredValue:hs,childIndex:0,variableIndex:0}):cs.push({setDependency:as[fs].mathAndMathListChildren,desiredValue:hs,childIndex:0,variableIndex:1}))}return{success:!0,instructions:cs}}let us=[];for(let cs in rs.maths){if(!is[cs])continue;let ps=is[cs].mathAndMathListChildren[0];ps&&(ps.stateValues.value!==void 0?us.push({setDependency:as[cs].mathAndMathListChildren,desiredValue:rs.maths[cs],childIndex:0,variableIndex:0}):us.push({setDependency:as[cs].mathAndMathListChildren,desiredValue:rs.maths[cs],childIndex:0,variableIndex:1}))}return{success:!0,instructions:us}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({maths:{dependencyType:"stateVariable",variableName:"maths"}}),definition({dependencyValues:rs}){let ns;return rs.maths.length===0?ns=Context.fromAst(""):rs.maths.length===1?ns=rs.maths[0]:ns=Context.fromAst(["list",...rs.maths.map(is=>is.tree)]),{setValue:{math:ns}}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"maths"},ts.latex={additionalStateVariablesDefined:["latexs"],public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["valueForDisplay","latex","latexs"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is=[],as={};if(rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(as.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(as.padToDigits=rs.displayDigits)),rs.mathAndMathListChildren.length>0)for(let us of rs.mathAndMathListChildren)if(us.stateValues.valueForDisplay){let cs=us.stateValues.valueForDisplay;if(rs.mergeMathLists&&Array.isArray(cs.tree)&&cs.tree[0]==="list")for(let ps=0;ps<cs.tree.length-1;ps++)is.push(cs.get_component(ps).toLatex(as));else is.push(us.stateValues.latex)}else is.push(...us.stateValues.latexs);else rs.mathsShadow!==null&&(is=rs.mathsShadow.map(us=>roundForDisplay({value:us,dependencyValues:rs,usedDefault:ns}).toLatex(as)));let os=rs.maximumNumber;return os!==null&&is.length>os&&(os=Math.max(0,Math.floor(os)),is=is.slice(0,os)),{setValue:{latex:is.join(", "),latexs:is}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}}),definition:function({dependencyValues:rs}){let ns=[];if(rs.mathAndMathListChildren.length>0)for(let os of rs.mathAndMathListChildren)if(os.stateValues.valueForDisplay){let ls=os.stateValues.valueForDisplay;if(rs.mergeMathLists&&Array.isArray(ls.tree)&&ls.tree[0]==="list")for(let us=0;us<ls.tree.length-1;us++)ns.push(ls.get_component(us).toString());else ns.push(os.stateValues.text)}else ns.push(...os.stateValues.texts);else rs.mathsShadow!==null&&(ns=rs.mathsShadow.map(os=>os.toString()));let is=rs.maximumNumber;return is!==null&&ns.length>is&&(is=Math.max(0,Math.floor(is)),ns=ns.slice(0,is)),{setValue:{text:ns.join(", "),texts:ns}}}},ts.componentNamesInList={returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=[];for(let os of rs.mathAndMathListChildren)ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"mathList"})?is.push(...os.stateValues.componentNamesInList):is.push(os.componentName);let as=rs.maximumNumber;return as!==null&&is.length>as&&(as=Math.max(0,Math.floor(as)),is=is.slice(0,as)),{setValue:{componentNamesInList:is}}}},ts.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],variableNames:["nComponents"]},mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns,componentName:is}){let as=rs.nComponents;rs.parentNComponentsToDisplayByChild!==null&&(as=rs.parentNComponentsToDisplayByChild[is]);let os={},ls=0,us=0,cs=0;for(let ps of rs.mathAndMathListChildren){let ds=Math.max(0,as-ls);if(ds>0&&us++,ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"mathList"})){let fs=rs.mathListChildren[cs];cs++;let hs=Math.min(ds,fs.stateValues.nComponents);os[fs.componentName]=hs,ls+=hs}else ls+=1}return{setValue:{nComponentsToDisplayByChild:os,nChildrenToRender:us}}},markStale:()=>({updateRenderedChildren:!0})},ts}}Ms(MathList,"componentType","mathList"),Ms(MathList,"renderChildren",!0),Ms(MathList,"includeBlankStringChildren",!0),Ms(MathList,"removeBlankStringChildrenPostSugar",!0),Ms(MathList,"stateVariableForAttributeValue","maths"),Ms(MathList,"primaryStateVariableForDefinition","mathsShadow"),Ms(MathList,"descendantCompositesMustHaveAReplacement",!1),Ms(MathList,"adapters",[{stateVariable:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text"]);class Columns extends Text{}Ms(Columns,"componentType","columns"),Ms(Columns,"rendererType","text");class Title extends TextOrInline{}Ms(Title,"componentType","title");class RightHandSide extends MathComponent{}Ms(RightHandSide,"componentType","rightHandSide"),Ms(RightHandSide,"rendererType","math");class Description extends TextOrInline{}Ms(Description,"componentType","description"),Ms(Description,"rendererType");class Else extends Template{}Ms(Else,"componentType","else");class Xlabel extends Label{}Ms(Xlabel,"componentType","xlabel"),Ms(Xlabel,"rendererType","label");class Ylabel extends Label{}Ms(Ylabel,"componentType","ylabel"),Ms(Ylabel,"rendererType","label");class MatrixRow extends MathList{}Ms(MatrixRow,"componentType","matrixRow"),Ms(MatrixRow,"rendererType","mathList");class MatrixColumn extends MathList{}Ms(MatrixColumn,"componentType","matrixColumn"),Ms(MatrixColumn,"rendererType","mathList");var Aliases=Object.freeze({__proto__:null,Columns,Description,Else,MatrixColumn,MatrixRow,RightHandSide,Title,Xlabel,Ylabel});let M$3=(kl=class extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveMath:this.moveMath.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.styleNumber.defaultValue=0,ts}static returnChildGroups(){return[{group:"inline",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"",hasEssential:!0,forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["latex","text"],variablesOptional:!0}}),definition:function({dependencyValues:ns}){if(ns.inlineChildren.length===0)return{useEssentialOrDefaultValue:{latex:!0}};let is="";for(let as of ns.inlineChildren)typeof as!="object"?is+=as:typeof as.stateValues.latex=="string"?is+=as.stateValues.latex:typeof as.stateValues.text=="string"&&(is+=as.stateValues.text);return{setValue:{latex:is}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){if(typeof ns.latex!="string")return{success:!1};if(is.inlineChildren.length===0)return{success:!0,instructions:[{setEssentialValue:"latex",value:ns.latex}]};if(is.inlineChildren.length===1){let as=is.inlineChildren[0];return typeof as!="object"?{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ns.latex,childIndex:0}]}:typeof as.stateValues.latex=="string"?{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ns.latex,childIndex:0,variableIndex:0}]}:typeof as.stateValues.text=="string"?{success:!0,instructions:[{setDependency:"inlineChildren",desiredValue:ns.latex,childIndex:0,variableIndex:1}]}:{success:!1}}else return{success:!1}}},ts.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["latex","text"],variablesOptional:!0},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns,componentInfoObjects:is}){if(ns.inlineChildren.length===0)return{setValue:{latexWithInputChildren:[ns.latex]}};let as=[],os="",ls=0;for(let us of ns.inlineChildren)typeof us!="object"?os+=us:is.isInheritedComponentType({inheritedComponentType:us.componentType,baseComponentType:"input"})?(os.length>0&&(as.push(os),os=""),as.push(ls),ls++):typeof us.stateValues.latex=="string"?os+=us.stateValues.latex:typeof us.stateValues.text=="string"&&(os+=us.stateValues.text);return os.length>0&&as.push(os),{setValue:{latexWithInputChildren:as}}}},ts.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{renderMode:"inline"}})},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns}){let is;try{is=Context.fromAst(latexToAst.convert(ns.latex))}catch{return{setValue:{text:ns.latex}}}return{setValue:{text:superSubscriptsToUnicode(is.toString())}}}},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveMath({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}},Ms(kl,"componentType","m"),Ms(kl,"rendererType","math"),Ms(kl,"includeBlankStringChildren",!0),Ms(kl,"primaryStateVariableForDefinition","latex"),kl),Me$2=(uu=class extends M$3{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.renderMode.definition=()=>({setValue:{renderMode:"display"}}),ts}},Ms(uu,"componentType","me"),uu);class Men extends M$3{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.renderMode.definition=()=>({setValue:{renderMode:"numbered"}}),ts.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({equationCounter:{dependencyType:"counter",counterName:"equation"}}),definition({dependencyValues:rs}){return{setValue:{equationTag:String(rs.equationCounter)}}}},ts}}Ms(Men,"componentType","men");var MMeMen=Object.freeze({__proto__:null,M:M$3,Me:Me$2,Men});class Md extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveMath:this.moveMath.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.styleNumber.defaultValue=0,ts}static returnChildGroups(){return[{group:"mrows",componentTypes:["mrow"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.mrowChildNames={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"]}}),definition:({dependencyValues:ns})=>({setValue:{mrowChildNames:ns.mrowChildren.map(is=>is.componentName)}})},ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"",hasEssential:!0,shadowVariable:!0,forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"],variableNames:["latex","hide","equationTag","numbered"]}}),definition:function({dependencyValues:ns}){if(ns.mrowChildren.length>0){let is="";for(let as of ns.mrowChildren)as.stateValues.hide||(is.length>0&&(is+="\\\\"),as.stateValues.numbered?is+=`\\tag{${as.stateValues.equationTag}}`:is+="\\notag ",is+=as.stateValues.latex);return{setValue:{latex:is}}}else return{useEssentialOrDefaultValue:{latex:!0}}}},ts.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"],variableNames:["latexWithInputChildren","hide","equationTag","numbered"]},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns}){if(ns.mrowChildren.length>0){let is=[],as=0,os="";for(let ls of ns.mrowChildren)if(!ls.stateValues.hide){os.length>0&&(os+="\\\\"),ls.stateValues.numbered?os+=`\\tag{${ls.stateValues.equationTag}}`:os+="\\notag ";for(let us of ls.stateValues.latexWithInputChildren)typeof us=="number"?(os.length>0&&(is.push(os),os=""),is.push(as),as++):os+=us}return os.length>0&&is.push(os),{setValue:{latexWithInputChildren:is}}}else return{setValue:{latexWithInputChildren:[ns.latex]}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns}){let is;try{is=ns.latex.replaceAll("\\notag","").replaceAll("\\amp","").split("\\\\").map(as=>Context.fromAst(latexToAst.convert(as)).toString()).join(`\\\\
`)}catch{return{setValue:{text:ns.latex}}}return{setValue:{text:superSubscriptsToUnicode(is.toString())}}}},ts.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{renderMode:"align"}})},ts.numbered={returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!1}})},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveMath({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}}Ms(Md,"componentType","md"),Ms(Md,"rendererType","math"),Ms(Md,"primaryStateVariableForDefinition","latex");class Mdn extends Md{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numbered={returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!0}})},ts}}Ms(Mdn,"componentType","mdn");class Mrow extends M$3{static createAttributesObject(){let ts=super.createAttributesObject();return ts.number={createComponentOfType:"boolean"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.renderMode.definition=()=>({setValue:{renderMode:"display"}}),ts.numbered={forRenderer:!0,returnDependencies:()=>({parentNumbered:{dependencyType:"parentStateVariable",variableName:"numbered"},numberAttr:{dependencyType:"attributeComponent",attributeName:"number",variableNames:["value"]}}),definition({dependencyValues:rs}){let ns;return rs.numberAttr!==null?ns=rs.numberAttr.stateValues.value:ns=rs.parentNumbered,{setValue:{numbered:ns}}}},ts.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["numbered"],returnDependencies({stateValues:rs}){return rs.numbered?{equationCounter:{dependencyType:"counter",counterName:"equation"}}:{}},definition({dependencyValues:rs}){return rs.equationCounter!==void 0?{setValue:{equationTag:String(rs.equationCounter)}}:{setValue:{equationTag:null}}}},ts}}Ms(Mrow,"componentType","mrow");var MdMdnMrow=Object.freeze({__proto__:null,Md,Mdn,Mrow});function periodicSetEquality(ss,ts,{min_elements_match:rs=3,match_partial:ns=!1}={}){if(!is_periodic_set(ss))return!1;if(is_periodic_set(ts))if(ns){let is=contained_in(ss.tree,ts.tree,ns);if(is===!1)return 0;let as=contained_in(ts.tree,ss.tree,ns);return as===!1?0:is===!0?as===!0?1:as:as===!0?is:Math.min(is,as)}else return contained_in(ss.tree,ts.tree,ns)&&contained_in(ts.tree,ss.tree,ns);else{let is=ss.tree.slice(1);if(is.length>1)return!1;let as=Context.fromAst(is[0][1]).evaluate_to_constant(),os=Context.fromAst(["apply","abs",is[0][2]]).evaluate_to_constant();if(!Number.isFinite(as)||!Number.isFinite(os))return!1;let ls=is[0][3],us=is[0][4];if(ls!==-1/0||us!==1/0||ts.tree[0]!=="list")return!1;let cs=ts.tree.slice(1),ps=0;if(cs[0][0]==="ldots")ps++,cs=cs.slice(1);else if(!ns)return!1;if(cs[cs.length-1][0]==="ldots")ps++,cs=cs.slice(0,cs.length-1);else if(!ns)return!1;let ds=cs.length;if(ds===0||!ns&&ds<rs)return!1;cs=cs.map(gs=>Context.fromAst(gs).evaluate_to_constant());let fs=Context.math.mod(cs[0]-as,os);if(!(Context.math.min(fs,os-fs)<1e-10*os))return!1;let hs=1;for(let gs=1;gs<ds;gs++)if(Math.abs(cs[gs]-cs[gs-1]-os)<1e-10*os)hs++;else{if(!ns)return!1;break}if(hs===ds&&ps===2&&ds>=rs)return!0;let ys=hs/Math.max(ds,rs);return ys*=(9+ps/2)/10,ys}}function is_periodic_set(ss){var ts=ss.tree;if(!Array.isArray(ts)||ts[0]!=="periodic_set")return!1;var rs=ts.slice(1);for(var ns of rs)if(!Array.isArray(ns)||ns[0]!=="tuple"||ns.length!==5)return!1;return!0}function contained_in(ss,ts,rs){if(ss[0]==="periodic_set")if(rs){let ds=0;for(let hs of ss.slice(1)){let ys=contained_in(hs,ts,rs);ys===!0?ds++:ys!==!1&&(ds+=ys)}let fs=ss.length-1;return ds===fs?!0:ds===0?!1:ds/fs}else return ss.slice(1).every(ds=>contained_in(ds,ts));var ns=ss[1],is=ss[2],as=ss[3],os=ss[4];if(as!==-1/0||os!==1/0)return!1;ns=Context.fromAst(["/",ns,is]).evaluate_to_constant();var ls=ts.slice(1),us=[];for(let ds=0;ds<ls.length;ds++){let fs=ls[ds][3],hs=ls[ds][4];if(fs!==-1/0||hs!==1/0)return!1;let ys=Context.fromAst(["/",ls[ds][1],is]).evaluate_to_constant(),gs=Context.fromAst(["apply","abs",["/",ls[ds][2],is]]).evaluate_to_constant();if(typeof gs!="number"||Number.isNaN(gs))return!1;let bs=Context.math.fraction(gs),vs=bs.n;if(vs>1e3)return!1;let Ns=bs.d;us.push([vs,Ns,ys,gs])}for(us.sort();us[0][0]===1;){let fs=us[0][2],hs=us[0][3],ys=Context.fromAst(["+",fs,["-",ns]]).evaluate_to_constant();if(Number.isFinite(ys)&&Number.isFinite(hs)&&(ys=Context.math.mod(ys,hs),Context.math.min(ys,hs-ys)<1e-10*hs))return!0;if(us.splice(0,1),us.length===0)return!1}var cs=[...new Set(us.map(ds=>ds[0]))];let ps=0;for(let ds of cs){let fs=us.map(function(ys,gs){let bs=ds/ys[0];if(Number.isInteger(bs))return[ys[0],bs,gs]}).filter(ys=>ys),hs=[];for(let ys of fs){let gs=ys[0],bs=ys[1],vs=ys[2],Ns=us[vs][2],Ts=us[vs][3];for(let Cs=0;Cs<gs;Cs++){let xs=Context.fromAst(["+",Ns,["-",["+",ns,Cs]]]).evaluate_to_constant();if(Number.isFinite(xs)&&Number.isFinite(Ts)&&(xs=Context.math.mod(xs,Ts),Context.math.min(xs,Ts-xs)<1e-10*Ts)){for(let ws=0;ws<bs;ws++)hs[Cs+ws*gs]=!0;let As=!0;for(let ws=0;ws<ds;ws++)if(!hs[ws]){As=!1;break}if(As)return!0;break}}}if(rs){let ys=0;for(let gs=0;gs<ds;gs++)hs[gs]&&ys++;ys/=ds,ys>ps&&(ps=ys)}}return rs&&ps>0?ps:!1}const nonTupleVectorOperators=["vector","altvector"];function checkEquality({object1:ss,object2:ts,isUnordered:rs=!1,partialMatches:ns=!1,matchByExactPositions:is=!1,symbolicEquality:as=!1,simplify:os="none",expand:ls=!1,allowedErrorInNumbers:us=0,includeErrorInNumberExponents:cs=!1,allowedErrorIsAbsolute:ps=!1,nSignErrorsMatched:ds=0,nPeriodicSetMatchesRequired:fs=3,caseInsensitiveMatch:hs=!1,matchBlanks:ys=!1}){let gs=!1;if(ss instanceof Context.class){if(gs=!0,!(ts instanceof Context.class))if(typeof ts=="number"||typeof ts=="string")ts=Context.fromAst(ts);else return{fraction_equal:0}}else if(ts instanceof Context.class)if(gs=!0,typeof ss=="number"||typeof ss=="string")ss=Context.fromAst(ss);else return{fraction_equal:0};let bs=function(Ss,Ds=!1){Ss instanceof Context.class||(Ss=Context.fromAst(Ss)),Ss=Ss.normalize_function_names().normalize_applied_functions(),hs&&(Ss=Context.fromAst(setStringsInTreeToLowerCase(Ss.tree)));let Vs=os,Is=ls;return Ds&&(Vs="full",Is=!0),Vs==="none"?us>0&&(Ss=Ss.constants_to_floats()):Vs==="numberspreserveorder"?Ss=Ss.evaluate_numbers({max_digits:1/0,skip_ordering:!0}):Vs==="number"?Ss=Ss.evaluate_numbers({max_digits:1/0}):Ss=Ss.evaluate_numbers({max_digits:1/0,evaluate_functions:!0}),normalizeMathExpression({value:Ss,simplify:Vs,expand:Is})},vs;gs?as?vs=function(Ss,Ds){let Vs=Ss,Is=Ds;if(Ss instanceof Context.class||(Vs=Context.fromAst(Ss)),Ds instanceof Context.class||(Is=Context.fromAst(Ds)),ds>0){Is=JSON.parse(JSON.stringify(Is),Context.reviver);let Os=function($s,Rs){return $s.variables().includes("")||Rs.variables().includes("")?!1:($s=bs($s),$s.equalsViaSyntax(Rs,{allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,allow_blanks:ys}))};return Vs.tree.im||Is.tree.im?{fraction_equal:0}:{fraction_equal:Context.equalSpecifiedSignErrors(Is,Vs,{equalityFunction:Os,n_sign_errors:ds})?1:0}}else return Vs.variables().includes("")||Is.variables().includes("")?{fraction_equal:0}:Vs.tree.im||Is.tree.im?{fraction_equal:0}:{fraction_equal:Vs.equalsViaSyntax(Is,{allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,allow_blanks:ys})?1:0}}:vs=function(Ss,Ds){let Vs=Ss,Is=Ds;if(Ss instanceof Context.class||(Vs=Context.fromAst(Ss)),Ds instanceof Context.class||(Is=Context.fromAst(Ds)),hs&&(Vs=Context.fromAst(setStringsInTreeToLowerCase(Vs.tree)),Is=Context.fromAst(setStringsInTreeToLowerCase(Is.tree))),ds>0){Is=JSON.parse(JSON.stringify(Is),Context.reviver);let Os=function($s,Rs){return $s.equals(Rs,{allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,allow_blanks:ys})};return Vs.tree.im||Is.tree.im?{fraction_equal:0}:{fraction_equal:Context.equalSpecifiedSignErrors(Is,Vs,{equalityFunction:Os,n_sign_errors:ds})?1:0}}else return Vs.tree.im||Is.tree.im?{fraction_equal:0}:{fraction_equal:Vs.equals(Is,{allowed_error_in_numbers:us,include_error_in_number_exponents:cs,allowed_error_is_absolute:ps,allow_blanks:ys})?1:0}}:vs=(Ss,Ds)=>(hs&&(Ss=convertStringsToLowerCase(Ss),Ds=convertStringsToLowerCase(Ds)),{fraction_equal:deepCompare(Ss,Ds)?1:0});let Ns=!1,Ts=!1;if(gs){ss=bs(ss,!as),ts=bs(ts,!as);let Ss=ss.tree[0],Ds=ts.tree[0];if(Ss==="periodic_set"||Ds==="periodic_set"){let Vs=ss,Is=ts;Ss!=="periodic_set"&&(Vs=ts,Is=ss);let Os=periodicSetEquality(Vs,Is,{match_partial:ns,min_elements_match:fs});return Os===!0?{fraction_equal:1}:Os===!1?{fraction_equal:0}:{fraction_equal:Os}}else if(Ss==="list")ss=ss.tree.slice(1),Ds==="list"?ts=ts.tree.slice(1):ts=[ts.tree];else if(Ds==="list")ts=ts.tree.slice(1),ss=[ss.tree];else if(nonTupleVectorOperators.includes(Ss)){if(ss=ss.tree.slice(1),Ds==="interval"||Ds==="matrix"||Ds==="array"||Ds==="set")return{fraction_equal:0};vectorOperators.includes(Ds)?ts=ts.tree.slice(1):ts=[ts.tree]}else if(nonTupleVectorOperators.includes(Ds)){if(ts=ts.tree.slice(1),Ss==="interval"||Ss==="matrix"||Ss==="array"||Ss==="set")return{fraction_equal:0};Ss==="tuple"?ss=ss.tree.slice(1):ss=[ss.tree]}else if(Ss==="interval"){is=!0;let Vs=ss.tree[2],Is=Vs[1],Os=Vs[2];if(ss=ss.tree[1].slice(1),Ds==="matrix"||Ds==="set")return{fraction_equal:0};if(Ds==="tuple"){let Ps=ts.tree.slice(1);if(Ps.length===2&&Is===!1&&Os===!1)ts=Ps;else return{fraction_equal:0}}else if(Ds==="array"){let Ps=ts.tree.slice(1);if(Ps.length===2&&Is===!0&&Os===!0)ts=Ps;else return{fraction_equal:0}}else if(Ds==="interval"){let Ps=ts.tree[2];if(Ps[1]!==Is||Ps[2]!==Os)return{fraction_equal:0};ts=ts.tree[1].slice(1)}else return{fraction_equal:0}}else if(Ds==="interval"){is=!0;let Vs=ts.tree[2],Is=Vs[1],Os=Vs[2];if(ts=ts.tree[1].slice(1),Ss==="matrix"||Ss==="set")return{fraction_equal:0};if(Ss==="tuple"){let Ps=ss.tree.slice(1);if(Ps.length===2&&Is===!1&&Os===!1)ss=Ps;else return{fraction_equal:0}}else if(Ss==="array"){let Ps=ss.tree.slice(1);if(Ps.length===2&&Is===!0&&Os===!0)ss=Ps;else return{fraction_equal:0}}else return{fraction_equal:0}}else if(Ss==="matrix")if(Ds==="matrix")ss=convertMatrixToArrayOfTuples(ss.tree.slice(1)),ts=convertMatrixToArrayOfTuples(ts.tree.slice(1)),is=!0,Ts=!0,Ns=!0;else return{fraction_equal:0};else{if(Ds==="matrix")return{fraction_equal:0};if(Ss==="set"){let Vs=[];for(let Is of ss.tree.slice(1))Vs.some(Os=>vs(Os,Is).fraction_equal===1)||Vs.push(Is);if(ss=Vs,rs=!0,Ds==="tuple"||Ds==="array")return{fraction_equal:0};if(Ds==="set"){Vs=[];for(let Is of ts.tree.slice(1))Vs.some(Os=>vs(Os,Is).fraction_equal===1)||Vs.push(Is);ts=Vs}else ts=[ts.tree]}else if(Ds==="set"){let Vs=[];for(let Is of ts.tree.slice(1))Vs.some(Os=>vs(Os,Is).fraction_equal===1)||Vs.push(Is);if(ts=Vs,rs=!0,Ss==="tuple"||Ss==="array")return{fraction_equal:0};ss=[ss.tree]}else if(Ss==="tuple"){if(ss=ss.tree.slice(1),Ds==="array")return{fraction_equal:0};Ds==="tuple"?ts=ts.tree.slice(1):ts=[ts.tree]}else if(Ds==="tuple"){if(ts=ts.tree.slice(1),Ss==="array")return{fraction_equal:0};ss=[ss.tree]}else if(Ss==="array")ss=ss.tree.slice(1),Ds==="array"?ts=ts.tree.slice(1):ts=[ts.tree];else if(Ds==="array")ts=ts.tree.slice(1),ss=[ss.tree];else return vs(ss.tree,ts.tree)}}else if(Array.isArray(ss))Array.isArray(ts)||(typeof ts=="string"&&ss.every(Ss=>typeof Ss=="string"&&!Ss.includes(","))?ts=ts.split(",").map(Ss=>Ss.trim()):ts=[ts]);else if(Array.isArray(ts))typeof ss=="string"&&ts.every(Ss=>typeof Ss=="string"&&!Ss.includes(","))?ss=ss.split(",").map(Ss=>Ss.trim()):ss=[ss];else return vs(ss,ts);let Cs=ss.length,xs=ts.length,As={fraction_equal:0};if(is&&(rs=!1),!rs){let Ss=0,Ds=Math.min(Cs,xs);for(let Os=0;Os<Ds;Os++){let Ps=checkEquality({object1:Context.fromAst(ss[Os]),object2:Context.fromAst(ts[Os]),isUnordered:!1,partialMatches:Ns,matchByExactPositions:Ts,symbolicEquality:as,simplify:os,expand:ls,allowedErrorInNumbers:us,allowedErrorIsAbsolute:ps,nSignErrorsMatched:ds,nPeriodicSetMatchesRequired:fs,caseInsensitiveMatch:hs,matchBlanks:ys});Ss+=Ps.fraction_equal}if(Cs===xs&&Cs===Ss)return As.fraction_equal=1,As;if(!ns)return As;if(is)return As.fraction_equal=Ss/Math.max(Cs,xs),As;let Vs=Array.from(Array(Cs+1),Os=>Array(xs+1).fill(0));for(let Os=0;Os<Cs;Os++)for(let Ps=0;Ps<xs;Ps++){let $s=checkEquality({object1:Context.fromAst(ss[Os]),object2:Context.fromAst(ts[Ps]),isUnordered:!1,partialMatches:Ns,matchByExactPositions:Ts,symbolicEquality:as,simplify:os,expand:ls,allowedErrorInNumbers:us,allowedErrorIsAbsolute:ps,nSignErrorsMatched:ds,nPeriodicSetMatchesRequired:fs,caseInsensitiveMatch:hs,matchBlanks:ys});Vs[Os+1][Ps+1]=Math.max(Vs[Os][Ps]+$s.fraction_equal,Vs[Os+1][Ps],Vs[Os][Ps+1])}let Is=Vs[Cs][xs];return As.fraction_equal=Is/Math.max(Cs,xs),As}let ws=new Set,Es=0;for(let Ss of ss){let Ds=-1,Vs=0;for(let[Is,Os]of ts.entries()){if(ws.has(Is))continue;let Ps=checkEquality({object1:Context.fromAst(Ss),object2:Context.fromAst(Os),isUnordered:!1,partialMatches:Ns,matchByExactPositions:Ts,symbolicEquality:as,simplify:os,expand:ls,allowedErrorInNumbers:us,allowedErrorIsAbsolute:ps,nSignErrorsMatched:ds,nPeriodicSetMatchesRequired:fs,caseInsensitiveMatch:hs,matchBlanks:ys});Ps.fraction_equal>Vs&&(Vs=Ps.fraction_equal,Ds=Is)}Ds!==-1&&(Es+=Vs,ws.add(Ds))}return Cs===xs&&Cs===Es?(As.fraction_equal=1,As):(ns&&(As.fraction_equal=Es/Math.max(Cs,xs)),As)}function setStringsInTreeToLowerCase(ss){return typeof ss=="string"?ss.toLowerCase():Array.isArray(ss)?[ss[0],...ss.slice(1).map(setStringsInTreeToLowerCase)]:ss}function convertStringsToLowerCase(ss){return typeof ss=="string"?ss.toLowerCase():Array.isArray(ss)?ss.map(convertStringsToLowerCase):ss}function convertMatrixToArrayOfTuples(ss){let ts=ss[0][1],rs=ss[0][2];if(!(Number.isInteger(ts)&&Number.isInteger(rs)))return ss;let ns=[];for(let is=0;is<ts;is++){let as=["tuple"],os=ss[1][is+1]||[];for(let ls=0;ls<rs;ls++){let us=os[ls+1];us==null&&(us=""),as.push(us)}ns.push(as)}return ns}const appliedFunctionSymbolsWithBooleanOperators=[...appliedFunctionSymbolsDefault,"isnumber","isinteger"];var fromTextUnsplit=getFromText({splitSymbols:!1,appliedFunctionSymbols:appliedFunctionSymbolsWithBooleanOperators,parseScientificNotation:!1}),fromTextSplit=getFromText({parseScientificNotation:!1});function buildParsedExpression({dependencyValues:ss,componentInfoObjects:ts}){let rs="comp",ns=!0;for(;ns;){ns=!1;for(let cs of ss.stringChildren)if(cs.includes(rs)){ns=!0,rs+="p";break}}let is="",as=0,os=[],ls=0;for(let cs of ss.allChildren)if(typeof cs=="string")is+=" "+ss.stringChildren[ls]+" ",ls++;else{let ps=rs+as;is+=" "+ps+" ",ts.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"math"})||ts.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"mathList"})||ts.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"number"})||ts.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"numberList"})||os.push(ps),as+=1}let us=null;try{us=fromTextUnsplit(is)}catch{}return us&&(us=Context.fromAst(splitSymbolsIfMath({logicTree:us.tree,nonMathCodes:os}))),{setValue:{codePre:rs,parsedExpression:us}}}function evaluateLogic({logicTree:ss,canOverrideUnorderedCompare:ts=!1,dependencyValues:rs,valueOnInvalid:ns=0}){let is=Ns=>evaluateLogic({logicTree:Ns,canOverrideUnorderedCompare:ts,dependencyValues:rs,valueOnInvalid:ns});if(!Array.isArray(ss)){if(typeof ss=="string"){let Ns=rs.booleanChildrenByCode[ss];if(Ns)return rs.matchPartial&&Ns.stateValues.fractionSatisfied!==void 0?Ns.stateValues.fractionSatisfied:Ns.stateValues.value?1:0;{let Ts=rs.mathChildrenByCode[ss];if(Ts){let Cs=Ts.stateValues.value.simplify().evaluate_to_constant();return Number.isFinite(Cs)&&Cs!==0?1:0}else{let Cs=rs.numberChildrenByCode[ss];if(Cs){let xs=Cs.stateValues.value;return Number.isFinite(xs)&&xs!==0?1:0}else{if(ss.toLowerCase()==="true")return 1;if(ss.toLowerCase()==="false")return 0}}}}else if(typeof ss=="number")return ss===0?0:1;return console.warn("Invalid format for boolean condition"),ns}let as=ss[0],os=ss.slice(1);if(as==="not")return os.length!==1?(console.warn("Invalid format for boolean condition"),ns):is(os[0])===0?1:0;if(as==="and")return rs.matchPartial?os.reduce((Ns,Ts)=>Ns+is(Ts),0)/os.length:os.every(Ns=>is(Ns)===1)?1:0;if(as==="or")return rs.matchPartial?os.reduce((Ns,Ts)=>Math.max(is(Ts),Ns),0):os.some(Ns=>is(Ns)===1)?1:0;let ls=!1,us=!1,cs=!1,ps=!1;os.forEach(function(Ns){typeof Ns=="string"&&(Ns in rs.mathChildrenByCode||Ns in rs.mathListChildrenByCode||Ns in rs.numberChildrenByCode||Ns in rs.numberListChildrenByCode?ls=!0:Ns in rs.textChildrenByCode||Ns in rs.textListChildrenByCode?us=!0:Ns in rs.booleanChildrenByCode||Ns in rs.booleanListChildrenByCode?cs=!0:Ns in rs.otherChildrenByCode&&(ps=!0))});let ds=function(Ns){if(typeof Ns=="string"){let Ts=rs.mathChildrenByCode[Ns];return Ts!==void 0?Ts.stateValues.value.tree:(Ts=rs.mathListChildrenByCode[Ns],Ts!==void 0?["list",...Ts.stateValues.maths.map(Cs=>Cs.tree)]:(Ts=rs.numberChildrenByCode[Ns],Ts!==void 0?numberToMathExpression(Ts.stateValues.value).tree:(Ts=rs.numberListChildrenByCode[Ns],Ts!==void 0?["list",...Ts.stateValues.numbers]:Ns)))}return Array.isArray(Ns)?[Ns[0],...Ns.slice(1).map(ds)]:Ns};if(as==="apply"&&["isnumber","isinteger"].includes(os[0])){if(us||cs||ps)return 0;let Ts=Context.fromAst(ds(os[1])).simplify().evaluate_to_constant();if(!Number.isFinite(Ts))return 0;if(os[0]==="isnumber")return 1;{let Cs=Math.round(Ts);return Math.abs(Cs-Ts)<=1e-15*Math.abs(Ts)?1:0}}if(!["=","ne","<",">","le","ge","lts","gts","in","notin"].includes(as)){if(us||cs||ps)return console.warn("Invalid format for boolean condition"),ns;let Ts=Context.fromAst(ds(ss)).simplify().evaluate_to_constant();return Number.isFinite(Ts)&&Ts!==0?1:0}if(cs){if(ls||us||ps)return console.warn("Invalid format for boolean condition"),ns;let Ns=!1,Ts=!1;if(os=os.map(function(xs){if(typeof xs=="string"){let As=rs.booleanChildrenByCode[xs];return As!==void 0?As.stateValues.value:(As=rs.booleanListChildrenByCode[xs],As!==void 0?(As.stateValues.unordered&&(Ts=!0),As.stateValues.booleans):(xs=xs.toLowerCase().trim(),xs==="true"||xs==="t"?!0:xs==="false"||xs==="f"?!1:(console.warn("Invalid format for boolean condition"),Ns=!0,ns)))}return console.warn("Invalid format for boolean condition"),Ns=!0,ns}),Ns)return ns;let Cs=rs.unorderedCompare;if(ts&&Ts&&(Cs=!0),as==="="){let xs=os[0];if(rs.matchPartial){let As=os.slice(1).map(Es=>checkEquality({object1:xs,object2:Es,isUnordered:Cs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions}));return As.reduce((Es,Ss)=>Es+Ss.fraction_equal,0)/As.length}else return os.slice(1).every(As=>checkEquality({object1:xs,object2:As,isUnordered:Cs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions}).fraction_equal===1)?1:0}else return as==="ne"?os.length!==2?(console.warn("Invalid format for boolean condition"),ns):checkEquality({object1:os[0],object2:os[1],isUnordered:Cs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),ns)}else if(us){if(ls||ps)return console.warn("Invalid format for boolean condition"),ns;let Ns=!1,Ts=!1,Cs=function(As,ws=!1){if(typeof As=="string"){let Es=rs.textChildrenByCode[As];return Es!==void 0?Es.stateValues.value.trim().replace(/\s+/," "):(Es=rs.textListChildrenByCode[As],Es!==void 0?(Es.stateValues.unordered&&(Ts=!0),Es.stateValues.texts.map(Ss=>Ss.trim().replace(/\s+/," "))):As.trim())}return typeof As=="number"?As.toString():ws&&Array.isArray(As)&&As[0]==="*"?As.slice(1).map(Cs).join(" "):(console.warn("Invalid format for boolean condition"),Ns=!0,"")};if(os=os.map(As=>Cs(As,!0)),Ns)return ns;let xs=rs.unorderedCompare;if(ts&&Ts&&(xs=!0),as==="="){let As=os[0];if(rs.matchPartial){let ws=os.slice(1).map(Ss=>checkEquality({object1:As,object2:Ss,isUnordered:xs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,caseInsensitiveMatch:rs.caseInsensitiveMatch}));return ws.reduce((Ss,Ds)=>Ss+Ds.fraction_equal,0)/ws.length}else return os.slice(1).every(ws=>checkEquality({object1:As,object2:ws,isUnordered:xs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,caseInsensitiveMatch:rs.caseInsensitiveMatch}).fraction_equal===1)?1:0}else return as==="ne"?os.length!==2?(console.warn("Invalid format for boolean condition"),0):checkEquality({object1:os[0],object2:os[1],isUnordered:xs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,caseInsensitiveMatch:rs.caseInsensitiveMatch}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),ns)}else if(ps){if(ls)return console.warn("Invalid format for boolean condition"),ns;let Ns=!1;return os=os.map(function(Ts){if(typeof Ts=="string"){let Cs=rs.otherChildrenByCode[Ts];if(Cs!==void 0)return Cs.stateValues.value}return console.warn("Invalid format for boolean condition"),Ns=!0,null}),Ns?ns:as==="="?os.slice(1).every(Ts=>deepCompare(Ts,os[0]))?1:0:as==="ne"?os.length!==2?(console.warn("Invalid format for boolean condition"),0):deepCompare(os[0],os[1])?0:1:(console.warn("Invalid format for boolean condition"),0)}let fs;(as==="lts"||as==="gts")&&(fs=os[1].slice(1),os=os[0].slice(1));let hs=!1,ys=function(Ns){if(typeof Ns=="string"){let Ts=rs.mathChildrenByCode[Ns];return Ts!==void 0?(Ts.stateValues.unordered&&(hs=!0),Ts.stateValues.value.tree):(Ts=rs.mathListChildrenByCode[Ns],Ts!==void 0?(Ts.stateValues.unordered&&(hs=!0),["list",...Ts.stateValues.maths.map(Cs=>Cs.tree)]):(Ts=rs.numberChildrenByCode[Ns],Ts!==void 0?numberToMathExpression(Ts.stateValues.value).tree:(Ts=rs.numberListChildrenByCode[Ns],Ts!==void 0?(Ts.stateValues.unordered&&(hs=!0),["list",...Ts.stateValues.numbers]):Ns)))}return Array.isArray(Ns)?[Ns[0],...Ns.slice(1).map(ys)]:Ns},gs=os.map(function(Ns){return Context.fromAst(ys(Ns))}),bs=rs.unorderedCompare;if(ts&&hs&&(bs=!0),as==="="){let Ns=gs[0];if(Number.isNaN(Ns.tree))return gs.slice(1).every(Ts=>Number.isNaN(Ts.tree))?1:0;if(rs.matchPartial){let Ts=gs.slice(1).map(xs=>checkEquality({object1:Ns,object2:xs,isUnordered:bs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,symbolicEquality:rs.symbolicEquality,simplify:rs.simplifyOnCompare,expand:rs.expandOnCompare,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched,nPeriodicSetMatchesRequired:rs.nPeriodicSetMatchesRequired,caseInsensitiveMatch:rs.caseInsensitiveMatch,matchBlanks:rs.matchBlanks}));return Ts.reduce((xs,As)=>xs+As.fraction_equal,0)/Ts.length}else return gs.slice(1).every(Ts=>checkEquality({object1:Ns,object2:Ts,isUnordered:bs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,symbolicEquality:rs.symbolicEquality,simplify:rs.simplifyOnCompare,expand:rs.expandOnCompare,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched,nPeriodicSetMatchesRequired:rs.nPeriodicSetMatchesRequired,caseInsensitiveMatch:rs.caseInsensitiveMatch,matchBlanks:rs.matchBlanks}).fraction_equal===1)?1:0}if(as==="ne")return checkEquality({object1:gs[0],object2:gs[1],isUnordered:bs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,symbolicEquality:rs.symbolicEquality,simplify:rs.simplifyOnCompare,expand:rs.expandOnCompare,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched,nPeriodicSetMatchesRequired:rs.nPeriodicSetMatchesRequired,caseInsensitiveMatch:rs.caseInsensitiveMatch,matchBlanks:rs.matchBlanks}).fraction_equal===0?1:0;if(as==="in"||as==="notin"){let Ns=gs[0],Cs=gs[1].tree;if(!(Array.isArray(Cs)&&Cs[0]==="set"))return console.warn("Invalid format for boolean condition"),ns;if(rs.matchPartial){let As=Cs.slice(1).map(ws=>checkEquality({object1:Ns,object2:Context.fromAst(ws),isUnordered:bs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,symbolicEquality:rs.symbolicEquality,simplify:rs.simplifyOnCompare,expand:rs.expandOnCompare,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched,nPeriodicSetMatchesRequired:rs.nPeriodicSetMatchesRequired,caseInsensitiveMatch:rs.caseInsensitiveMatch,matchBlanks:rs.matchBlanks})).reduce((ws,Es)=>Math.max(ws,Es.fraction_equal),0);return as==="in"?As:1-As}else{let xs=Cs.slice(1).some(As=>checkEquality({object1:Ns,object2:Context.fromAst(As),isUnordered:bs,partialMatches:rs.matchPartial,matchByExactPositions:rs.matchByExactPositions,symbolicEquality:rs.symbolicEquality,simplify:rs.simplifyOnCompare,expand:rs.expandOnCompare,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched,nPeriodicSetMatchesRequired:rs.nPeriodicSetMatchesRequired,caseInsensitiveMatch:rs.caseInsensitiveMatch,matchBlanks:rs.matchBlanks}).fraction_equal===1);return as==="in"?xs?1:0:xs?0:1}}let vs=gs.map(Ns=>Ns.simplify().evaluate_to_constant());if(vs.some(Ns=>Number.isNaN(Ns)))return 0;if(as==="<")return vs[0]<vs[1]?1:0;if(as===">")return vs[0]>vs[1]?1:0;if(as==="le")return vs[0]<=vs[1]?1:0;if(as==="ge")return vs[0]>=vs[1]?1:0;for(let Ns=0;Ns<fs.length;Ns++)if(as==="lts"){if(fs[Ns]===!0){if(!(vs[Ns]<vs[Ns+1]))return 0}else if(!(vs[Ns]<=vs[Ns+1]))return 0}else if(fs[Ns]===!0){if(!(vs[Ns]>vs[Ns+1]))return 0}else if(!(vs[Ns]>=vs[Ns+1]))return 0;return 1}function splitSymbolsIfMath({logicTree:ss,nonMathCodes:ts,foundNonMath:rs=!1,init:ns=!0}){if(!Array.isArray(ss))return typeof ss=="string"&&!rs&&!ns?fromTextSplit(ss).tree:ss;let is=ss[0],as=ss.slice(1);if(["and","not","or"].includes(is))return[is,...as.map(os=>splitSymbolsIfMath({logicTree:os,nonMathCodes:ts,foundNonMath:rs,init:ns}))];if(as.some(os=>ts.includes(os))&&(rs=!0),is==="apply"){as=[as[0],...as.slice(1).map(ls=>splitSymbolsIfMath({logicTree:ls,nonMathCodes:ts,foundNonMath:rs,init:!1}))];let os=!1;if(as[0]==="int"?os=!0:Array.isArray(as[0])&&(as[0][0]==="^"?(as[0][1]==="int"||Array.isArray(as[0][1])&&as[0][1][0]==="_"&&as[0][1][1]==="int")&&(os=!0):as[0][0]==="_"&&as[0][1]==="int"&&(os=!0)),os){as=Context.fromAst([is,...as]).tree.slice(1);let ls=as[1];if(Array.isArray(ls)&&ls[0]==="*"){let us=[];for(let cs=0;cs<ls.length-1;cs++)if(ls[cs]==="d"){let ds=ls[cs+1];ls.splice(cs,2),us.push(["d",ds]),cs--}ls.push(...us)}}return[is,...as]}else if(is==="angle"){let os=[];for(let ls of as)if(typeof ls=="string"&&!rs){let us=fromTextSplit(ls).tree;us[0]==="*"?os.push(...us.slice(1)):os.push(us)}else os.push(splitSymbolsIfMath({logicTree:ls,nonMathCodes:ts,foundNonMath:rs,init:!1}));return[is,...os]}else return[is,...as.map(os=>splitSymbolsIfMath({logicTree:os,nonMathCodes:ts,foundNonMath:rs,init:!1}))]}class BooleanComponent extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0},ts.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0},ts.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0},ts.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0},ts.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0},ts.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0},ts.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0},ts.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0},ts.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0},ts.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0},ts.caseInsensitiveMatch={createComponentOfType:"boolean",createStateVariable:"caseInsensitiveMatch",defaultValue:!1,public:!0},ts.matchBlanks={createComponentOfType:"boolean",createStateVariable:"matchBlanks",defaultValue:!1,public:!0},ts}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"comparableTypes",componentTypes:["math","mathList","number","numberList","text","textList","boolean","booleanList","orbitalDiagram"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]}}),definition:buildParsedExpression},ts.mathChildrenByCode={additionalStateVariablesDefined:["mathListChildrenByCode","numberChildrenByCode","numberListChildrenByCode","textChildrenByCode","textListChildrenByCode","booleanChildrenByCode","booleanListChildrenByCode","otherChildrenByCode"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"],variableNames:["value","texts","maths","numbers","booleans","fractionSatisfied","unordered"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is={},as={},os={},ls={},us={},cs={},ps={},ds={},fs={},hs=0,ys=rs.codePre;for(let gs of rs.allChildren)if(typeof gs!="string"){let bs=ys+hs;ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"math"})?is[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"mathList"})?as[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"number"})?os[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"numberList"})?ls[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"text"})?us[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"textList"})?cs[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"boolean"})?ps[bs]=gs:ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"booleanList"})?ds[bs]=gs:fs[bs]=gs,hs+=1}return{setValue:{mathChildrenByCode:is,mathListChildrenByCode:as,numberChildrenByCode:os,numberListChildrenByCode:ls,textChildrenByCode:us,textListChildrenByCode:cs,booleanChildrenByCode:ps,booleanListChildrenByCode:ds,otherChildrenByCode:fs}}}},ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean",attributesToShadow:["fixed"]},forRenderer:!0,hasEssential:!0,defaultValue:!1,set:Boolean,returnDependencies:()=>({symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"},caseInsensitiveMatch:{dependencyType:"stateVariable",variableName:"caseInsensitiveMatch"},matchBlanks:{dependencyType:"stateVariable",variableName:"matchBlanks"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"],variableNames:["value"],variablesOptional:!0},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},numberListChildrenByCode:{dependencyType:"stateVariable",variableName:"numberListChildrenByCode"},otherChildrenByCode:{dependencyType:"stateVariable",variableName:"otherChildrenByCode"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.allChildren.length===0)return{useEssentialOrDefaultValue:{value:!0}};if(rs.parsedExpression===null)return{setValue:{value:!1}};let is=ns.unorderedCompare;return{setValue:{value:evaluateLogic({logicTree:rs.parsedExpression.tree,canOverrideUnorderedCompare:is,dependencyValues:rs})===1}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns,componentInfoObjects:is}){if(ns.allChildren.length===0)return{success:!0,instructions:[{setEssentialValue:"value",value:!!rs.value}]};if(ns.allChildren.length===1){let as=ns.allChildren[0];if(typeof as=="string")return{success:!0,instructions:[{setDependency:"allChildren",desiredValue:rs.value.toString(),childIndex:0,variableIndex:0}]};if(is.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"boolean"}))return{success:!0,instructions:[{setDependency:"allChildren",desiredValue:rs.value,childIndex:0,variableIndex:0}]}}return{success:!1}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs}){return{setValue:{text:rs.value?"true":"false"}}},inverseDefinition({desiredStateVariableValues:rs}){let ns=String(rs.text).toLowerCase(),is;return ns==="true"?is=!0:ns==="false"&&(is=!1),is!==void 0?{success:!0,instructions:[{setDependency:"value",desiredValue:is}]}:{success:!1}}},ts}}Ms(BooleanComponent,"componentType","boolean"),Ms(BooleanComponent,"variableForPlainMacro","value"),Ms(BooleanComponent,"descendantCompositesMustHaveAReplacement",!0),Ms(BooleanComponent,"descendantCompositesDefaultReplacementType","math"),Ms(BooleanComponent,"adapters",["text"]);class BooleanOperator extends BooleanComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:ns.reduce(function(as,os){return typeof os=="string"?[...as,...os.split(/\s+/).filter(ls=>ls).map(ls=>({componentType:"boolean",children:[ls]}))]:[...as,os]},[])}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"booleans",componentTypes:["boolean"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();delete ts.parsedExpression,delete ts.mathChildrenByCode;let rs=this;return ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({booleanChildren:{dependencyType:"child",childGroups:["booleans"],variableNames:["value"]}}),definition:function({dependencyValues:ns}){return{setValue:{value:rs.applyBooleanOperator(ns.booleanChildren.map(is=>is.stateValues.value))}}}},ts}}Ms(BooleanOperator,"componentType","_booleanOperator"),Ms(BooleanOperator,"rendererType","boolean"),Ms(BooleanOperator,"descendantCompositesMustHaveAReplacement",!1);class BooleanOperatorOneInput extends BooleanComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=this;return renameStateVariable({stateVariableDefinitions:ts,oldName:"value",newName:"valuePreOperator"}),ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"valuePreOperator"}}),definition:function({dependencyValues:ns}){return{setValue:{value:rs.applyBooleanOperator(ns.value)}}}},ts}}Ms(BooleanOperatorOneInput,"componentType","_booleanOperatorOneInput"),Ms(BooleanOperatorOneInput,"rendererType","boolean");class Not extends BooleanOperatorOneInput{static applyBooleanOperator(ts){return!ts}}Ms(Not,"componentType","not");class And extends BooleanOperator{static applyBooleanOperator(ts){return ts.every(rs=>rs)}}Ms(And,"componentType","and");let Or$1=(cu=class extends BooleanOperator{static applyBooleanOperator(ts){return ts.some(rs=>rs)}},Ms(cu,"componentType","or"),cu);class Xor extends BooleanOperator{static applyBooleanOperator(ts){return ts.reduce((ns,is)=>ns+is,0)===1}}Ms(Xor,"componentType","xor");var BooleanOperators=Object.freeze({__proto__:null,And,Not,Or:Or$1,Xor});class BooleanBaseOperatorOfMath extends BooleanComponent{static returnSugarInstructions(){let ts=[],rs=function({matchedChildren:ns}){return ns.every(is=>typeof is=="string"||is.doenetAttributes&&is.doenetAttributes.createdFromMacro)?ns.length===1&&typeof ns[0]!="string"?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:ns}]}:{success:!1}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.parsedExpression,delete ts.mathChildrenByCode,ts.booleanOperator={returnDependencies:()=>({}),definition:()=>({setValue:{booleanOperator:rs=>!1}})},ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},booleanOperator:{dependencyType:"stateVariable",variableName:"booleanOperator"}}),definition:function({dependencyValues:rs}){return{setValue:{value:rs.booleanOperator(rs.mathChildren.map(ns=>ns.stateValues.value))}}}},ts}}Ms(BooleanBaseOperatorOfMath,"componentType","_booleanOperatorOfMath"),Ms(BooleanBaseOperatorOfMath,"rendererType","boolean");class IsInteger extends BooleanBaseOperatorOfMath{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.booleanOperator.definition=()=>({setValue:{booleanOperator:function(rs){if(rs.length===0)return!1;if(rs.length!==1)return console.warn("IsInteger requires exactly one math child"),null;let ns=rs[0].evaluate_to_constant();if(!Number.isFinite(ns))return!1;let is=Math.round(ns);return Math.abs(is-ns)<=1e-15*Math.abs(ns)}}}),ts}}Ms(IsInteger,"componentType","isInteger");class IsNumber extends BooleanBaseOperatorOfMath{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.booleanOperator.definition=()=>({setValue:{booleanOperator:function(rs){if(rs.length===0)return!1;if(rs.length!==1)return console.warn("IsNumber requires exactly one math child"),null;let ns=rs[0].evaluate_to_constant();return Number.isFinite(ns)}}}),ts}}Ms(IsNumber,"componentType","isNumber");class IsBetween extends BooleanBaseOperatorOfMath{static createAttributesObject(){let ts=super.createAttributesObject();return ts.limits={createComponentOfType:"numberList",createStateVariable:"limits",defaultValue:[],public:!0},ts.strict={createComponentOfType:"boolean",createStateVariable:"strict",defaultValue:!1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.booleanOperator={returnDependencies:()=>({limits:{dependencyType:"stateVariable",variableName:"limits"},strict:{dependencyType:"stateVariable",variableName:"strict"}}),definition({dependencyValues:rs}){let ns,is,as=rs.limits[0],os=rs.limits[1];if(as<os)is=as,ns=os;else if(os<as)is=os,ns=as;else return{setValue:{booleanOperator:()=>!1}};let ls=rs.strict;return{setValue:{booleanOperator:function(us){if(us.length===0)return!1;if(us.length!==1)return console.warn("IsBetween requires exactly one math child"),null;let cs=us[0].evaluate_to_constant();return ls?cs>is&&cs<ns:cs>=is&&cs<=ns}}}}},ts}}Ms(IsBetween,"componentType","isBetween");var BooleanOperatorsOfMath=Object.freeze({__proto__:null,IsBetween,IsInteger,IsNumber});class MathOperator extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},ts.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:ns.reduce(function(as,os){return typeof os=="string"?[...as,...os.split(/\s+/).filter(ls=>ls).map(ls=>({componentType:Number.isFinite(Number(ls))?"number":"math",children:[ls]}))]:[...as,os]},[])}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"numbers",componentTypes:["number"]},{group:"mathLists",componentTypes:["mathList"]},{group:"numberLists",componentTypes:["numberList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displayDigits"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.displayDigitsAttr!==null?{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}:rs.displayDecimalsAttr===null&&rs.mathLikeChildren.length===1&&!(ns.mathLikeChildren[0]&&ns.mathLikeChildren[0].displayDigits)?{setValue:{displayDigits:rs.mathLikeChildren[0].stateValues.displayDigits}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displayDecimals"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.displayDecimalsAttr!==null?{setValue:{displayDecimals:rs.displayDecimalsAttr.stateValues.value}}:rs.mathLikeChildren.length===1&&!(ns.mathLikeChildren[0]&&ns.mathLikeChildren[0].displayDecimals)?{setValue:{displayDecimals:rs.mathLikeChildren[0].stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displaySmallAsZero"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.displaySmallAsZeroAttr!==null?{setValue:{displaySmallAsZero:rs.displaySmallAsZeroAttr.stateValues.value}}:rs.mathLikeChildren.length===1&&!(ns.mathLikeChildren[0]&&ns.mathLikeChildren[0].displaySmallAsZero)?{setValue:{displaySmallAsZero:rs.mathLikeChildren[0].stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["padZeros"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.padZerosAttr!==null?{setValue:{padZeros:rs.padZerosAttr.stateValues.value}}:rs.mathLikeChildren.length===1&&!(ns.mathLikeChildren[0]&&ns.mathLikeChildren[0].padZeros)?{setValue:{padZeros:rs.mathLikeChildren[0].stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.isNumericOperator={returnDependencies:()=>({forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["isNumber"],variablesOptional:!0},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],variableNames:["maths"]}}),definition({dependencyValues:rs}){let ns;return rs.forceNumeric?ns=!0:rs.forceSymbolic?ns=!1:rs.mathChildren.length===0&&rs.mathListChildren.length===0?ns=!0:ns=rs.mathChildren.every(is=>is.stateValues.isNumber)&&rs.mathListChildren.every(is=>is.stateValues.maths.every(as=>Number.isFinite(as.tree))),{setValue:{isNumericOperator:ns}}}},delete ts.codePre,delete ts.expressionWithCodes,delete ts.mathChildrenFunctionSymbols,delete ts.codesAdjacentToStrings,delete ts.mathChildrenByVectorComponent,ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:rs=>Context.fromAst("")}})},ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:rs=>Context.fromAst("")}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:null}})},ts.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseNumericOperator:null}})},ts.unnormalizedValue={returnDependencies:()=>({mathNumberChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["value","maths","numbers","canBeModified"],variablesOptional:!0},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},numericOperator:{dependencyType:"stateVariable",variableName:"numericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){if(rs.mathNumberChildren.length===0)return{setValue:{unnormalizedValue:Context.fromAst("")}};if(rs.isNumericOperator){let is=[];for(let as of rs.mathNumberChildren)if(ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"number"}))is.push(as.stateValues.value);else if(ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"math"})){let os=as.stateValues.value.evaluate_to_constant();is.push(os)}else if(ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"numberList"}))is.push(...as.stateValues.numbers);else{let os=as.stateValues.maths.map(ls=>{let us=ls.evaluate_to_constant();return Number.isFinite(us)||(us=NaN),us});is.push(...os)}return{setValue:{unnormalizedValue:Context.fromAst(rs.numericOperator(is))}}}else{let is=[];for(let as of rs.mathNumberChildren)ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"number"})?is.push(Context.fromAst(as.stateValues.value)):ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"math"})?is.push(as.stateValues.value):ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"numberList"})?is.push(...as.stateValues.numbers.map(os=>Context.fromAst(os))):is.push(...as.stateValues.maths);return{setValue:{unnormalizedValue:rs.mathOperator(is)}}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns,componentInfoObjects:is}){if(ns.mathNumberChildren.length===0)return{success:!1};if(ns.isNumericOperator)if(ns.inverseNumericOperator){let as=[],os=[],ls=[];for(let[cs,ps]of ns.mathNumberChildren.entries())if(is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"number"}))as.push(ps.stateValues.value),os.push(ps.stateValues.canBeModified),ls.push(cs);else if(is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"math"})){let ds=ps.stateValues.value.evaluate_to_constant();as.push(ds),os.push(ps.stateValues.canBeModified),ls.push(cs)}else if(is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"numberList"}))as.push(...ps.stateValues.numbers),os.push(...Array(ps.stateValues.numbers.length).fill(ps.stateValues.canBeModified)),ps.stateValues.numbers.length===1?ls.push(cs):ls.push(...Array(ps.stateValues.numbers.length).fill(NaN));else{let ds=ps.stateValues.maths.map(fs=>fs.evaluate_to_constant());as.push(...ds),os.push(...Array(ps.stateValues.maths.length).fill(ps.stateValues.canBeModified)),ps.stateValues.maths.length===1?ls.push(cs):ls.push(...Array(ps.stateValues.maths.length).fill(NaN))}let us=ns.inverseNumericOperator({desiredValue:rs.unnormalizedValue.evaluate_to_constant(),inputs:as,canBeModified:os,desiredMathValue:rs.unnormalizedValue});if(us.success){let cs=ls[us.inputNumber];if(Number.isFinite(cs)){let ps=us.inputValue,ds=0,fs=ns.mathNumberChildren[cs];return is.isInheritedComponentType({inheritedComponentType:fs.componentType,baseComponentType:"numberList"})?(ds=2,ps={0:ps}):is.isInheritedComponentType({inheritedComponentType:fs.componentType,baseComponentType:"mathList"})&&(ds=1,ps={0:ps}),{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:ps,childIndex:cs,variableIndex:ds}]}}else return{success:!1}}else return{success:!1}}else return{success:!1};else if(ns.inverseMathOperator){let as=[],os=[],ls=[];for(let[cs,ps]of ns.mathNumberChildren.entries())is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"number"})?(as.push(Context.fromAst(ps.stateValues.value)),os.push(ps.stateValues.canBeModified),ls.push(cs)):is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"math"})?(as.push(ps.stateValues.value),os.push(ps.stateValues.canBeModified),ls.push(cs)):is.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"numberList"})?(as.push(...ps.stateValues.numbers.map(ds=>Context.fromAst(ds))),os.push(...Array(ps.stateValues.numbers.length).fill(ps.stateValues.canBeModified)),ps.stateValues.numbers.length===1?ls.push(cs):ls.push(...Array(ps.stateValues.numbers.length).fill(NaN))):(as.push(...ps.stateValues.maths),os.push(...Array(ps.stateValues.maths.length).fill(ps.stateValues.canBeModified)),ps.stateValues.maths.length===1?ls.push(cs):ls.push(...Array(ps.stateValues.maths.length).fill(NaN)));let us=ns.inverseMathOperator({desiredValue:rs.unnormalizedValue,inputs:as,canBeModified:os});if(us.success){let cs=ls[us.inputNumber];if(Number.isFinite(cs)){let ps=us.inputValue,ds=0,fs=ns.mathNumberChildren[cs];return is.isInheritedComponentType({inheritedComponentType:fs.componentType,baseComponentType:"numberList"})?(ds=2,ps={0:ps}):is.isInheritedComponentType({inheritedComponentType:fs.componentType,baseComponentType:"mathList"})&&(ds=1,ps={0:ps}),{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:ps,childIndex:cs,variableIndex:ds}]}}else return{success:!1}}else return{success:!1}}else return{success:!1}}},ts.canBeModified={returnDependencies:()=>({modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},mathNumberChildren:{dependencyType:"child",childGroups:["maths","numbers"],variableNames:["canBeModified"]},mathNumberListChildren:{dependencyType:"child",childGroups:["mathLists","numberLists"],variableNames:["nComponents"]},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:rs}){let ns=rs.modifyIndirectly&&!rs.fixed&&!!(rs.isNumericOperator?rs.inverseNumericOperator:rs.inverseMathOperator);return ns&&rs.mathNumberChildren.length+rs.mathNumberListChildren.length>0&&rs.mathNumberChildren.filter(as=>as.stateValues.canBeModified).length+rs.mathNumberListChildren.reduce((as,os)=>as+os.stateValues.nComponents,0)!==1&&(ns=!1),{setValue:{canBeModified:ns}}}},ts}}Ms(MathOperator,"componentType","_mathOperator"),Ms(MathOperator,"rendererType","math"),Ms(MathOperator,"descendantCompositesMustHaveAReplacement",!1);class MathOperatorOneInput extends MathComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:rs=>me.fromAst("")}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:null}})},renameStateVariable({stateVariableDefinitions:ts,oldName:"unnormalizedValue",newName:"unnormalizedValuePreOperator"}),ts.unnormalizedValue={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"unnormalizedValuePreOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"}}),definition:function({dependencyValues:rs}){return{setValue:{unnormalizedValue:rs.mathOperator(rs.value)}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns,componentName:is}){return ns.inverseMathOperator?{success:!0,instructions:[{setDependency:"value",desiredValue:ns.inverseMathOperator(rs.unnormalizedValue)}]}:{success:!1}}},renameStateVariable({stateVariableDefinitions:ts,oldName:"canBeModified",newName:"canBeModifiedPreOperator"}),ts.canBeModified={returnDependencies:()=>({canBeModifiedPreOperator:{dependencyType:"stateVariable",variableName:"canBeModifiedPreOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"}}),definition:function({dependencyValues:rs}){let ns=rs.canBeModifiedPreOperator;return rs.inverseMathOperator||(ns=!1),{setValue:{canBeModified:ns}}}},ts}}Ms(MathOperatorOneInput,"componentType","_mathOperatorOneInput"),Ms(MathOperatorOneInput,"rendererType","math");class Sum extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.reduce((ns,is)=>ns+is)}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return rs.reduce((ns,is)=>ns.add(is))}}})},ts}}Ms(Sum,"componentType","sum");class Product extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.reduce((ns,is)=>ns*is)}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return rs.reduce((ns,is)=>ns.multiply(is))}}})},ts}}Ms(Product,"componentType","product");class ClampNumber extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return ts.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},ts.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},ts.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){return clamp({value:ns,lowerValue:rs.lowerValue,upperValue:rs.upperValue})}}})},ts.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:rs})=>({setValue:{inverseMathOperator:function(ns){return clamp({value:ns,lowerValue:rs.lowerValue,upperValue:rs.upperValue})}}})},ts}}Ms(ClampNumber,"componentType","clampNumber");function clamp({value:ss,lowerValue:ts,upperValue:rs}){let ns=ss;return ns instanceof Context.class&&(ns=ns.evaluate_to_constant()),Context.fromAst(Math.max(ts,Math.min(rs,ns)))}class WrapNumberPeriodic extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return ts.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},ts.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},ts.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){return makePeriodic({value:ns,lowerValue:rs.lowerValue,upperValue:rs.upperValue})}}})},ts.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:rs})=>({setValue:{inverseMathOperator:function(ns){return makePeriodic({value:ns,lowerValue:rs.lowerValue,upperValue:rs.upperValue})}}})},ts}}Ms(WrapNumberPeriodic,"componentType","wrapNumberPeriodic");function makePeriodic({value:ss,lowerValue:ts,upperValue:rs}){let ns=ss;return ns instanceof Context.class&&(ns=ns.evaluate_to_constant()),Number.isFinite(ns)?ts===rs?Context.fromAst(ts):(ts>rs&&([rs,ts]=[ts,rs]),Context.fromAst(ts+Context.math.mod(ns-ts,rs-ts))):Context.fromAst(NaN)}class Round extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return ts.numberDecimals={createComponentOfType:"number",createStateVariable:"numberDecimals",defaultValue:0,public:!0},ts.numberDigits={createComponentOfType:"number",createStateVariable:"numberDigits",defaultValue:null,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({numberDecimals:{dependencyType:"stateVariable",variableName:"numberDecimals"},numberDigits:{dependencyType:"stateVariable",variableName:"numberDigits"}}),definition:({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){let is=ns.evaluate_numbers({max_digits:1/0,evaluate_functions:!0});return rs.numberDigits!==null?is.round_numbers_to_precision(rs.numberDigits):is.round_numbers_to_decimals(rs.numberDecimals)}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:rs=>rs}})},ts}}Ms(Round,"componentType","round");class setSmallToZero extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return ts.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:1e-14,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){return ns.evaluate_numbers({skip_ordering:!0,set_small_zero:rs.threshold})}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:rs=>rs}})},ts}}Ms(setSmallToZero,"componentType","setSmallToZero");class ConvertSetToList extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.unordered,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.unordered={returnDependencies:()=>({}),definition:()=>({setValue:{unordered:!0}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){if(rs!==void 0&&Array.isArray(rs.tree)&&rs.tree[0]==="set"){let ns=[];for(let is of rs.tree.slice(1))ns.some(as=>rs.context.equalsViaSyntax(rs.context.fromAst(as),rs.context.fromAst(is)))||ns.push(is);return rs.context.fromAst(["list",...ns])}return rs}}})},ts}}Ms(ConvertSetToList,"componentType","convertSetToList");class Ceil extends MathOperatorOneInput{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){let ns=rs.evaluate_to_constant();if(!Number.isFinite(ns))return Context.fromAst(["apply","ceil",rs.tree]);let is=Math.round(ns);return Math.abs((is-ns)/ns)<1e-15?Context.fromAst(is):Context.fromAst(Math.ceil(ns))}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:rs=>rs}})},ts}}Ms(Ceil,"componentType","ceil");class Floor extends MathOperatorOneInput{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){let ns=rs.evaluate_to_constant();if(!Number.isFinite(ns))return Context.fromAst(["apply","floor",rs.tree]);let is=Math.round(ns);return Math.abs((is-ns)/ns)<1e-15?Context.fromAst(is):Context.fromAst(Math.floor(ns))}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:rs=>rs}})},ts}}Ms(Floor,"componentType","floor");class Abs extends MathOperatorOneInput{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){let ns=rs.evaluate_to_constant();return Number.isFinite(ns)?Context.fromAst(Math.abs(ns)):Context.fromAst(["apply","abs",rs.tree])}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:function(rs){let ns=rs,is=rs.evaluate_to_constant();return Number.isFinite(is)?is<0&&(ns=Context.fromAst(0)):Array.isArray(rs.tree)&&rs.tree[0]==="apply"&&rs.tree[1]==="abs"&&(ns=Context.fromAst(rs.tree[2])),ns}}})},ts}}Ms(Abs,"componentType","abs");class Sign extends MathOperatorOneInput{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){let ns=rs.evaluate_to_constant();return Number.isFinite(ns)?Context.fromAst(Math.sign(ns)):Context.fromAst(["apply","sign",rs.tree])}}})},ts}}Ms(Sign,"componentType","sign");class Mean extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){let ns=rs.reduce((is,as)=>is+as);return ns/=rs.length,ns}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return rs.reduce((ns,is)=>ns.add(is)).divide(rs.length)}}})},ts}}Ms(Mean,"componentType","mean");class Variance extends MathOperator{static createAttributesObject(){let ts=super.createAttributesObject();return ts.population={createComponentOfType:"boolean",createStateVariable:"population",defaultValue:!1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:rs})=>({setValue:{numericOperator:function(ns){return calculateNumericVariance(ns,rs.population)}}})},ts.mathOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){return calculateSymbolicVariance(ns,rs.population)}}})},ts}}Ms(Variance,"componentType","variance");function calculateNumericVariance(ss,ts){let rs=0,ns=0;for(let as of ss)rs+=as,ns+=as*as;let is=ss.length;return ns-=rs**2/is,ts?ns/=is:ns/=is-1,ns}function calculateSymbolicVariance(ss,ts){let rs=ss.length,ns=ss.reduce((as,os)=>as.add(os)),is=ss.slice(1).reduce((as,os)=>as.add(os.pow(2)),ss[0].pow(2)).subtract(ns.pow(2).divide(rs));return ts?is=is.divide(rs):is=is.divide(rs-1),is}class StandardDeviation extends Variance{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator.definition=({dependencyValues:rs})=>({setValue:{numericOperator:function(ns){return Math.sqrt(calculateNumericVariance(ns,rs.population))}}}),ts.mathOperator.definition=({dependencyValues:rs})=>({setValue:{mathOperator:function(ns){return Context.fromAst(["apply","sqrt",calculateSymbolicVariance(ns,rs.population).tree])}}}),ts}}Ms(StandardDeviation,"componentType","standardDeviation");class Count extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.length}}})},ts}}Ms(Count,"componentType","count");class Min extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.reduce((ns,is)=>Math.min(ns,is),1/0)}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return Context.fromAst(["apply","min",["tuple",...rs.map(ns=>ns.tree)]])}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:function({desiredValue:rs,canBeModified:ns}){if(ns.filter(is=>is).length===1){let is=ns.indexOf(!0);if(is>=0)return{success:!0,inputValue:rs,inputNumber:is}}return{success:!1}}}})},ts.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseNumericOperator:function({desiredValue:rs,canBeModified:ns,desiredMathValue:is}){if(ns.filter(as=>as).length===1){let as=ns.indexOf(!0);if(as>=0)return Number.isFinite(rs)||(rs=is),{success:!0,inputValue:rs,inputNumber:as}}return{success:!1}}}})},ts}}Ms(Min,"componentType","min");class Max extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.reduce((ns,is)=>Math.max(ns,is),-1/0)}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return Context.fromAst(["apply","max",["tuple",...rs.map(ns=>ns.tree)]])}}})},ts.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:function({desiredValue:rs,canBeModified:ns}){if(ns.filter(is=>is).length===1){let is=ns.indexOf(!0);if(is>=0)return{success:!0,inputValue:rs,inputNumber:is}}return{success:!1}}}})},ts.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseNumericOperator:function({desiredValue:rs,canBeModified:ns,desiredMathValue:is}){if(ns.filter(as=>as).length===1){let as=ns.indexOf(!0);if(as>=0)return Number.isFinite(rs)||(rs=is),{success:!0,inputValue:rs,inputNumber:as}}return{success:!1}}}})},ts}}Ms(Max,"componentType","max");class Mod extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.length!==2?NaN:Context.math.mod(rs[0],rs[1])}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return rs.length!==2?Context.fromAst(""):Context.fromAst(["apply","mod",["tuple",...rs.map(ns=>ns.tree)]])}}})},ts}}Ms(Mod,"componentType","mod");class Gcd extends MathOperator{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(rs){return rs.every(Number.isInteger)?gcd(...rs):NaN}}})},ts.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(rs){return Context.fromAst(["apply","gcd",["tuple",...rs.map(ns=>ns.tree)]])}}})},ts}}Ms(Gcd,"componentType","gcd");class ExtractMath extends MathOperatorOneInput{static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:null,toLowerCase:!0,validValues:["operand","function","functionargument","numberofoperands"]},ts.operandNumber={createComponentOfType:"number",createStateVariable:"operandNumber",defaultValue:null,public:!0},ts.argumentNumber={createComponentOfType:"number",createStateVariable:"argumentNumber",defaultValue:null,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.mathOperator={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},operandNumber:{dependencyType:"stateVariable",variableName:"operandNumber"},argumentNumber:{dependencyType:"stateVariable",variableName:"argumentNumber"}}),definition({dependencyValues:rs}){return rs.type==="operand"?rs.operandNumber===null?(console.warn("Must specify a operandNumber when extracting a math operand"),{setValue:{mathOperator:ns=>Context.fromAst("")}}):{setValue:{mathOperator:function(ns){let is=ns.tree;if(!Array.isArray(is)||is[0]==="apply")return rs.operandNumber===1?ns:Context.fromAst("");let os=is[rs.operandNumber];return os===void 0?Context.fromAst(""):Context.fromAst(os)}}}:rs.type==="function"?{setValue:{mathOperator:function(ns){let is=ns.tree;return!Array.isArray(is)||is[0]!=="apply"?Context.fromAst(""):Context.fromAst(is[1])}}}:rs.type==="functionargument"?{setValue:{mathOperator:function(ns){let is=ns.tree;if(!Array.isArray(is)||is[0]!=="apply")return Context.fromAst("");let os=is[2];if(rs.argumentNumber===null)return Context.fromAst(os);if(rs.argumentNumber===1)return Array.isArray(os)&&os[0]==="tuple"?Context.fromAst(os[1]):Context.fromAst(os);if(Array.isArray(os)&&os[0]==="tuple"){let ls=os[rs.argumentNumber];return ls===void 0?Context.fromAst(""):Context.fromAst(ls)}else return Context.fromAst("")}}}:rs.type==="numberofoperands"?{setValue:{mathOperator:function(ns){let is=ns.tree;return!Array.isArray(is)||is[0]==="apply"?Context.fromAst(1):Context.fromAst(is.length-1)}}}:{setValue:{mathOperator:ns=>Context.fromAst("_")}}}},ts}}Ms(ExtractMath,"componentType","extractMath");function gcd(ss,ts,...rs){return!ts&&rs.length>0?gcd(ss,...rs):ts?gcd(ts,ss%ts,...rs):ss}var MathOperators=Object.freeze({__proto__:null,Abs,Ceil,ClampNumber,ConvertSetToList,Count,ExtractMath,Floor,Gcd,Max,Mean,Min,Mod,Product,Round,Sign,StandardDeviation,Sum,Variance,WrapNumberPeriodic,setSmallToZero});function returnLabelStateVariableDefinitions(){let ss={};return ss.componentNameAndShadowSourceNames={returnDependencies:()=>({shadowSource:{dependencyType:"shadowSource",variableNames:["componentNameAndShadowSourceNames"]},unlinkedCopySource:{dependencyType:"unlinkedCopySource",variableNames:["componentNameAndShadowSourceNames"]}}),definition({dependencyValues:ts,componentName:rs}){var is,as;let ns=[rs];return(is=ts.shadowSource)!=null&&is.stateValues.componentNameAndShadowSourceNames?ns.push(...ts.shadowSource.stateValues.componentNameAndShadowSourceNames):(as=ts.unlinkedCopySource)!=null&&as.stateValues.componentNameAndShadowSourceNames&&ns.push(...ts.unlinkedCopySource.stateValues.componentNameAndShadowSourceNames),{setValue:{componentNameAndShadowSourceNames:ns}}}},ss.label={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"label",addStateVariablesShadowingStateVariables:{hasLatex:{stateVariableToShadow:"labelHasLatex"}}},hasEssential:!0,doNotShadowEssential:!0,defaultValue:"",provideEssentialValuesInDefinition:!0,additionalStateVariablesDefined:[{variableName:"labelHasLatex",forRenderer:!0}],returnDependencies:()=>({labelChild:{dependencyType:"child",childGroups:["labels"],variableNames:["value","hasLatex"]},labelIsName:{dependencyType:"stateVariable",variableName:"labelIsName"},labelIsNameAttr:{dependencyType:"attributeComponent",attributeName:"labelIsName"},componentNameAndShadowSourceNames:{dependencyType:"stateVariable",variableName:"componentNameAndShadowSourceNames"},shadowSource:{dependencyType:"shadowSource",variableNames:["label","labelHasLatex"]}}),definition({dependencyValues:ts,essentialValues:rs}){var is;let ns=ts.labelChild[ts.labelChild.length-1];if(ns&&!ns.shadowDepth)return{setValue:{label:ns.stateValues.value,labelHasLatex:ns.stateValues.hasLatex}};if(rs.label!==void 0)return{useEssentialOrDefaultValue:{label:!0},setValue:{labelHasLatex:!1}};if(ts.labelIsName&&!ts.labelIsNameAttr.shadowDepth){let as="__",os=ts.componentNameAndShadowSourceNames;for(let ls of os){let us=ls.lastIndexOf("/");if(as=ls.substring(us+1),as.slice(0,2)!=="__")break}return as.slice(0,2)==="__"?{setValue:{label:"",labelHasLatex:!1}}:(as[0]!=="_"&&(as.includes("_")||as.includes("-")?as=as.replace(/[_\-]/g," "):as.match(/^[a-z]/)?as.match(/[A-Z]/)&&(as=as.replace(/([A-Z])/g," $1").toLowerCase()):as.match(/^[A-Z]/)&&as.match(/[a-z]/)&&(as=as.replace(/([A-Z])/g," $1"),as=as.slice(1))),{setValue:{label:as,labelHasLatex:!1}})}else return typeof((is=ts.shadowSource)==null?void 0:is.stateValues.label)=="string"?{setValue:{label:ts.shadowSource.stateValues.label,labelHasLatex:!!ts.shadowSource.stateValues.labelHasLatex}}:{useEssentialOrDefaultValue:{label:!0},setValue:{labelHasLatex:!1}}},inverseDefinition({desiredStateVariableValues:ts,dependencyValues:rs}){var as;if(typeof ts.label!="string")return{success:!1};let ns=rs.labelChild.length-1,is=rs.labelChild[ns];return is&&!is.shadowDepth?{success:!0,instructions:[{setDependency:"labelChild",desiredValue:ts.label,childIndex:ns,variableIndex:0}]}:rs.labelIsName&&!rs.labelIsNameAttr.shadowDepth?{success:!0,instructions:[{setEssentialValue:"label",value:ts.label}]}:typeof((as=rs.shadowSource)==null?void 0:as.stateValues.label)=="string"?{success:!0,instructions:[{setDependency:"shadowSource",desiredValue:ts.label,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"label",value:ts.label}]}}},ss.labelForGraph={forRenderer:!0,returnDependencies:()=>({label:{dependencyType:"stateVariable",variableName:"label"},labelHasLatex:{dependencyType:"stateVariable",variableName:"labelHasLatex"}}),definition({dependencyValues:ts}){let rs;if(ts.labelHasLatex){let ns=0;rs="";for(let is of ts.label)is==="("?ns++:is===")"?ns--:ns===0&&(is==="_"?is="&UnderBar;":is==="^"&&(is="&Hat;")),rs+=is}else rs=ts.label.replaceAll("_","&UnderBar;").replaceAll("^","&Hat;");return{setValue:{labelForGraph:rs}}}},ss}class GraphicalComponent extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},ts.applyStyleToLabel={createComponentOfType:"boolean",createStateVariable:"applyStyleToLabel",defaultValue:!1,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"integer",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0,attributesForCreatedComponent:{valueOnNaN:0}},ts}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();Object.assign(ts,rs);let ns=returnLabelStateVariableDefinitions();return Object.assign(ts,ns),ts}}Ms(GraphicalComponent,"componentType","_graphical");function returnNumericalFunctionFromFormula({formula:ss,nInputs:ts,variables:rs,domain:ns,component:is=0}){if(is=Number(is),Array.isArray(ss.tree)&&vectorOperators.includes(ss.tree[0]))try{ss=ss.get_component(is)}catch{return()=>NaN}else if(is!==0)return()=>NaN;let os;try{os=ss.subscripts_to_strings().f()}catch{return()=>NaN}if(ts===1){let ds=rs[0].subscripts_to_strings().tree,fs=-1/0,hs=1/0,ys=!1,gs=!1;if(ns!==null){let bs=ns[0];bs!==void 0&&(fs=Context.fromAst(bs.tree[1][1]).evaluate_to_constant(),typeof fs!="number"||Number.isNaN(fs)?fs=-1/0:ys=!bs.tree[2][1],hs=Context.fromAst(bs.tree[1][2]).evaluate_to_constant(),typeof hs!="number"||Number.isNaN(hs)?hs=1/0:gs=!bs.tree[2][2])}return function(bs,vs=!1){if(vs){if(isNaN(bs))return NaN}else if(!(bs>=fs)||!(bs<=hs)||ys&&bs===fs||gs&&bs===hs)return NaN;try{return os({[ds]:bs})}catch{return NaN}}}let ls=[];for(let ds=0;ds<ts;ds++)ls.push(rs[ds].subscripts_to_strings().tree);let us=!1,cs=[],ps=[];if(ns!==null){us=!0;for(let ds=0;ds<ts;ds++){let fs=ns[ds];if(!fs){us=!1;break}let hs=-1/0,ys=1/0,gs=!1,bs=!1;hs=Context.fromAst(fs.tree[1][1]).evaluate_to_constant(),typeof hs!="number"||Number.isNaN(hs)?hs=-1/0:gs=!fs.tree[2][1],ys=Context.fromAst(fs.tree[1][2]).evaluate_to_constant(),typeof ys!="number"||Number.isNaN(ys)?ys=1/0:bs=!fs.tree[2][2],cs.push([hs,ys]),ps.push([gs,bs])}}return function(...ds){let fs={};for(let hs=0;hs<ts;hs++){let ys=ds[hs];if(isNaN(ys))return NaN;if(us){let[gs,bs]=cs[hs],[vs,Ns]=ps[hs];if(!(ys>=gs)||!(ys<=bs)||vs&&ys===gs||Ns&&ys===bs)return NaN}fs[ls[hs]]=ys}try{return os(fs)}catch{return NaN}}}function returnNumericalFunctionFromReevaluatedFormula({formulaExpressionWithCodes:ss,evaluateChildrenToReevaluate:ts,nInputs:rs,variables:ns,domain:is,component:as=0}){if(as=Number(as),Array.isArray(ss.tree)&&vectorOperators.includes(ss.tree[0]))try{ss=ss.get_component(Number(as))}catch{return()=>NaN}else if(as!==0)return()=>NaN;let ls;try{ls=ss.subscripts_to_strings().f()}catch{return()=>NaN}if(rs===1){let fs=ns[0].subscripts_to_strings().tree,hs=-1/0,ys=1/0,gs=!1,bs=!1;if(is!==null){let vs=is[0];vs!==void 0&&(hs=Context.fromAst(vs.tree[1][1]).evaluate_to_constant(),typeof hs!="number"||Number.isNaN(hs)?hs=-1/0:gs=!vs.tree[2][1],ys=Context.fromAst(vs.tree[1][2]).evaluate_to_constant(),typeof ys!="number"||Number.isNaN(ys)?ys=1/0:bs=!vs.tree[2][2])}return function(vs,Ns=!1){if(Ns){if(isNaN(vs))return NaN}else if(!(vs>=hs)||!(vs<=ys)||gs&&vs===hs||bs&&vs===ys)return NaN;let Ts={[fs]:vs},Cs={[fs]:vs};for(let xs in ts){let As=ts[xs].fReevaluate,ws=ts[xs].inputMathFs;try{let Es=ws.map(Ss=>Context.fromAst(Ss(Ts)));Cs[xs]=As(Es).evaluate_to_constant()}catch{return NaN}}try{return ls(Cs)}catch{return NaN}}}let us=[];for(let fs=0;fs<rs;fs++)us.push(ns[fs].subscripts_to_strings().tree);let cs=!1,ps=[],ds=[];if(is!==null){cs=!0;for(let fs=0;fs<rs;fs++){let hs=is[fs];if(!hs){cs=!1;break}let ys=-1/0,gs=1/0,bs=!1,vs=!1;ys=Context.fromAst(hs.tree[1][1]).evaluate_to_constant(),typeof ys!="number"||Number.isNaN(ys)?ys=-1/0:bs=!hs.tree[2][1],gs=Context.fromAst(hs.tree[1][2]).evaluate_to_constant(),typeof gs!="number"||Number.isNaN(gs)?gs=1/0:vs=!hs.tree[2][2],ps.push([ys,gs]),ds.push([bs,vs])}}return function(...fs){let hs={};for(let gs=0;gs<rs;gs++){let bs=fs[gs];if(isNaN(bs))return NaN;if(cs){let[vs,Ns]=ps[gs],[Ts,Cs]=ds[gs];if(!(bs>=vs)||!(bs<=Ns)||Ts&&bs===vs||Cs&&bs===Ns)return NaN}hs[us[gs]]=bs}let ys={...hs};for(let gs in ts){let bs=ts[gs].fReevaluate,vs=ts[gs].inputMathFs;try{let Ns=vs.map(Ts=>Context.fromAst(Ts(ys)));hs[gs]=bs(Ns).evaluate_to_constant()}catch{return NaN}}try{return ls(hs)}catch{return NaN}}}function returnPiecewiseNumericalFunctionFromChildren({numericalFsOfChildren:ss,numericalDomainsOfChildren:ts,domain:rs,component:ns=0}){if(ns=Number(ns),ns!==0)return()=>NaN;let is=-1/0,as=1/0,os=!1,ls=!1;if(rs!==null){let us=rs[0];us!==void 0&&(is=Context.fromAst(us.tree[1][1]).evaluate_to_constant(),typeof is!="number"||Number.isNaN(is)?is=-1/0:os=!us.tree[2][1],as=Context.fromAst(us.tree[1][2]).evaluate_to_constant(),typeof as!="number"||Number.isNaN(as)?as=1/0:ls=!us.tree[2][2])}return function(us,cs=!1){if(cs){if(isNaN(us))return NaN}else if(!(us>=is)||!(us<=as)||os&&us===is||ls&&us===as)return NaN;for(let[ps,ds]of ts.entries()){let fs=ds[0][0],hs=ds[0][1],ys=ds[1][0],gs=ds[1][1];if((us>fs||ys&&us===fs)&&(us<hs||gs&&us===hs))return ss[ps](us)}return NaN}}function returnSymbolicFunctionFromFormula({formula:ss,simplify:ts,expand:rs,domain:ns,nInputs:is,variables:as,component:os=0}){if(os=Number(os),Array.isArray(ss.tree)&&vectorOperators.includes(ss.tree[0]))try{ss=ss.get_component(os)}catch{return()=>Context.fromAst("")}else if(os!==0)return()=>Context.fromAst("");let us=ss.subscripts_to_strings();if(is===1){let hs=as[0].subscripts_to_strings().tree,ys=-1/0,gs=1/0,bs=!1,vs=!1;if(ns!==null){let Ns=ns[0];Ns!==void 0&&(ys=Context.fromAst(Ns.tree[1][1]).evaluate_to_constant(),typeof ys!="number"||Number.isNaN(ys)?ys=-1/0:bs=!Ns.tree[2][1],gs=Context.fromAst(Ns.tree[1][2]).evaluate_to_constant(),typeof gs!="number"||Number.isNaN(gs)?gs=1/0:vs=!Ns.tree[2][2])}return function(Ns,Ts=!1){if(!Ts){let Cs=Ns.evaluate_to_constant();if(!Number.isNaN(Cs)&&(!(Cs>=ys)||!(Cs<=gs)||bs&&Cs===ys||vs&&Cs===gs))return Context.fromAst("")}return normalizeMathExpression({value:us.substitute({[hs]:Ns}).strings_to_subscripts(),simplify:ts,expand:rs})}}let cs=[];for(let hs=0;hs<is;hs++)cs.push(as[hs].subscripts_to_strings().tree);let ps=!1,ds=[],fs=[];if(ns!==null){ps=!0;for(let hs=0;hs<is;hs++){let ys=ns[hs];if(!ys){ps=!1;break}let gs=-1/0,bs=1/0,vs=!1,Ns=!1;gs=Context.fromAst(ys.tree[1][1]).evaluate_to_constant(),typeof gs!="number"||Number.isNaN(gs)?gs=-1/0:vs=!ys.tree[2][1],bs=Context.fromAst(ys.tree[1][2]).evaluate_to_constant(),typeof bs!="number"||Number.isNaN(bs)?bs=1/0:Ns=!ys.tree[2][2],ds.push([gs,bs]),fs.push([vs,Ns])}}return function(...hs){let ys={},gs=!1,bs=!0;for(let vs=0;vs<is;vs++){let Ns=hs[vs];if(ps&&bs){let Ts=Ns.evaluate_to_constant();if(Number.isNaN(Ts))bs=!1;else{let[Cs,xs]=ds[vs],[As,ws]=fs[vs];(!(Ts>=Cs)||!(Ts<=xs)||As&&Ts===Cs||ws&&Ts===xs)&&(gs=!0)}}ys[cs[vs]]=Ns}return bs&&gs?Context.fromAst(""):normalizeMathExpression({value:us.substitute(ys).strings_to_subscripts(),simplify:ts,expand:rs})}}function returnSymbolicFunctionFromReevaluatedFormula({formulaExpressionWithCodes:ss,evaluateChildrenToReevaluate:ts,simplify:rs,expand:ns,nInputs:is,variables:as,domain:os,component:ls=0}){if(ls=Number(ls),Array.isArray(ss.tree)&&vectorOperators.includes(ss.tree[0]))try{ss=ss.get_component(ls)}catch{return()=>Context.fromAst("")}else if(ls!==0)return()=>Context.fromAst("");let cs=ss.subscripts_to_strings();if(is===1){let ys=as[0].subscripts_to_strings().tree,gs=-1/0,bs=1/0,vs=!1,Ns=!1;if(os!==null){let Ts=os[0];Ts!==void 0&&(gs=Context.fromAst(Ts.tree[1][1]).evaluate_to_constant(),typeof gs!="number"||Number.isNaN(gs)?gs=-1/0:vs=!Ts.tree[2][1],bs=Context.fromAst(Ts.tree[1][2]).evaluate_to_constant(),typeof bs!="number"||Number.isNaN(bs)?bs=1/0:Ns=!Ts.tree[2][2])}return function(Ts,Cs=!1){if(!Cs){let ws=Ts.evaluate_to_constant();if(!Number.isNaN(ws)&&(!(ws>=gs)||!(ws<=bs)||vs&&ws===gs||Ns&&ws===bs))return Context.fromAst("")}let xs={[ys]:Ts.tree},As={[ys]:Ts};for(let ws in ts){let Es=ts[ws].fReevaluate,Ss=ts[ws].inputMathFs;try{let Ds=Ss.map(Vs=>Context.fromAst(Vs(xs)));As[ws]=Es(Ds)}catch{return NaN}}return normalizeMathExpression({value:cs.substitute(As).strings_to_subscripts(),simplify:rs,expand:ns})}}let ps=[];for(let ys=0;ys<is;ys++)ps.push(as[ys].subscripts_to_strings().tree);let ds=!1,fs=[],hs=[];if(os!==null){ds=!0;for(let ys=0;ys<is;ys++){let gs=os[ys];if(!gs){ds=!1;break}let bs=-1/0,vs=1/0,Ns=!1,Ts=!1;bs=Context.fromAst(gs.tree[1][1]).evaluate_to_constant(),typeof bs!="number"||Number.isNaN(bs)?bs=-1/0:Ns=!gs.tree[2][1],vs=Context.fromAst(gs.tree[1][2]).evaluate_to_constant(),typeof vs!="number"||Number.isNaN(vs)?vs=1/0:Ts=!gs.tree[2][2],fs.push([bs,vs]),hs.push([Ns,Ts])}}return function(...ys){let gs={},bs={},vs=!1,Ns=!0;for(let Ts=0;Ts<is;Ts++){let Cs=ys[Ts];if(ds&&Ns){let xs=Cs.evaluate_to_constant();if(Number.isNaN(xs))Ns=!1;else{let[As,ws]=fs[Ts],[Es,Ss]=hs[Ts];(!(xs>=As)||!(xs<=ws)||Es&&xs===As||Ss&&xs===ws)&&(vs=!0)}}gs[ps[Ts]]=Cs,bs[ps[Ts]]=Cs.tree}if(Ns&&vs)return Context.fromAst("");for(let Ts in ts){let Cs=ts[Ts].fReevaluate,xs=ts[Ts].inputMathFs;try{let As=xs.map(ws=>Context.fromAst(ws(bs)));gs[Ts]=Cs(As)}catch{return NaN}}return normalizeMathExpression({value:cs.substitute(gs).strings_to_subscripts(),simplify:rs,expand:ns})}}function returnSymbolicFunctionForEvaluate({symbolicfs:ss,nInputs:ts}){return function(rs){if(rs.length===1){let as=rs[0].tree;Array.isArray(as)&&vectorOperators.includes(as[0])&&(rs=as.slice(1).map(os=>Context.fromAst(os)))}if(rs.length!==ts)return Context.fromAst("");let ns=ss.map(as=>as(...rs).tree),is;return ns.length===1?is=Context.fromAst(ns[0]):is=Context.fromAst(["vector",...ns]),is}}function returnNumericFunctionForEvaluate({numericalfs:ss,nInputs:ts}){return function(rs){if(rs.length===1){let os=rs[0].tree;Array.isArray(os)&&vectorOperators.includes(os[0])&&(rs=os.slice(1).map(ls=>Context.fromAst(ls)))}if(rs.length!==ts)return Context.fromAst("");let ns=rs.map(os=>os.evaluate_to_constant()),is=ss.map(os=>os(...ns)),as;return is.length===1?as=Context.fromAst(is[0]):as=Context.fromAst(["vector",...is]),as}}function returnBezierFunctions({nThroughPoints:ss,numericalThroughPoints:ts,splineCoeffs:rs,extrapolateForward:ns,extrapolateForwardCoeffs:is,extrapolateBackward:as,extrapolateBackwardCoeffs:os,component:ls}){if(ss<1)return()=>NaN;let us=ss-1,cs=ts[us][ls],ps=rs.map(hs=>hs[ls]),ds;as&&(ds=os[ls]);let fs;return ns&&(fs=is[ls]),function(hs){if(isNaN(hs))return NaN;if(hs<0)return as?(ds[2]*hs+ds[1])*hs+ds[0]:NaN;if(hs>=us)return ns?(hs-=us,(fs[2]*hs+fs[1])*hs+fs[0]):hs===us?cs:NaN;let ys=Math.floor(hs);hs-=ys;let gs=ps[ys];return((gs[3]*hs+gs[2])*hs+gs[1])*hs+gs[0]}}function returnInterpolatedFunction({xs:ss,coeffs:ts,interpolationPoints:rs,domain:ns}){let is=[];if(rs&&(is=rs.map(ds=>ds.y)),ss===null)return()=>NaN;let as=-1/0,os=1/0,ls=!1,us=!1;if(ns!==null){let ds=ns[0];ds!==void 0&&(as=Context.fromAst(ds.tree[1][1]).evaluate_to_constant(),typeof as!="number"||Number.isNaN(as)?as=-1/0:ls=!ds.tree[2][1],os=Context.fromAst(ds.tree[1][2]).evaluate_to_constant(),typeof os!="number"||Number.isNaN(os)?os=1/0:us=!ds.tree[2][2])}let cs=ss[0],ps=ss[ss.length-1];return function(ds,fs=!1){if(fs){if(isNaN(ds))return NaN}else if(!(ds>=as)||!(ds<=os)||ls&&ds===as||us&&ds===os)return NaN;if(ds<=cs){ds-=cs;let Ns=ts[0];return((Ns[3]*ds+Ns[2])*ds+Ns[1])*ds+Ns[0]}if(ds>=ps){let Ns=ss.length-2;ds-=ss[Ns];let Ts=ts[Ns];return((Ts[3]*ds+Ts[2])*ds+Ts[1])*ds+Ts[0]}for(var hs=0,ys,gs=ss.length-1;hs<=gs;){ys=Math.floor(.5*(hs+gs));let Ns=ss[ys];if(Ns<ds)hs=ys+1;else if(Ns>ds)gs=ys-1;else return is[ys]}let bs=Math.max(0,gs);ds-=ss[bs];let vs=ts[bs];return((vs[3]*ds+vs[2])*ds+vs[1])*ds+vs[0]}}function returnReturnDerivativesOfInterpolatedFunction({xs:ss,coeffs:ts,variables:rs}){if(!ss)return()=>NaN;let ns=rs[0].subscripts_to_strings().tree,is=ss[0],as=ss[ss.length-1];return function(os){let ls=os.map(cs=>cs.subscripts_to_strings().tree),us=ls.length;return us>3||!ls.every(cs=>cs===ns)||ls.includes("")?()=>0:us===0||ss===null?()=>NaN:function(cs){if(isNaN(cs))return NaN;if(cs<=is){cs-=is;let gs=ts[0];return us===1?(3*gs[3]*cs+2*gs[2])*cs+gs[1]:us===2?6*gs[3]*cs+2*gs[2]:6*gs[3]}if(cs>=as){let gs=ss.length-2;cs-=ss[gs];let bs=ts[gs];return us===1?(3*bs[3]*cs+2*bs[2])*cs+bs[1]:us===2?6*bs[3]*cs+2*bs[2]:6*bs[3]}for(var ps=0,ds,fs=ss.length-1;ps<=fs;){ds=Math.floor(.5*(ps+fs));let gs=ss[ds];if(gs<cs)ps=ds+1;else if(gs>cs)fs=ds-1;else return us===1?ts[ds][1]:us===2?2*ts[ds][2]:6*ts[ds][3]}let hs=Math.max(0,fs);cs-=ss[hs];let ys=ts[hs];return us===1?(3*ys[3]*cs+2*ys[2])*cs+ys[1]:us===2?6*ys[3]*cs+2*ys[2]:6*ys[3]}}}var functionOperatorDefinitions={clampFunction:function(ss,ts){return function(rs){return Number.isFinite(rs)?Math.max(ss,Math.min(ts,rs)):NaN}},wrapFunctionPeriodic:function(ss,ts){return function(rs){if(!Number.isFinite(rs))return NaN;let ns=ss,is=ts;return ns===is?ns:(ns>is&&([is,ns]=[ns,is]),ns+Context.math.mod(rs-ns,is-ns))}},derivative:function(ss,ts){if(ss.derivativeType==="interpolatedFunction"){let rs=returnReturnDerivativesOfInterpolatedFunction({xs:ss.xs,coeffs:ss.coeffs,variables:ss.variables.map(convertValueToMathExpression)}),ns=ts.map(convertValueToMathExpression);if(ss.additionalDerivVariables&&(ns=[...ss.additionalDerivVariables.map(convertValueToMathExpression),...ns]),ss.variableMappings)for(let as of ss.variableMappings){let os=[];for(let ls of ns){let us=as[ls.subscripts_to_strings().tree];us?os.push(convertValueToMathExpression(us)):os.push(Context.fromAst(""))}ns=os}return rs(ns)}else return()=>NaN}};let Function$1=(Bl=class extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.simplify={createComponentOfType:"text",createStateVariable:"simplifySpecified",defaultValue:"full",toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numberspreserveorder"]},ts.expand={createComponentOfType:"boolean",createStateVariable:"expandSpecified",defaultValue:!1,public:!0},ts.xscale={createComponentOfType:"number",createStateVariable:"xscale",defaultValue:1,public:!0},ts.yscale={createComponentOfType:"number",createStateVariable:"yscale",defaultValue:1,public:!0},ts.nInputs={createComponentOfType:"integer"},ts.nOutputs={createComponentOfType:"integer"},ts.domain={createComponentOfType:"_intervalListComponent"},ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},ts.applyStyleToLabel={createComponentOfType:"boolean",createStateVariable:"applyStyleToLabel",defaultValue:!1,public:!0,forRenderer:!0},ts.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.minima={createComponentOfType:"extrema"},ts.maxima={createComponentOfType:"extrema"},ts.extrema={createComponentOfType:"extrema"},ts.through={createComponentOfType:"_pointListComponent"},ts.throughSlopes={createComponentOfType:"mathList"},ts.variables={createComponentOfType:"variables"},ts.symbolic={createComponentOfType:"boolean"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer"},ts.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},ts.padZeros={createComponentOfType:"boolean"},ts.nearestPointAsCurve={createComponentOfType:"boolean",createStateVariable:"nearestPointAsCurve",defaultValue:!1},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){let as=ps=>is.componentIsSpecifiedType(ps,"label"),os=ns.map(as),ls=[],us=[],cs=[];if(os.filter(ps=>ps).length===0)ls=ns;else{if(os[0]){let ds=os.indexOf(!1);ds!==-1&&(us=ns.slice(0,ds),ns=ns.slice(ds),os=os.slice(ds))}let ps=os.indexOf(!0);ps===-1?ls=ns:(ls=ns.slice(0,ps),cs=ns.slice(ps))}return ls.length===1&&typeof ls[0]!="string"||ls.length===0?{success:!1}:{success:!0,newChildren:[...us,{componentType:"math",children:ls},...cs]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"functions",componentTypes:["function"]},{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions({numerics:ts}){let rs=GraphicalComponent.returnStateVariableDefinitions();return rs.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var os;let is;((os=ns.document)==null?void 0:os.stateValues.theme)==="dark"?is=ns.selectedStyle.lineColorWordDarkMode:is=ns.selectedStyle.lineColorWord;let as=ns.selectedStyle.lineWidthWord;return ns.selectedStyle.lineStyleWord&&(as&&(as+=" "),as+=ns.selectedStyle.lineStyleWord),as&&(as+=" "),as+=is,{setValue:{styleDescription:as}}}},rs.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:ns}){return{setValue:{styleDescriptionWithNoun:ns.styleDescription+" function"}}}},rs.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displayDigits"]}}),definition({dependencyValues:ns,usedDefault:is}){if(ns.displayDigitsAttr!==null){let as=is.displayDigitsAttr,os=ns.displayDecimalsAttr===null||is.displayDecimalsAttr;if(!(as||os)){let ls=ns.displayDigitsAttr.shadowDepth;ns.displayDecimalsAttr.shadowDepth<ls&&(as=!0)}return as?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:ns.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:ns.displayDigitsAttr.stateValues.value}}}else if(ns.functionChild.length>0){let as=is.functionChild[0],os=ns.displayDecimalsAttr===null||is.displayDecimalsAttr;return as||os||(as=!0),as?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:ns.functionChild[0].stateValues.displayDigits}}}:{setValue:{displayDigits:ns.functionChild[0].stateValues.displayDigits}}}else return{useEssentialOrDefaultValue:{displayDigits:!0}}}},rs.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:null,hasEssential:!0,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displayDecimals"]}}),definition({dependencyValues:ns,usedDefault:is}){return ns.displayDecimalsAttr!==null?{setValue:{displayDecimals:ns.displayDecimalsAttr.stateValues.value}}:ns.functionChild.length>0&&!is.functionChild[0]?{setValue:{displayDecimals:ns.functionChild[0].stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},rs.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displaySmallAsZero"]}}),definition({dependencyValues:ns,usedDefault:is}){return ns.displaySmallAsZeroAttr!==null?{setValue:{displaySmallAsZero:ns.displaySmallAsZeroAttr.stateValues.value}}:ns.functionChild.length>0&&!is.functionChild[0]?{setValue:{displaySmallAsZero:ns.functionChild[0].stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},rs.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["padZeros"]}}),definition({dependencyValues:ns,usedDefault:is}){return ns.padZerosAttr!==null?{setValue:{padZeros:ns.padZerosAttr.stateValues.value}}:ns.functionChild.length>0&&!is.functionChild[0]?{setValue:{padZeros:ns.functionChild[0].stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},rs.isInterpolatedFunction={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through"},minima:{dependencyType:"attributeComponent",attributeName:"minima"},maxima:{dependencyType:"attributeComponent",attributeName:"maxima"},extrema:{dependencyType:"attributeComponent",attributeName:"extrema"}}),definition({dependencyValues:ns}){return{setValue:{isInterpolatedFunction:ns.through||ns.minima||ns.maxima||ns.extrema}}}},rs.nInputs={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({nInputsAttr:{dependencyType:"attributeComponent",attributeName:"nInputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nInputs"]},variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["nComponents"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition({dependencyValues:ns}){if(ns.isInterpolatedFunction)return{setValue:{nInputs:1}};if(ns.nInputsAttr!==null){let is=ns.nInputsAttr.stateValues.value;return is>=0||(is=1),{setValue:{nInputs:is}}}else return ns.variablesAttr!==null?{setValue:{nInputs:Math.max(1,ns.variablesAttr.stateValues.nComponents)}}:ns.functionChild.length>0?{setValue:{nInputs:ns.functionChild[0].stateValues.nInputs}}:{setValue:{nInputs:1}}}},rs.nOutputs={defaultValue:1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({nOutputsAttr:{dependencyType:"attributeComponent",attributeName:"nOutputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nOutputs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}),definition({dependencyValues:ns}){if(ns.functionChild.length>0)return{setValue:{nOutputs:ns.functionChild[0].stateValues.nOutputs}};if(ns.nOutputsAttr!==null){let is=ns.nOutputsAttr.stateValues.value;return is>=0||(is=1),{setValue:{nOutputs:is}}}else if(ns.mathChild.length>0){let is=ns.mathChild[0].stateValues.value,as=Array.isArray(is.tree)&&vectorOperators.includes(is.tree[0]),os=1;return as&&(os=is.tree.length-1),{setValue:{nOutputs:os}}}else return{useEssentialOrDefaultValue:{nOutputs:!0}}}},rs.domain={returnDependencies:()=>({domainAttr:{dependencyType:"attributeComponent",attributeName:"domain",variableNames:["intervals"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"}}),definition({dependencyValues:ns}){if(ns.domainAttr!==null){let is=ns.nInputs,as=ns.domainAttr.stateValues.intervals.slice(0,is);return as.length!==is?{setValue:{domain:null}}:as.every(os=>Array.isArray(os.tree)&&os.tree[0]==="interval")?{setValue:{domain:as}}:{setValue:{domain:null}}}else return ns.functionChild.length>0?{setValue:{domain:ns.functionChild[0].stateValues.domain}}:{setValue:{domain:null}}}},rs.simplify={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({simplifySpecified:{dependencyType:"stateVariable",variableName:"simplifySpecified"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["simplify"]}}),definition({dependencyValues:ns,usedDefault:is}){return is.simplifySpecified&&ns.functionChild.length>0?{setValue:{simplify:ns.functionChild[0].stateValues.simplify}}:{setValue:{simplify:ns.simplifySpecified}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,usedDefault:as}){return as.simplifySpecified&&is.functionChild.length>0?{success:!0,instructions:[{setDependency:"functionChild",desiredValue:ns.simplify,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"simplifySpecified",desiredValue:ns.simplify}]}}},rs.expand={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({expandSpecified:{dependencyType:"stateVariable",variableName:"expandSpecified"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["expand"]}}),definition({dependencyValues:ns,usedDefault:is}){return is.expandSpecified&&ns.functionChild.length>0?{setValue:{expand:ns.functionChild[0].stateValues.expand}}:{setValue:{expand:ns.expandSpecified}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,usedDefault:as}){return as.expandSpecified&&is.functionChild.length>0?{success:!0,instructions:[{setDependency:"functionChild",desiredValue:ns.expand,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"expandSpecified",desiredValue:ns.expand}]}}},rs.numericalfShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{numericalfShadow:!0}})},rs.symbolicfShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{symbolicfShadow:!0}})},rs.symbolic={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!0,hasEssential:!0,returnDependencies:()=>({symbolicAttr:{dependencyType:"attributeComponent",attributeName:"symbolic",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolic"]},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"}}),definition({dependencyValues:ns}){return ns.symbolicAttr!==null?{setValue:{symbolic:ns.symbolicAttr.stateValues.value}}:ns.functionChild.length>0?{setValue:{symbolic:ns.functionChild[0].stateValues.symbolic}}:ns.numericalfShadow?{setValue:{symbolic:!1}}:ns.symbolicfShadow?{setValue:{symbolic:!0}}:{useEssentialOrDefaultValue:{symbolic:!0}}}},rs.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({nInputs:{dependencyType:"stateVariable",variableName:"nInputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nInputs]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},functionChild:{dependencyType:"child",childGroups:["functions"]}},as={};for(let os of ns)as[os]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["variable"+(Number(os)+1)]}};return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arraySize:as,arrayKeys:os,usedDefault:ls}){if(ns.variablesAttr!==null){let us=ns.variablesAttr.stateValues.variables;return{setValue:{variables:returnNVariables(as[0],us)}}}else if(ns.functionChild.length>0){let us={};for(let cs of os)us[cs]=is[cs].functionChild[0].stateValues["variable"+(Number(cs)+1)];return{setValue:{variables:us}}}else return ns.parentVariableForChild&&!ls.parentVariableForChild?{setValue:{variables:Array(as[0]).fill(ns.parentVariableForChild)}}:{setValue:{variables:returnNVariables(as[0],[])}}}},rs.variable={isAlias:!0,targetVariableName:"variable1"},rs.formula={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},defaultValue:Context.fromAst(0),hasEssential:!0,returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value","formula"],variablesOptional:!0},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["formula"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:ns,usedDefault:is}){return ns.isInterpolatedFunction?{setValue:{formula:Context.fromAst("")}}:ns.mathChild.length>0?{setValue:{formula:ns.mathChild[0].stateValues.value}}:ns.functionChild.length>0&&!is.functionChild[0].formula?{setValue:{formula:ns.functionChild[0].stateValues.formula}}:{useEssentialOrDefaultValue:{formula:!0}}}},rs.nPrescribedPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:ns}){let is=0;return ns.through!==null&&(is=ns.through.stateValues.nPoints),{setValue:{nPrescribedPoints:is}}}},rs.prescribedPoints={isArray:!0,entryPrefixes:["prescribedPoint"],returnArraySizeDependencies:()=>({nPrescribedPoints:{dependencyType:"stateVariable",variableName:"nPrescribedPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nPrescribedPoints]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1;is[as]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["point"+os]},throughSlopes:{dependencyType:"attributeComponent",attributeName:"throughSlopes",variableNames:["math"+os]}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].through;if(ls!==null){let us=Number(os)+1,cs=ls.stateValues["point"+us],ps=null,ds=ns[os].throughSlopes;ds!==null&&(ps=ds.stateValues["math"+us],ps===void 0&&(ps=null)),as[os]={x:cs[0],y:cs[1],slope:ps}}}return{setValue:{prescribedPoints:as}}}},rs.prescribedMinima={returnDependencies:()=>({minima:{dependencyType:"attributeComponent",attributeName:"minima",variableNames:["extrema"]}}),definition({dependencyValues:ns}){let is=[];return ns.minima!==null&&(is=ns.minima.stateValues.extrema.map(as=>({x:as[0],y:as[1]}))),{setValue:{prescribedMinima:is}}}},rs.prescribedMaxima={returnDependencies:()=>({maxima:{dependencyType:"attributeComponent",attributeName:"maxima",variableNames:["extrema"]}}),definition({dependencyValues:ns}){let is=[];return ns.maxima!==null&&(is=ns.maxima.stateValues.extrema.map(as=>({x:as[0],y:as[1]}))),{setValue:{prescribedMaxima:is}}}},rs.prescribedExtrema={returnDependencies:()=>({extrema:{dependencyType:"attributeComponent",attributeName:"extrema",variableNames:["extrema"]}}),definition({dependencyValues:ns}){let is=[];return ns.extrema!==null&&(is=ns.extrema.stateValues.extrema.map(as=>({x:as[0],y:as[1]}))),{setValue:{prescribedExtrema:is}}}},rs.interpolationPoints={returnDependencies:()=>({xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"},prescribedPoints:{dependencyType:"stateVariable",variableName:"prescribedPoints"},prescribedMinima:{dependencyType:"stateVariable",variableName:"prescribedMinima"},prescribedMaxima:{dependencyType:"stateVariable",variableName:"prescribedMaxima"},prescribedExtrema:{dependencyType:"stateVariable",variableName:"prescribedExtrema"}}),definition:({dependencyValues:ns})=>calculateInterpolationPoints({dependencyValues:ns,numerics:ts})},rs.xs={additionalStateVariablesDefined:["coeffs"],returnDependencies:()=>({interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"}}),definition:computeSplineParamCoeffs},rs.mathChildName={returnDependencies(){return{mathChild:{dependencyType:"child",childGroups:["maths"]}}},definition({dependencyValues:ns}){return ns.mathChild.length>0?{setValue:{mathChildName:ns.mathChild[0].componentName}}:{setValue:{mathChildName:null}}}},rs.mathChildCreatedBySugar={stateVariablesDeterminingDependencies:["mathChildName"],returnDependencies({stateValues:ns}){return ns.mathChildName?{mathChildCreatedBySugar:{dependencyType:"doenetAttribute",componentName:ns.mathChildName,attributeName:"createdFromSugar"}}:{}},definition({dependencyValues:ns}){return{setValue:{mathChildCreatedBySugar:!!ns.mathChildCreatedBySugar}}}},rs.symbolicfs={isArray:!0,entryPrefixes:["symbolicf"],stateVariablesDeterminingDependencies:["isInterpolatedFunction","mathChildName","mathChildCreatedBySugar"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey({stateValues:ns}){if(ns.isInterpolatedFunction)return{globalDependencies:{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}};{let is={formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolicfs"]},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}};return ns.mathChildName&&(ns.mathChildCreatedBySugar?(is.mathChildExpressionWithCodes={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"expressionWithCodes"},is.mathChildMathChildren={dependencyType:"child",parentName:ns.mathChildName,childGroups:["maths"],variableNames:["value","fReevaluate","inputMaths"],variablesOptional:!0},is.mathChildCodePre={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"codePre"}):is.mathChild={dependencyType:"child",childGroups:["maths"],variableNames:["value","fReevaluate","inputMaths"],variablesOptional:!0}),{globalDependencies:is}}},arrayDefinitionByKey:function({globalDependencyValues:ns,usedDefault:is,arrayKeys:as}){var os,ls;if(ns.isInterpolatedFunction){let us={};for(let cs of as)if(cs==="0"){let ps=returnInterpolatedFunction({xs:ns.xs,coeffs:ns.coeffs,interpolationPoints:ns.interpolationPoints,domain:ns.domain});us[cs]=function(ds){let fs=ds.evaluate_to_constant();return Context.fromAst(ps(fs))}}else us[cs]=ps=>Context.fromAst("");return{setValue:{symbolicfs:us}}}else if(ns.functionChild.length>0){let us={};for(let cs of as)us[cs]=ns.functionChild[0].stateValues.symbolicfs[cs];return{setValue:{symbolicfs:us}}}else if(is.formula)if(ns.symbolicfShadow){let us={};for(let cs of as)cs==="0"?us[cs]=ns.symbolicfShadow:us[cs]=ps=>Context.fromAst("");return{setValue:{symbolicfs:us}}}else if(ns.numericalfShadow){let us={};for(let cs of as)cs==="0"?us[cs]=function(ps){let ds=ps.evaluate_to_constant();return Context.fromAst(ns.numericalfShadow(ds))}:us[cs]=ps=>Context.fromAst("");return{setValue:{symbolicfs:us}}}else{let us={};for(let cs of as)us[cs]=returnSymbolicFunctionFromFormula({formula:ns.formula,simplify:ns.simplify,expand:ns.expand,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:cs});return{setValue:{symbolicfs:us}}}else{if(((os=ns.mathChildMathChildren)==null?void 0:os.length)>0){let cs=ns.variables.map(ys=>ys.subscripts_to_strings().tree),ps={},ds=!1,fs=ns.mathChildCodePre,hs={};for(let[ys,gs]of ns.mathChildMathChildren.entries())gs.stateValues.fReevaluate&&gs.stateValues.inputMaths.reduce((vs,Ns)=>[...vs,...Ns.subscripts_to_strings().variables()],[]).some(vs=>cs.includes(vs))?(ps[fs+ys]={fReevaluate:gs.stateValues.fReevaluate,inputMathFs:gs.stateValues.inputMaths.map(vs=>vs.subscripts_to_strings().f())},ds=!0):hs[fs+ys]=gs.stateValues.value;if(ds){let ys=ns.mathChildExpressionWithCodes;Object.keys(hs).length>0&&(ys=ys.substitute(hs)),ys=Context.fromAst(mergeListsWithOtherContainers(ys.tree));let gs={};for(let bs of as)gs[bs]=returnSymbolicFunctionFromReevaluatedFormula({formulaExpressionWithCodes:ys,evaluateChildrenToReevaluate:ps,simplify:ns.simplify,expand:ns.expand,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:bs});return{setValue:{symbolicfs:gs}}}}else if((ls=ns.mathChild)!=null&&ls[0].stateValues.fReevaluate){let cs=ns.variables.map(fs=>fs.subscripts_to_strings().tree),ps=ns.mathChild[0];if(ps.stateValues.inputMaths.reduce((fs,hs)=>[...fs,...hs.subscripts_to_strings().variables()],[]).some(fs=>cs.includes(fs))){let fs=Context.fromAst("code"),hs={code:{fReevaluate:ps.stateValues.fReevaluate,inputMathFs:ps.stateValues.inputMaths.map(gs=>gs.subscripts_to_strings().f())}},ys={};for(let gs of as)ys[gs]=returnSymbolicFunctionFromReevaluatedFormula({formulaExpressionWithCodes:fs,evaluateChildrenToReevaluate:hs,simplify:ns.simplify,expand:ns.expand,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:gs});return{setValue:{symbolicfs:ys}}}}let us={};for(let cs of as)us[cs]=returnSymbolicFunctionFromFormula({formula:ns.formula,simplify:ns.simplify,expand:ns.expand,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:cs});return{setValue:{symbolicfs:us}}}}},rs.symbolicf={isAlias:!0,targetVariableName:"symbolicf1"},rs.numericalfs={isArray:!0,entryPrefixes:["numericalf"],stateVariablesDeterminingDependencies:["isInterpolatedFunction","mathChildName","mathChildCreatedBySugar"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey({stateValues:ns}){if(ns.isInterpolatedFunction)return{globalDependencies:{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}};{let is={formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalfs"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}};return ns.mathChildName&&(ns.mathChildCreatedBySugar?(is.mathChildExpressionWithCodes={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"expressionWithCodes"},is.mathChildMathChildren={dependencyType:"child",parentName:ns.mathChildName,childGroups:["maths"],variableNames:["value","fReevaluate","inputMaths"],variablesOptional:!0},is.mathChildCodePre={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"codePre"}):is.mathChild={dependencyType:"child",childGroups:["maths"],variableNames:["value","fReevaluate","inputMaths"],variablesOptional:!0}),{globalDependencies:is}}},arrayDefinitionByKey:function({globalDependencyValues:ns,usedDefault:is,arrayKeys:as}){var os,ls;if(ns.isInterpolatedFunction){let us={};for(let cs of as)cs==="0"?us[cs]=returnInterpolatedFunction({xs:ns.xs,coeffs:ns.coeffs,interpolationPoints:ns.interpolationPoints,domain:ns.domain}):us[cs]=ps=>Context.fromAst("");return{setValue:{numericalfs:us}}}else if(ns.functionChild.length>0){let us={};for(let cs of as)us[cs]=ns.functionChild[0].stateValues.numericalfs[cs];return{setValue:{numericalfs:us}}}else if(is.formula)if(ns.numericalfShadow){let us={};for(let cs of as)cs==="0"?us[cs]=ns.numericalfShadow:us[cs]=()=>NaN;return{setValue:{numericalfs:us}}}else if(ns.symbolicfShadow){let us={};for(let cs of as)cs==="0"?us[cs]=function(ps){return ns.symbolicfShadow(Context.fromAst(ps)).evaluate_to_constant()}:us[cs]=()=>NaN;return{setValue:{numericalfs:us}}}else{let us={};for(let cs of as)us[cs]=returnNumericalFunctionFromFormula({formula:ns.formula,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:cs});return{setValue:{numericalfs:us}}}else{if(((os=ns.mathChildMathChildren)==null?void 0:os.length)>0){let cs=ns.variables.map(ys=>ys.subscripts_to_strings().tree),ps={},ds=!1,fs=ns.mathChildCodePre,hs={};for(let[ys,gs]of ns.mathChildMathChildren.entries())gs.stateValues.fReevaluate&&gs.stateValues.inputMaths.reduce((vs,Ns)=>[...vs,...Ns.subscripts_to_strings().variables()],[]).some(vs=>cs.includes(vs))?(ps[fs+ys]={fReevaluate:gs.stateValues.fReevaluate,inputMathFs:gs.stateValues.inputMaths.map(vs=>vs.subscripts_to_strings().f())},ds=!0):hs[fs+ys]=gs.stateValues.value;if(ds){let ys=ns.mathChildExpressionWithCodes;Object.keys(hs).length>0&&(ys=ys.substitute(hs)),ys=Context.fromAst(mergeListsWithOtherContainers(ys.tree));let gs={};for(let bs of as)gs[bs]=returnNumericalFunctionFromReevaluatedFormula({formulaExpressionWithCodes:ys,evaluateChildrenToReevaluate:ps,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:bs});return{setValue:{numericalfs:gs}}}}else if((ls=ns.mathChild)!=null&&ls[0].stateValues.fReevaluate){let cs=ns.variables.map(fs=>fs.subscripts_to_strings().tree),ps=ns.mathChild[0];if(ps.stateValues.inputMaths.reduce((fs,hs)=>[...fs,...hs.subscripts_to_strings().variables()],[]).some(fs=>cs.includes(fs))){let fs=Context.fromAst("code"),hs={code:{fReevaluate:ps.stateValues.fReevaluate,inputMathFs:ps.stateValues.inputMaths.map(gs=>gs.subscripts_to_strings().f())}},ys={};for(let gs of as)ys[gs]=returnNumericalFunctionFromReevaluatedFormula({formulaExpressionWithCodes:fs,evaluateChildrenToReevaluate:hs,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:gs});return{setValue:{numericalfs:ys}}}}let us={};for(let cs of as)us[cs]=returnNumericalFunctionFromFormula({formula:ns.formula,nInputs:ns.nInputs,variables:ns.variables,domain:ns.domain,component:cs});return{setValue:{numericalfs:us}}}}},rs.numericalf={returnDependencies:()=>({numericalf1:{dependencyType:"stateVariable",variableName:"numericalf1"}}),definition({dependencyValues:ns}){return{setValue:{numericalf:ns.numericalf1}}}},rs.fDefinitions={isArray:!0,entryPrefixes:["fDefinition"],stateVariablesDeterminingDependencies:["isInterpolatedFunction","mathChildName","mathChildCreatedBySugar"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey({stateValues:ns}){if(ns.isInterpolatedFunction)return{globalDependencies:{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}};{let is={formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["fDefinitions"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}};return ns.mathChildName&&(ns.mathChildCreatedBySugar?(is.mathChildExpressionWithCodes={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"expressionWithCodes"},is.mathChildMathChildren={dependencyType:"child",parentName:ns.mathChildName,childGroups:["maths"],variableNames:["value","fReevaluateDefinition","inputMaths"],variablesOptional:!0},is.mathChildCodePre={dependencyType:"stateVariable",componentName:ns.mathChildName,variableName:"codePre"}):is.mathChild={dependencyType:"child",childGroups:["maths"],variableNames:["value","fReevaluateDefinition","inputMaths"],variablesOptional:!0}),{globalDependencies:is}}},arrayDefinitionByKey:function({globalDependencyValues:ns,usedDefault:is,arrayKeys:as}){var os,ls;if(ns.isInterpolatedFunction){let us={};for(let cs of as)cs==="0"?us[cs]={functionType:"interpolated",xs:ns.xs,coeffs:ns.coeffs,interpolationPoints:ns.interpolationPoints,domain:ns.domain?ns.domain.map(ps=>ps.tree):null}:us[cs]={};return{setValue:{fDefinitions:us}}}else if(ns.functionChild.length>0){let us={};for(let cs of as)us[cs]=ns.functionChild[0].stateValues.fDefinitions[cs];return{setValue:{fDefinitions:us}}}else if(is.formula)if(ns.numericalfShadow){let us={};for(let cs of as)us[cs]={};return{setValue:{fDefinitions:us}}}else if(ns.symbolicfShadow){let us={};for(let cs of as)us[cs]={};return{setValue:{fDefinitions:us}}}else{let us={};for(let cs of as)us[cs]={functionType:"formula",formula:ns.formula.tree,variables:ns.variables.map(ps=>ps.tree),nInputs:ns.nInputs,nOutputs:ns.nOutputs,domain:ns.domain?ns.domain.map(ps=>ps.tree):null,component:cs};return{setValue:{fDefinitions:us}}}else{if(((os=ns.mathChildMathChildren)==null?void 0:os.length)>0){let cs=ns.variables.map(ys=>ys.subscripts_to_strings().tree),ps={},ds=!1,fs=ns.mathChildCodePre,hs={};for(let[ys,gs]of ns.mathChildMathChildren.entries())gs.stateValues.fReevaluateDefinition&&gs.stateValues.inputMaths.reduce((vs,Ns)=>[...vs,...Ns.subscripts_to_strings().variables()],[]).some(vs=>cs.includes(vs))?(ps[fs+ys]={fReevaluateDefinition:gs.stateValues.fReevaluateDefinition,inputMaths:gs.stateValues.inputMaths},ds=!0):hs[fs+ys]=gs.stateValues.value;if(ds){let ys=ns.mathChildExpressionWithCodes;Object.keys(hs).length>0&&(ys=ys.substitute(hs)),ys=Context.fromAst(mergeListsWithOtherContainers(ys.tree));let gs={};for(let bs of as)gs[bs]={functionType:"reevaluatedFormula",formulaExpressionWithCodes:ys,evaluateChildrenToReevaluate:ps,nInputs:ns.nInputs,variables:ns.variables.map(vs=>vs.tree),domain:ns.domain?ns.domain.map(vs=>vs.tree):null,component:bs};return{setValue:{fDefinitions:gs}}}}else if((ls=ns.mathChild)!=null&&ls[0].stateValues.fReevaluateDefinition){let cs=ns.variables.map(fs=>fs.subscripts_to_strings().tree),ps=ns.mathChild[0];if(ps.stateValues.inputMaths.reduce((fs,hs)=>[...fs,...hs.subscripts_to_strings().variables()],[]).some(fs=>cs.includes(fs))){let fs=Context.fromAst("code"),hs={code:{fReevaluateDefinition:ps.stateValues.fReevaluateDefinition,inputMaths:ps.stateValues.inputMaths}},ys={};for(let gs of as)ys[gs]={functionType:"reevaluatedFormula",formulaExpressionWithCodes:fs,evaluateChildrenToReevaluate:hs,nInputs:ns.nInputs,variables:ns.variables.map(bs=>bs.tree),domain:ns.domain?ns.domain.map(bs=>bs.tree):null,component:gs};return{setValue:{fDefinitions:ys}}}}let us={};for(let cs of as)us[cs]={functionType:"formula",formula:ns.formula.tree,variables:ns.variables.map(ps=>ps.tree),nInputs:ns.nInputs,nOutputs:ns.nOutputs,domain:ns.domain?ns.domain.map(ps=>ps.tree):null,component:cs};return{setValue:{fDefinitions:us}}}}},rs.fDefinition={isAlias:!0,targetVariableName:"fDefinition1"},rs.fs={isArray:!0,entryPrefixes:["f"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={symbolic:{dependencyType:"stateVariable",variableName:"symbolic"}},as={};for(let os of ns){let ls=Number(os)+1;as[os]={symbolicf:{dependencyType:"stateVariable",variableName:"symbolicf"+ls},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"+ls}}}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){let os={};if(ns.symbolic)for(let ls of as)os[ls]=is[ls].symbolicf;else for(let ls of as)os[ls]=is[ls].numericalf;return{setValue:{fs:os}}}},rs.f={isAlias:!0,targetVariableName:"f1"},rs.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({formula:{dependencyType:"stateVariable",variableName:"formula"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:ns,usedDefault:is}){let as={};return ns.padZeros&&(is.displayDigits&&!is.displayDecimals?Number.isFinite(ns.displayDecimals)&&(as.padToDecimals=ns.displayDecimals):ns.displayDigits>=1&&(as.padToDigits=ns.displayDigits)),{setValue:{latex:roundForDisplay({value:ns.formula,dependencyValues:ns,usedDefault:is}).toLatex(as)}}}},rs.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:ns}){return{setValue:{latexWithInputChildren:[ns.latex]}}}},rs.allMinima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:ns}){return ns.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["allMinima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},domain:{dependencyType:"stateVariable",variableName:"domain"}}},definition:function({dependencyValues:ns}){if(ns.isInterpolatedFunction){let is=ns.xs,as=ns.coeffs,os=ts.eps,ls=[];if(is===null)return{setValue:{allMinima:ls}};let us=!1,cs=-1/0,ps=1/0,ds=!1,fs=!1;if(ns.domain!==null){let bs=ns.domain[0];bs!==void 0&&(cs=Context.fromAst(bs.tree[1][1]).evaluate_to_constant(),Number.isFinite(cs)?ds=!bs.tree[2][1]:cs=-1/0,ps=Context.fromAst(bs.tree[1][2]).evaluate_to_constant(),Number.isFinite(ps)?fs=!bs.tree[2][2]:ps=1/0)}let hs=1e-14*Math.max(Math.abs(cs),Math.abs(ps)),ys=as[0],gs=is[1]-is[0];if(ys[3]===0){if(ys[2]>0){let bs=-ys[1]/(2*ys[2]);bs+is[0]>=cs-hs&&bs+is[0]<=ps+hs&&(bs<=gs-os?ds&&Math.abs(bs+is[0]-cs)<hs||fs&&Math.abs(bs+is[0]-ps)<hs||ls.push([bs+is[0],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]]):Math.abs(bs-gs)<os&&(us=!0))}}else{let bs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(bs>0){let vs=Math.sqrt(bs),Ns=(-2*ys[2]+vs)/(6*ys[3]);Ns+is[0]>=cs-hs&&Ns+is[0]<=ps+hs&&(Ns<=gs-os?ds&&Math.abs(Ns+is[0]-cs)<hs||fs&&Math.abs(Ns+is[0]-ps)<hs||ls.push([Ns+is[0],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]]):Math.abs(Ns-gs)<os&&(us=!0))}}for(let bs=1;bs<is.length-2;bs++)if(ys=as[bs],gs=is[bs+1]-is[bs],ys[3]===0)if(ys[2]>0){let vs=-ys[1]/(2*ys[2]);if(vs+is[bs]>=cs-hs)if(vs+is[bs]<=ps+hs)Math.abs(vs)<os?us&&(ds&&Math.abs(vs+is[bs]-cs)<hs||fs&&Math.abs(vs+is[bs]-ps)<hs||ls.push([vs+is[bs],((ys[3]*vs+ys[2])*vs+ys[1])*vs+ys[0]])):vs>=os&&vs<=gs-os&&(ds&&Math.abs(vs+is[bs]-cs)<hs||fs&&Math.abs(vs+is[bs]-ps)<hs||ls.push([vs+is[bs],((ys[3]*vs+ys[2])*vs+ys[1])*vs+ys[0]])),us=Math.abs(vs-gs)<os;else{us=!1;continue}}else us=!1;else{let vs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(vs>0){let Ns=Math.sqrt(vs),Ts=(-2*ys[2]+Ns)/(6*ys[3]);if(Ts+is[bs]>=cs-hs)if(Ts+is[bs]<=ps+hs)Math.abs(Ts)<os?us&&(ds&&Math.abs(Ts+is[bs]-cs)<hs||fs&&Math.abs(Ts+is[bs]-ps)<hs||ls.push([Ts+is[bs],((ys[3]*Ts+ys[2])*Ts+ys[1])*Ts+ys[0]])):Ts>=os&&Ts<=gs-os&&(ds&&Math.abs(Ts+is[bs]-cs)<hs||fs&&Math.abs(Ts+is[bs]-ps)<hs||ls.push([Ts+is[bs],((ys[3]*Ts+ys[2])*Ts+ys[1])*Ts+ys[0]])),us=Math.abs(Ts-gs)<os;else{us=!1;continue}}else us=!1}if(ys=as[is.length-2],ys[3]===0){if(ys[2]>0){let bs=-ys[1]/(2*ys[2]);bs+is[is.length-2]>=cs-hs&&bs+is[is.length-2]<=ps+hs&&(Math.abs(bs)<os?us&&(ds&&Math.abs(bs+is[is.length-2]-cs)<hs||fs&&Math.abs(bs+is[is.length-2]-ps)<hs||ls.push([bs+is[is.length-2],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]])):bs>=os&&(ds&&Math.abs(bs+is[is.length-2]-cs)<hs||fs&&Math.abs(bs+is[is.length-2]-ps)<hs||ls.push([bs+is[is.length-2],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]])))}}else{let bs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(bs>0){let vs=Math.sqrt(bs),Ns=(-2*ys[2]+vs)/(6*ys[3]);Ns+is[is.length-2]>=cs-hs&&Ns+is[is.length-2]<=ps+hs&&(Ns>=os?ds&&Math.abs(Ns+is[is.length-2]-cs)<hs||fs&&Math.abs(Ns+is[is.length-2]-ps)<hs||ls.push([Ns+is[is.length-2],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]]):Math.abs(Ns)<os&&us&&(ds&&Math.abs(Ns+is[is.length-2]-cs)<hs||fs&&Math.abs(Ns+is[is.length-2]-ps)<hs||ls.push([Ns+is[is.length-2],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]])))}}return{setValue:{allMinima:ls}}}else{if(ns.functionChild&&ns.functionChild.length>0)return{setValue:{allMinima:ns.functionChild[0].stateValues.allMinima}};if(!(ns.nInputs===1&&ns.nOutputs===1))return{setValue:{allMinima:[]}};let is=ns.variables[0].subscripts_to_strings().tree,as=ns.formula.subscripts_to_strings().derivative(is),os,ls=!0,us;try{os=as.subscripts_to_strings().f()}catch{ls=!1,us=()=>NaN}ls&&(us=function(As){try{return os({[is]:As})}catch{return NaN}});let cs=As=>ns.numericalf(As,!0),ps=-100*ns.xscale,ds=100*ns.xscale,fs=!1,hs=!1;if(ns.domain!==null){let As=ns.domain[0];As!==void 0&&(ps=Context.fromAst(As.tree[1][1]).evaluate_to_constant(),Number.isFinite(ps)?fs=!As.tree[2][1]:ps=-100*ns.xscale,ds=Context.fromAst(As.tree[1][2]).evaluate_to_constant(),Number.isFinite(ds)?hs=!As.tree[2][2]:ds=100*ns.xscale)}let ys=1e3,gs=(ds-ps)/ys,bs=1e-10*Math.max(Math.abs(ps),Math.abs(ds)),vs=[],Ns=!1,Ts=!1,Cs=cs(ps-gs),xs=us(ps-gs);for(let As=-1;As<ys+1;As++){let ws=ps+As*gs,Es=ps+(As+1)*gs,Ss=Cs;Cs=cs(Es);let Ds=xs;if(xs=us(Es),Number.isNaN(Ss)||Number.isNaN(Cs))continue;let Vs=!1;if(ls&&Ds*xs<=0){let Is;Ds===0?Is=ws:xs===0?Is=Es:Is=ts.fzero(us,[ws,Es]);let Ps=.5*1e-6*(Math.abs(Is)+1);us(Is-Ps)<0&&us(Is+Ps)>0&&(Vs=!0,Ns=!1,Is>=ps-bs&&Is<=ds+bs&&!(fs&&Math.abs(Is-ps)<bs||hs&&Math.abs(Is-ds)<bs)&&!(Ts&&Math.abs(Is-ws)<bs)?(vs.push([Is,cs(Is)]),Ts=Math.abs(Is-Es)<bs):Ts=!1)}if(!Vs){Ts=!1;let Is=ts.fminbr(cs,[ws,Es]);if(Is.success!==!0)continue;let Os=Is.x,Ps=Is.fx;Ss<Ps?(Ns&&Number.isFinite(Ss)&&vs.push([ws,Ss]),Ns=!1):Cs<Ps?Ns=!0:(Ns=!1,Ps<Cs&&Ps<Ss&&Ps<cs(Os+Is.tol)&&Ps<cs(Os-Is.tol)&&Number.isFinite(Ps)&&vs.push([Os,Ps]))}}return{setValue:{allMinima:vs}}}}},rs.numberMinima={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}),definition({dependencyValues:ns}){return{setValue:{numberMinima:ns.allMinima.length},checkForActualChange:{numberMinima:!0}}}},rs.minima={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(ns){return ns==="minimum"||ns===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]}},isArray:!0,nDimensions:2,entryPrefixes:["minimum","minimumLocations","minimumLocation","minimumValues","minimumValue"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(["minimum","minimumLocation","minimumValue"].includes(ns)){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?!as||os<as[0]?ns==="minimum"?[os+",0",os+",1"]:ns==="minimumLocation"?[os+",0"]:[os+",1"]:[]:[]}else return ns==="minimumLocations"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",0"):["0,0"]:ns==="minimumValues"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",1"):["0,1"]:[]},arrayVarNameFromArrayKey(ns){let[is,as]=ns.split(",");return as==="0"?"minimumLocation"+(Number(is)+1):"minimumValue"+(Number(is)+1)},arrayVarNameFromPropIndex(ns,is){if(is==="minima"){if(ns.length===1)return"minimum"+ns[0];{let as=Number(ns[0]);if(Number.isInteger(as)&&as>0){if(ns[1]===1)return"minimumLocation"+as;if(ns[1]===2)return"minimumValue"+as}return null}}if(is==="minimumLocations")return"minimumLocation"+ns[0];if(is==="minimumValues")return"minimumValue"+ns[0];if(is.slice(0,7)==="minimum"){let as=Number(is.slice(7));if(Number.isInteger(as)&&as>0){if(ns[0]===1)return"minimumLocation"+as;if(ns[0]===2)return"minimumValue"+as}}return null},returnArraySizeDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"}}),returnArraySize({dependencyValues:ns}){return[ns.numberMinima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allMinima[as][os]}return{setValue:{minima:is}}}},rs.allMaxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:ns}){return ns.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["allMaxima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},domain:{dependencyType:"stateVariable",variableName:"domain"}}},definition:function({dependencyValues:ns}){if(ns.isInterpolatedFunction){let is=ns.xs,as=ns.coeffs,os=ts.eps,ls=[];if(is===null)return{setValue:{allMaxima:ls}};let us=!1,cs=-1/0,ps=1/0,ds=!1,fs=!1;if(ns.domain!==null){let bs=ns.domain[0];bs!==void 0&&(cs=Context.fromAst(bs.tree[1][1]).evaluate_to_constant(),Number.isFinite(cs)?ds=!bs.tree[2][1]:cs=-1/0,ps=Context.fromAst(bs.tree[1][2]).evaluate_to_constant(),Number.isFinite(ps)?fs=!bs.tree[2][2]:ps=1/0)}let hs=1e-14*Math.max(Math.abs(cs),Math.abs(ps)),ys=as[0],gs=is[1]-is[0];if(ys[3]===0){if(ys[2]<0){let bs=-ys[1]/(2*ys[2]);bs+is[0]>=cs-hs&&bs+is[0]<=ps+hs&&(bs<=gs-os?ds&&Math.abs(bs+is[0]-cs)<hs||fs&&Math.abs(bs+is[0]-ps)<hs||ls.push([bs+is[0],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]]):Math.abs(bs-gs)<os&&(us=!0))}}else{let bs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(bs>0){let vs=Math.sqrt(bs),Ns=(-2*ys[2]-vs)/(6*ys[3]);Ns+is[0]>=cs-hs&&Ns+is[0]<=ps+hs&&(Ns<=gs-os?ds&&Math.abs(Ns+is[0]-cs)<hs||fs&&Math.abs(Ns+is[0]-ps)<hs||ls.push([Ns+is[0],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]]):Math.abs(Ns-gs)<os&&(us=!0))}}for(let bs=1;bs<is.length-2;bs++)if(ys=as[bs],gs=is[bs+1]-is[bs],ys[3]===0)if(ys[2]<0){let vs=-ys[1]/(2*ys[2]);if(vs+is[bs]>=cs-hs)if(vs+is[bs]<=ps+hs)Math.abs(vs)<os?us&&(ds&&Math.abs(vs+is[bs]-cs)<hs||fs&&Math.abs(vs+is[bs]-ps)<hs||ls.push([vs+is[bs],((ys[3]*vs+ys[2])*vs+ys[1])*vs+ys[0]])):vs>=os&&vs<=gs-os&&(ds&&Math.abs(vs+is[bs]-cs)<hs||fs&&Math.abs(vs+is[bs]-ps)<hs||ls.push([vs+is[bs],((ys[3]*vs+ys[2])*vs+ys[1])*vs+ys[0]])),us=Math.abs(vs-gs)<os;else{us=!1;continue}}else us=!1;else{let vs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(vs>0){let Ns=Math.sqrt(vs),Ts=(-2*ys[2]-Ns)/(6*ys[3]);if(Ts+is[bs]>=cs-hs)if(Ts+is[bs]<=ps+hs)Math.abs(Ts)<os?us&&(ds&&Math.abs(Ts+is[bs]-cs)<hs||fs&&Math.abs(Ts+is[bs]-ps)<hs||ls.push([Ts+is[bs],((ys[3]*Ts+ys[2])*Ts+ys[1])*Ts+ys[0]])):Ts>=os&&Ts<=gs-os&&(ds&&Math.abs(Ts+is[bs]-cs)<hs||fs&&Math.abs(Ts+is[bs]-ps)<hs||ls.push([Ts+is[bs],((ys[3]*Ts+ys[2])*Ts+ys[1])*Ts+ys[0]])),us=Math.abs(Ts-gs)<os;else{us=!1;continue}}else us=!1}if(ys=as[is.length-2],ys[3]===0){if(ys[2]<0){let bs=-ys[1]/(2*ys[2]);bs+is[is.length-2]>=cs-hs&&bs+is[is.length-2]<=ps+hs&&(Math.abs(bs)<os?us&&(ds&&Math.abs(bs+is[is.length-2]-cs)<hs||fs&&Math.abs(bs+is[is.length-2]-ps)<hs||ls.push([bs+is[is.length-2],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]])):bs>=os&&(ds&&Math.abs(bs+is[is.length-2]-cs)<hs||fs&&Math.abs(bs+is[is.length-2]-ps)<hs||ls.push([bs+is[is.length-2],((ys[3]*bs+ys[2])*bs+ys[1])*bs+ys[0]])))}}else{let bs=4*ys[2]*ys[2]-12*ys[3]*ys[1];if(bs>0){let vs=Math.sqrt(bs),Ns=(-2*ys[2]-vs)/(6*ys[3]);Ns+is[is.length-2]>=cs-hs&&Ns+is[is.length-2]<=ps+hs&&(Ns>=os?ds&&Math.abs(Ns+is[is.length-2]-cs)<hs||fs&&Math.abs(Ns+is[is.length-2]-ps)<hs||ls.push([Ns+is[is.length-2],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]]):Math.abs(Ns)<os&&us&&(ds&&Math.abs(Ns+is[is.length-2]-cs)<hs||fs&&Math.abs(Ns+is[is.length-2]-ps)<hs||ls.push([Ns+is[is.length-2],((ys[3]*Ns+ys[2])*Ns+ys[1])*Ns+ys[0]])))}}return{setValue:{allMaxima:ls}}}else{if(ns.functionChild&&ns.functionChild.length>0)return{setValue:{allMaxima:ns.functionChild[0].stateValues.allMaxima}};if(!(ns.nInputs===1&&ns.nOutputs===1))return{setValue:{allMaxima:[]}};let is=ns.variables[0].subscripts_to_strings().tree,as=ns.formula.subscripts_to_strings().derivative(is),os,ls=!0,us;try{os=as.subscripts_to_strings().f()}catch{ls=!1,us=()=>NaN}ls&&(us=function(As){try{return os({[is]:As})}catch{return NaN}});let cs=As=>-ns.numericalf(As,!0),ps=-100*ns.xscale,ds=100*ns.xscale,fs=!1,hs=!1;if(ns.domain!==null){let As=ns.domain[0];As!==void 0&&(ps=Context.fromAst(As.tree[1][1]).evaluate_to_constant(),Number.isFinite(ps)?fs=!As.tree[2][1]:ps=-100*ns.xscale,ds=Context.fromAst(As.tree[1][2]).evaluate_to_constant(),Number.isFinite(ds)?hs=!As.tree[2][2]:ds=100*ns.xscale)}let ys=1e3,gs=(ds-ps)/ys,bs=1e-10*Math.max(Math.abs(ps),Math.abs(ds)),vs=[],Ns=!1,Ts=!1,Cs=cs(ps-gs),xs=us(ps-gs);for(let As=-1;As<ys+1;As++){let ws=ps+As*gs,Es=ps+(As+1)*gs,Ss=Cs;Cs=cs(Es);let Ds=xs;if(xs=us(Es),Number.isNaN(Ss)||Number.isNaN(Cs))continue;let Vs=!1;if(ls&&Ds*xs<=0){let Is;Ds===0?Is=ws:xs===0?Is=Es:Is=ts.fzero(us,[ws,Es]);let Ps=.5*1e-6*(Math.abs(Is)+1);us(Is-Ps)>0&&us(Is+Ps)<0&&(Vs=!0,Ns=!1,Is>=ps-bs&&Is<=ds+bs&&!(fs&&Math.abs(Is-ps)<bs||hs&&Math.abs(Is-ds)<bs)&&!(Ts&&Math.abs(Is-ws)<bs)?(vs.push([Is,-cs(Is)]),Ts=Math.abs(Is-Es)<bs):Ts=!1)}if(!Vs){Ts=!1;let Is=ts.fminbr(cs,[ws,Es],void 0,1e-6);if(Is.success!==!0)continue;let Os=Is.x,Ps=Is.fx;Ss<Ps?(Ns&&Number.isFinite(Ss)&&vs.push([ws,-Ss]),Ns=!1):Cs<Ps?Ns=!0:(Ns=!1,Ps<Cs&&Ps<Ss&&Ps<cs(Os+Is.tol)&&Ps<cs(Os-Is.tol)&&Number.isFinite(Ps)&&vs.push([Os,-Ps]))}}return{setValue:{allMaxima:vs}}}}},rs.numberMaxima={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:ns}){return{setValue:{numberMaxima:ns.allMaxima.length},checkForActualChange:{numberMaxima:!0}}}},rs.maxima={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(ns){return ns==="maximum"||ns===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]}},isArray:!0,nDimensions:2,entryPrefixes:["maximum","maximumLocations","maximumLocation","maximumValues","maximumValue"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(["maximum","maximumLocation","maximumValue"].includes(ns)){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?!as||os<as[0]?ns==="maximum"?[os+",0",os+",1"]:ns==="maximumLocation"?[os+",0"]:[os+",1"]:[]:[]}else return ns==="maximumLocations"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",0"):["0,0"]:ns==="maximumValues"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",1"):["0,1"]:[]},arrayVarNameFromArrayKey(ns){let[is,as]=ns.split(",");return as==="0"?"maximumLocation"+(Number(is)+1):"maximumValue"+(Number(is)+1)},arrayVarNameFromPropIndex(ns,is){if(is==="maxima"){if(ns.length===1)return"maximum"+ns[0];{let as=Number(ns[0]);if(Number.isInteger(as)&&as>0){if(ns[1]===1)return"maximumLocation"+as;if(ns[1]===2)return"maximumValue"+as}return null}}if(is==="maximumLocations")return"maximumLocation"+ns[0];if(is==="maximumValues")return"maximumValue"+ns[0];if(is.slice(0,7)==="maximum"){let as=Number(is.slice(7));if(Number.isInteger(as)&&as>0){if(ns[0]===1)return"maximumLocation"+as;if(ns[0]===2)return"maximumValue"+as}}return null},returnArraySizeDependencies:()=>({numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),returnArraySize({dependencyValues:ns}){return[ns.numberMaxima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allMaxima[as][os]}return{setValue:{maxima:is}}}},rs.numberExtrema={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"},numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),definition:function({dependencyValues:ns}){return{setValue:{numberExtrema:ns.numberMinima+ns.numberMaxima},checkForActualChange:{numberExtrema:!0}}}},rs.allExtrema={returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"},allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:ns}){return{setValue:{allExtrema:[...ns.allMinima,...ns.allMaxima].sort((as,os)=>as[0]-os[0])}}}},rs.extrema={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(ns){return ns==="extremum"||ns===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]}},isArray:!0,nDimensions:2,entryPrefixes:["extremum","extremumLocations","extremumLocation","extremumValues","extremumValue"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(["extremum","extremumLocation","extremumValue"].includes(ns)){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?!as||os<as[0]?ns==="extremum"?[os+",0",os+",1"]:ns==="extremumLocation"?[os+",0"]:[os+",1"]:[]:[]}else return ns==="extremumLocations"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",0"):["0,0"]:ns==="extremumValues"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",1"):["0,1"]:[]},arrayVarNameFromArrayKey(ns){let[is,as]=ns.split(",");return as==="0"?"extremumLocation"+(Number(is)+1):"extremumValue"+(Number(is)+1)},arrayVarNameFromPropIndex(ns,is){if(is==="extrema"){if(ns.length===1)return"extremum"+ns[0];{let as=Number(ns[0]);if(Number.isInteger(as)&&as>0){if(ns[1]===1)return"extremumLocation"+as;if(ns[1]===2)return"extremumValue"+as}return null}}if(is==="extremumLocations")return"extremumLocation"+ns[0];if(is==="extremumValues")return"extremumValue"+ns[0];if(is.slice(0,8)==="extremum"){let as=Number(is.slice(8));if(Number.isInteger(as)&&as>0){if(ns[0]===1)return"extremumLocation"+as;if(ns[0]===2)return"extremumValue"+as}}return null},returnArraySizeDependencies:()=>({numberExtrema:{dependencyType:"stateVariable",variableName:"numberExtrema"}}),returnArraySize({dependencyValues:ns}){return[ns.numberExtrema,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allExtrema:{dependencyType:"stateVariable",variableName:"allExtrema"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allExtrema[as][os]}return{setValue:{extrema:is}}}},rs.returnNumericalDerivatives={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:ns}){return ns.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}:{functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["returnNumericalDerivatives","variables"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}},definition:function({dependencyValues:ns}){if(ns.isInterpolatedFunction)return{setValue:{returnNumericalDerivatives:returnReturnDerivativesOfInterpolatedFunction(ns)}};if(ns.functionChild.length>0&&ns.functionChild[0].stateValues.returnNumericalDerivatives){let is=ns.variables.map(us=>us.subscripts_to_strings().tree),as=ns.functionChild[0].stateValues.variables,os=as.map(us=>us.subscripts_to_strings().tree),ls={};for(let[us,cs]of is.entries())os[us]&&os[us]!==cs&&(ls[cs]=as[us]);return Object.keys(ls).length===0?{setValue:{returnNumericalDerivatives:ns.functionChild[0].stateValues.returnNumericalDerivatives}}:{setValue:{returnNumericalDerivatives:function(cs){let ps=[];for(let ds of cs){let fs=ls[ds.subscripts_to_strings().tree];fs?ps.push(fs):ps.push(Context.fromAst(""))}return ns.functionChild[0].stateValues.returnNumericalDerivatives(ps)}}}}else return{setValue:{returnNumericalDerivatives:null}}}},rs.numericalDerivativesDefinition={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:ns}){return ns.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}:{functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalDerivativesDefinition","variables"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}},definition:function({dependencyValues:ns}){if(ns.isInterpolatedFunction)return{setValue:{numericalDerivativesDefinition:{derivativeType:"interpolatedFunction",xs:ns.xs,coeffs:ns.coeffs,variables:ns.variables}}};if(ns.functionChild.length>0&&ns.functionChild[0].stateValues.numericalDerivativesDefinition){let is=ns.variables.map(us=>us.subscripts_to_strings().tree),as=ns.functionChild[0].stateValues.variables,os=as.map(us=>us.subscripts_to_strings().tree),ls={};for(let[us,cs]of is.entries())os[us]&&os[us]!==cs&&(ls[cs]=as[us]);if(Object.keys(ls).length===0)return{setValue:{numericalDerivativesDefinition:ns.functionChild[0].stateValues.numericalDerivativesDefinition}};{let us={...ns.functionChild[0].stateValues.numericalDerivativesDefinition};return us.variableMappings?us.variableMappings=[ls,...us.variableMappings]:us.variableMappings=[ls],{setValue:{numericalDerivativesDefinition:us}}}}else return{setValue:{numericalDerivativesDefinition:{}}}}},rs}},Ms(Bl,"componentType","function"),Ms(Bl,"rendererType","math"),Ms(Bl,"primaryStateVariableForDefinition","numericalfShadow"),Ms(Bl,"adapters",[{stateVariable:"numericalf",componentType:"curve",stateVariablesToShadow:["label","labelHasLatex"]},{stateVariable:"formula",componentType:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}]),Bl);function calculateInterpolationPoints({dependencyValues:ss,numerics:ts}){let rs=[],ns=[],is={maximum:ss.prescribedMaxima,minimum:ss.prescribedMinima,extremum:ss.prescribedExtrema,point:ss.prescribedPoints};for(let xs in is)for(let As of is[xs]){let ws=null,Es=null,Ss=null;if(As.x!==null&&(ws=As.x.evaluate_to_constant(),!Number.isFinite(ws))){console.warn(`Ignoring non-numerical ${xs}`);continue}if(As.y!==null&&(Es=As.y.evaluate_to_constant(),!Number.isFinite(Es))){console.warn(`Ignoring non-numerical ${xs}`);continue}if(As.slope!==null&&As.slope!==void 0&&(Ss=As.slope.evaluate_to_constant(),Number.isFinite(Ss)||(console.warn("Ignoring non-numerical slope"),Ss=null)),ws===null){if(Es===null){console.warn(`Ignoring empty ${xs}`);continue}ns.push({type:xs,y:Es,slope:Ss})}else rs.push({type:xs,x:ws,y:Es,slope:Ss})}rs.sort((xs,As)=>xs.x-As.x),ns.sort((xs,As)=>xs.y-As.y);let as=-1/0,os=ts.eps;for(let xs=0;xs<rs.length;xs++){let As=rs[xs];if(As.x<=as+os)return console.warn("Two points with locations too close together.  Can't define function"),{setValue:{interpolationPoints:null}};as=As.x}let ls=ss.xscale,us=ss.yscale;as=void 0;let cs,ps,ds=[],fs=rs[0];for(let xs=0;xs<rs.length;xs++){let As=fs;fs=rs[xs+1];let ws=bs({p:As,pNext:fs,typePrev:ps,xPrev:as,yPrev:cs});ps=ws.type,as=ws.x,cs=ws.y}let hs=!1;for(rs.length===0&&(hs=!0);ns.length>0;){let xs;ps===void 0?xs=Cs({allowedTypes:["maximum","minimum","extremum"],comparison:"atLeast",value:-1/0}):ps==="maximum"?xs=Cs({allowedTypes:["minimum","extremum"],comparison:"atMost",value:cs-us}):ps==="minimum"?xs=Cs({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:cs+us}):ps==="point"&&(xs=Cs({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:cs+us}),xs.success!==!0&&(xs=Cs({allowedTypes:["minimum","extremum"],comparison:"atMost",value:cs-us})));let As;xs.success===!0?(As=xs.point,ns.splice(xs.ind,1),hs?(As.x=0,hs=!1):As.x=as+ls):(As=ns.pop(),hs?(As.x=0,hs=!1):As.x=as+2*ls);let ws=bs({p:As,typePrev:ps,xPrev:as,yPrev:cs});ps=ws.type,as=ws.x,cs=ws.y}if(ds.length===0&&ds.push({type:"point",x:0,y:0,slope:0}),hs=ds[0],hs.type==="maximum"){let xs={type:"point",x:hs.x-ls,y:hs.y-us,slope:2*us/ls};ds.splice(0,0,xs)}else if(hs.type==="minimum"){let xs={type:"point",x:hs.x-ls,y:hs.y+us,slope:-2*us/ls};ds.splice(0,0,xs)}else if(hs.type==="point")if(ds.length===1)hs.slope===null&&(hs.slope=0);else{let xs=ds[1],As=(xs.y-hs.y)/(xs.x-hs.x);if(xs.type==="maximum"||xs.type==="minimum")hs.slope===null&&(hs.slope=2*As);else{ds.length===2?hs.slope===null&&(hs.slope=As):(xs.slope===null&&(xs.slope=gs({point:xs,prevPoint:hs,nextPoint:ds[2]})),hs.slope===null&&(hs.slope=2*(hs.y-xs.y)/(hs.x-xs.x)-xs.slope));let ws={x:hs.x-ls,y:hs.y-ls*hs.slope,slope:hs.slope};ds.splice(0,0,ws)}}let ys=ds[ds.length-1];if(ys.type==="maximum"){let xs={type:"point",x:ys.x+ls,y:ys.y-us,slope:-2*us/ls};ds.push(xs)}else if(ys.type==="minimum"){let xs={type:"point",x:ys.x+ls,y:ys.y+us,slope:2*us/ls};ds.push(xs)}else if(ys.type==="point")if(ds.length===1){let xs={type:"point",x:ys.x+ls,y:ys.y+hs.slope*ls,slope:hs.slope};ds.push(xs)}else{let xs=ds[ds.length-2],As=(xs.y-ys.y)/(xs.x-ys.x);if(xs.type==="maximum"||xs.type==="minimum")ys.slope===null&&(ys.slope=2*As);else{ds.length===2?ys.slope===null&&(ys.slope=As):(xs.slope===null&&(xs.slope=gs({point:xs,prevPoint:ds[ds.length-3],nextPoint:ys})),ys.slope===null&&(ys.slope=2*(xs.y-ys.y)/(xs.x-ys.x)-xs.slope));let ws={x:ys.x+ls,y:ys.y+ls*ys.slope,slope:ys.slope};ds.push(ws)}}for(let xs=1;xs<ds.length-1;xs++){let As=ds[xs];As.slope===null&&(As.slope=gs({point:As,prevPoint:ds[xs-1],nextPoint:ds[xs+1]}))}return{setValue:{interpolationPoints:ds}};function gs({point:xs,prevPoint:As,nextPoint:ws}){let Es=xs.x-As.x,Ss=ws.x-xs.x,Ds=xs.y-As.y,Vs=ws.y-xs.y,Is=Ds/Es,Os=Vs/Ss,Ps=(Is*Ss+Os*Es)/(Es+Ss);return(Math.sign(Is)+Math.sign(Os))*Math.min(Math.abs(Is),Math.abs(Os),.5*Math.abs(Ps))}function bs({p:xs,pNext:As,typePrev:ws,xPrev:Es,yPrev:Ss}){let Ds;if(As!==void 0&&(Ds=As.y),xs.type==="maximum")return vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As});if(xs.type==="minimum")return Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As});if(xs.type==="extremum"){let Vs;if(ws===void 0){if(As===void 0)return vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As});Vs=As.type}if(ws==="maximum"||Vs==="maximum")return xs.y!==null&&xs.y>Ss-us?vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):Vs!==void 0&&xs.y!==null&&xs.y>As.y-us?vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As});if(ws==="minimum"||Vs==="minimum")return xs.y!==null&&xs.y<Ss+us?Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):Vs!==void 0&&xs.y!==null&&xs.y>As.y+us?Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As});if(ws==="point"||Vs==="point"){let Is="maximum";return(xs.y===null&&As!==void 0&&As.type===maximum||xs.y!==null&&xs.y<=Ss-us||Vs!==void 0&&xs.y!==null&&xs.y>=As.y-us)&&(Is="minimum"),Is==="minimum"?Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As})}else return xs.y!==null&&xs.y<As.y-us?Ns({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As}):vs({x:xs.x,y:xs.y,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As})}else if(xs.type==="point")return Ts({x:xs.x,y:xs.y,slope:xs.slope,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:As})}function vs({x:xs,y:As,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:Vs}){if(ws===void 0)As===null&&(Ds===void 0?As=0:Vs.type==="maximum"?As=Ds:As=Ds+us);else if(ws==="maximum"){As===null&&(Ds===void 0?As=Ss:Vs.type==="maximum"?As=Math.max(Ss,Ds):As=Math.max(Ss,Ds+us));let Os=Math.min(Ss,As)-us,Ps=(xs+Es)/2,$s,Rs,ks=null,_s=Cs({allowedTypes:["minimum","extremum"],comparison:"atMost",value:Os});_s.success===!0?(Rs="minimum",$s=_s.point.y,ns.splice(_s.ind,1),ks=0):(Rs="point",$s=Os),ds.push({type:Rs,x:Ps,y:$s,slope:ks})}else if(ws==="minimum"){if(As===null)Ds===void 0?As=Ss+us:Vs.type==="maximum"?As=Math.max(Ss+us,Ds):As=Math.max(Ss,Ds)+us;else if(As<Ss+us){let Os=[(2*Es+xs)/3,(Es+2*xs)/3],Ps=[Ss+us,As-us],$s=["atLeast","atMost"],Rs=[["maximum","extremum"],["minimum","extremum"]];for(let ks=0;ks<2;ks++){let _s=Os[ks],Bs,Us,zs=null,Hs=Cs({allowedTypes:Rs[ks],comparison:$s[ks],value:Ps[ks]});Hs.success===!0?(Us=Rs[ks][0],Bs=Hs.point.y,ns.splice(Hs.ind,1),zs=0):(Us="point",Bs=Ps[ks],zs=null),ds.push({type:Us,x:_s,y:Bs,slope:zs})}}}else if(ws==="point"){if(As===null)Ds===void 0?As=Ss+us:Vs.type==="maximum"?As=Math.max(Ss+us,Ds):As=Math.max(Ss,Ds)+us;else if(As<Ss+us){let Os=(xs+Es)/2,Ps,$s,Rs=null,ks=Cs({allowedTypes:["minimum","extremum"],comparison:"atMost",value:As-us});ks.success===!0?($s="minimum",Ps=ks.point.y,ns.splice(ks.ind,1),Rs=0):($s="point",Ps=As-us),ds.push({type:$s,x:Os,y:Ps,slope:Rs})}}let Is={type:"maximum",x:xs,y:As,slope:0};return ds.push(Is),Is}function Ns({x:xs,y:As,typePrev:ws,xPrev:Es,yPrev:Ss,yNext:Ds,pNext:Vs}){if(ws===void 0)As===null&&(Ds===void 0?As=0:Vs.type==="minimum"?As=Ds:As=Ds-us);else if(ws==="maximum"){if(As===null)Ds===void 0?As=Ss-us:Vs.type==="minimum"?As=Math.min(Ss-us,Ds):As=Math.min(Ss,Ds)-us;else if(As>Ss-us){let Os=[(2*Es+xs)/3,(Es+2*xs)/3],Ps=[Ss-us,As+us],$s=["atMost","atLeast"],Rs=[["minimum","extremum"],["maximum","extremum"]];for(let ks=0;ks<2;ks++){let _s=Os[ks],Bs,Us,zs=null,Hs=Cs({allowedTypes:Rs[ks],comparison:$s[ks],value:Ps[ks]});Hs.success===!0?(Us=Rs[ks][0],Bs=Hs.point.y,ns.splice(Hs.ind,1),zs=0):(Us="point",Bs=Ps[ks],zs=null),ds.push({type:Us,x:_s,y:Bs,slope:zs})}}}else if(ws==="minimum"){As===null&&(Ds===void 0?As=Ss:Vs.type==="minimum"?As=Math.min(Ss,Ds):As=Math.min(Ss,Ds-us));let Os=Math.max(Ss,As)+us,Ps=(xs+Es)/2,$s,Rs,ks=null,_s=Cs({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:Os});_s.success===!0?(Rs="maximum",$s=_s.point.y,ns.splice(_s.ind,1),ks=0):(Rs="point",$s=Os),ds.push({type:Rs,x:Ps,y:$s,slope:ks})}else if(ws==="point"){if(As===null)Ds===void 0?As=Ss-us:Vs.type==="minimum"?As=Math.min(Ss-us,Ds):As=Math.min(Ss,Ds)-us;else if(As>Ss-us){let Os=(xs+Es)/2,Ps,$s,Rs=null,ks=Cs({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:As+us});ks.success===!0?($s="maximum",Ps=ks.point.y,ns.splice(ks.ind,1),Rs=0):($s="point",Ps=As+us),ds.push({type:$s,x:Os,y:Ps,slope:Rs})}}let Is={type:"minimum",x:xs,y:As,slope:0};return ds.push(Is),Is}function Ts({x:xs,y:As,slope:ws,typePrev:Es,xPrev:Ss,yPrev:Ds,yNext:Vs,pNext:Is}){if(Es==="maximum"){if(As>Ds-us){let Ps=Math.min(Ds,As)-us,$s=(xs+Ss)/2,Rs,ks,_s=null,Bs=Cs({allowedTypes:["minimum","extremum"],comparison:"atMost",value:Ps});Bs.success===!0?(ks="minimum",Rs=Bs.point.y,ns.splice(Bs.ind,1),_s=0):(ks="point",Rs=Ds-us),ds.push({type:ks,x:$s,y:Rs,slope:_s})}}else if(Es==="minimum"&&As<Ds+us){let Ps=Math.max(Ds,As)+us,$s=(xs+Ss)/2,Rs,ks,_s=null,Bs=Cs({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:Ps});Bs.success===!0?(ks="maximum",Rs=Bs.point.y,ns.splice(Bs.ind,1),_s=0):(ks="point",Rs=Ds+us),ds.push({type:ks,x:$s,y:Rs,slope:_s})}let Os={type:"point",x:xs,y:As,slope:ws};return ds.push(Os),Os}function Cs({allowedTypes:xs,comparison:As,value:ws}){let Es=[];if(As==="atMost")Es=Object.keys(ns).reverse();else if(As==="atLeast")Es=Object.keys(ns);else return{success:!1};for(let Ss of xs)for(let Ds of Es){let Vs=ns[Ds];if(Vs.type===Ss){if(As==="atMost"){if(Vs.y<=ws)return{success:!0,ind:Ds,point:Vs}}else if(Vs.y>=ws)return{success:!0,ind:Ds,point:Vs}}}return{success:!1}}}function computeSplineParamCoeffs({dependencyValues:ss}){let ts=function(ls,us,cs,ps,ds){return[ls,cs,(-3*ls/ds+3*us/ds-2*cs-ps)/ds,(2*ls/ds-2*us/ds+cs+ps)/(ds*ds)]},rs=ss.interpolationPoints;if(rs===null)return{setValue:{xs:null,coeffs:null}};let ns=[],is=[],as,os=rs[0];is.push(os.x);for(let ls=1;ls<rs.length;ls++){as=os,os=rs[ls];let us=ts(as.y,os.y,as.slope,os.slope,os.x-as.x);Math.abs(us[3])<1e-14*Math.max(Math.abs(us[0]),Math.abs(us[1]),Math.abs(us[2]))&&(us[3]=0,Math.abs(us[2])<1e-14*Math.max(Math.abs(us[0]),Math.abs(us[1]))&&(us[2]=0)),ns.push(us),is.push(os.x)}return{setValue:{xs:is,coeffs:ns}}}class FunctionOperator extends Function$1{static returnSugarInstructions(){let ts=[],rs=function({matchedChildren:ns,componentInfoObjects:is}){let as=ps=>is.componentIsSpecifiedType(ps,"label");if(ns.length===0||!ns.every(ps=>{var ds;return typeof ps=="string"||((ds=ps.doenetAttributes)==null?void 0:ds.createdFromMacro)||as(ps)}))return{success:!1};let os=ns.map(as),ls=[],us=[],cs=[];if(os.filter(ps=>ps).length===0)ls=ns;else{if(os[0]){let ds=os.indexOf(!1);ds!==-1&&(us=ns.slice(0,ds),ns=ns.slice(ds),os=os.slice(ds))}let ps=os.indexOf(!0);ps===-1?ls=ns:(ls=ns.slice(0,ps),cs=ns.slice(ps))}return ls.length===0?{success:!1}:ls.length===1&&typeof ls[0]!="string"?{success:!1}:{success:!0,newChildren:[...us,{componentType:"math",children:ls},...cs]}};return ts.push({replacementFunction:rs}),ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts}),ns=this.componentType;rs.isInterpolatedFunction={returnDependencies:()=>({}),definition:()=>({setValue:{isInterpolatedFunction:!1}})},delete rs.nPrescribedPoints,delete rs.prescribedPoints,delete rs.prescribedMinima,delete rs.prescribedMaxima,delete rs.prescribedExtrema,delete rs.interpolationPoints,delete rs.xs,rs.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({setValue:{operatorBasedOnFormulaIfAvailable:!1}})},rs.formula.returnDependencies=()=>({}),rs.formula.definition=()=>({setValue:{formula:Context.fromAst("")}}),rs.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({setValue:{operatorComposesWithOriginal:!0}})},rs.symbolicFunctionOperator={returnDependencies:()=>({}),definition:()=>({setValue:{symbolicFunctionOperator:os=>Context.fromAst("")}})},rs.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({}),definition:()=>({setValue:{numericalFunctionOperator:os=>NaN,numericalFunctionOperatorArguments:[]}})},rs.formulaOperator={returnDependencies:()=>({}),definition:()=>({setValue:{formulaOperator:os=>Context.fromAst("")}})},rs.returnNumericalDerivatives={returnDependencies:()=>({}),definition:()=>({setValue:{returnNumericalDerivatives:null}})},rs.formula={public:!0,shadowingInstructions:{createComponentOfType:"math"},additionalStateVariablesDefined:["operatorBasedOnFormula"],returnDependencies:()=>({operatorBasedOnFormulaIfAvailable:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormulaIfAvailable"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["formula"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},formulaOperator:{dependencyType:"stateVariable",variableName:"formulaOperator"}}),definition:function({dependencyValues:os}){if(!os.operatorBasedOnFormulaIfAvailable||(os.functionChild.length===0||os.functionChild[0].stateValues.formula.tree==="")&&(os.mathChild.length===0||os.mathChild[0].stateValues.value.tree===""))return{setValue:{formula:Context.fromAst(""),operatorBasedOnFormula:!1}};let ls;return os.functionChild.length===0?ls=os.mathChild[0].stateValues.value:ls=os.functionChild[0].stateValues.formula,{setValue:{formula:os.formulaOperator(ls),operatorBasedOnFormula:!0}}}},rs.symbolicfs={isArray:!0,entryPrefixes:["symbolicf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:os}){return[os.nOutputs]},returnArrayDependenciesByKey:()=>({globalDependencies:{operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolicfs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},symbolicFunctionOperator:{dependencyType:"stateVariable",variableName:"symbolicFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}),arrayDefinitionByKey:function({globalDependencyValues:os,usedDefault:ls,arrayKeys:us,arraySize:cs}){if(os.operatorBasedOnFormula){let ps={};for(let ds of us)return ps[ds]=returnSymbolicFunctionFromFormula({formula:os.formula,simplify:os.simplify,expand:os.expand,nInputs:os.nInputs,variables:os.variables,domain:os.domain,component:ds}),{setValue:{symbolicfs:ps}}}else if(os.operatorComposesWithOriginal)if(os.functionChild.length===0)if(os.mathChild.length===0){let ps={};for(let ds of us)ps[ds]=fs=>Context.fromAst("");return{setValue:{symbolicfs:ps}}}else{let ps=Object.assign({},os);ps.formula=os.mathChild[0].stateValues.value;let ds=[];for(let hs=0;hs<cs[0];hs++)ds.push(returnSymbolicFunctionFromFormula({formula:ps.formula,simplify:ps.simplify,expand:ps.expand,nInputs:ps.nInputs,variables:ps.variables,domain:os.domain,component:hs}));let fs={};for(let hs of us)fs[hs]=(...ys)=>os.symbolicFunctionOperator(...ds.map(gs=>gs(...ys)));return{setValue:{symbolicfs:fs}}}else{let ps=[];for(let fs=0;fs<cs[0];fs++)ps.push(os.functionChild[0].stateValues.symbolicfs[fs]);let ds={};for(let fs of us)ds[fs]=(...hs)=>os.symbolicFunctionOperator(...ps.map(ys=>ys(...hs)));return{setValue:{symbolicfs:ds}}}else{let ps={};for(let ds of us)ps[ds]=(...fs)=>os.symbolicFunctionOperator(...fs);return{setValue:{symbolicfs:ps}}}}},rs.numericalfs={isArray:!0,entryPrefixes:["numericalf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:os}){return[os.nOutputs]},returnArrayDependenciesByKey:()=>({globalDependencies:{operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalfs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}),arrayDefinitionByKey:function({globalDependencyValues:os,usedDefault:ls,arrayKeys:us,arraySize:cs}){if(os.operatorBasedOnFormula){let ps={};for(let ds of us)return ps[ds]=returnNumericalFunctionFromFormula({formula:os.formula,nInputs:os.nInputs,variables:os.variables,domain:os.domain,component:ds}),{setValue:{numericalfs:ps}}}else if(os.operatorComposesWithOriginal)if(os.functionChild.length===0)if(os.mathChild.length===0){let ps={};for(let ds of us)ps[ds]=fs=>NaN;return{setValue:{numericalfs:ps}}}else{let ps=Object.assign({},os);ps.formula=os.mathChild[0].stateValues.value;let ds=[];for(let hs=0;hs<cs[0];hs++)ds.push(returnNumericalFunctionFromFormula({formula:os.formula,nInputs:os.nInputs,variables:os.variables,domain:os.domain,component:hs}));let fs={};for(let hs of us)fs[hs]=(...ys)=>os.numericalFunctionOperator(...ds.map(gs=>gs(...ys)));return{setValue:{numericalfs:fs}}}else{let ps=[];for(let fs=0;fs<cs[0];fs++)ps.push(os.functionChild[0].stateValues.numericalfs[fs]);let ds={};for(let fs of us)ds[fs]=(...hs)=>os.numericalFunctionOperator(...ps.map(ys=>ys(...hs)));return{setValue:{numericalfs:ds}}}else{let ps={};for(let ds of us)ps[ds]=(...fs)=>os.numericalFunctionOperator(...fs);return{setValue:{numericalfs:ps}}}}},rs.fDefinitions={isArray:!0,entryPrefixes:["fDefinition"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:os}){return[os.nOutputs]},returnArrayDependenciesByKey:()=>({globalDependencies:{operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["fDefinitions"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},numericalFunctionOperatorArguments:{dependencyType:"stateVariable",variableName:"numericalFunctionOperatorArguments"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}),arrayDefinitionByKey:function({globalDependencyValues:os,usedDefault:ls,arrayKeys:us,arraySize:cs}){if(os.operatorBasedOnFormula){let ps={};for(let ds of us)ps[ds]={functionType:"formula",formula:os.formula.tree,variables:os.variables.map(fs=>fs.tree),nInputs:os.nInputs,nOutputs:os.nOutputs,domain:os.domain,component:ds};return{setValue:{fDefinitions:ps}}}else if(os.operatorComposesWithOriginal)if(os.functionChild.length===0)if(os.mathChild.length===0){let ps={};for(let ds of us)ps[ds]={functionType:"formula",formula:"",variables:os.variables.map(fs=>fs.tree),nInputs:os.nInputs,nOutputs:os.nOutputs,domain:os.domain};return{setValue:{fDefinitions:ps}}}else throw Error("function operator with math child not implemented yet");else{let ps={};for(let ds of us)ps[ds]={functionType:"functionOperator",componentType:ns,nOutputs:os.nOutputs,functionOperatorArguments:os.numericalFunctionOperatorArguments,operatorComposesWithOriginal:!0,originalFDefinition:os.functionChild[0].stateValues.fDefinitions[ds]};return{setValue:{fDefinitions:ps}}}else if(os.functionChild.length===0)if(os.mathChild.length===0){let ps={};for(let ds of us)ps[ds]={functionType:"formula",formula:"",variables:os.variables.map(fs=>fs.tree),nInputs:os.nInputs,nOutputs:os.nOutputs,domain:os.domain};return{setValue:{fDefinitions:ps}}}else throw Error("function operator with math child not implemented yet");else{let ps={};for(let ds of us)ps[ds]={functionType:"functionOperator",componentType:ns,nOutputs:os.nOutputs,functionOperatorArguments:os.numericalFunctionOperatorArguments,operatorComposesWithOriginal:!1,originalFDefinition:os.functionChild[0].stateValues.fDefinitions[ds]};return{setValue:{fDefinitions:ps}}}}};let is=rs.allMinima.returnDependencies;rs.allMinima.returnDependencies=function(os){let ls=is(os);return delete ls.functionChild,ls};let as=rs.allMaxima.returnDependencies;return rs.allMaxima.returnDependencies=function(os){let ls=as(os);return delete ls.functionChild,ls},rs}}Ms(FunctionOperator,"componentType","_functionOperator");class ClampFunction extends FunctionOperator{static createAttributesObject(){let ts=super.createAttributesObject();return ts.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},ts.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:ns}){return{setValue:{numericalFunctionOperator:functionOperatorDefinitions.clampFunction(ns.lowerValue,ns.upperValue),numericalFunctionOperatorArguments:[ns.lowerValue,ns.upperValue]}}}},rs.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:ns}){return{setValue:{symbolicFunctionOperator:is=>Context.fromAst(ns.numericalFunctionOperator(is.evaluate_to_constant()))}}}},rs}}Ms(ClampFunction,"componentType","clampFunction");class WrapFunctionPeriodic extends FunctionOperator{static createAttributesObject(){let ts=super.createAttributesObject();return ts.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},ts.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:ns}){return{setValue:{numericalFunctionOperator:functionOperatorDefinitions.wrapFunctionPeriodic(ns.lowerValue,ns.upperValue),numericalFunctionOperatorArguments:[ns.lowerValue,ns.upperValue]}}}},rs.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:ns}){return{setValue:{symbolicFunctionOperator:is=>Context.fromAst(ns.numericalFunctionOperator(is.evaluate_to_constant()))}}}},rs}}Ms(WrapFunctionPeriodic,"componentType","wrapFunctionPeriodic");class Derivative extends FunctionOperator{static createAttributesObject(){let ts=super.createAttributesObject();return ts.derivVariables={createComponentOfType:"variables"},ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({setValue:{operatorBasedOnFormulaIfAvailable:!0}})},rs.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({setValue:{operatorComposesWithOriginal:!1}})},rs.haveFunctionChild={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"]}}),definition({dependencyValues:ns}){return{setValue:{haveFunctionChild:ns.functionChild.length>0}}}},rs.nInputs={defaultValue:1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},stateVariablesDeterminingDependencies:["haveFunctionChild"],returnDependencies({stateValues:ns}){let is={nInputsAttr:{dependencyType:"attributeComponent",attributeName:"nInputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nInputs"]},variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["nComponents"]}};return ns.haveFunctionChild||(is.derivVariablesAttr={dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]}),is},definition({dependencyValues:ns}){if(ns.nInputsAttr!==null){let is=ns.nInputsAttr.stateValues.value;return is>=0||(is=1),{setValue:{nInputs:is}}}else return ns.variablesAttr!==null?{setValue:{nInputs:Math.max(1,ns.variablesAttr.stateValues.nComponents)}}:ns.functionChild.length>0?{setValue:{nInputs:ns.functionChild[0].stateValues.nInputs}}:ns.derivVariablesAttr!==null?{setValue:{nInputs:[...new Set(ns.derivVariablesAttr.stateValues.variables.map(as=>as.subscripts_to_strings().tree))].length}}:{useEssentialOrDefaultValue:{nInputs:!0}}}},rs.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({nInputs:{dependencyType:"stateVariable",variableName:"nInputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nInputs]},stateVariablesDeterminingDependencies:["haveFunctionChild"],returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},haveFunctionChild:{dependencyType:"stateVariable",variableName:"haveFunctionChild"}},os={};if(is.haveFunctionChild)for(let ls of ns)os[ls]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["variable"+(Number(ls)+1)]}};else as.derivVariablesAttr={dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]};return{globalDependencies:as,dependenciesByKey:os}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arraySize:as,arrayKeys:os,usedDefault:ls}){if(ns.variablesAttr!==null){let us=ns.variablesAttr.stateValues.variables;return{setValue:{variables:returnNVariables(as[0],us)}}}else if(ns.haveFunctionChild){let us={};for(let cs of os)us[cs]=is[cs].functionChild[0].stateValues["variable"+(Number(cs)+1)];return{setValue:{variables:us}}}else if(ns.derivVariablesAttr!==null){let us=[],cs=[];for(let ps of ns.derivVariablesAttr.stateValues.variables){let ds=ps.subscripts_to_strings().tree;cs.includes(ds)||(us.push(ps),cs.push(ds))}return{setValue:{variables:returnNVariables(as[0],us)}}}else return ns.parentVariableForChild&&!ls.parentVariableForChild?{setValue:{variables:Array(as[0]).fill(ns.parentVariableForChild)}}:{setValue:{variables:returnNVariables(as[0],[])}}}},rs.nDerivatives={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies(){return{derivVariablesAttr:{dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["nComponents"]}}},definition({dependencyValues:ns}){return ns.derivVariablesAttr!==null?{setValue:{nDerivatives:ns.derivVariablesAttr.stateValues.nComponents}}:{setValue:{nDerivatives:1}}}},rs.derivVariables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["derivVariable"],returnArraySizeDependencies:()=>({nDerivatives:{dependencyType:"stateVariable",variableName:"nDerivatives"}}),returnArraySize({dependencyValues:ns}){return[ns.nDerivatives]},returnArrayDependenciesByKey(){return{globalDependencies:{derivVariablesAttr:{dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]},variable1:{dependencyType:"stateVariable",variableName:"variable1"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){return ns.derivVariablesAttr!==null?{setValue:{derivVariables:ns.derivVariablesAttr.stateValues.variables}}:{setValue:{derivVariables:{0:ns.variable1}}}}},rs.formulaOperator={returnDependencies:()=>({derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),definition({dependencyValues:ns}){return{setValue:{formulaOperator:function(is){let as=is.subscripts_to_strings();for(let os of ns.derivVariables)as=as.derivative(os.subscripts_to_strings().tree);return as.strings_to_subscripts()}}}}},rs.numericalFunctionOperator={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["returnNumericalDerivatives"],variablesOptional:!0},derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),additionalStateVariablesDefined:["returnNumericalDerivatives"],definition:function({dependencyValues:ns}){return ns.functionChild.length===0||!ns.functionChild[0].stateValues.returnNumericalDerivatives?{setValue:{numericalFunctionOperator:os=>NaN,returnNumericalDerivatives:null}}:{setValue:{numericalFunctionOperator:ns.functionChild[0].stateValues.returnNumericalDerivatives(ns.derivVariables),returnNumericalDerivatives:function(os){let ls=[...ns.derivVariables,...os];return ns.functionChild[0].stateValues.returnNumericalDerivatives(ls)}}}}},rs.numericalFunctionOperatorArguments={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalDerivativesDefinition"],variablesOptional:!0},derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),additionalStateVariablesDefined:["numericalDerivativesDefinition"],definition:function({dependencyValues:ns}){if(ns.functionChild.length===0||!ns.functionChild[0].stateValues.numericalDerivativesDefinition)return{setValue:{numericalFunctionOperatorArguments:[],numericalDerivativesDefinition:{}}};let is=ns.functionChild[0].stateValues.numericalDerivativesDefinition,as={...is};return as.additionalDerivVariables?as.additionalDerivVariables=[...ns.derivVariables,...as.additionalDerivVariables]:as.additionalDerivVariables=[...ns.derivVariables],{setValue:{numericalFunctionOperatorArguments:[is,ns.derivVariables],numericalDerivativesDefinition:as}}}},rs.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:ns}){return{setValue:{symbolicFunctionOperator:is=>Context.fromAst(ns.numericalFunctionOperator(is.evaluate_to_constant()))}}}},rs}}Ms(Derivative,"componentType","derivative");var FunctionOperators=Object.freeze({__proto__:null,ClampFunction,Derivative,WrapFunctionPeriodic});class TextBaseOperatorOfMath extends Text{static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=this;return ts.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}),definition:function({dependencyValues:ns}){return{setValue:{value:rs.applyTextOperator(ns.mathChildren.map(is=>is.stateValues.value))}}}},ts}}Ms(TextBaseOperatorOfMath,"componentType","_textOperatorOfMath"),Ms(TextBaseOperatorOfMath,"rendererType","text");class ExtractMathOperator extends TextBaseOperatorOfMath{static applyTextOperator(ts){return ts.length===0?"":ts.length!==1?(console.warn("MathOperator requires exactly one math child"),""):Array.isArray(ts[0].tree)?ts[0].tree[0]:""}}Ms(ExtractMathOperator,"componentType","extractMathOperator");var TextOperatorsOfMath=Object.freeze({__proto__:null,ExtractMathOperator});class Extremum extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.location={createComponentOfType:"math"},ts.value={createComponentOfType:"math"},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let os=returnBreakStringsSugarFunction({childrenToComponentFunction:ls=>({componentType:"math",children:ls}),mustStripOffOuterParentheses:!0})({matchedChildren:ns});if(!os.success&&ns.length===1)return{success:!0,newAttributes:{value:{component:{componentType:"math",children:ns}}}};if(os.success){if(os.newChildren.length===1)return{success:!0,newAttributes:{value:{component:os.newChildren[0]}}};if(os.newChildren.length===2){let ls=os.newChildren[0],us=os.newChildren[1],cs={location:{component:ls},value:{component:us}};return(ls.children.length===0||ls.children.length===1&&typeof ls.children[0]=="string"&&ls.children[0].trim()==="")&&delete cs.location,(us.children.length===0||us.children.length===1&&typeof us.children[0]=="string"&&us.children[0].trim()==="")&&delete cs.value,{success:!0,newAttributes:cs}}else return{success:!1}}return os};return ts.push({childrenRegex:/s+(.*s)?/,replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts}),ns=this;return rs.value={public:!0,shadowingInstructions:{createComponentOfType:"math"},defaultValue:null,hasEssential:!0,additionalStateVariablesDefined:[{variableName:"location",public:!0,shadowingInstructions:{createComponentOfType:"math"},defaultValue:null,hasEssential:!0}],returnDependencies:()=>({extremumChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions","xs"]},location:{dependencyType:"attributeComponent",attributeName:"location",variableNames:["value"]},value:{dependencyType:"attributeComponent",attributeName:"value",variableNames:["value"]}}),definition:function({dependencyValues:is}){let as,os;if(is.extremumChild.length>0){let fs=is.extremumChild[0];fs.stateValues.nDimensions!==2?(console.log("Cannot determine "+ns.componentType+" from a point that isn't 2D"),as=null,os=null):(as=fs.stateValues.xs[0],os=fs.stateValues.xs[1])}else is.location!==null&&(as=is.location.stateValues.value),is.value!==null&&(os=is.value.stateValues.value);let ls={},us={},cs=!1,ps=!1;as===void 0?(us.location=!0,ps=!0):(ls.location=as,cs=!0),os===void 0?(us.value=!0,ps=!0):(ls.value=os,cs=!0);let ds={};return cs&&(ds.setValue=ls),ps&&(ds.useEssentialOrDefaultValue=us),ds}},rs}}Ms(Extremum,"componentType","extremum"),Ms(Extremum,"rendererType");class Extrema extends BaseComponent{static get componentTypeCapitalized(){return this.componentType.charAt(0).toUpperCase()+this.componentType.slice(1)}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=this,ns=function({matchedChildren:is}){let as=breakEmbeddedStringsIntoParensPieces({componentList:is});return as.success!==!0?{success:!1}:{success:!0,newChildren:as.pieces.map(function(os){return os.length>1||typeof os[0]=="string"?{componentType:rs.componentTypeSingular,children:os}:os[0]})}};return ts.push({replacementFunction:ns}),ts}static returnChildGroups(){return[{group:"extrema",componentTypes:[this.componentTypeSingular]},{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=this;return ts["n"+rs.componentTypeCapitalized]={additionalStateVariablesDefined:["childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childGroups:["extrema","points"]}}),definition:function({dependencyValues:ns}){return{setValue:{["n"+rs.componentTypeCapitalized]:ns.children.length,childIdentities:ns.children}}}},ts[rs.componentType]={isArray:!0,nDimensions:2,entryPrefixes:[rs.componentTypeSingular,rs.componentTypeSingular+"Locations",rs.componentTypeSingular+"Location",rs.componentTypeSingular+"Values",rs.componentTypeSingular+"Value"],stateVariablesDeterminingDependencies:["childIdentities"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if([rs.componentTypeSingular,rs.componentTypeSingular+"Location",rs.componentTypeSingular+"Value"].includes(ns)){let os=Number(is)-1;return Number.isInteger(os)&&os>=0?!as||os<as[0]?ns===rs.componentTypeSingular?[os+",0",os+",1"]:ns===rs.componentTypeSingular+"Location"?[os+",0"]:[os+",1"]:[]:[]}else return ns===rs.componentTypeSingular+"Locations"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",0"):["0,0"]:ns===rs.componentTypeSingular+"Values"?is!==""?[]:as?Array.from(Array(as[0]),(os,ls)=>ls+",1"):["0,1"]:[]},arrayVarNameFromArrayKey(ns){let[is,as]=ns.split(",");return as==="0"?rs.componentTypeSingular+"Location"+(Number(is)+1):rs.componentTypeSingular+"Value"+(Number(is)+1)},arrayVarNameFromPropIndex(ns,is){if(is===rs.componentType){if(ns.length===1)return rs.componentTypeSingular+ns[0];{let os=Number(ns[0]);if(Number.isInteger(os)&&os>0){if(ns[1]===1)return rs.componentTypeSingular+"Location"+os;if(ns[1]===2)return rs.componentTypeSingular+"Value"+os}return null}}if(is===rs.componentTypeSingular+"Locations")return rs.componentTypeSingular+"Location"+ns[0];if(is===rs.componentTypeSingular+"Values")return rs.componentTypeSingular+"Value"+ns[0];let as=rs.componentTypeSingular.length;if(is.slice(0,as)===rs.componentTypeSingular){let os=Number(is.slice(as));if(Number.isInteger(os)&&os>0){if(ns[0]===1)return rs.componentTypeSingular+"Location"+os;if(ns[0]===2)return rs.componentTypeSingular+"Value"+os}}return null},returnArraySizeDependencies:()=>({nChildren:{dependencyType:"stateVariable",variableName:"n"+rs.componentTypeCapitalized}}),returnArraySize({dependencyValues:ns}){return[ns.nChildren,2]},returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={};for(let os of ns){let[ls,us]=os.split(","),cs;is.childIdentities[ls].componentType===rs.componentTypeSingular?cs=Number(us)===0?"location":"value":cs="x"+(Number(us)+1),as[os]={child:{dependencyType:"child",childGroups:["extrema","points"],variableNames:[cs],childIndices:[ls]}}}return{dependenciesByKey:as}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].child[0];if(ls){let us=os.split(",")[1],cs=Number(us)===0?"location":"value";cs in ls.stateValues?as[os]=ls.stateValues[cs]:as[os]=ls.stateValues["x"+(Number(us)+1)]}}return{setValue:{[rs.componentType]:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is}){let as=[];for(let os in ns[rs.componentType])as.push({setDependency:is[os].extremumChild,desiredValue:ns[rs.componentType][os],childIndex:0,variableIndex:0});return{success:!0,instructions:as}}},ts}}Ms(Extrema,"componentType","extrema"),Ms(Extrema,"rendererType"),Ms(Extrema,"componentTypeSingular","extremum");var Extrema$1=Object.freeze({__proto__:null,Extrema,Extremum});class InlineRenderInlineChildren extends InlineComponent{static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=this;return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:ns}){let is="";for(let as of ns.inlineChildren)typeof as!="object"?is+=as.toString():typeof as.stateValues.text=="string"?is+=as.stateValues.text:is+=" ";return is=rs.beginTextDelimiter+is+rs.endTextDelimiter,{setValue:{text:is}}}},ts}}Ms(InlineRenderInlineChildren,"componentType","_inlineRenderInlineChildren"),Ms(InlineRenderInlineChildren,"renderChildren",!0),Ms(InlineRenderInlineChildren,"includeBlankStringChildren",!0),Ms(InlineRenderInlineChildren,"beginTextDelimiter",""),Ms(InlineRenderInlineChildren,"endTextDelimiter","");class Em extends InlineRenderInlineChildren{}Ms(Em,"componentType","em");class Alert extends InlineRenderInlineChildren{}Ms(Alert,"componentType","alert");let Q$2=(Xl=class extends InlineRenderInlineChildren{},Ms(Xl,"componentType","q"),Ms(Xl,"beginTextDelimiter",'"'),Ms(Xl,"endTextDelimiter",'"'),Xl);class SQ extends InlineRenderInlineChildren{}Ms(SQ,"componentType","sq"),Ms(SQ,"beginTextDelimiter","'"),Ms(SQ,"endTextDelimiter","'");class Term extends InlineRenderInlineChildren{}Ms(Term,"componentType","term"),Ms(Term,"rendererType","alert");let C$2=(pu=class extends InlineRenderInlineChildren{},Ms(pu,"componentType","c"),pu);class Tag extends InlineRenderInlineChildren{}Ms(Tag,"componentType","tag"),Ms(Tag,"rendererType","tag"),Ms(Tag,"beginTextDelimiter","<"),Ms(Tag,"endTextDelimiter",">");class Tage extends InlineRenderInlineChildren{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.selfClosed={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{selfClosed:!0}})},ts}}Ms(Tage,"componentType","tage"),Ms(Tage,"rendererType","tag"),Ms(Tage,"beginTextDelimiter","<"),Ms(Tage,"endTextDelimiter","/>");class Attr extends InlineRenderInlineChildren{}Ms(Attr,"componentType","attr"),Ms(Attr,"rendererType","c");var ParagraphMarkup=Object.freeze({__proto__:null,Alert,Attr,C:C$2,Em,Q:Q$2,SQ,Tag,Tage,Term});class SingleCharacter extends InlineComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({}),definition:()=>({setValue:{text:this.unicodeCharacter}})},ts}}Ms(SingleCharacter,"componentType","_singleCharacterInline"),Ms(SingleCharacter,"unicodeCharacter","");class Ndash extends SingleCharacter{}Ms(Ndash,"componentType","ndash"),Ms(Ndash,"unicodeCharacter","");class Mdash extends SingleCharacter{}Ms(Mdash,"componentType","mdash"),Ms(Mdash,"unicodeCharacter","");class NBSP extends SingleCharacter{}Ms(NBSP,"componentType","nbsp"),Ms(NBSP,"unicodeCharacter","");class Ellipsis extends SingleCharacter{}Ms(Ellipsis,"componentType","ellipsis"),Ms(Ellipsis,"unicodeCharacter","");var SingleCharacterComponents=Object.freeze({__proto__:null,Ellipsis,Mdash,NBSP,Ndash});class BlockComponent extends BaseComponent{}Ms(BlockComponent,"componentType","_block");function returnDefaultFeedbackDefinitions(){return{numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."}}function returnFeedbackDefinitionStateVariables(){let ss={};return ss.setupChildren={returnDependencies:()=>({setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}}),definition({dependencyValues:ts}){return{setValue:{setupChildren:ts.setupChildren}}}},ss.feedbackDefinitions={stateVariablesDeterminingDependencies:["setupChildren"],returnDependencies({stateValues:ts}){let rs={ancestorWithFeedback:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}};for(let ns of ts.setupChildren)rs[`feedbackDefinitionsOf${ns.componentName}`]={dependencyType:"child",parentName:ns.componentName,childGroups:["feedbackDefinitions"],variableNames:["value"]};return rs},definition({dependencyValues:ts}){let rs={},ns;ts.ancestorWithFeedback&&(ns=ts.ancestorWithFeedback.stateValues.feedbackDefinitions),ns||(ns=returnDefaultFeedbackDefinitions()),Object.assign(rs,ns);let is=[];for(let as of ts.setupChildren)is.push(...ts[`feedbackDefinitionsOf${as.componentName}`]);for(let as of is)Object.assign(rs,as.stateValues.value);return{setValue:{feedbackDefinitions:rs}}}},ss}class SectioningComponent extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{submitAllAnswers:this.submitAllAnswers.bind(this),revealSection:this.revealSection.bind(this),closeSection:this.closeSection.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.aggregateScores={createComponentOfType:"boolean",createStateVariable:"aggregateScores",defaultValue:!1,public:!0},ts.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},ts.sectionWideCheckWork={createComponentOfType:"boolean",createStateVariable:"sectionWideCheckWork",defaultValue:!1,public:!0},ts.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},ts.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},ts.boxed={createComponentOfType:"boolean",createStateVariable:"boxed",defaultValue:!1,public:!0,forRenderer:!0},ts.suppressAutoName={createComponentOfType:"boolean",createStateVariable:"suppressAutoName",defaultValue:!1,public:!0},ts.suppressAutoNumber={createComponentOfType:"boolean",createStateVariable:"suppressAutoNumber",defaultValue:!1,public:!0},ts.includeAutoName={createComponentOfType:"boolean",createStateVariable:"includeAutoName",defaultValue:!1,public:!0},ts.includeAutoNumber={createComponentOfType:"boolean",createStateVariable:"includeAutoNumber",defaultValue:!1,public:!0},ts.includeAutoNameNumberIfNoTitle={createComponentOfType:"boolean",createStateVariable:"includeAutoNameNumberIfNoTitle",defaultValue:!0,public:!0},ts.includeParentNumber={createComponentOfType:"boolean",createStateVariable:"includeParentNumber",defaultValue:!1,public:!0},ts.level={createComponentOfType:"integer"},ts}static returnChildGroups(){return[{group:"variantControls",componentTypes:["variantControl"]},{group:"titles",componentTypes:["title"]},{group:"setups",componentTypes:["setup"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnStyleDefinitionStateVariables();Object.assign(ts,rs);let ns=returnFeedbackDefinitionStateVariables();return Object.assign(ts,ns),ts.enumeration={additionalStateVariablesDefined:[{variableName:"sectionNumber",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["enumeration"]},includeParentNumber:{dependencyType:"stateVariable",variableName:"includeParentNumber"}}),definition({dependencyValues:is}){let as=[];return is.includeParentNumber&&is.sectionAncestor&&as.push(...is.sectionAncestor.stateValues.enumeration),as.push(is.countAmongSiblings),{setValue:{enumeration:as,sectionNumber:as.join(".")}}}},ts.sectionName={returnDependencies:()=>({}),definition:()=>({setValue:{sectionName:"Section"}})},ts.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition({dependencyValues:is}){let as=null;return is.titleChild.length>0&&(as=is.titleChild[is.titleChild.length-1].componentName),{setValue:{titleChildName:as}}}},ts.childIndicesToRender={returnDependencies:()=>({titleChildren:{dependencyType:"child",childGroups:["titles"]},allChildren:{dependencyType:"child",childGroups:["anything","variantControls","titles","setups"]},titleChildName:{dependencyType:"stateVariable",variableName:"titleChildName"}}),definition({dependencyValues:is}){let as=[],os=is.titleChildren.map(ls=>ls.componentName);for(let[ls,us]of is.allChildren.entries())(typeof us!="object"||!os.includes(us.componentName)||us.componentName===is.titleChildName)&&as.push(ls);return{setValue:{childIndicesToRender:as}}}},ts.title={additionalStateVariablesDefined:[{variableName:"titlePrefix",forRenderer:!0,alwaysUpdateRenderer:!0}],public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,alwaysUpdateRenderer:!0,returnDependencies:({sharedParameters:is})=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]},sectionName:{dependencyType:"stateVariable",variableName:"sectionName"},sectionNumber:{dependencyType:"stateVariable",variableName:"sectionNumber"},includeAutoName:{dependencyType:"stateVariable",variableName:"includeAutoName"},includeAutoNumber:{dependencyType:"stateVariable",variableName:"includeAutoNumber"},prerender:{dependencyType:"value",value:is.prerender},includeAutoNameNumberIfNoTitle:{dependencyType:"stateVariable",variableName:"includeAutoNameNumberIfNoTitle"}}),definition({dependencyValues:is}){let as="",os="";const ls=is.titleChild.length>0;let us=(is.includeAutoNumber||!ls&&is.includeAutoNameNumberIfNoTitle)&&!is.prerender,cs=is.includeAutoName||!ls&&is.includeAutoNameNumberIfNoTitle;return us?(cs&&(as=is.sectionName+" "),as+=is.sectionNumber):cs&&(as=is.sectionName),ls?(as&&(is.includeAutoName?as+=": ":as+=". "),os=is.titleChild[is.titleChild.length-1].stateValues.text):os=as,{setValue:{title:os,titlePrefix:as}}}},ts.containerTag={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{containerTag:"section"}})},ts.level={forRenderer:!0,returnDependencies:()=>({ancestorLevel:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["level"]},levelAttr:{dependencyType:"attributeComponent",attributeName:"level",variableNames:["value"]}}),definition({dependencyValues:is}){var os,ls;let as=(os=is.levelAttr)==null?void 0:os.stateValues.value;return as>0||(as=(((ls=is.ancestorLevel)==null?void 0:ls.stateValues.level)||0)+1),{setValue:{level:as}}}},ts.viewedSolution={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:!0}}),inverseDefinition({desiredStateVariableValues:is}){return{success:!0,instructions:[{setEssentialValue:"viewedSolution",value:is.viewedSolution}]}}},ts.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer","setup"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:is}){let as=[];for(let os of is.scoredDescendants)os.componentType!=="setup"&&(os.stateValues.aggregateScores||os.stateValues.scoredDescendants===void 0?as.push(os):as.push(...os.stateValues.scoredDescendants));return{setValue:{scoredDescendants:as}}}},ts.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition({dependencyValues:is}){return{setValue:{answerDescendants:is.answerDescendants}}}},ts.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition({dependencyValues:is}){return{setValue:{justSubmitted:is.answerDescendants.every(as=>as.stateValues.justSubmitted)}}}},ts.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition({dependencyValues:is}){return{setValue:{showCorrectness:is.showCorrectnessFlag!==!1}}}},ts.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({setValue:{displayDigitsForCreditAchieved:3}})},ts.creditAchieved={public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},forRenderer:!0,defaultValue:0,hasEssential:!0,additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},defaultValue:0,hasEssential:!0}],stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:is}){let as={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(is.aggregateScores){as.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[os,ls]of is.scoredDescendants.entries())as["creditAchieved"+os]={dependencyType:"stateVariable",componentName:ls.componentName,variableName:"creditAchieved"}}return as},definition({dependencyValues:is}){if(!is.aggregateScores)return{setValue:{creditAchieved:0,percentCreditAchieved:0}};let as=0,os=0;for(let[cs,ps]of is.scoredDescendants.entries()){let ds=ps.stateValues.weight;as+=is["creditAchieved"+cs]*ds,os+=ds}let ls;os>0?ls=as/os:ls=1;let us=ls*100;return{setValue:{creditAchieved:ls,percentCreditAchieved:us}}}},ts.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:is}){let as={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(is.aggregateScores){as.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[os,ls]of is.scoredDescendants.entries())as["creditAchievedIfSubmit"+os]={dependencyType:"stateVariable",componentName:ls.componentName,variableName:"creditAchievedIfSubmit"}}return as},definition({dependencyValues:is}){if(!is.aggregateScores)return{setValue:{creditAchievedIfSubmit:0}};let as=0,os=0;for(let[us,cs]of is.scoredDescendants.entries()){let ps=cs.stateValues.weight;as+=is["creditAchievedIfSubmit"+us]*ps,os+=ps}return{setValue:{creditAchievedIfSubmit:as/os}}}},ts.generatedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({sharedParameters:is,componentInfoObjects:as})=>({variantSeed:{dependencyType:"value",value:is.variantSeed},variantIndex:{dependencyType:"value",value:is.variantIndex},variantName:{dependencyType:"value",value:is.variantName},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(as.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:is,componentName:as}){let os={};is.variantName?(os.index=is.variantIndex,os.name=is.variantName):os.seed=is.variantSeed,os.meta={createdBy:as};let ls=os.subvariants=[];for(let us of is.variantDescendants)us.stateValues.isVariantComponent?ls.push(us.stateValues.generatedVariantInfo):us.stateValues.generatedVariantInfo&&ls.push(...us.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:os,isVariantComponent:!0}}}},ts.collapsible={forRenderer:!0,returnDependencies:()=>({}),definition(){return{setValue:{collapsible:!1}}}},ts.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!0,hasEssential:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:!0}}},inverseDefinition({desiredStateVariableValues:is}){return{success:!0,instructions:[{setEssentialValue:"open",value:is.open}]}}},ts.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"suppressAnswerSubmitButtons",forRenderer:!0}],returnDependencies:()=>({sectionWideCheckWork:{dependencyType:"stateVariable",variableName:"sectionWideCheckWork"},aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons"]},documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["suppressAnswerSubmitButtons"]}}),definition({dependencyValues:is,componentName:as}){let os=!1,ls=!1;return is.documentAncestor.stateValues.suppressAnswerSubmitButtons||is.sectionAncestor&&is.sectionAncestor.stateValues.suppressAnswerSubmitButtons?ls=!0:is.sectionWideCheckWork&&(is.aggregateScores?(os=!0,ls=!0):console.warn(`Cannot create submit all button for ${as} because it doesn't aggegrate scores`)),{setValue:{createSubmitAllButton:os,suppressAnswerSubmitButtons:ls}}}},ts.suppressCheckwork={forRenderer:!0,returnDependencies:()=>({autoSubmit:{dependencyType:"flag",flagName:"autoSubmit"}}),definition({dependencyValues:is}){return{setValue:{suppressCheckwork:is.autoSubmit}}}},ts}async submitAllAnswers({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{creditAchieved:await this.stateValues.creditAchievedIfSubmit}});let is=await this.stateValues.answerDescendants;for(let[as,os]of await this.stateValues.answerDescendants.entries())await os.stateValues.justSubmitted||await this.coreFunctions.performAction({componentName:os.componentName,actionName:"submitAnswer",args:{actionId:ts,sourceInformation:rs,skipRendererUpdate:ns||as<is-1}});this.coreFunctions.resolveAction({actionId:ts})}async revealSection({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],overrideReadOnly:!0,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}async closeSection({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],overrideReadOnly:!0,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){var ls;if(!((ls=ts.variants)!=null&&ls.allPossibleVariants)){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns,useSubpartVariantRng:!0});return}let is=ts.variants.numberOfVariants,as,os=ts.variants.desiredVariant;if(os!==void 0&&os.index!==void 0){let us=Number(os.index);if(!Number.isFinite(us))console.warn("Variant index "+os.index+" must be a number"),as=1;else{Number.isInteger(us)||(console.warn("Variant index "+os.index+" must be an integer"),us=Math.round(us));let cs=(us-1)%is;cs<0&&(cs+=is),as=cs+1}}if(as===void 0){let us=rs.variantRng();as=Math.floor(us*is)+1}if(rs.allPossibleVariants=ts.variants.allPossibleVariants,rs.allVariantNames=ts.variants.allVariantNames,rs.variantSeed=ts.variants.allPossibleVariantSeeds[as-1],rs.variantIndex=as,rs.variantName=ts.variants.allPossibleVariants[as-1],rs.uniqueIndex=ts.variants.allPossibleVariantUniqueIndices[as-1],rs.variantRng=new rs.rngClass(rs.variantSeed),rs.subpartVariantRng=new rs.rngClass(rs.variantSeed+"s"),os!=null&&os.subvariants&&ns)for(let us in os.subvariants){let cs=os.subvariants[us],ps=ns[us];if(ps===void 0)break;ps.variants.desiredVariant=cs}}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){return determineVariantsForSection({serializedComponent:ts,componentInfoObjects:rs})}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){if(!ts.variants.allPossibleVariants)return super.getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns});let is=ts.variants.allPossibleVariantUniqueIndices[rs-1];if(is===void 0)return{success:!1};if(!ts.variants.uniqueVariants)return{success:!0,desiredVariant:{index:rs}};let as=getVariantsForDescendantsForUniqueVariants({variantIndex:is,serializedComponent:ts,componentInfoObjects:ns});return as.success?(ts.variants.selectedUniqueVariant=!0,{success:!0,desiredVariant:{index:rs,subvariants:as.desiredVariants}}):(console.log("Failed to get unique variant for section."),{success:!1})}}Ms(SectioningComponent,"componentType","_sectioningComponent"),Ms(SectioningComponent,"renderChildren",!0),Ms(SectioningComponent,"includeBlankStringChildren",!0),Ms(SectioningComponent,"createsVariants",!0);class Section extends SectioningComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.includeParentNumber.defaultValue=!0,ts}}Ms(Section,"componentType","section"),Ms(Section,"rendererType","section");class Subsection extends Section{}Ms(Subsection,"componentType","subsection");class Subsubsection extends Section{}Ms(Subsubsection,"componentType","subsubsection");class Paragraphs extends SectioningComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.level.definition=()=>({setValue:{level:4}}),ts.sectionName.definition=()=>({setValue:{sectionName:"Paragraphs"}}),ts}}Ms(Paragraphs,"componentType","paragraphs"),Ms(Paragraphs,"rendererType","section");class Aside extends SectioningComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.collapsible={createComponentOfType:"boolean",createStateVariable:"collapsible",defaultValue:!0,public:!0,forRenderer:!0},ts.startOpen={createComponentOfType:"boolean",createStateVariable:"startOpen",defaultValue:!1},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.collapsible,ts.open.returnDependencies=()=>({startOpen:{dependencyType:"stateVariable",variableName:"startOpen"}}),ts.open.definition=({dependencyValues:rs})=>({useEssentialOrDefaultValue:{open:{defaultValue:rs.startOpen}}}),ts.level.definition=()=>({setValue:{level:3}}),ts.containerTag.definition=()=>({setValue:{containerTag:"aside"}}),ts.sectionName.definition=()=>({setValue:{sectionName:"Aside"}}),ts}}Ms(Aside,"componentType","aside"),Ms(Aside,"rendererType","section");class Problem extends SectioningComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.aggregateScores.defaultValue=!0,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.sectionName.definition=()=>({setValue:{sectionName:"Problem"}}),ts}}Ms(Problem,"componentType","problem"),Ms(Problem,"rendererType","section");class Exercise extends Problem{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.sectionName.definition=()=>({setValue:{sectionName:"Exercise"}}),ts}}Ms(Exercise,"componentType","exercise"),Ms(Exercise,"rendererType","section");class Example extends SectioningComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.sectionName.definition=()=>({setValue:{sectionName:"Example"}}),ts}}Ms(Example,"componentType","example"),Ms(Example,"rendererType","section");class StandinForFutureLayoutTag extends SectioningComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.level.definition=()=>({setValue:{level:3}}),ts.containerTag.definition=()=>({setValue:{containerTag:"aside"}}),ts}}Ms(StandinForFutureLayoutTag,"componentType","standinForFutureLayoutTag"),Ms(StandinForFutureLayoutTag,"rendererType","section");class externalContent extends SectioningComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.includeAutoNameNumberIfNoTitle.defaultValue=!1,ts}}Ms(externalContent,"componentType","externalContent"),Ms(externalContent,"rendererType","section");var Sectioning=Object.freeze({__proto__:null,Aside,Example,Exercise,Paragraphs,Problem,Section,StandinForFutureLayoutTag,Subsection,Subsubsection,externalContent});class Ol extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:null,public:!0,forRenderer:!0},ts.level={createComponentOfType:"integer"},ts}static returnChildGroups(){return[{group:"lis",componentTypes:["li"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!0}})},ts.level={forRenderer:!0,returnDependencies:()=>({ancestorLevel:{dependencyType:"ancestor",componentType:"ol",variableNames:["level"]},levelAttr:{dependencyType:"attributeComponent",attributeName:"level",variableNames:["value"]}}),definition({dependencyValues:rs}){var is,as;let ns=(is=rs.levelAttr)==null?void 0:is.stateValues.value;return ns>0||(ns=(((as=rs.ancestorLevel)==null?void 0:as.stateValues.level)||0)+1),{setValue:{level:ns}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Ol,"componentType","ol"),Ms(Ol,"rendererType","list"),Ms(Ol,"renderChildren",!0);class Ul extends Ol{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!1}})},ts}}Ms(Ul,"componentType","ul"),Ms(Ul,"rendererType","list");let Li$1=(Ll=class extends BaseComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.item={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{item:!0}})},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}},Ms(Ll,"componentType","li"),Ms(Ll,"rendererType","list"),Ms(Ll,"renderChildren",!0),Ms(Ll,"includeBlankStringChildren",!0),Ll);var Lists=Object.freeze({__proto__:null,Li:Li$1,Ol,Ul});class ODESystem extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.independentVariable={createComponentOfType:"variable",createStateVariable:"independentVariable",defaultValue:Context.fromAst("t"),public:!0},ts.initialIndependentVariableValue={createComponentOfType:"math",createStateVariable:"initialIndependentVariableValue",defaultValue:Context.fromAst(0),public:!0},ts.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:14,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.renderMode={createComponentOfType:"text",createStateVariable:"renderMode",defaultValue:"align",public:!0,forRenderer:!0},ts.chunkSize={createComponentOfType:"number",createStateVariable:"chunkSize",defaultValue:10,public:!0},ts.tolerance={createComponentOfType:"number",createStateVariable:"tolerance",defaultValue:1e-6,public:!0},ts.maxIterations={createComponentOfType:"number",createStateVariable:"maxIterations",defaultValue:1e3,public:!0},ts.hideInitialCondition={createComponentOfType:"boolean",createStateVariable:"hideInitialCondition",defaultValue:!1,public:!0},ts.initialConditions={createComponentOfType:"mathList"},ts.variables={createComponentOfType:"variables"},ts.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!1,public:!0},ts}static returnChildGroups(){return[{group:"rightHandSides",componentTypes:["rightHandSide"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.validIndependentVariable={returnDependencies:()=>({independentVarAttr:{dependencyType:"attributeComponent",attributeName:"independentVariable",variableNames:["validVariable"]}}),definition({dependencyValues:rs}){let ns=!0;return rs.independentVarAttr&&(ns=rs.independentVarAttr.stateValues.validVariable),{setValue:{validIndependentVariable:ns}}}},ts.nDimensions={returnDependencies:()=>({rhsChildren:{dependencyType:"child",childGroups:["rightHandSides"],skipComponentNames:!0}}),definition:function({dependencyValues:rs}){return{setValue:{nDimensions:rs.rhsChildren.length},checkForActualChange:{nDimensions:!0}}}},ts.variables={additionalStateVariablesDefined:[{variableName:"validVariables",isArray:!0,entryPrefixes:["validVar"]}],isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},variables:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables","validVariables"]},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns=[],is=[],as=rs.nDimensions;rs.variables!==null&&(ns=rs.variables.stateValues.variables,is=[...rs.variables.stateValues.validVariables].slice(0,as));let os=returnNVariables(as,ns);return os.some(ls=>ls.equals(rs.independentVariable))&&console.warn("Variables of odesystem must be different than independent variable."),is.length<as&&is.push(...Array(as-is.length).fill(!0)),{setValue:{variables:os,validVariables:is}}}},ts.rhss={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["rhs","righthandside"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={rhsChild:{dependencyType:"child",childGroups:["rightHandSides"],variableNames:["value"],childIndices:[is]}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs[as].rhsChild[0].stateValues.value;return{setValue:{rhss:is}}}},ts.rhs={isAlias:!0,targetVariableName:"rhs1"},ts.righthandside={isAlias:!0,targetVariableName:"rhs1"},ts.righthandsides={isAlias:!0,targetVariableName:"rhss"},ts.initialConditions={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["initialCondition"],defaultValueByArrayKey:()=>Context.fromAst(0),returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={initialConditionAttr:{dependencyType:"attributeComponent",attributeName:"initialConditions",variableNames:[`math${Number(is)+1}`]}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={},as={};for(let ls of ns){let us=!1;if(rs[ls].initialConditionAttr){let cs=rs[ls].initialConditionAttr.stateValues[`math${Number(ls)+1}`];cs!==void 0&&(us=!0,is[ls]=cs)}us||(as[ls]=!0)}let os={};return Object.keys(is).length>0&&(os.setValue={initialConditions:is}),Object.keys(as).length>0&&(os.useEssentialOrDefaultValue={initialConditions:as}),os}},ts.initialCondition={isAlias:!0,targetVariableName:"initialCondition1"},ts.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],returnDependencies({stateValues:rs}){return rs.number?{equationCounter:{dependencyType:"counter",counterName:"equation"}}:{}},definition({dependencyValues:rs}){return rs.equationCounter!==void 0?{setValue:{equationTag:String(rs.equationCounter)}}:{setValue:{equationTag:null}}}},ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies(){return{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},variables:{dependencyType:"stateVariable",variableName:"variables"},initialConditions:{dependencyType:"stateVariable",variableName:"initialConditions"},hideInitialCondition:{dependencyType:"stateVariable",variableName:"hideInitialCondition"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},initialIndependentVariableValue:{dependencyType:"stateVariable",variableName:"initialIndependentVariableValue"},rhss:{dependencyType:"stateVariable",variableName:"rhss"},number:{dependencyType:"stateVariable",variableName:"number"},equationTag:{dependencyType:"stateVariable",variableName:"equationTag"}}},definition({dependencyValues:rs,usedDefault:ns}){let is={};rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits));let as=[],os=rs.independentVariable.toLatex();for(let us=0;us<rs.nDimensions;us++){let cs=rs.variables[us].toLatex(),ps=roundForDisplay({value:rs.rhss[us],dependencyValues:rs,usedDefault:ns}),ds=`\\frac{d${cs}}{d${os}} &=  ${ps.toLatex(is)}`;rs.number&&us===0?ds+=`\\tag{${rs.equationTag}}`:ds+="\\notag",as.push(ds)}if(!rs.hideInitialCondition){let us=rs.initialIndependentVariableValue;for(let cs=0;cs<rs.nDimensions;cs++){let ps=rs.variables[cs].toLatex(),ds=roundForDisplay({value:rs.initialConditions[cs],dependencyValues:rs,usedDefault:ns});as.push(`${ps}(${us}) &= ${ds.toLatex(is)}\\notag`)}}return{setValue:{latex:as.join("\\\\")}}}},ts.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:rs}){return{setValue:{latexWithInputChildren:[rs.latex]}}}},ts.numericalRHSf={additionalStateVariablesDefined:["numericalRHSfDefinitions"],returnDependencies:()=>({validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},rhss:{dependencyType:"stateVariable",variableName:"rhss"}}),definition({dependencyValues:rs}){let ns=!0;rs.validIndependentVariable||(console.warn("Can't define ODE RHS functions with invalid independent variable."),ns=!1),rs.validVariables.every(ls=>ls)||(console.warn("Can't define ODE RHS functions with an invalid variable."),ns=!1);let is=rs.independentVariable.subscripts_to_strings().tree,as=rs.variables.map(ls=>ls.subscripts_to_strings().tree);as.includes(is)&&(console.warn("Can't define ODE RHS functions when independent variable is a dependent variable"),ns=!1),[...new Set(as)].length!==as.length&&(console.warn("Can't define ODE RHS functions with duplicate dependent variable names"),ns=!1);let os;try{os=rs.rhss.map(ls=>ls.subscripts_to_strings().f())}catch{console.warn("Cannot define ODE RHS function.  Error creating mathjs function"),ns=!1}if(!ns){let ls=rs.rhss.length;return{setValue:{numericalRHSf:()=>NaN,numericalRHSfDefinitions:Array(ls).fill({})}}}return{setValue:{numericalRHSf:function(ls,us){let cs={[is]:ls};Array.isArray(us)?us.forEach((ps,ds)=>cs[as[ds]]=ps):cs[as[0]]=us;try{return os.map(ps=>ps(cs))}catch{return NaN}},numericalRHSfDefinitions:rs.rhss.map(ls=>({functionType:"formula",formula:ls,nInputs:as.length+1,variables:[is,...as]}))}}}},ts.haveNumericalInitialConditions={additionalStateVariablesDefined:["t0","x0s"],returnDependencies:()=>({initialIndependentVariableValue:{dependencyType:"stateVariable",variableName:"initialIndependentVariableValue"},initialConditions:{dependencyType:"stateVariable",variableName:"initialConditions"}}),definition({dependencyValues:rs}){let ns=rs.initialIndependentVariableValue.evaluate_to_constant(),is=rs.initialConditions.map(os=>os.evaluate_to_constant()),as=Number.isFinite(ns)&&is.every(os=>Number.isFinite(os));return{setValue:{t0:ns,x0s:is,haveNumericalInitialConditions:as}}}},ts.numericalSolutions={isArray:!0,entryPrefixes:["numericalSolution"],public:!0,shadowingInstructions:{createComponentOfType:"function",addStateVariablesShadowingStateVariables:{fDefinitions:{stateVariableToShadow:"numericalSolutionFDefinitions"}}},createWorkspace:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},chunkSize:{dependencyType:"stateVariable",variableName:"chunkSize"},tolerance:{dependencyType:"stateVariable",variableName:"tolerance"},maxIterations:{dependencyType:"stateVariable",variableName:"maxIterations"},haveNumericalInitialConditions:{dependencyType:"stateVariable",variableName:"haveNumericalInitialConditions"},t0:{dependencyType:"stateVariable",variableName:"t0"},x0s:{dependencyType:"stateVariable",variableName:"x0s"},numericalRHSf:{dependencyType:"stateVariable",variableName:"numericalRHSf"}}}},arrayDefinitionByKey({globalDependencyValues:rs,workspace:ns,componentName:is}){let as={};if(ns.calculatedNumericSolutions=[],ns.endingNumericalValues=[],ns.maxPossibleTime=void 0,!rs.haveNumericalInitialConditions){for(let fs=0;fs<rs.nDimensions;fs++)as[fs]=hs=>NaN;return{setValue:{numericalSolutions:as}}}let os=rs.t0,ls=rs.x0s,us=rs.chunkSize,cs=rs.tolerance,ps=rs.numericalRHSf,ds=rs.maxIterations;for(let fs=0;fs<rs.nDimensions;fs++)as[fs]=function(ys){if(!Number.isFinite(ys))return NaN;if(ys===os)return ls[fs];let gs=ns.calculatedNumericSolutions.length,bs=Math.ceil((ys-os)/us)-1;if(bs<0)return NaN;if(ns.maxPossibleTime===void 0&&bs>=gs)for(let Ns=gs;Ns<=bs;Ns++){let Ts=ns.endingNumericalValues[Ns-1];Ts===void 0&&(Ts=ls);let Cs=os+Ns*us,xs=Context.math.dopri(Cs,Cs+us,Ts,ps,cs,ds);ns.endingNumericalValues.push(xs.y[xs.y.length-1]),ns.calculatedNumericSolutions.push(xs.at.bind(xs));let As=xs.x[xs.x.length-1];if(As<(Cs+us)*(1-1e-6)){ns.maxPossibleTime=As;let ws="For chunksize "+us+" and tolerance "+cs+", odesystem";is!==void 0&&(ws+=" ("+is+")"),ws+=" hit maxiterations ("+ds+") at t = "+ns.maxPossibleTime+". Will not calculate solution beyond that time. Decrease chunksize, increase maxiterations, or increase tolerance to calculate further.";break}}return ys>ns.maxPossibleTime?NaN:ns.calculatedNumericSolutions[bs](ys)[fs]};return{setValue:{numericalSolutions:as}}}},ts.numericalSolution={isAlias:!0,targetVariableName:"numericalSolution1"},ts.numericalSolutionFDefinitions={forRenderer:!0,isArray:!0,entryPrefixes:["numericalSolutionFDefinition"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},chunkSize:{dependencyType:"stateVariable",variableName:"chunkSize"},tolerance:{dependencyType:"stateVariable",variableName:"tolerance"},maxIterations:{dependencyType:"stateVariable",variableName:"maxIterations"},haveNumericalInitialConditions:{dependencyType:"stateVariable",variableName:"haveNumericalInitialConditions"},t0:{dependencyType:"stateVariable",variableName:"t0"},x0s:{dependencyType:"stateVariable",variableName:"x0s"},numericalRHSfDefinitions:{dependencyType:"stateVariable",variableName:"numericalRHSfDefinitions"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return rs.haveNumericalInitialConditions?{setValue:{numericalSolutionFDefinitions:[...Array(rs.nDimensions).keys()].map(ns=>({functionType:"ODESolution",nDimensions:rs.nDimensions,t0:rs.t0,x0s:rs.x0s,chunkSize:rs.chunkSize,tolerance:rs.tolerance,numericalRHSfDefinitions:rs.numericalRHSfDefinitions,maxIterations:rs.maxIterations,component:ns}))}}:{setValue:{numericalSolutionFDefinitions:Array(rs.nDimensions).fill({})}}}},ts}}Ms(ODESystem,"componentType","odesystem"),Ms(ODESystem,"rendererType","math");class Polyline extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{movePolyline:this.movePolyline.bind(this),finalizePolylinePosition:this.finalizePolylinePosition.bind(this),polylineClicked:this.polylineClicked.bind(this),mouseDownOnPolyline:this.mouseDownOnPolyline.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.verticesDraggable={createComponentOfType:"boolean"},ts.vertices={createComponentOfType:"_pointListComponent"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" polyline"}}}},ts.verticesDraggable={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({verticesDraggableAttr:{dependencyType:"attributeComponent",attributeName:"verticesDraggable",variableNames:["value"]},draggable:{dependencyType:"stateVariable",variableName:"draggable"}}),definition({dependencyValues:rs}){return rs.verticesDraggableAttr?{setValue:{verticesDraggable:rs.verticesDraggableAttr.stateValues.value}}:{useEssentialOrDefaultValue:{verticesDraggable:{defaultValue:rs.draggable}}}}},ts.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:rs}){return rs.vertices!==null?{setValue:{nVertices:rs.vertices.stateValues.nPoints}}:{setValue:{nVertices:0}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies(){return{vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nDimensions"]}}},definition:function({dependencyValues:rs}){return rs.vertices!==null?{setValue:{nDimensions:rs.vertices.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{setValue:{nDimensions:2}}}},ts.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="vertexX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},getAllArrayKeys(rs,ns=!0,is){function as(os){if(os.length===1)return Array.from(Array(os[0]),(ls,us)=>String(us));{let ls=os[0],us=as(os.slice(1)),cs=[];for(let ps=0;ps<ls;ps++)ns?cs.push(...us.map(ds=>ps+","+ds)):cs.push(us.map(ds=>ps+","+ds));return cs}}if(is){if(is.length===0||!rs)return[];{let os=[...rs];return os[0]=is[0],as(os)}}else return!rs||rs.length===0?[]:as(rs)},arrayVarNameFromPropIndex(rs,ns){if(ns==="vertices")return rs.length===1?"vertex"+rs[0]:`vertexX${rs[0]}_${rs[1]}`;if(ns.slice(0,6)==="vertex"){let is=Number(ns.slice(6));if(Number.isInteger(is)&&is>0)return`vertexX${is}_${rs[0]}`}return null},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nVertices,rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let[as,os]=is.split(","),ls=Number(as)+1+"_"+(Number(os)+1);ns[is]={vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+ls]}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let[os,ls]=as.split(","),us=Number(os)+1+"_"+(Number(ls)+1),cs=rs[as].vertices;cs!==null&&cs.stateValues["pointX"+us]?is[as]=cs.stateValues["pointX"+us]:is[as]=Context.fromAst("")}return{setValue:{vertices:is}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyValuesByKey:ns,dependencyNamesByKey:is,initialChange:as,stateValues:os}){let ls=[];for(let us in rs.vertices){let[cs,ps]=us.split(","),ds=Number(cs)+1+"_"+(Number(ps)+1);if(ns[us].vertices!==null&&ns[us].vertices.stateValues["pointX"+ds])ls.push({setDependency:is[us].vertices,desiredValue:rs.vertices[us],variableIndex:0});else return{success:!1}}return{success:!0,instructions:ls}}},ts.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:rs}){return[rs.nVertices]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(is)+1)}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].vertex.map(ls=>ls.evaluate_to_constant());os.every(ls=>Number.isFinite(ls))||(os=Array(os.length).fill(NaN)),is[as]=os}return{setValue:{numericalVertices:is}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:rs}){var ds,fs,hs,ys;let ns=rs.nDimensions,is=rs.nVertices,as=rs.numericalVertices,os=[],ls,us,cs=(ds=as[0])==null?void 0:ds[0],ps=(fs=as[0])==null?void 0:fs[1];for(let gs=1;gs<is;gs++)if(ls=cs,us=ps,cs=(hs=as[gs])==null?void 0:hs[0],ps=(ys=as[gs])==null?void 0:ys[1],!(Number.isFinite(ls)&&Number.isFinite(us)&&Number.isFinite(cs)&&Number.isFinite(ps)))os.push(null);else{let bs=cs-ls,vs=ps-us;bs===0&&vs===0?os.push(null):os.push([bs,vs])}return{setValue:{nearestPoint:function({variables:gs,scales:bs}){var Vs,Is;let vs=bs[0],Ns=bs[1];if(ns!==2||is===0)return{};let Ts=1/0,Cs={},xs=(Vs=gs.x1)==null?void 0:Vs.evaluate_to_constant(),As=(Is=gs.x2)==null?void 0:Is.evaluate_to_constant(),ws,Es,Ss=as[0][0],Ds=as[0][1];for(let Os=1;Os<is;Os++){ws=Ss,Es=Ds,Ss=as[Os][0],Ds=as[Os][1];let Ps=os[Os-1];if(Ps===null)continue;let $s=Ps[0]/vs,Rs=Ps[1]/Ns,ks=$s*$s+Rs*Rs,_s=((xs-ws)/vs*$s+(As-Es)/Ns*Rs)/ks,Bs;_s<=0?Bs={x1:ws,x2:Es}:_s>=1?Bs={x1:Ss,x2:Ds}:Bs={x1:ws+_s*$s*vs,x2:Es+_s*Rs*Ns};let Us=Math.pow((xs-Bs.x1)/vs,2)+Math.pow((As-Bs.x2)/Ns,2);Us<Ts&&(Ts=Us,Cs=Bs)}return gs.x3!==void 0&&Object.keys(Cs).length>0&&(Cs.x3=0),Cs}}}}},ts}async movePolyline({pointCoords:ts,transient:rs,sourceDetails:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){if(Object.keys(ts).length===1){if(!await this.stateValues.verticesDraggable)return await this.coreFunctions.resolveAction({actionId:is})}else if(!await this.stateValues.draggable)return await this.coreFunctions.resolveAction({actionId:is});let us={};for(let cs in ts)us[cs+",0"]=Context.fromAst(ts[cs][0]),us[cs+",1"]=Context.fromAst(ts[cs][1]);return rs?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:us,sourceDetails:ns}],transient:rs,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:us,sourceDetails:ns}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:ts}}})}async finalizePolylinePosition({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.actions.movePolyline({pointCoords:await this.stateValues.numericalVertices,transient:!1,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}async polylineClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnPolyline({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Polyline,"componentType","polyline");class CobwebPolyline extends Polyline{static createAttributesObject(){let ts=super.createAttributesObject();return ts.attractThreshold={createComponentOfType:"number",createStateVariable:"attractThreshold",defaultValue:.5,public:!0},ts.nPoints={createComponentOfType:"number",createStateVariable:"nPoints",defaultValue:1,public:!0,clamp:[0,1/0],forRenderer:!0},ts.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:Context.fromAst("x"),public:!0,forRenderer:!0},ts.nIterationsRequired={createComponentOfType:"number",createStateVariable:"nIterationsRequired",defaultValue:0,public:!0},ts.initialPoint={createComponentOfType:"point"},ts.function={createComponentOfType:"function"},ts.lockToSolution={createComponentOfType:"boolean",createStateVariable:"lockToSolution",defaultValue:!1},ts.defaultPoint={createComponentOfType:"point"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nDimensions.returnDependencies=()=>({}),ts.nDimensions.definition=()=>({setValue:{nDimensions:2}}),ts.initialPoint={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="initialPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},entryPrefixes:["initialPointX"],defaultValueByArrayKey:()=>Context.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let as=Number(is)+1;ns[is]={initialPointAttr:{dependencyType:"attributeComponent",attributeName:"initialPoint",variableNames:["x"+as]}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={},as={};for(let ls of ns){let us=Number(ls)+1;rs[ls].initialPointAttr?is[ls]=rs[ls].initialPointAttr.stateValues["x"+us]:as[ls]=!0}let os={};return Object.keys(is).length>0&&(os.setValue={initialPoint:is}),Object.keys(as).length>0&&(os.useEssentialOrDefaultValue={initialPoint:as}),os},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyValuesByKey:ns,dependencyNamesByKey:is}){let as=[];for(let os in rs.initialPoint)ns[os].initialPointAttr&&ns[os].initialPointAttr.stateValues["x"+(Number(os)+1)]?as.push({setDependency:is[os].initialPointAttr,desiredValue:rs.initialPoint[os],variableIndex:0}):as.push({setEssentialValue:"initialPoint",value:{[os]:rs.initialPoint[os]}});return{success:!0,instructions:as}}},ts.f={additionalStateVariablesDefined:[{variableName:"fDefinition",forRenderer:!0}],returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["numericalf","fDefinition"]}}),definition({dependencyValues:rs}){return rs.functionAttr?{setValue:{f:rs.functionAttr.stateValues.numericalf,fDefinition:rs.functionAttr.stateValues.fDefinition}}:{setValue:{f:null,fDefinition:null}}}},ts.nVertices={isAlias:!0,targetVariableName:"nPoints"},ts.nOriginalVertices={providePreviousValuesInDefinition:!0,returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:rs,previousValues:ns}){let is=rs.nVertices;return ns.nOriginalVertices>is&&(is=ns.nOriginalVertices),{setValue:{nOriginalVertices:is}}}},ts.originalVertices={isArray:!0,nDimensions:2,hasEssential:!0,entryPrefixes:["originalVertexX","originalVertex"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="originalVertexX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="originalVertices")return rs.length===1?"originalVertex"+rs[0]:`originalVertexX${rs[0]}_${rs[1]}`;if(ns.slice(0,14)==="originalVertex"){let is=Number(ns.slice(14));if(Number.isInteger(is)&&is>0)return`originalVertexX${is}_${rs[0]}`}return null},returnArraySizeDependencies:()=>({nOriginalVertices:{dependencyType:"stateVariable",variableName:"nOriginalVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nOriginalVertices-1,rs.nDimensions]},returnArrayDependenciesByKey:()=>({globalDependencies:{graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]},defaultPoint:{dependencyType:"attributeComponent",attributeName:"defaultPoint",variableNames:["xs"]}}}),arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=as.split(",").map(Number);is[as]={get defaultValue(){if(rs.defaultPoint){let ls=rs.defaultPoint.stateValues.xs;if(ls.length===2&&os[1]<2)return ls[os[1]]}if(rs.graphAncestor){if(os[1]===0){let ls=rs.graphAncestor.stateValues.xmin,us=rs.graphAncestor.stateValues.xmax;return Context.fromAst((ls+us)/2)}else if(os[1]===1){let ls=rs.graphAncestor.stateValues.ymin,us=rs.graphAncestor.stateValues.ymax;return Context.fromAst((ls+us)/2)}}return Context.fromAst(0)}}}return{useEssentialOrDefaultValue:{originalVertices:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns=[];for(let is in rs.originalVertices)ns.push({setEssentialValue:"originalVertices",value:{[is]:rs.originalVertices[is]}});return{success:!0,instructions:ns}}},ts.vertices.additionalStateVariablesDefined=[{variableName:"prelimCorrectVertices",entryPrefixes:["prelimCorrectVertexX","prelimCorrectVertex"],getArrayKeysFromVarName:function({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="prelimCorrectVertexX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}}}],ts.vertices.basedOnArrayKeyStateVariables=!0,ts.vertices.returnArrayDependenciesByKey=function({arrayKeys:rs}){let ns={f:{dependencyType:"stateVariable",variableName:"f"},attractThreshold:{dependencyType:"stateVariable",variableName:"attractThreshold"},lockToSolution:{dependencyType:"stateVariable",variableName:"lockToSolution"}},is={};for(let as of rs){let[os,ls]=as.split(",");os==="0"?is[as]={initialPoint:{dependencyType:"stateVariable",variableName:"initialPointX"+(Number(ls)+1)}}:is[as]={originalVertexX1:{dependencyType:"stateVariable",variableName:"originalVertexX"+os+"_1"},originalVertexX2:{dependencyType:"stateVariable",variableName:"originalVertexX"+os+"_2"},previousVertexX1:{dependencyType:"stateVariable",variableName:"vertexX"+os+"_1"},previousVertexX2:{dependencyType:"stateVariable",variableName:"vertexX"+os+"_2"}}}return{globalDependencies:ns,dependenciesByKey:is}},ts.vertices.arrayDefinitionByKey=function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let ls of is){let[us,cs]=ls.split(",");if(us==="0")as[ls]=ns[ls].initialPoint,os[ls]=null;else{let ps,ds;try{ps=[ns[ls].originalVertexX1.evaluate_to_constant(),ns[ls].originalVertexX2.evaluate_to_constant()],ds=[ns[ls].previousVertexX1.evaluate_to_constant(),ns[ls].previousVertexX2.evaluate_to_constant()]}catch{as[us+",0"]=Context.fromAst(0),as[us+",1"]=Context.fromAst(0),os[us+",0"]=!1;continue}let fs;if(Number(us)%2===1){let ys=rs.f(ds[0]);fs=[ds[0],ys]}else fs=[ds[1],ds[1]];Math.pow(ps[0]-fs[0],2)+Math.pow(ps[1]-fs[1],2)<rs.attractThreshold*rs.attractThreshold||rs.lockToSolution?(as[us+",0"]=Context.fromAst(fs[0]),as[us+",1"]=Context.fromAst(fs[1]),os[us+",0"]=!0):(as[us+",0"]=ns[ls].originalVertexX1,as[us+",1"]=ns[ls].originalVertexX2,os[us+",0"]=!1),os[us+",1"]=null}}return{setValue:{vertices:as,prelimCorrectVertices:os}}},ts.vertices.inverseArrayDefinitionByKey=async function({desiredStateVariableValues:rs,dependencyNamesByKey:ns,initialChange:is,stateValues:as}){if(is&&!await as.draggable)return{success:!1};let os=[];for(let ls in rs.vertices){let[us,cs]=ls.split(",");us==="0"?os.push({setDependency:ns[ls].initialPoint,desiredValue:rs.vertices[ls]}):os.push({setDependency:ns[ls]["originalVertexX"+(Number(cs)+1)],desiredValue:rs.vertices[ls]})}return{success:!0,instructions:os}},ts.correctVertices={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},entryPrefixes:["correctVertex"],returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:rs}){return[rs.nVertices-1]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={prelimCorrectVertex:{dependencyType:"stateVariable",variableName:"prelimCorrectVertexX"+(Number(is)+2)+"_1"}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs[as].prelimCorrectVertex;return{setValue:{correctVertices:is}}}},ts.fractionCorrectVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"nGradedVertices",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"nCorrectVertices",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({correctVertices:{dependencyType:"stateVariable",variableName:"correctVertices"}}),definition({dependencyValues:rs}){let ns=rs.correctVertices.length,is,as;return ns===0?(is=0,as=0):(as=rs.correctVertices.reduce((os,ls)=>os+ls,0),is=as/ns),{setValue:{fractionCorrectVertices:is,nGradedVertices:ns,nCorrectVertices:as}}}},ts.fractionCorrectVerticesAdjusted={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"nGradedVerticesAdjusted",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({nCorrectVertices:{dependencyType:"stateVariable",variableName:"nCorrectVertices"},nGradedVertices:{dependencyType:"stateVariable",variableName:"nGradedVertices"},nIterationsRequired:{dependencyType:"stateVariable",variableName:"nIterationsRequired"}}),definition({dependencyValues:rs}){let ns=0;rs.nIterationsRequired>0&&(ns=2*rs.nIterationsRequired-1);let is=Math.max(rs.nGradedVertices,ns),as;return is===0?as=0:as=rs.nCorrectVertices/is,{setValue:{fractionCorrectVerticesAdjusted:as,nGradedVerticesAdjusted:is}}}},ts.nIterateValues={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:rs})=>({setValue:{nIterateValues:Math.ceil((rs.nVertices+1)/2)}})},ts.iterateValues={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["iterateValue"],returnArraySizeDependencies:()=>({nIterateValues:{dependencyType:"stateVariable",variableName:"nIterateValues"}}),returnArraySize({dependencyValues:rs}){return[rs.nIterateValues]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)is==="0"?ns[is]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX1_1"}}:ns[is]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX"+2*Number(is)+"_2"}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs[as].iterateValue;return{setValue:{iterateValues:is}}}},ts}}Ms(CobwebPolyline,"componentType","cobwebPolyline"),Ms(CobwebPolyline,"rendererType","cobwebPolyline");class Point extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{movePoint:this.movePoint.bind(this),switchPoint:this.switchPoint.bind(this),pointClicked:this.pointClicked.bind(this),mouseDownOnPoint:this.mouseDownOnPoint.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.x={createComponentOfType:"math"},ts.y={createComponentOfType:"math"},ts.z={createComponentOfType:"math"},ts.xs={createComponentOfType:"mathList"},ts.coords={createComponentOfType:"coords"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},ts.showCoordsWhenDragging={createComponentOfType:"boolean",createStateVariable:"showCoordsWhenDragging",defaultValue:!0,public:!0,forRenderer:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){let os=returnBreakStringsSugarFunction({childrenToComponentFunction:fs=>({componentType:"math",children:fs}),mustStripOffOuterParentheses:!0}),ls=ns.map(fs=>typeof fs),us=ls.indexOf("string"),cs=ls.lastIndexOf("string");if(us===-1){let fs=is.componentIsSpecifiedType,hs=ns.filter(ys=>!(fs(ys,"point")||fs(ys,"vector")||fs(ys,"constraints")||fs(ys,"label")));if(hs.length===1){let ys=hs[0],gs=ns.indexOf(ys),bs=[...ns.slice(0,gs),...ns.slice(gs+1)];return{success:!0,newAttributes:{coords:{component:{componentType:"math",children:hs}}},newChildren:bs}}else return{success:!1}}let ps=[...ns.slice(0,us),...ns.slice(cs+1)];ns=ns.slice(us,cs+1);let ds=os({matchedChildren:ns});return!ds.success&&ns.length===1?{success:!0,newAttributes:{xs:{component:{componentType:"mathList",children:[{componentType:"math",children:ns}]}}},newChildren:ps}:ds.success?{success:!0,newAttributes:{xs:{component:{componentType:"mathList",children:ds.newChildren,skipSugar:!0}}},newChildren:ps}:{success:!1}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){let ts=super.returnChildGroups();return ts.push({group:"points",componentTypes:["point"]},{group:"vectors",componentTypes:["vector"]},{group:"constraints",componentTypes:["constraints"]}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var is;let ns;return((is=rs.document)==null?void 0:is.stateValues.theme)==="dark"?ns=rs.selectedStyle.markerColorWordDarkMode:ns=rs.selectedStyle.markerColorWord,{setValue:{styleDescription:ns}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" "+rs.selectedStyle.markerStyleWord}}}},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=rs.displayDigitsAttr===null||ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.coordsShadow={defaultValue:null,hasEssential:!0,essentialVarName:"coords",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{coordsShadow:!0}}),inverseDefinition:async function({desiredStateVariableValues:rs,stateValues:ns,workspace:is}){return{success:!0,instructions:[{setEssentialValue:"coordsShadow",value:rs.coordsShadow}]}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]},x:{dependencyType:"attributeComponent",attributeName:"x"},y:{dependencyType:"attributeComponent",attributeName:"y"},z:{dependencyType:"attributeComponent",attributeName:"z"},xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["nDimensions"]}}),definition:function({dependencyValues:rs}){let ns=!1,is,as;if(rs.z!==null?as=3:rs.y!==null?as=2:as=0,rs.coords!==null?(ns=!0,is=rs.coords.stateValues.value):rs.coordsShadow&&(ns=!0,is=rs.coordsShadow),ns){let os=is.tree;return Array.isArray(os)&&vectorOperators.includes(os[0])?as=Math.max(os.length-1,as):as=Math.max(1,as),{setValue:{nDimensions:as},checkForActualChange:{nDimensions:!0}}}else return rs.xs!==null?{setValue:{nDimensions:Math.max(rs.xs.stateValues.nComponents,as)}}:rs.pointChild.length>0?{setValue:{nDimensions:Math.max(rs.pointChild[0].stateValues.nDimensions,as)}}:rs.vectorChild.length>0?{setValue:{nDimensions:Math.max(rs.vectorChild[0].stateValues.nDimensions,as)}}:(as===0&&(as=2),{setValue:{nDimensions:as},checkForActualChange:{nDimensions:!0}})}},ts.arrayVariableForConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{arrayVariableForConstraints:"unconstrainedXs"}})},ts.arrayEntryPrefixForConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{arrayEntryPrefixForConstraints:"unconstrainedX"}})},ts.nDimensionsForConstraints={isAlias:!0,targetVariableName:"nDimensions"},ts.unconstrainedXs={isArray:!0,entryPrefixes:["unconstrainedX"],defaultValueByArrayKey:()=>Context.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]}},is={};for(let as of rs){let os=Number(as)+1;is[as]={xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+os]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+os]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["x"+os]}},as==="0"?is[as].component={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:as==="1"?is[as].component={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:as==="2"&&(is[as].component={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]})}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={},ls=!1,us;if(rs.coords!==null?(ls=!0,us=rs.coords.stateValues.value):rs.coordsShadow&&(ls=!0,us=rs.coordsShadow),ls){let ps=us.tree;if(Array.isArray(ps)&&vectorOperators.includes(ps[0]))for(let ds of is){let fs=Number(ds);(fs>=0||fs<ps.length-1)&&(us.tree[fs+1]===void 0?as[ds]=Context.fromAst(""):as[ds]=us.get_component(fs).simplify())}else is.includes("0")&&(as[0]=us.simplify())}else for(let ps of is){let ds=Number(ps)+1,fs=ns[ps].xs;if(fs!==null){let hs=fs.stateValues["math"+ds];hs!==void 0&&(as[ps]=hs.simplify())}else{let hs=ns[ps].pointChild;if(hs.length>0)as[ps]=hs[0].stateValues["x"+ds];else{let ys=ns[ps].vectorChild;ys.length>0&&(as[ps]=ys[0].stateValues["x"+ds])}}}for(let ps of is){let ds=ns[ps].component;ds?as[ps]=ds.stateValues.value.simplify():as[ps]===void 0&&(os[ps]=!0)}let cs={};return Object.keys(as).length>0&&(cs.setValue={unconstrainedXs:as}),Object.keys(os).length>0&&(cs.useEssentialOrDefaultValue={unconstrainedXs:os}),cs},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1,cs,ps,ds=!1;ns.coords!==null?(us=!0,cs="coords",ps=Array(os[0]+1)):ns.coordsShadow!==null&&(us=!0,cs="coordsShadow",ps=Array(os[0]+1));for(let fs of Object.keys(rs.unconstrainedXs).reverse()){let hs=convertValueToMathExpression(rs.unconstrainedXs[fs]);is[fs].component!==null?ls.push({setDependency:as[fs].component,desiredValue:hs,childIndex:0,variableIndex:0}):us?(ps[Number(fs)+1]=hs.tree,ds=!0):is[fs].xs!==null?ls.push({setDependency:as[fs].xs,desiredValue:hs,childIndex:0,variableIndex:0}):is[fs].pointChild.length>0?ls.push({setDependency:as[fs].pointChild,desiredValue:hs,childIndex:0,variableIndex:0}):is[fs].vectorChild.length>0?ls.push({setDependency:as[fs].vectorChild,desiredValue:hs,childIndex:0,variableIndex:0}):ls.push({setEssentialValue:"unconstrainedXs",value:{[fs]:hs}})}if(ds){let fs;os[0]===1?fs=Context.fromAst(ps[1]):(ps[0]="vector",fs=Context.fromAst(ps));let hs={setDependency:cs,desiredValue:fs};cs==="coords"&&(hs.childIndex=0,hs.variableIndex=0),ls.push(hs)}return{success:!0,instructions:ls}}},ts.xs={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let as=Number(is)+1,os={};os.unconstrainedX={dependencyType:"stateVariable",variableName:`unconstrainedX${as}`},os.constraintsChild={dependencyType:"child",childGroups:["constraints"],variableNames:[`constraintResult${as}`]},ns[is]=os}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns)if(rs[as].constraintsChild.length>0){let os=Number(as)+1;is[as]=convertValueToMathExpression(rs[as].constraintsChild[0].stateValues["constraintResult"+os])}else is[as]=convertValueToMathExpression(rs[as].unconstrainedX);return ns.length>0?{setValue:{xs:is}}:{}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyValuesByKey:ns,dependencyNamesByKey:is,initialChange:as,stateValues:os}){if(as&&!await os.draggable)return{success:!1};let ls=[];for(let us of Object.keys(rs.xs).reverse())ns[us]&&(ns[us].constraintsChild.length>0?ls.push({setDependency:is[us].constraintsChild,desiredValue:rs.xs[us],childIndex:0,variableIndex:0}):ls.push({setDependency:is[us].unconstrainedX,desiredValue:rs.xs[us]}));return{success:!0,instructions:ls}}},ts.x={isAlias:!0,targetVariableName:"x1"},ts.y={isAlias:!0,targetVariableName:"x2"},ts.z={isAlias:!0,targetVariableName:"x3"},ts.coords={public:!0,shadowingInstructions:{createComponentOfType:"coords",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({xs:{dependencyType:"stateVariable",variableName:"xs"}}),definition:function({dependencyValues:rs}){let ns=[];for(let is of rs.xs)is?ns.push(is.tree):ns.push("");return ns.length>1?ns=["vector",...ns]:ns.length===1?ns=ns[0]:ns="",{setValue:{coords:Context.fromAst(ns)}}},inverseDefinition:async function({desiredStateVariableValues:rs,stateValues:ns,initialChange:is}){if(is&&!await ns.draggable)return{success:!1};let as=[],os={},ls=rs.coords.tree;if(!(Array.isArray(ls)&&vectorOperators.includes(ls[0])))os[0]=rs.coords;else for(let us=0;us<ls.length-1;us++){let cs=rs.coords.get_component(us);cs.tree!==void 0&&(os[us]=cs)}return as.push({setDependency:"xs",desiredValue:os}),{success:!0,instructions:as}}},ts.latex={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({coords:{dependencyType:"stateVariable",variableName:"coords"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is={};return rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits)),{setValue:{latex:roundForDisplay({value:rs.coords,dependencyValues:rs,usedDefault:ns}).toLatex(is)}}}},ts.value={isAlias:!0,targetVariableName:"coords"},ts.constraintUsed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({constraintsChild:{dependencyType:"child",childGroups:["constraints"],variableNames:["constraintUsed"]}}),definition:function({dependencyValues:rs}){return rs.constraintsChild.length===0?{setValue:{constraintUsed:!1}}:{setValue:{constraintUsed:rs.constraintsChild[0].stateValues.constraintUsed}}}},ts.numericalXs={isArray:!0,entryPrefixes:["numericalX"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let as=Number(is)+1;ns[is]={x:{dependencyType:"stateVariable",variableName:`x${as}`}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].x;os?(os=rs[as].x.evaluate_to_constant(),is[as]=os):is[as]=NaN}return{setValue:{numericalXs:is}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,initialChange:is,stateValues:as}){if(is&&!await as.draggable)return{success:!1};let os=[];for(let ls in rs.numericalXs)dependencyValuesByKey[ls]&&os.push({setDependency:ns[ls].xs,desiredValue:rs.numericalXs[ls]});return{success:!0,instructions:os}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalXs:{dependencyType:"stateVariable",variableName:"numericalXs"}}),definition:({dependencyValues:rs})=>({setValue:{nearestPoint:function(){let ns={};for(let is=1;is<=rs.nDimensions;is++){let as=rs.numericalXs[is-1];if(!Number.isFinite(as))return{};ns["x"+is]=as}return ns}}})},ts}async movePoint({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us={};return ts!==void 0&&(us[0]=Context.fromAst(ts)),rs!==void 0&&(us[1]=Context.fromAst(rs)),ns!==void 0&&(us[2]=Context.fromAst(ns)),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:us}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:us}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}switchPoint(){}async pointClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnPoint({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Point,"componentType","point"),Ms(Point,"primaryStateVariableForDefinition","coordsShadow"),Ms(Point,"stateVariableForAttributeValue","coords"),Ms(Point,"adapters",[{stateVariable:"coords",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}]);class EquilibriumPoint extends Point{static createAttributesObject(){let ts=super.createAttributesObject();return ts.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},ts.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.open={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition({dependencyValues:rs}){return{setValue:{open:!rs.stable}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setDependency:"stable",desiredValue:!rs.open}]}}},ts}async switchPoint({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:ts})}}Ms(EquilibriumPoint,"componentType","equilibriumPoint"),Ms(EquilibriumPoint,"rendererType","point");class Line extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveLine:this.moveLine.bind(this),switchLine:this.switchLine.bind(this),lineClicked:this.lineClicked.bind(this),mouseDownOnLine:this.mouseDownOnLine.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.equation={createComponentOfType:"math"},ts.through={createComponentOfType:"_pointListComponent"},ts.slope={createComponentOfType:"number"},ts.variables={createComponentOfType:"variables"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft"]},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){if(ns.length===0)return{success:!1};let as=cs=>is.componentIsSpecifiedType(cs,"label"),os=ns.map(as),ls=[],us=[];if(os.filter(cs=>cs).length===0)ls=ns;else{if(os[0]){let ps=os.indexOf(!1);ps!==-1&&(us.push(...ns.slice(0,ps)),ns=ns.slice(ps),os=os.slice(ps))}let cs=os.indexOf(!0);cs===-1?ls=ns:(ls=ns.slice(0,cs),us.push(...ns.slice(cs)))}return ls.length===0?{success:!1}:{success:!0,newAttributes:{equation:{component:{componentType:"math",children:ls}}},newChildren:us}};return ts.push({replacementFunction:rs}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" line"}}}},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=rs.displayDigitsAttr===null||ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return rs.displayDigitsAttr!==null?is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["equationIdentity"],returnDependencies:function({stateValues:rs}){return rs.equationIdentity===null?{through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}:{equation:{dependencyType:"attributeComponent",attributeName:"equation"}}},definition:function({dependencyValues:rs,changes:ns}){return rs.equation?ns.equation&&ns.equation.componentIdentitiesChanged?{setValue:{nDimensions:2},checkForActualChange:{nDimensions:!0}}:{noChanges:["nDimensions"]}:rs.through?{setValue:{nDimensions:rs.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{setValue:{nDimensions:2}}}},ts.nPointsPrescribed={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:rs}){return rs.throughAttr===null?{setValue:{nPointsPrescribed:0}}:{setValue:{nPointsPrescribed:rs.throughAttr.stateValues.nPoints}}}},ts.basedOnSlope={returnDependencies:()=>({slopeAttr:{dependencyType:"attributeComponent",attributeName:"slope"},nPointsPrescribed:{dependencyType:"stateVariable",variableName:"nPointsPrescribed"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition({dependencyValues:rs}){return{setValue:{basedOnSlope:rs.nPointsPrescribed<2&&rs.slopeAttr!==null&&rs.nDimensions===2}}}},ts.dForSlope={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{dForSlope:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"dForSlope",value:rs.dForSlope}]}}},ts.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{variables:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]}}}},arrayDefinitionByKey({globalDependencyValues:rs,arraySize:ns}){let is=[];return rs.variables!==null&&(is=rs.variables.stateValues.variables),{setValue:{variables:returnNVariables(ns[0],is)}}}},ts.equationIdentity={returnDependencies:()=>({equation:{dependencyType:"attributeComponent",attributeName:"equation"}}),definition:function({dependencyValues:rs}){return rs.equation!==null?{setValue:{equationIdentity:rs.equation}}:{setValue:{equationIdentity:null}}}},ts.essentialPoints={isArray:!0,nDimensions:"2",hasEssential:!0,entryPrefixes:["essentialPointX","essentialPoint"],set:convertValueToMathExpression,defaultValueByArrayKey:rs=>Context.fromAst(rs==="0,0"?1:0),getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="essentialPointX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[2,rs.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]=!0;return{useEssentialOrDefaultValue:{essentialPoints:ns}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns=[];for(let is in rs.essentialPoints)ns.push({setEssentialValue:"essentialPoints",value:{[is]:convertValueToMathExpression(rs.essentialPoints[is])}});return{success:!0,instructions:ns}}},ts.points={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(rs){return rs==="pointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="pointX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="points")return rs.length===1?"point"+rs[0]:`pointX${rs[0]}_${rs[1]}`;if(ns.slice(0,5)==="point"){let is=Number(ns.slice(5));if(Number.isInteger(is)&&is>0)return`pointX${is}_${rs[0]}`}return null},stateVariablesDeterminingDependencies:["equationIdentity","nPointsPrescribed","basedOnSlope"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[2,rs.nDimensions]},returnArrayDependenciesByKey({stateValues:rs,arrayKeys:ns}){if(rs.equationIdentity===null){let is={};for(let os of ns){let[ls,us]=os.split(","),cs=Number(ls)+1+"_"+(Number(us)+1);is[os]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+cs]}},rs.basedOnSlope?(ls==="1"&&(rs.nPointsPrescribed===1&&is[os].through.variableNames.push("pointX1_"+(Number(us)+1)),is[os].dForSlope={dependencyType:"stateVariable",variableName:"dForSlope"},is[os].slopeAttr={dependencyType:"attributeComponent",attributeName:"slope",variableNames:["value"]}),rs.nPointsPrescribed===0&&(is[os].essentialPoint={dependencyType:"stateVariable",variableName:"essentialPointX2_"+(Number(us)+1)})):is[os].essentialPoint={dependencyType:"stateVariable",variableName:"essentialPointX"+cs}}return{dependenciesByKey:is,globalDependencies:{nPointsPrescribed:{dependencyType:"stateVariable",variableName:"nPointsPrescribed"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},basedOnSlope:{dependencyType:"stateVariable",variableName:"basedOnSlope"}}}}else return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,arraySize:as,componentName:os}){if("coeff0"in rs){let ls=calculatePointsFromCoeffs(rs);if(ls.success)return{setValue:{points:ls.points}};{let us={};for(let cs=0;cs<as[0];cs++)for(let ps=0;ps<as[1];ps++)us[cs+","+ps]=Context.fromAst("");return{setValue:{points:us}}}}else{let ls={};for(let us of is){let[cs,ps]=us.split(","),ds=Number(cs)+1+"_"+(Number(ps)+1);if(ns[us].through!==null&&ns[us].through.stateValues["pointX"+ds])ls[us]=ns[us].through.stateValues["pointX"+ds];else if(rs.basedOnSlope){let fs;if(rs.nPointsPrescribed===1?fs=ns[us].through.stateValues["pointX1_"+(Number(ps)+1)]:fs=ns[us].essentialPoint,cs==="0")ls[us]=fs;else{let hs=ns[us].slopeAttr.stateValues.value;if(hs===1/0||hs===-1/0)ps==="0"?ls[us]=fs:ls[us]=Context.fromAst(["+",fs.tree,ns[us].dForSlope*Math.sign(hs)]);else if(Number.isFinite(hs)){let ys=Math.atan(hs);ps==="0"?ls[us]=Context.fromAst(["+",fs.tree,ns[us].dForSlope*Math.cos(ys)]):ls[us]=Context.fromAst(["+",fs.tree,ns[us].dForSlope*Math.sin(ys)])}else ls[us]=Context.fromAst("")}}else ls[us]=ns[us].essentialPoint}return{setValue:{points:ls}}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,initialChange:os,stateValues:ls,workspace:us}){if(os&&!await ls.draggable)return{success:!1};if("coeff0"in ns){us.desiredPoints||(us.desiredPoints={}),Object.assign(us.desiredPoints,rs.points);let cs=await ls.points,ps,ds,fs,hs;if(us.desiredPoints["0,0"]?ps=us.desiredPoints["0,0"]:ps=cs[0][0],us.desiredPoints["0,1"]?ds=us.desiredPoints["0,1"]:ds=cs[0][1],us.desiredPoints["1,0"]?fs=us.desiredPoints["1,0"]:fs=cs[1][0],us.desiredPoints["1,1"]?hs=us.desiredPoints["1,1"]:hs=cs[1][1],typeof ps.tree=="number"&&typeof ds.tree=="number"&&typeof fs.tree=="number"&&typeof hs.tree=="number"){let vs=[ps.tree,ds.tree],Ns=[fs.tree,hs.tree],Ts=vs[1]-Ns[1],Cs=Ns[0]-vs[0],xs=vs[0]*Ns[1]-vs[1]*Ns[0],As=await ls.coeffvar1,ws=await ls.coeffvar2,Es=Math.abs(Ts*ws-As*Cs),Ss=[];return Es<Math.abs(Ts*ws)*1e-12?(Ts!==0?xs*=As/Ts:xs*=ws/Cs,Ss.push({setDependency:"coeff0",desiredValue:xs,additionalDependencyValues:{coeffvar1:As,coeffvar2:ws}})):Ss.push({setDependency:"coeff0",desiredValue:xs,additionalDependencyValues:{coeffvar1:Ts,coeffvar2:Cs}}),Ss.push({setDependency:"lastPointsFromInverting",desiredValue:[vs,Ns]}),{success:!0,instructions:Ss}}let ys=ds.subtract(hs).simplify(),gs=fs.subtract(ps).simplify();return{success:!0,instructions:[{setDependency:"coeff0",desiredValue:ps.multiply(hs).subtract(ds.multiply(fs)).simplify(),additionalDependencyValues:{coeffvar1:ys,coeffvar2:gs}}]}}else{let cs=[];for(let ps of Object.keys(rs.points).reverse()){let[ds,fs]=ps.split(","),hs=Number(ds)+1+"_"+(Number(fs)+1);if(is[ps].through!==null&&is[ps].through.stateValues["pointX"+hs])cs.push({setDependency:as[ps].through,desiredValue:rs.points[ps],variableIndex:0});else if(ns.basedOnSlope)if(ds==="0")cs.push({setDependency:as[ps].essentialPoint,desiredValue:rs.points[ps],variableIndex:0});else{let ys=rs.points[ps];ys instanceof Context.class&&(ys=ys.evaluate_to_constant()),us.desiredPoint1||(us.desiredPoint1=[]),us.desiredPoint1[fs]=ys;let gs=fs==="0"?"1":"0";if(us.desiredPoint1[gs]===void 0){let bs=(await ls.points)[1][gs].evaluate_to_constant();us.desiredPoint1[gs]=bs}if(us.desiredPoint1.every(Number.isFinite)){let bs=(await ls.points)[0][0].evaluate_to_constant(),vs=(await ls.points)[0][1].evaluate_to_constant();if(Number.isFinite(bs)&&Number.isFinite(vs)){let Ns=us.desiredPoint1[0]-bs,Ts=us.desiredPoint1[1]-vs,Cs=Math.sqrt(Ns*Ns+Ts*Ts);Ns!==0&&(Cs*=Math.sign(Ns)),cs.push({setDependency:as[ps].dForSlope,desiredValue:Cs}),cs.push({setDependency:as[ps].slopeAttr,desiredValue:Ts/Ns,variableIndex:0})}}}else cs.push({setDependency:as[ps].essentialPoint,desiredValue:rs.points[ps]})}return{success:!0,instructions:cs}}}},ts.equation={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},stateVariablesDeterminingDependencies:["equationIdentity"],additionalStateVariablesDefined:[{variableName:"coeff0",public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}},{variableName:"coeffvar1",public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}},{variableName:"coeffvar2",public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}}],returnDependencies:function({stateValues:rs}){let ns={variables:{dependencyType:"stateVariable",variableName:"variables"}};return rs.equationIdentity===null?(ns.points={dependencyType:"stateVariable",variableName:"points"},ns.nDimensions={dependencyType:"stateVariable",variableName:"nDimensions"}):ns.equation={dependencyType:"attributeComponent",attributeName:"equation",variableNames:["value"]},ns},definition:function({dependencyValues:rs}){let ns=rs.variables,is=Context.fromAst("");if(rs.equation){let gs=rs.equation.stateValues.value,bs=calculateCoeffsFromEquation({equation:gs,variables:ns});if(!bs.success)return{setValue:{equation:gs,coeff0:is,coeffvar1:is,coeffvar2:is}};let{coeff0:vs,coeffvar1:Ns,coeffvar2:Ts}=bs;return{setValue:{equation:gs,coeff0:vs,coeffvar1:Ns,coeffvar2:Ts}}}let as=rs.nDimensions;if(Number.isNaN(as))return console.warn("Line through points of undetermined dimensions"),{setValue:{equation:is,coeff0:is,coeffvar1:is,coeffvar2:is}};if(as<2)return console.warn("Line must be through points of at least two dimensions"),{setValue:{equation:is,coeff0:is,coeffvar1:is,coeffvar2:is}};let os=rs.points[0][0],ls=rs.points[0][1],us=rs.points[1][0],cs=rs.points[1][1],ps=[...ns.map(gs=>gs.toString())];for(let gs=0;gs<as;gs++)if(os.variables().indexOf(ps[gs])!==-1||ls.variables().indexOf(ps[gs])!==-1||us.variables().indexOf(ps[gs])!==-1||cs.variables().indexOf(ps[gs])!==-1)return console.warn("Points through line depend on variables: "+ps.join(", ")),{setValue:{equation:is,coeff0:is,coeffvar1:is,coeffvar2:is}};if(as!==2)return{setValue:{equation:is,coeff0:is,coeffvar1:is,coeffvar2:is}};if(os.equals(us)&&ls.equals(cs)){let gs=Context.fromAst(0);return{setValue:{equation:is,coeff0:gs,coeffvar1:gs,coeffvar2:gs}}}let ds=ls.subtract(cs).simplify(),fs=us.subtract(os).simplify(),hs=os.multiply(cs).subtract(ls.multiply(us)).simplify();return{setValue:{equation:Context.fromAst(["=",["+",["*","a","x"],["*","b","y"],"c"],0]).substitute({a:ds,b:fs,c:hs,x:ns[0],y:ns[1]}).simplify(),coeff0:hs,coeffvar1:ds,coeffvar2:fs}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.points?(console.log("Haven't implemented inverse definition of equation of line based on points"),{success:!1}):rs.equation?{success:!0,instructions:[{setDependency:"equation",desiredValue:rs.equation,variableIndex:0}]}:"coeff0"in rs&&"coeffvar1"in rs&&"coeffvar2"in rs?{success:!0,instructions:[{setDependency:"equation",desiredValue:Context.fromAst(["=",0,["+",["*","a","x"],["*","b","y"],"c"]]).substitute({a:rs.coeffvar1,b:rs.coeffvar2,c:rs.coeff0,x:ns.variables[0],y:ns.variables[1]}).simplify(),variableIndex:0}]}:(console.log("Haven't implemented inverting coeffs if not specifying all of them"),{success:!1})}},ts.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return Number.isNaN(rs.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},is={};for(let as of rs)is[as]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(as)+1)}};return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,componentName:as}){if(Number.isNaN(rs.nDimensions))return{};let os={};for(let ls of is){let us=ns[ls].point;Array.isArray(us)||(us=[us]);let cs=[];for(let ps=0;ps<rs.nDimensions;ps++){let ds=us[ps].evaluate_to_constant();cs.push(ds)}os[ls]=cs}return{setValue:{numericalPoints:os}}}},ts.numericalCoeff0={additionalStateVariablesDefined:["numericalCoeffvar1","numericalCoeffvar2"],returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:rs}){let ns=rs.coeff0.evaluate_to_constant(),is=rs.coeffvar1.evaluate_to_constant(),as=rs.coeffvar2.evaluate_to_constant();return{setValue:{numericalCoeff0:ns,numericalCoeffvar1:is,numericalCoeffvar2:as}}}},ts.slope={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:rs}){return{setValue:{slope:Context.fromAst(["-",["/","a","b"]]).substitute({a:rs.coeffvar1,b:rs.coeffvar2}).simplify()}}}},ts.xintercept={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"}}),definition:({dependencyValues:rs})=>({setValue:{xintercept:Context.fromAst(["-",["/","a","b"]]).substitute({a:rs.coeff0,b:rs.coeffvar1}).simplify()}})},ts.yintercept={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:({dependencyValues:rs})=>({setValue:{yintercept:Context.fromAst(["-",["/","a","b"]]).substitute({a:rs.coeff0,b:rs.coeffvar2}).simplify()}})},ts.lastPointsFromInverting={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{lastPointsFromInverting:!0}}),inverseDefinition:({desiredStateVariableValues:rs})=>({success:!0,instructions:[{setEssentialValue:"lastPointsFromInverting",value:rs.lastPointsFromInverting}]})},ts.latex={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({equation:{dependencyType:"stateVariable",variableName:"equation"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is={};return rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits)),{setValue:{latex:roundForDisplay({value:rs.equation,dependencyValues:rs,usedDefault:ns}).toLatex(is)}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalCoeff0:{dependencyType:"stateVariable",variableName:"numericalCoeff0"},numericalCoeffvar1:{dependencyType:"stateVariable",variableName:"numericalCoeffvar1"},numericalCoeffvar2:{dependencyType:"stateVariable",variableName:"numericalCoeffvar2"}}),definition({dependencyValues:rs}){let ns=rs.numericalCoeffvar1,is=rs.numericalCoeffvar2,as=rs.numericalCoeff0,os=Number.isFinite(ns)&&Number.isFinite(is)&&Number.isFinite(as),ls=rs.nDimensions!==2||!os||ns===0&&is===0;return{setValue:{nearestPoint:function({variables:us,scales:cs=[1,1]}){var Cs,xs;if(ls)return{};let ps=cs[0],ds=cs[1],fs=ns*ps,hs=is*ds,ys=fs*fs+hs*hs,gs=(Cs=us.x1)==null?void 0:Cs.evaluate_to_constant(),bs=(xs=us.x2)==null?void 0:xs.evaluate_to_constant();if(!(Number.isFinite(gs)&&Number.isFinite(bs)))return{};let vs=gs/ps,Ns=bs/ds,Ts={};return Ts.x1=(hs*(hs*vs-fs*Ns)-fs*as)*ps/ys,Ts.x2=(fs*(-hs*vs+fs*Ns)-hs*as)*ds/ys,us.x3!==void 0&&(Ts.x3=0),Ts}}}}},ts}async moveLine({point1coords:ts,point2coords:rs,transient:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){let ls={"0,0":Context.fromAst(ts[0]),"0,1":Context.fromAst(ts[1])};return await this.stateValues.basedOnSlope||(ls["1,0"]=Context.fromAst(rs[0]),ls["1,1"]=Context.fromAst(rs[1])),ns?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:ls}],transient:!0,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:ls}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentId:this.componentName},result:{point1:ts,point2:rs}}})}switchLine(){}async lineClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnLine({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Line,"componentType","line"),Ms(Line,"adapters",[{stateVariable:"equation",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}]);function calculateCoeffsFromEquation({equation:ss,variables:ts}){let rs=ts[0],ns=ts[1],is=rs.toString(),as=ns.toString();if(ss=ss.expand().simplify(),!(Array.isArray(ss.tree)&&ss.tree[0]==="="&&ss.tree.length===3))return{success:!1};let os=Context.fromAst(["+",ss.tree[2],["-",ss.tree[1]]]).expand().simplify(),ls=[];Array.isArray(os.tree)&&os.tree[0]==="+"?ls=os.tree.slice(1):ls=[os.tree];let us=Context.fromAst(0),cs=Context.fromAst(0),ps=Context.fromAst(0);for(let fs of ls){let hs=ds(fs);if(!hs.success)return{success:!1};us=us.add(hs.coeffvar1),cs=cs.add(hs.coeffvar2),ps=ps.add(hs.coeff0)}return us=us.simplify(),cs=cs.simplify(),ps=ps.simplify(),{success:!0,coeff0:ps,coeffvar1:us,coeffvar2:cs};function ds(fs){let hs=0,ys=0,gs=0;if(typeof fs=="string")fs===is?hs=1:fs===as?ys=1:gs=fs;else if(typeof fs=="number")gs=fs;else if(Array.isArray(fs)){let bs=fs[0],vs=fs.slice(1);if(bs==="-"){let Ns=ds(vs[0]);if(!Ns.success)return{success:!1};hs=["-",Ns.coeffvar1.tree],ys=["-",Ns.coeffvar2.tree],gs=["-",Ns.coeff0.tree]}else{if(bs==="+")return console.warn("Invalid format for equation of line in variables "+rs+" and "+ns),{success:!1};if(bs==="*"){let Ns=-1,Ts=-1;for(let Cs=0;Cs<vs.length;Cs++)if(rs.equals(Context.fromAst(vs[Cs]))){Ns=Cs;break}else if(ns.equals(Context.fromAst(vs[Cs]))){Ts=Cs;break}Ns!==-1?(vs.splice(Ns,1),vs.length===1?hs=vs[0]:hs=["*"].concat(vs)):Ts!==-1?(vs.splice(Ts,1),vs.length===1?ys=vs[0]:ys=["*"].concat(vs)):gs=fs}else if(bs==="/"){let Ns=ds(vs[0]);if(!Ns.success)return{success:!1};hs=["/",Ns.coeffvar1.tree,vs[1]],ys=["/",Ns.coeffvar2.tree,vs[1]],gs=["/",Ns.coeff0.tree,vs[1]]}else bs==="_"?rs.equals(Context.fromAst(fs))?hs=1:ns.equals(Context.fromAst(fs))?ys=1:gs=fs:gs=fs}}else return console.warn("Invalid format for equation of line in variables "+rs+" and "+ns),{success:!1};return{success:!0,coeffvar1:Context.fromAst(hs),coeffvar2:Context.fromAst(ys),coeff0:Context.fromAst(gs)}}}function calculatePointsFromCoeffs({coeff0:ss,coeffvar1:ts,coeffvar2:rs,variables:ns,lastPointsFromInverting:is}){let as=ns[0],os=ns[1],ls=as.toString(),us=os.toString();if(ts.variables(!0).indexOf(ls)!==-1||ts.variables(!0).indexOf(us)!==-1||rs.variables(!0).indexOf(ls)!==-1||rs.variables(!0).indexOf(us)!==-1||ss.variables(!0).indexOf(ls)!==-1||ss.variables(!0).indexOf(us)!==-1)return console.warn("Invalid format for equation of line in variables "+ls+" and "+us),{success:!1};let cs=Context.fromAst(0);if(ts.equals(cs)&&rs.equals(cs))return console.warn("Invalid format for equation of line in variables "+ls+" and "+us),{success:!1};let ps=ts.evaluate_to_constant(),ds=rs.evaluate_to_constant(),fs=ss.evaluate_to_constant(),hs,ys,gs,bs,vs={};if(Number.isFinite(fs)&&Number.isFinite(ps)&&Number.isFinite(ds)){let Ns=ps*ps+ds*ds;if(Ns===0)return{success:!1};if(is){let Ts=is[0][0],Cs=is[0][1];hs=(ds*(ds*Ts-ps*Cs)-ps*fs)/Ns,ys=(ps*(-ds*Ts+ps*Cs)-ds*fs)/Ns,Ts=is[1][0],Cs=is[1][1],gs=(ds*(ds*Ts-ps*Cs)-ps*fs)/Ns,bs=(ps*(-ds*Ts+ps*Cs)-ds*fs)/Ns}else hs=(2*ds-ps*fs)/Ns,ys=(-2*ps-ds*fs)/Ns,gs=(ds-ps*fs)/Ns,bs=-(ps+ds*fs)/Ns;vs["0,0"]=Context.fromAst(hs),vs["0,1"]=Context.fromAst(ys),vs["1,0"]=Context.fromAst(gs),vs["1,1"]=Context.fromAst(bs)}else{let Ns=ts.pow(2).add(rs.pow(2));hs=rs.multiply(2).subtract(ts.multiply(ss)).divide(Ns),ys=ts.multiply(-2).subtract(rs.multiply(ss)).divide(Ns),gs=rs.subtract(ts.multiply(ss)).divide(Ns),bs=ts.add(rs.multiply(ss)).multiply(-1).divide(Ns),vs["0,0"]=hs,vs["0,1"]=ys,vs["1,0"]=gs,vs["1,1"]=bs}return{success:!0,points:vs}}class EquilibriumLine extends Line{static createAttributesObject(){let ts=super.createAttributesObject();return ts.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},ts.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.dashed={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition({dependencyValues:rs}){return{setValue:{dashed:!rs.stable}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setDependency:"stable",desiredValue:!rs.dashed}]}}},ts}async switchLine({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:ts})}}Ms(EquilibriumLine,"componentType","equilibriumLine"),Ms(EquilibriumLine,"rendererType","line");class Curve extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveControlVector:this.moveControlVector.bind(this),moveThroughPoint:this.moveThroughPoint.bind(this),changeVectorControlDirection:this.changeVectorControlDirection.bind(this),switchCurve:this.switchCurve.bind(this),curveClicked:this.curveClicked.bind(this),mouseDownOnCurve:this.mouseDownOnCurve.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},ts.flipFunction={createComponentOfType:"boolean",createStateVariable:"flipFunction",defaultValue:!1,public:!0,forRenderer:!0},ts.nDiscretizationPoints={createComponentOfType:"number",createStateVariable:"nDiscretizationPoints",defaultValue:1e3,public:!0},ts.periodic={createComponentOfType:"boolean",createStateVariable:"periodic",defaultValue:!1,public:!0},ts.splineTension={createComponentOfType:"number",createStateVariable:"splineTension",defaultValue:.8,clamp:[0,1],public:!0},ts.extrapolateBackward={createComponentOfType:"boolean",createStateVariable:"extrapolateBackward",defaultValue:!1,public:!0,forRenderer:!0},ts.extrapolateForward={createComponentOfType:"boolean",createStateVariable:"extrapolateForward",defaultValue:!1,public:!0,forRenderer:!0},ts.splineForm={createComponentOfType:"text",createStateVariable:"splineForm",defaultValue:"centripetal",public:!0,toLowerCase:!0,validValues:["centripetal","uniform"]},ts.variable={createComponentOfType:"variable",createStateVariable:"variableForChild",defaultValue:Context.fromAst("x")},ts.through={createComponentOfType:"_pointListComponent"},ts.parMin={createComponentOfType:"math"},ts.parMax={createComponentOfType:"math"},ts.nearestPointAsCurve={createComponentOfType:"boolean",createStateVariable:"nearestPointAsCurvePrelim",defaultValue:!1},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){let as=ys=>is.componentIsSpecifiedType(ys,"label");if(ns.length===0||!ns.every(ys=>{var gs;return typeof ys=="string"||((gs=ys.doenetAttributes)==null?void 0:gs.createdFromMacro)||as(ys)}))return{success:!1};let os=ns.map(as),ls=[],us=[],cs=[];if(os.filter(ys=>ys).length===0)ls=ns;else{if(os[0]){let gs=os.indexOf(!1);gs!==-1&&(us=ns.slice(0,gs),ns=ns.slice(gs),os=os.slice(gs))}let ys=os.indexOf(!0);ys===-1?ls=ns:(ls=ns.slice(0,ys),cs=ns.slice(ys))}if(ls.length===0)return{success:!1};let fs=returnBreakStringsSugarFunction({childrenToComponentFunction:ys=>({componentType:"function",children:ys}),mustStripOffOuterParentheses:!0})({matchedChildren:ls}),hs=[];return fs.success?hs=fs.newChildren:hs=[{componentType:"function",children:ls}],{success:!0,newChildren:[...us,...hs,...cs]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){let ts=super.returnChildGroups();return ts.push({group:"functions",componentTypes:["function"]},{group:"bezierControls",componentTypes:["bezierControls"]}),ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var os;let is;((os=ns.document)==null?void 0:os.stateValues.theme)==="dark"?is=ns.selectedStyle.lineColorWordDarkMode:is=ns.selectedStyle.lineColorWord;let as=ns.selectedStyle.lineWidthWord;return ns.selectedStyle.lineStyleWord&&(as&&(as+=" "),as+=ns.selectedStyle.lineStyleWord),as&&(as+=" "),as+=is,{setValue:{styleDescription:as}}}},rs.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:ns}){return{setValue:{styleDescriptionWithNoun:ns.styleDescription+" curve"}}}},rs.curveType={forRenderer:!0,returnDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"]},through:{dependencyType:"attributeComponent",attributeName:"through"}}),definition({dependencyValues:ns}){let is="function";return ns.through!==null?is="bezier":ns.functionChildren.length>1&&(is="parameterization"),{setValue:{curveType:is}}}},rs.fShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fShadow:!0}})},rs.graphXmin={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"graphXmax",forRenderer:!0},{variableName:"graphYmin",forRenderer:!0},{variableName:"graphYmax",forRenderer:!0}],returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]}}),definition({dependencyValues:ns}){return ns.graphAncestor?{setValue:{graphXmin:ns.graphAncestor.stateValues.xmin,graphXmax:ns.graphAncestor.stateValues.xmax,graphYmin:ns.graphAncestor.stateValues.ymin,graphYmax:ns.graphAncestor.stateValues.ymax}}:{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}}}},rs.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMaxAttr:{dependencyType:"attributeComponent",attributeName:"parMax",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]},adapterSourceDomain:{dependencyType:"adapterSourceStateVariable",variableName:"domain"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"}}),definition:function({dependencyValues:ns}){let is;if(ns.curveType==="bezier")is=ns.nThroughPoints-1,ns.extrapolateForward&&(is*=2);else if(ns.parMaxAttr!==null)is=ns.parMaxAttr.stateValues.value.evaluate_to_constant();else if(ns.curveType==="function"){let as=null;ns.functionChild.length===1?as=ns.functionChild[0].stateValues.domain:as=ns.adapterSourceDomain,as!==null&&(as=as[0],is=Context.fromAst(as.tree[1][2]).evaluate_to_constant());let os,ls;ns.flipFunction?(ls=ns.graphYmax,os=ns.graphYmin):(ls=ns.graphXmax,os=ns.graphXmin),ls!==null&&os!==null&&(is===void 0?is=ls+.1*(ls-os):is=Math.min(is,ls+.1*(ls-os))),is===void 0&&(is=1/0)}else is=10;return{setValue:{parMax:is}}}},rs.parMin={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMinAttr:{dependencyType:"attributeComponent",attributeName:"parMin",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]},adapterSourceDomain:{dependencyType:"adapterSourceStateVariable",variableName:"domain"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"}}),definition:function({dependencyValues:ns}){let is;if(ns.curveType==="bezier")is=0,ns.extrapolateBackward&&(is=-(ns.nThroughPoints-1));else if(ns.parMinAttr!==null)is=ns.parMinAttr.stateValues.value.evaluate_to_constant();else if(ns.curveType==="function"){let as=null;ns.functionChild.length===1?as=ns.functionChild[0].stateValues.domain:as=ns.adapterSourceDomain,as!==null&&(as=as[0],is=Context.fromAst(as.tree[1][1]).evaluate_to_constant());let os,ls;ns.flipFunction?(ls=ns.graphYmax,os=ns.graphYmin):(ls=ns.graphXmax,os=ns.graphXmin),ls!==null&&os!==null&&(is===void 0?is=os+.1*(os-ls):is=Math.max(is,os+.1*(os-ls))),is===void 0&&(is=-1/0)}else is=-10;return{setValue:{parMin:is}}}},rs.domainForFunctions={returnDependencies:()=>({parMin:{dependencyType:"stateVariable",variableName:"parMin"},parMax:{dependencyType:"stateVariable",variableName:"parMax"}}),definition({dependencyValues:ns}){return{setValue:{domainForFunctions:[Context.fromAst(["interval",["tuple",ns.parMin,ns.parMax],["tuple",!0,!0]])]}}}},rs.nThroughPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:ns}){let is=0;return ns.through!==null&&(is=ns.through.stateValues.nPoints),{setValue:{nThroughPoints:is}}}},rs.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies(){return{through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}},definition:function({dependencyValues:ns}){return ns.through!==null?{setValue:{nDimensions:ns.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{setValue:{nDimensions:2}}}},rs.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="throughPointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="throughPoints")return ns.length===1?"throughPoint"+ns[0]:`throughPointX${ns[0]}_${ns[1]}`;if(is.slice(0,12)==="throughPoint"){let as=Number(is.slice(12));if(Number.isInteger(as)&&as>0)return`throughPointX${as}_${ns[0]}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,ns.nDimensions]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let[os,ls]=as.split(","),us=Number(os)+1+"_"+(Number(ls)+1);is[as]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+us]}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let[ls,us]=os.split(","),cs=Number(ls)+1+"_"+(Number(us)+1),ps=ns[os].through;ps!==null&&ps.stateValues["pointX"+cs]?as[os]=ps.stateValues["pointX"+cs]:as[os]=Context.fromAst(0)}return{setValue:{throughPoints:as}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,initialChange:os,stateValues:ls}){if(os&&!await ls.draggable)return{success:!1};let us=[];for(let cs in ns.throughPoints){let[ps,ds]=cs.split(","),fs=Number(ps)+1+"_"+(Number(ds)+1);if(is[cs].through!==null&&is[cs].through.stateValues["pointX"+fs])us.push({setDependency:as[cs].through,desiredValue:ns.throughPoints[cs],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:us}}},rs.numericalThroughPoints={isArray:!0,entryPrefixes:["numericalThroughPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns)is[as]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(as)+1)}};return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].throughPoint.map(us=>us.evaluate_to_constant());ls.every(us=>Number.isFinite(us))||(ls=Array(ls.length).fill(NaN)),as[os]=ls}return{setValue:{numericalThroughPoints:as}}}},rs.haveBezierControls={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childGroups:["bezierControls"]}}),definition({dependencyValues:ns}){return{setValue:{haveBezierControls:ns.controlChild.length>0}}}},rs.bezierControlsAlwaysVisible={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["alwaysVisible"]}}),definition({dependencyValues:ns}){return{setValue:{bezierControlsAlwaysVisible:ns.controlChild.length>0&&ns.controlChild[0].stateValues.alwaysVisible}}}},rs.vectorControlDirections={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["vectorControlDirection"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let os of ns)is[os]={controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["direction"+(Number(os)+1)]}};return{dependenciesByKey:is,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].controlChild;ls&&ls.length>0?as[os]=ls[0].stateValues["direction"+(Number(os)+1)]:as[os]="none"}return{setValue:{vectorControlDirections:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is,dependencyValuesByKey:as,globalDependencyValues:os}){if(!os.haveBezierControls)return{success:!1};let ls=[];for(let us in ns.vectorControlDirections){let cs=as[us].controlChild;cs&&cs.length>0&&ls.push({setDependency:is[us].controlChild,desiredValue:ns.vectorControlDirections[us],childIndex:0,variableIndex:0})}return{success:!0,instructions:ls}}},rs.hiddenControls={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},isArray:!0,entryPrefixes:["hiddenControl"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let os of ns)is[os]={controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["hiddenControl"+(Number(os)+1)]}};return{dependenciesByKey:is,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].controlChild;ls&&ls.length>0?as[os]=ls[0].stateValues["hiddenControl"+(Number(os)+1)]:as[os]=!1}return{setValue:{hiddenControls:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is,dependencyValuesByKey:as,globalDependencyValues:os}){if(!os.haveBezierControls)return{success:!1};let ls=[];for(let us in ns.hiddenControls){let cs=as[us].controlChild;cs&&cs.length>0&&ls.push({setDependency:is[us].controlChild,desiredValue:ns.hiddenControls[us],childIndex:0,variableIndex:0})}return{success:!0,instructions:ls}}},rs.controlVectors={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="controlVectorX"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]}},entryPrefixes:["controlVectorX","controlVector"],nDimensions:3,stateVariablesDeterminingDependencies:["vectorControlDirections","nThroughPoints"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="controlVectorX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===3&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every(ls=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?Array.from(Array(as[2]),(ls,us)=>String(os)+","+us):[]:[String(os)+",0"]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,2,ns.nDimensions]},returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},splineTension:{dependencyType:"stateVariable",variableName:"splineTension"},splineForm:{dependencyType:"stateVariable",variableName:"splineForm"}},os={};for(let ls of ns){let us=ls.split(",").map(ys=>Number(ys)),cs=us.map(ys=>ys+1),ps=cs.join("_");os[ls]={direction:{dependencyType:"stateVariable",variableName:"vectorControlDirection"+cs[0]},controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["control"+ps]}};let ds=us[0],fs=is.vectorControlDirections[ds],hs=[];fs==="none"?hs=[ds-1,ds,ds+1]:fs==="previous"?hs=[ds,ds+1]:fs==="next"&&(hs=[ds-1,ds]);for(let ys of hs)ys>=0&&ys<is.nThroughPoints&&(os[ls]["throughPoint"+(ys+1)]={dependencyType:"stateVariable",variableName:"throughPoint"+(ys+1)})}return{globalDependencies:as,dependenciesByKey:os}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as){if(ns.nDimensions!==2){os[ls]=Context.fromAst(NaN);continue}if(ls in os)continue;let us=ls.split(",").map(ys=>Number(ys)),ps=us.map(ys=>ys+1).join("_"),ds=us[0],fs=us[1],hs=is[ls].direction;if(hs==="none"){let ys=is[ls]["throughPoint"+(ds+1)],gs,bs;ds>0&&(gs=is[ls]["throughPoint"+ds]),ds<ns.nThroughPoints&&(bs=is[ls]["throughPoint"+(ds+2)]);let{coordsNumeric:vs,numericEntries:Ns}=calculateControlVectorFromSpline({tau:ns.splineTension,eps:ts.eps,splineForm:ns.splineForm,point1:gs,point2:ys,point3:bs});for(let Ts=0;Ts<2;Ts++){let Cs=ds+","+fs+","+Ts,xs=ds+","+(1-fs)+","+Ts;fs===0?(os[Cs]=vs[Ts],os[xs]=Context.fromAst(-vs[Ts].tree)):(os[Cs]=Context.fromAst(-vs[Ts].tree),os[xs]=vs[Ts])}}else if(us[1]===0&&hs==="next"||us[1]===1&&hs==="previous"){let ys=is[ls]["throughPoint"+ds],gs=is[ls]["throughPoint"+(ds+1)],bs=is[ls]["throughPoint"+(ds+2)],{coordsNumeric:vs,numericEntries:Ns}=calculateControlVectorFromSpline({tau:ns.splineTension,eps:ts.eps,splineForm:ns.splineForm,point1:ys||bs,point2:gs,point3:void 0});for(let Ts=0;Ts<2;Ts++){let Cs=ds+","+fs+","+Ts;os[Cs]=vs[Ts]}}else os[ls]=is[ls].controlChild[0].stateValues["control"+ps]}return{setValue:{controlVectors:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is,dependencyValuesByKey:as,globalDependencyValues:os}){if(!os.haveBezierControls||os.nDimensions!==2)return{success:!1};let ls=[];for(let us in ns.controlVectors){let ds=us.split(",").map(hs=>Number(hs)).map(hs=>hs+1).join("_"),fs=as[us].controlChild;fs.length>0&&fs[0].stateValues["control"+ds]&&ls.push({setDependency:is[us].controlChild,desiredValue:ns.controlVectors[us],childIndex:0,variableIndex:0})}return{success:!0,instructions:ls}}},rs.numericalControlVectors={isArray:!0,entryPrefixes:["numericalControlVector"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let us=as.split(",").map(cs=>Number(cs)).map(cs=>cs+1).join("_");is[as]={controlVector:{dependencyType:"stateVariable",variableName:"controlVector"+us}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].controlVector.map(us=>us.tree);as[os]=ls}return{setValue:{numericalControlVectors:as}}}},rs.controlPoints={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="controlPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},entryPrefixes:["controlPointX","controlPoint"],nDimensions:3,getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="controlPointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===3&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every(ls=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?Array.from(Array(as[2]),(ls,us)=>String(os)+","+us):[]:[String(os)+",0"]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,2,ns.nDimensions]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},as={};for(let os of ns){let us=os.split(",").map(ps=>Number(ps)).map(ps=>ps+1),cs=us.join("_");as[os]={throughPointX:{dependencyType:"stateVariable",variableName:"throughPointX"+us[0]+"_"+us[2]},controlVectorX:{dependencyType:"stateVariable",variableName:"controlVectorX"+cs}}}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as)if(ns.nDimensions!==2)os[ls]=Context.fromAst(NaN);else{let us=is[ls].controlVectorX;if(us){let cs=is[ls].throughPointX.evaluate_to_constant();os[ls]=Context.fromAst(cs+us.tree)}else os[ls]=null}return{setValue:{controlPoints:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is,dependencyValuesByKey:as,globalDependencyValues:os}){if(!os.haveBezierControls||os.nDimensions!==2)return{success:!1};let ls=[];for(let us in ns.controlPoints)if(as[us].controlVectorX){let ps=as[us].throughPointX,ds=ns.controlPoints[us];ds.tree&&(ds=ds.tree);let fs=Context.fromAst(["+",ds,["-",ps.tree]]);ls.push({setDependency:is[us].controlVectorX,desiredValue:fs})}return{success:!0,instructions:ls}}},rs.numericalControlPoints={isArray:!0,entryPrefixes:["numericalControlPoint"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let us=as.split(",").map(cs=>Number(cs)).map(cs=>cs+1).join("_");is[as]={controlPoint:{dependencyType:"stateVariable",variableName:"controlPoint"+us}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].controlPoint.map(us=>us.tree);as[os]=ls}return{setValue:{numericalControlPoints:as}}}},rs.splineCoeffs={isArray:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints-1]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1,ls=os+1;is[as]={previousPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+os},nextPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+ls},previousVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+os+"_2"},nextVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+ls+"_1"}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].previousPoint,us=ns[os].nextPoint,cs=ns[os].previousVector,ps=ns[os].nextVector,ds=[];for(let fs=0;fs<2;fs++)ds.push(initCubicPoly(ls[fs],us[fs],3*cs[fs],-3*ps[fs]));as[os]=ds}return{setValue:{splineCoeffs:as}}}},rs.extrapolateBackwardCoeffs={stateVariablesDeterminingDependencies:["extrapolateBackward"],additionalStateVariablesDefined:[{variableName:"extrapolateBackwardMode",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies({stateValues:ns}){let is={extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return ns.extrapolateBackward&&(is.firstSplineCoeffs={dependencyType:"stateVariable",variableName:"splineCoeffs1"},is.graphXmin={dependencyType:"stateVariable",variableName:"graphXmin"},is.graphXmax={dependencyType:"stateVariable",variableName:"graphXmax"},is.graphYmin={dependencyType:"stateVariable",variableName:"graphYmin"},is.graphYmax={dependencyType:"stateVariable",variableName:"graphYmax"}),is},definition({dependencyValues:ns}){if(!ns.extrapolateBackward||!ns.firstSplineCoeffs)return{setValue:{extrapolateBackwardCoeffs:null,extrapolateBackwardMode:""}};let is=ns.firstSplineCoeffs[0],as=ns.firstSplineCoeffs[1],os=is[0],ls=is[1],us=2*is[2],cs=as[0],ps=as[1],ds=2*as[2],fs=ls*ls+ps*ps,hs=(ps*us-ls*ds)/(fs*fs);if(Math.abs(hs)<1e-12||Math.abs(ls)<1e-12||Math.abs(ps)<1e-12){let bs=ls,vs=ps;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let Ts=ns.graphXmax-ns.graphXmin,Cs=ns.graphYmax-ns.graphYmin,xs=ns.nThroughPoints-1,As=Ts/xs/Math.abs(bs),ws=Cs/xs/Math.abs(vs),Es=Math.min(As,ws);Es>1&&(bs*=Es,vs*=Es)}return{setValue:{extrapolateBackwardCoeffs:[[os,bs,0],[cs,vs,0]],extrapolateBackwardMode:"line"}}}let ys=ps*hs,gs=-ls*hs;if(ys*ls>0){let bs=ys/gs,vs=(1+bs*bs)**2,Ns=ls;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let As=ns.graphXmax-ns.graphXmin,ws=ns.graphYmax-ns.graphYmin,Es=ns.nThroughPoints-1,Ss=As/Es,Ds=1/0;if(gs!==0){let Is=gs*vs/2*Es*Es,Os=-bs*Es,Ps=Math.sqrt(Os*Os+4*Math.abs(Is)*ws);Ds=(Math.abs(Os)+Ps)/(2*Math.abs(Is))}let Vs=Math.min(Ss,Ds);Vs>Math.abs(Ns)&&(Ns*=Vs/Math.abs(Ns))}let Ts=-Ns*bs,Cs=gs*Ns*Ns*vs;return{setValue:{extrapolateBackwardCoeffs:[[os,Ns,0],[cs,Ts,Cs/2]],extrapolateBackwardMode:"parabolaVertical"}}}else{let bs=gs/ys,vs=(1+bs*bs)**2,Ns=ps;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let As=ns.graphXmax-ns.graphXmin,ws=ns.graphYmax-ns.graphYmin,Es=ns.nThroughPoints-1,Ss=ws/Es,Ds=1/0;if(ys!==0){let Is=ys*vs/2*Es*Es,Os=-bs*Es,Ps=Math.sqrt(Os*Os+4*Math.abs(Is)*As);Ds=(Math.abs(Os)+Ps)/(2*Math.abs(Is))}let Vs=Math.min(Ds,Ss);Vs>Math.abs(Ns)&&(Ns*=Vs/Math.abs(Ns))}let Ts=-Ns*bs,Cs=ys*Ns*Ns*vs;return{setValue:{extrapolateBackwardCoeffs:[[os,Ts,Cs/2],[cs,Ns,0]],extrapolateBackwardMode:"parabolaHorizontal"}}}}},rs.extrapolateForwardCoeffs={stateVariablesDeterminingDependencies:["nThroughPoints","extrapolateForward"],additionalStateVariablesDefined:[{variableName:"extrapolateForwardMode",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies({stateValues:ns}){let is={extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return ns.extrapolateForward&&ns.nThroughPoints>=2&&(is.lastSplineCoeffs={dependencyType:"stateVariable",variableName:"splineCoeffs"+(ns.nThroughPoints-1)},is.graphXmin={dependencyType:"stateVariable",variableName:"graphXmin"},is.graphXmax={dependencyType:"stateVariable",variableName:"graphXmax"},is.graphYmin={dependencyType:"stateVariable",variableName:"graphYmin"},is.graphYmax={dependencyType:"stateVariable",variableName:"graphYmax"}),is},definition({dependencyValues:ns}){if(!ns.extrapolateForward||!ns.lastSplineCoeffs)return{setValue:{extrapolateForwardCoeffs:null,extrapolateForwardMode:""}};let is=ns.lastSplineCoeffs[0],as=ns.lastSplineCoeffs[1],os=is[0]+is[1]+is[2]+is[3],ls=is[1]+2*is[2]+3*is[3],us=2*is[2]+6*is[3],cs=as[0]+as[1]+as[2]+as[3],ps=as[1]+2*as[2]+3*as[3],ds=2*as[2]+6*as[3],fs=ls*ls+ps*ps,hs=(ps*us-ls*ds)/(fs*fs);if(Math.abs(hs)<1e-12||Math.abs(ls)<1e-12||Math.abs(ps)<1e-12){let bs=ls,vs=ps;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let Ts=ns.graphXmax-ns.graphXmin,Cs=ns.graphYmax-ns.graphYmin,xs=ns.nThroughPoints-1,As=Ts/xs/Math.abs(bs),ws=Cs/xs/Math.abs(vs),Es=Math.min(As,ws);Es>1&&(bs*=Es,vs*=Es)}return{setValue:{extrapolateForwardCoeffs:[[os,bs,0],[cs,vs,0]],extrapolateForwardMode:"line"}}}let ys=ps*hs,gs=-ls*hs;if(ys*ls<0){let bs=ys/gs,vs=(1+bs*bs)**2,Ns=ls;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let As=ns.graphXmax-ns.graphXmin,ws=ns.graphYmax-ns.graphYmin,Es=ns.nThroughPoints-1,Ss=As/Es,Ds=1/0;if(gs!==0){let Is=gs*vs/2*Es*Es,Os=-bs*Es,Ps=Math.sqrt(Os*Os+4*Math.abs(Is)*ws);Ds=(Math.abs(Os)+Ps)/(2*Math.abs(Is))}let Vs=Math.min(Ss,Ds);Vs>Math.abs(Ns)&&(Ns*=Vs/Math.abs(Ns))}let Ts=-Ns*bs,Cs=gs*Ns*Ns*vs;return{setValue:{extrapolateForwardCoeffs:[[os,Ns,0],[cs,Ts,Cs/2]],extrapolateForwardMode:"parabolaVertical"}}}else{let bs=gs/ys,vs=(1+bs*bs)**2,Ns=ps;if(ns.graphXmin!==null&&ns.graphXmax!==null&&ns.graphYmin!==null&&ns.graphYmax!==null){let As=ns.graphXmax-ns.graphXmin,ws=ns.graphYmax-ns.graphYmin,Es=ns.nThroughPoints-1,Ss=ws/Es,Ds=1/0;if(ys!==0){let Is=ys*vs/2*Es*Es,Os=-bs*Es,Ps=Math.sqrt(Os*Os+4*Math.abs(Is)*As);Ds=(Math.abs(Os)+Ps)/(2*Math.abs(Is))}let Vs=Math.min(Ds,Ss);Vs>Math.abs(Ns)&&(Ns*=Vs/Math.abs(Ns))}let Ts=-Ns*bs,Cs=ys*Ns*Ns*vs;return{setValue:{extrapolateForwardCoeffs:[[os,Ts,Cs/2],[cs,Ns,0]],extrapolateForwardMode:"parabolaHorizontal"}}}}},rs.fs={isArray:!0,entryPrefixes:["f"],additionalStateVariablesDefined:[{variableName:"fDefinitions",isArray:!0,forRenderer:!0,entryPrefixes:["fDefinition"]}],public:!0,shadowingInstructions:{createComponentOfType:"function",addStateVariablesShadowingStateVariables:{fDefinitions:{stateVariableToShadow:"fDefinitions"},domain:{stateVariableToShadow:"domainForFunctions"}}},returnArraySizeDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"]},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),returnArraySize({dependencyValues:ns}){return ns.curveType==="bezier"?[2]:[Math.max(1,ns.functionChildren.length)]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={curveType:{dependencyType:"stateVariable",variableName:"curveType"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},extrapolateBackwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateBackwardCoeffs"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},extrapolateForwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateForwardCoeffs"}},as={};for(let os of ns)as[os]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalf","fDefinition"],childIndices:[os]}},Number(os)===0&&(as[os].fShadow={dependencyType:"stateVariable",variableName:"fShadow"},as[os].fDefinitionAdapted={dependencyType:"adapterSourceStateVariable",variableName:"fDefinition"});return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){if(ns.curveType==="bezier"){let us={functionType:"bezier",nThroughPoints:ns.nThroughPoints,numericalThroughPoints:ns.numericalThroughPoints,splineCoeffs:ns.splineCoeffs,extrapolateForward:ns.extrapolateForward,extrapolateForwardCoeffs:ns.extrapolateForwardCoeffs,extrapolateBackward:ns.extrapolateBackward,extrapolateBackwardCoeffs:ns.extrapolateBackwardCoeffs},cs={},ps={};return us.component=0,cs[0]=returnBezierFunctions(us),ps[0]=us,us={...us},us.component=1,cs[1]=returnBezierFunctions(us),ps[1]=us,{setValue:{fs:cs,fDefinitions:ps}}}let os={},ls={};for(let us of as){let cs=is[us].functionChild;cs.length===1?(os[us]=cs[0].stateValues.numericalf,ls[us]=cs[0].stateValues.fDefinition):Number(us)===0&&is[us].fShadow?(os[us]=is[us].fShadow,ls[us]=is[us].fDefinitionAdapted):(os[us]=()=>0,ls[us]={functionType:"zero"})}return{setValue:{fs:os,fDefinitions:ls}}}},rs.f={isAlias:!0,targetVariableName:"f1"},rs.allXCriticalPoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:ns}){let is=[];if(ns.curveType!=="bezier")return{setValue:{allXCriticalPoints:is}};let as=ns.fs[0],os=ns.fs[1],ls=[],us=!1;for(let[cs,ps]of ns.splineCoeffs.entries()){let ds=ps[0],fs=3*ds[3],hs=2*ds[2],ys=ds[1];if(Math.abs(fs)<1e-14){let gs=-ys/hs;us=addTimePointBezier({t:gs,ind:cs,ts:ls,ignoreLeft:us})}else{let gs=hs*hs-4*fs*ys;if(gs==0){let bs=-hs/(2*fs);us=addTimePointBezier({t:bs,ind:cs,ts:ls,ignoreLeft:us})}else if(gs>0){let bs=Math.sqrt(gs),vs=[(-hs-bs)/(2*fs),(-hs+bs)/(2*fs)];fs<0&&(vs=[vs[1],vs[0]]);let Ns=!1;for(let Ts of vs)addTimePointBezier({t:Ts,ind:cs,ts:ls,ignoreLeft:us})&&(Ns=!0);us=Ns}else us=!1}}for(let cs of ls)is.push([as(cs),os(cs)]);return{setValue:{allXCriticalPoints:is}}}},rs.nXCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allXCriticalPoints:{dependencyType:"stateVariable",variableName:"allXCriticalPoints"}}),definition({dependencyValues:ns}){return{setValue:{nXCriticalPoints:ns.allXCriticalPoints.length}}}},rs.xCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents(ns){return ns==="xCriticalPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["xCriticalPointX","xCriticalPoint"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="xCriticalPointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="xCriticalPoints")return ns.length===1?"xCriticalPoint"+ns[0]:`xCriticalPointX${ns[0]}_${ns[1]}`;if(is.slice(0,14)==="xCriticalPoint"){let as=Number(is.slice(14));if(Number.isInteger(as)&&as>0)return`xCriticalPointX${as}_${ns[0]}`}return null},returnArraySizeDependencies:()=>({nXCriticalPoints:{dependencyType:"stateVariable",variableName:"nXCriticalPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nXCriticalPoints,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allXCriticalPoints:{dependencyType:"stateVariable",variableName:"allXCriticalPoints"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allXCriticalPoints[as][os]}return{setValue:{xCriticalPoints:is}}}},rs.allYCriticalPoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:ns}){let is=[];if(ns.curveType!=="bezier")return{setValue:{allYCriticalPoints:is}};let as=ns.fs[0],os=ns.fs[1],ls=[],us=!1;for(let[cs,ps]of ns.splineCoeffs.entries()){let ds=ps[1],fs=3*ds[3],hs=2*ds[2],ys=ds[1];if(Math.abs(fs)<1e-14){let gs=-ys/hs;us=addTimePointBezier({t:gs,ind:cs,ts:ls,ignoreLeft:us})}else{let gs=hs*hs-4*fs*ys;if(gs==0){let bs=-hs/(2*fs);us=addTimePointBezier({t:bs,ind:cs,ts:ls,ignoreLeft:us})}else if(gs>0){let bs=Math.sqrt(gs),vs=[(-hs-bs)/(2*fs),(-hs+bs)/(2*fs)];fs<0&&(vs=[vs[1],vs[0]]);let Ns=!1;for(let Ts of vs)addTimePointBezier({t:Ts,ind:cs,ts:ls,ignoreLeft:us})&&(Ns=!0);us=Ns}else us=!1}}for(let cs of ls)is.push([as(cs),os(cs)]);return{setValue:{allYCriticalPoints:is}}}},rs.nYCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allYCriticalPoints:{dependencyType:"stateVariable",variableName:"allYCriticalPoints"}}),definition({dependencyValues:ns}){return{setValue:{nYCriticalPoints:ns.allYCriticalPoints.length}}}},rs.yCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents(ns){return ns==="yCriticalPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["yCriticalPointX","yCriticalPoint"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="yCriticalPointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="yCriticalPoints")return ns.length===1?"yCriticalPoint"+ns[0]:`yCriticalPointX${ns[0]}_${ns[1]}`;if(is.slice(0,14)==="yCriticalPoint"){let as=Number(is.slice(14));if(Number.isInteger(as)&&as>0)return`yCriticalPointX${as}_${ns[0]}`}return null},returnArraySizeDependencies:()=>({nYCriticalPoints:{dependencyType:"stateVariable",variableName:"nYCriticalPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nYCriticalPoints,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allYCriticalPoints:{dependencyType:"stateVariable",variableName:"allYCriticalPoints"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allYCriticalPoints[as][os]}return{setValue:{yCriticalPoints:is}}}},rs.allCurvatureChangePoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:ns}){let is=[];if(ns.curveType!=="bezier")return{setValue:{allCurvatureChangePoints:is}};let as=ns.fs[0],os=ns.fs[1],ls=[],us=!1;for(let[cs,ps]of ns.splineCoeffs.entries()){let[ds,fs,hs,ys]=ps[0],[gs,bs,vs,Ns]=ps[1],Ts=3*(hs*Ns-vs*ys),Cs=3*(fs*Ns-bs*ys),xs=fs*vs-bs*hs;if(Math.abs(Ts)<1e-14){let As=-xs/Cs;us=addTimePointBezier({t:As,ind:cs,ts:ls,ignoreLeft:us})}else{let As=Cs*Cs-4*Ts*xs;if(As==0){let ws=-Cs/(2*Ts);us=addTimePointBezier({t:ws,ind:cs,ts:ls,ignoreLeft:us})}else if(As>0){let ws=Math.sqrt(As),Es=[(-Cs-ws)/(2*Ts),(-Cs+ws)/(2*Ts)];Ts<0&&(Es=[Es[1],Es[0]]);let Ss=!1;for(let Ds of Es)addTimePointBezier({t:Ds,ind:cs,ts:ls,ignoreLeft:us})&&(Ss=!0);us=Ss}else us=!1}}for(let cs of ls)is.push([as(cs),os(cs)]);return{setValue:{allCurvatureChangePoints:is}}}},rs.nCurvatureChangePoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"allCurvatureChangePoints"}}),definition({dependencyValues:ns}){return{setValue:{nCurvatureChangePoints:ns.allCurvatureChangePoints.length}}}},rs.curvatureChangePoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents(ns){return ns==="curvatureChangePointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["curvatureChangePointX","curvatureChangePoint"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="curvatureChangePointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="curvatureChangePoints")return ns.length===1?"curvatureChangePoint"+ns[0]:`curvatureChangePointX${ns[0]}_${ns[1]}`;if(is.slice(0,20)==="curvatureChangePoint"){let as=Number(is.slice(20));if(Number.isInteger(as)&&as>0)return`curvatureChangePointX${as}_${ns[0]}`}return null},returnArraySizeDependencies:()=>({nCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"nCurvatureChangePoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nCurvatureChangePoints,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"allCurvatureChangePoints"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)for(let os=0;os<2;os++){let ls=`${as},${os}`;is[ls]=ns.allCurvatureChangePoints[as][os]}return{setValue:{curvatureChangePoints:is}}}},rs.nearestPointAsCurve={returnDependencies:()=>({nearestPointAsCurvePrelim:{dependencyType:"stateVariable",variableName:"nearestPointAsCurvePrelim"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nearestPointAsCurve"]},adapterSourceValue:{dependencyType:"adapterSourceStateVariable",variableName:"nearestPointAsCurve"}}),definition({dependencyValues:ns,usedDefault:is}){let as=ns.nearestPointAsCurvePrelim;return is.nearestPointAsCurvePrelim&&(ns.functionChild.length>0?as=ns.functionChild[0].stateValues.nearestPointAsCurve:ns.adapterSourceValue!==null&&(as=ns.adapterSourceValue)),{setValue:{nearestPointAsCurve:as}}}},rs.nearestPoint={returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},fs:{dependencyType:"stateVariable",variableName:"fs"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"},parMin:{dependencyType:"stateVariable",variableName:"parMin"},parMax:{dependencyType:"stateVariable",variableName:"parMax"},periodic:{dependencyType:"stateVariable",variableName:"periodic"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},nearestPointAsCurve:{dependencyType:"stateVariable",variableName:"nearestPointAsCurve"}}),definition({dependencyValues:ns}){let is=null;return ns.curveType==="function"?is=getNearestPointFunctionCurve({dependencyValues:ns,numerics:ts}):["parameterization","bezier"].includes(ns.curveType)&&(is=getNearestPointParametrizedCurve({dependencyValues:ns,numerics:ts})),{setValue:{nearestPoint:is}}}},rs}async moveControlVector({controlVector:ts,controlVectorInds:rs,transient:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){let ls={[rs+",0"]:Context.fromAst(ts[0]),[rs+",1"]:Context.fromAst(ts[1])};return ns?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:ls,sourceDetails:{controlVectorMoved:rs}}],transient:ns,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:ls,sourceDetails:{controlVectorMoved:rs}}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentId:this.componentName},result:{["controlVector"+rs.join("_")]:ts}}})}async moveThroughPoint({throughPoint:ts,throughPointInd:rs,transient:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){let ls={[rs+",0"]:Context.fromAst(ts[0]),[rs+",1"]:Context.fromAst(ts[1])};return ns?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:ls,sourceDetails:{throughPointMoved:rs}}],transient:ns,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:ls,sourceDetails:{throughPointMoved:rs}}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentId:this.componentName},result:{["throughPoint"+rs]:ts}}})}async changeVectorControlDirection({direction:ts,throughPointInd:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vectorControlDirection",value:{[rs]:ts}}],actionId:ns,sourceInformation:is,skipRendererUpdate:as})}switchCurve(){}async curveClicked({actionId:ts,name:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:rs,actionId:ts,sourceInformation:ns,skipRendererUpdate:is}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnCurve({actionId:ts,name:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:rs,actionId:ts,sourceInformation:ns,skipRendererUpdate:is}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Curve,"componentType","curve"),Ms(Curve,"rendererType","curve"),Ms(Curve,"primaryStateVariableForDefinition","fShadow");function getNearestPointFunctionCurve({dependencyValues:ss,numerics:ts}){let rs=ss.flipFunction,ns=ss.fs[0],is=ss.nDiscretizationPoints,as=ss.parMax,os=ss.parMin;return function({variables:ls,scales:us}){var ks,_s;let cs=(ks=ls.x1)==null?void 0:ks.evaluate_to_constant(),ps=(_s=ls.x2)==null?void 0:_s.evaluate_to_constant(),ds=us[0],fs=us[1],hs,ys;if(os!==-1/0){if(hs=os,ys=ns(os),!Number.isFinite(ys)){let Bs=os*.99999+as*1e-5,Us=ns(Bs);Number.isFinite(Us)&&(hs=Bs,ys=Us)}if(rs){let Bs=hs;hs=ys,ys=Bs}}let gs,bs;if(as!==1/0){if(gs=as,bs=ns(as),!Number.isFinite(bs)){let Bs=os*1e-5+as*.99999,Us=ns(Bs);Number.isFinite(Us)&&(gs=Bs,bs=Us)}if(rs){let Bs=gs;gs=bs,bs=Bs}}if(!ss.nearestPointAsCurve||!(Number.isFinite(cs)&&Number.isFinite(ps))){let Bs,Us;if(rs?(Us=ps,Bs=ns(Us)):(Bs=cs,Us=ns(Bs)),!(Number.isFinite(Bs)&&Number.isFinite(Us))){let zs,Hs;rs?(zs=Math.abs(os-ps),Hs=Math.abs(as-ps)):(zs=Math.abs(os-cs),Hs=Math.abs(as-cs)),zs<Hs||!Number.isFinite(Hs)?(Bs=hs,Us=ys):(Bs=gs,Us=bs)}if(Number.isFinite(Bs)&&Number.isFinite(Us)){let zs={x1:Bs,x2:Us};return ls.x3!==void 0&&(zs.x3=0),zs}if(!(Number.isFinite(cs)&&Number.isFinite(ps)))return{}}let vs=function(Bs){let Us=cs,zs=ps;return rs?(Us-=ns(Bs),zs-=Bs):(Us-=Bs,zs-=ns(Bs)),Us/=ds,zs/=fs,Us*Us+zs*zs},Ns=0,Ts=1;os!==-1/0&&(Ns=os),as!==-1/0&&(Ts=as);let Cs=is,xs=(Ts-Ns)/Cs,As=Ns,ws=vs(Ns),Es=Ns,Ss=Ns+xs,Ds,Vs;for(let Bs=1;Bs<=Cs;Bs++){let Us=Ns+Bs*xs,zs=vs(Us);Number.isFinite(zs)&&Number.isFinite(Ds)&&(zs<ws||Number.isNaN(ws))&&(As=Us,ws=zs,Es=Vs,Bs===Cs?Ss=Us:Ss=Us+xs),Ds=zs,Vs=Us}let Is=vs(Ss);Number.isFinite(Is)||(Ss-=xs);let Os=ts.fminbr(vs,[Es,Ss]);As=Os.x;let Ps=As,$s=ns(Ps),Rs;if(Os.success&&Number.isFinite(Ps)&&Number.isFinite($s)?(rs&&([Ps,$s]=[$s,Ps]),Rs=Math.pow((Ps-cs)/ds,2)+Math.pow(($s-ps)/fs,2)):Rs=1/0,os!==-1/0){let Bs=Math.pow((hs-cs)/ds,2)+Math.pow((ys-ps)/fs,2);Bs<Rs&&(Ps=hs,$s=ys,Rs=Bs)}if(as!==1/0){let Bs=Math.pow((gs-cs)/ds,2)+Math.pow((bs-ps)/fs,2);Bs<Rs&&(Ps=gs,$s=bs,Rs=Bs)}return Os={x1:Ps,x2:$s},ls.x3!==void 0&&(Os.x3=0),Os}}function getNearestPointParametrizedCurve({dependencyValues:ss,numerics:ts}){let rs=ss.fs,ns=ss.parMin,is=ss.parMax,as=ss.nDiscretizationPoints,os=ss.periodic;return function({variables:ls,scales:us}){var Is,Os;let cs=us[0],ps=us[1];if(ss.fs.length!==2)return{};let ds=(Is=ls.x1)==null?void 0:Is.evaluate_to_constant(),fs=(Os=ls.x2)==null?void 0:Os.evaluate_to_constant();if(!(Number.isFinite(ds)&&Number.isFinite(fs)))return{};let hs=function(Ps){let $s=(ds-rs[0](Ps))/cs,Rs=(fs-rs[1](Ps))/ps;return $s*$s+Rs*Rs},ys=ns,gs=is,bs=as,vs=(gs-ys)/bs,Ns=ys,Ts=hs(ys),Cs=ys,xs=ys+vs,As,ws;for(let Ps=1;Ps<=bs;Ps++){let $s=ys+Ps*vs,Rs=hs($s);Number.isFinite(Rs)&&Number.isFinite(As)&&(Rs<Ts||Number.isNaN(Ts))&&(Ns=$s,Ts=Rs,Cs=ws,Ps===bs?xs=$s:xs=$s+vs),As=Rs,ws=$s}os&&(Math.abs(Ns-ys)<ts.eps?Cs=ys-vs:Math.abs(Ns-gs)<ts.eps&&(xs=gs+vs));let Es=ts.fminbr(hs,[Cs,xs]);Ns=Es.x;let Ss=rs[0](Ns),Ds=rs[1](Ns),Vs=hs(Ns);if(!Es.success&&Number.isFinite(Ss)&&Number.isFinite(Ds)&&(Vs=1/0),Number.isFinite(ns)){let Ps=hs(ns);Ps<Vs&&(Ns=ns,Ss=rs[0](Ns),Ds=rs[1](Ns),Vs=Ps)}if(Number.isFinite(is)){let Ps=hs(is);Ps<Vs&&(Ns=is,Ss=rs[0](Ns),Ds=rs[1](Ns),Vs=Ps)}return Es={x1:Ss,x2:Ds},ls.x3!==void 0&&(Es.x3=0),Es}}function calculateControlVectorFromSpline({tau:ss,eps:ts,point1:rs,point2:ns,point3:is,splineForm:as}){let os=function(hs,ys){let gs=hs[0]-ys[0],bs=hs[1]-ys[1];return Math.sqrt(gs*gs+bs*bs)},ls,us,cs;if(ns)us=ns.map(hs=>hs.evaluate_to_constant());else return{coordsNumeric:[Context.fromAst(NaN),Context.fromAst(NaN)],numericEntries:!1};if(is)cs=is.map(hs=>hs.evaluate_to_constant()),rs?ls=rs.map(hs=>hs.evaluate_to_constant()):ls=[2*us[0]-cs[0],2*us[1]-cs[1]];else if(rs)ls=rs.map(hs=>hs.evaluate_to_constant()),cs=[2*us[0]-ls[0],2*us[1]-ls[1]];else return{coordsNumeric:[Context.fromAst(NaN),Context.fromAst(NaN)],numericEntries:!1};let ps=[];if(as==="centripetal"){let hs=os(ls,us),ys=os(us,cs);hs=Math.sqrt(hs),ys=Math.sqrt(ys),ys<ts&&(ys=1),hs<ts&&(hs=ys);for(let gs=0;gs<2;gs++){let bs=(us[gs]-ls[gs])/hs-(cs[gs]-ls[gs])/(ys+hs)+(cs[gs]-us[gs])/ys;bs*=ss*Math.sqrt(hs*ys),ps.push(-bs/3)}}else for(let hs=0;hs<2;hs++)ps.push(-ss*(cs[hs]-ls[hs])/3);let ds=ps.map(hs=>Context.fromAst(hs)),fs=Number.isFinite(ps[0])&&Number.isFinite(ps[1]);return{coordsNumeric:ds,numericEntries:fs}}function initCubicPoly(ss,ts,rs,ns){return[ss,rs,-3*ss+3*ts-2*rs-ns,2*ss-2*ts+rs+ns]}function addTimePointBezier({t:ss,ind:ts,ts:rs,ignoreLeft:ns=!1}){const as=1.00000000000001,os=1-1e-14;let ls=!1;return ss>=1e-14?ss<=os?rs.push(ts+ss):ss<as&&(rs.push(ts+1),ls=!0):ss>-1e-14&&!ns&&rs.push(ts),ls}class EquilibriumCurve extends Curve{static createAttributesObject(){let ts=super.createAttributesObject();return ts.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},ts.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},ts}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.dashed={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition({dependencyValues:ns}){return{setValue:{dashed:!ns.stable}}},inverseDefinition({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"stable",desiredValue:!ns.dashed}]}}},rs}async switchCurve({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:ts})}}Ms(EquilibriumCurve,"componentType","equilibriumCurve"),Ms(EquilibriumCurve,"rendererType","curve");var DynamicalSystems=Object.freeze({__proto__:null,CobwebPolyline,EquilibriumCurve,EquilibriumLine,EquilibriumPoint,ODESystem});class Atom extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.symbol={createComponentOfType:"text"},ts.atomicNumber={createComponentOfType:"integer"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.atomicNumberShadow={defaultValue:null,hasEssential:!0,essentialVarName:"atomicNumber",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{atomicNumberShadow:!0}}),inverseDefinition:async function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"atomicNumberShadow",value:rs.atomicNumberShadow}]}}},ts.dataForAtom={returnDependencies:()=>({fileContents:{dependencyType:"file",cid:"bafkreibilal4glrbpo7p7oodtwtnzkfhiylfoqa2td4ij6h6iqva57kzcy",fileType:"csv"},symbolAttr:{dependencyType:"attributeComponent",attributeName:"symbol",variableNames:["value"]},atomicNumberAttr:{dependencyType:"attributeComponent",attributeName:"atomicNumber",variableNames:["value"]},atomicNumberShadow:{dependencyType:"stateVariable",variableName:"atomicNumberShadow"}}),definition:function({dependencyValues:rs}){let ns=null,is=null;if(rs.symbolAttr)ns=rs.symbolAttr.stateValues.value.toLowerCase();else if(rs.atomicNumberAttr)is=rs.atomicNumberAttr.stateValues.value;else if(rs.atomicNumberShadow)is=rs.atomicNumberShadow;else return{setValue:{dataForAtom:null}};let as=rs.fileContents.trim().split(`
`),os;is!==null?os=is-1:os=["h","he","li","be","b","c","n","o","f","ne","na","mg","al","si","p","s","cl","ar","k","ca","sc","ti","v","cr","mn","fe","co","ni","cu","zn","ga","ge","as","se","br","kr","rb","sr","y","zr","nb","mo","tc","ru","rh","pd","ag","cd","in","sn","sb","te","i","xe","cs","ba","la","ce","pr","nd","pm","sm","eu","gd","tb","dy","ho","er","tm","yb","lu","hf","ta","w","re","os","ir","pt","au","hg","tl","pb","bi","po","at","rn","fr","ra","ac","th","pa","u","np","pu","am","cm","bk","cf","es","fm","md","no","lr","rf","db","sg","bh","hs","mt","ds","rg","cn","nh","fl","mc","lv","ts","og"].indexOf(ns==null?void 0:ns.toLowerCase());let ls=as.slice(1)[os];if(!ls)return{setValue:{dataForAtom:null}};ls=ls.trim().split(",").map(fs=>fs.trim());let us=as[0].trim().split(",").map(fs=>fs.trim()).map(fs=>(['"',"'"].includes(fs[0])&&fs[fs.length-1]===fs[0]&&(fs=fs.substring(1,fs.length-1).trim()),fs)),cs=us.length,ps=["number","string","string","number","number","string","number","string","string","number","number","number","number","number","number","number","string"],ds={};for(let fs=0;fs<cs;fs++){let hs=us[fs],ys=ps[fs],gs;ys==="number"?(gs=ls[fs],gs===""?gs=NaN:gs=Number(gs)):(gs=ls[fs],['"',"'"].includes(gs[0])&&gs[gs.length-1]===gs[0]&&(gs=gs.substring(1,gs.length-1))),hs==="Electron Configuration"?ds[hs]=Context.fromText(gs):ds[hs]=gs}return{setValue:{dataForAtom:ds}}}},ts.atomicNumber={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Atomic Number"]:ns=null,{setValue:{atomicNumber:ns}}}},ts.symbol={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Symbol:ns=null,{setValue:{symbol:ns}}}},ts.name={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Name:ns=null,{setValue:{name:ns}}}},ts.group={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Group:ns=null,{setValue:{group:ns}}}},ts.atomicMass={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Atomic Mass"]:ns=null,{setValue:{atomicMass:ns}}}},ts.phaseAtSTP={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Phase at STP"]:ns=null,{setValue:{phaseAtSTP:ns}}}},ts.chargeOfCommonIon={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Charge of Common Ion"]:ns=null,{setValue:{chargeOfCommonIon:ns}}}},ts.metalCategory={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Metal/Nonmetal/Metalloid"]:ns=null,{setValue:{metalCategory:ns}}}},ts.groupName={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Group Name"]:ns=null,{setValue:{groupName:ns}}}},ts.period={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Period:ns=null,{setValue:{period:ns}}}},ts.ionizationEnergy={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Ionization Energy"]:ns=null,{setValue:{ionizationEnergy:ns}}}},ts.meltingPoint={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Melting Point"]:ns=null,{setValue:{meltingPoint:ns}}}},ts.boilingPoint={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Boiling Point"]:ns=null,{setValue:{boilingPoint:ns}}}},ts.atomicRadius={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Atomic Radius"]:ns=null,{setValue:{atomicRadius:ns}}}},ts.density={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Density:ns=null,{setValue:{density:ns}}}},ts.electronegativity={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Electronegativity:ns=null,{setValue:{electronegativity:ns}}}},ts.electronConfiguration={public:!0,shadowingInstructions:{createComponentOfType:"electronConfiguration"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Electron Configuration"]:ns=null,{setValue:{electronConfiguration:ns}}}},ts.orbitalDiagram={public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},returnDependencies:()=>({electronConfiguration:{dependencyType:"stateVariable",variableName:"electronConfiguration"}}),definition({dependencyValues:rs}){let ns;return rs.electronConfiguration?ns=electronConfigurationToOrbitalDiagram(rs.electronConfiguration):ns=null,{setValue:{orbitalDiagram:ns}}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({symbol:{dependencyType:"stateVariable",variableName:"symbol"}}),definition({dependencyValues:rs}){let ns;return rs.symbol?ns=["^",rs.symbol]:ns="",{setValue:{math:Context.fromAst(ns)}}}},ts.latex={additionalStateVariablesDefined:[{variableName:"latexWithInputChildren",forRenderer:!0}],returnDependencies:()=>({symbol:{dependencyType:"stateVariable",variableName:"symbol"}}),definition({dependencyValues:rs}){let ns;return rs.symbol?ns=`\\text{${rs.symbol}}`:ns="[\\text{Invalid Chemical Symbol}]",{setValue:{latex:ns,latexWithInputChildren:[ns]}}}},ts}}Ms(Atom,"componentType","atom"),Ms(Atom,"rendererType","math"),Ms(Atom,"primaryStateVariableForDefinition","atomicNumberShadow"),Ms(Atom,"adapters",["math","name",{stateVariable:"atomicNumber",componentType:"ion"}]);function electronConfigurationToOrbitalDiagram(ss){let ts=ss.tree;if(!(Array.isArray(ts)&&ts[0]==="*"))return null;ts=ts.slice(1);let rs=ts.length/2;if(!Number.isInteger(rs))return null;let ns=[];for(let is=0;is<rs;is++){let as=ts[2*is];if(!(Number.isInteger(as)&&as>0))return null;let os=ts[2*is+1];if(!(Array.isArray(os)&&os[0]==="^"))return null;let ls=os[1],us=os[2];if(!(["s","p","d","f"].includes(ls)&&Number.isInteger(us)&&us>0))return null;let cs=`${as}${ls}`,ps;ls==="s"?ps=1:ls==="p"?ps=3:ls==="d"?ps=5:ps=7;let ds=Array(ps).fill("");for(let fs=0;fs<Math.min(ps,us);fs++)us<=fs+ps?ds[fs]="U":ds[fs]="UD";ns.push({orbitalText:cs,boxes:ds})}return ns}class Ion extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.symbol={createComponentOfType:"text"},ts.atomicNumber={createComponentOfType:"integer"},ts.charge={createComponentOfType:"integer"},ts}static returnChildGroups(){return[{group:"atoms",componentTypes:["atom"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.atomicNumberShadow={defaultValue:null,hasEssential:!0,essentialVarName:"atomicNumber",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{atomicNumberShadow:!0}}),inverseDefinition:async function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"atomicNumberShadow",value:rs.atomicNumberShadow}]}}},ts.dataForAtom={returnDependencies:()=>({fileContents:{dependencyType:"file",cid:"bafkreibilal4glrbpo7p7oodtwtnzkfhiylfoqa2td4ij6h6iqva57kzcy",fileType:"csv"},symbolAttr:{dependencyType:"attributeComponent",attributeName:"symbol",variableNames:["value"]},atomicNumberAttr:{dependencyType:"attributeComponent",attributeName:"atomicNumber",variableNames:["value"]},atomChild:{dependencyType:"child",childGroups:["atoms"],variableNames:["atomicNumber"]},atomicNumberShadow:{dependencyType:"stateVariable",variableName:"atomicNumberShadow"}}),definition:function({dependencyValues:rs}){let ns=null,is=null;if(rs.atomChild.length>0)is=rs.atomChild[0].stateValues.atomicNumber;else if(rs.symbolAttr)ns=rs.symbolAttr.stateValues.value.toLowerCase();else if(rs.atomicNumberAttr)is=rs.atomicNumberAttr.stateValues.value;else if(rs.atomicNumberShadow)is=rs.atomicNumberShadow;else return{setValue:{dataForAtom:null}};let as=rs.fileContents.trim().split(`
`),os;is!==null?os=is-1:os=["h","he","li","be","b","c","n","o","f","ne","na","mg","al","si","p","s","cl","ar","k","ca","sc","ti","v","cr","mn","fe","co","ni","cu","zn","ga","ge","as","se","br","kr","rb","sr","y","zr","nb","mo","tc","ru","rh","pd","ag","cd","in","sn","sb","te","i","xe","cs","ba","la","ce","pr","nd","pm","sm","eu","gd","tb","dy","ho","er","tm","yb","lu","hf","ta","w","re","os","ir","pt","au","hg","tl","pb","bi","po","at","rn","fr","ra","ac","th","pa","u","np","pu","am","cm","bk","cf","es","fm","md","no","lr","rf","db","sg","bh","hs","mt","ds","rg","cn","nh","fl","mc","lv","ts","og"].indexOf(ns==null?void 0:ns.toLowerCase());let ls=as.slice(1)[os];if(!ls)return{setValue:{dataForAtom:null}};ls=ls.trim().split(",").map(fs=>fs.trim());let us=as[0].trim().split(",").map(fs=>fs.trim()).map(fs=>(['"',"'"].includes(fs[0])&&fs[fs.length-1]===fs[0]&&(fs=fs.substring(1,fs.length-1).trim()),fs)),cs=us.length,ps=["number","string","string","number","number","string","number","string","string","number","number","number","number","number","number","number","string"],ds={};for(let fs=0;fs<cs;fs++){let hs=us[fs],ys=ps[fs],gs;ys==="number"?(gs=ls[fs],gs===""?gs=NaN:gs=Number(gs)):(gs=ls[fs],['"',"'"].includes(gs[0])&&gs[gs.length-1]===gs[0]&&(gs=gs.substring(1,gs.length-1))),hs==="Electron Configuration"?ds[hs]=Context.fromText(gs):ds[hs]=gs}return{setValue:{dataForAtom:ds}}}},ts.atomicNumber={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Atomic Number"]:ns=null,{setValue:{atomicNumber:ns}}}},ts.symbol={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Symbol:ns=null,{setValue:{symbol:ns}}}},ts.charge={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"},chargeAttr:{dependencyType:"attributeComponent",attributeName:"charge",variableNames:["value"]}}),definition({dependencyValues:rs}){let ns;return rs.chargeAttr?(ns=rs.chargeAttr.stateValues.value,Number.isFinite(ns)||(ns=0)):rs.dataForAtom?ns=rs.dataForAtom["Charge of Common Ion"]||0:ns=0,{setValue:{charge:ns}}}},ts.name={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"},charge:{dependencyType:"stateVariable",variableName:"charge"},group:{dependencyType:"stateVariable",variableName:"group"},atomicNumber:{dependencyType:"stateVariable",variableName:"atomicNumber"}}),definition({dependencyValues:rs}){let ns;if(rs.dataForAtom){if(ns=rs.dataForAtom.Name,rs.charge<0){let is={Hydrogen:"Hydride",Oxygen:"Oxide",Sulfur:"Sulfide",Nitrogen:"Nitride",Phosphorus:"Phosphide",Carbon:"Carbide"},as=ns.length;ns.substring(as-3,as)==="ine"?ns=ns.substring(0,as-3)+"ide":ns in is&&(ns=is[ns])}else if(rs.charge>0&&(rs.group>=3&&rs.group<=12||rs.group===101||rs.group===102||[13,31,49,50,81,82,83,84].includes(rs.atomicNumber))){let is="";switch(rs.charge){case 1:is=" (I)";break;case 2:is=" (II)";break;case 3:is=" (III)";break;case 4:is=" (IV)";break;case 5:is=" (V)";break;case 6:is=" (VI)";break;case 7:is=" (VII)";break;case 8:is=" (VIII)";break}ns+=is}}else ns=null;return{setValue:{name:ns}}}},ts.group={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Group:ns=null,{setValue:{group:ns}}}},ts.metalCategory={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Metal/Nonmetal/Metalloid"]:ns=null,{setValue:{metalCategory:ns}}}},ts.groupName={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom["Group Name"]:ns=null,{setValue:{groupName:ns}}}},ts.period={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:rs}){let ns;return rs.dataForAtom?ns=rs.dataForAtom.Period:ns=null,{setValue:{period:ns}}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({symbol:{dependencyType:"stateVariable",variableName:"symbol"},charge:{dependencyType:"stateVariable",variableName:"charge"}}),definition({dependencyValues:rs}){let ns;return rs.symbol?(ns=["^",rs.symbol],rs.charge===-1?ns.push("-"):rs.charge===1?ns.push("+"):rs.charge<0?ns.push(Math.abs(rs.charge)+"-"):rs.charge>0&&ns.push(Math.abs(rs.charge)+"+")):ns="",{setValue:{math:Context.fromAst(ns)}}}},ts.latex={additionalStateVariablesDefined:[{variableName:"latexWithInputChildren",forRenderer:!0}],returnDependencies:()=>({symbol:{dependencyType:"stateVariable",variableName:"symbol"},charge:{dependencyType:"stateVariable",variableName:"charge"}}),definition({dependencyValues:rs}){let ns;return rs.symbol?(ns=`\\text{${rs.symbol}}`,rs.charge===-1?ns=ns+"^-":rs.charge===1?ns=ns+"^+":rs.charge<0?ns=ns+`^{${Math.abs(rs.charge)}-}`:rs.charge>0&&(ns=ns+`^{${Math.abs(rs.charge)}+}`)):ns="[\\text{Invalid Chemical Symbol}]",{setValue:{latex:ns,latexWithInputChildren:[ns]}}}},ts}}Ms(Ion,"componentType","ion"),Ms(Ion,"rendererType","math"),Ms(Ion,"primaryStateVariableForDefinition","atomicNumberShadow"),Ms(Ion,"adapters",["math","name"]);class IonicCompound extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.symbol={createComponentOfType:"text"},ts.atomicNumber={createComponentOfType:"integer"},ts.charge={createComponentOfType:"integer"},ts}static returnChildGroups(){return[{group:"ions",componentTypes:["ion"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.ionicCompound={returnDependencies:()=>({ionChildren:{dependencyType:"child",childGroups:["ions"],variableNames:["symbol","charge","atomicNumber","name"]}}),definition({dependencyValues:rs}){let ns=rs.ionChildren.map(us=>us.stateValues.charge);if(ns.length!==2)return console.warn("have not implemented ionic compound for anything other than two ions"),{setValue:{ionicCompound:null}};if(!(ns[0]*ns[1]<0))return console.warn("ionic compound implemented only for one cation and one anion"),{setValue:{ionicCompound:null}};let is=Math.abs(ns[1]),as=Math.abs(ns[0]),os=Context.math.gcd(is,as);return is/=os,as/=os,{setValue:{ionicCompound:[{symbol:rs.ionChildren[0].stateValues.symbol,atomicNumber:rs.ionChildren[0].stateValues.atomicNumber,name:rs.ionChildren[0].stateValues.name,charge:ns[0],count:is},{symbol:rs.ionChildren[1].stateValues.symbol,atomicNumber:rs.ionChildren[1].stateValues.atomicNumber,name:rs.ionChildren[1].stateValues.name,charge:ns[1],count:as}]}}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({ionicCompound:{dependencyType:"stateVariable",variableName:"ionicCompound"}}),definition({dependencyValues:rs}){let ns;if(rs.ionicCompound){ns=[];for(let is of rs.ionicCompound){let as=is.symbol;is.count>1&&(as=["_",as,is.count]),ns.push(as)}ns.length>1?ns=["*",...ns]:ns.length===1?ns=ns[0]:ns=""}else ns="";return{setValue:{math:Context.fromAst(ns)}}}},ts.latex={additionalStateVariablesDefined:[{variableName:"latexWithInputChildren",forRenderer:!0}],returnDependencies:()=>({ionicCompound:{dependencyType:"stateVariable",variableName:"ionicCompound"}}),definition({dependencyValues:rs}){let ns;if(rs.ionicCompound){ns="";for(let is of rs.ionicCompound)ns+=`\\text{${is.symbol}}`,is.count>1&&(ns+=`_{${is.count}}`)}else ns="[\\text{Invalid Ionic Compound}]";return{setValue:{latex:ns,latexWithInputChildren:[ns]}}}},ts}}Ms(IonicCompound,"componentType","ionicCompound"),Ms(IonicCompound,"rendererType","math"),Ms(IonicCompound,"adapters",["math"]);class ElectronConfiguration extends MathComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is;try{is=rs.valueForDisplay.toLatex()}catch{is=""}return is=is.replaceAll("\\,",""),is=is.replaceAll("\\cdot","~"),{setValue:{latex:is}}}},ts}}Ms(ElectronConfiguration,"componentType","electronConfiguration"),Ms(ElectronConfiguration,"rendererType","math");class OrbitalDiagram extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.labels={createComponentOfType:"textList",createStateVariable:"labels",defaultValue:[]},ts}static returnSugarInstructions(){return[{replacementFunction:function({matchedChildren:rs}){return rs.length===1&&typeof rs[0]!="string"?{success:!1}:{success:!0,newChildren:[{componentType:"tupleList",children:rs}]}}}]}static returnChildGroups(){return[{group:"tupleLists",componentTypes:["tupleList"]},{group:"orbitalDiagrams",componentTypes:["orbitalDiagram"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={defaultValue:[{orbitalText:"",boxes:[]}],public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},forRenderer:!0,returnDependencies:()=>({orbitalDiagramChildren:{dependencyType:"child",childGroups:["orbitalDiagrams"],variableNames:["value"]},tupleListChildren:{dependencyType:"child",childGroups:["tupleLists"],variableNames:["maths"]},labels:{dependencyType:"stateVariable",variableName:"labels"}}),definition:function({dependencyValues:rs}){function ns(){var os;function is(ls){if(ls==="u"||ls==="U")return"U";if(ls==="d"||ls==="D")return"D";if(ls==="e"||ls==="E")return"";if(Array.isArray(ls)&&ls[0]==="*"){let us="";for(let cs of ls.slice(1))if(cs==="u"||cs==="U")us+="U";else if(cs==="d"||cs==="D")us+="D";else return"";return us}else return""}if(rs.orbitalDiagramChildren.length===1)return rs.orbitalDiagramChildren[0].stateValues.value;let as=[];if(((os=rs.tupleListChildren[0])==null?void 0:os.stateValues.maths.length)>0){let ls=rs.tupleListChildren[0].stateValues.maths;for(let[us,cs]of ls.entries()){let ps="";rs.labels[us]&&(ps=rs.labels[us]);let ds=[];if(Array.isArray(cs.tree)&&cs.tree[0]==="tuple")for(let fs of cs.tree.slice(1))ds.push(is(fs));else ds.push(is(cs.tree));as.push({orbitalText:ps,boxes:ds})}return as}else return[{orbitalText:"",boxes:[]}]}return{setValue:{value:ns()}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(OrbitalDiagram,"componentType","orbitalDiagram"),Ms(OrbitalDiagram,"variableForPlainMacro","value");class OrbitalDiagramInput extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{addRow:this.addRow.bind(this),removeRow:this.removeRow.bind(this),addBox:this.addBox.bind(this),removeBox:this.removeBox.bind(this),addUpArrow:this.addUpArrow.bind(this),addDownArrow:this.addDownArrow.bind(this),removeArrow:this.removeArrow.bind(this),updateRowText:this.updateRowText.bind(this),selectRow:this.selectRow.bind(this),selectBox:this.selectBox.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.prefill={createComponentOfType:"orbitalDiagram",createStateVariable:"prefill",defaultValue:[]},ts.prefillLabel={createComponentOfType:"textList",createStateVariable:"prefillLabel",defaultValue:[]},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={defaultValue:[{orbitalText:"",boxes:[]}],hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},returnDependencies:()=>({prefill:{dependencyType:"stateVariable",variableName:"prefill"},prefillLabel:{dependencyType:"stateVariable",variableName:"prefillLabel"}}),definition:function({dependencyValues:rs}){function ns(){var is;if(((is=rs.prefill)==null?void 0:is.length)>0){let as=JSON.parse(JSON.stringify(rs.prefill));for(let[os,ls]of as.entries())rs.prefillLabel[os]&&(ls.orbitalText=rs.prefillLabel[os]);return as}else return[{orbitalText:"",boxes:[]}]}return{useEssentialOrDefaultValue:{value:{get defaultValue(){return ns()}}}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"value",value:rs.value}]}}},ts.rows={public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:rs}){return{setValue:{rows:[...rs.value].reverse()}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setDependency:"value",desiredValue:[...rs.rows].reverse()}]}}},ts.numRows={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({rows:{dependencyType:"stateVariable",variableName:"rows"}}),definition:function({dependencyValues:rs}){return{setValue:{numRows:rs.rows.length}}}},ts.selectedRowIndex={defaultValue:0,hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({}),definition:function(){return{useEssentialOrDefaultValue:{selectedRowIndex:!0}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){let is=await ns.numRows,as=rs.selectedRowIndex;return Number.isFinite(as)?as=Math.min(is,Math.max(0,Math.round(as))):as=0,{success:!0,instructions:[{setEssentialValue:"selectedRowIndex",value:as}]}}},ts.selectedBoxIndex={defaultValue:0,hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({}),definition:function(){return{useEssentialOrDefaultValue:{selectedBoxIndex:!0}}},async inverseDefinition({desiredStateVariableValues:rs}){let ns=rs.selectedBoxIndex;return Number.isFinite(ns)?ns=Math.max(0,Math.round(ns)):ns=0,{success:!0,instructions:[{setEssentialValue:"selectedBoxIndex",value:ns}]}}},ts}async addRow({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is));is.length<20&&(as=[{orbitalText:"",boxes:[]},...is]);let os=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];return await this.stateValues.selectedRowIndex-1!==-1&&os.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:0}),await this.stateValues.selectedBoxIndex-1!==-1&&os.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}),await this.coreFunctions.performUpdate({updateInstructions:os,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async removeRow({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=await this.stateValues.selectedRowIndex-1,os=JSON.parse(JSON.stringify(is));if(is.length>1){let ls=is.length-1-as;as===-1&&(ls=0),os.splice(ls,1)}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:os},{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:0},{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:os}}})}async addBox({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is)),os=await this.stateValues.selectedRowIndex-1,ls=is.length-os-1;os===-1&&(ls=0),as[ls].boxes.length<17&&as[ls].boxes.push("");let us=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];if(os!==-1){let cs=0;us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:cs})}return await this.coreFunctions.performUpdate({updateInstructions:us,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async removeBox({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is)),os=await this.stateValues.selectedRowIndex-1,ls=is.length-os-1;os===-1&&(ls=0);let us=await this.stateValues.selectedBoxIndex-1,cs=us;us===-1&&(cs=as[ls].boxes.length-1),as[ls].boxes.splice(cs,1);let ps=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];return us!==-1&&ps.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}),await this.coreFunctions.performUpdate({updateInstructions:ps,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async addUpArrow({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is)),os=await this.stateValues.selectedRowIndex-1,ls=is.length-os-1;os===-1&&(ls=0);let us=await this.stateValues.selectedBoxIndex-1,cs=us;us===-1&&(cs=as[ls].boxes.length-1),as[ls].boxes.length>0&&as[ls].boxes[cs].length<3&&(as[ls].boxes[cs]=as[ls].boxes[cs]+"U");let ps=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];return await this.coreFunctions.performUpdate({updateInstructions:ps,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async addDownArrow({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is)),os=await this.stateValues.selectedRowIndex-1,ls=is.length-os-1;os===-1&&(ls=0);let us=await this.stateValues.selectedBoxIndex-1,cs=us;us===-1&&(cs=as[ls].boxes.length-1),as[ls].boxes.length>0&&as[ls].boxes[cs].length<3&&(as[ls].boxes[cs]=as[ls].boxes[cs]+"D");let ps=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];return await this.coreFunctions.performUpdate({updateInstructions:ps,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async removeArrow({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.rows,as=JSON.parse(JSON.stringify(is)),os=await this.stateValues.selectedRowIndex-1,ls=is.length-os-1;os===-1&&(ls=0);let us=await this.stateValues.selectedBoxIndex-1,cs=us;us===-1&&(cs=as[ls].boxes.length-1),as[ls].boxes.length>0&&as[ls].boxes[cs].length>0&&(as[ls].boxes[cs]=as[ls].boxes[cs].slice(0,-1));let ps=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:as}];return await this.coreFunctions.performUpdate({updateInstructions:ps,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:as}}})}async updateRowText({newValue:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=await this.stateValues.rows,os=JSON.parse(JSON.stringify(as)),ls=await this.stateValues.selectedRowIndex-1,us=as.length-ls-1;ls===-1&&(us=0),os[us].orbitalText=ts;let cs=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:os}];return await this.coreFunctions.performUpdate({updateInstructions:cs,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:os}}})}async selectRow({index:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{selectedRowIndex:ts}}})}async selectBox({index:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{selectedBoxIndex:ts}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(OrbitalDiagramInput,"componentType","orbitalDiagramInput"),Ms(OrbitalDiagramInput,"variableForPlainMacro","value"),Ms(OrbitalDiagramInput,"variableForPlainCopy","value");var Chemistry=Object.freeze({__proto__:null,Atom,ElectronConfiguration,Ion,IonicCompound,OrbitalDiagram,OrbitalDiagramInput});class FeedbackDefinition extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.code={createComponentOfType:"text"},ts.text={createComponentOfType:"text"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.feedbackDefinition={returnDependencies:()=>({codeAttr:{dependencyType:"attributeComponent",attributeName:"code",variableNames:["value"]},textAttr:{dependencyType:"attributeComponent",attributeName:"text",variableNames:["value"]}}),definition({dependencyValues:rs}){return rs.codeAttr!==null&&rs.textAttr!==null?{setValue:{feedbackDefinition:{[rs.codeAttr.stateValues.value.toLowerCase()]:rs.textAttr.stateValues.value}}}:{setValue:{feedbackDefinition:null}}}},ts}}Ms(FeedbackDefinition,"componentType","feedbackDefinition");class FeedbackDefinitions extends BaseComponent{static returnChildGroups(){return[{group:"feedbackDefinition",componentTypes:["feedbackDefinition"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={returnDependencies:()=>({feedbackDefinitionChildren:{dependencyType:"child",childGroups:["feedbackDefinition"],variableNames:["feedbackDefinition"]}}),definition({dependencyValues:rs}){let ns={};for(let is of rs.feedbackDefinitionChildren)is.stateValues.feedbackDefinition&&Object.assign(ns,is.stateValues.feedbackDefinition);return{setValue:{value:ns}}}},ts}}Ms(FeedbackDefinitions,"componentType","feedbackDefinitions"),Ms(FeedbackDefinitions,"rendererType");var FeedbackDefinitions$1=Object.freeze({__proto__:null,FeedbackDefinition,FeedbackDefinitions});class StyleDefinition extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();ts.styleNumber={createPrimitiveOfType:"number",createStateVariable:"styleNumber",defaultValue:1};for(let rs in styleAttributes)ts[rs]={createComponentOfType:styleAttributes[rs].componentType};return ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDefinition={returnDependencies:function(){let rs={};for(let ns in styleAttributes)rs[ns]={dependencyType:"attributeComponent",attributeName:ns,variableNames:["value"]};return rs},definition:function({dependencyValues:rs}){let ns={};for(let is in styleAttributes)rs[is]!==null&&(ns[is]=rs[is].stateValues.value,typeof ns[is]=="string"&&(ns[is]=ns[is].toLowerCase()));return{setValue:{styleDefinition:ns}}}},ts}}Ms(StyleDefinition,"componentType","styleDefinition"),Ms(StyleDefinition,"rendererType");class StyleDefinitions extends BaseComponent{static returnChildGroups(){return[{group:"styleDefinition",componentTypes:["styleDefinition"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={returnDependencies:()=>({styleDefinitionChildren:{dependencyType:"child",childGroups:["styleDefinition"],variableNames:["styleNumber","styleDefinition"]}}),definition({dependencyValues:rs}){let ns={};for(let is of rs.styleDefinitionChildren){let as=is.stateValues.styleNumber,os=ns[as];os||(os=ns[as]={}),Object.assign(os,is.stateValues.styleDefinition)}return{setValue:{value:ns}}}},ts}}Ms(StyleDefinitions,"componentType","styleDefinitions"),Ms(StyleDefinitions,"rendererType");var StyleDefinitions$1=Object.freeze({__proto__:null,StyleDefinition,StyleDefinitions});class ComponentWithSelectableType extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createPrimitiveOfType:"string"},ts}static returnSugarInstructions(){let ts=[];function rs({matchedChildren:ns,componentAttributes:is,parentAttributes:as}){let os=is.type;os||(os=as.type),os?["number","letters","math","text","boolean"].includes(os)||(console.warn(`Invalid type ${os}, setting type to number`),os="number"):os="number";let ls=os==="letters"?"text":os;return ls!=="text"&&(ns=ns.filter(us=>typeof us!="string"||us.trim()!=="")),{success:!0,newChildren:[{componentType:ls,children:ns}]}}return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.type={shadowVariable:!0,returnDependencies:()=>({type:{dependencyType:"doenetAttribute",attributeName:"type"},parentType:{dependencyType:"parentStateVariable",variableName:"type"}}),definition:function({dependencyValues:rs,componentName:ns}){let is=rs.type;return is||(is=rs.parentType),is?["number","letters","math","text","boolean"].includes(is)||(console.warn(`Invalid type ${is}, setting type to number`),is="number"):is="number",{setValue:{type:is}}}},ts.value={public:!0,shadowingInstructions:{hasVariableComponentType:!0},shadowVariable:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},atMostOneChild:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition({dependencyValues:rs}){let ns;return rs.atMostOneChild.length>0?ns=rs.atMostOneChild[0].stateValues.value:rs.type==="text"||rs.type==="letters"?ns="":rs.type==="boolean"?ns=!1:rs.type==="number"?ns=NaN:ns=Context.fromAst(""),{setValue:{value:ns},setCreateComponentOfType:{value:rs.type}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.atMostOneChild.length>0?{success:!0,instructions:[{setDependency:"atMostOneChild",desiredValue:rs.value,childIndex:0,variableIndex:0}]}:{success:!1}}},ts}}Ms(ComponentWithSelectableType,"componentType","_componentWithSelectableType"),Ms(ComponentWithSelectableType,"rendererType"),Ms(ComponentWithSelectableType,"includeBlankStringChildren",!0);class ComponentListWithSelectableType extends ComponentWithSelectableType{static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createPrimitiveOfType:"string"},ts}static returnSugarInstructions(){let ts=[];return ts.push({replacementFunction:function({matchedChildren:rs,componentAttributes:ns,parentAttributes:is,isAttributeComponent:as=!1,createdFromMacro:os=!1,componentInfoObjects:ls}){let us=ns.type;us||(us=is.type),us?["number","letters","math","text","boolean"].includes(us)||(console.warn(`Invalid type ${us}, setting type to number`),us="number"):us="number";let cs=us==="letters"?"text":us;return as&&!os?returnGroupIntoComponentTypeSeparatedBySpaces({componentType:cs})({matchedChildren:rs}):returnBreakStringsIntoComponentTypeBySpaces({componentType:cs})({matchedChildren:rs})}}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.value,ts.nValues={additionalStateVariablesDefined:["childForValue"],returnDependencies:()=>({anythingForSelectedType:{dependencyType:"child",childGroups:["anything"],variableNames:["nValues"],variablesOptional:!0}}),definition({dependencyValues:rs}){let ns=0,is=[];for(let[as,os]of rs.anythingForSelectedType.entries()){let ls=Number.isInteger(os.stateValues.nValues)?os.stateValues.nValues:1;ns+=ls;for(let us=0;us<ls;us++)is.push({child:as,valueIndex:us})}return{setValue:{nValues:ns,childForValue:is}}}},ts.values={public:!0,isArray:!0,shadowingInstructions:{hasVariableComponentType:!0},entryPrefixes:["value"],stateVariablesDeterminingDependencies:["childForValue"],returnArraySizeDependencies:()=>({nValues:{dependencyType:"stateVariable",variableName:"nValues"}}),returnArraySize({dependencyValues:rs}){return[rs.nValues]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={type:{dependencyType:"stateVariable",variableName:"type"}},as={};for(let os of rs){let ls=ns.childForValue[os];as[os]={anythingForSelectedType:{dependencyType:"child",childGroups:["anything"],variableNames:["value","values"],childIndices:[ls.child],variablesOptional:!0},valueIndex:{dependencyType:"value",value:ls.valueIndex}}}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,componentName:as}){let os={};for(let ls of is)if(ns[ls].anythingForSelectedType&&ns[ls].anythingForSelectedType.length===1){let us=ns[ls].anythingForSelectedType[0],cs;us.stateValues.values?cs=us.stateValues.values[ns[ls].valueIndex]:cs=us.stateValues.value,os[ls]=convertValueToType(cs,rs.type)}return{setValue:{values:os},setCreateComponentOfType:{values:rs.type}}}},ts}}Ms(ComponentListWithSelectableType,"componentType","_componentListWithSelectableType"),Ms(ComponentListWithSelectableType,"includeBlankStringChildren",!0),Ms(ComponentListWithSelectableType,"removeBlankStringChildrenPostSugar",!0);class ComponentListOfListsWithSelectableType extends ComponentWithSelectableType{static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createPrimitiveOfType:"string"},ts}static returnSugarInstructions(){let ts=[],rs=function({matchedChildren:ns,componentAttributes:is,parentAttributes:as}){let os=breakEmbeddedStringsIntoParensPieces({componentList:ns,removeParens:!0});if(os.success!==!0)return{success:!1};let ls=is.type;return ls||(ls=as.type),ls?["number","letters","math","text","boolean"].includes(ls)||(console.warn(`Invalid type ${ls}, setting type to number`),ls="number"):ls="number",{success:!0,newChildren:os.pieces.map(us=>({componentType:"_componentListWithSelectableType",attributes:{type:{primitive:ls}},children:us}))}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"lists",componentTypes:["_componentListWithSelectableType"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.value,ts.nLists={returnDependencies:()=>({listChildren:{dependencyType:"child",childGroups:["lists"]}}),definition({dependencyValues:rs}){return{setValue:{nLists:rs.listChildren.length}}}},ts.lists={isArray:!0,entryPrefixes:["list"],returnArraySizeDependencies:()=>({nLists:{dependencyType:"stateVariable",variableName:"nLists"}}),returnArraySize({dependencyValues:rs}){return[rs.nLists]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={type:{dependencyType:"stateVariable",variableName:"type"}},is={};for(let as of rs)is[as]={listChildren:{dependencyType:"child",childGroups:["lists"],variableNames:["values","type"],childIndices:[as]}};return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is)if(ns[os].listChildren&&ns[os].listChildren.length===1){let ls=ns[os].listChildren[0];ls.stateValues.type===rs.type?as[os]=ls.stateValues.values:as[os]=ls.stateValues.values.map(us=>convertValueToType(us,rs.type))}return{setValue:{lists:as}}}},ts}}Ms(ComponentListOfListsWithSelectableType,"componentType","_componentListOfListsWithSelectableType");function convertValueToType(ss,ts){if(Array.isArray(ss)&&(ss=ss[0]),ts==="number")return ss instanceof Context.class?ss.evaluate_to_constant():Number(ss);if(ts==="math"){if(typeof ss=="string")try{return Context.fromAst(textToAst.convert(ss))}catch{}return convertValueToMathExpression(ss)}else return ts==="boolean"?!!ss:String(ss)}var ComponentWithSelectableType$1=Object.freeze({__proto__:null,ComponentListOfListsWithSelectableType,ComponentListWithSelectableType,ComponentWithSelectableType});class SideBySide extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize"},ts.widths={createComponentOfType:"_componentSizeList"},ts.margins={createComponentOfType:"_componentSizeList"},ts.valign={createComponentOfType:"text"},ts.valigns={createComponentOfType:"textList"},ts}static returnChildGroups(){return[{group:"blocks",componentTypes:["_block"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nPanels={forRenderer:!0,returnDependencies:()=>({blockChildren:{dependencyType:"child",childGroups:["blocks"],skipComponentNames:!0}}),definition({dependencyValues:rs}){return{setValue:{nPanels:rs.blockChildren.length},checkForActualChange:{nPanels:!0}}}},ts.essentialWidths={isArray:!0,entryPrefixes:["essentialWidth"],defaultValueByArrayKey:()=>null,hasEssential:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize({dependencyValues:rs}){return[rs.nPanels]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]=!0;return{useEssentialOrDefaultValue:{essentialWidths:ns}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns={};for(let is in rs.essentialWidths)ns[is]=rs.essentialWidths[is];return{success:!0,instructions:[{setEssentialValue:"essentialWidths",value:ns}]}}},ts.allWidthsSpecified={additionalStateVariablesDefined:["widthsAbsolute"],returnDependencies(){return{nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents","componentSizes"]},parentWidths:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"specifiedWidths"},parentWidthsAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"widthsAbsolute"},essentialWidth:{dependencyType:"stateVariable",variableName:"essentialWidths"}}},definition({dependencyValues:rs}){let ns=[],is=null,as,os=!1;rs.widthsAttr!==null?as=rs.widthsAttr.stateValues.nComponents:rs.widthAttr!==null?(as=rs.nPanels,os=!0):as=0;for(let ls=0;ls<rs.nPanels;ls++){let us=null;if(ls<as?os?rs.widthAttr.stateValues.componentSize?(ns[ls]=rs.widthAttr.stateValues.componentSize.size,us=!!rs.widthAttr.stateValues.componentSize.isAbsolute):ns[ls]=null:rs.widthsAttr.stateValues.componentSizes[ls]?(ns[ls]=rs.widthsAttr.stateValues.componentSizes[ls].size,us=!!rs.widthsAttr.stateValues.componentSizes[ls].isAbsolute):ns[ls]=null:rs.parentWidths?(rs.essentialWidth[ls]===null?ns[ls]=rs.parentWidths[ls]:ns[ls]=rs.essentialWidth[ls],us=rs.parentWidthsAbsolute):ns[ls]=rs.essentialWidth[ls],is===null)is=us;else if(us!==null&&is!==us)throw Error("SideBySide is not implemented for absolute measurements")}return ns=ns.map(ls=>Number.isFinite(ls)?ls:null),{setValue:{allWidthsSpecified:ns,widthsAbsolute:is}}}},ts.essentialMargins={isArray:!0,entryPrefixes:["essentialMargin"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]=!0;return{useEssentialOrDefaultValue:{essentialMargins:ns}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns={};for(let is in rs.essentialMargins)ns[is]=rs.essentialMargins[is];return{success:!0,instructions:[{setEssentialValue:"essentialMargins",value:ns}]}}},ts.allMarginsSpecified={additionalStateVariablesDefined:["marginsAbsolute"],returnDependencies(){return{nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["nComponents","componentSizes"]},parentMargins:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"specifiedMargins"},parentMarginsAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"marginsAbsolute"},essentialMargins:{dependencyType:"stateVariable",variableName:"essentialMargins"}}},definition({dependencyValues:rs}){let ns=[],is=null;if(rs.marginsAttr===null)if(rs.parentMargins){is=rs.parentMarginsAbsolute;for(let as=0;as<2;as++)rs.essentialMargins[as]===null?ns[as]=rs.parentMargins[as]:ns[as]=rs.essentialMargins[as]}else for(let as=0;as<2;as++)ns[as]=rs.essentialMargins[as];else if(rs.marginsAttr.stateValues.nComponents===0)for(let as=0;as<2;as++)ns[as]=rs.essentialMargins[as];else if(rs.marginsAttr.stateValues.nComponents===1){let as=null;rs.marginsAttr.stateValues.componentSizes[0]&&(as=rs.marginsAttr.stateValues.componentSizes[0].size,Number.isFinite(as)||(as=null),is=!!rs.marginsAttr.stateValues.componentSizes[0].isAbsolute),ns=[as,as]}else{rs.marginsAttr.stateValues.componentSizes[0]?is=!!rs.marginsAttr.stateValues.componentSizes[0].isAbsolute:is=!1;let as;if(rs.marginsAttr.stateValues.componentSizes[1]?as=!!rs.marginsAttr.stateValues.componentSizes[1].isAbsolute:as=!1,as!==is)throw Error("SideBySide is not implemented for absolute measurements");ns=rs.marginsAttr.stateValues.componentSizes.slice(0,2).map(os=>os&&Number.isFinite(os.size)?os.size:null)}return{setValue:{allMarginsSpecified:ns,marginsAbsolute:is}}}},ts.absoluteMeasurements={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({widthsAbsolute:{dependencyType:"stateVariable",variableName:"widthsAbsolute"},marginsAbsolute:{dependencyType:"stateVariable",variableName:"marginsAbsolute"}}),definition({dependencyValues:rs}){let ns;if(rs.widthsAbsolute===null)rs.marginsAbsolute===null?ns=!1:ns=rs.marginsAbsolute;else if(rs.marginsAbsolute===null)ns=rs.widthsAbsolute;else{if(rs.widthsAbsolute!==rs.marginsAbsolute)throw Error("SideBySide is not implemented for absolute measurements");ns=rs.widthsAbsolute}if(ns===!0)throw Error("SideBySide is not implemented for absolute measurements");return{setValue:{absoluteMeasurements:ns}}}},ts.allWidths={additionalStateVariablesDefined:["allMargins",{variableName:"gapWidth",public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0}],returnDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},allWidthsSpecified:{dependencyType:"stateVariable",variableName:"allWidthsSpecified"},allMarginsSpecified:{dependencyType:"stateVariable",variableName:"allMarginsSpecified"},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}}),definition({dependencyValues:rs}){let ns=0,is=[...rs.allWidthsSpecified],as=[...rs.allMarginsSpecified],os=0,ls=0;for(let ps=0;ps<rs.nPanels;ps++){let ds=is[ps];ds===null?ls++:os+=ds}let us=0,cs=0;for(let ps=0;ps<2;ps++){let ds=as[ps];ds===null?cs++:us+=ds}if(us*=rs.nPanels,!rs.absoluteMeasurements)if(os+us>=100){let ps=100/(os+us);for(let ds=0;ds<rs.nPanels;ds++)is[ds]===null?is[ds]=0:is[ds]*=ps;for(let ds=0;ds<2;ds++)as[ds]===null?as[ds]=0:as[ds]*=ps}else if(ls>0){let ps=(100-(os+us))/ls;for(let ds=0;ds<rs.nPanels;ds++)is[ds]===null&&(is[ds]=ps);for(let ds=0;ds<2;ds++)as[ds]===null&&(as[ds]=0)}else if(cs>0){let ps=(100-(os+us))/(cs*rs.nPanels);for(let ds=0;ds<2;ds++)as[ds]===null&&(as[ds]=ps)}else rs.nPanels>1?ns=(100-(os+us))/(rs.nPanels-1):rs.nPanels===1?as[1]=100-(as[0]+is[0]):console.warn("Invalid sideBySide, as it must have at least one block child");return{setValue:{allWidths:is,allMargins:as,gapWidth:ns}}}},ts.widths={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["width"],forRenderer:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize({dependencyValues:rs}){return[rs.nPanels]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={allWidths:{dependencyType:"stateVariable",variableName:"allWidths"},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents"]},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}},is={};for(let as of rs){let os=Number(as)+1;is[as]={widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:[`componentSize${os}`]},essentialWidth:{dependencyType:"stateVariable",variableName:`essentialWidth${os}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs.allWidths[as];return{setValue:{widths:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,dependencyValuesByKey:is,globalDependencyValues:as,arraySize:os}){let ls,us=!1;as.widthsAttr!==null?ls=as.widthsAttr.stateValues.nComponents:as.widthAttr!==null?(ls=os[0],us=!0):ls=0;let cs=[];for(let ps in rs.widths)Number(ps)<ls?us?cs.push({setDependency:"widthAttr",desiredValue:{size:rs.widths[ps],isAbsolute:as.absoluteMeasurements},variableIndex:0}):cs.push({setDependency:ns[ps].widthsAttr,desiredValue:{size:rs.widths[ps],isAbsolute:as.absoluteMeasurements},variableIndex:0}):cs.push({setDependency:ns[ps].essentialWidth,desiredValue:rs.widths[ps]});return{success:!0,instructions:cs}}},ts.margins={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["margin"],forRenderer:!0,returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={allMargins:{dependencyType:"stateVariable",variableName:"allMargins"},marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["componentSize1","componentSize2","nComponents"]},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}},is={};for(let as of rs){let os=Number(as)+1;is[as]={essentialMargin:{dependencyType:"stateVariable",variableName:`essentialMargin${os}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs.allMargins[as];return{setValue:{margins:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyNamesByKey:is}){let as=[];if(ns.marginsAttr===null)for(let os in rs.margins)as.push({setDependency:is[os].essentialMargin,desiredValue:rs.margins[os]});else if(!(ns.marginsAttr.stateValues.componentSize1&&Number.isFinite(ns.marginsAttr.stateValues.componentSize1.size)))"0"in rs.margins?as.push({setDependency:"marginsAttr",desiredValue:{size:rs.margins[0],isAbsolute:ns.absoluteMeasurements},variableIndex:0}):as.push({setDependency:"marginsAttr",desiredValue:{size:rs.margins[1],isAbsolute:ns.absoluteMeasurements},variableIndex:0}),"1"in rs.margins&&ns.marginsAttr.stateValues.nComponents>1&&as.push({setDependency:"marginsAttr",desiredValue:{size:rs.margins[1],isAbsolute:ns.absoluteMeasurements},variableIndex:1});else{let os=ns.marginsAttr.stateValues.nComponents===1;for(let ls in rs.margins)os?as.push({setDependency:"marginsAttr",desiredValue:{size:rs.margins[ls],isAbsolute:ns.absoluteMeasurements},variableIndex:0}):as.push({setDependency:"marginsAttr",desiredValue:{size:rs.margins[ls],isAbsolute:ns.absoluteMeasurements},variableIndex:ls})}return{success:!0,instructions:as}}},ts.essentialValigns={isArray:!0,entryPrefixes:["essentialValign"],defaultValueByArrayKey:()=>null,hasEssential:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize({dependencyValues:rs}){return[rs.nPanels]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]=!0;return{useEssentialOrDefaultValue:{essentialValigns:ns}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns={};for(let is in rs.essentialValigns)ns[is]=rs.essentialValigns[is];return{success:!0,instructions:[{setEssentialValue:"essentialValigns",value:ns}]}}},ts.valigns={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"text"},entryPrefixes:["valign"],forRenderer:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize({dependencyValues:rs}){return[rs.nPanels]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:["nComponents"]}},is={};for(let as of rs){let os=Number(as)+1;is[as]={valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:[`text${os}`]},parentValign:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:`valign${os}`},parentValignAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:`valignAbsolute${os}`},essentialValign:{dependencyType:"stateVariable",variableName:`essentialValign${os}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,arraySize:as}){let os={},ls,us=!1;rs.valignsAttr!==null?ls=rs.valignsAttr.stateValues.nComponents:rs.valignAttr!==null?(ls=as[0],us=!0):ls=0;for(let cs of is){let ps=Number(cs);if(ps<ls){if(us)os[cs]=rs.valignAttr.stateValues.value.toLowerCase();else{let ds=ps+1;os[cs]=ns[cs].valignsAttr.stateValues[`text${ds}`].toLowerCase()}["top","middle","bottom"].includes(os[cs])||(os[cs]="top")}else ns[cs].parentValign?ns[cs].essentialValign===null?os[cs]=ns[cs].parentValign:os[cs]=ns[cs].essentialValign:ns[cs].essentialValign===null?os[cs]="top":os[cs]=ns[cs].essentialValign}return{setValue:{valigns:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,globalDependencyValues:is,arraySize:as}){let os,ls=!1;is.valignsAttr!==null?os=is.valignsAttr.stateValues.nComponents:is.valignAttr!==null?(os=as[0],ls=!0):os=0;let us=[];for(let cs in rs.valigns){let ps=rs.valigns[cs].toLowerCase();if(!["top","middle","bottom"].includes(ps))continue;Number(cs)<os?ls?us.push({setDependency:"valignAttr",desiredValue:ps,variableIndex:0}):us.push({setDependency:ns[cs].valignsAttr,desiredValue:ps,variableIndex:0}):us.push({setDependency:ns[cs].essentialValign,desiredValue:ps})}return{success:!0,instructions:us}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(SideBySide,"componentType","sideBySide"),Ms(SideBySide,"renderChildren",!0);class SbsGroup extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize"},ts.widths={createComponentOfType:"_componentSizeList"},ts.margins={createComponentOfType:"_componentSizeList"},ts.valign={createComponentOfType:"text"},ts.valigns={createComponentOfType:"textList"},ts}static returnChildGroups(){return[{group:"sideBySides",componentTypes:["sideBySide"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.maxNPanelsPerRow={returnDependencies:()=>({sideBySideChildren:{dependencyType:"child",childGroups:["sideBySides"],variableNames:["nPanels"]}}),definition({dependencyValues:rs}){return{setValue:{maxNPanelsPerRow:Context.math.max(rs.sideBySideChildren.map(ns=>ns.stateValues.nPanels))},checkForActualChange:{maxNPanelsPerRow:!0}}}},ts.specifiedWidths={additionalStateVariablesDefined:[{variableName:"widthsAbsoluteArray",isArray:!0}],isArray:!0,entryPrefixes:["specifiedWidth"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize({dependencyValues:rs}){return[rs.maxNPanelsPerRow]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents"]}},is={};for(let as of rs){let os=Number(as)+1;is[as]={widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:[`componentSize${os}`]}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,arraySize:as}){let os={},ls={},us={},cs,ps=!1;rs.widthsAttr!==null?cs=rs.widthsAttr.stateValues.nComponents:rs.widthAttr!==null?(cs=as[0],ps=!0):cs=0;for(let fs of is){let hs=Number(fs);if(hs<cs)if(ps)rs.widthAttr.stateValues.componentSize&&(os[fs]=rs.widthAttr.stateValues.componentSize.size,us[fs]=rs.widthAttr.stateValues.componentSize.isAbsolute);else{let ys=hs+1,gs=ns[fs].widthsAttr.stateValues[`componentSize${ys}`];gs&&(os[fs]=gs.size,us[fs]=gs.isAbsolute)}else ls[fs]=!0,us[fs]=null}let ds={setValue:{widthsAbsoluteArray:us,specifiedWidths:os}};return Object.keys(ls).length>0&&(ds.useEssentialOrDefaultValue={specifiedWidths:ls}),ds},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,globalDependencyValues:is,stateValues:as,arraySize:os}){let ls,us=!1;is.widthsAttr!==null?ls=is.widthsAttr.stateValues.nComponents:is.widthAttr!==null?(ls=os[0],us=!0):ls=0;let cs=[];for(let ps in rs.specifiedWidths)Number(ps)<ls?us?cs.push({setDependency:"widthAttr",desiredValue:{size:rs.specifiedWidths[ps],isAbsolute:as.widthsAbsolute},variableIndex:0}):cs.push({setDependency:ns[ps].widthsAttr,desiredValue:{size:rs.specifiedWidths[ps],isAbsolute:as.widthsAbsolute},variableIndex:0}):cs.push({setEssentialValue:"specifiedWidths",value:{[ps]:rs.specifiedWidths[ps]}});return{success:!0,instructions:cs}}},ts.widthsAbsolute={returnDependencies:()=>({widthsAbsoluteArray:{dependencyType:"stateVariable",variableName:"widthsAbsoluteArray"}}),definition({dependencyValues:rs}){let ns=null;for(let is in rs.widthsAbsoluteArray){let as=rs.widthsAbsoluteArray[is];if(as!==null){if(as=!!as,ns===null)ns=as;else if(ns!==as)throw Error("SbsGroup is not implemented for absolute measurements")}}return{setValue:{widthsAbsolute:ns}}}},ts.specifiedMargins={additionalStateVariablesDefined:[{variableName:"marginsAbsoluteArray",isArray:!0,entryPrefixes:["marginAbsolute"]}],isArray:!0,entryPrefixes:["specifiedMargin"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:rs}){return{globalDependencies:{marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["componentSize1","componentSize2","nComponents"]}}}},arrayDefinitionByKey({dependencyValuesByKey:rs,globalDependencyValues:ns,arrayKeys:is}){let as={},os={},ls={};if(ns.marginsAttr===null||ns.marginsAttr.stateValues.nComponents===0)for(let cs of is)os[cs]=!0,ls[cs]=null;else if(ns.marginsAttr.stateValues.nComponents===1){let cs=null,ps=null;ns.marginsAttr.stateValues.componentSize1&&(cs=ns.marginsAttr.stateValues.componentSize1.size,Number.isFinite(cs)||(cs=null),ps=!!ns.marginsAttr.stateValues.componentSize1.isAbsolute);for(let ds of is)as[ds]=cs,ls[ds]=ps}else for(let cs of is)if(ns.marginsAttr.stateValues[`componentSize${Number(cs)+1}`]){let ps=ns.marginsAttr.stateValues[`componentSize${Number(cs)+1}`].size;Number.isFinite(ps)||(ps=null);let ds=!!ns.marginsAttr.stateValues[`componentSize${Number(cs)+1}`].isAbsolute;as[cs]=ps,ls[cs]=ds}let us={setValue:{marginsAbsoluteArray:ls,specifiedMargins:as}};return Object.keys(os).length>0&&(us.useEssentialOrDefaultValue={specifiedMargins:os}),us},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,globalDependencyValues:is,stateValues:as}){let os=[];if(is.marginsAttr===null)os.push({setEssentialValue:"specifiedMargins",value:rs.specifiedMargins});else if(!(is.marginsAttr.stateValues.componentSize1&&Number.isFinite(is.marginsAttr.stateValues.componentSize1.size)))"0"in rs.specifiedMargins?os.push({setDependency:"marginsAttr",desiredValue:{size:rs.specifiedMargins[0],isAbsolute:await as.marginsAbsolute},variableIndex:0}):os.push({setDependency:"marginsAttr",desiredValue:{size:rs.specifiedMargins[1],isAbsolute:await as.marginsAbsolute},variableIndex:0}),"1"in rs.specifiedMargins&&is.marginsAttr.stateValues.nComponents>1&&os.push({setDependency:"marginsAttr",desiredValue:{size:rs.specifiedMargins[1],isAbsolute:await as.marginsAbsolute},variableIndex:1});else{let ls=is.marginsAttr.stateValues.nComponents===1;for(let us in rs.specifiedMargins)ls?os.push({setDependency:"marginsAttr",desiredValue:{size:rs.specifiedMargins[us],isAbsolute:await as.marginsAbsolute},variableIndex:0}):os.push({setDependency:"marginsAttr",desiredValue:{size:rs.specifiedMargins[us],isAbsolute:await as.marginsAbsolute},variableIndex:us})}return{success:!0,instructions:os}}},ts.marginsAbsolute={returnDependencies:()=>({marginsAbsoluteArray:{dependencyType:"stateVariable",variableName:"marginsAbsoluteArray"}}),definition({dependencyValues:rs}){let ns=null;for(let is in rs.marginsAbsoluteArray){let as=rs.marginsAbsoluteArray[is];if(as!==null){if(as=!!as,ns===null)ns=as;else if(ns!==as)throw Error("SbsGroup is not implemented for absolute measurements")}}return{setValue:{marginsAbsolute:ns}}}},ts.absoluteMeasurements={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({widthsAbsolute:{dependencyType:"stateVariable",variableName:"widthsAbsolute"},marginsAbsolute:{dependencyType:"stateVariable",variableName:"marginsAbsolute"}}),definition({dependencyValues:rs}){let ns;if(rs.widthsAbsolute===null)rs.marginsAbsolute===null?ns=!1:ns=rs.marginsAbsolute;else if(rs.marginsAbsolute===null)ns=rs.widthsAbsolute;else{if(rs.widthsAbsolute!==rs.marginsAbsolute)throw Error("SbsGroup is not implemented for absolute measurements");ns=rs.widthsAbsolute}if(ns===!0)throw Error("SbsGroup is not implemented for absolute measurements");return{setValue:{absoluteMeasurements:ns}}}},ts.allWidths={additionalStateVariablesDefined:["allMargins",{variableName:"gapWidth",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"},specifiedWidths:{dependencyType:"stateVariable",variableName:"specifiedWidths"},specifiedMargins:{dependencyType:"stateVariable",variableName:"specifiedMargins"},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}}),definition({dependencyValues:rs}){let ns=0,is=[...rs.specifiedWidths],as=[...rs.specifiedMargins],os=0,ls=0;for(let ps=0;ps<rs.maxNPanelsPerRow;ps++){let ds=is[ps];ds===null?ls++:os+=ds}let us=0,cs=0;for(let ps=0;ps<2;ps++){let ds=as[ps];ds===null?cs++:us+=ds}if(us*=rs.maxNPanelsPerRow,!rs.absoluteMeasurements)if(os+us>=100){let ps=100/(os+us);for(let ds=0;ds<rs.maxNPanelsPerRow;ds++)is[ds]===null?is[ds]=0:is[ds]*=ps;for(let ds=0;ds<2;ds++)as[ds]===null?as[ds]=0:as[ds]*=ps}else if(ls>0){let ps=(100-(os+us))/ls;for(let ds=0;ds<rs.maxNPanelsPerRow;ds++)is[ds]===null&&(is[ds]=ps);for(let ds=0;ds<2;ds++)as[ds]===null&&(as[ds]=0)}else if(cs>0){let ps=(100-(os+us))/(cs*rs.maxNPanelsPerRow);for(let ds=0;ds<2;ds++)as[ds]===null&&(as[ds]=ps)}else rs.maxNPanelsPerRow>1?ns=(100-(os+us))/(rs.maxNPanelsPerRow-1):rs.maxNPanelsPerRow===1?as[1]=100-(as[0]+is[0]):console.warn("Invalid sideBySide, as it must have at least one block child");return{setValue:{allWidths:is,allMargins:as,gapWidth:ns}}}},ts.widths={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["width"],returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize({dependencyValues:rs}){return[rs.maxNPanelsPerRow]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={allWidths:{dependencyType:"stateVariable",variableName:"allWidths"}},is={};for(let as of rs){let os=Number(as)+1;is[as]={specifiedWidth:{dependencyType:"stateVariable",variableName:`specifiedWidth${os}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs.allWidths[as];return{setValue:{widths:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.widths)is.push({setDependency:ns[as].specifiedWidth,desiredValue:rs.widths[as],variableIndex:0});return{success:!0,instructions:is}}},ts.margins={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["margin"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={allMargins:{dependencyType:"stateVariable",variableName:"allMargins"}},is={};for(let as of rs){let os=Number(as)+1;is[as]={specifiedMargin:{dependencyType:"stateVariable",variableName:`specifiedMargin${os}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns)is[as]=rs.allMargins[as];return{setValue:{margins:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.margins)is.push({setDependency:ns[as].specifiedMargin,desiredValue:rs.margins[as],variableIndex:0});return{success:!0,instructions:is}}},ts.valigns={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"text"},entryPrefixes:["valign"],hasEssential:!0,defaultValueByArrayKey:()=>"top",returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize({dependencyValues:rs}){return[rs.maxNPanelsPerRow]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:["nComponents"]}},is={};for(let as of rs){let os=Number(as)+1;is[as]={valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:[`text${os}`]}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,arraySize:as}){let os={},ls={},us,cs=!1;rs.valignsAttr!==null?us=rs.valignsAttr.stateValues.nComponents:rs.valignAttr!==null?(us=as[0],cs=!0):us=0;for(let ds of is){let fs=Number(ds);if(fs<us){if(cs)os[ds]=rs.valignAttr.stateValues.value.toLowerCase();else{let hs=fs+1;os[ds]=ns[ds].valignsAttr.stateValues[`text${hs}`].toLowerCase()}["top","middle","bottom"].includes(os[ds])||(os[ds]="top")}else ls[ds]=!0}let ps={};return Object.keys(os).length>0&&(ps.setValue={valigns:os}),Object.keys(ls).length>0&&(ps.useEssentialOrDefaultValue={valigns:ls}),ps},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,globalDependencyValues:is,arraySize:as}){let os,ls=!1;is.valignsAttr!==null?os=is.valignsAttr.stateValues.nComponents:is.valignAttr!==null?(os=as[0],ls=!0):os=0;let us=[];for(let cs in rs.valigns){let ps=rs.valigns[cs].toLowerCase();if(!["top","middle","bottom"].includes(ps))continue;Number(cs)<os?ls?us.push({setDependency:"valignAttr",desiredValue:ps,variableIndex:0}):us.push({setDependency:ns[cs].valignsAttr,desiredValue:ps,variableIndex:0}):us.push({setEssentialValue:"valigns",value:{[cs]:ps}})}return{success:!0,instructions:us}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(SbsGroup,"componentType","sbsGroup"),Ms(SbsGroup,"rendererType","containerBlock"),Ms(SbsGroup,"renderChildren",!0);class Stack extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Stack,"componentType","stack"),Ms(Stack,"rendererType","containerBlock"),Ms(Stack,"renderChildren",!0);var SideBySide$1=Object.freeze({__proto__:null,SbsGroup,SideBySide,Stack});let H$2=(eu=class extends Text{},Ms(eu,"componentType","h"),Ms(eu,"rendererType","text"),eu);class Idx extends BaseComponent{static returnChildGroups(){return[{group:"hs",componentTypes:["h"]},{group:"stringsTexts",componentTypes:["string","text"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.terms={returnDependencies:()=>({stringTextChildren:{dependencyType:"child",childGroups:["stringsTexts"],variableNames:["value"]},hChildren:{dependencyType:"child",childGroups:["hs"],variableNames:["value"]}}),definition({dependencyValues:rs}){let ns;if(rs.hChildren.length>0)ns=rs.hChildren.map(is=>is.stateValues.value);else{let is="";for(let as of rs.stringTextChildren)typeof as=="string"?is+=as:is+=as.stateValues.value;ns=[is]}return{setValue:{terms:ns}}}},ts}}Ms(Idx,"componentType","idx"),Ms(Idx,"rendererType");var Indexing=Object.freeze({__proto__:null,H:H$2,Idx});class Div extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Div,"componentType","div"),Ms(Div,"rendererType","containerBlock"),Ms(Div,"renderChildren",!0);class Span extends InlineComponent{static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}}Ms(Span,"componentType","span"),Ms(Span,"rendererType","containerInline"),Ms(Span,"renderChildren",!0);var Divisions=Object.freeze({__proto__:null,Div,Span});class Pre extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"allChildren",componentTypes:["_base"]}]}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Pre,"componentType","pre"),Ms(Pre,"renderChildren",!0),Ms(Pre,"includeBlankStringChildren",!0);class DisplayDoenetML extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"allChildren",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={returnDependencies:()=>({childrenDoenetML:{dependencyType:"doenetML",displayOnlyChildren:!0}}),definition({dependencyValues:rs}){return{setValue:{value:rs.childrenDoenetML}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.value}})},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(DisplayDoenetML,"componentType","displayDoenetML"),Ms(DisplayDoenetML,"rendererType","text"),Ms(DisplayDoenetML,"includeBlankStringChildren",!0);var Verbatim=Object.freeze({__proto__:null,DisplayDoenetML,Pre});class Paginator extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{setPage:this.setPage.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.initialPage={createComponentOfType:"integer",createStateVariable:"initialPage",defaultValue:1},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nPages={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"]}}),definition({dependencyValues:rs}){return{setValue:{nPages:rs.children.length}}}},ts.currentPage={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,returnDependencies:()=>({initialPage:{dependencyType:"stateVariable",variableName:"initialPage"},nPages:{dependencyType:"stateVariable",variableName:"nPages"}}),definition({dependencyValues:rs}){return{useEssentialOrDefaultValue:{currentPage:{get defaultValue(){let ns=rs.initialPage;return Number.isInteger(ns)?Math.max(1,Math.min(rs.nPages,ns)):1}}}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns,sourceDetails:is={}}){if(!is.fromSetPage)return{success:!1};let as=Number(rs.currentPage);return Number.isInteger(as)?(as=Math.max(1,Math.min(await ns.nPages,as)),{success:!0,instructions:[{setEssentialValue:"currentPage",value:as}]}):{success:!1}}},ts.childIndicesToRender={returnDependencies:()=>({currentPage:{dependencyType:"stateVariable",variableName:"currentPage"}}),definition({dependencyValues:rs}){return{setValue:{childIndicesToRender:[rs.currentPage-1]}}},markStale:()=>({updateRenderedChildren:!0})},ts}async setPage({number:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(!Number.isInteger(ts)){this.coreFunctions.resolveAction({actionId:rs});return}let as=Math.max(1,Math.min(await this.stateValues.nPages,ts)),os=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"currentPage",value:as,sourceDetails:{fromSetPage:!0}}];await this.coreFunctions.performUpdate({updateInstructions:os,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:as,responseText:as.toString()}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Paginator,"componentType","paginator"),Ms(Paginator,"rendererType","containerBlock"),Ms(Paginator,"renderChildren",!0);class PaginatorControls extends BlockComponent{constructor(ts){super(ts),this.externalActions={},Object.defineProperty(this.externalActions,"setPage",{enumerable:!0,get:async function(){let rs=await this.stateValues.paginatorComponentName;if(rs)return{componentName:rs,actionName:"setPage"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.previousLabel={createComponentOfType:"text",createStateVariable:"previousLabel",defaultValue:"Previous",forRenderer:!0,public:!0},ts.nextLabel={createComponentOfType:"text",createStateVariable:"nextLabel",defaultValue:"Next",forRenderer:!0,public:!0},ts.pageLabel={createComponentOfType:"text",createStateVariable:"pageLabel",defaultValue:"Page",forRenderer:!0,public:!0},ts.paginator={createTargetComponentNames:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.paginatorComponentName={returnDependencies:()=>({paginator:{dependencyType:"attributeTargetComponentNames",attributeName:"paginator"}}),definition({dependencyValues:rs}){var is;let ns;return((is=rs.paginator)==null?void 0:is.length)===1?ns=rs.paginator[0].absoluteName:ns=null,{setValue:{paginatorComponentName:ns}}}},ts.currentPage={forRenderer:!0,stateVariablesDeterminingDependencies:["paginatorComponentName"],returnDependencies({stateValues:rs}){return rs.paginatorComponentName?{paginatorPage:{dependencyType:"stateVariable",componentName:rs.paginatorComponentName,variableName:"currentPage"}}:{}},definition({dependencyValues:rs}){return"paginatorPage"in rs?{setValue:{currentPage:rs.paginatorPage}}:{setValue:{currentPage:1}}}},ts.nPages={forRenderer:!0,stateVariablesDeterminingDependencies:["paginatorComponentName"],returnDependencies({stateValues:rs}){return rs.paginatorComponentName?{paginatorNPages:{dependencyType:"stateVariable",componentName:rs.paginatorComponentName,variableName:"nPages"}}:{}},definition({dependencyValues:rs}){return"paginatorNPages"in rs?{setValue:{nPages:rs.paginatorNPages}}:{setValue:{nPages:1}}}},ts}}Ms(PaginatorControls,"componentType","paginatorControls"),Ms(PaginatorControls,"renderChildren",!0);var Paginator$1=Object.freeze({__proto__:null,Paginator,PaginatorControls});class Input extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.collaborateGroups={createComponentOfType:"collaborateGroups",createStateVariable:"collaborateGroups",defaultValue:null,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nValues={returnDependencies:()=>({}),definition:()=>({setValue:{nValues:1}})},ts.answerAncestor={returnDependencies:()=>({answerAncestor:{dependencyType:"ancestor",componentType:"answer",variableNames:["delegateCheckWorkToInput","justSubmitted","creditAchieved","showCorrectness","numberOfAttemptsLeft"]}}),definition:function({dependencyValues:rs}){return{setValue:{answerAncestor:rs.answerAncestor}}}},ts.includeCheckWork={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:rs}){let ns=!1;return rs.answerAncestor&&(ns=rs.answerAncestor.stateValues.delegateCheckWorkToInput),{setValue:{includeCheckWork:ns}}}},ts.suppressCheckwork={forRenderer:!0,returnDependencies:()=>({autoSubmit:{dependencyType:"flag",flagName:"autoSubmit"}}),definition({dependencyValues:rs}){return{setValue:{suppressCheckwork:rs.autoSubmit}}}},ts.creditAchieved={defaultValue:0,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:rs}){let ns=0;return rs.answerAncestor&&(ns=rs.answerAncestor.stateValues.creditAchieved),{setValue:{creditAchieved:ns}}}},ts.valueHasBeenValidated={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:rs}){let ns=!1;return rs.answerAncestor&&rs.answerAncestor.stateValues.justSubmitted&&(ns=!0),{setValue:{valueHasBeenValidated:ns}}}},ts.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:rs}){let ns;return rs.answerAncestor?ns=rs.answerAncestor.stateValues.showCorrectness:ns=rs.showCorrectnessFlag!==!1,{setValue:{showCorrectness:ns}}}},ts.numberOfAttemptsLeft={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:rs}){let ns;return rs.answerAncestor?ns=rs.answerAncestor.stateValues.numberOfAttemptsLeft:ns=1/0,{setValue:{numberOfAttemptsLeft:ns}}}},ts}}Ms(Input,"componentType","_input");class MatrixInput extends Input{constructor(ts){super(ts),Object.assign(this.actions,{updateNumRows:this.updateNumRows.bind(this),updateNumColumns:this.updateNumColumns.bind(this)}),this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let rs=await this.stateValues.answerAncestor;if(rs!==null)return{componentName:rs.componentName,actionName:"submitAnswer"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.numRows={createComponentOfType:"integer",createStateVariable:"numRowsPreliminary",defaultValue:1,transformNonFiniteTo:0},ts.numColumns={createComponentOfType:"integer",createStateVariable:"numColumnsPreliminary",defaultValue:1,transformNonFiniteTo:0},ts.showSizeControls={createComponentOfType:"boolean",createStateVariable:"showSizeControls",defaultValue:!0,public:!0,forRenderer:!0},ts.defaultEntry={createComponentOfType:"math",createStateVariable:"defaultEntry",defaultValue:Context.fromAst("")},ts.prefill={createComponentOfType:"math",createStateVariable:"prefill",defaultValue:Context.fromAst(""),public:!0,copyComponentAttributesForCreatedComponent:["format","functionSymbols","splitSymbols","parseScientificNotation"]},ts.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},ts.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},ts.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0},ts.parseScientificNotation={createComponentOfType:"boolean",createStateVariable:"parseScientificNotation",defaultValue:!1,public:!0},ts.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.bindValueTo={createComponentOfType:"math"},ts.unionFromU={createComponentOfType:"boolean",createStateVariable:"unionFromU",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentAttributes:is}){return ns.length>0?{success:!1}:{success:!0,newChildren:[{componentType:"matrixInputGrid"}]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"matrixComponentInputs",componentTypes:["matrixComponentInput"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.valueOriginal={hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),set:convertValueToMathExpression,definition:function({dependencyValues:rs}){return rs.bindValueTo?{setValue:{valueOriginal:rs.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{valueOriginal:{defaultValue:rs.prefill}}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:rs.valueOriginal,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"valueOriginal",value:rs.valueOriginal}]}}},ts.immediateValueOriginal={hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),set:convertValueToMathExpression,definition:function({dependencyValues:rs,changes:ns,justUpdatedForNewComponent:is}){return ns.valueOriginal&&!is?{setValue:{immediateValueOriginal:rs.valueOriginal},setEssentialValue:{immediateValueOriginal:rs.valueOriginal}}:{useEssentialOrDefaultValue:{immediateValueOriginal:{defaultValue:rs.valueOriginal}}}},inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns,shadowedVariable:is}){let as=[{setEssentialValue:"immediateValueOriginal",value:rs.immediateValueOriginal}];return ns||is||as.push({setDependency:"valueOriginal",desiredValue:rs.immediateValueOriginal}),{success:!0,instructions:as}}},ts.haveBoundValue={returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo"}}),definition({dependencyValues:rs}){return{setValue:{haveBoundValue:rs.bindValueTo!==null}}}},ts.numRows={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({numRowsPreliminary:{dependencyType:"stateVariable",variableName:"numRowsPreliminary"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},haveBoundValue:{dependencyType:"stateVariable",variableName:"haveBoundValue"}}),definition({dependencyValues:rs,usedDefault:ns}){let is=rs.numRowsPreliminary;if(ns.numRowsPreliminary||rs.haveBoundValue){let as=rs.valueOriginal.tree;if(is=1,Array.isArray(as)){let os=as[0];os==="matrix"?is=as[1][1]:vectorOperators.includes(os)&&(is=as.length-1)}}return{setValue:{numRows:is}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){let as=rs.numRows;if(!Number.isInteger(as))return{success:!1};as=Math.max(0,as);let os=[{setDependency:"numRowsPreliminary",desiredValue:as}];if(ns.haveBoundValue){let ls=ns.valueOriginal.tree,us=(await is.defaultEntry).tree;if(await is.numColumns===1&&Array.isArray(ls)&&vectorOperators.includes(ls[0])){let cs=ls.length-1;if(as<cs){let ps=deepClone(ls).slice(0,as+1);os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(ps)})}else if(as>cs){let ps=deepClone(ls),ds=await is.accumulatedComponents;for(let fs=cs;fs<as;fs++){let hs=ds[fs],ys;hs&&(ys=hs[0]),ps[fs+1]=ys===void 0?us:ys}os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(ps)})}}else{let cs=deepClone((await is.value).tree),ps=cs[1][1];if(cs[1][1]=as,as!==ps){if(as<ps)cs[2].length=as+1;else{let ds=await is.numColumns,fs=cs[2],hs=await is.accumulatedComponents;for(let ys=ps;ys<as;ys++){fs[ys+1]||(fs[ys+1]=["tuple"]);let gs=hs[ys];gs||(gs=[]);for(let bs=0;bs<ds;bs++){let vs=gs[bs];fs[ys+1][bs+1]=vs===void 0?us:vs}}}os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(cs)})}}}return{success:!0,instructions:os}}},ts.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({numColumnsPreliminary:{dependencyType:"stateVariable",variableName:"numColumnsPreliminary"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},haveBoundValue:{dependencyType:"stateVariable",variableName:"haveBoundValue"}}),definition({dependencyValues:rs,usedDefault:ns}){let is=rs.numColumnsPreliminary;if(ns.numColumnsPreliminary||rs.haveBoundValue){let as=rs.valueOriginal.tree;if(is=1,Array.isArray(as)){let os=as[0];os==="matrix"?is=as[1][2]:Array.isArray(as[1])&&vectorOperators.includes(as[1][0])&&(os==="^"&&as[2]==="T"||os==="prime")&&(is=as[1].length-1)}}return{setValue:{numColumns:is}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){let as=rs.numColumns;if(!Number.isInteger(as))return{success:!1};as=Math.max(0,as);let os=[{setDependency:"numColumnsPreliminary",desiredValue:as}];if(ns.haveBoundValue){let ls=(await is.defaultEntry).tree,us=ns.valueOriginal.tree,cs=us[0];if(Array.isArray(us[1])&&vectorOperators.includes(us[1][0])&&(cs==="^"&&us[2]==="T"||cs==="prime")){let ps=us[1].length-1;if(as<ps){let ds=deepClone(us);ds[1]=ds[1].slice(0,as+1),os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(ds)})}else if(as>ps){let ds=deepClone(us),fs=(await is.accumulatedComponents)[0];fs||(fs=[]);for(let hs=ps;hs<as;hs++){let ys=fs[hs];ds[1][hs+1]=ys===void 0?ls:ys}os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(ds)})}}else{let ps=deepClone((await is.value).tree),ds=ps[1][2];if(ps[1][2]=as,as!==ds){let fs=await is.numRows,hs=ps[2];if(as<ds)for(let ys=0;ys<fs;ys++)hs[ys+1].length=as+1;else{let ys=await is.accumulatedComponents;for(let gs=0;gs<fs;gs++){let bs=ys[gs];bs||(bs=[]);for(let vs=ds;vs<as;vs++){let Ns=bs[vs];hs[gs+1][vs+1]=Ns===void 0?ls:Ns}}}os.push({setDependency:"valueOriginal",desiredValue:Context.fromAst(ps)})}}}return{success:!0,instructions:os}}},ts.accumulatedComponents={providePreviousValuesInDefinition:!0,returnDependencies:()=>({valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),definition({dependencyValues:rs,previousValues:ns}){let is=[];ns.accumulatedComponents&&(is=deepClone(ns.accumulatedComponents));let as=rs.valueOriginal.tree;if(Array.isArray(as)){let ls=as[0];if(ls==="matrix"){let us=as[2];for(let[cs,ps]of us.slice(1).entries()){let ds=is[cs];ds||(ds=is[cs]=[]);for(let[fs,hs]of ps.slice(1).entries())ds[fs]=hs}return{setValue:{accumulatedComponents:is}}}else if(vectorOperators.includes(ls)){for(let[us,cs]of as.slice(1).entries()){let ps=is[us];ps||(ps=is[us]=[]),ps[0]=cs}return{setValue:{accumulatedComponents:is}}}else if(Array.isArray(as[1])&&vectorOperators.includes(as[1][0])&&(ls==="^"&&as[2]==="T"||ls==="prime")){let us=is[0];us||(us=is[0]=[]);for(let[cs,ps]of as[1].slice(1).entries())us[cs]=ps;return{setValue:{accumulatedComponents:is}}}}let os=is[0];return os||(os=is[0]=[]),os[0]=as,{setValue:{accumulatedComponents:is}}}},ts.componentValues={isArray:!0,entryPrefixes:["componentValue"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnArrayDependenciesByKey(){return{globalDependencies:{valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},accumulatedComponents:{dependencyType:"stateVariable",variableName:"accumulatedComponents"},defaultEntry:{dependencyType:"stateVariable",variableName:"defaultEntry"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is=rs.valueOriginal.tree,as=rs.accumulatedComponents,os=rs.numRows,ls=rs.numColumns;if(Array.isArray(is)){let cs=is[0];if(cs==="matrix"){if(is[1][1]===os&&is[1][2]===ls){let bs={},vs=is[2];for(let Ns=0;Ns<os;Ns++)for(let Ts=0;Ts<ls;Ts++){let Cs=`${Ns},${Ts}`;bs[Cs]=Context.fromAst(vs[Ns+1][Ts+1])}return{setValue:{componentValues:bs}}}let ps=is[1][1],ds=is[1][2],fs={},hs=is[2],ys=Math.min(os,ps),gs=Math.min(ls,ds);for(let bs=0;bs<ys;bs++)for(let vs=0;vs<gs;vs++){let Ns=`${bs},${vs}`;fs[Ns]=Context.fromAst(hs[bs+1][vs+1])}if(ls>ds)for(let bs=0;bs<ys;bs++){let vs=as[bs];for(let Ns=ds;Ns<ls;Ns++){let Ts=vs[Ns],Cs=`${bs},${Ns}`;fs[Cs]=Context.fromAst(Ts===void 0?rs.defaultEntry.tree:Ts)}}if(os>ps)for(let bs=ps;bs<os;bs++){let vs=as[bs];vs||(vs=[]);for(let Ns=0;Ns<ls;Ns++){let Ts=vs[Ns],Cs=`${bs},${Ns}`;fs[Cs]=Context.fromAst(Ts===void 0?rs.defaultEntry.tree:Ts)}}return{setValue:{componentValues:fs}}}else if(vectorOperators.includes(cs)){let ps=is.slice(1),ds=ps.length,fs={};for(let hs=0;hs<os;hs++){let ys=0;if(hs<ds){let bs=`${hs},0`;fs[bs]=Context.fromAst(ps[hs]),ys=1}let gs=as[hs];gs||(gs=[]);for(let bs=ys;bs<ls;bs++){let vs=gs[bs],Ns=`${hs},${bs}`;fs[Ns]=Context.fromAst(vs===void 0?rs.defaultEntry.tree:vs)}}return{setValue:{componentValues:fs}}}else if(Array.isArray(is[1])&&vectorOperators.includes(is[1][0])&&(cs==="^"&&is[2]==="T"||cs==="prime")){let ps=is[1].slice(1,ls+1);as[0];let ds={};for(let fs=0;fs<os;fs++){let hs=as[fs];hs||(hs=[]);let ys=0;if(fs===0){for(let gs=0;gs<ps.length;gs++){let bs=`0,${gs}`;ds[bs]=Context.fromAst(ps[gs])}ys=ps.length}for(let gs=ys;gs<ls;gs++){let bs=hs[gs],vs=`${fs},${gs}`;ds[vs]=Context.fromAst(bs===void 0?rs.defaultEntry.tree:bs)}}return{setValue:{componentValues:ds}}}}let us={};for(let cs=0;cs<os;cs++){let ps=0;if(cs===0){let fs="0,0";us[fs]=Context.fromAst(is),ps=1}let ds=as[cs];ds||(ds=[]);for(let fs=ps;fs<ls;fs++){let hs=ds[fs],ys=`${cs},${fs}`;us[ys]=Context.fromAst(hs===void 0?rs.defaultEntry.tree:hs)}}return{setValue:{componentValues:us}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,initialChange:is,workspace:as}){let os=ns.numRows,ls=ns.numColumns,us=!1,cs=!1,ps=!1,ds=ns.valueOriginal.tree;if(Array.isArray(ds)){let hs=ds[0];vectorOperators.includes(hs)?us=!0:hs==="matrix"?ps=!0:Array.isArray(ds[1])&&vectorOperators.includes(ds[1][0])&&(hs==="^"&&ds[2]==="T"||hs==="prime")&&(cs=!0)}let fs;if(as.valueData)fs=as.valueData.map(hs=>[...hs]);else{let hs=ns.valueOriginal.tree;if(us){if(fs=hs.slice(1,1+os).map(ys=>[ys]),fs.length<os)for(let ys=fs.length;ys<os;ys++)fs.push([""]);if(ls>1)for(let ys=0;ys<os;ys++)fs[ys].push(...Array(ls-1).fill(""))}else if(cs){if(fs=[hs[1].slice(1,1+ls)],fs[0].length<ls&&fs[0].push(...Array(ls-fs[0].length).fill("")),os>1)for(let ys=1;ys<os;ys++)fs.push(Array(ls).fill(""))}else if(ps){if(fs=hs[2].slice(1,os+1).map(ys=>ys.slice(1,ls+1)),fs[0].length<ls)for(let ys=0;ys<fs.length;ys++)fs[ys].push(...Array(ls-fs[ys].length).fill(""));if(fs.length<os)for(let ys=fs.length;ys<os;ys++)fs.push(Array(ls).fill(""))}else if(fs=[[hs]],ls>1&&fs[0].push(...Array(ls-1).fill("")),os>1)for(let ys=1;ys<os;ys++)fs.push(Array(ls).fill(""))}for(let hs in rs.componentValues){let[ys,gs]=hs.split(",");fs[ys][gs]=convertValueToMathExpression(rs.componentValues[hs]).tree}if(as.valueData=fs,ls===1&&us){let hs=ns.valueOriginal.tree[0];return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:Context.fromAst([hs,...fs.map(gs=>gs[0])]),treatAsInitialChange:is}]}}else if(os===1&&cs){let hs=ns.valueOriginal.tree,ys=hs[0],gs=[hs[1][0],...fs[0]];return ys==="^"?gs=Context.fromAst(["^",gs,"T"]):gs=Context.fromAst(["prime",gs]),{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:gs,treatAsInitialChange:is}]}}else{let hs=["matrix",["tuple",ns.numRows,ns.numColumns],["tuple",...fs.map(ys=>["tuple",...ys])]];return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:Context.fromAst(hs),treatAsInitialChange:is}]}}}},ts.componentImmediateValues={isArray:!0,entryPrefixes:["componentImmediateValue"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnArrayDependenciesByKey(){return{globalDependencies:{immediateValueOriginal:{dependencyType:"stateVariable",variableName:"immediateValueOriginal"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},accumulatedComponents:{dependencyType:"stateVariable",variableName:"accumulatedComponents"},defaultEntry:{dependencyType:"stateVariable",variableName:"defaultEntry"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is=rs.immediateValueOriginal.tree,as=rs.accumulatedComponents,os=rs.numRows,ls=rs.numColumns;if(Array.isArray(is)){let cs=is[0];if(cs==="matrix"){if(is[1][1]===os&&is[1][2]===ls){let bs={},vs=is[2];for(let Ns=0;Ns<os;Ns++)for(let Ts=0;Ts<ls;Ts++){let Cs=`${Ns},${Ts}`;bs[Cs]=Context.fromAst(vs[Ns+1][Ts+1])}return{setValue:{componentImmediateValues:bs}}}let ps=is[1][1],ds=is[1][2],fs={},hs=is[2],ys=Math.min(os,ps),gs=Math.min(ls,ds);for(let bs=0;bs<ys;bs++)for(let vs=0;vs<gs;vs++){let Ns=`${bs},${vs}`;fs[Ns]=Context.fromAst(hs[bs+1][vs+1])}if(ls>ds)for(let bs=0;bs<ys;bs++){let vs=as[bs];for(let Ns=ds;Ns<ls;Ns++){let Ts=vs[Ns],Cs=`${bs},${Ns}`;fs[Cs]=Context.fromAst(Ts===void 0?rs.defaultEntry.tree:Ts)}}if(os>ps)for(let bs=ps;bs<os;bs++){let vs=as[bs];vs||(vs=[]);for(let Ns=0;Ns<ls;Ns++){let Ts=vs[Ns],Cs=`${bs},${Ns}`;fs[Cs]=Context.fromAst(Ts===void 0?rs.defaultEntry.tree:Ts)}}return{setValue:{componentImmediateValues:fs}}}else if(vectorOperators.includes(cs)){let ps=is.slice(1),ds=ps.length,fs={};for(let hs=0;hs<os;hs++){let ys=0;if(hs<ds){let bs=`${hs},0`;fs[bs]=Context.fromAst(ps[hs]),ys=1}let gs=as[hs];gs||(gs=[]);for(let bs=ys;bs<ls;bs++){let vs=gs[bs],Ns=`${hs},${bs}`;fs[Ns]=Context.fromAst(vs===void 0?rs.defaultEntry.tree:vs)}}return{setValue:{componentImmediateValues:fs}}}else if(Array.isArray(is[1])&&vectorOperators.includes(is[1][0])&&(cs==="^"&&is[2]==="T"||cs==="prime")){let ps=is[1].slice(1,ls+1);as[0];let ds={};for(let fs=0;fs<os;fs++){let hs=as[fs];hs||(hs=[]);let ys=0;if(fs===0){for(let gs=0;gs<ps.length;gs++){let bs=`0,${gs}`;ds[bs]=Context.fromAst(ps[gs])}ys=ps.length}for(let gs=ys;gs<ls;gs++){let bs=hs[gs],vs=`${fs},${gs}`;ds[vs]=Context.fromAst(bs===void 0?rs.defaultEntry.tree:bs)}}return{setValue:{componentImmediateValues:ds}}}}let us={};for(let cs=0;cs<os;cs++){let ps=0;if(cs===0){let fs="0,0";us[fs]=Context.fromAst(is),ps=1}let ds=as[cs];ds||(ds=[]);for(let fs=ps;fs<ls;fs++){let hs=ds[fs],ys=`${cs},${fs}`;us[ys]=Context.fromAst(hs===void 0?rs.defaultEntry.tree:hs)}}return{setValue:{componentImmediateValues:us}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,initialChange:is,workspace:as}){let os=ns.numRows,ls=ns.numColumns,us=!1,cs=!1,ps=!1,ds=ns.immediateValueOriginal.tree;if(Array.isArray(ds)){let hs=ds[0];vectorOperators.includes(hs)?us=!0:hs==="matrix"?ps=!0:Array.isArray(ds[1])&&vectorOperators.includes(ds[1][0])&&(hs==="^"&&ds[2]==="T"||hs==="prime")&&(cs=!0)}let fs;if(as.immediateValueData)fs=as.immediateValueData.map(hs=>[...hs]);else{let hs=ns.immediateValueOriginal.tree;if(us){if(fs=hs.slice(1,1+os).map(ys=>[ys]),fs.length<os)for(let ys=fs.length;ys<os;ys++)fs.push([""]);if(ls>1)for(let ys=0;ys<os;ys++)fs[ys].push(...Array(ls-1).fill(""))}else if(cs){if(fs=[hs[1].slice(1,1+ls)],fs[0].length<ls&&fs[0].push(...Array(ls-fs[0].length).fill("")),os>1)for(let ys=1;ys<os;ys++)fs.push(Array(ls).fill(""))}else if(ps){if(fs=hs[2].slice(1,os+1).map(ys=>ys.slice(1,ls+1)),fs[0].length<ls)for(let ys=0;ys<fs.length;ys++)fs[ys].push(...Array(ls-fs[ys].length).fill(""));if(fs.length<os)for(let ys=fs.length;ys<os;ys++)fs.push(Array(ls).fill(""))}else if(fs=[[hs]],ls>1&&fs[0].push(...Array(ls-1).fill("")),os>1)for(let ys=1;ys<os;ys++)fs.push(Array(ls).fill(""))}for(let hs in rs.componentImmediateValues){let[ys,gs]=hs.split(",");fs[ys][gs]=convertValueToMathExpression(rs.componentImmediateValues[hs]).tree}if(as.immediateValueData=fs,ls===1&&us){let hs=ns.immediateValueOriginal.tree[0];return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:Context.fromAst([hs,...fs.map(gs=>gs[0])]),treatAsInitialChange:is}]}}else if(os===1&&cs){let hs=ns.immediateValueOriginal.tree,ys=hs[0],gs=[hs[1][0],...fs[0]];return ys==="^"?gs=Context.fromAst(["^",gs,"T"]):gs=Context.fromAst(["prime",gs]),{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:gs,treatAsInitialChange:is}]}}else{let hs=["matrix",["tuple",ns.numRows,ns.numColumns],["tuple",...fs.map(ys=>["tuple",...ys])]];return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:Context.fromAst(hs),treatAsInitialChange:is}]}}}},ts.componentValuesForDisplay={isArray:!0,entryPrefixes:["componentValueForDisplay"],nDimensions:2,forRenderer:!0,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}},is={};for(let as of rs){let[os,ls]=as.split(","),us=Number(os)+1+"_"+(Number(ls)+1);is[as]={componentValue:{dependencyType:"stateVariable",variableName:`componentValue${us}`}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,usedDefault:as}){let os={};for(let ls of is){let us=roundForDisplay({value:ns[ls].componentValue,dependencyValues:rs,usedDefault:as});os[ls]=us}return{setValue:{componentValuesForDisplay:os}}}},ts.value={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({componentValues:{dependencyType:"stateVariable",variableName:"componentValues"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),definition({dependencyValues:rs}){let ns=rs.numRows,is=rs.numColumns,as=["matrix",["tuple",ns,is]],os=as[2]=["tuple"];for(let ls=0;ls<ns;ls++){os[ls+1]=["tuple"];for(let us=0;us<is;us++)os[ls+1][us+1]=rs.componentValues[ls][us].tree}return{setValue:{value:Context.fromAst(as)}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){let is=rs.value.tree;if(Array.isArray(is)&&is[0]==="matrix"&&is[1][1]===ns.numRows&&is[1][2]===ns.numColumns){if(ns.numColumns===1){let as=ns.valueOriginal.tree;if(Array.isArray(as)){let os=as[0];if(vectorOperators.includes(os))return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:Context.fromAst([os,...is[2].slice(1).map(us=>us[1])])}]}}}else if(ns.numRows===1){let as=ns.valueOriginal.tree;if(Array.isArray(as)){let os=as[0];if(Array.isArray(as[1])&&vectorOperators.includes(as[1][0])&&(os==="^"&&as[2]==="T"||os==="prime")){let ls=[as[1][0],...is[2][1].slice(1)];return os==="^"?ls=Context.fromAst(["^",ls,"T"]):ls=Context.fromAst(["prime",ls]),{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:ls}]}}}}return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:rs.value}]}}else return{success:!1}}},ts.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({componentImmediateValues:{dependencyType:"stateVariable",variableName:"componentImmediateValues"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},immediateValueOriginal:{dependencyType:"stateVariable",variableName:"immediateValueOriginal"}}),definition({dependencyValues:rs}){let ns=rs.numRows,is=rs.numColumns,as=["matrix",["tuple",ns,is]],os=as[2]=["tuple"];for(let ls=0;ls<ns;ls++){os[ls+1]=["tuple"];for(let us=0;us<is;us++)os[ls+1][us+1]=rs.componentImmediateValues[ls][us].tree}return{setValue:{immediateValue:Context.fromAst(as)}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){let is=rs.immediateValue.tree;if(Array.isArray(is)&&is[0]==="matrix"&&is[1][1]===ns.numRows&&is[1][2]===ns.numColumns){if(ns.numColumns===1){let as=ns.immediateValueOriginal.tree;if(Array.isArray(as)){let os=as[0];if(vectorOperators.includes(os))return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:Context.fromAst([os,...is[2].slice(1).map(us=>us[1])])}]}}}else if(ns.numRows===1){let as=ns.immediateValueOriginal.tree;if(Array.isArray(as)){let os=as[0];if(Array.isArray(as[1])&&vectorOperators.includes(as[1][0])&&(os==="^"&&as[2]==="T"||os==="prime")){let ls=[as[1][0],...is[2][1].slice(1)];return os==="^"?ls=Context.fromAst(["^",ls,"T"]):ls=Context.fromAst(["prime",ls]),{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:ls}]}}}}return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:rs.immediateValue}]}}else return{success:!1}}},ts.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:rs,usedDefault:ns}){return{setValue:{valueForDisplay:roundForDisplay({value:rs.value,dependencyValues:rs,usedDefault:ns})}}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"matrix"}})},ts}async updateNumRows({numRows:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numRows",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}async updateNumColumns({numColumns:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numColumns",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}}Ms(MatrixInput,"componentType","matrixInput"),Ms(MatrixInput,"variableForPlainMacro","value"),Ms(MatrixInput,"variableForPlainCopy","value"),Ms(MatrixInput,"processWhenJustUpdatedForNewComponent",!0),Ms(MatrixInput,"renderChildren",!0),Ms(MatrixInput,"adapters",[{stateVariable:"value",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]}]);class MatrixInputGrid extends CompositeComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.numRows={returnDependencies:()=>({parentNumRows:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numRows"}}),definition({dependencyValues:rs}){return{setValue:{numRows:rs.parentNumRows}}}},ts.numColumns={returnDependencies:()=>({parentNumColumns:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numColumns"}}),definition({dependencyValues:rs}){return{setValue:{numColumns:rs.parentNumColumns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),markStale(){return{updateReplacements:!0}},definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns,workspace:is}){let as=[],os=await ts.stateValues.numRows;is.previousNumRows=os;for(let ls=0;ls<os;ls++)as.push({componentType:"matrixInputRow",state:{rowInd:ls},uniqueIdentifier:ls});return{replacements:as}}static async calculateReplacementChanges({component:ts,componentChanges:rs,componentInfoObjects:ns,flags:is,workspace:as}){let os=[],ls=as.previousNumRows,us=await ts.stateValues.numRows,cs,ps=0;if(us<ls){cs=ts.replacements.length-us;let ds={changeType:"changeReplacementsToWithhold",replacementsToWithhold:cs};os.push(ds)}else if(us>ls&&(ps=us-ls,ts.replacementsToWithhold>0))if(ts.replacementsToWithhold>=ps){cs=ts.replacementsToWithhold-ps,ls+=ps,ps=0;let ds={changeType:"changeReplacementsToWithhold",replacementsToWithhold:cs};os.push(ds)}else ps-=ts.replacementsToWithhold,ls+=ts.replacementsToWithhold,cs=0;if(ps>0){let ds=[];for(let hs=ls;hs<us;hs++)ds.push({componentType:"matrixInputRow",state:{rowInd:hs},uniqueIdentifier:hs});let fs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ls,serializedReplacements:ds,replacementsToWithhold:0,assignNamesOffset:ls};os.push(fs)}return as.previousNumRows=us,os}}Ms(MatrixInputGrid,"componentType","matrixInputGrid"),Ms(MatrixInputGrid,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class MatrixInputRow extends CompositeComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.rowInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{rowInd:!0}})},ts.numColumns={returnDependencies:()=>({parentNumColumns:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numColumns"}}),definition({dependencyValues:rs}){return{setValue:{numColumns:rs.parentNumColumns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),markStale(){return{updateReplacements:!0}},definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns,workspace:is}){let as=[],os=await ts.stateValues.numColumns,ls=await ts.stateValues.rowInd;is.previousNumColumns=os;for(let us=0;us<os;us++)as.push({componentType:"matrixComponentInput",state:{rowInd:ls,colInd:us},uniqueIdentifier:us});return{replacements:as}}static async calculateReplacementChanges({component:ts,componentChanges:rs,componentInfoObjects:ns,flags:is,workspace:as}){let os=[],ls=as.previousNumColumns,us=await ts.stateValues.numColumns,cs=await ts.stateValues.rowInd,ps,ds=0;if(us<ls){ps=ts.replacements.length-us;let fs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:ps};os.push(fs)}else if(us>ls&&(ds=us-ls,ts.replacementsToWithhold>0))if(ts.replacementsToWithhold>=ds){ps=ts.replacementsToWithhold-ds,ls+=ds,ds=0;let fs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:ps};os.push(fs)}else ds-=ts.replacementsToWithhold,ls+=ts.replacementsToWithhold,ps=0;if(ds>0){let fs=[];for(let ys=ls;ys<us;ys++)fs.push({componentType:"matrixComponentInput",state:{rowInd:cs,colInd:ys},uniqueIdentifier:ys});let hs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ls,serializedReplacements:fs,replacementsToWithhold:0,assignNamesOffset:ls};os.push(hs)}return as.previousNumColumns=us,os}}Ms(MatrixInputRow,"componentType","matrixInputRow"),Ms(MatrixInputRow,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class MatrixComponentInput extends BaseComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateRawValue:this.updateRawValue.bind(this),updateValue:this.updateValue.bind(this)})}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.rowInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{rowInd:!0}})},ts.colInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{colInd:!0}})},ts.format={returnDependencies:()=>({parentFormat:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"format"}}),definition({dependencyValues:rs}){return{setValue:{format:rs.parentFormat}}}},ts.functionSymbols={returnDependencies:()=>({parentFunctionSymbols:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"functionSymbols"}}),definition({dependencyValues:rs}){return{setValue:{functionSymbols:rs.parentFunctionSymbols}}}},ts.splitSymbols={returnDependencies:()=>({parentSplitSymbols:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"splitSymbols"}}),definition({dependencyValues:rs}){return{setValue:{splitSymbols:rs.parentSplitSymbols}}}},ts.parseScientificNotation={returnDependencies:()=>({parentParseScientificNotation:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"parseScientificNotation"}}),definition({dependencyValues:rs}){return{setValue:{parseScientificNotation:rs.parentParseScientificNotation}}}},ts.displayDigits={returnDependencies:()=>({parentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displayDigits"}}),definition({dependencyValues:rs,usedDefault:ns}){let is={setValue:{displayDigits:rs.parentDisplayDigits}};return ns.parentDisplayDigits&&(is.markAsUsedDefault={displayDigits:!0}),is}},ts.displayDecimals={returnDependencies:()=>({parentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displayDecimals"}}),definition({dependencyValues:rs,usedDefault:ns}){let is={setValue:{displayDecimals:rs.parentDisplayDecimals}};return ns.parentDisplayDecimals&&(is.markAsUsedDefault={displayDecimals:!0}),is}},ts.displaySmallAsZero={returnDependencies:()=>({parentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displaySmallAsZero"}}),definition({dependencyValues:rs}){return{setValue:{displaySmallAsZero:rs.parentDisplaySmallAsZero}}}},ts.unionFromU={returnDependencies:()=>({parentUnionFromU:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"unionFromU"}}),definition({dependencyValues:rs}){return{setValue:{unionFromU:rs.parentUnionFromU}}}},ts.value={stateVariablesDeterminingDependencies:["rowInd","colInd"],returnDependencies:({stateValues:rs})=>{let ns="";return rs.rowInd!==null&&rs.colInd!==null&&(ns=`${rs.rowInd+1}_${rs.colInd+1}`),{parentComponentValue:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:`componentValue${ns}`}}},definition:function({dependencyValues:rs}){return rs.parentComponentValue?{setValue:{value:rs.parentComponentValue}}:{setValue:{value:Context.fromAst("")}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return{success:!0,instructions:[{setDependency:"parentComponentValue",desiredValue:rs.value}]}}},ts.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},stateVariablesDeterminingDependencies:["rowInd","colInd"],returnDependencies:({stateValues:rs})=>{let ns="";return rs.rowInd!==null&&rs.colInd!==null&&(ns=`${rs.rowInd+1}_${rs.colInd+1}`),{parentComponentImmediateValue:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:`componentImmediateValue${ns}`}}},definition:function({dependencyValues:rs}){return{setValue:{immediateValue:rs.parentComponentImmediateValue}}},inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns}){return{success:!0,instructions:[{setDependency:"parentComponentImmediateValue",desiredValue:rs.immediateValue,treatAsInitialChange:ns}]}}},ts.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:rs,usedDefault:ns}){return{setValue:{valueForDisplay:roundForDisplay({value:rs.value,dependencyValues:rs,usedDefault:ns})}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:rs}){return{setValue:{text:rs.valueForDisplay.toString()}}}},ts.rawRendererValue={forRenderer:!0,hasEssential:!0,shadowVariable:!0,defaultValue:"",provideEssentialValuesInDefinition:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"lastValueForDisplay",hasEssential:!0,shadowVariable:!0,defaultValue:null,set:convertValueToMathExpression}],returnDependencies:()=>({immediateValue:{dependencyType:"stateVariable",variableName:"immediateValue"},valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition({dependencyValues:rs,essentialValues:ns}){if(ns.rawRendererValue===void 0||!deepCompare(ns.lastValueForDisplay.tree,rs.valueForDisplay.tree)){let is=stripLatex(rs.valueForDisplay.toLatex());return is===""&&(is=""),{setValue:{rawRendererValue:is,lastValueForDisplay:rs.valueForDisplay},setEssentialValue:{rawRendererValue:is,lastValueForDisplay:rs.valueForDisplay}}}else return{useEssentialOrDefaultValue:{rawRendererValue:!0,lastValueForDisplay:!0}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns,essentialValues:is}){const as=async ls=>{let us;ls=normalizeLatexString(ls,{unionFromU:await ns.unionFromU}),ls=ls.replace(/\^(\w)/g,"^{$1}");let cs=getFromLatex({functionSymbols:await ns.functionSymbols,splitSymbols:await ns.splitSymbols,parseScientificNotation:await ns.parseScientificNotation});try{us=cs(ls)}catch{us=Context.fromAst("")}return us};let os=[];if(typeof rs.rawRendererValue=="string"){let ls=is.rawRendererValue,us=rs.rawRendererValue;ls!==us&&os.push({setEssentialValue:"rawRendererValue",value:us});let cs=await as(ls),ps=await as(us);deepCompare(ps.tree,cs.tree)||os.push({setDependency:"immediateValue",desiredValue:ps,treatAsInitialChange:!0})}else{os.push({setEssentialValue:"lastValueForDisplay",value:rs.rawRendererValue});let ls=await as(is.rawRendererValue);if(!deepCompare(rs.rawRendererValue.tree,ls.tree)){let us=stripLatex(rs.rawRendererValue.toLatex());us===""&&(us=""),os.push({setEssentialValue:"rawRendererValue",value:us})}}return{success:!0,instructions:os}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"math"}})},ts}async updateRawValue({rawRendererValue:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",value:ts},{updateType:"setComponentNeedingUpdateValue",componentName:this.componentName}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}async updateValue({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:ts});else{let is=await this.stateValues.immediateValue;if(deepCompare((await this.stateValues.value).tree,is.tree))await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"rawRendererValue"}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns});else{let as=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:is},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"},{updateType:"unsetComponentNeedingUpdateValue"}];is.tree!==""&&as.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"valueForDisplay"});let os={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:is,responseText:is.toString()}},ls=await this.stateValues.answerAncestor;return ls&&(os.context={answerAncestor:ls.componentName}),await this.coreFunctions.performUpdate({updateInstructions:as,actionId:ts,sourceInformation:rs,skipRendererUpdate:!0,event:os}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}}}Ms(MatrixComponentInput,"componentType","matrixComponentInput"),Ms(MatrixComponentInput,"rendererType","mathInput"),Ms(MatrixComponentInput,"variableForPlainMacro","value"),Ms(MatrixComponentInput,"variableForPlainCopy","value");var MatrixInput$1=Object.freeze({__proto__:null,MatrixInput,MatrixInputGrid,MatrixInputRow,default:MatrixComponentInput});class Document extends BaseComponent{constructor(ts){super(ts),Object.assign(this.actions,{submitAllAnswers:this.submitAllAnswers.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.hide,delete ts.disabled,delete ts.modifyIndirectly,delete ts.fixed,delete ts.styleNumber,delete ts.isResponse,ts.documentWideCheckWork={createComponentOfType:"boolean",createStateVariable:"documentWideCheckWork",defaultValue:!1,public:!0},ts.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},ts.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},ts.displayDigitsForCreditAchieved={createComponentOfType:"integer",createStateVariable:"displayDigitsForCreditAchieved",defaultValue:3,public:!0},ts.xmlns={createPrimitiveOfType:"string"},ts.type={createPrimitiveOfType:"string"},ts}static returnChildGroups(){return[{group:"variantControl",componentTypes:["variantControl"]},{group:"title",componentTypes:["title"]},{group:"description",componentTypes:["description"]},{group:"setups",componentTypes:["setup"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnStyleDefinitionStateVariables();Object.assign(ts,rs);let ns=returnFeedbackDefinitionStateVariables();return Object.assign(ts,ns),ts.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["title"]}}),definition({dependencyValues:is}){let as=null;return is.titleChild.length>0&&(as=is.titleChild[0].componentName),{setValue:{titleChildName:as}}}},ts.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["title"],variableNames:["text"]}}),definition({dependencyValues:is}){return is.titleChild.length===0?{setValue:{title:""}}:{setValue:{title:is.titleChild[0].stateValues.text}}}},ts.description={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({descriptionChild:{dependencyType:"child",childGroups:["description"],variableNames:["text"]}}),definition({dependencyValues:is}){return is.descriptionChild.length===0?{setValue:{description:""}}:{setValue:{description:is.descriptionChild[0].stateValues.text}}}},ts.theme={hasEssential:!0,defaultValue:"light",returnDependencies:()=>({documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition({dependencyValues:is}){return is.documentAncestor?{setValue:{theme:is.documentAncestor.stateValues.theme}}:{useEssentialOrDefaultValue:{theme:!0}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.documentAncestor?{success:!0,instructions:[{setDependency:"documentAncestor",desiredValue:is.theme}]}:{success:!0,instructions:[{setEssentialValue:"theme",value:is.theme}]}}},ts.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{level:0}})},ts.viewedSolution={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:!0}}),inverseDefinition({desiredStateVariableValues:is}){return{success:!0,instructions:[{setEssentialValue:"viewedSolution",value:is.viewedSolution}]}}},ts.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer","setup"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:is}){let as=[];for(let os of is.scoredDescendants)os.componentType!=="setup"&&(os.stateValues.aggregateScores||os.stateValues.scoredDescendants===void 0?as.push(os):as.push(...os.stateValues.scoredDescendants));return{setValue:{scoredDescendants:as}}}},ts.nScoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}}),definition({dependencyValues:is}){return{setValue:{nScoredDescendants:is.scoredDescendants.length}}}},ts.itemCreditAchieved={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize({dependencyValues:is}){return[is.nScoredDescendants]},stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:is,stateValues:as}){let os={};for(let ls of is){let us=as.scoredDescendants[ls];us&&(os[ls]={creditAchieved:{dependencyType:"stateVariable",componentName:us.componentName,variableName:"creditAchieved"}})}return{dependenciesByKey:os}},arrayDefinitionByKey({dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as)os[ls]=is[ls].creditAchieved;return{setValue:{itemCreditAchieved:os}}}},ts.itemNumberByAnswerName={stateVariablesDeterminingDependencies:["scoredDescendants"],returnDependencies({stateValues:is}){let as={scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}};for(let os in is.scoredDescendants){let ls=is.scoredDescendants[os];as[`descendantsOf${os}`]={dependencyType:"descendant",ancestorName:ls.componentName,componentTypes:["answer"],recurseToMatchedChildren:!1}}return as},definition({dependencyValues:is,componentInfoObjects:as}){let os={};for(let[ls,us]of is.scoredDescendants.entries()){let cs=ls+1;for(let ps of is[`descendantsOf${ls}`])os[ps.componentName]=cs;as.isInheritedComponentType({inheritedComponentType:us.componentType,baseComponentType:"answer"})&&(os[us.componentName]=cs)}return{setValue:{itemNumberByAnswerName:os}}}},ts.itemVariantInfo={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize({dependencyValues:is}){return[is.nScoredDescendants]},stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:is,stateValues:as}){let os={};for(let ls of is){let us=as.scoredDescendants[ls];us&&(os[ls]={generatedVariantInfo:{dependencyType:"stateVariable",componentName:us.componentName,variableName:"generatedVariantInfo",variablesOptional:!0}})}return{dependenciesByKey:os}},arrayDefinitionByKey({dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as)os[ls]=is[ls].generatedVariantInfo;return{setValue:{itemVariantInfo:os}}}},ts.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition({dependencyValues:is}){return{setValue:{answerDescendants:is.answerDescendants}}}},ts.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition({dependencyValues:is}){return{setValue:{justSubmitted:is.answerDescendants.every(as=>as.stateValues.justSubmitted)}}}},ts.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition({dependencyValues:is}){return{setValue:{showCorrectness:is.showCorrectnessFlag!==!1}}}},ts.creditAchieved={public:!0,forRenderer:!0,defaultValue:0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}}}],returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"},itemCreditAchieved:{dependencyType:"stateVariable",variableName:"itemCreditAchieved"}}),definition({dependencyValues:is}){let as=0,os=0;for(let[cs,ps]of is.scoredDescendants.entries()){let ds=ps.stateValues.weight;as+=is.itemCreditAchieved[cs]*ds,os+=ds}let ls;os>0?ls=as/os:ls=1;let us=ls*100;return{setValue:{creditAchieved:ls,percentCreditAchieved:us}}}},ts.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["scoredDescendants"],returnDependencies({stateValues:is}){let as={scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}};for(let[os,ls]of is.scoredDescendants.entries())as["creditAchievedIfSubmit"+os]={dependencyType:"stateVariable",componentName:ls.componentName,variableName:"creditAchievedIfSubmit"};return as},definition({dependencyValues:is}){let as=0,os=0;for(let[us,cs]of is.scoredDescendants.entries()){let ps=cs.stateValues.weight;as+=is["creditAchievedIfSubmit"+us]*ps,os+=ps}return{setValue:{creditAchievedIfSubmit:as/os}}}},ts.generatedVariantInfo={providePreviousValuesInDefinition:!0,returnDependencies:({sharedParameters:is,componentInfoObjects:as})=>({variantIndex:{dependencyType:"value",value:is.variantIndex},variantName:{dependencyType:"value",value:is.variantName},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(as.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:is,componentName:as,previousValues:os}){var cs;let ls={index:is.variantIndex,name:is.variantName,meta:{createdBy:as}},us=ls.subvariants=[];for(let ps of is.variantDescendants)ps.stateValues.isVariantComponent?us.push(ps.stateValues.generatedVariantInfo):ps.stateValues.generatedVariantInfo&&us.push(...ps.stateValues.generatedVariantInfo.subvariants);for(let[ps,ds]of us.entries())if(!ds.subvariants&&os.generatedVariantInfo){let fs=os.generatedVariantInfo.subvariants;(cs=fs[ps])!=null&&cs.subvariants&&(us[ps]=Object.assign({},us[ps]),us[ps].subvariants=fs[ps].subvariants)}return{setValue:{generatedVariantInfo:ls}}}},ts.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"suppressAnswerSubmitButtons",forRenderer:!0}],returnDependencies:()=>({documentWideCheckWork:{dependencyType:"stateVariable",variableName:"documentWideCheckWork"}}),definition({dependencyValues:is,componentName:as}){let os=!1,ls=!1;return is.documentWideCheckWork&&(os=!0,ls=!0),{setValue:{createSubmitAllButton:os,suppressAnswerSubmitButtons:ls}}}},ts.suppressCheckwork={forRenderer:!0,returnDependencies:()=>({autoSubmit:{dependencyType:"flag",flagName:"autoSubmit"}}),definition({dependencyValues:is}){return{setValue:{suppressCheckwork:is.autoSubmit}}}},ts}async submitAllAnswers({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType}});let is=await this.stateValues.answerDescendants;for(let[as,os]of await this.stateValues.answerDescendants.entries())await os.stateValues.justSubmitted||await this.coreFunctions.performAction({componentName:os.componentName,actionName:"submitAnswer",args:{actionId:ts,sourceInformation:rs,skipRendererUpdate:ns||as<is-1}});this.coreFunctions.resolveAction({actionId:ts})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){let is=ts.variants.numberOfVariants,as,os=ts.variants.desiredVariant;if(os!==void 0&&os.index!==void 0){let ls=Number(os.index);if(!Number.isFinite(ls))console.warn("Variant index "+os.index+" must be a number"),as=1;else{Number.isInteger(ls)||(console.warn("Variant index "+os.index+" must be an integer"),ls=Math.round(ls));let us=(ls-1)%is;us<0&&(us+=is),as=us+1}}if(as===void 0&&(as=1),rs.allPossibleVariants=ts.variants.allPossibleVariants,rs.allVariantNames=ts.variants.allVariantNames,rs.variantSeed=ts.variants.allPossibleVariantSeeds[as-1],rs.variantIndex=as,rs.variantName=ts.variants.allPossibleVariants[as-1],rs.uniqueIndex=ts.variants.allPossibleVariantUniqueIndices[as-1],rs.variantRng=new rs.rngClass(rs.variantSeed),rs.subpartVariantRng=new rs.rngClass(rs.variantSeed+"s"),os!=null&&os.subvariants&&ns)for(let ls in os.subvariants){let us=os.subvariants[ls],cs=ns[ls];if(cs===void 0)break;cs.variants.desiredVariant=us}}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){return determineVariantsForSection({serializedComponent:ts,componentInfoObjects:rs,isDocument:!0})}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){let is=ts.variants.allPossibleVariantUniqueIndices[rs-1];if(is===void 0)return{success:!1};let as=getVariantsForDescendantsForUniqueVariants({variantIndex:is,serializedComponent:ts,componentInfoObjects:ns});return as.success?{success:!0,desiredVariant:{index:rs,subvariants:as.desiredVariants}}:(console.log("Failed to get unique variant for document."),{success:!1})}}Ms(Document,"componentType","document"),Ms(Document,"rendererType","section"),Ms(Document,"renderChildren",!0),Ms(Document,"createsVariants",!0),Ms(Document,"includeBlankStringChildren",!0);let TextList$1=(Rl=class extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},ts.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"text"}),ns=returnBreakStringsIntoComponentTypeBySpaces({componentType:"text"});return ts.push({replacementFunction:function({matchedChildren:is,isAttributeComponent:as=!1,createdFromMacro:os=!1}){return as&&!os?rs({matchedChildren:is}):ns({matchedChildren:is})}}),ts}static returnChildGroups(){return[{group:"texts",componentTypes:["text"]},{group:"textLists",componentTypes:["textList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},ts.textsShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{textsShadow:!0}})},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},textListChildren:{dependencyType:"child",childGroups:["textLists"],variableNames:["nComponents"]},textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],skipComponentNames:!0},textsShadow:{dependencyType:"stateVariable",variableName:"textsShadow"}}},definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=0,as=[];if(rs.textAndTextListChildren.length>0){let ls=0;for(let[us,cs]of rs.textAndTextListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"textList"})){let ps=rs.textListChildren[ls];ls++;for(let ds=0;ds<ps.stateValues.nComponents;ds++)as[is+ds]=[us,ds];is+=ps.stateValues.nComponents}else as[is]=[us,0],is+=1}else rs.textsShadow!==null&&(is=rs.textsShadow.length);let os=rs.maximumNumber;return os!==null&&is>os&&(is=os,as=as.slice(0,os)),{setValue:{nComponents:is,childIndexByArrayKey:as},checkForActualChange:{nComponents:!0}}}},ts.texts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["text"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={},as={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},textsShadow:{dependencyType:"stateVariable",variableName:"textsShadow"}};for(let os of rs){let ls=[],us="1";ns.childIndexByArrayKey[os]&&(ls=[ns.childIndexByArrayKey[os][0]],us=ns.childIndexByArrayKey[os][1]+1),is[os]={textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],variableNames:["value","text"+us],variablesOptional:!0,childIndices:ls}}}return{globalDependencies:as,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].textAndTextListChildren[0];if(ls)if(ls.stateValues.value!==void 0)as[os]=ls.stateValues.value;else{let us=rs.childIndexByArrayKey[os][1]+1;as[os]=ls.stateValues["text"+us]}else rs.textsShadow!==null&&(as[os]=rs.textsShadow[os])}return{setValue:{texts:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[];for(let us in rs.texts){if(!is[us])continue;let cs=is[us].textAndTextListChildren[0];cs&&(cs.stateValues.value!==void 0?ls.push({setDependency:as[us].textAndTextListChildren,desiredValue:rs.texts[us],childIndex:0,variableIndex:0}):ls.push({setDependency:as[us].textAndTextListChildren,desiredValue:rs.texts[us],childIndex:0,variableIndex:1}))}return{success:!0,instructions:ls}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"texts"},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.texts.join(", ")}})},ts.componentNamesInList={returnDependencies:()=>({textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=[];for(let os of rs.textAndTextListChildren)ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"textList"})?is.push(...os.stateValues.componentNamesInList):is.push(os.componentName);let as=rs.maximumNumber;return as!==null&&is.length>as&&(as=Math.max(0,Math.floor(as)),is=is.slice(0,as)),{setValue:{componentNamesInList:is}}}},ts.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},textListChildren:{dependencyType:"child",childGroups:["textLists"],variableNames:["nComponents"]},textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"textList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns,componentName:is}){let as=rs.nComponents;rs.parentNComponentsToDisplayByChild!==null&&(as=rs.parentNComponentsToDisplayByChild[is]);let os={},ls=0,us=0,cs=0;for(let ps of rs.textAndTextListChildren){let ds=Math.max(0,as-ls);if(ds>0&&us++,ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"textList"})){let fs=rs.textListChildren[cs];cs++;let hs=Math.min(ds,fs.stateValues.nComponents);os[fs.componentName]=hs,ls+=hs}else ls+=1}return{setValue:{nComponentsToDisplayByChild:os,nChildrenToRender:us}}},markStale:()=>({updateRenderedChildren:!0})},ts}},Ms(Rl,"componentType","textList"),Ms(Rl,"renderChildren",!0),Ms(Rl,"includeBlankStringChildren",!0),Ms(Rl,"removeBlankStringChildrenPostSugar",!0),Ms(Rl,"stateVariableForAttributeValue","texts"),Ms(Rl,"primaryStateVariableForDefinition","textsShadow"),Ms(Rl,"descendantCompositesMustHaveAReplacement",!1),Ms(Rl,"adapters",["text"]),Rl);class TextList extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.unordered={default:!1},ts.maximumNumber={default:null},ts}static returnChildLogic(ts){let rs=super.returnChildLogic(ts),ns=rs.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),is=rs.newLeaf({name:"atLeastZeroTextLists",componentType:"textList",comparison:"atLeast",number:0}),as=function({dependencyValues:us}){let cs=us.stringChildren[0];return{success:!0,newChildren:cs.stateValues.value.split(",").map(ds=>({componentType:"text",state:{value:ds.trim()}})),toDelete:[cs.componentName]}},os=rs.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,returnSugarDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"exactlyOneString",variableNames:["value"]}}),logicToWaitOnSugar:["atLeastZeroTexts"],replacementFunction:as}),ls=rs.newOperator({name:"textAndTextLists",operator:"and",propositions:[ns,is]});return rs.newOperator({name:"TextsXorSugar",operator:"xor",propositions:[os,ls],setAsBase:!0}),rs}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.texts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["text"],returnDependencies:()=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},childrenToRender:{dependencyType:"stateVariable",variableName:"childrenToRender"}}),definition:function({dependencyValues:rs}){let ns=[],is=rs.textAndTextListChildren.map(as=>as.componentName);for(let as of rs.childrenToRender){let os=is.indexOf(as),ls=rs.textAndTextListChildren[os];ls.stateValues.texts?ns.push(...ls.stateValues.texts):ns.push(ls.stateValues.value)}return{setValue:{texts:ns}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.texts.join(", ")}})},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:function({dependencyValues:rs}){return{setValue:{nComponents:rs.texts.length}}}},ts.childrenToRender={returnDependencies:({sharedParameters:rs})=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},selectRng:{dependencyType:"value",value:rs.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let os of rs.textAndTextListChildren)os.stateValues.childrenToRender?ns.push(...os.stateValues.childrenToRender):ns.push(os.componentName);let is=rs.maximumNumber;is!==null&&ns.length>is&&(is=Math.max(0,Math.floor(is)),ns=ns.slice(0,is)),console.log("randomizing children");for(let os=ns.length-1;os>0;os--){const ls=rs.selectRng(),us=Math.floor(ls*(os+1));[ns[os],ns[us]]=[ns[us],ns[os]]}let as=Math.ceil(rs.selectRng()*ns.length);return console.log(`numChildren: ${as}`),ns=ns.slice(0,as),{setValue:{childrenToRender:ns}}}},ts}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.aslist({key:this.componentName}))}}Ms(TextList,"componentType","randomizedTextList"),Ms(TextList,"stateVariableForAttributeValue","texts");class TupleList extends MathList{static returnSugarInstructions(){let ts=[],rs=function({matchedChildren:ns}){let is=breakEmbeddedStringsIntoParensPieces({componentList:ns});return is.success!==!0?{success:!1}:{success:!0,newChildren:is.pieces.map(function(as){return as.length>1||typeof as[0]=="string"?{componentType:"math",children:as}:as[0]})}};return ts.push({replacementFunction:rs}),ts}}Ms(TupleList,"componentType","tupleList"),Ms(TupleList,"rendererType","mathList"),Ms(TupleList,"includeBlankStringChildren",!1);class NumberList extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},ts.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"number"}),ns=returnBreakStringsIntoComponentTypeBySpaces({componentType:"number"});return ts.push({replacementFunction:function({matchedChildren:is,isAttributeComponent:as=!1,createdFromMacro:os=!1}){return as&&!os?rs({matchedChildren:is}):ns({matchedChildren:is})}}),ts}static returnChildGroups(){return[{group:"numbers",componentTypes:["number"]},{group:"numberLists",componentTypes:["numberList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.numbersShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{numbersShadow:!0}})},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numberListChildren:{dependencyType:"child",childGroups:["numberLists"],variableNames:["nComponents"]},numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],skipComponentNames:!0},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=0,as=[],os=0;if(rs.numberAndNumberListChildren.length>0)for(let[us,cs]of rs.numberAndNumberListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"numberList"})){let ps=rs.numberListChildren[os];os++;for(let ds=0;ds<ps.stateValues.nComponents;ds++)as[is+ds]=[us,ds];is+=ps.stateValues.nComponents}else as[is]=[us,0],is+=1;else rs.numbersShadow!==null&&(is=rs.numbersShadow.length);let ls=rs.maximumNumber;return ls!==null&&is>ls&&(is=ls,as=as.slice(0,ls)),{setValue:{nComponents:is,childIndexByArrayKey:as},checkForActualChange:{nComponents:!0}}}},ts.numbers={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["number"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={},as={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"}};for(let os of rs){let ls=[],us="1";ns.childIndexByArrayKey[os]&&(ls=[ns.childIndexByArrayKey[os][0]],us=ns.childIndexByArrayKey[os][1]+1),is[os]={numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["value","number"+us],variablesOptional:!0,childIndices:ls}}}return{globalDependencies:as,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].numberAndNumberListChildren[0];if(ls)if(ls.stateValues.value!==void 0)as[os]=ls.stateValues.value;else{let us=rs.childIndexByArrayKey[os][1]+1;as[os]=ls.stateValues["number"+us]}else rs.numbersShadow!==null&&(as[os]=rs.numbersShadow[os])}return{setValue:{numbers:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[];for(let us in rs.numbers){if(!is[us])continue;let cs=is[us].numberAndNumberListChildren[0];cs&&(cs.stateValues.value!==void 0?ls.push({setDependency:as[us].numberAndNumberListChildren,desiredValue:rs.numbers[us],childIndex:0,variableIndex:0}):ls.push({setDependency:as[us].numberAndNumberListChildren,desiredValue:rs.numbers[us],childIndex:0,variableIndex:1}))}return{success:!0,instructions:ls}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"numbers"},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({numbers:{dependencyType:"stateVariable",variableName:"numbers"}}),definition({dependencyValues:rs}){let ns;return rs.numbers.length===0?ns=Context.fromAst(""):rs.numbers.length===1?ns=Context.fromAst(rs.numbers[0]):ns=Context.fromAst(["list",...rs.numbers]),{setValue:{math:ns}}}},ts.text={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is=[],as={};if(rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(as.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(as.padToDigits=rs.displayDigits)),rs.numberAndNumberListChildren.length>0)for(let us of rs.numberAndNumberListChildren)us.stateValues.valueForDisplay!==void 0?is.push(us.stateValues.text):is.push(...us.stateValues.texts);else rs.numbersShadow!==null&&(is=rs.numbersShadow.map(us=>roundForDisplay({value:Context.fromAst(us),dependencyValues:rs,usedDefault:ns}).toString(as)));let os=rs.maximumNumber;return os!==null&&is.length>os&&(os=Math.max(0,Math.floor(os)),is=is.slice(0,os)),{setValue:{text:is.join(", "),texts:is}}}},ts.componentNamesInList={returnDependencies:()=>({numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=[];for(let os of rs.numberAndNumberListChildren)ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"numberList"})?is.push(...os.stateValues.componentNamesInList):is.push(os.componentName);let as=rs.maximumNumber;return as!==null&&is.length>as&&(as=Math.max(0,Math.floor(as)),is=is.slice(0,as)),{setValue:{componentNamesInList:is}}}},ts.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},numberListChildren:{dependencyType:"child",childGroups:["numberLists"],variableNames:["nComponents"]},numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns,componentName:is}){let as=rs.nComponents;rs.parentNComponentsToDisplayByChild!==null&&(as=rs.parentNComponentsToDisplayByChild[is]);let os={},ls=0,us=0,cs=0;for(let ps of rs.numberAndNumberListChildren){let ds=Math.max(0,as-ls);if(ds>0&&us++,ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"numberList"})){let fs=rs.numberListChildren[cs];cs++;let hs=Math.min(ds,fs.stateValues.nComponents);os[fs.componentName]=hs,ls+=hs}else ls+=1}return{setValue:{nComponentsToDisplayByChild:os,nChildrenToRender:us}}},markStale:()=>({updateRenderedChildren:!0})},ts}}Ms(NumberList,"componentType","numberList"),Ms(NumberList,"renderChildren",!0),Ms(NumberList,"includeBlankStringChildren",!0),Ms(NumberList,"removeBlankStringChildrenPostSugar",!0),Ms(NumberList,"stateVariableForAttributeValue","numbers"),Ms(NumberList,"primaryStateVariableForDefinition","numbersShadow"),Ms(NumberList,"adapters",[{stateVariable:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text"]);class NumberListFromString extends InlineComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:ns.reduce(function(as,os){return typeof os=="string"?[...as,...os.split(/\s+/).filter(ls=>ls)]:[...as,os]},[])}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition:function({dependencyValues:rs}){return{setValue:{nComponents:rs.stringChildren.length}}}},ts.numbers={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["number"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey(){return{globalDependencies:{stringChildren:{dependencyType:"child",childGroups:["strings"]}}}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let[as,os]of rs.stringChildren.entries())is[as]=Number(os);return{setValue:{numbers:is}}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"numbers"},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numbers:{dependencyType:"stateVariable",variableName:"numbers"}}),definition:function({dependencyValues:rs}){let ns=rs.numbers.map(as=>as.toString());return{setValue:{text:ns.join(", "),texts:ns}}}},ts}}Ms(NumberListFromString,"componentType","numberListFromString"),Ms(NumberListFromString,"rendererType","asList"),Ms(NumberListFromString,"renderChildren",!0),Ms(NumberListFromString,"stateVariableForAttributeValue","numbers");let P$2=(Yl=class extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns="";for(let is of rs.inlineChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"?ns+=is.stateValues.text:ns+=" ";return{setValue:{text:ns}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}},Ms(Yl,"componentType","p"),Ms(Yl,"renderChildren",!0),Ms(Yl,"includeBlankStringChildren",!0),Yl);class BooleanList extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},ts.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"boolean"}),ns=returnBreakStringsIntoComponentTypeBySpaces({componentType:"boolean"});return ts.push({replacementFunction:function({matchedChildren:is,isAttributeComponent:as=!1,createdFromMacro:os=!1}){return as&&!os?rs({matchedChildren:is}):ns({matchedChildren:is})}}),ts}static returnChildGroups(){return[{group:"booleans",componentTypes:["boolean"]},{group:"booleanLists",componentTypes:["booleanList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},booleanListChildren:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["nComponents"]},booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],skipComponentNames:!0}}},definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=0,as=[],os=0;for(let[us,cs]of rs.booleanAndBooleanListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"booleanList"})){let ps=rs.booleanListChildren[os];os++;for(let ds=0;ds<ps.stateValues.nComponents;ds++)as[is+ds]=[us,ds];is+=ps.stateValues.nComponents}else as[is]=[us,0],is+=1;let ls=rs.maximumNumber;return ls!==null&&is>ls&&(is=ls,as=as.slice(0,ls)),{setValue:{nComponents:is,childIndexByArrayKey:as},checkForActualChange:{nComponents:!0}}}},ts.booleans={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},isArray:!0,entryPrefixes:["boolean"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={},as={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let os of rs){let ls=[],us="1";ns.childIndexByArrayKey[os]&&(ls=[ns.childIndexByArrayKey[os][0]],us=ns.childIndexByArrayKey[os][1]+1),is[os]={booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],variableNames:["value","boolean"+us],variablesOptional:!0,childIndices:ls}}}return{globalDependencies:as,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].booleanAndBooleanListChildren[0];if(ls)if(ls.stateValues.value!==void 0)as[os]=ls.stateValues.value;else{let us=rs.childIndexByArrayKey[os][1]+1;as[os]=ls.stateValues["boolean"+us]}}return{setValue:{booleans:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[];for(let us in rs.booleans){if(!is[us])continue;let cs=is[us].booleanAndBooleanListChildren[0];cs&&(cs.stateValues.value!==void 0?ls.push({setDependency:as[us].booleanAndBooleanListChildren,desiredValue:rs.booleans[us],childIndex:0,variableIndex:0}):ls.push({setDependency:as[us].booleanAndBooleanListChildren,desiredValue:rs.booleans[us],childIndex:0,variableIndex:1}))}return{success:!0,instructions:ls}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"booleans"},ts.componentNamesInList={returnDependencies:()=>({booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=[];for(let os of rs.booleanAndBooleanListChildren)ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"booleanList"})?is.push(...os.stateValues.componentNamesInList):is.push(os.componentName);let as=rs.maximumNumber;return as!==null&&is.length>as&&(as=Math.max(0,Math.floor(as)),is=is.slice(0,as)),{setValue:{componentNamesInList:is}}}},ts.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},booleanListChildren:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["nComponents"]},booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"booleanList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns,componentName:is}){let as=rs.nComponents;rs.parentNComponentsToDisplayByChild!==null&&(as=rs.parentNComponentsToDisplayByChild[is]);let os={},ls=0,us=0,cs=0;for(let ps of rs.booleanAndBooleanListChildren){let ds=Math.max(0,as-ls);if(ds>0&&us++,ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"booleanList"})){let fs=rs.booleanListChildren[cs];cs++;let hs=Math.min(ds,fs.stateValues.nComponents);os[fs.componentName]=hs,ls+=hs}else ls+=1}return{setValue:{nComponentsToDisplayByChild:os,nChildrenToRender:us}}},markStale:()=>({updateRenderedChildren:!0})},ts}}Ms(BooleanList,"componentType","booleanList"),Ms(BooleanList,"rendererType","asList"),Ms(BooleanList,"renderChildren",!0),Ms(BooleanList,"includeBlankStringChildren",!0),Ms(BooleanList,"removeBlankStringChildrenPostSugar",!0),Ms(BooleanList,"stateVariableForAttributeValue","booleans"),Ms(BooleanList,"descendantCompositesMustHaveAReplacement",!1);class Copy extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.disabled,delete ts.modifyIndirectly,delete ts.fixed,delete ts.styleNumber,delete ts.isResponse,ts.assignNewNamespaces={createPrimitiveOfType:"boolean"},ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.prop={createPrimitiveOfType:"string"},ts.obtainPropFromComposite={createPrimitiveOfType:"boolean",createStateVariable:"obtainPropFromComposite",defaultValue:!1,public:!0},ts.createComponentOfType={createPrimitiveOfType:"string"},ts.nComponents={createPrimitiveOfType:"number"},ts.componentIndex={createComponentOfType:"integer",createStateVariable:"componentIndex",defaultValue:null,public:!0},ts.sourceSubnames={createPrimitiveOfType:"stringArray",createStateVariable:"targetSubnames",defaultValue:null,public:!0},ts.sourceSubnamesComponentIndex={createComponentOfType:"numberList",createStateVariable:"targetSubnamesComponentIndex",defaultValue:null,public:!0},ts.propIndex={createComponentOfType:"numberList",createStateVariable:"propIndex",defaultValue:null,public:!0},ts.uri={createPrimitiveOfType:"string",createStateVariable:"uri",defaultValue:null,public:!0},ts.sourceAttributesToIgnore={createPrimitiveOfType:"stringArray",createStateVariable:"sourceAttributesToIgnore",defaultValue:["hide"],public:!0},ts.sourceAttributesToIgnoreRecursively={createPrimitiveOfType:"stringArray",createStateVariable:"sourceAttributesToIgnoreRecursively",defaultValue:["isResponse"],public:!0},ts.link={createPrimitiveOfType:"boolean"},ts.removeEmptyArrayEntries={createPrimitiveOfType:"boolean",createStateVariable:"removeEmptyArrayEntries",defaultValue:!1},ts}static keepChildrenSerialized({serializedComponent:ts}){return ts.children===void 0?[]:Object.keys(ts.children)}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:rs})=>({setValue:{target:rs.target}})},ts.targetSourcesName={additionalStateVariablesDefined:[{variableName:"sourcesChildNumber",hasEssential:!0,shadowVariable:!0}],stateVariablesDeterminingDependencies:["target"],determineDependenciesImmediately:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:function({stateValues:rs,sharedParameters:ns}){let is=ns.sourceNameMappings;if(!is)return{};let as=is[rs.target];return as?{targetSourcesName:{dependencyType:"value",value:as.name},sourcesChildNumber:{dependencyType:"value",value:as.childNumber}}:{}},definition:function({dependencyValues:rs}){let ns=rs.targetSourcesName,is=rs.sourcesChildNumber;return ns||(ns=null,is=null),{setValue:{targetSourcesName:ns,sourcesChildNumber:is},setEssentialValue:{targetSourcesName:ns,sourcesChildNumber:is}}}},ts.targetSources={stateVariablesDeterminingDependencies:["targetSourcesName"],determineDependenciesImmediately:!0,returnDependencies({stateValues:rs}){return rs.targetSourcesName?{targetSourcesComponent:{dependencyType:"componentIdentity",componentName:rs.targetSourcesName}}:{}},definition:function({dependencyValues:rs}){let ns=rs.targetSourcesComponent;return ns||(ns=null),{setValue:{targetSources:ns}}}},ts.sourceIndex={stateVariablesDeterminingDependencies:["target"],determineDependenciesImmediately:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:function({stateValues:rs,sharedParameters:ns}){let is=ns.sourceIndexMappings;if(!is)return{};let as=is[rs.target];return as===void 0?{}:{sourceIndex:{dependencyType:"value",value:as}}},definition:function({dependencyValues:rs}){let ns=rs.sourceIndex;return ns===void 0&&(ns=null),{setValue:{sourceIndex:ns},setEssentialValue:{sourceIndex:ns}}}},ts.targetComponent={shadowVariable:!0,stateVariablesDeterminingDependencies:["targetSources","sourceIndex"],determineDependenciesImmediately:!0,returnDependencies({stateValues:rs}){return rs.sourceIndex!==null?{}:rs.targetSources!==null?{targetSourcesChildren:{dependencyType:"stateVariable",componentName:rs.targetSources.componentName,variableName:"childIdentities"},sourcesChildNumber:{dependencyType:"stateVariable",variableName:"sourcesChildNumber"}}:{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:rs}){let ns=null;return rs.targetSourcesChildren?(ns=rs.targetSourcesChildren[rs.sourcesChildNumber],ns||(ns=null)):rs.targetComponent&&(ns=rs.targetComponent),{setValue:{targetComponent:ns}}}},ts.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:rs}){return rs.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:rs.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:rs}){return{setValue:{targetInactive:!!rs.targetIsInactiveCompositeReplacement}}}},ts.cid={additionalStateVariablesDefined:["doenetId"],returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:rs}){if(!rs.uri||rs.uri.substring(0,7).toLowerCase()!=="doenet:")return{setValue:{cid:null,doenetId:null}};let ns=null,is=null,as=rs.uri.match(/[:&]cid=([^&]+)/i);return as&&(ns=as[1]),as=rs.uri.match(/[:&]doenetid=([^&]+)/i),as&&(is=as[1]),{setValue:{cid:ns,doenetId:is}}}},ts.serializedComponentsForCid={returnDependencies:()=>({cid:{dependencyType:"stateVariable",variableName:"cid"},serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:rs}){var ns;return rs.cid?((ns=rs.serializedChildren)==null?void 0:ns.length)>0?{setValue:{serializedComponentsForCid:rs.serializedChildren}}:{setValue:{serializedComponentsForCid:null}}:{setValue:{serializedComponentsForCid:null}}}},ts.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:rs}){return{setValue:{propName:rs.propName}}}},ts.isPlainMacro={returnDependencies:()=>({isPlainMacro:{dependencyType:"doenetAttribute",attributeName:"isPlainMacro"},targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"},targetSubnames:{dependencyType:"stateVariable",variableName:"targetSubnames"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){var as,os;let is=rs.isPlainMacro&&(!ns.isCompositeComponent({componentType:(as=rs.targetComponent)==null?void 0:as.componentType})||rs.targetSubnames);if(is&&rs.typeAttr){is=!1;let ls=ns.componentTypeLowerCaseMapping[rs.typeAttr.toLowerCase()],us=ns.allComponentClasses[(os=rs.targetComponent)==null?void 0:os.componentType];if(us){let cs=ns.publicStateVariableInfo[us.componentType].stateVariableDescriptions[us.variableForPlainMacro];ls!==us.componentType&&cs&&(cs.createComponentOfType===void 0||cs.createComponentOfType===ls)&&(is=!0)}}return{setValue:{isPlainMacro:is}}}},ts.isPlainCopy={returnDependencies:()=>({isPlainCopy:{dependencyType:"doenetAttribute",attributeName:"isPlainCopy"},targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"},targetSubnames:{dependencyType:"stateVariable",variableName:"targetSubnames"}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){var as,os;let is=rs.isPlainCopy&&(!ns.isCompositeComponent({componentType:(as=rs.targetComponent)==null?void 0:as.componentType})||rs.targetSubnames);if(is&&rs.typeAttr){is=!1;let ls=ns.componentTypeLowerCaseMapping[rs.typeAttr.toLowerCase()],us=ns.allComponentClasses[(os=rs.targetComponent)==null?void 0:os.componentType];if(us){let cs=ns.publicStateVariableInfo[us.componentType].stateVariableDescriptions[us.variableForPlainCopy];ls!==us.componentType&&cs&&(cs.createComponentOfType===void 0||cs.createComponentOfType===ls)&&(is=!0)}}return{setValue:{isPlainCopy:is}}}},ts.linkAttrForDetermineDeps={returnDependencies:()=>({linkAttr:{dependencyType:"attributePrimitive",attributeName:"link"}}),definition({dependencyValues:rs}){let ns;return rs.linkAttr===null?ns=!0:ns=rs.linkAttr,{setValue:{linkAttrForDetermineDeps:ns}}}},ts.replacementSourceIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex","propName","targetSubnames","targetSubnamesComponentIndex","obtainPropFromComposite","linkAttrForDetermineDeps"],additionalStateVariablesDefined:["addLevelToAssignNames"],returnDependencies:function({stateValues:rs,componentInfoObjects:ns}){let is={},as=!1,os=!1;if(rs.targetComponent!==null){if(ns.isCompositeComponent({componentType:rs.targetComponent.componentType,includeNonStandard:!1})&&!(rs.propName&&rs.obtainPropFromComposite))if(rs.linkAttrForDetermineDeps){os=!0;let ls=rs.targetSubnamesComponentIndex;ls&&(ls=[...ls]),is.targets={dependencyType:"replacement",compositeName:rs.targetComponent.componentName,recursive:!0,componentIndex:rs.componentIndex,targetSubnames:rs.targetSubnames,targetSubnamesComponentIndex:ls}}else as=!0;!os&&(rs.componentIndex===null||rs.componentIndex===1)&&(is.targets={dependencyType:"stateVariable",variableName:"targetComponent"})}return is.addLevelToAssignNames={dependencyType:"value",value:as},is},definition({dependencyValues:rs}){let ns=null;return rs.targets&&(ns=rs.targets,Array.isArray(ns)||(ns=[ns])),{setValue:{replacementSourceIdentities:ns,addLevelToAssignNames:rs.addLevelToAssignNames}}}},ts.replacementSources={stateVariablesDeterminingDependencies:["replacementSourceIdentities","propName","propIndex","isPlainMacro","isPlainCopy"],additionalStateVariablesDefined:["effectivePropNameBySource"],returnDependencies:function({stateValues:rs,componentInfoObjects:ns}){let is={replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"},propIndex:{dependencyType:"stateVariable",variableName:"propIndex"}};if(!rs.propName&&rs.propIndex!==null)throw Error("You cannot specify a propIndex without specifying a prop.");if(rs.replacementSourceIdentities!==null)for(let[as,os]of rs.replacementSourceIdentities.entries()){let ls=rs.propName;rs.isPlainMacro?ls=ns.allComponentClasses[os.componentType].variableForPlainMacro:rs.isPlainCopy&&(ls=ns.allComponentClasses[os.componentType].variableForPlainCopy);let us;if(ls){is["propName"+as]={dependencyType:"value",value:ls};let cs=rs.propIndex;cs&&(cs=[...cs]),us={dependencyType:"stateVariable",componentName:os.componentName,variableName:ls,returnAsComponentObject:!0,variablesOptional:!0,propIndex:cs,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}}else us={dependencyType:"componentIdentity",componentName:os.componentName};is["target"+as]=us}return is},definition({dependencyValues:rs}){let ns=null,is=null;if(rs.replacementSourceIdentities!==null){ns=[],is=[];for(let as in rs.replacementSourceIdentities){let os=rs["target"+as];if(os){ns.push(os);let ls;os.stateValues&&(ls=Object.keys(os.stateValues)[0]),!ls&&rs["propName"+as]&&(ls="__prop_name_not_found"),is.push(ls)}}}return{setValue:{replacementSources:ns,effectivePropNameBySource:is}}}},ts.nComponentsSpecified={returnDependencies:()=>({nComponentsAttr:{dependencyType:"attributePrimitive",attributeName:"nComponents"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is;if(rs.typeAttr){if(!(ns.componentTypeLowerCaseMapping[rs.typeAttr.toLowerCase()]in ns.allComponentClasses))throw Error(`Invalid componentType ${rs.typeAttr} of copy.`);rs.nComponentsAttr!==null?is=rs.nComponentsAttr:is=1}else{if(rs.nComponentsAttr!==null)throw Error("You must specify createComponentOfType when specifying nComponents for a copy.");is=null}return{setValue:{nComponentsSpecified:is}}}},ts.link={returnDependencies:()=>({linkAttr:{dependencyType:"attributePrimitive",attributeName:"link"},serializedComponentsForCid:{dependencyType:"stateVariable",variableName:"serializedComponentsForCid"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is;return rs.linkAttr===null?rs.serializedComponentsForCid||rs.replacementSourceIdentities&&rs.replacementSourceIdentities.some(as=>ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"module"}))?is=!1:is=!0:is=rs.linkAttr!==!1,{setValue:{link:is}}}},ts.readyToExpandWhenResolved={stateVariablesDeterminingDependencies:["targetComponent","propName","obtainPropFromComposite","link"],returnDependencies({stateValues:rs,componentInfoObjects:ns}){let is={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"},serializedComponentsForCid:{dependencyType:"stateVariable",variableName:"serializedComponentsForCid"},link:{dependencyType:"stateVariable",variableName:"link"}};return rs.targetComponent&&ns.isCompositeComponent({componentType:rs.targetComponent.componentType,includeNonStandard:!1})&&!(rs.propName&&rs.obtainPropFromComposite)&&(is.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:rs.targetComponent.componentName,variableName:"readyToExpandWhenResolved"}),rs.link||(is.replacementSources={dependencyType:"stateVariable",variableName:"replacementSources"}),is},definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.needsReplacementsUpdatedWhenStale={stateVariablesDeterminingDependencies:["targetComponent","replacementSourceIdentities","effectivePropNameBySource","propName","obtainPropFromComposite","link","removeEmptyArrayEntries"],returnDependencies:function({stateValues:rs,componentInfoObjects:ns}){if(!rs.link)return{};let is={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"},propIndex:{dependencyType:"stateVariable",variableName:"propIndex"}};if(rs.effectivePropNameBySource!==null){for(let[as,os]of rs.effectivePropNameBySource.entries())if(os){let ls=rs.replacementSourceIdentities[as];is["sourceArraySize"+as]={dependencyType:"stateVariableArraySize",componentName:ls.componentName,variableName:os,variablesOptional:!0,caseInsensitiveVariableMatch:!0},is["sourceComponentType"+as]={dependencyType:"stateVariableComponentType",componentName:ls.componentName,variableName:os,variablesOptional:!0,caseInsensitiveVariableMatch:!0}}}return rs.targetComponent!==null&&ns.isCompositeComponent({componentType:rs.targetComponent.componentType,includeNonStandard:!1})&&!(rs.propName&&rs.obtainPropFromComposite)&&(is.allReplacementIdentities={dependencyType:"replacement",compositeName:rs.targetComponent.componentName,recursive:!0,variableNames:["isInactiveCompositeReplacement"]}),rs.removeEmptyArrayEntries&&(is.replacementSources={dependencyType:"stateVariable",variableName:"replacementSources"}),is},markStale(){return{updateReplacements:!0}},definition:()=>({setValue:{needsReplacementsUpdatedWhenStale:!0}})},ts.effectiveAssignNames={returnDependencies:()=>({assignNames:{dependencyType:"doenetAttribute",attributeName:"assignNames"},addLevelToAssignNames:{dependencyType:"stateVariable",variableName:"addLevelToAssignNames"}}),definition({dependencyValues:rs}){let ns=rs.assignNames;return ns&&rs.addLevelToAssignNames&&(ns=[ns]),{setValue:{effectiveAssignNames:ns}}}},ts}static async createSerializedReplacements({component:ts,components:rs,workspace:ns,componentInfoObjects:is,flags:as,resolveItem:os,publicCaseInsensitiveAliasSubstitutions:ls}){var As,ws,Es,Ss,Ds;await ts.stateValues.nComponentsSpecified,ns.numReplacementsBySource=[],ns.numNonStringReplacementsBySource=[],ns.propVariablesCopiedBySource=[],ns.sourceNames=[],ns.uniqueIdentifiersUsedBySource={};let us=(As=ts.attributes.newNamespace)==null?void 0:As.primitive,cs=this.createAttributesObject(),ps=await ts.stateValues.effectiveAssignNames,ds=await ts.stateValues.serializedComponentsForCid;if(ds){let Vs=deepClone([ds[0]]),Is=deepClone(ds.slice(1));if(Vs[0].children){let $s;if(Vs[0].componentName?$s=Vs[0].componentName+"/":$s=Vs[0].originalName+"/",ts.doenetAttributes.keptNewNamespaceOfLastChild){$s=$s.slice(0,$s.length-1);let Rs=$s.lastIndexOf("/");$s=$s.slice(0,Rs+1)}restrictTNamesToNamespace({components:Vs[0].children,namespace:$s,invalidateReferencesToBaseNamespace:ts.doenetAttributes.keptNewNamespaceOfLastChild})}if(Vs[0].componentType==="externalContent")for(let $s of Vs[0].children){if(typeof $s!="object")continue;$s.attributes||($s.attributes={});let Rs=convertAttributesForComponentType({attributes:ts.attributes,componentType:$s.componentType,componentInfoObjects:is,compositeAttributesObj:cs,compositeCreatesNewNamespace:us,flags:as});for(let ks in Rs){let _s=Rs[ks];_s.component?setTNamesToAbsolute([_s.component]):_s.childrenForComponent&&setTNamesToAbsolute(_s.childrenForComponent)}Object.assign($s.attributes,Rs)}else{Vs[0].attributes||(Vs[0].attributes={});let $s=convertAttributesForComponentType({attributes:ts.attributes,componentType:Vs[0].componentType,componentInfoObjects:is,compositeAttributesObj:cs,compositeCreatesNewNamespace:us,flags:as});for(let Rs in $s){let ks=$s[Rs];ks.component?setTNamesToAbsolute([ks.component]):ks.childrenForComponent&&setTNamesToAbsolute(ks.childrenForComponent)}Object.assign(Vs[0].attributes,$s)}return Vs=processAssignNames({assignNames:ps,assignNewNamespaces:(ws=ts.attributes.assignNewNamespaces)==null?void 0:ws.primitive,serializedComponents:Vs,parentName:ts.componentName,parentCreatesNewNamespace:us,componentInfoObjects:is}).serializedComponents,ts.doenetAttributes.fromCopyFromURI&&Is.length>0&&this.addChildrenFromComposite({replacements:Vs,children:Is,assignNewNamespaces:(Es=ts.attributes.assignNewNamespaces)==null?void 0:Es.primitive,componentInfoObjects:is}),{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:Vs,assignNames:ps,workspace:ns,componentInfoObjects:is,compositeAttributesObj:cs,flags:as})).replacements}}let fs=await ts.stateValues.sourceIndex;if(fs!==null){let Is=[{componentType:"number",attributes:convertAttributesForComponentType({attributes:ts.attributes,componentType:"number",componentInfoObjects:is,compositeAttributesObj:cs,compositeCreatesNewNamespace:us,flags:as}),state:{value:fs,fixed:!0}}],Os=processAssignNames({assignNames:ps,serializedComponents:Is,parentName:ts.componentName,parentCreatesNewNamespace:us,componentInfoObjects:is});return{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:Os.serializedComponents,assignNames:ps,workspace:ns,componentInfoObjects:is,compositeAttributesObj:cs,flags:as})).replacements}}let hs=await ts.stateValues.replacementSourceIdentities;if(!await ts.stateValues.targetComponent||!hs){let Vs=[];if(ts.doenetAttributes.fromCopyTarget){let Os=is.componentTypeLowerCaseMapping[ts.attributes.createComponentOfType.primitive.toLowerCase()],Ps=is.allComponentClasses[Os],$s=convertAttributesForComponentType({attributes:ts.attributes,componentType:Os,componentInfoObjects:is,compositeAttributesObj:cs,compositeCreatesNewNamespace:us,flags:as});ns.uniqueIdentifiersUsedBySource[0]=[];let Rs=Os+"|empty",ks=getUniqueIdentifierFromBase(Rs,ns.uniqueIdentifiersUsedBySource[0]),_s=deepClone(ts.serializedChildren);Ps.includeBlankStringChildren||(_s=_s.filter(zs=>typeof zs!="string"||zs.trim()!==""));let Bs=$s;(Ss=ts.attributes.assignNewNamespaces)!=null&&Ss.primitive&&(Bs.newNamespace={primitive:!0}),Vs=[{componentType:Os,attributes:Bs,children:_s,uniqueIdentifier:ks}],Vs=processAssignNames({assignNames:ps,serializedComponents:Vs,parentName:ts.componentName,componentInfoObjects:is,originalNamesAreConsistent:!0}).serializedComponents,ns.numReplacementsBySource.push(Vs.length),ns.numNonStringReplacementsBySource.push(Vs.filter(zs=>typeof zs!="string").length)}return{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:Vs,assignNames:ps,workspace:ns,componentInfoObjects:is,compositeAttributesObj:cs})).replacements}}let ys=await os({componentName:ts.componentName,type:"determineDependencies",stateVariable:"replacementSources",dependency:"__determine_dependencies",expandComposites:!1});if(!ys.success)throw Error(`Couldn't resolve determineDependencies of replacementSources of ${ts.componentName}`);let gs=await ts.stateValues.effectivePropNameBySource;for(let Vs in hs)if(gs[Vs]&&(ys=await os({componentName:ts.componentName,type:"recalculateDownstreamComponents",stateVariable:"replacementSources",dependency:"target"+Vs,expandComposites:!1}),!ys.success))throw Error(`Couldn't resolve recalculateDownstreamComponents for target${Vs} of replacementSources of ${ts.componentName}`);let bs=[],vs=[],Ns=[],Ts=0,Cs=0;for(let Vs in hs){let Is=ns.uniqueIdentifiersUsedBySource[Vs]=[],Os;if((Ds=ts.attributes.createComponentOfType)!=null&&Ds.primitive){let Rs=await ts.stateValues.nComponentsSpecified,ks=hs.length;Os=Math.floor(Rs/ks);let _s=Rs%ks;Vs<_s&&Os++}let Ps=await this.createReplacementForSource({component:ts,sourceNum:Vs,components:rs,numReplacementsSoFar:Ts,numNonStringReplacementsSoFar:Cs,uniqueIdentifiersUsed:Is,compositeAttributesObj:cs,componentInfoObjects:is,nComponentsForSource:Os,publicCaseInsensitiveAliasSubstitutions:ls,flags:as,fromCopyTarget:Number(Vs)===0&&ts.doenetAttributes.fromCopyTarget});ns.propVariablesCopiedBySource[Vs]=Ps.propVariablesCopiedByReplacement;let $s=Ps.serializedReplacements;vs[Vs]=$s.length,Ns[Vs]=$s.filter(Rs=>typeof Rs!="string").length,Ts+=vs[Vs],Cs+=Ns[Vs],bs.push(...$s)}return ns.numReplacementsBySource=vs,ns.numNonStringReplacementsBySource=Ns,ns.sourceNames=hs.map(Vs=>Vs.componentName),{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:bs,assignNames:ps,workspace:ns,componentInfoObjects:is,compositeAttributesObj:cs,flags:as})).replacements}}static async createReplacementForSource({component:ts,sourceNum:rs,components:ns,numReplacementsSoFar:is,numNonStringReplacementsSoFar:as,uniqueIdentifiersUsed:os,compositeAttributesObj:ls,componentInfoObjects:us,nComponentsForSource:cs,publicCaseInsensitiveAliasSubstitutions:ps,flags:ds,fromCopyTarget:fs}){var ws,Es,Ss,Ds,Vs,Is;let hs=(await ts.stateValues.replacementSourceIdentities)[rs];if(typeof hs!="object")return{serializedReplacements:[hs]};let ys=ns[hs.componentName],gs=await ts.stateValues.link;(!gs||await ts.stateValues.removeEmptyArrayEntries)&&(hs=(await ts.stateValues.replacementSources)[rs]);let bs=(ws=ts.attributes.newNamespace)==null?void 0:ws.primitive,vs=await ts.stateValues.effectiveAssignNames,Ns=(await ts.stateValues.effectivePropNameBySource)[rs];if(Ns){let Os=await replacementFromProp({component:ts,components:ns,replacementSource:hs,propName:Ns,numReplacementsSoFar:is,numNonStringReplacementsSoFar:as,uniqueIdentifiersUsed:os,compositeAttributesObj:ls,componentInfoObjects:us,nComponentsForSource:cs,publicCaseInsensitiveAliasSubstitutions:ps,flags:ds});return{serializedReplacements:processAssignNames({assignNames:vs,serializedComponents:Os.serializedReplacements,parentName:ts.componentName,parentCreatesNewNamespace:bs,indOffset:as,componentInfoObjects:us}).serializedComponents,propVariablesCopiedByReplacement:Os.propVariablesCopiedByReplacement}}let Ts=await ts.stateValues.sourceAttributesToIgnore,Cs=await ts.stateValues.sourceAttributesToIgnoreRecursively,xs=[await ys.serialize({copyAll:!gs,copyVariants:!gs,sourceAttributesToIgnore:Ts,sourceAttributesToIgnoreRecursively:Cs})];!gs&&((Es=xs[0].state)==null?void 0:Es.fixed)!==void 0&&delete xs[0].state.fixed,xs=postProcessCopy({serializedComponents:xs,componentName:ts.componentName,uniqueIdentifiersUsed:os,addShadowDependencies:gs,unlinkExternalCopies:!gs}),xs.length>0&&delete xs[0].doenetAttributes.haveNewNamespaceOnlyFromShadow;for(let Os of xs){if(typeof Os!="object")continue;Os.attributes||(Os.attributes={});let Ps=convertAttributesForComponentType({attributes:ts.attributes,componentType:Os.componentType,componentInfoObjects:us,compositeAttributesObj:ls,compositeCreatesNewNamespace:bs,flags:ds});Object.assign(Os.attributes,Ps)}return(Ss=xs[0].attributes.newNamespace)!=null&&Ss.primitive&&!((Ds=ts.attributes.assignNewNamespaces)!=null&&Ds.primitive)&&(xs[0].doenetAttributes.haveNewNamespaceOnlyFromShadow=!0),xs=processAssignNames({assignNames:vs,assignNewNamespaces:(Vs=ts.attributes.assignNewNamespaces)==null?void 0:Vs.primitive,serializedComponents:xs,parentName:ts.componentName,parentCreatesNewNamespace:bs,indOffset:as,componentInfoObjects:us,originalNamesAreConsistent:bs&&!vs}).serializedComponents,fs&&xs.length===1&&ts.serializedChildren.length>0&&this.addChildrenFromComposite({replacements:xs,children:ts.serializedChildren,assignNewNamespaces:(Is=ts.attributes.assignNewNamespaces)==null?void 0:Is.primitive,componentInfoObjects:us}),{serializedReplacements:xs}}static addChildrenFromComposite({replacements:ts,children:rs,assignNewNamespaces:ns,componentInfoObjects:is}){var cs,ps;let as=ts[0];as.children||(as.children=[]);let os=deepClone(rs);if(is.allComponentClasses[as.componentType].includeBlankStringChildren||(os=os.filter(ds=>typeof ds!="string"||ds.trim()!=="")),(cs=ts[0].attributes.newNamespace)!=null&&cs.primitive&&ns){let ds=countRegularComponentTypesInNamespace(as.children);renameAutonameBasedOnNewCounts(os,ds)}let us=processAssignNames({serializedComponents:os,parentName:ts[0].componentName,parentCreatesNewNamespace:ns,componentInfoObjects:is,originalNamesAreConsistent:!0});if((ps=ts[0].attributes.newNamespace)!=null&&ps.primitive&&!ns)for(let ds of us.serializedComponents)typeof ds=="object"&&(ds.doenetAttributes.ignoreParentNewNamespace=!0);as.children.push(...us.serializedComponents)}static async calculateReplacementChanges({component:ts,componentChanges:rs,components:ns,workspace:is,componentInfoObjects:as,flags:os,resolveItem:ls,publicCaseInsensitiveAliasSubstitutions:us}){var Es;if(await ts.stateValues.serializedComponentsForCid)return[];if(await ts.stateValues.sourceIndex!==null)return[];let cs=this.createAttributesObject(),ps=await ts.stateValues.effectiveAssignNames,ds=await ts.stateValues.replacementSourceIdentities;if(!await ts.stateValues.targetComponent||!ds){if(await ts.stateValues.targetSources)return[];{let Ss=[];if(ts.replacements.length>0){let Is={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:ts.replacements.length};Ss.push(Is)}let Ds=is.sourceNames.length===0;is.sourceNames=[],is.numReplacementsBySource=[],is.numNonStringReplacementsBySource=[],is.propVariablesCopiedBySource=[];let Vs=await verifyReplacementsMatchSpecifiedType({component:ts,replacementChanges:Ss,assignNames:ps,workspace:is,componentInfoObjects:as,compositeAttributesObj:cs,flags:os});return Ds?[]:Vs.replacementChanges}}if(await ts.stateValues.targetInactive){let Ss=[],Ds=ts.replacements.length;if(Ds>0){if(ts.replacementsToWithhold!==Ds){let Is={changeType:"changeReplacementsToWithhold",replacementsToWithhold:Ds};Ss.push(Is)}Ss=(await verifyReplacementsMatchSpecifiedType({component:ts,replacementChanges:Ss,assignNames:ps,workspace:is,componentInfoObjects:as,compositeAttributesObj:cs,flags:os})).replacementChanges}return Ss}let fs=await ls({componentName:ts.componentName,type:"determineDependencies",stateVariable:"replacementSources",dependency:"__determine_dependencies",expandComposites:!1});if(!fs.success)throw Error(`Couldn't resolve determineDependencies of replacementSources of ${ts.componentName}`);let hs=await ts.stateValues.effectivePropNameBySource;for(let Ss in ds)if(hs[Ss]&&(fs=await ls({componentName:ts.componentName,type:"recalculateDownstreamComponents",stateVariable:"replacementSources",dependency:"target"+Ss,expandComposites:!1}),!fs.success))throw Error(`Couldn't resolve recalculateDownstreamComponents for target${Ss} of replacementSources of ${ts.componentName}`);let ys=[];if(ts.replacementsToWithhold>0){let Ss={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};ys.push(Ss)}let gs=0,bs=0,vs=[],Ns=[],Ts=[],Cs=Math.max(ds.length,is.numReplacementsBySource.length),xs=!1;for(let Ss=0;Ss<Cs;Ss++){let Ds;if((Es=ts.attributes.createComponentOfType)!=null&&Es.primitive){let zs=await ts.stateValues.nComponentsSpecified,Hs=ds.length;Ds=Math.floor(zs/Hs);let el=zs%Hs;Ss<el&&Ds++}let Vs=ds[Ss];if(Vs===void 0){if(is.numReplacementsBySource[Ss]>0){if(!xs){let zs=is.numReplacementsBySource.slice(Ss).reduce((Hs,el)=>Hs+el,0);if(zs>0){let Hs={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:gs,numberReplacementsToDelete:zs};ys.push(Hs)}xs=!0,is.numReplacementsBySource.slice(Ss).forEach((Hs,el)=>is.numReplacementsBySource[el]=0),is.numNonStringReplacementsBySource.slice(Ss).forEach((Hs,el)=>is.numNonStringReplacementsBySource[el]=0)}is.uniqueIdentifiersUsedBySource[Ss]=[]}vs[Ss]=0,Ns[Ss]=0,Ts.push([]);continue}let Is=is.sourceNames[Ss],Os=Is===void 0||Vs.componentName!==Is||xs;if(!Os)for(let zs=0;zs<is.numReplacementsBySource[Ss];zs++){let Hs=ts.replacements[gs+zs];if(Hs){if(!hs[Ss]&&Hs.shadows&&Hs.shadows.componentName!==ds[Ss].componentName){Os=!0;break}}else{Os=!0;break}}if(Os){let zs=0;Ss in is.numReplacementsBySource&&(zs=is.numReplacementsBySource[Ss]);let Hs=zs;xs&&(Hs=0);let el=is.uniqueIdentifiersUsedBySource[Ss]=[],Ys=await this.recreateReplacements({component:ts,sourceNum:Ss,numReplacementsSoFar:gs,numNonStringReplacementsSoFar:bs,numReplacementsToDelete:Hs,components:ns,uniqueIdentifiersUsed:el,compositeAttributesObj:cs,componentInfoObjects:as,nComponentsForSource:Ds,publicCaseInsensitiveAliasSubstitutions:us,flags:os});gs+=Ys.numReplacements,bs+=Ys.numNonStringReplacements,vs[Ss]=Ys.numReplacements,Ns[Ss]=Ys.numNonStringReplacements,Ts[Ss]=Ys.propVariablesCopiedByReplacement;let il=Ys.replacementInstruction;if(!xs&&Ys.numReplacements!==zs){let al=is.numReplacementsBySource.slice(Ss).reduce((ll,nl)=>ll+nl,0);il.numberReplacementsToReplace=al,xs=!0,is.numReplacementsBySource.slice(Ss).forEach((ll,nl)=>is.numReplacementsBySource[nl]=0),is.numNonStringReplacementsBySource.slice(Ss).forEach((ll,nl)=>is.numNonStringReplacementsBySource[nl]=0)}ys.push(il);continue}if(!hs[Ss]&&is.numReplacementsBySource[Ss]>0){gs+=is.numReplacementsBySource[Ss],bs+=is.numNonStringReplacementsBySource[Ss],vs[Ss]=is.numReplacementsBySource[Ss],Ns[Ss]=is.numNonStringReplacementsBySource[Ss];continue}let Ps=is.uniqueIdentifiersUsedBySource[Ss]=[],$s=await this.createReplacementForSource({component:ts,sourceNum:Ss,components:ns,numReplacementsSoFar:gs,numNonStringReplacementsSoFar:bs,uniqueIdentifiersUsed:Ps,compositeAttributesObj:cs,componentInfoObjects:as,nComponentsForSource:Ds,publicCaseInsensitiveAliasSubstitutions:us,flags:os}),Rs=$s.propVariablesCopiedByReplacement,ks=$s.serializedReplacements,_s=ks.length,Bs=is.numReplacementsBySource[Ss];if(_s!==Bs){let zs=is.numReplacementsBySource.slice(Ss).reduce((el,Ys)=>el+Ys,0),Hs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:gs,numberReplacementsToReplace:zs,serializedReplacements:ks,assignNamesOffset:bs};ys.push(Hs),xs=!0,is.numReplacementsBySource.slice(Ss).forEach((el,Ys)=>is.numReplacementsBySource[Ys]=0),is.numNonStringReplacementsBySource.slice(Ss).forEach((el,Ys)=>is.numNonStringReplacementsBySource[Ys]=0)}else{let zs=0;for(let Hs=0;Hs<_s;Hs++){let el=Rs[Hs].length!==is.propVariablesCopiedBySource[Ss][Hs].length,Ys=!el;if(el||(is.propVariablesCopiedBySource[Ss][Hs].some((il,al)=>il!==Rs[Hs][al])?(Ys=!1,el=!0):ts.replacements[gs+Hs].componentType!==ks[Hs].componentType&&(el=!0)),Hs==0&&el&&Ys&&await ts.stateValues.nComponentsSpecified===1&&_s===1&&!(ts.replacementsToWithhold>0)&&is.sourceNames.length===1&&(el=!1),el){let il={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:gs+Hs,numberReplacementsToReplace:1,serializedReplacements:[ks[Hs]],assignNamesOffset:bs+zs};ys.push(il)}typeof ks[Hs]!="string"&&zs++}}let Us=ks.filter(zs=>typeof zs!="string").length;gs+=_s,bs+=Us,vs[Ss]=_s,Ns[Ss]=Us,Ts[Ss]=Rs}let As=is.sourceNames.length===0;is.numReplacementsBySource=vs,is.numNonStringReplacementsBySource=Ns,is.sourceNames=ds.map(Ss=>Ss.componentName),is.propVariablesCopiedBySource=Ts;let ws=await verifyReplacementsMatchSpecifiedType({component:ts,replacementChanges:ys,assignNames:ps,workspace:is,componentInfoObjects:as,compositeAttributesObj:cs,flags:os});return As&&is.sourceNames.length===0?[]:ws.replacementChanges}static async recreateReplacements({component:ts,sourceNum:rs,numReplacementsSoFar:ns,numNonStringReplacementsSoFar:is,numReplacementsToDelete:as,uniqueIdentifiersUsed:os,components:ls,compositeAttributesObj:us,componentInfoObjects:cs,nComponentsForSource:ps,publicCaseInsensitiveAliasSubstitutions:ds,flags:fs}){let hs=await this.createReplacementForSource({component:ts,sourceNum:rs,numReplacementsSoFar:ns,numNonStringReplacementsSoFar:is,components:ls,uniqueIdentifiersUsed:os,compositeAttributesObj:us,componentInfoObjects:cs,nComponentsForSource:ps,publicCaseInsensitiveAliasSubstitutions:ds,flags:fs}),ys=hs.propVariablesCopiedByReplacement,gs=hs.serializedReplacements,bs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ns,numberReplacementsToReplace:as,serializedReplacements:gs,assignNamesOffset:is};return{numReplacements:gs.length,numNonStringReplacements:gs.filter(vs=>typeof vs!="string").length,propVariablesCopiedByReplacement:ys,replacementInstruction:bs}}}Ms(Copy,"componentType","copy"),Ms(Copy,"assignNamesToReplacements",!0),Ms(Copy,"acceptTarget",!0),Ms(Copy,"acceptAnyAttribute",!0),Ms(Copy,"includeBlankStringChildren",!0),Ms(Copy,"stateVariableToEvaluateAfterReplacements","needsReplacementsUpdatedWhenStale");async function replacementFromProp({component:ss,components:ts,replacementSource:rs,propName:ns,uniqueIdentifiersUsed:is,compositeAttributesObj:as,componentInfoObjects:os,nComponentsForSource:ls,publicCaseInsensitiveAliasSubstitutions:us,flags:cs}){var Ts,Cs,xs,As,ws,Es,Ss,Ds,Vs,Is;let ps=[],ds=[],fs=(Ts=ss.attributes.newNamespace)==null?void 0:Ts.primitive,hs=-1,ys=ts[rs.componentName],gs=us({stateVariables:[ns],componentClass:ys.constructor})[0];if(gs===void 0||gs.slice(0,12)==="__not_public")return ns!=="__prop_name_not_found"&&console.warn(`Could not find prop ${ns} on a component of type ${rs.componentType}`),{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let bs=ys.state[gs],vs=await bs.value,Ns=await ss.stateValues.link;if(bs.isArray||bs.isArrayEntry){let Os,Ps,$s,Rs;if(bs.isArray?(Os=bs,$s=await bs.arraySize,Ps=bs.getAllArrayKeys($s,!1)):(Os=ys.state[bs.arrayStateVariable],Ps=await bs.unflattenedArrayKeys,Rs=await bs.arrayKeys),(Cs=Os.shadowingInstructions)!=null&&Cs.hasVariableComponentType&&(await ss.stateValues.replacementSources,!Os.shadowingInstructions.createComponentOfType))return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let ks=bs.wrappingComponents,_s=ks.length,Bs=ls;if(bs.isArray)Bs=$s.slice(0,$s.length-_s).reduce((Us,zs)=>Us*zs,1);else if(Rs.length===0)Bs=0;else if(_s===0)Bs=Rs.length;else if(_s>=bs.nDimensions)Bs=1;else if(_s===bs.nDimensions-1)Bs=Ps.length;else{let Us=bs.nDimensions-_s-1;Bs=flattenLevels(Ps,Us).length}if(_s===0){let Us=flattenDeep(Ps);for(let zs=0;zs<Bs;zs++){let Hs=Us[zs];if(await ss.stateValues.removeEmptyArrayEntries){if(!Hs)continue;let il=Os.keyToIndex(Hs);Array.isArray(il)||(il=[il]);let al=await Os.value;for(let ll of il)al=al[ll];if(al==null)continue}hs++;let el=ds[hs]=[],Ys=Os.shadowingInstructions.createComponentOfType;if(Array.isArray(Ys)&&(Ys[Os.keyToIndex(Hs)]?Ys=Ys[Os.keyToIndex(Hs)]:Ys=Ys[0]),Hs){let il=Os.arrayVarNameFromArrayKey(Hs);el.push(il);let al=rs.componentName+"|shadow|"+il,ll=getUniqueIdentifierFromBase(al,is),nl=convertAttributesForComponentType({attributes:ss.attributes,componentType:Ys,componentInfoObjects:os,compositeAttributesObj:as,compositeCreatesNewNamespace:fs,flags:cs}),cl;if(Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables){cl={};for(let sl in Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let js=Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables[sl].stateVariableToShadow,Ls=ys.state[js];Ls.isArray&&(js=Ls.arrayVarNameFromArrayKey(Hs)),cl[sl]={stateVariableToShadow:js}}}let dl;if(Os.shadowingInstructions.addStateVariablesShadowingStateVariables){dl={};for(let sl in Os.shadowingInstructions.addStateVariablesShadowingStateVariables){let js=Os.shadowingInstructions.addStateVariablesShadowingStateVariables[sl].stateVariableToShadow,Ls=ys.state[js];Ls.isArray&&(js=Ls.arrayVarNameFromArrayKey(Hs)),dl[sl]={stateVariableToShadow:js}}}if(Ns){let sl={};if(cl){let Ls=os.allComponentClasses[Ys].createAttributesObject();for(let Ws in cl){let Zs=cl[Ws].stateVariableToShadow,rl={componentType:Ls[Ws].createComponentOfType,downstreamDependencies:{[ys.componentName]:[{compositeName:ss.componentName,dependencyType:"referenceShadow",propVariable:Zs}]}};sl[Ws]={component:rl}}}Object.assign(sl,nl),ps.push({componentType:Ys,attributes:sl,downstreamDependencies:{[rs.componentName]:[{dependencyType:"referenceShadow",compositeName:ss.componentName,propVariable:il,additionalStateVariableShadowing:dl}]},uniqueIdentifier:ll})}else{let sl={};if(cl){let rl={};for(let Gs in cl){let Xs=cl[Gs].stateVariableToShadow,Ks=ys.state[Xs],ol=await Ks.value;Ks.isArray&&(ol=ol[Ks.keyToIndex[Hs]]),ys.state[Xs].usedDefault||(rl[Gs]=ol)}let qs=convertAttributesForComponentType({attributes:rl,componentType:Ys,componentInfoObjects:os,flags:cs});if(bs.shadowingInstructions.attributesToShadow)for(let Gs of bs.shadowingInstructions.attributesToShadow)(xs=ys.attributes[Gs])!=null&&xs.component?qs[Gs]={component:await((As=ys.attributes[Gs])==null?void 0:As.component.serialize({copyAll:!0,copyVariants:!0}))}:((ws=ys.attributes[Gs])==null?void 0:ws.primitive)!==void 0&&(qs[Gs]={primitive:JSON.parse(JSON.stringify(ys.attributes[Gs].primitive))});Object.assign(sl,qs)}Object.assign(sl,nl);let js="value",Ls=os.allComponentClasses[Ys];Ls.primaryEssentialStateVariable?js=Ls.primaryEssentialStateVariable:Ls.primaryStateVariableForDefinition&&(js=Ls.primaryStateVariableForDefinition);let Ws=Os.keyToIndex(Hs);Array.isArray(Ws)||(Ws=[Ws]);let Zs=await Os.value;for(let rl of Ws)Zs=Zs[rl];let tl={componentType:Ys,attributes:sl,state:{[js]:Zs},uniqueIdentifier:ll};ps.push(tl)}}else{let il=Ys+"|empty",al=getUniqueIdentifierFromBase(il,is);ps.push({componentType:Ys,uniqueIdentifier:al})}}}else{let Us=async function(el,Ys){var nl,cl,dl;let il=[],al=[];if(Ys>1)for(let sl of el){let js=await Us(sl,Ys-1);il.push(...js.pieces),al.push(...js.propVariablesCopiedByPiece)}else for(let sl of el){let js=Os.arrayVarNameFromArrayKey(sl),Ls=[js],Ws=rs.componentName+"|shadow|"+js,Zs=getUniqueIdentifierFromBase(Ws,is),tl=Os.shadowingInstructions.createComponentOfType;Array.isArray(tl)&&(tl=tl[Os.keyToIndex(sl)]);let rl;if(Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables){rl={};for(let Gs in Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let Xs=Os.shadowingInstructions.addAttributeComponentsShadowingStateVariables[Gs].stateVariableToShadow,Ks=ys.state[Xs];Ks.isArray&&(Xs=Ks.arrayVarNameFromArrayKey(sl)),rl[Gs]={stateVariableToShadow:Xs}}}let qs;if(Os.shadowingInstructions.addStateVariablesShadowingStateVariables){qs={};for(let Gs in Os.shadowingInstructions.addStateVariablesShadowingStateVariables){let Xs=Os.shadowingInstructions.addStateVariablesShadowingStateVariables[Gs].stateVariableToShadow,Ks=ys.state[Xs];Ks.isArray&&(Xs=Ks.arrayVarNameFromArrayKey(sl)),qs[Gs]={stateVariableToShadow:Xs}}}if(Ns){let Gs={};if(rl){let Ks=os.allComponentClasses[tl].createAttributesObject();for(let ol in rl){let Fs=rl[ol].stateVariableToShadow,Js={componentType:Ks[ol].createComponentOfType,downstreamDependencies:{[ys.componentName]:[{compositeName:ss.componentName,dependencyType:"referenceShadow",propVariable:Fs}]}};Gs[ol]={component:Js}}}il.push({componentType:tl,attributes:Gs,downstreamDependencies:{[rs.componentName]:[{dependencyType:"referenceShadow",compositeName:ss.componentName,propVariable:js,additionalStateVariableShadowing:qs}]},uniqueIdentifier:Zs})}else{let Gs={};if(rl){let Js={};for(let pl in rl){let ml=rl[pl].stateVariableToShadow,fl=ys.state[ml],hl=await fl.value;fl.isArray&&(hl=hl[fl.keyToIndex[sl]]),ys.state[ml].usedDefault||(Js[pl]=hl)}let ul=convertAttributesForComponentType({attributes:Js,componentType:tl,componentInfoObjects:os,flags:cs});if(bs.shadowingInstructions.attributesToShadow)for(let pl of bs.shadowingInstructions.attributesToShadow)(nl=ys.attributes[pl])!=null&&nl.component?ul[pl]={component:await((cl=ys.attributes[pl])==null?void 0:cl.component.serialize({copyAll:!0,copyVariants:!0}))}:((dl=ys.attributes[pl])==null?void 0:dl.primitive)!==void 0&&(ul[pl]={primitive:JSON.parse(JSON.stringify(ys.attributes[pl].primitive))});Object.assign(Gs,ul)}let Xs="value",Ks=os.allComponentClasses[tl];Ks.primaryEssentialStateVariable?Xs=Ks.primaryEssentialStateVariable:Ks.primaryStateVariableForDefinition&&(Xs=Ks.primaryStateVariableForDefinition);let ol=Os.keyToIndex(sl);Array.isArray(ol)||(ol=[ol]);let Fs=await Os.value;for(let Js of ol)Fs=Fs[Js];let Qs={componentType:tl,attributes:Gs,state:{[Xs]:Fs},uniqueIdentifier:Zs};il.push(Qs)}al.push(Ls)}let ll=ks[Ys-1];if(il.length>0&&ll&&ll.length>0){for(let sl=ll.length-1;sl>=0;sl--){let js=typeof ll[sl]=="object"?ll[sl].componentType:ll[sl],Ls=js+"|wrapper",Ws=getUniqueIdentifierFromBase(Ls,is),Zs=[],tl={};for(let rl of il)if(rl.isAttribute){let qs=rl.isAttribute;delete rl.isAttribute,tl[qs]={component:rl}}else Zs.push(rl);il=[{componentType:js,children:Zs,attributes:tl,uniqueIdentifier:Ws,skipSugar:!0}],typeof ll[sl]=="object"&&(ll[sl].doenetAttributes&&(il[0].doenetAttributes=Object.assign({},ll[sl].doenetAttributes)),ll[sl].isAttribute&&(il[0].isAttribute=ll[sl].isAttribute))}al=[flattenDeep(al)]}return{pieces:il,propVariablesCopiedByPiece:al}},zs=await Us(Ps,bs.nDimensions),Hs=zs.pieces;ds=zs.propVariablesCopiedByPiece;for(let el of Hs){if(typeof el!="object")continue;el.attributes||(el.attributes={});let Ys=convertAttributesForComponentType({attributes:ss.attributes,componentType:el.componentType,componentInfoObjects:os,compositeAttributesObj:as,compositeCreatesNewNamespace:fs,flags:cs});Object.assign(el.attributes,Ys),Ns&&(el.downstreamDependencies={[rs.componentName]:[{dependencyType:"referenceShadow",compositeName:ss.componentName,propVariable:gs,ignorePrimaryStateVariable:!0}]})}if(hs+=Hs.length,ps.push(...Hs),Hs.length<Bs)for(let el=Hs.length;el<Bs;el++){hs++,ds[hs]=[];let Ys,il=ks[0],al;il&&il.length>0?typeof il[0]=="object"?(Ys=il[0].componentType,al=Object.assign({},il[0].doenetAttributes)):Ys=il[0]:(Ys=Os.shadowingInstructions.createComponentOfType,Array.isArray(Ys)&&(bs.isArrayEntry?Ys=Ys[Os.keyToIndex(Rs[el])]:Ys=Ys[el]));let ll=Ys+"|empty",nl=getUniqueIdentifierFromBase(ll,is),cl={componentType:Ys,uniqueIdentifier:nl};al&&(cl.doenetAttributes=al),ps.push(cl)}else if(Hs>Bs)throw Error(`Something went wrong when creating replacements for ${ss.componentName} as we ended up with too many replacements`)}}else{if((Es=bs.shadowingInstructions)!=null&&Es.hasVariableComponentType&&await bs.value,!((Ss=bs.shadowingInstructions)!=null&&Ss.createComponentOfType))return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};hs++,(ds[hs]=[]).push(gs);let Ps=ys.componentName+"|shadow|"+gs,$s=getUniqueIdentifierFromBase(Ps,is);if(bs.shadowingInstructions.createComponentOfType==="string")ps.push(await bs.value);else{let Rs=convertAttributesForComponentType({attributes:ss.attributes,componentType:bs.shadowingInstructions.createComponentOfType,componentInfoObjects:os,compositeAttributesObj:as,compositeCreatesNewNamespace:fs,flags:cs});if(Ns){let ks={};if(bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let Bs=os.allComponentClasses[bs.shadowingInstructions.createComponentOfType].createAttributesObject();for(let Us in bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let zs=bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables[Us].stateVariableToShadow,el={componentType:Bs[Us].createComponentOfType,downstreamDependencies:{[ys.componentName]:[{compositeName:ss.componentName,dependencyType:"referenceShadow",propVariable:zs}]}};ks[Us]={component:el}}}Object.assign(ks,Rs),ps.push({componentType:bs.shadowingInstructions.createComponentOfType,attributes:ks,downstreamDependencies:{[ys.componentName]:[{dependencyType:"referenceShadow",compositeName:ss.componentName,propVariable:gs,additionalStateVariableShadowing:bs.shadowingInstructions.addStateVariablesShadowingStateVariables}]},uniqueIdentifier:$s})}else{let ks={};if(bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let zs={};for(let el in bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables)if(el!=="fixed"){let Ys=bs.shadowingInstructions.addAttributeComponentsShadowingStateVariables[el].stateVariableToShadow,il=await ys.state[Ys].value;ys.state[Ys].usedDefault||(zs[el]=il)}let Hs=convertAttributesForComponentType({attributes:zs,componentType:bs.shadowingInstructions.createComponentOfType,componentInfoObjects:os,flags:cs});if(bs.shadowingInstructions.attributesToShadow)for(let el of bs.shadowingInstructions.attributesToShadow)(Ds=ys.attributes[el])!=null&&Ds.component?Hs[el]={component:await((Vs=ys.attributes[el])==null?void 0:Vs.component.serialize({copyAll:!0,copyVariants:!0}))}:((Is=ys.attributes[el])==null?void 0:Is.primitive)!==void 0&&(Hs[el]={primitive:JSON.parse(JSON.stringify(ys.attributes[el].primitive))});Object.assign(ks,Hs)}Object.assign(ks,Rs);let _s="value",Bs=os.allComponentClasses[bs.shadowingInstructions.createComponentOfType];Bs.primaryEssentialStateVariable?_s=Bs.primaryEssentialStateVariable:Bs.primaryStateVariableForDefinition&&(_s=Bs.primaryStateVariableForDefinition);let Us={componentType:bs.shadowingInstructions.createComponentOfType,attributes:ks,state:{[_s]:vs},uniqueIdentifier:$s};ps.push(Us)}}}return{serializedReplacements:ps,propVariablesCopiedByReplacement:ds}}class Extract extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.disabled,delete ts.modifyIndirectly,delete ts.fixed,delete ts.styleNumber,delete ts.isResponse,ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.prop={createPrimitiveOfType:"string"},ts.createComponentOfType={createPrimitiveOfType:"string"},ts.nComponents={createPrimitiveOfType:"number"},ts.componentIndex={createComponentOfType:"integer",createStateVariable:"componentIndex",defaultValue:null,public:!0},ts.propIndex={createComponentOfType:"numberList",createStateVariable:"propIndex",defaultValue:null,public:!0},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nComponentsSpecified={returnDependencies:()=>({nComponentsAttr:{dependencyType:"attributePrimitive",attributeName:"nComponents"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is;if(rs.typeAttr){if(!(ns.componentTypeLowerCaseMapping[rs.typeAttr.toLowerCase()]in ns.allComponentClasses))throw Error(`Invalid componentType ${rs.typeAttr} of copy.`);rs.nComponentsAttr!==null?is=rs.nComponentsAttr:is=1}else{if(rs.nComponentsAttr!==null)throw Error("You must specify createComponentOfType when specifying nComponents for a copy.");is=null}return{setValue:{nComponentsSpecified:is}}}},ts.link={returnDependencies:()=>({}),definition:()=>({setValue:{link:!0}})},ts.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:rs}){return{setValue:{propName:rs.propName}}}},ts.sourceComponents={stateVariablesDeterminingDependencies:["propName","componentIndex","propIndex"],additionalStateVariablesDefined:["effectivePropNameBySource"],returnDependencies:function({stateValues:rs}){let ns,is;rs.componentIndex!==null&&(is=Number(rs.componentIndex),Number.isInteger(is)?ns=[is-1]:ns=[]);let as=rs.propIndex;return as&&(as=[...as]),{children:{dependencyType:"child",childGroups:["anything"],variableNames:[rs.propName],variablesOptional:!0,childIndices:ns,propIndex:as,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0},propName:{dependencyType:"stateVariable",variableName:"propName"}}},definition:function({dependencyValues:rs}){let ns=rs.children,is=[];for(let as of ns){let os;as.stateValues&&(os=Object.keys(as.stateValues)[0]),os||(os="__prop_name_not_found"),is.push(os)}return{setValue:{sourceComponents:ns,effectivePropNameBySource:is}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({replacementClasses:{dependencyType:"stateVariable",variableName:"sourceComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.needsReplacementsUpdatedWhenStale={returnDependencies(){return{sourceComponents:{dependencyType:"stateVariable",variableName:"sourceComponents"}}},markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{needsReplacementsUpdatedWhenStale:!0}})},ts}static async createSerializedReplacements({component:ts,components:rs,workspace:ns,componentInfoObjects:is,flags:as,publicCaseInsensitiveAliasSubstitutions:os}){let ls=[],us=[],cs=0;ns.propVariablesCopiedBySource=[],ns.uniqueIdentifiersUsedBySource={};let ps=this.createAttributesObject(),ds=await ts.stateValues.sourceComponents;for(let hs=0;hs<ds.length;hs++)if(ds[hs]!==void 0){let ys=ns.uniqueIdentifiersUsedBySource[hs]=[],gs=await this.createReplacementForSource({component:ts,sourceNum:hs,components:rs,numReplacementsSoFar:cs,uniqueIdentifiersUsed:ys,componentInfoObjects:is,compositeAttributesObj:ps,publicCaseInsensitiveAliasSubstitutions:os});ns.propVariablesCopiedBySource[hs]=gs.propVariablesCopiedByReplacement;let bs=gs.serializedReplacements;us[hs]=bs.length,cs+=bs.length,ls.push(...bs)}else us[hs]=0;return ns.numReplacementsBySource=us,ns.numNonStringReplacementsBySource=[...us],ns.sourceNames=ds.map(hs=>hs.componentName),{replacements:(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:ls,assignNames:ts.doenetAttributes.assignNames,workspace:ns,componentInfoObjects:is,compositeAttributesObj:ps,flags:as})).replacements}}static async createReplacementForSource({component:ts,components:rs,sourceNum:ns,numReplacementsSoFar:is,uniqueIdentifiersUsed:as,componentInfoObjects:os,compositeAttributesObj:ls,publicCaseInsensitiveAliasSubstitutions:us}){var gs;let cs=(await ts.stateValues.effectivePropNameBySource)[ns],ps=await replacementFromProp({component:ts,components:rs,replacementSource:(await ts.stateValues.sourceComponents)[ns],propName:cs,uniqueIdentifiersUsed:as,compositeAttributesObj:ls,componentInfoObjects:os,publicCaseInsensitiveAliasSubstitutions:us}),ds=ps.serializedReplacements,fs=ps.propVariablesCopiedByReplacement,hs=(gs=ts.attributes.newNamespace)==null?void 0:gs.primitive;return ds=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:ds,parentName:ts.componentName,indOffset:is,parentCreatesNewNamespace:hs,componentInfoObjects:os}).serializedComponents,{serializedReplacements:ds,propVariablesCopiedByReplacement:fs}}static async calculateReplacementChanges({component:ts,components:rs,workspace:ns,componentInfoObjects:is,flags:as,publicCaseInsensitiveAliasSubstitutions:os}){let ls=[],us=0,cs=[],ps=[],ds=this.createAttributesObject(),fs=await ts.stateValues.sourceComponents,hs=Math.max(fs.length,ns.numReplacementsBySource.length),ys=!1;for(let bs=0;bs<hs;bs++){let vs=fs[bs];if(vs===void 0){if(ns.numReplacementsBySource[bs]>0){if(!ys){let Ds=ns.numReplacementsBySource.slice(bs).reduce((Vs,Is)=>Vs+Is,0);if(Ds>0){let Vs={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:us,numberReplacementsToDelete:Ds};ls.push(Vs)}ys=!0,ns.numReplacementsBySource.slice(bs).forEach((Vs,Is)=>ns.numReplacementsBySource[Is]=0)}ns.uniqueIdentifiersUsedBySource[bs]=[]}cs[bs]=0,ps.push([]);continue}let Ns=ns.sourceNames[bs],Ts=Ns===void 0||vs.componentName!==Ns||ys;if(!Ts){for(let Ds=0;Ds<ns.numReplacementsBySource[bs];Ds++)if(!ts.replacements[us+Ds]){Ts=!0;break}}if(Ts){let Ds=0;Ns!==void 0&&(Ds=ns.numReplacementsBySource[bs]);let Vs=Ds;ys&&(Vs=0);let Is=ns.uniqueIdentifiersUsedBySource[bs]=[],Os=await this.recreateReplacements({component:ts,sourceNum:bs,numReplacementsSoFar:us,numReplacementsToDelete:Vs,components:rs,uniqueIdentifiersUsed:Is,componentInfoObjects:is,compositeAttributesObj:ds,publicCaseInsensitiveAliasSubstitutions:os});us+=Os.numReplacements,cs[bs]=Os.numReplacements,ps[bs]=Os.propVariablesCopiedByReplacement;let Ps=Os.replacementInstruction;if(!ys&&Os.numReplacements!==Ds){let $s=ns.numReplacementsBySource.slice(bs).reduce((Rs,ks)=>Rs+ks,0);Ps.numberReplacementsToReplace=$s,ys=!0,ns.numReplacementsBySource.slice(bs).forEach((Rs,ks)=>ns.numReplacementsBySource[ks]=0)}ls.push(Ps);continue}let Cs=ns.uniqueIdentifiersUsedBySource[bs]=[],xs=await this.createReplacementForSource({component:ts,sourceNum:bs,components:rs,numReplacementsSoFar:us,uniqueIdentifiersUsed:Cs,componentInfoObjects:is,compositeAttributesObj:ds,publicCaseInsensitiveAliasSubstitutions:os}),As=xs.propVariablesCopiedByReplacement,ws=xs.serializedReplacements,Es=ws.length,Ss=ns.numReplacementsBySource[bs];if(Es!==Ss){let Ds=ns.numReplacementsBySource.slice(bs).reduce((Is,Os)=>Is+Os,0),Vs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:us,numberReplacementsToReplace:Ds,serializedReplacements:ws,assignNamesOffset:us};ls.push(Vs),ys=!0,ns.numReplacementsBySource.slice(bs).forEach((Is,Os)=>ns.numReplacementsBySource[Os]=0)}else for(let Ds=0;Ds<Es;Ds++)if(As[Ds].length!==ns.propVariablesCopiedBySource[bs][Ds].length||ns.propVariablesCopiedBySource[bs][Ds].some((Vs,Is)=>Vs!==As[Ds][Is])){let Vs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:us+Ds,numberReplacementsToReplace:1,serializedReplacements:[ws[Ds]],assignNamesOffset:us+Ds};ls.push(Vs)}us+=Es,cs[bs]=Es,ps[bs]=As}return ns.numReplacementsBySource=cs,ns.numNonStringReplacementsBySource=[...cs],ns.sourceNames=fs.map(bs=>bs.componentName),ns.propVariablesCopiedBySource=ps,(await verifyReplacementsMatchSpecifiedType({component:ts,replacementChanges:ls,assignNames:ts.doenetAttributes.assignNames,workspace:ns,componentInfoObjects:is,compositeAttributesObj:ds,flags:as})).replacementChanges}static async recreateReplacements({component:ts,sourceNum:rs,numReplacementsSoFar:ns,numReplacementsToDelete:is,uniqueIdentifiersUsed:as,components:os,componentInfoObjects:ls,compositeAttributesObj:us,publicCaseInsensitiveAliasSubstitutions:cs}){let ps=await this.createReplacementForSource({component:ts,sourceNum:rs,numReplacementsSoFar:ns,components:os,uniqueIdentifiersUsed:as,componentInfoObjects:ls,compositeAttributesObj:us,publicCaseInsensitiveAliasSubstitutions:cs}),ds=ps.propVariablesCopiedByReplacement,fs=ps.serializedReplacements,hs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ns,numberReplacementsToReplace:is,serializedReplacements:fs,assignNamesOffset:ns};return{numReplacements:fs.length,propVariablesCopiedByReplacement:ds,replacementInstruction:hs}}}Ms(Extract,"componentType","extract"),Ms(Extract,"assignNamesToReplacements",!0),Ms(Extract,"acceptAnyAttribute",!0),Ms(Extract,"stateVariableToEvaluateAfterReplacements","needsReplacementsUpdatedWhenStale");class Collect extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.disabled,delete ts.modifyIndirectly,delete ts.fixed,delete ts.styleNumber,delete ts.isResponse,ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.prop={createPrimitiveOfType:"string"},ts.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},ts.componentIndex={createComponentOfType:"integer",createStateVariable:"componentIndex",defaultValue:null,public:!0},ts.propIndex={createComponentOfType:"numberList",createStateVariable:"propIndex",defaultValue:null,public:!0},ts.sourceAttributesToIgnore={createPrimitiveOfType:"stringArray",createStateVariable:"sourceAttributesToIgnore",defaultValue:[],public:!0},ts.sourceAttributesToIgnoreRecursively={createPrimitiveOfType:"stringArray",createStateVariable:"sourceAttributesToIgnoreRecursively",defaultValue:["isResponse"],public:!0},ts.componentTypes={createComponentOfType:"textList"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.link={returnDependencies:()=>({}),definition:()=>({setValue:{link:!0}})},ts.targetComponent={shadowVariable:!0,returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:rs}){return{setValue:{targetComponent:rs.targetComponent}}}},ts.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:rs}){return rs.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:rs.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:rs}){return{setValue:{targetInactive:!!rs.targetIsInactiveCompositeReplacement}}}},ts.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition:function({dependencyValues:rs}){return rs.targetComponent===null?(console.warn("No copy target"),{setValue:{targetName:""}}):{setValue:{targetName:rs.targetComponent.componentName}}}},ts.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:rs}){return{setValue:{propName:rs.propName}}}},ts.componentTypesToCollect={shadowVariable:!0,additionalStateVariablesDefined:[{variableName:"componentClassesToCollect",shadowVariable:!0}],returnDependencies:()=>({componentTypesAttr:{dependencyType:"attributeComponent",attributeName:"componentTypes",variableNames:["texts"]}}),definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=[],as=[];if(rs.componentTypesAttr!==null)for(let os of rs.componentTypesAttr.stateValues.texts){let ls=ns.componentTypeLowerCaseMapping[os.toLowerCase()],us=ns.allComponentClasses[ls];if(us)is.push(ls),as.push(us);else{let cs="Cannot collect component type "+os+". Component type not found.";console.warn(cs)}}return{setValue:{componentTypesToCollect:is,componentClassesToCollect:as}}}},ts.collectedComponents={stateVariablesDeterminingDependencies:["componentTypesToCollect","targetName","propName","componentIndex","propIndex"],additionalStateVariablesDefined:["effectivePropNameByComponent"],returnDependencies:function({stateValues:rs}){if(!rs.targetName)return{};let ns={dependencyType:"descendant",ancestorName:rs.targetName,componentTypes:rs.componentTypesToCollect,useReplacementsForComposites:!0,includeNonActiveChildren:!0,recurseToMatchedChildren:!1,componentIndex:rs.componentIndex};if(rs.propName){let is=rs.propIndex;is&&(is=[...is]),ns.variableNames=[rs.propName],ns.variablesOptional=!0,ns.propIndex=is,ns.caseInsensitiveVariableMatch=!0,ns.publicStateVariablesOnly=!0,ns.useMappedVariableNames=!0}return{descendants:ns,maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},propName:{dependencyType:"stateVariable",variableName:"propName"}}},definition:function({dependencyValues:rs}){let ns=rs.descendants;if(ns||(ns=[]),rs.maximumNumber!==null&&ns.length>rs.maximumNumber){let as=Math.max(0,Math.floor(rs.maximumNumber));ns=ns.slice(0,as)}let is=[];for(let as of ns){let os;as.stateValues&&(os=Object.keys(as.stateValues)[0]),!os&&rs.propName&&(os="__prop_name_not_found"),is.push(os)}return{setValue:{collectedComponents:ns,effectivePropNameByComponent:is}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},ts.needsReplacementsUpdatedWhenStale={returnDependencies(){return{collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"}}},markStale(){return{updateReplacements:!0}},definition(){return{setValue:{needsReplacementsUpdatedWhenStale:!0}}}},ts}static async createSerializedReplacements({component:ts,components:rs,workspace:ns,componentInfoObjects:is,nComponentsForSource:as,publicCaseInsensitiveAliasSubstitutions:os,flags:ls}){if(!await ts.stateValues.targetComponent)return{replacements:[]};let us=[],cs=[],ps=0,ds=[];ns.propVariablesCopiedByCollected=[],ns.uniqueIdentifiersUsedByCollected={};let fs=this.createAttributesObject(),hs=await ts.stateValues.collectedComponents;for(let ys=0;ys<hs.length;ys++)if(hs[ys]){let gs=ns.uniqueIdentifiersUsedByCollected[ys]=[],bs=await this.createReplacementForCollected({component:ts,collectedNum:ys,components:rs,numReplacementsSoFar:ps,uniqueIdentifiersUsed:gs,componentInfoObjects:is,compositeAttributesObj:fs,nComponentsForSource:as,publicCaseInsensitiveAliasSubstitutions:os,flags:ls});ns.propVariablesCopiedByCollected[ys]=bs.propVariablesCopiedByReplacement;let vs=bs.serializedReplacements;cs[ys]=vs.length,ps+=vs.length,us.push(...vs),ds[ys]=vs.map(Ns=>Ns.componentName)}else cs[ys]=0,ds[ys]=[],ns.propVariablesCopiedByCollected[ys]=[];return ns.numReplacementsByCollected=cs,ns.collectedNames=hs.map(ys=>ys.componentName),ns.replacementNamesByCollected=ds,{replacements:us}}static async createReplacementForCollected({component:ts,components:rs,collectedNum:ns,numReplacementsSoFar:is,uniqueIdentifiersUsed:as,componentInfoObjects:os,compositeAttributesObj:ls,nComponentsForSource:us,publicCaseInsensitiveAliasSubstitutions:cs,flags:ps}){var Ts;let ds=(await ts.stateValues.collectedComponents)[ns],fs=ds.componentName,hs=rs[fs],ys=[],gs=[];if(!hs)return{serializedReplacements:ys,propVariablesCopiedByReplacement:gs};let bs=(Ts=ts.attributes.newNamespace)==null?void 0:Ts.primitive,vs=(await ts.stateValues.effectivePropNameByComponent)[ns];if(vs){let Cs=await replacementFromProp({component:ts,components:rs,replacementSource:ds,propName:vs,uniqueIdentifiersUsed:as,compositeAttributesObj:ls,componentInfoObjects:os,nComponentsForSource:us,publicCaseInsensitiveAliasSubstitutions:cs});ys=Cs.serializedReplacements,gs=Cs.propVariablesCopiedByReplacement}else{let Cs=await ts.stateValues.sourceAttributesToIgnore,xs=await ts.stateValues.sourceAttributesToIgnoreRecursively,As=[await hs.serialize({sourceAttributesToIgnore:Cs,sourceAttributesToIgnoreRecursively:xs})];ys=postProcessCopy({serializedComponents:As,componentName:ts.componentName,uniqueIdentifiersUsed:as,identifierPrefix:ns+"|"});for(let ws of ys){ws.attributes||(ws.attributes={});let Es=convertAttributesForComponentType({attributes:ts.attributes,componentType:ws.componentType,componentInfoObjects:os,compositeAttributesObj:ls,compositeCreatesNewNamespace:bs,flags:ps});Object.assign(ws.attributes,Es)}}return ys=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:ys,parentName:ts.componentName,indOffset:is,parentCreatesNewNamespace:bs,componentInfoObjects:os}).serializedComponents,{serializedReplacements:ys,propVariablesCopiedByReplacement:gs}}static async calculateReplacementChanges({component:ts,componentChanges:rs,components:ns,workspace:is,componentInfoObjects:as,nComponentsForSource:os,publicCaseInsensitiveAliasSubstitutions:ls,flags:us}){let cs=0;for(let Ts=0;Ts<is.numReplacementsByCollected.length;Ts++){let Cs=[];for(let[xs,As]of is.replacementNamesByCollected[Ts].entries())!ts.replacements[cs]||ts.replacements[cs].componentName!==As?Cs.push(xs):cs++;for(let xs of Cs.reverse())is.replacementNamesByCollected[Ts].splice(xs,1),is.propVariablesCopiedByCollected[Ts].splice(xs,1);is.numReplacementsByCollected[Ts]-=Cs.length}let ps=[],ds=0,fs=[],hs=[],ys=[],gs=await ts.stateValues.collectedComponents,bs=Math.max(gs.length,is.numReplacementsByCollected.length),vs=!1,Ns=this.createAttributesObject();for(let Ts=0;Ts<bs;Ts++){let Cs=gs[Ts];if(Cs===void 0){if(is.numReplacementsByCollected[Ts]>0){if(!vs){let Is=is.numReplacementsByCollected.slice(Ts).reduce((Os,Ps)=>Os+Ps,0);if(Is>0){let Os={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:ds,numberReplacementsToDelete:Is};ps.push(Os)}vs=!0,is.numReplacementsByCollected.slice(Ts).forEach((Os,Ps)=>is.numReplacementsByCollected[Ps]=0)}is.uniqueIdentifiersUsedByCollected[Ts]=[]}fs[Ts]=0,hs.push([]),ys.push([]);continue}let xs=is.collectedNames[Ts];if(xs===void 0||Cs.componentName!==xs||vs){let Is=0;xs!==void 0&&(Is=is.numReplacementsByCollected[Ts]);let Os=Is;vs&&(Os=0);let Ps=is.uniqueIdentifiersUsedByCollected[Ts]=[],$s=await this.recreateReplacements({component:ts,collectedNum:Ts,numReplacementsSoFar:ds,numReplacementsToDelete:Os,components:ns,uniqueIdentifiersUsed:Ps,componentInfoObjects:as,compositeAttributesObj:Ns,nComponentsForSource:os,publicCaseInsensitiveAliasSubstitutions:ls,flags:us});ds+=$s.numReplacements,fs[Ts]=$s.numReplacements,hs[Ts]=$s.propVariablesCopiedByReplacement;let Rs=$s.replacementInstruction;if(ys[Ts]=Rs.serializedReplacements.map(ks=>ks.componentName),!vs&&$s.numReplacements!==Is){let ks=is.numReplacementsByCollected.slice(Ts).reduce((_s,Bs)=>_s+Bs,0);Rs.numberReplacementsToReplace=ks,vs=!0,is.numReplacementsByCollected.slice(Ts).forEach((_s,Bs)=>is.numReplacementsByCollected[Bs]=0)}ps.push(Rs);continue}if(!await ts.stateValues.propName){ds+=is.numReplacementsByCollected[Ts],fs[Ts]=is.numReplacementsByCollected[Ts],ys[Ts]=is.replacementNamesByCollected[Ts],hs[Ts]=[];continue}let As=is.uniqueIdentifiersUsedByCollected[Ts]=[],ws=await this.createReplacementForCollected({component:ts,collectedNum:Ts,components:ns,numReplacementsSoFar:ds,uniqueIdentifiersUsed:As,componentInfoObjects:as,compositeAttributesObj:Ns,nComponentsForSource:os,publicCaseInsensitiveAliasSubstitutions:ls,flags:us}),Es=ws.propVariablesCopiedByReplacement,Ss=ws.serializedReplacements,Ds=Ss.length,Vs=is.numReplacementsByCollected[Ts];if(Ds!==Vs){let Is=is.numReplacementsByCollected.slice(Ts).reduce((Ps,$s)=>Ps+$s,0),Os={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ds,numberReplacementsToReplace:Is,serializedReplacements:Ss,assignNamesOffset:ds};ps.push(Os),vs=!0,is.numReplacementsByCollected.slice(Ts).forEach((Ps,$s)=>is.numReplacementsByCollected[$s]=0)}else for(let Is=0;Is<Ds;Is++)if(Es[Is].length!==is.propVariablesCopiedByCollected[Ts][Is].length||is.propVariablesCopiedByCollected[Ts][Is].some((Os,Ps)=>Os!==Es[Is][Ps])){let Os={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ds+Is,numberReplacementsToReplace:1,serializedReplacements:[Ss[Is]],assignNamesOffset:ds+Is};ps.push(Os)}ds+=Ds,fs[Ts]=Ds,hs[Ts]=Es,ys[Ts]=Ss.map(Is=>Is.componentName)}return is.numReplacementsByCollected=fs,is.collectedNames=gs.map(Ts=>Ts.componentName),is.propVariablesCopiedByCollected=hs,is.replacementNamesByCollected=ys,ps}static async recreateReplacements({component:ts,collectedNum:rs,numReplacementsSoFar:ns,numReplacementsToDelete:is,uniqueIdentifiersUsed:as,components:os,componentInfoObjects:ls,compositeAttributesObj:us,nComponentsForSource:cs,publicCaseInsensitiveAliasSubstitutions:ps,flags:ds}){let fs=await this.createReplacementForCollected({component:ts,collectedNum:rs,components:os,numReplacementsSoFar:ns,uniqueIdentifiersUsed:as,componentInfoObjects:ls,compositeAttributesObj:us,nComponentsForSource:cs,publicCaseInsensitiveAliasSubstitutions:ps,flags:ds}),hs=fs.propVariablesCopiedByReplacement,ys=fs.serializedReplacements,gs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ns,numberReplacementsToReplace:is,serializedReplacements:ys,assignNamesOffset:ns};return{numReplacements:ys.length,propVariablesCopiedByReplacement:hs,replacementInstruction:gs}}}Ms(Collect,"componentType","collect"),Ms(Collect,"assignNamesToReplacements",!0),Ms(Collect,"acceptTarget",!0),Ms(Collect,"acceptAnyAttribute",!0),Ms(Collect,"stateVariableToEvaluateAfterReplacements","needsReplacementsUpdatedWhenStale");class Ref extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{navigateToTarget:this.navigateToTarget.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.textType={createComponentOfType:"text",createStateVariable:"textType",defaultValue:"type-global",public:!0},ts.uri={createPrimitiveOfType:"string",createStateVariable:"uri",defaultValue:null,public:!0,forRenderer:!0},ts.page={createPrimitiveOfType:"integer",createStateVariable:"page",defaultValue:null,public:!0,forRenderer:!0},ts.createButton={createComponentOfType:"boolean",createStateVariable:"createButton",defaultValue:!1,forRenderer:!0},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:rs}){return{setValue:{targetComponent:rs.targetComponent}}}},ts.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:rs}){return rs.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:rs.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:rs}){return{setValue:{targetInactive:!!rs.targetIsInactiveCompositeReplacement}}}},ts.targetName={forRenderer:!0,returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},uri:{dependencyType:"stateVariable",variableName:"uri"},page:{dependencyType:"stateVariable",variableName:"page"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},targetAttribute:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:function({dependencyValues:rs}){if(rs.uri||rs.page)if(rs.targetAttribute){let ns=rs.targetAttribute;return ns[0]!=="/"&&(ns="/"+ns),{setValue:{targetName:ns}}}else return{setValue:{targetName:""}};else return rs.targetComponent===null||rs.targetInactive?{setValue:{targetName:""}}:{setValue:{targetName:rs.targetComponent.componentName}}}},ts.cid={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"doenetId",forRenderer:!0},{variableName:"variantIndex",forRenderer:!0},{variableName:"edit",forRenderer:!0},{variableName:"draft",forRenderer:!0},{variableName:"hash",forRenderer:!0}],returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:rs}){if(!rs.uri||rs.uri.substring(0,7).toLowerCase()!=="doenet:")return{setValue:{cid:null,doenetId:null,variantIndex:null,edit:null,draft:null,hash:null}};let ns=null,is=null,as=null,os=null,ls=null,us=null,cs=rs.uri.match(/[:&]cid=([^&^#]+)/i);return cs&&(ns=cs[1]),cs=rs.uri.match(/[:&]doenetid=([^&^#]+)/i),cs&&(is=cs[1]),cs=rs.uri.match(/[:&]variant=([^&^#]+)/i),cs&&(as=Number(cs[1]),!Number.isInteger(as)&&as>=1&&(as=1)),cs=rs.uri.match(/[:&]edit=([^&^#]+)/i),cs&&(cs[1].toLowerCase()==="true"?ls=!0:ls=!1),cs=rs.uri.match(/[:&]draft=([^&^#]+)/i),cs&&(cs[1].toLowerCase()==="true"?os=!0:os=!1),cs=rs.uri.match(/(#.+)/i),cs&&(us=cs[1]),{setValue:{cid:ns,doenetId:is,variantIndex:as,edit:ls,draft:os,hash:us}}}},ts.linkText={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["targetName"],returnDependencies({stateValues:rs}){let ns={allChildren:{dependencyType:"child",childGroups:["anything"],variableNames:["text"],variablesOptional:!0},uri:{dependencyType:"stateVariable",variableName:"uri"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"}};return rs.targetName&&(ns.equationTag={dependencyType:"stateVariable",componentName:rs.targetName,variableName:"equationTag",variablesOptional:!0},ns.title={dependencyType:"stateVariable",componentName:rs.targetName,variableName:"title",variablesOptional:!0}),ns},definition:function({dependencyValues:rs}){let ns="";if(rs.allChildren.length===0)rs.uri!==null?ns=rs.uri:rs.targetInactive||(rs.title!==null?ns=rs.title:rs.equationTag!==null&&(ns="("+rs.equationTag+")"));else for(let is of rs.allChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"&&(ns+=is.stateValues.text);return ns||(ns="???"),{setValue:{linkText:ns}}}},ts}async navigateToTarget({actionId:ts}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:ts});else{let rs=await this.stateValues.cid,ns=await this.stateValues.doenetId,is=await this.stateValues.variantIndex,as=await this.stateValues.edit,os=await this.stateValues.hash,ls=await this.stateValues.page,us=await this.stateValues.uri,cs=await this.stateValues.targetName,ps=this.componentOrAdaptedName;this.coreFunctions.navigateToTarget({cid:rs,doenetId:ns,variantIndex:is,edit:as,hash:os,page:ls,uri:us,targetName:cs,actionId:ts,componentName:this.componentName,effectiveName:ps})}}}Ms(Ref,"componentType","ref"),Ms(Ref,"renderChildren",!0),Ms(Ref,"acceptTarget",!0);class Coords extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.createVectors,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.createVectors={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({}),definition:()=>({setValue:{createVectors:!0}})},ts}}Ms(Coords,"componentType","coords"),Ms(Coords,"rendererType","math");class LineSegment extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveLineSegment:this.moveLineSegment.bind(this),lineSegmentClicked:this.lineSegmentClicked.bind(this),mouseDownOnLineSegment:this.mouseDownOnLineSegment.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.endpointsDraggable={createComponentOfType:"boolean"},ts.endpoints={createComponentOfType:"_pointListComponent"},ts.showCoordsWhenDragging={createComponentOfType:"boolean",createStateVariable:"showCoordsWhenDragging",defaultValue:!0,public:!0,forRenderer:!0},ts.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft"]},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" line segment"}}}},ts.endpointsDraggable={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({endpointsDraggableAttr:{dependencyType:"attributeComponent",attributeName:"endpointsDraggable",variableNames:["value"]},draggable:{dependencyType:"stateVariable",variableName:"draggable"}}),definition({dependencyValues:rs}){return rs.endpointsDraggableAttr?{setValue:{endpointsDraggable:rs.endpointsDraggableAttr.stateValues.value}}:{useEssentialOrDefaultValue:{endpointsDraggable:{defaultValue:rs.draggable}}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["nDimensions"]}}),definition:function({dependencyValues:rs}){return rs.endpointsAttr!==null?{setValue:{nDimensions:rs.endpointsAttr.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{setValue:{nDimensions:2}}}},ts.endpoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="endpointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["endpointX","endpoint"],hasEssential:!0,set:convertValueToMathExpression,defaultValueByArrayKey:rs=>Context.fromAst(rs==="0,0"?1:0),getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="endpointX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="endpoints")return rs.length===1?"endpoint"+rs[0]:`endpointX${rs[0]}_${rs[1]}`;if(ns.slice(0,8)==="endpoint"){let is=Number(ns.slice(8));if(Number.isInteger(is)&&is>0)return`endpointX${is}_${rs[0]}`}return null},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[2,rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let[as,os]=is.split(","),ls=Number(as)+1+"_"+(Number(os)+1);ns[is]={endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["pointX"+ls]}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns,arraySize:is}){let as={},os={};for(let us of ns){let[cs,ps]=us.split(","),ds=Number(cs)+1+"_"+(Number(ps)+1);rs[us].endpointsAttr!==null&&rs[us].endpointsAttr.stateValues["pointX"+ds]?as[us]=rs[us].endpointsAttr.stateValues["pointX"+ds]:os[us]=!0}let ls={};return Object.keys(as).length>0&&(ls.setValue={endpoints:as}),Object.keys(os).length>0&&(ls.useEssentialOrDefaultValue={endpoints:os}),ls},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyValuesByKey:ns,dependencyNamesByKey:is,initialChange:as,stateValues:os}){let ls=[];for(let us in rs.endpoints){let[cs,ps]=us.split(","),ds=Number(cs)+1+"_"+(Number(ps)+1);ns[us].endpointsAttr!==null&&ns[us].endpointsAttr.stateValues["pointX"+ds]?ls.push({setDependency:is[us].endpointsAttr,desiredValue:rs.endpoints[us],childIndex:0,variableIndex:0}):ls.push({setEssentialValue:"endpoints",value:{[us]:rs.endpoints[us]}})}return{success:!0,instructions:ls}}},ts.length={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},endpoints:{dependencyType:"stateVariable",variableName:"endpoints"}}),definition({dependencyValues:rs}){let ns=0,is=rs.endpoints[0],as=rs.endpoints[1],os=!0;for(let ls=0;ls<rs.nDimensions;ls++){let us=is[ls].evaluate_to_constant();if(!Number.isFinite(us)){os=!1;break}let cs=as[ls].evaluate_to_constant();if(!Number.isFinite(cs)){os=!1;break}let ps=us-cs;ns+=ps*ps}if(os)return{setValue:{length:Context.fromAst(Math.sqrt(ns))}};ns=["+"];for(let ls=0;ls<rs.nDimensions;ls++)ns.push(["^",["+",is[ls],["-",as[ls]]],2]);return{setValue:{length:Context.fromAst(["apply","sqrt",ns])}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){let is=[],as=[],os=ns.endpoints[0],ls=ns.endpoints[1],us=!0;for(let ys=0;ys<ns.nDimensions;ys++){let gs=os[ys].evaluate_to_constant();if(!Number.isFinite(gs)){us=!1;break}let bs=ls[ys].evaluate_to_constant();if(!Number.isFinite(bs)){us=!1;break}is.push((gs+bs)/2),as.push(gs-bs)}if(!us)return{success:!1};let cs=Math.sqrt(as.reduce((ys,gs)=>ys+gs*gs,0));as=as.map(ys=>ys/cs);let ps=rs.length.evaluate_to_constant();if(!Number.isFinite(ps)||ps<0)return{success:!1};let ds=[],fs=[],hs=ps/2;for(let ys=0;ys<ns.nDimensions;ys++)ds.push(Context.fromAst(is[ys]+as[ys]*hs)),fs.push(Context.fromAst(is[ys]-as[ys]*hs));return{success:!0,instructions:[{setDependency:"endpoints",desiredValue:[ds,fs]}]}}},ts.numericalEndpoints={isArray:!0,entryPrefixes:["numericalEndpoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return Number.isNaN(rs.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},is={};for(let as of rs)is[as]={endpoint:{dependencyType:"stateVariable",variableName:"endpoint"+(Number(as)+1)}};return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){if(Number.isNaN(rs.nDimensions))return{};let as={};for(let os of is){let ls=ns[os].endpoint,us=[];for(let cs=0;cs<rs.nDimensions;cs++){let ps=ls[cs].evaluate_to_constant();us.push(ps)}as[os]=us}return{setValue:{numericalEndpoints:as}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition({dependencyValues:rs}){let ns=rs.numericalEndpoints[0][0],is=rs.numericalEndpoints[0][1],as=rs.numericalEndpoints[1][0],os=rs.numericalEndpoints[1][1],ls=Number.isFinite(ns)&&Number.isFinite(is)&&Number.isFinite(as)&&Number.isFinite(os),us=rs.nDimensions!==2||!ls||as===ns&&os===is;return{setValue:{nearestPoint:function({variables:cs,scales:ps}){if(us)return{};let ds=ps[0],fs=ps[1],hs=(as-ns)/ds,ys=(os-is)/fs,gs=hs*hs+ys*ys,bs=((cs.x1-ns)/ds*hs+(cs.x2-is)/fs*ys)/gs,vs={};return bs<=0?vs={x1:ns,x2:is}:bs>=1?vs={x1:as,x2:os}:vs={x1:ns+bs*hs*ds,x2:is+bs*ys*fs},cs.x3!==void 0&&(vs.x3=0),vs}}}}},ts.slope={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition({dependencyValues:rs}){if(rs.nDimensions!==2)return{setValue:{slope:NaN}};let ns=rs.numericalEndpoints;return{setValue:{slope:(ns[1][1]-ns[0][1])/(ns[1][0]-ns[0][0])}}}},ts}async moveLineSegment({point1coords:ts,point2coords:rs,transient:ns,actionId:is,sourceDetails:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){if(ts===void 0||rs===void 0){if(!await this.stateValues.endpointsDraggable)return await this.coreFunctions.resolveAction({actionId:is})}else if(!await this.stateValues.draggable)return await this.coreFunctions.resolveAction({actionId:is});let us={};return ts!==void 0&&(us["0,0"]=Context.fromAst(ts[0]),us["0,1"]=Context.fromAst(ts[1])),rs!==void 0&&(us["1,0"]=Context.fromAst(rs[0]),us["1,1"]=Context.fromAst(rs[1])),ns?await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:us,sourceDetails:as}],transient:!0,actionId:is,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:us,sourceDetails:as}],actionId:is,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{point1:ts,point2:rs}}})}async lineSegmentClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnLineSegment({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(LineSegment,"componentType","lineSegment");class Ray extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveRay:this.moveRay.bind(this),rayClicked:this.rayClicked.bind(this),mouseDownOnRay:this.mouseDownOnRay.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.endpoint={createComponentOfType:"point"},ts.through={createComponentOfType:"point"},ts.direction={createComponentOfType:"vector"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" ray"}}}},ts.directionShadow={defaultValue:null,hasEssential:!0,essentialVarName:"direction",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{directionShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"directionShadow",value:convertValueToMathExpression(rs.directionShadow)}]}}},ts.throughShadow={defaultValue:null,hasEssential:!0,essentialVarName:"through",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{throughShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"throughShadow",value:convertValueToMathExpression(rs.throughShadow)}]}}},ts.endpointShadow={defaultValue:null,hasEssential:!0,essentialVarName:"endpoint",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{endpointShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"endpointShadow",value:convertValueToMathExpression(rs.endpointShadow)}]}}},ts.basedOnThrough={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"},endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint"},directionAttr:{dependencyType:"attributeComponent",attributeName:"direction"}}),definition:function({dependencyValues:rs}){return rs.endpointAttr!==null&&rs.directionAttr!==null?(rs.throughAttr!==null&&console.warn("Ray is prescribed by through, endpoint, and direction.  Ignoring specified through."),{setValue:{basedOnThrough:!1},checkForActualChange:{basedOnThrough:!0}}):rs.throughAttr!==null?{setValue:{basedOnThrough:!0},checkForActualChange:{basedOnThrough:!0}}:{setValue:{basedOnThrough:rs.throughShadow!==null},checkForActualChange:{basedOnThrough:!0}}}},ts.basedOnEndpoint={returnDependencies:()=>({endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"}}),definition:function({dependencyValues:rs}){return rs.endpointAttr!==null?{setValue:{basedOnEndpoint:!0},checkForActualChange:{basedOnEndpoint:!0}}:{setValue:{basedOnEndpoint:rs.endpointShadow!==null},checkForActualChange:{basedOnEndpoint:!0}}}},ts.basedOnDirection={returnDependencies:()=>({directionAttr:{dependencyType:"attributeComponent",attributeName:"direction"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"}}),definition:function({dependencyValues:rs}){return rs.directionAttr!==null?{setValue:{basedOnDirection:!0},checkForActualChange:{basedOnDirection:!0}}:{setValue:{basedOnDirection:rs.directionShadow!==null},checkForActualChange:{basedOnDirection:!0}}}},ts.nDimDirection={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:rs}){let ns={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"},directionAttr:{dependencyType:"attributeComponent",attributeName:"direction",variableNames:["nDimensions"]}};return rs.basedOnDirection||(rs.basedOnThrough&&(ns.nDimThrough={dependencyType:"stateVariable",variableName:"nDimThrough"}),rs.basedOnEndpoint&&(ns.nDimEndpoint={dependencyType:"stateVariable",variableName:"nDimEndpoint"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnDirection){if(rs.directionAttr!==null)ns=rs.directionAttr.stateValues.nDimensions;else if(rs.directionShadow){let is=rs.directionShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=2}}else rs.basedOnThrough?rs.basedOnEndpoint?rs.nDimThrough===rs.nDimEndpoint?ns=rs.nDimThrough:ns=NaN:ns=rs.nDimThrough:rs.basedOnEndpoint?ns=rs.nDimEndpoint:ns=2;return{setValue:{nDimDirection:ns},checkForActualChange:{nDimDirection:!0}}}},ts.nDimThrough={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:rs}){let ns={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"},throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}};return rs.basedOnThrough||(rs.basedOnEndpoint&&(ns.nDimEndpoint={dependencyType:"stateVariable",variableName:"nDimEndpoint"}),rs.basedOnDirection&&(ns.nDimDirection={dependencyType:"stateVariable",variableName:"nDimDirection"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnThrough){if(rs.throughAttr!==null)ns=rs.throughAttr.stateValues.nDimensions;else if(rs.throughShadow){let is=rs.throughShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=2}}else rs.basedOnDirection?rs.basedOnEndpoint?rs.nDimDirection===rs.nDimEndpoint?ns=rs.nDimDirection:ns=NaN:ns=rs.nDimDirection:rs.basedOnEndpoint?ns=rs.nDimEndpoint:ns=2;return{setValue:{nDimThrough:ns},checkForActualChange:{nDimThrough:!0}}}},ts.nDimEndpoint={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:rs}){let ns={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"},endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint",variableNames:["nDimensions"]}};return rs.basedOnEndpoint||(rs.basedOnThrough&&(ns.nDimThrough={dependencyType:"stateVariable",variableName:"nDimThrough"}),rs.basedOnDirection&&(ns.nDimDirection={dependencyType:"stateVariable",variableName:"nDimDirection"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnEndpoint){if(rs.endpointAttr!==null)ns=rs.endpointAttr.stateValues.nDimensions;else if(rs.endpointShadow){let is=rs.endpointShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=2}}else rs.basedOnDirection?rs.basedOnThrough?rs.nDimDirection===rs.nDimThrough?ns=rs.nDimDirection:ns=NaN:ns=rs.nDimDirection:rs.basedOnThrough?ns=rs.nDimThrough:ns=2;return{setValue:{nDimEndpoint:ns},checkForActualChange:{nDimEndpoint:!0}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},nDimDirection:{dependencyType:"stateVariable",variableName:"nDimDirection"},nDimThrough:{dependencyType:"stateVariable",variableName:"nDimThrough"},nDimEndpoint:{dependencyType:"stateVariable",variableName:"nDimEndpoint"}}),definition:function({dependencyValues:rs}){let ns;if(rs.basedOnDirection){if(rs.basedOnEndpoint){if(rs.nDimDirection!==rs.nDimEndpoint)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}}}else if(rs.basedOnThrough&&rs.nDimDirection!==rs.nDimThrough)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};ns=rs.nDimDirection}else if(rs.basedOnEndpoint){if(rs.basedOnThrough&&rs.nDimEndpoint!==rs.nDimThrough)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};ns=rs.nDimEndpoint}else rs.basedOnThrough?ns=rs.nDimThrough:ns=2;return{setValue:{nDimensions:ns},checkForActualChange:{nDimensions:!0}}}},ts.direction={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="directionX"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["directionX"],hasEssential:!0,essentialVarName:"direction2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough"],returnArraySizeDependencies:()=>({nDimDirection:{dependencyType:"stateVariable",variableName:"nDimDirection"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimDirection]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={directionAttr:{dependencyType:"attributeComponent",attributeName:"direction",variableNames:["x"+ls]}},!ns.basedOnDirection&&ns.basedOnThrough&&(as[os].endpointX={dependencyType:"stateVariable",variableName:"endpointX"+ls},as[os].throughX={dependencyType:"stateVariable",variableName:"throughX"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let us of is){let cs=Number(us)+1;rs.basedOnDirection?ns[us].directionAttr!==null?as[us]=ns[us].directionAttr.stateValues["x"+cs]:rs.directionShadow!==null&&(as[us]=rs.directionShadow.get_component(Number(us))):rs.basedOnThrough?as[us]=ns[us].throughX.subtract(ns[us].endpointX).simplify():os[us]={defaultValue:Context.fromAst(us==="0"?1:0)}}let ls={};return Object.keys(as).length>0&&(ls.setValue={direction:as}),Object.keys(os).length>0&&(ls.useEssentialOrDefaultValue={direction:os}),ls},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.direction)ns.basedOnDirection?is[cs].directionAttr!==null?ls.push({setDependency:as[cs].directionAttr,desiredValue:rs.direction[cs],variableIndex:0}):us=!0:ns.basedOnThrough?ls.push({setDependency:as[cs].throughX,desiredValue:is[cs].endpointX.add(rs.direction[cs]).simplify()}):ls.push({setEssentialValue:"direction",value:{[cs]:convertValueToMathExpression(rs.direction[cs])}});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.direction)cs[Number(ps)+1]=rs.direction[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"directionShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.direction&&ls.push({setDependency:"directionShadow",desiredValue:rs.direction[0]});return{success:!0,instructions:ls}}},ts.through={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="throughX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["throughX"],set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnThrough"],returnArraySizeDependencies:()=>({nDimThrough:{dependencyType:"stateVariable",variableName:"nDimThrough"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimThrough]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["x"+ls]}},ns.basedOnThrough||(as[os].endpointX={dependencyType:"stateVariable",variableName:"endpointX"+ls},as[os].directionX={dependencyType:"stateVariable",variableName:"directionX"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=Number(os)+1;rs.basedOnThrough?ns[os].throughAttr!==null?as[os]=ns[os].throughAttr.stateValues["x"+ls]:rs.throughShadow!==null&&(as[os]=rs.throughShadow.get_component(Number(os))):as[os]=ns[os].endpointX.add(ns[os].directionX).simplify()}return{setValue:{through:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.through)ns.basedOnThrough?is[cs].throughAttr&&is[cs].throughAttr!==null?ls.push({setDependency:as[cs].throughAttr,desiredValue:rs.through[cs],variableIndex:0}):ns.throughShadow!==null&&(us=!0):ls.push({setDependency:as[cs].directionX,desiredValue:rs.through[cs].subtract(is[cs].endpointX).simplify()});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.through)cs[Number(ps)+1]=rs.through[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"throughShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.through&&ls.push({setDependency:"throughShadow",desiredValue:rs.through[0]});return{success:!0,instructions:ls}}},ts.endpoint={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="endpointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["endpointX"],hasEssential:!0,defaultValueByArrayKey:()=>Context.fromAst(0),essentialVarName:"endpoint2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnEndpoint","basedOnThrough","basedOnDirection"],returnArraySizeDependencies:()=>({nDimEndpoint:{dependencyType:"stateVariable",variableName:"nDimEndpoint"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimEndpoint]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint",variableNames:["x"+ls]}},ns.basedOnEndpoint||ns.basedOnThrough&&ns.basedOnDirection&&(as[os].throughX={dependencyType:"stateVariable",variableName:"throughX"+ls},as[os].directionX={dependencyType:"stateVariable",variableName:"directionX"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let us of is){let cs=Number(us)+1;ns[us].endpointAttr!==null?as[us]=ns[us].endpointAttr.stateValues["x"+cs]:rs.endpointShadow!==null?as[us]=rs.endpointShadow.get_component(Number(us)):rs.basedOnThrough&&rs.basedOnDirection?as[us]=ns[us].throughX.subtract(ns[us].directionX).simplify():os[us]=!0}let ls={};return Object.keys(as).length>0&&(ls.setValue={endpoint:as}),Object.keys(os).length>0&&(ls.useEssentialOrDefaultValue={endpoint:os}),ls},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.endpoint)is[cs].endpointAttr&&is[cs].endpointAttr!==null?ls.push({setDependency:as[cs].endpointAttr,desiredValue:rs.endpoint[cs],variableIndex:0}):ns.endpointShadow!==null?us=!0:ns.basedOnThrough&&ns.basedOnDirection?ls.push({setDependency:as[cs].directionX,desiredValue:is[cs].throughX.subtract(rs.endpoint[cs]).simplify()}):ls.push({setEssentialValue:"endpoint",value:{[cs]:convertValueToMathExpression(rs.endpoint[cs])}});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.endpoint)cs[Number(ps)+1]=rs.endpoint[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"endpointShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.endpoint&&ls.push({setDependency:"endpointShadow",desiredValue:rs.endpoint[0]});return{success:!0,instructions:ls}}},ts.numericalEndpoint={forRenderer:!0,returnDependencies(){return{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},endpoint:{dependencyType:"stateVariable",variableName:"endpoint"}}},definition({dependencyValues:rs}){if(Number.isNaN(rs.nDimensions))return null;let ns=rs.endpoint,is=[];for(let as=0;as<rs.nDimensions;as++){let os=ns[as].evaluate_to_constant();is.push(os)}return{setValue:{numericalEndpoint:is}}}},ts.numericalThroughpoint={forRenderer:!0,returnDependencies(){return{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},through:{dependencyType:"stateVariable",variableName:"through"}}},definition({dependencyValues:rs}){if(Number.isNaN(rs.nDimensions))return null;let ns=rs.through,is=[];for(let as=0;as<rs.nDimensions;as++){let os=ns[as].evaluate_to_constant();is.push(os)}return{setValue:{numericalThroughpoint:is}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoint:{dependencyType:"stateVariable",variableName:"numericalEndpoint"},numericalThroughpoint:{dependencyType:"stateVariable",variableName:"numericalThroughpoint"}}),definition({dependencyValues:rs}){let ns=rs.numericalEndpoint[0],is=rs.numericalEndpoint[1],as=rs.numericalThroughpoint[0],os=rs.numericalThroughpoint[1],ls=Number.isFinite(ns)&&Number.isFinite(is)&&Number.isFinite(as)&&Number.isFinite(os),us=rs.nDimensions!==2||!ls||as===ns&&os===is;return{setValue:{nearestPoint:function({variables:cs,scales:ps}){if(us)return{};let ds=ps[0],fs=ps[1],hs=(as-ns)/ds,ys=(os-is)/fs,gs=hs*hs+ys*ys,bs=((cs.x1-ns)/ds*hs+(cs.x2-is)/fs*ys)/gs,vs={};return bs<=0?vs={x1:ns,x2:is}:vs={x1:ns+bs*hs*ds,x2:is+bs*ys*fs},cs.x3!==void 0&&(vs.x3=0),vs}}}}},ts}async moveRay({endpointcoords:ts,throughcoords:rs,transient:ns,skippable:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=[];if(ts!==void 0){if(await this.stateValues.basedOnThrough&&await this.stateValues.basedOnDirection){let cs;if(rs===void 0){let ps=await this.stateValues.numericalThroughpoint;cs=ts.map((ds,fs)=>ps[fs]-ds)}else cs=ts.map((ps,ds)=>rs[ds]-ps);us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:cs.map(ps=>Context.fromAst(ps))})}else us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"endpoint",value:ts.map(cs=>Context.fromAst(cs))});if(rs===void 0&&!await this.stateValues.basedOnThrough){let cs=await this.stateValues.numericalThroughpoint,ps=ts.map((ds,fs)=>cs[fs]-ds);us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:ps.map(ds=>Context.fromAst(ds))})}}if(rs!==void 0){if(await this.stateValues.basedOnThrough)us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"through",value:rs.map(cs=>Context.fromAst(cs))});else{ts==null&&(ts=await this.stateValues.numericalEndpoint);let cs=ts.map((ps,ds)=>rs[ds]-ps);us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:cs.map(ps=>Context.fromAst(ps))})}if(ts===void 0&&await this.stateValues.basedOnThrough&&await this.stateValues.basedOnDirection){let cs=await this.stateValues.numericalEndpoint,ps=rs.map((ds,fs)=>ds-cs[fs]);us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:ps.map(ds=>Context.fromAst(ds))})}}return ns?await this.coreFunctions.performUpdate({updateInstructions:us,transient:ns,skippable:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:us,actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{through:rs,endpoint:ts}}})}async rayClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnRay({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Ray,"componentType","ray");class Polygon extends Polyline{constructor(ts){super(ts),Object.assign(this.actions,{movePolygon:this.movePolygon.bind(this),polygonClicked:this.polygonClicked.bind(this),mouseDownOnPolygon:this.mouseDownOnPolygon.bind(this)})}get movePolygon(){return this.movePolyline}get polygonClicked(){return this.polylineClicked}get mouseDownOnPolygon(){return this.mouseDownOnPolyline}static createAttributesObject(){let ts=super.createAttributesObject();return ts.filled={createComponentOfType:"boolean",createStateVariable:"filled",defaultValue:!1,public:!0,forRenderer:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var os,ls;let ns;((os=rs.document)==null?void 0:os.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" ");let as;if(!rs.filled)as=is+ns;else{let us;((ls=rs.document)==null?void 0:ls.stateValues.theme)==="dark"?us=rs.selectedStyle.fillColorWordDarkMode:us=rs.selectedStyle.fillColorWord,us===ns?(as="filled "+us,is&&(as+=" with "+is+"border")):as="filled "+us+" with "+is+ns+" border"}return{setValue:{styleDescription:as}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var os,ls;let ns;((os=rs.document)==null?void 0:os.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" ");let as;if(!rs.filled)as=is+ns+" polygon";else{let us;((ls=rs.document)==null?void 0:ls.stateValues.theme)==="dark"?us=rs.selectedStyle.fillColorWordDarkMode:us=rs.selectedStyle.fillColorWord,us===ns?(as="filled "+us+" polygon",is&&(as+=" with a "+is+"border")):as="filled "+us+" polygon with a "+is+ns+" border"}return{setValue:{styleDescriptionWithNoun:as}}}},ts.borderStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{borderStyleDescription:is}}}},ts.fillStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.fillColorWordDarkMode:ns=rs.selectedStyle.fillColorWord;let is;return rs.filled?is=ns:is="unfilled",{setValue:{fillStyleDescription:is}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:rs}){var ds,fs,hs,ys;let ns=rs.nDimensions,is=rs.nVertices,as=rs.numericalVertices,os=[],ls,us,cs=(ds=as[is-1])==null?void 0:ds[0],ps=(fs=as[is-1])==null?void 0:fs[1];for(let gs=0;gs<is;gs++)if(ls=cs,us=ps,cs=(hs=as[gs])==null?void 0:hs[0],ps=(ys=as[gs])==null?void 0:ys[1],!(Number.isFinite(ls)&&Number.isFinite(us)&&Number.isFinite(cs)&&Number.isFinite(ps)))os.push(null);else{let bs=cs-ls,vs=ps-us;bs===0&&vs===0?os.push(null):os.push([bs,vs])}return{setValue:{nearestPoint:function({variables:gs,scales:bs}){var Vs,Is;let vs=bs[0],Ns=bs[1];if(ns!==2||is===0)return{};let Ts=1/0,Cs={},xs=(Vs=gs.x1)==null?void 0:Vs.evaluate_to_constant(),As=(Is=gs.x2)==null?void 0:Is.evaluate_to_constant(),ws,Es,Ss=as[is-1][0],Ds=as[is-1][1];for(let Os=0;Os<is;Os++){ws=Ss,Es=Ds,Ss=as[Os][0],Ds=as[Os][1];let Ps=os[Os];if(Ps===null)continue;let $s=Ps[0]/vs,Rs=Ps[1]/Ns,ks=$s*$s+Rs*Rs,_s=((xs-ws)/vs*$s+(As-Es)/Ns*Rs)/ks,Bs;_s<=0?Bs={x1:ws,x2:Es}:_s>=1?Bs={x1:Ss,x2:Ds}:Bs={x1:ws+_s*$s*vs,x2:Es+_s*Rs*Ns};let Us=Math.pow((xs-Bs.x1)/vs,2)+Math.pow((As-Bs.x2)/Ns,2);Us<Ts&&(Ts=Us,Cs=Bs)}return gs.x3!==void 0&&Object.keys(Cs).length>0&&(Cs.x3=0),Cs}}}}},ts}}Ms(Polygon,"componentType","polygon"),Ms(Polygon,"representsClosedPath",!0);class Triangle extends Polygon{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=ts.styleDescriptionWithNoun.definition;return ts.styleDescriptionWithNoun.definition=function({dependencyValues:ns}){let is=rs({dependencyValues:ns}).setValue.styleDescriptionWithNoun;return is=is.replaceAll("polygon","triangle"),{setValue:{styleDescriptionWithNoun:is}}},ts.vertices.hasEssential=!0,ts.vertices.defaultValueByArrayKey=function(ns){return["0,1","1,0"].includes(ns)?Context.fromAst(1):Context.fromAst(0)},ts.vertices.returnArraySizeDependencies=()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),ts.vertices.returnArraySize=function({dependencyValues:ns}){return[3,ns.nDimensions]},ts.vertices.arrayDefinitionByKey=function({dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let ls of is){let[us,cs]=ls.split(","),ps=Number(us)+1+"_"+(Number(cs)+1),ds=ns[ls].vertices;ds!==null&&ds.stateValues["pointX"+ps]?as[ls]=ds.stateValues["pointX"+ps]:os[ls]=!0}return{setValue:{vertices:as},useEssentialOrDefaultValue:{vertices:os}}},ts.vertices.inverseArrayDefinitionByKey=async function({desiredStateVariableValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,initialChange:os,stateValues:ls}){if(os&&!await ls.draggable)return{success:!1};let us=[];for(let cs in ns.vertices){let[ps,ds]=cs.split(","),fs=Number(ps)+1+"_"+(Number(ds)+1);is[cs].vertices!==null&&is[cs].vertices.stateValues["pointX"+fs]?us.push({setDependency:as[cs].vertices,desiredValue:ns.vertices[cs],variableIndex:0}):us.push({setEssentialValue:"vertices",value:{[cs]:ns.vertices[cs].simplify()}})}return{success:!0,instructions:us}},ts.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{nVertices:3}})},ts}}Ms(Triangle,"componentType","triangle"),Ms(Triangle,"rendererType","polygon");class Rectangle extends Polygon{static createAttributesObject(){let ts=super.createAttributesObject();return ts.center={createComponentOfType:"point"},ts.width={createComponentOfType:"number"},ts.height={createComponentOfType:"number"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=ts.styleDescriptionWithNoun.definition;return ts.styleDescriptionWithNoun.definition=function({dependencyValues:ns}){let is=rs({dependencyValues:ns}).setValue.styleDescriptionWithNoun;return is=is.replaceAll("polygon","rectangle"),{setValue:{styleDescriptionWithNoun:is}}},ts.nVerticesSpecified={returnDependencies:()=>({verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:ns}){return ns.verticesAttr!==null?{setValue:{nVerticesSpecified:ns.verticesAttr.stateValues.nPoints}}:{setValue:{nVerticesSpecified:0}}}},ts.essentialVertex={isArray:!0,entryPrefixes:["essentialVertexX"],defaultValueByArrayKey:()=>Context.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}}),returnArraySize({dependencyValues:ns}){return[ns.nVerticesSpecified===0?2:0]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:ns}){let is={};for(let as of ns)is[as]=!0;return{useEssentialOrDefaultValue:{essentialVertex:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns}){let is=[];for(let as in ns.essentialVertex)is.push({setEssentialValue:"essentialVertex",value:{[as]:ns.essentialVertex[as]}});return{success:!0,instructions:is}}},ts.haveSpecifiedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:ns})=>({setValue:{haveSpecifiedCenter:ns.centerAttr!==null}})},ts.specifiedCenter={isArray:!0,entryPrefixes:["specifiedCenterX"],returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:ns}){return[ns.haveSpecifiedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1;is[as]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+os]}}}return{dependenciesByKey:is}},arrayDefinitionByKey:function({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=Number(os)+1;ns[os].centerAttr!==null&&(as[os]=ns[os].centerAttr.stateValues["x"+ls])}return{setValue:{specifiedCenter:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as}){let os=[];for(let ls in ns.specifiedCenter)is[ls].centerAttr&&is[ls].centerAttr!==null&&os.push({setDependency:as[ls].centerAttr,desiredValue:ns.specifiedCenter[ls],variableIndex:0});return{success:!0,instructions:os}}},ts.specifiedWidth={defaultValue:1,hasEssential:!0,essentialVarName:"width",returnDependencies(){return{widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}},definition({dependencyValues:ns}){return ns.widthAttr!==null?{setValue:{specifiedWidth:ns.widthAttr.stateValues.value}}:(ns.haveSpecifiedCenter?1:0)+ns.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedWidth:!0}}:{setValue:{specifiedWidth:null}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){return is.widthAttr!==null?{success:!0,instructions:[{setDependency:"widthAttr",desiredValue:ns.specifiedWidth,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"specifiedWidth",value:ns.specifiedWidth}]}}},ts.specifiedHeight={defaultValue:1,hasEssential:!0,essentialVarName:"height",returnDependencies(){return{heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}},definition({dependencyValues:ns}){return ns.heightAttr!==null?{setValue:{specifiedHeight:ns.heightAttr.stateValues.value}}:(ns.haveSpecifiedCenter?1:0)+ns.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedHeight:!0}}:{setValue:{specifiedHeight:null}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){return is.heightAttr!==null?{success:!0,instructions:[{setDependency:"heightAttr",desiredValue:ns.specifiedHeight,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"specifiedHeight",value:ns.specifiedHeight}]}}},ts.center={public:!0,isArray:!0,entryPrefixes:["centerX"],shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="centerX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1;is[as]={vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_"+os},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_"+os}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].vertex0,us=ns[os].vertex2;as[os]=ls.add(us).divide(2).simplify()}return{setValue:{center:as}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,stateValues:os}){let ls=[],us=await os.center;for(let cs in ns.center){let ps=Number(cs),ds=is[cs].vertex0,fs=is[cs].vertex2,hs=ns.center[ps].subtract(us[ps]),ys=ds.add(hs).simplify(),gs=fs.add(hs).simplify();ls.push({setDependency:as[cs].vertex0,desiredValue:ys},{setDependency:as[cs].vertex2,desiredValue:gs})}return{success:!0,instructions:ls}}},ts.width={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_1"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_1"}}},definition({dependencyValues:ns}){let is=ns.vertex0.evaluate_to_constant(),as=ns.vertex2.evaluate_to_constant();return{setValue:{width:Math.abs(is-as)}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){let as=is.vertex0.evaluate_to_constant(),os=is.vertex2.evaluate_to_constant(),ls=(os+as)/2,cs=(os-as<0?-1:1)*Math.max(0,ns.width)/2,ps=Context.fromAst(ls-cs),ds=Context.fromAst(ls+cs);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:ps},{setDependency:"vertex2",desiredValue:ds}]}}},ts.height={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_2"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_2"}}},definition({dependencyValues:ns}){let is=ns.vertex0.evaluate_to_constant(),as=ns.vertex2.evaluate_to_constant();return{setValue:{height:Math.abs(is-as)}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){let as=is.vertex0.evaluate_to_constant(),os=is.vertex2.evaluate_to_constant(),ls=(os+as)/2,cs=(os-as<0?-1:1)*Math.max(0,ns.height)/2,ps=Context.fromAst(ls-cs),ds=Context.fromAst(ls+cs);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:ps},{setDependency:"vertex2",desiredValue:ds}]}}},ts.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="vertexX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="vertices")return ns.length===1?"vertex"+ns[0]:`vertexX${ns[0]}_${ns[1]}`;if(is.slice(0,6)==="vertex"){let as=Number(is.slice(6));if(Number.isInteger(as)&&as>0)return`vertexX${as}_${ns[0]}`}return null},stateVariablesDeterminingDependencies:["nVerticesSpecified","haveSpecifiedCenter"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[4,2]},returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={},os={nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}};if(is.nVerticesSpecified===0)if(os.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},is.haveSpecifiedCenter)for(let ls of ns){let[us,cs]=ls.split(",");as[ls]={specifiedCenter:{dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(cs)+1)}},cs==="0"?as[ls].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}:as[ls].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"}}else for(let ls of ns){let[us,cs]=ls.split(",");as[ls]={essentialVertex:{dependencyType:"stateVariable",variableName:"essentialVertexX"+(Number(cs)+1)}},cs==="0"?(us==="1"||us==="2")&&(as[ls].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(us==="2"||us==="3")&&(as[ls].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else if(is.nVerticesSpecified===1)if(os.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},is.haveSpecifiedCenter)for(let ls of ns){let[us,cs]=ls.split(","),ps="1_"+(Number(cs)+1);as[ls]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+ps]}},(cs==="0"&&us==="1"||us==="2"||cs==="1"&&us==="2"||us==="3")&&(as[ls].specifiedCenter={dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(cs)+1)})}else for(let ls of ns){let[us,cs]=ls.split(","),ps="1_"+(Number(cs)+1);as[ls]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+ps]}},cs==="0"?(us==="1"||us==="2")&&(as[ls].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(us==="2"||us==="3")&&(as[ls].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else for(let ls of ns){let[us,cs]=ls.split(","),ps="1_"+(Number(cs)+1),ds="2_"+(Number(cs)+1),fs;us==="0"?fs=ps:us==="2"?fs=ds:us==="1"?cs==="0"?fs=ds:fs=ps:cs==="0"?fs=ps:fs=ds,as[ls]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+fs]}}}return{dependenciesByKey:as,globalDependencies:os}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is,globalDependencyValues:as}){let os={};if(as.nVerticesSpecified===0)if(as.haveSpecifiedCenter)for(let ls of is){let[us,cs]=ls.split(","),ps=ns[ls].specifiedCenter;if(cs==="0"){let ds=ns[ls].specifiedWidth;us==="0"||us==="3"?os[ls]=ps.subtract(ds/2):os[ls]=ps.add(ds/2)}else{let ds=ns[ls].specifiedHeight;us==="0"||us==="1"?os[ls]=ps.subtract(ds/2):os[ls]=ps.add(ds/2)}}else for(let ls of is){let[us,cs]=ls.split(","),ps=ns[ls].essentialVertex;if(cs==="0")if(us==="0"||us==="3")os[ls]=ps;else{let ds=ns[ls].specifiedWidth;os[ls]=ps.add(ds)}else if(us==="0"||us==="1")os[ls]=ps;else{let ds=ns[ls].specifiedHeight;os[ls]=ps.add(ds)}}else if(as.nVerticesSpecified===1)if(as.haveSpecifiedCenter)for(let ls of is){let[us,cs]=ls.split(","),ps=ns[ls].verticesAttr,ds;if(ps!==null&&Object.keys(ps.stateValues).length===1?ds=Object.values(ps.stateValues)[0]:ds=Context.fromAst(""),cs==="0"&&(us==="0"||us==="3")||cs==="1"&&(us==="0"||us==="1"))os[ls]=ds;else{let fs=ns[ls].specifiedCenter;os[ls]=ds.add(fs.subtract(ds).multiply(2))}}else for(let ls of is){let[us,cs]=ls.split(","),ps=ns[ls].verticesAttr,ds;if(ps!==null&&Object.keys(ps.stateValues).length===1?ds=Object.values(ps.stateValues)[0]:ds=Context.fromAst(""),cs==="0")if(us==="0"||us==="3")os[ls]=ds;else{let fs=ns[ls].specifiedWidth;os[ls]=ds.add(fs)}else if(us==="0"||us==="1")os[ls]=ds;else{let fs=ns[ls].specifiedHeight;os[ls]=ds.add(fs)}}else for(let ls of is){let us=ns[ls].verticesAttr;us!==null&&Object.keys(us.stateValues).length===1?os[ls]=Object.values(us.stateValues)[0]:os[ls]=Context.fromAst("")}return{setValue:{vertices:os}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyValuesByKey:is,globalDependencyValues:as,stateValues:os,workspace:ls,initialChange:us,dependencyNamesByKey:cs}){if(!ls.v0){let vs=await os.vertices;ls.v0=[...vs[0]],ls.v2=[...vs[2]]}let ps,ds,fs,hs,ys,gs;for(let vs in ns.vertices){let[Ns,Ts]=vs.split(","),Cs=ns.vertices[vs];Ns==="0"?ls.v0[Number(Ts)]=Cs:Ns==="2"?ls.v2[Number(Ts)]=Cs:Ns==="1"?Ts==="0"?ls.v2[Number(Ts)]=Cs:ls.v0[Number(Ts)]=Cs:Ts==="0"?ls.v0[Number(Ts)]=Cs:ls.v2[Number(Ts)]=Cs,Ts==="0"?(ps=vs,Ns==="0"||Ns==="3"?fs=vs:ys=vs):(ds=vs,Ns==="0"||Ns==="1"?hs=vs:gs=vs)}let bs=[];if(as.nVerticesSpecified===0)if(as.haveSpecifiedCenter){if(ps!==void 0){let vs=ls.v2[0].subtract(ls.v0[0]).evaluate_to_constant(),Ns=ls.v2[0].add(ls.v0[0]).divide(2).simplify();bs.push({setDependency:cs[ps].specifiedWidth,desiredValue:vs},{setDependency:cs[ps].specifiedCenter,desiredValue:Ns})}if(ds!==void 0){let vs=ls.v2[1].subtract(ls.v0[1]).evaluate_to_constant(),Ns=ls.v2[1].add(ls.v0[1]).divide(2).simplify();bs.push({setDependency:cs[ds].specifiedHeight,desiredValue:vs},{setDependency:cs[ds].specifiedCenter,desiredValue:Ns})}}else{if(fs!==void 0){let vs=ls.v0[0].simplify();bs.push({setDependency:cs[fs].essentialVertex,desiredValue:vs})}if(ys!==void 0){let vs=ls.v2[0].subtract(ls.v0[0]).evaluate_to_constant();bs.push({setDependency:cs[ys].specifiedWidth,desiredValue:vs})}if(hs!==void 0){let vs=ls.v0[1].simplify();bs.push({setDependency:cs[hs].essentialVertex,desiredValue:vs})}if(gs!==void 0){let vs=ls.v2[1].subtract(ls.v0[1]).evaluate_to_constant();bs.push({setDependency:cs[gs].specifiedHeight,desiredValue:vs})}}else if(as.nVerticesSpecified===1)if(as.haveSpecifiedCenter){if(fs!==void 0){let vs=ls.v0[0].simplify();bs.push({setDependency:cs[fs].verticesAttr,desiredValue:vs,variableIndex:0})}if(ys!==void 0){let vs=ls.v2[0].add(ls.v0[0]).divide(2).simplify();bs.push({setDependency:cs[ys].specifiedCenter,desiredValue:vs})}if(hs!==void 0){let vs=ls.v0[1].simplify();bs.push({setDependency:cs[hs].verticesAttr,desiredValue:vs,variableIndex:0})}if(gs!==void 0){let vs=ls.v2[1].add(ls.v0[1]).divide(2).simplify();bs.push({setDependency:cs[gs].specifiedCenter,desiredValue:vs})}}else{if(fs!==void 0){let vs=ls.v0[0].simplify();bs.push({setDependency:cs[fs].verticesAttr,desiredValue:vs,variableIndex:0})}if(ys!==void 0){let vs=ls.v2[0].subtract(ls.v0[0]).evaluate_to_constant();bs.push({setDependency:cs[ys].specifiedWidth,desiredValue:vs})}if(hs!==void 0){let vs=ls.v0[1].simplify();bs.push({setDependency:cs[hs].verticesAttr,desiredValue:vs,variableIndex:0})}if(gs!==void 0){let vs=ls.v2[1].subtract(ls.v0[1]).evaluate_to_constant();bs.push({setDependency:cs[gs].specifiedHeight,desiredValue:vs})}}else fs!==void 0&&bs.push({setDependency:cs[fs].verticesAttr,desiredValue:ls.v0[0],variableIndex:0}),ys!==void 0&&bs.push({setDependency:cs[ys].verticesAttr,desiredValue:ls.v2[0],variableIndex:0}),hs!==void 0&&bs.push({setDependency:cs[hs].verticesAttr,desiredValue:ls.v0[1],variableIndex:0}),gs!==void 0&&bs.push({setDependency:cs[gs].verticesAttr,desiredValue:ls.v2[1],variableIndex:0});return{success:!0,instructions:bs}}},ts.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{nVertices:4}})},ts}async movePolygon({pointCoords:ts,transient:rs,sourceDetails:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){if(Object.keys(ts).length===1){if(!await this.stateValues.verticesDraggable)return await this.coreFunctions.resolveAction({actionId:is})}else if(!await this.stateValues.draggable)return await this.coreFunctions.resolveAction({actionId:is});let us=[],cs={};for(let ps in ts)cs[ps+",0"]=Context.fromAst(ts[ps][0]),cs[ps+",1"]=Context.fromAst(ts[ps][1]);if(us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:cs,sourceDetails:ns}),Object.keys(ts).length===1){let ps=Number(Object.keys(ts)[0]),ds=Context.fromAst(ts[ps][0]),fs=Context.fromAst(ts[ps][1]),hs=(ps+2)%4,ys=await this.stateValues.vertices,gs=ys[hs][0],bs=ys[hs][1];if(await this.stateValues.nVerticesSpecified<2)if(await this.stateValues.haveSpecifiedCenter){let vs,Ns;ps===0?(vs=ds.add(gs).divide(2),Ns=fs.add(bs).divide(2)):ps===1?Ns=fs.add(bs).divide(2):ps===3&&(vs=ds.add(gs).divide(2)),vs!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{0:vs.simplify()}}),Ns!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{1:Ns.simplify()}})}else{let vs,Ns;ps===0?(vs=gs.subtract(ds),Ns=bs.subtract(fs)):ps===1?Ns=bs.subtract(fs):ps===3&&(vs=gs.subtract(ds)),vs!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedWidth",value:vs.simplify()}),Ns!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedHeight",value:Ns.simplify()})}}return rs?await this.coreFunctions.performUpdate({updateInstructions:us,transient:rs,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:us,actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:ts}}})}}Ms(Rectangle,"componentType","rectangle"),Ms(Rectangle,"rendererType","polygon");class RegularPolygon extends Polygon{static createAttributesObject(){let ts=super.createAttributesObject();return ts.nVertices={createComponentOfType:"number",createStateVariable:"nVertices",defaultValue:3,public:!0,forRenderer:!0},ts.center={createComponentOfType:"point"},ts.circumradius={createComponentOfType:"number"},ts.radius={createComponentOfType:"number"},ts.inradius={createComponentOfType:"number"},ts.apothem={createComponentOfType:"number"},ts.sideLength={createComponentOfType:"number"},ts.perimeter={createComponentOfType:"number"},ts.area={createComponentOfType:"number"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();delete ts.nVertices;let rs=ts.styleDescriptionWithNoun.returnDependencies();rs.nSides={dependencyType:"stateVariable",variableName:"nSides"},ts.styleDescriptionWithNoun.returnDependencies=()=>rs;let ns=ts.styleDescriptionWithNoun.definition;return ts.styleDescriptionWithNoun.definition=function({dependencyValues:is}){let as=ns({dependencyValues:is}).setValue.styleDescriptionWithNoun;return as=as.replaceAll("polygon",`${is.nSides}-sided regular polygon`),{setValue:{styleDescriptionWithNoun:as}}},ts.nVerticesSpecified={returnDependencies:()=>({verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:is}){return is.verticesAttr!==null?{setValue:{nVerticesSpecified:is.verticesAttr.stateValues.nPoints}}:{setValue:{nVerticesSpecified:0}}}},ts.essentialDirection={isArray:!0,entryPrefixes:["essentialVertexX"],defaultValueByArrayKey:()=>0,hasEssential:!0,returnArraySizeDependencies:()=>({nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:is}){return[(is.haveSpecifiedCenter?1:0)+is.nVerticesSpecified<=1?2:0]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:is}){let as={};for(let os of is)os==="0"?as[os]={defaultValue:1}:as[os]=!0;return{useEssentialOrDefaultValue:{essentialDirection:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:is}){let as=[];for(let os in is.essentialDirection)as.push({setEssentialValue:"essentialDirection",value:{[os]:is.essentialDirection[os]}});return{success:!0,instructions:as}}},ts.haveSpecifiedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:is})=>({setValue:{haveSpecifiedCenter:is.centerAttr!==null}})},ts.specifiedCenter={isArray:!0,entryPrefixes:["specifiedCenterX"],returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:is}){return[is.haveSpecifiedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:is}){let as={};for(let os of is){let ls=Number(os)+1;as[os]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+ls]}}}return{dependenciesByKey:as}},arrayDefinitionByKey:function({dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as){let us=Number(ls)+1;is[ls].centerAttr!==null&&(os[ls]=is[ls].centerAttr.stateValues["x"+us].evaluate_to_constant())}return{setValue:{specifiedCenter:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:is,dependencyValuesByKey:as,dependencyNamesByKey:os}){let ls=[];for(let us in is.specifiedCenter)as[us].centerAttr&&as[us].centerAttr!==null&&ls.push({setDependency:os[us].centerAttr,desiredValue:Context.fromAst(is.specifiedCenter[us]),variableIndex:0});return{success:!0,instructions:ls}}},ts.essentialCenter={isArray:!0,entryPrefixes:["essentialCenterX"],defaultValueByArrayKey:()=>0,hasEssential:!0,returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:is}){return[is.haveSpecifiedCenter?0:2]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:is}){let as={};for(let os of is)as[os]=!0;return{useEssentialOrDefaultValue:{essentialCenter:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:is}){let as=[];for(let os in is.essentialCenter)as.push({setEssentialValue:"essentialCenter",value:{[os]:is.essentialCenter[os]}});return{success:!0,instructions:as}}},ts.specifiedCircumradius={returnDependencies(){return{circumradiusAttr:{dependencyType:"attributeComponent",attributeName:"circumradius",variableNames:["value"]},radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}},definition({dependencyValues:is}){return is.circumradiusAttr!==null?{setValue:{specifiedCircumradius:is.circumradiusAttr.stateValues.value}}:is.radiusAttr!==null?{setValue:{specifiedCircumradius:is.radiusAttr.stateValues.value}}:{setValue:{specifiedCircumradius:null}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.circumradiusAttr!==null?{success:!0,instructions:[{setDependency:"circumradiusAttr",desiredValue:is.specifiedCircumradius,childIndex:0,variableIndex:0}]}:as.radiusAttr!==null?{success:!0,instructions:[{setDependency:"radiusAttr",desiredValue:is.specifiedCircumradius,childIndex:0,variableIndex:0}]}:{success:!1}}},ts.specifiedInradius={returnDependencies(){return{inradiusAttr:{dependencyType:"attributeComponent",attributeName:"inradius",variableNames:["value"]},apothemAttr:{dependencyType:"attributeComponent",attributeName:"apothem",variableNames:["value"]}}},definition({dependencyValues:is}){return is.inradiusAttr!==null?{setValue:{specifiedInradius:is.inradiusAttr.stateValues.value}}:is.apothemAttr!==null?{setValue:{specifiedInradius:is.apothemAttr.stateValues.value}}:{setValue:{specifiedInradius:null}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.inradiusAttr!==null?{success:!0,instructions:[{setDependency:"inradiusAttr",desiredValue:is.specifiedInradius,childIndex:0,variableIndex:0}]}:as.apothemAttr!==null?{success:!0,instructions:[{setDependency:"apothemAttr",desiredValue:is.specifiedInradius,childIndex:0,variableIndex:0}]}:{sucess:!1}}},ts.specifiedSideLength={returnDependencies(){return{sideLengthAttr:{dependencyType:"attributeComponent",attributeName:"sideLength",variableNames:["value"]}}},definition({dependencyValues:is}){return is.sideLengthAttr!==null?{setValue:{specifiedSideLength:is.sideLengthAttr.stateValues.value}}:{setValue:{specifiedSideLength:null}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.sideLengthAttr!==null?{success:!0,instructions:[{setDependency:"sideLengthAttr",desiredValue:is.specifiedSideLength,childIndex:0,variableIndex:0}]}:{sucess:!1}}},ts.specifiedPerimeter={returnDependencies(){return{perimeterAttr:{dependencyType:"attributeComponent",attributeName:"perimeter",variableNames:["value"]}}},definition({dependencyValues:is}){return is.perimeterAttr!==null?{setValue:{specifiedPerimeter:is.perimeterAttr.stateValues.value}}:{setValue:{specifiedPerimeter:null}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.perimeterAttr!==null?{success:!0,instructions:[{setDependency:"perimeterAttr",desiredValue:is.specifiedPerimeter,childIndex:0,variableIndex:0}]}:{sucess:!1}}},ts.specifiedArea={returnDependencies(){return{areaAttr:{dependencyType:"attributeComponent",attributeName:"area",variableNames:["value"]}}},definition({dependencyValues:is}){return is.areaAttr!==null?{setValue:{specifiedArea:is.areaAttr.stateValues.value}}:{setValue:{specifiedArea:null}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){return as.areaAttr!==null?{success:!0,instructions:[{setDependency:"areaAttr",desiredValue:is.specifiedArea,childIndex:0,variableIndex:0}]}:{sucess:!1}}},ts.essentialCircumradius={hasEssential:!0,defaultValue:1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{essentialCircumradius:!0}}),inverseDefinition({desiredStateVariableValues:is}){return{success:!0,instructions:[{setEssentialValue:"essentialCircumradius",value:is.essentialCircumradius}]}}},ts.centerComponents={additionalStateVariablesDefined:["directionWithRadius"],returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},specifiedCircumradius:{dependencyType:"stateVariable",variableName:"specifiedCircumradius"},specifiedInradius:{dependencyType:"stateVariable",variableName:"specifiedInradius"},specifiedSideLength:{dependencyType:"stateVariable",variableName:"specifiedSideLength"},specifiedPerimeter:{dependencyType:"stateVariable",variableName:"specifiedPerimeter"},specifiedArea:{dependencyType:"stateVariable",variableName:"specifiedArea"},essentialCircumradius:{dependencyType:"stateVariable",variableName:"essentialCircumradius"},essentialDirection:{dependencyType:"stateVariable",variableName:"essentialDirection"},verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["points"]},specifiedCenter:{dependencyType:"stateVariable",variableName:"specifiedCenter"},essentialCenter:{dependencyType:"stateVariable",variableName:"essentialCenter"}}),definition({dependencyValues:is}){let as=is.nVertices,os,ls;if(is.nVerticesSpecified===0){is.haveSpecifiedCenter?os=is.specifiedCenter:os=is.essentialCenter;let us;is.specifiedCircumradius!==null?us=is.specifiedCircumradius:is.specifiedInradius!==null?us=is.specifiedInradius/Math.cos(Math.PI/as):is.specifiedSideLength!==null?us=is.specifiedSideLength/(2*Math.sin(Math.PI/as)):is.specifiedPerimeter!==null?us=is.specifiedPerimeter/(2*as*Math.sin(Math.PI/as)):is.specifiedArea!==null?us=Math.sqrt(is.specifiedArea/(as/2*Math.sin(2*Math.PI/as))):us=is.essentialCircumradius,ls=is.essentialDirection.map(cs=>cs*us)}else if(is.haveSpecifiedCenter){os=is.specifiedCenter;let us=is.verticesAttr.stateValues.points[0].map(cs=>cs.evaluate_to_constant());ls=[us[0]-os[0],us[1]-os[1]]}else if(is.nVerticesSpecified===1){let us;is.specifiedCircumradius!==null?us=is.specifiedCircumradius:is.specifiedInradius!==null?us=is.specifiedInradius/Math.cos(Math.PI/as):is.specifiedSideLength!==null?us=is.specifiedSideLength/(2*Math.sin(Math.PI/as)):is.specifiedPerimeter!==null?us=is.specifiedPerimeter/(2*as*Math.sin(Math.PI/as)):is.specifiedArea!==null?us=Math.sqrt(is.specifiedArea/(as/2*Math.sin(2*Math.PI/as))):us=is.essentialCircumradius,ls=is.essentialDirection.map(ps=>ps*us);let cs=is.verticesAttr.stateValues.points[0].map(ps=>ps.evaluate_to_constant());os=[cs[0]-ls[0],cs[1]-ls[1]]}else{let us=is.verticesAttr.stateValues.points[0].map(gs=>gs.evaluate_to_constant()),cs=is.verticesAttr.stateValues.points[1].map(gs=>gs.evaluate_to_constant()),ps=[cs[0]-us[0],cs[1]-us[1]],ds=[(us[0]+cs[0])/2,(us[1]+cs[1])/2],fs=Math.sqrt(ps[0]**2+ps[1]**2),hs=fs/(2*Math.tan(Math.PI/as)),ys=[-ps[1]/fs,ps[0]/fs];os=[ds[0]+ys[0]*hs,ds[1]+ys[1]*hs],ls=[us[0]-os[0],us[1]-os[1]]}return{setValue:{centerComponents:os,directionWithRadius:ls}}},async inverseDefinition({desiredStateVariableValues:is,dependencyValues:as,workspace:os,stateValues:ls}){let us=as.nVertices,cs=[],ps=is.centerComponents;ps||(ps=os.desiredCenter),ps||(ps=(await ls.center).map(fs=>fs.evaluate_to_constant()));let ds=is.directionWithRadius;if(ds||(ds=os.desiredDirectionWithRadius),!ds){let fs=(await ls.center).map(ys=>ys.evaluate_to_constant()),hs=(await ls.vertices)[0].map(ys=>ys.evaluate_to_constant());ds=[hs[0]-fs[0],hs[1]-fs[1]]}if(os.desiredCenter=ps,os.desiredDirectionWithRadius=ds,as.nVerticesSpecified===0){as.haveSpecifiedCenter?cs.push({setDependency:"specifiedCenter",desiredValue:ps}):cs.push({setDependency:"essentialCenter",desiredValue:ps});let fs=Math.sqrt(ds[0]**2+ds[1]**2),hs=ds.map(ys=>ys/fs);as.specifiedCircumradius!==null?cs.push({setDependency:"specifiedCircumradius",desiredValue:fs}):as.specifiedInradius!==null?cs.push({setDependency:"specifiedInradius",desiredValue:fs*Math.cos(Math.PI/us)}):as.specifiedSideLength!==null?cs.push({setDependency:"specifiedSideLength",desiredValue:fs*(2*Math.sin(Math.PI/us))}):as.specifiedPerimeter!==null?cs.push({setDependency:"specifiedPerimeter",desiredValue:fs*(2*us*Math.sin(Math.PI/us))}):as.specifiedArea!==null?cs.push({setDependency:"specifiedArea",desiredValue:fs**2*(us/2*Math.sin(2*Math.PI/us))}):cs.push({setDependency:"essentialCircumradius",desiredValue:fs}),cs.push({setDependency:"essentialDirection",desiredValue:hs})}else if(as.haveSpecifiedCenter){cs.push({setDependency:"specifiedCenter",desiredValue:ps});let fs={"0,0":Context.fromAst(ds[0]+ps[0]),"0,1":Context.fromAst(ds[1]+ps[1])};cs.push({setDependency:"verticesAttr",desiredValue:fs,variableIndex:0})}else if(as.nVerticesSpecified===1){let fs=Math.sqrt(ds[0]**2+ds[1]**2),hs=ds.map(gs=>gs/fs);as.specifiedCircumradius!==null?cs.push({setDependency:"specifiedCircumradius",desiredValue:fs}):as.specifiedInradius!==null?cs.push({setDependency:"specifiedInradius",desiredValue:fs*Math.cos(Math.PI/us)}):as.specifiedSideLength!==null?cs.push({setDependency:"specifiedSideLength",desiredValue:fs*(2*Math.sin(Math.PI/us))}):as.specifiedPerimeter!==null?cs.push({setDependency:"specifiedPerimeter",desiredValue:fs*(2*us*Math.sin(Math.PI/us))}):as.specifiedArea!==null?cs.push({setDependency:"specifiedArea",desiredValue:fs**2*(us/2*Math.sin(2*Math.PI/us))}):cs.push({setDependency:"essentialCircumradius",desiredValue:fs}),cs.push({setDependency:"essentialDirection",desiredValue:hs});let ys={"0,0":Context.fromAst(ds[0]+ps[0]),"0,1":Context.fromAst(ds[1]+ps[1])};cs.push({setDependency:"verticesAttr",desiredValue:ys,variableIndex:0})}else{let fs=2*Math.PI/us,hs=Math.cos(fs),ys=Math.sin(fs),gs=[ds[0]*hs-ds[1]*ys,ds[0]*ys+ds[1]*hs],bs={"0,0":Context.fromAst(ds[0]+ps[0]),"0,1":Context.fromAst(ds[1]+ps[1]),"1,0":Context.fromAst(gs[0]+ps[0]),"1,1":Context.fromAst(gs[1]+ps[1])};cs.push({setDependency:"verticesAttr",desiredValue:bs,variableIndex:0})}return{success:!0,instructions:cs}}},ts.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(is){return is==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:is,varEnding:as,arraySize:os}){if(is==="vertexX"){let ls=as.split("_").map(us=>Number(us)-1);return ls.length===2&&ls.every((us,cs)=>Number.isInteger(us)&&us>=0)?os?ls.every((us,cs)=>us<os[cs])?[String(ls)]:[]:[String(ls)]:[]}else{let ls=Number(as)-1;return Number.isInteger(ls)&&ls>=0?os?ls<os[0]?Array.from(Array(os[1]),(us,cs)=>ls+","+cs):[]:[ls+",0"]:[]}},arrayVarNameFromPropIndex(is,as){if(as==="vertices")return is.length===1?"vertex"+is[0]:`vertexX${is[0]}_${is[1]}`;if(as.slice(0,6)==="vertex"){let os=Number(as.slice(6));if(Number.isInteger(os)&&os>0)return`vertexX${os}_${is[0]}`}return null},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:is}){return[is.nVertices,2]},returnArrayDependenciesByKey(){return{globalDependencies:{nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},centerComponents:{dependencyType:"stateVariable",variableName:"centerComponents"},directionWithRadius:{dependencyType:"stateVariable",variableName:"directionWithRadius"}}}},arrayDefinitionByKey({globalDependencyValues:is}){let as=is.nVertices,os=is.centerComponents,ls=is.directionWithRadius,us={};if(os.some(cs=>!Number.isFinite(cs))||ls.some(cs=>!Number.isFinite(cs)))for(let cs=0;cs<as;cs++)us[`${cs},0`]=Context.fromAst(""),us[`${cs},1`]=Context.fromAst("");else for(let cs=0;cs<as;cs++){let ps=cs*2*Math.PI/as,ds=Math.sin(ps),fs=Math.cos(ps);us[`${cs},0`]=Context.fromAst(os[0]+ls[0]*fs-ls[1]*ds),us[`${cs},1`]=Context.fromAst(os[1]+ls[0]*ds+ls[1]*fs)}return{setValue:{vertices:us}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:is,globalDependencyValues:as,stateValues:os,workspace:ls}){let us=as.nVertices;ls.desiredVertices||(ls.desiredVertices={}),Object.assign(ls.desiredVertices,is.vertices);let cs=Object.keys(ls.desiredVertices),ps=cs[0].split(",")[0],ds=cs.every(ws=>ws.split(",")[0]===ps),fs;if(ds)fs=(await os.center).map(ws=>ws.evaluate_to_constant());else{ls.allVertices||(ls.allVertices={}),Object.assign(ls.allVertices,ls.desiredVertices);let ws=0,Es=0;for(let Ss=0;Ss<us;Ss++){let Ds=ls.allVertices[Ss+",0"];Ds||(Ds=(await os.vertices)[Ss][0],ls.allVertices[Ss+",0"]=Ds);let Vs=ls.allVertices[Ss+",1"];Vs||(Vs=(await os.vertices)[Ss][1],ls.allVertices[Ss+",1"]=Vs),ws+=Ds.evaluate_to_constant(),Es+=Vs.evaluate_to_constant()}ws/=us,Es/=us,fs=[ws,Es]}let hs=Number(ps),ys=ls.desiredVertices[ps+",0"];ys||(ys=(await os.vertices)[hs][0]);let gs=ls.desiredVertices[ps+",1"];gs||(gs=(await os.vertices)[hs][1]);let bs=[ys.evaluate_to_constant(),gs.evaluate_to_constant()],vs=[bs[0]-fs[0],bs[1]-fs[1]],Ns=-hs*2*Math.PI/us,Ts=Math.cos(Ns),Cs=Math.sin(Ns),xs=[vs[0]*Ts-vs[1]*Cs,vs[0]*Cs+vs[1]*Ts];return{success:!0,instructions:[{setDependency:"centerComponents",desiredValue:fs},{setDependency:"directionWithRadius",desiredValue:xs}]}}},ts.center={public:!0,isArray:!0,entryPrefixes:["centerX"],shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(is){return is==="centerX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey(){return{globalDependencies:{centerComponents:{dependencyType:"stateVariable",variableName:"centerComponents"}}}},arrayDefinitionByKey({globalDependencyValues:is}){return{setValue:{center:is.centerComponents.map(as=>Context.fromAst(as))}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:is,stateValues:as,workspace:os}){let ls=is.center[0];ls||(ls=os.desired_center_x),ls||(ls=(await as.center)[0]),os.desired_center_x=ls;let us=is.center[1];return us||(us=os.desired_center_y),us||(us=(await as.center)[1]),os.desired_center_y=us,{success:!0,instructions:[{setDependency:"centerComponents",desiredValue:[ls.evaluate_to_constant(),us.evaluate_to_constant()]}]}}},ts.circumradius={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({center:{dependencyType:"stateVariable",variableName:"center"},vertex1:{dependencyType:"stateVariable",variableName:"vertex1"}}),definition({dependencyValues:is}){let as=is.center.map(us=>us.evaluate_to_constant()),os=is.vertex1.map(us=>us.evaluate_to_constant());return{setValue:{circumradius:Math.sqrt((os[0]-as[0])**2+(os[1]-as[1])**2)}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){let os=as.center.map(hs=>hs.evaluate_to_constant()),ls=as.vertex1.map(hs=>hs.evaluate_to_constant()),us=[ls[0]-os[0],ls[1]-os[1]],cs=Math.sqrt(us[0]**2+us[1]**2),ps=is.circumradius,ds=us.map(hs=>hs/cs*ps);return{success:!0,instructions:[{setDependency:"vertex1",desiredValue:[Context.fromAst(ds[0]+os[0]),Context.fromAst(ds[1]+os[1])]}]}}},ts.radius={isAlias:!0,targetVariableName:"circumradius"},ts.inradius={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({circumradius:{dependencyType:"stateVariable",variableName:"circumradius"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:is}){let as=is.circumradius,os=is.nVertices;return{setValue:{inradius:as*Math.cos(Math.PI/os)}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){let os=is.inradius,ls=as.nVertices;return{success:!0,instructions:[{setDependency:"circumradius",desiredValue:os/Math.cos(Math.PI/ls)}]}}},ts.apothem={isAlias:!0,targetVariableName:"inradius"},ts.sideLength={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({circumradius:{dependencyType:"stateVariable",variableName:"circumradius"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:is}){let as=is.circumradius,os=is.nVertices;return{setValue:{sideLength:as*(2*Math.sin(Math.PI/os))}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){let os=is.sideLength,ls=as.nVertices;return{success:!0,instructions:[{setDependency:"circumradius",desiredValue:os/(2*Math.sin(Math.PI/ls))}]}}},ts.perimeter={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({circumradius:{dependencyType:"stateVariable",variableName:"circumradius"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:is}){let as=is.circumradius,os=is.nVertices;return{setValue:{perimeter:as*(2*os*Math.sin(Math.PI/os))}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){let os=is.perimeter,ls=as.nVertices;return{success:!0,instructions:[{setDependency:"circumradius",desiredValue:os/(2*ls*Math.sin(Math.PI/ls))}]}}},ts.area={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({circumradius:{dependencyType:"stateVariable",variableName:"circumradius"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:is}){let as=is.circumradius,os=is.nVertices;return{setValue:{area:as**2*(os/2*Math.sin(2*Math.PI/os))}}},inverseDefinition({desiredStateVariableValues:is,dependencyValues:as}){let os=is.area,ls=as.nVertices;return{success:!0,instructions:[{setDependency:"circumradius",desiredValue:Math.sqrt(os/(ls/2*Math.sin(2*Math.PI/ls)))}]}}},ts.nSides={isAlias:!0,targetVariableName:"nVertices"},ts}}Ms(RegularPolygon,"componentType","regularPolygon"),Ms(RegularPolygon,"rendererType","polygon");class Circle extends Curve{constructor(ts){super(ts),Object.assign(this.actions,{moveCircle:this.moveCircle.bind(this),circleClicked:this.circleClicked.bind(this),mouseDownOnCircle:this.mouseDownOnCircle.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.through={createComponentOfType:"_pointListComponent"},ts.center={createComponentOfType:"point"},ts.radius={createComponentOfType:"math"},ts.filled={createComponentOfType:"boolean",createStateVariable:"filled",defaultValue:!1,public:!0,forRenderer:!0},delete ts.parMin,delete ts.parMax,delete ts.variable,ts}static returnChildGroups(){return GraphicalComponent.returnChildGroups()}static returnStateVariableDefinitions(ts){let rs=GraphicalComponent.returnStateVariableDefinitions(ts);return rs.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var ls,us;let is;((ls=ns.document)==null?void 0:ls.stateValues.theme)==="dark"?is=ns.selectedStyle.lineColorWordDarkMode:is=ns.selectedStyle.lineColorWord;let as=ns.selectedStyle.lineWidthWord;ns.selectedStyle.lineStyleWord&&(as&&(as+=" "),as+=ns.selectedStyle.lineStyleWord),as&&(as+=" ");let os;if(!ns.filled)os=as+is;else{let cs;((us=ns.document)==null?void 0:us.stateValues.theme)==="dark"?cs=ns.selectedStyle.fillColorWordDarkMode:cs=ns.selectedStyle.fillColorWord,cs===is?(os="filled "+cs,as&&(os+=" with "+as+"border")):os="filled "+cs+" with "+as+is+" border"}return{setValue:{styleDescription:os}}}},rs.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var ls,us;let is;((ls=ns.document)==null?void 0:ls.stateValues.theme)==="dark"?is=ns.selectedStyle.lineColorWordDarkMode:is=ns.selectedStyle.lineColorWord;let as=ns.selectedStyle.lineWidthWord;ns.selectedStyle.lineStyleWord&&(as&&(as+=" "),as+=ns.selectedStyle.lineStyleWord),as&&(as+=" ");let os;if(!ns.filled)os=as+is+" circle";else{let cs;((us=ns.document)==null?void 0:us.stateValues.theme)==="dark"?cs=ns.selectedStyle.fillColorWordDarkMode:cs=ns.selectedStyle.fillColorWord,cs===is?(os="filled "+cs+" circle",as&&(os+=" with a "+as+"border")):os="filled "+cs+" circle with a "+as+is+" border"}return{setValue:{styleDescriptionWithNoun:os}}}},rs.borderStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var os;let is;((os=ns.document)==null?void 0:os.stateValues.theme)==="dark"?is=ns.selectedStyle.lineColorWordDarkMode:is=ns.selectedStyle.lineColorWord;let as=ns.selectedStyle.lineWidthWord;return ns.selectedStyle.lineStyleWord&&(as&&(as+=" "),as+=ns.selectedStyle.lineStyleWord),as&&(as+=" "),as+=is,{setValue:{borderStyleDescription:as}}}},rs.fillStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},filled:{dependencyType:"stateVariable",variableName:"filled"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:ns}){var os;let is;((os=ns.document)==null?void 0:os.stateValues.theme)==="dark"?is=ns.selectedStyle.fillColorWordDarkMode:is=ns.selectedStyle.fillColorWord;let as;return ns.filled?as=is:as="unfilled",{setValue:{fillStyleDescription:as}}}},rs.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{curveType:"circle"}})},rs.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMax:NaN}})},rs.parMin={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMin:NaN}})},rs.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[0],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:()=>({setValue:{fs:{}}})},rs.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:ns}){return ns.throughAttr!==null?{setValue:{nThroughPoints:ns.throughAttr.stateValues.nPoints}}:{setValue:{nThroughPoints:0}}}},rs.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:is,arraySize:as}){if(ns==="throughPointX"){let os=is.split("_").map(ls=>Number(ls)-1);return os.length===2&&os.every((ls,us)=>Number.isInteger(ls)&&ls>=0)?as?os.every((ls,us)=>ls<as[us])?[String(os)]:[]:[String(os)]:[]}else{let os=Number(is)-1;return Number.isInteger(os)&&os>=0?as?os<as[0]?Array.from(Array(as[1]),(ls,us)=>os+","+us):[]:[os+",0"]:[]}},arrayVarNameFromPropIndex(ns,is){if(is==="throughPoints")return ns.length===1?"throughPoint"+ns[0]:`throughPointX${ns[0]}_${ns[1]}`;if(is.slice(0,12)==="throughPoint"){let as=Number(is.slice(12));if(Number.isInteger(as)&&as>0)return`throughPointX${as}_${ns[0]}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:ns}){return[ns.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let[os,ls]=as.split(","),us=Number(os)+1+"_"+(Number(ls)+1);is[as]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+us]}}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let[ls,us]=os.split(","),cs=Number(ls)+1+"_"+(Number(us)+1),ps=ns[os].throughAttr;ps!==null&&ps.stateValues["pointX"+cs]?as[os]=ps.stateValues["pointX"+cs]:as[os]=Context.fromAst("")}return{setValue:{throughPoints:as}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,initialChange:os,stateValues:ls}){if(os&&!await ls.draggable)return{success:!1};let us=[];for(let cs in ns.throughPoints){let[ps,ds]=cs.split(","),fs=Number(ps)+1+"_"+(Number(ds)+1);if(is[cs].throughAttr!==null&&is[cs].throughAttr.stateValues["pointX"+fs])us.push({setDependency:as[cs].throughAttr,desiredValue:ns.throughPoints[cs],variableIndex:0});else return{success:!1}}return{success:!0,instructions:us}}},rs.havePrescribedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:ns})=>({setValue:{havePrescribedCenter:ns.centerAttr!==null},checkForActualChange:{havePrescribedCenter:!0}})},rs.prescribedCenter={isArray:!0,entryPrefixes:["prescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:ns}){return[ns.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1;is[as]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+os]}}}return{dependenciesByKey:is}},arrayDefinitionByKey:function({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as){let us=Number(ls)+1;is[ls].centerAttr!==null&&(os[ls]=is[ls].centerAttr.stateValues["x"+us],os[ls]||(os[ls]=Context.fromAst("")))}return{setValue:{prescribedCenter:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,globalDependencyValues:is,dependencyValuesByKey:as,dependencyNamesByKey:os,arraySize:ls}){let us=[];for(let cs of Object.keys(ns.prescribedCenter).reverse())as[cs].centerAttr!==null&&us.push({setDependency:os[cs].centerAttr,desiredValue:ns.prescribedCenter[cs],variableIndex:0});return{success:!0,instructions:us}}},rs.prescribedRadius={defaultValue:null,returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius",variableNames:["value"]}}),definition:function({dependencyValues:ns}){return ns.radiusAttr!==null?{setValue:{prescribedRadius:ns.radiusAttr.stateValues.value}}:{setValue:{prescribedRadius:null}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){return is.radiusAttr!==null?{success:!0,instructions:[{setDependency:"radiusAttr",desiredValue:ns.prescribedRadius,childIndex:0,variableIndex:0}]}:{success:!1}}},rs.havePrescribedRadius={returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius"}}),definition:({dependencyValues:ns})=>({setValue:{havePrescribedRadius:ns.radiusAttr!==null},checkForActualChange:{havePrescribedRadius:!0}})},rs.numericalPrescribedRadius={returnDependencies:()=>({prescribedRadius:{dependencyType:"stateVariable",variableName:"prescribedRadius"}}),additionalStateVariablesDefined:["haveNonNumericalPrescribedRadius"],definition:function({dependencyValues:ns}){let is=!1,as;return ns.prescribedRadius===null?as=null:(as=ns.prescribedRadius.evaluate_to_constant(),Number.isFinite(as)||(as=NaN,is=!0)),{setValue:{haveNonNumericalPrescribedRadius:is,numericalPrescribedRadius:as},checkForActualChange:{haveNonNumericalEntriesNumericalRadius:!0}}},inverseDefinition:async function({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as}){return await as.haveNonNumericalPrescribedRadius?{success:!1}:ns.numericalPrescribedRadius!==void 0?is.prescribedRadius===null?{success:!1}:{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:Context.fromAst(ns.numericalPrescribedRadius)}]}:{success:!1}}},rs.numericalPrescribedCenter={isArray:!0,entryPrefixes:["numericalPrescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:ns}){return[ns.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns){let os=Number(as)+1;is[as]={prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+os}}}return{dependenciesByKey:is}},arrayDefinitionByKey:function({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=ns[os].prescribedCenterX;ls?as[os]=ls.evaluate_to_constant():as[os]=NaN}return{setValue:{numericalPrescribedCenter:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:ns,dependencyNamesByKey:is}){let as=[];for(let os in ns.numericalPrescribedCenter)as.push({setDependency:is[os].prescribedCenterX,desiredValue:Context.fromAst(ns.numericalPrescribedCenter[os])});return{success:!0,instructions:as}}},rs.haveNonNumericalPrescribedCenter={returnDependencies:()=>({numericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"}}),definition({dependencyValues:ns}){return{setValue:{haveNonNumericalPrescribedCenter:ns.numericalPrescribedCenter.some(as=>!Number.isFinite(as))},checkForActualChange:{haveNonNumericalPrescribedCenter:!0}}}},rs.numericalThroughPoints={returnDependencies:()=>({throughPoints:{dependencyType:"stateVariable",variableName:"throughPoints"}}),additionalStateVariablesDefined:["haveNonNumericalThroughPoints"],definition:function({dependencyValues:ns}){let is=!1,as=[];for(let os of ns.throughPoints){let ls=[];for(let us=0;us<2;us++){let cs;try{cs=os[us].evaluate_to_constant()}catch{console.warn("Invalid point of circle"),is=!0,ls=[];break}if(Number.isFinite(cs))ls.push(cs);else{is=!0,ls=[];break}}if(ls.length>0)as.push(ls);else{as=[];break}}return{setValue:{haveNonNumericalThroughPoints:is,numericalThroughPoints:as},checkForActualChange:{haveNonNumericalThroughPoints:!0}}},inverseDefinition:async function({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as}){if(await as.haveNonNumericalThroughPoints)return{success:!1};if(ns.numericalThroughPoints!==void 0){let os={};for(let[ls,us]of ns.numericalThroughPoints.entries())os[ls+",0"]=Context.fromAst(us[0]),os[ls+",1"]=Context.fromAst(us[1]);return{success:!0,instructions:[{setDependency:"throughPoints",desiredValue:os}]}}return{success:!1}}},rs.haveNumericalEntries={returnDependencies:()=>({haveNonNumericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},haveNonNumericalThroughPoints:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:({dependencyValues:ns})=>({setValue:{haveNumericalEntries:!(ns.haveNonNumericalPrescribedCenter||ns.haveNonNumericalPrescribedRadius||ns.haveNonNumericalThroughPoints)}})},rs.numericalRadiusCalculatedWithCenter={additionalStateVariablesDefined:["numericalCenterCalculatedWithRadius"],returnDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:function({dependencyValues:ns}){if(ns.haveNonNumericalThroughPoints){let is="Haven't implemented circle through "+ns.nThroughPoints+" points";return is+=" in case where don't have numerical values.",console.warn(is),{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}if(ns.nThroughPoints===2){let{numericalCenter:is,numericalRadius:as}=circleFromTwoNumericalPoints({point1:ns.numericalThroughPoints[0],point2:ns.numericalThroughPoints[1]});return{setValue:{numericalCenterCalculatedWithRadius:is,numericalRadiusCalculatedWithCenter:as}}}else if(ns.nThroughPoints===3){let is=ns.numericalThroughPoints[0][0],as=ns.numericalThroughPoints[1][0],os=ns.numericalThroughPoints[2][0],ls=ns.numericalThroughPoints[0][1],us=ns.numericalThroughPoints[1][1],cs=ns.numericalThroughPoints[2][1],ps,ds;if(is===as&&ls===us)if(is===os&&ls===cs)ps=[is,ls],ds=0;else{let fs=circleFromTwoNumericalPoints({point1:[is,ls],point2:[os,cs]});ps=fs.numericalCenter,ds=fs.numericalRadius}else if(is===os&&ls===cs||as===os&&us===cs){let fs=circleFromTwoNumericalPoints({point1:[is,ls],point2:[as,us]});ps=fs.numericalCenter,ds=fs.numericalRadius}else{let fs=is*is+ls*ls,hs=as*as+us*us,ys=os*os+cs*cs,gs=is*(us-cs)-ls*(as-os)+as*cs-os*us,bs=fs*(cs-us)+hs*(ls-cs)+ys*(us-ls),vs=fs*(as-os)+hs*(os-is)+ys*(is-as),Ns=fs*(os*us-as*cs)+hs*(is*cs-os*ls)+ys*(as*ls-is*us);gs!==0?(ps=[-bs/(2*gs),-vs/(2*gs)],ds=Math.sqrt((bs*bs+vs*vs-4*gs*Ns)/(4*gs*gs))):(ps=[NaN,NaN],ds=NaN)}return{setValue:{numericalCenterCalculatedWithRadius:ps,numericalRadiusCalculatedWithCenter:ds}}}else return ns.nThroughPoints>3?(console.warn("Can't calculate circle through more than 3 points"),{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}):{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}},rs.essentialRadius={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{essentialRadius:!0}}),inverseDefinition:function({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setEssentialValue:"essentialRadius",value:ns.essentialRadius}]}}},rs.numericalRadius={forRenderer:!0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnDependencies:function({stateValues:ns}){let is={haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},essentialRadius:{dependencyType:"stateVariable",variableName:"essentialRadius"}};return ns.havePrescribedRadius?(is.numericalPrescribedRadius={dependencyType:"stateVariable",variableName:"numericalPrescribedRadius"},ns.havePrescribedCenter&&ns.nThroughPoints>0&&(is.haveCenterRadiusPoints={dependencyType:"value",value:!0})):ns.havePrescribedCenter?ns.nThroughPoints===1&&(is.haveNonNumericalPrescribedCenter={dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},is.numericalPrescribedCenter={dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"},is.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},is.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}):ns.nThroughPoints>1&&(is.numericalRadiusCalculatedWithCenter={dependencyType:"stateVariable",variableName:"numericalRadiusCalculatedWithCenter"},is.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}),is},definition:function({dependencyValues:ns}){if(ns.haveNonNumericalPrescribedRadius||ns.haveNonNumericalPrescribedCenter||ns.haveNonNumericalThroughPoints)return{setValue:{numericalRadius:NaN}};if(ns.numericalPrescribedRadius!==void 0)return ns.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{numericalRadius:NaN}}):{setValue:{numericalRadius:Math.max(0,ns.numericalPrescribedRadius)}};if(ns.numericalPrescribedCenter!==void 0)if(ns.nThroughPoints===0){let is=ns.essentialRadius;return is instanceof Context.class&&(is=is.evaluate_to_constant()),{setValue:{numericalRadius:is}}}else if(ns.nThroughPoints===1){let is=ns.numericalThroughPoints[0];return is===void 0?{setValue:{numericalRadius:NaN}}:{setValue:{numericalRadius:Math.sqrt(Math.pow(is[0]-ns.numericalPrescribedCenter[0],2)+Math.pow(is[1]-ns.numericalPrescribedCenter[1],2))}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{setValue:{numericalRadius:NaN}};if(ns.nThroughPoints<2){let is=ns.essentialRadius;return is instanceof Context.class&&(is=is.evaluate_to_constant()),{setValue:{numericalRadius:is}}}else return{setValue:{numericalRadius:ns.numericalRadiusCalculatedWithCenter}}},inverseDefinition:async function({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as}){if(is.numericalPrescribedRadius!==void 0)return{success:!0,instructions:[{setDependency:"numericalPrescribedRadius",desiredValue:Math.max(0,ns.numericalRadius)}]};if(is.numericalPrescribedCenter!==void 0){if(is.nThroughPoints===0)return{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:Math.max(0,ns.numericalRadius)}]};if(is.nThroughPoints===1){let os=Math.max(0,ns.numericalRadius),ls=(await as.throughAngles)[0];if(!Number.isFinite(ls))return{success:!1};let us=await as.numericalCenter;return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:[[us[0]+os*Math.cos(ls),us[1]+os*Math.sin(ls)]]}]}}else return{success:!1}}if(is.nThroughPoints<2)return{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:Math.max(0,ns.numericalRadius)}]};{let os=[],ls=Math.max(0,ns.numericalRadius);for(let us=0;us<is.nThroughPoints;us++){let cs=(await as.throughAngles)[us];if(!Number.isFinite(cs))return{success:!1};let ps=await as.numericalCenter,ds=[ps[0]+ls*Math.cos(cs),ps[1]+ls*Math.sin(cs)];os.push(ds)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:os}]}}}},rs.essentialCenter={isArray:!0,entryPrefixes:["essentialCenterX"],hasEssential:!0,defaultValueByArrayKey:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:function({arrayKeys:ns}){let is={};for(let as of ns)is[as]=!0;return{useEssentialOrDefaultValue:{essentialCenter:is}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,stateValues:is,workspace:as}){let os=[];for(let ls in ns.essentialCenter)os.push({setEssentialValue:"essentialCenter",value:{[ls]:ns.essentialCenter[ls]}});return{success:!0,instructions:os}}},rs.numericalCenter={forRenderer:!0,isArray:!0,entryPrefixes:["numericalCenterX"],stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={},os={};if(is.havePrescribedCenter){for(let ls of ns){let us=Number(ls)+1;os[ls]={numericalPrescribedCenterX:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenterX"+us}}}is.havePrescribedRadius&&is.nThroughPoints>0&&(as.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else{for(let ls of ns){let us=Number(ls)+1;os[ls]={essentialCenterX:{dependencyType:"stateVariable",variableName:"essentialCenterX"+us}}}as.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},as.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"},as.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},is.havePrescribedRadius?as.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:is.nThroughPoints==1?as.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:is.nThroughPoints>1&&(as.numericalCenterCalculatedWithRadius={dependencyType:"stateVariable",variableName:"numericalCenterCalculatedWithRadius"})}return{globalDependencies:as,dependenciesByKey:os}},arrayDefinitionByKey:function({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as)if(is[ls].numericalPrescribedCenterX!==void 0){if(ns.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{numericalCenter:[NaN,NaN]}};os[ls]=is[ls].numericalPrescribedCenterX}if(Object.keys(os).length>0)return{setValue:{numericalCenter:os}};if(ns.haveNonNumericalPrescribedRadius||ns.haveNonNumericalThroughPoints)return{setValue:{numericalCenter:[NaN,NaN]}};if(ns.numericalRadius!==void 0)if(ns.nThroughPoints===0){for(let ls of as){let us=is[ls].essentialCenterX;us instanceof Context.class&&(us=us.evaluate_to_constant()),os[ls]=us}return{setValue:{numericalCenter:os}}}else{if(ns.nThroughPoints===1)return ns.numericalThroughPoints.length<1?{setValue:{numericalCenter:[NaN,NaN]}}:{setValue:{numericalCenter:[ns.numericalThroughPoints[0][0],ns.numericalThroughPoints[0][1]-ns.numericalRadius]}};if(ns.nThroughPoints===2){if(ns.numericalThroughPoints.length<2)return{setValue:{numericalCenter:[NaN,NaN]}};let ls=ns.numericalRadius,us=ns.numericalThroughPoints[0][0],cs=ns.numericalThroughPoints[1][0],ps=ns.numericalThroughPoints[0][1],ds=ns.numericalThroughPoints[1][1],fs=Math.pow(us-cs,2)+Math.pow(ps-ds,2),hs=ls*ls;if(ls<0||4*hs<fs)return console.warn("Can't find circle through given radius and two points"),{setValue:{numericalCenter:[NaN,NaN]}};if(fs===0)return{setValue:{numericalCenter:[us,ps-ls]}};let ys=.5*(fs*(us+cs)+(ps-ds)*Math.sqrt((4*hs-fs)*fs))/fs,gs=.5*(fs*(ps+ds)+(cs-us)*Math.sqrt((4*hs-fs)*fs))/fs;return{setValue:{numericalCenter:[ys,gs]}}}else return console.warn("Can't create circle through more than two points with given radius"),{setValue:{numericalCenter:[NaN,NaN]}}}if(ns.nThroughPoints===0){for(let ls of as){let us=is[ls].essentialCenterX;us instanceof Context.class&&(us=us.evaluate_to_constant()),os[ls]=us}return{setValue:{numericalCenter:os}}}else return ns.numericalCenterCalculatedWithRadius===void 0?{setValue:{numericalCenter:[NaN,NaN]}}:{setValue:{numericalCenter:ns.numericalCenterCalculatedWithRadius}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,globalDependencyValues:is,dependencyValuesByKey:as,dependencyNamesByKey:os,stateValues:ls,workspace:us}){let cs=[];for(let ps in ns.numericalCenter)as[ps].numericalPrescribedCenterX!==void 0&&cs.push({setDependency:os[ps].numericalPrescribedCenterX,desiredValue:ns.numericalCenter[ps]});if(cs.length>0)return{success:!0,instructions:cs};if(is.nThroughPoints===0){for(let ps in ns.numericalCenter)cs.push({setDependency:os[ps].essentialCenterX,desiredValue:ns.numericalCenter[ps]});return{success:!0,instructions:cs}}else{us.desiredCenter||(us.desiredCenter={});for(let hs=0;hs<2;hs++)ns.numericalCenter[hs]!==void 0?us.desiredCenter[hs]=ns.numericalCenter[hs]:us.desiredCenter[hs]===void 0&&(us.desiredCenter[hs]=ls.numericalCenter[hs]);let ps=[],ds=await ls.throughAngles,fs=await ls.numericalRadius;for(let hs=0;hs<is.nThroughPoints;hs++){let ys=ds[hs];if(!Number.isFinite(ys))return{success:!1};let gs=[us.desiredCenter[0]+fs*Math.cos(ys),us.desiredCenter[1]+fs*Math.sin(ys)];ps.push(gs)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:ps}]}}}},rs.throughAngles={forRenderer:!0,defaultValue:[],hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNumericalEntries"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"}}),definition:function({dependencyValues:ns}){if(!(ns.haveNumericalEntries&&ns.nThroughPoints>0&&ns.numericalRadius>0&&ns.numericalCenter.every(as=>Number.isFinite(as))))return{useEssentialOrDefaultValue:{throughAngles:!0}};let is=[];for(let as of ns.numericalThroughPoints)is.push(Math.atan2(as[1]-ns.numericalCenter[1],as[0]-ns.numericalCenter[0]));return{setValue:{throughAngles:is},setEssentialValue:{throughAngles:is}}}},rs.radius={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnDependencies:function({stateValues:ns}){let is={numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},essentialRadius:{dependencyType:"stateVariable",variableName:"essentialRadius"}};return ns.havePrescribedRadius?(is.prescribedRadius={dependencyType:"stateVariable",variableName:"prescribedRadius"},ns.havePrescribedCenter&&ns.nThroughPoints>0&&(is.haveCenterRadiusPoints={dependencyType:"value",value:!0})):ns.havePrescribedCenter&&ns.nThroughPoints===1&&(is.prescribedCenter={dependencyType:"stateVariable",variableName:"prescribedCenter"},is.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"}),is},definition:function({dependencyValues:ns}){if(Number.isFinite(ns.numericalRadius))return{setValue:{radius:Context.fromAst(ns.numericalRadius)}};if(ns.prescribedRadius!==void 0)return ns.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{radius:Context.fromAst("")}}):{setValue:{radius:ns.prescribedRadius}};if(ns.prescribedCenter!==void 0)if(ns.nThroughPoints===0){let is=ns.essentialRadius;return is instanceof Context.class||(Number.isFinite(is)?is=Context.fromAst(is):is=Context.fromAst("")),{setValue:{radius:is}}}else if(ns.nThroughPoints===1)try{let is=ns.throughPoints[0],as=is[0],os=is[1],ls=ns.prescribedCenter[0],us=ns.prescribedCenter[1];return{setValue:{radius:as.subtract(ls).pow(2).add(os.subtract(us).pow(2)).pow(.5).simplify()}}}catch{return console.warn("Invalid center or through points of circle"),{setValue:{radius:Context.fromAst("")}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{setValue:{radius:Context.fromAst("")}};if(ns.nThroughPoints<2){let is=ns.essentialRadius;return is instanceof Context.class||(Number.isFinite(is)?is=Context.fromAst(is):is=Context.fromAst("")),{setValue:{radius:is}}}else return console.warn(`Have not implemented circle through ${ns.nThroughPoints} points when non-numerical values`),{setValue:{radius:Context.fromAst("")}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){let as=ns.radius.evaluate_to_constant();return Number.isFinite(as)&&Number.isFinite(is.numericalRadius)?{success:!0,instructions:[{setDependency:"numericalRadius",desiredValue:as}]}:is.prescribedRadius!==void 0?{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:ns.radius}]}:is.nThroughPoints===0?{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:ns.radius}]}:(console.warn("Can't change radius of circle with non-numerical values through points"),{success:!1})}},rs.diameter={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:ns}){return{setValue:{diameter:ns.radius.multiply(2).simplify()}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){return{success:!0,instructions:[{setDependency:"radius",desiredValue:ns.diameter.divide(2).simplify()}]}}},rs.center={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(ns){return ns==="centerX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["centerX"],stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:ns,stateValues:is}){let as={},os={};if(is.havePrescribedCenter){as.havePrescribedCenter={dependencyType:"value",value:!0};for(let ls of ns){let us=Number(ls)+1;os[ls]={numericalCenterX:{dependencyType:"stateVariable",variableName:"numericalCenterX"+us},prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+us}}}is.havePrescribedRadius&&is.nThroughPoints>0&&(as.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else{for(let ls of ns){let us=Number(ls)+1;os[ls]={essentialCenterX:{dependencyType:"stateVariable",variableName:"essentialCenterX"+us}}}as.numericalCenter={dependencyType:"stateVariable",variableName:"numericalCenter"},as.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},as.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"},is.havePrescribedRadius?as.radius={dependencyType:"stateVariable",variableName:"prescribedRadius"}:is.nThroughPoints==1&&(as.radius={dependencyType:"stateVariable",variableName:"radius"})}return{dependenciesByKey:os,globalDependencies:as}},arrayDefinitionByKey:function({globalDependencyValues:ns,dependencyValuesByKey:is,arrayKeys:as}){if(ns.havePrescribedCenter){if(ns.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{center:[Context.fromAst(""),Context.fromAst("")]}};let os={};for(let ls of as)Number.isFinite(is[ls].numericalCenterX)?os[ls]=Context.fromAst(is[ls].numericalCenterX):os[ls]=is[ls].prescribedCenterX;return{setValue:{center:os}}}if(ns.numericalCenter.every(os=>Number.isFinite(os)))return{setValue:{center:ns.numericalCenter.map(os=>Context.fromAst(os))}};if(ns.radius!==void 0)if(ns.nThroughPoints===0){let os={};for(let ls of as){let us=is[ls].essentialCenterX;us instanceof Context.class||(Number.isFinite(us)?us=Context.fromAst(us):us=Context.fromAst("")),os[ls]=us}return{setValue:{center:os}}}else if(ns.nThroughPoints===1){let os;try{os=[ns.throughPoints[0][0],ns.throughPoints[0][1].subtract(ns.radius).simplify()]}catch{os=[Context.fromAst(""),Context.fromAst("")]}return{setValue:{center:os}}}else return console.warn("Can't create circle through more than one point with given radius when don't have numerical values"),{setValue:{center:[Context.fromAst(""),Context.fromAst("")]}};if(ns.nThroughPoints===0){let os={};for(let ls of as){let us=is[ls].essentialCenterX;us instanceof Context.class||(Number.isFinite(us)?us=Context.fromAst(us):us=Context.fromAst("")),os[ls]=us}return{setValue:{center:os}}}else return console.warn("Can't create circle through more than one point when don't have numerical values"),{setValue:{center:[Context.fromAst(""),Context.fromAst("")]}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:ns,globalDependencyValues:is,stateValues:as,dependencyNamesByKey:os,workspace:ls}){if(is.havePrescribedCenter){let ps=[];for(let ds in ns.center)ps.push({setDependency:os[ds].prescribedCenterX,desiredValue:ns.center[ds],arrayKey:ds});return{success:!0,instructions:ps}}ls.desiredCenter||(ls.desiredCenter={});for(let ps=0;ps<2;ps++)ns.center[ps]!==void 0?ls.desiredCenter[ps]=ns.center[ps]:ls.desiredCenter[ps]===void 0&&(ls.desiredCenter[ps]=(await as.center)[ps]);let us=[],cs=!0;for(let ps=0;ps<2;ps++){let ds=ls.desiredCenter[ps].evaluate_to_constant();if(!Number.isFinite(ds)){cs=!1;break}us.push(ds)}if(cs&&is.numericalCenter.every(ps=>Number.isFinite(ps)))return{success:!0,instructions:[{setDependency:"numericalCenter",desiredValue:us}]};if(is.nThroughPoints===0){let ps=[];for(let ds in ns.center)ps.push({setDependency:os[ds].essentialCenterX,desiredValue:ns.center[ds],arrayKey:ds});return{success:!0,instructions:ps}}else return console.warn("Haven't implemented changing center of circle through points with non numerical values"),{success:!1}}},rs.nearestPoint={returnDependencies:()=>({numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"}}),definition({dependencyValues:ns}){let is=ns.numericalRadius,as=ns.numericalCenter[0],os=ns.numericalCenter[1];return{setValue:{nearestPoint:function({variables:ls,scales:us}){var hs,ys;let cs=(hs=ls.x1)==null?void 0:hs.evaluate_to_constant(),ps=(ys=ls.x2)==null?void 0:ys.evaluate_to_constant();if(!(Number.isFinite(cs)&&Number.isFinite(ps)))return{};if(!(Number.isFinite(as)&&Number.isFinite(os)&&Number.isFinite(is)))return{};let ds=Math.atan2(ps-os,cs-as),fs={x1:as+is*Math.cos(ds),x2:os+is*Math.sin(ds)};return ls.x3!==void 0&&(fs.x3=0),fs}}}}},rs}async moveCircle({center:ts,radius:rs,throughAngles:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=[],cs=await this.stateValues.nThroughPoints,ps=await this.stateValues.numericalPrescribedCenter;if((cs<=1||ps!==null)&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalCenter",value:ts}),cs>=1){let ds=[];ns===void 0&&(ns=await this.stateValues.throughAngles),rs===void 0&&(rs=await this.stateValues.numericalRadius);for(let fs=0;fs<cs;fs++){let hs=ns[fs],ys=[ts[0]+rs*Math.cos(hs),ts[1]+rs*Math.sin(hs)];ds.push(ys)}us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalThroughPoints",value:ds})}return is?await this.coreFunctions.performUpdate({updateInstructions:us,transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:us,actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{center:ts}}})}async circleClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnCircle({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Circle,"componentType","circle"),Ms(Circle,"rendererType","circle"),Ms(Circle,"representsClosedPath",!0);function circleFromTwoNumericalPoints({point1:ss,point2:ts}){let rs=(ss[0]+ts[0])/2,ns=(ss[1]+ts[1])/2,is=[rs,ns],as=Math.sqrt(Math.pow(rs-ss[0],2)+Math.pow(ns-ss[1],2));return{numericalCenter:is,numericalRadius:as}}class Parabola extends Curve{static createAttributesObject(){let ts=super.createAttributesObject();return ts.through={createComponentOfType:"_pointListComponent"},ts.vertex={createComponentOfType:"point",createStateVariable:"prescribedVertex",defaultValue:null},delete ts.parMin,delete ts.parMax,delete ts.variable,ts}static returnChildGroups(){return GraphicalComponent.returnChildGroups()}static returnStateVariableDefinitions(ts){let rs=GraphicalComponent.returnStateVariableDefinitions(ts),ns=super.returnStateVariableDefinitions(ts);return rs.graphXmin=ns.graphXmin,rs.styleDescription=ns.styleDescription,rs.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:is}){return{setValue:{styleDescriptionWithNoun:is.styleDescription+" parabola"}}}},rs.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{curveType:"function"}})},rs.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMax:1/0}})},rs.parMin={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMin:-1/0}})},rs.aShadow={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{aShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:is}){return{success:!0,instructions:[{setEssentialValue:"aShadow",value:is.aShadow}]}}},rs.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:is}){return is.throughAttr===null?{setValue:{nThroughPoints:0}}:{setValue:{nThroughPoints:is.throughAttr.stateValues.nPoints}}}},rs.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(is){return is==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:is,varEnding:as,arraySize:os}){if(is==="throughPointX"){let ls=as.split("_").map(us=>Number(us)-1);return ls.length===2&&ls.every((us,cs)=>Number.isInteger(us)&&us>=0)?os?ls.every((us,cs)=>us<os[cs])?[String(ls)]:[]:[String(ls)]:[]}else{let ls=Number(as)-1;return Number.isInteger(ls)&&ls>=0?os?ls<os[0]?Array.from(Array(os[1]),(us,cs)=>ls+","+cs):[]:[ls+",0"]:[]}},arrayVarNameFromPropIndex(is,as){if(as==="throughPoints")return is.length===1?"throughPoint"+is[0]:`throughPointX${is[0]}_${is[1]}`;if(as.slice(0,12)==="throughPoint"){let os=Number(as.slice(12));if(Number.isInteger(os)&&os>0)return`throughPointX${os}_${is[0]}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:is}){return[is.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:is}){let as={};for(let os of is){let[ls,us]=os.split(","),cs=Number(ls)+1+"_"+(Number(us)+1);as[os]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+cs]}}}return{dependenciesByKey:as}},arrayDefinitionByKey({dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as){let[us,cs]=ls.split(","),ps=Number(us)+1+"_"+(Number(cs)+1),ds=is[ls].throughAttr;if(ds!==null&&ds.stateValues["pointX"+ps]){let fs=ds.stateValues["pointX"+ps].evaluate_to_constant();Number.isFinite(fs)?os[ls]=Context.fromAst(fs):os[ls]=Context.fromAst("")}else os[ls]=Context.fromAst("")}return{setValue:{throughPoints:os}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:is,dependencyValuesByKey:as,dependencyNamesByKey:os,initialChange:ls,stateValues:us}){if(ls&&!await us.draggable)return{success:!1};let cs=[];for(let ps in is.throughPoints){let[ds,fs]=ps.split(","),hs=Number(ds)+1+"_"+(Number(fs)+1);if(as[ps].throughAttr!==null&&as[ps].throughAttr.stateValues["pointX"+hs])cs.push({setDependency:os[ps].throughAttr,desiredValue:is.throughPoints[ps],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:cs}}},rs.numericalThroughPoints={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:is}){return[is.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:is}){let as={};for(let os of is)as[os]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(os)+1)}};return{dependenciesByKey:as}},arrayDefinitionByKey({dependencyValuesByKey:is,arrayKeys:as}){let os={};for(let ls of as){let us=is[ls].throughPoint.map(cs=>cs.tree);us.every(cs=>Number.isFinite(cs))||(us=Array(us.length).fill(NaN)),os[ls]=us}return{setValue:{numericalThroughPoints:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:is,dependencyValuesByKey:as,dependencyNamesByKey:os}){let ls=[];for(let us in is.numericalThroughPoints)if(as[us].throughPoint)ls.push({setDependency:os[us].throughPoint,desiredValue:is.numericalThroughPoints[us].map(cs=>Context.fromAst(cs))});else return{success:!1};return{success:!0,instructions:ls}}},rs.numericalPrescribedVertex={returnDependencies:()=>({prescribedVertex:{dependencyType:"stateVariable",variableName:"prescribedVertex"}}),definition({dependencyValues:is}){if(is.prescribedVertex===null)return{setValue:{numericalPrescribedVertex:null}};let as,os;try{as=is.prescribedVertex.get_component(0).evaluate_to_constant(),os=is.prescribedVertex.get_component(1).evaluate_to_constant(),Number.isFinite(as)&&Number.isFinite(os)||(as=NaN,os=NaN)}catch{as=NaN,os=NaN}return{setValue:{numericalPrescribedVertex:[as,os]}}}},rs.pointsAreNumerical={returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalPrescribedVertex:{dependencyType:"stateVariable",variableName:"numericalPrescribedVertex"}}),definition:({dependencyValues:is})=>({setValue:{pointsAreNumerical:is.numericalThroughPoints.every(as=>Number.isFinite(as[0]))&&(!is.numericalPrescribedVertex||Number.isFinite(is.numericalPrescribedVertex[0]))},checkForActualChange:{pointsAreNumerical:!0}})},rs.a={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"b",public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0},{variableName:"c",public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0},"realValued"],returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalPrescribedVertex:{dependencyType:"stateVariable",variableName:"numericalPrescribedVertex"},pointsAreNumerical:{dependencyType:"stateVariable",variableName:"pointsAreNumerical"},aShadow:{dependencyType:"stateVariable",variableName:"aShadow"}}),definition:function({dependencyValues:is,componentName:as}){if(!is.pointsAreNumerical)return{setValue:{a:NaN,b:NaN,c:NaN,realValued:!1}};let os,ls,us,cs=!0;if(is.numericalPrescribedVertex)if(is.numericalThroughPoints.length===0){let ps=is.numericalPrescribedVertex,ds=ps[0],fs=ps[1];return os=is.aShadow,ls=-2*os*ds,us=os*ds*ds+fs,{setValue:{a:os,b:ls,c:us,realValued:!0}}}else{let ps=is.numericalPrescribedVertex,ds=ps[0],fs=ps[1],hs=is.numericalThroughPoints[0],ys=hs[0];return os=(hs[1]-fs)/(ys-ds)**2,ls=-2*os*ds,us=os*ds*ds+fs,{setValue:{a:os,b:ls,c:us,realValued:!0}}}if(is.numericalThroughPoints.length===0)return{setValue:{a:is.aShadow,realValued:!0},useEssentialOrDefaultValue:{b:!0,c:!0}};if(is.numericalThroughPoints.length===1){let ps=is.numericalThroughPoints[0],ds=ps[0],fs=ps[1];return os=is.aShadow,ls=-2*os*ds,us=os*ds*ds+fs,{setValue:{a:os,b:ls,c:us,realValued:!0}}}else if(is.numericalThroughPoints.length===2){os=is.aShadow;let ps=is.numericalThroughPoints[0],ds=ps[0],fs=ps[1],hs=ds*ds,ys=is.numericalThroughPoints[1],gs=ys[0],bs=ys[1],vs=gs*gs;return ds===gs?fs==bs?(ls=-2*os*ds,us=os*hs+fs):(cs=!1,os=NaN,ls=NaN,us=NaN):(ls=(fs-bs-os*(hs-vs))/(ds-gs),us=fs-os*hs-ls*ds),{setValue:{a:os,b:ls,c:us,realValued:cs}}}else if(is.numericalThroughPoints.length===3){let ps=is.numericalThroughPoints[0],ds=ps[0],fs=ps[1],hs=ds*ds,ys=is.numericalThroughPoints[1],gs=ys[0],bs=ys[1],vs=gs*gs,Ns=is.numericalThroughPoints[2],Ts=Ns[0],Cs=Ns[1],xs=Ts*Ts,As=hs-xs,ws=vs-xs,Es=ds-Ts,Ss=gs-Ts,Ds=fs-Cs,Vs=bs-Cs,Is=As*Ss-ws*Es;if(Is===0){let Os=!1,Ps,$s,Rs;ds===gs?fs===bs?ds===Ts?fs==Cs?Ps=1:Os=!0:(Ps=2,$s=Ts,Rs=Cs):Os=!0:ds===Ts?fs===Cs?(Ps=2,$s=gs,Rs=bs):Os=!0:gs===Ts&&bs===Cs?(Ps=2,$s=gs,Rs=bs):Os=!0,Os?(cs=!1,os=NaN,ls=NaN,us=NaN):Ps===1?(os=is.aShadow,ls=-2*os*ds,us=os*ds*ds+fs):(os=is.aShadow,ls=(fs-Rs-os*(hs-$s*$s))/(ds-$s),us=fs-os*hs-ls*ds)}else os=(Ds*Ss-Vs*Es)/Is,ls=(Vs*As-Ds*ws)/Is,us=fs-ls*ds-os*hs;return{setValue:{a:os,b:ls,c:us,realValued:cs}}}else return console.warn("Haven't implemented parabola through more than 3 points"),{setValue:{a:NaN,b:NaN,c:NaN,realValued:!1}}},inverseDefinition:async function({desiredStateVariableValues:is,dependencyValues:as,stateValues:os,workspace:ls}){if(!as.pointsAreNumerical)return{success:!1};let us={},cs=function(ds){if(Number.isFinite(ds))return{success:!0,value:ds};if(ds instanceof Context.class){let fs=ds.evaluate_to_constant();if(Number.isFinite(fs))return{success:!0,value:fs}}return{success:!1}};if(is.a!==void 0){let ds=cs(is.a);if(ds.success)us.a=ds.value;else return{success:!1}}if(is.b!==void 0){let ds=cs(is.b);if(ds.success)us.b=ds.value;else return{success:!1}}if(is.c!==void 0){let ds=cs(is.c);if(ds.success)us.c=ds.value;else return{success:!1}}Object.assign(ls,us);let ps=async function(ds){return ls[ds]!==void 0?ls[ds]:await os[ds]};if(as.numericalThroughPoints.length===0){let ds=[];return us.a!==void 0&&ds.push({setDependency:"aShadow",desiredValue:us.a}),us.b!==void 0&&ds.push({setEssentialValue:"b",value:us.b}),us.c!==void 0&&ds.push({setEssentialValue:"c",value:us.c}),{success:!0,instructions:ds}}else if(as.numericalThroughPoints.length===1){let ds=await ps("a"),fs=await ps("b"),hs=await ps("c"),ys=-fs/(2*ds),gs=hs-fs*fs/(4*ds),bs=[{setDependency:"numericalThroughPoints",desiredValue:[[ys,gs]]}];return us.a!==void 0&&bs.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:bs}}else if(as.numericalThroughPoints.length===2){let ds=await ps("a"),fs=await ps("b"),hs=await ps("c"),gs=as.numericalThroughPoints[0][0],vs=as.numericalThroughPoints[1][0];if(gs===vs){gs=-fs/(2*ds);let Ns=hs-fs*fs/(4*ds),Ts=[{setDependency:"numericalThroughPoints",desiredValue:[[gs,Ns],[gs,Ns]]}];return us.a!==void 0&&Ts.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Ts}}else{let Ns=ds*gs*gs+fs*gs+hs,Ts=ds*vs*vs+fs*vs+hs,Cs=[{setDependency:"numericalThroughPoints",desiredValue:[[gs,Ns],[vs,Ts]]}];return us.a!==void 0&&Cs.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Cs}}}else if(as.numericalThroughPoints.length===3){let ds=await ps("a"),fs=await ps("b"),hs=await ps("c"),gs=as.numericalThroughPoints[0][0],vs=as.numericalThroughPoints[1][0],Ts=as.numericalThroughPoints[2][0],Cs=3,xs;if(gs===vs?gs===Ts?Cs=1:(Cs=2,xs=3):gs===Ts?(Cs=2,xs=2):vs===Ts&&(Cs=2,xs=1),Cs===3){let As=ds*gs*gs+fs*gs+hs,ws=ds*vs*vs+fs*vs+hs,Es=ds*Ts*Ts+fs*Ts+hs,Ss=[{setDependency:"numericalThroughPoints",desiredValue:[[gs,As],[vs,ws],[Ts,Es]]}];return us.a!==void 0&&Ss.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Ss}}else if(Cs===2)if(xs===1){let As=gs,ws=vs,Es=ds*As*As+fs*As+hs,Ss=ds*ws*ws+fs*ws+hs,Ds=[{setDependency:"numericalThroughPoints",desiredValue:[[As,Es],[ws,Ss],[ws,Ss]]}];return us.a!==void 0&&Ds.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Ds}}else if(xs===2){let As=gs,ws=vs,Es=ds*As*As+fs*As+hs,Ss=ds*ws*ws+fs*ws+hs,Ds=[{setDependency:"numericalThroughPoints",desiredValue:[[As,Es],[ws,Ss],[As,Es]]}];return us.a!==void 0&&Ds.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Ds}}else{let As=gs,ws=Ts,Es=ds*As*As+fs*As+hs,Ss=ds*ws*ws+fs*ws+hs,Ds=[{setDependency:"numericalThroughPoints",desiredValue:[[As,Es],[As,Es],[ws,Ss]]}];return us.a!==void 0&&Ds.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:Ds}}else{gs=-fs/(2*ds);let As=hs-fs*fs/(4*ds),ws=[{setDependency:"numericalThroughPoints",desiredValue:[[gs,As],[gs,As],[gs,As]]}];return us.a!==void 0&&ws.push({setDependency:"aShadow",desiredValue:us.a}),{success:!0,instructions:ws}}}else return{success:!1}}},rs.vertex={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(is){return is==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["vertexX"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"},realValued:{dependencyType:"stateVariable",variableName:"realValued"}}}},arrayDefinitionByKey:function({globalDependencyValues:is}){let as={};return is.realValued&&is.a!==0?(as[0]=Context.fromAst(-is.b/(2*is.a)),as[1]=Context.fromAst(is.c-is.b**2/(4*is.a))):(as[0]=Context.fromAst(""),as[1]=Context.fromAst("")),{setValue:{vertex:as}}},inverseArrayDefinitionByKey:async function({desiredStateVariableValues:is,globalDependencyValues:as,workspace:os,stateValues:ls}){let us;if("0"in is.vertex?us=is.vertex[0].evaluate_to_constant():os.x!==void 0?us=os.x:us=(await ls.vertex)[0].tree,Number.isFinite(us))os.x=us;else return{success:!1};let cs;if("1"in is.vertex?cs=is.vertex[1].evaluate_to_constant():os.y!==void 0?cs=os.y:cs=(await ls.vertex)[1].tree,Number.isFinite(cs))os.y=cs;else return{success:!1};let ps=as.a,ds=-2*ps*us,fs=cs+ps*us*us;return{success:!0,instructions:[{setDependency:"b",desiredValue:ds,additionalDependencyValues:{c:fs}}]}}},rs.equation={public:!0,shadowingInstructions:{createComponentOfType:"math"},additionalProperties:{simplify:"numberspreserveorder",displaysmallaszero:!0},returnDependencies:()=>({a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition:function({dependencyValues:is}){let as=["=","y",["+",["*",is.a,["^","x",2]],["*",is.b,"x"],is.c]];return{setValue:{equation:Context.fromAst(as).evaluate_numbers({skip_ordering:!0})}}}},rs.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],additionalStateVariablesDefined:[{variableName:"fDefinitions",isArray:!0,forRenderer:!0}],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[1],returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}}},arrayDefinitionByKey({globalDependencyValues:is}){return{setValue:{fs:[function(os){return is.a*os*os+is.b*os+is.c}],fDefinitions:[{functionType:"formula",formula:["+",["*",is.a,"x","x"],["*",is.b,"x"],is.c],variables:["x"],nInputs:1,nOutputs:1,domain:null}]}}}},rs.f={isAlias:!0,targetVariableName:"f1"},rs.nearestPoint={returnDependencies:()=>({f:{dependencyType:"stateVariable",variableName:"f"},a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition({dependencyValues:is,componentName:as}){let os=!(Number.isFinite(is.a)&&Number.isFinite(is.b)&&Number.isFinite(is.c));return{setValue:{nearestPoint:function({variables:ls,scales:us}){var Ds,Vs;if(os)return{};let cs=us[0],ps=us[1],ds=(Ds=ls.x1)==null?void 0:Ds.evaluate_to_constant(),fs=(Vs=ls.x2)==null?void 0:Vs.evaluate_to_constant();if(!(Number.isFinite(ds)&&Number.isFinite(fs)))return{};ds/=cs,fs/=ps;let hs=is.a*cs*cs/ps,ys=is.b*cs/ps,gs=is.c/ps;if(hs===0){let Is=ys*ys+1,Os={};return Os.x1=(ds+ys*fs-ys*gs)/Is*cs,Os.x2=(ys*(ds+ys*fs)+gs)/Is*ps,ls.x3!==void 0&&(Os.x3=0),Os}let bs=gs-fs,vs=2*hs**2,Ns=3*hs*ys/vs,Ts=(2*hs*bs+ys**2+1)/vs,Cs=(ys*bs-ds)/vs,xs=cardano(Ns,Ts,Cs,1e-14),As=xs[0],ws=is.f(As*cs)/ps,Es=(ds-As)**2+(fs-ws)**2;for(let Is of xs.slice(1)){let Os=Is,Ps=is.f(Os*cs)/ps,$s=(ds-Os)**2+(fs-Ps)**2;$s<Es&&(As=Os,ws=Ps,Es=$s)}let Ss={x1:As*cs,x2:ws*ps};return ls.x3!==void 0&&(Ss.x3=0),Ss}}}}},rs}}Ms(Parabola,"componentType","parabola"),Ms(Parabola,"rendererType","curve");function cardano(ss,ts,rs,ns=1e-10){const[is,as]=[-.3333333333333333*ss*ss+ts,.07407407407407407*ss*ss*ss-.3333333333333333*ss*ts+rs];if(Math.abs(as)<=ns){if(Math.abs(is)<=ns)return[-ss/3];let ds=Math.sqrt(Math.abs(is));return is<0?[-ds-ss/3,-ss/3,ds-ss/3]:[-ss/3]}const os=-27*as*as-4*is*is*is;if(Math.abs(os)<=ns){const ds=Math.cbrt(-as/2);return[2*ds-ss/3,-ds-ss/3]}if(os>0){const ds=Math.sqrt(os/108),fs=Math.sqrt(Math.cbrt(as*as/4+os/108))*2,hs=Math.atan2(ds,-as/2);return[Math.cos(hs/3),Math.cos(hs/3+2*Math.PI/3),Math.cos(hs/3-2*Math.PI/3)].sort((ys,gs)=>ys-gs).map(ys=>fs*ys-ss/3)}const ls=Math.sqrt(-os/108),us=Math.cbrt(-as/2+ls),cs=Math.cbrt(-as/2-ls);return[us+cs-ss/3]}class BezierControls extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.alwaysVisible={createComponentOfType:"boolean",createStateVariable:"alwaysVisible",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=breakEmbeddedStringsIntoParensPieces({componentList:ns});return is.success!==!0?{success:!1}:{success:!0,newChildren:is.pieces.map(function(as){return as.length>1||typeof as[0]=="string"?{componentType:"controlVectors",children:[{componentType:"vector",children:as}]}:as[0]})}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"controlVectors",componentTypes:["controlVectors"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nControls={returnDependencies:()=>({nParentPoints:{dependencyType:"parentStateVariable",variableName:"nThroughPoints",skipComponentNames:!0}}),definition({dependencyValues:rs}){let ns=rs.nParentPoints;return Number.isInteger(ns)&&ns>=0||(ns=0),{setValue:{nControls:ns}}}},ts.pointIndMap={returnDependencies:()=>({controlChildren:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["pointNumber"]}}),definition:function({dependencyValues:rs}){let ns=[],is=-1;for(let[as,os]of rs.controlChildren.entries()){let ls=os.stateValues.pointNumber;Number.isFinite(ls)?is=Math.round(ls)-1:is+=1,ns[is]=as}return{setValue:{pointIndMap:ns}}}},ts.directions={isArray:!0,entryPrefixes:["direction"],hasEssential:!0,defaultValueByArrayKey:()=>"none",stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize({dependencyValues:rs}){return[rs.nControls]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={};for(let as of rs){let os=ns.pointIndMap[as];os!==void 0&&(is[as]={controlChild:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["direction"],childIndices:[os]}})}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={},as={};for(let os of ns){let ls=rs[os].controlChild;ls&&ls.length===1?is[os]=ls[0].stateValues.direction:as[os]=!0}return{setValue:{directions:is},useEssentialOrDefaultValue:{directions:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,dependencyValuesByKey:is}){let as=[],os={};for(let ls in rs.directions){let us=is[ls].controlChild;us&&us.length===1?as.push({setDependency:ns[ls].controlChild,desiredValue:rs.directions[ls],childIndex:0,variableIndex:0}):os[ls]=rs.directions[ls]}return Object.keys(os).length>0&&as.push({setEssentialValue:"directions",value:os}),{success:!0,instructions:as}}},ts.hiddenControls={isArray:!0,entryPrefixes:["hiddenControl"],hasEssential:!0,defaultValueByArrayKey:()=>!1,stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize({dependencyValues:rs}){return[rs.nControls]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={};for(let as of rs){let os=ns.pointIndMap[as];os!==void 0&&(is[as]={controlChild:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["hide"],childIndices:[os]}})}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={},as={};for(let os of ns){let ls=rs[os].controlChild;ls&&ls.length===1?is[os]=ls[0].stateValues.hide:as[os]=!0}return{setValue:{hiddenControls:is},useEssentialOrDefaultValue:{hiddenControls:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,dependencyValuesByKey:is}){let as=[],os={};for(let ls in rs.hiddenControls){let us=is[ls].controlChild;us&&us.length===1?as.push({setDependency:ns[ls].controlChild,desiredValue:rs.hiddenControls[ls],childIndex:0,variableIndex:0}):os[ls]=rs.hiddenControls[ls]}return Object.keys(os).length>0&&as.push({setEssentialValue:"hiddenControls",value:os}),{success:!0,instructions:as}}},ts.nDimensions={returnDependencies(){return{nParentDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensions"}}},definition:function({dependencyValues:rs}){let ns=rs.nParentDimensions;return Number.isInteger(ns)&&ns>=0||(ns=0),{setValue:{nDimensions:ns},checkForActualChange:{nDimensions:!0}}}},ts.essentialSymmetricControls={isArray:!0,entryPrefixes:["essentialSymmetricControl"],nDimensions:2,hasEssential:!0,defaultValueByArrayKey:()=>Context.fromAst(1),returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nControls,rs.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:rs}){let ns={};for(let is of rs)is.split(",").map(as=>Number(as)),ns[is]=!0;return{useEssentialOrDefaultValue:{essentialSymmetricControls:ns}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs}){let ns=[],is={};for(let as in rs.essentialSymmetricControls)is[as]=rs.essentialSymmetricControls[as];return Object.keys(is).length>0&&ns.push({setEssentialValue:"essentialSymmetricControls",value:is}),{success:!0,instructions:ns}}},ts.controls={isArray:!0,entryPrefixes:["control"],nDimensions:3,hasEssential:!0,shadowVariable:!0,defaultValueByArrayKey:()=>Context.fromAst(1),stateVariablesDeterminingDependencies:["pointIndMap","directions"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nControls,2,rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={};for(let as of rs){let os=as.split(",").map(cs=>Number(cs)),ls=os.map(cs=>cs+1);is[as]={direction:{dependencyType:"stateVariable",variableName:"direction"+ls[0]}};let us=ns.directions[os[0]];if(us!=="none"&&(os[1]===0||os[1]===1)){let cs=ns.pointIndMap[os[0]];cs!==void 0&&(us==="symmetric"||us==="previous"&&os[1]===0||us==="next"&&os[1]===1?is[as].controlChild={dependencyType:"child",childGroups:["controlVectors"],variableNames:["vectorX1_"+ls[2]],childIndices:[cs]}:us==="both"&&(is[as].controlChild={dependencyType:"child",childGroups:["controlVectors"],variableNames:["vectorX"+ls[1]+"_"+ls[2]],childIndices:[cs]})),us==="symmetric"&&(is[as].essentialSymmetricControl={dependencyType:"stateVariable",variableName:"essentialSymmetricControl"+ls[0]+"_"+ls[2]})}}return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns,componentName:is}){let as={},os={};for(let ls of ns){let us=ls.split(",").map(ds=>Number(ds)),cs=us.map(ds=>ds+1),ps=rs[ls].direction;if(us[1]===0)if(ps==="none"||ps==="next")as[ls]=null;else{let ds=rs[ls].controlChild,fs=!0;if(ds&&ds.length===1){let hs=ds[0].stateValues["vectorX1_"+cs[2]];hs&&(fs=!1,hs=hs.evaluate_to_constant(),as[ls]=Context.fromAst(hs))}fs&&(ps==="symmetric"?as[ls]=rs[ls].essentialSymmetricControl:os[ls]=!0)}else if(us[1]===1)if(ps==="none"||ps==="previous")as[ls]=null;else{let ds=rs[ls].controlChild,fs=!0;if(ds&&ds.length===1)if(ps==="both"){let hs=ds[0].stateValues["vectorX2_"+cs[2]];hs&&(fs=!1,hs=hs.evaluate_to_constant(),as[ls]=Context.fromAst(hs))}else{let hs=ds[0].stateValues["vectorX1_"+cs[2]];hs&&(fs=!1,hs=hs.evaluate_to_constant(),ps==="symmetric"?as[ls]=Context.fromAst(-hs):as[ls]=Context.fromAst(hs))}fs&&(ps==="symmetric"?rs[ls].essentialSymmetricControl&&(as[ls]=Context.fromAst(-rs[ls].essentialSymmetricControl.tree)):os[ls]=!0)}}return{setValue:{controls:as},useEssentialOrDefaultValue:{controls:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns,dependencyValuesByKey:is}){let as=[],os={};for(let ls in rs.controls){let us=ls.split(",").map(ds=>Number(ds)),cs=us.map(ds=>ds+1),ps=is[ls].direction;if(ps){if(us[1]===0){if(!(ps==="none"||ps==="next")){let ds=is[ls].controlChild,fs=!0;if(ds&&ds.length===1&&ds[0].stateValues["vectorX1_"+cs[2]]&&(fs=!1,as.push({setDependency:ns[ls].controlChild,desiredValue:rs.controls[ls],childIndex:0,variableIndex:0})),fs){let hs=Context.fromAst(rs.controls[ls].evaluate_to_constant());ps==="symmetric"?as.push({setDependency:ns[ls].essentialSymmetricControl,desiredValue:hs}):os[ls]=hs}}}else if(us[1]===1&&!(ps==="none"||ps==="previous")){let ds=is[ls].controlChild,fs=!0;ds&&ds.length===1&&(ps==="both"?ds[0].stateValues["vectorX2_"+cs[2]]&&(fs=!1):ds[0].stateValues["vectorX1_"+cs[2]]&&(fs=!1));let hs;ps==="symmetric"?hs=Context.fromAst(["-",rs.controls[ls].tree]):hs=rs.controls[ls],fs?(hs=Context.fromAst(hs.evaluate_to_constant()),ps==="symmetric"?as.push({setDependency:ns[ls].essentialSymmetricControl,desiredValue:hs}):os[ls]=hs):as.push({setDependency:ns[ls].controlChild,desiredValue:hs,childIndex:0,variableIndex:0})}}}return Object.keys(os).length>0&&as.push({setEssentialValue:"controls",value:os}),{success:!0,instructions:as}}},ts}}Ms(BezierControls,"componentType","bezierControls"),Ms(BezierControls,"rendererType","containerInline");class VectorListComponent extends BaseComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=breakEmbeddedStringsIntoParensPieces({componentList:ns});return is.success!==!0?{success:!1}:{success:!0,newChildren:is.pieces.map(function(as){return as.length>1||typeof as[0]=="string"?{componentType:"vector",children:as}:as[0]})}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"vectors",componentTypes:["vector"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nVectors={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childGroups:["vectors"],skipComponentNames:!0}}),definition:({dependencyValues:rs})=>({setValue:{nVectors:rs.vectorChildren.length},checkForActualChange:{nVectors:!0}})},ts.nDimensions={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childGroups:["vectors"],variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:rs}){let ns;if(rs.vectorChildren.length===0)ns=2;else{ns=1;for(let is of rs.vectorChildren)Number.isFinite(is.stateValues.nDimensions)&&(ns=Math.max(ns,is.stateValues.nDimensions))}return{setValue:{nDimensions:ns},checkForActualChange:{nDimensions:!0}}}},ts.vectors={isArray:!0,nDimensions:2,entryPrefixes:["vectorX","vector"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="vectorX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="vectors")return rs.length===1?"vector"+rs[0]:`vectorX${rs[0]}_${rs[1]}`;if(ns.slice(0,6)==="vector"){let is=Number(ns.slice(6));if(Number.isInteger(is)&&is>0)return`vectorX${is}_${rs[0]}`}return null},returnArraySizeDependencies:()=>({nVectors:{dependencyType:"stateVariable",variableName:"nVectors"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nVectors,rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let[as,os]=is.split(",");ns[is]={vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["x"+(Number(os)+1)],childIndices:[as]}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=as.split(",")[1],ls=rs[as].vectorChild[0];ls&&(is[as]=ls.stateValues["x"+(Number(os)+1)])}return{setValue:{vectors:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.vectors)is.push({setDependency:ns[as].vectorChild,desiredValue:rs.vectors[as],childIndex:0,variableIndex:0});return{success:!0,instructions:is}}},ts}}Ms(VectorListComponent,"componentType","_vectorListComponent"),Ms(VectorListComponent,"rendererType","containerInline"),Ms(VectorListComponent,"renderChildren",!0);class ControlVectors extends VectorListComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.direction={createComponentOfType:"text",createStateVariable:"direction",defaultValue:"symmetric",public:!0,toLowerCase:!0,validValues:["symmetric","previous","next","both","none"]},ts.pointNumber={createComponentOfType:"number",createStateVariable:"pointNumber",defaultValue:null,public:!0},ts}}Ms(ControlVectors,"componentType","controlVectors");class PointListComponent extends BaseComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=breakEmbeddedStringsIntoParensPieces({componentList:ns});return is.success!==!0?{success:!1}:{success:!0,newChildren:is.pieces.map(function(as){return as.length>1||typeof as[0]=="string"?{componentType:"point",children:as}:as[0]})}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nPoints={returnDependencies:()=>({pointChildren:{dependencyType:"child",childGroups:["points"],skipComponentNames:!0}}),definition:function({dependencyValues:rs}){return{setValue:{nPoints:rs.pointChildren.length},checkForActualChange:{nPoints:!0}}}},ts.nDimensions={returnDependencies:()=>({pointChildren:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:rs}){let ns;if(rs.pointChildren.length===0)ns=2;else{ns=1;for(let is of rs.pointChildren)Number.isFinite(is.stateValues.nDimensions)&&(ns=Math.max(ns,is.stateValues.nDimensions))}return{setValue:{nDimensions:ns},checkForActualChange:{nDimensions:!0}}}},ts.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="pointX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="points")return rs.length===1?"point"+rs[0]:`pointX${rs[0]}_${rs[1]}`;if(ns.slice(0,5)==="point"){let is=Number(ns.slice(5));if(Number.isInteger(is)&&is>0)return`pointX${is}_${rs[0]}`}return null},returnArraySizeDependencies:()=>({nPoints:{dependencyType:"stateVariable",variableName:"nPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nPoints,rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let[as,os]=is.split(",");ns[is]={pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+(Number(os)+1)],childIndices:[as]}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=as.split(",")[1],ls=rs[as].pointChild[0];ls&&(is[as]=ls.stateValues["x"+(Number(os)+1)])}return{setValue:{points:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.points)is.push({setDependency:ns[as].pointChild,desiredValue:rs.points[as],childIndex:0,variableIndex:0});return{success:!0,instructions:is}}},ts}}Ms(PointListComponent,"componentType","_pointListComponent"),Ms(PointListComponent,"rendererType","containerInline"),Ms(PointListComponent,"renderChildren",!0);class IntervalListComponent extends BaseComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=breakEmbeddedStringsIntoIntervalPieces({componentList:ns});return is.success!==!0?{success:!1}:{success:!0,newChildren:is.pieces.map(function(as){return as.length>1||typeof as[0]=="string"?{componentType:"interval",children:as}:as[0]})}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"intervals",componentTypes:["interval"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nIntervals={returnDependencies:()=>({intervalChildren:{dependencyType:"child",childGroups:["intervals"],skipComponentNames:!0}}),definition:function({dependencyValues:rs}){return{setValue:{nIntervals:rs.intervalChildren.length},checkForActualChange:{nIntervals:!0}}}},ts.intervals={isArray:!0,nDimensions:1,entryPrefixes:["interval"],returnArraySizeDependencies:()=>({nIntervals:{dependencyType:"stateVariable",variableName:"nIntervals"}}),returnArraySize({dependencyValues:rs}){return[rs.nIntervals]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={intervalChild:{dependencyType:"child",childGroups:["intervals"],variableNames:["value"],childIndices:[is]}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].intervalChild[0];os&&(is[as]=os.stateValues.value)}return{setValue:{intervals:is}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.intervals)is.push({setDependency:ns[as].intervalChild,desiredValue:rs.intervals[as],childIndex:0,variableIndex:0});return{success:!0,instructions:is}}},ts}}Ms(IntervalListComponent,"componentType","_intervalListComponent"),Ms(IntervalListComponent,"rendererType","containerInline"),Ms(IntervalListComponent,"renderChildren",!0);function breakEmbeddedStringsIntoIntervalPieces({componentList:ss}){let ts=0,rs=[],ns=[];for(let is of ss){if(typeof is!="string"){if(ts===0)return{success:!1};ns.push(is);continue}let as=is.trim(),os=0;for(let ls=0;ls<as.length;ls++){let us=as[ls];if(us==="("||ts===0&&us==="[")ts++;else if(us===")"||ts===1&&us==="]"){if(ts===0)return{success:!1};if(ts===1){if(ls+1>os){let cs=ls+1,ps=as.substring(os,cs).trim();ps.length>0&&ns.push(ps)}rs.push(ns),ns=[],os=ls+1}ts--}else if(ts===0&&!us.match(/\s/))return{success:!1}}if(as.length>os){let ls=as.substring(os,as.length).trim();ns.push(ls)}}return ts!==0?{success:!1}:ns.length>0?{success:!1}:{success:!0,pieces:rs}}class LineListComponent extends BaseComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:ns.reduce(function(as,os){return typeof os=="string"?[...as,...os.split(/\s+/).filter(ls=>ls).map(ls=>({componentType:"line",children:[ls]}))]:[...as,os]},[])}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"lines",componentTypes:["line"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nLines={returnDependencies:()=>({lineChildren:{dependencyType:"child",childGroups:["lines"],skipComponentNames:!0}}),definition:function({dependencyValues:rs}){return{setValue:{nLines:rs.lineChildren.length},checkForActualChange:{nLines:!0}}}},ts.lineNames={isArray:!0,entryPrefixes:["lineName"],returnArraySizeDependencies:()=>({nLines:{dependencyType:"stateVariable",variableName:"nLines"}}),returnArraySize({dependencyValues:rs}){return[rs.nLines]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={lineChild:{dependencyType:"child",childGroups:["lines"],childIndices:[is]}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].lineChild[0];os&&(is[as]=os.componentName)}return{setValue:{lineNames:is}}}},ts}}Ms(LineListComponent,"componentType","_lineListComponent"),Ms(LineListComponent,"rendererType","containerInline"),Ms(LineListComponent,"renderChildren",!0);class AngleListComponent extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.hide={default:!0},ts}static returnChildLogic(ts){let rs=super.returnChildLogic(ts),ns=rs.newLeaf({name:"AtLeastZeroAngles",componentType:"angle",comparison:"atLeast",number:0}),is=breakStringsAndOthersIntoComponentsByStringCommas(),as=rs.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),os=rs.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),ls=rs.newOperator({name:"StringsAndMaths",operator:"or",propositions:[as,os],requireConsecutive:!0,isSugar:!0,replacementFunction:is});return rs.newOperator({name:"AnglesXorSugar",operator:"xor",propositions:[ns,ls],setAsBase:!0}),rs}updateState(ts={}){if(ts.init&&(this._state.angles={trackChanges:!0}),super.updateState(ts),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.nAngles=!0;return}if(this.currentTracker.trackChanges.childrenChanged(this.componentName)){delete this.unresolvedState.angles,delete this.unresolvedState.nAngles;let is=this.childLogic.returnMatches("AtLeastZeroAngles");this.state.nAngles=is.length,this.state.angles=is.map(as=>this.activeChildren[as])}}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.container({key:this.componentName}))}updateChildrenWhoRender(){this.childrenWhoRender=this.state.angles.map(ts=>ts.componentName)}}Ms(AngleListComponent,"componentType","_angleListComponent");class Vector extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveVector:this.moveVector.bind(this),vectorClicked:this.vectorClicked.bind(this),mouseDownOnVector:this.mouseDownOnVector.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.headDraggable={createComponentOfType:"boolean"},ts.tailDraggable={createComponentOfType:"boolean"},ts.x={createComponentOfType:"math"},ts.y={createComponentOfType:"math"},ts.z={createComponentOfType:"math"},ts.xs={createComponentOfType:"mathList"},ts.displacement={createComponentOfType:"vector"},ts.head={createComponentOfType:"point"},ts.tail={createComponentOfType:"point"},ts.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.displayWithAngleBrackets={createComponentOfType:"boolean",createStateVariable:"displayWithAngleBrackets",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){let os=returnBreakStringsSugarFunction({childrenToComponentFunction:fs=>({componentType:"math",children:fs}),mustStripOffOuterParentheses:!0}),ls=ns.map(fs=>typeof fs),us=ls.indexOf("string"),cs=ls.lastIndexOf("string");if(us===-1){let fs=is.componentIsSpecifiedType,hs=ns.filter(ys=>!(fs(ys,"point")||fs(ys,"vector")||fs(ys,"label")));if(hs.length===1){let ys=hs[0],gs=ns.indexOf(ys),bs=[...ns.slice(0,gs),...ns.slice(gs+1)];return{success:!0,newAttributes:{displacement:{component:{componentType:"math",children:hs}}},newChildren:bs}}else return{success:!1}}let ps=[...ns.slice(0,us),...ns.slice(cs+1)];ns=ns.slice(us,cs+1);let ds=os({matchedChildren:ns});return!ds.success&&ns.length===1?{success:!0,newAttributes:{x:{component:{componentType:"math",children:ns}}},newChildren:ps}:ds.success?{success:!0,newAttributes:{xs:{component:{componentType:"mathList",children:ds.newChildren,skipSugar:!0}}},newChildren:ps}:{success:!1}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){let ts=super.returnChildGroups();return ts.push({group:"points",componentTypes:["point"]},{group:"vectors",componentTypes:["vector"]}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" vector"}}}},ts.tailDraggable={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({tailDraggableAttr:{dependencyType:"attributeComponent",attributeName:"tailDraggable",variableNames:["value"]},draggable:{dependencyType:"stateVariable",variableName:"draggable"}}),definition({dependencyValues:rs}){return rs.tailDraggableAttr?{setValue:{tailDraggable:rs.tailDraggableAttr.stateValues.value}}:{useEssentialOrDefaultValue:{tailDraggable:{defaultValue:rs.draggable}}}}},ts.headDraggable={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({headDraggableAttr:{dependencyType:"attributeComponent",attributeName:"headDraggable",variableNames:["value"]},draggable:{dependencyType:"stateVariable",variableName:"draggable"}}),definition({dependencyValues:rs}){return rs.headDraggableAttr?{setValue:{headDraggable:rs.headDraggableAttr.stateValues.value}}:{useEssentialOrDefaultValue:{headDraggable:{defaultValue:rs.draggable}}}}},ts.displacementShadow={defaultValue:null,hasEssential:!0,essentialVarName:"displacement",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{displacementShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"displacementShadow",value:convertValueToMathExpression(rs.displacementShadow)}]}}},ts.headShadow={defaultValue:null,hasEssential:!0,essentialVarName:"head",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{headShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"headShadow",value:convertValueToMathExpression(rs.headShadow)}]}}},ts.tailShadow={defaultValue:null,hasEssential:!0,essentialVarName:"tail",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{tailShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"tailShadow",value:convertValueToMathExpression(rs.tailShadow)}]}}},ts.sourceOfDisplacement={returnDependencies:()=>({xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement"},pointChild:{dependencyType:"child",childGroups:["points"]},vectorChild:{dependencyType:"child",childGroups:["vectors"]}}),definition({dependencyValues:rs}){let ns=null;return rs.vectorChild.length>0?ns="vectorChild":rs.pointChild.length>0?ns="pointChild":rs.displacementAttr!==null?ns="displacementAttr":rs.xsAttr!==null?ns="xsAttr":(rs.xAttr!==null||rs.yAttr!==null||rs.zAttr!==null)&&(ns="componentAttrs"),{setValue:{sourceOfDisplacement:ns}}}},ts.basedOnHead={returnDependencies:()=>({headAttr:{dependencyType:"attributeComponent",attributeName:"head"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}}),definition:function({dependencyValues:rs}){return rs.tailAttr!==null&&rs.sourceOfDisplacement!==null?(rs.headAttr!==null&&console.warn("Vector is prescribed by head, tail, and displacement.  Ignoring specified head."),{setValue:{basedOnHead:!1},checkForActualChange:{basedOnHead:!0}}):rs.headAttr!==null?{setValue:{basedOnHead:!0},checkForActualChange:{basedOnHead:!0}}:{setValue:{basedOnHead:rs.headShadow!==null},checkForActualChange:{basedOnHead:!0}}}},ts.basedOnTail={returnDependencies:()=>({tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}}),definition:function({dependencyValues:rs}){return rs.tailAttr!==null?{setValue:{basedOnTail:!0},checkForActualChange:{basedOnTail:!0}}:{setValue:{basedOnTail:rs.tailShadow!==null},checkForActualChange:{basedOnTail:!0}}}},ts.basedOnDisplacement={returnDependencies:()=>({sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"}}),definition:function({dependencyValues:rs}){return rs.sourceOfDisplacement!==null?{setValue:{basedOnDisplacement:!0},checkForActualChange:{basedOnDisplacement:!0}}:{setValue:{basedOnDisplacement:rs.displacementShadow!==null},checkForActualChange:{basedOnDisplacement:!0}}}},ts.nDimDisplacement={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:rs}){let ns={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["nDimensions"]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["nDimensions"]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"]},xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]}};return rs.basedOnDisplacement||(rs.basedOnHead&&(ns.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),rs.basedOnTail&&(ns.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnDisplacement)switch(rs.sourceOfDisplacement){case"vectorChild":ns=rs.vectorChild[0].stateValues.nDimensions;break;case"pointChild":ns=rs.pointChild[0].stateValues.nDimensions;break;case"displacementAttr":ns=rs.displacementAttr.stateValues.nDimensions;break;case"xsAttr":ns=rs.xsAttr.stateValues.nComponents;break;case"componentAttrs":rs.zAttr!==null?ns=3:rs.yAttr!==null?ns=2:ns=1;break;default:let is=rs.displacementShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=1}else rs.basedOnHead?rs.basedOnTail?rs.nDimHead===rs.nDimTail?ns=rs.nDimHead:ns=NaN:ns=rs.nDimHead:rs.basedOnTail?ns=rs.nDimTail:ns=2;return{setValue:{nDimDisplacement:ns},checkForActualChange:{nDimDisplacement:!0}}}},ts.nDimHead={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:rs}){let ns={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["nDimensions"]}};return rs.basedOnHead||(rs.basedOnTail&&(ns.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"}),rs.basedOnDisplacement&&(ns.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnHead){if(rs.headAttr!==null)ns=rs.headAttr.stateValues.nDimensions;else if(rs.headShadow){let is=rs.headShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=2}}else rs.basedOnDisplacement?rs.basedOnTail?rs.nDimDisplacement===rs.nDimTail?ns=rs.nDimDisplacement:ns=NaN:ns=rs.nDimDisplacement:rs.basedOnTail?ns=rs.nDimTail:ns=2;return{setValue:{nDimHead:ns},checkForActualChange:{nDimHead:!0}}}},ts.nDimTail={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:rs}){let ns={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["nDimensions"]}};return rs.basedOnTail||(rs.basedOnHead&&(ns.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),rs.basedOnDisplacement&&(ns.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),ns},definition:function({dependencyValues:rs}){let ns;if(rs.basedOnTail){if(rs.tailAttr!==null)ns=rs.tailAttr.stateValues.nDimensions;else if(rs.tailShadow){let is=rs.tailShadow.tree;Array.isArray(is)&&vectorOperators.includes(is[0])?ns=is.length-1:ns=2}}else rs.basedOnDisplacement?rs.basedOnHead?rs.nDimDisplacement===rs.nDimHead?ns=rs.nDimDisplacement:ns=NaN:ns=rs.nDimDisplacement:rs.basedOnHead?ns=rs.nDimHead:ns=2;return{setValue:{nDimTail:ns},checkForActualChange:{nDimTail:!0}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"},nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"},nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),definition:function({dependencyValues:rs}){let ns;if(rs.basedOnDisplacement){if(rs.basedOnTail){if(rs.nDimDisplacement!==rs.nDimTail)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}}}else if(rs.basedOnHead&&rs.nDimDisplacement!==rs.nDimHead)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};ns=rs.nDimDisplacement}else if(rs.basedOnTail){if(rs.basedOnHead&&rs.nDimTail!==rs.nDimHead)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};ns=rs.nDimTail}else rs.basedOnHead?ns=rs.nDimHead:ns=2;return{setValue:{nDimensions:ns},checkForActualChange:{nDimensions:!0}}}},ts.displacement={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros","displayWithAngleBrackets"],returnWrappingComponents(rs){return rs==="x"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["x"],hasEssential:!0,essentialVarName:"displacement2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","sourceOfDisplacement"],returnArraySizeDependencies:()=>({nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimDisplacement]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+ls]},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["x"+ls]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+ls]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["x"+ls]}},os==="0"?as[os].componentAttr={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:os==="1"?as[os].componentAttr={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:os==="2"&&(as[os].componentAttr={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]}),!ns.basedOnDisplacement&&ns.basedOnHead&&(as[os].tailX={dependencyType:"stateVariable",variableName:"tailX"+ls},as[os].headX={dependencyType:"stateVariable",variableName:"headX"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let us of is){let cs=Number(us)+1;if(rs.basedOnDisplacement)switch(rs.sourceOfDisplacement){case"vectorChild":as[us]=ns[us].vectorChild[0].stateValues["x"+cs];break;case"pointChild":as[us]=ns[us].pointChild[0].stateValues["x"+cs];break;case"displacementAttr":as[us]=ns[us].displacementAttr.stateValues["x"+cs];break;case"xsAttr":as[us]=ns[us].xsAttr.stateValues["math"+cs].simplify();break;case"componentAttrs":let ps=ns[us].componentAttr;ps===null?os[us]={defaultValue:Context.fromAst(0)}:as[us]=ps.stateValues.value.simplify();break;default:let ds=rs.displacementShadow.tree;Array.isArray(ds)&&vectorOperators.includes(ds[0])?as[us]=rs.displacementShadow.get_component(Number(us)):as[us]=rs.displacementShadow}else rs.basedOnHead?as[us]=ns[us].headX.subtract(ns[us].tailX).simplify():os[us]={defaultValue:Context.fromAst(us==="0"?1:0)}}let ls={};return Object.keys(as).length>0&&(ls.setValue={displacement:as}),Object.keys(os).length>0&&(ls.useEssentialOrDefaultValue={displacement:os}),ls},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.displacement)if(ns.basedOnDisplacement)switch(ns.sourceOfDisplacement){case"vectorChild":ls.push({setDependency:as[cs].vectorChild,desiredValue:rs.displacement[cs],childIndex:0,variableIndex:0});break;case"pointChild":ls.push({setDependency:as[cs].pointChild,desiredValue:rs.displacement[cs],childIndex:0,variableIndex:0});break;case"displacementAttr":ls.push({setDependency:as[cs].displacementAttr,desiredValue:rs.displacement[cs],variableIndex:0});break;case"xsAttr":ls.push({setDependency:as[cs].xsAttr,desiredValue:rs.displacement[cs],variableIndex:0});break;case"componentAttrs":is[cs].componentAttr===null?ls.push({setEssentialValue:"displacement",value:{[cs]:convertValueToMathExpression(rs.displacement[cs])}}):ls.push({setDependency:as[cs].componentAttr,desiredValue:rs.displacement[cs],variableIndex:0});break;default:us=!0}else ns.basedOnHead?ls.push({setDependency:as[cs].headX,desiredValue:is[cs].tailX.add(rs.displacement[cs]).simplify()}):ls.push({setEssentialValue:"displacement",value:{[cs]:convertValueToMathExpression(rs.displacement[cs])}});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.displacement)cs[Number(ps)+1]=rs.displacement[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"displacementShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.displacement&&ls.push({setDependency:"displacementShadow",desiredValue:rs.displacement[0]});return{success:!0,instructions:ls}}},ts.x={isAlias:!0,targetVariableName:"x1"},ts.y={isAlias:!0,targetVariableName:"x2"},ts.z={isAlias:!0,targetVariableName:"x3"},ts.head={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(rs){return rs==="headX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["headX"],set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnHead"],returnArraySizeDependencies:()=>({nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimHead]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["x"+ls]}},ns.basedOnHead||(as[os].tailX={dependencyType:"stateVariable",variableName:"tailX"+ls},as[os].x={dependencyType:"stateVariable",variableName:"x"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is){let ls=Number(os)+1;rs.basedOnHead?ns[os].headAttr!==null?as[os]=ns[os].headAttr.stateValues["x"+ls]:rs.headShadow!==null&&(as[os]=rs.headShadow.get_component(Number(os))):as[os]=ns[os].tailX.add(ns[os].x).simplify()}return{setValue:{head:as}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.head)ns.basedOnHead?is[cs].headAttr&&is[cs].headAttr!==null?ls.push({setDependency:as[cs].headAttr,desiredValue:rs.head[cs],variableIndex:0}):ns.headShadow!==null&&(us=!0):ls.push({setDependency:as[cs].x,desiredValue:rs.head[cs].subtract(is[cs].tailX).simplify()});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.head)cs[Number(ps)+1]=rs.head[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"headShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.head&&ls.push({setDependency:"headShadow",desiredValue:rs.head[0]});return{success:!0,instructions:ls}}},ts.tail={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(rs){return rs==="tailX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,entryPrefixes:["tailX"],hasEssential:!0,defaultValueByArrayKey:()=>Context.fromAst(0),essentialVarName:"tail2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnTail","basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimTail]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}},as={};for(let os of rs){let ls=Number(os)+1;as[os]={tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["x"+ls]}},ns.basedOnTail||ns.basedOnHead&&ns.basedOnDisplacement&&(as[os].headX={dependencyType:"stateVariable",variableName:"headX"+ls},as[os].x={dependencyType:"stateVariable",variableName:"x"+ls})}return{globalDependencies:is,dependenciesByKey:as}},arrayDefinitionByKey:function({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){let as={},os={};for(let us of is){let cs=Number(us)+1;ns[us].tailAttr!==null?as[us]=ns[us].tailAttr.stateValues["x"+cs]:rs.tailShadow!==null?as[us]=rs.tailShadow.get_component(Number(us)):rs.basedOnHead&&rs.basedOnDisplacement?as[us]=ns[us].headX.subtract(ns[us].x).simplify():os[us]=!0}let ls={};return Object.keys(as).length>0&&(ls.setValue={tail:as}),Object.keys(os).length>0&&(ls.useEssentialOrDefaultValue={tail:os}),ls},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os}){let ls=[],us=!1;for(let cs in rs.tail)is[cs].tailAttr&&is[cs].tailAttr!==null?ls.push({setDependency:as[cs].tailAttr,desiredValue:rs.tail[cs],variableIndex:0}):ns.tailShadow!==null?us=!0:ns.basedOnHead&&ns.basedOnDisplacement?ls.push({setDependency:as[cs].x,desiredValue:is[cs].headX.subtract(rs.tail[cs]).simplify()}):ls.push({setEssentialValue:"tail",value:{[cs]:convertValueToMathExpression(rs.tail[cs])}});if(us)if(os[0]>1){let cs=["vector"];for(let ps in rs.tail)cs[Number(ps)+1]=rs.tail[ps].tree;cs.length=os[0]+1,ls.push({setDependency:"tailShadow",desiredValue:Context.fromAst(cs)})}else os[0]===1&&"0"in rs.tail&&ls.push({setDependency:"tailShadow",desiredValue:rs.tail[0]});return{success:!0,instructions:ls}}},ts.magnitude={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},displacement:{dependencyType:"stateVariable",variableName:"displacement"}}),definition({dependencyValues:rs}){let ns=0,is=!0;for(let as=0;as<rs.nDimensions;as++){let os=rs.displacement[as].evaluate_to_constant();if(!Number.isFinite(os)){is=!1;break}ns+=os*os}if(is)return{setValue:{magnitude:Context.fromAst(Math.sqrt(ns))}};ns=["+"];for(let as=0;as<rs.nDimensions;as++)ns.push(["^",rs.displacement[as],2]);return{setValue:{magnitude:Context.fromAst(["apply","sqrt",ns])}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){let is=[],as=0,os=!0;for(let ps=0;ps<ns.nDimensions;ps++){let ds=ns.displacement[ps].evaluate_to_constant();if(!Number.isFinite(ds)){os=!1;break}is.push(ds),as+=ds*ds}if(!os)return{success:!1};let ls=Math.sqrt(as);is=is.map(ps=>ps/ls);let us=rs.magnitude.evaluate_to_constant();if(!Number.isFinite(us)||us<0)return{success:!1};let cs=[];for(let ps=0;ps<ns.nDimensions;ps++)cs.push(Context.fromAst(is[ps]*us));return{success:!0,instructions:[{setDependency:"displacement",desiredValue:cs}]}}},ts.numericalEndpoints={forRenderer:!0,returnDependencies:()=>({head:{dependencyType:"stateVariable",variableName:"head"},tail:{dependencyType:"stateVariable",variableName:"tail"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition:function({dependencyValues:rs}){let ns,is;if(rs.nDimensions===1)ns=rs.head[0].evaluate_to_constant(),is=rs.tail[0].evaluate_to_constant();else{ns=[],is=[];for(let as=0;as<rs.nDimensions;as++){let os=rs.head[as].evaluate_to_constant();ns.push(os);let ls=rs.tail[as].evaluate_to_constant();is.push(ls)}}return{setValue:{numericalEndpoints:[is,ns]}}}},ts.displacementCoords={returnDependencies:()=>({displacement:{dependencyType:"stateVariable",variableName:"displacement"},displayWithAngleBrackets:{dependencyType:"stateVariable",variableName:"displayWithAngleBrackets"}}),definition({dependencyValues:rs}){let ns=[];for(let is of rs.displacement)is?ns.push(is.tree):ns.push("");return ns.length>1?ns=[rs.displayWithAngleBrackets?"altvector":"vector",...ns]:ns.length===1?ns=ns[0]:ns="",{setValue:{displacementCoords:Context.fromAst(ns)}}},inverseDefinition({desiredStateVariableValues:rs}){let ns=rs.displacementCoords.tree,is;return Array.isArray(ns)&&vectorOperators.includes(ns[0])?is=ns.slice(1).map(as=>Context.fromAst(as)):is=[rs.displacementCoords],{success:!0,instructions:[{setDependency:"displacement",desiredValue:is}]}}},ts.latex={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({displacementCoords:{dependencyType:"stateVariable",variableName:"displacementCoords"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is={};return rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits)),{setValue:{latex:roundForDisplay({value:rs.displacementCoords,dependencyValues:rs,usedDefault:ns}).toLatex(is)}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition({dependencyValues:rs}){var cs,ps,ds,fs;let ns=(cs=rs.numericalEndpoints[0])==null?void 0:cs[0],is=(ps=rs.numericalEndpoints[0])==null?void 0:ps[1],as=(ds=rs.numericalEndpoints[1])==null?void 0:ds[0],os=(fs=rs.numericalEndpoints[1])==null?void 0:fs[1],ls=Number.isFinite(ns)&&Number.isFinite(is)&&Number.isFinite(as)&&Number.isFinite(os),us=rs.nDimensions!==2||!ls||as===ns&&os===is;return{setValue:{nearestPoint:function({variables:hs,scales:ys}){if(us)return{};let gs=ys[0],bs=ys[1],vs=(as-ns)/gs,Ns=(os-is)/bs,Ts=vs*vs+Ns*Ns,Cs=((hs.x1-ns)/gs*vs+(hs.x2-is)/bs*Ns)/Ts,xs={};return Cs<=0?xs={x1:ns,x2:is}:Cs>=1?xs={x1:as,x2:os}:xs={x1:ns+Cs*vs*gs,x2:is+Cs*Ns*bs},hs.x3!==void 0&&(xs.x3=0),xs}}}}},ts}async moveVector({tailcoords:ts,headcoords:rs,transient:ns,skippable:is,sourceDetails:as,actionId:os,sourceInformation:ls={},skipRendererUpdate:us=!1}){if(ts!==void 0){if(rs!==void 0){if(!await this.stateValues.draggable)return await this.coreFunctions.resolveAction({actionId:os})}else if(!await this.stateValues.tailDraggable)return await this.coreFunctions.resolveAction({actionId:os})}else if(!await this.stateValues.headDraggable)return await this.coreFunctions.resolveAction({actionId:os});let cs=[];if(ts!==void 0){if(await this.stateValues.basedOnHead&&await this.stateValues.basedOnDisplacement){let ps;if(rs===void 0){let ds=await this.stateValues.numericalEndpoints;ps=ts.map((fs,hs)=>ds[1][hs]-fs)}else ps=ts.map((ds,fs)=>rs[fs]-ds);cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:ps.map(ds=>Context.fromAst(ds)),sourceDetails:as})}else cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"tail",value:ts.map(ps=>Context.fromAst(ps)),sourceDetails:as});if(rs===void 0&&!await this.stateValues.basedOnHead){let ps=await this.stateValues.numericalEndpoints,ds=ts.map((fs,hs)=>ps[1][hs]-fs);cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:ds.map(fs=>Context.fromAst(fs)),sourceDetails:as})}}if(rs!==void 0){if(await this.stateValues.basedOnHead)cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"head",value:rs.map(ps=>Context.fromAst(ps)),sourceDetails:as});else{ts==null&&(ts=(await this.stateValues.numericalEndpoints)[0]);let ps=ts.map((ds,fs)=>rs[fs]-ds);cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:ps.map(ds=>Context.fromAst(ds)),sourceDetails:as})}if(ts===void 0&&await this.stateValues.basedOnHead&&await this.stateValues.basedOnDisplacement){let ps=await this.stateValues.numericalEndpoints,ds=rs.map((fs,hs)=>fs-ps[0][hs]);cs.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:ds.map(fs=>Context.fromAst(fs)),sourceDetails:as})}}return ns?await this.coreFunctions.performUpdate({updateInstructions:cs,transient:ns,skippable:is,actionId:os,sourceInformation:ls,skipRendererUpdate:us}):await this.coreFunctions.performUpdate({updateInstructions:cs,actionId:os,sourceInformation:ls,skipRendererUpdate:us,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{head:rs,tail:ts}}})}async vectorClicked({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"click",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}async mouseDownOnVector({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.triggerChainedActions({triggeringAction:"down",componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.coreFunctions.resolveAction({actionId:ts})}}Ms(Vector,"componentType","vector"),Ms(Vector,"primaryStateVariableForDefinition","displacementShadow"),Ms(Vector,"adapters",[{stateVariable:"displacementCoords",componentType:"coords",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}]);class Angle extends GraphicalComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.radius={createComponentOfType:"math",createStateVariable:"radius",defaultValue:Context.fromAst(1),public:!0},ts.chooseReflexAngle={createComponentOfType:"text",createStateVariable:"chooseReflexAngle",defaultValue:"never",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["never","allowed","always"]},ts.inDegrees={createComponentOfType:"boolean",createStateVariable:"inDegrees",defaultValue:!1,public:!0,forRenderer:!0},ts.radians={createComponentOfType:"math"},ts.degrees={createComponentOfType:"math"},ts.through={createComponentOfType:"_pointListComponent"},ts.betweenLines={createComponentOfType:"_lineListComponent"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.emphasizeRightAngle={createComponentOfType:"boolean",createStateVariable:"emphasizeRightAngle",defaultValue:!0,public:!0,forRenderer:!0},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentInfoObjects:is}){let as=cs=>is.componentIsSpecifiedType(cs,"label"),os=ns.map(as),ls=[],us=[];if(os.filter(cs=>cs).length===0)ls=ns;else{if(os[0]){let ps=os.indexOf(!1);ps!==-1&&(us.push(...ns.slice(0,ps)),ns=ns.slice(ps),os=os.slice(ps))}let cs=os.indexOf(!0);cs===-1?ls=ns:(ls=ns.slice(0,cs),us.push(...ns.slice(cs)))}return ls.length===0?{success:!1}:{success:!0,newAttributes:{radians:{component:{componentType:"math",children:ls}}},newChildren:us}};return ts.push({replacementFunction:rs}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.betweenLinesName={returnDependencies:()=>({betweenLines:{dependencyType:"attributeComponent",attributeName:"betweenLines"}}),definition({dependencyValues:rs}){let ns=null;return rs.betweenLines!==null&&(ns=rs.betweenLines.componentName),{setValue:{betweenLinesName:ns}}}},ts.nPointsSpecified={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:rs}){return rs.through!==null?{setValue:{nPointsSpecified:rs.through.stateValues.nPoints}}:{setValue:{nPointsSpecified:0}}}},ts.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],stateVariablesDeterminingDependencies:["betweenLinesName"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[3,2]},getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="pointX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},returnArrayDependenciesByKey({stateValues:rs}){let ns={nPointsSpecified:{dependencyType:"stateVariable",variableName:"nPointsSpecified"},throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["points"]},radiansAttr:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degreesAttr:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]}};return rs.betweenLinesName!==null&&(ns.lineChildren={dependencyType:"child",parentName:rs.betweenLinesName,childGroups:["lines"],variableNames:["points","nDimensions","coeff0","coeffvar1","coeffvar2","nearestPoint"]}),{globalDependencies:ns}},arrayDefinitionByKey({globalDependencyValues:rs}){if(rs.lineChildren)if(rs.lineChildren.length>2){console.warn(`Cannot define an angle between ${rs.lineChildren.length} line(s)`);let os={};for(let ls=0;ls<3;ls++)for(let us=0;us<2;us++)os[ls+","+us]=Context.fromAst("");return{setValue:{points:os}}}else if(rs.lineChildren.length===1){let os=rs.lineChildren[0];if(os.stateValues.nDimensions!==2){let bs={};for(let vs=0;vs<3;vs++)for(let Ns=0;Ns<2;Ns++)bs[vs+","+Ns]=Context.fromAst("");return{setValue:{points:bs}}}let ls=os.stateValues.nearestPoint({variables:{x1:Context.fromAst(0),x2:Context.fromAst(0)}}),us=os.stateValues.points[0][0].evaluate_to_constant(),cs=os.stateValues.points[0][1].evaluate_to_constant(),ps=os.stateValues.points[1][0].evaluate_to_constant(),ds=os.stateValues.points[1][1].evaluate_to_constant(),fs=Math.atan2(ds-cs,ps-us),hs={"0,0":Context.fromAst(ls.x1+Math.cos(fs)),"0,1":Context.fromAst(ls.x2+Math.sin(fs)),"1,0":Context.fromAst(ls.x1),"1,1":Context.fromAst(ls.x2)},ys=null;if(rs.radiansAttr){if(ys=rs.radiansAttr.stateValues.value.evaluate_to_constant(),!Number.isFinite(ys)){let bs={};return bs["2,0"]=Context.fromAst(""),bs["2,1"]=Context.fromAst(""),{setValue:{points:bs}}}}else if(rs.degreesAttr){let bs=rs.degreesAttr.stateValues.value.evaluate_to_constant();if(Number.isFinite(bs))ys=bs/180*Math.PI;else return hs["2,0"]=Context.fromAst(""),hs["2,1"]=Context.fromAst(""),{setValue:{points:hs}}}else ys=Math.PI/2;let gs=fs+ys;return hs["2,0"]=Context.fromAst(ls.x1+Math.cos(gs)),hs["2,1"]=Context.fromAst(ls.x2+Math.sin(gs)),{setValue:{points:hs}}}else{let os=rs.lineChildren[0],ls=rs.lineChildren[1],us=calculateLineIntersection(os,ls);if(us===void 0){let bs={};for(let vs=0;vs<3;vs++)for(let Ns=0;Ns<2;Ns++)bs[vs+","+Ns]=Context.fromAst("");return{setValue:{points:bs}}}let cs=us,ps=os.stateValues.points[0][0].evaluate_to_constant(),ds=os.stateValues.points[0][1].evaluate_to_constant(),fs=os.stateValues.points[1][0].evaluate_to_constant(),hs=os.stateValues.points[1][1].evaluate_to_constant(),ys=[Context.fromAst(cs[0].tree+fs-ps),Context.fromAst(cs[1].tree+hs-ds)];ps=ls.stateValues.points[0][0].evaluate_to_constant(),ds=ls.stateValues.points[0][1].evaluate_to_constant(),fs=ls.stateValues.points[1][0].evaluate_to_constant(),hs=ls.stateValues.points[1][1].evaluate_to_constant();let gs=[Context.fromAst(cs[0].tree+fs-ps),Context.fromAst(cs[1].tree+hs-ds)];return{setValue:{points:{"0,0":ys[0],"0,1":ys[1],"1,0":cs[0],"1,1":cs[1],"2,0":gs[0],"2,1":gs[1]}}}}let ns=rs.nPointsSpecified,is;rs.throughAttr?is=rs.throughAttr.stateValues.points:is=[];let as={};for(let[os,ls]of is.entries())as[os+",0"]=ls[0],as[os+",1"]=ls[1];if(ns===0&&(as["0,0"]=Context.fromAst(1),as["0,1"]=Context.fromAst(0)),ns<2&&(as["1,0"]=Context.fromAst(0),as["1,1"]=Context.fromAst(0)),ns<3){let os=null;if(rs.radiansAttr){if(os=rs.radiansAttr.stateValues.value.evaluate_to_constant(),!Number.isFinite(os))return as["2,0"]=Context.fromAst(""),as["2,1"]=Context.fromAst(""),{setValue:{points:as}}}else if(rs.degreesAttr){let hs=rs.degreesAttr.stateValues.value.evaluate_to_constant();if(Number.isFinite(hs))os=hs/180*Math.PI;else return as["2,0"]=Context.fromAst(""),as["2,1"]=Context.fromAst(""),{setValue:{points:as}}}else os=Math.PI/2;let ls=as["0,0"].evaluate_to_constant(),us=as["0,1"].evaluate_to_constant(),cs=as["1,0"].evaluate_to_constant(),ps=as["1,1"].evaluate_to_constant(),fs=Math.atan2(us-ps,ls-cs)+os;as["2,0"]=Context.fromAst(cs+Math.cos(fs)),as["2,1"]=Context.fromAst(ps+Math.sin(fs))}return{setValue:{points:as}}}},ts.radians={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},additionalStateVariablesDefined:[{variableName:"swapPointOrder",forRenderer:!0}],returnDependencies:()=>({radians:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degrees:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]},points:{dependencyType:"stateVariable",variableName:"points"},chooseReflexAngle:{dependencyType:"stateVariable",variableName:"chooseReflexAngle"}}),definition({dependencyValues:rs}){let ns=!1;if(rs.radians!==null)return{setValue:{radians:rs.radians.stateValues.value.simplify(),swapPointOrder:ns}};if(rs.degrees!==null)return{setValue:{radians:rs.degrees.stateValues.value.divide(Context.fromAst(180)).simplify().multiply(Context.fromAst("pi")).simplify(),swapPointOrder:ns}};let is=[],as=!1;for(let ls=0;ls<3;ls++)is.push([rs.points[ls][0].evaluate_to_constant(),rs.points[ls][1].evaluate_to_constant()]),(Number.isNaN(is[ls][0])||Number.isNaN(is[ls][1]))&&(as=!0);let os;return as?{setValue:{radians:Context.fromAst(""),swapPointOrder:ns}}:(os=Math.atan2(is[2][1]-is[1][1],is[2][0]-is[1][0])-Math.atan2(is[0][1]-is[1][1],is[0][0]-is[1][0]),os<0&&(os+=2*Math.PI),os>Math.PI?rs.chooseReflexAngle==="never"&&(os=2*Math.PI-os,ns=!0):rs.chooseReflexAngle==="always"&&(os=2*Math.PI-os,ns=!0),{setValue:{radians:Context.fromAst(os),swapPointOrder:ns}})}},ts.value={isAlias:!0,targetVariableName:"radians"},ts.angle={isAlias:!0,targetVariableName:"radians"},ts.degrees={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({radians:{dependencyType:"stateVariable",variableName:"radians"}}),definition({dependencyValues:rs}){let ns;if(rs.radians.tree===""||Number.isNaN(rs.radians.tree))ns=rs.radians;else{let is=rs.radians.evaluate_to_constant();Number.isFinite(is)?ns=Context.fromAst(is*180/Math.PI):ns=rs.radians.multiply(Context.fromAst(["/",180,"pi"])).simplify()}return{setValue:{degrees:ns}}}},ts.latexForRenderer={forRenderer:!0,returnDependencies:()=>({inDegrees:{dependencyType:"stateVariable",variableName:"inDegrees"},radians:{dependencyType:"stateVariable",variableName:"radians"},degrees:{dependencyType:"stateVariable",variableName:"degrees"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is={};rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits));let as=rs.inDegrees?rs.degrees:rs.radians,os=roundForDisplay({value:as,dependencyValues:rs,usedDefault:ns}).toLatex(is);return rs.inDegrees&&(os+="^\\circ"),{setValue:{latexForRenderer:os}}}},ts.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({}),returnArraySize(){return[3]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(is)+1)}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].point,ls=[];for(let us=0;us<2;us++){let cs=os[us].evaluate_to_constant();ls.push(cs)}is[as]=ls}return{setValue:{numericalPoints:is}}}},ts.numericalRadius={forRenderer:!0,returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:rs}){return{setValue:{numericalRadius:rs.radius.evaluate_to_constant()}}}},ts}}Ms(Angle,"componentType","angle"),Ms(Angle,"adapters",["radians"]);function calculateLineIntersection(ss,ts){if(ss.stateValues.nDimensions!==2||ts.stateValues.nDimensions!==2){console.log("Calculating angle between two lines implemented only in 2D");return}let rs=ss.stateValues.coeffvar1.evaluate_to_constant(),ns=ss.stateValues.coeffvar2.evaluate_to_constant(),is=ss.stateValues.coeff0.evaluate_to_constant(),as=ts.stateValues.coeffvar1.evaluate_to_constant(),os=ts.stateValues.coeffvar2.evaluate_to_constant(),ls=ts.stateValues.coeff0.evaluate_to_constant();if(!(Number.isFinite(rs)&&Number.isFinite(ns)&&Number.isFinite(is)&&Number.isFinite(as)&&Number.isFinite(os)&&Number.isFinite(ls))){console.log("Calculating angle between two lines implemented only for constant coefficients");return}let us=rs*os-as*ns;if(Math.abs(us)<1e-14)if(Math.abs(ls*rs-is*as)>1e-14){console.log("Cannot calculate angle between two parallel lines");return}else return rs===0&&ns===0&&is===0||as===0&&os===0&&ls===0?void 0:ns!==0?[Context.fromAst(0),Context.fromAst(-is/ns)]:[Context.fromAst(-is/rs),Context.fromAst(0)];let cs=(ls*ns-is*os)/us,ps=(is*as-ls*rs)/us;return[Context.fromAst(cs),Context.fromAst(ps)]}var defaults$5={space:"",cycles:!1,replacer:(ss,ts)=>ts,stringify:JSON.stringify},util$1={isArray:Array.isArray,assign:Object.assign,isObject:ss=>typeof ss=="object",isFunction:ss=>typeof ss=="function",isBoolean:ss=>typeof ss=="boolean",isRegex:ss=>ss instanceof RegExp,keys:Object.keys};const DEFAULTS=defaults$5,isFunction$2=util$1.isFunction,isBoolean$1=util$1.isBoolean,isObject$2=util$1.isObject,isArray$3=util$1.isArray,isRegex=util$1.isRegex,assign$1=util$1.assign,keys$1=util$1.keys;function serialize(ss){return ss==null?ss:isRegex(ss)?ss.toString():ss.toJSON?ss.toJSON():ss}function stringifyDeterministic(ss,ts){ts=ts||assign$1({},DEFAULTS),isFunction$2(ts)&&(ts={compare:ts});const rs=ts.space||DEFAULTS.space,ns=isBoolean$1(ts.cycles)?ts.cycles:DEFAULTS.cycles,is=ts.replacer||DEFAULTS.replacer,as=ts.stringify||DEFAULTS.stringify,os=ts.compare&&function(us){return function(cs){return function(ps,ds){const fs={key:ps,value:cs[ps]},hs={key:ds,value:cs[ds]};return us(fs,hs)}}}(ts.compare);ns||as(ss);const ls=[];return function us(cs,ps,ds,fs){const hs=rs?`
`+new Array(fs+1).join(rs):"",ys=rs?": ":":";if(ds=serialize(ds),ds=is.call(cs,ps,ds),ds!==void 0){if(!isObject$2(ds)||ds===null)return as(ds);if(isArray$3(ds)){const gs=[];for(let bs=0;bs<ds.length;bs++){const vs=us(ds,bs,ds[bs],fs+1)||as(null);gs.push(hs+rs+vs)}return"["+gs.join(",")+hs+"]"}else{if(ns){if(ls.indexOf(ds)!==-1)return as("[Circular]");ls.push(ds)}const gs=keys$1(ds).sort(os&&os(ds)),bs=[];for(let vs=0;vs<gs.length;vs++){const Ns=gs[vs],Ts=us(ds,Ns,ds[Ns],fs+1);if(!Ts)continue;const Cs=as(Ns)+ys+Ts;bs.push(hs+rs+Cs)}return ls.splice(ls.indexOf(ds),1),"{"+bs.join(",")+hs+"}"}}}({"":ss},"",ss,0)}var lib=stringifyDeterministic;class Answer extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{submitAnswer:this.submitAnswer.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},ts.handGraded={createPrimitiveOfType:"boolean",createStateVariable:"handGraded",defaultValue:!1,public:!0},ts.inline={createComponentOfType:"boolean",createStateVariable:"inline",defaultValue:!1,public:!0},ts.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0},ts.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0},ts.forceFullCheckworkButton={createComponentOfType:"boolean",createStateVariable:"forceFullCheckworkButton",defaultValue:!1,public:!0},ts.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0},ts.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0},ts.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0},ts.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0},ts.nAwardsCredited={createComponentOfType:"integer",createStateVariable:"nAwardsCredited",defaultValue:1,public:!0},ts.maximumNumberOfAttempts={createComponentOfType:"integer",createStateVariable:"maximumNumberOfAttempts",defaultValue:1/0,public:!0},ts.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0},ts.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0},ts.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0},ts.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0},ts.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0},ts.caseInsensitiveMatch={createComponentOfType:"boolean",createStateVariable:"caseInsensitiveMatch",defaultValue:!1,public:!0},ts.matchBlanks={createComponentOfType:"boolean",createStateVariable:"matchBlanks",defaultValue:!1,public:!0},ts.showCorrectness={createComponentOfType:"boolean",createStateVariable:"showCorrectnessPreliminary",defaultValue:null},ts.type={createPrimitiveOfType:"string"},ts.disableAfterCorrect={createComponentOfType:"boolean",createStateVariable:"disableAfterCorrect",defaultValue:!1,public:!0},ts.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},ts.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},ts.selectMultiple={createComponentOfType:"boolean",createStateVariable:"selectMultiple",defaultValue:!1,public:!0},ts.shuffleOrder={createPrimitiveOfType:"boolean",createStateVariable:"shuffleOrder",defaultValue:!1,public:!0},ts.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0},ts.parseScientificNotation={createComponentOfType:"boolean",createStateVariable:"parseScientificNotation",defaultValue:!1,public:!0},ts.expanded={createComponentOfType:"boolean",createStateVariable:"expanded",defaultValue:!1,public:!0},ts.suppressToast={createComponentOfType:"boolean",createStateVariable:"suppressToast",defaultValue:!1},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentAttributes:is,componentInfoObjects:as}){var Es,Ss,Ds,Vs,Is,Os,Ps,$s,Rs;function os(ks){var _s;for(let Bs of ks){if((_s=Bs==null?void 0:Bs.attributes)!=null&&_s.isResponse&&Bs.attributes.isResponse.primitive!==!1)return!0;if(Bs.children&&os(Bs.children))return!0}return!1}function ls(ks){for(let _s of ks)as.isInheritedComponentType({inheritedComponentType:_s.componentType,baseComponentType:"_composite"})?(_s.attributes||(_s.attributes={}),_s.attributes.isResponse=!0):_s.children&&ls(_s.children)}let us=as.componentIsSpecifiedType,cs=!1,ps=!1,ds=!1,fs=0,hs=!1,ys=!1,gs=!1,bs=!1,vs=[];for(let ks of ns)if(typeof ks!="object")vs.push(!0),ks.trim()&&(ys=!0);else if(us(ks,"math")||us(ks,"number")||us(ks,"mathList")||us(ks,"numberList"))vs.push(!0),ys=!0,cs=!0;else if(us(ks,"text")||us(ks,"textList"))vs.push(!0),ps=!0,ys=!0;else if(us(ks,"boolean"))vs.push(!0),ds=!0,ys=!0;else if(us(ks,"booleanList"))vs.push(!0),ds=!0;else if(us(ks,"choice"))vs.push(!0),fs++;else if(us(ks,"award"))if(bs=!0,vs.push(!1),(Es=ks.attributes)!=null&&Es.sourcesAreResponses&&(gs=!0),((Ss=ks.children)==null?void 0:Ss.length)>0)for(let _s of ks.children)typeof _s!="object"?_s.trim()&&(ys=!0):us(_s,"when")||(us(_s,"math")||us(_s,"number")||us(_s,"mathList")||us(_s,"numberList")?(cs=!0,ys=!0):us(_s,"text")||us(_s,"textList")?(ps=!0,ys=!0):us(_s,"boolean")?(ds=!0,ys=!0):us(_s,"booleanList")?ds=!0:as.isInheritedComponentType({inheritedComponentType:_s.componentType,baseComponentType:"_composite"})&&!((Vs=(Ds=_s.attributes)==null?void 0:Ds.createComponentOfType)!=null&&Vs.primitive)?ys=!0:us(_s,"orbitalDiagram")||(ys=!0));else ys=!0;else us(ks,"mathInput")?(vs.push(!1),cs=!0,hs=!0):us(ks,"textInput")?(vs.push(!1),ps=!0,hs=!0):us(ks,"_input")||us(ks,"considerAsResponses")?(vs.push(!1),hs=!0):(as.isInheritedComponentType({inheritedComponentType:ks.componentType,baseComponentType:"_composite"})&&((Os=(Is=ks.attributes)==null?void 0:Is.createComponentOfType)!=null&&Os.primitive),vs.push(!0),ys=!0);if(hs&&(gs=!0),fs>0){if(ns=ns.filter(ks=>typeof ks!="string"||ks.trim()!==""),ns.length!==fs)return{success:!1};{let ks={componentType:"choiceInput",children:ns};return is.shuffleOrder&&(ks.attributes={shuffleOrder:{primitive:!0}}),{success:!0,newChildren:[ks]}}}if(is.handGraded&&!bs&&(ys=!0),!ys&&!gs){for(let ks of ns)if(us(ks,"award")&&((Ps=ks.children)==null?void 0:Ps.length)>0&&os(ks.children)){gs=!0;break}if(!gs)for(let ks of ns)us(ks,"award")&&(($s=ks.children)==null?void 0:$s.length)>0&&ls(ks.children)}let Ns=[],Ts=[],Cs=[];if(vs.filter(ks=>!ks).length===0)Ns=ns;else{if(!vs[0]){let _s=vs.indexOf(!0);_s!==-1&&(Ts=ns.slice(0,_s),ns=ns.slice(_s),vs=vs.slice(_s))}let ks=vs.indexOf(!1);ks===-1?Ns=ns:(Ns=ns.slice(0,ks),Cs=ns.slice(ks))}for(;typeof Ns[0]=="string"&&Ns[0].trim()==="";)Ns=Ns.slice(1);let xs=Ns.length;for(;typeof Ns[xs-1]=="string"&&Ns[xs-1].trim()==="";)Ns=Ns.slice(0,xs-1),xs=Ns.length;let As,ws;if(is.type?(ws=is.type,["math","text","boolean"].includes(ws)||(console.warn(`Invalid type ${ws}`),ws="math")):cs?ws="math":ps?ws="text":ds?ws="boolean":ws="math",Ns.length===0)As=[...Ts,...Cs];else{let ks=Ns.length>1||as.isInheritedComponentType({inheritedComponentType:Ns[0].componentType,baseComponentType:"_composite"})&&!((Rs=Ns[0].props)!=null&&Rs.componentType),_s;ks?_s=[{componentType:ws,children:Ns}]:_s=Ns,As=[...Ts,{componentType:"award",children:_s},...Cs]}return ys&&!hs&&(As=[{componentType:ws+"Input"},...As]),{success:!0,newChildren:As}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"awards",componentTypes:["award"]},{group:"inputs",componentTypes:["_input"]},{group:"responses",componentTypes:["considerAsResponses"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:ts,oldName:"disabled",newName:"disabledOriginal"}),ts.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessPreliminary:{dependencyType:"stateVariable",variableName:"showCorrectnessPreliminary"},showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},handGraded:{dependencyType:"stateVariable",variableName:"handGraded"}}),definition({dependencyValues:rs,usedDefault:ns}){let is;return ns.showCorrectnessPreliminary?is=rs.showCorrectnessFlag!==!1&&!rs.handGraded:is=rs.showCorrectnessPreliminary,{setValue:{showCorrectness:is}}}},ts.haveAwardThatRequiresInput={returnDependencies:()=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["requireInputInAnswer"]}}),definition({dependencyValues:rs}){return{setValue:{haveAwardThatRequiresInput:rs.awardChildren.some(ns=>ns.stateValues.requireInputInAnswer)}}}},ts.allInputChildrenIncludingSugared={returnDependencies:()=>({allInputChildrenIncludingSugared:{dependencyType:"child",childGroups:["inputs"]}}),definition({dependencyValues:rs}){return{setValue:{allInputChildrenIncludingSugared:rs.allInputChildrenIncludingSugared}}}},ts.inputChildren={stateVariablesDeterminingDependencies:["allInputChildrenIncludingSugared"],additionalStateVariablesDefined:["inputChildIndices","skippedFirstInput"],forRenderer:!0,returnDependencies({stateValues:rs}){let ns={allInputChildrenIncludingSugared:{dependencyType:"stateVariable",variableName:"allInputChildrenIncludingSugared"},haveAwardThatRequiresInput:{dependencyType:"stateVariable",variableName:"haveAwardThatRequiresInput"},handGraded:{dependencyType:"stateVariable",variableName:"handGraded"}};return rs.allInputChildrenIncludingSugared.length>0&&(ns.firstInputFromSugar={dependencyType:"doenetAttribute",componentName:rs.allInputChildrenIncludingSugared[0].componentName,attributeName:"createdFromSugar"}),ns},definition({dependencyValues:rs}){var ls;let ns=[...rs.allInputChildrenIncludingSugared],is=[...rs.allInputChildrenIncludingSugared.keys()],as=!1;return((ls=ns[0])==null?void 0:ls.componentType)!=="choiceInput"&&(!(rs.haveAwardThatRequiresInput||rs.handGraded)||rs.allInputChildrenIncludingSugared.length>1)&&rs.firstInputFromSugar&&(as=!0,ns=ns.slice(1),is=is.slice(1)),{setValue:{inputChildren:ns,inputChildIndices:is,skippedFirstInput:as}}}},ts.inputChildrenWithValues={stateVariablesDeterminingDependencies:["inputChildIndices"],forRenderer:!0,returnDependencies:({stateValues:rs})=>({inputChildren:{dependencyType:"child",childGroups:["inputs"],variableNames:["valueToRecordOnSubmit","valueRecordedAtSubmit","value"],childIndices:rs.inputChildIndices,variablesOptional:!0}}),definition:function({dependencyValues:rs}){return{setValue:{inputChildrenWithValues:rs.inputChildren}}}},ts.inputChildWithValues={returnDependencies:()=>({inputChildrenWithValues:{dependencyType:"stateVariable",variableName:"inputChildrenWithValues"}}),definition({dependencyValues:rs}){let ns=null;return rs.inputChildrenWithValues.length===1&&(ns=rs.inputChildrenWithValues[0]),{setValue:{inputChildWithValues:ns}}}},ts.awardInputResponseChildren={returnDependencies:()=>({awardInputResponseChildren:{dependencyType:"child",childGroups:["awards","inputs","responses"]},skippedFirstInput:{dependencyType:"stateVariable",variableName:"skippedFirstInput"}}),definition({dependencyValues:rs}){let ns=[...rs.awardInputResponseChildren];return rs.skippedFirstInput&&(ns=ns.slice(1)),{setValue:{awardInputResponseChildren:ns}}}},ts.nResponses={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnDependencies({stateValues:rs,componentInfoObjects:ns}){let is={childTypes:{dependencyType:"value",value:rs.awardInputResponseChildren.map(as=>as.componentType)}};for(let[as,os]of rs.awardInputResponseChildren.entries())ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"award"})?is["child"+as]={dependencyType:"descendant",ancestorName:os.componentName,componentTypes:["_base"],variableNames:["isResponse","nValues"],variablesOptional:!0,recurseToMatchedChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"_input"})?is["childNValues"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"nValues",variablesOptional:!0}:is["child"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"childrenWithNValues"};return is},definition({dependencyValues:rs,componentInfoObjects:ns}){let is=0;for(let[as,os]of rs.childTypes.entries())if(ns.isInheritedComponentType({inheritedComponentType:os,baseComponentType:"award"}))for(let ls of rs["child"+as])!ls.stateValues.isResponse||ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"_composite"})||(ls.stateValues.nValues===void 0?is+=1:is+=ls.stateValues.nValues);else if(ns.isInheritedComponentType({inheritedComponentType:os,baseComponentType:"_input"})){let ls=rs["childNValues"+as];ls===void 0?is+=1:is+=ls}else for(let ls of rs["child"+as])ls.stateValues.nValues===void 0?is+=1:is+=ls.stateValues.nValues;return{setValue:{nResponses:is}}}},ts.currentResponses={public:!0,shadowingInstructions:{hasVariableComponentType:!0},isArray:!0,entryPrefixes:["currentResponse"],stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnArraySizeDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),returnArraySize({dependencyValues:rs}){return[rs.nResponses]},returnArrayDependenciesByKey({stateValues:rs,componentInfoObjects:ns}){let is={childTypes:{dependencyType:"value",value:rs.awardInputResponseChildren.map(as=>as.componentType)}};for(let[as,os]of rs.awardInputResponseChildren.entries())ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"award"})?is["child"+as]={dependencyType:"descendant",ancestorName:os.componentName,componentTypes:["_base"],variableNames:["isResponse","value","values","formula","componentType"],variablesOptional:!0,recurseToMatchedChildren:!0,includeAttributeChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:ns.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"_input"})?(is["childValue"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"value",variablesOptional:!0},is["childValues"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"values",variablesOptional:!0},is["childComponentType"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"componentType",variablesOptional:!0}):is["child"+as]={dependencyType:"stateVariable",componentName:os.componentName,variableName:"childrenAsResponses"};return{globalDependencies:is}},arrayDefinitionByKey({globalDependencyValues:rs,componentInfoObjects:ns}){let is=[],as=[],os=[];for(let[ls,us]of rs.childTypes.entries())if(ns.isInheritedComponentType({inheritedComponentType:us,baseComponentType:"award"}))for(let cs of rs["child"+ls])!cs.stateValues.isResponse||ns.isInheritedComponentType({inheritedComponentType:cs.componentType,baseComponentType:"_composite"})||os.push(cs);else if(ns.isInheritedComponentType({inheritedComponentType:us,baseComponentType:"_input"})){let cs={componentType:us,stateValues:{value:rs["childValue"+ls],values:rs["childValues"+ls],componentType:rs["childComponentType"+ls]}};os.push(cs)}else os.push(...rs["child"+ls]);for(let ls of os){let us=ls.stateValues.componentType;us||(us=ls.componentType),us==="mathList"?us="math":us==="numberList"?us="number":us==="textList"?us="text":us==="booleanList"&&(us="boolean"),Array.isArray(ls.stateValues.values)?(is.push(...ls.stateValues.values),as.push(...Array(ls.stateValues.values.length).fill(us))):ls.stateValues.value!==void 0?(is.push(ls.stateValues.value),as.push(us)):ls.stateValues.formula instanceof Context.class?(is.push(ls.stateValues.formula),as.push("math")):(is.push(""),as.push("text"))}return{setValue:{currentResponses:is},setCreateComponentOfType:{currentResponses:as}}}},ts.currentResponse={isAlias:!0,targetVariableName:"currentResponse1"},ts.nSubmittedResponses={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nSubmittedResponses:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"nSubmittedResponses",value:rs.nSubmittedResponses}]}}},ts.submittedResponsesComponentType={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedResponsesComponentType:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return rs.submittedResponsesComponentType?{success:!0,instructions:[{setEssentialValue:"submittedResponsesComponentType",value:[...rs.submittedResponsesComponentType]}]}:{success:!0,instructions:[{setEssentialValue:"submittedResponsesComponentType",value:[]}]}}},ts.submittedResponses={public:!0,shadowingInstructions:{hasVariableComponentType:!0},isArray:!0,entryPrefixes:["submittedResponse"],defaultValueByArrayKey:()=>"",hasEssential:!0,inverseShadowToSetEntireArray:!0,doNotCombineInverseArrayInstructions:!0,returnArraySizeDependencies:()=>({nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}),returnArraySize({dependencyValues:rs}){return[rs.nSubmittedResponses]},returnArrayDependenciesByKey(){return{globalDependencies:{submittedResponsesComponentType:{dependencyType:"stateVariable",variableName:"submittedResponsesComponentType"},nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns=[];rs.submittedResponsesComponentType&&ns.push(...rs.submittedResponsesComponentType.slice(0,rs.nSubmittedResponses));let is={};for(let as=0;as<rs.nSubmittedResponses;as++)is[as]=!0,ns[as]||(ns[as]="math");return{useEssentialOrDefaultValue:{submittedResponses:is},setCreateComponentOfType:{submittedResponses:ns}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:rs,initialChange:ns}){return ns?{success:!0,instructions:[{setDependency:"nSubmittedResponses",desiredValue:rs.submittedResponses.length},{setEssentialValue:"submittedResponses",value:[...rs.submittedResponses]}]}:{success:!1}}},ts.submittedResponse={isAlias:!0,targetVariableName:"submittedResponse1"},ts.suppressCheckwork={forRenderer:!0,returnDependencies:()=>({autoSubmit:{dependencyType:"flag",flagName:"autoSubmit"}}),definition({dependencyValues:rs}){return{setValue:{suppressCheckwork:rs.autoSubmit}}}},ts.delegateCheckWork={additionalStateVariablesDefined:["delegateCheckWorkToInput","delegateCheckWorkToAncestor"],forRenderer:!0,returnDependencies:()=>({inputChildren:{dependencyType:"stateVariable",variableName:"inputChildren"},forceFullCheckworkButton:{dependencyType:"stateVariable",variableName:"forceFullCheckworkButton"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons"]},documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["suppressAnswerSubmitButtons"]}}),definition:function({dependencyValues:rs}){var os;let ns=!1,is=!1,as=!1;return rs.documentAncestor.stateValues.suppressAnswerSubmitButtons||(os=rs.sectionAncestor)!=null&&os.stateValues.suppressAnswerSubmitButtons?ns=as=!0:rs.inputChildren.length===1&&!rs.forceFullCheckworkButton&&(is=as=!0),{setValue:{delegateCheckWork:as,delegateCheckWorkToAncestor:ns,delegateCheckWorkToInput:is}}}},ts.creditAchievedIfSubmit={additionalStateVariablesDefined:["awardsUsedIfSubmit","awardChildren","inputUsedIfSubmit"],stateVariablesDeterminingDependencies:["inputChildIndices"],returnDependencies:({stateValues:rs})=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["credit","creditAchievedIfSubmit","fractionSatisfiedIfSubmit"]},inputChildren:{dependencyType:"child",childGroups:["inputs"],variableNames:["creditAchievedIfSubmit","value"],childIndices:rs.inputChildIndices,variablesOptional:!0},nAwardsCredited:{dependencyType:"stateVariable",variableName:"nAwardsCredited"}}),definition:function({dependencyValues:rs}){let ns=0,is=rs.nAwardsCredited,as=Array(is).fill(null),os=null;if(rs.awardChildren.length===0){if(rs.inputChildren.length===1){let ls=rs.inputChildren[0].stateValues.creditAchievedIfSubmit;ls>=0&&(ns=ls,os=rs.inputChildren[0].componentName)}}else{let ls=Array(is).fill(null),us=0;for(let cs of rs.awardChildren){let ps=cs.stateValues.creditAchievedIfSubmit;if((ps>us||as[is-1]===null)&&cs.stateValues.fractionSatisfiedIfSubmit>0){if(as[0]===null)as[0]=cs.componentName,ls[0]=ps,us=Math.min(...ls);else for(let[ds,fs]of ls.entries())if(ps>fs||fs===null){as.splice(ds,0,cs.componentName),as=as.slice(0,is),ls.splice(ds,0,ps),ls=ls.slice(0,is),us=Math.min(...ls);break}}}ns=Math.min(1,ls.reduce((cs,ps)=>cs+ps,0))}return{setValue:{creditAchievedIfSubmit:ns,awardsUsedIfSubmit:as,awardChildren:rs.awardChildren,inputUsedIfSubmit:os}}}},ts.creditAchieved={defaultValue:0,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"creditAchieved",value:rs.creditAchieved}]}}},ts.responseHasBeenSubmitted={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{responseHasBeenSubmitted:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"responseHasBeenSubmitted",value:rs.responseHasBeenSubmitted}]}}},ts.autoSubmit={returnDependencies:()=>({autoSubmit:{dependencyType:"flag",flagName:"autoSubmit"}}),definition({dependencyValues:rs}){return{setValue:{autoSubmit:!!rs.autoSubmit}}}},ts.creditAchievedDependencies={shadowVariable:!0,stateVariablesDeterminingDependencies:["autoSubmit"],returnDependencies:({stateValues:rs})=>({currentCreditAchievedDependencies:{dependencyType:"recursiveDependencyValues",variableNames:["creditAchievedIfSubmit"],includeImmediateValueWithValue:!rs.autoSubmit,includeRawValueWithImmediateValue:!rs.autoSubmit,includeOnlyEssentialValues:!0}}),definition({dependencyValues:rs}){let ns=lib(rs.currentCreditAchievedDependencies,{replacer:serializedComponentsReplacer});return{setValue:{creditAchievedDependencies:encBase64Exports.stringify(sha1Exports(ns))}}},markStale:()=>({answerCreditPotentiallyChanged:!0})},ts.creditAchievedDependenciesAtSubmit={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchievedDependenciesAtSubmit:!0}}),inverseDefinition:function({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"creditAchievedDependenciesAtSubmit",value:rs.creditAchievedDependenciesAtSubmit}]}}},ts.justSubmitted={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"stateVariable",variableName:"creditAchievedDependencies"},creditAchievedDependenciesAtSubmit:{dependencyType:"stateVariable",variableName:"creditAchievedDependenciesAtSubmit"},disableAfterCorrect:{dependencyType:"stateVariable",variableName:"disableAfterCorrect"},hasBeenCorrect:{dependencyType:"stateVariable",variableName:"hasBeenCorrect"}}),definition:function({dependencyValues:rs,justUpdatedForNewComponent:ns,componentName:is}){return rs.disableAfterCorrect&&rs.hasBeenCorrect?{setValue:{justSubmitted:!0}}:rs.creditAchievedDependenciesAtSubmit!==rs.currentCreditAchievedDependencies&&!ns?{setValue:{justSubmitted:!1},setEssentialValue:{justSubmitted:!1}}:{useEssentialOrDefaultValue:{justSubmitted:!0}}},inverseDefinition({desiredStateVariableValues:rs,componentName:ns}){return{success:!0,instructions:[{setEssentialValue:"justSubmitted",value:rs.justSubmitted}]}}},ts.allFeedbacks={returnDependencies:()=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["feedbacks"]},feedbackComponents:{dependencyType:"descendant",componentTypes:["_input"],variableNames:["feedbacks"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let is of rs.awardChildren)ns.push(...is.stateValues.feedbacks);for(let is of rs.feedbackComponents)Array.isArray(is.stateValues.feedbacks)&&ns.push(...is.stateValues.feedbacks);return{setValue:{allFeedbacks:ns}}}},ts.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:rs}){return{setValue:{numberFeedbacks:rs.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},ts.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:rs}){return[rs.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns={};for(let is=0;is<rs.__array_size;is++)ns[is]=rs.allFeedbacks[is];return{setValue:{feedbacks:ns}}}},ts.nSubmissions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nSubmissions:!0}}),inverseDefinition:({desiredStateVariableValues:rs})=>({success:!0,instructions:[{setEssentialValue:"nSubmissions",value:rs.nSubmissions}]})},ts.numberOfAttemptsLeft={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({nSubmissions:{dependencyType:"stateVariable",variableName:"nSubmissions"},maximumNumberOfAttempts:{dependencyType:"stateVariable",variableName:"maximumNumberOfAttempts"}}),definition({dependencyValues:rs}){return{setValue:{numberOfAttemptsLeft:rs.maximumNumberOfAttempts-rs.nSubmissions}}}},ts.hasBeenCorrect={defaultValue:!1,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"}}),definition({dependencyValues:rs}){return rs.creditAchieved===1?{setValue:{hasBeenCorrect:!0},setEssentialValue:{hasBeenCorrect:!0}}:{useEssentialOrDefaultValue:{hasBeenCorrect:!0}}}},ts.disabled={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,stateVariablesDeterminingDependencies:["disableAfterCorrect"],returnDependencies({stateValues:rs}){let ns={disabledOriginal:{dependencyType:"stateVariable",variableName:"disabledOriginal"},numberOfAttemptsLeft:{dependencyType:"stateVariable",variableName:"numberOfAttemptsLeft"},disableAfterCorrect:{dependencyType:"stateVariable",variableName:"disableAfterCorrect"}};return rs.disableAfterCorrect&&(ns.hasBeenCorrect={dependencyType:"stateVariable",variableName:"hasBeenCorrect"}),ns},definition({dependencyValues:rs}){return{setValue:{disabled:rs.disabledOriginal||rs.numberOfAttemptsLeft<1||rs.disableAfterCorrect&&rs.hasBeenCorrect}}}},ts.inItemNumber={returnDependencies:()=>({documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["itemNumberByAnswerName"]}}),definition({dependencyValues:rs,componentName:ns}){return{setValue:{inItemNumber:rs.documentAncestor.stateValues.itemNumberByAnswerName[ns]}}}},ts}async submitAnswer({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.numberOfAttemptsLeft;if(is<1){console.warn(`Cannot submit answer for ${this.componentName} as number of attempts left is ${is}`);return}let as=await this.stateValues.creditAchievedIfSubmit;await this.stateValues.handGraded&&(as=0);let os=await this.stateValues.awardsUsedIfSubmit,ls=await this.stateValues.inputUsedIfSubmit,us=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchieved",value:as},{updateType:"updateValue",componentName:this.componentName,stateVariable:"responseHasBeenSubmitted",value:!0}],cs=await this.stateValues.inputChildrenWithValues;if(cs.length===1){let fs=cs[0];ls===fs.componentName&&"valueToRecordOnSubmit"in fs.stateValues&&"valueRecordedAtSubmit"in fs.stateValues&&us.push({updateType:"updateValue",componentName:fs.componentName,stateVariable:"valueRecordedAtSubmit",value:fs.stateValues.valueToRecordOnSubmit})}let ps=await this.stateValues.currentResponses;us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponses",value:ps}),us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponsesComponentType",value:this.state.currentResponses.shadowingInstructions.createComponentOfType}),us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"justSubmitted",value:!0}),us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchievedDependenciesAtSubmit",value:await this.stateValues.creditAchievedDependencies}),us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"nSubmissions",value:await this.stateValues.nSubmissions+1});for(let fs of await this.stateValues.awardChildren){let hs=os.includes(fs.componentName);us.push({updateType:"updateValue",componentName:fs.componentName,stateVariable:"awarded",value:hs}),us.push({updateType:"updateValue",componentName:fs.componentName,stateVariable:"creditAchieved",value:fs.stateValues.creditAchievedIfSubmit}),us.push({updateType:"updateValue",componentName:fs.componentName,stateVariable:"fractionSatisfied",value:fs.stateValues.fractionSatisfiedIfSubmit})}let ds=[];for(let fs of ps)if(fs.toString)try{ds.push(fs.toString())}catch{ds.push("")}else ds.push(fs);return us.push({updateType:"recordItemSubmission",itemNumber:await this.stateValues.inItemNumber,submittedComponent:this.componentName,response:ps,responseText:ds,creditAchieved:as}),await this.coreFunctions.performUpdate({updateInstructions:us,actionId:ts,sourceInformation:rs,skipRendererUpdate:!0,event:{verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{response:ps,responseText:ds,creditAchieved:as}},suppressToast:await this.stateValues.suppressToast}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}Ms(Answer,"componentType","answer"),Ms(Answer,"renderChildren",!0),Ms(Answer,"variableForPlainMacro","submittedResponses"),Ms(Answer,"variableForPlainCopy","submittedResponses"),Ms(Answer,"includeBlankStringChildren",!0),Ms(Answer,"removeBlankStringChildrenPostSugar",!0),Ms(Answer,"processWhenJustUpdatedForNewComponent",!0);class Award extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:1,public:!0,attributesForCreatedComponent:{convertBoolean:!0}},ts.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"},ts.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0,fallBackToParentStateVariable:"symbolicEquality"},ts.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0,fallBackToParentStateVariable:"expandOnCompare"},ts.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numberspreserveorder"],public:!0,fallBackToParentStateVariable:"simplifyOnCompare"},ts.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0,fallBackToParentStateVariable:"unorderedCompare"},ts.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchByExactPositions"},ts.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0,fallBackToParentStateVariable:"allowedErrorInNumbers"},ts.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0,fallBackToParentStateVariable:"includeErrorInNumberExponents"},ts.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0,fallBackToParentStateVariable:"allowedErrorIsAbsolute"},ts.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0,fallBackToParentStateVariable:"nSignErrorsMatched"},ts.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0,fallBackToParentStateVariable:"nPeriodicSetMatchesRequired"},ts.caseInsensitiveMatch={createComponentOfType:"boolean",createStateVariable:"caseInsensitiveMatch",defaultValue:!1,public:!0,fallBackToParentStateVariable:"caseInsensitiveMatch"},ts.matchBlanks={createComponentOfType:"boolean",createStateVariable:"matchBlanks",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchBlanks"},ts.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0},ts.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0},ts.sourcesAreResponses={createPrimitiveOfType:"string"},ts.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0,fallBackToParentStateVariable:"splitSymbols"},ts.parseScientificNotation={createComponentOfType:"boolean",createStateVariable:"parseScientificNotation",defaultValue:!1,public:!0,fallBackToParentStateVariable:"parseScientificNotation"},ts}static preprocessSerializedChildren({serializedChildren:ts,attributes:rs,componentName:ns}){var is;if(rs.sourcesAreResponses){let as=rs.sourcesAreResponses.primitive.split(/\s+/).filter(ls=>ls),os;(is=rs.newNamespace)!=null&&is.primitive?os=ns+"/":os=getNamespaceFromName(ns);for(let ls of as){let us;if(ls[0]==="/")us=ls;else if(ls.slice(0,3)==="../"){let cs=getNamespaceFromName(os.slice(0,os.length-1)),ps=ls.slice(3);for(;ps.slice(0,3)==="../";){if(cs==="/"){us=null;break}cs=getNamespaceFromName(cs.slice(0,cs.length-1)),ps=ps.slice(3)}us!==null&&(us=cs+ps)}else us=os+ls;addResponsesToDescendantsWithTarget(ts,ls,us)}}}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,parentAttributes:is,componentInfoObjects:as}){for(;typeof ns[0]=="string"&&ns[0].trim()==="";)ns=ns.slice(1);let os=ns.length;for(;typeof ns[os-1]=="string"&&ns[os-1].trim()==="";)ns=ns.slice(0,os-1),os=ns.length;if(ns.length===1&&typeof ns[0]=="object")return{success:!1};let ls=as.componentIsSpecifiedType,us=!1,cs=!1,ps=!1;for(let fs of ns)typeof fs=="object"&&(ls(fs,"math")||ls(fs,"number")||ls(fs,"mathList")||ls(fs,"numberList")?us=!0:ls(fs,"text")||ls(fs,"textList")?cs=!0:(ls(fs,"boolean")||ls(fs,"booleanList"))&&(ps=!0));let ds;return is.type?(ds=is.type,["math","text","boolean"].includes(ds)||(console.warn(`Invalid type ${ds}`),ds="math")):us?ds="math":cs?ds="text":ps?ds="boolean":ds="math",{success:!0,newChildren:[{componentType:ds,children:ns}]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"whens",componentTypes:["when"]},{group:"maths",componentTypes:["math"]},{group:"numbers",componentTypes:["number"]},{group:"texts",componentTypes:["text"]},{group:"booleans",componentTypes:["boolean"]},{group:"mathLists",componentTypes:["mathList"]},{group:"numberLists",componentTypes:["numberList"]},{group:"textLists",componentTypes:["textList"]},{group:"booleanLists",componentTypes:["booleanList"]},{group:"otherComparableTypes",componentTypes:["orbitalDiagram"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.parsedExpression={additionalStateVariablesDefined:["requireInputInAnswer"],returnDependencies:()=>({whenChild:{dependencyType:"child",childGroups:["whens"]},typeChildren:{dependencyType:"child",childGroups:["maths","numbers","texts","booleans","mathLists","numberLists","textLists","booleanLists","otherComparableTypes"]}}),definition:function({dependencyValues:rs}){let ns=null,is=!1;return rs.whenChild.length==0&&rs.typeChildren.length>0&&(is=!0,ns=Context.fromAst(["=","comp1","comp2"])),{setValue:{parsedExpression:ns,requireInputInAnswer:is}}}},ts.creditAchievedIfSubmit={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"fractionSatisfiedIfSubmit",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({credit:{dependencyType:"stateVariable",variableName:"credit"},whenChild:{dependencyType:"child",childGroups:["whens"],variableNames:["fractionSatisfied"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value","unordered"]},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},textChild:{dependencyType:"child",childGroups:["texts"],variableNames:["value"]},booleanChild:{dependencyType:"child",childGroups:["booleans"],variableNames:["value"]},mathListChild:{dependencyType:"child",childGroups:["mathLists"],variableNames:["maths","unordered"]},numberListChild:{dependencyType:"child",childGroups:["numberLists"],variableNames:["numbers","unordered"]},textListChild:{dependencyType:"child",childGroups:["textLists"],variableNames:["texts","unordered"]},booleanListChild:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["booleans","unordered"]},otherComparableChild:{dependencyType:"child",childGroups:["otherComparableTypes"],variableNames:["value"]},answerInput:{dependencyType:"parentStateVariable",variableName:"inputChildWithValues"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"},caseInsensitiveMatch:{dependencyType:"stateVariable",variableName:"caseInsensitiveMatch"},matchBlanks:{dependencyType:"stateVariable",variableName:"matchBlanks"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is;if(rs.whenChild.length>0)is=rs.whenChild[0].stateValues.fractionSatisfied;else{if(!rs.answerInput||!rs.parsedExpression)return{setValue:{creditAchievedIfSubmit:0,fractionSatisfiedIfSubmit:0}};is=evaluateLogicDirectlyFromChildren({dependencyValues:rs,usedDefault:ns})}is=Math.max(0,Math.min(1,is));let as=0;return Number.isFinite(rs.credit)&&(as=Math.max(0,Math.min(1,rs.credit))*is),{setValue:{fractionSatisfiedIfSubmit:is,creditAchievedIfSubmit:as}}}},ts.fractionSatisfied={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fractionSatisfied:!0}}),inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns}){return ns?{success:!0,instructions:[{setEssentialValue:"fractionSatisfied",value:rs.fractionSatisfied}]}:{success:!1}}},ts.creditAchieved={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:!0}}),inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns}){return ns?{success:!0,instructions:[{setEssentialValue:"creditAchieved",value:rs.creditAchieved}]}:{success:!1}}},ts.awarded={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{awarded:!0}}),inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns}){return ns?{success:!0,instructions:[{setEssentialValue:"awarded",value:rs.awarded}]}:{success:!1}}},ts.allFeedbacks={returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitionAncestor:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},awarded:{dependencyType:"stateVariable",variableName:"awarded"}}),definition:function({dependencyValues:rs}){if(!rs.awarded)return{setValue:{allFeedbacks:[]}};let ns=[],is=rs.feedbackDefinitionAncestor.stateValues.feedbackDefinitions;for(let as of rs.feedbackCodes){let os=as.toLowerCase(),ls=is[os];ls&&ns.push(ls)}return rs.feedbackText!==null&&ns.push(rs.feedbackText),{setValue:{allFeedbacks:ns}}}},ts.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:rs}){return{setValue:{numberFeedbacks:rs.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},ts.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:rs}){return[rs.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns={};for(let is=0;is<rs.__array_size;is++)ns[is]=rs.allFeedbacks[is];return{setValue:{feedbacks:ns}}}},ts.feedback={isAlias:!0,targetVariableName:"feedback1"},ts}}Ms(Award,"componentType","award"),Ms(Award,"rendererType"),Ms(Award,"includeBlankStringChildren",!0),Ms(Award,"removeBlankStringChildrenPostSugar",!0),Ms(Award,"variableForPlainMacro","awarded"),Ms(Award,"variableForPlainCopy","awarded"),Ms(Award,"standardizedFeedback",{numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."});function evaluateLogicDirectlyFromChildren({dependencyValues:ss,usedDefault:ts}){let rs={mathChildrenByCode:{},mathListChildrenByCode:{},numberChildrenByCode:{},numberListChildrenByCode:{},textChildrenByCode:{},textListChildrenByCode:{},booleanChildrenByCode:{},booleanListChildrenByCode:{},otherChildrenByCode:{}};Object.assign(rs,ss);let ns=ts.unorderedCompare;ss.textChild.length>0?rs.textChildrenByCode.comp2=ss.textChild[0]:ss.mathChild.length>0?rs.mathChildrenByCode.comp2=ss.mathChild[0]:ss.numberChild.length>0?rs.numberChildrenByCode.comp2=ss.numberChild[0]:ss.booleanChild.length>0?rs.booleanChildrenByCode.comp2=ss.booleanChild[0]:ss.textListChild.length>0?rs.textListChildrenByCode.comp2=ss.textListChild[0]:ss.mathListChild.length>0?rs.mathListChildrenByCode.comp2=ss.mathListChild[0]:ss.numberListChild.length>0?rs.numberListChildrenByCode.comp2=ss.numberListChild[0]:ss.booleanListChild.length>0?rs.booleanListChildrenByCode.comp2=ss.booleanListChild[0]:ss.otherComparableChild.length>0&&(rs.otherChildrenByCode.comp2=ss.otherComparableChild[0]);let is=ss.answerInput.stateValues.immediateValue;is===void 0&&(is=ss.answerInput.stateValues.value);let as={stateValues:{value:is}};return ss.answerInput.componentType==="textInput"?rs.textChildrenByCode.comp1=as:ss.answerInput.componentType==="booleanInput"?rs.booleanChildrenByCode.comp1=as:rs.mathChildrenByCode.comp1=as,evaluateLogic({logicTree:ss.parsedExpression.tree,canOverrideUnorderedCompare:ns,dependencyValues:rs})}function addResponsesToDescendantsWithTarget(ss,ts,rs){for(let ns of ss){let is=ns.props;if((!is||Object.keys(is).length===0)&&(is=ns.doenetAttributes),is)for(let as in is)(as.toLowerCase()==="target"&&is[as]===ts||as.toLowerCase()==="targetcomponentname"&&is[as]===rs)&&(ns.attributes||(ns.attributes={}),Object.keys(ns.attributes).map(ls=>ls.toLowerCase()).includes("isresponse")||(ns.attributes.isResponse=!0));ns.children&&addResponsesToDescendantsWithTarget(ns.children,ts,rs)}}class When extends BooleanComponent{static createAttributesObject(){let ts=super.createAttributesObject();ts.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"};for(let rs of["symbolicEquality","expandOnCompare","simplifyOnCompare","unorderedCompare","matchByExactPositions","allowedErrorInNumbers","includeErrorInNumberExponents","allowedErrorIsAbsolute","nSignErrorsMatched","nPeriodicSetMatchesRequired","caseInsensitiveMatch","matchBlanks"])ts[rs].fallBackToParentStateVariable=rs;return ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},additionalStateVariablesDefined:[{variableName:"fractionSatisfied",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"conditionSatisfied",public:!0,shadowingInstructions:{createComponentOfType:"boolean"}}],returnDependencies:()=>({matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"},caseInsensitiveMatch:{dependencyType:"stateVariable",variableName:"caseInsensitiveMatch"},matchBlanks:{dependencyType:"stateVariable",variableName:"matchBlanks"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},numberListChildrenByCode:{dependencyType:"stateVariable",variableName:"numberListChildrenByCode"},otherChildrenByCode:{dependencyType:"stateVariable",variableName:"otherChildrenByCode"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.parsedExpression===null)return{setValue:{conditionSatisfied:!1,value:!1,fractionSatisfied:0}};let is=ns.unorderedCompare,as=evaluateLogic({logicTree:rs.parsedExpression.tree,canOverrideUnorderedCompare:is,dependencyValues:rs}),os=as===1;return{setValue:{fractionSatisfied:as,conditionSatisfied:os,value:os}}}},ts}}Ms(When,"componentType","when"),Ms(When,"rendererType"),Ms(When,"stateVariableForAttributeValue","conditionSatisfied");class MathInput extends Input{constructor(ts){super(ts),Object.assign(this.actions,{updateRawValue:this.updateRawValue.bind(this),updateValue:this.updateValue.bind(this)}),this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let rs=await this.stateValues.answerAncestor;if(rs!==null)return{componentName:rs.componentName,actionName:"submitAnswer"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.prefill={createComponentOfType:"math",createStateVariable:"prefill",defaultValue:Context.fromAst(""),public:!0,copyComponentAttributesForCreatedComponent:["format","functionSymbols","splitSymbols","parseScientificNotation"]},ts.prefillLatex={createComponentOfType:"latex",createStateVariable:"prefillLatex",defaultValue:"",public:!0},ts.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},ts.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},ts.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0,fallBackToParentStateVariable:"splitSymbols"},ts.parseScientificNotation={createComponentOfType:"boolean",createStateVariable:"parseScientificNotation",defaultValue:!1,public:!0,fallBackToParentStateVariable:"parseScientificNotation"},ts.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.bindValueTo={createComponentOfType:"math"},ts.unionFromU={createComponentOfType:"boolean",createStateVariable:"unionFromU",defaultValue:!1,public:!0},ts.hideNaN={createComponentOfType:"boolean",createStateVariable:"hideNaN",defaultValue:!0,public:!0},ts.removeStrings={createComponentOfType:"textList",createStateVariable:"removeStrings",defaultValue:null},ts}static returnSugarInstructions(){let ts=[];function rs({matchedChildren:ns}){return ns.length===0?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:ns}]}}return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"},prefillLatex:{dependencyType:"stateVariable",variableName:"prefillLatex"},unionFromU:{dependencyType:"stateVariable",variableName:"unionFromU"},functionSymbols:{dependencyType:"stateVariable",variableName:"functionSymbols"},splitSymbols:{dependencyType:"stateVariable",variableName:"splitSymbols"},parseScientificNotation:{dependencyType:"stateVariable",variableName:"parseScientificNotation"}}),set:convertValueToMathExpression,definition:function({dependencyValues:rs,usedDefault:ns}){return rs.mathChild.length>0?{setValue:{value:rs.mathChild[0].stateValues.value}}:rs.bindValueTo?{setValue:{value:rs.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{get defaultValue(){return!ns.prefill||ns.prefillLatex?rs.prefill:calculateMathExpressionFromLatex({latex:rs.prefillLatex,unionFromU:rs.unionFromU,functionSymbols:rs.functionSymbols,splitSymbols:rs.splitSymbols,parseScientificNotation:rs.parseScientificNotation})}}}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.mathChild.length>0?{success:!0,instructions:[{setDependency:"mathChild",desiredValue:rs.value,variableIndex:0,childIndex:0}]}:ns.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:rs.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:rs.value}]}}},ts.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),set:convertValueToMathExpression,definition:function({dependencyValues:rs,changes:ns,justUpdatedForNewComponent:is,usedDefault:as}){return ns.value&&!is&&!as.value?{setValue:{immediateValue:rs.value},setEssentialValue:{immediateValue:rs.value}}:{useEssentialOrDefaultValue:{immediateValue:{defaultValue:rs.value}}}},inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns,shadowedVariable:is}){let as=[{setEssentialValue:"immediateValue",value:rs.immediateValue}];return ns||is||as.push({setDependency:"value",desiredValue:rs.immediateValue}),{success:!0,instructions:as}}},ts.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),set:convertValueToMathExpression,definition:function({dependencyValues:rs,usedDefault:ns}){return{setValue:{valueForDisplay:roundForDisplay({value:rs.value,dependencyValues:rs,usedDefault:ns})}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:rs}){return{setValue:{text:rs.valueForDisplay.toString()}}}},ts.dontUpdateRawValueInDefinition={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{dontUpdateRawValueInDefinition:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"dontUpdateRawValueInDefinition",value:rs.dontUpdateRawValueInDefinition}]}}},ts.rawRendererValue={forRenderer:!0,hasEssential:!0,shadowVariable:!0,defaultValue:"",provideEssentialValuesInDefinition:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"lastValueForDisplay",hasEssential:!0,shadowVariable:!0,defaultValue:null,set:convertValueToMathExpression}],returnDependencies:()=>({immediateValue:{dependencyType:"stateVariable",variableName:"immediateValue"},valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},hideNaN:{dependencyType:"stateVariable",variableName:"hideNaN"},dontUpdateRawValueInDefinition:{dependencyType:"stateVariable",variableName:"dontUpdateRawValueInDefinition"},prefill:{dependencyType:"stateVariable",variableName:"prefill"},prefillLatex:{dependencyType:"stateVariable",variableName:"prefillLatex"}}),definition({dependencyValues:rs,essentialValues:ns,justUpdatedForNewComponent:is,usedDefault:as}){if(ns.rawRendererValue===void 0||!(is||deepCompare(ns.lastValueForDisplay.tree,rs.valueForDisplay.tree)||rs.dontUpdateRawValueInDefinition)){let os;return as.immediateValue&&as.prefill&&!as.prefillLatex?os=stripLatex(rs.prefillLatex):os=stripLatex(rs.valueForDisplay.toLatex({showBlanks:!1})),rs.hideNaN&&os==="NaN"&&(os=""),{setValue:{rawRendererValue:os,lastValueForDisplay:rs.valueForDisplay},setEssentialValue:{rawRendererValue:os,lastValueForDisplay:rs.valueForDisplay}}}else return{useEssentialOrDefaultValue:{rawRendererValue:!0,lastValueForDisplay:!0}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns,essentialValues:is,dependencyValues:as,componentName:os}){let ls=[];if(typeof rs.rawRendererValue=="string"){let us=is.rawRendererValue,cs=rs.rawRendererValue;us!==cs&&ls.push({setEssentialValue:"rawRendererValue",value:cs});let ps=await ns.unionFromU,ds=await ns.functionSymbols,fs=await ns.splitSymbols,hs=await ns.parseScientificNotation,ys=await ns.removeStrings,gs=calculateMathExpressionFromLatex({latex:us,unionFromU:ps,functionSymbols:ds,splitSymbols:fs,parseScientificNotation:hs,removeStrings:ys}),bs=calculateMathExpressionFromLatex({latex:cs,unionFromU:ps,functionSymbols:ds,splitSymbols:fs,parseScientificNotation:hs,removeStrings:ys});deepCompare(bs.tree,gs.tree)||ls.push({setDependency:"immediateValue",desiredValue:bs,treatAsInitialChange:!0})}else if(rs.rawRendererValue instanceof Context.class){ls.push({setEssentialValue:"lastValueForDisplay",value:rs.rawRendererValue});let us=await ns.unionFromU,cs=await ns.functionSymbols,ps=await ns.splitSymbols,ds=await ns.parseScientificNotation,fs=await ns.removeStrings,hs=calculateMathExpressionFromLatex({latex:is.rawRendererValue,unionFromU:us,functionSymbols:cs,splitSymbols:ps,parseScientificNotation:ds,removeStrings:fs});if(!deepCompare(rs.rawRendererValue.tree,hs.tree)){let ys=stripLatex(rs.rawRendererValue.toLatex({showBlanks:!1}));as.hideNaN&&ys==="NaN"&&(ys=""),ls.push({setEssentialValue:"rawRendererValue",value:ys})}}else rs.lastValueForDisplay instanceof Context.class&&ls.push({setEssentialValue:"lastValueForDisplay",value:rs.lastValueForDisplay});return{success:!0,instructions:ls}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"math"}})},ts}async updateRawValue({rawRendererValue:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",value:ts},{updateType:"setComponentNeedingUpdateValue",componentName:this.componentName}],transient:!0,actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}async updateValue({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:ts});else{let is=await this.stateValues.immediateValue;if(deepCompare((await this.stateValues.value).tree,is.tree))this.coreFunctions.resolveAction({actionId:ts});else{let as=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"dontUpdateRawValueInDefinition",value:!0},{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:is},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"dontUpdateRawValueInDefinition",value:!1},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"},{updateType:"unsetComponentNeedingUpdateValue"}];is.tree!==""?as.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"valueForDisplay"}):as.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"lastValueForDisplay",valueOfStateVariable:"valueForDisplay"});let os={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:is,responseText:is.toString()}},ls=await this.stateValues.answerAncestor;return ls&&(os.context={answerAncestor:ls.componentName}),await this.coreFunctions.performUpdate({updateInstructions:as,actionId:ts,sourceInformation:rs,skipRendererUpdate:!1,event:os}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}}}Ms(MathInput,"componentType","mathInput"),Ms(MathInput,"variableForPlainMacro","value"),Ms(MathInput,"variableForPlainCopy","value"),Ms(MathInput,"processWhenJustUpdatedForNewComponent",!0),Ms(MathInput,"adapters",[{stateVariable:"value",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]}]);function calculateMathExpressionFromLatex({latex:ss,unionFromU:ts,functionSymbols:rs,splitSymbols:ns,parseScientificNotation:is,removeStrings:as}){let os;if(as)for(let us of as)["$","%"].includes(us)&&(us="\\"+us),ss=ss.replaceAll(us,"");ss=normalizeLatexString(ss,{unionFromU:ts});let ls=getFromLatex({functionSymbols:rs,splitSymbols:ns,parseScientificNotation:is});try{os=ls(ss)}catch{os=Context.fromAst("")}return os}class Textinput extends Input{constructor(ts){super(ts),Object.assign(this.actions,{updateImmediateValue:this.updateImmediateValue.bind(this),updateValue:this.updateValue.bind(this)}),this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let rs=await this.stateValues.answerAncestor;if(rs!==null)return{componentName:rs.componentName,actionName:"submitAnswer"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},ts.size={createComponentOfType:"number",createStateVariable:"size",defaultValue:10,forRenderer:!0,public:!0},ts.bindValueTo={createComponentOfType:"text"},ts.expanded={createComponentOfType:"boolean",createStateVariable:"expanded",defaultValue:!1,forRenderer:!0,public:!0,fallBackToParentStateVariable:"expanded"},ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:600,isAbsolute:!0},forRenderer:!0,public:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:120,isAbsolute:!0},forRenderer:!0,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:rs}){return rs.bindValueTo?{setValue:{value:rs.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{defaultValue:rs.prefill}}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:rs.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:rs.value}]}}},ts.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs,changes:ns,justUpdatedForNewComponent:is}){return ns.value&&!is?{setValue:{immediateValue:rs.value},setEssentialValue:{immediateValue:rs.value}}:{useEssentialOrDefaultValue:{immediateValue:{defaultValue:rs.value}}}},inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns,shadowedVariable:is}){let as=[{setEssentialValue:"immediateValue",value:rs.immediateValue}];return ns||is||as.push({setDependency:"value",desiredValue:rs.immediateValue}),{success:!0,instructions:as}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs}){return{setValue:{text:rs.value}}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"text"}})},ts}async updateImmediateValue({text:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:ts},{updateType:"setComponentNeedingUpdateValue",componentName:this.componentName}],transient:!0,actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}async updateValue({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(!await this.stateValues.disabled){let is=await this.stateValues.immediateValue;if(await this.stateValues.value!==is){let as=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:is},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"},{updateType:"unsetComponentNeedingUpdateValue"}],os={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:is,responseText:is}},ls=await this.stateValues.answerAncestor;return ls&&(os.context={answerAncestor:ls.componentName}),await this.coreFunctions.performUpdate({updateInstructions:as,actionId:ts,sourceInformation:rs,skipRendererUpdate:!0,event:os}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}this.coreFunctions.resolveAction({actionId:ts})}}Ms(Textinput,"componentType","textInput"),Ms(Textinput,"variableForPlainMacro","value"),Ms(Textinput,"variableForPlainCopy","value"),Ms(Textinput,"processWhenJustUpdatedForNewComponent",!0);class BooleanInput extends Input{constructor(ts){super(ts),Object.assign(this.actions,{updateBoolean:this.updateBoolean.bind(this)}),this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let rs=await this.stateValues.answerAncestor;if(rs!==null)return{componentName:rs.componentName,actionName:"submitAnswer"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.prefill={createComponentOfType:"boolean",createStateVariable:"prefill",defaultValue:!1,public:!0},ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.asToggleButton={createComponentOfType:"boolean",createStateVariable:"asToggleButton",defaultValue:!1,forRenderer:!0,public:!0},ts.bindValueTo={createComponentOfType:"boolean"},ts}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnLabelStateVariableDefinitions();return Object.assign(ts,rs),ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:ns}){return ns.bindValueTo?{setValue:{value:ns.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{defaultValue:ns.prefill}}}},inverseDefinition:function({desiredStateVariableValues:ns,dependencyValues:is}){return is.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:ns.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:ns.value}]}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:ns}){return{setValue:{text:ns.value?"true":"false"}}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"boolean"}})},ts}async updateBoolean({boolean:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else{let as=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:ts}],os={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:ts,responseText:ts.toString()}},ls=await this.stateValues.answerAncestor;return ls&&(os.context={answerAncestor:ls.componentName}),await this.coreFunctions.performUpdate({updateInstructions:as,event:os,actionId:rs,sourceInformation:ns,skipRendererUpdate:!0}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}}}Ms(BooleanInput,"componentType","booleanInput"),Ms(BooleanInput,"variableForPlainMacro","value"),Ms(BooleanInput,"variableForPlainCopy","value"),Ms(BooleanInput,"adapters",["value"]);class Choiceinput extends Input{constructor(ts){super(ts),Object.assign(this.actions,{updateSelectedIndices:this.updateSelectedIndices.bind(this)}),this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let rs=await this.stateValues.answerAncestor;if(rs!==null)return{componentName:rs.componentName,actionName:"submitAnswer"}}.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.selectMultiple={createComponentOfType:"boolean",createStateVariable:"selectMultiple",defaultValue:!1,public:!0,forRenderer:!0,fallBackToParentStateVariable:"selectMultiple"},ts.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"},ts.inline={createComponentOfType:"boolean"},ts.shuffleOrder={createPrimitiveOfType:"boolean",createStateVariable:"shuffleOrder",defaultValue:!1,public:!0},ts.preselectChoice={createComponentOfType:"number",createStateVariable:"preselectChoice",defaultValue:null},ts.bindValueTo={createComponentOfType:"text"},ts.placeHolder={createComponentOfType:"text",createStateVariable:"placeHolder",defaultValue:"",forRenderer:!0},ts.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0,fallBackToParentStateVariable:"submitLabel"},ts.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0,fallBackToParentStateVariable:"submitLabelNoCorrectness"},ts}static returnChildGroups(){return[{group:"choices",componentTypes:["choice"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.inline={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({inlineAttr:{dependencyType:"attributeComponent",attributeName:"inline",variableNames:["value"]},parentInline:{dependencyType:"parentStateVariable",variableName:"inline"}}),definition({dependencyValues:rs}){return rs.inlineAttr?{setValue:{inline:rs.inlineAttr.stateValues.value}}:rs.parentInline!==null?{setValue:{inline:rs.parentInline}}:{useEssentialOrDefaultValue:{inline:{}}}}},ts.numberChoices={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({choiceChildren:{dependencyType:"child",childGroups:["choices"]}}),definition({dependencyValues:rs}){return{setValue:{numberChoices:rs.choiceChildren.length}}}},ts.choiceOrder={forRenderer:!0,shadowVariable:!0,returnDependencies:({sharedParameters:rs})=>({choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},shuffleOrder:{dependencyType:"stateVariable",variableName:"shuffleOrder"},variantSeed:{dependencyType:"value",value:rs.variantSeed},rngClass:{dependencyType:"value",value:rs.rngClass,doNotProxy:!0},variants:{dependencyType:"variants"}}),definition:function({dependencyValues:rs}){var as,os;let ns=rs.choiceChildren.length,is;if(!rs.shuffleOrder)is=[...Array(ns).keys()].map(ls=>ls+1);else{let ls=(os=(as=rs.variants)==null?void 0:as.desiredVariant)==null?void 0:os.indices;if(ls!==void 0)if(ls.length!==ns)console.warn("Ignoring indices specified for choiceInput as number of indices doesn't match number of choice children.");else{if(ls=ls.map(Number),!ls.every(Number.isInteger))throw Error("All indices specified for choiceInput must be integers");if(!ls.every(cs=>cs>=1&&cs<=ns))console.warn("Ignoring indices specified for choiceInput as some indices out of range.");else return{setValue:{choiceOrder:ls}}}let us=rs.rngClass(rs.variantSeed+"co");is=[...Array(ns).keys()].map(cs=>cs+1);for(let cs=ns-1;cs>0;cs--){const ps=us(),ds=Math.floor(ps*(cs+1));[is[cs],is[ds]]=[is[ds],is[cs]]}}return{setValue:{choiceOrder:is}}}},ts.generatedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:rs,sharedParameters:ns})=>({variantSeed:{dependencyType:"value",value:ns.variantSeed},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},shuffleOrder:{dependencyType:"stateVariable",variableName:"shuffleOrder"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(rs.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns}){let is={seed:rs.variantSeed,meta:{createdBy:ns}};rs.shuffleOrder&&(is.indices=rs.choiceOrder);let as=is.subvariants=[];for(let os of rs.variantDescendants)os.stateValues.isVariantComponent?as.push(os.stateValues.generatedVariantInfo):os.stateValues.generatedVariantInfo&&as.push(...os.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:is,isVariantComponent:!0}}}},ts.choiceChildrenOrdered={additionalStateVariablesDefined:[{variableName:"numberChoices",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"]}}),definition:function({dependencyValues:rs}){let ns=rs.choiceChildren.length;return{setValue:{choiceChildrenOrdered:rs.choiceOrder.map(as=>rs.choiceChildren[as-1]),numberChoices:ns}}}},ts.choiceTexts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["choiceText"],forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:rs}){return[rs.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return{setValue:{choiceTexts:rs.choiceOrder.map(is=>rs.choiceChildren[is-1]).map(is=>is.stateValues.text)}}}},ts.choiceMaths={public:!0,shadowingInstructions:{createComponentOfType:"math"},isArray:!0,entryPrefixes:["choiceMath"],forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:rs}){return[rs.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["math"]}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return{setValue:{choiceMaths:rs.choiceOrder.map(is=>rs.choiceChildren[is-1]).map(is=>is.stateValues.math)}}}},ts.choicePreselects={isArray:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:rs}){return[rs.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["preSelect"]}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return{setValue:{choicePreselects:rs.choiceOrder.map(is=>rs.choiceChildren[is-1]).map(is=>is.stateValues.preSelect)}}}},ts.choicesDisabled={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:rs}){return[rs.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["disabled"]}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return{setValue:{choicesDisabled:rs.choiceOrder.map(is=>rs.choiceChildren[is-1]).map(is=>is.stateValues.disabled)}}}},ts.choicesHidden={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:rs}){return[rs.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["hidden"]}}}},arrayDefinitionByKey({globalDependencyValues:rs}){return{setValue:{choicesHidden:rs.choiceOrder.map(is=>rs.choiceChildren[is-1]).map(is=>is.stateValues.hidden)}}}},ts.componentType={returnDependencies:()=>({choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["math"]}}),definition({dependencyValues:rs}){let ns="text";return rs.choiceChildren.length>0&&rs.choiceChildren.every(is=>is.stateValues.math)&&(ns="math"),{setValue:{componentType:ns}}}},ts.indicesMatchedByBoundValue={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"}}),definition({dependencyValues:rs}){let ns=rs.choiceOrder.map(is=>rs.choiceChildren[is-1]);if(rs.bindValueTo!==null){let is=ns.map(as=>as.stateValues.text.toLowerCase().trim());if(rs.bindValueTo.stateValues.value)if(rs.selectMultiple){let as=rs.bindValueTo.stateValues.value.toLowerCase().split(",").map(ls=>ls.trim()),os=[];for(let ls of as){let us=is.indexOf(ls);us!==-1&&!os.includes(us+1)&&os.push(us+1)}return os.sort((ls,us)=>ls-us),{setValue:{indicesMatchedByBoundValue:os}}}else{let as=is.indexOf(rs.bindValueTo.stateValues.value.toLowerCase().trim());if(as!==-1)return{setValue:{indicesMatchedByBoundValue:[as+1]}}}}return{setValue:{indicesMatchedByBoundValue:[]}}}},ts.allSelectedIndices={hasEssential:!0,returnDependencies(){return{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},indicesMatchedByBoundValue:{dependencyType:"stateVariable",variableName:"indicesMatchedByBoundValue"},preselectChoice:{dependencyType:"stateVariable",variableName:"preselectChoice"},choicePreselects:{dependencyType:"stateVariable",variableName:"choicePreselects"},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}},definition({dependencyValues:rs}){return rs.bindValueTo!==null?{setValue:{allSelectedIndices:rs.indicesMatchedByBoundValue}}:{useEssentialOrDefaultValue:{allSelectedIndices:{get defaultValue(){let ns=rs.choicePreselects.indexOf(!0);return ns!==-1?[ns+1]:rs.preselectChoice!==null?[rs.preselectChoice]:[]}}}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){if(ns.bindValueTo===null)return{success:!0,instructions:[{setEssentialValue:"allSelectedIndices",value:rs.allSelectedIndices}]};{let is="";if(rs.allSelectedIndices.length>0){let as=ns.choiceOrder.map(ls=>ns.choiceChildren[ls-1]),os=[];for(let ls of rs.allSelectedIndices){let us=as[ls-1];us&&os.push(us.stateValues.text)}is=os.join(", ")}return{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:is,variableIndex:0}]}}}},ts.nSelectedIndices={returnDependencies:()=>({allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}),definition({dependencyValues:rs}){return{setValue:{nSelectedIndices:rs.allSelectedIndices.length}}}},ts.selectedIndices={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["selectedIndex"],forRenderer:!0,returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:rs}){return[rs.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns={};for(let is in rs.allSelectedIndices)ns[is]=rs.allSelectedIndices[is];return{setValue:{selectedIndices:ns}}}},ts.selectedIndex={isAlias:!0,targetVariableName:"selectedIndex1"},ts.selectedValues={public:!0,shadowingInstructions:{hasVariableComponentType:!0},isArray:!0,entryPrefixes:["selectedValue"],returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:rs}){return[rs.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceTexts:{dependencyType:"stateVariable",variableName:"choiceTexts"},choiceMaths:{dependencyType:"stateVariable",variableName:"choiceMaths"},componentType:{dependencyType:"stateVariable",variableName:"componentType"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={},as=rs.componentType;for(let os of ns)as==="math"?is[os]=rs.choiceMaths[rs.selectedIndices[os]-1]:is[os]=rs.choiceTexts[rs.selectedIndices[os]-1];return{setValue:{selectedValues:is},setCreateComponentOfType:{selectedValues:as}}}},ts.selectedValue={isAlias:!0,targetVariableName:"selectedValue1"},ts.values={isAlias:!0,targetVariableName:"selectedValues"},ts.nValues={isAlias:!0,targetVariableName:"nSelectedIndices"},ts.childIndicesSelected={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"}}),definition({dependencyValues:rs}){return{setValue:{childIndicesSelected:rs.selectedIndices.map(is=>rs.choiceOrder[is-1])}}}},ts.creditAchievedIfSubmit={returnDependencies:()=>({choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["selected","credit"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"}}),definition:function({dependencyValues:rs}){let ns=0;if(rs.selectMultiple){let is=0,as=0,os=0;for(let ls of rs.choiceChildren)ls.stateValues.selected?ls.stateValues.credit===1?is++:as++:ls.stateValues.credit===1&&os++;if(rs.matchPartial){let ls=is+as+os;ls===0?ns=1:ns=is/ls}else as+os===0&&(ns=1)}else for(let is of rs.choiceChildren)if(is.stateValues.selected){ns=is.stateValues.credit;break}return{setValue:{creditAchievedIfSubmit:ns}}}},ts.valueToRecordOnSubmit={isAlias:!0,targetVariableName:"selectedIndices"},ts.submittedIndices={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["submitted"]}}),definition({dependencyValues:rs}){let ns=[],is=rs.choiceOrder.map(as=>rs.choiceChildren[as-1]);for(let[as,os]of is.entries())os.stateValues.submitted&&ns.push(as+1);return{setValue:{submittedIndices:ns}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){let is=[];for(let[as,os]of ns.choiceOrder.entries())is.push({setDependency:"choiceChildren",desiredValue:rs.submittedIndices.includes(as+1),variableIndex:0,childIndex:os-1});return{success:!0,instructions:is}}},ts.valueRecordedAtSubmit={isAlias:!0,targetVariableName:"submittedIndices"},ts.allFeedbacks={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["feedbacks"]}}),definition({dependencyValues:rs}){let ns=rs.choiceOrder.map(as=>rs.choiceChildren[as-1]),is=[];for(let as of ns)is.push(...as.stateValues.feedbacks);return{setValue:{allFeedbacks:is}}}},ts.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:rs}){return{setValue:{numberFeedbacks:rs.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},ts.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:rs}){return[rs.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns={};for(let is=0;is<rs.__array_size;is++)ns[is]=rs.allFeedbacks[is];return{setValue:{feedbacks:ns}}}},ts}async updateSelectedIndices({selectedIndices:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else{let as=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"allSelectedIndices",value:ts}],os=await this.stateValues.choiceTexts,ls={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:ts,responseText:ts.map(cs=>os[cs-1])}},us=await this.stateValues.answerAncestor;return us&&(ls.context={answerAncestor:us.componentName}),await this.coreFunctions.performUpdate({updateInstructions:as,actionId:rs,sourceInformation:ns,skipRendererUpdate:!0,event:ls}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns})}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){var ls,us,cs,ps,ds;if(!((us=(ls=ts.attributes)==null?void 0:ls.shuffleOrder)!=null&&us.primitive))return super.determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs});let ns=0;for(let fs of ts.children)if(fs.componentType==="choice")ns++;else if(rs.isInheritedComponentType({inheritedComponentType:fs.componentType,baseComponentType:"_composite"})&&((cs=fs.attributes.createComponentOfType)==null?void 0:cs.primitive)==="choice")if(((ps=fs.attributes.nComponents)==null?void 0:ps.primitive)!==void 0){let hs=Number((ds=fs.attributes.nComponents)==null?void 0:ds.primitive);if(Number.isInteger(hs)&&hs>=0)ns+=hs;else return{success:!1}}else ns++;else return{success:!1};let is=1;for(let fs=2;fs<=ns;fs++)is*=fs;let as=super.determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs});if(!as.success)return{success:!1};let os=as.numberOfVariants*is;return ts.variants.numberOfVariants=os,ts.variants.uniqueVariantData={numberOfVariantsByDescendant:ts.variants.uniqueVariantData.numberOfVariantsByDescendant,numberOfPermutations:is,numberOfChoices:ns},{success:!0,numberOfVariants:os}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){var Ns,Ts;let is=(Ns=ts.variants)==null?void 0:Ns.numberOfVariants;if(is===void 0)return{success:!1};if(!Number.isInteger(rs)||rs<1||rs>is)return{success:!1};if(!((Ts=ts.attributes.shuffleOrder)!=null&&Ts.primitive))return super.getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns});let as=ts.variants.uniqueVariantData.numberOfVariantsByDescendant,os=ts.variants.descendantVariantComponents,ls=ts.variants.uniqueVariantData.numberOfPermutations,us=ts.variants.uniqueVariantData.numberOfChoices,cs=[...as];cs.push(ls);let ps=enumerateCombinations({numberOfOptionsByIndex:cs,maxNumber:rs})[rs-1].map(Cs=>Cs+1),ds=ps.pop(),fs=ps,hs=[...Array(us).keys()].map(Cs=>Cs+1),ys=enumeratePermutations({values:hs,maxNumber:ds})[ds-1],gs=!1,bs=[];for(let Cs=0;Cs<as.length;Cs++)if(as[Cs]>1){let xs=os[Cs],ws=ns.allComponentClasses[xs.componentType].getUniqueVariant({serializedComponent:xs,variantIndex:fs[Cs],componentInfoObjects:ns});if(!ws.success)return{success:!1};bs.push(ws.desiredVariant),gs=!0}else bs.push({});let vs={indices:ys};return gs&&(vs.subvariants=bs),{success:!0,desiredVariant:vs}}}Ms(Choiceinput,"componentType","choiceInput"),Ms(Choiceinput,"renderChildren",!0),Ms(Choiceinput,"variableForPlainMacro","values"),Ms(Choiceinput,"variableForPlainCopy","values"),Ms(Choiceinput,"createsVariants",!0);class Choice extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:0,public:!0,attributesForCreatedComponent:{convertBoolean:!0}},ts.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0},ts.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0},ts.preSelect={createComponentOfType:"boolean",createStateVariable:"preSelect",defaultValue:!1},ts}static returnChildGroups(){return[{group:"children",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["children"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns="";for(let is of rs.inlineChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"&&(ns+=is.stateValues.text);return{setValue:{text:ns}}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["children"],variableNames:["value","latex"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=null;if(rs.inlineChildren.length===1){let is=rs.inlineChildren[0];if(typeof is=="object"){let as=is.stateValues.value;if(as instanceof Context.class)ns=as;else if(typeof as=="number")ns=Context.fromAst(as);else if(typeof is.stateValues.latex=="string")try{ns=Context.fromLatex(is.stateValues.latex)}catch{}}}return{setValue:{math:ns}}}},ts.selected={defaultValue:!1,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},childIndicesSelected:{dependencyType:"parentStateVariable",parentComponentType:"choiceInput",variableName:"childIndicesSelected"},primaryShadow:{dependencyType:"primaryShadow",variableNames:["selected"]}}),definition({dependencyValues:rs,componentName:ns}){let is;return rs.childIndicesSelected?is=rs.childIndicesSelected.includes(rs.countAmongSiblings):rs.primaryShadow?is=rs.primaryShadow.stateValues.selected:is=!1,{setValue:{selected:is}}}},ts.submitted={defaultValue:!1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},doNotShadowEssential:!0,returnDependencies:()=>({primaryShadow:{dependencyType:"primaryShadow",variableNames:["submitted"]}}),definition({dependencyValues:rs}){return rs.primaryShadow?{setValue:{submitted:rs.primaryShadow.stateValues.submitted}}:{useEssentialOrDefaultValue:{submitted:!0}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.primaryShadow?{success:!1}:{success:!0,instructions:[{setEssentialValue:"submitted",value:rs.submitted}]}}},ts.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedbacktext"},returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitionAncestor:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},submitted:{dependencyType:"stateVariable",variableName:"submitted"}}),definition({dependencyValues:rs}){if(!rs.submitted)return{setValue:{feedbacks:[]}};let ns=[],is=rs.feedbackDefinitionAncestor.stateValues.feedbackDefinitions;for(let as of rs.feedbackCodes){let os=as.toLowerCase(),ls=is[os];ls&&ns.push(ls)}return rs.feedbackText!==null&&ns.push(rs.feedbackText),{setValue:{feedbacks:ns}}}},ts}}Ms(Choice,"componentType","choice"),Ms(Choice,"rendererType","containerInline"),Ms(Choice,"renderChildren",!0),Ms(Choice,"variableForPlainMacro","submitted"),Ms(Choice,"variableForPlainCopy","submitted"),Ms(Choice,"includeBlankStringChildren",!0),Ms(Choice,"adapters",["text","math"]);class NumberComponent extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer"},ts.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},ts.padZeros={createComponentOfType:"boolean"},ts.renderAsMath={createComponentOfType:"boolean",createStateVariable:"renderAsMath",defaultValue:!1,public:!0,forRenderer:!0},ts.convertBoolean={createPrimitiveOfType:"boolean",createStateVariable:"convertBoolean",defaultValue:!1},ts.valueOnNaN={createPrimitiveOfType:"number",createStateVariable:"valueOnNaN",defaultValue:NaN},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions();return ts.push({childrenRegex:/..+/,replacementFunction:({matchedChildren:rs,componentAttributes:ns})=>({success:!ns.convertBoolean,newChildren:[{componentType:"math",children:rs}]})}),ts}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"numbers",componentTypes:["number"]},{group:"maths",componentTypes:["math"]},{group:"texts",componentTypes:["text"]},{group:"booleans",componentTypes:["boolean"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displayDigits"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.numberListParentDisplayDigits!==null)if(ns.numberListParentDisplayDigits)is=!0,as=rs.numberListParentDisplayDigits;else return{setValue:{displayDigits:rs.numberListParentDisplayDigits}};if(rs.mathListParentDisplayDigits!==null)if(ns.mathListParentDisplayDigits)is=!0,as=rs.mathListParentDisplayDigits;else return{setValue:{displayDigits:rs.mathListParentDisplayDigits}};let os=rs.numberListParentDisplayDecimals!==null&&!ns.numberListParentDisplayDecimals||rs.mathListParentDisplayDecimals!==null&&!ns.mathListParentDisplayDecimals,ls=rs.displayDigitsAttr===null||ns.displayDigitsAttr,us=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(ls||us)){let cs=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<cs&&(ls=!0)}if(!os&&rs.displayDigitsAttr!==null)if(ls)is=!0,as=rs.displayDigitsAttr.stateValues.value;else return{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}};if(!os&&us&&rs.numberMathChildren.length===1&&rs.otherChildren.length===0)if(ns.numberMathChildren[0]&&ns.numberMathChildren[0].displayDigits)is=!0,as=rs.numberMathChildren[0].stateValues.displayDigits;else return{setValue:{displayDigits:rs.numberMathChildren[0].stateValues.displayDigits}};return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displayDecimals"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.numberListParentDisplayDecimals!==null)if(ns.numberListParentDisplayDecimals)is=!0,as=rs.numberListParentDisplayDecimals;else return{setValue:{displayDecimals:rs.numberListParentDisplayDecimals}};if(rs.mathListParentDisplayDecimals!==null)if(ns.mathListParentDisplayDecimals)is=!0,as=rs.mathListParentDisplayDecimals;else return{setValue:{displayDecimals:rs.mathListParentDisplayDecimals}};if(rs.displayDecimalsAttr!==null)if(ns.displayDecimalsAttr)is=!0,as=rs.displayDecimalsAttr.stateValues.value;else return{setValue:{displayDecimals:rs.displayDecimalsAttr.stateValues.value}};if(rs.numberMathChildren.length===1&&rs.otherChildren.length===0)if(ns.numberMathChildren[0]&&ns.numberMathChildren[0].displayDecimals)is=!0,as=rs.numberMathChildren[0].stateValues.displayDecimals;else return{setValue:{displayDecimals:rs.numberMathChildren[0].stateValues.displayDecimals}};return is?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displaySmallAsZero"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.numberListParentDisplaySmallAsZero!==null)if(ns.numberListParentDisplaySmallAsZero)is=!0,as=rs.numberListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:rs.numberListParentDisplaySmallAsZero}};if(rs.mathListParentDisplaySmallAsZero!==null)if(ns.mathListParentDisplaySmallAsZero)is=!0,as=rs.mathListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:rs.mathListParentDisplaySmallAsZero}};if(rs.displaySmallAsZeroAttr!==null)if(ns.displaySmallAsZeroAttr)is=!0,as=rs.displaySmallAsZeroAttr.stateValues.value;else return{setValue:{displaySmallAsZero:rs.displaySmallAsZeroAttr.stateValues.value}};if(rs.numberMathChildren.length===1&&rs.otherChildren.length===0)if(ns.numberMathChildren[0]&&ns.numberMathChildren[0].displaySmallAsZero)is=!0,as=rs.numberMathChildren[0].stateValues.displaySmallAsZero;else return{setValue:{displaySmallAsZero:rs.numberMathChildren[0].stateValues.displaySmallAsZero}};return is?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["padZeros"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.numberListParentPadZeros!==null)if(ns.numberListParentPadZeros)is=!0,as=rs.numberListParentPadZeros;else return{setValue:{padZeros:rs.numberListParentPadZeros}};if(rs.mathListParentPadZeros!==null)if(ns.mathListParentPadZeros)is=!0,as=rs.mathListParentPadZeros;else return{setValue:{padZeros:rs.mathListParentPadZeros}};if(rs.padZerosAttr!==null)if(ns.padZerosAttr)is=!0,as=rs.padZerosAttr.stateValues.value;else return{setValue:{padZeros:rs.padZerosAttr.stateValues.value}};if(rs.numberMathChildren.length===1&&rs.otherChildren.length==0)if(ns.numberMathChildren[0]&&ns.numberMathChildren[0].padZeros)is=!0,as=rs.numberMathChildren[0].stateValues.padZeros;else return{setValue:{padZeros:rs.numberMathChildren[0].stateValues.padZeros}};return is?{useEssentialOrDefaultValue:{padZeros:{defaultValue:as}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.singleNumberOrStringChild={additionalStateVariablesDefined:["singleMathChild"],returnDependencies:()=>({numberChildren:{dependencyType:"child",childGroups:["numbers"]},stringChildren:{dependencyType:"child",childGroups:["strings"]},mathChildren:{dependencyType:"child",childGroups:["maths"]},booleanChildren:{dependencyType:"child",childGroups:["booleans"]},textChildren:{dependencyType:"child",childGroups:["texts"]}}),definition({dependencyValues:rs}){let ns=rs.numberChildren.length+rs.stringChildren.length,is=rs.mathChildren.length,as=rs.booleanChildren.length+rs.textChildren.length,os=ns<=1&&is+as===0,ls=is===1&&ns+as===0;return{setValue:{singleNumberOrStringChild:os,singleMathChild:ls}}}},ts.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]}}),definition:buildParsedExpression},ts.mathChildrenByCode={additionalStateVariablesDefined:["textChildrenByCode","numberChildrenByCode","booleanChildrenByCode"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"],variableNames:["value","texts","maths","booleans"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is={},as={},os={},ls={},us=0,cs=rs.codePre;for(let ps of rs.allChildren)if(typeof ps!="string"){let ds=cs+us;ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"math"})?is[ds]=ps:ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"number"})?as[ds]=ps:ns.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"text"})?os[ds]=ps:ls[ds]=ps,us+=1}return{setValue:{mathChildrenByCode:is,numberChildrenByCode:as,textChildrenByCode:os,booleanChildrenByCode:ls}}}},ts.value={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},hasEssential:!0,stateVariablesDeterminingDependencies:["singleNumberOrStringChild"],returnDependencies({stateValues:rs}){return rs.singleNumberOrStringChild?{singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},convertBoolean:{dependencyType:"stateVariable",variableName:"convertBoolean"},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},valueOnNaN:{dependencyType:"stateVariable",variableName:"valueOnNaN"}}:{singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},singleMathChild:{dependencyType:"stateVariable",variableName:"singleMathChild"},convertBoolean:{dependencyType:"stateVariable",variableName:"convertBoolean"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"],variableNames:["value","texts","maths","unordered"],variablesOptional:!0},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},valueOnNaN:{dependencyType:"stateVariable",variableName:"valueOnNaN"}}},definition({dependencyValues:rs,componentInfoObjects:ns}){if(rs.singleNumberOrStringChild)if(rs.numberChild.length===0){if(rs.stringChild.length===0)return{useEssentialOrDefaultValue:{value:{defaultValue:rs.valueOnNaN}}};let is=Number(rs.stringChild[0]);if(Number.isNaN(is))try{if(is=Context.fromAst(textToAst.convert(rs.stringChild[0])).evaluate_to_constant(),typeof is=="boolean")rs.convertBoolean?is=is?1:0:is=rs.valueOnNaN;else if(Number.isNaN(is))if(rs.convertBoolean){let as=buildParsedExpression({dependencyValues:{stringChildren:rs.stringChild,allChildren:rs.stringChild},componentInfoObjects:ns}).setValue.parsedExpression;is=evaluateLogic({logicTree:as.tree,dependencyValues:{booleanChildrenByCode:{},booleanListChildrenByCode:{},textChildrenByCode:{},textListChildrenByCode:{},mathChildrenByCode:{},mathListChildrenByCode:{},numberChildrenByCode:{},numberListChildrenByCode:{},otherChildrenByCode:{}},valueOnInvalid:rs.valueOnNaN})}else is=rs.valueOnNaN;else(is==null?void 0:is.re)===1/0||(is==null?void 0:is.re)===-1/0||(is==null?void 0:is.im)===1/0||(is==null?void 0:is.im)===-1/0?is=numberToMathExpression(is).evaluate_to_constant():(is==null?void 0:is.im)===0&&(is=is.re)}catch{is=rs.valueOnNaN}return{setValue:{value:is}}}else{let is=rs.numberChild[0].stateValues.value;return Number.isNaN(is)&&(is=rs.valueOnNaN),{setValue:{value:is}}}else{if(rs.parsedExpression===null)return{setValue:{value:rs.valueOnNaN}};if(Object.keys(rs.textChildrenByCode).length===0&&Object.keys(rs.booleanChildrenByCode).length===0){let as=function(ls){if(typeof ls=="string"){let us=rs.mathChildrenByCode[ls];return us!==void 0?us.stateValues.value.tree:(us=rs.numberChildrenByCode[ls],us!==void 0?numberToMathExpression(us.stateValues.value).tree:ls)}return Array.isArray(ls)?[ls[0],...ls.slice(1).map(as)]:ls},os;try{os=Context.fromAst(as(rs.parsedExpression.tree)).evaluate_to_constant()}catch{os=rs.valueOnNaN}if(!Number.isNaN(os)&&(typeof os=="number"||typeof(os==null?void 0:os.re)=="number"&&typeof(os==null?void 0:os.im)=="number"))return os.re===1/0||os.re===-1/0||os.im===1/0||os.im===-1/0?os=numberToMathExpression(os).evaluate_to_constant():os.im===0&&(os=os.re),{setValue:{value:os}}}return rs.convertBoolean?(rs=Object.assign({},rs),rs.mathListChildrenByCode={},rs.numberListChildrenByCode={},rs.textListChildrenByCode={},rs.booleanListChildrenByCode={},rs.otherChildrenByCode={},{setValue:{value:evaluateLogic({logicTree:rs.parsedExpression.tree,dependencyValues:rs,valueOnInvalid:rs.valueOnNaN})}}):{setValue:{value:rs.valueOnNaN}}}},set:function(rs){if(rs===null)return NaN;if(typeof rs=="number"||typeof(rs==null?void 0:rs.re)=="number"&&typeof(rs==null?void 0:rs.im)=="number")return rs;let ns=Number(rs);if(Number.isNaN(ns))try{ns=Context.fromAst(textToAst.convert(rs)).evaluate_to_constant()}catch{ns=NaN}return ns},inverseDefinition:async function({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is,overrideFixed:as}){if(!await is.canBeModified&&!as)return{success:!1};let os=rs.value;if(os instanceof Context.class?(os=os.evaluate_to_constant(),(Number.isNaN(os)||!(typeof os=="number"||typeof(os==null?void 0:os.re)=="number"&&typeof(os==null?void 0:os.im)=="number"))&&(os=ns.valueOnNaN)):(Number.isNaN(os)||!(typeof os=="number"||typeof(os==null?void 0:os.re)=="number"&&typeof(os==null?void 0:os.im)=="number"))&&(os=Number(os),Number.isNaN(os)&&(os=ns.valueOnNaN)),!ns.singleNumberOrStringChild)return ns.singleMathChild?{success:!0,instructions:[{setDependency:"allChildren",desiredValue:numberToMathExpression(os),childIndex:0,variableIndex:0}]}:{success:!1};let ls;return ns.numberChild.length===0?ns.stringChild.length===0?ls=[{setEssentialValue:"value",value:numberToMathExpression(os).evaluate_to_constant()}]:ls=[{setDependency:"stringChild",desiredValue:numberToMathExpression(os).toString(),childIndex:0,variableIndex:0}]:ls=[{setDependency:"numberChild",desiredValue:os,childIndex:0,variableIndex:0}],{success:!0,instructions:ls}}},ts.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"}}),definition:function({dependencyValues:rs,usedDefault:ns}){return{setValue:{valueForDisplay:roundForDisplay({value:numberToMathExpression(rs.value),dependencyValues:rs,usedDefault:ns}).evaluate_to_constant()}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs,usedDefault:ns}){let is={};return rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits)),{setValue:{text:numberToMathExpression(rs.valueForDisplay).toString(is)}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){let is=Number(rs.text);if(Number.isFinite(is))return{success:!0,instructions:[{setDependency:"value",desiredValue:is}]};{let as=getFromText({parseScientificNotation:!1}),os;try{os=as(rs.text)}catch{return{success:!1}}return is=os.evaluate_to_constant(),Number.isFinite(is)?{success:!0,instructions:[{setDependency:"value",desiredValue:is}]}:{success:!1}}}},ts.math=mathStateVariableFromNumberStateVariable({numberVariableName:"value",mathVariableName:"math",isPublic:!0}),ts.math.shadowingInstructions.attributesToShadow=["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"}}),definition({dependencyValues:rs,usedDefault:ns}){let is={};return rs.padZeros&&(ns.displayDigits&&!ns.displayDecimals?Number.isFinite(rs.displayDecimals)&&(is.padToDecimals=rs.displayDecimals):rs.displayDigits>=1&&(is.padToDigits=rs.displayDigits)),{setValue:{latex:numberToMathExpression(rs.valueForDisplay).toLatex(is)}}}},ts.canBeModified={returnDependencies:()=>({numberChildModifiable:{dependencyType:"child",childGroups:["numbers"],variableNames:["canBeModified"]},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},singleMathChild:{dependencyType:"stateVariable",variableName:"singleMathChild"}}),definition:function({dependencyValues:rs}){return!rs.modifyIndirectly||rs.fixed||!(rs.singleNumberOrStringChild||rs.singleMathChild)?{setValue:{canBeModified:!1}}:rs.numberChildModifiable.length===1&&!rs.numberChildModifiable[0].stateValues.canBeModified?{setValue:{canBeModified:!1}}:{setValue:{canBeModified:!0}}}},ts}}Ms(NumberComponent,"componentType","number"),Ms(NumberComponent,"variableForPlainMacro","value"),Ms(NumberComponent,"adapters",[{stateVariable:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text"]);class Integer extends NumberComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:ts,oldName:"value",newName:"valuePreRound"}),ts.value={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({valuePreRound:{dependencyType:"stateVariable",variableName:"valuePreRound"}}),set:function(rs){if(rs===null)return NaN;let ns=Number(rs);if(Number.isNaN(ns))try{ns=Context.fromAst(textToAst.convert(rs)).evaluate_to_constant(),ns===null&&(ns=NaN)}catch{ns=NaN}return Math.round(ns)},definition({dependencyValues:rs}){return{setValue:{value:Math.round(rs.valuePreRound)}}},inverseDefinition({desiredStateVariableValues:rs}){let ns=rs.value;return ns instanceof Context.class?ns=ns.evaluate_to_constant():ns=Number(ns),ns=Math.round(ns),{success:!0,instructions:[{setDependency:"valuePreRound",desiredValue:ns}]}}},ts}}Ms(Integer,"componentType","integer"),Ms(Integer,"rendererType","number");const maxWidth=850,sizePossibilities=["tiny","small","medium","large","full"],widthFractions=[1/12,.3,.5,.7,1],fractionMidpoints=widthFractions.map((ss,ts)=>(ss+(widthFractions[ts+1]||1/0))/2),orderedWidthMidpoints=fractionMidpoints.map(ss=>maxWidth*ss),orderedPercentWidthMidpoints=fractionMidpoints.map(ss=>ss*100),widthsBySize={};sizePossibilities.forEach((ss,ts)=>widthsBySize[ss]=Math.floor(widthFractions[ts]*maxWidth));const percentWidthsBySize={};sizePossibilities.forEach((ss,ts)=>percentWidthsBySize[ss]=Math.round(widthFractions[ts]*100));let Graph$1=(tu=class extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{changeAxisLimits:this.changeAxisLimits.bind(this),addChildren:this.addChildren.bind(this),deleteChildren:this.deleteChildren.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.xmin={createComponentOfType:"number",createStateVariable:"xminPrelim",defaultValue:-10},ts.xmax={createComponentOfType:"number",createStateVariable:"xmaxPrelim",defaultValue:10},ts.ymin={createComponentOfType:"number",createStateVariable:"yminPrelim",defaultValue:-10},ts.ymax={createComponentOfType:"number",createStateVariable:"ymaxPrelim",defaultValue:10},ts.width={createComponentOfType:"_componentSize"},ts.size={createComponentOfType:"text"},ts.aspectRatio={createComponentOfType:"number"},ts.height={createComponentOfType:"_componentSize"},ts.displayMode={createComponentOfType:"text",createStateVariable:"displayMode",validValues:["block","inline"],defaultValue:"block",forRenderer:!0,public:!0},ts.horizontalAlign={createComponentOfType:"text",createStateVariable:"horizontalAlign",validValues:["center","left","right"],defaultValue:"center",forRenderer:!0,public:!0},ts.identicalAxisScales={createPrimitiveOfType:"boolean",createStateVariable:"identicalAxisScales",defaultValue:!1,public:!0},ts.displayXAxis={createComponentOfType:"boolean",createStateVariable:"displayXAxis",defaultValue:!0,public:!0,forRenderer:!0},ts.displayYAxis={createComponentOfType:"boolean",createStateVariable:"displayYAxis",defaultValue:!0,public:!0,forRenderer:!0},ts.displayXAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayXAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},ts.displayYAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayYAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},ts.xlabel={createComponentOfType:"label"},ts.xlabelPosition={createComponentOfType:"text",createStateVariable:"xlabelPosition",defaultValue:"right",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["right","left"]},ts.xTickScaleFactor={createComponentOfType:"math",createStateVariable:"xTickScaleFactor",defaultValue:null,public:!0,forRenderer:!0},ts.ylabel={createComponentOfType:"label"},ts.ylabelPosition={createComponentOfType:"text",createStateVariable:"ylabelPosition",defaultValue:"top",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["top","bottom"]},ts.ylabelAlignment={createComponentOfType:"text",createStateVariable:"ylabelAlignment",defaultValue:"left",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["left","right"]},ts.yTickScaleFactor={createComponentOfType:"math",createStateVariable:"yTickScaleFactor",defaultValue:null,public:!0,forRenderer:!0},ts.showNavigation={createComponentOfType:"boolean",createStateVariable:"showNavigation",defaultValue:!0,public:!0,forRenderer:!0},ts.fixAxes={createComponentOfType:"boolean",createStateVariable:"fixAxes",defaultValue:!1,public:!0,forRenderer:!0},ts.grid={createComponentOfType:"text"},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.showBorder={createComponentOfType:"boolean",createStateVariable:"showBorder",defaultValue:!0,public:!0,forRenderer:!0},ts}static returnChildGroups(){return[{group:"xlabels",componentTypes:["xlabel"]},{group:"ylabels",componentTypes:["ylabel"]},{group:"graphical",componentTypes:["_graphical","text","image","math","m","md","label"]},{group:"graphs",componentTypes:["graph"]},{group:"childrenThatShouldNotBeHere",componentTypes:["_base"],matchAfterAdapters:!0}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.xlabel={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"label",addStateVariablesShadowingStateVariables:{hasLatex:{stateVariableToShadow:"xlabelHasLatex"}}},hasEssential:!0,defaultValue:"",additionalStateVariablesDefined:[{variableName:"xlabelHasLatex",forRenderer:!0}],returnDependencies:()=>({xlabelAttr:{dependencyType:"attributeComponent",attributeName:"xlabel",variableNames:["value","hasLatex"]},xlabelChild:{dependencyType:"child",childGroups:["xlabels"],variableNames:["value","hasLatex"]}}),definition({dependencyValues:rs}){if(rs.xlabelChild.length>0){let ns=rs.xlabelChild[rs.xlabelChild.length-1];return{setValue:{xlabel:ns.stateValues.value,xlabelHasLatex:ns.stateValues.hasLatex}}}else return rs.xlabelAttr?{setValue:{xlabel:rs.xlabelAttr.stateValues.value,xlabelHasLatex:rs.xlabelAttr.stateValues.hasLatex}}:{useEssentialOrDefaultValue:{xlabel:!0},setValue:{xlabelHasLatex:!1}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){if(typeof rs.xlabel!="string")return{success:!1};if(ns.xlabelChild.length>0){let is=ns.xlabelChild.length-1;return{success:!0,instructions:[{setDependency:"xlabelChild",desiredValue:rs.xlabel,childIndex:is,variableIndex:0}]}}else return{success:!0,instructions:[{setEssentialValue:"xlabel",value:rs.xlabel}]}}},ts.ylabel={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"label",addStateVariablesShadowingStateVariables:{hasLatex:{stateVariableToShadow:"ylabelHasLatex"}}},hasEssential:!0,defaultValue:"",additionalStateVariablesDefined:[{variableName:"ylabelHasLatex",forRenderer:!0}],returnDependencies:()=>({ylabelAttr:{dependencyType:"attributeComponent",attributeName:"ylabel",variableNames:["value","hasLatex"]},ylabelChild:{dependencyType:"child",childGroups:["ylabels"],variableNames:["value","hasLatex"]}}),definition({dependencyValues:rs}){if(rs.ylabelChild.length>0){let ns=rs.ylabelChild[rs.ylabelChild.length-1];return{setValue:{ylabel:ns.stateValues.value,ylabelHasLatex:ns.stateValues.hasLatex}}}else return rs.ylabelAttr?{setValue:{ylabel:rs.ylabelAttr.stateValues.value,ylabelHasLatex:rs.ylabelAttr.stateValues.hasLatex}}:{useEssentialOrDefaultValue:{ylabel:!0},setValue:{ylabelHasLatex:!1}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){if(typeof rs.ylabel!="string")return{success:!1};if(ns.ylabelChild.length>0){let is=ns.ylabelChild.length-1;return{success:!0,instructions:[{setDependency:"ylabelChild",desiredValue:rs.ylabel,childIndex:is,variableIndex:0}]}}else return{success:!0,instructions:[{setEssentialValue:"ylabel",value:rs.ylabel}]}}},ts.graphicalDescendants={forRenderer:!0,returnDependencies:()=>({graphicalDescendants:{dependencyType:"descendant",componentTypes:["_graphical"]}}),definition:function({dependencyValues:rs}){return{setValue:{graphicalDescendants:rs.graphicalDescendants}}}},ts.childIndicesToRender={returnDependencies:()=>({graphicalOrGraphChildren:{dependencyType:"child",childGroups:["graphical","graphs"]},allChildren:{dependencyType:"child",childGroups:["graphical","xlabels","ylabels","graphs","childrenThatShouldNotBeHere"]}}),definition({dependencyValues:rs}){let ns=[],is=rs.graphicalOrGraphChildren.map(as=>as.componentName);for(let[as,os]of rs.allChildren.entries())is.includes(os.componentName)&&ns.push(as);return{setValue:{childIndicesToRender:ns}}}},ts.nChildrenAdded={defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nChildrenAdded:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"nChildrenAdded",value:rs.nChildrenAdded}]}}},ts.size={public:!0,defaultValue:"medium",hasEssential:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({sizeAttr:{dependencyType:"attributeComponent",attributeName:"size",variableNames:["value"]},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]}}),definition({dependencyValues:rs}){const ns="medium";if(rs.sizeAttr){let is=rs.sizeAttr.stateValues.value.toLowerCase();return sizePossibilities.includes(is)||(is=ns),{setValue:{size:is}}}else if(rs.widthAttr){let is=rs.widthAttr.stateValues.componentSize;if(is===null)return{setValue:{size:ns}};let{isAbsolute:as,size:os}=is,ls;if(as){for(let[us,cs]of orderedWidthMidpoints.entries())if(os<=cs){ls=sizePossibilities[us];break}ls||(ls=ns)}else{for(let[us,cs]of orderedPercentWidthMidpoints.entries())if(os<=cs){ls=sizePossibilities[us];break}ls||(ls=ns)}return{setValue:{size:ls}}}else return{useEssentialOrDefaultValue:{size:!0}}}},ts.width={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},returnDependencies:()=>({size:{dependencyType:"stateVariable",variableName:"size"}}),definition({dependencyValues:rs}){return{setValue:{width:{isAbsolute:!0,size:widthsBySize[rs.size]}}}}},ts.aspectRatioFromAxisScales={returnDependencies:()=>({aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]},identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]}}),definition({dependencyValues:rs}){return rs.heightAttr!==null&&console.warn("Height attribute of graph is deprecated and is being ignored.  Use aspectRatio attribute instead."),{setValue:{aspectRatioFromAxisScales:rs.identicalAxisScales&&rs.aspectRatioAttr===null},checkForActualChange:{aspectRatioFromAxisScales:!0}}}},ts.aspectRatio={public:!0,forRenderer:!0,defaultValue:1,hasEssential:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["aspectRatioFromAxisScales"],returnDependencies({stateValues:rs}){return rs.aspectRatioFromAxisScales?{aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"}}:{aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]},width:{dependencyType:"stateVariable",variableName:"width"}}},definition({dependencyValues:rs}){if(rs.aspectRatioFromAxisScales)return{setValue:{aspectRatio:rs.xscale/rs.yscale}};if(rs.aspectRatioAttr!==null){let ns=rs.aspectRatioAttr.stateValues.value;return Number.isFinite(ns)||(ns=1),{setValue:{aspectRatio:ns}}}else return{useEssentialOrDefaultValue:{aspectRatio:!0}}}},ts.haveGraphParent={forRenderer:!0,returnDependencies:()=>({graphParent:{dependencyType:"parentIdentity",parentComponentType:"graph"}}),definition({dependencyValues:rs}){return{setValue:{haveGraphParent:rs.graphParent!==null}}}},ts.xmin={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xminPrelim:{dependencyType:"stateVariable",variableName:"xminPrelim"},graphParentXmin:{dependencyType:"parentStateVariable",parentComponentType:"graph",variableName:"xmin"}};return rs.identicalAxisScales&&!rs.aspectRatioFromAxisScales&&(ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(rs.graphParentXmin!==null)return{setValue:{xmin:rs.graphParentXmin}};if(!rs.identicalAxisScales||rs.aspectRatioFromAxisScales)return{setValue:{xmin:rs.xminPrelim}};if(!ns.xminPrelim)return{setValue:{xmin:rs.xminPrelim}};let as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim;if(os&&ls){let cs=rs.aspectRatio,ps=(rs.ymaxPrelim-rs.yminPrelim)*cs;return as?{setValue:{xmin:rs.xmaxPrelim-ps}}:{setValue:{xmin:-ps/2}}}else return as?{setValue:{xmin:rs.xmaxPrelim-20}}:{setValue:{xmin:-10}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){return ns.graphParentXmin!==null?{success:!0,instructions:[{setDependency:"graphParentXmin",desiredValue:rs.xmin}]}:await is.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xminPrelim",desiredValue:rs.xmin}]}}},ts.xmax={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xmaxPrelim:{dependencyType:"stateVariable",variableName:"xmaxPrelim"},graphParentXmax:{dependencyType:"parentStateVariable",parentComponentType:"graph",variableName:"xmax"}};return rs.identicalAxisScales&&!rs.aspectRatioFromAxisScales&&(ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(rs.graphParentXmax!==null)return{setValue:{xmax:rs.graphParentXmax}};if(!rs.identicalAxisScales||rs.aspectRatioFromAxisScales)return{setValue:{xmax:rs.xmaxPrelim}};let is=!ns.xminPrelim,as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim,us=os&&ls,cs=is&&as,ps=rs.xminPrelim;if(us){let ds=rs.aspectRatio,fs=(rs.ymaxPrelim-rs.yminPrelim)*ds;if(cs){let hs=rs.xmaxPrelim-ps,ys=Math.max(hs,fs);return{setValue:{xmax:ps+ys}}}else return is?{setValue:{xmax:ps+fs}}:as?{setValue:{xmax:rs.xmaxPrelim}}:{setValue:{xmax:fs/2}}}else return as?{setValue:{xmax:rs.xmaxPrelim}}:is?{setValue:{xmax:ps+20}}:{setValue:{xmax:10}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){return ns.graphParentXmax!==null?{success:!0,instructions:[{setDependency:"graphParentXmax",desiredValue:rs.xmax}]}:await is.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xmaxPrelim",desiredValue:rs.xmax}]}}},ts.ymin={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},yminPrelim:{dependencyType:"stateVariable",variableName:"yminPrelim"},graphParentYmin:{dependencyType:"parentStateVariable",parentComponentType:"graph",variableName:"ymin"}};return rs.identicalAxisScales&&!rs.aspectRatioFromAxisScales&&(ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(rs.graphParentYmin!==null)return{setValue:{ymin:rs.graphParentYmin}};if(!rs.identicalAxisScales||rs.aspectRatioFromAxisScales)return{setValue:{ymin:rs.yminPrelim}};if(!ns.yminPrelim)return{setValue:{ymin:rs.yminPrelim}};let as=!ns.ymaxPrelim,os=!ns.xminPrelim,ls=!ns.xmaxPrelim,us=os&&ls,cs=rs.aspectRatio;if(us){let ps=(rs.xmaxPrelim-rs.xminPrelim)/cs;return as?{setValue:{ymin:rs.ymaxPrelim-ps}}:{setValue:{ymin:-ps/2}}}else return as?{setValue:{ymin:rs.ymaxPrelim-20/cs}}:{setValue:{ymin:-10/cs}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){return ns.graphParentYmin!==null?{success:!0,instructions:[{setDependency:"graphParentYmin",desiredValue:rs.ymin}]}:await is.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"yminPrelim",desiredValue:rs.ymin}]}}},ts.ymax={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},ymaxPrelim:{dependencyType:"stateVariable",variableName:"ymaxPrelim"},graphParentYmax:{dependencyType:"parentStateVariable",parentComponentType:"graph",variableName:"ymax"}};return rs.identicalAxisScales&&!rs.aspectRatioFromAxisScales&&(ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(rs.graphParentYmax!==null)return{setValue:{ymax:rs.graphParentYmax}};if(!rs.identicalAxisScales||rs.aspectRatioFromAxisScales)return{setValue:{ymax:rs.ymaxPrelim}};let is=!ns.xminPrelim,as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim,us=os&&ls,cs=is&&as,ps=rs.yminPrelim,ds=rs.aspectRatio;if(cs){let fs=(rs.xmaxPrelim-rs.xminPrelim)/ds;if(us){let hs=rs.ymaxPrelim-ps,ys=Math.max(hs,fs);return{setValue:{ymax:ps+ys}}}else return os?{setValue:{ymax:ps+fs}}:ls?{setValue:{ymax:rs.ymaxPrelim}}:{setValue:{ymax:fs/2}}}else return ls?{setValue:{ymax:rs.ymaxPrelim}}:os?{setValue:{ymax:ps+20/ds}}:{setValue:{ymax:10/ds}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){return ns.graphParentYmax!==null?{success:!0,instructions:[{setDependency:"graphParentYmax",desiredValue:rs.ymax}]}:await is.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"ymaxPrelim",desiredValue:rs.ymax}]}}},ts.xscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({xmin:{dependencyType:"stateVariable",variableName:"xmin"},xmax:{dependencyType:"stateVariable",variableName:"xmax"}}),definition({dependencyValues:rs}){return{setValue:{xscale:rs.xmax-rs.xmin}}}},ts.yscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({ymin:{dependencyType:"stateVariable",variableName:"ymin"},ymax:{dependencyType:"stateVariable",variableName:"ymax"}}),definition({dependencyValues:rs}){return{setValue:{yscale:rs.ymax-rs.ymin}}}},ts.gridAttrCompName={returnDependencies:()=>({gridAttr:{dependencyType:"attributeComponent",attributeName:"grid"}}),definition({dependencyValues:rs}){return rs.gridAttr?{setValue:{gridAttrCompName:rs.gridAttr.componentName}}:{setValue:{gridAttrCompName:null}}}},ts.gridAttrCompChildren={stateVariablesDeterminingDependencies:["gridAttrCompName"],returnDependencies:({stateValues:rs})=>rs.gridAttrCompName?{gridAttrCompChildren:{dependencyType:"child",parentName:rs.gridAttrCompName,childGroups:["textLike"],variableNames:["value"]}}:{},definition({dependencyValues:rs}){return rs.gridAttrCompChildren?{setValue:{gridAttrCompChildren:rs.gridAttrCompChildren}}:{setValue:{gridAttrCompChildren:null}}}},ts.grid={public:!0,shadowingInstructions:{hasVariableComponentType:!0,attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},forRenderer:!0,stateVariablesDeterminingDependencies:["gridAttrCompChildren"],returnDependencies({stateValues:rs}){if(rs.gridAttrCompChildren){let ns={gridAttrCompChildren:{dependencyType:"stateVariable",variableName:"gridAttrCompChildren"},gridAttr:{dependencyType:"attributeComponent",attributeName:"grid",variableNames:["value"]}};for(let[is,as]of rs.gridAttrCompChildren.entries())ns["childAdapter"+is]={dependencyType:"adapterSourceStateVariable",componentName:as.componentName,variableName:"value"};return ns}else return{}},definition({dependencyValues:rs}){if(!rs.gridAttrCompChildren)return{setValue:{grid:"none"},setCreateComponentOfType:{grid:"text"}};let ns=rs.gridAttr.stateValues.value.toLowerCase().trim();if(ns==="true"?ns="medium":ns==="false"&&(ns="none"),["medium","dense","none"].includes(ns))return{setValue:{grid:ns},setCreateComponentOfType:{grid:"text"}};let is=[],as=[];for(let os of rs.gridAttrCompChildren)if(typeof os!="string")as.push(os);else{let ls=os.split(/\s+/),us=ls[0];us===""?as.length>0&&(is.push(as),as=[]):as.push(us);for(let cs of ls.slice(1))as.length>0&&(is.push(as),as=[]),cs!==""&&as.push(cs)}if(as.length>0&&is.push(as),is.length<2)return{setValue:{grid:"none"},setCreateComponentOfType:{grid:"text"}};ns=[];for(let os of is)if(os.length===1){let ls=os[0];if(typeof ls=="string"){let us=Context.fromText(ls).evaluate_to_constant();if(us>0)ns.push(us);else return{setValue:{grid:"none"},setCreateComponentOfType:{grid:"text"}}}else{let us=rs.gridAttrCompChildren.indexOf(ls),cs=rs["childAdapter"+us];if(cs instanceof Context.class&&(cs=cs.evaluate_to_constant()),cs>0)ns.push(cs);else return{setValue:{grid:"none"},setCreateComponentOfType:{grid:"text"}}}}else{let ls=1;for(let us of os)if(typeof us=="string")ls*=Context.fromText(us).evaluate_to_constant();else{let cs=rs.gridAttrCompChildren.indexOf(us),ps=rs["childAdapter"+cs];ps instanceof Context.class&&(ps=ps.evaluate_to_constant()),ls*=ps}if(ls>0)ns.push(ls);else return{setValue:{grid:"none"},setCreateComponentOfType:{grid:"text"}}}return{setValue:{grid:ns},setCreateComponentOfType:{grid:"numberList"}}}},ts}async changeAxisLimits({xmin:ts,xmax:rs,ymin:ns,ymax:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=[];return ts!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmin",value:ts}),rs!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmax",value:rs}),ns!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymin",value:ns}),is!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymax",value:is}),await this.coreFunctions.performUpdate({updateInstructions:us,actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{xmin:ts,xmax:rs,ymin:ns,ymax:is}}})}async addChildren({serializedComponents:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){var as;if(ts&&ts.length>0){let os=processAssignNames({serializedComponents:ts,parentName:this.componentName,parentCreatesNewNamespace:(as=this.attributes.newNamespace)==null?void 0:as.primitive,componentInfoObjects:this.componentInfoObjects,indOffset:await this.stateValues.nChildrenAdded});return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"addComponents",serializedComponents:os.serializedComponents,parentName:this.componentName,assignNamesOffset:await this.stateValues.nChildrenAdded},{updateType:"updateValue",componentName:this.componentName,stateVariable:"nChildrenAdded",value:await this.stateValues.nChildrenAdded+os.serializedComponents.length}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}else this.coreFunctions.resolveAction({actionId:rs})}async deleteChildren({number:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=Math.min(ts,await this.stateValues.nChildrenAdded);if(as>0){let os=this.definingChildren.length,ls=this.definingChildren.slice(os-as,os).map(us=>us.componentName);return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"deleteComponents",componentNames:ls},{updateType:"updateValue",componentName:this.componentName,stateVariable:"nChildrenAdded",value:await this.stateValues.nChildrenAdded-as}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}else this.coreFunctions.resolveAction({actionId:rs})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}},Ms(tu,"componentType","graph"),Ms(tu,"renderChildren",!0),tu);class Variables extends MathList{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();ts.variables={public:!0,shadowingInstructions:{createComponentOfType:"variable"},isArray:!0,entryPrefixes:["var"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:ns}){return[ns.nComponents]},returnArrayDependenciesByKey({arrayKeys:ns}){let is={};for(let as of ns)is[as]={math:{dependencyType:"stateVariable",variableName:"math"+(Number(as)+1)}};return{dependenciesByKey:is}},arrayDefinitionByKey({dependencyValuesByKey:ns,arrayKeys:is}){let as={};for(let os of is)as[os]=ns[os].math;return{setValue:{variables:as}}}};let rs=this.componentType;return ts.validVariables={returnDependencies:()=>({variables:{dependencyType:"stateVariable",variableName:"variables"}}),definition:function({dependencyValues:ns}){let is=[];for(let as of ns.variables){let os=isValidVariable(as);os||(console.warn("Invalid value for "+rs),os=!1),is.push(os)}return{setValue:{validVariables:is}}}},ts}}Ms(Variables,"componentType","variables"),Ms(Variables,"stateVariableForAttributeValue","variables");class Variable extends MathComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.validVariable={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs}){let ns=isValidVariable(rs.value);return ns||console.warn("Invalid value of a "+this.componentType),{setValue:{validVariable:ns}}}},ts}}Ms(Variable,"componentType","variable"),Ms(Variable,"rendererType","math");class PiecewiseFunction extends Function$1{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.nInputs,delete ts.nOutputs,delete ts.minima,delete ts.maxima,delete ts.extrema,delete ts.through,delete ts.throughSlope,ts}static returnSugarInstructions(){return[]}static returnChildGroups(){return[{group:"functions",componentTypes:["function"]},{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return delete rs.isInterpolatedFunction,rs.nInputs={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({}),definition(){return{setValue:{nInputs:1}}}},rs.nOutputs={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["nOutputs"]}}),definition({dependencyValues:ns}){return ns.functionChildren.length>0?{setValue:{nOutputs:ns.functionChildren[0].stateValues.nOutputs}}:{setValue:{nOutputs:1}}}},rs.numericalDomainsOfChildren={returnDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]}}),definition({dependencyValues:ns}){var as;let is=[];for(let[os,ls]of ns.functionChildren.entries()){let us=(as=ls.stateValues.domain)==null?void 0:as[0];if(us){let cs=Context.fromAst(us.tree[1][1]).evaluate_to_constant(),ps=Context.fromAst(us.tree[1][2]).evaluate_to_constant(),ds=us.tree[2][1],fs=us.tree[2][2];!Number.isFinite(cs)&&cs!==-1/0||!Number.isFinite(ps)&&ps!==1/0||ps<cs||ps===cs&&!(ds&&fs)?is.push(null):is.push([[cs,ps],[ds,fs]])}else is.push([[-1/0,1/0],[!1,!1]])}return{setValue:{numericalDomainsOfChildren:is}}}},rs.domain={returnDependencies:()=>({domainAttr:{dependencyType:"attributeComponent",attributeName:"domain",variableNames:["intervals"]},numericalDomainsOfChildren:{dependencyType:"stateVariable",variableName:"numericalDomainsOfChildren"}}),definition({dependencyValues:ns}){if(ns.domainAttr!==null){let cs=ns.domainAttr.stateValues.intervals[0];return cs&&Array.isArray(cs.tree)&&cs.tree[0]==="interval"?{setValue:{domain:[cs]}}:{setValue:{domain:null}}}let is=!1,as=1/0,os=-1/0,ls=!1,us=!1;if(ns.numericalDomainsOfChildren.length>0){for(let cs of ns.numericalDomainsOfChildren)if(cs){is=!0;let ps=cs[0][0],ds=cs[0][1],fs=cs[1][0],hs=cs[1][1];ps<as?(as=ps,ls=fs):ps===as&&fs&&(ls=!0),ds>os?(os=ds,us=hs):ds===os&&hs&&(us=!0)}}return is?{setValue:{domain:[Context.fromAst(["interval",["tuple",as,os],["tuple",ls,us]])]}}:{setValue:{domain:null}}}},delete rs.unnormalizedFormula,rs.formula={public:!0,shadowingInstructions:{createComponentOfType:"math",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({}),definition:()=>({setValue:{formula:Context.fromAst("")}})},delete rs.nPrescribedPoints,delete rs.prescribedPoints,delete rs.prescribedMinima,delete rs.prescribedMaxima,delete rs.prescribedExtrema,delete rs.interpolationPoints,delete rs.xs,delete rs.mathChildName,delete rs.mathChildCreatedBySugar,rs.symbolicfs={isArray:!0,entryPrefixes:["symbolicf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:ns}){let is={};for(let as of ns)is[as]=os=>Context.fromAst("");return{setValue:{symbolicfs:is}}}},rs.numericalfs={isArray:!0,entryPrefixes:["numericalf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey(){return{globalDependencies:{functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalfs"]},numericalDomainsOfChildren:{dependencyType:"stateVariable",variableName:"numericalDomainsOfChildren"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}},arrayDefinitionByKey:function({globalDependencyValues:ns,arrayKeys:is}){if(ns.functionChildren.length>0){let as={};for(let os of is){let ls=ns.functionChildren.filter((cs,ps)=>ns.numericalDomainsOfChildren[ps]).map(cs=>cs.stateValues.numericalfs[os]),us=ns.numericalDomainsOfChildren.filter(cs=>cs);as[os]=returnPiecewiseNumericalFunctionFromChildren({numericalFsOfChildren:ls,numericalDomainsOfChildren:us,domain:ns.domain,component:os})}return{setValue:{numericalfs:as}}}else if(ns.numericalfShadow){let as={};for(let os of is)os==="0"?as[os]=ns.numericalfShadow:as[os]=()=>NaN;return{setValue:{numericalfs:as}}}else if(ns.symbolicfShadow){let as={};for(let os of is)os==="0"?as[os]=function(ls){return ns.symbolicfShadow(Context.fromAst(ls)).evaluate_to_constant()}:as[os]=()=>NaN;return{setValue:{numericalfs:as}}}else{let as={};for(let os of is)as[os]=()=>NaN;return{setValue:{numericalfs:as}}}}},rs.fDefinitions={isArray:!0,entryPrefixes:["fDefinition"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize({dependencyValues:ns}){return[ns.nOutputs]},returnArrayDependenciesByKey({stateValues:ns}){return{globalDependencies:{functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["fDefinitions"]},numericalDomainsOfChildren:{dependencyType:"stateVariable",variableName:"numericalDomainsOfChildren"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}},arrayDefinitionByKey:function({globalDependencyValues:ns,usedDefault:is,arrayKeys:as}){if(ns.functionChildren.length>0){let os={};for(let ls of as){let us=ns.functionChildren.filter((ps,ds)=>ns.numericalDomainsOfChildren[ds]).map(ps=>ps.stateValues.fDefinitions[ls]),cs=ns.numericalDomainsOfChildren.filter(ps=>ps);os[ls]={functionType:"piecewise",fDefinitionsOfChildren:us,numericalDomainsOfChildren:cs,domain:ns.domain,component:ls}}return{setValue:{fDefinitions:os}}}else if(ns.numericalfShadow){let os={};for(let ls of as)os[ls]={};return{setValue:{fDefinitions:os}}}else{let os={};for(let ls of as)os[ls]={};return{setValue:{fDefinitions:os}}}}},rs.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({variable:{dependencyType:"stateVariable",variableName:"variable"},functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["formula","variable","domain"]},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:ns,usedDefault:is}){var ds;let as=ns.variable,os={};ns.padZeros&&(is.displayDigits&&!is.displayDecimals?Number.isFinite(ns.displayDecimals)&&(os.padToDecimals=ns.displayDecimals):ns.displayDigits>=1&&(os.padToDigits=ns.displayDigits));let ls=Context.fromAst(1/0),us=Context.fromAst(-1/0),cs=[];for(let[fs,hs]of ns.functionChildren.entries()){let ys=hs.stateValues.formula.subscripts_to_strings(),gs=hs.stateValues.variable.subscripts_to_strings();ys=ys.substitute({[gs]:as}).strings_to_subscripts();let bs=roundForDisplay({value:ys,dependencyValues:ns,usedDefault:is}).toLatex(os),vs=(ds=hs.stateValues.domain)==null?void 0:ds[0],Ns,Ts,Cs,xs;if(vs?(Ns=Context.fromAst(vs.tree[1][1]).simplify(),Ts=Context.fromAst(vs.tree[1][2]).simplify(),Cs=vs.tree[2][1],xs=vs.tree[2][2]):(Ns=us,Ts=ls),Ns.equals(us))if(Ts.equals(ls)){if(fs===0)return{setValue:{latex:bs}};cs.push(`${bs} & \\text{otherwise}`);break}else{let As=xs?"\\le":"<",ws=roundForDisplay({value:Ts,dependencyValues:ns,usedDefault:is}).toLatex(os);cs.push(`${bs} & \\text{if } ${as} ${As} ${ws}`)}else if(Ts.equals(ls)){let As=Cs?"\\ge":">",ws=roundForDisplay({value:Ns,dependencyValues:ns,usedDefault:is}).toLatex(os);cs.push(`${bs} & \\text{if } ${as} ${As} ${ws}`)}else if(Ts.equals(Ns)&&Cs&&xs){let As=roundForDisplay({value:Ts,dependencyValues:ns,usedDefault:is}).toLatex(os);cs.push(`${bs} & \\text{if } ${as} = ${As}`)}else{let As="{"+roundForDisplay({value:Ns,dependencyValues:ns,usedDefault:is}).toLatex(os)+"}";Cs?As+=" \\le ":As+=" < ",As+=as,xs?As+=" \\le ":As+=" < ",As+=roundForDisplay({value:Ts,dependencyValues:ns,usedDefault:is}).toLatex(os),cs.push(`${bs} & \\text{if } ${As}`)}}let ps=cs.join(`\\\\
    `);return ps=`\\begin{cases}
    ${ps}
\\end{cases}`,{setValue:{latex:ps}}}},rs.allMinima={returnDependencies(){return{functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["allMinima"]},numericalDomainsOfChildren:{dependencyType:"stateVariable",variableName:"numericalDomainsOfChildren"},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"}}},definition:function({dependencyValues:ns}){let is=ts.eps,as=[],os=ns.functionChildren.map(us=>us.stateValues.allMinima),ls=ns.numericalf;for(let[us,cs]of ns.numericalDomainsOfChildren.entries()){if(!cs)continue;let ps=cs[0][0],ds=cs[0][1],fs=os[us];fs=fs.filter(gs=>gs[0]>ps+is&&gs[0]<ds-is),as.push(...fs);let hs=ls(ps);hs<ls(ps-is)&&hs<ls(ps+is)&&as.every(gs=>gs[0]<ps-is||gs[0]>ps+is)&&as.push([ps,hs]);let ys=ls(ds);ys<ls(ds-is)&&ys<ls(ds+is)&&as.every(gs=>gs[0]<ds-is||gs[0]>ds+is)&&as.push([ds,ys]);for(let[gs,bs]of[...os.entries()].slice(us+1)){let vs=bs.filter(Ns=>Ns[0]<ps-is||Ns[0]>ds+is);os[gs]=vs}}return as=as.sort((us,cs)=>us[0]-cs[0]),{setValue:{allMinima:as}}}},rs.allMaxima={returnDependencies(){return{functionChildren:{dependencyType:"child",childGroups:["functions"],variableNames:["allMaxima"]},numericalDomainsOfChildren:{dependencyType:"stateVariable",variableName:"numericalDomainsOfChildren"},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"}}},definition:function({dependencyValues:ns}){let is=ts.eps,as=[],os=ns.functionChildren.map(us=>us.stateValues.allMaxima),ls=ns.numericalf;for(let[us,cs]of ns.numericalDomainsOfChildren.entries()){if(!cs)continue;let ps=cs[0][0],ds=cs[0][1],fs=os[us];fs=fs.filter(gs=>gs[0]>ps+is&&gs[0]<ds-is),as.push(...fs);let hs=ls(ps);hs>ls(ps-is)&&hs>ls(ps+is)&&as.every(gs=>gs[0]<ps-is||gs[0]>ps+is)&&as.push([ps,hs]);let ys=ls(ds);ys>ls(ds-is)&&ys>ls(ds+is)&&as.every(gs=>gs[0]<ds-is||gs[0]>ds+is)&&as.push([ds,ys]);for(let[gs,bs]of[...os.entries()].slice(us+1)){let vs=bs.filter(Ns=>Ns[0]<ps-is||Ns[0]>ds+is);os[gs]=vs}}return as=as.sort((us,cs)=>us[0]-cs[0]),{setValue:{allMaxima:as}}}},rs.returnNumericalDerivatives={returnDependencies:()=>({}),definition:function(){return{setValue:{returnNumericalDerivatives:null}}}},rs.numericalDerivativesDefinition={returnDependencies:()=>({}),definition:function(){return{setValue:{numericalDerivativesDefinition:{}}}}},rs}}Ms(PiecewiseFunction,"componentType","piecewiseFunction");class Interval extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.createIntervals,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.createIntervals={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({}),definition:()=>({setValue:{createIntervals:!0}})},ts}}Ms(Interval,"componentType","interval"),Ms(Interval,"rendererType","math");class Group extends Template{}Ms(Group,"componentType","group"),Ms(Group,"renderedDefault",!0);let Option$1=(ru=class extends Group{static createAttributesObject(){let ts=super.createAttributesObject();return ts.selectForVariants={createComponentOfType:"textListFromString",createStateVariable:"selectForVariants",defaultValue:[],public:!0},ts.selectWeight={createComponentOfType:"number",createStateVariable:"selectWeight",defaultValue:1,public:!0},ts}},Ms(ru,"componentType","option"),Ms(ru,"renderedDefault",!1),ru);class Sequence extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();ts.fixed={leaveRaw:!0},ts.displayDigits={leaveRaw:!0},ts.displayDecimals={leaveRaw:!0},ts.displaySmallAsZero={leaveRaw:!0},ts.padZeros={leaveRaw:!0};let rs=returnStandardSequenceAttributes();return Object.assign(ts,rs),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnStandardSequenceStateVariableDefinitions();return Object.assign(ts,rs),ts.readyToExpandWhenResolved={returnDependencies:()=>({from:{dependencyType:"stateVariable",variableName:"from"},length:{dependencyType:"stateVariable",variableName:"length"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"},exclude:{dependencyType:"stateVariable",variableName:"exclude"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,workspace:rs,componentInfoObjects:ns,flags:is}){var bs;if(!await ts.stateValues.validSequence)return rs.lastReplacementParameters={from:null,length:null,step:null,type:null,exclude:null},{replacements:[]};let as=await ts.stateValues.from,os=await ts.stateValues.length,ls=await ts.stateValues.step,us=await ts.stateValues.type,cs=await ts.stateValues.exclude;rs.lastReplacementParameters={from:as,length:os,step:ls,type:us,exclude:cs};let ps=(bs=ts.attributes.newNamespace)==null?void 0:bs.primitive,ds=returnSequenceValues({from:as,step:ls,length:os,exclude:cs,type:us,lowercase:await ts.stateValues.lowercase}),fs=us;us==="letters"&&(fs="text");let hs=[],ys={};for(let vs of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])vs in ts.attributes&&(ys[vs]=ts.attributes[vs]);for(let vs of ds){let Ns={};Object.keys(ys).length>0&&(Ns=convertAttributesForComponentType({attributes:ys,componentType:fs,componentInfoObjects:ns,compositeCreatesNewNamespace:ps,flags:is}));let Ts={componentType:fs,attributes:Ns,state:{value:vs,fixed:!0}};hs.push(Ts)}return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:hs,parentName:ts.componentName,parentCreatesNewNamespace:ps,componentInfoObjects:ns}).serializedComponents}}static async calculateReplacementChanges({component:ts,workspace:rs,componentInfoObjects:ns,flags:is}){var hs;let as=rs.lastReplacementParameters,os=[];if(!await ts.stateValues.validSequence){let ys=ts.replacementsToWithhold;if(ys||(ys=0),ts.replacements.length-ys>0){let bs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:ts.replacements.length};os.push(bs)}return as.length=0,os}let ls=await ts.stateValues.from,us=await ts.stateValues.length,cs=await ts.stateValues.step,ps=await ts.stateValues.type,ds=await ts.stateValues.exclude,fs=await ts.stateValues.lowercase;if(as.type!==ps||as.exclude.length>0||ds.length>0){let ys=(await this.createSerializedReplacements({component:ts,workspace:rs,componentInfoObjects:ns,flags:is})).replacements,gs={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:ys,replacementsToWithhold:0};os.push(gs)}else{let ys=!1;ps==="math"?ls.equals(as.from)&&cs.equals(as.step)||(ys=!0):(ls!==as.from||cs!==as.step)&&(ys=!0);let gs=as.length,bs=0,vs=0,Ns=gs,Ts;if(us<gs){Ts=ts.replacements.length-us;let Cs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:Ts};os.push(Cs)}else if(us>gs&&(bs=us-gs,ts.replacementsToWithhold>0))if(ts.replacementsToWithhold>=bs){Ts=ts.replacementsToWithhold-bs,vs+=bs,gs+=bs,bs=0;let Cs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:Ts};os.push(Cs)}else bs-=ts.replacementsToWithhold,vs+=ts.replacementsToWithhold,gs+=ts.replacementsToWithhold,Ts=0;if(ys===!0&&(vs=gs,Ns=0),vs>0)for(let Cs=Ns;Cs<Ns+vs;Cs++){let xs=returnSequenceValueForIndex({index:Cs,from:ls,step:cs,exclude:[],type:ps,lowercase:fs}),As={changeType:"updateStateVariables",component:ts.replacements[Cs],stateChanges:{value:xs}};os.push(As)}if(bs>0){let Cs=[],xs=(hs=ts.attributes.newNamespace)==null?void 0:hs.primitive,As={};for(let Ss of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])Ss in ts.attributes&&(As[Ss]=ts.attributes[Ss]);for(let Ss=gs;Ss<await ts.stateValues.length;Ss++){let Ds=returnSequenceValueForIndex({index:Ss,from:ls,step:cs,exclude:[],type:ps,lowercase:fs}),Vs=await ts.stateValues.type;Vs==="letters"&&(Vs="text");let Is={};Object.keys(As).length>0&&(Is=convertAttributesForComponentType({attributes:As,componentType:Vs,componentInfoObjects:ns,compositeCreatesNewNamespace:xs,flags:is}));let Os={componentType:Vs,attributes:Is,state:{value:Ds,fixed:!0}};Cs.push(Os)}let ws=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:Cs,parentName:ts.componentName,parentCreatesNewNamespace:xs,componentInfoObjects:ns,indOffset:gs}),Es={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:gs,serializedReplacements:ws.serializedComponents,replacementsToWithhold:0,assignNamesOffset:gs};os.push(Es)}}return as.type=ps,as.from=ls,as.length=us,as.step=cs,as.exclude=ds,os}get allPotentialRendererTypes(){let ts=super.allPotentialRendererTypes,rs="number";this.attributes.type&&this.attributes.type.primitive&&(rs=this.attributes.type.primitive);let ns=this.componentInfoObjects.allComponentClasses[rs==="letters"?"text":rs].rendererType;return ts.includes(ns)||ts.push(ns),ts}}Ms(Sequence,"componentType","sequence"),Ms(Sequence,"assignNamesToReplacements",!0),Ms(Sequence,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");let Map$1=(zl=class extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.behavior={createComponentOfType:"text",createStateVariable:"behavior",defaultValue:"combination",public:!0,trim:!0},ts.isResponse={leaveRaw:!0},ts}static returnChildGroups(){return[{group:"templates",componentTypes:["template"]},{group:"sources",componentTypes:["sources"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nSources={additionalStateVariablesDefined:["sourcesNames","sourceAliases","sourceIndexAliases"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childGroups:["sources"],variableNames:["alias","indexAlias"]}}),definition:function({dependencyValues:rs}){return{setValue:{nSources:rs.sourcesChildren.length,sourcesNames:rs.sourcesChildren.map(ns=>ns.componentName),sourceAliases:rs.sourcesChildren.map(ns=>ns.stateValues.alias),sourceIndexAliases:rs.sourcesChildren.map(ns=>ns.stateValues.indexAlias)}}}},ts.nIterates={additionalStateVariablesDefined:["minNIterates","sourcesChildNames"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childGroups:["sources"],variableNames:["numberOfChildren","childComponentNames"]}}),definition:function({dependencyValues:rs}){let ns=rs.sourcesChildren.map(os=>os.stateValues.numberOfChildren),is=Math.min(...ns),as=rs.sourcesChildren.map(os=>[...os.stateValues.childComponentNames]);return{setValue:{nIterates:ns,minNIterates:is,sourcesChildNames:as}}}},ts.template={returnDependencies:()=>({templateChild:{dependencyType:"child",childGroups:["templates"],variableNames:["serializedChildren","newNamespace"]}}),definition:function({dependencyValues:rs}){let ns=rs.templateChild[0];if(!ns)return{setValue:{template:null}};let is=ns.stateValues.serializedChildren,as={componentType:"template",state:{rendered:!0},children:is,originalName:ns.componentName};return ns.stateValues.newNamespace&&(as.attributes={newNamespace:{primitive:!0}}),{setValue:{template:as}}}},ts.validBehavior={returnDependencies:()=>({behavior:{dependencyType:"stateVariable",variableName:"behavior"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition:function({dependencyValues:rs}){let ns=!0;return rs.behavior==="parallel"?rs.nIterates.slice(1).some(is=>is!=rs.nIterates[0])&&console.warn("Warning: map with parallel behavior and different numbers of iterates in sources activeChildren. Extra iterates will be ignored."):rs.behavior!=="combination"&&(console.warn("Invalid map behavior: "+rs.behavior),ns=!1),{setValue:{validBehavior:ns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({validBehavior:{dependencyType:"stateVariable",variableName:"validBehavior"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:rs,componentInfoObjects:ns})=>({variantSeed:{dependencyType:"value",value:rs.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(ns.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns}){let is={seed:rs.variantSeed,meta:{createdBy:ns}},as=is.subvariants=[];for(let os of rs.variantDescendants)os.stateValues.isVariantComponent?as.push(os.stateValues.generatedVariantInfo):os.stateValues.generatedVariantInfo&&as.push(...os.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:is}}}},ts}static async createSerializedReplacements({component:ts,workspace:rs,componentInfoObjects:ns,flags:is}){if(!await ts.stateValues.validBehavior)return rs.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0},{replacements:[]};rs.lastReplacementParameters={sourcesNames:await ts.stateValues.sourcesNames,sourcesChildNames:await ts.stateValues.sourcesChildNames,behavior:await ts.stateValues.behavior,nIterates:await ts.stateValues.nIterates,minNIterates:await ts.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]};let as=[];if(await ts.stateValues.behavior==="parallel")for(let os=0;os<await ts.stateValues.minNIterates;os++)as.push(...await this.parallelReplacement({component:ts,iter:os,componentInfoObjects:ns,flags:is}));else as=(await this.recurseThroughCombinations({component:ts,sourcesNumber:0,iterateNumber:-1,componentInfoObjects:ns,flags:is})).replacements;return{replacements:as}}static async parallelReplacement({component:ts,iter:rs,componentInfoObjects:ns,flags:is}){var us,cs,ps;let as=[deepClone(await ts.stateValues.template)],os=(us=ts.attributes.newNamespace)==null?void 0:us.primitive;if("isResponse"in ts.attributes){let ds=convertAttributesForComponentType({attributes:{isResponse:ts.attributes.isResponse},componentType:as[0].componentType,componentInfoObjects:ns,compositeCreatesNewNamespace:os,flags:is});as[0].attributes||(as[0].attributes={}),Object.assign(as[0].attributes,ds)}return!((ps=(cs=as[0].attributes)==null?void 0:cs.newNamespace)!=null&&ps.primitive)&&as[0].children&&markToCreateAllUniqueNames(as[0].children),as=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:as,parentName:ts.componentName,parentCreatesNewNamespace:os,componentInfoObjects:ns,indOffset:rs}).serializedComponents,await addSharedParameters(as[0],ts,Array(await ts.stateValues.nSources).fill(rs)),as}static async recurseThroughCombinations({component:ts,sourcesNumber:rs,childnumberArray:ns=[],iterateNumber:is,componentInfoObjects:as,flags:os}){var ys,gs;let ls=[],us=[...ns,0],cs=(ys=ts.attributes.newNamespace)==null?void 0:ys.primitive,ps=await ts.stateValues.nIterates,ds=await ts.stateValues.nSources,fs=await ts.stateValues.template,hs=this.createAttributesObject();for(let bs=0;bs<ps[rs];bs++)if(us[rs]=bs,rs>=ds-1){is++;let vs=[deepClone(fs)],Ns={};Ns=convertAttributesForComponentType({attributes:ts.attributes,componentType:vs[0].componentType,componentInfoObjects:as,compositeAttributesObj:hs,compositeCreatesNewNamespace:cs,flags:os}),vs[0].attributes||(vs[0].attributes={}),Object.assign(vs[0].attributes,Ns),!((gs=vs[0].attributes.newNamespace)!=null&&gs.primitive)&&vs[0].children&&markToCreateAllUniqueNames(vs[0].children);let Cs=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:vs,parentName:ts.componentName,parentCreatesNewNamespace:cs,componentInfoObjects:as,indOffset:is}).serializedComponents[0];await addSharedParameters(Cs,ts,us),ls.push(Cs)}else{let vs=await this.recurseThroughCombinations({component:ts,sourcesNumber:rs+1,childnumberArray:us,iterateNumber:is,componentInfoObjects:as,flags:os});ls.push(...vs.replacements),is=vs.iterateNumber}return{replacements:ls,iterateNumber:is}}static async calculateReplacementChanges({component:ts,components:rs,workspace:ns,componentInfoObjects:is,flags:as}){let os=[];if(!await ts.stateValues.validBehavior){if(ns.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},ts.replacements.length>0){let xs={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:ts.replacements.length,replacementsToWithhold:0};os.push(xs)}return os}let ls=ns.lastReplacementParameters,us=!1,cs=!0,ps=await ts.stateValues.nSources,ds=await ts.stateValues.sourcesNames;if(ps!==ls.sourcesNames.length)cs=!1;else for(let xs=0;xs<ps;xs++)if(ds[xs]!==ls.sourcesNames[xs]){cs=!1;break}let fs=await ts.stateValues.nIterates,hs=await ts.stateValues.sourcesChildNames,ys=await ts.stateValues.behavior;if(!cs||ls.behavior!==await ys)us=!0;else{let xs=!0;if(ls.nIterates===void 0)us=!0;else for(let As=0;As<ps;As++){let ws=fs[As],Es=ls.nIterates[As];ws!==Es&&(xs=!1);let Ss=Math.min(ws,Es);for(let Ds=0;Ds<Ss;Ds++)if(hs[As][Ds]!=ls.sourcesChildNames[As][Ds]){us=!0,xs=!1;break}if(us)break}if(xs)return[];ys==="combination"&&ps>1&&(us=!0)}if(us){let xs=await this.createSerializedReplacements({component:ts,workspace:ns,componentInfoObjects:is,flags:as}).replacements,As={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:xs,replacementsToWithhold:0};return os.push(As),ns.lastReplacementParameters={sourcesNames:ds,sourcesChildNames:hs,behavior:ys,nIterates:fs,minNIterates:await ts.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},os}let gs=await ts.stateValues.minNIterates,bs=ls.minNIterates,vs=0,Ns=ts.replacementsToWithhold;Ns||(Ns=0);let Ts=ls.withheldSubstitutionChildNames,Cs=!1;if(gs<bs){for(let xs=0;xs<ps;xs++)for(let As=gs;As<bs;As++)rs[ls.sourcesChildNames[xs][As]]===void 0&&(Cs=!0);if(!Cs)for(let xs of ls.withheldSubstitutionChildNames)for(let As of xs)rs[As]===void 0&&(Cs=!0)}if(Cs){let xs=Math.min(gs,bs),As=ts.replacements.length-xs,ws={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:xs,numberReplacementsToDelete:As,replacementsToWithhold:0};os.push(ws),Ts=[],Ns=0}if(gs<bs){if(!Cs){vs=ts.replacements.length-gs;let xs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:vs};os.push(xs);for(let As=0;As<ps;As++){let ws=ls.withheldSubstitutionChildNames[As];ws?ws=[...ws]:ws=[],ws=new Set([...ls.sourcesChildNames[As].slice(gs),...ws]),Ts[As]=ws}}}else if(gs>bs){let xs=gs-bs;if(Ns>0)if(Ns>=xs){vs=Ns-xs,xs=0;let As={changeType:"changeReplacementsToWithhold",replacementsToWithhold:vs};os.push(As)}else xs-=Ns,bs+=Ns,vs=0;if(xs>0){let As=[];for(let Es=bs;Es<gs;Es++)As.push(...await this.parallelReplacement({component:ts,iter:Es,componentInfoObjects:is,flags:as}));ts.doenetAttributes.assignNames&&ts.doenetAttributes.assignNames.length;let ws={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:bs,serializedReplacements:As,replacementsToWithhold:0,assignNamesOffset:bs};os.push(ws)}}return ns.lastReplacementParameters={sourcesNames:ds,sourcesChildNames:hs,behavior:ys,nIterates:fs,minNIterates:gs,replacementsToWithhold:vs,withheldSubstitutionChildNames:Ts},os}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns,useSubpartVariantRng:!0})}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){var os;let ns=(os=ts.variants)==null?void 0:os.numberOfVariants;if(ns!==void 0)return{success:!0,numberOfVariants:ns};let is=gatherVariantComponents({serializedComponents:ts.children,componentInfoObjects:rs}),as=[];for(let ls of is){let cs=rs.allComponentClasses[ls.componentType].determineNumberOfUniqueVariants({serializedComponent:ls,componentInfoObjects:rs});if(!cs.success)return{success:!1};as.push(cs.numberOfVariants)}return as.length===1&&as[0]===1?(ts.variants.numberOfVariants=1,{success:!0,numberOfVariants:1}):{success:!1}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){var os;let is=(os=ts.variants)==null?void 0:os.numberOfVariants;return is===void 0?{success:!1}:!Number.isInteger(rs)||rs<1||rs>is?{success:!1}:{success:!0,desiredVariant:{index:rs}}}},Ms(zl,"componentType","map"),Ms(zl,"assignNamesToReplacements",!0),Ms(zl,"createsVariants",!0),Ms(zl,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved"),zl);async function addSharedParameters(ss,ts,rs){let ns=ss.doenetAttributes.addToSharedParameters=[],is=await ts.stateValues.sourcesNames;for(let[as,os]of(await ts.stateValues.sourceAliases).entries())if(os){let ls=is[as];ns.push({parameterName:"sourceNameMappings",key:os,value:{name:ls,childNumber:rs[as]}})}for(let[as,os]of(await ts.stateValues.sourceIndexAliases).entries())os&&ns.push({parameterName:"sourceIndexMappings",key:os,value:rs[as]+1})}class Sources extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.alias={createPrimitiveOfType:"string",validationFunction:function(rs){if(!/[a-zA-Z_]/.test(rs.substring(0,1)))throw Error("All aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(rs))throw Error("Aliases can contain only letters, numbers, hyphens, and underscores");return rs}},ts.indexAlias={createPrimitiveOfType:"string",validationFunction:function(rs){if(!/[a-zA-Z_]/.test(rs.substring(0,1)))throw Error("All index aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(rs))throw Error("Index aliases can contain only letters, numbers, hyphens, and underscores");return rs}},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.alias={returnDependencies:()=>({alias:{dependencyType:"attributePrimitive",attributeName:"alias"}}),definition({dependencyValues:rs}){return{setValue:{alias:rs.alias}}}},ts.indexAlias={returnDependencies:()=>({indexAlias:{dependencyType:"attributePrimitive",attributeName:"indexAlias"}}),definition({dependencyValues:rs}){return{setValue:{indexAlias:rs.indexAlias}}}},ts.numberOfChildren={additionalStateVariablesDefined:["childComponentNames","childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"]}}),definition:function({dependencyValues:rs}){let ns=rs.children.length,is=rs.children.map(as=>as.componentName);return{setValue:{numberOfChildren:ns,childComponentNames:is,childIdentities:rs.children}}}},ts}}Ms(Sources,"componentType","sources"),Ms(Sources,"rendererType","containerInline"),Ms(Sources,"renderChildren",!0);class Slider extends BaseComponent{constructor(ts){super(ts),this.changeValue=this.changeValue.bind(this),Object.assign(this.actions,{changeValue:this.changeValue})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultValue:"number",toLowerCase:!0,validValues:["number","text"],forRenderer:!0},ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:100,isAbsolute:!0},public:!0,forRenderer:!0},ts.initialValue={createComponentOfType:"_componentWithSelectableType",createStateVariable:"initialValue",defaultValue:null},ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.showControls={createComponentOfType:"boolean",createStateVariable:"showControls",defaultValue:!1,public:!0,forRenderer:!0},ts.showTicks={createComponentOfType:"boolean",createStateVariable:"showTicks",defaultValue:!0,public:!0,forRenderer:!0},ts.showValue={createComponentOfType:"boolean",createStateVariable:"showValue",defaultValue:!0,public:!0,forRenderer:!0},ts.from={createComponentOfType:"number",createStateVariable:"from",defaultValue:0,public:!0,forRenderer:!0},ts.to={createComponentOfType:"number",createStateVariable:"to",defaultValue:10,public:!0,forRenderer:!0},ts.step={createComponentOfType:"number",createStateVariable:"step",defaultValue:1,public:!0,forRenderer:!0},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.bindValueTo={createComponentOfType:"_componentWithSelectableType"},ts}static returnChildGroups(){return[{group:"numbersTexts",componentTypes:["number","text"]},{group:"markers",componentTypes:["markers"]},{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnLabelStateVariableDefinitions();return Object.assign(ts,rs),ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:ns,usedDefault:is}){if(ns.displayDigitsAttr!==null){let as=is.displayDigitsAttr,os=ns.displayDecimalsAttr===null||is.displayDecimalsAttr;if(!(as||os)){let ls=ns.displayDigitsAttr.shadowDepth;ns.displayDecimalsAttr.shadowDepth<ls&&(as=!0)}return as?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:ns.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:ns.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.items={forRenderer:!0,public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({numberAndTextChildren:{dependencyType:"child",childGroups:["numbersTexts"],variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"}}),definition:function({dependencyValues:ns,componentInfoObjects:is}){let as=[];if(ns.type==="text")for(let os of ns.numberAndTextChildren)is.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"text"})?as.push(os.stateValues.value):as.push(os.stateValues.value.toString());else if(ns.numberAndTextChildren.length>0){for(let os of ns.numberAndTextChildren)if(is.isInheritedComponentType({inheritedComponentType:os.componentType,baseComponentType:"number"}))as.push(os.stateValues.value);else{let ls=Number(os.stateValues.value);Number.isFinite(ls)&&as.push(ls)}as.sort((os,ls)=>os-ls)}return{setValue:{items:as},setCreateComponentOfType:{items:ns.type}}}},ts.nItems={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:ns}){let is=ns.items.length;return is===0&&ns.type==="number"&&(is=Math.floor((ns.to-ns.from)/ns.step+1e-10)+1,is>=0&&Number.isFinite(is)||(is=0)),{setValue:{nItems:is}}}},ts.firstItem={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:ns}){let is;return ns.items.length>0?is=ns.items[0]:ns.type==="number"?is=ns.from:is=null,{setValue:{firstItem:is}}}},ts.lastItem={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},nItems:{dependencyType:"stateVariable",variableName:"nItems"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:ns}){let is;return ns.items.length>0?is=ns.items[ns.items.length-1]:ns.type==="number"?is=ns.from+(ns.nItems-1)*ns.step:is=null,{setValue:{lastItem:is}}}},ts.valueToIndex={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:ns}){let is={};for(let[as,os]of ns.items.entries())is[os]=as;return{setValue:{valueToIndex:is}}}},ts.preliminaryValue={hasEssential:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}),definition({dependencyValues:ns}){return ns.bindValueTo?{setValue:{preliminaryValue:ns.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{preliminaryValue:{get defaultValue(){return ns.initialValue}}}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){return is.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:ns.preliminaryValue,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"preliminaryValue",value:ns.preliminaryValue}]}}},ts.index={forRenderer:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},valueToIndex:{dependencyType:"stateVariable",variableName:"valueToIndex"},items:{dependencyType:"stateVariable",variableName:"items"},preliminaryValue:{dependencyType:"stateVariable",variableName:"preliminaryValue"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},nItems:{dependencyType:"stateVariable",variableName:"nItems"}}),definition:function({dependencyValues:ns}){let is=findIndexOfClosestValidValue(ns);return is===void 0&&(is=0),{setValue:{index:is}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){if(is.items.length===0){let os=is.from,ls=is.step,us=ns.index;return Number.isInteger(us)?us>=0&&us<is.nItems?{success:!0,instructions:[{setDependency:"preliminaryValue",desiredValue:os+us*ls}]}:{success:!1}:{success:!1}}let as=is.items[ns.index];return as===void 0?{success:!1}:{success:!0,instructions:[{setDependency:"preliminaryValue",desiredValue:as}]}}},ts.value={forRenderer:!0,public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},items:{dependencyType:"stateVariable",variableName:"items"},index:{dependencyType:"stateVariable",variableName:"index"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"}}),definition:function({dependencyValues:ns}){let is;return ns.items.length>0?is=ns.items[ns.index]:is=ns.from+ns.step*ns.index,{setValue:{value:is},setCreateComponentOfType:{value:ns.type}}},inverseDefinition:invertSliderValue},ts.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:ns,usedDefault:is}){return{setValue:{valueForDisplay:roundForDisplay({value:ns.value,dependencyValues:ns,usedDefault:is}).tree}}}},ts.markers={forRenderer:!0,returnDependencies:()=>({markersChild:{dependencyType:"child",childGroups:["markers"],variableNames:["markerType","markers"]},type:{dependencyType:"stateVariable",variableName:"type"},items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:ns}){let is=[];if(ns.markersChild.length>0){let as=ns.markersChild[0].stateValues.markerType;as==="empty"?is=[...ns.items]:as!==ns.type?(console.warn("Markers type doesn't match slider type."),is=[]):is=ns.markersChild[0].stateValues.markers}return{setValue:{markers:is}}}},ts}async changeValue({value:ts,transient:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:ns});else return rs?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:ts}],transient:rs,actionId:ns,sourceInformation:is,skipRendererUpdate:as}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:ts}],actionId:ns,sourceInformation:is,skipRendererUpdate:as,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:ts,responseText:ts.toString()}}})}}Ms(Slider,"componentType","slider"),Ms(Slider,"variableForPlainMacro","value"),Ms(Slider,"variableForPlainCopy","value");function findIndexOfClosestValidValue({preliminaryValue:ss,valueToIndex:ts,type:rs,items:ns,from:is,step:as,nItems:os}){let ls=ss;if(ns.length===0){if(!Number.isFinite(ls))return;let ds=Math.round((ls-is)/as);return ds>=0?ds<os?ds:os-1:0}let us=ts[ls];if(us!==void 0)return us;if(rs==="text")return;let cs=function(ds=0,fs=ns.length-1){if(fs<=ds+1)return ls>ns[ds]?fs:ds;let hs=Math.round((fs+ds)/2);return ls>ns[hs]?cs(hs,fs):cs(ds,hs)},ps=cs();if(ps!==0){let ds=ns[ps-1],fs=ns[ps],hs=Math.abs(ls-ds),ys=Math.abs(ls-fs);hs<ys&&ps--}return ps}async function invertSliderValue({desiredStateVariableValues:ss,stateValues:ts}){let rs=ss.value;if(await ts.type==="text")rs=rs.toString();else if(rs instanceof Context.class){if(rs=rs.evaluate_to_constant(),Number.isNaN(rs))return{success:!1}}else rs=Number(rs);let ns=findIndexOfClosestValidValue({preliminaryValue:rs,valueToIndex:await ts.valueToIndex,type:await ts.type,items:await ts.items,from:await ts.from,step:await ts.step,nItems:await ts.nItems});return ns===void 0?{success:!1}:{success:!0,instructions:[{setDependency:"index",desiredValue:ns}]}}class Markers extends BaseComponent{static returnChildGroups(){return[{group:"texts",componentTypes:["text"]},{group:"numbers",componentTypes:["number"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.markerType={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({textChildren:{dependencyType:"child",childGroups:["texts"]},numberChildren:{dependencyType:"child",childGroups:["numbers"]}}),definition:function({dependencyValues:rs}){let ns;return rs.textChildren.length>0?ns="text":rs.numberChildren.length>0?ns="number":ns="empty",{setValue:{markerType:ns}}}},ts.markers={public:!0,isArray:!0,shadowingInstructions:{hasVariableComponentType:!0},entryPrefixes:["item"],returnDependencies:()=>({markerType:{dependencyType:"stateVariable",variableName:"markerType"},textChildren:{dependencyType:"child",childGroups:["texts"],variableNames:["value"]},numberChildren:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]}}),definition:function({dependencyValues:rs}){let ns=[],is=rs.markerType;return rs.markerType==="text"?ns=rs.textChildren.map(as=>as.stateValues.value):rs.markerType==="number"?(ns=rs.numberChildren.map(as=>as.stateValues.value),ns.sort((as,os)=>as-os)):is="text",{setValue:{markers:ns},setCreateComponentOfType:{markers:is}}}},ts}}Ms(Markers,"componentType","markers");class Pegboard extends GraphicalComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0,forRenderer:!0},ts.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0,forRenderer:!0},ts.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0,forRenderer:!0},ts.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0,forRenderer:!0},ts}}Ms(Pegboard,"componentType","pegboard");function applyConstraintFromComponentConstraints({variables:ss,applyComponentConstraint:ts,scales:rs}){let ns={},is=!1;for(let as in ss){let os=ts({variables:{[as]:ss[as]},scales:rs});os.constrained&&(is=!0,ns[as]=os.variables[as])}return is?{constrained:is,variables:ns}:{}}class Constraints extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.baseOnGraph={createTargetComponentNames:!0},ts}static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.independentComponentConstraints={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["independentComponentConstraints"]}}),definition:({dependencyValues:rs})=>({setValue:{independentComponentConstraints:rs.constraintChildren.every(ns=>ns.stateValues.independentComponentConstraints)}})},ts.arrayEntryPrefixForConstraints={returnDependencies:()=>({arrayEntryPrefixForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayEntryPrefixForConstraints"}}),definition:({dependencyValues:rs})=>({setValue:{arrayEntryPrefixForConstraints:rs.arrayEntryPrefixForConstraints}})},ts.arrayVariableForConstraints={returnDependencies:()=>({arrayVariableForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayVariableForConstraints"}}),definition:({dependencyValues:rs})=>({setValue:{arrayVariableForConstraints:rs.arrayVariableForConstraints}})},ts.nDimensions={returnDependencies:()=>({nDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensionsForConstraints"}}),definition({dependencyValues:rs}){return{setValue:{nDimensions:rs.nDimensions}}}},ts.graphComponentName={returnDependencies:()=>({graphComponentName:{dependencyType:"attributeTargetComponentNames",attributeName:"baseOnGraph"}}),definition({dependencyValues:rs}){var ns;return((ns=rs.graphComponentName)==null?void 0:ns.length)===1?{setValue:{graphComponentName:rs.graphComponentName[0].absoluteName}}:{setValue:{graphComponentName:null}}}},ts.scales={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["graphComponentName"],returnDependencies({stateValues:rs}){return rs.graphComponentName?{graph:{dependencyType:"multipleStateVariables",componentName:rs.graphComponentName,variableNames:["xscale","yscale"],variablesOptional:!0}}:{}},definition({dependencyValues:rs}){if(rs.graph){let ns=rs.graph.stateValues,is=[ns.xscale,ns.yscale,1];if(is.every(as=>Number.isFinite(as)&&as>0))return{setValue:{scales:is}}}return{setValue:{scales:[1,1,1]}}}},ts.graphXmin={additionalStateVariablesDefined:["graphXmax","graphYmin","graphYmax"],stateVariablesDeterminingDependencies:["graphComponentName"],returnDependencies({stateValues:rs}){return rs.graphComponentName?{graph:{dependencyType:"multipleStateVariables",componentName:rs.graphComponentName,variableNames:["xmin","xmax","ymin","ymax"],variablesOptional:!0}}:{}},definition({dependencyValues:rs}){if(!rs.graph)return{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}};let ns=rs.graph.stateValues.xmin,is=rs.graph.stateValues.xmax,as=rs.graph.stateValues.ymin,os=rs.graph.stateValues.ymax;return[ns,is,as,os].every(Number.isFinite)?{setValue:{graphXmin:ns,graphXmax:is,graphYmin:as,graphYmax:os}}:{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}}}},ts.constraintResults={additionalStateVariablesDefined:[{variableName:"constraintUsedByComponent",isArray:!0,entryPrefixes:["constraintUsedByComponent"]}],isArray:!0,entryPrefixes:["constraintResult"],stateVariablesDeterminingDependencies:["independentComponentConstraints","arrayEntryPrefixForConstraints","arrayVariableForConstraints"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:rs}){return[rs.nDimensions]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},scales:{dependencyType:"stateVariable",variableName:"scales"}},as=ns.arrayEntryPrefixForConstraints,os={};if(ns.independentComponentConstraints)for(let ls of rs)os[ls]={x:{dependencyType:"parentStateVariable",variableName:as+(Number(ls)+1)}};else{let ls=ns.arrayVariableForConstraints?ns.arrayVariableForConstraints:"__null";is.xs={dependencyType:"parentStateVariable",variableName:ls}}return{globalDependencies:is,dependenciesByKey:os}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is}){if(rs.independentComponentConstraints){let as={},os={};for(let ls of is){let us=Number(ls)+1,cs={["x"+us]:ns[ls].x},ps=!1;for(let ds of rs.constraintChildren){let fs=ds.stateValues.applyComponentConstraint({variables:cs,scales:rs.scales});fs.constrained&&(cs["x"+us]=convertValueToMathExpression(fs.variables["x"+us]),ps=!0)}as[ls]=cs["x"+us],os[ls]=ps}return{setValue:{constraintResults:as,constraintUsedByComponent:os}}}else{let as={},os=!1;for(let cs in rs.xs)as[`x${Number(cs)+1}`]=rs.xs[cs];for(let cs of rs.constraintChildren){let ps;if(cs.stateValues.applyConstraint?ps=cs.stateValues.applyConstraint({variables:as,scales:rs.scales}):ps=applyConstraintFromComponentConstraints({variables:as,applyComponentConstraint:cs.stateValues.applyComponentConstraint,scales:rs.scales}),ps.constrained){for(let ds in ps.variables)as[ds]=convertValueToMathExpression(ps.variables[ds]);os=!0}}let ls={},us={};for(let cs in rs.xs)ls[cs]=as[`x${Number(cs)+1}`],us[cs]=os;return{setValue:{constraintResults:ls,constraintUsedByComponent:us}}}},inverseArrayDefinitionByKey:async function({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,stateValues:os,workspace:ls}){if(ns.independentComponentConstraints){let us=[];for(let cs in rs.constraintResults){let ps=Number(cs)+1,ds={["x"+ps]:convertValueToMathExpression(rs.constraintResults[cs])};for(let fs of ns.constraintChildren){let hs=fs.stateValues.applyComponentConstraint({variables:ds,scales:ns.scales});hs.constrained&&(ds["x"+ps]=convertValueToMathExpression(hs.variables["x"+ps]))}us.push({setDependency:as[cs].x,desiredValue:ds["x"+ps]})}return{success:!0,instructions:us}}else{let us={};ls.desiredConstraintResults||(ls.desiredConstraintResults={}),Object.assign(ls.desiredConstraintResults,rs.constraintResults);let cs=await os.constraintResults;for(let ds in cs){let fs=Number(ds)+1;ds in ls.desiredConstraintResults?us["x"+fs]=convertValueToMathExpression(ls.desiredConstraintResults[ds]):us["x"+fs]=convertValueToMathExpression(cs[ds])}for(let ds of ns.constraintChildren){let fs;if(ds.stateValues.applyConstraint?fs=ds.stateValues.applyConstraint({variables:us,scales:ns.scales}):fs=applyConstraintFromComponentConstraints({variables:us,applyComponentConstraint:ds.stateValues.applyComponentConstraint,scales:ns.scales}),fs.constrained)for(let hs in fs.variables)us[hs]=convertValueToMathExpression(fs.variables[hs])}let ps={};for(let ds in ls.desiredConstraintResults)ps[ds]=us[`x${Number(ds)+1}`];return{success:!0,instructions:[{setDependency:"xs",desiredValue:ps}]}}}},ts.constraintUsed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({constraintUsedByComponent:{dependencyType:"stateVariable",variableName:"constraintUsedByComponent"}}),definition:function({dependencyValues:rs}){return{setValue:{constraintUsed:Object.values(rs.constraintUsedByComponent).some(is=>is)}}}},ts}}Ms(Constraints,"componentType","constraints"),Ms(Constraints,"rendererType");class ConstraintComponent extends BaseComponent{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!1}})},ts}}Ms(ConstraintComponent,"componentType","_constraint"),Ms(ConstraintComponent,"rendererType");class ConstrainToGrid extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},ts.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},ts.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},ts.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},ts.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},ts.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},ts.ignoreGraphBounds={createComponentOfType:"boolean",createStateVariable:"ignoreGraphBounds",defaultValue:!1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!0}})},ts.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},constraintAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin","graphXmax","graphYmin","graphYmax"]},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]},ignoreGraphBounds:{dependencyType:"stateVariable",variableName:"ignoreGraphBounds"}}),definition:({dependencyValues:rs})=>({setValue:{applyComponentConstraint:function({variables:ns,scales:is}){let as;if(rs.constraintAncestor!==null&&rs.constraintAncestor.stateValues.graphXmin!==null?as="constraints":rs.graphAncestor!==null&&rs.graphAncestor.stateValues.xmin!==null&&(as="graph"),"x1"in ns){let os=findFiniteNumericalValue(ns.x1);if(!Number.isFinite(os))return{};let ls=rs.dx,us=rs.xoffset,cs=Math.round((os-us)/ls)*ls+us;if(Number.isFinite(cs)){if(!rs.ignoreGraphBounds){let ps,ds;as==="constraints"?(ps=rs.constraintAncestor.stateValues.graphXmin,ds=rs.constraintAncestor.stateValues.graphXmax):as==="graph"&&(ps=rs.graphAncestor.stateValues.xmin,ds=rs.graphAncestor.stateValues.xmax),ps!==void 0&&(cs<ps?cs=Math.ceil((ps-us)/ls)*ls+us:cs>ds&&(cs=Math.floor((ds-us)/ls)*ls+us))}return{constrained:!0,variables:{x1:cs}}}else return{}}if("x2"in ns){let os=findFiniteNumericalValue(ns.x2);if(!Number.isFinite(os))return{};let ls=rs.dy,us=rs.yoffset,cs=Math.round((os-us)/ls)*ls+us;if(Number.isFinite(cs)){if(!rs.ignoreGraphBounds){let ps,ds;as==="constraints"?(ps=rs.constraintAncestor.stateValues.graphYmin,ds=rs.constraintAncestor.stateValues.graphYmax):as==="graph"&&(ps=rs.graphAncestor.stateValues.ymin,ds=rs.graphAncestor.stateValues.ymax),ps!==void 0&&(cs<ps?cs=Math.ceil((ps-us)/ls)*ls+us:cs>ds&&(cs=Math.floor((ds-us)/ls)*ls+us))}return{constrained:!0,variables:{x2:cs}}}else return{}}if("x3"in ns){let os=findFiniteNumericalValue(ns.x3);if(!Number.isFinite(os))return{};let ls=rs.dz,us=rs.zoffset,cs=Math.round((os-us)/ls)*ls+us;return Number.isFinite(cs)?{constrained:!0,variables:{x3:cs}}:{}}return{}}}})},ts}}Ms(ConstrainToGrid,"componentType","constrainToGrid");class ConstrainToGraph extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.buffer={createComponentOfType:"number",createStateVariable:"buffer",defaultValue:.01,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!0}})},ts.applyComponentConstraint={returnDependencies:()=>({constraintAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin","graphXmax","graphYmin","graphYmax"]},buffer:{dependencyType:"stateVariable",variableName:"buffer"},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]}}),definition:({dependencyValues:rs})=>({setValue:{applyComponentConstraint:function({variables:ns,scales:is}){let as;if(rs.constraintAncestor!==null&&rs.constraintAncestor.stateValues.graphXmin!==null?as="constraints":rs.graphAncestor!==null&&rs.graphAncestor.stateValues.xmin!==null&&(as="graph"),!as)return{};if("x1"in ns){let os=findFiniteNumericalValue(ns.x1);if(!Number.isFinite(os))return{};let ls,us;if(as==="constraints"?(ls=rs.constraintAncestor.stateValues.graphXmin,us=rs.constraintAncestor.stateValues.graphXmax):(ls=rs.graphAncestor.stateValues.xmin,us=rs.graphAncestor.stateValues.xmax),!(Number.isFinite(ls)&&Number.isFinite(us)))return{};let cs=ls,ps=us,ds=rs.buffer;if(ds>0){let hs=ds*(us-ls);cs+=hs,ps-=hs}return{constrained:!0,variables:{x1:Math.max(cs,Math.min(ps,os))}}}if("x2"in ns){let os=findFiniteNumericalValue(ns.x2);if(!Number.isFinite(os))return{};let ls,us;if(as==="constraints"?(ls=rs.constraintAncestor.stateValues.graphYmin,us=rs.constraintAncestor.stateValues.graphYmax):(ls=rs.graphAncestor.stateValues.ymin,us=rs.graphAncestor.stateValues.ymax),!(Number.isFinite(ls)&&Number.isFinite(us)))return{};let cs=ls,ps=us,ds=rs.buffer;if(ds>0){let hs=ds*(us-ls);cs+=hs,ps-=hs}return{constrained:!0,variables:{x2:Math.max(cs,Math.min(ps,os))}}}return{}}}})},ts}}Ms(ConstrainToGraph,"componentType","constrainToGraph");class AttractToGrid extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},ts.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},ts.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},ts.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},ts.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},ts.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},ts.xthreshold={createComponentOfType:"number",createStateVariable:"xthreshold",defaultValue:.2,public:!0},ts.ythreshold={createComponentOfType:"number",createStateVariable:"ythreshold",defaultValue:.2,public:!0},ts.zthreshold={createComponentOfType:"number",createStateVariable:"zthreshold",defaultValue:.2,public:!0},ts.includeGridlines={createComponentOfType:"boolean",createStateVariable:"includeGridlines",defaultValue:!1,public:!0},ts.ignoreGraphBounds={createComponentOfType:"boolean",createStateVariable:"ignoreGraphBounds",defaultValue:!1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.independentComponentConstraints={returnDependencies:()=>({includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"}}),definition:({dependencyValues:rs})=>({setValue:{independentComponentConstraints:rs.includeGridlines}})},ts.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"},constraintAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin","graphXmax","graphYmin","graphYmax"]},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]},ignoreGraphBounds:{dependencyType:"stateVariable",variableName:"ignoreGraphBounds"}}),definition:({dependencyValues:rs})=>({setValue:{applyComponentConstraint:function({variables:ns,scales:is}){let as;if(rs.constraintAncestor!==null&&rs.constraintAncestor.stateValues.graphXmin!==null?as="constraints":rs.graphAncestor!==null&&rs.graphAncestor.stateValues.xmin!==null&&(as="graph"),"x1"in ns){let os=findFiniteNumericalValue(ns.x1);if(!Number.isFinite(os))return{};let ls=rs.dx,us=rs.xoffset,cs=Math.round((os-us)/ls)*ls+us;if(!Number.isFinite(cs))return{};if(!rs.ignoreGraphBounds){let ps,ds;as==="constraints"?(ps=rs.constraintAncestor.stateValues.graphXmin,ds=rs.constraintAncestor.stateValues.graphXmax):as==="graph"&&(ps=rs.graphAncestor.stateValues.xmin,ds=rs.graphAncestor.stateValues.xmax),ps!==void 0&&(cs<ps?cs=Math.ceil((ps-us)/ls)*ls+us:cs>ds&&(cs=Math.floor((ds-us)/ls)*ls+us))}return Math.abs(os-cs)<rs.xthreshold?{constrained:!0,variables:{x1:cs}}:{}}if("x2"in ns){let os=findFiniteNumericalValue(ns.x2);if(!Number.isFinite(os))return{};let ls=rs.dy,us=rs.yoffset,cs=Math.round((os-us)/ls)*ls+us;if(!Number.isFinite(cs))return{};if(!rs.ignoreGraphBounds){let ps,ds;as==="constraints"?(ps=rs.constraintAncestor.stateValues.graphYmin,ds=rs.constraintAncestor.stateValues.graphYmax):as==="graph"&&(ps=rs.graphAncestor.stateValues.ymin,ds=rs.graphAncestor.stateValues.ymax),ps!==void 0&&(cs<ps?cs=Math.ceil((ps-us)/ls)*ls+us:cs>ds&&(cs=Math.floor((ds-us)/ls)*ls+us))}return Math.abs(os-cs)<rs.ythreshold?{constrained:!0,variables:{x2:cs}}:{}}if("x3"in ns){let os=findFiniteNumericalValue(ns.x3);if(!Number.isFinite(os))return{};let ls=rs.dz,us=rs.zoffset,cs=Math.round((os-us)/ls)*ls+us;return Number.isFinite(cs)&&Math.abs(os-cs)<rs.zthreshold?{constrained:!0,variables:{x3:cs}}:{}}return{}}}})},ts.applyConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"},includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"},applyComponentConstraint:{dependencyType:"stateVariable",variableName:"applyComponentConstraint"}}),definition:({dependencyValues:rs})=>({setValue:{applyConstraint:function({variables:ns,scales:is}){let as={},os=!1;for(let ls in ns){let us=rs.applyComponentConstraint({variables:{[ls]:ns[ls]},scales:is});us.constrained&&(os=!0,as[ls]=us.variables[ls])}if(!os)return{};if(!rs.includeGridlines){if(ns.x1!==void 0&&as.x1===void 0)return{};if(ns.x2!==void 0&&as.x2===void 0)return{};if(ns.x3!==void 0&&as.x3===void 0)return{}}return{constrained:os,variables:as}}}})},ts}}Ms(AttractToGrid,"componentType","attractToGrid");class ConstrainTo extends ConstraintComponent{static returnChildGroups(){return[{group:"graphical",componentTypes:["_graphical"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childGroups:["graphical"],variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let is of rs.graphicalChildren){if(!is.stateValues.nearestPoint){console.warn(`cannot attract to ${is.componentName} as it doesn't have a nearestPoint state variable`);continue}ns.push(is.stateValues.nearestPoint)}return{setValue:{nearestPointFunctions:ns}}}},ts.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"}}),definition:({dependencyValues:rs})=>({setValue:{applyConstraint:function({variables:ns,scales:is}){let as=1/0,os={},ls=!1,us={};for(let cs in ns)us[cs]=findFiniteNumericalValue(ns[cs]);for(let cs of rs.nearestPointFunctions){let ps=cs({variables:ns,scales:is});if(ps===void 0)continue;let ds={},fs=0;if(us.x1!==void 0){if(ps.x1===void 0)continue;ds.x1=ps.x1,fs+=Math.pow(us.x1-ps.x1,2)}if(us.x2!==void 0){if(ps.x2===void 0)continue;ds.x2=ps.x2,fs+=Math.pow(us.x2-ps.x2,2)}if(us.x3!==void 0){if(ps.x3===void 0)continue;ds.x3=ps.x3,fs+=Math.pow(us.x3-ps.x3,2)}fs<as&&(os=ds,as=fs,ls=!0)}return ls?{constrained:ls,variables:os}:{}}}})},ts}}Ms(ConstrainTo,"componentType","constrainTo");class AttractTo extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.threshold={createComponentOfType:"number"},ts}static returnChildGroups(){return[{group:"graphical",componentTypes:["_graphical"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.threshold={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,returnDependencies:()=>({thresholdAttr:{dependencyType:"attributeComponent",attributeName:"threshold",variableNames:["value"]},constraintsAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin"]}}),definition({dependencyValues:rs}){if(rs.thresholdAttr)return{setValue:{threshold:rs.thresholdAttr.stateValues.value}};{let ns=.02;return(rs.constraintsAncestor===null||rs.constraintsAncestor.stateValues.graphXmin===null)&&(ns=.5),{useEssentialOrDefaultValue:{threshold:{defaultValue:ns}}}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.thresholdAttr?{success:!0,instructions:[{setDependency:"thresholdAttr",desiredValue:rs.threshold}]}:{success:!0,instructions:[{setEssentialValue:"threshold",value:rs.threshold}]}}},ts.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childGroups:["graphical"],variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let is of rs.graphicalChildren){if(!is.stateValues.nearestPoint){console.warn(`cannot attract to ${is.componentName} as it doesn't have a nearestPoint state variable`);continue}ns.push(is.stateValues.nearestPoint)}return{setValue:{nearestPointFunctions:ns}}}},ts.graphXscale={additionalStateVariablesDefined:["graphYscale"],returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["scales"]}}),definition({dependencyValues:rs}){if(!rs.graphAncestor)return{setValue:{graphXscale:null,graphYscale:null}};let ns=rs.graphAncestor.stateValues.xscale,is=rs.graphAncestor.stateValues.yscale;return{setValue:{graphXscale:ns,graphYscale:is}}}},ts.applyConstraint={returnDependencies(){return{nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"},threshold:{dependencyType:"stateVariable",variableName:"threshold"},constraintsAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["scales"]}}},definition({dependencyValues:rs}){let ns=1,is=1;return rs.constraintsAncestor&&([ns,is]=rs.constraintsAncestor.stateValues.scales),{setValue:{applyConstraint:function({variables:as,scales:os}){let ls=1/0,us={},cs={};for(let ps in as)cs[ps]=findFiniteNumericalValue(as[ps]);for(let ps of rs.nearestPointFunctions){let ds=ps({variables:as,scales:os});if(ds===void 0)continue;let fs={},hs=0;if(cs.x1!==void 0){if(ds.x1===void 0)continue;fs.x1=ds.x1,hs+=Math.pow((cs.x1-ds.x1)/ns,2)}if(cs.x2!==void 0){if(ds.x2===void 0)continue;fs.x2=ds.x2,hs+=Math.pow((cs.x2-ds.x2)/is,2)}if(cs.x3!==void 0){if(ds.x3===void 0)continue;fs.x3=ds.x3,hs+=Math.pow(cs.x3-ds.x3,2)}hs<ls&&(us=fs,ls=hs)}return ls>rs.threshold*rs.threshold?{}:{constrained:!0,variables:us}}}}}},ts}}Ms(AttractTo,"componentType","attractTo");class ConstraintUnion extends ConstraintComponent{static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.applyConstraint={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0}}),definition:({dependencyValues:rs})=>({setValue:{applyConstraint:function({variables:ns,scales:is}){let as;if(rs.constraintChildren.length===1){let cs=rs.constraintChildren[0];return cs.stateValues.applyConstraint?as=cs.stateValues.applyConstraint({variables:ns,scales:is}):as=applyConstraintFromComponentConstraints({variables:ns,applyComponentConstraint:cs.stateValues.applyComponentConstraint,scales:is}),as}let os=1/0,ls={},us;for(let[cs,ps]of rs.constraintChildren.entries()){if(ps.stateValues.applyConstraint?as=ps.stateValues.applyConstraint({variables:ns,scales:is}):as=applyConstraintFromComponentConstraints({variables:ns,applyComponentConstraint:ps.stateValues.applyComponentConstraint,scales:is}),!as.constrained)continue;let ds=0;for(let fs in as.variables){let hs=findFiniteNumericalValue(ns[fs]),ys=findFiniteNumericalValue(as.variables[fs]);if(!Number.isFinite(hs)||!Number.isFinite(ys)){ds=1/0;break}ds+=Math.pow(hs-ys,2)}ds<os&&(ls=as,us=cs+1,os=ds)}return us===void 0?{}:(ls.constraintIndices===void 0?ls.constraintIndices=[us]:ls.constraintIndices=[us,...ls.constraintIndices],ls)}}})},ts}}Ms(ConstraintUnion,"componentType","constraintUnion");class AttractToConstraint extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.5,public:!0},ts}static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.applyConstraint={returnDependencies:()=>({constraintChild:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:rs})=>({setValue:{applyConstraint:function({variables:ns,scales:is}){let as,os=rs.constraintChild[0];if(!os)return{};os.stateValues.applyConstraint?as=os.stateValues.applyConstraint({variables:ns,scales:is}):as=applyConstraintFromComponentConstraints({variables:ns,applyComponentConstraint:os.stateValues.applyComponentConstraint,scales:is});let ls=0;for(let us in as.variables){let cs=findFiniteNumericalValue(ns[us]),ps=findFiniteNumericalValue(as.variables[us]);if(!Number.isFinite(cs)||!Number.isFinite(ps))return{};ls+=Math.pow(cs-ps,2)}return ls>rs.threshold*rs.threshold?{}:as}}})},ts}}Ms(AttractToConstraint,"componentType","attractToConstraint");class Intersection extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts}static returnChildGroups(){return[{group:"lines",componentTypes:["line"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.lineChildren={returnDependencies:()=>({lineChildren:{dependencyType:"child",childGroups:["lines"],variableNames:["numericalCoeff0","numericalCoeffvar1","numericalCoeffvar2","nDimensions"]}}),definition:({dependencyValues:rs})=>({setValue:{lineChildren:rs.lineChildren}})},ts.readyToExpandWhenResolved={returnDependencies:()=>({lineChildren:{dependencyType:"stateVariable",variableName:"lineChildren"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns}){var xs,As,ws;let is=await ts.stateValues.lineChildren,as=is.length;if(as===0)return{replacements:[]};if(as===1){let Es=is[0].componentName,Ss=await rs[Es].serialize({sourceAttributesToIgnoreRecursively:["isResponse"]});Ss.state||(Ss.state={}),Ss.state.draggable=!1,Ss.state.fixed=!0;let Ds=postProcessCopy({serializedComponents:[Ss],componentName:ts.componentName}),Vs=(xs=ts.attributes.newNamespace)==null?void 0:xs.primitive;return Ds=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:Ds,parentName:ts.componentName,parentCreatesNewNamespace:Vs,componentInfoObjects:ns}).serializedComponents,{replacements:Ds}}if(as>2)return console.warn("Haven't implemented intersection for more than two objects"),{replacements:[]};let os=is[0],ls=is[1];if(os.stateValues.nDimensions!==2||ls.stateValues.nDimensions!==2)return console.log("Intersection of lines implemented only in 2D"),{replacements:[]};let us=os.stateValues.numericalCoeffvar1,cs=os.stateValues.numericalCoeffvar2,ps=os.stateValues.numericalCoeff0,ds=ls.stateValues.numericalCoeffvar1,fs=ls.stateValues.numericalCoeffvar2,hs=ls.stateValues.numericalCoeff0;if(!(Number.isFinite(us)&&Number.isFinite(cs)&&Number.isFinite(ps)&&Number.isFinite(ds)&&Number.isFinite(fs)&&Number.isFinite(hs)))return console.log("Intersection of lines implemented only for constant coefficients"),{replacements:[]};let ys=us*fs-ds*cs;if(Math.abs(ys)<1e-14){if(Math.abs(hs*us-ps*ds)>1e-14)return{replacements:[]};if(us===0&&cs===0&&ps===0||ds===0&&fs===0&&hs===0)return{replacements:[]};{let Es=is[0].componentName,Ss=await rs[Es].serialize({sourceAttributesToIgnoreRecursively:["isResponse"]});Ss.state||(Ss.state={}),Ss.state.draggable=!1,Ss.state.fixed=!0;let Ds=postProcessCopy({serializedComponents:[Ss],componentName:ts.componentName}),Vs=(As=ts.attributes.newNamespace)==null?void 0:As.primitive;return Ds=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:Ds,parentName:ts.componentName,parentCreatesNewNamespace:Vs,componentInfoObjects:ns}).serializedComponents,{replacements:Ds}}}let gs=(hs*cs-ps*fs)/ys,bs=(ps*ds-hs*us)/ys,Ns=[{componentType:"point",state:{coords:Context.fromAst(["vector",gs,bs]),draggable:!1,fixed:!0}}],Ts=(ws=ts.attributes.newNamespace)==null?void 0:ws.primitive;return Ns=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:Ns,parentName:ts.componentName,parentCreatesNewNamespace:Ts,componentInfoObjects:ns}).serializedComponents,{replacements:Ns}}static async calculateReplacementChanges({component:ts,components:rs,componentInfoObjects:ns}){let is=[],as=(await this.createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns})).replacements,os=as.length,ls=!0;if(os===ts.replacements.length){ls=!1;for(let cs=0;cs<os;cs++){if(as[cs].componentType!==ts.replacements[cs].componentType){ls=!0;break}if(as[cs].state===void 0){console.warn("No state by which to update intersection component, so recreating"),ls=!0;break}if(as[cs].componentType!=="point"){console.warn(`Have not implemented state changes for an intersection that results in a  ${as[cs].componentType}, so recreating`),ls=!0;break}let ps={changeType:"updateStateVariables",component:ts.replacements[cs],stateChanges:{coords:as[cs].state.coords}};is.push(ps)}}return ls===!1?is:[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:as}]}}Ms(Intersection,"componentType","intersection"),Ms(Intersection,"assignNamesToReplacements",!0),Ms(Intersection,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class Panel extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.columns={createComponentOfType:"text",createStateVariable:"columns",defaultValue:null,public:!0},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.breakpoints={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["width"]},columns:{dependencyType:"stateVariable",variableName:"columns"}}),definition:function({dependencyValues:rs}){let ns=[],is=rs.children.map(as=>as.stateValues.width);if(rs.columns!==null){let as;if(rs.columns.indexOf(",")!==-1)as=rs.columns.split(",").map(Number);else if(rs.columns.indexOf("-")!==-1){let[cs,ps]=rs.columns.split("-");as=[];for(let ds=Number(cs);ds<=ps;ds++)as.push(ds)}else as=[Number(rs.columns)];let os={},ls={};for(let cs of as){let ps=[],ds=0;for(let fs=0;fs<cs;fs++){let hs=-1;for(let ys=fs;ys<is.length;ys=ys+cs)is[ys]>hs&&(hs=is[ys]);ps.push(hs),ds=ds+Number(hs)}os[cs]=ps,ls[cs]=ds}let us=-1;for(let cs of as){let ps=Number.POSITIVE_INFINITY,ds=-1;for(let fs of as)ls[fs]<=ps&&fs>us&&(ps=ls[fs],ds=fs);ps<Number.POSITIVE_INFINITY&&(ns.push({breakpoint:ps,possibleColumnNumbers:ds,arrayOfWidths:os[ds]}),us=ds)}}return{setValue:{breakpoints:ns}}}},ts}}Ms(Panel,"componentType","panel"),Ms(Panel,"rendererType","containerInline"),Ms(Panel,"renderChildren",!0);class ConstrainToAngles extends ConstraintComponent{static returnChildLogic(ts){let rs=super.returnChildLogic(ts),ns=function({activeChildrenMatched:ds}){let fs=[];for(let hs of ds)fs.push({createdComponent:!0,componentName:hs.componentName});return{success:!0,newChildren:[{componentType:"angles",children:fs}]}},is=rs.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:ns}),as=rs.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),os=rs.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),ls=rs.newOperator({name:"StringsAndMaths",operator:"or",propositions:[as,os],requireConsecutive:!0,isSugar:!0,replacementFunction:ns}),us=rs.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),cs=rs.newOperator({name:"Angles",operator:"xor",propositions:[is,ls,us],setAsBase:!0}),ps=rs.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return rs.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[cs,ps],setAsBase:!0}),rs}updateState(ts={}){if(super.updateState(ts),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let rs=this.currentTracker.trackChanges,ns=rs.childrenChanged(this.componentName);if(ns){let is=this.childLogic.returnMatches("AtMostOneAngles");is.length===1?this.state.anglesChild=this.activeChildren[is[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let as=this.childLogic.returnMatches("AtMostOnePoint");as.length===1?this.state.pointChild=this.activeChildren[as[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(ns||rs.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(ns||rs.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let is=0;is<this.state.pointChild.state.ndimensions;is++){let as=this.state.pointChild.state.xs[is].evaluate_to_constant();if(!Number.isFinite(as)){this.state.offset=NaN;break}this.state.offset.push(as)}}}}applyTheConstraint({x1:ts,x2:rs,x3:ns,offset:is}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(ts===void 0||rs===void 0||ns!==void 0)return{};if(ts=this.findFiniteNumericalValue(ts),rs=this.findFiniteNumericalValue(rs),!Number.isFinite(ts)||!Number.isFinite(rs))return{};if(is===void 0&&(is=this.state.offset),Number.isNaN(is))return{};let as=ts-is[0],os=rs-is[1],ls=Math.atan2(os,as),us=1/0,cs,ps;for(let[gs,bs]of this.state.angles.entries()){let vs=bs.state.angle.evaluate_to_constant();if(!Number.isFinite(vs))continue;let Ns=Math.abs((vs-ls+Math.PI)%(2*Math.PI)-Math.PI);Ns<us&&(cs=vs,ps=gs,us=Ns)}if(cs===void 0)return{};let ds=Math.sqrt(as*as+os*os),fs=is[0]+ds*Math.cos(cs),hs=is[1]+ds*Math.sin(cs);return{variables:{x1:fs,x2:hs},constraintIndices:[ps+1],constrained:!0}}}Ms(ConstrainToAngles,"componentType","constrainToAngles");class AttractToAngles extends ConstraintComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.3,public:!0},ts}static returnChildLogic(ts){let rs=super.returnChildLogic(ts),ns=function({activeChildrenMatched:ds}){let fs=[];for(let hs of ds)fs.push({createdComponent:!0,componentName:hs.componentName});return{success:!0,newChildren:[{componentType:"angles",children:fs}]}},is=rs.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:ns}),as=rs.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),os=rs.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),ls=rs.newOperator({name:"StringsAndMaths",operator:"or",propositions:[as,os],requireConsecutive:!0,isSugar:!0,replacementFunction:ns}),us=rs.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),cs=rs.newOperator({name:"Angles",operator:"xor",propositions:[is,ls,us],setAsBase:!0}),ps=rs.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return rs.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[cs,ps],setAsBase:!0}),rs}updateState(ts={}){if(super.updateState(ts),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let rs=this.currentTracker.trackChanges,ns=rs.childrenChanged(this.componentName);if(ns){let is=this.childLogic.returnMatches("AtMostOneAngles");is.length===1?this.state.anglesChild=this.activeChildren[is[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let as=this.childLogic.returnMatches("AtMostOnePoint");as.length===1?this.state.pointChild=this.activeChildren[as[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(ns||rs.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(ns||rs.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let is=0;is<this.state.pointChild.state.ndimensions;is++){let as=this.state.pointChild.state.xs[is].evaluate_to_constant();if(!Number.isFinite(as)){this.state.offset=NaN;break}this.state.offset.push(as)}}}}applyTheConstraint({x1:ts,x2:rs,x3:ns,offset:is}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(ts===void 0||rs===void 0||ns!==void 0)return{};if(ts=this.findFiniteNumericalValue(ts),rs=this.findFiniteNumericalValue(rs),!Number.isFinite(ts)||!Number.isFinite(rs))return{};if(is===void 0&&(is=this.state.offset),Number.isNaN(is))return{};let as=ts-is[0],os=rs-is[1],ls=Math.atan2(os,as),us=1/0,cs,ps;for(let[bs,vs]of this.state.angles.entries()){let Ns=vs.state.angle.evaluate_to_constant();if(!Number.isFinite(Ns))continue;let Ts=Math.abs((Ns-ls+Math.PI)%(2*Math.PI)-Math.PI);Ts<us&&(cs=Ns,ps=bs,us=Ts)}if(cs===void 0)return{};let ds=Math.sqrt(as*as+os*os),fs=is[0]+ds*Math.cos(cs),hs=is[1]+ds*Math.sin(cs);return Math.sqrt(Math.pow(fs-ts,2)+Math.pow(hs-rs,2))>=this.state.threshold?{}:{variables:{x1:fs,x2:hs},constraintIndices:[ps+1],constrained:!0}}}Ms(AttractToAngles,"componentType","attractToAngles");class ConditionalContent extends CompositeComponent{static keepChildrenSerialized({serializedComponent:ts,componentInfoObjects:rs}){if(ts.children===void 0)return[];let ns=rs.componentIsSpecifiedType,is=[];for(let[as,os]of ts.children.entries())ns(os,"case")||ns(os,"else")||is.push(as);return is}static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.maximumNumberToShow={createComponentOfType:"number",createStateVariable:"maximumNumberToShow",defaultValue:null,public:!0},ts.condition={createComponentOfType:"boolean"},ts}static returnChildGroups(){return[{group:"cases",componentTypes:["case"]},{group:"elses",componentTypes:["else"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.baseConditionSatisfied={returnDependencies:()=>({conditionAttr:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:rs}){let ns=!0;return rs.conditionAttr&&(ns=rs.conditionAttr.stateValues.value),{setValue:{baseConditionSatisfied:ns}}}},ts.nCases={additionalStateVariablesDefined:["caseChildren"],returnDependencies:()=>({caseChildren:{dependencyType:"child",childGroups:["cases"]}}),definition({dependencyValues:rs}){return{setValue:{caseChildren:rs.caseChildren,nCases:rs.caseChildren.length}}}},ts.elseChild={returnDependencies:()=>({elseChild:{dependencyType:"child",childGroups:["elses"]}}),definition({dependencyValues:rs}){let ns=null;return rs.elseChild.length>0&&(ns=rs.elseChild[0]),{setValue:{elseChild:ns}}}},ts.haveCasesOrElse={returnDependencies:()=>({nCases:{dependencyType:"stateVariable",variableName:"nCases"},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"}}),definition:({dependencyValues:rs})=>({setValue:{haveCasesOrElse:rs.nCases>0||rs.elseChild!==null}})},ts.selectedIndices={returnDependencies:()=>({caseChildren:{dependencyType:"child",childGroups:["cases"],variableNames:["conditionSatisfied"]},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"},maximumNumberToShow:{dependencyType:"stateVariable",variableName:"maximumNumberToShow"}}),definition({dependencyValues:rs}){let ns=[];for(let[is,as]of rs.caseChildren.entries())as.stateValues.conditionSatisfied&&ns.push(is);if(ns.length===0&&rs.elseChild&&ns.push(rs.caseChildren.length),rs.maximumNumberToShow!==null&&ns.length>rs.maximumNumberToShow){let is=Math.max(0,Math.floor(rs.maximumNumberToShow));ns=ns.slice(0,is)}return{setValue:{selectedIndices:ns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({baseConditionSatisfied:{dependencyType:"stateVariable",variableName:"baseConditionSatisfied"},haveCasesOrElse:{dependencyType:"stateVariable",variableName:"haveCasesOrElse"},selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:rs,componentInfoObjects:ns})=>({variantSeed:{dependencyType:"value",value:rs.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(ns.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns}){let is={seed:rs.variantSeed,meta:{createdBy:ns}},as=is.subvariants=[];for(let os of rs.variantDescendants)os.stateValues.isVariantComponent?as.push(os.stateValues.generatedVariantInfo):os.stateValues.generatedVariantInfo&&as.push(...os.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:is}}}},ts}static async createSerializedReplacements({component:ts,components:rs,workspace:ns,componentInfoObjects:is}){let as=await this.getReplacements(ts,rs,is);return ns.previousSelectedIndices=[...await ts.stateValues.selectedIndices],ns.previousBaseConditionSatisfied=await ts.stateValues.baseConditionSatisfied,{replacements:as}}static async getReplacements(ts,rs,ns){var ls;if(!await ts.stateValues.baseConditionSatisfied)return[];let is=[];if(!await ts.stateValues.haveCasesOrElse)is=deepClone(ts.serializedChildren);else{let us=await ts.stateValues.caseChildren;for(let[cs,ps]of(await ts.stateValues.selectedIndices).entries()){let ds,fs,hs;ps<await ts.stateValues.nCases?(ds=us[ps].componentName,hs=createUniqueName("case",`${ts.componentName}|replacement|${ps}`),fs="case"):(ds=(await ts.stateValues.elseChild).componentName,hs=createUniqueName("else",`${ts.componentName}|replacement|${ps}`),fs="else");let ys=ds.lastIndexOf("/");hs=ds.substring(0,ys)+"/"+hs;let bs=deepClone(await rs[ds].state.serializedChildren.value),vs={componentType:fs,state:{rendered:!0},doenetAttributes:Object.assign({},rs[ds].doenetAttributes),children:bs,originalName:hs,variants:{desiredVariant:{seed:ts.sharedParameters.variantSeed+cs.toString()+"|"+ps.toString()}}};rs[ds].attributes.newNamespace&&(vs.attributes={newNamespace:{primitive:!0}}),is.push(vs)}}let as=(ls=ts.attributes.newNamespace)==null?void 0:ls.primitive;return processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:is,parentName:ts.componentName,parentCreatesNewNamespace:as,componentInfoObjects:ns,originalNamesAreConsistent:!0}).serializedComponents}static async calculateReplacementChanges({component:ts,componentChanges:rs,components:ns,workspace:is,componentInfoObjects:as}){let os=await ts.stateValues.selectedIndices,ls=await ts.stateValues.baseConditionSatisfied;if(is.previousSelectedIndices.length===os.length&&is.previousSelectedIndices.every((ds,fs)=>ds===os[fs])){if(is.previousBaseConditionSatisfied===ls)return[];if(ls){if(ts.replacements.length===ts.serializedChildren.length){let ds={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};return is.previousBaseConditionSatisfied=ls,[ds]}}else{let fs={changeType:"changeReplacementsToWithhold",replacementsToWithhold:ts.replacements.length};return is.previousBaseConditionSatisfied=ls,[fs]}}let us=[],cs=await this.getReplacements(ts,ns,as),ps={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:cs,replacementsToWithhold:0};return us.push(ps),is.previousSelectedIndices=[...os],is.previousBaseConditionSatisfied=ls,us}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns,useSubpartVariantRng:!0})}get allPotentialRendererTypes(){let ts=super.allPotentialRendererTypes;if(this.serializedChildren){let rs=this.potentialRendererTypesFromSerializedComponents(this.serializedChildren);for(let ns of rs)ts.includes(ns)||ts.push(ns)}return ts}}Ms(ConditionalContent,"componentType","conditionalContent"),Ms(ConditionalContent,"includeBlankStringChildren",!0),Ms(ConditionalContent,"assignNamesToReplacements",!0),Ms(ConditionalContent,"createsVariants",!0),Ms(ConditionalContent,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class AsList extends InlineComponent{static returnChildGroups(){return[{group:"inline",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let as of rs.inlineChildren)typeof as!="object"?ns.push(as.toString()):typeof as.stateValues.text=="string"?ns.push(as.stateValues.text):ns.push("");return{setValue:{text:ns.join(", ")}}}},ts.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["text","latex"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns=[];for(let as of rs.inlineChildren)typeof as!="object"?ns.push(as.toString()):typeof as.stateValues.latex=="string"?ns.push(as.stateValues.latex):typeof as.stateValues.text=="string"?ns.push(as.stateValues.text):ns.push("");return{setValue:{latex:ns.join(", ")}}}},ts}}Ms(AsList,"componentType","asList"),Ms(AsList,"renderChildren",!0);function normalizeIndex(ss){if(ss!==null&&ss!==""){if(Number.isFinite(Number(ss)))return Number(ss)-1;if(typeof ss=="string")return lettersToNumber(ss)}}function lettersToNumber(ss){ss=ss.toUpperCase();let ts=0,rs=ss.length,ns=rs;for(;(ns-=1)>-1;){let is=ss.charCodeAt(ns)-64;if(is<1||is>26){console.warn("Cannot convert "+ss+" to a number");return}ts+=is*Math.pow(26,rs-1-ns)}return ts--,ts}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class NoSheetWithIdError extends Error{constructor(ts){super(`There's no sheet with id = ${ts}`)}}class NoSheetWithNameError extends Error{constructor(ts){super(`There's no sheet with name '${ts}'`)}}class SheetNameAlreadyTakenError extends Error{constructor(ts){super(`Sheet with name ${ts} already exists`)}}class SheetSizeLimitExceededError extends Error{constructor(){super("Sheet size limit exceeded")}}class NotAFormulaError extends Error{constructor(){super("This is not a formula")}}class InvalidAddressError extends Error{constructor(ts){super(`Address (row = ${ts.row}, col = ${ts.col}) is invalid`)}}class InvalidArgumentsError extends Error{constructor(ts){super(`Invalid arguments, expected ${ts}`)}}class SheetsNotEqual extends Error{constructor(ts,rs){super(`Sheets ${ts} and ${rs} are not equal.`)}}class NamedExpressionNameIsAlreadyTakenError extends Error{constructor(ts){super(`Name of Named Expression '${ts}' is already present`)}}class NamedExpressionNameIsInvalidError extends Error{constructor(ts){super(`Name of Named Expression '${ts}' is invalid`)}}class NamedExpressionDoesNotExistError extends Error{constructor(ts){super(`Named Expression '${ts}' does not exist`)}}class NoOperationToUndoError extends Error{constructor(){super("There is no operation to undo")}}class NoOperationToRedoError extends Error{constructor(){super("There is no operation to redo")}}class NothingToPasteError extends Error{constructor(){super("There is nothing to paste")}}function replacer(ss,ts){switch(typeof ts){case"function":case"symbol":return ts.toString();case"bigint":return"BigInt("+ts.toString()+")";default:return ts instanceof RegExp?"RegExp("+ts.toString()+")":ts}}class UnableToParseError extends Error{constructor(ts){super(`Unable to parse value: ${JSON.stringify(ts,replacer,4)}`)}}class ExpectedValueOfTypeError extends Error{constructor(ts,rs){super(`Expected value of type: ${ts} for config parameter: ${rs}`)}}class ConfigValueEmpty extends Error{constructor(ts){super(`Config parameter ${ts} cannot be empty.`)}}class ConfigValueTooSmallError extends Error{constructor(ts,rs){super(`Config parameter ${ts} should be at least ${rs}`)}}class ConfigValueTooBigError extends Error{constructor(ts,rs){super(`Config parameter ${ts} should be at most ${rs}`)}}class ExpectedOneOfValuesError extends Error{constructor(ts,rs){super(`Expected one of ${ts} for config parameter: ${rs}`)}}class EvaluationSuspendedError extends Error{constructor(){super("Computations are suspended")}}class MissingTranslationError extends Error{constructor(ts){super(`Translation for ${ts} is missing in the translation package you're using.`)}}class ProtectedFunctionTranslationError extends Error{constructor(ts){super(`Cannot register translation for function with id: ${ts}`)}}class LanguageNotRegisteredError extends Error{constructor(){super("Language not registered.")}}class LanguageAlreadyRegisteredError extends Error{constructor(){super("Language already registered.")}}class FunctionPluginValidationError extends Error{static functionNotDeclaredInPlugin(ts,rs){return new FunctionPluginValidationError(`Function with id ${ts} not declared in plugin ${rs}`)}static functionMethodNotFound(ts,rs){return new FunctionPluginValidationError(`Function method ${ts} not found in plugin ${rs}`)}}class ProtectedFunctionError extends Error{static cannotRegisterFunctionWithId(ts){return new ProtectedFunctionError(`Cannot register function with id ${ts}`)}static cannotUnregisterFunctionWithId(ts){return new ProtectedFunctionError(`Cannot unregister function with id ${ts}`)}static cannotUnregisterProtectedPlugin(){return new ProtectedFunctionError("Cannot unregister protected plugin")}}class SourceLocationHasArrayError extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}class TargetLocationHasArrayError extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}class NoRelativeAddressesAllowedError extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}class AliasAlreadyExisting extends Error{constructor(ts,rs){super(`Alias id ${ts} in plugin ${rs} already defined as a function or alias.`)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var ReferenceType;(function(ss){ss.RELATIVE="RELATIVE",ss.ABSOLUTE="ABSOLUTE"})(ReferenceType||(ReferenceType={}));class ColumnAddress{constructor(ts,rs,ns){this.type=ts,this.col=rs,this.sheet=ns}static absolute(ts,rs){return new ColumnAddress(ReferenceType.ABSOLUTE,ts,rs)}static relative(ts,rs){return new ColumnAddress(ReferenceType.RELATIVE,ts,rs)}static compareByAbsoluteAddress(ts){return(rs,ns)=>rs.toSimpleColumnAddress(ts).col-ns.toSimpleColumnAddress(ts).col}isColumnAbsolute(){return this.type===ReferenceType.ABSOLUTE}isColumnRelative(){return this.type===ReferenceType.RELATIVE}isAbsolute(){return this.type===ReferenceType.ABSOLUTE&&this.sheet!==void 0}moved(ts,rs,ns){const is=this.sheet===void 0?void 0:ts;return new ColumnAddress(this.type,this.col+rs,is)}shiftedByColumns(ts){return new ColumnAddress(this.type,this.col+ts,this.sheet)}toSimpleColumnAddress(ts){const rs=absoluteSheetReference(this,ts);let ns=this.col;return this.isColumnRelative()&&(ns=ts.col+this.col),simpleColumnAddress(rs,ns)}shiftRelativeDimensions(ts,rs){const ns=this.isColumnRelative()?this.col+ts:this.col;return new ColumnAddress(this.type,ns,this.sheet)}shiftAbsoluteDimensions(ts,rs){const ns=this.isColumnAbsolute()?this.col+ts:this.col;return new ColumnAddress(this.type,ns,this.sheet)}withSheet(ts){return new ColumnAddress(this.type,this.col,ts)}isInvalid(ts){return this.toSimpleColumnAddress(ts).col<0}hash(ts){const rs=ts&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case ReferenceType.RELATIVE:return`${rs}#COLR${this.col}`;case ReferenceType.ABSOLUTE:return`${rs}#COLA${this.col}`}}unparse(ts){const rs=this.toSimpleColumnAddress(ts);if(invalidSimpleColumnAddress(rs))return;const ns=columnIndexToLabel(rs.col);return`${this.type===ReferenceType.ABSOLUTE?"$":""}${ns}`}exceedsSheetSizeLimits(ts){return this.col>=ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RowAddress{constructor(ts,rs,ns){this.type=ts,this.row=rs,this.sheet=ns}static absolute(ts,rs){return new RowAddress(ReferenceType.ABSOLUTE,ts,rs)}static relative(ts,rs){return new RowAddress(ReferenceType.RELATIVE,ts,rs)}static compareByAbsoluteAddress(ts){return(rs,ns)=>rs.toSimpleRowAddress(ts).row-ns.toSimpleRowAddress(ts).row}isRowAbsolute(){return this.type===ReferenceType.ABSOLUTE}isRowRelative(){return this.type===ReferenceType.RELATIVE}isAbsolute(){return this.type===ReferenceType.ABSOLUTE&&this.sheet!==void 0}moved(ts,rs,ns){const is=this.sheet===void 0?void 0:ts;return new RowAddress(this.type,this.row+ns,is)}shiftedByRows(ts){return new RowAddress(this.type,this.row+ts,this.sheet)}toSimpleRowAddress(ts){const rs=absoluteSheetReference(this,ts);let ns=this.row;return this.isRowRelative()&&(ns=ts.row+this.row),simpleRowAddress(rs,ns)}shiftRelativeDimensions(ts,rs){const ns=this.isRowRelative()?this.row+rs:this.row;return new RowAddress(this.type,ns,this.sheet)}shiftAbsoluteDimensions(ts,rs){const ns=this.isRowAbsolute()?this.row+rs:this.row;return new RowAddress(this.type,ns,this.sheet)}withSheet(ts){return new RowAddress(this.type,this.row,ts)}isInvalid(ts){return this.toSimpleRowAddress(ts).row<0}hash(ts){const rs=ts&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case ReferenceType.RELATIVE:return`${rs}#ROWR${this.row}`;case ReferenceType.ABSOLUTE:return`${rs}#ROWA${this.row}`}}unparse(ts){const rs=this.toSimpleRowAddress(ts);return invalidSimpleRowAddress(rs)?void 0:`${this.type===ReferenceType.ABSOLUTE?"$":""}${rs.row+1}`}exceedsSheetSizeLimits(ts){return this.row>=ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var CellReferenceType;(function(ss){ss.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",ss.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",ss.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",ss.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"})(CellReferenceType||(CellReferenceType={}));class CellAddress{constructor(ts,rs,ns,is){this.col=ts,this.row=rs,this.type=ns,this.sheet=is}static fromColAndRow(ts,rs,ns){return(ts.isColumnAbsolute()&&rs.isRowAbsolute()?CellAddress.absolute.bind(this):ts.isColumnAbsolute()?CellAddress.absoluteCol.bind(this):rs.isRowAbsolute()?CellAddress.absoluteRow.bind(this):(as,os,ls)=>CellAddress.relative(os,as,ls))(ts.col,rs.row,ns)}static relative(ts,rs,ns){return new CellAddress(rs,ts,CellReferenceType.CELL_REFERENCE_RELATIVE,ns)}static absolute(ts,rs,ns){return new CellAddress(ts,rs,CellReferenceType.CELL_REFERENCE_ABSOLUTE,ns)}static absoluteCol(ts,rs,ns){return new CellAddress(ts,rs,CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL,ns)}static absoluteRow(ts,rs,ns){return new CellAddress(ts,rs,CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW,ns)}toSimpleCellAddress(ts){const rs=absoluteSheetReference(this,ts);return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE?simpleCellAddress(rs,this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?simpleCellAddress(rs,ts.col+this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?simpleCellAddress(rs,this.col,ts.row+this.row):simpleCellAddress(rs,ts.col+this.col,ts.row+this.row)}toColumnAddress(){const ts=this.isColumnRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new ColumnAddress(ts,this.col,this.sheet)}toRowAddress(){const ts=this.isRowRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new RowAddress(ts,this.row,this.sheet)}toSimpleColumnAddress(ts){const rs=absoluteSheetReference(this,ts);let ns=this.col;return this.isColumnRelative()&&(ns+=ts.col),simpleColumnAddress(rs,ns)}toSimpleRowAddress(ts){const rs=absoluteSheetReference(this,ts);let ns=this.row;return this.isRowRelative()&&(ns+=ts.row),simpleRowAddress(rs,ns)}isRowAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE&&this.sheet!==void 0}shiftedByRows(ts){return new CellAddress(this.col,this.row+ts,this.type,this.sheet)}shiftedByColumns(ts){return new CellAddress(this.col+ts,this.row,this.type,this.sheet)}moved(ts,rs,ns){const is=this.sheet===void 0?void 0:ts;return new CellAddress(this.col+rs,this.row+ns,this.type,is)}withSheet(ts){return new CellAddress(this.col,this.row,this.type,ts)}isInvalid(ts){return invalidSimpleCellAddress(this.toSimpleCellAddress(ts))}shiftRelativeDimensions(ts,rs){const ns=this.isColumnAbsolute()?this.col:this.col+ts,is=this.isRowAbsolute()?this.row:this.row+rs;return new CellAddress(ns,is,this.type,this.sheet)}shiftAbsoluteDimensions(ts,rs){const ns=this.isColumnRelative()?this.col:this.col+ts,is=this.isRowRelative()?this.row:this.row+rs;return new CellAddress(ns,is,this.type,this.sheet)}hash(ts){const rs=ts&&this.sheet!==void 0?`#${this.sheet}`:"";switch(this.type){case CellReferenceType.CELL_REFERENCE_RELATIVE:return`${rs}#${this.row}R${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE:return`${rs}#${this.row}A${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL:return`${rs}#${this.row}AC${this.col}`;case CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW:return`${rs}#${this.row}AR${this.col}`}}unparse(ts){const rs=this.toSimpleCellAddress(ts);if(invalidSimpleCellAddress(rs))return;const ns=columnIndexToLabel(rs.col),is=this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${ns}${is}${rs.row+1}`}exceedsSheetSizeLimits(ts,rs){return this.row>=rs||this.col>=ts}}function isEmpty(ss){return ss&&ss.length===0}function keys(ss){return ss==null?[]:Object.keys(ss)}function values(ss){for(var ts=[],rs=Object.keys(ss),ns=0;ns<rs.length;ns++)ts.push(ss[rs[ns]]);return ts}function mapValues(ss,ts){for(var rs=[],ns=keys(ss),is=0;is<ns.length;is++){var as=ns[is];rs.push(ts.call(null,ss[as],as))}return rs}function map(ss,ts){for(var rs=[],ns=0;ns<ss.length;ns++)rs.push(ts.call(null,ss[ns],ns));return rs}function flatten(ss){for(var ts=[],rs=0;rs<ss.length;rs++){var ns=ss[rs];Array.isArray(ns)?ts=ts.concat(flatten(ns)):ts.push(ns)}return ts}function first$1(ss){return isEmpty(ss)?void 0:ss[0]}function last(ss){var ts=ss&&ss.length;return ts?ss[ts-1]:void 0}function forEach$1(ss,ts){if(Array.isArray(ss))for(var rs=0;rs<ss.length;rs++)ts.call(null,ss[rs],rs);else if(isObject$1(ss))for(var ns=keys(ss),rs=0;rs<ns.length;rs++){var is=ns[rs],as=ss[is];ts.call(null,as,is)}else throw Error("non exhaustive match")}function isString$1(ss){return typeof ss=="string"}function isUndefined$1(ss){return ss===void 0}function isFunction$1(ss){return ss instanceof Function}function drop(ss,ts){return ts===void 0&&(ts=1),ss.slice(ts,ss.length)}function dropRight(ss,ts){return ts===void 0&&(ts=1),ss.slice(0,ss.length-ts)}function filter(ss,ts){var rs=[];if(Array.isArray(ss))for(var ns=0;ns<ss.length;ns++){var is=ss[ns];ts.call(null,is)&&rs.push(is)}return rs}function reject(ss,ts){return filter(ss,function(rs){return!ts(rs)})}function pick(ss,ts){for(var rs=Object.keys(ss),ns={},is=0;is<rs.length;is++){var as=rs[is],os=ss[as];ts(os)&&(ns[as]=os)}return ns}function has(ss,ts){return isObject$1(ss)?ss.hasOwnProperty(ts):!1}function contains(ss,ts){return find(ss,function(rs){return rs===ts})!==void 0}function cloneArr(ss){for(var ts=[],rs=0;rs<ss.length;rs++)ts.push(ss[rs]);return ts}function cloneObj(ss){var ts={};for(var rs in ss)Object.prototype.hasOwnProperty.call(ss,rs)&&(ts[rs]=ss[rs]);return ts}function find(ss,ts){for(var rs=0;rs<ss.length;rs++){var ns=ss[rs];if(ts.call(null,ns))return ns}}function findAll(ss,ts){for(var rs=[],ns=0;ns<ss.length;ns++){var is=ss[ns];ts.call(null,is)&&rs.push(is)}return rs}function reduce(ss,ts,rs){for(var ns=Array.isArray(ss),is=ns?ss:values(ss),as=ns?[]:keys(ss),os=rs,ls=0;ls<is.length;ls++)os=ts.call(null,os,is[ls],ns?ls:as[ls]);return os}function compact(ss){return reject(ss,function(ts){return ts==null})}function uniq(ss,ts){ts===void 0&&(ts=function(ns){return ns});var rs=[];return reduce(ss,function(ns,is){var as=ts(is);return contains(rs,as)?ns:(rs.push(as),ns.concat(is))},[])}function isArray$2(ss){return Array.isArray(ss)}function isRegExp(ss){return ss instanceof RegExp}function isObject$1(ss){return ss instanceof Object}function every(ss,ts){for(var rs=0;rs<ss.length;rs++)if(!ts(ss[rs],rs))return!1;return!0}function difference(ss,ts){return reject(ss,function(rs){return contains(ts,rs)})}function some(ss,ts){for(var rs=0;rs<ss.length;rs++)if(ts(ss[rs]))return!0;return!1}function indexOf(ss,ts){for(var rs=0;rs<ss.length;rs++)if(ss[rs]===ts)return rs;return-1}function assign(ss){for(var ts=[],rs=1;rs<arguments.length;rs++)ts[rs-1]=arguments[rs];for(var ns=0;ns<ts.length;ns++)for(var is=ts[ns],as=keys(is),os=0;os<as.length;os++){var ls=as[os];ss[ls]=is[ls]}return ss}function assignNoOverwrite(ss){for(var ts=[],rs=1;rs<arguments.length;rs++)ts[rs-1]=arguments[rs];for(var ns=0;ns<ts.length;ns++){var is=ts[ns];if(!isUndefined$1(is))for(var as=keys(is),os=0;os<as.length;os++){var ls=as[os];has(ss,ls)||(ss[ls]=is[ls])}}return ss}function defaults$4(){for(var ss=[],ts=0;ts<arguments.length;ts++)ss[ts]=arguments[ts];return assignNoOverwrite.apply(null,[{}].concat(ss))}function groupBy(ss,ts){var rs={};return forEach$1(ss,function(ns){var is=ts(ns),as=rs[is];as?as.push(ns):rs[is]=[ns]}),rs}function merge$1(ss,ts){for(var rs=cloneObj(ss),ns=keys(ts),is=0;is<ns.length;is++){var as=ns[is],os=ts[as];rs[as]=os}return rs}function NOOP(){}function IDENTITY(ss){return ss}function packArray(ss){for(var ts=[],rs=0;rs<ss.length;rs++){var ns=ss[rs];ts.push(ns!==void 0?ns:void 0)}return ts}function PRINT_ERROR(ss){console&&console.error&&console.error("Error: "+ss)}function PRINT_WARNING(ss){console&&console.warn&&console.warn("Warning: "+ss)}function isES2015MapSupported(){return typeof Map=="function"}function applyMixins(ss,ts){ts.forEach(function(rs){var ns=rs.prototype;Object.getOwnPropertyNames(ns).forEach(function(is){if(is!=="constructor"){var as=Object.getOwnPropertyDescriptor(ns,is);as&&(as.get||as.set)?Object.defineProperty(ss.prototype,is,as):ss.prototype[is]=rs.prototype[is]}})})}function toFastProperties(ss){function ts(){}ts.prototype=ss;var rs=new ts;function ns(){return typeof rs.bar}return ns(),ns(),ss}function peek(ss){return ss[ss.length-1]}function timer(ss){var ts=new Date().getTime(),rs=ss(),ns=new Date().getTime(),is=ns-ts;return{time:is,value:rs}}var regexpToAstExports={},regexpToAst={get exports(){return regexpToAstExports},set exports(ss){regexpToAstExports=ss}};(function(ss){(function(ts,rs){ss.exports?ss.exports=rs():ts.regexpToAst=rs()})(typeof self<"u"?self:commonjsGlobal,function(){function ts(){}ts.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},ts.prototype.restoreState=function(gs){this.idx=gs.idx,this.input=gs.input,this.groupIdx=gs.groupIdx},ts.prototype.pattern=function(gs){this.idx=0,this.input=gs,this.groupIdx=0,this.consumeChar("/");var bs=this.disjunction();this.consumeChar("/");for(var vs={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":ls(vs,"global");break;case"i":ls(vs,"ignoreCase");break;case"m":ls(vs,"multiLine");break;case"u":ls(vs,"unicode");break;case"y":ls(vs,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:vs,value:bs}},ts.prototype.disjunction=function(){var gs=[];for(gs.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),gs.push(this.alternative());return{type:"Disjunction",value:gs}},ts.prototype.alternative=function(){for(var gs=[];this.isTerm();)gs.push(this.term());return{type:"Alternative",value:gs}},ts.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},ts.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var gs;switch(this.popChar()){case"=":gs="Lookahead";break;case"!":gs="NegativeLookahead";break}us(gs);var bs=this.disjunction();return this.consumeChar(")"),{type:gs,value:bs}}cs()},ts.prototype.quantifier=function(gs){var bs;switch(this.popChar()){case"*":bs={atLeast:0,atMost:1/0};break;case"+":bs={atLeast:1,atMost:1/0};break;case"?":bs={atLeast:0,atMost:1};break;case"{":var vs=this.integerIncludingZero();switch(this.popChar()){case"}":bs={atLeast:vs,atMost:vs};break;case",":var Ns;this.isDigit()?(Ns=this.integerIncludingZero(),bs={atLeast:vs,atMost:Ns}):bs={atLeast:vs,atMost:1/0},this.consumeChar("}");break}if(gs===!0&&bs===void 0)return;us(bs);break}if(!(gs===!0&&bs===void 0))return us(bs),this.peekChar(0)==="?"?(this.consumeChar("?"),bs.greedy=!1):bs.greedy=!0,bs.type="Quantifier",bs},ts.prototype.atom=function(){var gs;switch(this.peekChar()){case".":gs=this.dotAll();break;case"\\":gs=this.atomEscape();break;case"[":gs=this.characterClass();break;case"(":gs=this.group();break}return gs===void 0&&this.isPatternCharacter()&&(gs=this.patternCharacter()),us(gs),this.isQuantifier()&&(gs.quantifier=this.quantifier()),gs},ts.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[as(`
`),as("\r"),as("\u2028"),as("\u2029")]}},ts.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},ts.prototype.decimalEscapeAtom=function(){var gs=this.positiveInteger();return{type:"GroupBackReference",value:gs}},ts.prototype.characterClassEscape=function(){var gs,bs=!1;switch(this.popChar()){case"d":gs=ds;break;case"D":gs=ds,bs=!0;break;case"s":gs=hs;break;case"S":gs=hs,bs=!0;break;case"w":gs=fs;break;case"W":gs=fs,bs=!0;break}return us(gs),{type:"Set",value:gs,complement:bs}},ts.prototype.controlEscapeAtom=function(){var gs;switch(this.popChar()){case"f":gs=as("\f");break;case"n":gs=as(`
`);break;case"r":gs=as("\r");break;case"t":gs=as("	");break;case"v":gs=as("\v");break}return us(gs),{type:"Character",value:gs}},ts.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var gs=this.popChar();if(/[a-zA-Z]/.test(gs)===!1)throw Error("Invalid ");var bs=gs.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:bs}},ts.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:as("\0")}},ts.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},ts.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},ts.prototype.identityEscapeAtom=function(){var gs=this.popChar();return{type:"Character",value:as(gs)}},ts.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var gs=this.popChar();return{type:"Character",value:as(gs)}}},ts.prototype.characterClass=function(){var gs=[],bs=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),bs=!0);this.isClassAtom();){var vs=this.classAtom(),Ns=vs.type==="Character";if(Ns&&this.isRangeDash()){this.consumeChar("-");var Ts=this.classAtom(),Cs=Ts.type==="Character";if(Cs){if(Ts.value<vs.value)throw Error("Range out of order in character class");gs.push({from:vs.value,to:Ts.value})}else os(vs.value,gs),gs.push(as("-")),os(Ts.value,gs)}else os(vs.value,gs)}return this.consumeChar("]"),{type:"Set",complement:bs,value:gs}},ts.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},ts.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:as("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},ts.prototype.group=function(){var gs=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),gs=!1;break;default:this.groupIdx++;break}var bs=this.disjunction();this.consumeChar(")");var vs={type:"Group",capturing:gs,value:bs};return gs&&(vs.idx=this.groupIdx),vs},ts.prototype.positiveInteger=function(){var gs=this.popChar();if(is.test(gs)===!1)throw Error("Expecting a positive integer");for(;ns.test(this.peekChar(0));)gs+=this.popChar();return parseInt(gs,10)},ts.prototype.integerIncludingZero=function(){var gs=this.popChar();if(ns.test(gs)===!1)throw Error("Expecting an integer");for(;ns.test(this.peekChar(0));)gs+=this.popChar();return parseInt(gs,10)},ts.prototype.patternCharacter=function(){var gs=this.popChar();switch(gs){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:as(gs)}}},ts.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},ts.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},ts.prototype.isDigit=function(){return ns.test(this.peekChar(0))},ts.prototype.isClassAtom=function(gs){switch(gs===void 0&&(gs=0),this.peekChar(gs)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},ts.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},ts.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},ts.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},ts.prototype.isQuantifier=function(){var gs=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(gs)}},ts.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},ts.prototype.parseHexDigits=function(gs){for(var bs="",vs=0;vs<gs;vs++){var Ns=this.popChar();if(rs.test(Ns)===!1)throw Error("Expecting a HexDecimal digits");bs+=Ns}var Ts=parseInt(bs,16);return{type:"Character",value:Ts}},ts.prototype.peekChar=function(gs){return gs===void 0&&(gs=0),this.input[this.idx+gs]},ts.prototype.popChar=function(){var gs=this.peekChar(0);return this.consumeChar(),gs},ts.prototype.consumeChar=function(gs){if(gs!==void 0&&this.input[this.idx]!==gs)throw Error("Expected: '"+gs+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var rs=/[0-9a-fA-F]/,ns=/[0-9]/,is=/[1-9]/;function as(gs){return gs.charCodeAt(0)}function os(gs,bs){gs.length!==void 0?gs.forEach(function(vs){bs.push(vs)}):bs.push(gs)}function ls(gs,bs){if(gs[bs]===!0)throw"duplicate flag "+bs;gs[bs]=!0}function us(gs){if(gs===void 0)throw Error("Internal Error - Should never get here!")}function cs(){throw Error("Internal Error - Should never get here!")}var ps,ds=[];for(ps=as("0");ps<=as("9");ps++)ds.push(ps);var fs=[as("_")].concat(ds);for(ps=as("a");ps<=as("z");ps++)fs.push(ps);for(ps=as("A");ps<=as("Z");ps++)fs.push(ps);var hs=[as(" "),as("\f"),as(`
`),as("\r"),as("	"),as("\v"),as("	"),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as(""),as("\u2028"),as("\u2029"),as(""),as(""),as(""),as("\uFEFF")];function ys(){}return ys.prototype.visitChildren=function(gs){for(var bs in gs){var vs=gs[bs];gs.hasOwnProperty(bs)&&(vs.type!==void 0?this.visit(vs):Array.isArray(vs)&&vs.forEach(function(Ns){this.visit(Ns)},this))}},ys.prototype.visit=function(gs){switch(gs.type){case"Pattern":this.visitPattern(gs);break;case"Flags":this.visitFlags(gs);break;case"Disjunction":this.visitDisjunction(gs);break;case"Alternative":this.visitAlternative(gs);break;case"StartAnchor":this.visitStartAnchor(gs);break;case"EndAnchor":this.visitEndAnchor(gs);break;case"WordBoundary":this.visitWordBoundary(gs);break;case"NonWordBoundary":this.visitNonWordBoundary(gs);break;case"Lookahead":this.visitLookahead(gs);break;case"NegativeLookahead":this.visitNegativeLookahead(gs);break;case"Character":this.visitCharacter(gs);break;case"Set":this.visitSet(gs);break;case"Group":this.visitGroup(gs);break;case"GroupBackReference":this.visitGroupBackReference(gs);break;case"Quantifier":this.visitQuantifier(gs);break}this.visitChildren(gs)},ys.prototype.visitPattern=function(gs){},ys.prototype.visitFlags=function(gs){},ys.prototype.visitDisjunction=function(gs){},ys.prototype.visitAlternative=function(gs){},ys.prototype.visitStartAnchor=function(gs){},ys.prototype.visitEndAnchor=function(gs){},ys.prototype.visitWordBoundary=function(gs){},ys.prototype.visitNonWordBoundary=function(gs){},ys.prototype.visitLookahead=function(gs){},ys.prototype.visitNegativeLookahead=function(gs){},ys.prototype.visitCharacter=function(gs){},ys.prototype.visitSet=function(gs){},ys.prototype.visitGroup=function(gs){},ys.prototype.visitGroupBackReference=function(gs){},ys.prototype.visitQuantifier=function(gs){},{RegExpParser:ts,BaseRegExpVisitor:ys,VERSION:"0.4.0"}})})(regexpToAst);var regExpAstCache={},regExpParser=new regexpToAstExports.RegExpParser;function getRegExpAst(ss){var ts=ss.toString();if(regExpAstCache.hasOwnProperty(ts))return regExpAstCache[ts];var rs=regExpParser.pattern(ts);return regExpAstCache[ts]=rs,rs}function clearRegExpParserCache(){regExpAstCache={}}var __extends$a=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),complementErrorMessage="Complement Sets are not supported for first char optimization",failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function getOptimizedStartCodesIndices(ss,ts){ts===void 0&&(ts=!1);try{var rs=getRegExpAst(ss),ns=firstCharOptimizedIndices(rs.value,{},rs.flags.ignoreCase);return ns}catch(as){if(as.message===complementErrorMessage)ts&&PRINT_WARNING(""+failedOptimizationPrefixMsg+("	Unable to optimize: < "+ss.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var is="";ts&&(is=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),PRINT_ERROR(failedOptimizationPrefixMsg+`
`+("	Failed parsing: < "+ss.toString()+` >
`)+("	Using the regexp-to-ast library version: "+regexpToAstExports.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+is)}}return[]}function firstCharOptimizedIndices(ss,ts,rs){switch(ss.type){case"Disjunction":for(var ns=0;ns<ss.value.length;ns++)firstCharOptimizedIndices(ss.value[ns],ts,rs);break;case"Alternative":for(var is=ss.value,ns=0;ns<is.length;ns++){var as=is[ns];switch(as.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var os=as;switch(os.type){case"Character":addOptimizedIdxToResult(os.value,ts,rs);break;case"Set":if(os.complement===!0)throw Error(complementErrorMessage);forEach$1(os.value,function(cs){if(typeof cs=="number")addOptimizedIdxToResult(cs,ts,rs);else{var ps=cs;if(rs===!0)for(var ds=ps.from;ds<=ps.to;ds++)addOptimizedIdxToResult(ds,ts,rs);else{for(var ds=ps.from;ds<=ps.to&&ds<minOptimizationVal;ds++)addOptimizedIdxToResult(ds,ts,rs);if(ps.to>=minOptimizationVal)for(var fs=ps.from>=minOptimizationVal?ps.from:minOptimizationVal,hs=ps.to,ys=charCodeToOptimizedIndex(fs),gs=charCodeToOptimizedIndex(hs),bs=ys;bs<=gs;bs++)ts[bs]=bs}}});break;case"Group":firstCharOptimizedIndices(os.value,ts,rs);break;default:throw Error("Non Exhaustive Match")}var ls=os.quantifier!==void 0&&os.quantifier.atLeast===0;if(os.type==="Group"&&isWholeOptional(os)===!1||os.type!=="Group"&&ls===!1)break}break;default:throw Error("non exhaustive match!")}return values(ts)}function addOptimizedIdxToResult(ss,ts,rs){var ns=charCodeToOptimizedIndex(ss);ts[ns]=ns,rs===!0&&handleIgnoreCase(ss,ts)}function handleIgnoreCase(ss,ts){var rs=String.fromCharCode(ss),ns=rs.toUpperCase();if(ns!==rs){var is=charCodeToOptimizedIndex(ns.charCodeAt(0));ts[is]=is}else{var as=rs.toLowerCase();if(as!==rs){var is=charCodeToOptimizedIndex(as.charCodeAt(0));ts[is]=is}}}function findCode(ss,ts){return find(ss.value,function(rs){if(typeof rs=="number")return contains(ts,rs);var ns=rs;return find(ts,function(is){return ns.from<=is&&is<=ns.to})!==void 0})}function isWholeOptional(ss){return ss.quantifier&&ss.quantifier.atLeast===0?!0:ss.value?isArray$2(ss.value)?every(ss.value,isWholeOptional):isWholeOptional(ss.value):!1}var CharCodeFinder=function(ss){__extends$a(ts,ss);function ts(rs){var ns=ss.call(this)||this;return ns.targetCharCodes=rs,ns.found=!1,ns}return ts.prototype.visitChildren=function(rs){if(this.found!==!0){switch(rs.type){case"Lookahead":this.visitLookahead(rs);return;case"NegativeLookahead":this.visitNegativeLookahead(rs);return}ss.prototype.visitChildren.call(this,rs)}},ts.prototype.visitCharacter=function(rs){contains(this.targetCharCodes,rs.value)&&(this.found=!0)},ts.prototype.visitSet=function(rs){rs.complement?findCode(rs,this.targetCharCodes)===void 0&&(this.found=!0):findCode(rs,this.targetCharCodes)!==void 0&&(this.found=!0)},ts}(regexpToAstExports.BaseRegExpVisitor);function canMatchCharCode(ss,ts){if(ts instanceof RegExp){var rs=getRegExpAst(ts),ns=new CharCodeFinder(ss);return ns.visit(rs),ns.found}else return find(ts,function(is){return contains(ss,is.charCodeAt(0))})!==void 0}var __extends$9=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),PATTERN="PATTERN",DEFAULT_MODE="defaultMode",MODES="modes",SUPPORT_STICKY=typeof new RegExp("(?:)").sticky=="boolean";function analyzeTokenTypes(ss,ts){ts=defaults$4(ts,{useSticky:SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(Ns,Ts){return Ts()}});var rs=ts.tracer;rs("initCharCodeToOptimizedIndexMap",function(){initCharCodeToOptimizedIndexMap()});var ns;rs("Reject Lexer.NA",function(){ns=reject(ss,function(Ns){return Ns[PATTERN]===Lexer.NA})});var is=!1,as;rs("Transform Patterns",function(){is=!1,as=map(ns,function(Ns){var Ts=Ns[PATTERN];if(isRegExp(Ts)){var Cs=Ts.source;return Cs.length===1&&Cs!=="^"&&Cs!=="$"&&Cs!=="."?Cs:Cs.length===2&&Cs[0]==="\\"&&!contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],Cs[1])?Cs[1]:ts.useSticky?addStickyFlag(Ts):addStartOfInput(Ts)}else{if(isFunction$1(Ts))return is=!0,{exec:Ts};if(has(Ts,"exec"))return is=!0,Ts;if(typeof Ts=="string"){if(Ts.length===1)return Ts;var xs=Ts.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),As=new RegExp(xs);return ts.useSticky?addStickyFlag(As):addStartOfInput(As)}else throw Error("non exhaustive match")}})});var os,ls,us,cs,ps;rs("misc mapping",function(){os=map(ns,function(Ns){return Ns.tokenTypeIdx}),ls=map(ns,function(Ns){var Ts=Ns.GROUP;if(Ts!==Lexer.SKIPPED){if(isString$1(Ts))return Ts;if(isUndefined$1(Ts))return!1;throw Error("non exhaustive match")}}),us=map(ns,function(Ns){var Ts=Ns.LONGER_ALT;if(Ts){var Cs=indexOf(ns,Ts);return Cs}}),cs=map(ns,function(Ns){return Ns.PUSH_MODE}),ps=map(ns,function(Ns){return has(Ns,"POP_MODE")})});var ds;rs("Line Terminator Handling",function(){var Ns=getCharCodes(ts.lineTerminatorCharacters);ds=map(ns,function(Ts){return!1}),ts.positionTracking!=="onlyOffset"&&(ds=map(ns,function(Ts){if(has(Ts,"LINE_BREAKS"))return Ts.LINE_BREAKS;if(checkLineBreaksIssues(Ts,Ns)===!1)return canMatchCharCode(Ns,Ts.PATTERN)}))});var fs,hs,ys,gs;rs("Misc Mapping #2",function(){fs=map(ns,isCustomPattern),hs=map(as,isShortPattern),ys=reduce(ns,function(Ns,Ts){var Cs=Ts.GROUP;return isString$1(Cs)&&Cs!==Lexer.SKIPPED&&(Ns[Cs]=[]),Ns},{}),gs=map(as,function(Ns,Ts){return{pattern:as[Ts],longerAlt:us[Ts],canLineTerminator:ds[Ts],isCustom:fs[Ts],short:hs[Ts],group:ls[Ts],push:cs[Ts],pop:ps[Ts],tokenTypeIdx:os[Ts],tokenType:ns[Ts]}})});var bs=!0,vs=[];return ts.safeMode||rs("First Char Optimization",function(){vs=reduce(ns,function(Ns,Ts,Cs){if(typeof Ts.PATTERN=="string"){var xs=Ts.PATTERN.charCodeAt(0),As=charCodeToOptimizedIndex(xs);addToMapOfArrays(Ns,As,gs[Cs])}else if(isArray$2(Ts.START_CHARS_HINT)){var ws;forEach$1(Ts.START_CHARS_HINT,function(Ss){var Ds=typeof Ss=="string"?Ss.charCodeAt(0):Ss,Vs=charCodeToOptimizedIndex(Ds);ws!==Vs&&(ws=Vs,addToMapOfArrays(Ns,Vs,gs[Cs]))})}else if(isRegExp(Ts.PATTERN))if(Ts.PATTERN.unicode)bs=!1,ts.ensureOptimizations&&PRINT_ERROR(""+failedOptimizationPrefixMsg+("	Unable to analyze < "+Ts.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var Es=getOptimizedStartCodesIndices(Ts.PATTERN,ts.ensureOptimizations);isEmpty(Es)&&(bs=!1),forEach$1(Es,function(Ss){addToMapOfArrays(Ns,Ss,gs[Cs])})}else ts.ensureOptimizations&&PRINT_ERROR(""+failedOptimizationPrefixMsg+("	TokenType: <"+Ts.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),bs=!1;return Ns},[])}),rs("ArrayPacking",function(){vs=packArray(vs)}),{emptyGroups:ys,patternIdxToConfig:gs,charCodeToPatternIdxToConfig:vs,hasCustom:is,canBeOptimized:bs}}function validatePatterns(ss,ts){var rs=[],ns=findMissingPatterns(ss);rs=rs.concat(ns.errors);var is=findInvalidPatterns(ns.valid),as=is.valid;return rs=rs.concat(is.errors),rs=rs.concat(validateRegExpPattern(as)),rs=rs.concat(findInvalidGroupType(as)),rs=rs.concat(findModesThatDoNotExist(as,ts)),rs=rs.concat(findUnreachablePatterns(as)),rs}function validateRegExpPattern(ss){var ts=[],rs=filter(ss,function(ns){return isRegExp(ns[PATTERN])});return ts=ts.concat(findEndOfInputAnchor(rs)),ts=ts.concat(findStartOfInputAnchor(rs)),ts=ts.concat(findUnsupportedFlags(rs)),ts=ts.concat(findDuplicatePatterns(rs)),ts=ts.concat(findEmptyMatchRegExps(rs)),ts}function findMissingPatterns(ss){var ts=filter(ss,function(is){return!has(is,PATTERN)}),rs=map(ts,function(is){return{message:"Token Type: ->"+is.name+"<- missing static 'PATTERN' property",type:LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[is]}}),ns=difference(ss,ts);return{errors:rs,valid:ns}}function findInvalidPatterns(ss){var ts=filter(ss,function(is){var as=is[PATTERN];return!isRegExp(as)&&!isFunction$1(as)&&!has(as,"exec")&&!isString$1(as)}),rs=map(ts,function(is){return{message:"Token Type: ->"+is.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[is]}}),ns=difference(ss,ts);return{errors:rs,valid:ns}}var end_of_input=/[^\\][\$]/;function findEndOfInputAnchor(ss){var ts=function(is){__extends$9(as,is);function as(){var os=is!==null&&is.apply(this,arguments)||this;return os.found=!1,os}return as.prototype.visitEndAnchor=function(os){this.found=!0},as}(regexpToAstExports.BaseRegExpVisitor),rs=filter(ss,function(is){var as=is[PATTERN];try{var os=getRegExpAst(as),ls=new ts;return ls.visit(os),ls.found}catch{return end_of_input.test(as.source)}}),ns=map(rs,function(is){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+is.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[is]}});return ns}function findEmptyMatchRegExps(ss){var ts=filter(ss,function(ns){var is=ns[PATTERN];return is.test("")}),rs=map(ts,function(ns){return{message:"Token Type: ->"+ns.name+"<- static 'PATTERN' must not match an empty string",type:LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[ns]}});return rs}var start_of_input=/[^\\[][\^]|^\^/;function findStartOfInputAnchor(ss){var ts=function(is){__extends$9(as,is);function as(){var os=is!==null&&is.apply(this,arguments)||this;return os.found=!1,os}return as.prototype.visitStartAnchor=function(os){this.found=!0},as}(regexpToAstExports.BaseRegExpVisitor),rs=filter(ss,function(is){var as=is[PATTERN];try{var os=getRegExpAst(as),ls=new ts;return ls.visit(os),ls.found}catch{return start_of_input.test(as.source)}}),ns=map(rs,function(is){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+is.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[is]}});return ns}function findUnsupportedFlags(ss){var ts=filter(ss,function(ns){var is=ns[PATTERN];return is instanceof RegExp&&(is.multiline||is.global)}),rs=map(ts,function(ns){return{message:"Token Type: ->"+ns.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[ns]}});return rs}function findDuplicatePatterns(ss){var ts=[],rs=map(ss,function(as){return reduce(ss,function(os,ls){return as.PATTERN.source===ls.PATTERN.source&&!contains(ts,ls)&&ls.PATTERN!==Lexer.NA&&(ts.push(ls),os.push(ls)),os},[])});rs=compact(rs);var ns=filter(rs,function(as){return as.length>1}),is=map(ns,function(as){var os=map(as,function(us){return us.name}),ls=first$1(as).PATTERN;return{message:"The same RegExp pattern ->"+ls+"<-"+("has been used in all of the following Token Types: "+os.join(", ")+" <-"),type:LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:as}});return is}function findInvalidGroupType(ss){var ts=filter(ss,function(ns){if(!has(ns,"GROUP"))return!1;var is=ns.GROUP;return is!==Lexer.SKIPPED&&is!==Lexer.NA&&!isString$1(is)}),rs=map(ts,function(ns){return{message:"Token Type: ->"+ns.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[ns]}});return rs}function findModesThatDoNotExist(ss,ts){var rs=filter(ss,function(is){return is.PUSH_MODE!==void 0&&!contains(ts,is.PUSH_MODE)}),ns=map(rs,function(is){var as="Token Type: ->"+is.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+is.PUSH_MODE+"<-which does not exist";return{message:as,type:LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[is]}});return ns}function findUnreachablePatterns(ss){var ts=[],rs=reduce(ss,function(ns,is,as){var os=is.PATTERN;return os===Lexer.NA||(isString$1(os)?ns.push({str:os,idx:as,tokenType:is}):isRegExp(os)&&noMetaChar(os)&&ns.push({str:os.source,idx:as,tokenType:is})),ns},[]);return forEach$1(ss,function(ns,is){forEach$1(rs,function(as){var os=as.str,ls=as.idx,us=as.tokenType;if(is<ls&&testTokenType(os,ns.PATTERN)){var cs="Token: ->"+us.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+ns.name+"<-")+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;ts.push({message:cs,type:LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[ns,us]})}})}),ts}function testTokenType(ss,ts){if(isRegExp(ts)){var rs=ts.exec(ss);return rs!==null&&rs.index===0}else{if(isFunction$1(ts))return ts(ss,0,[],{});if(has(ts,"exec"))return ts.exec(ss,0,[],{});if(typeof ts=="string")return ts===ss;throw Error("non exhaustive match")}}function noMetaChar(ss){var ts=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return find(ts,function(rs){return ss.source.indexOf(rs)!==-1})===void 0}function addStartOfInput(ss){var ts=ss.ignoreCase?"i":"";return new RegExp("^(?:"+ss.source+")",ts)}function addStickyFlag(ss){var ts=ss.ignoreCase?"iy":"y";return new RegExp(""+ss.source,ts)}function performRuntimeChecks(ss,ts,rs){var ns=[];return has(ss,DEFAULT_MODE)||ns.push({message:"A MultiMode Lexer cannot be initialized without a <"+DEFAULT_MODE+`> property in its definition
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),has(ss,MODES)||ns.push({message:"A MultiMode Lexer cannot be initialized without a <"+MODES+`> property in its definition
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),has(ss,MODES)&&has(ss,DEFAULT_MODE)&&!has(ss.modes,ss.defaultMode)&&ns.push({message:"A MultiMode Lexer cannot be initialized with a "+DEFAULT_MODE+": <"+ss.defaultMode+`>which does not exist
`,type:LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),has(ss,MODES)&&forEach$1(ss.modes,function(is,as){forEach$1(is,function(os,ls){isUndefined$1(os)&&ns.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+as+"> at index: <"+ls+`>
`),type:LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),ns}function performWarningRuntimeChecks(ss,ts,rs){var ns=[],is=!1,as=compact(flatten(mapValues(ss.modes,function(us){return us}))),os=reject(as,function(us){return us[PATTERN]===Lexer.NA}),ls=getCharCodes(rs);return ts&&forEach$1(os,function(us){var cs=checkLineBreaksIssues(us,ls);if(cs!==!1){var ps=buildLineBreakIssueMessage(us,cs),ds={message:ps,type:cs.issue,tokenType:us};ns.push(ds)}else has(us,"LINE_BREAKS")?us.LINE_BREAKS===!0&&(is=!0):canMatchCharCode(ls,us.PATTERN)&&(is=!0)}),ts&&!is&&ns.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),ns}function cloneEmptyGroups(ss){var ts={},rs=keys(ss);return forEach$1(rs,function(ns){var is=ss[ns];if(isArray$2(is))ts[ns]=[];else throw Error("non exhaustive match")}),ts}function isCustomPattern(ss){var ts=ss.PATTERN;if(isRegExp(ts))return!1;if(isFunction$1(ts))return!0;if(has(ts,"exec"))return!0;if(isString$1(ts))return!1;throw Error("non exhaustive match")}function isShortPattern(ss){return isString$1(ss)&&ss.length===1?ss.charCodeAt(0):!1}var LineTerminatorOptimizedTester={test:function(ss){for(var ts=ss.length,rs=this.lastIndex;rs<ts;rs++){var ns=ss.charCodeAt(rs);if(ns===10)return this.lastIndex=rs+1,!0;if(ns===13)return ss.charCodeAt(rs+1)===10?this.lastIndex=rs+2:this.lastIndex=rs+1,!0}return!1},lastIndex:0};function checkLineBreaksIssues(ss,ts){if(has(ss,"LINE_BREAKS"))return!1;if(isRegExp(ss.PATTERN)){try{canMatchCharCode(ts,ss.PATTERN)}catch(rs){return{issue:LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:rs.message}}return!1}else{if(isString$1(ss.PATTERN))return!1;if(isCustomPattern(ss))return{issue:LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function buildLineBreakIssueMessage(ss,ts){if(ts.issue===LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+ss.name+`> Token Type
`)+("	 Root cause: "+ts.errMsg+`.
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(ts.issue===LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+ss.name+`> Token Type
`)+"	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function getCharCodes(ss){var ts=map(ss,function(rs){return isString$1(rs)&&rs.length>0?rs.charCodeAt(0):rs});return ts}function addToMapOfArrays(ss,ts,rs){ss[ts]===void 0?ss[ts]=[rs]:ss[ts].push(rs)}var minOptimizationVal=256;function charCodeToOptimizedIndex(ss){return ss<minOptimizationVal?ss:charCodeToOptimizedIdxMap[ss]}var charCodeToOptimizedIdxMap=[];function initCharCodeToOptimizedIndexMap(){if(isEmpty(charCodeToOptimizedIdxMap)){charCodeToOptimizedIdxMap=new Array(65536);for(var ss=0;ss<65536;ss++)charCodeToOptimizedIdxMap[ss]=ss>255?255+~~(ss/255):ss}}function tokenStructuredMatcher(ss,ts){var rs=ss.tokenTypeIdx;return rs===ts.tokenTypeIdx?!0:ts.isParent===!0&&ts.categoryMatchesMap[rs]===!0}function tokenStructuredMatcherNoCategories(ss,ts){return ss.tokenTypeIdx===ts.tokenTypeIdx}var tokenShortNameIdx=1,tokenIdxToClass={};function augmentTokenTypes(ss){var ts=expandCategories(ss);assignTokenDefaultProps(ts),assignCategoriesMapProp(ts),assignCategoriesTokensProp(ts),forEach$1(ts,function(rs){rs.isParent=rs.categoryMatches.length>0})}function expandCategories(ss){for(var ts=cloneArr(ss),rs=ss,ns=!0;ns;){rs=compact(flatten(map(rs,function(as){return as.CATEGORIES})));var is=difference(rs,ts);ts=ts.concat(is),isEmpty(is)?ns=!1:rs=is}return ts}function assignTokenDefaultProps(ss){forEach$1(ss,function(ts){hasShortKeyProperty(ts)||(tokenIdxToClass[tokenShortNameIdx]=ts,ts.tokenTypeIdx=tokenShortNameIdx++),hasCategoriesProperty(ts)&&!isArray$2(ts.CATEGORIES)&&(ts.CATEGORIES=[ts.CATEGORIES]),hasCategoriesProperty(ts)||(ts.CATEGORIES=[]),hasExtendingTokensTypesProperty(ts)||(ts.categoryMatches=[]),hasExtendingTokensTypesMapProperty(ts)||(ts.categoryMatchesMap={})})}function assignCategoriesTokensProp(ss){forEach$1(ss,function(ts){ts.categoryMatches=[],forEach$1(ts.categoryMatchesMap,function(rs,ns){ts.categoryMatches.push(tokenIdxToClass[ns].tokenTypeIdx)})})}function assignCategoriesMapProp(ss){forEach$1(ss,function(ts){singleAssignCategoriesToksMap([],ts)})}function singleAssignCategoriesToksMap(ss,ts){forEach$1(ss,function(rs){ts.categoryMatchesMap[rs.tokenTypeIdx]=!0}),forEach$1(ts.CATEGORIES,function(rs){var ns=ss.concat(ts);contains(ns,rs)||singleAssignCategoriesToksMap(ns,rs)})}function hasShortKeyProperty(ss){return has(ss,"tokenTypeIdx")}function hasCategoriesProperty(ss){return has(ss,"CATEGORIES")}function hasExtendingTokensTypesProperty(ss){return has(ss,"categoryMatches")}function hasExtendingTokensTypesMapProperty(ss){return has(ss,"categoryMatchesMap")}function isTokenType(ss){return has(ss,"tokenTypeIdx")}var defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(ss){return"Unable to pop Lexer Mode after encountering Token ->"+ss.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(ss,ts,rs,ns,is){return"unexpected character: ->"+ss.charAt(ts)+"<- at offset: "+ts+","+(" skipped "+rs+" characters.")}},LexerDefinitionErrorType;(function(ss){ss[ss.MISSING_PATTERN=0]="MISSING_PATTERN",ss[ss.INVALID_PATTERN=1]="INVALID_PATTERN",ss[ss.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",ss[ss.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",ss[ss.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",ss[ss.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",ss[ss.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",ss[ss.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",ss[ss.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",ss[ss.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",ss[ss.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",ss[ss.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",ss[ss.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",ss[ss.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",ss[ss.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",ss[ss.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",ss[ss.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(LexerDefinitionErrorType||(LexerDefinitionErrorType={}));var DEFAULT_LEXER_CONFIG={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(DEFAULT_LEXER_CONFIG);var Lexer=function(){function ss(ts,rs){var ns=this;if(rs===void 0&&(rs=DEFAULT_LEXER_CONFIG),this.lexerDefinition=ts,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof rs=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=merge$1(DEFAULT_LEXER_CONFIG,rs);var is=this.config.traceInitPerf;is===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof is=="number"&&(this.traceInitMaxIdent=is,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var as,os=!0;ns.TRACE_INIT("Lexer Config handling",function(){if(ns.config.lineTerminatorsPattern===DEFAULT_LEXER_CONFIG.lineTerminatorsPattern)ns.config.lineTerminatorsPattern=LineTerminatorOptimizedTester;else if(ns.config.lineTerminatorCharacters===DEFAULT_LEXER_CONFIG.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(rs.safeMode&&rs.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');ns.trackStartLines=/full|onlyStart/i.test(ns.config.positionTracking),ns.trackEndLines=/full/i.test(ns.config.positionTracking),isArray$2(ts)?(as={modes:{}},as.modes[DEFAULT_MODE]=cloneArr(ts),as[DEFAULT_MODE]=DEFAULT_MODE):(os=!1,as=cloneObj(ts))}),ns.config.skipValidations===!1&&(ns.TRACE_INIT("performRuntimeChecks",function(){ns.lexerDefinitionErrors=ns.lexerDefinitionErrors.concat(performRuntimeChecks(as,ns.trackStartLines,ns.config.lineTerminatorCharacters))}),ns.TRACE_INIT("performWarningRuntimeChecks",function(){ns.lexerDefinitionWarning=ns.lexerDefinitionWarning.concat(performWarningRuntimeChecks(as,ns.trackStartLines,ns.config.lineTerminatorCharacters))})),as.modes=as.modes?as.modes:{},forEach$1(as.modes,function(ps,ds){as.modes[ds]=reject(ps,function(fs){return isUndefined$1(fs)})});var ls=keys(as.modes);if(forEach$1(as.modes,function(ps,ds){ns.TRACE_INIT("Mode: <"+ds+"> processing",function(){if(ns.modes.push(ds),ns.config.skipValidations===!1&&ns.TRACE_INIT("validatePatterns",function(){ns.lexerDefinitionErrors=ns.lexerDefinitionErrors.concat(validatePatterns(ps,ls))}),isEmpty(ns.lexerDefinitionErrors)){augmentTokenTypes(ps);var fs;ns.TRACE_INIT("analyzeTokenTypes",function(){fs=analyzeTokenTypes(ps,{lineTerminatorCharacters:ns.config.lineTerminatorCharacters,positionTracking:rs.positionTracking,ensureOptimizations:rs.ensureOptimizations,safeMode:rs.safeMode,tracer:ns.TRACE_INIT.bind(ns)})}),ns.patternIdxToConfig[ds]=fs.patternIdxToConfig,ns.charCodeToPatternIdxToConfig[ds]=fs.charCodeToPatternIdxToConfig,ns.emptyGroups=merge$1(ns.emptyGroups,fs.emptyGroups),ns.hasCustom=fs.hasCustom||ns.hasCustom,ns.canModeBeOptimized[ds]=fs.canBeOptimized}})}),ns.defaultMode=as.defaultMode,!isEmpty(ns.lexerDefinitionErrors)&&!ns.config.deferDefinitionErrorsHandling){var us=map(ns.lexerDefinitionErrors,function(ps){return ps.message}),cs=us.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+cs)}forEach$1(ns.lexerDefinitionWarning,function(ps){PRINT_WARNING(ps.message)}),ns.TRACE_INIT("Choosing sub-methods implementations",function(){if(SUPPORT_STICKY?(ns.chopInput=IDENTITY,ns.match=ns.matchWithTest):(ns.updateLastIndex=NOOP,ns.match=ns.matchWithExec),os&&(ns.handleModes=NOOP),ns.trackStartLines===!1&&(ns.computeNewColumn=IDENTITY),ns.trackEndLines===!1&&(ns.updateTokenEndLineColumnLocation=NOOP),/full/i.test(ns.config.positionTracking))ns.createTokenInstance=ns.createFullToken;else if(/onlyStart/i.test(ns.config.positionTracking))ns.createTokenInstance=ns.createStartOnlyToken;else if(/onlyOffset/i.test(ns.config.positionTracking))ns.createTokenInstance=ns.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+ns.config.positionTracking+'"');ns.hasCustom?(ns.addToken=ns.addTokenUsingPush,ns.handlePayload=ns.handlePayloadWithCustom):(ns.addToken=ns.addTokenUsingMemberAccess,ns.handlePayload=ns.handlePayloadNoCustom)}),ns.TRACE_INIT("Failed Optimization Warnings",function(){var ps=reduce(ns.canModeBeOptimized,function(ds,fs,hs){return fs===!1&&ds.push(hs),ds},[]);if(rs.ensureOptimizations&&!isEmpty(ps))throw Error("Lexer Modes: < "+ps.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),ns.TRACE_INIT("clearRegExpParserCache",function(){clearRegExpParserCache()}),ns.TRACE_INIT("toFastProperties",function(){toFastProperties(ns)})})}return ss.prototype.tokenize=function(ts,rs){if(rs===void 0&&(rs=this.defaultMode),!isEmpty(this.lexerDefinitionErrors)){var ns=map(this.lexerDefinitionErrors,function(os){return os.message}),is=ns.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+is)}var as=this.tokenizeInternal(ts,rs);return as},ss.prototype.tokenizeInternal=function(ts,rs){var ns=this,is,as,os,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs,Ns=ts,Ts=Ns.length,Cs=0,xs=0,As=this.hasCustom?0:Math.floor(ts.length/10),ws=new Array(As),Es=[],Ss=this.trackStartLines?1:void 0,Ds=this.trackStartLines?1:void 0,Vs=cloneEmptyGroups(this.emptyGroups),Is=this.trackStartLines,Os=this.config.lineTerminatorsPattern,Ps=0,$s=[],Rs=[],ks=[],_s=[];Object.freeze(_s);var Bs=void 0;function Us(){return $s}function zs(Xs){var Ks=charCodeToOptimizedIndex(Xs),ol=Rs[Ks];return ol===void 0?_s:ol}var Hs=function(Xs){if(ks.length===1&&Xs.tokenType.PUSH_MODE===void 0){var Ks=ns.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Xs);Es.push({offset:Xs.startOffset,line:Xs.startLine!==void 0?Xs.startLine:void 0,column:Xs.startColumn!==void 0?Xs.startColumn:void 0,length:Xs.image.length,message:Ks})}else{ks.pop();var ol=last(ks);$s=ns.patternIdxToConfig[ol],Rs=ns.charCodeToPatternIdxToConfig[ol],Ps=$s.length;var Fs=ns.canModeBeOptimized[ol]&&ns.config.safeMode===!1;Rs&&Fs?Bs=zs:Bs=Us}};function el(Xs){ks.push(Xs),Rs=this.charCodeToPatternIdxToConfig[Xs],$s=this.patternIdxToConfig[Xs],Ps=$s.length,Ps=$s.length;var Ks=this.canModeBeOptimized[Xs]&&this.config.safeMode===!1;Rs&&Ks?Bs=zs:Bs=Us}el.call(this,rs);for(var Ys;Cs<Ts;){us=null;var il=Ns.charCodeAt(Cs),al=Bs(il),ll=al.length;for(is=0;is<ll;is++){Ys=al[is];var nl=Ys.pattern;cs=null;var cl=Ys.short;if(cl!==!1?il===cl&&(us=nl):Ys.isCustom===!0?(vs=nl.exec(Ns,Cs,ws,Vs),vs!==null?(us=vs[0],vs.payload!==void 0&&(cs=vs.payload)):us=null):(this.updateLastIndex(nl,Cs),us=this.match(nl,ts,Cs)),us!==null){if(ls=Ys.longerAlt,ls!==void 0){var dl=$s[ls],sl=dl.pattern;ps=null,dl.isCustom===!0?(vs=sl.exec(Ns,Cs,ws,Vs),vs!==null?(os=vs[0],vs.payload!==void 0&&(ps=vs.payload)):os=null):(this.updateLastIndex(sl,Cs),os=this.match(sl,ts,Cs)),os&&os.length>us.length&&(us=os,cs=ps,Ys=dl)}break}}if(us!==null){if(ds=us.length,fs=Ys.group,fs!==void 0&&(hs=Ys.tokenTypeIdx,ys=this.createTokenInstance(us,Cs,hs,Ys.tokenType,Ss,Ds,ds),this.handlePayload(ys,cs),fs===!1?xs=this.addToken(ws,xs,ys):Vs[fs].push(ys)),ts=this.chopInput(ts,ds),Cs=Cs+ds,Ds=this.computeNewColumn(Ds,ds),Is===!0&&Ys.canLineTerminator===!0){var js=0,Ls=void 0,Ws=void 0;Os.lastIndex=0;do Ls=Os.test(us),Ls===!0&&(Ws=Os.lastIndex-1,js++);while(Ls===!0);js!==0&&(Ss=Ss+js,Ds=ds-Ws,this.updateTokenEndLineColumnLocation(ys,fs,Ws,js,Ss,Ds,ds))}this.handleModes(Ys,Hs,el,ys)}else{for(var Zs=Cs,tl=Ss,rl=Ds,qs=!1;!qs&&Cs<Ts;)for(Ns.charCodeAt(Cs),ts=this.chopInput(ts,1),Cs++,as=0;as<Ps;as++){var Gs=$s[as],nl=Gs.pattern,cl=Gs.short;if(cl!==!1?Ns.charCodeAt(Cs)===cl&&(qs=!0):Gs.isCustom===!0?qs=nl.exec(Ns,Cs,ws,Vs)!==null:(this.updateLastIndex(nl,Cs),qs=nl.exec(ts)!==null),qs===!0)break}gs=Cs-Zs,bs=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(Ns,Zs,gs,tl,rl),Es.push({offset:Zs,line:tl,column:rl,length:gs,message:bs})}}return this.hasCustom||(ws.length=xs),{tokens:ws,groups:Vs,errors:Es}},ss.prototype.handleModes=function(ts,rs,ns,is){if(ts.pop===!0){var as=ts.push;rs(is),as!==void 0&&ns.call(this,as)}else ts.push!==void 0&&ns.call(this,ts.push)},ss.prototype.chopInput=function(ts,rs){return ts.substring(rs)},ss.prototype.updateLastIndex=function(ts,rs){ts.lastIndex=rs},ss.prototype.updateTokenEndLineColumnLocation=function(ts,rs,ns,is,as,os,ls){var us,cs;rs!==void 0&&(us=ns===ls-1,cs=us?-1:0,is===1&&us===!0||(ts.endLine=as+cs,ts.endColumn=os-1+-cs))},ss.prototype.computeNewColumn=function(ts,rs){return ts+rs},ss.prototype.createTokenInstance=function(){return null},ss.prototype.createOffsetOnlyToken=function(ts,rs,ns,is){return{image:ts,startOffset:rs,tokenTypeIdx:ns,tokenType:is}},ss.prototype.createStartOnlyToken=function(ts,rs,ns,is,as,os){return{image:ts,startOffset:rs,startLine:as,startColumn:os,tokenTypeIdx:ns,tokenType:is}},ss.prototype.createFullToken=function(ts,rs,ns,is,as,os,ls){return{image:ts,startOffset:rs,endOffset:rs+ls-1,startLine:as,endLine:as,startColumn:os,endColumn:os+ls-1,tokenTypeIdx:ns,tokenType:is}},ss.prototype.addToken=function(ts,rs,ns){return 666},ss.prototype.addTokenUsingPush=function(ts,rs,ns){return ts.push(ns),rs},ss.prototype.addTokenUsingMemberAccess=function(ts,rs,ns){return ts[rs]=ns,rs++,rs},ss.prototype.handlePayload=function(ts,rs){},ss.prototype.handlePayloadNoCustom=function(ts,rs){},ss.prototype.handlePayloadWithCustom=function(ts,rs){rs!==null&&(ts.payload=rs)},ss.prototype.match=function(ts,rs,ns){return null},ss.prototype.matchWithTest=function(ts,rs,ns){var is=ts.test(rs);return is===!0?rs.substring(ns,ts.lastIndex):null},ss.prototype.matchWithExec=function(ts,rs){var ns=ts.exec(rs);return ns!==null?ns[0]:ns},ss.prototype.TRACE_INIT=function(ts,rs){if(this.traceInitPerf===!0){this.traceInitIndent++;var ns=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(ns+"--> <"+ts+">");var is=timer(rs),as=is.time,os=is.value,ls=as>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&ls(ns+"<-- <"+ts+"> time: "+as+"ms"),this.traceInitIndent--,os}else return rs()},ss.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ss.NA=/NOT_APPLICABLE/,ss}();function tokenLabel(ss){return hasTokenLabel(ss)?ss.LABEL:ss.name}function hasTokenLabel(ss){return isString$1(ss.LABEL)&&ss.LABEL!==""}var PARENT="parent",CATEGORIES="categories",LABEL="label",GROUP="group",PUSH_MODE="push_mode",POP_MODE="pop_mode",LONGER_ALT="longer_alt",LINE_BREAKS="line_breaks",START_CHARS_HINT="start_chars_hint";function createToken(ss){return createTokenInternal(ss)}function createTokenInternal(ss){var ts=ss.pattern,rs={};if(rs.name=ss.name,isUndefined$1(ts)||(rs.PATTERN=ts),has(ss,PARENT))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return has(ss,CATEGORIES)&&(rs.CATEGORIES=ss[CATEGORIES]),augmentTokenTypes([rs]),has(ss,LABEL)&&(rs.LABEL=ss[LABEL]),has(ss,GROUP)&&(rs.GROUP=ss[GROUP]),has(ss,POP_MODE)&&(rs.POP_MODE=ss[POP_MODE]),has(ss,PUSH_MODE)&&(rs.PUSH_MODE=ss[PUSH_MODE]),has(ss,LONGER_ALT)&&(rs.LONGER_ALT=ss[LONGER_ALT]),has(ss,LINE_BREAKS)&&(rs.LINE_BREAKS=ss[LINE_BREAKS]),has(ss,START_CHARS_HINT)&&(rs.START_CHARS_HINT=ss[START_CHARS_HINT]),rs}var EOF=createToken({name:"EOF",pattern:Lexer.NA});augmentTokenTypes([EOF]);function createTokenInstance(ss,ts,rs,ns,is,as,os,ls){return{image:ts,startOffset:rs,endOffset:ns,startLine:is,endLine:as,startColumn:os,endColumn:ls,tokenTypeIdx:ss.tokenTypeIdx,tokenType:ss}}function tokenMatcher(ss,ts){return tokenStructuredMatcher(ss,ts)}var __extends$8=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),AbstractProduction=function(){function ss(ts){this.definition=ts}return ss.prototype.accept=function(ts){ts.visit(this),forEach$1(this.definition,function(rs){rs.accept(ts)})},ss}(),NonTerminal=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,[])||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return Object.defineProperty(ts.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(rs){},enumerable:!0,configurable:!0}),ts.prototype.accept=function(rs){rs.visit(this)},ts}(AbstractProduction),Rule=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.orgText="",assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),Flat=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.ignoreAmbiguities=!1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),Option=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),RepetitionMandatory=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),RepetitionMandatoryWithSeparator=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),Repetition=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),RepetitionWithSeparator=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),Alternation=function(ss){__extends$8(ts,ss);function ts(rs){var ns=ss.call(this,rs.definition)||this;return ns.idx=1,ns.ignoreAmbiguities=!1,ns.hasPredicates=!1,assign(ns,pick(rs,function(is){return is!==void 0})),ns}return ts}(AbstractProduction),Terminal=function(){function ss(ts){this.idx=1,assign(this,pick(ts,function(rs){return rs!==void 0}))}return ss.prototype.accept=function(ts){ts.visit(this)},ss}();function serializeGrammar(ss){return map(ss,serializeProduction)}function serializeProduction(ss){function ts(is){return map(is,serializeProduction)}if(ss instanceof NonTerminal)return{type:"NonTerminal",name:ss.nonTerminalName,idx:ss.idx};if(ss instanceof Flat)return{type:"Flat",definition:ts(ss.definition)};if(ss instanceof Option)return{type:"Option",idx:ss.idx,definition:ts(ss.definition)};if(ss instanceof RepetitionMandatory)return{type:"RepetitionMandatory",name:ss.name,idx:ss.idx,definition:ts(ss.definition)};if(ss instanceof RepetitionMandatoryWithSeparator)return{type:"RepetitionMandatoryWithSeparator",name:ss.name,idx:ss.idx,separator:serializeProduction(new Terminal({terminalType:ss.separator})),definition:ts(ss.definition)};if(ss instanceof RepetitionWithSeparator)return{type:"RepetitionWithSeparator",name:ss.name,idx:ss.idx,separator:serializeProduction(new Terminal({terminalType:ss.separator})),definition:ts(ss.definition)};if(ss instanceof Repetition)return{type:"Repetition",name:ss.name,idx:ss.idx,definition:ts(ss.definition)};if(ss instanceof Alternation)return{type:"Alternation",name:ss.name,idx:ss.idx,definition:ts(ss.definition)};if(ss instanceof Terminal){var rs={type:"Terminal",name:ss.terminalType.name,label:tokenLabel(ss.terminalType),idx:ss.idx},ns=ss.terminalType.PATTERN;return ss.terminalType.PATTERN&&(rs.pattern=isRegExp(ns)?ns.source:ns),rs}else{if(ss instanceof Rule)return{type:"Rule",name:ss.name,orgText:ss.orgText,definition:ts(ss.definition)};throw Error("non exhaustive match")}}var RestWalker=function(){function ss(){}return ss.prototype.walk=function(ts,rs){var ns=this;rs===void 0&&(rs=[]),forEach$1(ts.definition,function(is,as){var os=drop(ts.definition,as+1);if(is instanceof NonTerminal)ns.walkProdRef(is,os,rs);else if(is instanceof Terminal)ns.walkTerminal(is,os,rs);else if(is instanceof Flat)ns.walkFlat(is,os,rs);else if(is instanceof Option)ns.walkOption(is,os,rs);else if(is instanceof RepetitionMandatory)ns.walkAtLeastOne(is,os,rs);else if(is instanceof RepetitionMandatoryWithSeparator)ns.walkAtLeastOneSep(is,os,rs);else if(is instanceof RepetitionWithSeparator)ns.walkManySep(is,os,rs);else if(is instanceof Repetition)ns.walkMany(is,os,rs);else if(is instanceof Alternation)ns.walkOr(is,os,rs);else throw Error("non exhaustive match")})},ss.prototype.walkTerminal=function(ts,rs,ns){},ss.prototype.walkProdRef=function(ts,rs,ns){},ss.prototype.walkFlat=function(ts,rs,ns){var is=rs.concat(ns);this.walk(ts,is)},ss.prototype.walkOption=function(ts,rs,ns){var is=rs.concat(ns);this.walk(ts,is)},ss.prototype.walkAtLeastOne=function(ts,rs,ns){var is=[new Option({definition:ts.definition})].concat(rs,ns);this.walk(ts,is)},ss.prototype.walkAtLeastOneSep=function(ts,rs,ns){var is=restForRepetitionWithSeparator(ts,rs,ns);this.walk(ts,is)},ss.prototype.walkMany=function(ts,rs,ns){var is=[new Option({definition:ts.definition})].concat(rs,ns);this.walk(ts,is)},ss.prototype.walkManySep=function(ts,rs,ns){var is=restForRepetitionWithSeparator(ts,rs,ns);this.walk(ts,is)},ss.prototype.walkOr=function(ts,rs,ns){var is=this,as=rs.concat(ns);forEach$1(ts.definition,function(os){var ls=new Flat({definition:[os]});is.walk(ls,as)})},ss}();function restForRepetitionWithSeparator(ss,ts,rs){var ns=[new Option({definition:[new Terminal({terminalType:ss.separator})].concat(ss.definition)})],is=ns.concat(ts,rs);return is}var GAstVisitor=function(){function ss(){}return ss.prototype.visit=function(ts){var rs=ts;switch(rs.constructor){case NonTerminal:return this.visitNonTerminal(rs);case Flat:return this.visitFlat(rs);case Option:return this.visitOption(rs);case RepetitionMandatory:return this.visitRepetitionMandatory(rs);case RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(rs);case RepetitionWithSeparator:return this.visitRepetitionWithSeparator(rs);case Repetition:return this.visitRepetition(rs);case Alternation:return this.visitAlternation(rs);case Terminal:return this.visitTerminal(rs);case Rule:return this.visitRule(rs);default:throw Error("non exhaustive match")}},ss.prototype.visitNonTerminal=function(ts){},ss.prototype.visitFlat=function(ts){},ss.prototype.visitOption=function(ts){},ss.prototype.visitRepetition=function(ts){},ss.prototype.visitRepetitionMandatory=function(ts){},ss.prototype.visitRepetitionMandatoryWithSeparator=function(ts){},ss.prototype.visitRepetitionWithSeparator=function(ts){},ss.prototype.visitAlternation=function(ts){},ss.prototype.visitTerminal=function(ts){},ss.prototype.visitRule=function(ts){},ss}(),__extends$7=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}();function isSequenceProd(ss){return ss instanceof Flat||ss instanceof Option||ss instanceof Repetition||ss instanceof RepetitionMandatory||ss instanceof RepetitionMandatoryWithSeparator||ss instanceof RepetitionWithSeparator||ss instanceof Terminal||ss instanceof Rule}function isOptionalProd(ss,ts){ts===void 0&&(ts=[]);var rs=ss instanceof Option||ss instanceof Repetition||ss instanceof RepetitionWithSeparator;return rs?!0:ss instanceof Alternation?some(ss.definition,function(ns){return isOptionalProd(ns,ts)}):ss instanceof NonTerminal&&contains(ts,ss)?!1:ss instanceof AbstractProduction?(ss instanceof NonTerminal&&ts.push(ss),every(ss.definition,function(ns){return isOptionalProd(ns,ts)})):!1}function isBranchingProd(ss){return ss instanceof Alternation}function getProductionDslName(ss){if(ss instanceof NonTerminal)return"SUBRULE";if(ss instanceof Option)return"OPTION";if(ss instanceof Alternation)return"OR";if(ss instanceof RepetitionMandatory)return"AT_LEAST_ONE";if(ss instanceof RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(ss instanceof RepetitionWithSeparator)return"MANY_SEP";if(ss instanceof Repetition)return"MANY";if(ss instanceof Terminal)return"CONSUME";throw Error("non exhaustive match")}var DslMethodsCollectorVisitor=function(ss){__extends$7(ts,ss);function ts(){var rs=ss!==null&&ss.apply(this,arguments)||this;return rs.separator="-",rs.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},rs}return ts.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},ts.prototype.visitTerminal=function(rs){var ns=rs.terminalType.name+this.separator+"Terminal";has(this.dslMethods,ns)||(this.dslMethods[ns]=[]),this.dslMethods[ns].push(rs)},ts.prototype.visitNonTerminal=function(rs){var ns=rs.nonTerminalName+this.separator+"Terminal";has(this.dslMethods,ns)||(this.dslMethods[ns]=[]),this.dslMethods[ns].push(rs)},ts.prototype.visitOption=function(rs){this.dslMethods.option.push(rs)},ts.prototype.visitRepetitionWithSeparator=function(rs){this.dslMethods.repetitionWithSeparator.push(rs)},ts.prototype.visitRepetitionMandatory=function(rs){this.dslMethods.repetitionMandatory.push(rs)},ts.prototype.visitRepetitionMandatoryWithSeparator=function(rs){this.dslMethods.repetitionMandatoryWithSeparator.push(rs)},ts.prototype.visitRepetition=function(rs){this.dslMethods.repetition.push(rs)},ts.prototype.visitAlternation=function(rs){this.dslMethods.alternation.push(rs)},ts}(GAstVisitor),collectorVisitor=new DslMethodsCollectorVisitor;function collectMethods(ss){collectorVisitor.reset(),ss.accept(collectorVisitor);var ts=collectorVisitor.dslMethods;return collectorVisitor.reset(),ts}function first(ss){if(ss instanceof NonTerminal)return first(ss.referencedRule);if(ss instanceof Terminal)return firstForTerminal(ss);if(isSequenceProd(ss))return firstForSequence(ss);if(isBranchingProd(ss))return firstForBranching(ss);throw Error("non exhaustive match")}function firstForSequence(ss){for(var ts=[],rs=ss.definition,ns=0,is=rs.length>ns,as,os=!0;is&&os;)as=rs[ns],os=isOptionalProd(as),ts=ts.concat(first(as)),ns=ns+1,is=rs.length>ns;return uniq(ts)}function firstForBranching(ss){var ts=map(ss.definition,function(rs){return first(rs)});return uniq(flatten(ts))}function firstForTerminal(ss){return[ss.terminalType]}var IN="_~IN~_",__extends$6=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),ResyncFollowsWalker=function(ss){__extends$6(ts,ss);function ts(rs){var ns=ss.call(this)||this;return ns.topProd=rs,ns.follows={},ns}return ts.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},ts.prototype.walkTerminal=function(rs,ns,is){},ts.prototype.walkProdRef=function(rs,ns,is){var as=buildBetweenProdsFollowPrefix(rs.referencedRule,rs.idx)+this.topProd.name,os=ns.concat(is),ls=new Flat({definition:os}),us=first(ls);this.follows[as]=us},ts}(RestWalker);function computeAllProdsFollows(ss){var ts={};return forEach$1(ss,function(rs){var ns=new ResyncFollowsWalker(rs).startWalking();assign(ts,ns)}),ts}function buildBetweenProdsFollowPrefix(ss,ts){return ss.name+ts+IN}var BITS_FOR_METHOD_TYPE=4,BITS_FOR_OCCURRENCE_IDX=8,BITS_FOR_ALT_IDX=8,OR_IDX=1<<BITS_FOR_OCCURRENCE_IDX,OPTION_IDX=2<<BITS_FOR_OCCURRENCE_IDX,MANY_IDX=3<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_IDX=4<<BITS_FOR_OCCURRENCE_IDX,MANY_SEP_IDX=5<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_SEP_IDX=6<<BITS_FOR_OCCURRENCE_IDX;function getKeyForAutomaticLookahead(ss,ts,rs){return rs|ts|ss}var BITS_START_FOR_ALT_IDX=32-BITS_FOR_ALT_IDX;function getKeyForAltIndex(ss,ts,rs,ns){var is=ns+1<<BITS_START_FOR_ALT_IDX;return getKeyForAutomaticLookahead(ss,ts,rs)|is}var __extends$5=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}();function setNodeLocationOnlyOffset(ss,ts){isNaN(ss.startOffset)===!0?(ss.startOffset=ts.startOffset,ss.endOffset=ts.endOffset):ss.endOffset<ts.endOffset&&(ss.endOffset=ts.endOffset)}function setNodeLocationFull(ss,ts){isNaN(ss.startOffset)===!0?(ss.startOffset=ts.startOffset,ss.startColumn=ts.startColumn,ss.startLine=ts.startLine,ss.endOffset=ts.endOffset,ss.endColumn=ts.endColumn,ss.endLine=ts.endLine):ss.endOffset<ts.endOffset&&(ss.endOffset=ts.endOffset,ss.endColumn=ts.endColumn,ss.endLine=ts.endLine)}function addTerminalToCst(ss,ts,rs){ss.children[rs]===void 0?ss.children[rs]=[ts]:ss.children[rs].push(ts)}function addNoneTerminalToCst(ss,ts,rs){ss.children[ts]===void 0?ss.children[ts]=[rs]:ss.children[ts].push(rs)}var NamedDSLMethodsCollectorVisitor=function(ss){__extends$5(ts,ss);function ts(rs){var ns=ss.call(this)||this;return ns.result=[],ns.ruleIdx=rs,ns}return ts.prototype.collectNamedDSLMethod=function(rs,ns,is){if(!isUndefined$1(rs.name)){var as=void 0;if(rs instanceof Option||rs instanceof Repetition||rs instanceof RepetitionMandatory||rs instanceof Alternation)as=new ns({definition:rs.definition,idx:rs.idx});else if(rs instanceof RepetitionMandatoryWithSeparator||rs instanceof RepetitionWithSeparator)as=new ns({definition:rs.definition,idx:rs.idx,separator:rs.separator});else throw Error("non exhaustive match");var os=[as],ls=getKeyForAutomaticLookahead(this.ruleIdx,is,rs.idx);this.result.push({def:os,key:ls,name:rs.name,orgProd:rs})}},ts.prototype.visitOption=function(rs){this.collectNamedDSLMethod(rs,Option,OPTION_IDX)},ts.prototype.visitRepetition=function(rs){this.collectNamedDSLMethod(rs,Repetition,MANY_IDX)},ts.prototype.visitRepetitionMandatory=function(rs){this.collectNamedDSLMethod(rs,RepetitionMandatory,AT_LEAST_ONE_IDX)},ts.prototype.visitRepetitionMandatoryWithSeparator=function(rs){this.collectNamedDSLMethod(rs,RepetitionMandatoryWithSeparator,AT_LEAST_ONE_SEP_IDX)},ts.prototype.visitRepetitionWithSeparator=function(rs){this.collectNamedDSLMethod(rs,RepetitionWithSeparator,MANY_SEP_IDX)},ts.prototype.visitAlternation=function(rs){var ns=this;this.collectNamedDSLMethod(rs,Alternation,OR_IDX);var is=rs.definition.length>1;forEach$1(rs.definition,function(as,os){if(!isUndefined$1(as.name)){var ls=as.definition;is?ls=[new Option({definition:as.definition})]:ls=as.definition;var us=getKeyForAltIndex(ns.ruleIdx,OR_IDX,rs.idx,os);ns.result.push({def:ls,key:us,name:as.name,orgProd:as})}})},ts}(GAstVisitor);function expandAllNestedRuleNames(ss,ts){var rs={allRuleNames:[]};return forEach$1(ss,function(ns){var is=ts[ns.name];rs.allRuleNames.push(ns.name);var as=new NamedDSLMethodsCollectorVisitor(is);ns.accept(as),forEach$1(as.result,function(os){os.def,os.key;var ls=os.name;rs.allRuleNames.push(ns.name+ls)})}),rs}var __extends$4=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),AbstractNextPossibleTokensWalker=function(ss){__extends$4(ts,ss);function ts(rs,ns){var is=ss.call(this)||this;return is.topProd=rs,is.path=ns,is.possibleTokTypes=[],is.nextProductionName="",is.nextProductionOccurrence=0,is.found=!1,is.isAtEndOfPath=!1,is}return ts.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},ts.prototype.walk=function(rs,ns){ns===void 0&&(ns=[]),this.found||ss.prototype.walk.call(this,rs,ns)},ts.prototype.walkProdRef=function(rs,ns,is){if(rs.referencedRule.name===this.nextProductionName&&rs.idx===this.nextProductionOccurrence){var as=ns.concat(is);this.updateExpectedNext(),this.walk(rs.referencedRule,as)}},ts.prototype.updateExpectedNext=function(){isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},ts}(RestWalker),NextAfterTokenWalker=function(ss){__extends$4(ts,ss);function ts(rs,ns){var is=ss.call(this,rs,ns)||this;return is.path=ns,is.nextTerminalName="",is.nextTerminalOccurrence=0,is.nextTerminalName=is.path.lastTok.name,is.nextTerminalOccurrence=is.path.lastTokOccurrence,is}return ts.prototype.walkTerminal=function(rs,ns,is){if(this.isAtEndOfPath&&rs.terminalType.name===this.nextTerminalName&&rs.idx===this.nextTerminalOccurrence&&!this.found){var as=ns.concat(is),os=new Flat({definition:as});this.possibleTokTypes=first(os),this.found=!0}},ts}(AbstractNextPossibleTokensWalker),AbstractNextTerminalAfterProductionWalker=function(ss){__extends$4(ts,ss);function ts(rs,ns){var is=ss.call(this)||this;return is.topRule=rs,is.occurrence=ns,is.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},is}return ts.prototype.startWalking=function(){return this.walk(this.topRule),this.result},ts}(RestWalker),NextTerminalAfterManyWalker=function(ss){__extends$4(ts,ss);function ts(){return ss!==null&&ss.apply(this,arguments)||this}return ts.prototype.walkMany=function(rs,ns,is){if(rs.idx===this.occurrence){var as=first$1(ns.concat(is));this.result.isEndOfRule=as===void 0,as instanceof Terminal&&(this.result.token=as.terminalType,this.result.occurrence=as.idx)}else ss.prototype.walkMany.call(this,rs,ns,is)},ts}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterManySepWalker=function(ss){__extends$4(ts,ss);function ts(){return ss!==null&&ss.apply(this,arguments)||this}return ts.prototype.walkManySep=function(rs,ns,is){if(rs.idx===this.occurrence){var as=first$1(ns.concat(is));this.result.isEndOfRule=as===void 0,as instanceof Terminal&&(this.result.token=as.terminalType,this.result.occurrence=as.idx)}else ss.prototype.walkManySep.call(this,rs,ns,is)},ts}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneWalker=function(ss){__extends$4(ts,ss);function ts(){return ss!==null&&ss.apply(this,arguments)||this}return ts.prototype.walkAtLeastOne=function(rs,ns,is){if(rs.idx===this.occurrence){var as=first$1(ns.concat(is));this.result.isEndOfRule=as===void 0,as instanceof Terminal&&(this.result.token=as.terminalType,this.result.occurrence=as.idx)}else ss.prototype.walkAtLeastOne.call(this,rs,ns,is)},ts}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneSepWalker=function(ss){__extends$4(ts,ss);function ts(){return ss!==null&&ss.apply(this,arguments)||this}return ts.prototype.walkAtLeastOneSep=function(rs,ns,is){if(rs.idx===this.occurrence){var as=first$1(ns.concat(is));this.result.isEndOfRule=as===void 0,as instanceof Terminal&&(this.result.token=as.terminalType,this.result.occurrence=as.idx)}else ss.prototype.walkAtLeastOneSep.call(this,rs,ns,is)},ts}(AbstractNextTerminalAfterProductionWalker);function possiblePathsFrom(ss,ts,rs){rs===void 0&&(rs=[]),rs=cloneArr(rs);var ns=[],is=0;function as(cs){return cs.concat(drop(ss,is+1))}function os(cs){var ps=possiblePathsFrom(as(cs),ts,rs);return ns.concat(ps)}for(;rs.length<ts&&is<ss.length;){var ls=ss[is];if(ls instanceof Flat)return os(ls.definition);if(ls instanceof NonTerminal)return os(ls.definition);if(ls instanceof Option)ns=os(ls.definition);else if(ls instanceof RepetitionMandatory){var us=ls.definition.concat([new Repetition({definition:ls.definition})]);return os(us)}else if(ls instanceof RepetitionMandatoryWithSeparator){var us=[new Flat({definition:ls.definition}),new Repetition({definition:[new Terminal({terminalType:ls.separator})].concat(ls.definition)})];return os(us)}else if(ls instanceof RepetitionWithSeparator){var us=ls.definition.concat([new Repetition({definition:[new Terminal({terminalType:ls.separator})].concat(ls.definition)})]);ns=os(us)}else if(ls instanceof Repetition){var us=ls.definition.concat([new Repetition({definition:ls.definition})]);ns=os(us)}else{if(ls instanceof Alternation)return forEach$1(ls.definition,function(cs){ns=os(cs.definition)}),ns;if(ls instanceof Terminal)rs.push(ls.terminalType);else throw Error("non exhaustive match")}is++}return ns.push({partialPath:rs,suffixDef:drop(ss,is)}),ns}function nextPossibleTokensAfter(ss,ts,rs,ns){var is="EXIT_NONE_TERMINAL",as=[is],os="EXIT_ALTERNATIVE",ls=!1,us=ts.length,cs=us-ns-1,ps=[],ds=[];for(ds.push({idx:-1,def:ss,ruleStack:[],occurrenceStack:[]});!isEmpty(ds);){var fs=ds.pop();if(fs===os){ls&&last(ds).idx<=cs&&ds.pop();continue}var hs=fs.def,ys=fs.idx,gs=fs.ruleStack,bs=fs.occurrenceStack;if(!isEmpty(hs)){var vs=hs[0];if(vs===is){var Ns={idx:ys,def:drop(hs),ruleStack:dropRight(gs),occurrenceStack:dropRight(bs)};ds.push(Ns)}else if(vs instanceof Terminal)if(ys<us-1){var Ts=ys+1,Cs=ts[Ts];if(rs(Cs,vs.terminalType)){var Ns={idx:Ts,def:drop(hs),ruleStack:gs,occurrenceStack:bs};ds.push(Ns)}}else if(ys===us-1)ps.push({nextTokenType:vs.terminalType,nextTokenOccurrence:vs.idx,ruleStack:gs,occurrenceStack:bs}),ls=!0;else throw Error("non exhaustive match");else if(vs instanceof NonTerminal){var xs=cloneArr(gs);xs.push(vs.nonTerminalName);var As=cloneArr(bs);As.push(vs.idx);var Ns={idx:ys,def:vs.definition.concat(as,drop(hs)),ruleStack:xs,occurrenceStack:As};ds.push(Ns)}else if(vs instanceof Option){var ws={idx:ys,def:drop(hs),ruleStack:gs,occurrenceStack:bs};ds.push(ws),ds.push(os);var Es={idx:ys,def:vs.definition.concat(drop(hs)),ruleStack:gs,occurrenceStack:bs};ds.push(Es)}else if(vs instanceof RepetitionMandatory){var Ss=new Repetition({definition:vs.definition,idx:vs.idx}),Ds=vs.definition.concat([Ss],drop(hs)),Ns={idx:ys,def:Ds,ruleStack:gs,occurrenceStack:bs};ds.push(Ns)}else if(vs instanceof RepetitionMandatoryWithSeparator){var Vs=new Terminal({terminalType:vs.separator}),Ss=new Repetition({definition:[Vs].concat(vs.definition),idx:vs.idx}),Ds=vs.definition.concat([Ss],drop(hs)),Ns={idx:ys,def:Ds,ruleStack:gs,occurrenceStack:bs};ds.push(Ns)}else if(vs instanceof RepetitionWithSeparator){var ws={idx:ys,def:drop(hs),ruleStack:gs,occurrenceStack:bs};ds.push(ws),ds.push(os);var Vs=new Terminal({terminalType:vs.separator}),Is=new Repetition({definition:[Vs].concat(vs.definition),idx:vs.idx}),Ds=vs.definition.concat([Is],drop(hs)),Es={idx:ys,def:Ds,ruleStack:gs,occurrenceStack:bs};ds.push(Es)}else if(vs instanceof Repetition){var ws={idx:ys,def:drop(hs),ruleStack:gs,occurrenceStack:bs};ds.push(ws),ds.push(os);var Is=new Repetition({definition:vs.definition,idx:vs.idx}),Ds=vs.definition.concat([Is],drop(hs)),Es={idx:ys,def:Ds,ruleStack:gs,occurrenceStack:bs};ds.push(Es)}else if(vs instanceof Alternation)for(var Os=vs.definition.length-1;Os>=0;Os--){var Ps=vs.definition[Os],$s={idx:ys,def:Ps.definition.concat(drop(hs)),ruleStack:gs,occurrenceStack:bs};ds.push($s),ds.push(os)}else if(vs instanceof Flat)ds.push({idx:ys,def:vs.definition.concat(drop(hs)),ruleStack:gs,occurrenceStack:bs});else if(vs instanceof Rule)ds.push(expandTopLevelRule(vs,ys,gs,bs));else throw Error("non exhaustive match")}}return ps}function expandTopLevelRule(ss,ts,rs,ns){var is=cloneArr(rs);is.push(ss.name);var as=cloneArr(ns);return as.push(1),{idx:ts,def:ss.definition,ruleStack:is,occurrenceStack:as}}var __extends$3=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),PROD_TYPE;(function(ss){ss[ss.OPTION=0]="OPTION",ss[ss.REPETITION=1]="REPETITION",ss[ss.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",ss[ss.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",ss[ss.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",ss[ss.ALTERNATION=5]="ALTERNATION"})(PROD_TYPE||(PROD_TYPE={}));function getProdType(ss){if(ss instanceof Option)return PROD_TYPE.OPTION;if(ss instanceof Repetition)return PROD_TYPE.REPETITION;if(ss instanceof RepetitionMandatory)return PROD_TYPE.REPETITION_MANDATORY;if(ss instanceof RepetitionMandatoryWithSeparator)return PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR;if(ss instanceof RepetitionWithSeparator)return PROD_TYPE.REPETITION_WITH_SEPARATOR;if(ss instanceof Alternation)return PROD_TYPE.ALTERNATION;throw Error("non exhaustive match")}function buildLookaheadFuncForOr(ss,ts,rs,ns,is,as){var os=getLookaheadPathsForOr(ss,ts,rs),ls=areTokenCategoriesNotUsed(os)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher;return as(os,ns,ls,is)}function buildLookaheadFuncForOptionalProd(ss,ts,rs,ns,is,as){var os=getLookaheadPathsForOptionalProd(ss,ts,is,rs),ls=areTokenCategoriesNotUsed(os)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher;return as(os[0],ls,ns)}function buildAlternativesLookAheadFunc(ss,ts,rs,ns){var is=ss.length,as=every(ss,function(us){return every(us,function(cs){return cs.length===1})});if(ts)return function(us){for(var cs=map(us,function(Ts){return Ts.GATE}),ps=0;ps<is;ps++){var ds=ss[ps],fs=ds.length,hs=cs[ps];if(!(hs!==void 0&&hs.call(this)===!1))e:for(var ys=0;ys<fs;ys++){for(var gs=ds[ys],bs=gs.length,vs=0;vs<bs;vs++){var Ns=this.LA(vs+1);if(rs(Ns,gs[vs])===!1)continue e}return ps}}};if(as&&!ns){var os=map(ss,function(us){return flatten(us)}),ls=reduce(os,function(us,cs,ps){return forEach$1(cs,function(ds){has(us,ds.tokenTypeIdx)||(us[ds.tokenTypeIdx]=ps),forEach$1(ds.categoryMatches,function(fs){has(us,fs)||(us[fs]=ps)})}),us},[]);return function(){var us=this.LA(1);return ls[us.tokenTypeIdx]}}else return function(){for(var us=0;us<is;us++){var cs=ss[us],ps=cs.length;e:for(var ds=0;ds<ps;ds++){for(var fs=cs[ds],hs=fs.length,ys=0;ys<hs;ys++){var gs=this.LA(ys+1);if(rs(gs,fs[ys])===!1)continue e}return us}}}}function buildSingleAlternativeLookaheadFunction(ss,ts,rs){var ns=every(ss,function(cs){return cs.length===1}),is=ss.length;if(ns&&!rs){var as=flatten(ss);if(as.length===1&&isEmpty(as[0].categoryMatches)){var os=as[0],ls=os.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===ls}}else{var us=reduce(as,function(cs,ps,ds){return cs[ps.tokenTypeIdx]=!0,forEach$1(ps.categoryMatches,function(fs){cs[fs]=!0}),cs},[]);return function(){var cs=this.LA(1);return us[cs.tokenTypeIdx]===!0}}}else return function(){e:for(var cs=0;cs<is;cs++){for(var ps=ss[cs],ds=ps.length,fs=0;fs<ds;fs++){var hs=this.LA(fs+1);if(ts(hs,ps[fs])===!1)continue e}return!0}return!1}}var RestDefinitionFinderWalker=function(ss){__extends$3(ts,ss);function ts(rs,ns,is){var as=ss.call(this)||this;return as.topProd=rs,as.targetOccurrence=ns,as.targetProdType=is,as}return ts.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},ts.prototype.checkIsTarget=function(rs,ns,is,as){return rs.idx===this.targetOccurrence&&this.targetProdType===ns?(this.restDef=is.concat(as),!0):!1},ts.prototype.walkOption=function(rs,ns,is){this.checkIsTarget(rs,PROD_TYPE.OPTION,ns,is)||ss.prototype.walkOption.call(this,rs,ns,is)},ts.prototype.walkAtLeastOne=function(rs,ns,is){this.checkIsTarget(rs,PROD_TYPE.REPETITION_MANDATORY,ns,is)||ss.prototype.walkOption.call(this,rs,ns,is)},ts.prototype.walkAtLeastOneSep=function(rs,ns,is){this.checkIsTarget(rs,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,ns,is)||ss.prototype.walkOption.call(this,rs,ns,is)},ts.prototype.walkMany=function(rs,ns,is){this.checkIsTarget(rs,PROD_TYPE.REPETITION,ns,is)||ss.prototype.walkOption.call(this,rs,ns,is)},ts.prototype.walkManySep=function(rs,ns,is){this.checkIsTarget(rs,PROD_TYPE.REPETITION_WITH_SEPARATOR,ns,is)||ss.prototype.walkOption.call(this,rs,ns,is)},ts}(RestWalker),InsideDefinitionFinderVisitor=function(ss){__extends$3(ts,ss);function ts(rs,ns,is){var as=ss.call(this)||this;return as.targetOccurrence=rs,as.targetProdType=ns,as.targetRef=is,as.result=[],as}return ts.prototype.checkIsTarget=function(rs,ns){rs.idx===this.targetOccurrence&&this.targetProdType===ns&&(this.targetRef===void 0||rs===this.targetRef)&&(this.result=rs.definition)},ts.prototype.visitOption=function(rs){this.checkIsTarget(rs,PROD_TYPE.OPTION)},ts.prototype.visitRepetition=function(rs){this.checkIsTarget(rs,PROD_TYPE.REPETITION)},ts.prototype.visitRepetitionMandatory=function(rs){this.checkIsTarget(rs,PROD_TYPE.REPETITION_MANDATORY)},ts.prototype.visitRepetitionMandatoryWithSeparator=function(rs){this.checkIsTarget(rs,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},ts.prototype.visitRepetitionWithSeparator=function(rs){this.checkIsTarget(rs,PROD_TYPE.REPETITION_WITH_SEPARATOR)},ts.prototype.visitAlternation=function(rs){this.checkIsTarget(rs,PROD_TYPE.ALTERNATION)},ts}(GAstVisitor);function initializeArrayOfArrays(ss){for(var ts=new Array(ss),rs=0;rs<ss;rs++)ts[rs]=[];return ts}function pathToHashKeys(ss){for(var ts=[""],rs=0;rs<ss.length;rs++){for(var ns=ss[rs],is=[],as=0;as<ts.length;as++){var os=ts[as];is.push(os+"_"+ns.tokenTypeIdx);for(var ls=0;ls<ns.categoryMatches.length;ls++){var us="_"+ns.categoryMatches[ls];is.push(os+us)}}ts=is}return ts}function isUniquePrefixHash(ss,ts,rs){for(var ns=0;ns<ss.length;ns++)if(ns!==rs)for(var is=ss[ns],as=0;as<ts.length;as++){var os=ts[as];if(is[os]===!0)return!1}return!0}function lookAheadSequenceFromAlternatives(ss,ts){for(var rs=map(ss,function(ps){return possiblePathsFrom([ps],1)}),ns=initializeArrayOfArrays(rs.length),is=map(rs,function(ps){var ds={};return forEach$1(ps,function(fs){var hs=pathToHashKeys(fs.partialPath);forEach$1(hs,function(ys){ds[ys]=!0})}),ds}),as=rs,os=1;os<=ts;os++){var ls=as;as=initializeArrayOfArrays(ls.length);for(var us=function(ps){for(var ds=ls[ps],fs=0;fs<ds.length;fs++){var hs=ds[fs].partialPath,ys=ds[fs].suffixDef,gs=pathToHashKeys(hs),bs=isUniquePrefixHash(is,gs,ps);if(bs||isEmpty(ys)||hs.length===ts){var vs=ns[ps];if(containsPath(vs,hs)===!1){vs.push(hs);for(var Ns=0;Ns<gs.length;Ns++){var Ts=gs[Ns];is[ps][Ts]=!0}}}else{var Cs=possiblePathsFrom(ys,os+1,hs);as[ps]=as[ps].concat(Cs),forEach$1(Cs,function(xs){var As=pathToHashKeys(xs.partialPath);forEach$1(As,function(ws){is[ps][ws]=!0})})}}},cs=0;cs<ls.length;cs++)us(cs)}return ns}function getLookaheadPathsForOr(ss,ts,rs,ns){var is=new InsideDefinitionFinderVisitor(ss,PROD_TYPE.ALTERNATION,ns);return ts.accept(is),lookAheadSequenceFromAlternatives(is.result,rs)}function getLookaheadPathsForOptionalProd(ss,ts,rs,ns){var is=new InsideDefinitionFinderVisitor(ss,rs);ts.accept(is);var as=is.result,os=new RestDefinitionFinderWalker(ts,ss,rs),ls=os.startWalking(),us=new Flat({definition:as}),cs=new Flat({definition:ls});return lookAheadSequenceFromAlternatives([us,cs],ns)}function containsPath(ss,ts){e:for(var rs=0;rs<ss.length;rs++){var ns=ss[rs];if(ns.length===ts.length){for(var is=0;is<ns.length;is++){var as=ts[is],os=ns[is],ls=as===os||os.categoryMatchesMap[as.tokenTypeIdx]!==void 0;if(ls===!1)continue e}return!0}}return!1}function isStrictPrefixOfPath(ss,ts){return ss.length<ts.length&&every(ss,function(rs,ns){var is=ts[ns];return rs===is||is.categoryMatchesMap[rs.tokenTypeIdx]})}function areTokenCategoriesNotUsed(ss){return every(ss,function(ts){return every(ts,function(rs){return every(rs,function(ns){return isEmpty(ns.categoryMatches)})})})}var __extends$2=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}();function validateGrammar$1(ss,ts,rs,ns,is,as){var os=map(ss,function(Ns){return validateDuplicateProductions(Ns,is)}),ls=map(ss,function(Ns){return validateNoLeftRecursion(Ns,Ns,is)}),us=[],cs=[],ps=[];every(ls,isEmpty)&&(us=map(ss,function(Ns){return validateEmptyOrAlternative(Ns,is)}),cs=map(ss,function(Ns){return validateAmbiguousAlternationAlternatives(Ns,ts,ns,is)}),ps=validateSomeNonEmptyLookaheadPath(ss,ts,is));var ds=checkTerminalAndNoneTerminalsNameSpace(ss,rs,is),fs=map(rs,function(Ns){return validateTokenName(Ns,is)}),hs=validateNestedRulesNames(ss,is),ys=validateDuplicateNestedRules(ss,is),gs=map(ss,function(Ns){return validateTooManyAlts(Ns,is)}),bs=map(ss,function(Ns){return validateRuleName(Ns,is)}),vs=map(ss,function(Ns){return validateRuleDoesNotAlreadyExist(Ns,ss,as,is)});return flatten(os.concat(fs,hs,ys,ps,ls,us,cs,ds,gs,bs,vs))}function validateNestedRulesNames(ss,ts){var rs=[];return forEach$1(ss,function(ns){var is=new NamedDSLMethodsCollectorVisitor("");ns.accept(is);var as=map(is.result,function(os){return os.orgProd});rs.push(map(as,function(os){return validateNestedRuleName(ns,os,ts)}))}),flatten(rs)}function validateDuplicateProductions(ss,ts){var rs=new OccurrenceValidationCollector;ss.accept(rs);var ns=rs.allProductions,is=groupBy(ns,identifyProductionForDuplicates),as=pick(is,function(ls){return ls.length>1}),os=map(values(as),function(ls){var us=first$1(ls),cs=ts.buildDuplicateFoundError(ss,ls),ps=getProductionDslName(us),ds={message:cs,type:ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:ss.name,dslName:ps,occurrence:us.idx},fs=getExtraProductionArgument(us);return fs&&(ds.parameter=fs),ds});return os}function identifyProductionForDuplicates(ss){return getProductionDslName(ss)+"_#_"+ss.idx+"_#_"+getExtraProductionArgument(ss)}function getExtraProductionArgument(ss){return ss instanceof Terminal?ss.terminalType.name:ss instanceof NonTerminal?ss.nonTerminalName:""}var OccurrenceValidationCollector=function(ss){__extends$2(ts,ss);function ts(){var rs=ss!==null&&ss.apply(this,arguments)||this;return rs.allProductions=[],rs}return ts.prototype.visitNonTerminal=function(rs){this.allProductions.push(rs)},ts.prototype.visitOption=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetitionWithSeparator=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetitionMandatory=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetitionMandatoryWithSeparator=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetition=function(rs){this.allProductions.push(rs)},ts.prototype.visitAlternation=function(rs){this.allProductions.push(rs)},ts.prototype.visitTerminal=function(rs){this.allProductions.push(rs)},ts}(GAstVisitor),validTermsPattern=/^[a-zA-Z_]\w*$/,validNestedRuleName=new RegExp(validTermsPattern.source.replace("^","^\\$"));function validateRuleName(ss,ts){var rs=[],ns=ss.name;return ns.match(validTermsPattern)||rs.push({message:ts.buildInvalidRuleNameError({topLevelRule:ss,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:ns}),rs}function validateNestedRuleName(ss,ts,rs){var ns=[],is;return ts.name.match(validNestedRuleName)||(is=rs.buildInvalidNestedRuleNameError(ss,ts),ns.push({message:is,type:ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:ss.name})),ns}function validateTokenName(ss,ts){var rs=[],ns=ss.name;return ns.match(validTermsPattern)||rs.push({message:ts.buildTokenNameError({tokenType:ss,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_TOKEN_NAME}),rs}function validateRuleDoesNotAlreadyExist(ss,ts,rs,ns){var is=[],as=reduce(ts,function(ls,us){return us.name===ss.name?ls+1:ls},0);if(as>1){var os=ns.buildDuplicateRuleNameError({topLevelRule:ss,grammarName:rs});is.push({message:os,type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:ss.name})}return is}function validateRuleIsOverridden(ss,ts,rs){var ns=[],is;return contains(ts,ss)||(is="Invalid rule override, rule: ->"+ss+"<- cannot be overridden in the grammar: ->"+rs+"<-as it is not defined in any of the super grammars ",ns.push({message:is,type:ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:ss})),ns}function validateNoLeftRecursion(ss,ts,rs,ns){ns===void 0&&(ns=[]);var is=[],as=getFirstNoneTerminal(ts.definition);if(isEmpty(as))return[];var os=ss.name,ls=contains(as,ss);ls&&is.push({message:rs.buildLeftRecursionError({topLevelRule:ss,leftRecursionPath:ns}),type:ParserDefinitionErrorType.LEFT_RECURSION,ruleName:os});var us=difference(as,ns.concat([ss])),cs=map(us,function(ps){var ds=cloneArr(ns);return ds.push(ps),validateNoLeftRecursion(ss,ps,rs,ds)});return is.concat(flatten(cs))}function getFirstNoneTerminal(ss){var ts=[];if(isEmpty(ss))return ts;var rs=first$1(ss);if(rs instanceof NonTerminal)ts.push(rs.referencedRule);else if(rs instanceof Flat||rs instanceof Option||rs instanceof RepetitionMandatory||rs instanceof RepetitionMandatoryWithSeparator||rs instanceof RepetitionWithSeparator||rs instanceof Repetition)ts=ts.concat(getFirstNoneTerminal(rs.definition));else if(rs instanceof Alternation)ts=flatten(map(rs.definition,function(os){return getFirstNoneTerminal(os.definition)}));else if(!(rs instanceof Terminal))throw Error("non exhaustive match");var ns=isOptionalProd(rs),is=ss.length>1;if(ns&&is){var as=drop(ss);return ts.concat(getFirstNoneTerminal(as))}else return ts}var OrCollector=function(ss){__extends$2(ts,ss);function ts(){var rs=ss!==null&&ss.apply(this,arguments)||this;return rs.alternations=[],rs}return ts.prototype.visitAlternation=function(rs){this.alternations.push(rs)},ts}(GAstVisitor);function validateEmptyOrAlternative(ss,ts){var rs=new OrCollector;ss.accept(rs);var ns=rs.alternations,is=reduce(ns,function(as,os){var ls=dropRight(os.definition),us=map(ls,function(cs,ps){var ds=nextPossibleTokensAfter([cs],[],null,1);return isEmpty(ds)?{message:ts.buildEmptyAlternationError({topLevelRule:ss,alternation:os,emptyChoiceIdx:ps}),type:ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:ss.name,occurrence:os.idx,alternative:ps+1}:null});return as.concat(compact(us))},[]);return is}function validateAmbiguousAlternationAlternatives(ss,ts,rs,ns){var is=new OrCollector;ss.accept(is);var as=is.alternations,os=rs[ss.name];os&&(as=reject(as,function(us){return os[getProductionDslName(us)+(us.idx===0?"":us.idx)]})),as=reject(as,function(us){return us.ignoreAmbiguities===!0});var ls=reduce(as,function(us,cs){var ps=cs.idx,ds=cs.maxLookahead||ts,fs=getLookaheadPathsForOr(ps,ss,ds,cs),hs=checkAlternativesAmbiguities(fs,cs,ss,ns),ys=checkPrefixAlternativesAmbiguities(fs,cs,ss,ns);return us.concat(hs,ys)},[]);return ls}var RepetionCollector=function(ss){__extends$2(ts,ss);function ts(){var rs=ss!==null&&ss.apply(this,arguments)||this;return rs.allProductions=[],rs}return ts.prototype.visitRepetitionWithSeparator=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetitionMandatory=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetitionMandatoryWithSeparator=function(rs){this.allProductions.push(rs)},ts.prototype.visitRepetition=function(rs){this.allProductions.push(rs)},ts}(GAstVisitor);function validateTooManyAlts(ss,ts){var rs=new OrCollector;ss.accept(rs);var ns=rs.alternations,is=reduce(ns,function(as,os){return os.definition.length>255&&as.push({message:ts.buildTooManyAlternativesError({topLevelRule:ss,alternation:os}),type:ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:ss.name,occurrence:os.idx}),as},[]);return is}function validateSomeNonEmptyLookaheadPath(ss,ts,rs){var ns=[];return forEach$1(ss,function(is){var as=new RepetionCollector;is.accept(as);var os=as.allProductions;forEach$1(os,function(ls){var us=getProdType(ls),cs=ls.maxLookahead||ts,ps=ls.idx,ds=getLookaheadPathsForOptionalProd(ps,is,us,cs),fs=ds[0];if(isEmpty(flatten(fs))){var hs=rs.buildEmptyRepetitionError({topLevelRule:is,repetition:ls});ns.push({message:hs,type:ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:is.name})}})}),ns}function checkAlternativesAmbiguities(ss,ts,rs,ns){var is=[],as=reduce(ss,function(ls,us,cs){return ts.definition[cs].ignoreAmbiguities===!0||forEach$1(us,function(ps){var ds=[cs];forEach$1(ss,function(fs,hs){cs!==hs&&containsPath(fs,ps)&&ts.definition[hs].ignoreAmbiguities!==!0&&ds.push(hs)}),ds.length>1&&!containsPath(is,ps)&&(is.push(ps),ls.push({alts:ds,path:ps}))}),ls},[]),os=map(as,function(ls){var us=map(ls.alts,function(ps){return ps+1}),cs=ns.buildAlternationAmbiguityError({topLevelRule:rs,alternation:ts,ambiguityIndices:us,prefixPath:ls.path});return{message:cs,type:ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:rs.name,occurrence:ts.idx,alternatives:[ls.alts]}});return os}function checkPrefixAlternativesAmbiguities(ss,ts,rs,ns){var is=[],as=reduce(ss,function(os,ls,us){var cs=map(ls,function(ps){return{idx:us,path:ps}});return os.concat(cs)},[]);return forEach$1(as,function(os){var ls=ts.definition[os.idx];if(ls.ignoreAmbiguities!==!0){var us=os.idx,cs=os.path,ps=findAll(as,function(fs){return ts.definition[fs.idx].ignoreAmbiguities!==!0&&fs.idx<us&&isStrictPrefixOfPath(fs.path,cs)}),ds=map(ps,function(fs){var hs=[fs.idx+1,us+1],ys=ts.idx===0?"":ts.idx,gs=ns.buildAlternationPrefixAmbiguityError({topLevelRule:rs,alternation:ts,ambiguityIndices:hs,prefixPath:fs.path});return{message:gs,type:ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:rs.name,occurrence:ys,alternatives:hs}});is=is.concat(ds)}}),is}function checkTerminalAndNoneTerminalsNameSpace(ss,ts,rs){var ns=[],is=map(ts,function(as){return as.name});return forEach$1(ss,function(as){var os=as.name;if(contains(is,os)){var ls=rs.buildNamespaceConflictError(as);ns.push({message:ls,type:ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:os})}}),ns}function validateDuplicateNestedRules(ss,ts){var rs=[];return forEach$1(ss,function(ns){var is=new NamedDSLMethodsCollectorVisitor("");ns.accept(is);var as=groupBy(is.result,function(ls){return ls.name}),os=pick(as,function(ls){return ls.length>1});forEach$1(values(os),function(ls){var us=map(ls,function(ps){return ps.orgProd}),cs=ts.buildDuplicateNestedRuleNameError(ns,us);rs.push({message:cs,type:ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:ns.name})})}),rs}var defaultParserErrorProvider={buildMismatchTokenMessage:function(ss){var ts=ss.expected,rs=ss.actual;ss.previous,ss.ruleName;var ns=hasTokenLabel(ts),is=ns?"--> "+tokenLabel(ts)+" <--":"token of type --> "+ts.name+" <--",as="Expecting "+is+" but found --> '"+rs.image+"' <--";return as},buildNotAllInputParsedMessage:function(ss){var ts=ss.firstRedundant;return ss.ruleName,"Redundant input, expecting EOF but found: "+ts.image},buildNoViableAltMessage:function(ss){var ts=ss.expectedPathsPerAlt,rs=ss.actual;ss.previous;var ns=ss.customUserDescription;ss.ruleName;var is="Expecting: ",as=first$1(rs).image,os=`
but found: '`+as+"'";if(ns)return is+ns+os;var ls=reduce(ts,function(ds,fs){return ds.concat(fs)},[]),us=map(ls,function(ds){return"["+map(ds,function(fs){return tokenLabel(fs)}).join(", ")+"]"}),cs=map(us,function(ds,fs){return"  "+(fs+1)+". "+ds}),ps=`one of these possible Token sequences:
`+cs.join(`
`);return is+ps+os},buildEarlyExitMessage:function(ss){var ts=ss.expectedIterationPaths,rs=ss.actual,ns=ss.customUserDescription;ss.ruleName;var is="Expecting: ",as=first$1(rs).image,os=`
but found: '`+as+"'";if(ns)return is+ns+os;var ls=map(ts,function(cs){return"["+map(cs,function(ps){return tokenLabel(ps)}).join(",")+"]"}),us=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+ls.join(" ,")+">");return is+us+os}};Object.freeze(defaultParserErrorProvider);var defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(ss,ts){var rs="Invalid grammar, reference to a rule which is not defined: ->"+ts.nonTerminalName+`<-
inside top level rule: ->`+ss.name+"<-";return rs}},defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(ss,ts){function rs(ps){return ps instanceof Terminal?ps.terminalType.name:ps instanceof NonTerminal?ps.nonTerminalName:""}var ns=ss.name,is=first$1(ts),as=is.idx,os=getProductionDslName(is),ls=rs(is),us=as>0,cs="->"+os+(us?as:"")+"<- "+(ls?"with argument: ->"+ls+"<-":"")+`
                  appears more than once (`+ts.length+" times) in the top level rule: ->"+ns+`<-.                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return cs=cs.replace(/[ \t]+/g," "),cs=cs.replace(/\s\s+/g,`
`),cs},buildInvalidNestedRuleNameError:function(ss,ts){var rs="Invalid nested rule name: ->"+ts.name+"<- inside rule: ->"+ss.name+`<-
`+("it must match the pattern: ->"+validNestedRuleName.toString()+`<-.
`)+"Note that this means a nested rule name must start with the '$'(dollar) sign.";return rs},buildDuplicateNestedRuleNameError:function(ss,ts){var rs=first$1(ts).name,ns="Duplicate nested rule name: ->"+rs+"<- inside rule: ->"+ss.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`;return ns},buildNamespaceConflictError:function(ss){var ts=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+ss.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return ts},buildAlternationPrefixAmbiguityError:function(ss){var ts=map(ss.prefixPath,function(is){return tokenLabel(is)}).join(", "),rs=ss.alternation.idx===0?"":ss.alternation.idx,ns="Ambiguous alternatives: <"+ss.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+rs+"> inside <"+ss.topLevelRule.name+`> Rule,
`)+("<"+ts+`> may appears as a prefix path in all these alternatives.
`)+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return ns},buildAlternationAmbiguityError:function(ss){var ts=map(ss.prefixPath,function(is){return tokenLabel(is)}).join(", "),rs=ss.alternation.idx===0?"":ss.alternation.idx,ns="Ambiguous Alternatives Detected: <"+ss.ambiguityIndices.join(" ,")+"> in <OR"+rs+">"+(" inside <"+ss.topLevelRule.name+`> Rule,
`)+("<"+ts+`> may appears as a prefix path in all these alternatives.
`);return ns=ns+`See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,ns},buildEmptyRepetitionError:function(ss){var ts=getProductionDslName(ss.repetition);ss.repetition.idx!==0&&(ts+=ss.repetition.idx);var rs="The repetition <"+ts+"> within Rule <"+ss.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return rs},buildTokenNameError:function(ss){var ts=ss.tokenType.name,rs="Invalid Grammar Token name: ->"+ts+"<- it must match the pattern: ->"+ss.expectedPattern.toString()+"<-";return rs},buildEmptyAlternationError:function(ss){var ts="Ambiguous empty alternative: <"+(ss.emptyChoiceIdx+1)+">"+(" in <OR"+ss.alternation.idx+"> inside <"+ss.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return ts},buildTooManyAlternativesError:function(ss){var ts=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+ss.alternation.idx+"> inside <"+ss.topLevelRule.name+`> Rule.
 has `+(ss.alternation.definition.length+1)+" alternatives.");return ts},buildLeftRecursionError:function(ss){var ts=ss.topLevelRule.name,rs=map(ss.leftRecursionPath,function(as){return as.name}),ns=ts+" --> "+rs.concat([ts]).join(" --> "),is=`Left Recursion found in grammar.
`+("rule: <"+ts+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+ns+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return is},buildInvalidRuleNameError:function(ss){var ts=ss.topLevelRule.name,rs=ss.expectedPattern.toString(),ns="Invalid grammar rule name: ->"+ts+"<- it must match the pattern: ->"+rs+"<-";return ns},buildDuplicateRuleNameError:function(ss){var ts;ss.topLevelRule instanceof Rule?ts=ss.topLevelRule.name:ts=ss.topLevelRule;var rs="Duplicate definition, rule: ->"+ts+"<- is already defined in the grammar: ->"+ss.grammarName+"<-";return rs}},__extends$1=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}();function resolveGrammar$1(ss,ts){var rs=new GastRefResolverVisitor(ss,ts);return rs.resolveRefs(),rs.errors}var GastRefResolverVisitor=function(ss){__extends$1(ts,ss);function ts(rs,ns){var is=ss.call(this)||this;return is.nameToTopRule=rs,is.errMsgProvider=ns,is.errors=[],is}return ts.prototype.resolveRefs=function(){var rs=this;forEach$1(values(this.nameToTopRule),function(ns){rs.currTopLevel=ns,ns.accept(rs)})},ts.prototype.visitNonTerminal=function(rs){var ns=this.nameToTopRule[rs.nonTerminalName];if(ns)rs.referencedRule=ns;else{var is=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,rs);this.errors.push({message:is,type:ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:rs.nonTerminalName})}},ts}(GAstVisitor);function resolveGrammar(ss){ss=defaults$4(ss,{errMsgProvider:defaultGrammarResolverErrorProvider});var ts={};return forEach$1(ss.rules,function(rs){ts[rs.name]=rs}),resolveGrammar$1(ts,ss.errMsgProvider)}function validateGrammar(ss){return ss=defaults$4(ss,{errMsgProvider:defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),validateGrammar$1(ss.rules,ss.maxLookahead,ss.tokenTypes,ss.ignoredIssues,ss.errMsgProvider,ss.grammarName)}var MISMATCHED_TOKEN_EXCEPTION="MismatchedTokenException",NO_VIABLE_ALT_EXCEPTION="NoViableAltException",EARLY_EXIT_EXCEPTION="EarlyExitException",NOT_ALL_INPUT_PARSED_EXCEPTION="NotAllInputParsedException",RECOGNITION_EXCEPTION_NAMES=[MISMATCHED_TOKEN_EXCEPTION,NO_VIABLE_ALT_EXCEPTION,EARLY_EXIT_EXCEPTION,NOT_ALL_INPUT_PARSED_EXCEPTION];Object.freeze(RECOGNITION_EXCEPTION_NAMES);function isRecognitionException(ss){return contains(RECOGNITION_EXCEPTION_NAMES,ss.name)}function MismatchedTokenException(ss,ts,rs){this.name=MISMATCHED_TOKEN_EXCEPTION,this.message=ss,this.token=ts,this.previousToken=rs,this.resyncedTokens=[]}MismatchedTokenException.prototype=Error.prototype;function NoViableAltException(ss,ts,rs){this.name=NO_VIABLE_ALT_EXCEPTION,this.message=ss,this.token=ts,this.previousToken=rs,this.resyncedTokens=[]}NoViableAltException.prototype=Error.prototype;function NotAllInputParsedException(ss,ts){this.name=NOT_ALL_INPUT_PARSED_EXCEPTION,this.message=ss,this.token=ts,this.resyncedTokens=[]}NotAllInputParsedException.prototype=Error.prototype;function EarlyExitException(ss,ts,rs){this.name=EARLY_EXIT_EXCEPTION,this.message=ss,this.token=ts,this.previousToken=rs,this.resyncedTokens=[]}EarlyExitException.prototype=Error.prototype;var EOF_FOLLOW_KEY={},IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";function InRuleRecoveryException(ss){this.name=IN_RULE_RECOVERY_EXCEPTION,this.message=ss}InRuleRecoveryException.prototype=Error.prototype;var Recoverable=function(){function ss(){}return ss.prototype.initRecoverable=function(ts){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=has(ts,"recoveryEnabled")?ts.recoveryEnabled:DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=attemptInRepetitionRecovery)},ss.prototype.getTokenToInsert=function(ts){var rs=createTokenInstance(ts,"",NaN,NaN,NaN,NaN,NaN,NaN);return rs.isInsertedInRecovery=!0,rs},ss.prototype.canTokenTypeBeInsertedInRecovery=function(ts){return!0},ss.prototype.tryInRepetitionRecovery=function(ts,rs,ns,is){for(var as=this,os=this.findReSyncTokenType(),ls=this.exportLexerState(),us=[],cs=!1,ps=this.LA(1),ds=this.LA(1),fs=function(){var hs=as.LA(0),ys=as.errorMessageProvider.buildMismatchTokenMessage({expected:is,actual:ps,previous:hs,ruleName:as.getCurrRuleFullName()}),gs=new MismatchedTokenException(ys,ps,as.LA(0));gs.resyncedTokens=dropRight(us),as.SAVE_ERROR(gs)};!cs;)if(this.tokenMatcher(ds,is)){fs();return}else if(ns.call(this)){fs(),ts.apply(this,rs);return}else this.tokenMatcher(ds,os)?cs=!0:(ds=this.SKIP_TOKEN(),this.addToResyncTokens(ds,us));this.importLexerState(ls)},ss.prototype.shouldInRepetitionRecoveryBeTried=function(ts,rs,ns){return!(ns===!1||ts===void 0||rs===void 0||this.tokenMatcher(this.LA(1),ts)||this.isBackTracking()||this.canPerformInRuleRecovery(ts,this.getFollowsForInRuleRecovery(ts,rs)))},ss.prototype.getFollowsForInRuleRecovery=function(ts,rs){var ns=this.getCurrentGrammarPath(ts,rs),is=this.getNextPossibleTokenTypes(ns);return is},ss.prototype.tryInRuleRecovery=function(ts,rs){if(this.canRecoverWithSingleTokenInsertion(ts,rs)){var ns=this.getTokenToInsert(ts);return ns}if(this.canRecoverWithSingleTokenDeletion(ts)){var is=this.SKIP_TOKEN();return this.consumeToken(),is}throw new InRuleRecoveryException("sad sad panda")},ss.prototype.canPerformInRuleRecovery=function(ts,rs){return this.canRecoverWithSingleTokenInsertion(ts,rs)||this.canRecoverWithSingleTokenDeletion(ts)},ss.prototype.canRecoverWithSingleTokenInsertion=function(ts,rs){var ns=this;if(!this.canTokenTypeBeInsertedInRecovery(ts)||isEmpty(rs))return!1;var is=this.LA(1),as=find(rs,function(os){return ns.tokenMatcher(is,os)})!==void 0;return as},ss.prototype.canRecoverWithSingleTokenDeletion=function(ts){var rs=this.tokenMatcher(this.LA(2),ts);return rs},ss.prototype.isInCurrentRuleReSyncSet=function(ts){var rs=this.getCurrFollowKey(),ns=this.getFollowSetFromFollowKey(rs);return contains(ns,ts)},ss.prototype.findReSyncTokenType=function(){for(var ts=this.flattenFollowSet(),rs=this.LA(1),ns=2;;){var is=rs.tokenType;if(contains(ts,is))return is;rs=this.LA(ns),ns++}},ss.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return EOF_FOLLOW_KEY;var ts=this.getLastExplicitRuleShortName(),rs=this.getLastExplicitRuleOccurrenceIndex(),ns=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(ts),idxInCallingRule:rs,inRule:this.shortRuleNameToFullName(ns)}},ss.prototype.buildFullFollowKeyStack=function(){var ts=this,rs=this.RULE_STACK,ns=this.RULE_OCCURRENCE_STACK;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(rs=map(this.LAST_EXPLICIT_RULE_STACK,function(is){return ts.RULE_STACK[is]}),ns=map(this.LAST_EXPLICIT_RULE_STACK,function(is){return ts.RULE_OCCURRENCE_STACK[is]})),map(rs,function(is,as){return as===0?EOF_FOLLOW_KEY:{ruleName:ts.shortRuleNameToFullName(is),idxInCallingRule:ns[as],inRule:ts.shortRuleNameToFullName(rs[as-1])}})},ss.prototype.flattenFollowSet=function(){var ts=this,rs=map(this.buildFullFollowKeyStack(),function(ns){return ts.getFollowSetFromFollowKey(ns)});return flatten(rs)},ss.prototype.getFollowSetFromFollowKey=function(ts){if(ts===EOF_FOLLOW_KEY)return[EOF];var rs=ts.ruleName+ts.idxInCallingRule+IN+ts.inRule;return this.resyncFollows[rs]},ss.prototype.addToResyncTokens=function(ts,rs){return this.tokenMatcher(ts,EOF)||rs.push(ts),rs},ss.prototype.reSyncTo=function(ts){for(var rs=[],ns=this.LA(1);this.tokenMatcher(ns,ts)===!1;)ns=this.SKIP_TOKEN(),this.addToResyncTokens(ns,rs);return dropRight(rs)},ss.prototype.attemptInRepetitionRecovery=function(ts,rs,ns,is,as,os,ls){},ss.prototype.getCurrentGrammarPath=function(ts,rs){var ns=this.getHumanReadableRuleStack(),is=cloneArr(this.RULE_OCCURRENCE_STACK),as={ruleStack:ns,occurrenceStack:is,lastTok:ts,lastTokOccurrence:rs};return as},ss.prototype.getHumanReadableRuleStack=function(){var ts=this;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)?map(this.RULE_STACK,function(rs){return ts.shortRuleNameToFullName(rs)}):map(this.LAST_EXPLICIT_RULE_STACK,function(rs){return ts.shortRuleNameToFullName(ts.RULE_STACK[rs])})},ss}();function attemptInRepetitionRecovery(ss,ts,rs,ns,is,as,os){var ls=this.getKeyForAutomaticLookahead(ns,is),us=this.firstAfterRepMap[ls];if(us===void 0){var cs=this.getCurrRuleFullName(),ps=this.getGAstProductions()[cs],ds=new as(ps,is);us=ds.startWalking(),this.firstAfterRepMap[ls]=us}var fs=us.token,hs=us.occurrence,ys=us.isEndOfRule;this.RULE_STACK.length===1&&ys&&fs===void 0&&(fs=EOF,hs=1),this.shouldInRepetitionRecoveryBeTried(fs,hs,os)&&this.tryInRepetitionRecovery(ss,ts,rs,fs)}var LooksAhead=function(){function ss(){}return ss.prototype.initLooksAhead=function(ts){this.dynamicTokensEnabled=has(ts,"dynamicTokensEnabled")?ts.dynamicTokensEnabled:DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=has(ts,"maxLookahead")?ts.maxLookahead:DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=isES2015MapSupported()?new Map:[],isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},ss.prototype.preComputeLookaheadFunctions=function(ts){var rs=this;forEach$1(ts,function(ns){rs.TRACE_INIT(ns.name+" Rule Lookahead",function(){var is=collectMethods(ns),as=is.alternation,os=is.repetition,ls=is.option,us=is.repetitionMandatory,cs=is.repetitionMandatoryWithSeparator,ps=is.repetitionWithSeparator;forEach$1(as,function(ds){var fs=ds.idx===0?"":ds.idx;rs.TRACE_INIT(""+getProductionDslName(ds)+fs,function(){var hs=buildLookaheadFuncForOr(ds.idx,ns,ds.maxLookahead||rs.maxLookahead,ds.hasPredicates,rs.dynamicTokensEnabled,rs.lookAheadBuilderForAlternatives),ys=getKeyForAutomaticLookahead(rs.fullRuleNameToShort[ns.name],OR_IDX,ds.idx);rs.setLaFuncCache(ys,hs)})}),forEach$1(os,function(ds){rs.computeLookaheadFunc(ns,ds.idx,MANY_IDX,PROD_TYPE.REPETITION,ds.maxLookahead,getProductionDslName(ds))}),forEach$1(ls,function(ds){rs.computeLookaheadFunc(ns,ds.idx,OPTION_IDX,PROD_TYPE.OPTION,ds.maxLookahead,getProductionDslName(ds))}),forEach$1(us,function(ds){rs.computeLookaheadFunc(ns,ds.idx,AT_LEAST_ONE_IDX,PROD_TYPE.REPETITION_MANDATORY,ds.maxLookahead,getProductionDslName(ds))}),forEach$1(cs,function(ds){rs.computeLookaheadFunc(ns,ds.idx,AT_LEAST_ONE_SEP_IDX,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,ds.maxLookahead,getProductionDslName(ds))}),forEach$1(ps,function(ds){rs.computeLookaheadFunc(ns,ds.idx,MANY_SEP_IDX,PROD_TYPE.REPETITION_WITH_SEPARATOR,ds.maxLookahead,getProductionDslName(ds))})})})},ss.prototype.computeLookaheadFunc=function(ts,rs,ns,is,as,os){var ls=this;this.TRACE_INIT(""+os+(rs===0?"":rs),function(){var us=buildLookaheadFuncForOptionalProd(rs,ts,as||ls.maxLookahead,ls.dynamicTokensEnabled,is,ls.lookAheadBuilderForOptional),cs=getKeyForAutomaticLookahead(ls.fullRuleNameToShort[ts.name],ns,rs);ls.setLaFuncCache(cs,us)})},ss.prototype.lookAheadBuilderForOptional=function(ts,rs,ns){return buildSingleAlternativeLookaheadFunction(ts,rs,ns)},ss.prototype.lookAheadBuilderForAlternatives=function(ts,rs,ns,is){return buildAlternativesLookAheadFunc(ts,rs,ns,is)},ss.prototype.getKeyForAutomaticLookahead=function(ts,rs){var ns=this.getLastExplicitRuleShortName();return getKeyForAutomaticLookahead(ns,ts,rs)},ss.prototype.getLaFuncFromCache=function(ts){},ss.prototype.getLaFuncFromMap=function(ts){return this.lookAheadFuncsCache.get(ts)},ss.prototype.getLaFuncFromObj=function(ts){return this.lookAheadFuncsCache[ts]},ss.prototype.setLaFuncCache=function(ts,rs){},ss.prototype.setLaFuncCacheUsingMap=function(ts,rs){this.lookAheadFuncsCache.set(ts,rs)},ss.prototype.setLaFuncUsingObj=function(ts,rs){this.lookAheadFuncsCache[ts]=rs},ss}();function classNameFromInstance(ss){return functionName(ss.constructor)}var FUNC_NAME_REGEXP=/^\s*function\s*(\S*)\s*\(/,NAME="name";function functionName(ss){var ts=ss.name;if(ts)return ts;var rs=ss.toString().match(FUNC_NAME_REGEXP)[1];return rs}function defineNameProp(ss,ts){var rs=Object.getOwnPropertyDescriptor(ss,NAME);return isUndefined$1(rs)||rs.configurable?(Object.defineProperty(ss,NAME,{enumerable:!1,configurable:!0,writable:!1,value:ts}),!0):!1}function defaultVisit(ss,ts){for(var rs=keys(ss),ns=rs.length,is=0;is<ns;is++)for(var as=rs[is],os=ss[as],ls=os.length,us=0;us<ls;us++){var cs=os[us];cs.tokenTypeIdx===void 0&&(cs.fullName!==void 0?this[cs.fullName](cs.children,ts):this[cs.name](cs.children,ts))}}function createBaseSemanticVisitorConstructor(ss,ts){var rs=function(){};defineNameProp(rs,ss+"BaseSemantics");var ns={visit:function(is,as){if(isArray$2(is)&&(is=is[0]),!isUndefined$1(is))return is.fullName!==void 0?this[is.fullName](is.children,as):this[is.name](is.children,as)},validateVisitor:function(){var is=validateVisitor(this,ts);if(!isEmpty(is)){var as=map(is,function(os){return os.msg});throw Error("Errors Detected in CST Visitor <"+functionName(this.constructor)+`>:
	`+(""+as.join(`

`).replace(/\n/g,`
	`)))}}};return rs.prototype=ns,rs.prototype.constructor=rs,rs._RULE_NAMES=ts,rs}function createBaseVisitorConstructorWithDefaults(ss,ts,rs){var ns=function(){};defineNameProp(ns,ss+"BaseSemanticsWithDefaults");var is=Object.create(rs.prototype);return forEach$1(ts,function(as){is[as]=defaultVisit}),ns.prototype=is,ns.prototype.constructor=ns,ns}var CstVisitorDefinitionError;(function(ss){ss[ss.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",ss[ss.MISSING_METHOD=1]="MISSING_METHOD"})(CstVisitorDefinitionError||(CstVisitorDefinitionError={}));function validateVisitor(ss,ts){var rs=validateMissingCstMethods(ss,ts),ns=validateRedundantMethods(ss,ts);return rs.concat(ns)}function validateMissingCstMethods(ss,ts){var rs=map(ts,function(ns){if(!isFunction$1(ss[ns]))return{msg:"Missing visitor method: <"+ns+"> on "+functionName(ss.constructor)+" CST Visitor.",type:CstVisitorDefinitionError.MISSING_METHOD,methodName:ns}});return compact(rs)}var VALID_PROP_NAMES=["constructor","visit","validateVisitor"];function validateRedundantMethods(ss,ts){var rs=[];for(var ns in ss)validTermsPattern.test(ns)&&isFunction$1(ss[ns])&&!contains(VALID_PROP_NAMES,ns)&&!contains(ts,ns)&&rs.push({msg:"Redundant visitor method: <"+ns+"> on "+functionName(ss.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+("For utility methods on visitor classes use methods names that do not match /"+validTermsPattern.source+"/."),type:CstVisitorDefinitionError.REDUNDANT_METHOD,methodName:ns});return rs}var TreeBuilder=function(){function ss(){}return ss.prototype.initTreeBuilder=function(ts){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=has(ts,"outputCst")?ts.outputCst:DEFAULT_PARSER_CONFIG.outputCst,this.nodeLocationTracking=has(ts,"nodeLocationTracking")?ts.nodeLocationTracking:DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=NOOP,this.cstFinallyStateUpdate=NOOP,this.cstPostTerminal=NOOP,this.cstPostNonTerminal=NOOP,this.cstPostRule=NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationFull,this.setNodeLocationFromNode=setNodeLocationFull,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationOnlyOffset,this.setNodeLocationFromNode=setNodeLocationOnlyOffset,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=NOOP,this.setInitialNodeLocation=NOOP;else throw Error('Invalid <nodeLocationTracking> config option: "'+ts.nodeLocationTracking+'"')},ss.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(ts){ts.location={startOffset:NaN,endOffset:NaN}},ss.prototype.setInitialNodeLocationOnlyOffsetRegular=function(ts){ts.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},ss.prototype.setInitialNodeLocationFullRecovery=function(ts){ts.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},ss.prototype.setInitialNodeLocationFullRegular=function(ts){var rs=this.LA(1);ts.location={startOffset:rs.startOffset,startLine:rs.startLine,startColumn:rs.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},ss.prototype.cstNestedInvocationStateUpdate=function(ts,rs){var ns={name:ts,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+ts,children:{}};this.setInitialNodeLocation(ns),this.CST_STACK.push(ns)},ss.prototype.cstInvocationStateUpdate=function(ts,rs){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var ns={name:ts,children:{}};this.setInitialNodeLocation(ns),this.CST_STACK.push(ns)},ss.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},ss.prototype.cstNestedFinallyStateUpdate=function(){var ts=this.CST_STACK.pop();this.cstPostRule(ts)},ss.prototype.cstPostRuleFull=function(ts){var rs=this.LA(0),ns=ts.location;ns.startOffset<=rs.startOffset?(ns.endOffset=rs.endOffset,ns.endLine=rs.endLine,ns.endColumn=rs.endColumn):(ns.startOffset=NaN,ns.startLine=NaN,ns.startColumn=NaN)},ss.prototype.cstPostRuleOnlyOffset=function(ts){var rs=this.LA(0),ns=ts.location;ns.startOffset<=rs.startOffset?ns.endOffset=rs.endOffset:ns.startOffset=NaN},ss.prototype.cstPostTerminal=function(ts,rs){var ns=this.CST_STACK[this.CST_STACK.length-1];addTerminalToCst(ns,rs,ts),this.setNodeLocationFromToken(ns.location,rs)},ss.prototype.cstPostNonTerminal=function(ts,rs){if(this.isBackTracking()!==!0){var ns=this.CST_STACK[this.CST_STACK.length-1];addNoneTerminalToCst(ns,rs,ts),this.setNodeLocationFromNode(ns.location,ts.location)}},ss.prototype.getBaseCstVisitorConstructor=function(){if(isUndefined$1(this.baseCstVisitorConstructor)){var ts=createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=ts,ts}return this.baseCstVisitorConstructor},ss.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(isUndefined$1(this.baseCstVisitorWithDefaultsConstructor)){var ts=createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=ts,ts}return this.baseCstVisitorWithDefaultsConstructor},ss.prototype.nestedRuleBeforeClause=function(ts,rs){var ns;if(ts.NAME!==void 0)return ns=ts.NAME,this.nestedRuleInvocationStateUpdate(ns,rs),ns},ss.prototype.nestedAltBeforeClause=function(ts,rs,ns,is){var as=this.getLastExplicitRuleShortName(),os=getKeyForAltIndex(as,ns,rs,is),ls;if(ts.NAME!==void 0)return ls=ts.NAME,this.nestedRuleInvocationStateUpdate(ls,os),{shortName:os,nestedName:ls}},ss.prototype.nestedRuleFinallyClause=function(ts,rs){var ns=this.CST_STACK,is=ns[ns.length-1];this.nestedRuleFinallyStateUpdate();var as=ns[ns.length-1];addNoneTerminalToCst(as,rs,is),this.setNodeLocationFromNode(as.location,is.location)},ss.prototype.getLastExplicitRuleShortName=function(){var ts=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[ts]},ss.prototype.getLastExplicitRuleShortNameNoCst=function(){var ts=this.RULE_STACK;return ts[ts.length-1]},ss.prototype.getPreviousExplicitRuleShortName=function(){var ts=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[ts]},ss.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var ts=this.RULE_STACK;return ts[ts.length-2]},ss.prototype.getLastExplicitRuleOccurrenceIndex=function(){var ts=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[ts]},ss.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var ts=this.RULE_OCCURRENCE_STACK;return ts[ts.length-1]},ss.prototype.nestedRuleInvocationStateUpdate=function(ts,rs){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(rs),this.cstNestedInvocationStateUpdate(ts,rs)},ss.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},ss}(),LexerAdapter=function(){function ss(){}return ss.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(ss.prototype,"input",{get:function(){return this.tokVector},set:function(ts){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=ts,this.tokVectorLength=ts.length},enumerable:!0,configurable:!0}),ss.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):END_OF_FILE},ss.prototype.LA=function(ts){var rs=this.currIdx+ts;return rs<0||this.tokVectorLength<=rs?END_OF_FILE:this.tokVector[rs]},ss.prototype.consumeToken=function(){this.currIdx++},ss.prototype.exportLexerState=function(){return this.currIdx},ss.prototype.importLexerState=function(ts){this.currIdx=ts},ss.prototype.resetLexerState=function(){this.currIdx=-1},ss.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},ss.prototype.getLexerPosition=function(){return this.exportLexerState()},ss}(),RecognizerApi=function(){function ss(){}return ss.prototype.ACTION=function(ts){return ts.call(this)},ss.prototype.consume=function(ts,rs,ns){return this.consumeInternal(rs,ts,ns)},ss.prototype.subrule=function(ts,rs,ns){return this.subruleInternal(rs,ts,ns)},ss.prototype.option=function(ts,rs){return this.optionInternal(rs,ts)},ss.prototype.or=function(ts,rs){return this.orInternal(rs,ts)},ss.prototype.many=function(ts,rs){return this.manyInternal(ts,rs)},ss.prototype.atLeastOne=function(ts,rs){return this.atLeastOneInternal(ts,rs)},ss.prototype.CONSUME=function(ts,rs){return this.consumeInternal(ts,0,rs)},ss.prototype.CONSUME1=function(ts,rs){return this.consumeInternal(ts,1,rs)},ss.prototype.CONSUME2=function(ts,rs){return this.consumeInternal(ts,2,rs)},ss.prototype.CONSUME3=function(ts,rs){return this.consumeInternal(ts,3,rs)},ss.prototype.CONSUME4=function(ts,rs){return this.consumeInternal(ts,4,rs)},ss.prototype.CONSUME5=function(ts,rs){return this.consumeInternal(ts,5,rs)},ss.prototype.CONSUME6=function(ts,rs){return this.consumeInternal(ts,6,rs)},ss.prototype.CONSUME7=function(ts,rs){return this.consumeInternal(ts,7,rs)},ss.prototype.CONSUME8=function(ts,rs){return this.consumeInternal(ts,8,rs)},ss.prototype.CONSUME9=function(ts,rs){return this.consumeInternal(ts,9,rs)},ss.prototype.SUBRULE=function(ts,rs){return this.subruleInternal(ts,0,rs)},ss.prototype.SUBRULE1=function(ts,rs){return this.subruleInternal(ts,1,rs)},ss.prototype.SUBRULE2=function(ts,rs){return this.subruleInternal(ts,2,rs)},ss.prototype.SUBRULE3=function(ts,rs){return this.subruleInternal(ts,3,rs)},ss.prototype.SUBRULE4=function(ts,rs){return this.subruleInternal(ts,4,rs)},ss.prototype.SUBRULE5=function(ts,rs){return this.subruleInternal(ts,5,rs)},ss.prototype.SUBRULE6=function(ts,rs){return this.subruleInternal(ts,6,rs)},ss.prototype.SUBRULE7=function(ts,rs){return this.subruleInternal(ts,7,rs)},ss.prototype.SUBRULE8=function(ts,rs){return this.subruleInternal(ts,8,rs)},ss.prototype.SUBRULE9=function(ts,rs){return this.subruleInternal(ts,9,rs)},ss.prototype.OPTION=function(ts){return this.optionInternal(ts,0)},ss.prototype.OPTION1=function(ts){return this.optionInternal(ts,1)},ss.prototype.OPTION2=function(ts){return this.optionInternal(ts,2)},ss.prototype.OPTION3=function(ts){return this.optionInternal(ts,3)},ss.prototype.OPTION4=function(ts){return this.optionInternal(ts,4)},ss.prototype.OPTION5=function(ts){return this.optionInternal(ts,5)},ss.prototype.OPTION6=function(ts){return this.optionInternal(ts,6)},ss.prototype.OPTION7=function(ts){return this.optionInternal(ts,7)},ss.prototype.OPTION8=function(ts){return this.optionInternal(ts,8)},ss.prototype.OPTION9=function(ts){return this.optionInternal(ts,9)},ss.prototype.OR=function(ts){return this.orInternal(ts,0)},ss.prototype.OR1=function(ts){return this.orInternal(ts,1)},ss.prototype.OR2=function(ts){return this.orInternal(ts,2)},ss.prototype.OR3=function(ts){return this.orInternal(ts,3)},ss.prototype.OR4=function(ts){return this.orInternal(ts,4)},ss.prototype.OR5=function(ts){return this.orInternal(ts,5)},ss.prototype.OR6=function(ts){return this.orInternal(ts,6)},ss.prototype.OR7=function(ts){return this.orInternal(ts,7)},ss.prototype.OR8=function(ts){return this.orInternal(ts,8)},ss.prototype.OR9=function(ts){return this.orInternal(ts,9)},ss.prototype.MANY=function(ts){this.manyInternal(0,ts)},ss.prototype.MANY1=function(ts){this.manyInternal(1,ts)},ss.prototype.MANY2=function(ts){this.manyInternal(2,ts)},ss.prototype.MANY3=function(ts){this.manyInternal(3,ts)},ss.prototype.MANY4=function(ts){this.manyInternal(4,ts)},ss.prototype.MANY5=function(ts){this.manyInternal(5,ts)},ss.prototype.MANY6=function(ts){this.manyInternal(6,ts)},ss.prototype.MANY7=function(ts){this.manyInternal(7,ts)},ss.prototype.MANY8=function(ts){this.manyInternal(8,ts)},ss.prototype.MANY9=function(ts){this.manyInternal(9,ts)},ss.prototype.MANY_SEP=function(ts){this.manySepFirstInternal(0,ts)},ss.prototype.MANY_SEP1=function(ts){this.manySepFirstInternal(1,ts)},ss.prototype.MANY_SEP2=function(ts){this.manySepFirstInternal(2,ts)},ss.prototype.MANY_SEP3=function(ts){this.manySepFirstInternal(3,ts)},ss.prototype.MANY_SEP4=function(ts){this.manySepFirstInternal(4,ts)},ss.prototype.MANY_SEP5=function(ts){this.manySepFirstInternal(5,ts)},ss.prototype.MANY_SEP6=function(ts){this.manySepFirstInternal(6,ts)},ss.prototype.MANY_SEP7=function(ts){this.manySepFirstInternal(7,ts)},ss.prototype.MANY_SEP8=function(ts){this.manySepFirstInternal(8,ts)},ss.prototype.MANY_SEP9=function(ts){this.manySepFirstInternal(9,ts)},ss.prototype.AT_LEAST_ONE=function(ts){this.atLeastOneInternal(0,ts)},ss.prototype.AT_LEAST_ONE1=function(ts){return this.atLeastOneInternal(1,ts)},ss.prototype.AT_LEAST_ONE2=function(ts){this.atLeastOneInternal(2,ts)},ss.prototype.AT_LEAST_ONE3=function(ts){this.atLeastOneInternal(3,ts)},ss.prototype.AT_LEAST_ONE4=function(ts){this.atLeastOneInternal(4,ts)},ss.prototype.AT_LEAST_ONE5=function(ts){this.atLeastOneInternal(5,ts)},ss.prototype.AT_LEAST_ONE6=function(ts){this.atLeastOneInternal(6,ts)},ss.prototype.AT_LEAST_ONE7=function(ts){this.atLeastOneInternal(7,ts)},ss.prototype.AT_LEAST_ONE8=function(ts){this.atLeastOneInternal(8,ts)},ss.prototype.AT_LEAST_ONE9=function(ts){this.atLeastOneInternal(9,ts)},ss.prototype.AT_LEAST_ONE_SEP=function(ts){this.atLeastOneSepFirstInternal(0,ts)},ss.prototype.AT_LEAST_ONE_SEP1=function(ts){this.atLeastOneSepFirstInternal(1,ts)},ss.prototype.AT_LEAST_ONE_SEP2=function(ts){this.atLeastOneSepFirstInternal(2,ts)},ss.prototype.AT_LEAST_ONE_SEP3=function(ts){this.atLeastOneSepFirstInternal(3,ts)},ss.prototype.AT_LEAST_ONE_SEP4=function(ts){this.atLeastOneSepFirstInternal(4,ts)},ss.prototype.AT_LEAST_ONE_SEP5=function(ts){this.atLeastOneSepFirstInternal(5,ts)},ss.prototype.AT_LEAST_ONE_SEP6=function(ts){this.atLeastOneSepFirstInternal(6,ts)},ss.prototype.AT_LEAST_ONE_SEP7=function(ts){this.atLeastOneSepFirstInternal(7,ts)},ss.prototype.AT_LEAST_ONE_SEP8=function(ts){this.atLeastOneSepFirstInternal(8,ts)},ss.prototype.AT_LEAST_ONE_SEP9=function(ts){this.atLeastOneSepFirstInternal(9,ts)},ss.prototype.RULE=function(ts,rs,ns){if(ns===void 0&&(ns=DEFAULT_RULE_CONFIG),contains(this.definedRulesNames,ts)){var is=defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:ts,grammarName:this.className}),as={message:is,type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:ts};this.definitionErrors.push(as)}this.definedRulesNames.push(ts);var os=this.defineRule(ts,rs,ns);return this[ts]=os,os},ss.prototype.OVERRIDE_RULE=function(ts,rs,ns){ns===void 0&&(ns=DEFAULT_RULE_CONFIG);var is=[];is=is.concat(validateRuleIsOverridden(ts,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,is);var as=this.defineRule(ts,rs,ns);return this[ts]=as,as},ss.prototype.BACKTRACK=function(ts,rs){return function(){this.isBackTrackingStack.push(1);var ns=this.saveRecogState();try{return ts.apply(this,rs),!0}catch(is){if(isRecognitionException(is))return!1;throw is}finally{this.reloadRecogState(ns),this.isBackTrackingStack.pop()}}},ss.prototype.getGAstProductions=function(){return this.gastProductionsCache},ss.prototype.getSerializedGastProductions=function(){return serializeGrammar(values(this.gastProductionsCache))},ss}(),RecognizerEngine=function(){function ss(){}return ss.prototype.initRecognizerEngine=function(ts,rs){if(this.className=classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},has(rs,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(isArray$2(ts)){if(isEmpty(ts))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof ts[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(isArray$2(ts))this.tokensMap=reduce(ts,function(os,ls){return os[ls.name]=ls,os},{});else if(has(ts,"modes")&&every(flatten(values(ts.modes)),isTokenType)){var ns=flatten(values(ts.modes)),is=uniq(ns);this.tokensMap=reduce(is,function(os,ls){return os[ls.name]=ls,os},{})}else if(isObject$1(ts))this.tokensMap=cloneObj(ts);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=EOF;var as=every(values(ts),function(os){return isEmpty(os.categoryMatches)});this.tokenMatcher=as?tokenStructuredMatcherNoCategories:tokenStructuredMatcher,augmentTokenTypes(values(this.tokensMap))},ss.prototype.defineRule=function(ts,rs,ns){if(this.selfAnalysisDone)throw Error("Grammar rule <"+ts+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var is=has(ns,"resyncEnabled")?ns.resyncEnabled:DEFAULT_RULE_CONFIG.resyncEnabled,as=has(ns,"recoveryValueFunc")?ns.recoveryValueFunc:DEFAULT_RULE_CONFIG.recoveryValueFunc,os=this.ruleShortNameIdx<<BITS_FOR_METHOD_TYPE+BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull[os]=ts,this.fullRuleNameToShort[ts]=os;function ls(ps){try{if(this.outputCst===!0){rs.apply(this,ps);var ds=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(ds),ds}else return rs.apply(this,ps)}catch(fs){return this.invokeRuleCatch(fs,is,as)}finally{this.ruleFinallyStateUpdate()}}var us;us=function(ps,ds){return ps===void 0&&(ps=0),this.ruleInvocationStateUpdate(os,ts,ps),ls.call(this,ds)};var cs="ruleName";return us[cs]=ts,us.originalGrammarAction=rs,us},ss.prototype.invokeRuleCatch=function(ts,rs,ns){var is=this.RULE_STACK.length===1,as=rs&&!this.isBackTracking()&&this.recoveryEnabled;if(isRecognitionException(ts)){var os=ts;if(as){var ls=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(ls))if(os.resyncedTokens=this.reSyncTo(ls),this.outputCst){var us=this.CST_STACK[this.CST_STACK.length-1];return us.recoveredNode=!0,us}else return ns();else{if(this.outputCst){var us=this.CST_STACK[this.CST_STACK.length-1];us.recoveredNode=!0,os.partialCstResult=us}throw os}}else{if(is)return this.moveToTerminatedState(),ns();throw os}}else throw ts},ss.prototype.optionInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(OPTION_IDX,rs),is=this.nestedRuleBeforeClause(ts,ns);try{return this.optionInternalLogic(ts,rs,ns)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.optionInternalNoCst=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(OPTION_IDX,rs);return this.optionInternalLogic(ts,rs,ns)},ss.prototype.optionInternalLogic=function(ts,rs,ns){var is=this,as=this.getLaFuncFromCache(ns),os,ls;if(ts.DEF!==void 0){if(os=ts.DEF,ls=ts.GATE,ls!==void 0){var us=as;as=function(){return ls.call(is)&&us.call(is)}}}else os=ts;if(as.call(this)===!0)return os.call(this)},ss.prototype.atLeastOneInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,ts),is=this.nestedRuleBeforeClause(rs,ns);try{return this.atLeastOneInternalLogic(ts,rs,ns)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.atLeastOneInternalNoCst=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,ts);this.atLeastOneInternalLogic(ts,rs,ns)},ss.prototype.atLeastOneInternalLogic=function(ts,rs,ns){var is=this,as=this.getLaFuncFromCache(ns),os,ls;if(rs.DEF!==void 0){if(os=rs.DEF,ls=rs.GATE,ls!==void 0){var us=as;as=function(){return ls.call(is)&&us.call(is)}}}else os=rs;if(as.call(this)===!0)for(var cs=this.doSingleRepetition(os);as.call(this)===!0&&cs===!0;)cs=this.doSingleRepetition(os);else throw this.raiseEarlyExitException(ts,PROD_TYPE.REPETITION_MANDATORY,rs.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[ts,rs],as,AT_LEAST_ONE_IDX,ts,NextTerminalAfterAtLeastOneWalker)},ss.prototype.atLeastOneSepFirstInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,ts),is=this.nestedRuleBeforeClause(rs,ns);try{this.atLeastOneSepFirstInternalLogic(ts,rs,ns)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.atLeastOneSepFirstInternalNoCst=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,ts);this.atLeastOneSepFirstInternalLogic(ts,rs,ns)},ss.prototype.atLeastOneSepFirstInternalLogic=function(ts,rs,ns){var is=this,as=rs.DEF,os=rs.SEP,ls=this.getLaFuncFromCache(ns);if(ls.call(this)===!0){as.call(this);for(var us=function(){return is.tokenMatcher(is.LA(1),os)};this.tokenMatcher(this.LA(1),os)===!0;)this.CONSUME(os),as.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[ts,os,us,as,NextTerminalAfterAtLeastOneSepWalker],us,AT_LEAST_ONE_SEP_IDX,ts,NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(ts,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,rs.ERR_MSG)},ss.prototype.manyInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(MANY_IDX,ts),is=this.nestedRuleBeforeClause(rs,ns);try{return this.manyInternalLogic(ts,rs,ns)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.manyInternalNoCst=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(MANY_IDX,ts);return this.manyInternalLogic(ts,rs,ns)},ss.prototype.manyInternalLogic=function(ts,rs,ns){var is=this,as=this.getLaFuncFromCache(ns),os,ls;if(rs.DEF!==void 0){if(os=rs.DEF,ls=rs.GATE,ls!==void 0){var us=as;as=function(){return ls.call(is)&&us.call(is)}}}else os=rs;for(var cs=!0;as.call(this)===!0&&cs===!0;)cs=this.doSingleRepetition(os);this.attemptInRepetitionRecovery(this.manyInternal,[ts,rs],as,MANY_IDX,ts,NextTerminalAfterManyWalker,cs)},ss.prototype.manySepFirstInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,ts),is=this.nestedRuleBeforeClause(rs,ns);try{this.manySepFirstInternalLogic(ts,rs,ns)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.manySepFirstInternalNoCst=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,ts);this.manySepFirstInternalLogic(ts,rs,ns)},ss.prototype.manySepFirstInternalLogic=function(ts,rs,ns){var is=this,as=rs.DEF,os=rs.SEP,ls=this.getLaFuncFromCache(ns);if(ls.call(this)===!0){as.call(this);for(var us=function(){return is.tokenMatcher(is.LA(1),os)};this.tokenMatcher(this.LA(1),os)===!0;)this.CONSUME(os),as.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[ts,os,us,as,NextTerminalAfterManySepWalker],us,MANY_SEP_IDX,ts,NextTerminalAfterManySepWalker)}},ss.prototype.repetitionSepSecondInternal=function(ts,rs,ns,is,as){for(;ns();)this.CONSUME(rs),is.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[ts,rs,ns,is,as],ns,AT_LEAST_ONE_SEP_IDX,ts,as)},ss.prototype.doSingleRepetition=function(ts){var rs=this.getLexerPosition();ts.call(this);var ns=this.getLexerPosition();return ns>rs},ss.prototype.orInternalNoCst=function(ts,rs){var ns=isArray$2(ts)?ts:ts.DEF,is=this.getKeyForAutomaticLookahead(OR_IDX,rs),as=this.getLaFuncFromCache(is),os=as.call(this,ns);if(os!==void 0){var ls=ns[os];return ls.ALT.call(this)}this.raiseNoAltException(rs,ts.ERR_MSG)},ss.prototype.orInternal=function(ts,rs){var ns=this.getKeyForAutomaticLookahead(OR_IDX,rs),is=this.nestedRuleBeforeClause(ts,ns);try{var as=isArray$2(ts)?ts:ts.DEF,os=this.getLaFuncFromCache(ns),ls=os.call(this,as);if(ls!==void 0){var us=as[ls],cs=this.nestedAltBeforeClause(us,rs,OR_IDX,ls);try{return us.ALT.call(this)}finally{cs!==void 0&&this.nestedRuleFinallyClause(cs.shortName,cs.nestedName)}}this.raiseNoAltException(rs,ts.ERR_MSG)}finally{is!==void 0&&this.nestedRuleFinallyClause(ns,is)}},ss.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var ts=this.LA(1),rs=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:ts,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new NotAllInputParsedException(rs,ts))}},ss.prototype.subruleInternal=function(ts,rs,ns){var is;try{var as=ns!==void 0?ns.ARGS:void 0;return is=ts.call(this,rs,as),this.cstPostNonTerminal(is,ns!==void 0&&ns.LABEL!==void 0?ns.LABEL:ts.ruleName),is}catch(os){this.subruleInternalError(os,ns,ts.ruleName)}},ss.prototype.subruleInternalError=function(ts,rs,ns){throw isRecognitionException(ts)&&ts.partialCstResult!==void 0&&(this.cstPostNonTerminal(ts.partialCstResult,rs!==void 0&&rs.LABEL!==void 0?rs.LABEL:ns),delete ts.partialCstResult),ts},ss.prototype.consumeInternal=function(ts,rs,ns){var is;try{var as=this.LA(1);this.tokenMatcher(as,ts)===!0?(this.consumeToken(),is=as):this.consumeInternalError(ts,as,ns)}catch(os){is=this.consumeInternalRecovery(ts,rs,os)}return this.cstPostTerminal(ns!==void 0&&ns.LABEL!==void 0?ns.LABEL:ts.name,is),is},ss.prototype.consumeInternalError=function(ts,rs,ns){var is,as=this.LA(0);throw ns!==void 0&&ns.ERR_MSG?is=ns.ERR_MSG:is=this.errorMessageProvider.buildMismatchTokenMessage({expected:ts,actual:rs,previous:as,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new MismatchedTokenException(is,rs,as))},ss.prototype.consumeInternalRecovery=function(ts,rs,ns){if(this.recoveryEnabled&&ns.name==="MismatchedTokenException"&&!this.isBackTracking()){var is=this.getFollowsForInRuleRecovery(ts,rs);try{return this.tryInRuleRecovery(ts,is)}catch(as){throw as.name===IN_RULE_RECOVERY_EXCEPTION?ns:as}}else throw ns},ss.prototype.saveRecogState=function(){var ts=this.errors,rs=cloneArr(this.RULE_STACK);return{errors:ts,lexerState:this.exportLexerState(),RULE_STACK:rs,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},ss.prototype.reloadRecogState=function(ts){this.errors=ts.errors,this.importLexerState(ts.lexerState),this.RULE_STACK=ts.RULE_STACK},ss.prototype.ruleInvocationStateUpdate=function(ts,rs,ns){this.RULE_OCCURRENCE_STACK.push(ns),this.RULE_STACK.push(ts),this.cstInvocationStateUpdate(rs,ts)},ss.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},ss.prototype.getCurrRuleFullName=function(){var ts=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[ts]},ss.prototype.shortRuleNameToFullName=function(ts){return this.shortRuleNameToFull[ts]},ss.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),EOF)},ss.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},ss}(),ErrorHandler=function(){function ss(){}return ss.prototype.initErrorHandler=function(ts){this._errors=[],this.errorMessageProvider=defaults$4(ts.errorMessageProvider,DEFAULT_PARSER_CONFIG.errorMessageProvider)},ss.prototype.SAVE_ERROR=function(ts){if(isRecognitionException(ts))return ts.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(ts),ts;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(ss.prototype,"errors",{get:function(){return cloneArr(this._errors)},set:function(ts){this._errors=ts},enumerable:!0,configurable:!0}),ss.prototype.raiseEarlyExitException=function(ts,rs,ns){for(var is=this.getCurrRuleFullName(),as=this.getGAstProductions()[is],os=getLookaheadPathsForOptionalProd(ts,as,rs,this.maxLookahead),ls=os[0],us=[],cs=1;cs<=this.maxLookahead;cs++)us.push(this.LA(cs));var ps=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:ls,actual:us,previous:this.LA(0),customUserDescription:ns,ruleName:is});throw this.SAVE_ERROR(new EarlyExitException(ps,this.LA(1),this.LA(0)))},ss.prototype.raiseNoAltException=function(ts,rs){for(var ns=this.getCurrRuleFullName(),is=this.getGAstProductions()[ns],as=getLookaheadPathsForOr(ts,is,this.maxLookahead),os=[],ls=1;ls<=this.maxLookahead;ls++)os.push(this.LA(ls));var us=this.LA(0),cs=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:as,actual:os,previous:us,customUserDescription:rs,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new NoViableAltException(cs,this.LA(1),us))},ss}(),ContentAssist=function(){function ss(){}return ss.prototype.initContentAssist=function(){},ss.prototype.computeContentAssist=function(ts,rs){var ns=this.gastProductionsCache[ts];if(isUndefined$1(ns))throw Error("Rule ->"+ts+"<- does not exist in this grammar.");return nextPossibleTokensAfter([ns],rs,this.tokenMatcher,this.maxLookahead)},ss.prototype.getNextPossibleTokenTypes=function(ts){var rs=first$1(ts.ruleStack),ns=this.getGAstProductions(),is=ns[rs],as=new NextAfterTokenWalker(is,ts).startWalking();return as},ss}(),RECORDING_NULL_OBJECT={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(RECORDING_NULL_OBJECT);var HANDLE_SEPARATOR=!0,MAX_METHOD_IDX=Math.pow(2,BITS_FOR_OCCURRENCE_IDX)-1,RFT=createToken({name:"RECORDING_PHASE_TOKEN",pattern:Lexer.NA});augmentTokenTypes([RFT]);var RECORDING_PHASE_TOKEN=createTokenInstance(RFT,`This IToken indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(RECORDING_PHASE_TOKEN);var RECORDING_PHASE_CSTNODE={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details`,children:{}},GastRecorder=function(){function ss(){}return ss.prototype.initGastRecorder=function(ts){this.recordingProdStack=[],this.RECORDING_PHASE=!1},ss.prototype.enableRecording=function(){var ts=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var rs=function(is){var as=is>0?is:"";ts["CONSUME"+as]=function(os,ls){return this.consumeInternalRecord(os,is,ls)},ts["SUBRULE"+as]=function(os,ls){return this.subruleInternalRecord(os,is,ls)},ts["OPTION"+as]=function(os){return this.optionInternalRecord(os,is)},ts["OR"+as]=function(os){return this.orInternalRecord(os,is)},ts["MANY"+as]=function(os){this.manyInternalRecord(is,os)},ts["MANY_SEP"+as]=function(os){this.manySepFirstInternalRecord(is,os)},ts["AT_LEAST_ONE"+as]=function(os){this.atLeastOneInternalRecord(is,os)},ts["AT_LEAST_ONE_SEP"+as]=function(os){this.atLeastOneSepFirstInternalRecord(is,os)}},ns=0;ns<10;ns++)rs(ns);ts.consume=function(is,as,os){return this.consumeInternalRecord(as,is,os)},ts.subrule=function(is,as,os){return this.subruleInternalRecord(as,is,os)},ts.option=function(is,as){return this.optionInternalRecord(as,is)},ts.or=function(is,as){return this.orInternalRecord(as,is)},ts.many=function(is,as){this.manyInternalRecord(is,as)},ts.atLeastOne=function(is,as){this.atLeastOneInternalRecord(is,as)},ts.ACTION=ts.ACTION_RECORD,ts.BACKTRACK=ts.BACKTRACK_RECORD,ts.LA=ts.LA_RECORD})},ss.prototype.disableRecording=function(){var ts=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var rs=0;rs<10;rs++){var ns=rs>0?rs:"";delete ts["CONSUME"+ns],delete ts["SUBRULE"+ns],delete ts["OPTION"+ns],delete ts["OR"+ns],delete ts["MANY"+ns],delete ts["MANY_SEP"+ns],delete ts["AT_LEAST_ONE"+ns],delete ts["AT_LEAST_ONE_SEP"+ns]}delete ts.consume,delete ts.subrule,delete ts.option,delete ts.or,delete ts.many,delete ts.atLeastOne,delete ts.ACTION,delete ts.BACKTRACK,delete ts.LA})},ss.prototype.ACTION_RECORD=function(ts){},ss.prototype.BACKTRACK_RECORD=function(ts,rs){return function(){return!0}},ss.prototype.LA_RECORD=function(ts){return END_OF_FILE},ss.prototype.topLevelRuleRecord=function(ts,rs){try{var ns=new Rule({definition:[],name:ts});return ns.name=ts,this.recordingProdStack.push(ns),rs.call(this),this.recordingProdStack.pop(),ns}catch(is){if(is.KNOWN_RECORDER_ERROR!==!0)try{is.message=is.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording`}catch{throw is}throw is}},ss.prototype.optionInternalRecord=function(ts,rs){return recordProd.call(this,Option,ts,rs)},ss.prototype.atLeastOneInternalRecord=function(ts,rs){recordProd.call(this,RepetitionMandatory,rs,ts)},ss.prototype.atLeastOneSepFirstInternalRecord=function(ts,rs){recordProd.call(this,RepetitionMandatoryWithSeparator,rs,ts,HANDLE_SEPARATOR)},ss.prototype.manyInternalRecord=function(ts,rs){recordProd.call(this,Repetition,rs,ts)},ss.prototype.manySepFirstInternalRecord=function(ts,rs){recordProd.call(this,RepetitionWithSeparator,rs,ts,HANDLE_SEPARATOR)},ss.prototype.orInternalRecord=function(ts,rs){return recordOrProd.call(this,ts,rs)},ss.prototype.subruleInternalRecord=function(ts,rs,ns){if(assertMethodIdxIsValid(rs),!ts||has(ts,"ruleName")===!1){var is=new Error("<SUBRULE"+getIdxSuffix(rs)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(ts)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw is.KNOWN_RECORDER_ERROR=!0,is}var as=peek(this.recordingProdStack),os=ts.ruleName,ls=new NonTerminal({idx:rs,nonTerminalName:os,referencedRule:void 0});return as.definition.push(ls),this.outputCst?RECORDING_PHASE_CSTNODE:RECORDING_NULL_OBJECT},ss.prototype.consumeInternalRecord=function(ts,rs,ns){if(assertMethodIdxIsValid(rs),!hasShortKeyProperty(ts)){var is=new Error("<CONSUME"+getIdxSuffix(rs)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(ts)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw is.KNOWN_RECORDER_ERROR=!0,is}var as=peek(this.recordingProdStack),os=new Terminal({idx:rs,terminalType:ts});return as.definition.push(os),RECORDING_PHASE_TOKEN},ss}();function recordProd(ss,ts,rs,ns){ns===void 0&&(ns=!1),assertMethodIdxIsValid(rs);var is=peek(this.recordingProdStack),as=isFunction$1(ts)?ts:ts.DEF,os=new ss({definition:[],idx:rs});return has(ts,"NAME")&&(os.name=ts.NAME),ns&&(os.separator=ts.SEP),has(ts,"MAX_LOOKAHEAD")&&(os.maxLookahead=ts.MAX_LOOKAHEAD),this.recordingProdStack.push(os),as.call(this),is.definition.push(os),this.recordingProdStack.pop(),RECORDING_NULL_OBJECT}function recordOrProd(ss,ts){var rs=this;assertMethodIdxIsValid(ts);var ns=peek(this.recordingProdStack),is=isArray$2(ss)===!1,as=is===!1?ss:ss.DEF,os=new Alternation({definition:[],idx:ts,ignoreAmbiguities:is&&ss.IGNORE_AMBIGUITIES===!0});has(ss,"NAME")&&(os.name=ss.NAME),has(ss,"MAX_LOOKAHEAD")&&(os.maxLookahead=ss.MAX_LOOKAHEAD);var ls=some(as,function(us){return isFunction$1(us.GATE)});return os.hasPredicates=ls,ns.definition.push(os),forEach$1(as,function(us){var cs=new Flat({definition:[]});os.definition.push(cs),has(us,"NAME")&&(cs.name=us.NAME),has(us,"IGNORE_AMBIGUITIES")?cs.ignoreAmbiguities=us.IGNORE_AMBIGUITIES:has(us,"GATE")&&(cs.ignoreAmbiguities=!0),rs.recordingProdStack.push(cs),us.ALT.call(rs),rs.recordingProdStack.pop()}),RECORDING_NULL_OBJECT}function getIdxSuffix(ss){return ss===0?"":""+ss}function assertMethodIdxIsValid(ss){if(ss<0||ss>MAX_METHOD_IDX){var ts=new Error("Invalid DSL Method idx value: <"+ss+`>
	`+("Idx value must be a none negative value smaller than "+(MAX_METHOD_IDX+1)));throw ts.KNOWN_RECORDER_ERROR=!0,ts}}var PerformanceTracer=function(){function ss(){}return ss.prototype.initPerformanceTracer=function(ts){if(has(ts,"traceInitPerf")){var rs=ts.traceInitPerf,ns=typeof rs=="number";this.traceInitMaxIdent=ns?rs:1/0,this.traceInitPerf=ns?rs>0:rs}else this.traceInitMaxIdent=0,this.traceInitPerf=DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},ss.prototype.TRACE_INIT=function(ts,rs){if(this.traceInitPerf===!0){this.traceInitIndent++;var ns=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(ns+"--> <"+ts+">");var is=timer(rs),as=is.time,os=is.value,ls=as>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&ls(ns+"<-- <"+ts+"> time: "+as+"ms"),this.traceInitIndent--,os}else return rs()},ss}(),__extends=function(){var ss=function(ts,rs){return ss=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ns,is){ns.__proto__=is}||function(ns,is){for(var as in is)is.hasOwnProperty(as)&&(ns[as]=is[as])},ss(ts,rs)};return function(ts,rs){ss(ts,rs);function ns(){this.constructor=ts}ts.prototype=rs===null?Object.create(rs):(ns.prototype=rs.prototype,new ns)}}(),END_OF_FILE=createTokenInstance(EOF,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(END_OF_FILE);var DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),ParserDefinitionErrorType;(function(ss){ss[ss.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",ss[ss.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",ss[ss.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",ss[ss.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",ss[ss.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",ss[ss.LEFT_RECURSION=5]="LEFT_RECURSION",ss[ss.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",ss[ss.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",ss[ss.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",ss[ss.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",ss[ss.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",ss[ss.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",ss[ss.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",ss[ss.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",ss[ss.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"})(ParserDefinitionErrorType||(ParserDefinitionErrorType={}));function EMPTY_ALT(ss){return ss===void 0&&(ss=void 0),function(){return ss}}var Parser=function(){function ss(ts,rs){rs===void 0&&(rs=DEFAULT_PARSER_CONFIG),this.ignoredIssues=DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var ns=this;ns.initErrorHandler(rs),ns.initLexerAdapter(),ns.initLooksAhead(rs),ns.initRecognizerEngine(ts,rs),ns.initRecoverable(rs),ns.initTreeBuilder(rs),ns.initContentAssist(),ns.initGastRecorder(rs),ns.initPerformanceTracer(rs),has(rs,"ignoredIssues")&&rs.ignoredIssues!==DEFAULT_PARSER_CONFIG.ignoredIssues&&PRINT_WARNING(`The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.`),this.ignoredIssues=has(rs,"ignoredIssues")?rs.ignoredIssues:DEFAULT_PARSER_CONFIG.ignoredIssues,this.skipValidations=has(rs,"skipValidations")?rs.skipValidations:DEFAULT_PARSER_CONFIG.skipValidations}return ss.performSelfAnalysis=function(ts){ts.performSelfAnalysis()},ss.prototype.performSelfAnalysis=function(){var ts=this;this.TRACE_INIT("performSelfAnalysis",function(){var rs;ts.selfAnalysisDone=!0;var ns=ts.className;ts.TRACE_INIT("toFastProps",function(){toFastProperties(ts)}),ts.TRACE_INIT("Grammar Recording",function(){try{ts.enableRecording(),forEach$1(ts.definedRulesNames,function(as){var os=ts[as],ls=os.originalGrammarAction,us=void 0;ts.TRACE_INIT(as+" Rule",function(){us=ts.topLevelRuleRecord(as,ls)}),ts.gastProductionsCache[as]=us})}finally{ts.disableRecording()}});var is=[];if(ts.TRACE_INIT("Grammar Resolving",function(){is=resolveGrammar({rules:values(ts.gastProductionsCache)}),ts.definitionErrors.push.apply(ts.definitionErrors,is)}),ts.TRACE_INIT("Grammar Validations",function(){if(isEmpty(is)&&ts.skipValidations===!1){var as=validateGrammar({rules:values(ts.gastProductionsCache),maxLookahead:ts.maxLookahead,tokenTypes:values(ts.tokensMap),ignoredIssues:ts.ignoredIssues,errMsgProvider:defaultGrammarValidatorErrorProvider,grammarName:ns});ts.definitionErrors.push.apply(ts.definitionErrors,as)}}),isEmpty(ts.definitionErrors)&&(ts.recoveryEnabled&&ts.TRACE_INIT("computeAllProdsFollows",function(){var as=computeAllProdsFollows(values(ts.gastProductionsCache));ts.resyncFollows=as}),ts.TRACE_INIT("ComputeLookaheadFunctions",function(){ts.preComputeLookaheadFunctions(values(ts.gastProductionsCache))})),ts.TRACE_INIT("expandAllNestedRuleNames",function(){var as=expandAllNestedRuleNames(values(ts.gastProductionsCache),ts.fullRuleNameToShort);ts.allRuleNames=as.allRuleNames}),!ss.DEFER_DEFINITION_ERRORS_HANDLING&&!isEmpty(ts.definitionErrors))throw rs=map(ts.definitionErrors,function(as){return as.message}),new Error(`Parser Definition Errors detected:
 `+rs.join(`
-------------------------------
`))})},ss.DEFER_DEFINITION_ERRORS_HANDLING=!1,ss}();applyMixins(Parser,[Recoverable,LooksAhead,TreeBuilder,LexerAdapter,RecognizerEngine,RecognizerApi,ErrorHandler,ContentAssist,GastRecorder,PerformanceTracer]),function(ss){__extends(ts,ss);function ts(rs,ns){ns===void 0&&(ns=DEFAULT_PARSER_CONFIG);var is=this,as=cloneObj(ns);return as.outputCst=!0,is=ss.call(this,rs,as)||this,is}return ts}(Parser);var EmbeddedActionsParser=function(ss){__extends(ts,ss);function ts(rs,ns){ns===void 0&&(ns=DEFAULT_PARSER_CONFIG);var is=this,as=cloneObj(ns);return as.outputCst=!1,is=ss.call(this,rs,as)||this,is}return ts}(Parser);/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const RANGE_OPERATOR=":",ABSOLUTE_OPERATOR="$",ALL_WHITESPACE_REGEXP=/\s+/,ODFF_WHITESPACE_REGEXP=/[ \t\n\r]+/,AdditionOp=createToken({name:"AdditionOp",pattern:Lexer.NA}),PlusOp=createToken({name:"PlusOp",pattern:/\+/,categories:AdditionOp}),MinusOp=createToken({name:"MinusOp",pattern:/-/,categories:AdditionOp}),MultiplicationOp=createToken({name:"MultiplicationOp",pattern:Lexer.NA}),TimesOp=createToken({name:"TimesOp",pattern:/\*/,categories:MultiplicationOp}),DivOp=createToken({name:"DivOp",pattern:/\//,categories:MultiplicationOp}),PowerOp=createToken({name:"PowerOp",pattern:/\^/}),PercentOp=createToken({name:"PercentOp",pattern:/%/}),BooleanOp=createToken({name:"BooleanOp",pattern:Lexer.NA}),EqualsOp=createToken({name:"EqualsOp",pattern:/=/,categories:BooleanOp}),NotEqualOp=createToken({name:"NotEqualOp",pattern:/<>/,categories:BooleanOp}),GreaterThanOp=createToken({name:"GreaterThanOp",pattern:/>/,categories:BooleanOp}),LessThanOp=createToken({name:"LessThanOp",pattern:/</,categories:BooleanOp}),GreaterThanOrEqualOp=createToken({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:BooleanOp}),LessThanOrEqualOp=createToken({name:"LessThanOrEqualOp",pattern:/<=/,categories:BooleanOp}),ConcatenateOp=createToken({name:"ConcatenateOp",pattern:/&/}),simpleSheetName="[A-Za-z0-9_-]+",quotedSheetName="'(((?!').|'')*)'",sheetNameRegexp=`(${simpleSheetName}|${quotedSheetName})!`,CellReference=createToken({name:"CellReference",pattern:new RegExp(`(${sheetNameRegexp})?\\${ABSOLUTE_OPERATOR}?[A-Za-z]+\\${ABSOLUTE_OPERATOR}?[0-9]+`)}),ColumnRange=createToken({name:"ColumnRange",pattern:new RegExp(`(${sheetNameRegexp})?\\${ABSOLUTE_OPERATOR}?[A-Za-z]+${RANGE_OPERATOR}(${sheetNameRegexp})?\\${ABSOLUTE_OPERATOR}?[A-Za-z]+`)}),RowRange=createToken({name:"RowRange",pattern:new RegExp(`(${sheetNameRegexp})?\\${ABSOLUTE_OPERATOR}?[0-9]+${RANGE_OPERATOR}(${sheetNameRegexp})?\\${ABSOLUTE_OPERATOR}?[0-9]+`)}),RangeSeparator=createToken({name:"RangeSeparator",pattern:`${RANGE_OPERATOR}`}),LParen=createToken({name:"LParen",pattern:/\(/}),RParen=createToken({name:"RParen",pattern:/\)/}),ArrayLParen=createToken({name:"ArrayLParen",pattern:/{/}),ArrayRParen=createToken({name:"ArrayRParen",pattern:/}/}),ProcedureName=createToken({name:"ProcedureName",pattern:/([A-Za-z\u00C0-\u02AF][A-Za-z0-9\u00C0-\u02AF._]*)\(/}),NamedExpression=createToken({name:"NamedExpression",pattern:/[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*/}),StringLiteral=createToken({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),ErrorLiteral=createToken({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),buildLexerConfig=ss=>{const ts=ss.translationPackage.getFunctionTranslation("OFFSET"),rs=ss.errorMapping,ns=ss.translationPackage.buildFunctionMapping(),is=ss.ignoreWhiteSpace==="standard"?ODFF_WHITESPACE_REGEXP:ALL_WHITESPACE_REGEXP,as=createToken({name:"WhiteSpace",pattern:is}),os=createToken({name:"ArrayRowSep",pattern:ss.arrayRowSeparator}),ls=createToken({name:"ArrayColSep",pattern:ss.arrayColumnSeparator});let us,cs;ss.functionArgSeparator===ss.arrayColumnSeparator?(us=ls,cs=[]):ss.functionArgSeparator===ss.arrayRowSeparator?(us=os,cs=[]):(us=createToken({name:"ArgSeparator",pattern:ss.functionArgSeparator}),cs=[us]);const ps=createToken({name:"NumberLiteral",pattern:new RegExp(`(([${ss.decimalSeparator}]\\d+)|(\\d+([${ss.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),ds=createToken({name:"OffsetProcedureName",pattern:new RegExp(ts,"i")}),fs=[as,PlusOp,MinusOp,TimesOp,DivOp,PowerOp,EqualsOp,NotEqualOp,PercentOp,GreaterThanOrEqualOp,LessThanOrEqualOp,GreaterThanOp,LessThanOp,LParen,RParen,ArrayLParen,ArrayRParen,ds,ProcedureName,RangeSeparator,...cs,ColumnRange,RowRange,ps,StringLiteral,ErrorLiteral,ConcatenateOp,BooleanOp,AdditionOp,MultiplicationOp,CellReference,NamedExpression,os,ls];return{ArgSeparator:us,NumberLiteral:ps,OffsetProcedureName:ds,ArrayRowSeparator:os,ArrayColSeparator:ls,WhiteSpace:as,allTokens:fs,errorMapping:rs,functionMapping:ns,decimalSeparator:ss.decimalSeparator,maxColumns:ss.maxColumns,maxRows:ss.maxRows}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const addressRegex=new RegExp(`^(${sheetNameRegexp})?(\\${ABSOLUTE_OPERATOR}?)([A-Za-z]+)(\\${ABSOLUTE_OPERATOR}?)([0-9]+)$`),columnRegex=new RegExp(`^(${sheetNameRegexp})?(\\${ABSOLUTE_OPERATOR}?)([A-Za-z]+)$`),rowRegex=new RegExp(`^(${sheetNameRegexp})?(\\${ABSOLUTE_OPERATOR}?)([0-9]+)$`),simpleSheetNameRegex=new RegExp(`^${simpleSheetName}$`),cellAddressFromString=(ss,ts,rs)=>{const ns=addressRegex.exec(ts),is=columnLabelToIndex(ns[6]);let as=extractSheetNumber(ns,ss);if(as===void 0)return;as===null&&(as=void 0);const os=Number(ns[8])-1;return ns[5]===ABSOLUTE_OPERATOR&&ns[7]===ABSOLUTE_OPERATOR?CellAddress.absolute(is,os,as):ns[5]===ABSOLUTE_OPERATOR?CellAddress.absoluteCol(is,os-rs.row,as):ns[7]===ABSOLUTE_OPERATOR?CellAddress.absoluteRow(is-rs.col,os,as):CellAddress.relative(os-rs.row,is-rs.col,as)},columnAddressFromString=(ss,ts,rs)=>{const ns=columnRegex.exec(ts);let is=extractSheetNumber(ns,ss);if(is===void 0)return;is===null&&(is=void 0);const as=columnLabelToIndex(ns[6]);return ns[5]===ABSOLUTE_OPERATOR?ColumnAddress.absolute(as,is):ColumnAddress.relative(as-rs.col,is)},rowAddressFromString=(ss,ts,rs)=>{const ns=rowRegex.exec(ts);let is=extractSheetNumber(ns,ss);if(is===void 0)return;is===null&&(is=void 0);const as=Number(ns[6])-1;return ns[5]===ABSOLUTE_OPERATOR?RowAddress.absolute(as,is):RowAddress.relative(as-rs.row,is)},simpleCellAddressFromString=(ss,ts,rs)=>{const ns=addressRegex.exec(ts),is=columnLabelToIndex(ns[6]);let as=extractSheetNumber(ns,ss);if(as===void 0)return;as===null&&(as=rs);const os=Number(ns[8])-1;return simpleCellAddress(as,is,os)},simpleCellRangeFromString=(ss,ts,rs)=>{const ns=ts.split(RANGE_OPERATOR);if(ns.length!==2)return;const[is,as]=ns,os=simpleCellAddressFromString(ss,is,rs);if(os===void 0)return;const ls=simpleCellAddressFromString(ss,as,os.sheet);if(ls!==void 0&&os.sheet===ls.sheet)return simpleCellRange(os,ls)},simpleCellAddressToString=(ss,ts,rs)=>{const ns=columnIndexToLabel(ts.col),is=sheetIndexToString(ts.sheet,ss);if(is!==void 0)return rs!==ts.sheet?`${is}!${ns}${ts.row+1}`:`${ns}${ts.row+1}`},simpleCellRangeToString=(ss,ts,rs)=>{const ns=simpleCellAddressToString(ss,ts.start,rs),is=simpleCellAddressToString(ss,ts.end,ts.start.sheet);if(!(ns===void 0||is===void 0))return`${ns}${RANGE_OPERATOR}${is}`};function columnLabelToIndex(ss){return ss.length===1?ss.toUpperCase().charCodeAt(0)-65:ss.split("").reduce((ts,rs)=>ts*26+(rs.toUpperCase().charCodeAt(0)-64),0)-1}function columnIndexToLabel(ss){let ts="";for(;ss>=0;)ts=String.fromCharCode(ss%26+97)+ts,ss=Math.floor(ss/26)-1;return ts.toUpperCase()}function sheetIndexToString(ss,ts){let rs=ts(ss);if(rs!==void 0)return simpleSheetNameRegex.test(rs)?rs:(rs=rs.replace(/'/g,"''"),`'${rs}'`)}function extractSheetNumber(ss,ts){var rs;let ns=(rs=ss[3])!==null&&rs!==void 0?rs:ss[2];return ns?(ns=ns.replace(/''/g,"'"),ts(ns)):null}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const parsingError=(ss,ts)=>({type:ss,message:ts});var ParsingErrorType;(function(ss){ss.LexingError="LexingError",ss.ParserError="ParsingError",ss.StaticOffsetError="StaticOffsetError",ss.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",ss.RangeOffsetNotAllowed="RangeOffsetNotAllowed"})(ParsingErrorType||(ParsingErrorType={}));var AstNodeType;(function(ss){ss.EMPTY="EMPTY",ss.NUMBER="NUMBER",ss.STRING="STRING",ss.MINUS_UNARY_OP="MINUS_UNARY_OP",ss.PLUS_UNARY_OP="PLUS_UNARY_OP",ss.PERCENT_OP="PERCENT_OP",ss.CONCATENATE_OP="CONCATENATE_OP",ss.EQUALS_OP="EQUALS_OP",ss.NOT_EQUAL_OP="NOT_EQUAL_OP",ss.GREATER_THAN_OP="GREATER_THAN_OP",ss.LESS_THAN_OP="LESS_THAN_OP",ss.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",ss.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",ss.PLUS_OP="PLUS_OP",ss.MINUS_OP="MINUS_OP",ss.TIMES_OP="TIMES_OP",ss.DIV_OP="DIV_OP",ss.POWER_OP="POWER_OP",ss.FUNCTION_CALL="FUNCTION_CALL",ss.NAMED_EXPRESSION="NAMED_EXPRESSION",ss.PARENTHESIS="PARENTHESES",ss.CELL_REFERENCE="CELL_REFERENCE",ss.CELL_RANGE="CELL_RANGE",ss.COLUMN_RANGE="COLUMN_RANGE",ss.ROW_RANGE="ROW_RANGE",ss.ERROR="ERROR",ss.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",ss.ARRAY="ARRAY"})(AstNodeType||(AstNodeType={}));var RangeSheetReferenceType;(function(ss){ss[ss.RELATIVE=0]="RELATIVE",ss[ss.START_ABSOLUTE=1]="START_ABSOLUTE",ss[ss.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"})(RangeSheetReferenceType||(RangeSheetReferenceType={}));const buildEmptyArgAst=ss=>({type:AstNodeType.EMPTY,leadingWhitespace:ss==null?void 0:ss.image}),buildNumberAst=(ss,ts)=>({type:AstNodeType.NUMBER,value:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildStringAst=ss=>{var ts;return{type:AstNodeType.STRING,value:ss.image.slice(1,-1),leadingWhitespace:(ts=ss.leadingWhitespace)===null||ts===void 0?void 0:ts.image}},buildCellReferenceAst=(ss,ts)=>({type:AstNodeType.CELL_REFERENCE,reference:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildCellRangeAst=(ss,ts,rs,ns)=>(assertRangeConsistency(ss,ts,rs),{type:AstNodeType.CELL_RANGE,start:ss,end:ts,sheetReferenceType:rs,leadingWhitespace:ns}),buildColumnRangeAst=(ss,ts,rs,ns)=>(assertRangeConsistency(ss,ts,rs),{type:AstNodeType.COLUMN_RANGE,start:ss,end:ts,sheetReferenceType:rs,leadingWhitespace:ns==null?void 0:ns.image}),buildRowRangeAst=(ss,ts,rs,ns)=>(assertRangeConsistency(ss,ts,rs),{type:AstNodeType.ROW_RANGE,start:ss,end:ts,sheetReferenceType:rs,leadingWhitespace:ns==null?void 0:ns.image}),buildConcatenateOpAst=(ss,ts,rs)=>({type:AstNodeType.CONCATENATE_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildEqualsOpAst=(ss,ts,rs)=>({type:AstNodeType.EQUALS_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildNotEqualOpAst=(ss,ts,rs)=>({type:AstNodeType.NOT_EQUAL_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildGreaterThanOpAst=(ss,ts,rs)=>({type:AstNodeType.GREATER_THAN_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildLessThanOpAst=(ss,ts,rs)=>({type:AstNodeType.LESS_THAN_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildGreaterThanOrEqualOpAst=(ss,ts,rs)=>({type:AstNodeType.GREATER_THAN_OR_EQUAL_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildLessThanOrEqualOpAst=(ss,ts,rs)=>({type:AstNodeType.LESS_THAN_OR_EQUAL_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildPlusOpAst=(ss,ts,rs)=>({type:AstNodeType.PLUS_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildMinusOpAst=(ss,ts,rs)=>({type:AstNodeType.MINUS_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildTimesOpAst=(ss,ts,rs)=>({type:AstNodeType.TIMES_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildDivOpAst=(ss,ts,rs)=>({type:AstNodeType.DIV_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildPowerOpAst=(ss,ts,rs)=>({type:AstNodeType.POWER_OP,left:ss,right:ts,leadingWhitespace:rs==null?void 0:rs.image}),buildMinusUnaryOpAst=(ss,ts)=>({type:AstNodeType.MINUS_UNARY_OP,value:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildPlusUnaryOpAst=(ss,ts)=>({type:AstNodeType.PLUS_UNARY_OP,value:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildPercentOpAst=(ss,ts)=>({type:AstNodeType.PERCENT_OP,value:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildProcedureAst=(ss,ts,rs,ns)=>({type:AstNodeType.FUNCTION_CALL,procedureName:ss,args:ts,leadingWhitespace:rs==null?void 0:rs.image,internalWhitespace:ns==null?void 0:ns.image}),buildArrayAst=(ss,ts,rs)=>({type:AstNodeType.ARRAY,args:ss,leadingWhitespace:ts==null?void 0:ts.image,internalWhitespace:rs==null?void 0:rs.image}),buildNamedExpressionAst=(ss,ts)=>({type:AstNodeType.NAMED_EXPRESSION,expressionName:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildParenthesisAst=(ss,ts,rs)=>({type:AstNodeType.PARENTHESIS,expression:ss,leadingWhitespace:ts==null?void 0:ts.image,internalWhitespace:rs==null?void 0:rs.image}),buildCellErrorAst=(ss,ts)=>({type:AstNodeType.ERROR,error:ss,leadingWhitespace:ts==null?void 0:ts.image}),buildErrorWithRawInputAst=(ss,ts,rs)=>({type:AstNodeType.ERROR_WITH_RAW_INPUT,error:ts,rawInput:ss,leadingWhitespace:rs==null?void 0:rs.image}),buildParsingErrorAst=()=>({type:AstNodeType.ERROR,error:CellError.parsingError()});function assertRangeConsistency(ss,ts,rs){if(ss.sheet!==void 0&&ts.sheet===void 0||ss.sheet===void 0&&ts.sheet!==void 0)throw new Error("Start address inconsistent with end address");if(ss.sheet===void 0&&rs!==RangeSheetReferenceType.RELATIVE||ss.sheet!==void 0&&rs===RangeSheetReferenceType.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function imageWithWhitespace(ss,ts){return(ts??"")+ss}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const binaryOpTokenMap={[AstNodeType.PLUS_OP]:"+",[AstNodeType.MINUS_OP]:"-",[AstNodeType.TIMES_OP]:"*",[AstNodeType.DIV_OP]:"/",[AstNodeType.CONCATENATE_OP]:"&",[AstNodeType.POWER_OP]:"^",[AstNodeType.EQUALS_OP]:"=",[AstNodeType.NOT_EQUAL_OP]:"<>",[AstNodeType.GREATER_THAN_OP]:">",[AstNodeType.GREATER_THAN_OR_EQUAL_OP]:">=",[AstNodeType.LESS_THAN_OP]:"<",[AstNodeType.LESS_THAN_OR_EQUAL_OP]:"<="};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const buildCacheEntry=(ss,ts,rs,ns)=>({ast:ss,relativeDependencies:ts,hasVolatileFunction:rs,hasStructuralChangeFunction:ns});class Cache{constructor(ts){this.functionRegistry=ts,this.cache=new Map}set(ts,rs){const ns=collectDependencies(rs,this.functionRegistry),is=buildCacheEntry(rs,ns,doesContainFunctions(rs,this.functionRegistry.isFunctionVolatile),doesContainFunctions(rs,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(ts,is),is}get(ts){return this.cache.get(ts)}maybeSetAndThenGet(ts,rs){const ns=this.cache.get(ts);return ns!==void 0?ns.ast:(this.set(ts,rs),rs)}}const doesContainFunctions=(ss,ts)=>{switch(ss.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.CELL_REFERENCE:case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return doesContainFunctions(ss.value,ts);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return doesContainFunctions(ss.left,ts)||doesContainFunctions(ss.right,ts);case AstNodeType.PARENTHESIS:return doesContainFunctions(ss.expression,ts);case AstNodeType.FUNCTION_CALL:return ts(ss.procedureName)?!0:ss.args.some(rs=>doesContainFunctions(rs,ts));case AstNodeType.ARRAY:return ss.args.some(rs=>rs.some(ns=>doesContainFunctions(ns,ts)))}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ErrorMessage{}ErrorMessage.DistinctSigns="Distinct signs.",ErrorMessage.WrongArgNumber="Wrong number of arguments.",ErrorMessage.EmptyArg="Empty function argument.",ErrorMessage.EmptyArray="Empty array not allowed.",ErrorMessage.ArrayDimensions="Array dimensions are not compatible.",ErrorMessage.NoSpaceForArrayResult="No space for array result.",ErrorMessage.ValueSmall="Value too small.",ErrorMessage.ValueLarge="Value too large.",ErrorMessage.BadCriterion="Incorrect criterion.",ErrorMessage.RangeManySheets="Range spans more than one sheet.",ErrorMessage.CellRangeExpected="Cell range expected.",ErrorMessage.WrongDimension="Wrong range dimension.",ErrorMessage.ScalarExpected="Cell range not allowed.",ErrorMessage.NumberCoercion="Value cannot be coerced to number.",ErrorMessage.NumberExpected="Number argument expected.",ErrorMessage.IntegerExpected="Value needs to be an integer.",ErrorMessage.BadMode="Mode not recognized.",ErrorMessage.DateBounds="Date outside of bounds.",ErrorMessage.OutOfSheet="Resulting reference is out of the sheet.",ErrorMessage.WrongType="Wrong type of argument.",ErrorMessage.NaN="NaN or infinite value encountered.",ErrorMessage.EqualLength="Ranges need to be of equal length.",ErrorMessage.Negative="Value cannot be negative.",ErrorMessage.NotBinary="String does not represent a binary number.",ErrorMessage.NotOctal="String does not represent an octal number.",ErrorMessage.NotHex="String does not represent a hexadecimal number.",ErrorMessage.EndStartPeriod="End period needs to be at least start period.",ErrorMessage.CellRefExpected="Cell reference expected.",ErrorMessage.EmptyRange="Empty range not allowed.",ErrorMessage.BadRef="Address is not correct.",ErrorMessage.NumberRange="Number-only range expected.",ErrorMessage.ValueNotFound="Value not found.",ErrorMessage.ValueBaseLarge="Value in base too large.",ErrorMessage.ValueBaseSmall="Value in base too small.",ErrorMessage.ValueBaseLong="Value in base too long.",ErrorMessage.NegativeLength="Length cannot be negative.",ErrorMessage.PatternNotFound="Pattern not found.",ErrorMessage.OneValue="Needs at least one value.",ErrorMessage.TwoValues="Range needs to contain at least two elements.",ErrorMessage.ThreeValues="Range needs to contain at least three elements.",ErrorMessage.IndexBounds="Index out of bounds.",ErrorMessage.IndexLarge="Index too large.",ErrorMessage.Formula="Expected formula.",ErrorMessage.NegativeCount="Count cannot be negative.",ErrorMessage.ParseError="Parsing error.",ErrorMessage.SheetRef="Sheet does not exist.",ErrorMessage.PeriodLong="Period number cannot exceed life length.",ErrorMessage.InvalidDate="Invalid date.",ErrorMessage.BitshiftLong="Result of bitshift is too long.",ErrorMessage.EmptyString="Empty-string argument not allowed.",ErrorMessage.LengthBounds="Length out of bounds.",ErrorMessage.NegativeTime="Time cannot be negative.",ErrorMessage.NoDefault="No default option.",ErrorMessage.Selector="Selector cannot exceed the number of arguments.",ErrorMessage.StartEndDate="Start date needs to be earlier than end date.",ErrorMessage.IncorrectDateTime="String does not represent correct DateTime.",ErrorMessage.CharacterCodeBounds="Character code out of bounds.",ErrorMessage.NonZero="Argument cannot be 0.",ErrorMessage.LessThanOne="Argument cannot be less than 1.",ErrorMessage.WeekendString="Incorrect weekend bitmask string.",ErrorMessage.InvalidRoman="Invalid roman numeral.",ErrorMessage.WrongOrder="Wrong order of values.",ErrorMessage.ComplexNumberExpected="Complex number expected.",ErrorMessage.ShouldBeIorJ="Should be 'i' or 'j'.",ErrorMessage.SizeMismatch="Array dimensions mismatched.",ErrorMessage.FunctionName=ss=>`Function name ${ss} not recognized.`,ErrorMessage.NamedExpressionName=ss=>`Named expression ${ss} not recognized.`,ErrorMessage.LicenseKey=ss=>`License key is ${ss}.`;/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class FormulaParser extends EmbeddedActionsParser{constructor(ts,rs){super(ts.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:EMPTY_ALT(buildEmptyArgAst())}])),this.procedureExpression=this.RULE("procedureExpression",()=>{var ns;const is=this.CONSUME(ProcedureName),as=is.image.toUpperCase().slice(0,-1),os=(ns=this.lexerConfig.functionMapping[as])!==null&&ns!==void 0?ns:as,ls=[];let us=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY(()=>{var ps;const ds=this.CONSUME(this.lexerConfig.ArgSeparator);us.type===AstNodeType.EMPTY&&(us.leadingWhitespace=(ps=ds.leadingWhitespace)===null||ps===void 0?void 0:ps.image),ls.push(us),us=this.SUBRULE2(this.booleanExpressionOrEmpty)}),ls.push(us),ls.length===1&&ls[0].type===AstNodeType.EMPTY&&(ls.length=0);const cs=this.CONSUME(RParen);return buildProcedureAst(os,ls,is.leadingWhitespace,cs.leadingWhitespace)}),this.namedExpressionExpression=this.RULE("namedExpressionExpression",()=>{const ns=this.CONSUME(NamedExpression);return buildNamedExpressionAst(ns.image,ns.leadingWhitespace)}),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",()=>{const ns=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(LParen),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{ns.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(RParen),this.handleOffsetHeuristic(ns)}),this.columnRangeExpression=this.RULE("columnRangeExpression",()=>{const ns=this.CONSUME(ColumnRange),[is,as]=ns.image.split(":"),os=this.ACTION(()=>columnAddressFromString(this.sheetMapping,is,this.formulaAddress)),ls=this.ACTION(()=>columnAddressFromString(this.sheetMapping,as,this.formulaAddress));if(os===void 0||ls===void 0)return buildCellErrorAst(new CellError(ErrorType.REF));if(os.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||ls.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return buildErrorWithRawInputAst(ns.image,new CellError(ErrorType.NAME),ns.leadingWhitespace);if(os.sheet===void 0&&ls.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:us,secondEnd:cs,sheetRefType:ps}=FormulaParser.fixSheetIdsForRangeEnds(os,ls),{start:ds,end:fs}=this.orderColumnRangeEnds(us,cs);return buildColumnRangeAst(ds,fs,ps,ns.leadingWhitespace)}),this.rowRangeExpression=this.RULE("rowRangeExpression",()=>{const ns=this.CONSUME(RowRange),[is,as]=ns.image.split(":"),os=this.ACTION(()=>rowAddressFromString(this.sheetMapping,is,this.formulaAddress)),ls=this.ACTION(()=>rowAddressFromString(this.sheetMapping,as,this.formulaAddress));if(os===void 0||ls===void 0)return buildCellErrorAst(new CellError(ErrorType.REF));if(os.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||ls.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return buildErrorWithRawInputAst(ns.image,new CellError(ErrorType.NAME),ns.leadingWhitespace);if(os.sheet===void 0&&ls.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:us,secondEnd:cs,sheetRefType:ps}=FormulaParser.fixSheetIdsForRangeEnds(os,ls),{start:ds,end:fs}=this.orderRowRangeEnds(us,cs);return buildRowRangeAst(ds,fs,ps,ns.leadingWhitespace)}),this.cellReference=this.RULE("cellReference",()=>{const ns=this.CONSUME(CellReference),is=this.ACTION(()=>cellAddressFromString(this.sheetMapping,ns.image,this.formulaAddress));return is===void 0?buildErrorWithRawInputAst(ns.image,new CellError(ErrorType.REF),ns.leadingWhitespace):is.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?buildErrorWithRawInputAst(ns.image,new CellError(ErrorType.NAME),ns.leadingWhitespace):buildCellReferenceAst(is,ns.leadingWhitespace)}),this.endRangeReference=this.RULE("endRangeReference",ns=>{var is;const as=this.CONSUME(CellReference),os=this.ACTION(()=>cellAddressFromString(this.sheetMapping,ns.image,this.formulaAddress)),ls=this.ACTION(()=>cellAddressFromString(this.sheetMapping,as.image,this.formulaAddress));return os===void 0||ls===void 0?this.ACTION(()=>buildErrorWithRawInputAst(`${ns.image}:${as.image}`,new CellError(ErrorType.REF),ns.leadingWhitespace)):os.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||ls.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION(()=>buildErrorWithRawInputAst(`${ns.image}:${as.image}`,new CellError(ErrorType.NAME),ns.leadingWhitespace)):this.buildCellRange(os,ls,(is=ns.leadingWhitespace)===null||is===void 0?void 0:is.image)}),this.endOfRangeExpression=this.RULE("endOfRangeExpression",ns=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[ns]})},{ALT:()=>{var is;const as=this.SUBRULE(this.offsetProcedureExpression),os=this.ACTION(()=>cellAddressFromString(this.sheetMapping,ns.image,this.formulaAddress));return os===void 0?buildCellErrorAst(new CellError(ErrorType.REF)):as.type===AstNodeType.CELL_REFERENCE?this.buildCellRange(os,as.reference,(is=ns.leadingWhitespace)===null||is===void 0?void 0:is.image):this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.cellRangeExpression=this.RULE("cellRangeExpression",()=>{const ns=this.CONSUME(CellReference);return this.CONSUME2(RangeSeparator),this.SUBRULE(this.endOfRangeExpression,{ARGS:[ns]})}),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",ns=>{const is=this.CONSUME(CellReference),as=this.ACTION(()=>cellAddressFromString(this.sheetMapping,is.image,this.formulaAddress));return as===void 0?this.ACTION(()=>buildCellErrorAst(new CellError(ErrorType.REF))):this.buildCellRange(ns.reference,as,ns.leadingWhitespace)}),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",ns=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[ns]})},{ALT:()=>{const is=this.SUBRULE(this.offsetProcedureExpression);return is.type===AstNodeType.CELL_REFERENCE?this.buildCellRange(ns.reference,is.reference,ns.leadingWhitespace):this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])),this.offsetExpression=this.RULE("offsetExpression",()=>{const ns=this.SUBRULE(this.offsetProcedureExpression);let is;return this.OPTION(()=>{this.CONSUME(RangeSeparator),ns.type===AstNodeType.CELL_RANGE?is=this.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):is=this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[ns]})}),is!==void 0?is:ns}),this.insideArrayExpression=this.RULE("insideArrayExpression",()=>{const ns=[[]];return ns[ns.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY(()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),ns[ns.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),ns.push([]),ns[ns.length-1].push(this.SUBRULE3(this.booleanExpression))}}])}),buildArrayAst(ns)}),this.parenthesisExpression=this.RULE("parenthesisExpression",()=>{const ns=this.CONSUME(LParen),is=this.SUBRULE(this.booleanExpression),as=this.CONSUME(RParen);return buildParenthesisAst(is,ns.leadingWhitespace,as.leadingWhitespace)}),this.arrayExpression=this.RULE("arrayExpression",()=>this.OR([{ALT:()=>{const ns=this.CONSUME(ArrayLParen),is=this.SUBRULE(this.insideArrayExpression),as=this.CONSUME(ArrayRParen);return buildArrayAst(is.args,ns.leadingWhitespace,as.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}])),this.numericStringToNumber=ns=>{const is=ns.replace(this.lexerConfig.decimalSeparator,".");return Number(is)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",()=>{var ns;return this.OR((ns=this.atomicExpCache)!==null&&ns!==void 0?ns:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const is=this.CONSUME(this.lexerConfig.NumberLiteral);return buildNumberAst(this.numericStringToNumber(is.image),is.leadingWhitespace)}},{ALT:()=>{const is=this.CONSUME(StringLiteral);return buildStringAst(is)}},{ALT:()=>{const is=this.CONSUME(ErrorLiteral),as=is.image.toUpperCase(),os=this.lexerConfig.errorMapping[as];return os?buildCellErrorAst(new CellError(os),is.leadingWhitespace):this.parsingError(ParsingErrorType.ParserError,"Unknown error literal")}}])}),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",()=>{const ns=this.SUBRULE(this.positiveAtomicExpression),is=this.OPTION(()=>this.CONSUME(PercentOp));return is?buildPercentOpAst(ns,is.leadingWhitespace):ns}),this.atomicExpression=this.RULE("atomicExpression",()=>this.OR([{ALT:()=>{const ns=this.CONSUME(AdditionOp),is=this.SUBRULE(this.atomicExpression);return tokenMatcher(ns,PlusOp)?buildPlusUnaryOpAst(is,ns.leadingWhitespace):tokenMatcher(ns,MinusOp)?buildMinusUnaryOpAst(is,ns.leadingWhitespace):(this.customParsingError=parsingError(ParsingErrorType.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}])),this.powerExpression=this.RULE("powerExpression",()=>{let ns=this.SUBRULE(this.atomicExpression);return this.MANY(()=>{const is=this.CONSUME(PowerOp),as=this.SUBRULE2(this.atomicExpression);tokenMatcher(is,PowerOp)?ns=buildPowerOpAst(ns,as,is.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),ns}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{let ns=this.SUBRULE(this.powerExpression);return this.MANY(()=>{const is=this.CONSUME(MultiplicationOp),as=this.SUBRULE2(this.powerExpression);tokenMatcher(is,TimesOp)?ns=buildTimesOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,DivOp)?ns=buildDivOpAst(ns,as,is.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),ns}),this.additionExpression=this.RULE("additionExpression",()=>{let ns=this.SUBRULE(this.multiplicationExpression);return this.MANY(()=>{const is=this.CONSUME(AdditionOp),as=this.SUBRULE2(this.multiplicationExpression);tokenMatcher(is,PlusOp)?ns=buildPlusOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,MinusOp)?ns=buildMinusOpAst(ns,as,is.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),ns}),this.concatenateExpression=this.RULE("concatenateExpression",()=>{let ns=this.SUBRULE(this.additionExpression);return this.MANY(()=>{const is=this.CONSUME(ConcatenateOp),as=this.SUBRULE2(this.additionExpression);ns=buildConcatenateOpAst(ns,as,is.leadingWhitespace)}),ns}),this.booleanExpression=this.RULE("booleanExpression",()=>{let ns=this.SUBRULE(this.concatenateExpression);return this.MANY(()=>{const is=this.CONSUME(BooleanOp),as=this.SUBRULE2(this.concatenateExpression);tokenMatcher(is,EqualsOp)?ns=buildEqualsOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,NotEqualOp)?ns=buildNotEqualOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,GreaterThanOp)?ns=buildGreaterThanOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,LessThanOp)?ns=buildLessThanOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,GreaterThanOrEqualOp)?ns=buildGreaterThanOrEqualOpAst(ns,as,is.leadingWhitespace):tokenMatcher(is,LessThanOrEqualOp)?ns=buildLessThanOrEqualOpAst(ns,as,is.leadingWhitespace):this.ACTION(()=>{throw Error("Operator not supported")})}),ns}),this.formula=this.RULE("formula",()=>(this.CONSUME(EqualsOp),this.SUBRULE(this.booleanExpression))),this.lexerConfig=ts,this.sheetMapping=rs,this.formulaAddress=simpleCellAddress(0,0,0),this.performSelfAnalysis()}parseFromTokens(ts,rs){this.input=ts;let ns=this.formulaWithContext(rs),is=[];return this.customParsingError&&is.push(this.customParsingError),is=is.concat(this.errors.map(as=>({type:ParsingErrorType.ParserError,message:as.message}))),is.length>0&&(ns=buildParsingErrorAst()),{ast:ns,errors:is}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(ts){return this.formulaAddress=ts,this.formula()}buildCellRange(ts,rs,ns){if(ts.sheet===void 0&&rs.sheet!==void 0)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:is,secondEnd:as,sheetRefType:os}=FormulaParser.fixSheetIdsForRangeEnds(ts,rs),{start:ls,end:us}=this.orderCellRangeEnds(is,as);return buildCellRangeAst(ls,us,os,ns)}static fixSheetIdsForRangeEnds(ts,rs){const ns=FormulaParser.rangeSheetReferenceType(ts.sheet,rs.sheet),is=ts.sheet!==void 0&&rs.sheet===void 0?rs.withSheet(ts.sheet):rs;return{firstEnd:ts,secondEnd:is,sheetRefType:ns}}orderCellRangeEnds(ts,rs){const ns=[ts,rs],[is,as]=ns.map(ps=>ps.toColumnAddress()).sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[os,ls]=ns.map(ps=>ps.toRowAddress()).sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[us,cs]=ns.map(ps=>ps.sheet).sort(FormulaParser.compareSheetIds.bind(this));return{start:CellAddress.fromColAndRow(is,os,us),end:CellAddress.fromColAndRow(as,ls,cs)}}orderColumnRangeEnds(ts,rs){const ns=[ts,rs],[is,as]=ns.sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[os,ls]=ns.map(us=>us.sheet).sort(FormulaParser.compareSheetIds.bind(this));return{start:new ColumnAddress(is.type,is.col,os),end:new ColumnAddress(as.type,as.col,ls)}}orderRowRangeEnds(ts,rs){const ns=[ts,rs],[is,as]=ns.sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[os,ls]=ns.map(us=>us.sheet).sort(FormulaParser.compareSheetIds.bind(this));return{start:new RowAddress(is.type,is.row,os),end:new RowAddress(as.type,as.row,ls)}}static compareSheetIds(ts,rs){return ts=ts??1/0,rs=rs??1/0,ts-rs}handleOffsetHeuristic(ts){const rs=ts[0];if(rs.type!==AstNodeType.CELL_REFERENCE)return this.parsingError(ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");const ns=ts[1];let is;if(ns.type===AstNodeType.NUMBER&&Number.isInteger(ns.value))is=ns.value;else if(ns.type===AstNodeType.PLUS_UNARY_OP&&ns.value.type===AstNodeType.NUMBER&&Number.isInteger(ns.value.value))is=ns.value.value;else if(ns.type===AstNodeType.MINUS_UNARY_OP&&ns.value.type===AstNodeType.NUMBER&&Number.isInteger(ns.value.value))is=-ns.value.value;else return this.parsingError(ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");const as=ts[2];let os;if(as.type===AstNodeType.NUMBER&&Number.isInteger(as.value))os=as.value;else if(as.type===AstNodeType.PLUS_UNARY_OP&&as.value.type===AstNodeType.NUMBER&&Number.isInteger(as.value.value))os=as.value.value;else if(as.type===AstNodeType.MINUS_UNARY_OP&&as.value.type===AstNodeType.NUMBER&&Number.isInteger(as.value.value))os=-as.value.value;else return this.parsingError(ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");const ls=ts[3];let us;if(ls===void 0)us=1;else if(ls.type===AstNodeType.NUMBER){if(us=ls.value,us<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(us))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}else return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");const cs=ts[4];let ps;if(cs===void 0)ps=1;else if(cs.type===AstNodeType.NUMBER){if(ps=cs.value,ps<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(ps))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}else return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");const ds=new CellAddress(rs.reference.col+os,rs.reference.row+is,rs.reference.type);let fs=ds.col,hs=ds.row;if((rs.reference.type===CellReferenceType.CELL_REFERENCE_RELATIVE||rs.reference.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL)&&(hs=hs+this.formulaAddress.row),(rs.reference.type===CellReferenceType.CELL_REFERENCE_RELATIVE||rs.reference.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW)&&(fs=fs+this.formulaAddress.col),fs<0||hs<0)return buildCellErrorAst(new CellError(ErrorType.REF,ErrorMessage.OutOfSheet));if(ps===1&&us===1)return buildCellReferenceAst(ds);{const ys=new CellAddress(ds.col+ps-1,ds.row+us-1,ds.type);return buildCellRangeAst(ds,ys,RangeSheetReferenceType.RELATIVE)}}parsingError(ts,rs){return this.customParsingError=parsingError(ts,rs),buildParsingErrorAst()}static rangeSheetReferenceType(ts,rs){return ts===void 0?RangeSheetReferenceType.RELATIVE:rs===void 0?RangeSheetReferenceType.START_ABSOLUTE:RangeSheetReferenceType.BOTH_ABSOLUTE}}class FormulaLexer{constructor(ts){this.lexerConfig=ts,this.lexer=new Lexer(ts.allTokens,{ensureOptimizations:!0})}tokenizeFormula(ts){const rs=this.lexer.tokenize(ts);let ns=rs.tokens;return ns=this.trimTrailingWhitespaces(ns),ns=this.skipWhitespacesInsideRanges(ns),ns=this.skipWhitespacesBeforeArgSeparators(ns),rs.tokens=ns,rs}skipWhitespacesInsideRanges(ts){return FormulaLexer.filterTokensByNeighbors(ts,(rs,ns,is)=>(tokenMatcher(rs,CellReference)||tokenMatcher(rs,RangeSeparator))&&tokenMatcher(ns,this.lexerConfig.WhiteSpace)&&(tokenMatcher(is,CellReference)||tokenMatcher(is,RangeSeparator)))}skipWhitespacesBeforeArgSeparators(ts){return FormulaLexer.filterTokensByNeighbors(ts,(rs,ns,is)=>!tokenMatcher(rs,this.lexerConfig.ArgSeparator)&&tokenMatcher(ns,this.lexerConfig.WhiteSpace)&&tokenMatcher(is,this.lexerConfig.ArgSeparator))}static filterTokensByNeighbors(ts,rs){if(ts.length<3)return ts;let ns=0;const is=[ts[ns++]];for(;ns<ts.length-1;)rs(ts[ns-1],ts[ns],ts[ns+1])||is.push(ts[ns]),++ns;return is.push(ts[ns]),is}trimTrailingWhitespaces(ts){return ts.length>0&&tokenMatcher(ts[ts.length-1],this.lexerConfig.WhiteSpace)&&ts.pop(),ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Unparser{constructor(ts,rs,ns,is){this.config=ts,this.lexerConfig=rs,this.sheetMappingFn=ns,this.namedExpressions=is}unparse(ts,rs){return"="+this.unparseAst(ts,rs)}unparseAst(ts,rs){var ns,is;switch(ts.type){case AstNodeType.EMPTY:return imageWithWhitespace("",ts.leadingWhitespace);case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(ts.value,this.config.decimalSeparator),ts.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+ts.value+'"',ts.leadingWhitespace);case AstNodeType.FUNCTION_CALL:{const as=ts.args.map(us=>us!==void 0?this.unparseAst(us,rs):"").join(this.config.functionArgSeparator),ls=(this.config.translationPackage.isFunctionTranslated(ts.procedureName)?this.config.translationPackage.getFunctionTranslation(ts.procedureName):ts.procedureName)+"("+as+imageWithWhitespace(")",ts.internalWhitespace);return imageWithWhitespace(ls,ts.leadingWhitespace)}case AstNodeType.NAMED_EXPRESSION:{const as=(ns=this.namedExpressions.nearestNamedExpression(ts.expressionName,rs.sheet))===null||ns===void 0?void 0:ns.displayName;return imageWithWhitespace(as||ts.expressionName,ts.leadingWhitespace)}case AstNodeType.CELL_REFERENCE:{let as;return ts.reference.sheet!==void 0?as=this.unparseSheetName(ts.reference.sheet)+"!":as="",as+=(is=ts.reference.unparse(rs))!==null&&is!==void 0?is:this.config.translationPackage.getErrorTranslation(ErrorType.REF),imageWithWhitespace(as,ts.leadingWhitespace)}case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:return imageWithWhitespace(this.formatRange(ts,rs),ts.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:{const as=this.unparseAst(ts.value,rs);return imageWithWhitespace("+",ts.leadingWhitespace)+as}case AstNodeType.MINUS_UNARY_OP:{const as=this.unparseAst(ts.value,rs);return imageWithWhitespace("-",ts.leadingWhitespace)+as}case AstNodeType.PERCENT_OP:return this.unparseAst(ts.value,rs)+imageWithWhitespace("%",ts.leadingWhitespace);case AstNodeType.ERROR:{const as=this.config.translationPackage.getErrorTranslation(ts.error?ts.error.type:ErrorType.ERROR);return imageWithWhitespace(as,ts.leadingWhitespace)}case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(ts.rawInput,ts.leadingWhitespace);case AstNodeType.PARENTHESIS:{const os="("+this.unparseAst(ts.expression,rs)+imageWithWhitespace(")",ts.internalWhitespace);return imageWithWhitespace(os,ts.leadingWhitespace)}case AstNodeType.ARRAY:{const as="{"+ts.args.map(os=>os.map(ls=>this.unparseAst(ls,rs)).join(this.config.arrayColumnSeparator)).join(this.config.arrayRowSeparator)+imageWithWhitespace("}",ts.internalWhitespace);return imageWithWhitespace(as,ts.leadingWhitespace)}default:{const as=this.unparseAst(ts.left,rs),os=this.unparseAst(ts.right,rs);return as+imageWithWhitespace(binaryOpTokenMap[ts.type],ts.leadingWhitespace)+os}}}unparseSheetName(ts){const rs=sheetIndexToString(ts,this.sheetMappingFn);if(rs===void 0)throw new NoSheetWithIdError(ts);return rs}formatRange(ts,rs){let ns="",is="";ts.start.sheet!==void 0&&ts.sheetReferenceType!==RangeSheetReferenceType.RELATIVE&&(ns=this.unparseSheetName(ts.start.sheet)+"!"),ts.end.sheet!==void 0&&ts.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE&&(is=this.unparseSheetName(ts.end.sheet)+"!");const as=ts.start.unparse(rs),os=ts.end.unparse(rs);return as===void 0||os===void 0?this.config.translationPackage.getErrorTranslation(ErrorType.REF):`${ns}${as}:${is}${os}`}}function formatNumber(ss,ts){return ss.toString().replace(".",ts)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ParserWithCaching{constructor(ts,rs,ns){this.config=ts,this.functionRegistry=rs,this.sheetMapping=ns,this.statsCacheUsed=0,this.lexerConfig=buildLexerConfig(ts),this.lexer=new FormulaLexer(this.lexerConfig),this.formulaParser=new FormulaParser(this.lexerConfig,this.sheetMapping),this.cache=new Cache(this.functionRegistry)}parse(ts,rs){const ns=this.tokenizeFormula(ts);if(ns.errors.length>0){const ps=ns.errors.map(ds=>({type:ParsingErrorType.LexingError,message:ds.message}));return{ast:buildParsingErrorAst(),errors:ps,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const is=this.computeHashFromTokens(ns.tokens,rs);let as=this.cache.get(is);if(as!==void 0)++this.statsCacheUsed;else{const ps=this.bindWhitespacesToTokens(ns.tokens),ds=this.formulaParser.parseFromTokens(ps,rs);if(ds.errors.length>0)return Object.assign(Object.assign({},ds),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});as=this.cache.set(is,ds.ast)}const{ast:os,hasVolatileFunction:ls,hasStructuralChangeFunction:us,relativeDependencies:cs}=as;return{ast:os,errors:[],hasVolatileFunction:ls,hasStructuralChangeFunction:us,dependencies:cs}}fetchCachedResultForAst(ts){const rs=this.computeHashFromAst(ts);return this.fetchCachedResult(rs)}fetchCachedResult(ts){const rs=this.cache.get(ts);if(rs===void 0)throw new Error("There is no AST with such key in the cache");{const{ast:ns,hasVolatileFunction:is,hasStructuralChangeFunction:as,relativeDependencies:os}=rs;return{ast:ns,errors:[],hasVolatileFunction:is,hasStructuralChangeFunction:as,dependencies:os}}}computeHashFromTokens(ts,rs){var ns;let is="",as=0;for(;as<ts.length;){const os=ts[as];if(tokenMatcher(os,CellReference)){const ls=cellAddressFromString(this.sheetMapping,os.image,rs);ls===void 0?is=is.concat(os.image):is=is.concat(ls.hash(!0))}else if(tokenMatcher(os,ProcedureName)){const ls=os.image.toUpperCase().slice(0,-1),us=(ns=this.lexerConfig.functionMapping[ls])!==null&&ns!==void 0?ns:ls;is=is.concat(us,"(")}else if(tokenMatcher(os,ColumnRange)){const[ls,us]=os.image.split(":"),cs=columnAddressFromString(this.sheetMapping,ls,rs),ps=columnAddressFromString(this.sheetMapping,us,rs);cs===void 0||ps===void 0?is=is.concat("!REF"):is=is.concat(cs.hash(!0),":",ps.hash(!0))}else if(tokenMatcher(os,RowRange)){const[ls,us]=os.image.split(":"),cs=rowAddressFromString(this.sheetMapping,ls,rs),ps=rowAddressFromString(this.sheetMapping,us,rs);cs===void 0||ps===void 0?is=is.concat("!REF"):is=is.concat(cs.hash(!0),":",ps.hash(!0))}else is=is.concat(os.image);as++}return is}rememberNewAst(ts){const rs=this.computeHashFromAst(ts);return this.cache.maybeSetAndThenGet(rs,ts)}computeHashFromAst(ts){return"="+this.computeHashOfAstNode(ts)}computeHashOfAstNode(ts){switch(ts.type){case AstNodeType.EMPTY:return ts.leadingWhitespace||"";case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(ts.value,this.config.decimalSeparator),ts.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+ts.value+'"',ts.leadingWhitespace);case AstNodeType.NAMED_EXPRESSION:return imageWithWhitespace(ts.expressionName,ts.leadingWhitespace);case AstNodeType.FUNCTION_CALL:{const rs=ts.args.map(is=>this.computeHashOfAstNode(is)).join(this.config.functionArgSeparator),ns=ts.procedureName+"("+rs+imageWithWhitespace(")",ts.internalWhitespace);return imageWithWhitespace(ns,ts.leadingWhitespace)}case AstNodeType.CELL_REFERENCE:return imageWithWhitespace(ts.reference.hash(!0),ts.leadingWhitespace);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:{const rs=ts.start.hash(ts.sheetReferenceType!==RangeSheetReferenceType.RELATIVE),ns=ts.end.hash(ts.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE);return imageWithWhitespace(rs+":"+ns,ts.leadingWhitespace)}case AstNodeType.MINUS_UNARY_OP:return imageWithWhitespace("-"+this.computeHashOfAstNode(ts.value),ts.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:return imageWithWhitespace("+"+this.computeHashOfAstNode(ts.value),ts.leadingWhitespace);case AstNodeType.PERCENT_OP:return this.computeHashOfAstNode(ts.value)+imageWithWhitespace("%",ts.leadingWhitespace);case AstNodeType.ERROR:{const rs=this.config.translationPackage.getErrorTranslation(ts.error?ts.error.type:ErrorType.ERROR);return imageWithWhitespace(rs,ts.leadingWhitespace)}case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(ts.rawInput,ts.leadingWhitespace);case AstNodeType.ARRAY:{const rs=ts.args.map(ns=>ns.map(is=>this.computeHashOfAstNode(is)).join(",")).join(";");return imageWithWhitespace("{"+rs+imageWithWhitespace("}",ts.internalWhitespace),ts.leadingWhitespace)}case AstNodeType.PARENTHESIS:{const ns="("+this.computeHashOfAstNode(ts.expression)+imageWithWhitespace(")",ts.internalWhitespace);return imageWithWhitespace(ns,ts.leadingWhitespace)}default:return this.computeHashOfAstNode(ts.left)+imageWithWhitespace(binaryOpTokenMap[ts.type],ts.leadingWhitespace)+this.computeHashOfAstNode(ts.right)}}bindWhitespacesToTokens(ts){const rs=[],ns=ts[0];tokenMatcher(ns,this.lexerConfig.WhiteSpace)||rs.push(ns);for(let is=1;is<ts.length;++is){const as=ts[is];if(tokenMatcher(as,this.lexerConfig.WhiteSpace))continue;const os=ts[is-1];tokenMatcher(os,this.lexerConfig.WhiteSpace)&&(as.leadingWhitespace=os),rs.push(as)}return rs}tokenizeFormula(ts){return this.lexer.tokenizeFormula(ts)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const collectDependenciesFn=(ss,ts,rs,ns)=>{switch(ss.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:return;case AstNodeType.NAMED_EXPRESSION:{ns&&rs.push(new NamedExpressionDependency(ss.expressionName));return}case AstNodeType.CELL_REFERENCE:{ns&&rs.push(new AddressDependency(ss.reference));return}case AstNodeType.CELL_RANGE:{ns&&ss.start.sheet===ss.end.sheet&&rs.push(new CellRangeDependency(ss.start,ss.end));return}case AstNodeType.COLUMN_RANGE:{ns&&ss.start.sheet===ss.end.sheet&&rs.push(new ColumnRangeDependency(ss.start,ss.end));return}case AstNodeType.ROW_RANGE:{ns&&ss.start.sheet===ss.end.sheet&&rs.push(new RowRangeDependency(ss.start,ss.end));return}case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:{collectDependenciesFn(ss.value,ts,rs,!0);return}case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:collectDependenciesFn(ss.left,ts,rs,!0),collectDependenciesFn(ss.right,ts,rs,!0);return;case AstNodeType.PARENTHESIS:collectDependenciesFn(ss.expression,ts,rs,ns);return;case AstNodeType.FUNCTION_CALL:{const is=!ts.doesFunctionNeedArgumentToBeComputed(ss.procedureName);ss.args.forEach(as=>collectDependenciesFn(as,ts,rs,is));return}}},collectDependencies=(ss,ts)=>{const rs=new Array;return collectDependenciesFn(ss,ts,rs,!0),rs};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AddressDependency{constructor(ts){this.dependency=ts}absolutize(ts){return this.dependency.toSimpleCellAddress(ts)}}class CellRangeDependency{constructor(ts,rs){this.start=ts,this.end=rs}absolutize(ts){return new AbsoluteCellRange(this.start.toSimpleCellAddress(ts),this.end.toSimpleCellAddress(ts))}}class ColumnRangeDependency{constructor(ts,rs){this.start=ts,this.end=rs}absolutize(ts){const rs=this.start.toSimpleColumnAddress(ts),ns=this.end.toSimpleColumnAddress(ts);return new AbsoluteColumnRange(rs.sheet,rs.col,ns.col)}}class RowRangeDependency{constructor(ts,rs){this.start=ts,this.end=rs}absolutize(ts){const rs=this.start.toSimpleRowAddress(ts),ns=this.end.toSimpleRowAddress(ts);return new AbsoluteRowRange(rs.sheet,rs.row,ns.row)}}class NamedExpressionDependency{constructor(ts){this.name=ts}absolutize(ts){return this}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RowsSpan{constructor(ts,rs,ns){if(this.sheet=ts,this.rowStart=rs,this.rowEnd=ns,rs<0)throw Error("Starting row cant be less than 0");if(ns<rs)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(ts,rs,ns){return new RowsSpan(ts,rs,rs+ns-1)}static fromRowStartAndEnd(ts,rs,ns){return new RowsSpan(ts,rs,ns)}*rows(){for(let ts=this.rowStart;ts<=this.rowEnd;++ts)yield ts}intersect(ts){if(this.sheet!==ts.sheet)throw Error("Can't intersect spans from different sheets");const rs=Math.max(this.rowStart,ts.rowStart),ns=Math.min(this.rowEnd,ts.rowEnd);return rs>ns?null:new RowsSpan(this.sheet,rs,ns)}firstRow(){return new RowsSpan(this.sheet,this.rowStart,this.rowStart)}}class ColumnsSpan{constructor(ts,rs,ns){if(this.sheet=ts,this.columnStart=rs,this.columnEnd=ns,rs<0)throw Error("Starting column cant be less than 0");if(ns<rs)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(ts,rs,ns){return new ColumnsSpan(ts,rs,rs+ns-1)}static fromColumnStartAndEnd(ts,rs,ns){return new ColumnsSpan(ts,rs,ns)}*columns(){for(let ts=this.columnStart;ts<=this.columnEnd;++ts)yield ts}intersect(ts){if(this.sheet!==ts.sheet)throw Error("Can't intersect spans from different sheets");const rs=Math.max(this.columnStart,ts.columnStart),ns=Math.min(this.columnEnd,ts.columnEnd);return rs>ns?null:new ColumnsSpan(this.sheet,rs,ns)}firstColumn(){return new ColumnsSpan(this.sheet,this.columnStart,this.columnStart)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const WRONG_RANGE_SIZE="AbsoluteCellRange: Wrong range size";function isSimpleCellRange(ss){return ss&&(typeof ss=="object"||typeof ss=="function")?"start"in ss&&isSimpleCellAddress(ss.start)&&"end"in ss&&isSimpleCellAddress(ss.end):!1}const simpleCellRange=(ss,ts)=>({start:ss,end:ts});class AbsoluteCellRange{constructor(ts,rs){if(ts.sheet!==rs.sheet)throw new SheetsNotEqual(ts.sheet,rs.sheet);this.start=simpleCellAddress(ts.sheet,ts.col,ts.row),this.end=simpleCellAddress(rs.sheet,rs.col,rs.row)}get sheet(){return this.start.sheet}static fromAst(ts,rs){return ts.type===AstNodeType.CELL_RANGE?AbsoluteCellRange.fromCellRange(ts,rs):ts.type===AstNodeType.COLUMN_RANGE?AbsoluteColumnRange.fromColumnRange(ts,rs):AbsoluteRowRange.fromRowRangeAst(ts,rs)}static fromAstOrUndef(ts,rs){try{return AbsoluteCellRange.fromAst(ts,rs)}catch{return}}static fromCellRange(ts,rs){return new AbsoluteCellRange(ts.start.toSimpleCellAddress(rs),ts.end.toSimpleCellAddress(rs))}static spanFrom(ts,rs,ns){const is=AbsoluteCellRange.spanFromOrUndef(ts,rs,ns);if(is===void 0)throw new Error(WRONG_RANGE_SIZE);return is}static spanFromOrUndef(ts,rs,ns){if(!Number.isFinite(rs)&&Number.isFinite(ns))return ts.col!==0?void 0:new AbsoluteRowRange(ts.sheet,ts.row,ts.row+ns-1);if(!Number.isFinite(ns)&&Number.isFinite(rs))return ts.row!==0?void 0:new AbsoluteColumnRange(ts.sheet,ts.col,ts.col+rs-1);if(Number.isFinite(ns)&&Number.isFinite(rs))return new AbsoluteCellRange(ts,simpleCellAddress(ts.sheet,ts.col+rs-1,ts.row+ns-1))}static fromCoordinates(ts,rs,ns,is,as){return new AbsoluteCellRange(simpleCellAddress(ts,rs,ns),simpleCellAddress(ts,is,as))}isFinite(){return Number.isFinite(this.size())}doesOverlap(ts){return!(this.start.sheet!=ts.start.sheet||this.end.row<ts.start.row||this.start.row>ts.end.row||this.end.col<ts.start.col||this.start.col>ts.end.col)}addressInRange(ts){return this.sheet!==ts.sheet?!1:this.start.row<=ts.row&&this.end.row>=ts.row&&this.start.col<=ts.col&&this.end.col>=ts.col}columnInRange(ts){return this.sheet!==ts.sheet?!1:this.start.col<=ts.col&&this.end.col>=ts.col}rowInRange(ts){return this.sheet!==ts.sheet?!1:this.start.row<=ts.row&&this.end.row>=ts.row}containsRange(ts){return this.addressInRange(ts.start)&&this.addressInRange(ts.end)}intersectionWith(ts){if(this.sheet!==ts.start.sheet)return;const rs=Math.max(this.start.row,ts.start.row),ns=Math.min(this.end.row,ts.end.row),is=Math.max(this.start.col,ts.start.col),as=Math.min(this.end.col,ts.end.col);if(!(rs>ns||is>as))return new AbsoluteCellRange(simpleCellAddress(this.sheet,is,rs),simpleCellAddress(this.sheet,as,ns))}includesRow(ts){return this.start.row<ts&&this.end.row>=ts}includesColumn(ts){return this.start.col<ts&&this.end.col>=ts}shiftByRows(ts){this.start.row+=ts,this.end.row+=ts}expandByRows(ts){this.end.row+=ts}shiftByColumns(ts){this.start.col+=ts,this.end.col+=ts}shifted(ts,rs){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,this.start.col+ts,this.start.row+rs),this.width(),this.height())}expandByColumns(ts){this.end.col+=ts}moveToSheet(ts){this.start.sheet=ts,this.end.sheet=ts}removeSpan(ts){ts instanceof RowsSpan?this.removeRows(ts.start,ts.end):this.removeColumns(ts.start,ts.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(ts,rs){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,this.start.col,ts),this.width(),rs)}rangeWithSameHeight(ts,rs){return AbsoluteCellRange.spanFrom(simpleCellAddress(this.sheet,ts,this.start.row),rs,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const ts=[];for(let rs=0;rs<this.height();++rs){ts[rs]=[];for(let ns=0;ns<this.width();++ns){const is=simpleCellAddress(this.sheet,this.start.col+ns,this.start.row+rs);ts[rs].push(is)}}return ts}withStart(ts){return new AbsoluteCellRange(ts,this.end)}sameDimensionsAs(ts){return this.width()===ts.width()&&this.height()===ts.height()}sameAs(ts){return equalSimpleCellAddress(this.start,ts.start)&&equalSimpleCellAddress(this.end,ts.end)}addressesArrayMap(ts,rs){const ns=[];let is=this.start.row;for(;is<=this.effectiveEndRow(ts);){let as=this.start.col;const os=[];for(;as<=this.effectiveEndColumn(ts);)os.push(rs(simpleCellAddress(this.start.sheet,as,is))),as++;ns.push(os),is++}return ns}addresses(ts){const rs=[];let ns=this.start.row;const is=this.effectiveEndRow(ts),as=this.effectiveEndColumn(ts);for(;ns<=is;){let os=this.start.col;for(;os<=as;)rs.push(simpleCellAddress(this.start.sheet,os,ns)),os++;ns++}return rs}*addressesWithDirection(ts,rs,ns){if(ts>0)if(rs>0){let is=this.effectiveEndRow(ns);for(;is>=this.start.row;){let as=this.effectiveEndColumn(ns);for(;as>=this.start.col;)yield simpleCellAddress(this.start.sheet,as,is),as-=1;is-=1}}else{let is=this.start.row;for(;is<=this.effectiveEndRow(ns);){let as=this.effectiveEndColumn(ns);for(;as>=this.start.col;)yield simpleCellAddress(this.start.sheet,as,is),as-=1;is+=1}}else if(rs>0){let is=this.effectiveEndRow(ns);for(;is>=this.start.row;){let as=this.start.col;for(;as<=this.effectiveEndColumn(ns);)yield simpleCellAddress(this.start.sheet,as,is),as+=1;is-=1}}else{let is=this.start.row;for(;is<=this.effectiveEndRow(ns);){let as=this.start.col;for(;as<=this.effectiveEndColumn(ns);)yield simpleCellAddress(this.start.sheet,as,is),as+=1;is+=1}}}getAddress(ts,rs){if(ts<0||rs<0||rs>this.height()-1||ts>this.width()-1)throw Error("Index out of bound");return simpleCellAddress(this.start.sheet,this.start.col+ts,this.start.row+rs)}exceedsSheetSizeLimits(ts,rs){return this.end.col>=ts||this.end.row>=rs}effectiveEndColumn(ts){return this.end.col}effectiveEndRow(ts){return this.end.row}effectiveWidth(ts){return this.width()}effectiveHeight(ts){return this.height()}removeRows(ts,rs){if(!(ts>this.end.row)){if(rs<this.start.row){const ns=rs-ts+1;return this.shiftByRows(-ns)}ts<=this.start.row&&(this.start.row=ts),this.end.row-=Math.min(rs,this.end.row)-ts+1}}removeColumns(ts,rs){if(!(ts>this.end.col)){if(rs<this.start.col){const ns=rs-ts+1;return this.shiftByColumns(-ns)}ts<=this.start.col&&(this.start.col=ts),this.end.col-=Math.min(rs,this.end.col)-ts+1}}}class AbsoluteColumnRange extends AbsoluteCellRange{constructor(ts,rs,ns){super(simpleCellAddress(ts,rs,0),simpleCellAddress(ts,ns,Number.POSITIVE_INFINITY))}static fromColumnRange(ts,rs){const ns=ts.start.toSimpleColumnAddress(rs),is=ts.end.toSimpleColumnAddress(rs);if(ns.sheet!==is.sheet)throw new SheetsNotEqual(ns.sheet,is.sheet);return new AbsoluteColumnRange(ns.sheet,ns.col,is.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(ts){}expandByRows(ts){}shifted(ts,rs){return new AbsoluteColumnRange(this.sheet,this.start.col+ts,this.end.col+ts)}rangeWithSameHeight(ts,rs){return new AbsoluteColumnRange(this.sheet,ts,ts+rs-1)}exceedsSheetSizeLimits(ts,rs){return this.end.col>=ts}effectiveEndRow(ts){return this.effectiveHeight(ts)-1}effectiveHeight(ts){return ts.getSheetHeight(this.sheet)}removeRows(ts,rs){}}class AbsoluteRowRange extends AbsoluteCellRange{constructor(ts,rs,ns){super(simpleCellAddress(ts,0,rs),simpleCellAddress(ts,Number.POSITIVE_INFINITY,ns))}static fromRowRangeAst(ts,rs){const ns=ts.start.toSimpleRowAddress(rs),is=ts.end.toSimpleRowAddress(rs);if(ns.sheet!==is.sheet)throw new SheetsNotEqual(ns.sheet,is.sheet);return new AbsoluteRowRange(ns.sheet,ns.row,is.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(ts){}expandByColumns(ts){}shifted(ts,rs){return new AbsoluteRowRange(this.sheet,this.start.row+rs,this.end.row+rs)}rangeWithSameWidth(ts,rs){return new AbsoluteRowRange(this.sheet,ts,ts+rs-1)}exceedsSheetSizeLimits(ts,rs){return this.end.row>=rs}effectiveEndColumn(ts){return this.effectiveWidth(ts)-1}effectiveWidth(ts){return ts.getSheetWidth(this.sheet)}removeColumns(ts,rs){}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const absolutizeDependencies=(ss,ts)=>ss.map(rs=>rs.absolutize(ts)),filterDependenciesOutOfScope=ss=>ss.filter(ts=>ts instanceof NamedExpressionDependency?!0:ts instanceof AbsoluteCellRange?!(invalidSimpleCellAddress(ts.start)||invalidSimpleCellAddress(ts.end)):!invalidSimpleCellAddress(ts));/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class InterpreterState{constructor(ts,rs,ns){this.formulaAddress=ts,this.arraysFlag=rs,this.formulaVertex=ns}}var unormExports={},unorm$1={get exports(){return unormExports},set exports(ss){unormExports=ss}};(function(ss){(function(ts){for(var rs=[null,0,{}],ns=10,is=44032,as=4352,os=4449,ls=4519,us=19,cs=21,ps=28,ds=cs*ps,fs=us*ds,hs=function(_s,Bs){this.codepoint=_s,this.feature=Bs},ys={},gs=[],bs=0;bs<=255;++bs)gs[bs]=0;function vs(_s,Bs,Us){var zs=ys[Bs];return zs||(zs=_s(Bs,Us),zs.feature&&++gs[Bs>>8&255]>ns&&(ys[Bs]=zs)),zs}function Ns(_s,Bs,Us){var zs=Bs&65280,Hs=hs.udata[zs]||{},el=Hs[Bs];return el?new hs(Bs,el):new hs(Bs,rs)}function Ts(_s,Bs,Us){return Us?_s(Bs,Us):new hs(Bs,null)}function Cs(_s,Bs,Us){var zs;if(Bs<as||as+us<=Bs&&Bs<is||is+fs<Bs)return _s(Bs,Us);if(as<=Bs&&Bs<as+us){var Hs={},el=(Bs-as)*cs;for(zs=0;zs<cs;++zs)Hs[os+zs]=is+ps*(zs+el);return new hs(Bs,[,,Hs])}var Ys=Bs-is,il=Ys%ps,al=[];if(il!==0)al[0]=[is+Ys-il,ls+il];else for(al[0]=[as+Math.floor(Ys/ds),os+Math.floor(Ys%ds/ps)],al[2]={},zs=1;zs<ps;++zs)al[2][ls+zs]=Bs+zs;return new hs(Bs,al)}function xs(_s,Bs,Us){return Bs<60||13311<Bs&&Bs<42607?new hs(Bs,rs):_s(Bs,Us)}var As=[xs,vs,Ts,Cs,Ns];hs.fromCharCode=As.reduceRight(function(_s,Bs){return function(Us,zs){return Bs(_s,Us,zs)}},null),hs.isHighSurrogate=function(_s){return _s>=55296&&_s<=56319},hs.isLowSurrogate=function(_s){return _s>=56320&&_s<=57343},hs.prototype.prepFeature=function(){this.feature||(this.feature=hs.fromCharCode(this.codepoint,!0).feature)},hs.prototype.toString=function(){if(this.codepoint<65536)return String.fromCharCode(this.codepoint);var _s=this.codepoint-65536;return String.fromCharCode(Math.floor(_s/1024)+55296,_s%1024+56320)},hs.prototype.getDecomp=function(){return this.prepFeature(),this.feature[0]||null},hs.prototype.isCompatibility=function(){return this.prepFeature(),!!this.feature[1]&&this.feature[1]&1<<8},hs.prototype.isExclude=function(){return this.prepFeature(),!!this.feature[1]&&this.feature[1]&1<<9},hs.prototype.getCanonicalClass=function(){return this.prepFeature(),this.feature[1]?this.feature[1]&255:0},hs.prototype.getComposite=function(_s){if(this.prepFeature(),!this.feature[2])return null;var Bs=this.feature[2][_s.codepoint];return Bs?hs.fromCharCode(Bs):null};var ws=function(_s){this.str=_s,this.cursor=0};ws.prototype.next=function(){if(this.str&&this.cursor<this.str.length){var _s=this.str.charCodeAt(this.cursor++),Bs;return hs.isHighSurrogate(_s)&&this.cursor<this.str.length&&hs.isLowSurrogate(Bs=this.str.charCodeAt(this.cursor))&&(_s=(_s-55296)*1024+(Bs-56320)+65536,++this.cursor),hs.fromCharCode(_s)}else return this.str=null,null};var Es=function(_s,Bs){this.it=_s,this.canonical=Bs,this.resBuf=[]};Es.prototype.next=function(){function _s(Us,zs){var Hs=zs.getDecomp();if(Hs&&!(Us&&zs.isCompatibility())){for(var el=[],Ys=0;Ys<Hs.length;++Ys){var il=_s(Us,hs.fromCharCode(Hs[Ys]));el=el.concat(il)}return el}else return[zs]}if(this.resBuf.length===0){var Bs=this.it.next();if(!Bs)return null;this.resBuf=_s(this.canonical,Bs)}return this.resBuf.shift()};var Ss=function(_s){this.it=_s,this.resBuf=[]};Ss.prototype.next=function(){var _s;if(this.resBuf.length===0)do{var Bs=this.it.next();if(!Bs)break;_s=Bs.getCanonicalClass();var Us=this.resBuf.length;if(_s!==0)for(;Us>0;--Us){var zs=this.resBuf[Us-1],Hs=zs.getCanonicalClass();if(Hs<=_s)break}this.resBuf.splice(Us,0,Bs)}while(_s!==0);return this.resBuf.shift()};var Ds=function(_s){this.it=_s,this.procBuf=[],this.resBuf=[],this.lastClass=null};Ds.prototype.next=function(){for(;this.resBuf.length===0;){var _s=this.it.next();if(!_s){this.resBuf=this.procBuf,this.procBuf=[];break}if(this.procBuf.length===0)this.lastClass=_s.getCanonicalClass(),this.procBuf.push(_s);else{var Bs=this.procBuf[0],Us=Bs.getComposite(_s),zs=_s.getCanonicalClass();Us&&(this.lastClass<zs||this.lastClass===0)?this.procBuf[0]=Us:(zs===0&&(this.resBuf=this.procBuf,this.procBuf=[]),this.lastClass=zs,this.procBuf.push(_s))}}return this.resBuf.shift()};var Vs=function(_s,Bs){switch(_s){case"NFD":return new Ss(new Es(new ws(Bs),!0));case"NFKD":return new Ss(new Es(new ws(Bs),!1));case"NFC":return new Ds(new Ss(new Es(new ws(Bs),!0)));case"NFKC":return new Ds(new Ss(new Es(new ws(Bs),!1)))}throw _s+" is invalid"},Is=function(_s,Bs){for(var Us=Vs(_s,Bs),zs="",Hs;Hs=Us.next();)zs+=Hs.toString();return zs};function Os(_s){return Is("NFD",_s)}function Ps(_s){return Is("NFKD",_s)}function $s(_s){return Is("NFC",_s)}function Rs(_s){return Is("NFKC",_s)}hs.udata={0:{60:[,,{824:8814}],61:[,,{824:8800}],62:[,,{824:8815}],65:[,,{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260}],66:[,,{775:7682,803:7684,817:7686}],67:[,,{769:262,770:264,775:266,780:268,807:199}],68:[,,{775:7690,780:270,803:7692,807:7696,813:7698,817:7694}],69:[,,{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706}],70:[,,{775:7710}],71:[,,{769:500,770:284,772:7712,774:286,775:288,780:486,807:290}],72:[,,{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722}],73:[,,{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724}],74:[,,{770:308}],75:[,,{769:7728,780:488,803:7730,807:310,817:7732}],76:[,,{769:313,780:317,803:7734,807:315,813:7740,817:7738}],77:[,,{769:7742,775:7744,803:7746}],78:[,,{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752}],79:[,,{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490}],80:[,,{769:7764,775:7766}],82:[,,{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774}],83:[,,{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350}],84:[,,{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790}],85:[,,{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796}],86:[,,{771:7804,803:7806}],87:[,,{768:7808,769:7810,770:372,775:7814,776:7812,803:7816}],88:[,,{775:7818,776:7820}],89:[,,{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924}],90:[,,{769:377,770:7824,775:379,780:381,803:7826,817:7828}],97:[,,{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261}],98:[,,{775:7683,803:7685,817:7687}],99:[,,{769:263,770:265,775:267,780:269,807:231}],100:[,,{775:7691,780:271,803:7693,807:7697,813:7699,817:7695}],101:[,,{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707}],102:[,,{775:7711}],103:[,,{769:501,770:285,772:7713,774:287,775:289,780:487,807:291}],104:[,,{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830}],105:[,,{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725}],106:[,,{770:309,780:496}],107:[,,{769:7729,780:489,803:7731,807:311,817:7733}],108:[,,{769:314,780:318,803:7735,807:316,813:7741,817:7739}],109:[,,{769:7743,775:7745,803:7747}],110:[,,{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753}],111:[,,{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491}],112:[,,{769:7765,775:7767}],114:[,,{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775}],115:[,,{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351}],116:[,,{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791}],117:[,,{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797}],118:[,,{771:7805,803:7807}],119:[,,{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817}],120:[,,{775:7819,776:7821}],121:[,,{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925}],122:[,,{769:378,770:7825,775:380,780:382,803:7827,817:7829}],160:[[32],256],168:[[32,776],256,{768:8173,769:901,834:8129}],170:[[97],256],175:[[32,772],256],178:[[50],256],179:[[51],256],180:[[32,769],256],181:[[956],256],184:[[32,807],256],185:[[49],256],186:[[111],256],188:[[49,8260,52],256],189:[[49,8260,50],256],190:[[51,8260,52],256],192:[[65,768]],193:[[65,769]],194:[[65,770],,{768:7846,769:7844,771:7850,777:7848}],195:[[65,771]],196:[[65,776],,{772:478}],197:[[65,778],,{769:506}],198:[,,{769:508,772:482}],199:[[67,807],,{769:7688}],200:[[69,768]],201:[[69,769]],202:[[69,770],,{768:7872,769:7870,771:7876,777:7874}],203:[[69,776]],204:[[73,768]],205:[[73,769]],206:[[73,770]],207:[[73,776],,{769:7726}],209:[[78,771]],210:[[79,768]],211:[[79,769]],212:[[79,770],,{768:7890,769:7888,771:7894,777:7892}],213:[[79,771],,{769:7756,772:556,776:7758}],214:[[79,776],,{772:554}],216:[,,{769:510}],217:[[85,768]],218:[[85,769]],219:[[85,770]],220:[[85,776],,{768:475,769:471,772:469,780:473}],221:[[89,769]],224:[[97,768]],225:[[97,769]],226:[[97,770],,{768:7847,769:7845,771:7851,777:7849}],227:[[97,771]],228:[[97,776],,{772:479}],229:[[97,778],,{769:507}],230:[,,{769:509,772:483}],231:[[99,807],,{769:7689}],232:[[101,768]],233:[[101,769]],234:[[101,770],,{768:7873,769:7871,771:7877,777:7875}],235:[[101,776]],236:[[105,768]],237:[[105,769]],238:[[105,770]],239:[[105,776],,{769:7727}],241:[[110,771]],242:[[111,768]],243:[[111,769]],244:[[111,770],,{768:7891,769:7889,771:7895,777:7893}],245:[[111,771],,{769:7757,772:557,776:7759}],246:[[111,776],,{772:555}],248:[,,{769:511}],249:[[117,768]],250:[[117,769]],251:[[117,770]],252:[[117,776],,{768:476,769:472,772:470,780:474}],253:[[121,769]],255:[[121,776]]},256:{256:[[65,772]],257:[[97,772]],258:[[65,774],,{768:7856,769:7854,771:7860,777:7858}],259:[[97,774],,{768:7857,769:7855,771:7861,777:7859}],260:[[65,808]],261:[[97,808]],262:[[67,769]],263:[[99,769]],264:[[67,770]],265:[[99,770]],266:[[67,775]],267:[[99,775]],268:[[67,780]],269:[[99,780]],270:[[68,780]],271:[[100,780]],274:[[69,772],,{768:7700,769:7702}],275:[[101,772],,{768:7701,769:7703}],276:[[69,774]],277:[[101,774]],278:[[69,775]],279:[[101,775]],280:[[69,808]],281:[[101,808]],282:[[69,780]],283:[[101,780]],284:[[71,770]],285:[[103,770]],286:[[71,774]],287:[[103,774]],288:[[71,775]],289:[[103,775]],290:[[71,807]],291:[[103,807]],292:[[72,770]],293:[[104,770]],296:[[73,771]],297:[[105,771]],298:[[73,772]],299:[[105,772]],300:[[73,774]],301:[[105,774]],302:[[73,808]],303:[[105,808]],304:[[73,775]],306:[[73,74],256],307:[[105,106],256],308:[[74,770]],309:[[106,770]],310:[[75,807]],311:[[107,807]],313:[[76,769]],314:[[108,769]],315:[[76,807]],316:[[108,807]],317:[[76,780]],318:[[108,780]],319:[[76,183],256],320:[[108,183],256],323:[[78,769]],324:[[110,769]],325:[[78,807]],326:[[110,807]],327:[[78,780]],328:[[110,780]],329:[[700,110],256],332:[[79,772],,{768:7760,769:7762}],333:[[111,772],,{768:7761,769:7763}],334:[[79,774]],335:[[111,774]],336:[[79,779]],337:[[111,779]],340:[[82,769]],341:[[114,769]],342:[[82,807]],343:[[114,807]],344:[[82,780]],345:[[114,780]],346:[[83,769],,{775:7780}],347:[[115,769],,{775:7781}],348:[[83,770]],349:[[115,770]],350:[[83,807]],351:[[115,807]],352:[[83,780],,{775:7782}],353:[[115,780],,{775:7783}],354:[[84,807]],355:[[116,807]],356:[[84,780]],357:[[116,780]],360:[[85,771],,{769:7800}],361:[[117,771],,{769:7801}],362:[[85,772],,{776:7802}],363:[[117,772],,{776:7803}],364:[[85,774]],365:[[117,774]],366:[[85,778]],367:[[117,778]],368:[[85,779]],369:[[117,779]],370:[[85,808]],371:[[117,808]],372:[[87,770]],373:[[119,770]],374:[[89,770]],375:[[121,770]],376:[[89,776]],377:[[90,769]],378:[[122,769]],379:[[90,775]],380:[[122,775]],381:[[90,780]],382:[[122,780]],383:[[115],256,{775:7835}],416:[[79,795],,{768:7900,769:7898,771:7904,777:7902,803:7906}],417:[[111,795],,{768:7901,769:7899,771:7905,777:7903,803:7907}],431:[[85,795],,{768:7914,769:7912,771:7918,777:7916,803:7920}],432:[[117,795],,{768:7915,769:7913,771:7919,777:7917,803:7921}],439:[,,{780:494}],452:[[68,381],256],453:[[68,382],256],454:[[100,382],256],455:[[76,74],256],456:[[76,106],256],457:[[108,106],256],458:[[78,74],256],459:[[78,106],256],460:[[110,106],256],461:[[65,780]],462:[[97,780]],463:[[73,780]],464:[[105,780]],465:[[79,780]],466:[[111,780]],467:[[85,780]],468:[[117,780]],469:[[220,772]],470:[[252,772]],471:[[220,769]],472:[[252,769]],473:[[220,780]],474:[[252,780]],475:[[220,768]],476:[[252,768]],478:[[196,772]],479:[[228,772]],480:[[550,772]],481:[[551,772]],482:[[198,772]],483:[[230,772]],486:[[71,780]],487:[[103,780]],488:[[75,780]],489:[[107,780]],490:[[79,808],,{772:492}],491:[[111,808],,{772:493}],492:[[490,772]],493:[[491,772]],494:[[439,780]],495:[[658,780]],496:[[106,780]],497:[[68,90],256],498:[[68,122],256],499:[[100,122],256],500:[[71,769]],501:[[103,769]],504:[[78,768]],505:[[110,768]],506:[[197,769]],507:[[229,769]],508:[[198,769]],509:[[230,769]],510:[[216,769]],511:[[248,769]],66045:[,220]},512:{512:[[65,783]],513:[[97,783]],514:[[65,785]],515:[[97,785]],516:[[69,783]],517:[[101,783]],518:[[69,785]],519:[[101,785]],520:[[73,783]],521:[[105,783]],522:[[73,785]],523:[[105,785]],524:[[79,783]],525:[[111,783]],526:[[79,785]],527:[[111,785]],528:[[82,783]],529:[[114,783]],530:[[82,785]],531:[[114,785]],532:[[85,783]],533:[[117,783]],534:[[85,785]],535:[[117,785]],536:[[83,806]],537:[[115,806]],538:[[84,806]],539:[[116,806]],542:[[72,780]],543:[[104,780]],550:[[65,775],,{772:480}],551:[[97,775],,{772:481}],552:[[69,807],,{774:7708}],553:[[101,807],,{774:7709}],554:[[214,772]],555:[[246,772]],556:[[213,772]],557:[[245,772]],558:[[79,775],,{772:560}],559:[[111,775],,{772:561}],560:[[558,772]],561:[[559,772]],562:[[89,772]],563:[[121,772]],658:[,,{780:495}],688:[[104],256],689:[[614],256],690:[[106],256],691:[[114],256],692:[[633],256],693:[[635],256],694:[[641],256],695:[[119],256],696:[[121],256],728:[[32,774],256],729:[[32,775],256],730:[[32,778],256],731:[[32,808],256],732:[[32,771],256],733:[[32,779],256],736:[[611],256],737:[[108],256],738:[[115],256],739:[[120],256],740:[[661],256],66272:[,220]},768:{768:[,230],769:[,230],770:[,230],771:[,230],772:[,230],773:[,230],774:[,230],775:[,230],776:[,230,{769:836}],777:[,230],778:[,230],779:[,230],780:[,230],781:[,230],782:[,230],783:[,230],784:[,230],785:[,230],786:[,230],787:[,230],788:[,230],789:[,232],790:[,220],791:[,220],792:[,220],793:[,220],794:[,232],795:[,216],796:[,220],797:[,220],798:[,220],799:[,220],800:[,220],801:[,202],802:[,202],803:[,220],804:[,220],805:[,220],806:[,220],807:[,202],808:[,202],809:[,220],810:[,220],811:[,220],812:[,220],813:[,220],814:[,220],815:[,220],816:[,220],817:[,220],818:[,220],819:[,220],820:[,1],821:[,1],822:[,1],823:[,1],824:[,1],825:[,220],826:[,220],827:[,220],828:[,220],829:[,230],830:[,230],831:[,230],832:[[768],230],833:[[769],230],834:[,230],835:[[787],230],836:[[776,769],230],837:[,240],838:[,230],839:[,220],840:[,220],841:[,220],842:[,230],843:[,230],844:[,230],845:[,220],846:[,220],848:[,230],849:[,230],850:[,230],851:[,220],852:[,220],853:[,220],854:[,220],855:[,230],856:[,232],857:[,220],858:[,220],859:[,230],860:[,233],861:[,234],862:[,234],863:[,233],864:[,234],865:[,234],866:[,233],867:[,230],868:[,230],869:[,230],870:[,230],871:[,230],872:[,230],873:[,230],874:[,230],875:[,230],876:[,230],877:[,230],878:[,230],879:[,230],884:[[697]],890:[[32,837],256],894:[[59]],900:[[32,769],256],901:[[168,769]],902:[[913,769]],903:[[183]],904:[[917,769]],905:[[919,769]],906:[[921,769]],908:[[927,769]],910:[[933,769]],911:[[937,769]],912:[[970,769]],913:[,,{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124}],917:[,,{768:8136,769:904,787:7960,788:7961}],919:[,,{768:8138,769:905,787:7976,788:7977,837:8140}],921:[,,{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993}],927:[,,{768:8184,769:908,787:8008,788:8009}],929:[,,{788:8172}],933:[,,{768:8170,769:910,772:8169,774:8168,776:939,788:8025}],937:[,,{768:8186,769:911,787:8040,788:8041,837:8188}],938:[[921,776]],939:[[933,776]],940:[[945,769],,{837:8116}],941:[[949,769]],942:[[951,769],,{837:8132}],943:[[953,769]],944:[[971,769]],945:[,,{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115}],949:[,,{768:8050,769:941,787:7952,788:7953}],951:[,,{768:8052,769:942,787:7968,788:7969,834:8134,837:8131}],953:[,,{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150}],959:[,,{768:8056,769:972,787:8e3,788:8001}],961:[,,{787:8164,788:8165}],965:[,,{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166}],969:[,,{768:8060,769:974,787:8032,788:8033,834:8182,837:8179}],970:[[953,776],,{768:8146,769:912,834:8151}],971:[[965,776],,{768:8162,769:944,834:8167}],972:[[959,769]],973:[[965,769]],974:[[969,769],,{837:8180}],976:[[946],256],977:[[952],256],978:[[933],256,{769:979,776:980}],979:[[978,769]],980:[[978,776]],981:[[966],256],982:[[960],256],1008:[[954],256],1009:[[961],256],1010:[[962],256],1012:[[920],256],1013:[[949],256],1017:[[931],256],66422:[,230],66423:[,230],66424:[,230],66425:[,230],66426:[,230]},1024:{1024:[[1045,768]],1025:[[1045,776]],1027:[[1043,769]],1030:[,,{776:1031}],1031:[[1030,776]],1036:[[1050,769]],1037:[[1048,768]],1038:[[1059,774]],1040:[,,{774:1232,776:1234}],1043:[,,{769:1027}],1045:[,,{768:1024,774:1238,776:1025}],1046:[,,{774:1217,776:1244}],1047:[,,{776:1246}],1048:[,,{768:1037,772:1250,774:1049,776:1252}],1049:[[1048,774]],1050:[,,{769:1036}],1054:[,,{776:1254}],1059:[,,{772:1262,774:1038,776:1264,779:1266}],1063:[,,{776:1268}],1067:[,,{776:1272}],1069:[,,{776:1260}],1072:[,,{774:1233,776:1235}],1075:[,,{769:1107}],1077:[,,{768:1104,774:1239,776:1105}],1078:[,,{774:1218,776:1245}],1079:[,,{776:1247}],1080:[,,{768:1117,772:1251,774:1081,776:1253}],1081:[[1080,774]],1082:[,,{769:1116}],1086:[,,{776:1255}],1091:[,,{772:1263,774:1118,776:1265,779:1267}],1095:[,,{776:1269}],1099:[,,{776:1273}],1101:[,,{776:1261}],1104:[[1077,768]],1105:[[1077,776]],1107:[[1075,769]],1110:[,,{776:1111}],1111:[[1110,776]],1116:[[1082,769]],1117:[[1080,768]],1118:[[1091,774]],1140:[,,{783:1142}],1141:[,,{783:1143}],1142:[[1140,783]],1143:[[1141,783]],1155:[,230],1156:[,230],1157:[,230],1158:[,230],1159:[,230],1217:[[1046,774]],1218:[[1078,774]],1232:[[1040,774]],1233:[[1072,774]],1234:[[1040,776]],1235:[[1072,776]],1238:[[1045,774]],1239:[[1077,774]],1240:[,,{776:1242}],1241:[,,{776:1243}],1242:[[1240,776]],1243:[[1241,776]],1244:[[1046,776]],1245:[[1078,776]],1246:[[1047,776]],1247:[[1079,776]],1250:[[1048,772]],1251:[[1080,772]],1252:[[1048,776]],1253:[[1080,776]],1254:[[1054,776]],1255:[[1086,776]],1256:[,,{776:1258}],1257:[,,{776:1259}],1258:[[1256,776]],1259:[[1257,776]],1260:[[1069,776]],1261:[[1101,776]],1262:[[1059,772]],1263:[[1091,772]],1264:[[1059,776]],1265:[[1091,776]],1266:[[1059,779]],1267:[[1091,779]],1268:[[1063,776]],1269:[[1095,776]],1272:[[1067,776]],1273:[[1099,776]]},1280:{1415:[[1381,1410],256],1425:[,220],1426:[,230],1427:[,230],1428:[,230],1429:[,230],1430:[,220],1431:[,230],1432:[,230],1433:[,230],1434:[,222],1435:[,220],1436:[,230],1437:[,230],1438:[,230],1439:[,230],1440:[,230],1441:[,230],1442:[,220],1443:[,220],1444:[,220],1445:[,220],1446:[,220],1447:[,220],1448:[,230],1449:[,230],1450:[,220],1451:[,230],1452:[,230],1453:[,222],1454:[,228],1455:[,230],1456:[,10],1457:[,11],1458:[,12],1459:[,13],1460:[,14],1461:[,15],1462:[,16],1463:[,17],1464:[,18],1465:[,19],1466:[,19],1467:[,20],1468:[,21],1469:[,22],1471:[,23],1473:[,24],1474:[,25],1476:[,230],1477:[,220],1479:[,18]},1536:{1552:[,230],1553:[,230],1554:[,230],1555:[,230],1556:[,230],1557:[,230],1558:[,230],1559:[,230],1560:[,30],1561:[,31],1562:[,32],1570:[[1575,1619]],1571:[[1575,1620]],1572:[[1608,1620]],1573:[[1575,1621]],1574:[[1610,1620]],1575:[,,{1619:1570,1620:1571,1621:1573}],1608:[,,{1620:1572}],1610:[,,{1620:1574}],1611:[,27],1612:[,28],1613:[,29],1614:[,30],1615:[,31],1616:[,32],1617:[,33],1618:[,34],1619:[,230],1620:[,230],1621:[,220],1622:[,220],1623:[,230],1624:[,230],1625:[,230],1626:[,230],1627:[,230],1628:[,220],1629:[,230],1630:[,230],1631:[,220],1648:[,35],1653:[[1575,1652],256],1654:[[1608,1652],256],1655:[[1735,1652],256],1656:[[1610,1652],256],1728:[[1749,1620]],1729:[,,{1620:1730}],1730:[[1729,1620]],1746:[,,{1620:1747}],1747:[[1746,1620]],1749:[,,{1620:1728}],1750:[,230],1751:[,230],1752:[,230],1753:[,230],1754:[,230],1755:[,230],1756:[,230],1759:[,230],1760:[,230],1761:[,230],1762:[,230],1763:[,220],1764:[,230],1767:[,230],1768:[,230],1770:[,220],1771:[,230],1772:[,230],1773:[,220]},1792:{1809:[,36],1840:[,230],1841:[,220],1842:[,230],1843:[,230],1844:[,220],1845:[,230],1846:[,230],1847:[,220],1848:[,220],1849:[,220],1850:[,230],1851:[,220],1852:[,220],1853:[,230],1854:[,220],1855:[,230],1856:[,230],1857:[,230],1858:[,220],1859:[,230],1860:[,220],1861:[,230],1862:[,220],1863:[,230],1864:[,220],1865:[,230],1866:[,230],2027:[,230],2028:[,230],2029:[,230],2030:[,230],2031:[,230],2032:[,230],2033:[,230],2034:[,220],2035:[,230]},2048:{2070:[,230],2071:[,230],2072:[,230],2073:[,230],2075:[,230],2076:[,230],2077:[,230],2078:[,230],2079:[,230],2080:[,230],2081:[,230],2082:[,230],2083:[,230],2085:[,230],2086:[,230],2087:[,230],2089:[,230],2090:[,230],2091:[,230],2092:[,230],2093:[,230],2137:[,220],2138:[,220],2139:[,220],2276:[,230],2277:[,230],2278:[,220],2279:[,230],2280:[,230],2281:[,220],2282:[,230],2283:[,230],2284:[,230],2285:[,220],2286:[,220],2287:[,220],2288:[,27],2289:[,28],2290:[,29],2291:[,230],2292:[,230],2293:[,230],2294:[,220],2295:[,230],2296:[,230],2297:[,220],2298:[,220],2299:[,230],2300:[,230],2301:[,230],2302:[,230],2303:[,230]},2304:{2344:[,,{2364:2345}],2345:[[2344,2364]],2352:[,,{2364:2353}],2353:[[2352,2364]],2355:[,,{2364:2356}],2356:[[2355,2364]],2364:[,7],2381:[,9],2385:[,230],2386:[,220],2387:[,230],2388:[,230],2392:[[2325,2364],512],2393:[[2326,2364],512],2394:[[2327,2364],512],2395:[[2332,2364],512],2396:[[2337,2364],512],2397:[[2338,2364],512],2398:[[2347,2364],512],2399:[[2351,2364],512],2492:[,7],2503:[,,{2494:2507,2519:2508}],2507:[[2503,2494]],2508:[[2503,2519]],2509:[,9],2524:[[2465,2492],512],2525:[[2466,2492],512],2527:[[2479,2492],512]},2560:{2611:[[2610,2620],512],2614:[[2616,2620],512],2620:[,7],2637:[,9],2649:[[2582,2620],512],2650:[[2583,2620],512],2651:[[2588,2620],512],2654:[[2603,2620],512],2748:[,7],2765:[,9],68109:[,220],68111:[,230],68152:[,230],68153:[,1],68154:[,220],68159:[,9],68325:[,230],68326:[,220]},2816:{2876:[,7],2887:[,,{2878:2891,2902:2888,2903:2892}],2888:[[2887,2902]],2891:[[2887,2878]],2892:[[2887,2903]],2893:[,9],2908:[[2849,2876],512],2909:[[2850,2876],512],2962:[,,{3031:2964}],2964:[[2962,3031]],3014:[,,{3006:3018,3031:3020}],3015:[,,{3006:3019}],3018:[[3014,3006]],3019:[[3015,3006]],3020:[[3014,3031]],3021:[,9]},3072:{3142:[,,{3158:3144}],3144:[[3142,3158]],3149:[,9],3157:[,84],3158:[,91],3260:[,7],3263:[,,{3285:3264}],3264:[[3263,3285]],3270:[,,{3266:3274,3285:3271,3286:3272}],3271:[[3270,3285]],3272:[[3270,3286]],3274:[[3270,3266],,{3285:3275}],3275:[[3274,3285]],3277:[,9]},3328:{3398:[,,{3390:3402,3415:3404}],3399:[,,{3390:3403}],3402:[[3398,3390]],3403:[[3399,3390]],3404:[[3398,3415]],3405:[,9],3530:[,9],3545:[,,{3530:3546,3535:3548,3551:3550}],3546:[[3545,3530]],3548:[[3545,3535],,{3530:3549}],3549:[[3548,3530]],3550:[[3545,3551]]},3584:{3635:[[3661,3634],256],3640:[,103],3641:[,103],3642:[,9],3656:[,107],3657:[,107],3658:[,107],3659:[,107],3763:[[3789,3762],256],3768:[,118],3769:[,118],3784:[,122],3785:[,122],3786:[,122],3787:[,122],3804:[[3755,3737],256],3805:[[3755,3745],256]},3840:{3852:[[3851],256],3864:[,220],3865:[,220],3893:[,220],3895:[,220],3897:[,216],3907:[[3906,4023],512],3917:[[3916,4023],512],3922:[[3921,4023],512],3927:[[3926,4023],512],3932:[[3931,4023],512],3945:[[3904,4021],512],3953:[,129],3954:[,130],3955:[[3953,3954],512],3956:[,132],3957:[[3953,3956],512],3958:[[4018,3968],512],3959:[[4018,3969],256],3960:[[4019,3968],512],3961:[[4019,3969],256],3962:[,130],3963:[,130],3964:[,130],3965:[,130],3968:[,130],3969:[[3953,3968],512],3970:[,230],3971:[,230],3972:[,9],3974:[,230],3975:[,230],3987:[[3986,4023],512],3997:[[3996,4023],512],4002:[[4001,4023],512],4007:[[4006,4023],512],4012:[[4011,4023],512],4025:[[3984,4021],512],4038:[,220]},4096:{4133:[,,{4142:4134}],4134:[[4133,4142]],4151:[,7],4153:[,9],4154:[,9],4237:[,220],4348:[[4316],256],69702:[,9],69759:[,9],69785:[,,{69818:69786}],69786:[[69785,69818]],69787:[,,{69818:69788}],69788:[[69787,69818]],69797:[,,{69818:69803}],69803:[[69797,69818]],69817:[,9],69818:[,7]},4352:{69888:[,230],69889:[,230],69890:[,230],69934:[[69937,69927]],69935:[[69938,69927]],69937:[,,{69927:69934}],69938:[,,{69927:69935}],69939:[,9],69940:[,9],70003:[,7],70080:[,9]},4608:{70197:[,9],70198:[,7],70377:[,7],70378:[,9]},4864:{4957:[,230],4958:[,230],4959:[,230],70460:[,7],70471:[,,{70462:70475,70487:70476}],70475:[[70471,70462]],70476:[[70471,70487]],70477:[,9],70502:[,230],70503:[,230],70504:[,230],70505:[,230],70506:[,230],70507:[,230],70508:[,230],70512:[,230],70513:[,230],70514:[,230],70515:[,230],70516:[,230]},5120:{70841:[,,{70832:70844,70842:70843,70845:70846}],70843:[[70841,70842]],70844:[[70841,70832]],70846:[[70841,70845]],70850:[,9],70851:[,7]},5376:{71096:[,,{71087:71098}],71097:[,,{71087:71099}],71098:[[71096,71087]],71099:[[71097,71087]],71103:[,9],71104:[,7]},5632:{71231:[,9],71350:[,9],71351:[,7]},5888:{5908:[,9],5940:[,9],6098:[,9],6109:[,230]},6144:{6313:[,228]},6400:{6457:[,222],6458:[,230],6459:[,220]},6656:{6679:[,230],6680:[,220],6752:[,9],6773:[,230],6774:[,230],6775:[,230],6776:[,230],6777:[,230],6778:[,230],6779:[,230],6780:[,230],6783:[,220],6832:[,230],6833:[,230],6834:[,230],6835:[,230],6836:[,230],6837:[,220],6838:[,220],6839:[,220],6840:[,220],6841:[,220],6842:[,220],6843:[,230],6844:[,230],6845:[,220]},6912:{6917:[,,{6965:6918}],6918:[[6917,6965]],6919:[,,{6965:6920}],6920:[[6919,6965]],6921:[,,{6965:6922}],6922:[[6921,6965]],6923:[,,{6965:6924}],6924:[[6923,6965]],6925:[,,{6965:6926}],6926:[[6925,6965]],6929:[,,{6965:6930}],6930:[[6929,6965]],6964:[,7],6970:[,,{6965:6971}],6971:[[6970,6965]],6972:[,,{6965:6973}],6973:[[6972,6965]],6974:[,,{6965:6976}],6975:[,,{6965:6977}],6976:[[6974,6965]],6977:[[6975,6965]],6978:[,,{6965:6979}],6979:[[6978,6965]],6980:[,9],7019:[,230],7020:[,220],7021:[,230],7022:[,230],7023:[,230],7024:[,230],7025:[,230],7026:[,230],7027:[,230],7082:[,9],7083:[,9],7142:[,7],7154:[,9],7155:[,9]},7168:{7223:[,7],7376:[,230],7377:[,230],7378:[,230],7380:[,1],7381:[,220],7382:[,220],7383:[,220],7384:[,220],7385:[,220],7386:[,230],7387:[,230],7388:[,220],7389:[,220],7390:[,220],7391:[,220],7392:[,230],7394:[,1],7395:[,1],7396:[,1],7397:[,1],7398:[,1],7399:[,1],7400:[,1],7405:[,220],7412:[,230],7416:[,230],7417:[,230]},7424:{7468:[[65],256],7469:[[198],256],7470:[[66],256],7472:[[68],256],7473:[[69],256],7474:[[398],256],7475:[[71],256],7476:[[72],256],7477:[[73],256],7478:[[74],256],7479:[[75],256],7480:[[76],256],7481:[[77],256],7482:[[78],256],7484:[[79],256],7485:[[546],256],7486:[[80],256],7487:[[82],256],7488:[[84],256],7489:[[85],256],7490:[[87],256],7491:[[97],256],7492:[[592],256],7493:[[593],256],7494:[[7426],256],7495:[[98],256],7496:[[100],256],7497:[[101],256],7498:[[601],256],7499:[[603],256],7500:[[604],256],7501:[[103],256],7503:[[107],256],7504:[[109],256],7505:[[331],256],7506:[[111],256],7507:[[596],256],7508:[[7446],256],7509:[[7447],256],7510:[[112],256],7511:[[116],256],7512:[[117],256],7513:[[7453],256],7514:[[623],256],7515:[[118],256],7516:[[7461],256],7517:[[946],256],7518:[[947],256],7519:[[948],256],7520:[[966],256],7521:[[967],256],7522:[[105],256],7523:[[114],256],7524:[[117],256],7525:[[118],256],7526:[[946],256],7527:[[947],256],7528:[[961],256],7529:[[966],256],7530:[[967],256],7544:[[1085],256],7579:[[594],256],7580:[[99],256],7581:[[597],256],7582:[[240],256],7583:[[604],256],7584:[[102],256],7585:[[607],256],7586:[[609],256],7587:[[613],256],7588:[[616],256],7589:[[617],256],7590:[[618],256],7591:[[7547],256],7592:[[669],256],7593:[[621],256],7594:[[7557],256],7595:[[671],256],7596:[[625],256],7597:[[624],256],7598:[[626],256],7599:[[627],256],7600:[[628],256],7601:[[629],256],7602:[[632],256],7603:[[642],256],7604:[[643],256],7605:[[427],256],7606:[[649],256],7607:[[650],256],7608:[[7452],256],7609:[[651],256],7610:[[652],256],7611:[[122],256],7612:[[656],256],7613:[[657],256],7614:[[658],256],7615:[[952],256],7616:[,230],7617:[,230],7618:[,220],7619:[,230],7620:[,230],7621:[,230],7622:[,230],7623:[,230],7624:[,230],7625:[,230],7626:[,220],7627:[,230],7628:[,230],7629:[,234],7630:[,214],7631:[,220],7632:[,202],7633:[,230],7634:[,230],7635:[,230],7636:[,230],7637:[,230],7638:[,230],7639:[,230],7640:[,230],7641:[,230],7642:[,230],7643:[,230],7644:[,230],7645:[,230],7646:[,230],7647:[,230],7648:[,230],7649:[,230],7650:[,230],7651:[,230],7652:[,230],7653:[,230],7654:[,230],7655:[,230],7656:[,230],7657:[,230],7658:[,230],7659:[,230],7660:[,230],7661:[,230],7662:[,230],7663:[,230],7664:[,230],7665:[,230],7666:[,230],7667:[,230],7668:[,230],7669:[,230],7676:[,233],7677:[,220],7678:[,230],7679:[,220]},7680:{7680:[[65,805]],7681:[[97,805]],7682:[[66,775]],7683:[[98,775]],7684:[[66,803]],7685:[[98,803]],7686:[[66,817]],7687:[[98,817]],7688:[[199,769]],7689:[[231,769]],7690:[[68,775]],7691:[[100,775]],7692:[[68,803]],7693:[[100,803]],7694:[[68,817]],7695:[[100,817]],7696:[[68,807]],7697:[[100,807]],7698:[[68,813]],7699:[[100,813]],7700:[[274,768]],7701:[[275,768]],7702:[[274,769]],7703:[[275,769]],7704:[[69,813]],7705:[[101,813]],7706:[[69,816]],7707:[[101,816]],7708:[[552,774]],7709:[[553,774]],7710:[[70,775]],7711:[[102,775]],7712:[[71,772]],7713:[[103,772]],7714:[[72,775]],7715:[[104,775]],7716:[[72,803]],7717:[[104,803]],7718:[[72,776]],7719:[[104,776]],7720:[[72,807]],7721:[[104,807]],7722:[[72,814]],7723:[[104,814]],7724:[[73,816]],7725:[[105,816]],7726:[[207,769]],7727:[[239,769]],7728:[[75,769]],7729:[[107,769]],7730:[[75,803]],7731:[[107,803]],7732:[[75,817]],7733:[[107,817]],7734:[[76,803],,{772:7736}],7735:[[108,803],,{772:7737}],7736:[[7734,772]],7737:[[7735,772]],7738:[[76,817]],7739:[[108,817]],7740:[[76,813]],7741:[[108,813]],7742:[[77,769]],7743:[[109,769]],7744:[[77,775]],7745:[[109,775]],7746:[[77,803]],7747:[[109,803]],7748:[[78,775]],7749:[[110,775]],7750:[[78,803]],7751:[[110,803]],7752:[[78,817]],7753:[[110,817]],7754:[[78,813]],7755:[[110,813]],7756:[[213,769]],7757:[[245,769]],7758:[[213,776]],7759:[[245,776]],7760:[[332,768]],7761:[[333,768]],7762:[[332,769]],7763:[[333,769]],7764:[[80,769]],7765:[[112,769]],7766:[[80,775]],7767:[[112,775]],7768:[[82,775]],7769:[[114,775]],7770:[[82,803],,{772:7772}],7771:[[114,803],,{772:7773}],7772:[[7770,772]],7773:[[7771,772]],7774:[[82,817]],7775:[[114,817]],7776:[[83,775]],7777:[[115,775]],7778:[[83,803],,{775:7784}],7779:[[115,803],,{775:7785}],7780:[[346,775]],7781:[[347,775]],7782:[[352,775]],7783:[[353,775]],7784:[[7778,775]],7785:[[7779,775]],7786:[[84,775]],7787:[[116,775]],7788:[[84,803]],7789:[[116,803]],7790:[[84,817]],7791:[[116,817]],7792:[[84,813]],7793:[[116,813]],7794:[[85,804]],7795:[[117,804]],7796:[[85,816]],7797:[[117,816]],7798:[[85,813]],7799:[[117,813]],7800:[[360,769]],7801:[[361,769]],7802:[[362,776]],7803:[[363,776]],7804:[[86,771]],7805:[[118,771]],7806:[[86,803]],7807:[[118,803]],7808:[[87,768]],7809:[[119,768]],7810:[[87,769]],7811:[[119,769]],7812:[[87,776]],7813:[[119,776]],7814:[[87,775]],7815:[[119,775]],7816:[[87,803]],7817:[[119,803]],7818:[[88,775]],7819:[[120,775]],7820:[[88,776]],7821:[[120,776]],7822:[[89,775]],7823:[[121,775]],7824:[[90,770]],7825:[[122,770]],7826:[[90,803]],7827:[[122,803]],7828:[[90,817]],7829:[[122,817]],7830:[[104,817]],7831:[[116,776]],7832:[[119,778]],7833:[[121,778]],7834:[[97,702],256],7835:[[383,775]],7840:[[65,803],,{770:7852,774:7862}],7841:[[97,803],,{770:7853,774:7863}],7842:[[65,777]],7843:[[97,777]],7844:[[194,769]],7845:[[226,769]],7846:[[194,768]],7847:[[226,768]],7848:[[194,777]],7849:[[226,777]],7850:[[194,771]],7851:[[226,771]],7852:[[7840,770]],7853:[[7841,770]],7854:[[258,769]],7855:[[259,769]],7856:[[258,768]],7857:[[259,768]],7858:[[258,777]],7859:[[259,777]],7860:[[258,771]],7861:[[259,771]],7862:[[7840,774]],7863:[[7841,774]],7864:[[69,803],,{770:7878}],7865:[[101,803],,{770:7879}],7866:[[69,777]],7867:[[101,777]],7868:[[69,771]],7869:[[101,771]],7870:[[202,769]],7871:[[234,769]],7872:[[202,768]],7873:[[234,768]],7874:[[202,777]],7875:[[234,777]],7876:[[202,771]],7877:[[234,771]],7878:[[7864,770]],7879:[[7865,770]],7880:[[73,777]],7881:[[105,777]],7882:[[73,803]],7883:[[105,803]],7884:[[79,803],,{770:7896}],7885:[[111,803],,{770:7897}],7886:[[79,777]],7887:[[111,777]],7888:[[212,769]],7889:[[244,769]],7890:[[212,768]],7891:[[244,768]],7892:[[212,777]],7893:[[244,777]],7894:[[212,771]],7895:[[244,771]],7896:[[7884,770]],7897:[[7885,770]],7898:[[416,769]],7899:[[417,769]],7900:[[416,768]],7901:[[417,768]],7902:[[416,777]],7903:[[417,777]],7904:[[416,771]],7905:[[417,771]],7906:[[416,803]],7907:[[417,803]],7908:[[85,803]],7909:[[117,803]],7910:[[85,777]],7911:[[117,777]],7912:[[431,769]],7913:[[432,769]],7914:[[431,768]],7915:[[432,768]],7916:[[431,777]],7917:[[432,777]],7918:[[431,771]],7919:[[432,771]],7920:[[431,803]],7921:[[432,803]],7922:[[89,768]],7923:[[121,768]],7924:[[89,803]],7925:[[121,803]],7926:[[89,777]],7927:[[121,777]],7928:[[89,771]],7929:[[121,771]]},7936:{7936:[[945,787],,{768:7938,769:7940,834:7942,837:8064}],7937:[[945,788],,{768:7939,769:7941,834:7943,837:8065}],7938:[[7936,768],,{837:8066}],7939:[[7937,768],,{837:8067}],7940:[[7936,769],,{837:8068}],7941:[[7937,769],,{837:8069}],7942:[[7936,834],,{837:8070}],7943:[[7937,834],,{837:8071}],7944:[[913,787],,{768:7946,769:7948,834:7950,837:8072}],7945:[[913,788],,{768:7947,769:7949,834:7951,837:8073}],7946:[[7944,768],,{837:8074}],7947:[[7945,768],,{837:8075}],7948:[[7944,769],,{837:8076}],7949:[[7945,769],,{837:8077}],7950:[[7944,834],,{837:8078}],7951:[[7945,834],,{837:8079}],7952:[[949,787],,{768:7954,769:7956}],7953:[[949,788],,{768:7955,769:7957}],7954:[[7952,768]],7955:[[7953,768]],7956:[[7952,769]],7957:[[7953,769]],7960:[[917,787],,{768:7962,769:7964}],7961:[[917,788],,{768:7963,769:7965}],7962:[[7960,768]],7963:[[7961,768]],7964:[[7960,769]],7965:[[7961,769]],7968:[[951,787],,{768:7970,769:7972,834:7974,837:8080}],7969:[[951,788],,{768:7971,769:7973,834:7975,837:8081}],7970:[[7968,768],,{837:8082}],7971:[[7969,768],,{837:8083}],7972:[[7968,769],,{837:8084}],7973:[[7969,769],,{837:8085}],7974:[[7968,834],,{837:8086}],7975:[[7969,834],,{837:8087}],7976:[[919,787],,{768:7978,769:7980,834:7982,837:8088}],7977:[[919,788],,{768:7979,769:7981,834:7983,837:8089}],7978:[[7976,768],,{837:8090}],7979:[[7977,768],,{837:8091}],7980:[[7976,769],,{837:8092}],7981:[[7977,769],,{837:8093}],7982:[[7976,834],,{837:8094}],7983:[[7977,834],,{837:8095}],7984:[[953,787],,{768:7986,769:7988,834:7990}],7985:[[953,788],,{768:7987,769:7989,834:7991}],7986:[[7984,768]],7987:[[7985,768]],7988:[[7984,769]],7989:[[7985,769]],7990:[[7984,834]],7991:[[7985,834]],7992:[[921,787],,{768:7994,769:7996,834:7998}],7993:[[921,788],,{768:7995,769:7997,834:7999}],7994:[[7992,768]],7995:[[7993,768]],7996:[[7992,769]],7997:[[7993,769]],7998:[[7992,834]],7999:[[7993,834]],8e3:[[959,787],,{768:8002,769:8004}],8001:[[959,788],,{768:8003,769:8005}],8002:[[8e3,768]],8003:[[8001,768]],8004:[[8e3,769]],8005:[[8001,769]],8008:[[927,787],,{768:8010,769:8012}],8009:[[927,788],,{768:8011,769:8013}],8010:[[8008,768]],8011:[[8009,768]],8012:[[8008,769]],8013:[[8009,769]],8016:[[965,787],,{768:8018,769:8020,834:8022}],8017:[[965,788],,{768:8019,769:8021,834:8023}],8018:[[8016,768]],8019:[[8017,768]],8020:[[8016,769]],8021:[[8017,769]],8022:[[8016,834]],8023:[[8017,834]],8025:[[933,788],,{768:8027,769:8029,834:8031}],8027:[[8025,768]],8029:[[8025,769]],8031:[[8025,834]],8032:[[969,787],,{768:8034,769:8036,834:8038,837:8096}],8033:[[969,788],,{768:8035,769:8037,834:8039,837:8097}],8034:[[8032,768],,{837:8098}],8035:[[8033,768],,{837:8099}],8036:[[8032,769],,{837:8100}],8037:[[8033,769],,{837:8101}],8038:[[8032,834],,{837:8102}],8039:[[8033,834],,{837:8103}],8040:[[937,787],,{768:8042,769:8044,834:8046,837:8104}],8041:[[937,788],,{768:8043,769:8045,834:8047,837:8105}],8042:[[8040,768],,{837:8106}],8043:[[8041,768],,{837:8107}],8044:[[8040,769],,{837:8108}],8045:[[8041,769],,{837:8109}],8046:[[8040,834],,{837:8110}],8047:[[8041,834],,{837:8111}],8048:[[945,768],,{837:8114}],8049:[[940]],8050:[[949,768]],8051:[[941]],8052:[[951,768],,{837:8130}],8053:[[942]],8054:[[953,768]],8055:[[943]],8056:[[959,768]],8057:[[972]],8058:[[965,768]],8059:[[973]],8060:[[969,768],,{837:8178}],8061:[[974]],8064:[[7936,837]],8065:[[7937,837]],8066:[[7938,837]],8067:[[7939,837]],8068:[[7940,837]],8069:[[7941,837]],8070:[[7942,837]],8071:[[7943,837]],8072:[[7944,837]],8073:[[7945,837]],8074:[[7946,837]],8075:[[7947,837]],8076:[[7948,837]],8077:[[7949,837]],8078:[[7950,837]],8079:[[7951,837]],8080:[[7968,837]],8081:[[7969,837]],8082:[[7970,837]],8083:[[7971,837]],8084:[[7972,837]],8085:[[7973,837]],8086:[[7974,837]],8087:[[7975,837]],8088:[[7976,837]],8089:[[7977,837]],8090:[[7978,837]],8091:[[7979,837]],8092:[[7980,837]],8093:[[7981,837]],8094:[[7982,837]],8095:[[7983,837]],8096:[[8032,837]],8097:[[8033,837]],8098:[[8034,837]],8099:[[8035,837]],8100:[[8036,837]],8101:[[8037,837]],8102:[[8038,837]],8103:[[8039,837]],8104:[[8040,837]],8105:[[8041,837]],8106:[[8042,837]],8107:[[8043,837]],8108:[[8044,837]],8109:[[8045,837]],8110:[[8046,837]],8111:[[8047,837]],8112:[[945,774]],8113:[[945,772]],8114:[[8048,837]],8115:[[945,837]],8116:[[940,837]],8118:[[945,834],,{837:8119}],8119:[[8118,837]],8120:[[913,774]],8121:[[913,772]],8122:[[913,768]],8123:[[902]],8124:[[913,837]],8125:[[32,787],256],8126:[[953]],8127:[[32,787],256,{768:8141,769:8142,834:8143}],8128:[[32,834],256],8129:[[168,834]],8130:[[8052,837]],8131:[[951,837]],8132:[[942,837]],8134:[[951,834],,{837:8135}],8135:[[8134,837]],8136:[[917,768]],8137:[[904]],8138:[[919,768]],8139:[[905]],8140:[[919,837]],8141:[[8127,768]],8142:[[8127,769]],8143:[[8127,834]],8144:[[953,774]],8145:[[953,772]],8146:[[970,768]],8147:[[912]],8150:[[953,834]],8151:[[970,834]],8152:[[921,774]],8153:[[921,772]],8154:[[921,768]],8155:[[906]],8157:[[8190,768]],8158:[[8190,769]],8159:[[8190,834]],8160:[[965,774]],8161:[[965,772]],8162:[[971,768]],8163:[[944]],8164:[[961,787]],8165:[[961,788]],8166:[[965,834]],8167:[[971,834]],8168:[[933,774]],8169:[[933,772]],8170:[[933,768]],8171:[[910]],8172:[[929,788]],8173:[[168,768]],8174:[[901]],8175:[[96]],8178:[[8060,837]],8179:[[969,837]],8180:[[974,837]],8182:[[969,834],,{837:8183}],8183:[[8182,837]],8184:[[927,768]],8185:[[908]],8186:[[937,768]],8187:[[911]],8188:[[937,837]],8189:[[180]],8190:[[32,788],256,{768:8157,769:8158,834:8159}]},8192:{8192:[[8194]],8193:[[8195]],8194:[[32],256],8195:[[32],256],8196:[[32],256],8197:[[32],256],8198:[[32],256],8199:[[32],256],8200:[[32],256],8201:[[32],256],8202:[[32],256],8209:[[8208],256],8215:[[32,819],256],8228:[[46],256],8229:[[46,46],256],8230:[[46,46,46],256],8239:[[32],256],8243:[[8242,8242],256],8244:[[8242,8242,8242],256],8246:[[8245,8245],256],8247:[[8245,8245,8245],256],8252:[[33,33],256],8254:[[32,773],256],8263:[[63,63],256],8264:[[63,33],256],8265:[[33,63],256],8279:[[8242,8242,8242,8242],256],8287:[[32],256],8304:[[48],256],8305:[[105],256],8308:[[52],256],8309:[[53],256],8310:[[54],256],8311:[[55],256],8312:[[56],256],8313:[[57],256],8314:[[43],256],8315:[[8722],256],8316:[[61],256],8317:[[40],256],8318:[[41],256],8319:[[110],256],8320:[[48],256],8321:[[49],256],8322:[[50],256],8323:[[51],256],8324:[[52],256],8325:[[53],256],8326:[[54],256],8327:[[55],256],8328:[[56],256],8329:[[57],256],8330:[[43],256],8331:[[8722],256],8332:[[61],256],8333:[[40],256],8334:[[41],256],8336:[[97],256],8337:[[101],256],8338:[[111],256],8339:[[120],256],8340:[[601],256],8341:[[104],256],8342:[[107],256],8343:[[108],256],8344:[[109],256],8345:[[110],256],8346:[[112],256],8347:[[115],256],8348:[[116],256],8360:[[82,115],256],8400:[,230],8401:[,230],8402:[,1],8403:[,1],8404:[,230],8405:[,230],8406:[,230],8407:[,230],8408:[,1],8409:[,1],8410:[,1],8411:[,230],8412:[,230],8417:[,230],8421:[,1],8422:[,1],8423:[,230],8424:[,220],8425:[,230],8426:[,1],8427:[,1],8428:[,220],8429:[,220],8430:[,220],8431:[,220],8432:[,230]},8448:{8448:[[97,47,99],256],8449:[[97,47,115],256],8450:[[67],256],8451:[[176,67],256],8453:[[99,47,111],256],8454:[[99,47,117],256],8455:[[400],256],8457:[[176,70],256],8458:[[103],256],8459:[[72],256],8460:[[72],256],8461:[[72],256],8462:[[104],256],8463:[[295],256],8464:[[73],256],8465:[[73],256],8466:[[76],256],8467:[[108],256],8469:[[78],256],8470:[[78,111],256],8473:[[80],256],8474:[[81],256],8475:[[82],256],8476:[[82],256],8477:[[82],256],8480:[[83,77],256],8481:[[84,69,76],256],8482:[[84,77],256],8484:[[90],256],8486:[[937]],8488:[[90],256],8490:[[75]],8491:[[197]],8492:[[66],256],8493:[[67],256],8495:[[101],256],8496:[[69],256],8497:[[70],256],8499:[[77],256],8500:[[111],256],8501:[[1488],256],8502:[[1489],256],8503:[[1490],256],8504:[[1491],256],8505:[[105],256],8507:[[70,65,88],256],8508:[[960],256],8509:[[947],256],8510:[[915],256],8511:[[928],256],8512:[[8721],256],8517:[[68],256],8518:[[100],256],8519:[[101],256],8520:[[105],256],8521:[[106],256],8528:[[49,8260,55],256],8529:[[49,8260,57],256],8530:[[49,8260,49,48],256],8531:[[49,8260,51],256],8532:[[50,8260,51],256],8533:[[49,8260,53],256],8534:[[50,8260,53],256],8535:[[51,8260,53],256],8536:[[52,8260,53],256],8537:[[49,8260,54],256],8538:[[53,8260,54],256],8539:[[49,8260,56],256],8540:[[51,8260,56],256],8541:[[53,8260,56],256],8542:[[55,8260,56],256],8543:[[49,8260],256],8544:[[73],256],8545:[[73,73],256],8546:[[73,73,73],256],8547:[[73,86],256],8548:[[86],256],8549:[[86,73],256],8550:[[86,73,73],256],8551:[[86,73,73,73],256],8552:[[73,88],256],8553:[[88],256],8554:[[88,73],256],8555:[[88,73,73],256],8556:[[76],256],8557:[[67],256],8558:[[68],256],8559:[[77],256],8560:[[105],256],8561:[[105,105],256],8562:[[105,105,105],256],8563:[[105,118],256],8564:[[118],256],8565:[[118,105],256],8566:[[118,105,105],256],8567:[[118,105,105,105],256],8568:[[105,120],256],8569:[[120],256],8570:[[120,105],256],8571:[[120,105,105],256],8572:[[108],256],8573:[[99],256],8574:[[100],256],8575:[[109],256],8585:[[48,8260,51],256],8592:[,,{824:8602}],8594:[,,{824:8603}],8596:[,,{824:8622}],8602:[[8592,824]],8603:[[8594,824]],8622:[[8596,824]],8653:[[8656,824]],8654:[[8660,824]],8655:[[8658,824]],8656:[,,{824:8653}],8658:[,,{824:8655}],8660:[,,{824:8654}]},8704:{8707:[,,{824:8708}],8708:[[8707,824]],8712:[,,{824:8713}],8713:[[8712,824]],8715:[,,{824:8716}],8716:[[8715,824]],8739:[,,{824:8740}],8740:[[8739,824]],8741:[,,{824:8742}],8742:[[8741,824]],8748:[[8747,8747],256],8749:[[8747,8747,8747],256],8751:[[8750,8750],256],8752:[[8750,8750,8750],256],8764:[,,{824:8769}],8769:[[8764,824]],8771:[,,{824:8772}],8772:[[8771,824]],8773:[,,{824:8775}],8775:[[8773,824]],8776:[,,{824:8777}],8777:[[8776,824]],8781:[,,{824:8813}],8800:[[61,824]],8801:[,,{824:8802}],8802:[[8801,824]],8804:[,,{824:8816}],8805:[,,{824:8817}],8813:[[8781,824]],8814:[[60,824]],8815:[[62,824]],8816:[[8804,824]],8817:[[8805,824]],8818:[,,{824:8820}],8819:[,,{824:8821}],8820:[[8818,824]],8821:[[8819,824]],8822:[,,{824:8824}],8823:[,,{824:8825}],8824:[[8822,824]],8825:[[8823,824]],8826:[,,{824:8832}],8827:[,,{824:8833}],8828:[,,{824:8928}],8829:[,,{824:8929}],8832:[[8826,824]],8833:[[8827,824]],8834:[,,{824:8836}],8835:[,,{824:8837}],8836:[[8834,824]],8837:[[8835,824]],8838:[,,{824:8840}],8839:[,,{824:8841}],8840:[[8838,824]],8841:[[8839,824]],8849:[,,{824:8930}],8850:[,,{824:8931}],8866:[,,{824:8876}],8872:[,,{824:8877}],8873:[,,{824:8878}],8875:[,,{824:8879}],8876:[[8866,824]],8877:[[8872,824]],8878:[[8873,824]],8879:[[8875,824]],8882:[,,{824:8938}],8883:[,,{824:8939}],8884:[,,{824:8940}],8885:[,,{824:8941}],8928:[[8828,824]],8929:[[8829,824]],8930:[[8849,824]],8931:[[8850,824]],8938:[[8882,824]],8939:[[8883,824]],8940:[[8884,824]],8941:[[8885,824]]},8960:{9001:[[12296]],9002:[[12297]]},9216:{9312:[[49],256],9313:[[50],256],9314:[[51],256],9315:[[52],256],9316:[[53],256],9317:[[54],256],9318:[[55],256],9319:[[56],256],9320:[[57],256],9321:[[49,48],256],9322:[[49,49],256],9323:[[49,50],256],9324:[[49,51],256],9325:[[49,52],256],9326:[[49,53],256],9327:[[49,54],256],9328:[[49,55],256],9329:[[49,56],256],9330:[[49,57],256],9331:[[50,48],256],9332:[[40,49,41],256],9333:[[40,50,41],256],9334:[[40,51,41],256],9335:[[40,52,41],256],9336:[[40,53,41],256],9337:[[40,54,41],256],9338:[[40,55,41],256],9339:[[40,56,41],256],9340:[[40,57,41],256],9341:[[40,49,48,41],256],9342:[[40,49,49,41],256],9343:[[40,49,50,41],256],9344:[[40,49,51,41],256],9345:[[40,49,52,41],256],9346:[[40,49,53,41],256],9347:[[40,49,54,41],256],9348:[[40,49,55,41],256],9349:[[40,49,56,41],256],9350:[[40,49,57,41],256],9351:[[40,50,48,41],256],9352:[[49,46],256],9353:[[50,46],256],9354:[[51,46],256],9355:[[52,46],256],9356:[[53,46],256],9357:[[54,46],256],9358:[[55,46],256],9359:[[56,46],256],9360:[[57,46],256],9361:[[49,48,46],256],9362:[[49,49,46],256],9363:[[49,50,46],256],9364:[[49,51,46],256],9365:[[49,52,46],256],9366:[[49,53,46],256],9367:[[49,54,46],256],9368:[[49,55,46],256],9369:[[49,56,46],256],9370:[[49,57,46],256],9371:[[50,48,46],256],9372:[[40,97,41],256],9373:[[40,98,41],256],9374:[[40,99,41],256],9375:[[40,100,41],256],9376:[[40,101,41],256],9377:[[40,102,41],256],9378:[[40,103,41],256],9379:[[40,104,41],256],9380:[[40,105,41],256],9381:[[40,106,41],256],9382:[[40,107,41],256],9383:[[40,108,41],256],9384:[[40,109,41],256],9385:[[40,110,41],256],9386:[[40,111,41],256],9387:[[40,112,41],256],9388:[[40,113,41],256],9389:[[40,114,41],256],9390:[[40,115,41],256],9391:[[40,116,41],256],9392:[[40,117,41],256],9393:[[40,118,41],256],9394:[[40,119,41],256],9395:[[40,120,41],256],9396:[[40,121,41],256],9397:[[40,122,41],256],9398:[[65],256],9399:[[66],256],9400:[[67],256],9401:[[68],256],9402:[[69],256],9403:[[70],256],9404:[[71],256],9405:[[72],256],9406:[[73],256],9407:[[74],256],9408:[[75],256],9409:[[76],256],9410:[[77],256],9411:[[78],256],9412:[[79],256],9413:[[80],256],9414:[[81],256],9415:[[82],256],9416:[[83],256],9417:[[84],256],9418:[[85],256],9419:[[86],256],9420:[[87],256],9421:[[88],256],9422:[[89],256],9423:[[90],256],9424:[[97],256],9425:[[98],256],9426:[[99],256],9427:[[100],256],9428:[[101],256],9429:[[102],256],9430:[[103],256],9431:[[104],256],9432:[[105],256],9433:[[106],256],9434:[[107],256],9435:[[108],256],9436:[[109],256],9437:[[110],256],9438:[[111],256],9439:[[112],256],9440:[[113],256],9441:[[114],256],9442:[[115],256],9443:[[116],256],9444:[[117],256],9445:[[118],256],9446:[[119],256],9447:[[120],256],9448:[[121],256],9449:[[122],256],9450:[[48],256]},10752:{10764:[[8747,8747,8747,8747],256],10868:[[58,58,61],256],10869:[[61,61],256],10870:[[61,61,61],256],10972:[[10973,824],512]},11264:{11388:[[106],256],11389:[[86],256],11503:[,230],11504:[,230],11505:[,230]},11520:{11631:[[11617],256],11647:[,9],11744:[,230],11745:[,230],11746:[,230],11747:[,230],11748:[,230],11749:[,230],11750:[,230],11751:[,230],11752:[,230],11753:[,230],11754:[,230],11755:[,230],11756:[,230],11757:[,230],11758:[,230],11759:[,230],11760:[,230],11761:[,230],11762:[,230],11763:[,230],11764:[,230],11765:[,230],11766:[,230],11767:[,230],11768:[,230],11769:[,230],11770:[,230],11771:[,230],11772:[,230],11773:[,230],11774:[,230],11775:[,230]},11776:{11935:[[27597],256],12019:[[40863],256]},12032:{12032:[[19968],256],12033:[[20008],256],12034:[[20022],256],12035:[[20031],256],12036:[[20057],256],12037:[[20101],256],12038:[[20108],256],12039:[[20128],256],12040:[[20154],256],12041:[[20799],256],12042:[[20837],256],12043:[[20843],256],12044:[[20866],256],12045:[[20886],256],12046:[[20907],256],12047:[[20960],256],12048:[[20981],256],12049:[[20992],256],12050:[[21147],256],12051:[[21241],256],12052:[[21269],256],12053:[[21274],256],12054:[[21304],256],12055:[[21313],256],12056:[[21340],256],12057:[[21353],256],12058:[[21378],256],12059:[[21430],256],12060:[[21448],256],12061:[[21475],256],12062:[[22231],256],12063:[[22303],256],12064:[[22763],256],12065:[[22786],256],12066:[[22794],256],12067:[[22805],256],12068:[[22823],256],12069:[[22899],256],12070:[[23376],256],12071:[[23424],256],12072:[[23544],256],12073:[[23567],256],12074:[[23586],256],12075:[[23608],256],12076:[[23662],256],12077:[[23665],256],12078:[[24027],256],12079:[[24037],256],12080:[[24049],256],12081:[[24062],256],12082:[[24178],256],12083:[[24186],256],12084:[[24191],256],12085:[[24308],256],12086:[[24318],256],12087:[[24331],256],12088:[[24339],256],12089:[[24400],256],12090:[[24417],256],12091:[[24435],256],12092:[[24515],256],12093:[[25096],256],12094:[[25142],256],12095:[[25163],256],12096:[[25903],256],12097:[[25908],256],12098:[[25991],256],12099:[[26007],256],12100:[[26020],256],12101:[[26041],256],12102:[[26080],256],12103:[[26085],256],12104:[[26352],256],12105:[[26376],256],12106:[[26408],256],12107:[[27424],256],12108:[[27490],256],12109:[[27513],256],12110:[[27571],256],12111:[[27595],256],12112:[[27604],256],12113:[[27611],256],12114:[[27663],256],12115:[[27668],256],12116:[[27700],256],12117:[[28779],256],12118:[[29226],256],12119:[[29238],256],12120:[[29243],256],12121:[[29247],256],12122:[[29255],256],12123:[[29273],256],12124:[[29275],256],12125:[[29356],256],12126:[[29572],256],12127:[[29577],256],12128:[[29916],256],12129:[[29926],256],12130:[[29976],256],12131:[[29983],256],12132:[[29992],256],12133:[[3e4],256],12134:[[30091],256],12135:[[30098],256],12136:[[30326],256],12137:[[30333],256],12138:[[30382],256],12139:[[30399],256],12140:[[30446],256],12141:[[30683],256],12142:[[30690],256],12143:[[30707],256],12144:[[31034],256],12145:[[31160],256],12146:[[31166],256],12147:[[31348],256],12148:[[31435],256],12149:[[31481],256],12150:[[31859],256],12151:[[31992],256],12152:[[32566],256],12153:[[32593],256],12154:[[32650],256],12155:[[32701],256],12156:[[32769],256],12157:[[32780],256],12158:[[32786],256],12159:[[32819],256],12160:[[32895],256],12161:[[32905],256],12162:[[33251],256],12163:[[33258],256],12164:[[33267],256],12165:[[33276],256],12166:[[33292],256],12167:[[33307],256],12168:[[33311],256],12169:[[33390],256],12170:[[33394],256],12171:[[33400],256],12172:[[34381],256],12173:[[34411],256],12174:[[34880],256],12175:[[34892],256],12176:[[34915],256],12177:[[35198],256],12178:[[35211],256],12179:[[35282],256],12180:[[35328],256],12181:[[35895],256],12182:[[35910],256],12183:[[35925],256],12184:[[35960],256],12185:[[35997],256],12186:[[36196],256],12187:[[36208],256],12188:[[36275],256],12189:[[36523],256],12190:[[36554],256],12191:[[36763],256],12192:[[36784],256],12193:[[36789],256],12194:[[37009],256],12195:[[37193],256],12196:[[37318],256],12197:[[37324],256],12198:[[37329],256],12199:[[38263],256],12200:[[38272],256],12201:[[38428],256],12202:[[38582],256],12203:[[38585],256],12204:[[38632],256],12205:[[38737],256],12206:[[38750],256],12207:[[38754],256],12208:[[38761],256],12209:[[38859],256],12210:[[38893],256],12211:[[38899],256],12212:[[38913],256],12213:[[39080],256],12214:[[39131],256],12215:[[39135],256],12216:[[39318],256],12217:[[39321],256],12218:[[39340],256],12219:[[39592],256],12220:[[39640],256],12221:[[39647],256],12222:[[39717],256],12223:[[39727],256],12224:[[39730],256],12225:[[39740],256],12226:[[39770],256],12227:[[40165],256],12228:[[40565],256],12229:[[40575],256],12230:[[40613],256],12231:[[40635],256],12232:[[40643],256],12233:[[40653],256],12234:[[40657],256],12235:[[40697],256],12236:[[40701],256],12237:[[40718],256],12238:[[40723],256],12239:[[40736],256],12240:[[40763],256],12241:[[40778],256],12242:[[40786],256],12243:[[40845],256],12244:[[40860],256],12245:[[40864],256]},12288:{12288:[[32],256],12330:[,218],12331:[,228],12332:[,232],12333:[,222],12334:[,224],12335:[,224],12342:[[12306],256],12344:[[21313],256],12345:[[21316],256],12346:[[21317],256],12358:[,,{12441:12436}],12363:[,,{12441:12364}],12364:[[12363,12441]],12365:[,,{12441:12366}],12366:[[12365,12441]],12367:[,,{12441:12368}],12368:[[12367,12441]],12369:[,,{12441:12370}],12370:[[12369,12441]],12371:[,,{12441:12372}],12372:[[12371,12441]],12373:[,,{12441:12374}],12374:[[12373,12441]],12375:[,,{12441:12376}],12376:[[12375,12441]],12377:[,,{12441:12378}],12378:[[12377,12441]],12379:[,,{12441:12380}],12380:[[12379,12441]],12381:[,,{12441:12382}],12382:[[12381,12441]],12383:[,,{12441:12384}],12384:[[12383,12441]],12385:[,,{12441:12386}],12386:[[12385,12441]],12388:[,,{12441:12389}],12389:[[12388,12441]],12390:[,,{12441:12391}],12391:[[12390,12441]],12392:[,,{12441:12393}],12393:[[12392,12441]],12399:[,,{12441:12400,12442:12401}],12400:[[12399,12441]],12401:[[12399,12442]],12402:[,,{12441:12403,12442:12404}],12403:[[12402,12441]],12404:[[12402,12442]],12405:[,,{12441:12406,12442:12407}],12406:[[12405,12441]],12407:[[12405,12442]],12408:[,,{12441:12409,12442:12410}],12409:[[12408,12441]],12410:[[12408,12442]],12411:[,,{12441:12412,12442:12413}],12412:[[12411,12441]],12413:[[12411,12442]],12436:[[12358,12441]],12441:[,8],12442:[,8],12443:[[32,12441],256],12444:[[32,12442],256],12445:[,,{12441:12446}],12446:[[12445,12441]],12447:[[12424,12426],256],12454:[,,{12441:12532}],12459:[,,{12441:12460}],12460:[[12459,12441]],12461:[,,{12441:12462}],12462:[[12461,12441]],12463:[,,{12441:12464}],12464:[[12463,12441]],12465:[,,{12441:12466}],12466:[[12465,12441]],12467:[,,{12441:12468}],12468:[[12467,12441]],12469:[,,{12441:12470}],12470:[[12469,12441]],12471:[,,{12441:12472}],12472:[[12471,12441]],12473:[,,{12441:12474}],12474:[[12473,12441]],12475:[,,{12441:12476}],12476:[[12475,12441]],12477:[,,{12441:12478}],12478:[[12477,12441]],12479:[,,{12441:12480}],12480:[[12479,12441]],12481:[,,{12441:12482}],12482:[[12481,12441]],12484:[,,{12441:12485}],12485:[[12484,12441]],12486:[,,{12441:12487}],12487:[[12486,12441]],12488:[,,{12441:12489}],12489:[[12488,12441]],12495:[,,{12441:12496,12442:12497}],12496:[[12495,12441]],12497:[[12495,12442]],12498:[,,{12441:12499,12442:12500}],12499:[[12498,12441]],12500:[[12498,12442]],12501:[,,{12441:12502,12442:12503}],12502:[[12501,12441]],12503:[[12501,12442]],12504:[,,{12441:12505,12442:12506}],12505:[[12504,12441]],12506:[[12504,12442]],12507:[,,{12441:12508,12442:12509}],12508:[[12507,12441]],12509:[[12507,12442]],12527:[,,{12441:12535}],12528:[,,{12441:12536}],12529:[,,{12441:12537}],12530:[,,{12441:12538}],12532:[[12454,12441]],12535:[[12527,12441]],12536:[[12528,12441]],12537:[[12529,12441]],12538:[[12530,12441]],12541:[,,{12441:12542}],12542:[[12541,12441]],12543:[[12467,12488],256]},12544:{12593:[[4352],256],12594:[[4353],256],12595:[[4522],256],12596:[[4354],256],12597:[[4524],256],12598:[[4525],256],12599:[[4355],256],12600:[[4356],256],12601:[[4357],256],12602:[[4528],256],12603:[[4529],256],12604:[[4530],256],12605:[[4531],256],12606:[[4532],256],12607:[[4533],256],12608:[[4378],256],12609:[[4358],256],12610:[[4359],256],12611:[[4360],256],12612:[[4385],256],12613:[[4361],256],12614:[[4362],256],12615:[[4363],256],12616:[[4364],256],12617:[[4365],256],12618:[[4366],256],12619:[[4367],256],12620:[[4368],256],12621:[[4369],256],12622:[[4370],256],12623:[[4449],256],12624:[[4450],256],12625:[[4451],256],12626:[[4452],256],12627:[[4453],256],12628:[[4454],256],12629:[[4455],256],12630:[[4456],256],12631:[[4457],256],12632:[[4458],256],12633:[[4459],256],12634:[[4460],256],12635:[[4461],256],12636:[[4462],256],12637:[[4463],256],12638:[[4464],256],12639:[[4465],256],12640:[[4466],256],12641:[[4467],256],12642:[[4468],256],12643:[[4469],256],12644:[[4448],256],12645:[[4372],256],12646:[[4373],256],12647:[[4551],256],12648:[[4552],256],12649:[[4556],256],12650:[[4558],256],12651:[[4563],256],12652:[[4567],256],12653:[[4569],256],12654:[[4380],256],12655:[[4573],256],12656:[[4575],256],12657:[[4381],256],12658:[[4382],256],12659:[[4384],256],12660:[[4386],256],12661:[[4387],256],12662:[[4391],256],12663:[[4393],256],12664:[[4395],256],12665:[[4396],256],12666:[[4397],256],12667:[[4398],256],12668:[[4399],256],12669:[[4402],256],12670:[[4406],256],12671:[[4416],256],12672:[[4423],256],12673:[[4428],256],12674:[[4593],256],12675:[[4594],256],12676:[[4439],256],12677:[[4440],256],12678:[[4441],256],12679:[[4484],256],12680:[[4485],256],12681:[[4488],256],12682:[[4497],256],12683:[[4498],256],12684:[[4500],256],12685:[[4510],256],12686:[[4513],256],12690:[[19968],256],12691:[[20108],256],12692:[[19977],256],12693:[[22235],256],12694:[[19978],256],12695:[[20013],256],12696:[[19979],256],12697:[[30002],256],12698:[[20057],256],12699:[[19993],256],12700:[[19969],256],12701:[[22825],256],12702:[[22320],256],12703:[[20154],256]},12800:{12800:[[40,4352,41],256],12801:[[40,4354,41],256],12802:[[40,4355,41],256],12803:[[40,4357,41],256],12804:[[40,4358,41],256],12805:[[40,4359,41],256],12806:[[40,4361,41],256],12807:[[40,4363,41],256],12808:[[40,4364,41],256],12809:[[40,4366,41],256],12810:[[40,4367,41],256],12811:[[40,4368,41],256],12812:[[40,4369,41],256],12813:[[40,4370,41],256],12814:[[40,4352,4449,41],256],12815:[[40,4354,4449,41],256],12816:[[40,4355,4449,41],256],12817:[[40,4357,4449,41],256],12818:[[40,4358,4449,41],256],12819:[[40,4359,4449,41],256],12820:[[40,4361,4449,41],256],12821:[[40,4363,4449,41],256],12822:[[40,4364,4449,41],256],12823:[[40,4366,4449,41],256],12824:[[40,4367,4449,41],256],12825:[[40,4368,4449,41],256],12826:[[40,4369,4449,41],256],12827:[[40,4370,4449,41],256],12828:[[40,4364,4462,41],256],12829:[[40,4363,4457,4364,4453,4523,41],256],12830:[[40,4363,4457,4370,4462,41],256],12832:[[40,19968,41],256],12833:[[40,20108,41],256],12834:[[40,19977,41],256],12835:[[40,22235,41],256],12836:[[40,20116,41],256],12837:[[40,20845,41],256],12838:[[40,19971,41],256],12839:[[40,20843,41],256],12840:[[40,20061,41],256],12841:[[40,21313,41],256],12842:[[40,26376,41],256],12843:[[40,28779,41],256],12844:[[40,27700,41],256],12845:[[40,26408,41],256],12846:[[40,37329,41],256],12847:[[40,22303,41],256],12848:[[40,26085,41],256],12849:[[40,26666,41],256],12850:[[40,26377,41],256],12851:[[40,31038,41],256],12852:[[40,21517,41],256],12853:[[40,29305,41],256],12854:[[40,36001,41],256],12855:[[40,31069,41],256],12856:[[40,21172,41],256],12857:[[40,20195,41],256],12858:[[40,21628,41],256],12859:[[40,23398,41],256],12860:[[40,30435,41],256],12861:[[40,20225,41],256],12862:[[40,36039,41],256],12863:[[40,21332,41],256],12864:[[40,31085,41],256],12865:[[40,20241,41],256],12866:[[40,33258,41],256],12867:[[40,33267,41],256],12868:[[21839],256],12869:[[24188],256],12870:[[25991],256],12871:[[31631],256],12880:[[80,84,69],256],12881:[[50,49],256],12882:[[50,50],256],12883:[[50,51],256],12884:[[50,52],256],12885:[[50,53],256],12886:[[50,54],256],12887:[[50,55],256],12888:[[50,56],256],12889:[[50,57],256],12890:[[51,48],256],12891:[[51,49],256],12892:[[51,50],256],12893:[[51,51],256],12894:[[51,52],256],12895:[[51,53],256],12896:[[4352],256],12897:[[4354],256],12898:[[4355],256],12899:[[4357],256],12900:[[4358],256],12901:[[4359],256],12902:[[4361],256],12903:[[4363],256],12904:[[4364],256],12905:[[4366],256],12906:[[4367],256],12907:[[4368],256],12908:[[4369],256],12909:[[4370],256],12910:[[4352,4449],256],12911:[[4354,4449],256],12912:[[4355,4449],256],12913:[[4357,4449],256],12914:[[4358,4449],256],12915:[[4359,4449],256],12916:[[4361,4449],256],12917:[[4363,4449],256],12918:[[4364,4449],256],12919:[[4366,4449],256],12920:[[4367,4449],256],12921:[[4368,4449],256],12922:[[4369,4449],256],12923:[[4370,4449],256],12924:[[4366,4449,4535,4352,4457],256],12925:[[4364,4462,4363,4468],256],12926:[[4363,4462],256],12928:[[19968],256],12929:[[20108],256],12930:[[19977],256],12931:[[22235],256],12932:[[20116],256],12933:[[20845],256],12934:[[19971],256],12935:[[20843],256],12936:[[20061],256],12937:[[21313],256],12938:[[26376],256],12939:[[28779],256],12940:[[27700],256],12941:[[26408],256],12942:[[37329],256],12943:[[22303],256],12944:[[26085],256],12945:[[26666],256],12946:[[26377],256],12947:[[31038],256],12948:[[21517],256],12949:[[29305],256],12950:[[36001],256],12951:[[31069],256],12952:[[21172],256],12953:[[31192],256],12954:[[30007],256],12955:[[22899],256],12956:[[36969],256],12957:[[20778],256],12958:[[21360],256],12959:[[27880],256],12960:[[38917],256],12961:[[20241],256],12962:[[20889],256],12963:[[27491],256],12964:[[19978],256],12965:[[20013],256],12966:[[19979],256],12967:[[24038],256],12968:[[21491],256],12969:[[21307],256],12970:[[23447],256],12971:[[23398],256],12972:[[30435],256],12973:[[20225],256],12974:[[36039],256],12975:[[21332],256],12976:[[22812],256],12977:[[51,54],256],12978:[[51,55],256],12979:[[51,56],256],12980:[[51,57],256],12981:[[52,48],256],12982:[[52,49],256],12983:[[52,50],256],12984:[[52,51],256],12985:[[52,52],256],12986:[[52,53],256],12987:[[52,54],256],12988:[[52,55],256],12989:[[52,56],256],12990:[[52,57],256],12991:[[53,48],256],12992:[[49,26376],256],12993:[[50,26376],256],12994:[[51,26376],256],12995:[[52,26376],256],12996:[[53,26376],256],12997:[[54,26376],256],12998:[[55,26376],256],12999:[[56,26376],256],13e3:[[57,26376],256],13001:[[49,48,26376],256],13002:[[49,49,26376],256],13003:[[49,50,26376],256],13004:[[72,103],256],13005:[[101,114,103],256],13006:[[101,86],256],13007:[[76,84,68],256],13008:[[12450],256],13009:[[12452],256],13010:[[12454],256],13011:[[12456],256],13012:[[12458],256],13013:[[12459],256],13014:[[12461],256],13015:[[12463],256],13016:[[12465],256],13017:[[12467],256],13018:[[12469],256],13019:[[12471],256],13020:[[12473],256],13021:[[12475],256],13022:[[12477],256],13023:[[12479],256],13024:[[12481],256],13025:[[12484],256],13026:[[12486],256],13027:[[12488],256],13028:[[12490],256],13029:[[12491],256],13030:[[12492],256],13031:[[12493],256],13032:[[12494],256],13033:[[12495],256],13034:[[12498],256],13035:[[12501],256],13036:[[12504],256],13037:[[12507],256],13038:[[12510],256],13039:[[12511],256],13040:[[12512],256],13041:[[12513],256],13042:[[12514],256],13043:[[12516],256],13044:[[12518],256],13045:[[12520],256],13046:[[12521],256],13047:[[12522],256],13048:[[12523],256],13049:[[12524],256],13050:[[12525],256],13051:[[12527],256],13052:[[12528],256],13053:[[12529],256],13054:[[12530],256]},13056:{13056:[[12450,12497,12540,12488],256],13057:[[12450,12523,12501,12449],256],13058:[[12450,12531,12506,12450],256],13059:[[12450,12540,12523],256],13060:[[12452,12491,12531,12464],256],13061:[[12452,12531,12481],256],13062:[[12454,12457,12531],256],13063:[[12456,12473,12463,12540,12489],256],13064:[[12456,12540,12459,12540],256],13065:[[12458,12531,12473],256],13066:[[12458,12540,12512],256],13067:[[12459,12452,12522],256],13068:[[12459,12521,12483,12488],256],13069:[[12459,12525,12522,12540],256],13070:[[12460,12525,12531],256],13071:[[12460,12531,12510],256],13072:[[12462,12460],256],13073:[[12462,12491,12540],256],13074:[[12461,12517,12522,12540],256],13075:[[12462,12523,12480,12540],256],13076:[[12461,12525],256],13077:[[12461,12525,12464,12521,12512],256],13078:[[12461,12525,12513,12540,12488,12523],256],13079:[[12461,12525,12527,12483,12488],256],13080:[[12464,12521,12512],256],13081:[[12464,12521,12512,12488,12531],256],13082:[[12463,12523,12476,12452,12525],256],13083:[[12463,12525,12540,12493],256],13084:[[12465,12540,12473],256],13085:[[12467,12523,12490],256],13086:[[12467,12540,12509],256],13087:[[12469,12452,12463,12523],256],13088:[[12469,12531,12481,12540,12512],256],13089:[[12471,12522,12531,12464],256],13090:[[12475,12531,12481],256],13091:[[12475,12531,12488],256],13092:[[12480,12540,12473],256],13093:[[12487,12471],256],13094:[[12489,12523],256],13095:[[12488,12531],256],13096:[[12490,12494],256],13097:[[12494,12483,12488],256],13098:[[12495,12452,12484],256],13099:[[12497,12540,12475,12531,12488],256],13100:[[12497,12540,12484],256],13101:[[12496,12540,12524,12523],256],13102:[[12500,12450,12473,12488,12523],256],13103:[[12500,12463,12523],256],13104:[[12500,12467],256],13105:[[12499,12523],256],13106:[[12501,12449,12521,12483,12489],256],13107:[[12501,12451,12540,12488],256],13108:[[12502,12483,12471,12455,12523],256],13109:[[12501,12521,12531],256],13110:[[12504,12463,12479,12540,12523],256],13111:[[12506,12477],256],13112:[[12506,12491,12498],256],13113:[[12504,12523,12484],256],13114:[[12506,12531,12473],256],13115:[[12506,12540,12472],256],13116:[[12505,12540,12479],256],13117:[[12509,12452,12531,12488],256],13118:[[12508,12523,12488],256],13119:[[12507,12531],256],13120:[[12509,12531,12489],256],13121:[[12507,12540,12523],256],13122:[[12507,12540,12531],256],13123:[[12510,12452,12463,12525],256],13124:[[12510,12452,12523],256],13125:[[12510,12483,12495],256],13126:[[12510,12523,12463],256],13127:[[12510,12531,12471,12519,12531],256],13128:[[12511,12463,12525,12531],256],13129:[[12511,12522],256],13130:[[12511,12522,12496,12540,12523],256],13131:[[12513,12460],256],13132:[[12513,12460,12488,12531],256],13133:[[12513,12540,12488,12523],256],13134:[[12516,12540,12489],256],13135:[[12516,12540,12523],256],13136:[[12518,12450,12531],256],13137:[[12522,12483,12488,12523],256],13138:[[12522,12521],256],13139:[[12523,12500,12540],256],13140:[[12523,12540,12502,12523],256],13141:[[12524,12512],256],13142:[[12524,12531,12488,12466,12531],256],13143:[[12527,12483,12488],256],13144:[[48,28857],256],13145:[[49,28857],256],13146:[[50,28857],256],13147:[[51,28857],256],13148:[[52,28857],256],13149:[[53,28857],256],13150:[[54,28857],256],13151:[[55,28857],256],13152:[[56,28857],256],13153:[[57,28857],256],13154:[[49,48,28857],256],13155:[[49,49,28857],256],13156:[[49,50,28857],256],13157:[[49,51,28857],256],13158:[[49,52,28857],256],13159:[[49,53,28857],256],13160:[[49,54,28857],256],13161:[[49,55,28857],256],13162:[[49,56,28857],256],13163:[[49,57,28857],256],13164:[[50,48,28857],256],13165:[[50,49,28857],256],13166:[[50,50,28857],256],13167:[[50,51,28857],256],13168:[[50,52,28857],256],13169:[[104,80,97],256],13170:[[100,97],256],13171:[[65,85],256],13172:[[98,97,114],256],13173:[[111,86],256],13174:[[112,99],256],13175:[[100,109],256],13176:[[100,109,178],256],13177:[[100,109,179],256],13178:[[73,85],256],13179:[[24179,25104],256],13180:[[26157,21644],256],13181:[[22823,27491],256],13182:[[26126,27835],256],13183:[[26666,24335,20250,31038],256],13184:[[112,65],256],13185:[[110,65],256],13186:[[956,65],256],13187:[[109,65],256],13188:[[107,65],256],13189:[[75,66],256],13190:[[77,66],256],13191:[[71,66],256],13192:[[99,97,108],256],13193:[[107,99,97,108],256],13194:[[112,70],256],13195:[[110,70],256],13196:[[956,70],256],13197:[[956,103],256],13198:[[109,103],256],13199:[[107,103],256],13200:[[72,122],256],13201:[[107,72,122],256],13202:[[77,72,122],256],13203:[[71,72,122],256],13204:[[84,72,122],256],13205:[[956,8467],256],13206:[[109,8467],256],13207:[[100,8467],256],13208:[[107,8467],256],13209:[[102,109],256],13210:[[110,109],256],13211:[[956,109],256],13212:[[109,109],256],13213:[[99,109],256],13214:[[107,109],256],13215:[[109,109,178],256],13216:[[99,109,178],256],13217:[[109,178],256],13218:[[107,109,178],256],13219:[[109,109,179],256],13220:[[99,109,179],256],13221:[[109,179],256],13222:[[107,109,179],256],13223:[[109,8725,115],256],13224:[[109,8725,115,178],256],13225:[[80,97],256],13226:[[107,80,97],256],13227:[[77,80,97],256],13228:[[71,80,97],256],13229:[[114,97,100],256],13230:[[114,97,100,8725,115],256],13231:[[114,97,100,8725,115,178],256],13232:[[112,115],256],13233:[[110,115],256],13234:[[956,115],256],13235:[[109,115],256],13236:[[112,86],256],13237:[[110,86],256],13238:[[956,86],256],13239:[[109,86],256],13240:[[107,86],256],13241:[[77,86],256],13242:[[112,87],256],13243:[[110,87],256],13244:[[956,87],256],13245:[[109,87],256],13246:[[107,87],256],13247:[[77,87],256],13248:[[107,937],256],13249:[[77,937],256],13250:[[97,46,109,46],256],13251:[[66,113],256],13252:[[99,99],256],13253:[[99,100],256],13254:[[67,8725,107,103],256],13255:[[67,111,46],256],13256:[[100,66],256],13257:[[71,121],256],13258:[[104,97],256],13259:[[72,80],256],13260:[[105,110],256],13261:[[75,75],256],13262:[[75,77],256],13263:[[107,116],256],13264:[[108,109],256],13265:[[108,110],256],13266:[[108,111,103],256],13267:[[108,120],256],13268:[[109,98],256],13269:[[109,105,108],256],13270:[[109,111,108],256],13271:[[80,72],256],13272:[[112,46,109,46],256],13273:[[80,80,77],256],13274:[[80,82],256],13275:[[115,114],256],13276:[[83,118],256],13277:[[87,98],256],13278:[[86,8725,109],256],13279:[[65,8725,109],256],13280:[[49,26085],256],13281:[[50,26085],256],13282:[[51,26085],256],13283:[[52,26085],256],13284:[[53,26085],256],13285:[[54,26085],256],13286:[[55,26085],256],13287:[[56,26085],256],13288:[[57,26085],256],13289:[[49,48,26085],256],13290:[[49,49,26085],256],13291:[[49,50,26085],256],13292:[[49,51,26085],256],13293:[[49,52,26085],256],13294:[[49,53,26085],256],13295:[[49,54,26085],256],13296:[[49,55,26085],256],13297:[[49,56,26085],256],13298:[[49,57,26085],256],13299:[[50,48,26085],256],13300:[[50,49,26085],256],13301:[[50,50,26085],256],13302:[[50,51,26085],256],13303:[[50,52,26085],256],13304:[[50,53,26085],256],13305:[[50,54,26085],256],13306:[[50,55,26085],256],13307:[[50,56,26085],256],13308:[[50,57,26085],256],13309:[[51,48,26085],256],13310:[[51,49,26085],256],13311:[[103,97,108],256]},27136:{92912:[,1],92913:[,1],92914:[,1],92915:[,1],92916:[,1]},27392:{92976:[,230],92977:[,230],92978:[,230],92979:[,230],92980:[,230],92981:[,230],92982:[,230]},42496:{42607:[,230],42612:[,230],42613:[,230],42614:[,230],42615:[,230],42616:[,230],42617:[,230],42618:[,230],42619:[,230],42620:[,230],42621:[,230],42652:[[1098],256],42653:[[1100],256],42655:[,230],42736:[,230],42737:[,230]},42752:{42864:[[42863],256],43e3:[[294],256],43001:[[339],256]},43008:{43014:[,9],43204:[,9],43232:[,230],43233:[,230],43234:[,230],43235:[,230],43236:[,230],43237:[,230],43238:[,230],43239:[,230],43240:[,230],43241:[,230],43242:[,230],43243:[,230],43244:[,230],43245:[,230],43246:[,230],43247:[,230],43248:[,230],43249:[,230]},43264:{43307:[,220],43308:[,220],43309:[,220],43347:[,9],43443:[,7],43456:[,9]},43520:{43696:[,230],43698:[,230],43699:[,230],43700:[,220],43703:[,230],43704:[,230],43710:[,230],43711:[,230],43713:[,230],43766:[,9]},43776:{43868:[[42791],256],43869:[[43831],256],43870:[[619],256],43871:[[43858],256],44013:[,9]},48128:{113822:[,1]},53504:{119134:[[119127,119141],512],119135:[[119128,119141],512],119136:[[119135,119150],512],119137:[[119135,119151],512],119138:[[119135,119152],512],119139:[[119135,119153],512],119140:[[119135,119154],512],119141:[,216],119142:[,216],119143:[,1],119144:[,1],119145:[,1],119149:[,226],119150:[,216],119151:[,216],119152:[,216],119153:[,216],119154:[,216],119163:[,220],119164:[,220],119165:[,220],119166:[,220],119167:[,220],119168:[,220],119169:[,220],119170:[,220],119173:[,230],119174:[,230],119175:[,230],119176:[,230],119177:[,230],119178:[,220],119179:[,220],119210:[,230],119211:[,230],119212:[,230],119213:[,230],119227:[[119225,119141],512],119228:[[119226,119141],512],119229:[[119227,119150],512],119230:[[119228,119150],512],119231:[[119227,119151],512],119232:[[119228,119151],512]},53760:{119362:[,230],119363:[,230],119364:[,230]},54272:{119808:[[65],256],119809:[[66],256],119810:[[67],256],119811:[[68],256],119812:[[69],256],119813:[[70],256],119814:[[71],256],119815:[[72],256],119816:[[73],256],119817:[[74],256],119818:[[75],256],119819:[[76],256],119820:[[77],256],119821:[[78],256],119822:[[79],256],119823:[[80],256],119824:[[81],256],119825:[[82],256],119826:[[83],256],119827:[[84],256],119828:[[85],256],119829:[[86],256],119830:[[87],256],119831:[[88],256],119832:[[89],256],119833:[[90],256],119834:[[97],256],119835:[[98],256],119836:[[99],256],119837:[[100],256],119838:[[101],256],119839:[[102],256],119840:[[103],256],119841:[[104],256],119842:[[105],256],119843:[[106],256],119844:[[107],256],119845:[[108],256],119846:[[109],256],119847:[[110],256],119848:[[111],256],119849:[[112],256],119850:[[113],256],119851:[[114],256],119852:[[115],256],119853:[[116],256],119854:[[117],256],119855:[[118],256],119856:[[119],256],119857:[[120],256],119858:[[121],256],119859:[[122],256],119860:[[65],256],119861:[[66],256],119862:[[67],256],119863:[[68],256],119864:[[69],256],119865:[[70],256],119866:[[71],256],119867:[[72],256],119868:[[73],256],119869:[[74],256],119870:[[75],256],119871:[[76],256],119872:[[77],256],119873:[[78],256],119874:[[79],256],119875:[[80],256],119876:[[81],256],119877:[[82],256],119878:[[83],256],119879:[[84],256],119880:[[85],256],119881:[[86],256],119882:[[87],256],119883:[[88],256],119884:[[89],256],119885:[[90],256],119886:[[97],256],119887:[[98],256],119888:[[99],256],119889:[[100],256],119890:[[101],256],119891:[[102],256],119892:[[103],256],119894:[[105],256],119895:[[106],256],119896:[[107],256],119897:[[108],256],119898:[[109],256],119899:[[110],256],119900:[[111],256],119901:[[112],256],119902:[[113],256],119903:[[114],256],119904:[[115],256],119905:[[116],256],119906:[[117],256],119907:[[118],256],119908:[[119],256],119909:[[120],256],119910:[[121],256],119911:[[122],256],119912:[[65],256],119913:[[66],256],119914:[[67],256],119915:[[68],256],119916:[[69],256],119917:[[70],256],119918:[[71],256],119919:[[72],256],119920:[[73],256],119921:[[74],256],119922:[[75],256],119923:[[76],256],119924:[[77],256],119925:[[78],256],119926:[[79],256],119927:[[80],256],119928:[[81],256],119929:[[82],256],119930:[[83],256],119931:[[84],256],119932:[[85],256],119933:[[86],256],119934:[[87],256],119935:[[88],256],119936:[[89],256],119937:[[90],256],119938:[[97],256],119939:[[98],256],119940:[[99],256],119941:[[100],256],119942:[[101],256],119943:[[102],256],119944:[[103],256],119945:[[104],256],119946:[[105],256],119947:[[106],256],119948:[[107],256],119949:[[108],256],119950:[[109],256],119951:[[110],256],119952:[[111],256],119953:[[112],256],119954:[[113],256],119955:[[114],256],119956:[[115],256],119957:[[116],256],119958:[[117],256],119959:[[118],256],119960:[[119],256],119961:[[120],256],119962:[[121],256],119963:[[122],256],119964:[[65],256],119966:[[67],256],119967:[[68],256],119970:[[71],256],119973:[[74],256],119974:[[75],256],119977:[[78],256],119978:[[79],256],119979:[[80],256],119980:[[81],256],119982:[[83],256],119983:[[84],256],119984:[[85],256],119985:[[86],256],119986:[[87],256],119987:[[88],256],119988:[[89],256],119989:[[90],256],119990:[[97],256],119991:[[98],256],119992:[[99],256],119993:[[100],256],119995:[[102],256],119997:[[104],256],119998:[[105],256],119999:[[106],256],12e4:[[107],256],120001:[[108],256],120002:[[109],256],120003:[[110],256],120005:[[112],256],120006:[[113],256],120007:[[114],256],120008:[[115],256],120009:[[116],256],120010:[[117],256],120011:[[118],256],120012:[[119],256],120013:[[120],256],120014:[[121],256],120015:[[122],256],120016:[[65],256],120017:[[66],256],120018:[[67],256],120019:[[68],256],120020:[[69],256],120021:[[70],256],120022:[[71],256],120023:[[72],256],120024:[[73],256],120025:[[74],256],120026:[[75],256],120027:[[76],256],120028:[[77],256],120029:[[78],256],120030:[[79],256],120031:[[80],256],120032:[[81],256],120033:[[82],256],120034:[[83],256],120035:[[84],256],120036:[[85],256],120037:[[86],256],120038:[[87],256],120039:[[88],256],120040:[[89],256],120041:[[90],256],120042:[[97],256],120043:[[98],256],120044:[[99],256],120045:[[100],256],120046:[[101],256],120047:[[102],256],120048:[[103],256],120049:[[104],256],120050:[[105],256],120051:[[106],256],120052:[[107],256],120053:[[108],256],120054:[[109],256],120055:[[110],256],120056:[[111],256],120057:[[112],256],120058:[[113],256],120059:[[114],256],120060:[[115],256],120061:[[116],256],120062:[[117],256],120063:[[118],256]},54528:{120064:[[119],256],120065:[[120],256],120066:[[121],256],120067:[[122],256],120068:[[65],256],120069:[[66],256],120071:[[68],256],120072:[[69],256],120073:[[70],256],120074:[[71],256],120077:[[74],256],120078:[[75],256],120079:[[76],256],120080:[[77],256],120081:[[78],256],120082:[[79],256],120083:[[80],256],120084:[[81],256],120086:[[83],256],120087:[[84],256],120088:[[85],256],120089:[[86],256],120090:[[87],256],120091:[[88],256],120092:[[89],256],120094:[[97],256],120095:[[98],256],120096:[[99],256],120097:[[100],256],120098:[[101],256],120099:[[102],256],120100:[[103],256],120101:[[104],256],120102:[[105],256],120103:[[106],256],120104:[[107],256],120105:[[108],256],120106:[[109],256],120107:[[110],256],120108:[[111],256],120109:[[112],256],120110:[[113],256],120111:[[114],256],120112:[[115],256],120113:[[116],256],120114:[[117],256],120115:[[118],256],120116:[[119],256],120117:[[120],256],120118:[[121],256],120119:[[122],256],120120:[[65],256],120121:[[66],256],120123:[[68],256],120124:[[69],256],120125:[[70],256],120126:[[71],256],120128:[[73],256],120129:[[74],256],120130:[[75],256],120131:[[76],256],120132:[[77],256],120134:[[79],256],120138:[[83],256],120139:[[84],256],120140:[[85],256],120141:[[86],256],120142:[[87],256],120143:[[88],256],120144:[[89],256],120146:[[97],256],120147:[[98],256],120148:[[99],256],120149:[[100],256],120150:[[101],256],120151:[[102],256],120152:[[103],256],120153:[[104],256],120154:[[105],256],120155:[[106],256],120156:[[107],256],120157:[[108],256],120158:[[109],256],120159:[[110],256],120160:[[111],256],120161:[[112],256],120162:[[113],256],120163:[[114],256],120164:[[115],256],120165:[[116],256],120166:[[117],256],120167:[[118],256],120168:[[119],256],120169:[[120],256],120170:[[121],256],120171:[[122],256],120172:[[65],256],120173:[[66],256],120174:[[67],256],120175:[[68],256],120176:[[69],256],120177:[[70],256],120178:[[71],256],120179:[[72],256],120180:[[73],256],120181:[[74],256],120182:[[75],256],120183:[[76],256],120184:[[77],256],120185:[[78],256],120186:[[79],256],120187:[[80],256],120188:[[81],256],120189:[[82],256],120190:[[83],256],120191:[[84],256],120192:[[85],256],120193:[[86],256],120194:[[87],256],120195:[[88],256],120196:[[89],256],120197:[[90],256],120198:[[97],256],120199:[[98],256],120200:[[99],256],120201:[[100],256],120202:[[101],256],120203:[[102],256],120204:[[103],256],120205:[[104],256],120206:[[105],256],120207:[[106],256],120208:[[107],256],120209:[[108],256],120210:[[109],256],120211:[[110],256],120212:[[111],256],120213:[[112],256],120214:[[113],256],120215:[[114],256],120216:[[115],256],120217:[[116],256],120218:[[117],256],120219:[[118],256],120220:[[119],256],120221:[[120],256],120222:[[121],256],120223:[[122],256],120224:[[65],256],120225:[[66],256],120226:[[67],256],120227:[[68],256],120228:[[69],256],120229:[[70],256],120230:[[71],256],120231:[[72],256],120232:[[73],256],120233:[[74],256],120234:[[75],256],120235:[[76],256],120236:[[77],256],120237:[[78],256],120238:[[79],256],120239:[[80],256],120240:[[81],256],120241:[[82],256],120242:[[83],256],120243:[[84],256],120244:[[85],256],120245:[[86],256],120246:[[87],256],120247:[[88],256],120248:[[89],256],120249:[[90],256],120250:[[97],256],120251:[[98],256],120252:[[99],256],120253:[[100],256],120254:[[101],256],120255:[[102],256],120256:[[103],256],120257:[[104],256],120258:[[105],256],120259:[[106],256],120260:[[107],256],120261:[[108],256],120262:[[109],256],120263:[[110],256],120264:[[111],256],120265:[[112],256],120266:[[113],256],120267:[[114],256],120268:[[115],256],120269:[[116],256],120270:[[117],256],120271:[[118],256],120272:[[119],256],120273:[[120],256],120274:[[121],256],120275:[[122],256],120276:[[65],256],120277:[[66],256],120278:[[67],256],120279:[[68],256],120280:[[69],256],120281:[[70],256],120282:[[71],256],120283:[[72],256],120284:[[73],256],120285:[[74],256],120286:[[75],256],120287:[[76],256],120288:[[77],256],120289:[[78],256],120290:[[79],256],120291:[[80],256],120292:[[81],256],120293:[[82],256],120294:[[83],256],120295:[[84],256],120296:[[85],256],120297:[[86],256],120298:[[87],256],120299:[[88],256],120300:[[89],256],120301:[[90],256],120302:[[97],256],120303:[[98],256],120304:[[99],256],120305:[[100],256],120306:[[101],256],120307:[[102],256],120308:[[103],256],120309:[[104],256],120310:[[105],256],120311:[[106],256],120312:[[107],256],120313:[[108],256],120314:[[109],256],120315:[[110],256],120316:[[111],256],120317:[[112],256],120318:[[113],256],120319:[[114],256]},54784:{120320:[[115],256],120321:[[116],256],120322:[[117],256],120323:[[118],256],120324:[[119],256],120325:[[120],256],120326:[[121],256],120327:[[122],256],120328:[[65],256],120329:[[66],256],120330:[[67],256],120331:[[68],256],120332:[[69],256],120333:[[70],256],120334:[[71],256],120335:[[72],256],120336:[[73],256],120337:[[74],256],120338:[[75],256],120339:[[76],256],120340:[[77],256],120341:[[78],256],120342:[[79],256],120343:[[80],256],120344:[[81],256],120345:[[82],256],120346:[[83],256],120347:[[84],256],120348:[[85],256],120349:[[86],256],120350:[[87],256],120351:[[88],256],120352:[[89],256],120353:[[90],256],120354:[[97],256],120355:[[98],256],120356:[[99],256],120357:[[100],256],120358:[[101],256],120359:[[102],256],120360:[[103],256],120361:[[104],256],120362:[[105],256],120363:[[106],256],120364:[[107],256],120365:[[108],256],120366:[[109],256],120367:[[110],256],120368:[[111],256],120369:[[112],256],120370:[[113],256],120371:[[114],256],120372:[[115],256],120373:[[116],256],120374:[[117],256],120375:[[118],256],120376:[[119],256],120377:[[120],256],120378:[[121],256],120379:[[122],256],120380:[[65],256],120381:[[66],256],120382:[[67],256],120383:[[68],256],120384:[[69],256],120385:[[70],256],120386:[[71],256],120387:[[72],256],120388:[[73],256],120389:[[74],256],120390:[[75],256],120391:[[76],256],120392:[[77],256],120393:[[78],256],120394:[[79],256],120395:[[80],256],120396:[[81],256],120397:[[82],256],120398:[[83],256],120399:[[84],256],120400:[[85],256],120401:[[86],256],120402:[[87],256],120403:[[88],256],120404:[[89],256],120405:[[90],256],120406:[[97],256],120407:[[98],256],120408:[[99],256],120409:[[100],256],120410:[[101],256],120411:[[102],256],120412:[[103],256],120413:[[104],256],120414:[[105],256],120415:[[106],256],120416:[[107],256],120417:[[108],256],120418:[[109],256],120419:[[110],256],120420:[[111],256],120421:[[112],256],120422:[[113],256],120423:[[114],256],120424:[[115],256],120425:[[116],256],120426:[[117],256],120427:[[118],256],120428:[[119],256],120429:[[120],256],120430:[[121],256],120431:[[122],256],120432:[[65],256],120433:[[66],256],120434:[[67],256],120435:[[68],256],120436:[[69],256],120437:[[70],256],120438:[[71],256],120439:[[72],256],120440:[[73],256],120441:[[74],256],120442:[[75],256],120443:[[76],256],120444:[[77],256],120445:[[78],256],120446:[[79],256],120447:[[80],256],120448:[[81],256],120449:[[82],256],120450:[[83],256],120451:[[84],256],120452:[[85],256],120453:[[86],256],120454:[[87],256],120455:[[88],256],120456:[[89],256],120457:[[90],256],120458:[[97],256],120459:[[98],256],120460:[[99],256],120461:[[100],256],120462:[[101],256],120463:[[102],256],120464:[[103],256],120465:[[104],256],120466:[[105],256],120467:[[106],256],120468:[[107],256],120469:[[108],256],120470:[[109],256],120471:[[110],256],120472:[[111],256],120473:[[112],256],120474:[[113],256],120475:[[114],256],120476:[[115],256],120477:[[116],256],120478:[[117],256],120479:[[118],256],120480:[[119],256],120481:[[120],256],120482:[[121],256],120483:[[122],256],120484:[[305],256],120485:[[567],256],120488:[[913],256],120489:[[914],256],120490:[[915],256],120491:[[916],256],120492:[[917],256],120493:[[918],256],120494:[[919],256],120495:[[920],256],120496:[[921],256],120497:[[922],256],120498:[[923],256],120499:[[924],256],120500:[[925],256],120501:[[926],256],120502:[[927],256],120503:[[928],256],120504:[[929],256],120505:[[1012],256],120506:[[931],256],120507:[[932],256],120508:[[933],256],120509:[[934],256],120510:[[935],256],120511:[[936],256],120512:[[937],256],120513:[[8711],256],120514:[[945],256],120515:[[946],256],120516:[[947],256],120517:[[948],256],120518:[[949],256],120519:[[950],256],120520:[[951],256],120521:[[952],256],120522:[[953],256],120523:[[954],256],120524:[[955],256],120525:[[956],256],120526:[[957],256],120527:[[958],256],120528:[[959],256],120529:[[960],256],120530:[[961],256],120531:[[962],256],120532:[[963],256],120533:[[964],256],120534:[[965],256],120535:[[966],256],120536:[[967],256],120537:[[968],256],120538:[[969],256],120539:[[8706],256],120540:[[1013],256],120541:[[977],256],120542:[[1008],256],120543:[[981],256],120544:[[1009],256],120545:[[982],256],120546:[[913],256],120547:[[914],256],120548:[[915],256],120549:[[916],256],120550:[[917],256],120551:[[918],256],120552:[[919],256],120553:[[920],256],120554:[[921],256],120555:[[922],256],120556:[[923],256],120557:[[924],256],120558:[[925],256],120559:[[926],256],120560:[[927],256],120561:[[928],256],120562:[[929],256],120563:[[1012],256],120564:[[931],256],120565:[[932],256],120566:[[933],256],120567:[[934],256],120568:[[935],256],120569:[[936],256],120570:[[937],256],120571:[[8711],256],120572:[[945],256],120573:[[946],256],120574:[[947],256],120575:[[948],256]},55040:{120576:[[949],256],120577:[[950],256],120578:[[951],256],120579:[[952],256],120580:[[953],256],120581:[[954],256],120582:[[955],256],120583:[[956],256],120584:[[957],256],120585:[[958],256],120586:[[959],256],120587:[[960],256],120588:[[961],256],120589:[[962],256],120590:[[963],256],120591:[[964],256],120592:[[965],256],120593:[[966],256],120594:[[967],256],120595:[[968],256],120596:[[969],256],120597:[[8706],256],120598:[[1013],256],120599:[[977],256],120600:[[1008],256],120601:[[981],256],120602:[[1009],256],120603:[[982],256],120604:[[913],256],120605:[[914],256],120606:[[915],256],120607:[[916],256],120608:[[917],256],120609:[[918],256],120610:[[919],256],120611:[[920],256],120612:[[921],256],120613:[[922],256],120614:[[923],256],120615:[[924],256],120616:[[925],256],120617:[[926],256],120618:[[927],256],120619:[[928],256],120620:[[929],256],120621:[[1012],256],120622:[[931],256],120623:[[932],256],120624:[[933],256],120625:[[934],256],120626:[[935],256],120627:[[936],256],120628:[[937],256],120629:[[8711],256],120630:[[945],256],120631:[[946],256],120632:[[947],256],120633:[[948],256],120634:[[949],256],120635:[[950],256],120636:[[951],256],120637:[[952],256],120638:[[953],256],120639:[[954],256],120640:[[955],256],120641:[[956],256],120642:[[957],256],120643:[[958],256],120644:[[959],256],120645:[[960],256],120646:[[961],256],120647:[[962],256],120648:[[963],256],120649:[[964],256],120650:[[965],256],120651:[[966],256],120652:[[967],256],120653:[[968],256],120654:[[969],256],120655:[[8706],256],120656:[[1013],256],120657:[[977],256],120658:[[1008],256],120659:[[981],256],120660:[[1009],256],120661:[[982],256],120662:[[913],256],120663:[[914],256],120664:[[915],256],120665:[[916],256],120666:[[917],256],120667:[[918],256],120668:[[919],256],120669:[[920],256],120670:[[921],256],120671:[[922],256],120672:[[923],256],120673:[[924],256],120674:[[925],256],120675:[[926],256],120676:[[927],256],120677:[[928],256],120678:[[929],256],120679:[[1012],256],120680:[[931],256],120681:[[932],256],120682:[[933],256],120683:[[934],256],120684:[[935],256],120685:[[936],256],120686:[[937],256],120687:[[8711],256],120688:[[945],256],120689:[[946],256],120690:[[947],256],120691:[[948],256],120692:[[949],256],120693:[[950],256],120694:[[951],256],120695:[[952],256],120696:[[953],256],120697:[[954],256],120698:[[955],256],120699:[[956],256],120700:[[957],256],120701:[[958],256],120702:[[959],256],120703:[[960],256],120704:[[961],256],120705:[[962],256],120706:[[963],256],120707:[[964],256],120708:[[965],256],120709:[[966],256],120710:[[967],256],120711:[[968],256],120712:[[969],256],120713:[[8706],256],120714:[[1013],256],120715:[[977],256],120716:[[1008],256],120717:[[981],256],120718:[[1009],256],120719:[[982],256],120720:[[913],256],120721:[[914],256],120722:[[915],256],120723:[[916],256],120724:[[917],256],120725:[[918],256],120726:[[919],256],120727:[[920],256],120728:[[921],256],120729:[[922],256],120730:[[923],256],120731:[[924],256],120732:[[925],256],120733:[[926],256],120734:[[927],256],120735:[[928],256],120736:[[929],256],120737:[[1012],256],120738:[[931],256],120739:[[932],256],120740:[[933],256],120741:[[934],256],120742:[[935],256],120743:[[936],256],120744:[[937],256],120745:[[8711],256],120746:[[945],256],120747:[[946],256],120748:[[947],256],120749:[[948],256],120750:[[949],256],120751:[[950],256],120752:[[951],256],120753:[[952],256],120754:[[953],256],120755:[[954],256],120756:[[955],256],120757:[[956],256],120758:[[957],256],120759:[[958],256],120760:[[959],256],120761:[[960],256],120762:[[961],256],120763:[[962],256],120764:[[963],256],120765:[[964],256],120766:[[965],256],120767:[[966],256],120768:[[967],256],120769:[[968],256],120770:[[969],256],120771:[[8706],256],120772:[[1013],256],120773:[[977],256],120774:[[1008],256],120775:[[981],256],120776:[[1009],256],120777:[[982],256],120778:[[988],256],120779:[[989],256],120782:[[48],256],120783:[[49],256],120784:[[50],256],120785:[[51],256],120786:[[52],256],120787:[[53],256],120788:[[54],256],120789:[[55],256],120790:[[56],256],120791:[[57],256],120792:[[48],256],120793:[[49],256],120794:[[50],256],120795:[[51],256],120796:[[52],256],120797:[[53],256],120798:[[54],256],120799:[[55],256],120800:[[56],256],120801:[[57],256],120802:[[48],256],120803:[[49],256],120804:[[50],256],120805:[[51],256],120806:[[52],256],120807:[[53],256],120808:[[54],256],120809:[[55],256],120810:[[56],256],120811:[[57],256],120812:[[48],256],120813:[[49],256],120814:[[50],256],120815:[[51],256],120816:[[52],256],120817:[[53],256],120818:[[54],256],120819:[[55],256],120820:[[56],256],120821:[[57],256],120822:[[48],256],120823:[[49],256],120824:[[50],256],120825:[[51],256],120826:[[52],256],120827:[[53],256],120828:[[54],256],120829:[[55],256],120830:[[56],256],120831:[[57],256]},59392:{125136:[,220],125137:[,220],125138:[,220],125139:[,220],125140:[,220],125141:[,220],125142:[,220]},60928:{126464:[[1575],256],126465:[[1576],256],126466:[[1580],256],126467:[[1583],256],126469:[[1608],256],126470:[[1586],256],126471:[[1581],256],126472:[[1591],256],126473:[[1610],256],126474:[[1603],256],126475:[[1604],256],126476:[[1605],256],126477:[[1606],256],126478:[[1587],256],126479:[[1593],256],126480:[[1601],256],126481:[[1589],256],126482:[[1602],256],126483:[[1585],256],126484:[[1588],256],126485:[[1578],256],126486:[[1579],256],126487:[[1582],256],126488:[[1584],256],126489:[[1590],256],126490:[[1592],256],126491:[[1594],256],126492:[[1646],256],126493:[[1722],256],126494:[[1697],256],126495:[[1647],256],126497:[[1576],256],126498:[[1580],256],126500:[[1607],256],126503:[[1581],256],126505:[[1610],256],126506:[[1603],256],126507:[[1604],256],126508:[[1605],256],126509:[[1606],256],126510:[[1587],256],126511:[[1593],256],126512:[[1601],256],126513:[[1589],256],126514:[[1602],256],126516:[[1588],256],126517:[[1578],256],126518:[[1579],256],126519:[[1582],256],126521:[[1590],256],126523:[[1594],256],126530:[[1580],256],126535:[[1581],256],126537:[[1610],256],126539:[[1604],256],126541:[[1606],256],126542:[[1587],256],126543:[[1593],256],126545:[[1589],256],126546:[[1602],256],126548:[[1588],256],126551:[[1582],256],126553:[[1590],256],126555:[[1594],256],126557:[[1722],256],126559:[[1647],256],126561:[[1576],256],126562:[[1580],256],126564:[[1607],256],126567:[[1581],256],126568:[[1591],256],126569:[[1610],256],126570:[[1603],256],126572:[[1605],256],126573:[[1606],256],126574:[[1587],256],126575:[[1593],256],126576:[[1601],256],126577:[[1589],256],126578:[[1602],256],126580:[[1588],256],126581:[[1578],256],126582:[[1579],256],126583:[[1582],256],126585:[[1590],256],126586:[[1592],256],126587:[[1594],256],126588:[[1646],256],126590:[[1697],256],126592:[[1575],256],126593:[[1576],256],126594:[[1580],256],126595:[[1583],256],126596:[[1607],256],126597:[[1608],256],126598:[[1586],256],126599:[[1581],256],126600:[[1591],256],126601:[[1610],256],126603:[[1604],256],126604:[[1605],256],126605:[[1606],256],126606:[[1587],256],126607:[[1593],256],126608:[[1601],256],126609:[[1589],256],126610:[[1602],256],126611:[[1585],256],126612:[[1588],256],126613:[[1578],256],126614:[[1579],256],126615:[[1582],256],126616:[[1584],256],126617:[[1590],256],126618:[[1592],256],126619:[[1594],256],126625:[[1576],256],126626:[[1580],256],126627:[[1583],256],126629:[[1608],256],126630:[[1586],256],126631:[[1581],256],126632:[[1591],256],126633:[[1610],256],126635:[[1604],256],126636:[[1605],256],126637:[[1606],256],126638:[[1587],256],126639:[[1593],256],126640:[[1601],256],126641:[[1589],256],126642:[[1602],256],126643:[[1585],256],126644:[[1588],256],126645:[[1578],256],126646:[[1579],256],126647:[[1582],256],126648:[[1584],256],126649:[[1590],256],126650:[[1592],256],126651:[[1594],256]},61696:{127232:[[48,46],256],127233:[[48,44],256],127234:[[49,44],256],127235:[[50,44],256],127236:[[51,44],256],127237:[[52,44],256],127238:[[53,44],256],127239:[[54,44],256],127240:[[55,44],256],127241:[[56,44],256],127242:[[57,44],256],127248:[[40,65,41],256],127249:[[40,66,41],256],127250:[[40,67,41],256],127251:[[40,68,41],256],127252:[[40,69,41],256],127253:[[40,70,41],256],127254:[[40,71,41],256],127255:[[40,72,41],256],127256:[[40,73,41],256],127257:[[40,74,41],256],127258:[[40,75,41],256],127259:[[40,76,41],256],127260:[[40,77,41],256],127261:[[40,78,41],256],127262:[[40,79,41],256],127263:[[40,80,41],256],127264:[[40,81,41],256],127265:[[40,82,41],256],127266:[[40,83,41],256],127267:[[40,84,41],256],127268:[[40,85,41],256],127269:[[40,86,41],256],127270:[[40,87,41],256],127271:[[40,88,41],256],127272:[[40,89,41],256],127273:[[40,90,41],256],127274:[[12308,83,12309],256],127275:[[67],256],127276:[[82],256],127277:[[67,68],256],127278:[[87,90],256],127280:[[65],256],127281:[[66],256],127282:[[67],256],127283:[[68],256],127284:[[69],256],127285:[[70],256],127286:[[71],256],127287:[[72],256],127288:[[73],256],127289:[[74],256],127290:[[75],256],127291:[[76],256],127292:[[77],256],127293:[[78],256],127294:[[79],256],127295:[[80],256],127296:[[81],256],127297:[[82],256],127298:[[83],256],127299:[[84],256],127300:[[85],256],127301:[[86],256],127302:[[87],256],127303:[[88],256],127304:[[89],256],127305:[[90],256],127306:[[72,86],256],127307:[[77,86],256],127308:[[83,68],256],127309:[[83,83],256],127310:[[80,80,86],256],127311:[[87,67],256],127338:[[77,67],256],127339:[[77,68],256],127376:[[68,74],256]},61952:{127488:[[12411,12363],256],127489:[[12467,12467],256],127490:[[12469],256],127504:[[25163],256],127505:[[23383],256],127506:[[21452],256],127507:[[12487],256],127508:[[20108],256],127509:[[22810],256],127510:[[35299],256],127511:[[22825],256],127512:[[20132],256],127513:[[26144],256],127514:[[28961],256],127515:[[26009],256],127516:[[21069],256],127517:[[24460],256],127518:[[20877],256],127519:[[26032],256],127520:[[21021],256],127521:[[32066],256],127522:[[29983],256],127523:[[36009],256],127524:[[22768],256],127525:[[21561],256],127526:[[28436],256],127527:[[25237],256],127528:[[25429],256],127529:[[19968],256],127530:[[19977],256],127531:[[36938],256],127532:[[24038],256],127533:[[20013],256],127534:[[21491],256],127535:[[25351],256],127536:[[36208],256],127537:[[25171],256],127538:[[31105],256],127539:[[31354],256],127540:[[21512],256],127541:[[28288],256],127542:[[26377],256],127543:[[26376],256],127544:[[30003],256],127545:[[21106],256],127546:[[21942],256],127552:[[12308,26412,12309],256],127553:[[12308,19977,12309],256],127554:[[12308,20108,12309],256],127555:[[12308,23433,12309],256],127556:[[12308,28857,12309],256],127557:[[12308,25171,12309],256],127558:[[12308,30423,12309],256],127559:[[12308,21213,12309],256],127560:[[12308,25943,12309],256],127568:[[24471],256],127569:[[21487],256]},63488:{194560:[[20029]],194561:[[20024]],194562:[[20033]],194563:[[131362]],194564:[[20320]],194565:[[20398]],194566:[[20411]],194567:[[20482]],194568:[[20602]],194569:[[20633]],194570:[[20711]],194571:[[20687]],194572:[[13470]],194573:[[132666]],194574:[[20813]],194575:[[20820]],194576:[[20836]],194577:[[20855]],194578:[[132380]],194579:[[13497]],194580:[[20839]],194581:[[20877]],194582:[[132427]],194583:[[20887]],194584:[[20900]],194585:[[20172]],194586:[[20908]],194587:[[20917]],194588:[[168415]],194589:[[20981]],194590:[[20995]],194591:[[13535]],194592:[[21051]],194593:[[21062]],194594:[[21106]],194595:[[21111]],194596:[[13589]],194597:[[21191]],194598:[[21193]],194599:[[21220]],194600:[[21242]],194601:[[21253]],194602:[[21254]],194603:[[21271]],194604:[[21321]],194605:[[21329]],194606:[[21338]],194607:[[21363]],194608:[[21373]],194609:[[21375]],194610:[[21375]],194611:[[21375]],194612:[[133676]],194613:[[28784]],194614:[[21450]],194615:[[21471]],194616:[[133987]],194617:[[21483]],194618:[[21489]],194619:[[21510]],194620:[[21662]],194621:[[21560]],194622:[[21576]],194623:[[21608]],194624:[[21666]],194625:[[21750]],194626:[[21776]],194627:[[21843]],194628:[[21859]],194629:[[21892]],194630:[[21892]],194631:[[21913]],194632:[[21931]],194633:[[21939]],194634:[[21954]],194635:[[22294]],194636:[[22022]],194637:[[22295]],194638:[[22097]],194639:[[22132]],194640:[[20999]],194641:[[22766]],194642:[[22478]],194643:[[22516]],194644:[[22541]],194645:[[22411]],194646:[[22578]],194647:[[22577]],194648:[[22700]],194649:[[136420]],194650:[[22770]],194651:[[22775]],194652:[[22790]],194653:[[22810]],194654:[[22818]],194655:[[22882]],194656:[[136872]],194657:[[136938]],194658:[[23020]],194659:[[23067]],194660:[[23079]],194661:[[23e3]],194662:[[23142]],194663:[[14062]],194664:[[14076]],194665:[[23304]],194666:[[23358]],194667:[[23358]],194668:[[137672]],194669:[[23491]],194670:[[23512]],194671:[[23527]],194672:[[23539]],194673:[[138008]],194674:[[23551]],194675:[[23558]],194676:[[24403]],194677:[[23586]],194678:[[14209]],194679:[[23648]],194680:[[23662]],194681:[[23744]],194682:[[23693]],194683:[[138724]],194684:[[23875]],194685:[[138726]],194686:[[23918]],194687:[[23915]],194688:[[23932]],194689:[[24033]],194690:[[24034]],194691:[[14383]],194692:[[24061]],194693:[[24104]],194694:[[24125]],194695:[[24169]],194696:[[14434]],194697:[[139651]],194698:[[14460]],194699:[[24240]],194700:[[24243]],194701:[[24246]],194702:[[24266]],194703:[[172946]],194704:[[24318]],194705:[[140081]],194706:[[140081]],194707:[[33281]],194708:[[24354]],194709:[[24354]],194710:[[14535]],194711:[[144056]],194712:[[156122]],194713:[[24418]],194714:[[24427]],194715:[[14563]],194716:[[24474]],194717:[[24525]],194718:[[24535]],194719:[[24569]],194720:[[24705]],194721:[[14650]],194722:[[14620]],194723:[[24724]],194724:[[141012]],194725:[[24775]],194726:[[24904]],194727:[[24908]],194728:[[24910]],194729:[[24908]],194730:[[24954]],194731:[[24974]],194732:[[25010]],194733:[[24996]],194734:[[25007]],194735:[[25054]],194736:[[25074]],194737:[[25078]],194738:[[25104]],194739:[[25115]],194740:[[25181]],194741:[[25265]],194742:[[25300]],194743:[[25424]],194744:[[142092]],194745:[[25405]],194746:[[25340]],194747:[[25448]],194748:[[25475]],194749:[[25572]],194750:[[142321]],194751:[[25634]],194752:[[25541]],194753:[[25513]],194754:[[14894]],194755:[[25705]],194756:[[25726]],194757:[[25757]],194758:[[25719]],194759:[[14956]],194760:[[25935]],194761:[[25964]],194762:[[143370]],194763:[[26083]],194764:[[26360]],194765:[[26185]],194766:[[15129]],194767:[[26257]],194768:[[15112]],194769:[[15076]],194770:[[20882]],194771:[[20885]],194772:[[26368]],194773:[[26268]],194774:[[32941]],194775:[[17369]],194776:[[26391]],194777:[[26395]],194778:[[26401]],194779:[[26462]],194780:[[26451]],194781:[[144323]],194782:[[15177]],194783:[[26618]],194784:[[26501]],194785:[[26706]],194786:[[26757]],194787:[[144493]],194788:[[26766]],194789:[[26655]],194790:[[26900]],194791:[[15261]],194792:[[26946]],194793:[[27043]],194794:[[27114]],194795:[[27304]],194796:[[145059]],194797:[[27355]],194798:[[15384]],194799:[[27425]],194800:[[145575]],194801:[[27476]],194802:[[15438]],194803:[[27506]],194804:[[27551]],194805:[[27578]],194806:[[27579]],194807:[[146061]],194808:[[138507]],194809:[[146170]],194810:[[27726]],194811:[[146620]],194812:[[27839]],194813:[[27853]],194814:[[27751]],194815:[[27926]]},63744:{63744:[[35912]],63745:[[26356]],63746:[[36554]],63747:[[36040]],63748:[[28369]],63749:[[20018]],63750:[[21477]],63751:[[40860]],63752:[[40860]],63753:[[22865]],63754:[[37329]],63755:[[21895]],63756:[[22856]],63757:[[25078]],63758:[[30313]],63759:[[32645]],63760:[[34367]],63761:[[34746]],63762:[[35064]],63763:[[37007]],63764:[[27138]],63765:[[27931]],63766:[[28889]],63767:[[29662]],63768:[[33853]],63769:[[37226]],63770:[[39409]],63771:[[20098]],63772:[[21365]],63773:[[27396]],63774:[[29211]],63775:[[34349]],63776:[[40478]],63777:[[23888]],63778:[[28651]],63779:[[34253]],63780:[[35172]],63781:[[25289]],63782:[[33240]],63783:[[34847]],63784:[[24266]],63785:[[26391]],63786:[[28010]],63787:[[29436]],63788:[[37070]],63789:[[20358]],63790:[[20919]],63791:[[21214]],63792:[[25796]],63793:[[27347]],63794:[[29200]],63795:[[30439]],63796:[[32769]],63797:[[34310]],63798:[[34396]],63799:[[36335]],63800:[[38706]],63801:[[39791]],63802:[[40442]],63803:[[30860]],63804:[[31103]],63805:[[32160]],63806:[[33737]],63807:[[37636]],63808:[[40575]],63809:[[35542]],63810:[[22751]],63811:[[24324]],63812:[[31840]],63813:[[32894]],63814:[[29282]],63815:[[30922]],63816:[[36034]],63817:[[38647]],63818:[[22744]],63819:[[23650]],63820:[[27155]],63821:[[28122]],63822:[[28431]],63823:[[32047]],63824:[[32311]],63825:[[38475]],63826:[[21202]],63827:[[32907]],63828:[[20956]],63829:[[20940]],63830:[[31260]],63831:[[32190]],63832:[[33777]],63833:[[38517]],63834:[[35712]],63835:[[25295]],63836:[[27138]],63837:[[35582]],63838:[[20025]],63839:[[23527]],63840:[[24594]],63841:[[29575]],63842:[[30064]],63843:[[21271]],63844:[[30971]],63845:[[20415]],63846:[[24489]],63847:[[19981]],63848:[[27852]],63849:[[25976]],63850:[[32034]],63851:[[21443]],63852:[[22622]],63853:[[30465]],63854:[[33865]],63855:[[35498]],63856:[[27578]],63857:[[36784]],63858:[[27784]],63859:[[25342]],63860:[[33509]],63861:[[25504]],63862:[[30053]],63863:[[20142]],63864:[[20841]],63865:[[20937]],63866:[[26753]],63867:[[31975]],63868:[[33391]],63869:[[35538]],63870:[[37327]],63871:[[21237]],63872:[[21570]],63873:[[22899]],63874:[[24300]],63875:[[26053]],63876:[[28670]],63877:[[31018]],63878:[[38317]],63879:[[39530]],63880:[[40599]],63881:[[40654]],63882:[[21147]],63883:[[26310]],63884:[[27511]],63885:[[36706]],63886:[[24180]],63887:[[24976]],63888:[[25088]],63889:[[25754]],63890:[[28451]],63891:[[29001]],63892:[[29833]],63893:[[31178]],63894:[[32244]],63895:[[32879]],63896:[[36646]],63897:[[34030]],63898:[[36899]],63899:[[37706]],63900:[[21015]],63901:[[21155]],63902:[[21693]],63903:[[28872]],63904:[[35010]],63905:[[35498]],63906:[[24265]],63907:[[24565]],63908:[[25467]],63909:[[27566]],63910:[[31806]],63911:[[29557]],63912:[[20196]],63913:[[22265]],63914:[[23527]],63915:[[23994]],63916:[[24604]],63917:[[29618]],63918:[[29801]],63919:[[32666]],63920:[[32838]],63921:[[37428]],63922:[[38646]],63923:[[38728]],63924:[[38936]],63925:[[20363]],63926:[[31150]],63927:[[37300]],63928:[[38584]],63929:[[24801]],63930:[[20102]],63931:[[20698]],63932:[[23534]],63933:[[23615]],63934:[[26009]],63935:[[27138]],63936:[[29134]],63937:[[30274]],63938:[[34044]],63939:[[36988]],63940:[[40845]],63941:[[26248]],63942:[[38446]],63943:[[21129]],63944:[[26491]],63945:[[26611]],63946:[[27969]],63947:[[28316]],63948:[[29705]],63949:[[30041]],63950:[[30827]],63951:[[32016]],63952:[[39006]],63953:[[20845]],63954:[[25134]],63955:[[38520]],63956:[[20523]],63957:[[23833]],63958:[[28138]],63959:[[36650]],63960:[[24459]],63961:[[24900]],63962:[[26647]],63963:[[29575]],63964:[[38534]],63965:[[21033]],63966:[[21519]],63967:[[23653]],63968:[[26131]],63969:[[26446]],63970:[[26792]],63971:[[27877]],63972:[[29702]],63973:[[30178]],63974:[[32633]],63975:[[35023]],63976:[[35041]],63977:[[37324]],63978:[[38626]],63979:[[21311]],63980:[[28346]],63981:[[21533]],63982:[[29136]],63983:[[29848]],63984:[[34298]],63985:[[38563]],63986:[[40023]],63987:[[40607]],63988:[[26519]],63989:[[28107]],63990:[[33256]],63991:[[31435]],63992:[[31520]],63993:[[31890]],63994:[[29376]],63995:[[28825]],63996:[[35672]],63997:[[20160]],63998:[[33590]],63999:[[21050]],194816:[[27966]],194817:[[28023]],194818:[[27969]],194819:[[28009]],194820:[[28024]],194821:[[28037]],194822:[[146718]],194823:[[27956]],194824:[[28207]],194825:[[28270]],194826:[[15667]],194827:[[28363]],194828:[[28359]],194829:[[147153]],194830:[[28153]],194831:[[28526]],194832:[[147294]],194833:[[147342]],194834:[[28614]],194835:[[28729]],194836:[[28702]],194837:[[28699]],194838:[[15766]],194839:[[28746]],194840:[[28797]],194841:[[28791]],194842:[[28845]],194843:[[132389]],194844:[[28997]],194845:[[148067]],194846:[[29084]],194847:[[148395]],194848:[[29224]],194849:[[29237]],194850:[[29264]],194851:[[149e3]],194852:[[29312]],194853:[[29333]],194854:[[149301]],194855:[[149524]],194856:[[29562]],194857:[[29579]],194858:[[16044]],194859:[[29605]],194860:[[16056]],194861:[[16056]],194862:[[29767]],194863:[[29788]],194864:[[29809]],194865:[[29829]],194866:[[29898]],194867:[[16155]],194868:[[29988]],194869:[[150582]],194870:[[30014]],194871:[[150674]],194872:[[30064]],194873:[[139679]],194874:[[30224]],194875:[[151457]],194876:[[151480]],194877:[[151620]],194878:[[16380]],194879:[[16392]],194880:[[30452]],194881:[[151795]],194882:[[151794]],194883:[[151833]],194884:[[151859]],194885:[[30494]],194886:[[30495]],194887:[[30495]],194888:[[30538]],194889:[[16441]],194890:[[30603]],194891:[[16454]],194892:[[16534]],194893:[[152605]],194894:[[30798]],194895:[[30860]],194896:[[30924]],194897:[[16611]],194898:[[153126]],194899:[[31062]],194900:[[153242]],194901:[[153285]],194902:[[31119]],194903:[[31211]],194904:[[16687]],194905:[[31296]],194906:[[31306]],194907:[[31311]],194908:[[153980]],194909:[[154279]],194910:[[154279]],194911:[[31470]],194912:[[16898]],194913:[[154539]],194914:[[31686]],194915:[[31689]],194916:[[16935]],194917:[[154752]],194918:[[31954]],194919:[[17056]],194920:[[31976]],194921:[[31971]],194922:[[32e3]],194923:[[155526]],194924:[[32099]],194925:[[17153]],194926:[[32199]],194927:[[32258]],194928:[[32325]],194929:[[17204]],194930:[[156200]],194931:[[156231]],194932:[[17241]],194933:[[156377]],194934:[[32634]],194935:[[156478]],194936:[[32661]],194937:[[32762]],194938:[[32773]],194939:[[156890]],194940:[[156963]],194941:[[32864]],194942:[[157096]],194943:[[32880]],194944:[[144223]],194945:[[17365]],194946:[[32946]],194947:[[33027]],194948:[[17419]],194949:[[33086]],194950:[[23221]],194951:[[157607]],194952:[[157621]],194953:[[144275]],194954:[[144284]],194955:[[33281]],194956:[[33284]],194957:[[36766]],194958:[[17515]],194959:[[33425]],194960:[[33419]],194961:[[33437]],194962:[[21171]],194963:[[33457]],194964:[[33459]],194965:[[33469]],194966:[[33510]],194967:[[158524]],194968:[[33509]],194969:[[33565]],194970:[[33635]],194971:[[33709]],194972:[[33571]],194973:[[33725]],194974:[[33767]],194975:[[33879]],194976:[[33619]],194977:[[33738]],194978:[[33740]],194979:[[33756]],194980:[[158774]],194981:[[159083]],194982:[[158933]],194983:[[17707]],194984:[[34033]],194985:[[34035]],194986:[[34070]],194987:[[160714]],194988:[[34148]],194989:[[159532]],194990:[[17757]],194991:[[17761]],194992:[[159665]],194993:[[159954]],194994:[[17771]],194995:[[34384]],194996:[[34396]],194997:[[34407]],194998:[[34409]],194999:[[34473]],195e3:[[34440]],195001:[[34574]],195002:[[34530]],195003:[[34681]],195004:[[34600]],195005:[[34667]],195006:[[34694]],195007:[[17879]],195008:[[34785]],195009:[[34817]],195010:[[17913]],195011:[[34912]],195012:[[34915]],195013:[[161383]],195014:[[35031]],195015:[[35038]],195016:[[17973]],195017:[[35066]],195018:[[13499]],195019:[[161966]],195020:[[162150]],195021:[[18110]],195022:[[18119]],195023:[[35488]],195024:[[35565]],195025:[[35722]],195026:[[35925]],195027:[[162984]],195028:[[36011]],195029:[[36033]],195030:[[36123]],195031:[[36215]],195032:[[163631]],195033:[[133124]],195034:[[36299]],195035:[[36284]],195036:[[36336]],195037:[[133342]],195038:[[36564]],195039:[[36664]],195040:[[165330]],195041:[[165357]],195042:[[37012]],195043:[[37105]],195044:[[37137]],195045:[[165678]],195046:[[37147]],195047:[[37432]],195048:[[37591]],195049:[[37592]],195050:[[37500]],195051:[[37881]],195052:[[37909]],195053:[[166906]],195054:[[38283]],195055:[[18837]],195056:[[38327]],195057:[[167287]],195058:[[18918]],195059:[[38595]],195060:[[23986]],195061:[[38691]],195062:[[168261]],195063:[[168474]],195064:[[19054]],195065:[[19062]],195066:[[38880]],195067:[[168970]],195068:[[19122]],195069:[[169110]],195070:[[38923]],195071:[[38923]]},64e3:{64e3:[[20999]],64001:[[24230]],64002:[[25299]],64003:[[31958]],64004:[[23429]],64005:[[27934]],64006:[[26292]],64007:[[36667]],64008:[[34892]],64009:[[38477]],64010:[[35211]],64011:[[24275]],64012:[[20800]],64013:[[21952]],64016:[[22618]],64018:[[26228]],64021:[[20958]],64022:[[29482]],64023:[[30410]],64024:[[31036]],64025:[[31070]],64026:[[31077]],64027:[[31119]],64028:[[38742]],64029:[[31934]],64030:[[32701]],64032:[[34322]],64034:[[35576]],64037:[[36920]],64038:[[37117]],64042:[[39151]],64043:[[39164]],64044:[[39208]],64045:[[40372]],64046:[[37086]],64047:[[38583]],64048:[[20398]],64049:[[20711]],64050:[[20813]],64051:[[21193]],64052:[[21220]],64053:[[21329]],64054:[[21917]],64055:[[22022]],64056:[[22120]],64057:[[22592]],64058:[[22696]],64059:[[23652]],64060:[[23662]],64061:[[24724]],64062:[[24936]],64063:[[24974]],64064:[[25074]],64065:[[25935]],64066:[[26082]],64067:[[26257]],64068:[[26757]],64069:[[28023]],64070:[[28186]],64071:[[28450]],64072:[[29038]],64073:[[29227]],64074:[[29730]],64075:[[30865]],64076:[[31038]],64077:[[31049]],64078:[[31048]],64079:[[31056]],64080:[[31062]],64081:[[31069]],64082:[[31117]],64083:[[31118]],64084:[[31296]],64085:[[31361]],64086:[[31680]],64087:[[32244]],64088:[[32265]],64089:[[32321]],64090:[[32626]],64091:[[32773]],64092:[[33261]],64093:[[33401]],64094:[[33401]],64095:[[33879]],64096:[[35088]],64097:[[35222]],64098:[[35585]],64099:[[35641]],64100:[[36051]],64101:[[36104]],64102:[[36790]],64103:[[36920]],64104:[[38627]],64105:[[38911]],64106:[[38971]],64107:[[24693]],64108:[[148206]],64109:[[33304]],64112:[[20006]],64113:[[20917]],64114:[[20840]],64115:[[20352]],64116:[[20805]],64117:[[20864]],64118:[[21191]],64119:[[21242]],64120:[[21917]],64121:[[21845]],64122:[[21913]],64123:[[21986]],64124:[[22618]],64125:[[22707]],64126:[[22852]],64127:[[22868]],64128:[[23138]],64129:[[23336]],64130:[[24274]],64131:[[24281]],64132:[[24425]],64133:[[24493]],64134:[[24792]],64135:[[24910]],64136:[[24840]],64137:[[24974]],64138:[[24928]],64139:[[25074]],64140:[[25140]],64141:[[25540]],64142:[[25628]],64143:[[25682]],64144:[[25942]],64145:[[26228]],64146:[[26391]],64147:[[26395]],64148:[[26454]],64149:[[27513]],64150:[[27578]],64151:[[27969]],64152:[[28379]],64153:[[28363]],64154:[[28450]],64155:[[28702]],64156:[[29038]],64157:[[30631]],64158:[[29237]],64159:[[29359]],64160:[[29482]],64161:[[29809]],64162:[[29958]],64163:[[30011]],64164:[[30237]],64165:[[30239]],64166:[[30410]],64167:[[30427]],64168:[[30452]],64169:[[30538]],64170:[[30528]],64171:[[30924]],64172:[[31409]],64173:[[31680]],64174:[[31867]],64175:[[32091]],64176:[[32244]],64177:[[32574]],64178:[[32773]],64179:[[33618]],64180:[[33775]],64181:[[34681]],64182:[[35137]],64183:[[35206]],64184:[[35222]],64185:[[35519]],64186:[[35576]],64187:[[35531]],64188:[[35585]],64189:[[35582]],64190:[[35565]],64191:[[35641]],64192:[[35722]],64193:[[36104]],64194:[[36664]],64195:[[36978]],64196:[[37273]],64197:[[37494]],64198:[[38524]],64199:[[38627]],64200:[[38742]],64201:[[38875]],64202:[[38911]],64203:[[38923]],64204:[[38971]],64205:[[39698]],64206:[[40860]],64207:[[141386]],64208:[[141380]],64209:[[144341]],64210:[[15261]],64211:[[16408]],64212:[[16441]],64213:[[152137]],64214:[[154832]],64215:[[163539]],64216:[[40771]],64217:[[40846]],195072:[[38953]],195073:[[169398]],195074:[[39138]],195075:[[19251]],195076:[[39209]],195077:[[39335]],195078:[[39362]],195079:[[39422]],195080:[[19406]],195081:[[170800]],195082:[[39698]],195083:[[4e4]],195084:[[40189]],195085:[[19662]],195086:[[19693]],195087:[[40295]],195088:[[172238]],195089:[[19704]],195090:[[172293]],195091:[[172558]],195092:[[172689]],195093:[[40635]],195094:[[19798]],195095:[[40697]],195096:[[40702]],195097:[[40709]],195098:[[40719]],195099:[[40726]],195100:[[40763]],195101:[[173568]]},64256:{64256:[[102,102],256],64257:[[102,105],256],64258:[[102,108],256],64259:[[102,102,105],256],64260:[[102,102,108],256],64261:[[383,116],256],64262:[[115,116],256],64275:[[1396,1398],256],64276:[[1396,1381],256],64277:[[1396,1387],256],64278:[[1406,1398],256],64279:[[1396,1389],256],64285:[[1497,1460],512],64286:[,26],64287:[[1522,1463],512],64288:[[1506],256],64289:[[1488],256],64290:[[1491],256],64291:[[1492],256],64292:[[1499],256],64293:[[1500],256],64294:[[1501],256],64295:[[1512],256],64296:[[1514],256],64297:[[43],256],64298:[[1513,1473],512],64299:[[1513,1474],512],64300:[[64329,1473],512],64301:[[64329,1474],512],64302:[[1488,1463],512],64303:[[1488,1464],512],64304:[[1488,1468],512],64305:[[1489,1468],512],64306:[[1490,1468],512],64307:[[1491,1468],512],64308:[[1492,1468],512],64309:[[1493,1468],512],64310:[[1494,1468],512],64312:[[1496,1468],512],64313:[[1497,1468],512],64314:[[1498,1468],512],64315:[[1499,1468],512],64316:[[1500,1468],512],64318:[[1502,1468],512],64320:[[1504,1468],512],64321:[[1505,1468],512],64323:[[1507,1468],512],64324:[[1508,1468],512],64326:[[1510,1468],512],64327:[[1511,1468],512],64328:[[1512,1468],512],64329:[[1513,1468],512],64330:[[1514,1468],512],64331:[[1493,1465],512],64332:[[1489,1471],512],64333:[[1499,1471],512],64334:[[1508,1471],512],64335:[[1488,1500],256],64336:[[1649],256],64337:[[1649],256],64338:[[1659],256],64339:[[1659],256],64340:[[1659],256],64341:[[1659],256],64342:[[1662],256],64343:[[1662],256],64344:[[1662],256],64345:[[1662],256],64346:[[1664],256],64347:[[1664],256],64348:[[1664],256],64349:[[1664],256],64350:[[1658],256],64351:[[1658],256],64352:[[1658],256],64353:[[1658],256],64354:[[1663],256],64355:[[1663],256],64356:[[1663],256],64357:[[1663],256],64358:[[1657],256],64359:[[1657],256],64360:[[1657],256],64361:[[1657],256],64362:[[1700],256],64363:[[1700],256],64364:[[1700],256],64365:[[1700],256],64366:[[1702],256],64367:[[1702],256],64368:[[1702],256],64369:[[1702],256],64370:[[1668],256],64371:[[1668],256],64372:[[1668],256],64373:[[1668],256],64374:[[1667],256],64375:[[1667],256],64376:[[1667],256],64377:[[1667],256],64378:[[1670],256],64379:[[1670],256],64380:[[1670],256],64381:[[1670],256],64382:[[1671],256],64383:[[1671],256],64384:[[1671],256],64385:[[1671],256],64386:[[1677],256],64387:[[1677],256],64388:[[1676],256],64389:[[1676],256],64390:[[1678],256],64391:[[1678],256],64392:[[1672],256],64393:[[1672],256],64394:[[1688],256],64395:[[1688],256],64396:[[1681],256],64397:[[1681],256],64398:[[1705],256],64399:[[1705],256],64400:[[1705],256],64401:[[1705],256],64402:[[1711],256],64403:[[1711],256],64404:[[1711],256],64405:[[1711],256],64406:[[1715],256],64407:[[1715],256],64408:[[1715],256],64409:[[1715],256],64410:[[1713],256],64411:[[1713],256],64412:[[1713],256],64413:[[1713],256],64414:[[1722],256],64415:[[1722],256],64416:[[1723],256],64417:[[1723],256],64418:[[1723],256],64419:[[1723],256],64420:[[1728],256],64421:[[1728],256],64422:[[1729],256],64423:[[1729],256],64424:[[1729],256],64425:[[1729],256],64426:[[1726],256],64427:[[1726],256],64428:[[1726],256],64429:[[1726],256],64430:[[1746],256],64431:[[1746],256],64432:[[1747],256],64433:[[1747],256],64467:[[1709],256],64468:[[1709],256],64469:[[1709],256],64470:[[1709],256],64471:[[1735],256],64472:[[1735],256],64473:[[1734],256],64474:[[1734],256],64475:[[1736],256],64476:[[1736],256],64477:[[1655],256],64478:[[1739],256],64479:[[1739],256],64480:[[1733],256],64481:[[1733],256],64482:[[1737],256],64483:[[1737],256],64484:[[1744],256],64485:[[1744],256],64486:[[1744],256],64487:[[1744],256],64488:[[1609],256],64489:[[1609],256],64490:[[1574,1575],256],64491:[[1574,1575],256],64492:[[1574,1749],256],64493:[[1574,1749],256],64494:[[1574,1608],256],64495:[[1574,1608],256],64496:[[1574,1735],256],64497:[[1574,1735],256],64498:[[1574,1734],256],64499:[[1574,1734],256],64500:[[1574,1736],256],64501:[[1574,1736],256],64502:[[1574,1744],256],64503:[[1574,1744],256],64504:[[1574,1744],256],64505:[[1574,1609],256],64506:[[1574,1609],256],64507:[[1574,1609],256],64508:[[1740],256],64509:[[1740],256],64510:[[1740],256],64511:[[1740],256]},64512:{64512:[[1574,1580],256],64513:[[1574,1581],256],64514:[[1574,1605],256],64515:[[1574,1609],256],64516:[[1574,1610],256],64517:[[1576,1580],256],64518:[[1576,1581],256],64519:[[1576,1582],256],64520:[[1576,1605],256],64521:[[1576,1609],256],64522:[[1576,1610],256],64523:[[1578,1580],256],64524:[[1578,1581],256],64525:[[1578,1582],256],64526:[[1578,1605],256],64527:[[1578,1609],256],64528:[[1578,1610],256],64529:[[1579,1580],256],64530:[[1579,1605],256],64531:[[1579,1609],256],64532:[[1579,1610],256],64533:[[1580,1581],256],64534:[[1580,1605],256],64535:[[1581,1580],256],64536:[[1581,1605],256],64537:[[1582,1580],256],64538:[[1582,1581],256],64539:[[1582,1605],256],64540:[[1587,1580],256],64541:[[1587,1581],256],64542:[[1587,1582],256],64543:[[1587,1605],256],64544:[[1589,1581],256],64545:[[1589,1605],256],64546:[[1590,1580],256],64547:[[1590,1581],256],64548:[[1590,1582],256],64549:[[1590,1605],256],64550:[[1591,1581],256],64551:[[1591,1605],256],64552:[[1592,1605],256],64553:[[1593,1580],256],64554:[[1593,1605],256],64555:[[1594,1580],256],64556:[[1594,1605],256],64557:[[1601,1580],256],64558:[[1601,1581],256],64559:[[1601,1582],256],64560:[[1601,1605],256],64561:[[1601,1609],256],64562:[[1601,1610],256],64563:[[1602,1581],256],64564:[[1602,1605],256],64565:[[1602,1609],256],64566:[[1602,1610],256],64567:[[1603,1575],256],64568:[[1603,1580],256],64569:[[1603,1581],256],64570:[[1603,1582],256],64571:[[1603,1604],256],64572:[[1603,1605],256],64573:[[1603,1609],256],64574:[[1603,1610],256],64575:[[1604,1580],256],64576:[[1604,1581],256],64577:[[1604,1582],256],64578:[[1604,1605],256],64579:[[1604,1609],256],64580:[[1604,1610],256],64581:[[1605,1580],256],64582:[[1605,1581],256],64583:[[1605,1582],256],64584:[[1605,1605],256],64585:[[1605,1609],256],64586:[[1605,1610],256],64587:[[1606,1580],256],64588:[[1606,1581],256],64589:[[1606,1582],256],64590:[[1606,1605],256],64591:[[1606,1609],256],64592:[[1606,1610],256],64593:[[1607,1580],256],64594:[[1607,1605],256],64595:[[1607,1609],256],64596:[[1607,1610],256],64597:[[1610,1580],256],64598:[[1610,1581],256],64599:[[1610,1582],256],64600:[[1610,1605],256],64601:[[1610,1609],256],64602:[[1610,1610],256],64603:[[1584,1648],256],64604:[[1585,1648],256],64605:[[1609,1648],256],64606:[[32,1612,1617],256],64607:[[32,1613,1617],256],64608:[[32,1614,1617],256],64609:[[32,1615,1617],256],64610:[[32,1616,1617],256],64611:[[32,1617,1648],256],64612:[[1574,1585],256],64613:[[1574,1586],256],64614:[[1574,1605],256],64615:[[1574,1606],256],64616:[[1574,1609],256],64617:[[1574,1610],256],64618:[[1576,1585],256],64619:[[1576,1586],256],64620:[[1576,1605],256],64621:[[1576,1606],256],64622:[[1576,1609],256],64623:[[1576,1610],256],64624:[[1578,1585],256],64625:[[1578,1586],256],64626:[[1578,1605],256],64627:[[1578,1606],256],64628:[[1578,1609],256],64629:[[1578,1610],256],64630:[[1579,1585],256],64631:[[1579,1586],256],64632:[[1579,1605],256],64633:[[1579,1606],256],64634:[[1579,1609],256],64635:[[1579,1610],256],64636:[[1601,1609],256],64637:[[1601,1610],256],64638:[[1602,1609],256],64639:[[1602,1610],256],64640:[[1603,1575],256],64641:[[1603,1604],256],64642:[[1603,1605],256],64643:[[1603,1609],256],64644:[[1603,1610],256],64645:[[1604,1605],256],64646:[[1604,1609],256],64647:[[1604,1610],256],64648:[[1605,1575],256],64649:[[1605,1605],256],64650:[[1606,1585],256],64651:[[1606,1586],256],64652:[[1606,1605],256],64653:[[1606,1606],256],64654:[[1606,1609],256],64655:[[1606,1610],256],64656:[[1609,1648],256],64657:[[1610,1585],256],64658:[[1610,1586],256],64659:[[1610,1605],256],64660:[[1610,1606],256],64661:[[1610,1609],256],64662:[[1610,1610],256],64663:[[1574,1580],256],64664:[[1574,1581],256],64665:[[1574,1582],256],64666:[[1574,1605],256],64667:[[1574,1607],256],64668:[[1576,1580],256],64669:[[1576,1581],256],64670:[[1576,1582],256],64671:[[1576,1605],256],64672:[[1576,1607],256],64673:[[1578,1580],256],64674:[[1578,1581],256],64675:[[1578,1582],256],64676:[[1578,1605],256],64677:[[1578,1607],256],64678:[[1579,1605],256],64679:[[1580,1581],256],64680:[[1580,1605],256],64681:[[1581,1580],256],64682:[[1581,1605],256],64683:[[1582,1580],256],64684:[[1582,1605],256],64685:[[1587,1580],256],64686:[[1587,1581],256],64687:[[1587,1582],256],64688:[[1587,1605],256],64689:[[1589,1581],256],64690:[[1589,1582],256],64691:[[1589,1605],256],64692:[[1590,1580],256],64693:[[1590,1581],256],64694:[[1590,1582],256],64695:[[1590,1605],256],64696:[[1591,1581],256],64697:[[1592,1605],256],64698:[[1593,1580],256],64699:[[1593,1605],256],64700:[[1594,1580],256],64701:[[1594,1605],256],64702:[[1601,1580],256],64703:[[1601,1581],256],64704:[[1601,1582],256],64705:[[1601,1605],256],64706:[[1602,1581],256],64707:[[1602,1605],256],64708:[[1603,1580],256],64709:[[1603,1581],256],64710:[[1603,1582],256],64711:[[1603,1604],256],64712:[[1603,1605],256],64713:[[1604,1580],256],64714:[[1604,1581],256],64715:[[1604,1582],256],64716:[[1604,1605],256],64717:[[1604,1607],256],64718:[[1605,1580],256],64719:[[1605,1581],256],64720:[[1605,1582],256],64721:[[1605,1605],256],64722:[[1606,1580],256],64723:[[1606,1581],256],64724:[[1606,1582],256],64725:[[1606,1605],256],64726:[[1606,1607],256],64727:[[1607,1580],256],64728:[[1607,1605],256],64729:[[1607,1648],256],64730:[[1610,1580],256],64731:[[1610,1581],256],64732:[[1610,1582],256],64733:[[1610,1605],256],64734:[[1610,1607],256],64735:[[1574,1605],256],64736:[[1574,1607],256],64737:[[1576,1605],256],64738:[[1576,1607],256],64739:[[1578,1605],256],64740:[[1578,1607],256],64741:[[1579,1605],256],64742:[[1579,1607],256],64743:[[1587,1605],256],64744:[[1587,1607],256],64745:[[1588,1605],256],64746:[[1588,1607],256],64747:[[1603,1604],256],64748:[[1603,1605],256],64749:[[1604,1605],256],64750:[[1606,1605],256],64751:[[1606,1607],256],64752:[[1610,1605],256],64753:[[1610,1607],256],64754:[[1600,1614,1617],256],64755:[[1600,1615,1617],256],64756:[[1600,1616,1617],256],64757:[[1591,1609],256],64758:[[1591,1610],256],64759:[[1593,1609],256],64760:[[1593,1610],256],64761:[[1594,1609],256],64762:[[1594,1610],256],64763:[[1587,1609],256],64764:[[1587,1610],256],64765:[[1588,1609],256],64766:[[1588,1610],256],64767:[[1581,1609],256]},64768:{64768:[[1581,1610],256],64769:[[1580,1609],256],64770:[[1580,1610],256],64771:[[1582,1609],256],64772:[[1582,1610],256],64773:[[1589,1609],256],64774:[[1589,1610],256],64775:[[1590,1609],256],64776:[[1590,1610],256],64777:[[1588,1580],256],64778:[[1588,1581],256],64779:[[1588,1582],256],64780:[[1588,1605],256],64781:[[1588,1585],256],64782:[[1587,1585],256],64783:[[1589,1585],256],64784:[[1590,1585],256],64785:[[1591,1609],256],64786:[[1591,1610],256],64787:[[1593,1609],256],64788:[[1593,1610],256],64789:[[1594,1609],256],64790:[[1594,1610],256],64791:[[1587,1609],256],64792:[[1587,1610],256],64793:[[1588,1609],256],64794:[[1588,1610],256],64795:[[1581,1609],256],64796:[[1581,1610],256],64797:[[1580,1609],256],64798:[[1580,1610],256],64799:[[1582,1609],256],64800:[[1582,1610],256],64801:[[1589,1609],256],64802:[[1589,1610],256],64803:[[1590,1609],256],64804:[[1590,1610],256],64805:[[1588,1580],256],64806:[[1588,1581],256],64807:[[1588,1582],256],64808:[[1588,1605],256],64809:[[1588,1585],256],64810:[[1587,1585],256],64811:[[1589,1585],256],64812:[[1590,1585],256],64813:[[1588,1580],256],64814:[[1588,1581],256],64815:[[1588,1582],256],64816:[[1588,1605],256],64817:[[1587,1607],256],64818:[[1588,1607],256],64819:[[1591,1605],256],64820:[[1587,1580],256],64821:[[1587,1581],256],64822:[[1587,1582],256],64823:[[1588,1580],256],64824:[[1588,1581],256],64825:[[1588,1582],256],64826:[[1591,1605],256],64827:[[1592,1605],256],64828:[[1575,1611],256],64829:[[1575,1611],256],64848:[[1578,1580,1605],256],64849:[[1578,1581,1580],256],64850:[[1578,1581,1580],256],64851:[[1578,1581,1605],256],64852:[[1578,1582,1605],256],64853:[[1578,1605,1580],256],64854:[[1578,1605,1581],256],64855:[[1578,1605,1582],256],64856:[[1580,1605,1581],256],64857:[[1580,1605,1581],256],64858:[[1581,1605,1610],256],64859:[[1581,1605,1609],256],64860:[[1587,1581,1580],256],64861:[[1587,1580,1581],256],64862:[[1587,1580,1609],256],64863:[[1587,1605,1581],256],64864:[[1587,1605,1581],256],64865:[[1587,1605,1580],256],64866:[[1587,1605,1605],256],64867:[[1587,1605,1605],256],64868:[[1589,1581,1581],256],64869:[[1589,1581,1581],256],64870:[[1589,1605,1605],256],64871:[[1588,1581,1605],256],64872:[[1588,1581,1605],256],64873:[[1588,1580,1610],256],64874:[[1588,1605,1582],256],64875:[[1588,1605,1582],256],64876:[[1588,1605,1605],256],64877:[[1588,1605,1605],256],64878:[[1590,1581,1609],256],64879:[[1590,1582,1605],256],64880:[[1590,1582,1605],256],64881:[[1591,1605,1581],256],64882:[[1591,1605,1581],256],64883:[[1591,1605,1605],256],64884:[[1591,1605,1610],256],64885:[[1593,1580,1605],256],64886:[[1593,1605,1605],256],64887:[[1593,1605,1605],256],64888:[[1593,1605,1609],256],64889:[[1594,1605,1605],256],64890:[[1594,1605,1610],256],64891:[[1594,1605,1609],256],64892:[[1601,1582,1605],256],64893:[[1601,1582,1605],256],64894:[[1602,1605,1581],256],64895:[[1602,1605,1605],256],64896:[[1604,1581,1605],256],64897:[[1604,1581,1610],256],64898:[[1604,1581,1609],256],64899:[[1604,1580,1580],256],64900:[[1604,1580,1580],256],64901:[[1604,1582,1605],256],64902:[[1604,1582,1605],256],64903:[[1604,1605,1581],256],64904:[[1604,1605,1581],256],64905:[[1605,1581,1580],256],64906:[[1605,1581,1605],256],64907:[[1605,1581,1610],256],64908:[[1605,1580,1581],256],64909:[[1605,1580,1605],256],64910:[[1605,1582,1580],256],64911:[[1605,1582,1605],256],64914:[[1605,1580,1582],256],64915:[[1607,1605,1580],256],64916:[[1607,1605,1605],256],64917:[[1606,1581,1605],256],64918:[[1606,1581,1609],256],64919:[[1606,1580,1605],256],64920:[[1606,1580,1605],256],64921:[[1606,1580,1609],256],64922:[[1606,1605,1610],256],64923:[[1606,1605,1609],256],64924:[[1610,1605,1605],256],64925:[[1610,1605,1605],256],64926:[[1576,1582,1610],256],64927:[[1578,1580,1610],256],64928:[[1578,1580,1609],256],64929:[[1578,1582,1610],256],64930:[[1578,1582,1609],256],64931:[[1578,1605,1610],256],64932:[[1578,1605,1609],256],64933:[[1580,1605,1610],256],64934:[[1580,1581,1609],256],64935:[[1580,1605,1609],256],64936:[[1587,1582,1609],256],64937:[[1589,1581,1610],256],64938:[[1588,1581,1610],256],64939:[[1590,1581,1610],256],64940:[[1604,1580,1610],256],64941:[[1604,1605,1610],256],64942:[[1610,1581,1610],256],64943:[[1610,1580,1610],256],64944:[[1610,1605,1610],256],64945:[[1605,1605,1610],256],64946:[[1602,1605,1610],256],64947:[[1606,1581,1610],256],64948:[[1602,1605,1581],256],64949:[[1604,1581,1605],256],64950:[[1593,1605,1610],256],64951:[[1603,1605,1610],256],64952:[[1606,1580,1581],256],64953:[[1605,1582,1610],256],64954:[[1604,1580,1605],256],64955:[[1603,1605,1605],256],64956:[[1604,1580,1605],256],64957:[[1606,1580,1581],256],64958:[[1580,1581,1610],256],64959:[[1581,1580,1610],256],64960:[[1605,1580,1610],256],64961:[[1601,1605,1610],256],64962:[[1576,1581,1610],256],64963:[[1603,1605,1605],256],64964:[[1593,1580,1605],256],64965:[[1589,1605,1605],256],64966:[[1587,1582,1610],256],64967:[[1606,1580,1610],256],65008:[[1589,1604,1746],256],65009:[[1602,1604,1746],256],65010:[[1575,1604,1604,1607],256],65011:[[1575,1603,1576,1585],256],65012:[[1605,1581,1605,1583],256],65013:[[1589,1604,1593,1605],256],65014:[[1585,1587,1608,1604],256],65015:[[1593,1604,1610,1607],256],65016:[[1608,1587,1604,1605],256],65017:[[1589,1604,1609],256],65018:[[1589,1604,1609,32,1575,1604,1604,1607,32,1593,1604,1610,1607,32,1608,1587,1604,1605],256],65019:[[1580,1604,32,1580,1604,1575,1604,1607],256],65020:[[1585,1740,1575,1604],256]},65024:{65040:[[44],256],65041:[[12289],256],65042:[[12290],256],65043:[[58],256],65044:[[59],256],65045:[[33],256],65046:[[63],256],65047:[[12310],256],65048:[[12311],256],65049:[[8230],256],65056:[,230],65057:[,230],65058:[,230],65059:[,230],65060:[,230],65061:[,230],65062:[,230],65063:[,220],65064:[,220],65065:[,220],65066:[,220],65067:[,220],65068:[,220],65069:[,220],65072:[[8229],256],65073:[[8212],256],65074:[[8211],256],65075:[[95],256],65076:[[95],256],65077:[[40],256],65078:[[41],256],65079:[[123],256],65080:[[125],256],65081:[[12308],256],65082:[[12309],256],65083:[[12304],256],65084:[[12305],256],65085:[[12298],256],65086:[[12299],256],65087:[[12296],256],65088:[[12297],256],65089:[[12300],256],65090:[[12301],256],65091:[[12302],256],65092:[[12303],256],65095:[[91],256],65096:[[93],256],65097:[[8254],256],65098:[[8254],256],65099:[[8254],256],65100:[[8254],256],65101:[[95],256],65102:[[95],256],65103:[[95],256],65104:[[44],256],65105:[[12289],256],65106:[[46],256],65108:[[59],256],65109:[[58],256],65110:[[63],256],65111:[[33],256],65112:[[8212],256],65113:[[40],256],65114:[[41],256],65115:[[123],256],65116:[[125],256],65117:[[12308],256],65118:[[12309],256],65119:[[35],256],65120:[[38],256],65121:[[42],256],65122:[[43],256],65123:[[45],256],65124:[[60],256],65125:[[62],256],65126:[[61],256],65128:[[92],256],65129:[[36],256],65130:[[37],256],65131:[[64],256],65136:[[32,1611],256],65137:[[1600,1611],256],65138:[[32,1612],256],65140:[[32,1613],256],65142:[[32,1614],256],65143:[[1600,1614],256],65144:[[32,1615],256],65145:[[1600,1615],256],65146:[[32,1616],256],65147:[[1600,1616],256],65148:[[32,1617],256],65149:[[1600,1617],256],65150:[[32,1618],256],65151:[[1600,1618],256],65152:[[1569],256],65153:[[1570],256],65154:[[1570],256],65155:[[1571],256],65156:[[1571],256],65157:[[1572],256],65158:[[1572],256],65159:[[1573],256],65160:[[1573],256],65161:[[1574],256],65162:[[1574],256],65163:[[1574],256],65164:[[1574],256],65165:[[1575],256],65166:[[1575],256],65167:[[1576],256],65168:[[1576],256],65169:[[1576],256],65170:[[1576],256],65171:[[1577],256],65172:[[1577],256],65173:[[1578],256],65174:[[1578],256],65175:[[1578],256],65176:[[1578],256],65177:[[1579],256],65178:[[1579],256],65179:[[1579],256],65180:[[1579],256],65181:[[1580],256],65182:[[1580],256],65183:[[1580],256],65184:[[1580],256],65185:[[1581],256],65186:[[1581],256],65187:[[1581],256],65188:[[1581],256],65189:[[1582],256],65190:[[1582],256],65191:[[1582],256],65192:[[1582],256],65193:[[1583],256],65194:[[1583],256],65195:[[1584],256],65196:[[1584],256],65197:[[1585],256],65198:[[1585],256],65199:[[1586],256],65200:[[1586],256],65201:[[1587],256],65202:[[1587],256],65203:[[1587],256],65204:[[1587],256],65205:[[1588],256],65206:[[1588],256],65207:[[1588],256],65208:[[1588],256],65209:[[1589],256],65210:[[1589],256],65211:[[1589],256],65212:[[1589],256],65213:[[1590],256],65214:[[1590],256],65215:[[1590],256],65216:[[1590],256],65217:[[1591],256],65218:[[1591],256],65219:[[1591],256],65220:[[1591],256],65221:[[1592],256],65222:[[1592],256],65223:[[1592],256],65224:[[1592],256],65225:[[1593],256],65226:[[1593],256],65227:[[1593],256],65228:[[1593],256],65229:[[1594],256],65230:[[1594],256],65231:[[1594],256],65232:[[1594],256],65233:[[1601],256],65234:[[1601],256],65235:[[1601],256],65236:[[1601],256],65237:[[1602],256],65238:[[1602],256],65239:[[1602],256],65240:[[1602],256],65241:[[1603],256],65242:[[1603],256],65243:[[1603],256],65244:[[1603],256],65245:[[1604],256],65246:[[1604],256],65247:[[1604],256],65248:[[1604],256],65249:[[1605],256],65250:[[1605],256],65251:[[1605],256],65252:[[1605],256],65253:[[1606],256],65254:[[1606],256],65255:[[1606],256],65256:[[1606],256],65257:[[1607],256],65258:[[1607],256],65259:[[1607],256],65260:[[1607],256],65261:[[1608],256],65262:[[1608],256],65263:[[1609],256],65264:[[1609],256],65265:[[1610],256],65266:[[1610],256],65267:[[1610],256],65268:[[1610],256],65269:[[1604,1570],256],65270:[[1604,1570],256],65271:[[1604,1571],256],65272:[[1604,1571],256],65273:[[1604,1573],256],65274:[[1604,1573],256],65275:[[1604,1575],256],65276:[[1604,1575],256]},65280:{65281:[[33],256],65282:[[34],256],65283:[[35],256],65284:[[36],256],65285:[[37],256],65286:[[38],256],65287:[[39],256],65288:[[40],256],65289:[[41],256],65290:[[42],256],65291:[[43],256],65292:[[44],256],65293:[[45],256],65294:[[46],256],65295:[[47],256],65296:[[48],256],65297:[[49],256],65298:[[50],256],65299:[[51],256],65300:[[52],256],65301:[[53],256],65302:[[54],256],65303:[[55],256],65304:[[56],256],65305:[[57],256],65306:[[58],256],65307:[[59],256],65308:[[60],256],65309:[[61],256],65310:[[62],256],65311:[[63],256],65312:[[64],256],65313:[[65],256],65314:[[66],256],65315:[[67],256],65316:[[68],256],65317:[[69],256],65318:[[70],256],65319:[[71],256],65320:[[72],256],65321:[[73],256],65322:[[74],256],65323:[[75],256],65324:[[76],256],65325:[[77],256],65326:[[78],256],65327:[[79],256],65328:[[80],256],65329:[[81],256],65330:[[82],256],65331:[[83],256],65332:[[84],256],65333:[[85],256],65334:[[86],256],65335:[[87],256],65336:[[88],256],65337:[[89],256],65338:[[90],256],65339:[[91],256],65340:[[92],256],65341:[[93],256],65342:[[94],256],65343:[[95],256],65344:[[96],256],65345:[[97],256],65346:[[98],256],65347:[[99],256],65348:[[100],256],65349:[[101],256],65350:[[102],256],65351:[[103],256],65352:[[104],256],65353:[[105],256],65354:[[106],256],65355:[[107],256],65356:[[108],256],65357:[[109],256],65358:[[110],256],65359:[[111],256],65360:[[112],256],65361:[[113],256],65362:[[114],256],65363:[[115],256],65364:[[116],256],65365:[[117],256],65366:[[118],256],65367:[[119],256],65368:[[120],256],65369:[[121],256],65370:[[122],256],65371:[[123],256],65372:[[124],256],65373:[[125],256],65374:[[126],256],65375:[[10629],256],65376:[[10630],256],65377:[[12290],256],65378:[[12300],256],65379:[[12301],256],65380:[[12289],256],65381:[[12539],256],65382:[[12530],256],65383:[[12449],256],65384:[[12451],256],65385:[[12453],256],65386:[[12455],256],65387:[[12457],256],65388:[[12515],256],65389:[[12517],256],65390:[[12519],256],65391:[[12483],256],65392:[[12540],256],65393:[[12450],256],65394:[[12452],256],65395:[[12454],256],65396:[[12456],256],65397:[[12458],256],65398:[[12459],256],65399:[[12461],256],65400:[[12463],256],65401:[[12465],256],65402:[[12467],256],65403:[[12469],256],65404:[[12471],256],65405:[[12473],256],65406:[[12475],256],65407:[[12477],256],65408:[[12479],256],65409:[[12481],256],65410:[[12484],256],65411:[[12486],256],65412:[[12488],256],65413:[[12490],256],65414:[[12491],256],65415:[[12492],256],65416:[[12493],256],65417:[[12494],256],65418:[[12495],256],65419:[[12498],256],65420:[[12501],256],65421:[[12504],256],65422:[[12507],256],65423:[[12510],256],65424:[[12511],256],65425:[[12512],256],65426:[[12513],256],65427:[[12514],256],65428:[[12516],256],65429:[[12518],256],65430:[[12520],256],65431:[[12521],256],65432:[[12522],256],65433:[[12523],256],65434:[[12524],256],65435:[[12525],256],65436:[[12527],256],65437:[[12531],256],65438:[[12441],256],65439:[[12442],256],65440:[[12644],256],65441:[[12593],256],65442:[[12594],256],65443:[[12595],256],65444:[[12596],256],65445:[[12597],256],65446:[[12598],256],65447:[[12599],256],65448:[[12600],256],65449:[[12601],256],65450:[[12602],256],65451:[[12603],256],65452:[[12604],256],65453:[[12605],256],65454:[[12606],256],65455:[[12607],256],65456:[[12608],256],65457:[[12609],256],65458:[[12610],256],65459:[[12611],256],65460:[[12612],256],65461:[[12613],256],65462:[[12614],256],65463:[[12615],256],65464:[[12616],256],65465:[[12617],256],65466:[[12618],256],65467:[[12619],256],65468:[[12620],256],65469:[[12621],256],65470:[[12622],256],65474:[[12623],256],65475:[[12624],256],65476:[[12625],256],65477:[[12626],256],65478:[[12627],256],65479:[[12628],256],65482:[[12629],256],65483:[[12630],256],65484:[[12631],256],65485:[[12632],256],65486:[[12633],256],65487:[[12634],256],65490:[[12635],256],65491:[[12636],256],65492:[[12637],256],65493:[[12638],256],65494:[[12639],256],65495:[[12640],256],65498:[[12641],256],65499:[[12642],256],65500:[[12643],256],65504:[[162],256],65505:[[163],256],65506:[[172],256],65507:[[175],256],65508:[[166],256],65509:[[165],256],65510:[[8361],256],65512:[[9474],256],65513:[[8592],256],65514:[[8593],256],65515:[[8594],256],65516:[[8595],256],65517:[[9632],256],65518:[[9675],256]}};var ks={nfc:$s,nfd:Os,nfkc:Rs,nfkd:Ps};ss.exports=ks,ks.shimApplied=!1,String.prototype.normalize||(Object.defineProperty(String.prototype,"normalize",{enumerable:!1,configurable:!0,writable:!0,value:function(){var Bs=""+this,Us=arguments[0]===void 0?"NFC":arguments[0];if(this===null||this===void 0)throw new TypeError("Cannot call method on "+Object.prototype.toString.call(this));if(Us==="NFC")return ks.nfc(Bs);if(Us==="NFD")return ks.nfd(Bs);if(Us==="NFKC")return ks.nfkc(Bs);if(Us==="NFKD")return ks.nfkd(Bs);throw new RangeError("Invalid normalization form: "+Us)}}),ks.shimApplied=!0)})()})(unorm$1);var unorm=unormExports;/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function collatorFromConfig(ss){const ts=ss.caseSensitive?ss.accentSensitive?"variant":"case":ss.accentSensitive?"accent":"base",rs=ss.caseFirst,ns=ss.ignorePunctuation;return new Intl.Collator(ss.localeLang,{sensitivity:ts,caseFirst:rs,ignorePunctuation:ns})}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const EmptyValue=Symbol("Empty value");function getRawValue(ss){return ss instanceof RichNumber?ss.val:ss}class RichNumber{constructor(ts,rs){this.val=ts,this.format=rs}fromNumber(ts){return new this.constructor(ts)}}function cloneNumber(ss,ts){if(typeof ss=="number")return ts;{const rs=ss.fromNumber(ts);return rs.format=ss.format,rs}}class DateNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_DATE}}class CurrencyNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_CURRENCY}}class TimeNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_TIME}}class DateTimeNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_DATETIME}}class PercentNumber extends RichNumber{getDetailedType(){return NumberType.NUMBER_PERCENT}}function isExtendedNumber(ss){return typeof ss=="number"||ss instanceof RichNumber}var NumberType;(function(ss){ss.NUMBER_RAW="NUMBER_RAW",ss.NUMBER_DATE="NUMBER_DATE",ss.NUMBER_TIME="NUMBER_TIME",ss.NUMBER_DATETIME="NUMBER_DATETIME",ss.NUMBER_CURRENCY="NUMBER_CURRENCY",ss.NUMBER_PERCENT="NUMBER_PERCENT"})(NumberType||(NumberType={}));function getTypeOfExtendedNumber(ss){return ss instanceof RichNumber?ss.getDetailedType():NumberType.NUMBER_RAW}function getFormatOfExtendedNumber(ss){if(ss instanceof RichNumber)return ss.format}function getTypeFormatOfExtendedNumber(ss){return ss instanceof RichNumber?{type:ss.getDetailedType(),format:ss.format}:{type:NumberType.NUMBER_RAW}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const COMPLEX_NUMBER_SYMBOL="i",complexParsingRegexp=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;class ArithmeticHelper{constructor(ts,rs,ns){this.config=ts,this.dateTimeHelper=rs,this.numberLiteralsHelper=ns,this.lt=(is,as)=>this.compare(is,as)<0,this.leq=(is,as)=>this.compare(is,as)<=0,this.gt=(is,as)=>this.compare(is,as)>0,this.geq=(is,as)=>this.compare(is,as)>=0,this.eq=(is,as)=>this.compare(is,as)===0,this.neq=(is,as)=>this.compare(is,as)!==0,this.pow=(is,as)=>Math.pow(getRawValue(is),getRawValue(as)),this.addWithEpsilonRaw=(is,as)=>{const os=is+as;return Math.abs(os)<this.actualEps*Math.abs(is)?0:os},this.addWithEpsilon=(is,as)=>{const os=inferExtendedNumberTypeAdditive(is,as);return this.ExtendedNumberFactory(this.addWithEpsilonRaw(getRawValue(is),getRawValue(as)),os)},this.unaryMinus=is=>cloneNumber(is,-getRawValue(is)),this.unaryPlus=is=>is,this.unaryPercent=is=>new PercentNumber(getRawValue(is)/100),this.concat=(is,as)=>is.concat(as),this.nonstrictadd=(is,as)=>is instanceof CellError?is:as instanceof CellError?as:typeof is=="number"?typeof as=="number"?this.addWithEpsilonRaw(is,as):is:typeof as=="number"?as:0,this.subtract=(is,as)=>{const os=inferExtendedNumberTypeAdditive(is,as),ls=getRawValue(is),us=getRawValue(as);let cs=ls-us;return Math.abs(cs)<this.actualEps*Math.abs(ls)&&(cs=0),this.ExtendedNumberFactory(cs,os)},this.divide=(is,as)=>{const os=getRawValue(is),ls=getRawValue(as);if(ls===0)return new CellError(ErrorType.DIV_BY_ZERO);{const us=inferExtendedNumberTypeMultiplicative(is,as);return this.ExtendedNumberFactory(os/ls,us)}},this.multiply=(is,as)=>{const os=inferExtendedNumberTypeMultiplicative(is,as);return this.ExtendedNumberFactory(getRawValue(is)*getRawValue(as),os)},this.manyToExactComplex=is=>{const as=[];for(const os of is){if(os instanceof CellError)return os;if(isExtendedNumber(os)||typeof os=="string"){const ls=this.coerceScalarToComplex(os);ls instanceof CellError||as.push(ls)}}return as},this.coerceNumbersExactRanges=is=>this.manyToNumbers(is,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=is=>this.manyToNumbers(is,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=is=>{const as=[];for(const os of is){if(os instanceof CellError)return os;isExtendedNumber(os)&&as.push(getRawValue(os))}return as},this.manyToOnlyNumbersDropNulls=is=>{const as=[];for(const os of is){if(os instanceof CellError)return os;if(isExtendedNumber(os))as.push(getRawValue(os));else if(os!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}return as},this.manyToCoercedNumbersDropNulls=is=>{const as=[];for(const os of is){if(os instanceof CellError)return os;if(os===EmptyValue)continue;const ls=this.coerceScalarToNumberOrError(os);isExtendedNumber(ls)&&as.push(getRawValue(ls))}return as},this.collator=collatorFromConfig(ts),this.actualEps=ts.smartRounding?ts.precisionEpsilon:0}eqMatcherFunction(ts){const rs=this.buildRegex(ts);return ns=>typeof ns=="string"&&rs.test(this.normalizeString(ns))}neqMatcherFunction(ts){const rs=this.buildRegex(ts);return ns=>typeof ns!="string"||!rs.test(this.normalizeString(ns))}searchString(ts,rs){var ns;const as=this.buildRegex(ts,!1).exec(rs);return(ns=as==null?void 0:as.index)!==null&&ns!==void 0?ns:-1}requiresRegex(ts){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let rs=0;rs<ts.length;rs++){const ns=ts.charAt(rs);if(isWildcard(ns)||this.config.useRegularExpressions&&needsEscape(ns))return!0}return!1}floatCmp(ts,rs){const ns=getRawValue(ts),is=getRawValue(rs),as=1+this.actualEps;return is>=0&&ns*as>=is&&ns<=is*as||is<=0&&ns*as<=is&&ns>=is*as?0:ns>is?1:-1}coerceScalarToNumberOrError(ts){var rs;return ts instanceof CellError?ts:(rs=this.coerceToMaybeNumber(ts))!==null&&rs!==void 0?rs:new CellError(ErrorType.VALUE,ErrorMessage.NumberCoercion)}coerceToMaybeNumber(ts){var rs;return(rs=this.coerceNonDateScalarToMaybeNumber(ts))!==null&&rs!==void 0?rs:typeof ts=="string"?this.dateTimeHelper.dateStringToDateNumber(ts):void 0}coerceNonDateScalarToMaybeNumber(ts){if(ts===EmptyValue)return 0;if(typeof ts=="string"){if(ts==="")return 0;const rs=this.coerceStringToMaybePercentNumber(ts);if(rs!==void 0)return rs;const ns=this.coerceStringToMaybeCurrencyNumber(ts);return ns!==void 0?ns:this.numberLiteralsHelper.numericStringToMaybeNumber(ts.trim())}else return isExtendedNumber(ts)?ts:typeof ts=="boolean"?Number(ts):void 0}coerceStringToMaybePercentNumber(ts){const rs=ts.trim();if(rs.endsWith("%")){const ns=rs.slice(0,rs.length-1).trim(),is=this.numberLiteralsHelper.numericStringToMaybeNumber(ns);if(is!==void 0)return new PercentNumber(is/100)}}coerceStringToMaybeCurrencyNumber(ts){const rs=this.currencyMatcher(ts.trim());if(rs!==void 0){const[ns,is]=rs,as=this.numberLiteralsHelper.numericStringToMaybeNumber(is);if(as!==void 0)return new CurrencyNumber(as,ns)}}currencyMatcher(ts){for(const rs of this.config.currencySymbol){if(ts.startsWith(rs))return[rs,ts.slice(rs.length).trim()];if(ts.endsWith(rs))return[rs,ts.slice(0,ts.length-rs.length).trim()]}}coerceComplexExactRanges(ts){const rs=[];for(const is of ts)if(is instanceof SimpleRangeValue)rs.push(is);else if(is!==EmptyValue){const as=this.coerceScalarToComplex(is);if(as instanceof CellError)return as;rs.push(as)}const ns=[];for(const is of rs)if(is instanceof SimpleRangeValue){const as=this.manyToExactComplex(is.valuesFromTopLeftCorner());if(as instanceof CellError)return as;ns.push(...as)}else ns.push(is);return ns}coerceScalarToComplex(ts){return ts instanceof CellError?ts:ts===EmptyValue?[0,0]:isExtendedNumber(ts)?[getRawValue(ts),0]:typeof ts=="string"?this.coerceStringToComplex(ts):new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected)}ExtendedNumberFactory(ts,rs){const{type:ns,format:is}=rs;switch(ns){case NumberType.NUMBER_RAW:return ts;case NumberType.NUMBER_CURRENCY:return new CurrencyNumber(ts,is??this.config.currencySymbol[0]);case NumberType.NUMBER_DATE:return new DateNumber(ts,is);case NumberType.NUMBER_DATETIME:return new DateTimeNumber(ts,is);case NumberType.NUMBER_TIME:return new TimeNumber(ts,is);case NumberType.NUMBER_PERCENT:return new PercentNumber(ts,is)}}buildRegex(ts,rs=!0){ts=this.normalizeString(ts);let ns,is=this.config.useWildcards,as=this.config.useRegularExpressions;if(as)try{RegExp(ts)}catch{as=!1,is=!1}return as?ns=escapeNoCharacters(ts,this.config.caseSensitive):is?ns=escapeNonWildcards(ts,this.config.caseSensitive):ns=escapeAllCharacters(ts,this.config.caseSensitive),this.config.matchWholeCell&&rs?RegExp("^("+ns+")$"):RegExp(ns)}normalizeString(ts){return this.config.caseSensitive||(ts=ts.toLowerCase()),this.config.accentSensitive||(ts=normalizeString(ts,"nfd").replace(/[\u0300-\u036f]/g,"")),ts}compare(ts,rs){if(typeof ts=="string"||typeof rs=="string"){const ns=typeof ts=="string"?this.dateTimeHelper.dateStringToDateNumber(ts):ts,is=typeof rs=="string"?this.dateTimeHelper.dateStringToDateNumber(rs):rs;if(isExtendedNumber(ns)&&isExtendedNumber(is))return this.floatCmp(ns,is)}return ts===EmptyValue?ts=coerceEmptyToValue(rs):rs===EmptyValue&&(rs=coerceEmptyToValue(ts)),typeof ts=="string"&&typeof rs=="string"?this.stringCmp(ts,rs):typeof ts=="boolean"&&typeof rs=="boolean"?numberCmp(coerceBooleanToNumber(ts),coerceBooleanToNumber(rs)):isExtendedNumber(ts)&&isExtendedNumber(rs)?this.floatCmp(ts,rs):ts===EmptyValue&&rs===EmptyValue?0:numberCmp(CellValueTypeOrd(getCellValueType(ts)),CellValueTypeOrd(getCellValueType(rs)))}stringCmp(ts,rs){return this.collator.compare(ts,rs)}manyToNumbers(ts,rs){const ns=[];for(const as of ts)if(as instanceof SimpleRangeValue)ns.push(as);else{const os=getRawValue(this.coerceScalarToNumberOrError(as));if(os instanceof CellError)return os;ns.push(os)}const is=[];for(const as of ns)if(as instanceof SimpleRangeValue){const os=rs(as.valuesFromTopLeftCorner());if(os instanceof CellError)return os;is.push(...os)}else is.push(as);return is}coerceStringToComplex(ts){const rs=complexParsingRegexp.exec(ts);if(rs===null)return new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected);let ns;if(rs[6]!==void 0?ns=rs[1]==="-"?[0,-1]:[0,1]:ns=this.parseComplexToken(rs[1]+rs[3],rs[5]),ns instanceof CellError||rs[8]===void 0)return ns;let is;return rs[14]!==void 0?is=rs[9]==="-"?[0,-1]:[0,1]:is=this.parseComplexToken(rs[9]+rs[11],rs[13]),is instanceof CellError?is:rs[5]!==""||rs[13]===""?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):rs[8]==="+"?[ns[0]+is[0],ns[1]+is[1]]:[ns[0]-is[0],ns[1]-is[1]]}parseComplexToken(ts,rs){const ns=getRawValue(this.coerceNonDateScalarToMaybeNumber(ts));return ns===void 0?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):rs===""?[ns,0]:[0,ns]}}function coerceComplexToString([ss,ts],rs){if(!isFinite(ss)||!isFinite(ts))return new CellError(ErrorType.NUM,ErrorMessage.NaN);if(rs=rs??COMPLEX_NUMBER_SYMBOL,ts===0)return`${ss}`;const ns=`${ts===-1||ts===1?"":Math.abs(ts)}${rs}`;return ss===0?`${ts<0?"-":""}${ns}`:`${ss}${ts<0?"-":"+"}${ns}`}function coerceToRange(ss){return ss instanceof SimpleRangeValue?ss:SimpleRangeValue.fromScalar(ss)}function coerceBooleanToNumber(ss){return Number(ss)}function coerceEmptyToValue(ss){return typeof ss=="string"?"":isExtendedNumber(ss)?0:typeof ss=="boolean"?!1:EmptyValue}function coerceScalarToBoolean(ss){if(ss instanceof CellError||typeof ss=="boolean")return ss;if(ss===EmptyValue)return!1;if(isExtendedNumber(ss))return getRawValue(ss)!==0;{const ts=ss.toUpperCase();return ts==="TRUE"?!0:ts==="FALSE"||ts===""?!1:void 0}}function coerceScalarToString(ss){return ss instanceof CellError||typeof ss=="string"?ss:ss===EmptyValue?"":isExtendedNumber(ss)?getRawValue(ss).toString():ss?"TRUE":"FALSE"}function zeroIfEmpty(ss){return ss===EmptyValue?0:ss}function numberCmp(ss,ts){const rs=getRawValue(ss),ns=getRawValue(ts);return rs>ns?1:rs<ns?-1:0}function isNumberOverflow(ss){return isNaN(ss)||ss===1/0||ss===-1/0}function fixNegativeZero(ss){return ss===0?0:ss}function isWildcard(ss){return["*","?"].includes(ss)}const escapedCharacters=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function needsEscape(ss){return escapedCharacters.includes(ss)}function escapeNonWildcards(ss,ts){let rs="";for(let ns=0;ns<ss.length;ns++){const is=ss.charAt(ns);if(is==="~"){if(ns==ss.length-1){rs+="~";continue}const as=ss.charAt(ns+1);isWildcard(as)||needsEscape(as)?(rs+="\\"+as,ns++):(rs+=as,ns++)}else isWildcard(is)?rs+="."+is:needsEscape(is)?rs+="\\"+is:ts?rs+=is:rs+=is.toLowerCase()}return rs}function escapeAllCharacters(ss,ts){let rs="";for(let ns=0;ns<ss.length;ns++){const is=ss.charAt(ns);isWildcard(is)||needsEscape(is)?rs+="\\"+is:ts?rs+=is:rs+=is.toLowerCase()}return rs}function escapeNoCharacters(ss,ts){let rs="";for(let ns=0;ns<ss.length;ns++){const is=ss.charAt(ns);isWildcard(is)||needsEscape(is)||ts?rs+=is:rs+=is.toLowerCase()}return rs}function inferExtendedNumberTypeAdditive(ss,ts){const{type:rs,format:ns}=getTypeFormatOfExtendedNumber(ss),{type:is,format:as}=getTypeFormatOfExtendedNumber(ts);if(rs===NumberType.NUMBER_RAW)return{type:is,format:as};if(is===NumberType.NUMBER_RAW)return{type:rs,format:ns};if((rs===NumberType.NUMBER_DATETIME||rs===NumberType.NUMBER_DATE)&&(is===NumberType.NUMBER_DATETIME||is===NumberType.NUMBER_DATE))return{type:NumberType.NUMBER_RAW};if(rs===NumberType.NUMBER_TIME){if(is===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:as+" "+ns};if(is===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:as}}if(is===NumberType.NUMBER_TIME){if(rs===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:ns+" "+as};if(rs===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:ns}}return{type:rs,format:ns}}function inferExtendedNumberTypeMultiplicative(ss,ts){let{type:rs,format:ns}=getTypeFormatOfExtendedNumber(ss),{type:is,format:as}=getTypeFormatOfExtendedNumber(ts);return rs===NumberType.NUMBER_PERCENT&&(rs=NumberType.NUMBER_RAW,ns=void 0),is===NumberType.NUMBER_PERCENT&&(is=NumberType.NUMBER_RAW,as=void 0),rs===NumberType.NUMBER_RAW?{type:is,format:as}:is===NumberType.NUMBER_RAW?{type:rs,format:ns}:{type:NumberType.NUMBER_RAW}}function forceNormalizeString(ss){return normalizeString(ss.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function coerceRangeToScalar(ss,ts){var rs;if(ss.isAdHoc())return(rs=ss.data[0])===null||rs===void 0?void 0:rs[0];const ns=ss.range;if(ts.formulaAddress.sheet===ns.sheet){if(ns.width()===1){const is=ts.formulaAddress.row-ns.start.row;if(is>=0&&is<ns.height())return ss.data[is][0]}else if(ns.height()===1){const is=ts.formulaAddress.col-ns.start.col;if(is>=0&&is<ns.width())return ss.data[0][is]}}}function normalizeString(ss,ts){return typeof ss.normalize=="function"?ss.normalize(ts.toUpperCase()):unorm[ts](ss)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var ArgumentTypes;(function(ss){ss.STRING="STRING",ss.NUMBER="NUMBER",ss.BOOLEAN="BOOLEAN",ss.SCALAR="SCALAR",ss.NOERROR="NOERROR",ss.RANGE="RANGE",ss.INTEGER="INTEGER",ss.COMPLEX="COMPLEX",ss.ANY="ANY"})(ArgumentTypes||(ArgumentTypes={}));class FunctionPlugin{constructor(ts){this.coerceScalarToNumberOrError=rs=>this.arithmeticHelper.coerceScalarToNumberOrError(rs),this.runFunction=(rs,ns,is,as)=>{var os,ls,us,cs,ps;let ds=is.parameters||[],fs;if(is.expandRanges?fs=this.listOfScalarValues(rs,ns):fs=rs.map(bs=>[this.evaluateAst(bs,ns),!1]),is.repeatLastArgs===void 0&&ds.length<fs.length)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(is.repeatLastArgs!==void 0&&ds.length<fs.length&&(fs.length-ds.length)%is.repeatLastArgs!==0)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);for(ds=[...ds];ds.length<fs.length;)ds.push(...ds.slice(ds.length-is.repeatLastArgs));let hs=1,ys=1;if(!is.vectorizationForbidden&&ns.arraysFlag)for(let bs=0;bs<fs.length;bs++){const[vs]=fs[bs];vs instanceof SimpleRangeValue&&ds[bs].argumentType!==ArgumentTypes.RANGE&&ds[bs].argumentType!==ArgumentTypes.ANY&&(ys=Math.max(ys,vs.height()),hs=Math.max(hs,vs.width()))}for(let bs=fs.length;bs<ds.length;bs++)if(((os=ds[bs])===null||os===void 0?void 0:os.defaultValue)===void 0&&!(!((ls=ds[bs])===null||ls===void 0)&&ls.optionalArg))return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);const gs=[];for(let bs=0;bs<ys;bs++){const vs=[];for(let Ns=0;Ns<hs;Ns++){let Ts;const Cs=[];for(let As=0;As<ds.length;As++){let[ws,Es]=(us=fs[As])!==null&&us!==void 0?us:[void 0,void 0];ws instanceof SimpleRangeValue&&ds[As].argumentType!==ArgumentTypes.RANGE&&ds[As].argumentType!==ArgumentTypes.ANY&&!is.vectorizationForbidden&&ns.arraysFlag&&(ws=(cs=ws.data[ws.height()!==1?bs:0])===null||cs===void 0?void 0:cs[ws.width()!==1?Ns:0]);const Ss=ws??((ps=ds[As])===null||ps===void 0?void 0:ps.defaultValue);if(Ss===void 0)Cs.push(void 0);else{const Ds=ws!==void 0?this.coerceToType(Ss,ds[As],ns):Ss;Ds!==void 0?(Ds instanceof CellError&&ds[As].argumentType!==ArgumentTypes.SCALAR&&(Ts=Ts??Ds),Cs.push(Ds)):Es||(Ts=Ts??new CellError(ErrorType.VALUE,ErrorMessage.WrongType))}}const xs=Ts??this.returnNumberWrapper(as(...Cs),is.returnNumberType);if(ys===1&&hs===1)return xs;if(xs instanceof SimpleRangeValue)throw"Function returning array cannot be vectorized.";vs.push(xs)}gs.push(vs)}return SimpleRangeValue.onlyValues(gs)},this.runFunctionWithReferenceArgument=(rs,ns,is,as,os,ls=()=>new CellError(ErrorType.NA,ErrorMessage.CellRefExpected))=>{if(rs.length===0)return this.returnNumberWrapper(as(),is.returnNumberType);if(rs.length>1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);let us=rs[0];for(;us.type===AstNodeType.PARENTHESIS;)us=us.expression;let cs;if(us.type===AstNodeType.CELL_REFERENCE)cs=us.reference.toSimpleCellAddress(ns.formulaAddress);else if(us.type===AstNodeType.CELL_RANGE||us.type===AstNodeType.COLUMN_RANGE||us.type===AstNodeType.ROW_RANGE)try{cs=AbsoluteCellRange.fromAst(us,ns.formulaAddress).start}catch{return new CellError(ErrorType.REF,ErrorMessage.CellRefExpected)}return cs!==void 0?this.returnNumberWrapper(os(cs),is.returnNumberType):this.runFunction(rs,ns,is,ls)},this.interpreter=ts,this.dependencyGraph=ts.dependencyGraph,this.columnSearch=ts.columnSearch,this.config=ts.config,this.serialization=ts.serialization,this.arraySizePredictor=ts.arraySizePredictor,this.dateTimeHelper=ts.dateTimeHelper,this.arithmeticHelper=ts.arithmeticHelper}evaluateAst(ts,rs){return this.interpreter.evaluateAst(ts,rs)}arraySizeForAst(ts,rs){return this.arraySizePredictor.checkArraySizeForAst(ts,rs)}listOfScalarValues(ts,rs){const ns=[];for(const is of ts){const as=this.evaluateAst(is,rs);if(as instanceof SimpleRangeValue)for(const os of as.valuesFromTopLeftCorner())ns.push([os,!0]);else ns.push([as,!1])}return ns}coerceToType(ts,rs,ns){let is;if(ts instanceof SimpleRangeValue)switch(rs.argumentType){case ArgumentTypes.RANGE:case ArgumentTypes.ANY:is=ts;break;default:{const as=coerceRangeToScalar(ts,ns);if(as===void 0)return;ts=as}}if(!(ts instanceof SimpleRangeValue))switch(rs.argumentType){case ArgumentTypes.INTEGER:case ArgumentTypes.NUMBER:const as=this.coerceScalarToNumberOrError(ts);if(!isExtendedNumber(as)){is=as;break}const os=getRawValue(as);if(rs.maxValue!==void 0&&os>rs.maxValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(rs.minValue!==void 0&&os<rs.minValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(rs.lessThan!==void 0&&os>=rs.lessThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(rs.greaterThan!==void 0&&os<=rs.greaterThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(rs.argumentType===ArgumentTypes.INTEGER&&!Number.isInteger(os))return new CellError(ErrorType.NUM,ErrorMessage.IntegerExpected);is=as;break;case ArgumentTypes.STRING:is=coerceScalarToString(ts);break;case ArgumentTypes.BOOLEAN:is=coerceScalarToBoolean(ts);break;case ArgumentTypes.SCALAR:case ArgumentTypes.NOERROR:case ArgumentTypes.ANY:is=ts;break;case ArgumentTypes.RANGE:if(ts instanceof CellError)return ts;is=coerceToRange(ts);break;case ArgumentTypes.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(getRawValue(ts))}return rs.passSubtype||is===void 0?is:getRawValue(is)}metadata(ts){const rs=this.constructor.implementedFunctions[ts];if(rs!==void 0)return rs;throw new Error(`No metadata for function ${ts}.`)}returnNumberWrapper(ts,rs,ns){return rs!==void 0&&isExtendedNumber(ts)?this.arithmeticHelper.ExtendedNumberFactory(getRawValue(ts),{type:rs,format:ns}):ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ArraySize{constructor(ts,rs,ns=!1){if(this.width=ts,this.height=rs,this.isRef=ns,ts<=0||rs<=0)throw Error("Incorrect array size")}static fromArray(ts){return new ArraySize(ts.length>0?ts[0].length:0,ts.length)}static error(){return new ArraySize(1,1,!0)}static scalar(){return new ArraySize(1,1,!1)}isScalar(){return this.width<=1&&this.height<=1||this.isRef}}function arraySizeForBinaryOp(ss,ts){return new ArraySize(Math.max(ss.width,ts.width),Math.max(ss.height,ts.height))}function arraySizeForUnaryOp(ss){return new ArraySize(ss.width,ss.height)}class ArraySizePredictor{constructor(ts,rs){this.config=ts,this.functionRegistry=rs}checkArraySize(ts,rs){return this.checkArraySizeForAst(ts,{formulaAddress:rs,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(ts,rs){switch(ts.type){case AstNodeType.FUNCTION_CALL:return this.checkArraySizeForFunction(ts,rs);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:{const ns=AbsoluteCellRange.fromAstOrUndef(ts,rs.formulaAddress);return ns===void 0?ArraySize.error():new ArraySize(ns.width(),ns.height(),!0)}case AstNodeType.ARRAY:{const ns=[],is=[];for(const ls of ts.args){const us=ls.map(ds=>this.checkArraySizeForAst(ds,rs)),cs=Math.min(...us.map(ds=>ds.height)),ps=us.reduce((ds,fs)=>ds+fs.width,0);ns.push(cs),is.push(ps)}const as=ns.reduce((ls,us)=>ls+us,0),os=Math.min(...is);return new ArraySize(os,as)}case AstNodeType.STRING:case AstNodeType.NUMBER:return ArraySize.scalar();case AstNodeType.CELL_REFERENCE:return new ArraySize(1,1,!0);case AstNodeType.DIV_OP:case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.PLUS_OP:case AstNodeType.POWER_OP:case AstNodeType.TIMES_OP:{const ns=this.checkArraySizeForAst(ts.left,rs),is=this.checkArraySizeForAst(ts.right,rs);return!rs.arraysFlag&&(ns.height>1||ns.width>1||is.height>1||is.width>1)?ArraySize.error():arraySizeForBinaryOp(ns,is)}case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.PERCENT_OP:{const ns=this.checkArraySizeForAst(ts.value,rs);return!rs.arraysFlag&&(ns.height>1||ns.width>1)?ArraySize.error():arraySizeForUnaryOp(ns)}case AstNodeType.PARENTHESIS:return this.checkArraySizeForAst(ts.expression,rs);case AstNodeType.EMPTY:return ArraySize.error();default:return ArraySize.error()}}checkArraySizeForFunction(ts,rs){const ns=this.functionRegistry.getMetadata(ts.procedureName),is=this.functionRegistry.getArraySizeFunction(ts.procedureName);if(is!==void 0)return is(ts,rs);const as=ts.args.map(cs=>{var ps;return this.checkArraySizeForAst(cs,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((ps=ns==null?void 0:ns.arrayFunction)!==null&&ps!==void 0?ps:!1)))});if(ns===void 0||ns.expandRanges||!rs.arraysFlag||ns.vectorizationForbidden||ns.parameters===void 0)return new ArraySize(1,1);const os=[...ns.parameters];if(ns.repeatLastArgs===void 0&&os.length<as.length||ns.repeatLastArgs!==void 0&&os.length<as.length&&(as.length-os.length)%ns.repeatLastArgs!==0)return ArraySize.error();for(;os.length<as.length;)os.push(...os.slice(os.length-ns.repeatLastArgs));let ls=1,us=1;for(let cs=0;cs<as.length;cs++)os[cs].argumentType!==ArgumentTypes.RANGE&&os[cs].argumentType!==ArgumentTypes.ANY&&(us=Math.max(us,as[cs].height),ls=Math.max(ls,as[cs].width));return new ArraySize(ls,us)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class SimpleRangeValue{constructor(ts,rs,ns,is){this._data=ts,this.range=rs,this.dependencyGraph=ns,this._hasOnlyNumbers=is,ts===void 0?this.size=new ArraySize(rs.effectiveWidth(ns),rs.effectiveHeight(ns)):this.size=new ArraySize(ts[0].length,ts.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(ts,rs,ns){return new SimpleRangeValue(ts,rs,ns,!0)}static onlyNumbers(ts){return new SimpleRangeValue(ts,void 0,void 0,!0)}static onlyValues(ts){return new SimpleRangeValue(ts,void 0,void 0,void 0)}static onlyRange(ts,rs){return new SimpleRangeValue(void 0,ts,rs,void 0)}static fromScalar(ts){return new SimpleRangeValue([[ts]],void 0,void 0,void 0)}isAdHoc(){return this.range===void 0}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const ts=[];for(let rs=0;rs<this._data.length;rs++)for(let ns=0;ns<this._data[0].length;ns++)ts.push(this._data[rs][ns]);return ts}*effectiveAddressesFromData(ts){for(let rs=0;rs<this.data.length;++rs){const ns=this.data[rs];for(let is=0;is<ns.length;++is)yield simpleCellAddress(ts.sheet,ts.col+is,ts.row+rs)}}*entriesFromTopLeftCorner(ts){this.ensureThatComputed();for(let rs=0;rs<this.size.height;++rs)for(let ns=0;ns<this.size.width;++ns)yield[this._data[rs][ns],simpleCellAddress(ts.sheet,ts.col+ns,ts.row+rs)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(this._hasOnlyNumbers===void 0){this._hasOnlyNumbers=!0;for(const ts of this.data)for(const rs of ts)if(typeof rs!="number")return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var ts;return this.ensureThatComputed(),(ts=this._data)!==null&&ts!==void 0?ts:[]}sameDimensionsAs(ts){return this.width()===ts.width()&&this.height()===ts.height()}ensureThatComputed(){this._data===void 0&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,ts=>{const rs=this.dependencyGraph.getCellValue(ts);return rs instanceof SimpleRangeValue?(this._hasOnlyNumbers=!1,new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):(isExtendedNumber(rs)||(this._hasOnlyNumbers=!1),rs)}))}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ContentChanges{constructor(){this.changes=new Map}static empty(){return new ContentChanges}addAll(ts){for(const rs of ts.changes.values())this.add(rs.address,rs);return this}addChange(ts,rs,ns){this.addInterpreterValue(ts,rs,ns)}exportChanges(ts){let rs=[];return this.changes.forEach(ns=>{const is=ts.exportChange(ns);Array.isArray(is)?rs=rs.concat(is):rs.push(is)}),rs}getChanges(){return Array.from(this.changes.values())}isEmpty(){return this.changes.size===0}add(ts,rs){const ns=rs.value;if(ns instanceof SimpleRangeValue)for(const is of ns.effectiveAddressesFromData(ts))this.changes.delete(`${is.sheet},${is.col},${is.row}`);this.changes.set(addressKey(ts),rs)}addInterpreterValue(ts,rs,ns){this.add(rs,{address:rs,value:ts,oldValue:ns})}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var StatType;(function(ss){ss.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",ss.PARSER="PARSER",ss.GRAPH_BUILD="GRAPH_BUILD",ss.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",ss.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",ss.TOP_SORT="TOP_SORT",ss.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",ss.EVALUATION="EVALUATION",ss.VLOOKUP="VLOOKUP",ss.TRANSFORM_ASTS="TRANSFORM_ASTS",ss.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",ss.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",ss.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",ss.ADJUSTING_RANGES="ADJUSTING_RANGES",ss.ADJUSTING_GRAPH="ADJUSTING_GRAPH",ss.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",ss.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"})(StatType||(StatType={}));/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Statistics{constructor(){this.stats=new Map([[StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0],[StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var ts;const rs=((ts=this.stats.get(StatType.CRITERION_FUNCTION_FULL_CACHE_USED))!==null&&ts!==void 0?ts:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,rs)}incrementCriterionFunctionPartialCacheUsed(){var ts;const rs=((ts=this.stats.get(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED))!==null&&ts!==void 0?ts:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,rs)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(ts){if(this.startTimes.get(ts))throw Error(`Statistics ${ts} already started`);this.startTimes.set(ts,Date.now())}end(ts){var rs;const ns=Date.now(),is=this.startTimes.get(ts);if(is){let as=(rs=this.stats.get(ts))!==null&&rs!==void 0?rs:0;as+=ns-is,this.stats.set(ts,as),this.startTimes.delete(ts)}else throw Error(`Statistics ${ts} not started`)}measure(ts,rs){this.start(ts);const ns=rs();return this.end(ts),ns}snapshot(){return new Map(this.stats)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class EmptyStatistics extends Statistics{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(ts){}end(ts){}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AddressMapping{constructor(ts){this.policy=ts,this.mapping=new Map}getCell(ts){const rs=this.mapping.get(ts.sheet);if(rs===void 0)throw new NoSheetWithIdError(ts.sheet);return rs.getCell(ts)}fetchCell(ts){const rs=this.mapping.get(ts.sheet);if(rs===void 0)throw new NoSheetWithIdError(ts.sheet);const ns=rs.getCell(ts);if(!ns)throw Error("Vertex for address missing in AddressMapping");return ns}strategyFor(ts){const rs=this.mapping.get(ts);if(rs===void 0)throw new NoSheetWithIdError(ts);return rs}addSheet(ts,rs){if(this.mapping.has(ts))throw Error("Sheet already added");this.mapping.set(ts,rs)}autoAddSheet(ts,rs,ns){const{height:is,width:as,fill:os}=ns,ls=this.policy.call(os);this.addSheet(ts,new ls(as,is))}getCellValue(ts){const rs=this.getCell(ts);return rs===void 0?EmptyValue:rs instanceof ArrayVertex?rs.getArrayCellValue(ts):rs.getCellValue()}getRawValue(ts){const rs=this.getCell(ts);return rs instanceof ValueCellVertex?rs.getValues().rawValue:rs instanceof ArrayVertex?rs.getArrayCellRawValue(ts):null}setCell(ts,rs){const ns=this.mapping.get(ts.sheet);if(!ns)throw Error("Sheet not initialized");ns.setCell(ts,rs)}moveCell(ts,rs){const ns=this.mapping.get(ts.sheet);if(!ns)throw Error("Sheet not initialized.");if(ts.sheet!==rs.sheet)throw Error("Cannot move cells between sheets.");if(ns.has(rs))throw new Error("Cannot move cell. Destination already occupied.");const is=ns.getCell(ts);if(is===void 0)throw new Error("Cannot move cell. No cell with such address.");this.setCell(rs,is),this.removeCell(ts)}removeCell(ts){const rs=this.mapping.get(ts.sheet);if(!rs)throw Error("Sheet not initialized");rs.removeCell(ts)}has(ts){const rs=this.mapping.get(ts.sheet);return rs===void 0?!1:rs.has(ts)}getHeight(ts){const rs=this.mapping.get(ts);if(rs===void 0)throw new NoSheetWithIdError(ts);return rs.getHeight()}getWidth(ts){const rs=this.mapping.get(ts);if(!rs)throw new NoSheetWithIdError(ts);return rs.getWidth()}addRows(ts,rs,ns){const is=this.mapping.get(ts);if(is===void 0)throw new NoSheetWithIdError(ts);is.addRows(rs,ns)}removeRows(ts){const rs=this.mapping.get(ts.sheet);if(rs===void 0)throw new NoSheetWithIdError(ts.sheet);rs.removeRows(ts)}removeSheet(ts){this.mapping.delete(ts)}addColumns(ts,rs,ns){const is=this.mapping.get(ts);if(is===void 0)throw new NoSheetWithIdError(ts);is.addColumns(rs,ns)}removeColumns(ts){const rs=this.mapping.get(ts.sheet);if(rs===void 0)throw new NoSheetWithIdError(ts.sheet);rs.removeColumns(ts)}*verticesFromRowsSpan(ts){yield*this.mapping.get(ts.sheet).verticesFromRowsSpan(ts)}*verticesFromColumnsSpan(ts){yield*this.mapping.get(ts.sheet).verticesFromColumnsSpan(ts)}*entriesFromRowsSpan(ts){yield*this.mapping.get(ts.sheet).entriesFromRowsSpan(ts)}*entriesFromColumnsSpan(ts){yield*this.mapping.get(ts.sheet).entriesFromColumnsSpan(ts)}*entries(){for(const[ts,rs]of this.mapping.entries())yield*rs.getEntries(ts)}*sheetEntries(ts){const rs=this.mapping.get(ts);if(rs!==void 0)yield*rs.getEntries(ts);else throw new NoSheetWithIdError(ts)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ArrayMapping{constructor(){this.arrayMapping=new Map}getArray(ts){const rs=this.getArrayByCorner(ts.start);if(rs!=null&&rs.getRange().sameAs(ts))return rs}getArrayByCorner(ts){return this.arrayMapping.get(addressKey(ts))}setArray(ts,rs){this.arrayMapping.set(addressKey(ts.start),rs)}removeArray(ts){typeof ts=="string"?this.arrayMapping.delete(ts):this.arrayMapping.delete(addressKey(ts.start))}count(){return this.arrayMapping.size}*arraysInRows(ts){for(const[rs,ns]of this.arrayMapping.entries())ns.spansThroughSheetRows(ts.sheet,ts.rowStart,ts.rowEnd)&&(yield[rs,ns])}*arraysInCols(ts){for(const[rs,ns]of this.arrayMapping.entries())ns.spansThroughSheetColumn(ts.sheet,ts.columnStart,ts.columnEnd)&&(yield[rs,ns])}isFormulaArrayInRow(ts,rs){for(const ns of this.arrayMapping.values())if(ns.spansThroughSheetRows(ts,rs))return!0;return!1}isFormulaArrayInAllRows(ts){let rs=!0;for(const ns of ts.rows())this.isFormulaArrayInRow(ts.sheet,ns)||(rs=!1);return rs}isFormulaArrayInColumn(ts,rs){for(const ns of this.arrayMapping.values())if(ns.spansThroughSheetColumn(ts,rs))return!0;return!1}isFormulaArrayInAllColumns(ts){let rs=!0;for(const ns of ts.columns())this.isFormulaArrayInColumn(ts.sheet,ns)||(rs=!1);return rs}isFormulaArrayInRange(ts){for(const rs of this.arrayMapping.values())if(rs.getRange().doesOverlap(ts))return!0;return!1}isFormulaArrayAtAddress(ts){for(const rs of this.arrayMapping.values())if(rs.getRange().addressInRange(ts))return!0;return!1}moveArrayVerticesAfterRowByRows(ts,rs,ns){this.updateArrayVerticesInSheet(ts,(is,as)=>{const os=as.getRange();return rs<=os.start.row?[os.shifted(0,ns),as]:void 0})}moveArrayVerticesAfterColumnByColumns(ts,rs,ns){this.updateArrayVerticesInSheet(ts,(is,as)=>{const os=as.getRange();return rs<=os.start.col?[os.shifted(ns,0),as]:void 0})}updateArrayVerticesInSheet(ts,rs){const ns=Array();for(const[is,as]of this.arrayMapping.entries()){if(as.sheet!==ts)continue;const os=rs(is,as);os!==void 0&&(this.removeArray(is),ns.push(os))}ns.forEach(([is,as])=>{this.setArray(is,as)})}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class NotComputedArray{constructor(ts){this.size=ts}width(){return this.size.width}height(){return this.size.height}get(ts,rs){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}}class ArrayValue{constructor(ts){this.size=new ArraySize(ts.length>0?ts[0].length:0,ts.length),this.array=ts}static fromInterpreterValue(ts){return ts instanceof SimpleRangeValue?new ArrayValue(ts.data):new ArrayValue([[ts]])}simpleRangeValue(){return SimpleRangeValue.onlyValues(this.array)}addRows(ts,rs){this.array.splice(ts,0,...this.nullArrays(rs,this.width())),this.size.height+=rs}addColumns(ts,rs){for(let ns=0;ns<this.height();ns++)this.array[ns].splice(ts,0,...new Array(rs).fill(EmptyValue));this.size.width+=rs}removeRows(ts,rs){if(this.outOfBound(0,ts)||this.outOfBound(0,rs))throw Error("Array index out of bound");const ns=rs-ts+1;this.array.splice(ts,ns),this.size.height-=ns}removeColumns(ts,rs){if(this.outOfBound(ts,0)||this.outOfBound(rs,0))throw Error("Array index out of bound");const ns=rs-ts+1;for(const is of this.array)is.splice(ts,ns);this.size.width-=ns}nullArrays(ts,rs){const ns=[];for(let is=0;is<ts;++is)ns.push(new Array(rs).fill(EmptyValue));return ns}get(ts,rs){if(this.outOfBound(ts,rs))throw Error("Array index out of bound");return this.array[rs][ts]}set(ts,rs,ns){if(this.outOfBound(ts,rs))throw Error("Array index out of bound");this.array[rs][ts]=ns}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(ts){if(this.height()<ts.height&&isFinite(ts.height)&&this.addRows(this.height(),ts.height-this.height()),this.height()>ts.height||(this.width()<ts.width&&isFinite(ts.width)&&this.addColumns(this.width(),ts.width-this.width()),this.width()>ts.width))throw"Resizing to smaller array"}outOfBound(ts,rs){return ts<0||rs<0||rs>this.size.height-1||ts>this.size.width-1}}class ErroredArray{constructor(ts,rs){this.error=ts,this.size=rs}get(ts,rs){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class FormulaVertex{constructor(ts,rs,ns){this.formula=ts,this.cellAddress=rs,this.version=ns}get width(){return 1}get height(){return 1}static fromAst(ts,rs,ns,is){return ns.isScalar()?new FormulaCellVertex(ts,rs,is):new ArrayVertex(ts,rs,ns,is)}getFormula(ts){return this.ensureRecentData(ts),this.formula}ensureRecentData(ts){if(this.version!=ts.version()){const[rs,ns,is]=ts.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=rs,this.cellAddress=ns,this.version=is}}getAddress(ts){return this.ensureRecentData(ts),this.cellAddress}}class ArrayVertex extends FormulaVertex{constructor(ts,rs,ns,is=0){super(ts,rs,is),ns.isRef?this.array=new ErroredArray(new CellError(ErrorType.REF,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()):this.array=new NotComputedArray(ns)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(ts){if(ts instanceof CellError)return this.setErrorValue(ts),ts;const rs=ArrayValue.fromInterpreterValue(ts);return rs.resize(this.array.size),this.array=rs,ts}getCellValue(){if(this.array instanceof NotComputedArray)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof NotComputedArray))return this.array.simpleRangeValue()}getArrayCellValue(ts){const rs=ts.col-this.cellAddress.col,ns=ts.row-this.cellAddress.row;try{return this.array.get(rs,ns)}catch{return new CellError(ErrorType.REF)}}getArrayCellRawValue(ts){const rs=this.getArrayCellValue(ts);if(!(rs instanceof CellError||rs===EmptyValue))return getRawValue(rs)}setArrayCellValue(ts,rs){const ns=ts.col-this.cellAddress.col,is=ts.row-this.cellAddress.row;this.array instanceof ArrayValue&&this.array.set(ns,is,rs)}setNoSpace(){return this.array=new ErroredArray(new CellError(ErrorType.SPILL,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()),this.getCellValue()}getRange(){return AbsoluteCellRange.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return AbsoluteCellRange.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(ts){this.cellAddress=ts}setFormula(ts){this.formula=ts}spansThroughSheetRows(ts,rs,ns=rs){return this.cellAddress.sheet===ts&&this.cellAddress.row<=ns&&rs<this.cellAddress.row+this.height}spansThroughSheetColumn(ts,rs,ns=rs){return this.cellAddress.sheet===ts&&this.cellAddress.col<=ns&&rs<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof NotComputedArray)}columnsFromArray(){return ColumnsSpan.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return RowsSpan.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(ts){}isLeftCorner(ts){return equalSimpleCellAddress(this.cellAddress,ts)}setErrorValue(ts){this.array=new ErroredArray(ts,this.array.size)}}class FormulaCellVertex extends FormulaVertex{constructor(ts,rs,ns){super(ts,rs,ns)}valueOrUndef(){return this.cachedCellValue}setCellValue(ts){return this.cachedCellValue=ts,this.cachedCellValue}getCellValue(){if(this.cachedCellValue!==void 0)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return this.cachedCellValue!==void 0}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RangeVertex{constructor(ts){this.range=ts,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(ts){return this.functionCache.get(ts)}setFunctionValue(ts,rs){this.functionCache.set(ts,rs)}getCriterionFunctionValue(ts,rs){var ns;return(ns=this.getCriterionFunctionValues(ts).get(rs))===null||ns===void 0?void 0:ns[0]}getCriterionFunctionValues(ts){var rs;return(rs=this.criterionFunctionCache.get(ts))!==null&&rs!==void 0?rs:new Map}setCriterionFunctionValues(ts,rs){this.criterionFunctionCache.set(ts,rs)}addDependentCacheRange(ts){ts!==this&&this.dependentCacheRanges.add(ts)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach(ts=>ts.criterionFunctionCache.clear()),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const collectAddressesDependentToRange=(ss,ts,rs,ns,is)=>{if(ts instanceof RangeVertex){const ls=ts.range.intersectionWith(rs);return ls!==void 0?Array.from(ls.addresses(is)):[]}let as,os;if(ts instanceof FormulaVertex)as=ts.getFormula(ns),os=ts.getAddress(ns);else return[];return collectDependencies(as,ss).filter(ls=>ls instanceof AddressDependency).map(ls=>ls.dependency.toSimpleCellAddress(os)).filter(ls=>rs.addressInRange(ls))};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var NodeVisitStatus;(function(ss){ss[ss.ON_STACK=0]="ON_STACK",ss[ss.PROCESSED=1]="PROCESSED",ss[ss.POPPED=2]="POPPED"})(NodeVisitStatus||(NodeVisitStatus={}));class Graph{constructor(ts){this.dependencyQuery=ts,this.nodes=new Set,this.specialNodes=new Set,this.specialNodesStructuralChanges=new Set,this.specialNodesRecentlyChanged=new Set,this.infiniteRanges=new Set,this.edges=new Map}addNode(ts){this.nodes.add(ts),this.edges.has(ts)||this.edges.set(ts,new Set)}addEdge(ts,rs){if(!this.nodes.has(ts))throw new Error(`Unknown node ${ts}`);if(!this.nodes.has(rs))throw new Error(`Unknown node ${rs}`);this.edges.get(ts).add(rs)}removeEdge(ts,rs){if(this.existsEdge(ts,rs))this.edges.get(ts).delete(rs);else throw new Error("Edge does not exist")}softRemoveEdge(ts,rs){var ns;(ns=this.edges.get(ts))===null||ns===void 0||ns.delete(rs)}removeIncomingEdges(ts){this.edges.forEach(rs=>{rs.delete(ts)})}adjacentNodes(ts){return this.edges.get(ts)}adjacentNodesCount(ts){return this.adjacentNodes(ts).size}hasNode(ts){return this.nodes.has(ts)}nodesCount(){return this.nodes.size}edgesCount(){let ts=0;return this.edges.forEach(rs=>ts+=rs.size),ts}removeNode(ts){for(const rs of this.adjacentNodes(ts).values())this.markNodeAsSpecialRecentlyChanged(rs);return this.edges.delete(ts),this.nodes.delete(ts),this.specialNodes.delete(ts),this.specialNodesRecentlyChanged.delete(ts),this.specialNodesStructuralChanges.delete(ts),this.infiniteRanges.delete(ts),this.removeDependencies(ts)}markNodeAsSpecial(ts){this.specialNodes.add(ts)}markNodeAsSpecialRecentlyChanged(ts){this.nodes.has(ts)&&this.specialNodesRecentlyChanged.add(ts)}markNodeAsChangingWithStructure(ts){this.specialNodesStructuralChanges.add(ts)}clearSpecialNodesRecentlyChanged(){this.specialNodesRecentlyChanged.clear()}markNodeAsInfiniteRange(ts){this.infiniteRanges.add(ts)}existsEdge(ts,rs){var ns,is;return(is=(ns=this.edges.get(ts))===null||ns===void 0?void 0:ns.has(rs))!==null&&is!==void 0?is:!1}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(Array.from(this.nodes),()=>!0,()=>{})}getTopSortedWithSccSubgraphFrom(ts,rs,ns){const is=new Map,as=new Map,os=new Map,ls=new Set,us=new Map,cs=[];let ps=0;const ds=new Set;ts.reverse(),ts.forEach(gs=>{if(us.get(gs)!==void 0)return;const bs=[gs],vs=[];for(us.set(gs,NodeVisitStatus.ON_STACK);bs.length>0;){const Ns=bs[bs.length-1];switch(us.get(Ns)){case NodeVisitStatus.ON_STACK:{is.set(Ns,ps),as.set(Ns,ps),vs.push(Ns),ps++,this.adjacentNodes(Ns).forEach(Ts=>{is.get(Ts)===void 0&&(bs.push(Ts),os.set(Ts,Ns),us.set(Ts,NodeVisitStatus.ON_STACK))}),us.set(Ns,NodeVisitStatus.PROCESSED);break}case NodeVisitStatus.PROCESSED:{let Ts;if(Ts=is.get(Ns),this.adjacentNodes(Ns).forEach(Cs=>{ls.has(Cs)||(os.get(Cs)===Ns?Ts=Math.min(Ts,as.get(Cs)):Ts=Math.min(Ts,is.get(Cs)))}),as.set(Ns,Ts),Ts===is.get(Ns)){const Cs=[];do Cs.push(vs[vs.length-1]),vs.pop();while(Cs[Cs.length-1]!==Ns);Cs.forEach(xs=>{ls.add(xs)}),cs.push(...Cs),Cs.length>1&&Cs.forEach(xs=>{ds.add(xs)})}bs.pop(),us.set(Ns,NodeVisitStatus.POPPED);break}case NodeVisitStatus.POPPED:{bs.pop();break}}}});const fs=new Set(ts),hs=[],ys=[];return cs.reverse(),cs.forEach(gs=>{ds.has(gs)||this.adjacentNodes(gs).has(gs)?(ys.push(gs),ns(gs),this.adjacentNodes(gs).forEach(bs=>fs.add(bs))):(hs.push(gs),fs.has(gs)&&rs(gs)&&this.adjacentNodes(gs).forEach(bs=>fs.add(bs)))}),{sorted:hs,cycled:ys}}getDependencies(ts){const rs=[];return this.edges.forEach((ns,is)=>{ns.has(ts)&&rs.push(is)}),rs}removeDependencies(ts){const rs=this.dependencyQuery(ts);for(const ns of rs)this.softRemoveEdge(ns,ts);return rs}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RangeMapping{constructor(){this.rangeMapping=new Map}getMappingSize(ts){var rs,ns;return(ns=(rs=this.rangeMapping.get(ts))===null||rs===void 0?void 0:rs.size)!==null&&ns!==void 0?ns:0}setRange(ts){let rs=this.rangeMapping.get(ts.getStart().sheet);rs===void 0&&(rs=new Map,this.rangeMapping.set(ts.getStart().sheet,rs));const ns=keyFromAddresses(ts.getStart(),ts.getEnd());rs.set(ns,ts)}removeRange(ts){const rs=ts.getStart().sheet,ns=this.rangeMapping.get(rs);if(ns===void 0)return;const is=keyFromAddresses(ts.getStart(),ts.getEnd());ns.delete(is),ns.size===0&&this.rangeMapping.delete(rs)}getRange(ts,rs){const ns=this.rangeMapping.get(ts.sheet),is=keyFromAddresses(ts,rs);return ns==null?void 0:ns.get(is)}fetchRange(ts,rs){const ns=this.getRange(ts,rs);if(!ns)throw Error("Range does not exist");return ns}truncateRanges(ts,rs){const ns=Array(),is=Array(),as=Array(),os=ts.sheet;for(const[us,cs]of this.entriesFromSheet(ts.sheet)){const ps=cs.range;ts.start<=rs(cs.range.end)&&(ps.removeSpan(ts),ps.shouldBeRemoved()?(this.removeByKey(os,us),ns.push(cs)):is.push([us,cs]),as.push(cs))}const ls=[];is.sort((us,cs)=>compareBy(us[1],cs[1],rs));for(const[us,cs]of is){const ps=keyFromRange(cs.range);if(ps===us)continue;const ds=this.getByKey(os,ps);this.removeByKey(os,us),ds!==void 0&&cs!=ds?ls.push([ds,cs]):this.setRange(cs)}return{verticesToRemove:ns,verticesToMerge:ls,verticesWithChangedSize:as}}moveAllRangesInSheetAfterRowByRows(ts,rs,ns){return this.updateVerticesFromSheet(ts,(is,as)=>rs<=as.start.row?(as.range.shiftByRows(ns),{changedSize:!1,vertex:as}):rs>as.start.row&&rs<=as.end.row?(as.range.expandByRows(ns),{changedSize:!0,vertex:as}):void 0)}moveAllRangesInSheetAfterColumnByColumns(ts,rs,ns){return this.updateVerticesFromSheet(ts,(is,as)=>rs<=as.start.col?(as.range.shiftByColumns(ns),{changedSize:!1,vertex:as}):rs>as.start.col&&rs<=as.end.col?(as.range.expandByColumns(ns),{changedSize:!0,vertex:as}):void 0)}moveRangesInsideSourceRange(ts,rs,ns,is){this.updateVerticesFromSheet(ts.sheet,(as,os)=>{if(ts.containsRange(os.range))return os.range.shiftByColumns(rs),os.range.shiftByRows(ns),os.range.moveToSheet(is),{changedSize:!1,vertex:os}})}removeRangesInSheet(ts){if(this.rangeMapping.has(ts)){const rs=this.rangeMapping.get(ts).values();return this.rangeMapping.delete(ts),rs}return[][Symbol.iterator]()}*rangesInSheet(ts){const rs=this.rangeMapping.get(ts);rs&&(yield*rs.values())}*rangeVerticesContainedInRange(ts){for(const rs of this.rangesInSheet(ts.sheet))ts.containsRange(rs.range)&&(yield rs)}findSmallerRange(ts){if(ts.height()>1&&Number.isFinite(ts.height())){const rs=simpleCellAddress(ts.end.sheet,ts.end.col,ts.end.row-1),ns=this.getRange(ts.start,rs);if(ns!==void 0){const is=new AbsoluteCellRange(simpleCellAddress(ts.start.sheet,ts.start.col,ts.end.row),ts.end);return{smallerRangeVertex:ns,restRange:is}}}return{restRange:ts}}*entriesFromSheet(ts){const rs=this.rangeMapping.get(ts);rs&&(yield*rs.entries())}removeByKey(ts,rs){this.rangeMapping.get(ts).delete(rs)}getByKey(ts,rs){var ns;return(ns=this.rangeMapping.get(ts))===null||ns===void 0?void 0:ns.get(rs)}updateVerticesFromSheet(ts,rs){const ns=Array();for(const[is,as]of this.entriesFromSheet(ts)){const os=rs(is,as);os!==void 0&&(this.removeByKey(ts,is),ns.push(os))}return ns.forEach(is=>{this.setRange(is.vertex)}),{verticesWithChangedSize:ns.filter(is=>is.changedSize).map(is=>is.vertex)}}}function keyFromAddresses(ss,ts){return`${ss.col},${ss.row},${ts.col},${ts.row}`}function keyFromRange(ss){return keyFromAddresses(ss.start,ss.end)}const compareBy=(ss,ts,rs)=>{const ns=rs(ss.range.start),is=rs(ss.range.start);if(ns===is){const as=rs(ss.range.end),os=rs(ts.range.end);return as-os}else return ns-is};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class TranslationPackage{constructor(ts,rs,ns){this.functions=ts,this.errors=rs,this.ui=ns,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(ts){this.checkFunctionTranslations(ts),Object.assign(this.functions,ts)}buildFunctionMapping(){return Object.keys(this.functions).reduce((ts,rs)=>(ts[this.functions[rs]]=rs,ts),{})}buildErrorMapping(){return Object.keys(this.errors).reduce((ts,rs)=>(ts[this.errors[rs]]=rs,ts),{})}isFunctionTranslated(ts){return this.functions[ts]!==void 0}getFunctionTranslations(ts){const rs=[];for(const ns of ts)this.isFunctionTranslated(ns)&&rs.push(this.functions[ns]);return rs}getFunctionTranslation(ts){const rs=this.functions[ts];if(rs===void 0)throw new MissingTranslationError(`functions.${ts}`);return rs}getMaybeFunctionTranslation(ts){return this.functions[ts]}getErrorTranslation(ts){if(ts===ErrorType.LIC)return`#${ErrorType.LIC}!`;const rs=this.errors[ts];if(rs===void 0)throw new MissingTranslationError(`errors.${ts}`);return rs}getUITranslation(ts){const rs=this.ui[ts];if(rs===void 0)throw new MissingTranslationError(`ui.${ts}`);return rs}checkUI(){for(const ts of Object.values(UIElement))if(!(ts in this.ui))throw new MissingTranslationError(`ui.${ts}`)}checkErrors(){for(const ts of Object.values(ErrorType))if(!(ts in this.errors)&&ts!==ErrorType.LIC)throw new MissingTranslationError(`errors.${ts}`)}checkFunctionTranslations(ts){const rs=new Set(Object.getOwnPropertyNames(ts));for(const ns of Object.getOwnPropertyNames(this._protectedTranslations))if(rs.has(ns))throw new ProtectedFunctionTranslationError(ns)}}function buildTranslationPackage(ss){return new TranslationPackage(Object.assign({},ss.functions),Object.assign({},ss.errors),Object.assign({},ss.ui))}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var UIElement;(function(ss){ss.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"})(UIElement||(UIElement={}));/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function canonicalize(ss){return ss.toLowerCase()}class Sheet{constructor(ts,rs){this.id=ts,this.displayName=rs}get canonicalName(){return canonicalize(this.displayName)}}class SheetMapping{constructor(ts){this.languages=ts,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=rs=>{const ns=this.mappingFromCanonicalName.get(canonicalize(rs));if(ns===void 0)throw new NoSheetWithNameError(rs);return ns.id},this.get=rs=>{var ns;return(ns=this.mappingFromCanonicalName.get(canonicalize(rs)))===null||ns===void 0?void 0:ns.id},this.fetchDisplayName=rs=>this.fetchSheetById(rs).displayName,this.sheetNamePrefix=ts.getUITranslation(UIElement.NEW_SHEET_PREFIX)}addSheet(ts=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const rs=canonicalize(ts);if(this.mappingFromCanonicalName.has(rs))throw new SheetNameAlreadyTakenError(ts);this.lastSheetId++;const ns=new Sheet(this.lastSheetId,ts);return this.store(ns),ns.id}removeSheet(ts){const rs=this.fetchSheetById(ts);ts==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(rs.canonicalName),this.mappingFromId.delete(rs.id)}getDisplayName(ts){var rs;return(rs=this.mappingFromId.get(ts))===null||rs===void 0?void 0:rs.displayName}*displayNames(){for(const ts of this.mappingFromCanonicalName.values())yield ts.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(ts){return this.mappingFromId.has(ts)}hasSheetWithName(ts){return this.mappingFromCanonicalName.has(canonicalize(ts))}renameSheet(ts,rs){const ns=this.fetchSheetById(ts),is=ns.displayName;if(is===rs)return;const as=this.mappingFromCanonicalName.get(canonicalize(rs));if(as!==void 0&&as.id!==ns.id)throw new SheetNameAlreadyTakenError(rs);const os=ns.canonicalName;return this.mappingFromCanonicalName.delete(os),ns.displayName=rs,this.store(ns),is}sheetNames(){return Array.from(this.mappingFromId.values()).map(ts=>ts.displayName)}store(ts){this.mappingFromId.set(ts.id,ts),this.mappingFromCanonicalName.set(ts.canonicalName,ts)}fetchSheetById(ts){const rs=this.mappingFromId.get(ts);if(rs===void 0)throw new NoSheetWithIdError(ts);return rs}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DependencyGraph{constructor(ts,rs,ns,is,as,os,ls,us){this.addressMapping=ts,this.rangeMapping=rs,this.sheetMapping=ns,this.arrayMapping=is,this.stats=as,this.lazilyTransformingAstService=os,this.functionRegistry=ls,this.namedExpressions=us,this.changes=ContentChanges.empty(),this.dependencyQueryAddresses=cs=>{if(cs instanceof RangeVertex)return this.rangeDependencyQuery(cs).map(([ps,ds])=>ps);{const ps=this.formulaDependencyQuery(cs);if(ps!==void 0){const[ds,fs]=ps;return fs.map(hs=>hs instanceof NamedExpressionDependency?this.namedExpressions.namedExpressionOrPlaceholder(hs.name,ds.sheet).address:isSimpleCellAddress(hs)?hs:simpleCellRange(hs.start,hs.end))}else return[]}},this.dependencyQueryVertices=cs=>{if(cs instanceof RangeVertex)return this.rangeDependencyQuery(cs).map(([ps,ds])=>ds);{const ps=this.formulaDependencyQuery(cs);if(ps!==void 0){const[ds,fs]=ps;return fs.map(hs=>{if(hs instanceof AbsoluteCellRange)return this.rangeMapping.fetchRange(hs.start,hs.end);if(hs instanceof NamedExpressionDependency){const ys=this.namedExpressions.namedExpressionOrPlaceholder(hs.name,ds.sheet);return this.addressMapping.fetchCell(ys.address)}else return this.addressMapping.fetchCell(hs)})}else return[]}},this.rangeDependencyQuery=cs=>{const ps=[],{smallerRangeVertex:ds,restRange:fs}=this.rangeMapping.findSmallerRange(cs.range);let hs;ds!==void 0&&this.graph.adjacentNodes(ds).has(cs)?(hs=fs,ps.push([new AbsoluteCellRange(ds.start,ds.end),ds])):hs=cs.range;for(const ys of hs.addresses(this)){const gs=this.addressMapping.getCell(ys);gs instanceof EmptyCellVertex&&(gs.address=ys),gs!==void 0&&ps.push([ys,gs])}return ps},this.formulaDependencyQuery=cs=>{let ps,ds;if(cs instanceof FormulaVertex)ds=cs.getAddress(this.lazilyTransformingAstService),ps=cs.getFormula(this.lazilyTransformingAstService);else return;const fs=collectDependencies(ps,this.functionRegistry);return[ds,absolutizeDependencies(fs,ds)]},this.graph=new Graph(this.dependencyQueryVertices)}static buildEmpty(ts,rs,ns,is,as){return new DependencyGraph(new AddressMapping(rs.chooseAddressMappingPolicy),new RangeMapping,new SheetMapping(rs.translationPackage),new ArrayMapping,as,ts,ns,is)}setFormulaToCell(ts,rs,ns,is,as,os){const ls=FormulaVertex.fromAst(rs,ts,is,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(ls),this.processCellDependencies(ns,ls),this.graph.markNodeAsSpecialRecentlyChanged(ls),as&&this.markAsVolatile(ls),os&&this.markAsDependentOnStructureChange(ls),this.correctInfiniteRangesDependency(ts),this.getAndClearContentChanges()}setParsingErrorToCell(ts,rs){const ns=this.shrinkPossibleArrayAndGetCell(ts);return this.exchangeOrAddGraphNode(ns,rs),this.addressMapping.setCell(ts,rs),this.graph.markNodeAsSpecialRecentlyChanged(rs),this.correctInfiniteRangesDependency(ts),this.getAndClearContentChanges()}setValueToCell(ts,rs){const ns=this.shrinkPossibleArrayAndGetCell(ts);if(ns instanceof ArrayVertex&&this.arrayMapping.removeArray(ns.getRange()),ns instanceof ValueCellVertex)ns.getValues().rawValue!==rs.rawValue&&(ns.setValues(rs),this.graph.markNodeAsSpecialRecentlyChanged(ns));else{const is=new ValueCellVertex(rs.parsedValue,rs.rawValue);this.exchangeOrAddGraphNode(ns,is),this.addressMapping.setCell(ts,is),this.graph.markNodeAsSpecialRecentlyChanged(is)}return this.correctInfiniteRangesDependency(ts),this.getAndClearContentChanges()}setCellEmpty(ts){const rs=this.shrinkPossibleArrayAndGetCell(ts);if(rs===void 0)return ContentChanges.empty();if(this.graph.adjacentNodes(rs).size>0){const ns=new EmptyCellVertex(ts);this.exchangeGraphNode(rs,ns),this.graph.adjacentNodesCount(ns)===0?(this.removeVertex(ns),this.addressMapping.removeCell(ts)):(this.graph.markNodeAsSpecialRecentlyChanged(ns),this.addressMapping.setCell(ts,ns))}else this.removeVertex(rs),this.addressMapping.removeCell(ts);return this.getAndClearContentChanges()}ensureThatVertexIsNonArrayCellVertex(ts){if(ts instanceof ArrayVertex)throw new Error("Illegal operation")}clearRecentlyChangedVertices(){this.graph.clearSpecialNodesRecentlyChanged()}verticesToRecompute(){return new Set([...this.graph.specialNodesRecentlyChanged,...this.volatileVertices()])}processCellDependencies(ts,rs){ts.forEach(ns=>{if(ns instanceof AbsoluteCellRange){const is=ns;let as=this.getRange(is.start,is.end);as===void 0&&(as=new RangeVertex(is),this.rangeMapping.setRange(as)),this.graph.addNode(as),is.isFinite()||this.graph.markNodeAsInfiniteRange(as);const{smallerRangeVertex:os,restRange:ls}=this.rangeMapping.findSmallerRange(is);if(os!==void 0){if(this.graph.addEdge(os,as),as.bruteForce){as.bruteForce=!1;for(const cs of is.addresses(this))this.graph.removeEdge(this.fetchCell(cs),as)}}else as.bruteForce=!0;const us=this.arrayMapping.getArray(ls);if(us!==void 0)this.graph.addEdge(us,as);else for(const cs of ls.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(cs),as);this.graph.addEdge(as,rs),is.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(as)}else if(ns instanceof NamedExpressionDependency){const is=rs.getAddress(this.lazilyTransformingAstService).sheet,as=this.fetchNamedExpressionVertex(ns.name,is);this.graph.addEdge(as,rs)}else this.graph.addEdge(this.fetchCellOrCreateEmpty(ns),rs)})}fetchNamedExpressionVertex(ts,rs){const ns=this.namedExpressions.namedExpressionOrPlaceholder(ts,rs);return this.fetchCellOrCreateEmpty(ns.address)}exchangeNode(ts,rs){const ns=this.fetchCellOrCreateEmpty(ts),is=this.fetchCellOrCreateEmpty(rs);this.addressMapping.removeCell(ts),this.exchangeGraphNode(ns,is)}correctInfiniteRangesDependency(ts){let rs;for(const ns of this.graph.infiniteRanges){const is=ns;is.range.addressInRange(ts)&&(rs=rs??this.fetchCellOrCreateEmpty(ts),this.graph.addEdge(rs,is))}}fetchCellOrCreateEmpty(ts){let rs=this.addressMapping.getCell(ts);return rs===void 0&&(rs=new EmptyCellVertex(ts),this.graph.addNode(rs),this.addressMapping.setCell(ts,rs)),rs}removeRows(ts){this.stats.measure(StatType.ADJUSTING_GRAPH,()=>{for(const[ns,is]of this.addressMapping.entriesFromRowsSpan(ts)){for(const as of this.graph.adjacentNodes(is))this.graph.markNodeAsSpecialRecentlyChanged(as);if(is instanceof ArrayVertex)if(is.isLeftCorner(ns))this.shrinkArrayToCorner(is),this.arrayMapping.removeArray(is.getRange());else continue;this.removeVertex(is)}}),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeRows(ts)});const rs=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const ns=this.truncateRanges(ts,is=>is.row);return this.getArrayVerticesRelatedToRanges(ns)});return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterRemovingRows(ts.sheet,ts.rowStart,ts.numberOfRows)}),this.addStructuralNodesToChangeSet(),{affectedArrays:rs,contentChanges:this.getAndClearContentChanges()}}removeSheet(ts){const rs=new Set;for(const[ns,is]of this.addressMapping.sheetEntries(ts)){if(is instanceof ArrayVertex){if(rs.has(is))continue;rs.add(is)}for(const as of this.graph.adjacentNodes(is))this.graph.markNodeAsSpecialRecentlyChanged(as);this.removeVertex(is),this.addressMapping.removeCell(ns)}this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>{for(const ns of rs.values())this.arrayMapping.removeArray(ns.getRange())}),this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const ns=this.rangeMapping.removeRangesInSheet(ts);for(const is of ns)this.removeVertex(is);this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeSheet(ts)})}),this.addStructuralNodesToChangeSet()}clearSheet(ts){const rs=new Set;for(const[ns,is]of this.addressMapping.sheetEntries(ts))is instanceof ArrayVertex?rs.add(is):this.setCellEmpty(ns);for(const ns of rs.values())this.setArrayEmpty(ns);this.addStructuralNodesToChangeSet()}removeColumns(ts){this.stats.measure(StatType.ADJUSTING_GRAPH,()=>{for(const[ns,is]of this.addressMapping.entriesFromColumnsSpan(ts)){for(const as of this.graph.adjacentNodes(is))this.graph.markNodeAsSpecialRecentlyChanged(as);if(is instanceof ArrayVertex)if(is.isLeftCorner(ns))this.shrinkArrayToCorner(is),this.arrayMapping.removeArray(is.getRange());else continue;this.removeVertex(is)}}),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.removeColumns(ts)});const rs=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const ns=this.truncateRanges(ts,is=>is.col);return this.getArrayVerticesRelatedToRanges(ns)});return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterRemovingColumns(ts.sheet,ts.columnStart,ts.numberOfColumns)),this.addStructuralNodesToChangeSet(),{affectedArrays:rs,contentChanges:this.getAndClearContentChanges()}}addRows(ts){this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addRows(ts.sheet,ts.rowStart,ts.numberOfRows)});const rs=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const ns=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(ts.sheet,ts.rowStart,ts.numberOfRows);return this.fixRangesWhenAddingRows(ts.sheet,ts.rowStart,ts.numberOfRows),this.getArrayVerticesRelatedToRanges(ns.verticesWithChangedSize)});this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>{this.fixArraysAfterAddingRow(ts.sheet,ts.rowStart,ts.numberOfRows)});for(const ns of this.addressMapping.verticesFromRowsSpan(ts))this.graph.markNodeAsSpecialRecentlyChanged(ns);return this.addStructuralNodesToChangeSet(),{affectedArrays:rs}}addColumns(ts){this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,()=>{this.addressMapping.addColumns(ts.sheet,ts.columnStart,ts.numberOfColumns)});const rs=this.stats.measure(StatType.ADJUSTING_RANGES,()=>{const ns=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(ts.sheet,ts.columnStart,ts.numberOfColumns);return this.fixRangesWhenAddingColumns(ts.sheet,ts.columnStart,ts.numberOfColumns),this.getArrayVerticesRelatedToRanges(ns.verticesWithChangedSize)});this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,()=>this.fixArraysAfterAddingColumn(ts.sheet,ts.columnStart,ts.numberOfColumns));for(const ns of this.addressMapping.verticesFromColumnsSpan(ts))this.graph.markNodeAsSpecialRecentlyChanged(ns);return this.addStructuralNodesToChangeSet(),{affectedArrays:rs,contentChanges:this.getAndClearContentChanges()}}ensureNoArrayInRange(ts){if(this.arrayMapping.isFormulaArrayInRange(ts))throw Error("It is not possible to move / replace cells with array")}isThereSpaceForArray(ts){const rs=ts.getRangeOrUndef();if(rs===void 0)return!1;for(const ns of rs.addresses(this)){const is=this.addressMapping.getCell(ns);if(is!==void 0&&!(is instanceof EmptyCellVertex)&&is!==ts)return!1}return!0}moveCells(ts,rs,ns,is){for(const as of ts.addressesWithDirection(rs,ns,this)){const os=simpleCellAddress(is,as.col+rs,as.row+ns);let ls=this.addressMapping.getCell(as);const us=this.addressMapping.getCell(os);if(this.addressMapping.removeCell(as),ls!==void 0){this.graph.markNodeAsSpecialRecentlyChanged(ls),this.addressMapping.setCell(os,ls);let cs;for(const ps of this.graph.adjacentNodes(ls))ps instanceof RangeVertex&&!ts.containsRange(ps.range)&&(cs=cs??this.fetchCellOrCreateEmpty(as),this.graph.addEdge(cs,ps),this.graph.removeEdge(ls,ps));cs&&(this.graph.markNodeAsSpecialRecentlyChanged(cs),this.addressMapping.setCell(as,cs))}if(us!==void 0){ls===void 0&&this.addressMapping.removeCell(os);for(const cs of this.graph.adjacentNodes(us))ls=ls??this.fetchCellOrCreateEmpty(os),this.graph.addEdge(ls,cs),this.graph.markNodeAsSpecialRecentlyChanged(ls);this.removeVertex(us)}}for(const as of this.rangeMapping.rangeVerticesContainedInRange(ts))for(const os of this.graph.adjacentNodes(as))if(os instanceof RangeVertex&&!ts.containsRange(os.range)){this.graph.removeEdge(as,os);for(const ls of as.range.addresses(this)){const us=this.fetchCellOrCreateEmpty(ls);this.graph.addEdge(us,os),this.addressMapping.setCell(ls,us),this.graph.markNodeAsSpecialRecentlyChanged(us)}}this.rangeMapping.moveRangesInsideSourceRange(ts,rs,ns,is)}setArrayEmpty(ts){const rs=AbsoluteCellRange.spanFrom(ts.getAddress(this.lazilyTransformingAstService),ts.width,ts.height),ns=this.graph.adjacentNodes(ts);for(const is of rs.addresses(this))this.addressMapping.removeCell(is);for(const is of ns.values()){const as=collectAddressesDependentToRange(this.functionRegistry,is,ts.getRange(),this.lazilyTransformingAstService,this);for(const os of as){const ls=this.fetchCellOrCreateEmpty(os);this.graph.addEdge(ls,is)}as.length>0&&this.graph.markNodeAsSpecialRecentlyChanged(is)}this.removeVertex(ts),this.arrayMapping.removeArray(ts.getRange())}addVertex(ts,rs){this.graph.addNode(rs),this.addressMapping.setCell(ts,rs)}addArrayVertex(ts,rs){this.graph.addNode(rs),this.setAddressMappingForArrayVertex(rs,ts)}*arrayFormulaNodes(){for(const ts of this.graph.nodes)ts instanceof ArrayVertex&&(yield ts)}*entriesFromRowsSpan(ts){yield*this.addressMapping.entriesFromRowsSpan(ts)}*entriesFromColumnsSpan(ts){yield*this.addressMapping.entriesFromColumnsSpan(ts)}existsVertex(ts){return this.addressMapping.has(ts)}fetchCell(ts){return this.addressMapping.fetchCell(ts)}getCell(ts){return this.addressMapping.getCell(ts)}getCellValue(ts){return this.addressMapping.getCellValue(ts)}getRawValue(ts){return this.addressMapping.getRawValue(ts)}getScalarValue(ts){const rs=this.addressMapping.getCellValue(ts);return rs instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected):rs}existsEdge(ts,rs){return this.graph.existsEdge(ts,rs)}getSheetId(ts){return this.sheetMapping.fetch(ts)}getSheetHeight(ts){return this.addressMapping.getHeight(ts)}getSheetWidth(ts){return this.addressMapping.getWidth(ts)}getArray(ts){return this.arrayMapping.getArray(ts)}setArray(ts,rs){this.arrayMapping.setArray(ts,rs)}getRange(ts,rs){return this.rangeMapping.getRange(ts,rs)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(ts){this.graph.markNodeAsSpecial(ts)}markAsDependentOnStructureChange(ts){this.graph.markNodeAsChangingWithStructure(ts)}forceApplyPostponedTransformations(){for(const ts of this.graph.nodes.values())ts instanceof FormulaCellVertex&&ts.ensureRecentData(this.lazilyTransformingAstService)}volatileVertices(){return this.graph.specialNodes}getArrayVerticesRelatedToRanges(ts){const rs=ts.map(ns=>this.graph.hasNode(ns)?Array.from(this.graph.adjacentNodes(ns)).filter(is=>is instanceof ArrayVertex):[]);return new Set(...rs)}*rawValuesFromRange(ts){for(const rs of ts.addresses(this)){const ns=this.getScalarValue(rs);ns!==EmptyValue&&(yield[getRawValue(ns),rs])}}*entriesFromRange(ts){for(const rs of ts.addresses(this))yield[rs,this.getCell(rs)]}exchangeGraphNode(ts,rs){this.graph.addNode(rs);const ns=this.graph.adjacentNodes(ts);this.removeVertex(ts),ns.forEach(is=>{this.graph.hasNode(is)&&this.graph.addEdge(rs,is)})}exchangeOrAddGraphNode(ts,rs){ts?this.exchangeGraphNode(ts,rs):this.graph.addNode(rs)}computeListOfValuesInRange(ts){const rs=[];for(const ns of ts.addresses(this)){const is=this.getScalarValue(ns);rs.push(is)}return rs}shrinkArrayToCorner(ts){this.cleanAddressMappingUnderArray(ts);for(const rs of this.adjacentArrayVertices(ts)){let ns;rs instanceof FormulaVertex?ns=this.formulaDirectDependenciesToArray(rs,ts):ns=this.rangeDirectDependenciesToArray(rs,ts);let is=!1;for(const[as,os]of ns)ts.isLeftCorner(as)&&(is=!0),this.graph.addEdge(os,rs),this.graph.markNodeAsSpecialRecentlyChanged(os);is||this.graph.removeEdge(ts,rs)}this.graph.markNodeAsSpecialRecentlyChanged(ts)}isArrayInternalCell(ts){const rs=this.getCell(ts);return rs instanceof ArrayVertex&&!rs.isLeftCorner(ts)}getAndClearContentChanges(){const ts=this.changes;return this.changes=ContentChanges.empty(),ts}getAdjacentNodesAddresses(ts){const rs=this.graph.adjacentNodes(ts),ns=[];return rs.forEach(is=>{const as=is;as instanceof RangeVertex?ns.push(simpleCellRange(as.start,as.end)):ns.push(as.getAddress(this.lazilyTransformingAstService))}),ns}correctInfiniteRangesDependenciesByRangeVertex(ts){for(const rs of this.graph.infiniteRanges){const ns=rs,is=ts.range.intersectionWith(ns.range);if(is!==void 0)for(const as of is.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(as),rs)}}cleanAddressMappingUnderArray(ts){const rs=ts.getRange();for(const ns of rs.addresses(this)){const is=ts.getArrayCellValue(ns);this.getCell(ns)===ts?ts.isLeftCorner(ns)?this.changes.addChange(new CellError(ErrorType.REF),ns,is):(this.addressMapping.removeCell(ns),this.changes.addChange(EmptyValue,ns,is)):this.changes.addChange(EmptyValue,ns,is)}}*formulaDirectDependenciesToArray(ts,rs){var ns;const[,is]=(ns=this.formulaDependencyQuery(ts))!==null&&ns!==void 0?ns:[];if(is!==void 0){for(const as of is)if(!(as instanceof NamedExpressionDependency||as instanceof AbsoluteCellRange)&&rs.getRange().addressInRange(as)){const os=this.fetchCellOrCreateEmpty(as);yield[as,os]}}}*rangeDirectDependenciesToArray(ts,rs){const{restRange:ns}=this.rangeMapping.findSmallerRange(ts.range);for(const is of ns.addresses(this))if(rs.getRange().addressInRange(is)){const as=this.fetchCellOrCreateEmpty(is);yield[is,as]}}*adjacentArrayVertices(ts){const rs=this.graph.adjacentNodes(ts);for(const ns of rs)(ns instanceof FormulaVertex||ns instanceof RangeVertex)&&(yield ns)}addStructuralNodesToChangeSet(){for(const ts of this.graph.specialNodesStructuralChanges)this.graph.markNodeAsSpecialRecentlyChanged(ts)}fixRangesWhenAddingRows(ts,rs,ns){const is=Array.from(this.rangeMapping.rangesInSheet(ts));for(const as of is)if(as.range.includesRow(rs+ns))if(as.bruteForce){const os=as.range.rangeWithSameWidth(rs,ns);for(const ls of os.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(ls),as)}else{let os=as,ls=this.rangeMapping.findSmallerRange(os.range);if(ls.smallerRangeVertex!==void 0)continue;for(;ls.smallerRangeVertex===void 0;){const us=new RangeVertex(AbsoluteCellRange.spanFrom(os.range.start,os.range.width(),os.range.height()-1));this.rangeMapping.setRange(us),this.graph.addNode(us);const cs=new AbsoluteCellRange(simpleCellAddress(os.range.start.sheet,os.range.start.col,os.range.end.row),os.range.end);this.addAllFromRange(cs,os),this.graph.addEdge(us,os),os=us,ls=this.rangeMapping.findSmallerRange(os.range)}this.graph.addEdge(ls.smallerRangeVertex,os),this.addAllFromRange(ls.restRange,os),this.graph.removeEdge(ls.smallerRangeVertex,as)}}addAllFromRange(ts,rs){for(const ns of ts.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(ns),rs)}fixRangesWhenAddingColumns(ts,rs,ns){for(const is of this.rangeMapping.rangesInSheet(ts))if(is.range.includesColumn(rs+ns)){let as;is.bruteForce?as=is.range.rangeWithSameHeight(rs,ns):as=AbsoluteCellRange.spanFrom(simpleCellAddress(ts,rs,is.range.end.row),ns,1);for(const os of as.addresses(this))this.graph.addEdge(this.fetchCellOrCreateEmpty(os),is)}}exchangeOrAddFormulaVertex(ts){const rs=ts.getAddress(this.lazilyTransformingAstService),ns=AbsoluteCellRange.spanFrom(rs,ts.width,ts.height),is=this.shrinkPossibleArrayAndGetCell(rs);if(ts instanceof ArrayVertex&&this.setArray(ns,ts),this.exchangeOrAddGraphNode(is,ts),this.addressMapping.setCell(rs,ts),ts instanceof ArrayVertex){if(!this.isThereSpaceForArray(ts))return;for(const as of ns.addresses(this)){if(ts.isLeftCorner(as))continue;const os=this.getCell(as);this.exchangeOrAddGraphNode(os,ts)}}for(const as of ns.addresses(this))this.addressMapping.setCell(as,ts)}setAddressMappingForArrayVertex(ts,rs){if(this.addressMapping.setCell(rs,ts),!(ts instanceof ArrayVertex))return;const ns=AbsoluteCellRange.spanFromOrUndef(rs,ts.width,ts.height);if(ns!==void 0&&(this.setArray(ns,ts),!!this.isThereSpaceForArray(ts)))for(const is of ns.addresses(this))this.addressMapping.setCell(is,ts)}truncateRanges(ts,rs){const{verticesToRemove:ns,verticesToMerge:is,verticesWithChangedSize:as}=this.rangeMapping.truncateRanges(ts,rs);for(const[os,ls]of is)this.mergeRangeVertices(os,ls);for(const os of ns)this.removeVertexAndCleanupDependencies(os);return as}fixArraysAfterAddingRow(ts,rs,ns){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(ts,rs,ns),!(rs<=0))for(const[,is]of this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(ts,rs-1,rs-1))){const as=is.getRange();for(let os=as.start.col;os<=as.end.col;++os)for(let ls=rs;ls<=as.end.row;++ls){const us=simpleCellAddress(ts,os,ls),cs=simpleCellAddress(ts,os,ls+ns),ps=is.getArrayCellValue(us);this.addressMapping.moveCell(cs,us),this.changes.addChange(EmptyValue,cs,ps)}}}fixArraysAfterRemovingRows(ts,rs,ns){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(ts,rs,-ns),!(rs<=0))for(const[,is]of this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(ts,rs-1,rs-1)))if(this.isThereSpaceForArray(is))for(const as of is.getRange().addresses(this))this.addressMapping.setCell(as,is);else this.setNoSpaceIfArray(is)}fixArraysAfterAddingColumn(ts,rs,ns){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(ts,rs,ns),!(rs<=0))for(const[,is]of this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(ts,rs-1,rs-1))){const as=is.getRange();for(let os=as.start.row;os<=as.end.row;++os)for(let ls=rs;ls<=as.end.col;++ls){const us=simpleCellAddress(ts,ls,os),cs=simpleCellAddress(ts,ls+ns,os),ps=is.getArrayCellValue(us);this.addressMapping.moveCell(cs,us),this.changes.addChange(EmptyValue,cs,ps)}}}fixArraysAfterRemovingColumns(ts,rs,ns){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(ts,rs,-ns),!(rs<=0))for(const[,is]of this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(ts,rs-1,rs-1)))if(this.isThereSpaceForArray(is))for(const as of is.getRange().addresses(this))this.addressMapping.setCell(as,is);else this.setNoSpaceIfArray(is)}shrinkPossibleArrayAndGetCell(ts){const rs=this.getCell(ts);return rs instanceof ArrayVertex?(this.setNoSpaceIfArray(rs),this.getCell(ts)):rs}setNoSpaceIfArray(ts){ts instanceof ArrayVertex&&(this.shrinkArrayToCorner(ts),ts.setNoSpace())}removeVertex(ts){this.removeVertexAndCleanupDependencies(ts),ts instanceof RangeVertex&&this.rangeMapping.removeRange(ts)}mergeRangeVertices(ts,rs){const ns=this.graph.adjacentNodes(rs);this.removeVertexAndCleanupDependencies(rs),this.graph.softRemoveEdge(ts,rs),ns.forEach(is=>{this.graph.hasNode(is)&&this.graph.addEdge(ts,is)})}removeVertexAndCleanupDependencies(ts){const rs=new Set(this.graph.removeNode(ts));for(;rs.size>0;){const ns=rs.values().next().value;rs.delete(ns),this.graph.hasNode(ns)&&this.graph.adjacentNodesCount(ns)===0&&((ns instanceof RangeVertex||ns instanceof EmptyCellVertex)&&this.graph.removeNode(ns).forEach(is=>rs.add(is)),ns instanceof RangeVertex?this.rangeMapping.removeRange(ns):ns instanceof EmptyCellVertex&&this.addressMapping.removeCell(ns.address))}}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class EmptyCellVertex{constructor(ts){this.address=ts}getCellValue(){return EmptyValue}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ValueCellVertex{constructor(ts,rs){this.parsedValue=ts,this.rawValue=rs}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(ts){this.parsedValue=ts.parsedValue,this.rawValue=ts.rawValue}getCellValue(){return this.parsedValue}setCellValue(ts){throw"SetCellValue is deprecated for ValueCellVertex"}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ParsingErrorVertex{constructor(ts,rs){this.errors=ts,this.rawInput=rs}getCellValue(){return CellError.parsingError()}getFormula(){return this.rawInput}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class SparseStrategy{constructor(ts,rs){this.width=ts,this.height=rs,this.mapping=new Map}getCell(ts){var rs;return(rs=this.mapping.get(ts.col))===null||rs===void 0?void 0:rs.get(ts.row)}setCell(ts,rs){this.width=Math.max(this.width,ts.col+1),this.height=Math.max(this.height,ts.row+1);let ns=this.mapping.get(ts.col);ns||(ns=new Map,this.mapping.set(ts.col,ns)),ns.set(ts.row,rs)}has(ts){var rs;return!!(!((rs=this.mapping.get(ts.col))===null||rs===void 0)&&rs.get(ts.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(ts){var rs;(rs=this.mapping.get(ts.col))===null||rs===void 0||rs.delete(ts.row)}addRows(ts,rs){this.mapping.forEach(ns=>{const is=new Map;ns.forEach((as,os)=>{os>=ts&&(is.set(os+rs,as),ns.delete(os))}),is.forEach((as,os)=>{ns.set(os,as)})}),this.height+=rs}addColumns(ts,rs){const ns=new Map;this.mapping.forEach((is,as)=>{as>=ts&&(ns.set(as+rs,is),this.mapping.delete(as))}),ns.forEach((is,as)=>{this.mapping.set(as,is)}),this.width+=rs}removeRows(ts){this.mapping.forEach(is=>{const as=new Map;is.forEach((os,ls)=>{ls>=ts.rowStart&&(is.delete(ls),ls>ts.rowEnd&&as.set(ls-ts.numberOfRows,os))}),as.forEach((os,ls)=>{is.set(ls,os)})});const rs=Math.min(this.height-1,ts.rowEnd),ns=Math.max(0,rs-ts.rowStart+1);this.height=Math.max(0,this.height-ns)}removeColumns(ts){const rs=new Map;this.mapping.forEach((as,os)=>{os>=ts.columnStart&&(this.mapping.delete(os),os>ts.columnEnd&&rs.set(os-ts.numberOfColumns,as))}),rs.forEach((as,os)=>{this.mapping.set(os,as)});const ns=Math.min(this.width-1,ts.columnEnd),is=Math.max(0,ns-ts.columnStart+1);this.width=Math.max(0,this.width-is)}*getEntries(ts){for(const[rs,ns]of this.mapping)for(const[is,as]of ns)yield[simpleCellAddress(ts,rs,is),as]}*verticesFromColumn(ts){const rs=this.mapping.get(ts);if(rs!==void 0)for(const[ns,is]of rs)yield is}*verticesFromRow(ts){for(const rs of this.mapping.values()){const ns=rs.get(ts);ns!==void 0&&(yield ns)}}*verticesFromColumnsSpan(ts){for(const rs of ts.columns()){const ns=this.mapping.get(rs);if(ns!==void 0)for(const[is,as]of ns)yield as}}*verticesFromRowsSpan(ts){for(const rs of this.mapping.values())for(const ns of ts.rows()){const is=rs.get(ns);is!==void 0&&(yield is)}}*entriesFromRowsSpan(ts){for(const[rs,ns]of this.mapping.entries())for(const is of ts.rows()){const as=ns.get(is);as!==void 0&&(yield[simpleCellAddress(ts.sheet,rs,is),as])}}*entriesFromColumnsSpan(ts){for(const rs of ts.columns()){const ns=this.mapping.get(rs);if(ns!==void 0)for(const[is,as]of ns.entries())yield[simpleCellAddress(ts.sheet,rs,is),as]}}*vertices(){for(const[ts,rs]of this.mapping)for(const[ns,is]of rs)is!==void 0&&(yield is)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DenseStrategy{constructor(ts,rs){this.width=ts,this.height=rs,this.mapping=new Array(rs);for(let ns=0;ns<rs;ns++)this.mapping[ns]=new Array(ts)}getCell(ts){return this.getCellVertex(ts.col,ts.row)}setCell(ts,rs){this.width=Math.max(this.width,ts.col+1),this.height=Math.max(this.height,ts.row+1),this.mapping[ts.row]||(this.mapping[ts.row]=new Array(this.width)),this.mapping[ts.row][ts.col]=rs}has(ts){const rs=this.mapping[ts.row];return rs?!!rs[ts.col]:!1}getHeight(){return this.height}getWidth(){return this.width}removeCell(ts){this.mapping[ts.row]!==void 0&&delete this.mapping[ts.row][ts.col]}addRows(ts,rs){const ns=[];for(let is=0;is<rs;is++)ns.push(new Array(this.width));this.mapping.splice(ts,0,...ns),this.height+=rs}addColumns(ts,rs){for(let ns=0;ns<this.height;ns++)this.mapping[ns].splice(ts,0,...new Array(rs));this.width+=rs}removeRows(ts){this.mapping.splice(ts.rowStart,ts.numberOfRows);const rs=Math.min(this.height-1,ts.rowEnd),ns=Math.max(0,rs-ts.rowStart+1);this.height=Math.max(0,this.height-ns)}removeColumns(ts){for(let is=0;is<this.height;is++)this.mapping[is].splice(ts.columnStart,ts.numberOfColumns);const rs=Math.min(this.width-1,ts.columnEnd),ns=Math.max(0,rs-ts.columnStart+1);this.width=Math.max(0,this.width-ns)}*getEntries(ts){for(let rs=0;rs<this.height;++rs)for(let ns=0;ns<this.width;++ns){const is=this.getCellVertex(ns,rs);is&&(yield[simpleCellAddress(ts,ns,rs),is])}}*verticesFromColumn(ts){for(let rs=0;rs<this.height;++rs){const ns=this.getCellVertex(ts,rs);ns&&(yield ns)}}*verticesFromRow(ts){for(let rs=0;rs<this.width;++rs){const ns=this.getCellVertex(rs,ts);ns&&(yield ns)}}*verticesFromColumnsSpan(ts){for(let rs=ts.columnStart;rs<=ts.columnEnd;++rs)for(let ns=0;ns<this.height;++ns){const is=this.getCellVertex(rs,ns);is&&(yield is)}}*verticesFromRowsSpan(ts){for(let rs=0;rs<this.width;++rs)for(let ns=ts.rowStart;ns<=ts.rowEnd;++ns){const is=this.getCellVertex(rs,ns);is&&(yield is)}}*entriesFromRowsSpan(ts){for(let rs=0;rs<this.width;++rs)for(let ns=ts.rowStart;ns<=ts.rowEnd;++ns){const is=this.getCellVertex(rs,ns);is&&(yield[simpleCellAddress(ts.sheet,rs,ns),is])}}*entriesFromColumnsSpan(ts){for(let rs=0;rs<this.height;++rs)for(let ns=ts.columnStart;ns<=ts.columnEnd;++ns){const is=this.getCellVertex(ns,rs);is&&(yield[simpleCellAddress(ts.sheet,ns,rs),is])}}*vertices(){for(let ts=0;ts<this.height;++ts)for(let rs=0;rs<this.width;++rs){const ns=this.getCellVertex(rs,ts);ns&&(yield ns)}}getCellVertex(ts,rs){var ns;return(ns=this.mapping[rs])===null||ns===void 0?void 0:ns[ts]}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var ErrorType;(function(ss){ss.DIV_BY_ZERO="DIV_BY_ZERO",ss.NAME="NAME",ss.VALUE="VALUE",ss.NUM="NUM",ss.NA="NA",ss.CYCLE="CYCLE",ss.REF="REF",ss.SPILL="SPILL",ss.LIC="LIC",ss.ERROR="ERROR"})(ErrorType||(ErrorType={}));var CellType;(function(ss){ss.FORMULA="FORMULA",ss.VALUE="VALUE",ss.ARRAY="ARRAY",ss.EMPTY="EMPTY",ss.ARRAYFORMULA="ARRAYFORMULA"})(CellType||(CellType={}));const getCellType=(ss,ts)=>ss instanceof ArrayVertex?ss.isLeftCorner(ts)?CellType.ARRAYFORMULA:CellType.ARRAY:ss instanceof FormulaCellVertex||ss instanceof ParsingErrorVertex?CellType.FORMULA:ss instanceof ValueCellVertex?CellType.VALUE:CellType.EMPTY;var CellValueNoNumber;(function(ss){ss.EMPTY="EMPTY",ss.NUMBER="NUMBER",ss.STRING="STRING",ss.BOOLEAN="BOOLEAN",ss.ERROR="ERROR"})(CellValueNoNumber||(CellValueNoNumber={}));var CellValueJustNumber;(function(ss){ss.NUMBER="NUMBER"})(CellValueJustNumber||(CellValueJustNumber={}));const CellValueType=Object.assign(Object.assign({},CellValueNoNumber),CellValueJustNumber),CellValueDetailedType=Object.assign(Object.assign({},CellValueNoNumber),NumberType),CellValueTypeOrd=ss=>{switch(ss){case CellValueType.EMPTY:return 0;case CellValueType.NUMBER:return 1;case CellValueType.STRING:return 2;case CellValueType.BOOLEAN:return 3;case CellValueType.ERROR:return 4}throw new Error("Cell value not computed")},getCellValueType=ss=>{if(ss===EmptyValue)return CellValueType.EMPTY;if(ss instanceof CellError||ss instanceof SimpleRangeValue)return CellValueType.ERROR;if(typeof ss=="string")return CellValueType.STRING;if(isExtendedNumber(ss))return CellValueType.NUMBER;if(typeof ss=="boolean")return CellValueType.BOOLEAN;throw new Error("Cell value not computed")},getCellValueDetailedType=ss=>isExtendedNumber(ss)?getTypeOfExtendedNumber(ss):getCellValueType(ss),getCellValueFormat=ss=>{if(isExtendedNumber(ss))return getFormatOfExtendedNumber(ss)};class CellError{constructor(ts,rs,ns){this.type=ts,this.message=rs,this.root=ns}static parsingError(){return new CellError(ErrorType.ERROR,ErrorMessage.ParseError)}attachRootVertex(ts){return this.root===void 0?new CellError(this.type,this.message,ts):this}}const simpleRowAddress=(ss,ts)=>({sheet:ss,row:ts}),invalidSimpleRowAddress=ss=>ss.row<0,simpleColumnAddress=(ss,ts)=>({sheet:ss,col:ts}),invalidSimpleColumnAddress=ss=>ss.col<0,simpleCellAddress=(ss,ts,rs)=>({sheet:ss,col:ts,row:rs}),invalidSimpleCellAddress=ss=>ss.col<0||ss.row<0,movedSimpleCellAddress=(ss,ts,rs,ns)=>simpleCellAddress(ts,ss.col+rs,ss.row+ns),addressKey=ss=>`${ss.sheet},${ss.row},${ss.col}`;function isSimpleCellAddress(ss){return ss&&(typeof ss=="object"||typeof ss=="function")?"col"in ss&&typeof ss.col=="number"&&"row"in ss&&typeof ss.row=="number"&&"sheet"in ss&&typeof ss.sheet=="number":!1}const absoluteSheetReference=(ss,ts)=>{var rs;return(rs=ss.sheet)!==null&&rs!==void 0?rs:ts.sheet},equalSimpleCellAddress=(ss,ts)=>ss.sheet===ts.sheet&&ss.col===ts.col&&ss.row===ts.row;/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DetailedCellError{constructor(ts,rs,ns){var is;this.value=rs,this.address=ns,this.type=ts.type,this.message=(is=ts.message)!==null&&is!==void 0?is:""}toString(){return this.value}valueOf(){return this.value}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function configValueFromParam(ss,ts,rs){if(typeof ss>"u")return Config.defaultConfig[rs];if(typeof ts=="string"){if(typeof ss===ts)return ss;throw new ExpectedValueOfTypeError(ts,rs)}else{if(ts.includes(ss))return ss;throw new ExpectedOneOfValuesError(ts.map(ns=>`'${ns}'`).join(" "),rs)}}function validateNumberToBeAtLeast(ss,ts,rs){if(ss<rs)throw new ConfigValueTooSmallError(ts,rs)}function validateNumberToBeAtMost(ss,ts,rs){if(ss>rs)throw new ConfigValueTooBigError(ts,rs)}function configValueFromParamCheck(ss,ts,rs,ns){if(ts(ss))return ss;if(typeof ss>"u")return Config.defaultConfig[ns];throw new ExpectedValueOfTypeError(rs,ns)}function configCheckIfParametersNotInConflict(...ss){const ts=new Map;ss.forEach(ns=>{const is=ts.get(ns.value)||[];is.push(ns.name),ts.set(ns.value,is)});const rs=[];for(const ns of ts.values())ns.length>1&&rs.push(ns);if(rs.length>0){rs.forEach(is=>is.sort());const ns=rs.map(is=>`[${is}]`).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${ns}`)}}function validateArgToType(ss,ts,rs){if(typeof ss!==ts)throw new ExpectedValueOfTypeError(ts,rs)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function defaultParseToDateTime(ss,ts,rs){ss=ss.replace(/\s\s+/g," ").trim().toLowerCase();let ns=ss.substring(ss.length-2);ns==="am"||ns==="pm"?ss=ss.substring(0,ss.length-2).trim():(ns=ss.substring(ss.length-1),ns==="a"||ns==="p"?ss=ss.substring(0,ss.length-1).trim():ns=void 0);const is=ss.split(/[ /.-]/g);is.length>=2&&is[is.length-2].includes(":")&&(is[is.length-2]=is[is.length-2]+"."+is[is.length-1],is.pop());const as=is[is.length-1].split(":");if(ns!==void 0&&as.push(ns),is.length===1)return defaultParseToTime(as,rs);if(as.length===1)return defaultParseToDate(is,ts);const os=defaultParseToDate(is.slice(0,is.length-1),ts),ls=defaultParseToTime(as,rs);if(os!==void 0)return ls===void 0?void 0:Object.assign(Object.assign({},os),ls)}const secondsExtendedRegexp=/^ss(\.(s+|0+))?$/;function defaultParseToTime(ss,ts){if(ts===void 0)return;ts=ts.toLowerCase(),ts.endsWith("am/pm")?ts=ts.substring(0,ts.length-5).trim():ts.endsWith("a/p")&&(ts=ts.substring(0,ts.length-3).trim());const ns=ts.split(":");let is;if(ss[ss.length-1]==="am"||ss[ss.length-1]==="a"?(is=!1,ss.pop()):(ss[ss.length-1]==="pm"||ss[ss.length-1]==="p")&&(is=!0,ss.pop()),ss.length!==ns.length)return;const as=ns.indexOf("hh"),os=ns.indexOf("mm"),ls=ns.findIndex(ys=>secondsExtendedRegexp.test(ys)),us=as!==-1?ss[as]:"0";if(!/^\d+$/.test(us))return;let cs=Number(us);if(is!==void 0){if(cs<0||cs>12)return;cs=cs%12,is&&(cs=cs+12)}const ps=os!==-1?ss[os]:"0";if(!/^\d+$/.test(ps))return;const ds=Number(ps),fs=ls!==-1?ss[ls]:"0";if(!/^\d+(\.\d+)?$/.test(fs))return;const hs=Math.round(Number(fs)*1e3)/1e3;return{hours:cs,minutes:ds,seconds:hs}}function defaultParseToDate(ss,ts){if(ts===void 0)return;const rs=ts.toLowerCase().split(/[ /.-]/g);if(ss.length!==rs.length)return;const ns=rs.indexOf("mm"),is=rs.indexOf("dd"),as=rs.indexOf("yyyy"),os=rs.indexOf("yy");if(!(ns in ss)||!(is in ss)||!(as in ss)&&!(os in ss)||as in ss&&os in ss)return;let ls;if(as in ss){const fs=ss[as];if(/^\d+$/.test(fs)){if(ls=Number(fs),ls<1e3||ls>9999)return}else return}else{const fs=ss[os];if(/^\d+$/.test(fs)){if(ls=Number(fs),ls<0||ls>99)return}else return}const us=ss[ns];if(!/^\d+$/.test(us))return;const cs=Number(us),ps=ss[is];if(!/^\d+$/.test(ps))return;const ds=Number(ps);return{year:ls,month:cs,day:ds}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const numDays=[31,28,31,30,31,30,31,31,30,31,30,31],prefSumDays=[0,31,59,90,120,151,181,212,243,273,304,334],SECONDS_PER_MINUTE=60,MINUTES_PER_HOUR=60,HOURS_PER_DAY=24;function instanceOfSimpleDate(ss){return ss&&(typeof ss=="object"||typeof ss=="function")?"year"in ss&&typeof ss.year=="number"&&"month"in ss&&typeof ss.month=="number"&&"day"in ss&&typeof ss.day=="number":!1}function instanceOfSimpleTime(ss){return ss&&(typeof ss=="object"||typeof ss=="function")?"hours"in ss&&typeof ss.hours=="number"&&"minutes"in ss&&typeof ss.minutes=="number"&&"seconds"in ss&&typeof ss.seconds=="number":!1}const maxDate={year:9999,month:12,day:31};class DateTimeHelper{constructor(ts){this.config=ts,this.minDateAbsoluteValue=this.dateToNumberFromZero(ts.nullDate),this.maxDateValue=this.dateToNumber(maxDate),this.leapYear1900=ts.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=ts.parseDateTime}getWithinBounds(ts){return ts<=this.maxDateValue&&ts>=0?ts:void 0}dateStringToDateNumber(ts){const{dateTime:rs,dateFormat:ns="",timeFormat:is=""}=this.parseDateTimeFromConfigFormats(ts);if(rs!==void 0)return instanceOfSimpleTime(rs)?instanceOfSimpleDate(rs)?new DateTimeNumber(timeToNumber(rs)+this.dateToNumber(rs),ns+" "+is):new TimeNumber(timeToNumber(rs),is):instanceOfSimpleDate(rs)?new DateNumber(this.dateToNumber(rs),ns):0}parseDateTimeFromConfigFormats(ts){return this.parseDateTimeFromFormats(ts,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(ts){return isNaN(ts.year)||isNaN(ts.month)||isNaN(ts.day)||ts.day!==Math.round(ts.day)||ts.month!==Math.round(ts.month)||ts.year!==Math.round(ts.year)||ts.year<1582||ts.month<1||ts.month>12||ts.day<1?!1:this.isLeapYear(ts.year)&&ts.month===2?ts.day<=29:ts.day<=numDays[ts.month-1]}dateToNumber(ts){return this.dateToNumberFromZero(ts)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(ts){return ts+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(ts){const rs=Math.floor(ts)+this.minDateAbsoluteValue;let ns=Math.floor(rs/365.2425);this.dateToNumberFromZero({year:ns+1,month:1,day:1})<=rs?ns++:this.dateToNumberFromZero({year:ns-1,month:1,day:1})>rs&&ns--;const is=rs-this.dateToNumberFromZero({year:ns,month:1,day:1}),as=dayToMonth(is-(this.isLeapYear(ns)&&is>=59?1:0)),os=is-prefSumDays[as]-(this.isLeapYear(ns)&&as>1?1:0);return{year:ns,month:as+1,day:os+1}}numberToSimpleDateTime(ts){const rs=numberToSimpleTime(ts%1),ns=Math.floor(rs.hours/HOURS_PER_DAY);rs.hours=rs.hours%HOURS_PER_DAY;const is=this.numberToSimpleDate(Math.floor(ts)+ns);return Object.assign(Object.assign({},is),rs)}leapYearsCount(ts){return Math.floor(ts/4)-Math.floor(ts/100)+Math.floor(ts/400)+(this.config.leapYear1900&&ts>=1900?1:0)}daysInMonth(ts,rs){return this.isLeapYear(ts)&&rs===2?29:numDays[rs-1]}endOfMonth(ts){return{year:ts.year,month:ts.month,day:this.daysInMonth(ts.year,ts.month)}}toBasisUS(ts,rs){return ts.day===31&&(ts.day=30),ts.day===30&&rs.day===31&&(rs.day=30),ts.month===2&&ts.day===this.daysInMonth(ts.year,ts.month)&&(ts.day=30,rs.month===2&&rs.day===this.daysInMonth(rs.year,rs.month)&&(rs.day=30)),[ts,rs]}yearLengthForBasis(ts,rs){return ts.year!==rs.year?ts.year+1!==rs.year||ts.month<rs.month||ts.month===rs.month&&ts.day<rs.day?(this.leapYearsCount(rs.year)-this.leapYearsCount(ts.year-1))/(rs.year-ts.year+1)+365:this.countLeapDays(rs)!==this.countLeapDays({year:ts.year,month:ts.month,day:ts.day-1})?366:365:this.isLeapYear(ts.year)?366:365}parseSingleFormat(ts,rs,ns){const is=this.parseDateTime(ts,rs,ns);if(!(instanceOfSimpleDate(is)&&(is.year>=0&&is.year<100&&(is.year<this.getNullYear()?is.year+=2e3:is.year+=1900),!this.isValidDate(is))))return is}parseDateTimeFromFormats(ts,rs,ns){const is=rs.length===0?[void 0]:rs,as=ns.length===0?[void 0]:ns;for(const os of is)for(const ls of as){const us=this.parseSingleFormat(ts,os,ls);if(us!==void 0)return{dateTime:us,timeFormat:ls,dateFormat:os}}return{}}countLeapDays(ts){return ts.month>2||ts.month===2&&ts.day>=29?this.leapYearsCount(ts.year):this.leapYearsCount(ts.year-1)}dateToNumberFromZero(ts){return 365*ts.year+prefSumDays[ts.month-1]+ts.day-1+(ts.month<=2?this.leapYearsCount(ts.year-1):this.leapYearsCount(ts.year))}isLeapYear(ts){return ts%4?!1:ts%100?!0:ts%400?ts===1900&&this.config.leapYear1900:!0}}function dayToMonth(ss){let ts=0;return prefSumDays[ts+6]<=ss&&(ts+=6),prefSumDays[ts+3]<=ss&&(ts+=3),prefSumDays[ts+2]<=ss?ts+=2:prefSumDays[ts+1]<=ss&&(ts+=1),ts}function offsetMonth(ss,ts){const rs=12*ss.year+ss.month-1+ts;return{year:Math.floor(rs/12),month:rs%12+1,day:ss.day}}function truncateDayInMonth(ss){return{year:ss.year,month:ss.month,day:Math.min(ss.day,numDays[ss.month-1])}}function roundToNearestSecond(ss){return Math.round(ss*3600*24)/(3600*24)}function roundToEpsilon(ss,ts=1){return Math.round(ss*ts)/ts}function numberToSimpleTime(ss){const ts=ss*HOURS_PER_DAY*MINUTES_PER_HOUR*SECONDS_PER_MINUTE,rs=roundToEpsilon(ts%SECONDS_PER_MINUTE,1e5)%SECONDS_PER_MINUTE,ns=(ts-rs)/SECONDS_PER_MINUTE,is=Math.round(ns%MINUTES_PER_HOUR)%MINUTES_PER_HOUR,as=(ns-is)/MINUTES_PER_HOUR;return{hours:Math.round(as),minutes:is,seconds:rs}}function timeToNumber(ss){return((ss.seconds/60+ss.minutes)/60+ss.hours)/24}function toBasisEU(ss){return{year:ss.year,month:ss.month,day:Math.min(30,ss.day)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AlwaysDense{call(){return DenseStrategy}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const dateFormatRegex=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,numberFormatRegex=/(\\.|[#0]+(\.[#0]*)?)/g;var TokenType;(function(ss){ss.FORMAT="FORMAT",ss.FREE_TEXT="FREE_TEXT"})(TokenType||(TokenType={}));function formatToken(ss,ts){return{type:ss,value:ts}}var FormatExpressionType;(function(ss){ss.DATE="DATE",ss.NUMBER="NUMBER",ss.STRING="STRING"})(FormatExpressionType||(FormatExpressionType={}));function matchDateFormat(ss){dateFormatRegex.lastIndex=0;const ts=[];let rs;do rs=dateFormatRegex.exec(ss),rs!==null&&ts.push(rs);while(rs);return ts}function matchNumberFormat(ss){numberFormatRegex.lastIndex=0;const ts=numberFormatRegex.exec(ss);return ts!==null?[ts]:[]}function createTokens(ss,ts){const rs=[];let ns=0;for(let as=0;as<ss.length;++as){const os=ss[as];if(os.index!==ns){const ls=ts.substr(ns,os.index-ns);rs.push(formatToken(TokenType.FREE_TEXT,ls))}os[0].startsWith("\\")?rs.push(formatToken(TokenType.FREE_TEXT,os[0])):rs.push(formatToken(TokenType.FORMAT,os[0])),ns=os.index+os[0].length}const is=ss[ss.length-1];if(is.index+is[0].length<ts.length){const as=ts.substr(is.index+is[0].length,ts.length);rs.push(formatToken(TokenType.FREE_TEXT,as))}return rs}function parseForDateTimeFormat(ss){const ts=matchDateFormat(ss);if(!ts.every(rs=>isEscapeToken(rs)))return{type:FormatExpressionType.DATE,tokens:createTokens(ts,ss)}}function parseForNumberFormat(ss){const ts=matchNumberFormat(ss);if(!ts.every(rs=>isEscapeToken(rs)))return{type:FormatExpressionType.NUMBER,tokens:createTokens(ts,ss)}}function isEscapeToken(ss){return ss[0].startsWith("\\")}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function format(ss,ts,rs,ns){const is=rs.stringifyDateTime(ns.numberToSimpleDateTime(ss),ts);if(is!==void 0)return is;const as=rs.stringifyDuration(numberToSimpleTime(ss),ts);if(as!==void 0)return as;const os=parseForNumberFormat(ts);return os!==void 0?numberFormat(os.tokens,ss):ts}function padLeft(ss,ts){let rs=ss+"";for(;rs.length<ts;)rs="0"+rs;return rs}function padRight(ss,ts){let rs=ss+"";for(;rs.length<ts;)rs=rs+"0";return rs}function countChars(ss,ts){return ss.split(ts).length-1}function numberFormat(ss,ts){let rs="";for(let ns=0;ns<ss.length;++ns){const is=ss[ns];if(is.type===TokenType.FREE_TEXT){rs+=is.value;continue}const as=is.value.split("."),os=as[0],ls=as[1]||"",us=as[1]?".":"",cs=Number(ts.toFixed(ls.length)).toString().split(".");let ps=cs[0]||"",ds=cs[1]||"";if(os.length>ps.length){const hs=countChars(os.substr(0,os.length-ps.length),"0");ps=padLeft(ps,hs+ps.length)}const fs=countChars(ls.substr(ds.length,ls.length-ds.length),"0");ds=padRight(ds,fs+ds.length),rs+=ps+us+ds}return rs}function defaultStringifyDuration(ss,ts){const rs=parseForDateTimeFormat(ts);if(rs===void 0)return;const ns=rs.tokens;let is="";for(const as of ns){if(as.type===TokenType.FREE_TEXT){is+=as.value;continue}switch(as.value.toLowerCase()){case"h":case"hh":{is+=padLeft(ss.hours,as.value.length),ss.hours=0;break}case"[hh]":{is+=padLeft(ss.hours,as.value.length-2),ss.hours=0;break}case"m":case"mm":{is+=padLeft(ss.minutes,as.value.length),ss.minutes=0;break}case"[mm]":{is+=padLeft(ss.minutes+60*ss.hours,as.value.length-2),ss.minutes=0,ss.hours=0;break}case"s":case"ss":{is+=padLeft(Math.floor(ss.seconds),as.value.length);break}default:{if(secondsExtendedRegexp.test(as.value)){const os=Math.max(as.value.length-3,0);is+=(ss.seconds<10?"0":"")+Math.floor(ss.seconds*Math.pow(10,os))/Math.pow(10,os);continue}return}}}return is}function defaultStringifyDateTime(ss,ts){const rs=parseForDateTimeFormat(ts);if(rs===void 0)return;const ns=rs.tokens;let is="",as=!1;const os=ns.some(ls=>ls.type===TokenType.FORMAT&&(ls.value==="a/p"||ls.value==="A/P"||ls.value==="am/pm"||ls.value==="AM/PM"));for(let ls=0;ls<ns.length;ls++){const us=ns[ls];if(us.type===TokenType.FREE_TEXT){is+=us.value;continue}switch(us.value.toLowerCase()){case"h":case"hh":{as=!0,is+=padLeft(os?(ss.hours+11)%12+1:ss.hours,us.value.length);break}case"d":case"dd":{is+=padLeft(ss.day,us.value.length);break}case"s":case"ss":{is+=padLeft(Math.floor(ss.seconds),us.value.length);break}case"m":case"mm":{ls+1<ns.length&&ns[ls+1].value.startsWith(":")&&(as=!0),as?is+=padLeft(ss.minutes,us.value.length):is+=padLeft(ss.month,us.value.length),as=!0;break}case"yy":{is+=padLeft(ss.year%100,us.value.length);break}case"yyyy":{is+=ss.year;break}case"am/pm":case"a/p":{const[cs,ps]=us.value.split("/");is+=ss.hours<12?cs:ps;break}default:{if(secondsExtendedRegexp.test(us.value)){const cs=us.value.length-3;is+=(ss.seconds<10?"0":"")+Math.floor(ss.seconds*Math.pow(10,cs))/Math.pow(10,cs);continue}return}}}return is}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const _rl="length",_hd=ss=>parseInt(ss,16),_pi=ss=>parseInt(ss,10),_nm=ss=>(ss+"").replace(/\-/g,""),_ss=(ss,ts,rs)=>ss.substr(ts,rs),_cp=ss=>ss.codePointAt(0)-65;function extractTime(ss){return _nm(ss)[_rl]===25?_hd(_ss(_nm(ss),_hd("12"),_cp("F")))/(_hd(_ss(_nm(ss),_cp("C"),_cp("Y")>>4))||(~~![][_rl]<<3)+1):0}function checkKeySchema(ss){if(ss=(ss+"").replace(/\-/g,""),ss[_rl]!==_cp("Z"))return!1;let ts=0;return[[0,_cp("G")+1],[_cp("H"),_cp("H")-1],[_cp("G")+_cp("H"),_cp("G")]].reduce((rs,[ns,is],as)=>(rs|=(_pi(`${_pi(_hd(_ss(ss,ts+ns-(as===0?0:2),is+(as?2:0)))+(_hd(_ss(ss,ts+ns+is,2))+[]).padStart(2,"0"))}`)%97||2)>>1,ts+=2,rs),_cp("A"))===[]+1>>1}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const consoleMessages={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:ss})=>`The license key for HyperFormula expired on ${ss}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let _notified=!1;function checkLicenseKeyValidity(ss){const ts={template:"missing",vars:{}};if(ss==="gpl-v3"||ss==="internal-use-in-handsontable")ts.template="valid";else if(typeof ss=="string"&&checkKeySchema(ss)){const[rs,ns,is]="08/09/2022".split("/"),as=Math.floor(new Date(`${ns}/${rs}/${is}`).getTime()/864e5),os=extractTime(ss);ts.vars.keyValidityDate=formatDate(new Date((os+1)*864e5)),as>os?ts.template="expired":ts.template="valid"}else ss!==""&&(ts.template="invalid");return!_notified&&ts.template!=="valid"&&(console.warn(consoleMessages[ts.template](ts.vars)),_notified=!0),ts.template}function formatDate(ss){const rs=["January","February","March","April","May","June","July","August","September","October","November","December"][ss.getMonth()],ns=ss.getDate(),is=ss.getFullYear();return`${rs} ${ns}, ${is}`}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var CellContent;(function(ss){class ts{constructor(us){this.value=us,this.value=cloneNumber(this.value,fixNegativeZero(getRawValue(this.value)))}}ss.Number=ts;class rs{constructor(us){this.value=us}}ss.String=rs;class ns{constructor(us){this.value=us}}ss.Boolean=ns;class is{static getSingletonInstance(){return is.instance||(is.instance=new is),is.instance}}ss.Empty=is;class as{constructor(us){this.formula=us}}ss.Formula=as;class os{constructor(us,cs){this.value=new CellError(us,cs)}}ss.Error=os})(CellContent||(CellContent={}));function isFormula(ss){return ss.startsWith("=")}function isBoolean(ss){const ts=ss.toLowerCase();return ts==="true"||ts==="false"}function isError(ss,ts){const rs=ss.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(rs)&&Object.prototype.hasOwnProperty.call(ts,rs)}class CellContentParser{constructor(ts,rs,ns){this.config=ts,this.dateHelper=rs,this.numberLiteralsHelper=ns}parse(ts){if(ts==null)return CellContent.Empty.getSingletonInstance();if(typeof ts=="number")return isNumberOverflow(ts)?new CellContent.Error(ErrorType.NUM,ErrorMessage.ValueLarge):new CellContent.Number(ts);if(typeof ts=="boolean")return new CellContent.Boolean(ts);if(ts instanceof Date){const rs=this.dateHelper.dateToNumber({day:ts.getDate(),month:ts.getMonth()+1,year:ts.getFullYear()}),ns=timeToNumber({hours:ts.getHours(),minutes:ts.getMinutes(),seconds:ts.getSeconds()+ts.getMilliseconds()/1e3}),is=rs+ns;return is<0?new CellContent.Error(ErrorType.NUM,ErrorMessage.DateBounds):is%1===0?new CellContent.Number(new DateNumber(is,"Date()")):is<1?new CellContent.Number(new TimeNumber(is,"Date()")):new CellContent.Number(new DateTimeNumber(is,"Date()"))}else if(typeof ts=="string"){if(isBoolean(ts))return new CellContent.Boolean(ts.toLowerCase()==="true");if(isFormula(ts))return new CellContent.Formula(ts);if(isError(ts,this.config.errorMapping))return new CellContent.Error(this.config.errorMapping[ts.toUpperCase()]);{let rs=ts.trim(),ns=0,is;if(rs.endsWith("%"))ns=1,rs=rs.slice(0,rs.length-1);else{const ls=this.currencyMatcher(rs);ls!==void 0&&(ns=2,[is,rs]=ls)}const as=this.numberLiteralsHelper.numericStringToMaybeNumber(rs);if(as!==void 0){let ls;return ns===1?ls=new PercentNumber(as/100):ns===2?ls=new CurrencyNumber(as,is):ls=as,new CellContent.Number(ls)}const os=this.dateHelper.dateStringToDateNumber(rs);return os!==void 0?new CellContent.Number(os):new CellContent.String(ts.startsWith("'")?ts.slice(1):ts)}}else throw new UnableToParseError(ts)}currencyMatcher(ts){for(const rs of this.config.currencySymbol){if(ts.startsWith(rs))return[rs,ts.slice(rs.length)];if(ts.endsWith(rs))return[rs,ts.slice(0,ts.length-rs.length)]}}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var ClipboardOperationType;(function(ss){ss[ss.COPY=0]="COPY",ss[ss.CUT=1]="CUT"})(ClipboardOperationType||(ClipboardOperationType={}));var ClipboardCellType;(function(ss){ss[ss.VALUE=0]="VALUE",ss[ss.EMPTY=1]="EMPTY",ss[ss.FORMULA=2]="FORMULA",ss[ss.PARSING_ERROR=3]="PARSING_ERROR"})(ClipboardCellType||(ClipboardCellType={}));class Clipboard{constructor(ts,rs,ns,is,as){this.sourceLeftCorner=ts,this.width=rs,this.height=ns,this.type=is,this.content=as}*getContent(ts){if(this.content!==void 0)for(let rs=0;rs<this.height;++rs)for(let ns=0;ns<this.width;++ns)yield[simpleCellAddress(ts.sheet,ts.col+ns,ts.row+rs),this.content[rs][ns]]}}class ClipboardOperations{constructor(ts,rs,ns){this.dependencyGraph=rs,this.operations=ns,this.maxRows=ts.maxRows,this.maxColumns=ts.maxColumns}cut(ts,rs,ns){this.clipboard=new Clipboard(ts,rs,ns,ClipboardOperationType.CUT)}copy(ts,rs,ns){const is=[];for(let as=0;as<ns;++as){is[as]=[];for(let os=0;os<rs;++os){const ls=this.operations.getClipboardCell(simpleCellAddress(ts.sheet,ts.col+os,ts.row+as));is[as].push(ls)}}this.clipboard=new Clipboard(ts,rs,ns,ClipboardOperationType.COPY,is)}abortCut(){this.clipboard&&this.clipboard.type===ClipboardOperationType.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(ts){if(this.clipboard===void 0)return;if(invalidSimpleCellAddress(ts)||!this.dependencyGraph.sheetMapping.hasSheetWithId(ts.sheet))throw new InvalidArgumentsError("a valid target address.");const rs=AbsoluteCellRange.spanFrom(ts,this.clipboard.width,this.clipboard.height);if(rs.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(rs))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return this.clipboard!==void 0&&this.clipboard.type===ClipboardOperationType.CUT}isCopyClipboard(){return this.clipboard!==void 0&&this.clipboard.type===ClipboardOperationType.COPY}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class InternalNamedExpression{constructor(ts,rs,ns,is){this.displayName=ts,this.address=rs,this.added=ns,this.options=is}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new InternalNamedExpression(this.displayName,this.address,this.added,this.options)}}class WorkbookStore{constructor(){this.mapping=new Map}has(ts){return this.mapping.has(this.normalizeExpressionName(ts))}isNameAvailable(ts){const rs=this.normalizeExpressionName(ts),ns=this.mapping.get(rs);return!(ns&&ns.added)}add(ts){this.mapping.set(ts.normalizeExpressionName(),ts)}get(ts){return this.mapping.get(this.normalizeExpressionName(ts))}getExisting(ts){const rs=this.mapping.get(this.normalizeExpressionName(ts));if(rs&&rs.added)return rs}remove(ts){const rs=this.normalizeExpressionName(ts),ns=this.mapping.get(rs);ns&&(ns.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(ts=>ts.added)}normalizeExpressionName(ts){return ts.toLowerCase()}}class WorksheetStore{constructor(){this.mapping=new Map}add(ts){this.mapping.set(this.normalizeExpressionName(ts.displayName),ts)}get(ts){return this.mapping.get(this.normalizeExpressionName(ts))}has(ts){return this.mapping.has(this.normalizeExpressionName(ts))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter(ts=>ts.added)}isNameAvailable(ts){const rs=this.normalizeExpressionName(ts);return!this.mapping.has(rs)}remove(ts){const rs=this.normalizeExpressionName(ts);this.mapping.get(rs)&&this.mapping.delete(rs)}normalizeExpressionName(ts){return ts.toLowerCase()}}class NamedExpressions{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new WorkbookStore,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(ts,rs){var ns,is;return rs===void 0?this.workbookStore.isNameAvailable(ts):(is=(ns=this.worksheetStore(rs))===null||ns===void 0?void 0:ns.isNameAvailable(ts))!==null&&is!==void 0?is:!0}namedExpressionInAddress(ts){const rs=this.addressCache.get(ts);if(rs&&rs.added)return rs}namedExpressionForScope(ts,rs){var ns;return rs===void 0?this.workbookStore.getExisting(ts):(ns=this.worksheetStore(rs))===null||ns===void 0?void 0:ns.get(ts)}nearestNamedExpression(ts,rs){var ns,is;return(is=(ns=this.worksheetStore(rs))===null||ns===void 0?void 0:ns.get(ts))!==null&&is!==void 0?is:this.workbookStore.getExisting(ts)}isExpressionInScope(ts,rs){var ns,is;return(is=(ns=this.worksheetStore(rs))===null||ns===void 0?void 0:ns.has(ts))!==null&&is!==void 0?is:!1}isNameValid(ts){return/^[A-Za-z]+[0-9]+$/.test(ts)?!1:/^[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*$/.test(ts)}addNamedExpression(ts,rs,ns){const is=rs===void 0?this.workbookStore:this.worksheetStoreOrCreate(rs);let as=is.get(ts);return as!==void 0?(as.added=!0,as.displayName=ts,as.options=ns):(as=new InternalNamedExpression(ts,this.nextAddress(),!0,ns),is.add(as)),this.addressCache.set(as.address.row,as),as}restoreNamedExpression(ts,rs){const ns=rs===void 0?this.workbookStore:this.worksheetStoreOrCreate(rs);return ts.added=!0,ns.add(ts),this.addressCache.set(ts.address.row,ts),ts}namedExpressionOrPlaceholder(ts,rs){var ns;return(ns=this.worksheetStoreOrCreate(rs).get(ts))!==null&&ns!==void 0?ns:this.workbookNamedExpressionOrPlaceholder(ts)}workbookNamedExpressionOrPlaceholder(ts){let rs=this.workbookStore.get(ts);return rs===void 0&&(rs=new InternalNamedExpression(ts,this.nextAddress(),!1),this.workbookStore.add(rs)),rs}remove(ts,rs){let ns;rs===void 0?ns=this.workbookStore:ns=this.worksheetStore(rs);const is=ns==null?void 0:ns.get(ts);if(ns===void 0||is===void 0||!is.added)throw"Named expression does not exist";ns.remove(ts),ns instanceof WorksheetStore&&ns.mapping.size===0&&this.worksheetStores.delete(rs),this.addressCache.delete(is.address.row)}getAllNamedExpressionsNamesInScope(ts){return this.getAllNamedExpressions().filter(({scope:rs})=>rs===ts).map(rs=>rs.expression.displayName)}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map(ts=>ts.expression.displayName)}getAllNamedExpressions(){const ts=[];return this.workbookStore.getAllNamedExpressions().forEach(rs=>{ts.push({expression:rs,scope:void 0})}),this.worksheetStores.forEach((rs,ns)=>{rs.getAllNamedExpressions().forEach(is=>{ts.push({expression:is,scope:ns})})}),ts}getAllNamedExpressionsForScope(ts){var rs,ns;return ts===void 0?this.workbookStore.getAllNamedExpressions():(ns=(rs=this.worksheetStores.get(ts))===null||rs===void 0?void 0:rs.getAllNamedExpressions())!==null&&ns!==void 0?ns:[]}worksheetStoreOrCreate(ts){let rs=this.worksheetStores.get(ts);return rs||(rs=new WorksheetStore,this.worksheetStores.set(ts,rs)),rs}worksheetStore(ts){return this.worksheetStores.get(ts)}nextAddress(){return simpleCellAddress(NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const doesContainRelativeReferences=ss=>{switch(ss.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case AstNodeType.CELL_REFERENCE:return!ss.reference.isAbsolute();case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:return!ss.start.isAbsolute();case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return doesContainRelativeReferences(ss.value);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return doesContainRelativeReferences(ss.left)||doesContainRelativeReferences(ss.right);case AstNodeType.PARENTHESIS:return doesContainRelativeReferences(ss.expression);case AstNodeType.FUNCTION_CALL:return ss.args.some(ts=>doesContainRelativeReferences(ts));case AstNodeType.ARRAY:return ss.args.some(ts=>ts.some(rs=>doesContainRelativeReferences(rs)))}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Transformer{performEagerTransformations(ts,rs){for(const ns of ts.arrayFormulaNodes()){const[is,as]=this.transformSingleAst(ns.getFormula(ts.lazilyTransformingAstService),ns.getAddress(ts.lazilyTransformingAstService)),os=rs.rememberNewAst(is);ns.setFormula(os),ns.setAddress(as)}}transformSingleAst(ts,rs){const ns=this.transformAst(ts,rs),is=this.fixNodeAddress(rs);return[ns,is]}transformAst(ts,rs){switch(ts.type){case AstNodeType.CELL_REFERENCE:return this.transformCellReferenceAst(ts,rs);case AstNodeType.CELL_RANGE:return this.transformCellRangeAst(ts,rs);case AstNodeType.COLUMN_RANGE:return this.transformColumnRangeAst(ts,rs);case AstNodeType.ROW_RANGE:return this.transformRowRangeAst(ts,rs);case AstNodeType.EMPTY:case AstNodeType.ERROR:case AstNodeType.NUMBER:case AstNodeType.NAMED_EXPRESSION:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.STRING:return ts;case AstNodeType.PERCENT_OP:case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:return Object.assign(Object.assign({},ts),{value:this.transformAst(ts.value,rs)});case AstNodeType.FUNCTION_CALL:return Object.assign(Object.assign({},ts),{procedureName:ts.procedureName,args:ts.args.map(ns=>this.transformAst(ns,rs))});case AstNodeType.PARENTHESIS:return Object.assign(Object.assign({},ts),{expression:this.transformAst(ts.expression,rs)});case AstNodeType.ARRAY:return Object.assign(Object.assign({},ts),{args:ts.args.map(ns=>ns.map(is=>this.transformAst(is,rs)))});default:return Object.assign(Object.assign({},ts),{left:this.transformAst(ts.left,rs),right:this.transformAst(ts.right,rs)})}}transformCellReferenceAst(ts,rs){const ns=this.transformCellAddress(ts.reference,rs);return ns instanceof CellAddress?Object.assign(Object.assign({},ts),{reference:ns}):ns===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):ts}transformCellRangeAst(ts,rs){const ns=this.transformCellRange(ts.start,ts.end,rs);return Array.isArray(ns)?Object.assign(Object.assign({},ts),{start:ns[0],end:ns[1]}):ns===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):ts}transformColumnRangeAst(ts,rs){const ns=this.transformColumnRange(ts.start,ts.end,rs);return Array.isArray(ns)?Object.assign(Object.assign({},ts),{start:ns[0],end:ns[1]}):ns===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):ts}transformRowRangeAst(ts,rs){const ns=this.transformRowRange(ts.start,ts.end,rs);return Array.isArray(ns)?Object.assign(Object.assign({},ts),{start:ns[0],end:ns[1]}):ns===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AddColumnsTransformer extends Transformer{constructor(ts){super(),this.columnsSpan=ts}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(ts,rs){return ts}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){throw Error("Not implemented")}transformColumnRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformCellAddress(ts,rs){const ns=absoluteSheetReference(ts,rs);if(ns!==this.columnsSpan.sheet&&rs.sheet!==this.columnsSpan.sheet)return!1;const is=ts.toSimpleColumnAddress(rs);return ns===this.columnsSpan.sheet&&rs.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=is.col?ts.shiftedByColumns(this.columnsSpan.numberOfColumns):!1:rs.sheet===this.columnsSpan.sheet&&ns!==this.columnsSpan.sheet?ts.isColumnAbsolute()||rs.col<this.columnsSpan.columnStart?!1:ts.shiftedByColumns(-this.columnsSpan.numberOfColumns):ts.isColumnAbsolute()?ts.col<this.columnsSpan.columnStart?!1:ts.shiftedByColumns(this.columnsSpan.numberOfColumns):ts.toSimpleColumnAddress(rs).col<this.columnsSpan.columnStart?rs.col<this.columnsSpan.columnStart?!1:ts.shiftedByColumns(-this.columnsSpan.numberOfColumns):rs.col<this.columnsSpan.columnStart?ts.shiftedByColumns(this.columnsSpan.numberOfColumns):!1}fixNodeAddress(ts){return this.columnsSpan.sheet===ts.sheet&&this.columnsSpan.columnStart<=ts.col?Object.assign(Object.assign({},ts),{col:ts.col+this.columnsSpan.numberOfColumns}):ts}transformRange(ts,rs,ns){const is=this.transformCellAddress(ts,ns),as=this.transformCellAddress(rs,ns);return is===ErrorType.REF||as===ErrorType.REF?ErrorType.REF:is||as?[is||ts,as||rs]:!1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AddRowsTransformer extends Transformer{constructor(ts){super(),this.rowsSpan=ts}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(ts,rs){return ts}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformColumnRange(ts,rs,ns){throw Error("Not implemented")}transformCellAddress(ts,rs){const ns=absoluteSheetReference(ts,rs);if(ns!==this.rowsSpan.sheet&&rs.sheet!==this.rowsSpan.sheet)return!1;const is=ts.toSimpleRowAddress(rs);return ns===this.rowsSpan.sheet&&rs.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=is.row?ts.shiftedByRows(this.rowsSpan.numberOfRows):!1:rs.sheet===this.rowsSpan.sheet&&ns!==this.rowsSpan.sheet?ts.isRowAbsolute()||rs.row<this.rowsSpan.rowStart?!1:ts.shiftedByRows(-this.rowsSpan.numberOfRows):ts.isRowAbsolute()?ts.row<this.rowsSpan.rowStart?!1:ts.shiftedByRows(this.rowsSpan.numberOfRows):is.row<this.rowsSpan.rowStart?rs.row<this.rowsSpan.rowStart?!1:ts.shiftedByRows(-this.rowsSpan.numberOfRows):rs.row<this.rowsSpan.rowStart?ts.shiftedByRows(this.rowsSpan.numberOfRows):!1}fixNodeAddress(ts){return this.rowsSpan.sheet===ts.sheet&&this.rowsSpan.rowStart<=ts.row?Object.assign(Object.assign({},ts),{row:ts.row+this.rowsSpan.numberOfRows}):ts}transformRange(ts,rs,ns){const is=this.transformCellAddress(ts,ns),as=this.transformCellAddress(rs,ns);return is===ErrorType.REF||as===ErrorType.REF?ErrorType.REF:is||as?[is||ts,as||rs]:!1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CleanOutOfScopeDependenciesTransformer extends Transformer{constructor(ts){super(),this.sheet=ts}isIrreversible(){return!0}fixNodeAddress(ts){return ts}transformCellAddress(ts,rs){return ts.isInvalid(rs)?ErrorType.REF:!1}transformCellRange(ts,rs,ns){return ts.isInvalid(ns)||rs.isInvalid(ns)?ErrorType.REF:!1}transformColumnRange(ts,rs,ns){return ts.isInvalid(ns)||rs.isInvalid(ns)?ErrorType.REF:!1}transformRowRange(ts,rs,ns){return ts.isInvalid(ns)||rs.isInvalid(ns)?ErrorType.REF:!1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class MoveCellsTransformer extends Transformer{constructor(ts,rs,ns,is){super(),this.sourceRange=ts,this.toRight=rs,this.toBottom=ns,this.toSheet=is,this.dependentFormulaTransformer=new DependentFormulaTransformer(ts,rs,ns,is)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(ts,rs){return this.sourceRange.addressInRange(rs)?[this.transformAst(ts,rs),this.fixNodeAddress(rs)]:this.dependentFormulaTransformer.transformSingleAst(ts,rs)}fixNodeAddress(ts){return simpleCellAddress(this.toSheet,ts.col+this.toRight,ts.row+this.toBottom)}transformCellAddress(ts,rs){return this.transformAddress(ts,rs)}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformColumnRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformAddress(ts,rs){const ns=this.sourceRange;if(ts instanceof CellAddress){const is=ts.toSimpleCellAddress(rs);if(ns.addressInRange(is))return ts.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return ts.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(ts,rs,ns){const is=this.sourceRange;if(ts instanceof CellAddress&&rs instanceof CellAddress){const as=ts.toSimpleCellAddress(ns),os=rs.toSimpleCellAddress(ns);if(is.addressInRange(as)&&is.addressInRange(os))return[ts.shiftAbsoluteDimensions(this.toRight,this.toBottom),rs.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[ts.shiftRelativeDimensions(-this.toRight,-this.toBottom),rs.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}class DependentFormulaTransformer extends Transformer{constructor(ts,rs,ns,is){super(),this.sourceRange=ts,this.toRight=rs,this.toBottom=ns,this.toSheet=is}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(ts){return ts}transformCellAddress(ts,rs){return this.shouldMove(ts,rs)?ts.moved(this.toSheet,this.toRight,this.toBottom):!1}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformColumnRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}shouldMove(ts,rs){return ts instanceof CellAddress?this.sourceRange.addressInRange(ts.toSimpleCellAddress(rs)):ts instanceof RowAddress?this.sourceRange.rowInRange(ts.toSimpleRowAddress(rs))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(ts.toSimpleColumnAddress(rs))&&!this.sourceRange.isFinite()}transformRange(ts,rs,ns){const is=this.transformCellAddress(ts,ns),as=this.transformCellAddress(rs,ns);return is&&as?[is,as]:!1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RemoveColumnsTransformer extends Transformer{constructor(ts){super(),this.columnsSpan=ts}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(ts,rs){return ts}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){throw Error("Not implemented")}transformColumnRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformCellAddress(ts,rs){const ns=absoluteSheetReference(ts,rs);if(this.columnsSpan.sheet!==rs.sheet&&this.columnsSpan.sheet!==ns)return!1;if(this.columnsSpan.sheet!==rs.sheet&&this.columnsSpan.sheet===ns){const is=ts.toSimpleColumnAddress(rs);if(is.col<this.columnsSpan.columnStart)return!1;if(is.col>this.columnsSpan.columnEnd)return ts.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===rs.sheet&&this.columnsSpan.sheet!==ns){if(ts.isColumnAbsolute())return!1;if(rs.col<this.columnsSpan.columnStart)return!1;if(rs.col>this.columnsSpan.columnEnd)return ts.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===rs.sheet&&this.columnsSpan.sheet===ns)if(ts.isColumnAbsolute()){if(ts.col<this.columnsSpan.columnStart)return!1;if(ts.col>this.columnsSpan.columnEnd)return ts.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const is=ts.toSimpleColumnAddress(rs);if(is.col<this.columnsSpan.columnStart){if(rs.col<this.columnsSpan.columnStart)return!1;if(rs.col>this.columnsSpan.columnEnd)return ts.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(is.col>this.columnsSpan.columnEnd){if(rs.col<this.columnsSpan.columnStart)return ts.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(rs.col>this.columnsSpan.columnEnd)return!1}}return ErrorType.REF}fixNodeAddress(ts){return this.columnsSpan.sheet===ts.sheet&&this.columnsSpan.columnStart<=ts.col?Object.assign(Object.assign({},ts),{col:ts.col-this.columnsSpan.numberOfColumns}):ts}transformRange(ts,rs,ns){const is=absoluteSheetReference(ts,ns);let as=ts,os=rs;if(this.columnsSpan.sheet===is){const cs=ts.toSimpleColumnAddress(ns),ps=rs.toSimpleColumnAddress(ns);if(this.columnsSpan.columnStart<=cs.col&&this.columnsSpan.columnEnd>=ps.col)return ErrorType.REF;cs.col>=this.columnsSpan.columnStart&&cs.col<=this.columnsSpan.columnEnd&&(as=ts.shiftedByColumns(this.columnsSpan.columnEnd-cs.col+1)),ps.col>=this.columnsSpan.columnStart&&ps.col<=this.columnsSpan.columnEnd&&(os=rs.shiftedByColumns(-(ps.col-this.columnsSpan.columnStart+1)))}const ls=this.transformCellAddress(as,ns),us=this.transformCellAddress(os,ns);if(ls===!1&&us===!1)return[as,os];if(ls===ErrorType.REF||us===ErrorType.REF)throw Error("Cannot happen");return[ls||as,us||os]}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RemoveRowsTransformer extends Transformer{constructor(ts){super(),this.rowsSpan=ts}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(ts,rs){return ts}transformCellAddress(ts,rs){const ns=absoluteSheetReference(ts,rs);if(this.rowsSpan.sheet!==rs.sheet&&this.rowsSpan.sheet!==ns)return!1;if(this.rowsSpan.sheet!==rs.sheet&&this.rowsSpan.sheet===ns){const is=ts.toSimpleRowAddress(rs);if(is.row<this.rowsSpan.rowStart)return!1;if(is.row>this.rowsSpan.rowEnd)return ts.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===rs.sheet&&this.rowsSpan.sheet!==ns){if(ts.isRowAbsolute())return!1;if(rs.row<this.rowsSpan.rowStart)return!1;if(rs.row>this.rowsSpan.rowEnd)return ts.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===rs.sheet&&this.rowsSpan.sheet===ns)if(ts.isRowAbsolute()){if(ts.row<this.rowsSpan.rowStart)return!1;if(ts.row>this.rowsSpan.rowEnd)return ts.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const is=ts.toSimpleRowAddress(rs);if(is.row<this.rowsSpan.rowStart){if(rs.row<this.rowsSpan.rowStart)return!1;if(rs.row>this.rowsSpan.rowEnd)return ts.shiftedByRows(this.rowsSpan.numberOfRows)}else if(is.row>this.rowsSpan.rowEnd){if(rs.row<this.rowsSpan.rowStart)return ts.shiftedByRows(-this.rowsSpan.numberOfRows);if(rs.row>this.rowsSpan.rowEnd)return!1}}return ErrorType.REF}transformCellRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformRowRange(ts,rs,ns){return this.transformRange(ts,rs,ns)}transformColumnRange(ts,rs,ns){throw Error("Not implemented")}fixNodeAddress(ts){return this.rowsSpan.sheet===ts.sheet&&this.rowsSpan.rowStart<=ts.row?Object.assign(Object.assign({},ts),{row:ts.row-this.rowsSpan.numberOfRows}):ts}transformRange(ts,rs,ns){const is=absoluteSheetReference(ts,ns);let as=ts,os=rs;if(this.rowsSpan.sheet===is){const cs=ts.toSimpleRowAddress(ns),ps=rs.toSimpleRowAddress(ns);if(this.rowsSpan.rowStart<=cs.row&&this.rowsSpan.rowEnd>=ps.row)return ErrorType.REF;cs.row>=this.rowsSpan.rowStart&&cs.row<=this.rowsSpan.rowEnd&&(as=ts.shiftedByRows(this.rowsSpan.rowEnd-cs.row+1)),ps.row>=this.rowsSpan.rowStart&&ps.row<=this.rowsSpan.rowEnd&&(os=rs.shiftedByRows(-(ps.row-this.rowsSpan.rowStart+1)))}const ls=this.transformCellAddress(as,ns),us=this.transformCellAddress(os,ns);return ls===!1&&us===!1?[as,os]:ls===ErrorType.REF||us===ErrorType.REF?ErrorType.REF:[ls||as,us||os]}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RemoveSheetTransformer extends Transformer{constructor(ts){super(),this.sheet=ts}isIrreversible(){return!0}performEagerTransformations(ts,rs){for(const ns of ts.arrayFormulaNodes()){const[is]=this.transformSingleAst(ns.getFormula(ts.lazilyTransformingAstService),ns.getAddress(ts.lazilyTransformingAstService));ns.setFormula(is)}}fixNodeAddress(ts){return ts}transformCellAddress(ts,rs){return this.transformAddress(ts)}transformCellRange(ts,rs,ns){return this.transformAddress(ts)}transformColumnRange(ts,rs,ns){return this.transformAddress(ts)}transformRowRange(ts,rs,ns){return this.transformAddress(ts)}transformAddress(ts){return ts.sheet===this.sheet?ErrorType.REF:!1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function validateAsSheet(ss){if(!Array.isArray(ss))throw new InvalidArgumentsError("an array of arrays.");for(let ts=0;ts<ss.length;ts++)if(!Array.isArray(ss[ts]))throw new InvalidArgumentsError("an array of arrays.")}function findBoundaries(ss){let ts=0,rs=0,ns=0;for(let as=0;as<ss.length;as++){let os=0;for(let ls=0;ls<ss[as].length;ls++){const us=ss[as][ls];us!=null&&(os=ls+1,++ns)}ts=Math.max(ts,os),os>0&&(rs=as+1)}const is=ts*rs;return{height:rs,width:ts,fill:is===0?0:ns/is}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RemoveRowsCommand{constructor(ts,rs){this.sheet=ts,this.indexes=rs}normalizedIndexes(){return normalizeRemovedIndexes(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(ts=>RowsSpan.fromNumberOfRows(this.sheet,ts[0],ts[1]))}}class AddRowsCommand{constructor(ts,rs){this.sheet=ts,this.indexes=rs}normalizedIndexes(){return normalizeAddedIndexes(this.indexes)}rowsSpans(){return this.normalizedIndexes().map(ts=>RowsSpan.fromNumberOfRows(this.sheet,ts[0],ts[1]))}}class AddColumnsCommand{constructor(ts,rs){this.sheet=ts,this.indexes=rs}normalizedIndexes(){return normalizeAddedIndexes(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(ts=>ColumnsSpan.fromNumberOfColumns(this.sheet,ts[0],ts[1]))}}class RemoveColumnsCommand{constructor(ts,rs){this.sheet=ts,this.indexes=rs}normalizedIndexes(){return normalizeRemovedIndexes(this.indexes)}columnsSpans(){return this.normalizedIndexes().map(ts=>ColumnsSpan.fromNumberOfColumns(this.sheet,ts[0],ts[1]))}}class Operations{constructor(ts,rs,ns,is,as,os,ls,us,cs){this.dependencyGraph=rs,this.columnSearch=ns,this.cellContentParser=is,this.parser=as,this.stats=os,this.lazilyTransformingAstService=ls,this.namedExpressions=us,this.arraySizePredictor=cs,this.changes=ContentChanges.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=ts.maxColumns,this.maxRows=ts.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(ts){const rs=[];for(const ns of ts.rowsSpans()){const is=this.doRemoveRows(ns);is&&rs.push(is)}return rs}addRows(ts){for(const rs of ts.rowsSpans())this.doAddRows(rs)}addColumns(ts){for(const rs of ts.columnsSpans())this.doAddColumns(rs)}removeColumns(ts){const rs=[];for(const ns of ts.columnsSpans()){const is=this.doRemoveColumns(ns);is&&rs.push(is)}return rs}removeSheet(ts){this.dependencyGraph.removeSheet(ts);let rs;this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const is=new RemoveSheetTransformer(ts);is.performEagerTransformations(this.dependencyGraph,this.parser),rs=this.lazilyTransformingAstService.addTransformation(is)}),this.sheetMapping.removeSheet(ts),this.columnSearch.removeSheet(ts);const ns=this.namedExpressions.getAllNamedExpressionsForScope(ts).map(is=>this.removeNamedExpression(is.normalizeExpressionName(),ts));return{version:rs,scopedNamedExpressions:ns}}removeSheetByName(ts){const rs=this.sheetMapping.fetch(ts);return this.removeSheet(rs)}clearSheet(ts){this.dependencyGraph.clearSheet(ts),this.columnSearch.removeSheet(ts)}addSheet(ts){const rs=this.sheetMapping.addSheet(ts),ns=[];return this.dependencyGraph.addressMapping.autoAddSheet(rs,ns,findBoundaries(ns)),this.sheetMapping.fetchDisplayName(rs)}renameSheet(ts,rs){return this.sheetMapping.renameSheet(ts,rs)}moveRows(ts,rs,ns,is){const as=RowsSpan.fromNumberOfRows(ts,is,ns);this.lazilyTransformingAstService.beginCombinedMode(ts),this.doAddRows(as),is<rs&&(rs+=ns);const os=simpleCellAddress(ts,0,rs),ls=simpleCellAddress(ts,0,is);this.moveCells(os,Number.POSITIVE_INFINITY,ns,ls);const us=RowsSpan.fromNumberOfRows(ts,rs,ns);return this.doRemoveRows(us),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(ts,rs,ns,is){const as=ColumnsSpan.fromNumberOfColumns(ts,is,ns);this.lazilyTransformingAstService.beginCombinedMode(ts),this.doAddColumns(as),is<rs&&(rs+=ns);const os=simpleCellAddress(ts,rs,0),ls=simpleCellAddress(ts,is,0);this.moveCells(os,ns,Number.POSITIVE_INFINITY,ls);const us=ColumnsSpan.fromNumberOfColumns(ts,rs,ns);return this.doRemoveColumns(us),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(ts,rs,ns,is){this.ensureItIsPossibleToMoveCells(ts,rs,ns,is);const as=AbsoluteCellRange.spanFrom(ts,rs,ns),os=AbsoluteCellRange.spanFrom(is,rs,ns),ls=is.col-ts.col,us=is.row-ts.row,cs=is.sheet,ps=this.getRangeClipboardCells(os),ds=this.dependencyGraph.rawValuesFromRange(os);this.columnSearch.removeValues(ds);const fs=this.dependencyGraph.rawValuesFromRange(as);this.columnSearch.moveValues(fs,ls,us,cs);let hs;this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const gs=new MoveCellsTransformer(as,ls,us,cs);gs.performEagerTransformations(this.dependencyGraph,this.parser),hs=this.lazilyTransformingAstService.addTransformation(gs)}),this.dependencyGraph.moveCells(as,ls,us,cs);const ys=this.updateNamedExpressionsForMovedCells(ts,rs,ns,is);return{version:hs,overwrittenCellsData:ps,addedGlobalNamedExpressions:ys}}setRowOrder(ts,rs){const ns=[];let is=[];for(const[as,os]of rs)if(as!==os){const ls=AbsoluteCellRange.spanFrom({sheet:ts,col:0,row:as},1/0,1),us=this.getRangeClipboardCells(ls);is=is.concat(us),ns.push(us.map(([{sheet:cs,col:ps},ds])=>[{sheet:cs,col:ps,row:os},ds]))}return ns.forEach(as=>this.restoreClipboardCells(ts,as.values())),is}setColumnOrder(ts,rs){const ns=[];let is=[];for(const[as,os]of rs)if(as!==os){const ls=AbsoluteCellRange.spanFrom({sheet:ts,col:as,row:0},1,1/0),us=this.getRangeClipboardCells(ls);is=is.concat(us),ns.push(us.map(([{sheet:cs,col:ps,row:ds},fs])=>[{sheet:cs,col:os,row:ds},fs]))}return ns.forEach(as=>this.restoreClipboardCells(ts,as.values())),is}addNamedExpression(ts,rs,ns,is){const as=this.namedExpressions.addNamedExpression(ts,ns,is);this.storeNamedExpressionInCell(as.address,rs),this.adjustNamedExpressionEdges(as,ts,ns)}restoreNamedExpression(ts,rs,ns){const is=ts.displayName;this.restoreCell(ts.address,rs);const as=this.namedExpressions.restoreNamedExpression(ts,ns);this.adjustNamedExpressionEdges(as,is,ns)}changeNamedExpressionExpression(ts,rs,ns,is){const as=this.namedExpressions.namedExpressionForScope(ts,ns);if(!as)throw new NamedExpressionDoesNotExistError(ts);const os=as.copy();as.options=is;const ls=this.getClipboardCell(as.address);return this.storeNamedExpressionInCell(as.address,rs),[os,ls]}removeNamedExpression(ts,rs){const ns=this.namedExpressions.namedExpressionForScope(ts,rs);if(!ns)throw new NamedExpressionDoesNotExistError(ts);this.namedExpressions.remove(ns.displayName,rs);const is=this.getClipboardCell(ns.address);if(rs!==void 0){const as=this.namedExpressions.workbookNamedExpressionOrPlaceholder(ts);this.dependencyGraph.exchangeNode(ns.address,as.address)}else this.dependencyGraph.setCellEmpty(ns.address);return[ns,is]}ensureItIsPossibleToMoveCells(ts,rs,ns,is){if(invalidSimpleCellAddress(ts)||!(isPositiveInteger$1(rs)&&isPositiveInteger$1(ns)||isRowOrColumnRange(ts,rs,ns))||invalidSimpleCellAddress(is)||!this.sheetMapping.hasSheetWithId(ts.sheet)||!this.sheetMapping.hasSheetWithId(is.sheet))throw new InvalidArgumentsError("a valid range of cells to move.");const as=AbsoluteCellRange.spanFrom(ts,rs,ns),os=AbsoluteCellRange.spanFrom(is,rs,ns);if(os.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(as))throw new SourceLocationHasArrayError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(os))throw new TargetLocationHasArrayError}restoreClipboardCells(ts,rs){const ns=[];for(const[is,as]of rs)if(this.restoreCell(is,as),as.type===ClipboardCellType.FORMULA){const{dependencies:os}=this.parser.fetchCachedResult(as.hash);ns.push(...this.updateNamedExpressionsForTargetAddress(ts,is,os))}return ns}restoreCell(ts,rs){switch(rs.type){case ClipboardCellType.VALUE:{this.setValueToCell(rs,ts);break}case ClipboardCellType.FORMULA:{this.setFormulaToCellFromCache(rs.hash,ts);break}case ClipboardCellType.EMPTY:{this.setCellEmpty(ts);break}case ClipboardCellType.PARSING_ERROR:{this.setParsingErrorToCell(rs.rawInput,rs.errors,ts);break}}}getOldContent(ts){const rs=this.dependencyGraph.getCell(ts);if(rs===void 0||rs instanceof EmptyCellVertex)return[ts,{type:ClipboardCellType.EMPTY}];if(rs instanceof ValueCellVertex)return[ts,Object.assign({type:ClipboardCellType.VALUE},rs.getValues())];if(rs instanceof FormulaVertex)return[rs.getAddress(this.lazilyTransformingAstService),{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(rs.getFormula(this.lazilyTransformingAstService))}];if(rs instanceof ParsingErrorVertex)return[ts,{type:ClipboardCellType.PARSING_ERROR,rawInput:rs.rawInput,errors:rs.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(ts){const rs=this.dependencyGraph.getCell(ts);if(rs===void 0||rs instanceof EmptyCellVertex)return{type:ClipboardCellType.EMPTY};if(rs instanceof ValueCellVertex)return Object.assign({type:ClipboardCellType.VALUE},rs.getValues());if(rs instanceof ArrayVertex){const ns=rs.getArrayCellValue(ts);return ns===EmptyValue?{type:ClipboardCellType.EMPTY}:{type:ClipboardCellType.VALUE,parsedValue:ns,rawValue:rs.getArrayCellRawValue(ts)}}else{if(rs instanceof FormulaCellVertex)return{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(rs.getFormula(this.lazilyTransformingAstService))};if(rs instanceof ParsingErrorVertex)return{type:ClipboardCellType.PARSING_ERROR,rawInput:rs.rawInput,errors:rs.errors}}throw Error("Trying to copy unsupported type")}getSheetClipboardCells(ts){const rs=this.dependencyGraph.getSheetHeight(ts),ns=this.dependencyGraph.getSheetWidth(ts),is=new Array(rs);for(let as=0;as<rs;as++){is[as]=new Array(ns);for(let os=0;os<ns;os++){const ls=simpleCellAddress(ts,os,as);is[as][os]=this.getClipboardCell(ls)}}return is}getRangeClipboardCells(ts){const rs=[];for(const ns of ts.addresses(this.dependencyGraph))rs.push([ns,this.getClipboardCell(ns)]);return rs}setCellContent(ts,rs){const ns=this.cellContentParser.parse(rs),is=this.getOldContent(ts);if(ns instanceof CellContent.Formula){const as=this.parser.parse(ns.formula,ts),{ast:os,errors:ls}=as;if(ls.length>0)this.setParsingErrorToCell(ns.formula,ls,ts);else{const us=this.arraySizePredictor.checkArraySize(os,ts);this.setFormulaToCell(ts,us,as)}}else ns instanceof CellContent.Empty?this.setCellEmpty(ts):this.setValueToCell({parsedValue:ns.value,rawValue:rs},ts);return is}setSheetContent(ts,rs){this.clearSheet(ts);for(let ns=0;ns<rs.length;ns++)for(let is=0;is<rs[ns].length;is++){const as=simpleCellAddress(ts,is,ns);this.setCellContent(as,rs[ns][is])}}setParsingErrorToCell(ts,rs,ns){const is=this.dependencyGraph.getCellValue(ns),as=new ParsingErrorVertex(rs,ts),os=this.dependencyGraph.setParsingErrorToCell(ns,as);this.columnSearch.remove(getRawValue(is),ns),this.columnSearch.applyChanges(os.getChanges()),this.changes.addAll(os),this.changes.addChange(as.getCellValue(),ns)}setFormulaToCell(ts,rs,{ast:ns,hasVolatileFunction:is,hasStructuralChangeFunction:as,dependencies:os}){const ls=this.dependencyGraph.getCellValue(ts),us=this.dependencyGraph.setFormulaToCell(ts,ns,absolutizeDependencies(os,ts),rs,is,as);this.columnSearch.remove(getRawValue(ls),ts),this.columnSearch.applyChanges(us.getChanges()),this.changes.addAll(us)}setValueToCell(ts,rs){const ns=this.dependencyGraph.getCellValue(rs),is=this.dependencyGraph.setValueToCell(rs,ts);this.columnSearch.change(getRawValue(ns),getRawValue(ts.parsedValue),rs),this.columnSearch.applyChanges(is.getChanges().filter(as=>!equalSimpleCellAddress(as.address,rs))),this.changes.addAll(is),this.changes.addChange(ts.parsedValue,rs)}setCellEmpty(ts){if(this.dependencyGraph.isArrayInternalCell(ts))return;const rs=this.dependencyGraph.getCellValue(ts),ns=this.dependencyGraph.setCellEmpty(ts);this.columnSearch.remove(getRawValue(rs),ts),this.columnSearch.applyChanges(ns.getChanges()),this.changes.addAll(ns),this.changes.addChange(EmptyValue,ts)}setFormulaToCellFromCache(ts,rs){const{ast:ns,hasVolatileFunction:is,hasStructuralChangeFunction:as,dependencies:os}=this.parser.fetchCachedResult(ts),ls=absolutizeDependencies(os,rs),[us]=new CleanOutOfScopeDependenciesTransformer(rs.sheet).transformSingleAst(ns,rs);this.parser.rememberNewAst(us);const cs=filterDependenciesOutOfScope(ls),ps=this.arraySizePredictor.checkArraySize(ns,rs);this.dependencyGraph.setFormulaToCell(rs,us,cs,ps,is,as)}rowEffectivelyNotInSheet(ts,rs){const ns=this.dependencyGraph.addressMapping.getHeight(rs);return ts>=ns}getAndClearContentChanges(){const ts=this.changes;return this.changes=ContentChanges.empty(),ts}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(ts){if(this.rowEffectivelyNotInSheet(ts.rowStart,ts.sheet))return;const rs=[];for(const[os]of this.dependencyGraph.entriesFromRowsSpan(ts))rs.push({address:os,cellType:this.getClipboardCell(os)});const{affectedArrays:ns,contentChanges:is}=this.dependencyGraph.removeRows(ts);this.columnSearch.applyChanges(is.getChanges());let as;return this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const os=new RemoveRowsTransformer(ts);os.performEagerTransformations(this.dependencyGraph,this.parser),as=this.lazilyTransformingAstService.addTransformation(os)}),this.rewriteAffectedArrays(ns),{version:as,removedCells:rs,rowFrom:ts.rowStart,rowCount:ts.numberOfRows}}doRemoveColumns(ts){if(this.columnEffectivelyNotInSheet(ts.columnStart,ts.sheet))return;const rs=[];for(const[os]of this.dependencyGraph.entriesFromColumnsSpan(ts))rs.push({address:os,cellType:this.getClipboardCell(os)});const{affectedArrays:ns,contentChanges:is}=this.dependencyGraph.removeColumns(ts);this.columnSearch.applyChanges(is.getChanges()),this.columnSearch.removeColumns(ts);let as;return this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const os=new RemoveColumnsTransformer(ts);os.performEagerTransformations(this.dependencyGraph,this.parser),as=this.lazilyTransformingAstService.addTransformation(os)}),this.rewriteAffectedArrays(ns),{version:as,removedCells:rs,columnFrom:ts.columnStart,columnCount:ts.numberOfColumns}}doAddRows(ts){if(this.rowEffectivelyNotInSheet(ts.rowStart,ts.sheet))return;const{affectedArrays:rs}=this.dependencyGraph.addRows(ts);this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const ns=new AddRowsTransformer(ts);ns.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(ns)}),this.rewriteAffectedArrays(rs)}rewriteAffectedArrays(ts){for(const rs of ts.values()){if(rs.array.size.isRef)continue;const ns=rs.getFormula(this.lazilyTransformingAstService),is=rs.getAddress(this.lazilyTransformingAstService),as=this.parser.computeHashFromAst(ns);this.setFormulaToCellFromCache(as,is)}}doAddColumns(ts){if(this.columnEffectivelyNotInSheet(ts.columnStart,ts.sheet))return;const{affectedArrays:rs,contentChanges:ns}=this.dependencyGraph.addColumns(ts);this.columnSearch.addColumns(ts),this.columnSearch.applyChanges(ns.getChanges()),this.stats.measure(StatType.TRANSFORM_ASTS,()=>{const is=new AddColumnsTransformer(ts);is.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(is)}),this.rewriteAffectedArrays(rs)}columnEffectivelyNotInSheet(ts,rs){const ns=this.dependencyGraph.addressMapping.getWidth(rs);return ts>=ns}adjustNamedExpressionEdges(ts,rs,ns){if(ns===void 0)return;const is=this.dependencyGraph.fetchCellOrCreateEmpty(ts.address),as=this.namedExpressions.workbookNamedExpressionOrPlaceholder(rs),os=this.dependencyGraph.fetchCellOrCreateEmpty(as.address);for(const ls of this.dependencyGraph.graph.adjacentNodes(os))if(ls instanceof FormulaCellVertex&&ls.getAddress(this.lazilyTransformingAstService).sheet===ns){const us=ls.getFormula(this.lazilyTransformingAstService),cs=ls.getAddress(this.lazilyTransformingAstService),{dependencies:ps}=this.parser.fetchCachedResultForAst(us);for(const ds of absolutizeDependencies(ps,cs))ds instanceof NamedExpressionDependency&&ds.name.toLowerCase()===ts.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(os,ls),this.dependencyGraph.graph.addEdge(is,ls))}}storeNamedExpressionInCell(ts,rs){const ns=this.cellContentParser.parse(rs);if(ns instanceof CellContent.Formula){const is=this.parser.parse(ns.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(is.ast))throw new NoRelativeAddressesAllowedError;const{ast:as,hasVolatileFunction:os,hasStructuralChangeFunction:ls,dependencies:us}=is;this.dependencyGraph.setFormulaToCell(ts,as,absolutizeDependencies(us,ts),ArraySize.scalar(),os,ls)}else ns instanceof CellContent.Empty?this.setCellEmpty(ts):this.setValueToCell({parsedValue:ns.value,rawValue:rs},ts)}updateNamedExpressionsForMovedCells(ts,rs,ns,is){if(ts.sheet===is.sheet)return[];const as=[],os=AbsoluteCellRange.spanFrom(is,rs,ns);for(const ls of os.addresses(this.dependencyGraph)){const us=this.addressMapping.fetchCell(ls);if(us instanceof FormulaCellVertex&&ls.sheet!==ts.sheet){const cs=us.getFormula(this.lazilyTransformingAstService),{dependencies:ps}=this.parser.fetchCachedResultForAst(cs);as.push(...this.updateNamedExpressionsForTargetAddress(ts.sheet,ls,ps))}}return as}updateNamedExpressionsForTargetAddress(ts,rs,ns){if(ts===rs.sheet)return[];const is=[],as=this.addressMapping.fetchCell(rs);for(const os of absolutizeDependencies(ns,rs)){if(!(os instanceof NamedExpressionDependency))continue;const ls=os.name,us=this.dependencyGraph.fetchNamedExpressionVertex(ls,ts),ps=this.namedExpressions.isExpressionInScope(ls,rs.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(ls,rs.sheet):this.copyOrFetchGlobalNamedExpressionVertex(ls,us,is);ps!==us&&(this.dependencyGraph.graph.softRemoveEdge(us,as),this.dependencyGraph.graph.addEdge(ps,as))}return is}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(-1,new SparseStrategy(0,0))}copyOrFetchGlobalNamedExpressionVertex(ts,rs,ns){let is=this.namedExpressions.namedExpressionForScope(ts);if(is===void 0)if(is=this.namedExpressions.addNamedExpression(ts),ns.push(is.normalizeExpressionName()),rs instanceof FormulaCellVertex){const as=this.parser.fetchCachedResultForAst(rs.getFormula(this.lazilyTransformingAstService)),{ast:os,hasVolatileFunction:ls,hasStructuralChangeFunction:us,dependencies:cs}=as;this.dependencyGraph.setFormulaToCell(is.address,os,absolutizeDependencies(cs,is.address),ArraySize.scalar(),ls,us)}else rs instanceof EmptyCellVertex?this.setCellEmpty(is.address):rs instanceof ValueCellVertex&&this.setValueToCell(rs.getValues(),is.address);return this.dependencyGraph.fetchCellOrCreateEmpty(is.address)}}function normalizeRemovedIndexes(ss){if(ss.length<=1)return ss;const ts=[...ss].sort(([is],[as])=>is-as),rs=ts.reduce((is,[as,os])=>{const ls=is[is.length-1],us=ls[0]+ls[1];return as<=us?ls[1]+=Math.max(0,os-(us-as)):is.push([as,os]),is},[ts[0]]);let ns=0;for(let is=0;is<rs.length;++is)rs[is][0]-=ns,ns+=rs[is][1];return rs}function normalizeAddedIndexes(ss){if(ss.length<=1)return ss;const ts=[...ss].sort(([is],[as])=>is-as),rs=ts.reduce((is,[as,os])=>{const ls=is[is.length-1];return as===ls[0]?ls[1]=Math.max(ls[1],os):is.push([as,os]),is},[ts[0]]);let ns=0;for(let is=0;is<rs.length;++is)rs[is][0]+=ns,ns+=rs[is][1];return rs}function isPositiveInteger$1(ss){return Number.isInteger(ss)&&ss>0}function isRowOrColumnRange(ss,ts,rs){return ss.row===0&&isPositiveInteger$1(ts)&&rs===Number.POSITIVE_INFINITY||ss.col===0&&isPositiveInteger$1(rs)&&ts===Number.POSITIVE_INFINITY}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class BaseUndoEntry{}class RemoveRowsUndoEntry extends BaseUndoEntry{constructor(ts,rs){super(),this.command=ts,this.rowsRemovals=rs}doUndo(ts){ts.undoRemoveRows(this)}doRedo(ts){ts.redoRemoveRows(this)}}class MoveCellsUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is,as,os,ls){super(),this.sourceLeftCorner=ts,this.width=rs,this.height=ns,this.destinationLeftCorner=is,this.overwrittenCellsData=as,this.addedGlobalNamedExpressions=os,this.version=ls}doUndo(ts){ts.undoMoveCells(this)}doRedo(ts){ts.redoMoveCells(this)}}class AddRowsUndoEntry extends BaseUndoEntry{constructor(ts){super(),this.command=ts}doUndo(ts){ts.undoAddRows(this)}doRedo(ts){ts.redoAddRows(this)}}class SetRowOrderUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns){super(),this.sheetId=ts,this.rowMapping=rs,this.oldContent=ns}doUndo(ts){ts.undoSetRowOrder(this)}doRedo(ts){ts.redoSetRowOrder(this)}}class SetColumnOrderUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns){super(),this.sheetId=ts,this.columnMapping=rs,this.oldContent=ns}doUndo(ts){ts.undoSetColumnOrder(this)}doRedo(ts){ts.redoSetColumnOrder(this)}}class SetSheetContentUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns){super(),this.sheetId=ts,this.oldSheetContent=rs,this.newSheetContent=ns}doUndo(ts){ts.undoSetSheetContent(this)}doRedo(ts){ts.redoSetSheetContent(this)}}class MoveRowsUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is,as){super(),this.sheet=ts,this.startRow=rs,this.numberOfRows=ns,this.targetRow=is,this.version=as,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(ts){ts.undoMoveRows(this)}doRedo(ts){ts.redoMoveRows(this)}}class MoveColumnsUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is,as){super(),this.sheet=ts,this.startColumn=rs,this.numberOfColumns=ns,this.targetColumn=is,this.version=as,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(ts){ts.undoMoveColumns(this)}doRedo(ts){ts.redoMoveColumns(this)}}class AddColumnsUndoEntry extends BaseUndoEntry{constructor(ts){super(),this.command=ts}doUndo(ts){ts.undoAddColumns(this)}doRedo(ts){ts.redoAddColumns(this)}}class RemoveColumnsUndoEntry extends BaseUndoEntry{constructor(ts,rs){super(),this.command=ts,this.columnsRemovals=rs}doUndo(ts){ts.undoRemoveColumns(this)}doRedo(ts){ts.redoRemoveColumns(this)}}class AddSheetUndoEntry extends BaseUndoEntry{constructor(ts){super(),this.sheetName=ts}doUndo(ts){ts.undoAddSheet(this)}doRedo(ts){ts.redoAddSheet(this)}}class RemoveSheetUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is,as){super(),this.sheetName=ts,this.sheetId=rs,this.oldSheetContent=ns,this.scopedNamedExpressions=is,this.version=as}doUndo(ts){ts.undoRemoveSheet(this)}doRedo(ts){ts.redoRemoveSheet(this)}}class RenameSheetUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns){super(),this.sheetId=ts,this.oldName=rs,this.newName=ns}doUndo(ts){ts.undoRenameSheet(this)}doRedo(ts){ts.redoRenameSheet(this)}}class ClearSheetUndoEntry extends BaseUndoEntry{constructor(ts,rs){super(),this.sheetId=ts,this.oldSheetContent=rs}doUndo(ts){ts.undoClearSheet(this)}doRedo(ts){ts.redoClearSheet(this)}}class SetCellContentsUndoEntry extends BaseUndoEntry{constructor(ts){super(),this.cellContents=ts}doUndo(ts){ts.undoSetCellContents(this)}doRedo(ts){ts.redoSetCellContents(this)}}class PasteUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is){super(),this.targetLeftCorner=ts,this.oldContent=rs,this.newContent=ns,this.addedGlobalNamedExpressions=is}doUndo(ts){ts.undoPaste(this)}doRedo(ts){ts.redoPaste(this)}}class AddNamedExpressionUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is){super(),this.name=ts,this.newContent=rs,this.scope=ns,this.options=is}doUndo(ts){ts.undoAddNamedExpression(this)}doRedo(ts){ts.redoAddNamedExpression(this)}}class RemoveNamedExpressionUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns){super(),this.namedExpression=ts,this.content=rs,this.scope=ns}doUndo(ts){ts.undoRemoveNamedExpression(this)}doRedo(ts){ts.redoRemoveNamedExpression(this)}}class ChangeNamedExpressionUndoEntry extends BaseUndoEntry{constructor(ts,rs,ns,is,as){super(),this.namedExpression=ts,this.newContent=rs,this.oldContent=ns,this.scope=is,this.options=as}doUndo(ts){ts.undoChangeNamedExpression(this)}doRedo(ts){ts.redoChangeNamedExpression(this)}}class BatchUndoEntry extends BaseUndoEntry{constructor(){super(...arguments),this.operations=[]}add(ts){this.operations.push(ts)}*reversedOperations(){for(let ts=this.operations.length-1;ts>=0;ts--)yield this.operations[ts]}doUndo(ts){ts.undoBatch(this)}doRedo(ts){ts.redoBatch(this)}}class UndoRedo{constructor(ts,rs){this.operations=rs,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=ts.undoLimit}saveOperation(ts){this.batchUndoEntry!==void 0?this.batchUndoEntry.add(ts):this.addUndoEntry(ts)}beginBatchMode(){this.batchUndoEntry=new BatchUndoEntry}commitBatchMode(){if(this.batchUndoEntry===void 0)throw"Batch mode wasn't started";this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(ts,rs,ns){this.oldData.has(ts)||this.oldData.set(ts,[]),this.oldData.get(ts).push([rs,ns])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return this.undoStack.length===0}isRedoStackEmpty(){return this.redoStack.length===0}undo(){const ts=this.undoStack.pop();if(!ts)throw"Attempted to undo without operation on stack";this.undoEntry(ts),this.redoStack.push(ts)}undoBatch(ts){for(const rs of ts.reversedOperations())this.undoEntry(rs)}undoRemoveRows(ts){this.operations.forceApplyPostponedTransformations();const{command:{sheet:rs},rowsRemovals:ns}=ts;for(let is=ns.length-1;is>=0;--is){const as=ns[is];this.operations.addRows(new AddRowsCommand(rs,[[as.rowFrom,as.rowCount]]));for(const{address:os,cellType:ls}of as.removedCells)this.operations.restoreCell(os,ls);this.restoreOldDataFromVersion(as.version-1)}}undoRemoveColumns(ts){this.operations.forceApplyPostponedTransformations();const{command:{sheet:rs},columnsRemovals:ns}=ts;for(let is=ns.length-1;is>=0;--is){const as=ns[is];this.operations.addColumns(new AddColumnsCommand(rs,[[as.columnFrom,as.columnCount]]));for(const{address:os,cellType:ls}of as.removedCells)this.operations.restoreCell(os,ls);this.restoreOldDataFromVersion(as.version-1)}}undoAddRows(ts){const rs=ts.command.rowsSpans();for(let ns=rs.length-1;ns>=0;--ns){const is=rs[ns];this.operations.removeRows(new RemoveRowsCommand(ts.command.sheet,[[is.rowStart,is.numberOfRows]]))}}undoAddColumns(ts){const rs=ts.command.columnsSpans();for(let ns=rs.length-1;ns>=0;--ns){const is=rs[ns];this.operations.removeColumns(new RemoveColumnsCommand(ts.command.sheet,[[is.columnStart,is.numberOfColumns]]))}}undoSetCellContents(ts){for(const rs of ts.cellContents){const ns=rs.address,[is,as]=rs.oldContent;equalSimpleCellAddress(ns,is)||this.operations.setCellEmpty(ns),this.operations.restoreCell(is,as)}}undoPaste(ts){this.restoreOperationOldContent(ts.oldContent);for(const rs of ts.addedGlobalNamedExpressions)this.operations.removeNamedExpression(rs)}undoMoveRows(ts){const{sheet:rs}=ts;this.operations.moveRows(rs,ts.undoStart,ts.numberOfRows,ts.undoEnd),this.restoreOldDataFromVersion(ts.version-1)}undoMoveColumns(ts){const{sheet:rs}=ts;this.operations.moveColumns(rs,ts.undoStart,ts.numberOfColumns,ts.undoEnd),this.restoreOldDataFromVersion(ts.version-1)}undoMoveCells(ts){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(ts.destinationLeftCorner,ts.width,ts.height,ts.sourceLeftCorner),this.restoreOperationOldContent(ts.overwrittenCellsData),this.restoreOldDataFromVersion(ts.version-1);for(const rs of ts.addedGlobalNamedExpressions)this.operations.removeNamedExpression(rs)}undoAddSheet(ts){const{sheetName:rs}=ts;this.operations.removeSheetByName(rs)}undoRemoveSheet(ts){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:rs,sheetId:ns}=ts;this.operations.addSheet(ts.sheetName);for(let is=0;is<rs.length;is++){const as=rs[is];for(let os=0;os<as.length;os++){const ls=as[os],us=simpleCellAddress(ns,os,is);this.operations.restoreCell(us,ls)}}for(const[is,as]of ts.scopedNamedExpressions)this.operations.restoreNamedExpression(is,as,ns);this.restoreOldDataFromVersion(ts.version-1)}undoRenameSheet(ts){this.operations.renameSheet(ts.sheetId,ts.oldName)}undoClearSheet(ts){const{oldSheetContent:rs,sheetId:ns}=ts;for(let is=0;is<rs.length;is++){const as=rs[is];for(let os=0;os<as.length;os++){const ls=as[os],us=simpleCellAddress(ns,os,is);this.operations.restoreCell(us,ls)}}}undoSetSheetContent(ts){const{oldSheetContent:rs,sheetId:ns}=ts;this.operations.clearSheet(ns);for(let is=0;is<rs.length;is++){const as=rs[is];for(let os=0;os<as.length;os++){const ls=as[os],us=simpleCellAddress(ns,os,is);this.operations.restoreCell(us,ls)}}}undoAddNamedExpression(ts){this.operations.removeNamedExpression(ts.name,ts.scope)}undoRemoveNamedExpression(ts){this.operations.restoreNamedExpression(ts.namedExpression,ts.content,ts.scope)}undoChangeNamedExpression(ts){this.operations.restoreNamedExpression(ts.namedExpression,ts.oldContent,ts.scope)}undoSetRowOrder(ts){this.restoreOperationOldContent(ts.oldContent)}undoSetColumnOrder(ts){this.restoreOperationOldContent(ts.oldContent)}redo(){const ts=this.redoStack.pop();if(!ts)throw"Attempted to redo without operation on stack";this.redoEntry(ts),this.undoStack.push(ts)}redoBatch(ts){for(const rs of ts.operations)this.redoEntry(rs)}redoRemoveRows(ts){this.operations.removeRows(ts.command)}redoMoveCells(ts){this.operations.moveCells(ts.sourceLeftCorner,ts.width,ts.height,ts.destinationLeftCorner)}redoRemoveColumns(ts){this.operations.removeColumns(ts.command)}redoPaste(ts){const{targetLeftCorner:rs,newContent:ns}=ts,is=ns.length,as=ns[0].length;for(let os=0;os<is;++os)for(let ls=0;ls<as;++ls){const us=simpleCellAddress(rs.sheet,rs.col+ls,rs.row+os);this.operations.restoreCell(us,ns[os][ls])}}redoSetCellContents(ts){for(const rs of ts.cellContents)this.operations.setCellContent(rs.address,rs.newContent)}redoAddRows(ts){this.operations.addRows(ts.command)}redoAddColumns(ts){this.operations.addColumns(ts.command)}redoRemoveSheet(ts){this.operations.removeSheetByName(ts.sheetName)}redoAddSheet(ts){this.operations.addSheet(ts.sheetName)}redoRenameSheet(ts){this.operations.renameSheet(ts.sheetId,ts.newName)}redoMoveRows(ts){this.operations.moveRows(ts.sheet,ts.startRow,ts.numberOfRows,ts.targetRow)}redoMoveColumns(ts){this.operations.moveColumns(ts.sheet,ts.startColumn,ts.numberOfColumns,ts.targetColumn)}redoClearSheet(ts){this.operations.clearSheet(ts.sheetId)}redoSetSheetContent(ts){const{sheetId:rs,newSheetContent:ns}=ts;this.operations.setSheetContent(rs,ns)}redoAddNamedExpression(ts){this.operations.addNamedExpression(ts.name,ts.newContent,ts.scope,ts.options)}redoRemoveNamedExpression(ts){this.operations.removeNamedExpression(ts.namedExpression.displayName,ts.scope)}redoChangeNamedExpression(ts){this.operations.changeNamedExpressionExpression(ts.namedExpression.displayName,ts.newContent,ts.scope,ts.options)}redoSetRowOrder(ts){this.operations.setRowOrder(ts.sheetId,ts.rowMapping)}redoSetColumnOrder(ts){this.operations.setColumnOrder(ts.sheetId,ts.columnMapping)}addUndoEntry(ts){this.undoStack.push(ts),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(ts){ts.doUndo(this)}restoreOperationOldContent(ts){for(const[rs,ns]of ts)this.operations.restoreCell(rs,ns)}redoEntry(ts){ts.doRedo(this)}restoreOldDataFromVersion(ts){const rs=this.oldData.get(ts)||[];for(const ns of rs){const[is,as]=ns;this.operations.setFormulaToCellFromCache(as,is)}}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CrudOperations{constructor(ts,rs,ns,is,as,os,ls,us,cs,ps){this.operations=rs,this.undoRedo=ns,this.clipboardOperations=is,this.dependencyGraph=as,this.columnSearch=os,this.parser=ls,this.cellContentParser=us,this.lazilyTransformingAstService=cs,this.namedExpressions=ps,this.maxRows=ts.maxRows,this.maxColumns=ts.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(ts,...rs){const ns=new AddRowsCommand(ts,rs);this.ensureItIsPossibleToAddRows(ts,...rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(ns),this.undoRedo.saveOperation(new AddRowsUndoEntry(ns))}removeRows(ts,...rs){const ns=new RemoveRowsCommand(ts,rs);this.ensureItIsPossibleToRemoveRows(ts,...rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const is=this.operations.removeRows(ns);this.undoRedo.saveOperation(new RemoveRowsUndoEntry(ns,is))}addColumns(ts,...rs){const ns=new AddColumnsCommand(ts,rs);this.ensureItIsPossibleToAddColumns(ts,...rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(ns),this.undoRedo.saveOperation(new AddColumnsUndoEntry(ns))}removeColumns(ts,...rs){const ns=new RemoveColumnsCommand(ts,rs);this.ensureItIsPossibleToRemoveColumns(ts,...rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const is=this.operations.removeColumns(ns);this.undoRedo.saveOperation(new RemoveColumnsUndoEntry(ns,is))}moveCells(ts,rs,ns,is){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:as,overwrittenCellsData:os,addedGlobalNamedExpressions:ls}=this.operations.moveCells(ts,rs,ns,is);this.undoRedo.saveOperation(new MoveCellsUndoEntry(ts,rs,ns,is,os,ls,as))}moveRows(ts,rs,ns,is){this.ensureItIsPossibleToMoveRows(ts,rs,ns,is),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const as=this.operations.moveRows(ts,rs,ns,is);this.undoRedo.saveOperation(new MoveRowsUndoEntry(ts,rs,ns,is,as))}moveColumns(ts,rs,ns,is){this.ensureItIsPossibleToMoveColumns(ts,rs,ns,is),this.undoRedo.clearRedoStack();const as=this.operations.moveColumns(ts,rs,ns,is);this.undoRedo.saveOperation(new MoveColumnsUndoEntry(ts,rs,ns,is,as))}cut(ts,rs,ns){this.clipboardOperations.cut(ts,rs,ns)}ensureItIsPossibleToCopy(ts,rs,ns){if(!isPositiveInteger(rs))throw new InvalidArgumentsError("width to be positive integer.");if(!isPositiveInteger(ns))throw new InvalidArgumentsError("height to be positive integer.")}copy(ts,rs,ns){this.ensureItIsPossibleToCopy(ts,rs,ns),this.clipboardOperations.copy(ts,rs,ns)}paste(ts){const rs=this.clipboardOperations.clipboard;if(rs===void 0)throw new NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(rs.sourceLeftCorner,rs.width,rs.height,ts);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(ts);const ns=AbsoluteCellRange.spanFrom(ts,rs.width,rs.height),is=this.operations.getRangeClipboardCells(ns);this.undoRedo.clearRedoStack();const as=this.operations.restoreClipboardCells(rs.sourceLeftCorner.sheet,rs.getContent(ts));this.undoRedo.saveOperation(new PasteUndoEntry(ts,is,rs.content,as))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return this.clipboardOperations.clipboard===void 0}clearClipboard(){this.clipboardOperations.clear()}addSheet(ts){ts!==void 0&&this.ensureItIsPossibleToAddSheet(ts),this.undoRedo.clearRedoStack();const rs=this.operations.addSheet(ts);return this.undoRedo.saveOperation(new AddSheetUndoEntry(rs)),rs}removeSheet(ts){this.ensureScopeIdIsValid(ts),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const rs=this.sheetMapping.fetchDisplayName(ts),ns=this.operations.getSheetClipboardCells(ts),{version:is,scopedNamedExpressions:as}=this.operations.removeSheet(ts);this.undoRedo.saveOperation(new RemoveSheetUndoEntry(rs,ts,ns,as,is))}renameSheet(ts,rs){this.ensureItIsPossibleToRenameSheet(ts,rs);const ns=this.operations.renameSheet(ts,rs);return ns!==void 0&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new RenameSheetUndoEntry(ts,ns,rs))),ns}clearSheet(ts){this.ensureScopeIdIsValid(ts),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const rs=this.operations.getSheetClipboardCells(ts);this.operations.clearSheet(ts),this.undoRedo.saveOperation(new ClearSheetUndoEntry(ts,rs))}setCellContents(ts,rs){if(!(rs instanceof Array))rs=[[rs]];else for(let is=0;is<rs.length;is++)if(!(rs[is]instanceof Array))throw new InvalidArgumentsError("an array of arrays or a raw cell value.");this.ensureItIsPossibleToChangeCellContents(ts,rs),this.undoRedo.clearRedoStack();const ns=[];for(let is=0;is<rs.length;is++)for(let as=0;as<rs[is].length;as++){const os={sheet:ts.sheet,row:ts.row+is,col:ts.col+as},ls=rs[is][as];this.clipboardOperations.abortCut();const us=this.operations.setCellContent(os,ls);ns.push({address:os,newContent:ls,oldContent:us})}this.undoRedo.saveOperation(new SetCellContentsUndoEntry(ns))}setSheetContent(ts,rs){this.ensureScopeIdIsValid(ts),this.ensureItIsPossibleToChangeSheetContents(ts,rs),validateAsSheet(rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const ns=this.operations.getSheetClipboardCells(ts);this.operations.setSheetContent(ts,rs),this.undoRedo.saveOperation(new SetSheetContentUndoEntry(ts,ns,rs))}setRowOrder(ts,rs){this.validateSwapRowIndexes(ts,rs),this.testRowOrderForArrays(ts,rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const ns=this.operations.setRowOrder(ts,rs);this.undoRedo.saveOperation(new SetRowOrderUndoEntry(ts,rs,ns))}validateSwapRowIndexes(ts,rs){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);this.validateRowOrColumnMapping(ts,rs,"row")}testColumnOrderForArrays(ts,rs){for(const[ns,is]of rs)if(ns!==is){const as=AbsoluteCellRange.spanFrom({sheet:ts,col:ns,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(as))throw new SourceLocationHasArrayError}}setColumnOrder(ts,rs){this.validateSwapColumnIndexes(ts,rs),this.testColumnOrderForArrays(ts,rs),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const ns=this.operations.setColumnOrder(ts,rs);this.undoRedo.saveOperation(new SetColumnOrderUndoEntry(ts,rs,ns))}validateSwapColumnIndexes(ts,rs){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);this.validateRowOrColumnMapping(ts,rs,"column")}testRowOrderForArrays(ts,rs){for(const[ns,is]of rs)if(ns!==is){const as=AbsoluteCellRange.spanFrom({sheet:ts,col:0,row:ns},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(as))throw new SourceLocationHasArrayError}}mappingFromOrder(ts,rs,ns){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);const is=ns==="row"?this.dependencyGraph.getSheetHeight(ts):this.dependencyGraph.getSheetWidth(ts);if(rs.length!==is)throw new InvalidArgumentsError(`number of ${ns}s provided to be sheet ${ns==="row"?"height":"width"}.`);const as=[];for(let os=0;os<is;os++)rs[os]!==os&&as.push([os,rs[os]]);return as}undo(){if(this.undoRedo.isUndoStackEmpty())throw new NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(ts,rs,ns,is){this.ensureItIsPossibleToAddNamedExpression(ts,rs,ns),this.operations.addNamedExpression(ts,rs,ns,is),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new AddNamedExpressionUndoEntry(ts,rs,ns,is))}changeNamedExpressionExpression(ts,rs,ns,is){this.ensureItIsPossibleToChangeNamedExpression(ts,ns,rs);const[as,os]=this.operations.changeNamedExpressionExpression(ts,ns,rs,is);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new ChangeNamedExpressionUndoEntry(as,ns,os,rs,is))}removeNamedExpression(ts,rs){this.ensureScopeIdIsValid(rs);const[ns,is]=this.operations.removeNamedExpression(ts,rs);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new RemoveNamedExpressionUndoEntry(ns,is,rs)),ns}ensureItIsPossibleToAddNamedExpression(ts,rs,ns){this.ensureScopeIdIsValid(ns),this.ensureNamedExpressionNameIsValid(ts,ns),this.ensureNamedExpressionIsValid(rs)}ensureItIsPossibleToChangeNamedExpression(ts,rs,ns){if(this.ensureScopeIdIsValid(ns),this.namedExpressions.namedExpressionForScope(ts,ns)===void 0)throw new NamedExpressionDoesNotExistError(ts);this.ensureNamedExpressionIsValid(rs)}isItPossibleToRemoveNamedExpression(ts,rs){if(this.ensureScopeIdIsValid(rs),this.namedExpressions.namedExpressionForScope(ts,rs)===void 0)throw new NamedExpressionDoesNotExistError(ts)}ensureItIsPossibleToAddRows(ts,...rs){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);const ns=this.dependencyGraph.getSheetHeight(ts),is=rs.map(as=>as[1]).reduce((as,os)=>as+os,0);if(ns+is>this.maxRows)throw new SheetSizeLimitExceededError;for(const[as,os]of rs)if(!isNonnegativeInteger(as)||!isPositiveInteger(os))throw new InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(ts,...rs){for(const[ns,is]of rs){const as=ns+is-1;if(!isNonnegativeInteger(ns)||!isNonnegativeInteger(as))throw new InvalidArgumentsError("starting and ending row to be nonnegative.");if(as<ns)throw new InvalidArgumentsError("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts)}}ensureItIsPossibleToAddColumns(ts,...rs){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);const ns=this.dependencyGraph.getSheetWidth(ts),is=rs.map(as=>as[1]).reduce((as,os)=>as+os,0);if(ns+is>this.maxColumns)throw new SheetSizeLimitExceededError;for(const[as,os]of rs)if(!isNonnegativeInteger(as)||!isPositiveInteger(os))throw new InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(ts,...rs){for(const[ns,is]of rs){const as=ns+is-1;if(!isNonnegativeInteger(ns)||!isNonnegativeInteger(as))throw new InvalidArgumentsError("starting and ending column to be nonnegative.");if(as<ns)throw new InvalidArgumentsError("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts)}}ensureItIsPossibleToMoveRows(ts,rs,ns,is){this.ensureItIsPossibleToAddRows(ts,[is,ns]);const as=simpleCellAddress(ts,0,rs),os=simpleCellAddress(ts,0,is);if(!this.sheetMapping.hasSheetWithId(ts)||invalidSimpleCellAddress(as)||invalidSimpleCellAddress(os)||!isPositiveInteger(ns)||is<=rs+ns&&is>=rs)throw new InvalidArgumentsError("a valid range of rows to move.");const ls=this.dependencyGraph.getSheetWidth(ts),us=AbsoluteCellRange.spanFrom(as,ls,ns);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(us))throw new SourceLocationHasArrayError;if(is>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(RowsSpan.fromNumberOfRows(ts,is-1,2)))throw new TargetLocationHasArrayError}ensureItIsPossibleToMoveColumns(ts,rs,ns,is){this.ensureItIsPossibleToAddColumns(ts,[is,ns]);const as=simpleCellAddress(ts,rs,0),os=simpleCellAddress(ts,is,0);if(!this.sheetMapping.hasSheetWithId(ts)||invalidSimpleCellAddress(as)||invalidSimpleCellAddress(os)||!isPositiveInteger(ns)||is<=rs+ns&&is>=rs)throw new InvalidArgumentsError("a valid range of columns to move.");const ls=this.dependencyGraph.getSheetHeight(ts),us=AbsoluteCellRange.spanFrom(as,ns,ls);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(us))throw new SourceLocationHasArrayError;if(is>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(ColumnsSpan.fromNumberOfColumns(ts,is-1,2)))throw new TargetLocationHasArrayError}ensureItIsPossibleToAddSheet(ts){if(this.sheetMapping.hasSheetWithName(ts))throw new SheetNameAlreadyTakenError(ts)}ensureItIsPossibleToRenameSheet(ts,rs){if(!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts);const ns=this.sheetMapping.get(rs);if(ns!==void 0&&ns!==ts)throw new SheetNameAlreadyTakenError(rs)}ensureItIsPossibleToChangeContent(ts){if(invalidSimpleCellAddress(ts))throw new InvalidAddressError(ts);if(!this.sheetMapping.hasSheetWithId(ts.sheet))throw new NoSheetWithIdError(ts.sheet)}ensureItIsPossibleToChangeCellContents(ts,rs){const ns=findBoundaries(rs),is=AbsoluteCellRange.spanFrom(ts,ns.width,ns.height);this.ensureRangeInSizeLimits(is);for(const as of is.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(as)}ensureItIsPossibleToChangeSheetContents(ts,rs){const ns=findBoundaries(rs),is=AbsoluteCellRange.spanFrom(simpleCellAddress(ts,0,0),ns.width,ns.height);this.ensureRangeInSizeLimits(is)}ensureRangeInSizeLimits(ts){if(ts.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(ts){if(ts!==void 0&&!this.sheetMapping.hasSheetWithId(ts))throw new NoSheetWithIdError(ts)}validateRowOrColumnMapping(ts,rs,ns){const is=ns==="row"?this.dependencyGraph.getSheetHeight(ts):this.dependencyGraph.getSheetWidth(ts),as=rs.map(([ls,us])=>ls).sort((ls,us)=>ls-us),os=rs.map(([ls,us])=>us).sort((ls,us)=>ls-us);for(let ls=0;ls<as.length;ls++){if(!isNonnegativeInteger(as[ls])||as[ls]>=is)throw new InvalidArgumentsError(`${ns} numbers to be nonnegative integers and less than sheet ${ns==="row"?"height":"width"}.`);if(as[ls]===as[ls+1])throw new InvalidArgumentsError(`source ${ns} numbers to be unique.`);if(as[ls]!==os[ls])throw new InvalidArgumentsError(`target ${ns} numbers to be permutation of source ${ns} numbers.`)}}ensureNamedExpressionNameIsValid(ts,rs){if(!this.namedExpressions.isNameValid(ts))throw new NamedExpressionNameIsInvalidError(ts);if(!this.namedExpressions.isNameAvailable(ts,rs))throw new NamedExpressionNameIsAlreadyTakenError(ts)}ensureNamedExpressionIsValid(ts){const rs=this.cellContentParser.parse(ts);if(rs instanceof CellContent.Formula){const ns=this.parser.parse(rs.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(ns.ast))throw new NoRelativeAddressesAllowedError}}}function isPositiveInteger(ss){return Number.isInteger(ss)&&ss>0}function isNonnegativeInteger(ss){return Number.isInteger(ss)&&ss>=0}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Evaluator{constructor(ts,rs,ns,is,as,os){this.config=ts,this.stats=rs,this.interpreter=ns,this.lazilyTransformingAstService=is,this.dependencyGraph=as,this.columnSearch=os}run(){this.stats.start(StatType.TOP_SORT);const{sorted:ts,cycled:rs}=this.dependencyGraph.topSortWithScc();this.stats.end(StatType.TOP_SORT),this.stats.measure(StatType.EVALUATION,()=>{this.recomputeFormulas(rs,ts)})}partialRun(ts){const rs=ContentChanges.empty();return this.stats.measure(StatType.EVALUATION,()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(ts,ns=>{if(ns instanceof FormulaVertex){const is=ns.isComputed()?ns.getCellValue():void 0,as=this.recomputeFormulaVertexValue(ns);if(as!==is){const os=ns.getAddress(this.lazilyTransformingAstService);return rs.addChange(as,os),this.columnSearch.change(getRawValue(is),getRawValue(as),os),!0}return!1}else return ns instanceof RangeVertex&&ns.clearCache(),!0},ns=>{if(ns instanceof RangeVertex)ns.clearCache();else if(ns instanceof FormulaVertex){const is=ns.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove(getRawValue(ns.valueOrUndef()),is);const as=new CellError(ErrorType.CYCLE,void 0,ns);ns.setCellValue(as),rs.addChange(as,is)}})}),rs}runAndForget(ts,rs,ns){const is=[];for(const os of absolutizeDependencies(ns,rs))if(os instanceof AbsoluteCellRange){const ls=os;if(this.dependencyGraph.getRange(ls.start,ls.end)===void 0){const us=new RangeVertex(ls);this.dependencyGraph.rangeMapping.setRange(us),is.push(us)}}const as=this.evaluateAstToCellValue(ts,new InterpreterState(rs,this.config.useArrayArithmetic));return is.forEach(os=>{this.dependencyGraph.rangeMapping.removeRange(os)}),as}recomputeFormulas(ts,rs){ts.forEach(ns=>{ns instanceof FormulaVertex&&ns.setCellValue(new CellError(ErrorType.CYCLE,void 0,ns))}),rs.forEach(ns=>{if(ns instanceof FormulaVertex){const is=this.recomputeFormulaVertexValue(ns),as=ns.getAddress(this.lazilyTransformingAstService);this.columnSearch.add(getRawValue(is),as)}else ns instanceof RangeVertex&&ns.clearCache()})}recomputeFormulaVertexValue(ts){const rs=ts.getAddress(this.lazilyTransformingAstService);if(ts instanceof ArrayVertex&&(ts.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(ts)))return ts.setNoSpace();{const ns=ts.getFormula(this.lazilyTransformingAstService),is=this.evaluateAstToCellValue(ns,new InterpreterState(rs,this.config.useArrayArithmetic,ts));return ts.setCellValue(is)}}evaluateAstToCellValue(ts,rs){const ns=this.interpreter.evaluateAst(ts,rs);return ns instanceof SimpleRangeValue?ns:ns===EmptyValue&&this.config.evaluateNullToZero?0:ns}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ExportedCellChange{constructor(ts,rs){this.address=ts,this.newValue=rs}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}class ExportedNamedExpressionChange{constructor(ts,rs){this.name=ts,this.newValue=rs}}class Exporter{constructor(ts,rs,ns,is){this.config=ts,this.namedExpressions=rs,this.sheetIndexMapping=ns,this.lazilyTransformingService=is}exportChange(ts){const rs=ts.value,ns=ts.address;if(ns.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS){const is=this.namedExpressions.namedExpressionInAddress(ns.row);if(!is)throw new Error("Missing named expression");return new ExportedNamedExpressionChange(is.displayName,this.exportScalarOrRange(rs))}else if(rs instanceof SimpleRangeValue){const is=[];for(const[as,os]of rs.entriesFromTopLeftCorner(ns))is.push(new ExportedCellChange(os,this.exportValue(as)));return is}else return new ExportedCellChange(ns,this.exportValue(rs))}exportValue(ts){return ts instanceof SimpleRangeValue?this.detailedError(new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):this.config.smartRounding&&isExtendedNumber(ts)?this.cellValueRounding(getRawValue(ts)):ts instanceof CellError?this.detailedError(ts):ts===EmptyValue?null:getRawValue(ts)}exportScalarOrRange(ts){return ts instanceof SimpleRangeValue?ts.rawData().map(rs=>rs.map(ns=>this.exportValue(ns))):this.exportValue(ts)}detailedError(ts){var rs,ns;let is;const as=(rs=ts.root)===null||rs===void 0?void 0:rs.getAddress(this.lazilyTransformingService);return as!==void 0&&(as.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS?is=(ns=this.namedExpressions.namedExpressionInAddress(as.row))===null||ns===void 0?void 0:ns.displayName:is=simpleCellAddressToString(this.sheetIndexMapping,as,-1)),new DetailedCellError(ts,this.config.translationPackage.getErrorTranslation(ts.type),is)}cellValueRounding(ts){if(ts===0)return ts;const rs=Math.floor(Math.log10(Math.abs(ts))),ns=Math.pow(10,this.config.precisionRounding-rs);return ts<0?-Math.round(-ts*ns)/ns:Math.round(ts*ns)/ns}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class GraphBuilder{constructor(ts,rs,ns,is,as,os){this.dependencyGraph=ts,this.columnSearch=rs,this.parser=ns,this.cellContentParser=is,this.stats=as,this.arraySizePredictor=os,this.buildStrategy=new SimpleStrategy(ts,rs,ns,as,is,os)}buildGraph(ts,rs){const ns=rs.measure(StatType.COLLECT_DEPENDENCIES,()=>this.buildStrategy.run(ts));this.dependencyGraph.getAndClearContentChanges(),rs.measure(StatType.PROCESS_DEPENDENCIES,()=>this.processDependencies(ns))}processDependencies(ts){ts.forEach((rs,ns)=>{this.dependencyGraph.processCellDependencies(rs,ns)})}}class SimpleStrategy{constructor(ts,rs,ns,is,as,os){this.dependencyGraph=ts,this.columnIndex=rs,this.parser=ns,this.stats=is,this.cellContentParser=as,this.arraySizePredictor=os}run(ts){const rs=new Map;for(const ns in ts){const is=this.dependencyGraph.getSheetId(ns),as=ts[ns];for(let os=0;os<as.length;++os){const ls=as[os];for(let us=0;us<ls.length;++us){const cs=ls[us],ps=simpleCellAddress(is,us,os),ds=this.cellContentParser.parse(cs);if(ds instanceof CellContent.Formula){const fs=this.stats.measure(StatType.PARSER,()=>this.parser.parse(ds.formula,ps));if(fs.errors.length>0){this.shrinkArrayIfNeeded(ps);const hs=new ParsingErrorVertex(fs.errors,ds.formula);this.dependencyGraph.addVertex(ps,hs)}else{this.shrinkArrayIfNeeded(ps);const hs=this.arraySizePredictor.checkArraySize(fs.ast,ps);if(hs.isScalar()){const ys=new FormulaCellVertex(fs.ast,ps,0);rs.set(ys,absolutizeDependencies(fs.dependencies,ps)),this.dependencyGraph.addVertex(ps,ys),fs.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(ys),fs.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(ys)}else{const ys=new ArrayVertex(fs.ast,ps,new ArraySize(hs.width,hs.height));rs.set(ys,absolutizeDependencies(fs.dependencies,ps)),this.dependencyGraph.addArrayVertex(ps,ys)}}}else if(!(ds instanceof CellContent.Empty)){this.shrinkArrayIfNeeded(ps);const fs=new ValueCellVertex(ds.value,cs);this.columnIndex.add(getRawValue(ds.value),ps),this.dependencyGraph.addVertex(ps,fs)}}}}return rs}shrinkArrayIfNeeded(ts){const rs=this.dependencyGraph.getCell(ts);rs instanceof ArrayVertex&&this.dependencyGraph.shrinkArrayToCorner(rs)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const LICENSE_STATUS_MAP=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class VersionPlugin extends FunctionPlugin{version(ts,rs){return this.runFunction(ts.args,rs,this.metadata("VERSION"),()=>{const{licenseKeyValidityState:ns,licenseKey:is}=this.config;let as;return LICENSE_STATUS_MAP.has(is)?as=LICENSE_STATUS_MAP.get(is):LICENSE_STATUS_MAP.has(ns)?as=LICENSE_STATUS_MAP.get(ns):ns==="valid"&&(as=is.slice(-5)),`HyperFormula v${HyperFormula.version}, ${as}`})}}VersionPlugin.implementedFunctions={VERSION:{method:"version",parameters:[]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function validateAndReturnMetadataFromName(ss,ts){var rs;let ns=ts.implementedFunctions[ss];const is=(rs=ts.aliases)===null||rs===void 0?void 0:rs[ss];if(is!==void 0){if(ns!==void 0)throw new AliasAlreadyExisting(ss,ts.name);ns=ts.implementedFunctions[is]}if(ns===void 0)throw FunctionPluginValidationError.functionNotDeclaredInPlugin(ss,ts.name);return ns}class FunctionRegistry{constructor(ts){if(this.config=ts,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=rs=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(rs),this.isFunctionVolatile=rs=>this.volatileFunctions.has(rs),this.isArrayFunction=rs=>this.arrayFunctions.has(rs),this.isFunctionDependentOnSheetStructureChange=rs=>this.structuralChangeFunctions.has(rs),ts.functionPlugins.length>0){this.instancePlugins=new Map;for(const rs of ts.functionPlugins)FunctionRegistry.loadPluginFunctions(rs,this.instancePlugins)}else this.instancePlugins=new Map(FunctionRegistry.plugins);for(const[rs,ns]of FunctionRegistry.protectedFunctions())FunctionRegistry.loadFunctionUnprotected(ns,rs,this.instancePlugins);for(const[rs,ns]of this.instancePlugins.entries())this.categorizeFunction(rs,validateAndReturnMetadataFromName(rs,ns))}static registerFunctionPlugin(ts,rs){this.loadPluginFunctions(ts,this.plugins),rs!==void 0&&this.loadTranslations(rs)}static registerFunction(ts,rs,ns){this.loadPluginFunction(rs,ts,this.plugins),ns!==void 0&&this.loadTranslations(ns)}static unregisterFunction(ts){if(this.functionIsProtected(ts))throw ProtectedFunctionError.cannotUnregisterFunctionWithId(ts);this.plugins.delete(ts)}static unregisterFunctionPlugin(ts){for(const rs of this.protectedPlugins())if(rs===ts)throw ProtectedFunctionError.cannotUnregisterProtectedPlugin();for(const[rs,ns]of this.plugins.entries())ns===ts&&this.plugins.delete(rs)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(ts){if(!this.functionIsProtected(ts))return this.plugins.get(ts)}static functionIsProtected(ts){return this._protectedPlugins.has(ts)}static loadTranslations(ts){const rs=new Set(HyperFormula.getRegisteredLanguagesCodes());Object.keys(ts).forEach(ns=>{rs.has(ns)&&HyperFormula.getLanguage(ns).extendFunctions(ts[ns])})}static loadPluginFunctions(ts,rs){Object.keys(ts.implementedFunctions).forEach(ns=>{this.loadPluginFunction(ts,ns,rs)}),ts.aliases!==void 0&&Object.keys(ts.aliases).forEach(ns=>{this.loadPluginFunction(ts,ns,rs)})}static loadPluginFunction(ts,rs,ns){if(this.functionIsProtected(rs))throw ProtectedFunctionError.cannotRegisterFunctionWithId(rs);this.loadFunctionUnprotected(ts,rs,ns)}static loadFunctionUnprotected(ts,rs,ns){const is=validateAndReturnMetadataFromName(rs,ts).method;if(Object.prototype.hasOwnProperty.call(ts.prototype,is))ns.set(rs,ts);else throw FunctionPluginValidationError.functionMethodNotFound(is,ts.name)}static*protectedFunctions(){for(const[ts,rs]of this._protectedPlugins)rs!==void 0&&(yield[ts,rs])}static*protectedPlugins(){for(const[,ts]of this._protectedPlugins)ts!==void 0&&(yield ts)}initializePlugins(ts){const rs=[];for(const[ns,is]of this.instancePlugins.entries()){let as=rs.find(cs=>cs instanceof is);as===void 0&&(as=new is(ts),rs.push(as));const os=validateAndReturnMetadataFromName(ns,is),ls=os.method;this.functions.set(ns,[ls,as]);const us=os.arraySizeMethod;us!==void 0&&this.arraySizeFunctions.set(ns,[us,as])}}getFunctionPlugin(ts){if(!FunctionRegistry.functionIsProtected(ts))return this.instancePlugins.get(ts)}getFunction(ts){const rs=this.functions.get(ts);if(rs!==void 0&&this.config.translationPackage.isFunctionTranslated(ts)){const[ns,is]=rs;return(as,os)=>is[ns](as,os)}else return}getArraySizeFunction(ts){const rs=this.arraySizeFunctions.get(ts);if(rs!==void 0&&this.config.translationPackage.isFunctionTranslated(ts)){const[ns,is]=rs;return(as,os)=>is[ns](as,os)}else return}getMetadata(ts){return this.functionsMetadata.get(ts)}getPlugins(){const ts=new Set;for(const[rs,ns]of this.instancePlugins)FunctionRegistry.functionIsProtected(rs)||ts.add(ns);return Array.from(ts)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(ts,rs){rs.isVolatile&&this.volatileFunctions.add(ts),rs.arrayFunction&&this.arrayFunctions.add(ts),rs.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(ts),rs.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(ts),this.functionsMetadata.set(ts,rs)}}FunctionRegistry.plugins=new Map,FunctionRegistry._protectedPlugins=new Map([["VERSION",VersionPlugin],["OFFSET",void 0]]);/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var CriterionType;(function(ss){ss.GREATER_THAN="GREATER_THAN",ss.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",ss.LESS_THAN="LESS_THAN",ss.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",ss.NOT_EQUAL="NOT_EQUAL",ss.EQUAL="EQUAL"})(CriterionType||(CriterionType={}));const buildCriterion=(ss,ts)=>({operator:ss,value:ts});class CriterionBuilder{constructor(ts){var rs,ns,is,as;this.trueString=(ns=(rs=ts.translationPackage.getMaybeFunctionTranslation("TRUE"))===null||rs===void 0?void 0:rs.toLowerCase())!==null&&ns!==void 0?ns:"true",this.falseString=(as=(is=ts.translationPackage.getMaybeFunctionTranslation("FALSE"))===null||is===void 0?void 0:is.toLowerCase())!==null&&as!==void 0?as:"false"}fromCellValue(ts,rs){if(typeof ts!="string"&&typeof ts!="boolean"&&typeof ts!="number")return;const ns=this.parseCriterion(ts,rs);if(ns!==void 0)return{raw:ts,lambda:buildCriterionLambda(ns,rs)}}parseCriterion(ts,rs){if(typeof ts=="number"||typeof ts=="boolean")return buildCriterion(CriterionType.EQUAL,ts);if(typeof ts=="string"){const ns=ANY_CRITERION_REGEX.exec(ts);let is,as;ns?(as=StrToCriterionType(ns[1]),is=ns[2]):(as=CriterionType.EQUAL,is=ts);const os=rs.coerceToMaybeNumber(is),ls=is.toLowerCase()===this.trueString?!0:is.toLowerCase()===this.falseString?!1:void 0;if(as===void 0)return;if(is==="")return buildCriterion(as,null);if(os===void 0){if(as===CriterionType.EQUAL||as===CriterionType.NOT_EQUAL)return buildCriterion(as,ls??is)}else return buildCriterion(as,getRawValue(os))}}}const ANY_CRITERION_REGEX=/([<>=]+)(.*)/;function StrToCriterionType(ss){switch(ss){case">":return CriterionType.GREATER_THAN;case">=":return CriterionType.GREATER_THAN_OR_EQUAL;case"<":return CriterionType.LESS_THAN;case"<=":return CriterionType.LESS_THAN_OR_EQUAL;case"<>":return CriterionType.NOT_EQUAL;case"=":return CriterionType.EQUAL;default:return}}const buildCriterionLambda=(ss,ts)=>{switch(ss.operator){case CriterionType.GREATER_THAN:return typeof ss.value=="number"?rs=>typeof rs=="number"&&ts.floatCmp(rs,ss.value)>0:rs=>!1;case CriterionType.GREATER_THAN_OR_EQUAL:return typeof ss.value=="number"?rs=>typeof rs=="number"&&ts.floatCmp(rs,ss.value)>=0:rs=>!1;case CriterionType.LESS_THAN:return typeof ss.value=="number"?rs=>typeof rs=="number"&&ts.floatCmp(rs,ss.value)<0:rs=>!1;case CriterionType.LESS_THAN_OR_EQUAL:return typeof ss.value=="number"?rs=>typeof rs=="number"&&ts.floatCmp(rs,ss.value)<=0:rs=>!1;case CriterionType.EQUAL:return typeof ss.value=="number"?rs=>{if(typeof rs=="number")return ts.floatCmp(rs,ss.value)===0;if(typeof rs=="string"){if(rs==="")return!1;const ns=ts.coerceToMaybeNumber(rs);return ns===void 0?!1:ts.floatCmp(ns,ss.value)===0}else return!1}:typeof ss.value=="string"?ts.eqMatcherFunction(ss.value):typeof ss.value=="boolean"?rs=>typeof rs=="boolean"&&rs===ss.value:rs=>rs===EmptyValue;case CriterionType.NOT_EQUAL:return typeof ss.value=="number"?rs=>{if(typeof rs=="number")return ts.floatCmp(rs,ss.value)!==0;if(typeof rs=="string"){if(rs==="")return!0;const ns=ts.coerceToMaybeNumber(rs);return ns===void 0?!0:ts.floatCmp(ns,ss.value)!==0}else return!0}:typeof ss.value=="string"?ts.neqMatcherFunction(ss.value):typeof ss.value=="boolean"?rs=>typeof rs!="boolean"||rs!==ss.value:rs=>rs!==EmptyValue}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Interpreter{constructor(ts,rs,ns,is,as,os,ls,us,cs,ps){this.config=ts,this.dependencyGraph=rs,this.columnSearch=ns,this.stats=is,this.arithmeticHelper=as,this.functionRegistry=os,this.namedExpressions=ls,this.serialization=us,this.arraySizePredictor=cs,this.dateTimeHelper=ps,this.equalOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.eq,ds,fs),this.notEqualOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.neq,ds,fs),this.greaterThanOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.gt,ds,fs),this.lessThanOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.lt,ds,fs),this.greaterThanOrEqualOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.geq,ds,fs),this.lessThanOrEqualOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.leq,ds,fs),this.concatOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.concat,coerceScalarToString(ds),coerceScalarToString(fs)),this.plusOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(ds),this.arithmeticHelper.coerceScalarToNumberOrError(fs)),this.minusOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(ds),this.arithmeticHelper.coerceScalarToNumberOrError(fs)),this.timesOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(ds),this.arithmeticHelper.coerceScalarToNumberOrError(fs)),this.powerOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(ds),this.arithmeticHelper.coerceScalarToNumberOrError(fs)),this.divOp=(ds,fs)=>binaryErrorWrapper(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(ds),this.arithmeticHelper.coerceScalarToNumberOrError(fs)),this.unaryMinusOp=ds=>unaryErrorWrapper(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(ds)),this.percentOp=ds=>unaryErrorWrapper(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(ds)),this.unaryPlusOp=ds=>this.arithmeticHelper.unaryPlus(ds),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new CriterionBuilder(ts)}evaluateAst(ts,rs){let ns=this.evaluateAstWithoutPostprocessing(ts,rs);if(isExtendedNumber(ns)){if(isNumberOverflow(getRawValue(ns)))return new CellError(ErrorType.NUM,ErrorMessage.NaN);ns=cloneNumber(ns,fixNegativeZero(getRawValue(ns)))}return ns instanceof SimpleRangeValue&&ns.height()===1&&ns.width()===1&&([[ns]]=ns.data),wrapperForRootVertex(ns,rs.formulaVertex)}evaluateAstWithoutPostprocessing(ts,rs){switch(ts.type){case AstNodeType.EMPTY:return EmptyValue;case AstNodeType.CELL_REFERENCE:{const ns=ts.reference.toSimpleCellAddress(rs.formulaAddress);return invalidSimpleCellAddress(ns)?new CellError(ErrorType.REF,ErrorMessage.BadRef):this.dependencyGraph.getCellValue(ns)}case AstNodeType.NUMBER:case AstNodeType.STRING:return ts.value;case AstNodeType.CONCATENATE_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.concatOp,ns,is,rs)}case AstNodeType.EQUALS_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.equalOp,ns,is,rs)}case AstNodeType.NOT_EQUAL_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.notEqualOp,ns,is,rs)}case AstNodeType.GREATER_THAN_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.greaterThanOp,ns,is,rs)}case AstNodeType.LESS_THAN_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.lessThanOp,ns,is,rs)}case AstNodeType.GREATER_THAN_OR_EQUAL_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,ns,is,rs)}case AstNodeType.LESS_THAN_OR_EQUAL_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.lessThanOrEqualOp,ns,is,rs)}case AstNodeType.PLUS_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.plusOp,ns,is,rs)}case AstNodeType.MINUS_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.minusOp,ns,is,rs)}case AstNodeType.TIMES_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.timesOp,ns,is,rs)}case AstNodeType.POWER_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.powerOp,ns,is,rs)}case AstNodeType.DIV_OP:{const ns=this.evaluateAst(ts.left,rs),is=this.evaluateAst(ts.right,rs);return this.binaryRangeWrapper(this.divOp,ns,is,rs)}case AstNodeType.PLUS_UNARY_OP:{const ns=this.evaluateAst(ts.value,rs);return this.unaryRangeWrapper(this.unaryPlusOp,ns,rs)}case AstNodeType.MINUS_UNARY_OP:{const ns=this.evaluateAst(ts.value,rs);return this.unaryRangeWrapper(this.unaryMinusOp,ns,rs)}case AstNodeType.PERCENT_OP:{const ns=this.evaluateAst(ts.value,rs);return this.unaryRangeWrapper(this.percentOp,ns,rs)}case AstNodeType.FUNCTION_CALL:{if(this.config.licenseKeyValidityState!=="valid"&&!FunctionRegistry.functionIsProtected(ts.procedureName))return new CellError(ErrorType.LIC,ErrorMessage.LicenseKey(this.config.licenseKeyValidityState));const ns=this.functionRegistry.getFunction(ts.procedureName);return ns!==void 0?ns(ts,new InterpreterState(rs.formulaAddress,rs.arraysFlag||this.functionRegistry.isArrayFunction(ts.procedureName),rs.formulaVertex)):new CellError(ErrorType.NAME,ErrorMessage.FunctionName(ts.procedureName))}case AstNodeType.NAMED_EXPRESSION:{const ns=this.namedExpressions.nearestNamedExpression(ts.expressionName,rs.formulaAddress.sheet);return ns?this.dependencyGraph.getCellValue(ns.address):new CellError(ErrorType.NAME,ErrorMessage.NamedExpressionName(ts.expressionName))}case AstNodeType.CELL_RANGE:{if(!this.rangeSpansOneSheet(ts))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const ns=AbsoluteCellRange.fromCellRange(ts,rs.formulaAddress),is=this.dependencyGraph.getArray(ns);if(is){const as=is.array;if(as instanceof NotComputedArray)throw new Error("Array should be already computed");if(as instanceof CellError)return as;if(as instanceof ArrayValue)return SimpleRangeValue.fromRange(as.raw(),ns,this.dependencyGraph);throw new Error("Unknown array")}else return SimpleRangeValue.onlyRange(ns,this.dependencyGraph)}case AstNodeType.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(ts))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const ns=AbsoluteColumnRange.fromColumnRange(ts,rs.formulaAddress);return SimpleRangeValue.onlyRange(ns,this.dependencyGraph)}case AstNodeType.ROW_RANGE:{if(!this.rangeSpansOneSheet(ts))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);const ns=AbsoluteRowRange.fromRowRangeAst(ts,rs.formulaAddress);return SimpleRangeValue.onlyRange(ns,this.dependencyGraph)}case AstNodeType.PARENTHESIS:return this.evaluateAst(ts.expression,rs);case AstNodeType.ARRAY:{let ns;const is=[];for(const as of ts.args){let os;const ls=[];for(const cs of as){const ps=coerceToRange(this.evaluateAst(cs,rs)),ds=ps.height();if(os===void 0)os=ds,ls.push(...ps.data);else if(os===ds)for(let fs=0;fs<ds;fs++)ls[fs].push(...ps.data[fs]);else return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch)}const us=ls[0].length;if(ns===void 0)ns=us,is.push(...ls);else if(ns===us)is.push(...ls);else return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch)}return SimpleRangeValue.onlyValues(is)}case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.ERROR:return ts.error}}rangeSpansOneSheet(ts){return ts.start.sheet===ts.end.sheet}unaryRangeWrapper(ts,rs,ns){var is;if(rs instanceof SimpleRangeValue&&!ns.arraysFlag&&(rs=(is=coerceRangeToScalar(rs,ns))!==null&&is!==void 0?is:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),rs instanceof CellError)return rs;if(rs instanceof SimpleRangeValue){const as=rs.data.map(os=>os.map(ts));return SimpleRangeValue.onlyValues(as)}return ts(rs)}binaryRangeWrapper(ts,rs,ns,is){var as,os;if(rs instanceof SimpleRangeValue&&!is.arraysFlag&&(rs=(as=coerceRangeToScalar(rs,is))!==null&&as!==void 0?as:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),rs instanceof CellError)return rs;if(ns instanceof SimpleRangeValue&&!is.arraysFlag&&(ns=(os=coerceRangeToScalar(ns,is))!==null&&os!==void 0?os:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),ns instanceof CellError)return ns;if(rs instanceof SimpleRangeValue||ns instanceof SimpleRangeValue){if(!(rs instanceof SimpleRangeValue))if(ns.isAdHoc()){const ps=ns.data;for(let ds=0;ds<ps.length;ds++)for(let fs=0;fs<ps[0].length;fs++)ps[ds][fs]=ts(rs,ps[ds][fs]);return SimpleRangeValue.onlyValues(ps)}else rs=SimpleRangeValue.fromScalar(rs);if(!(ns instanceof SimpleRangeValue))if(rs.isAdHoc()){const ps=rs.data;for(let ds=0;ds<ps.length;ds++)for(let fs=0;fs<ps[0].length;fs++)ps[ds][fs]=ts(ps[ds][fs],ns);return SimpleRangeValue.onlyValues(ps)}else ns=SimpleRangeValue.fromScalar(ns);if(rs.width()===ns.width()&&rs.height()===ns.height()){if(rs.isAdHoc()){const ps=rs.data,ds=ns.data;for(let fs=0;fs<ps.length;fs++)for(let hs=0;hs<ps[0].length;hs++)ps[fs][hs]=ts(ps[fs][hs],ds[fs][hs]);return SimpleRangeValue.onlyValues(ps)}if(ns.isAdHoc()){const ps=rs.data,ds=ns.data;for(let fs=0;fs<ps.length;fs++)for(let hs=0;hs<ps[0].length;hs++)ds[fs][hs]=ts(ps[fs][hs],ds[fs][hs]);return SimpleRangeValue.onlyValues(ds)}}const ls=Math.max(rs.width(),ns.width()),us=Math.max(rs.height(),ns.height()),cs=Array(us);for(let ps=0;ps<us;ps++)cs[ps]=Array(ls);for(let ps=0;ps<us;ps++){const ds=rs.height()!==1?ps:0,fs=ns.height()!==1?ps:0;for(let hs=0;hs<ls;hs++){const ys=rs.width()!==1?hs:0,gs=ns.width()!==1?hs:0;ds<rs.height()&&fs<ns.height()&&ys<rs.width()&&gs<ns.width()?cs[ps][hs]=ts(rs.data[ds][ys],ns.data[fs][gs]):cs[ps][hs]=new CellError(ErrorType.NA)}}return SimpleRangeValue.onlyValues(cs)}return ts(rs,ns)}}function unaryErrorWrapper(ss,ts){return ts instanceof CellError?ts:ss(ts)}function binaryErrorWrapper(ss,ts,rs){return ts instanceof CellError?ts:rs instanceof CellError?rs:ss(ts,rs)}function wrapperForRootVertex(ss,ts){return ss instanceof CellError&&ts!==void 0?ss.attachRootVertex(ts):ss}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CombinedTransformer{constructor(ts){this.sheet=ts,this.transformations=[]}add(ts){this.transformations.push(ts)}performEagerTransformations(ts,rs){this.transformations.forEach(ns=>ns.performEagerTransformations(ts,rs))}transformSingleAst(ts,rs){let[ns,is]=[ts,rs];return this.transformations.forEach(as=>{[ns,is]=as.transformSingleAst(ns,is)}),[ns,is]}isIrreversible(){return!0}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class LazilyTransformingAstService{constructor(ts){this.stats=ts,this.transformations=[]}version(){return this.transformations.length}addTransformation(ts){return this.combinedTransformer!==void 0?this.combinedTransformer.add(ts):this.transformations.push(ts),this.version()}beginCombinedMode(ts){this.combinedTransformer=new CombinedTransformer(ts)}commitCombinedMode(){if(this.combinedTransformer===void 0)throw"Combined mode wasn't started";return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(ts,rs,ns){this.stats.start(StatType.TRANSFORM_ASTS_POSTPONED);for(let as=ns;as<this.transformations.length;as++){const os=this.transformations[as];os.isIrreversible()&&(this.undoRedo.storeDataForVersion(as,rs,this.parser.computeHashFromAst(ts)),this.parser.rememberNewAst(ts));const[ls,us]=os.transformSingleAst(ts,rs);ts=ls,rs=us}const is=this.parser.rememberNewAst(ts);return this.stats.end(StatType.TRANSFORM_ASTS_POSTPONED),[is,rs,this.transformations.length]}*getTransformationsFrom(ts,rs){for(let ns=ts;ns<this.transformations.length;ns++){const is=this.transformations[ns];(!rs||rs(is))&&(yield is)}}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function rangeLowerBound(ss,ts,rs,ns){let is;ns==="col"?is=ss.effectiveEndColumn(rs):is=ss.effectiveEndRow(rs);const as=ss.start[ns];let os;ns==="row"?os=us=>getRawValue(rs.getCellValue(simpleCellAddress(ss.sheet,ss.start.col,us))):os=us=>getRawValue(rs.getCellValue(simpleCellAddress(ss.sheet,us,ss.start.row)));const ls=lowerBound$2(os,ts,as,is);return typeof os(ls)!=typeof ts?-1:ls-as}function lowerBound$2(ss,ts,rs,ns){for(;rs<=ns;){const is=Math.floor((rs+ns)/2),as=compare(ts,ss(is));if(as>0)rs=is+1;else if(as<0)ns=is-1;else if(rs!=is)ns=is;else return is}return ns}function compare(ss,ts){return typeof ss==typeof ts?ss===EmptyValue?0:ss<ts?-1:ss>ts?1:0:ss===EmptyValue?-1:ts===EmptyValue?1:ts instanceof CellError||typeof ss=="number"&&typeof ts=="string"||typeof ss=="number"&&typeof ts=="boolean"?-1:typeof ss=="string"&&typeof ts=="number"?1:typeof ss=="string"&&typeof ts=="boolean"?-1:1}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AdvancedFind{constructor(ts){this.dependencyGraph=ts}advancedFind(ts,rs){let ns;const is=rs.range;is===void 0?ns=rs.valuesFromTopLeftCorner():ns=this.dependencyGraph.computeListOfValuesInRange(is);for(let as=0;as<ns.length;as++)if(ts(getRawValue(ns[as])))return as;return-1}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ColumnBinarySearch extends AdvancedFind{constructor(ts,rs){super(ts),this.dependencyGraph=ts,this.config=rs}add(ts,rs){}remove(ts,rs){}change(ts,rs,ns){}applyChanges(ts){}addColumns(ts){}removeColumns(ts){}removeSheet(ts){}moveValues(ts,rs,ns,is){}removeValues(ts){}find(ts,rs,ns){typeof ts=="string"&&(ts=forceNormalizeString(ts));const is=rs.range;return is===void 0?rs.valuesFromTopLeftCorner().map(getRawValue).map(as=>typeof as=="string"?forceNormalizeString(as):as).indexOf(ts):ns?rangeLowerBound(is,ts,this.dependencyGraph,"row"):this.dependencyGraph.computeListOfValuesInRange(is).findIndex(as=>(as=getRawValue(as),as=typeof as=="string"?forceNormalizeString(as):as,as===ts))}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ColumnIndex{constructor(ts,rs,ns){this.dependencyGraph=ts,this.config=rs,this.stats=ns,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new ColumnBinarySearch(ts,rs)}add(ts,rs){if(!(ts===EmptyValue||ts instanceof CellError))if(ts instanceof SimpleRangeValue)for(const[ns,is]of ts.entriesFromTopLeftCorner(rs))this.addSingleCellValue(getRawValue(ns),is);else this.addSingleCellValue(ts,rs)}remove(ts,rs){if(ts!==void 0)if(ts instanceof SimpleRangeValue)for(const[ns,is]of ts.entriesFromTopLeftCorner(rs))this.removeSingleValue(getRawValue(ns),is);else this.removeSingleValue(ts,rs)}change(ts,rs,ns){ts!==rs&&(this.remove(ts,ns),this.add(rs,ns))}applyChanges(ts){for(const rs of ts)rs.oldValue!==void 0&&this.change(getRawValue(rs.oldValue),getRawValue(rs.value),rs.address)}moveValues(ts,rs,ns,is){for(const[as,os]of ts){const ls=movedSimpleCellAddress(os,is,rs,ns);this.remove(as,os),this.add(as,ls)}}removeValues(ts){for(const[rs,ns]of ts)this.remove(rs,ns)}find(ts,rs,ns){const is=rs.range;if(is===void 0)return this.binarySearchStrategy.find(ts,rs,ns);this.ensureRecentData(is.sheet,is.start.col,ts);const as=this.getColumnMap(is.sheet,is.start.col);if(!as)return-1;typeof ts=="string"&&(ts=forceNormalizeString(ts));const os=as.get(ts);if(!os)return this.binarySearchStrategy.find(ts,rs,ns);const ls=upperBound(os.index,is.start.row),us=os.index[ls];return us<=is.end.row?us-is.start.row:this.binarySearchStrategy.find(ts,rs,ns)}advancedFind(ts,rs){return this.binarySearchStrategy.advancedFind(ts,rs)}addColumns(ts){const rs=this.index.get(ts.sheet);rs&&rs.splice(ts.columnStart,0,...Array(ts.numberOfColumns))}removeColumns(ts){const rs=this.index.get(ts.sheet);rs&&rs.splice(ts.columnStart,ts.numberOfColumns)}removeSheet(ts){this.index.delete(ts)}getColumnMap(ts,rs){this.index.has(ts)||this.index.set(ts,[]);const ns=this.index.get(ts);let is=ns[rs];return is||(is=new Map,ns[rs]=is),is}getValueIndex(ts,rs,ns){const is=this.getColumnMap(ts,rs);let as=this.getColumnMap(ts,rs).get(ns);return as||(as={version:this.transformingService.version(),index:[]},is.set(ns,as)),as}ensureRecentData(ts,rs,ns){const is=this.getValueIndex(ts,rs,ns),as=this.transformingService.version();if(is.version===as)return;const os=this.transformingService.getTransformationsFrom(is.version,ls=>ls.sheet===ts&&(ls instanceof AddRowsTransformer||ls instanceof RemoveRowsTransformer));for(const ls of os)ls instanceof AddRowsTransformer?this.addRows(rs,ls.rowsSpan,ns):ls instanceof RemoveRowsTransformer&&this.removeRows(rs,ls.rowsSpan,ns);is.version=as}addSingleCellValue(ts,rs){this.stats.measure(StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(rs.sheet,rs.col,ts),typeof ts=="string"&&(ts=forceNormalizeString(ts));const ns=this.getValueIndex(rs.sheet,rs.col,ts);this.addValue(ns,rs.row)})}removeSingleValue(ts,rs){this.stats.measure(StatType.BUILD_COLUMN_INDEX,()=>{this.ensureRecentData(rs.sheet,rs.col,ts);const ns=this.getColumnMap(rs.sheet,rs.col);typeof ts=="string"&&(ts=forceNormalizeString(ts));const is=ns.get(ts);if(!is)return;const as=upperBound(is.index,rs.row);is.index.splice(as,1),is.index.length===0&&ns.delete(ts),ns.size===0&&delete this.index.get(rs.sheet)[rs.col]})}addRows(ts,rs,ns){const is=this.getValueIndex(rs.sheet,ts,ns);this.shiftRows(is,rs.rowStart,rs.numberOfRows)}removeRows(ts,rs,ns){const is=this.getValueIndex(rs.sheet,ts,ns);this.removeRowsFromValues(is,rs),this.shiftRows(is,rs.rowEnd+1,-rs.numberOfRows)}addValue(ts,rs){const ns=lowerBound$1(ts.index,rs);ts.index[ns]!==rs&&(ns===ts.index.length-1?ts.index.push(rs):ts.index.splice(ns+1,0,rs))}removeRowsFromValues(ts,rs){const ns=upperBound(ts.index,rs.rowStart),is=lowerBound$1(ts.index,rs.rowEnd);ts.index[ns]<=rs.rowEnd&&ts.index.splice(ns,is-ns+1)}shiftRows(ts,rs,ns){const is=upperBound(ts.index,rs);for(let as=is;as<ts.index.length;++as)ts.index[as]+=ns}}function upperBound(ss,ts){let rs=0,ns=ss.length-1;for(;rs<=ns;){const is=Math.floor((rs+ns)/2);if(ts>ss[is])rs=is+1;else if(ts<ss[is])ns=is-1;else return is}return rs}function lowerBound$1(ss,ts){let rs=0,ns=ss.length-1;for(;rs<=ns;){const is=Math.floor((rs+ns)/2);if(ts>ss[is])rs=is+1;else if(ts<ss[is])ns=is-1;else return is}return ns}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function buildColumnSearchStrategy(ss,ts,rs){return ts.useColumnIndex?new ColumnIndex(ss,ts,rs):new ColumnBinarySearch(ss,ts)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class NumberLiteralHelper{constructor(ts){this.config=ts;const rs=this.config.thousandSeparator==="."?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,ns=this.config.decimalSeparator==="."?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${ns}\\d+)|(\\d+(${rs}\\d{3,})*(${ns}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${rs}`,"g")}numericStringToMaybeNumber(ts){if(this.numberPattern.test(ts)){const rs=this.numericStringToNumber(ts);return isNaN(rs)?void 0:rs}}numericStringToNumber(ts){const rs=ts.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(rs)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class Serialization{constructor(ts,rs,ns){this.dependencyGraph=ts,this.unparser=rs,this.exporter=ns}getCellFormula(ts,rs){const ns=this.dependencyGraph.getCell(ts);if(ns instanceof FormulaCellVertex){const is=ns.getFormula(this.dependencyGraph.lazilyTransformingAstService);return rs=rs??ts,this.unparser.unparse(is,rs)}else if(ns instanceof ArrayVertex){const is=ns.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(is.row!==ts.row||is.col!==ts.col||is.sheet!==ts.sheet)return;rs=rs??ts;const as=ns.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(as!==void 0)return this.unparser.unparse(as,rs)}else if(ns instanceof ParsingErrorVertex)return ns.getFormula()}getCellSerialized(ts,rs){var ns;return(ns=this.getCellFormula(ts,rs))!==null&&ns!==void 0?ns:this.getRawValue(ts)}getCellValue(ts){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(ts))}getRawValue(ts){return this.dependencyGraph.getRawValue(ts)}getSheetValues(ts){return this.genericSheetGetter(ts,rs=>this.getCellValue(rs))}getSheetFormulas(ts){return this.genericSheetGetter(ts,rs=>this.getCellFormula(rs))}genericSheetGetter(ts,rs){const ns=this.dependencyGraph.getSheetHeight(ts),is=this.dependencyGraph.getSheetWidth(ts),as=new Array(ns);for(let os=0;os<ns;os++){as[os]=new Array(is);for(let ls=0;ls<is;ls++){const us=simpleCellAddress(ts,ls,os);as[os][ls]=rs(us)}for(let ls=is-1;ls>=0&&(as[os][ls]===null||as[os][ls]===void 0);ls--)as[os].pop()}for(let os=ns-1;os>=0&&as[os].length===0;os--)as.pop();return as}genericAllSheetsGetter(ts){const rs={};for(const ns of this.dependencyGraph.sheetMapping.displayNames()){const is=this.dependencyGraph.sheetMapping.fetch(ns);rs[ns]=ts(is)}return rs}getSheetSerialized(ts){return this.genericSheetGetter(ts,rs=>this.getCellSerialized(rs))}getAllSheetsValues(){return this.genericAllSheetsGetter(ts=>this.getSheetValues(ts))}getAllSheetsFormulas(){return this.genericAllSheetsGetter(ts=>this.getSheetFormulas(ts))}getAllSheetsSerialized(){return this.genericAllSheetsGetter(ts=>this.getSheetSerialized(ts))}getAllNamedExpressionsSerialized(){const ts=[];let rs=0;for(const ns of this.dependencyGraph.sheetMapping.displayNames()){const is=this.dependencyGraph.sheetMapping.fetch(ns);ts[is]=rs,rs++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map(ns=>({name:ns.expression.displayName,expression:this.getCellSerialized(ns.expression.address),scope:ns.scope!==void 0?ts[ns.scope]:void 0,options:ns.expression.options}))}withNewConfig(ts,rs){const ns=new Unparser(ts,buildLexerConfig(ts),this.dependencyGraph.sheetMapping.fetchDisplayName,rs);return new Serialization(this.dependencyGraph,ns,this.exporter)}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class BuildEngineFactory{static buildFromSheets(ts,rs={},ns=[]){const is=new Config(rs);return this.buildEngine(is,ts,ns)}static buildFromSheet(ts,rs={},ns=[]){const is=new Config(rs),as=is.translationPackage.getUITranslation(UIElement.NEW_SHEET_PREFIX)+"1";return this.buildEngine(is,{[as]:ts},ns)}static buildEmpty(ts={},rs=[]){return this.buildEngine(new Config(ts),{},rs)}static rebuildWithConfig(ts,rs,ns,is){return this.buildEngine(ts,rs,ns,is)}static buildEngine(ts,rs={},ns=[],is=ts.useStats?new Statistics:new EmptyStatistics){is.start(StatType.BUILD_ENGINE_TOTAL);const as=new NamedExpressions,os=new FunctionRegistry(ts),ls=new LazilyTransformingAstService(is),us=DependencyGraph.buildEmpty(ls,ts,os,as,is),cs=buildColumnSearchStrategy(us,ts,is),ps=us.sheetMapping,ds=us.addressMapping;for(const Vs in rs)if(Object.prototype.hasOwnProperty.call(rs,Vs)){const Is=rs[Vs];validateAsSheet(Is);const Os=findBoundaries(Is);if(Os.height>ts.maxRows||Os.width>ts.maxColumns)throw new SheetSizeLimitExceededError;const Ps=ps.addSheet(Vs);ds.autoAddSheet(Ps,Is,Os)}const fs=new ParserWithCaching(ts,os,ps.get);ls.parser=fs;const hs=new Unparser(ts,buildLexerConfig(ts),ps.fetchDisplayName,as),ys=new DateTimeHelper(ts),gs=new NumberLiteralHelper(ts),bs=new ArithmeticHelper(ts,ys,gs),vs=new CellContentParser(ts,ys,gs),Ns=new ArraySizePredictor(ts,os),Ts=new Operations(ts,us,cs,vs,fs,is,ls,as,Ns),Cs=new UndoRedo(ts,Ts);ls.undoRedo=Cs;const xs=new ClipboardOperations(ts,us,Ts),As=new CrudOperations(ts,Ts,Cs,xs,us,cs,fs,vs,ls,as);ns.forEach(Vs=>{As.ensureItIsPossibleToAddNamedExpression(Vs.name,Vs.expression,Vs.scope),As.operations.addNamedExpression(Vs.name,Vs.expression,Vs.scope,Vs.options)});const ws=new Exporter(ts,as,ps.fetchDisplayName,ls),Es=new Serialization(us,hs,ws),Ss=new Interpreter(ts,us,cs,is,bs,os,as,Es,Ns,ys);is.measure(StatType.GRAPH_BUILD,()=>{new GraphBuilder(us,cs,fs,vs,is,Ns).buildGraph(rs,is)});const Ds=new Evaluator(ts,is,Ss,ls,us,cs);return Ds.run(),is.end(StatType.BUILD_ENGINE_TOTAL),{config:ts,stats:is,dependencyGraph:us,columnSearch:cs,parser:fs,unparser:hs,cellContentParser:vs,evaluator:Ds,lazilyTransformingAstService:ls,crudOperations:As,exporter:ws,namedExpressions:as,serialization:Es,functionRegistry:os}}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function objectDestroy(ss){for(const[ts,rs]of Object.entries(ss))rs instanceof Function?ss[ts]=postMortem(rs):delete ss[ts]}function postMortem(ss){return()=>{throw new Error(`The "${ss}" method cannot be called because this HyperFormula instance has been destroyed`)}}var tinyEmitterExports={},tinyEmitter={get exports(){return tinyEmitterExports},set exports(ss){tinyEmitterExports=ss}};function E$2(){}E$2.prototype={on:function(ss,ts,rs){var ns=this.e||(this.e={});return(ns[ss]||(ns[ss]=[])).push({fn:ts,ctx:rs}),this},once:function(ss,ts,rs){var ns=this;function is(){ns.off(ss,is),ts.apply(rs,arguments)}return is._=ts,this.on(ss,is,rs)},emit:function(ss){var ts=[].slice.call(arguments,1),rs=((this.e||(this.e={}))[ss]||[]).slice(),ns=0,is=rs.length;for(ns;ns<is;ns++)rs[ns].fn.apply(rs[ns].ctx,ts);return this},off:function(ss,ts){var rs=this.e||(this.e={}),ns=rs[ss],is=[];if(ns&&ts)for(var as=0,os=ns.length;as<os;as++)ns[as].fn!==ts&&ns[as].fn._!==ts&&is.push(ns[as]);return is.length?rs[ss]=is:delete rs[ss],this}},tinyEmitter.exports=E$2;var TinyEmitter=tinyEmitterExports.TinyEmitter=E$2;/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var Events;(function(ss){ss.SheetAdded="sheetAdded",ss.SheetRemoved="sheetRemoved",ss.SheetRenamed="sheetRenamed",ss.NamedExpressionAdded="namedExpressionAdded",ss.NamedExpressionRemoved="namedExpressionRemoved",ss.ValuesUpdated="valuesUpdated",ss.EvaluationSuspended="evaluationSuspended",ss.EvaluationResumed="evaluationResumed"})(Events||(Events={}));class Emitter extends TinyEmitter{emit(ts,...rs){return super.emit(ts,...rs),this}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class HyperFormula{constructor(ts,rs,ns,is,as,os,ls,us,cs,ps,ds,fs,hs,ys){this._config=ts,this._stats=rs,this._dependencyGraph=ns,this._columnSearch=is,this._parser=as,this._unparser=os,this._cellContentParser=ls,this._evaluator=us,this._lazilyTransformingAstService=cs,this._crudOperations=ps,this._exporter=ds,this._namedExpressions=fs,this._serialization=hs,this._functionRegistry=ys,this._emitter=new Emitter,this._evaluationSuspended=!1}static get defaultConfig(){return getDefaultConfig()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(ts,rs={},ns=[]){return this.buildFromEngineState(BuildEngineFactory.buildFromSheet(ts,rs,ns))}static buildFromSheets(ts,rs={},ns=[]){return this.buildFromEngineState(BuildEngineFactory.buildFromSheets(ts,rs,ns))}static buildEmpty(ts={},rs=[]){return this.buildFromEngineState(BuildEngineFactory.buildEmpty(ts,rs))}static getLanguage(ts){validateArgToType(ts,"string","languageCode");const rs=this.registeredLanguages.get(ts);if(rs===void 0)throw new LanguageNotRegisteredError;return rs}static registerLanguage(ts,rs){if(validateArgToType(ts,"string","languageCode"),this.registeredLanguages.has(ts))throw new LanguageAlreadyRegisteredError;this.registeredLanguages.set(ts,buildTranslationPackage(rs))}static unregisterLanguage(ts){if(validateArgToType(ts,"string","languageCode"),this.registeredLanguages.has(ts))this.registeredLanguages.delete(ts);else throw new LanguageNotRegisteredError}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(ts,rs){FunctionRegistry.registerFunctionPlugin(ts,rs)}static unregisterFunctionPlugin(ts){FunctionRegistry.unregisterFunctionPlugin(ts)}static registerFunction(ts,rs,ns){validateArgToType(ts,"string","functionId"),FunctionRegistry.registerFunction(ts,rs,ns)}static unregisterFunction(ts){validateArgToType(ts,"string","functionId"),FunctionRegistry.unregisterFunction(ts)}static unregisterAllFunctions(){FunctionRegistry.unregisterAll()}static getRegisteredFunctionNames(ts){validateArgToType(ts,"string","code");const rs=FunctionRegistry.getRegisteredFunctionIds();return this.getLanguage(ts).getFunctionTranslations(rs)}static getFunctionPlugin(ts){return validateArgToType(ts,"string","functionId"),FunctionRegistry.getFunctionPlugin(ts)}static getAllFunctionPlugins(){return FunctionRegistry.getPlugins()}static buildFromEngineState(ts){return new HyperFormula(ts.config,ts.stats,ts.dependencyGraph,ts.columnSearch,ts.parser,ts.unparser,ts.cellContentParser,ts.evaluator,ts.lazilyTransformingAstService,ts.crudOperations,ts.exporter,ts.namedExpressions,ts.serialization,ts.functionRegistry)}getCellValue(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(ts)}getCellFormula(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(ts)}getCellSerialized(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(ts)}getSheetValues(ts){return validateArgToType(ts,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(ts)}getSheetFormulas(ts){return validateArgToType(ts,"number","sheetId"),this._serialization.getSheetFormulas(ts)}getSheetSerialized(ts){return validateArgToType(ts,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(ts)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter(ts=>this.getSheetDimensions(ts))}getSheetDimensions(ts){return validateArgToType(ts,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(ts),height:this.dependencyGraph.getSheetHeight(ts)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(ts){const rs=this._config.mergeConfig(ts),ns=this._config.mergeConfig({language:ts.language}),is=this._serialization.withNewConfig(ns,this._namedExpressions).getAllSheetsSerialized(),as=this._serialization.getAllNamedExpressionsSerialized(),os=BuildEngineFactory.rebuildWithConfig(rs,is,as,this._stats);this._config=os.config,this._stats=os.stats,this._dependencyGraph=os.dependencyGraph,this._columnSearch=os.columnSearch,this._parser=os.parser,this._unparser=os.unparser,this._cellContentParser=os.cellContentParser,this._evaluator=os.evaluator,this._lazilyTransformingAstService=os.lazilyTransformingAstService,this._crudOperations=os.crudOperations,this._exporter=os.exporter,this._namedExpressions=os.namedExpressions,this._serialization=os.serialization,this._functionRegistry=os.functionRegistry}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.updateConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(ts){let rs;if(isSimpleCellAddress(ts))rs=new AbsoluteCellRange(ts,ts);else if(isSimpleCellRange(ts))rs=new AbsoluteCellRange(ts.start,ts.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange","address");try{this._crudOperations.ensureRangeInSizeLimits(rs);for(const ns of rs.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(ns)}catch{return!1}return!0}setCellContents(ts,rs){return this._crudOperations.setCellContents(ts,rs),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(ts,rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.setRowOrder(ts,rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(ts,rs){validateArgToType(ts,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(ts,rs),this._crudOperations.testRowOrderForArrays(ts,rs),!0}catch{return!1}}setRowOrder(ts,rs){validateArgToType(ts,"number","sheetId");const ns=this._crudOperations.mappingFromOrder(ts,rs,"row");return this.swapRowIndexes(ts,ns)}isItPossibleToSetRowOrder(ts,rs){validateArgToType(ts,"number","sheetId");try{const ns=this._crudOperations.mappingFromOrder(ts,rs,"row");return this._crudOperations.validateSwapRowIndexes(ts,ns),this._crudOperations.testRowOrderForArrays(ts,ns),!0}catch{return!1}}swapColumnIndexes(ts,rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.setColumnOrder(ts,rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(ts,rs){validateArgToType(ts,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(ts,rs),this._crudOperations.testColumnOrderForArrays(ts,rs),!0}catch{return!1}}setColumnOrder(ts,rs){validateArgToType(ts,"number","sheetId");const ns=this._crudOperations.mappingFromOrder(ts,rs,"column");return this.swapColumnIndexes(ts,ns)}isItPossibleToSetColumnOrder(ts,rs){validateArgToType(ts,"number","sheetId");try{const ns=this._crudOperations.mappingFromOrder(ts,rs,"column");return this._crudOperations.validateSwapColumnIndexes(ts,ns),this._crudOperations.testColumnOrderForArrays(ts,ns),!0}catch{return!1}}isItPossibleToAddRows(ts,...rs){validateArgToType(ts,"number","sheetId");const ns=normalizeAddedIndexes(rs);try{return this._crudOperations.ensureItIsPossibleToAddRows(ts,...ns),!0}catch{return!1}}addRows(ts,...rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.addRows(ts,...rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(ts,...rs){validateArgToType(ts,"number","sheetId");const ns=normalizeRemovedIndexes(rs);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(ts,...ns),!0}catch{return!1}}removeRows(ts,...rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.removeRows(ts,...rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(ts,...rs){validateArgToType(ts,"number","sheetId");const ns=normalizeAddedIndexes(rs);try{return this._crudOperations.ensureItIsPossibleToAddColumns(ts,...ns),!0}catch{return!1}}addColumns(ts,...rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.addColumns(ts,...rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(ts,...rs){validateArgToType(ts,"number","sheetId");const ns=normalizeRemovedIndexes(rs);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(ts,...ns),!0}catch{return!1}}removeColumns(ts,...rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.removeColumns(ts,...rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(ts,rs){if(!isSimpleCellAddress(rs))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");try{const ns=new AbsoluteCellRange(ts.start,ts.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(ns.start,ns.width(),ns.height(),rs),!0}catch{return!1}}moveCells(ts,rs){if(!isSimpleCellAddress(rs))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const ns=new AbsoluteCellRange(ts.start,ts.end);return this._crudOperations.moveCells(ns.start,ns.width(),ns.height(),rs),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(ts,rs,ns,is){validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"number","startRow"),validateArgToType(ns,"number","numberOfRows"),validateArgToType(is,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(ts,rs,ns,is),!0}catch{return!1}}moveRows(ts,rs,ns,is){return validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"number","startRow"),validateArgToType(ns,"number","numberOfRows"),validateArgToType(is,"number","targetRow"),this._crudOperations.moveRows(ts,rs,ns,is),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(ts,rs,ns,is){validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"number","startColumn"),validateArgToType(ns,"number","numberOfColumns"),validateArgToType(is,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(ts,rs,ns,is),!0}catch{return!1}}moveColumns(ts,rs,ns,is){return validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"number","startColumn"),validateArgToType(ns,"number","numberOfColumns"),validateArgToType(is,"number","targetColumn"),this._crudOperations.moveColumns(ts,rs,ns,is),this.recomputeIfDependencyGraphNeedsIt()}copy(ts){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const rs=new AbsoluteCellRange(ts.start,ts.end);return this._crudOperations.copy(rs.start,rs.width(),rs.height()),this.getRangeValues(ts)}cut(ts){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");const rs=new AbsoluteCellRange(ts.start,ts.end);return this._crudOperations.cut(rs.start,rs.width(),rs.height()),this.getRangeValues(ts)}paste(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(ts),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(ts){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(ts.start,ts.end).arrayOfAddressesInRange().map(ns=>ns.map(is=>this.getCellValue(is)))}getRangeFormulas(ts){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(ts.start,ts.end).arrayOfAddressesInRange().map(ns=>ns.map(is=>this.getCellFormula(is)))}getRangeSerialized(ts){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(ts.start,ts.end).arrayOfAddressesInRange().map(ns=>ns.map(is=>this.getCellSerialized(is)))}getFillRangeData(ts,rs,ns=!1){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","source");if(!isSimpleCellRange(rs))throw new ExpectedValueOfTypeError("SimpleCellRange","target");const is=new AbsoluteCellRange(ts.start,ts.end),as=new AbsoluteCellRange(rs.start,rs.end);return this.ensureEvaluationIsNotSuspended(),as.arrayOfAddressesInRange().map(os=>os.map(ls=>{const us=((ls.row-(ns?rs:ts).start.row)%is.height()+is.height())%is.height()+ts.start.row,cs=((ls.col-(ns?rs:ts).start.col)%is.width()+is.width())%is.width()+ts.start.col;return this._serialization.getCellSerialized({row:us,col:cs,sheet:is.sheet},ls)}))}isItPossibleToAddSheet(ts){validateArgToType(ts,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(ts),!0}catch{return!1}}addSheet(ts){ts!==void 0&&validateArgToType(ts,"string","sheetName");const rs=this._crudOperations.addSheet(ts);return this._emitter.emit(Events.SheetAdded,rs),rs}isItPossibleToRemoveSheet(ts){validateArgToType(ts,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(ts),!0}catch{return!1}}removeSheet(ts){validateArgToType(ts,"number","sheetId");const rs=this.sheetMapping.getDisplayName(ts);this._crudOperations.removeSheet(ts);const ns=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.SheetRemoved,rs,ns),ns}isItPossibleToClearSheet(ts){validateArgToType(ts,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(ts),!0}catch{return!1}}clearSheet(ts){return validateArgToType(ts,"number","sheetId"),this._crudOperations.clearSheet(ts),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(ts,rs){validateArgToType(ts,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(ts),this._crudOperations.ensureItIsPossibleToChangeSheetContents(ts,rs),!0}catch{return!1}}setSheetContent(ts,rs){return validateArgToType(ts,"number","sheetId"),this._crudOperations.setSheetContent(ts,rs),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(ts,rs){return validateArgToType(ts,"string","cellAddress"),validateArgToType(rs,"number","sheetId"),simpleCellAddressFromString(this.sheetMapping.get,ts,rs)}simpleCellRangeFromString(ts,rs){return validateArgToType(ts,"string","cellRange"),validateArgToType(rs,"number","sheetId"),simpleCellRangeFromString(this.sheetMapping.get,ts,rs)}simpleCellAddressToString(ts,rs){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return validateArgToType(rs,"number","sheetId"),simpleCellAddressToString(this.sheetMapping.fetchDisplayName,ts,rs)}simpleCellRangeToString(ts,rs){if(!isSimpleCellRange(ts))throw new ExpectedValueOfTypeError("SimpleCellRange","cellRange");return validateArgToType(rs,"number","sheetId"),simpleCellRangeToString(this.sheetMapping.fetchDisplayName,ts,rs)}getCellDependents(ts){let rs;if(isSimpleCellAddress(ts))rs=this._dependencyGraph.addressMapping.getCell(ts);else if(isSimpleCellRange(ts))rs=this._dependencyGraph.rangeMapping.getRange(ts.start,ts.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",ts);return rs===void 0?[]:this._dependencyGraph.getAdjacentNodesAddresses(rs)}getCellPrecedents(ts){let rs;if(isSimpleCellAddress(ts))rs=this._dependencyGraph.addressMapping.getCell(ts);else if(isSimpleCellRange(ts))rs=this._dependencyGraph.rangeMapping.getRange(ts.start,ts.end);else throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",ts);return rs===void 0?[]:this._dependencyGraph.dependencyQueryAddresses(rs)}getSheetName(ts){return validateArgToType(ts,"number","sheetId"),this.sheetMapping.getDisplayName(ts)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(ts){return validateArgToType(ts,"string","sheetName"),this.sheetMapping.get(ts)}doesSheetExist(ts){return validateArgToType(ts,"string","sheetName"),this.sheetMapping.hasSheetWithName(ts)}getCellType(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const rs=this.dependencyGraph.getCell(ts);return getCellType(rs,ts)}doesCellHaveSimpleValue(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(ts)===CellType.VALUE}doesCellHaveFormula(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const rs=this.getCellType(ts);return rs===CellType.FORMULA||rs===CellType.ARRAYFORMULA}isCellEmpty(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(ts)===CellType.EMPTY}isCellPartOfArray(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const rs=this.getCellType(ts);return rs===CellType.ARRAY||rs===CellType.ARRAYFORMULA}getCellValueType(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const rs=this.dependencyGraph.getCellValue(ts);return getCellValueType(rs)}getCellValueDetailedType(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const rs=this.dependencyGraph.getCellValue(ts);return getCellValueDetailedType(rs)}getCellValueFormat(ts){if(!isSimpleCellAddress(ts))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const rs=this.dependencyGraph.getCellValue(ts);return getCellValueFormat(rs)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(ts,rs){validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(ts,rs),!0}catch{return!1}}renameSheet(ts,rs){validateArgToType(ts,"number","sheetId"),validateArgToType(rs,"string","newName");const ns=this._crudOperations.renameSheet(ts,rs);ns!==void 0&&this._emitter.emit(Events.SheetRenamed,ns,rs)}batch(ts){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{ts()}catch(rs){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),rs}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(Events.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const ts=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.EvaluationResumed,ts),ts}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(ts,rs,ns){validateArgToType(ts,"string","expressionName"),ns!==void 0&&validateArgToType(ns,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(ts,rs,ns),!0}catch{return!1}}addNamedExpression(ts,rs,ns,is){validateArgToType(ts,"string","expressionName"),ns!==void 0&&validateArgToType(ns,"number","scope"),this._crudOperations.addNamedExpression(ts,rs,ns,is);const as=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionAdded,ts,as),as}getNamedExpressionValue(ts,rs){validateArgToType(ts,"string","expressionName"),rs!==void 0&&validateArgToType(rs,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(rs);const ns=this._namedExpressions.namedExpressionForScope(ts,rs);if(ns)return this._serialization.getCellValue(ns.address)}getNamedExpressionFormula(ts,rs){validateArgToType(ts,"string","expressionName"),rs!==void 0&&validateArgToType(rs,"number","scope"),this._crudOperations.ensureScopeIdIsValid(rs);const ns=this._namedExpressions.namedExpressionForScope(ts,rs);if(ns!==void 0)return this._serialization.getCellFormula(ns.address)}getNamedExpression(ts,rs){validateArgToType(ts,"string","expressionName"),rs!==void 0&&validateArgToType(rs,"number","scope");const ns=this._namedExpressions.namedExpressionForScope(ts,rs);if(ns===void 0)return;const is=this._serialization.getCellFormula(ns.address);return{name:ts,scope:rs,expression:is,options:ns.options}}isItPossibleToChangeNamedExpression(ts,rs,ns){validateArgToType(ts,"string","expressionName"),ns!==void 0&&validateArgToType(ns,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(ts,rs,ns),!0}catch{return!1}}changeNamedExpression(ts,rs,ns,is){return validateArgToType(ts,"string","expressionName"),ns!==void 0&&validateArgToType(ns,"number","scope"),this._crudOperations.changeNamedExpressionExpression(ts,ns,rs,is),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(ts,rs){validateArgToType(ts,"string","expressionName"),rs!==void 0&&validateArgToType(rs,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(ts,rs),!0}catch{return!1}}removeNamedExpression(ts,rs){validateArgToType(ts,"string","expressionName"),rs!==void 0&&validateArgToType(rs,"number","scope");const ns=this._crudOperations.removeNamedExpression(ts,rs);if(ns){const is=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionRemoved,ns.displayName,is),is}else return[]}listNamedExpressions(ts){return ts!==void 0&&validateArgToType(ts,"number","scope"),this._crudOperations.ensureScopeIdIsValid(ts),this._namedExpressions.getAllNamedExpressionsNamesInScope(ts)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(ts){validateArgToType(ts,"string","formulaString");const{ast:rs,address:ns}=this.extractTemporaryFormula(ts);if(rs===void 0)throw new NotAFormulaError;return this._unparser.unparse(rs,ns)}calculateFormula(ts,rs){validateArgToType(ts,"string","formulaString"),validateArgToType(rs,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(rs);const{ast:ns,address:is,dependencies:as}=this.extractTemporaryFormula(ts,rs);if(ns===void 0)throw new NotAFormulaError;const os=this.evaluator.runAndForget(ns,is,as);return this._exporter.exportScalarOrRange(os)}validateFormula(ts){validateArgToType(ts,"string","formulaString");const{ast:rs}=this.extractTemporaryFormula(ts);return!(rs===void 0||rs.type===AstNodeType.ERROR&&!rs.error)}getRegisteredFunctionNames(){return HyperFormula.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(ts){return validateArgToType(ts,"string","functionId"),this._functionRegistry.getFunctionPlugin(ts)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(ts){return validateArgToType(ts,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(ts)}numberToDate(ts){return validateArgToType(ts,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(ts)}numberToTime(ts){return validateArgToType(ts,"number","val"),numberToSimpleTime(ts)}on(ts,rs){this._emitter.on(ts,rs)}once(ts,rs){this._emitter.once(ts,rs)}off(ts,rs){this._emitter.off(ts,rs)}destroy(){objectDestroy(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new EvaluationSuspendedError}extractTemporaryFormula(ts,rs=1){const ns=this._cellContentParser.parse(ts),is={sheet:rs,col:0,row:0};if(!(ns instanceof CellContent.Formula))return{address:is,dependencies:[]};const{ast:as,errors:os,dependencies:ls}=this._parser.parse(ns.formula,is);return os.length>0?{address:is,dependencies:[]}:{ast:as,address:is,dependencies:ls}}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const ts=this._crudOperations.getAndClearContentChanges(),rs=Array.from(this.dependencyGraph.verticesToRecompute());this.dependencyGraph.clearRecentlyChangedVertices(),rs.length>0&&ts.addAll(this.evaluator.partialRun(rs));const ns=ts.exportChanges(this._exporter);return ts.isEmpty()||this._emitter.emit(Events.ValuesUpdated,ns),ns}}}HyperFormula.version="2.1.0",HyperFormula.buildDate="08/09/2022 13:04:38",HyperFormula.releaseDate="08/09/2022",HyperFormula.languages={},HyperFormula.registeredLanguages=new Map;/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const privatePool=new WeakMap;class Config{constructor(ts={},rs=!0){const{accentSensitive:ns,binarySearchThreshold:is,caseSensitive:as,caseFirst:os,chooseAddressMappingPolicy:ls,currencySymbol:us,dateFormats:cs,decimalSeparator:ps,evaluateNullToZero:ds,functionArgSeparator:fs,functionPlugins:hs,ignorePunctuation:ys,leapYear1900:gs,localeLang:bs,language:vs,ignoreWhiteSpace:Ns,licenseKey:Ts,matchWholeCell:Cs,arrayColumnSeparator:xs,arrayRowSeparator:As,maxRows:ws,maxColumns:Es,nullYear:Ss,nullDate:Ds,parseDateTime:Vs,precisionEpsilon:Is,precisionRounding:Os,stringifyDateTime:Ps,stringifyDuration:$s,smartRounding:Rs,timeFormats:ks,thousandSeparator:_s,useArrayArithmetic:Bs,useStats:Us,undoLimit:zs,useColumnIndex:Hs,useRegularExpressions:el,useWildcards:Ys}=ts;rs&&Config.warnDeprecatedOptions(ts),this.useArrayArithmetic=configValueFromParam(Bs,"boolean","useArrayArithmetic"),this.accentSensitive=configValueFromParam(ns,"boolean","accentSensitive"),this.caseSensitive=configValueFromParam(as,"boolean","caseSensitive"),this.caseFirst=configValueFromParam(os,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=configValueFromParam(ys,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=ls??Config.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...configValueFromParamCheck(cs,Array.isArray,"array","dateFormats")],this.timeFormats=[...configValueFromParamCheck(ks,Array.isArray,"array","timeFormats")],this.functionArgSeparator=configValueFromParam(fs,"string","functionArgSeparator"),this.decimalSeparator=configValueFromParam(ps,[".",","],"decimalSeparator"),this.language=configValueFromParam(vs,"string","language"),this.ignoreWhiteSpace=configValueFromParam(Ns,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=configValueFromParam(Ts,"string","licenseKey"),this.thousandSeparator=configValueFromParam(_s,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=configValueFromParam(xs,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=configValueFromParam(As,[";","|"],"arrayRowSeparator"),this.localeLang=configValueFromParam(bs,"string","localeLang"),this.functionPlugins=[...hs??Config.defaultConfig.functionPlugins],this.smartRounding=configValueFromParam(Rs,"boolean","smartRounding"),this.evaluateNullToZero=configValueFromParam(ds,"boolean","evaluateNullToZero"),this.nullYear=configValueFromParam(Ss,"number","nullYear"),validateNumberToBeAtLeast(this.nullYear,"nullYear",0),validateNumberToBeAtMost(this.nullYear,"nullYear",100),this.precisionRounding=configValueFromParam(Os,"number","precisionRounding"),validateNumberToBeAtLeast(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=configValueFromParam(Is,"number","precisionEpsilon"),validateNumberToBeAtLeast(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=configValueFromParam(Hs,"boolean","useColumnIndex"),this.useStats=configValueFromParam(Us,"boolean","useStats"),this.binarySearchThreshold=is??Config.defaultConfig.binarySearchThreshold,this.parseDateTime=configValueFromParam(Vs,"function","parseDateTime"),this.stringifyDateTime=configValueFromParam(Ps,"function","stringifyDateTime"),this.stringifyDuration=configValueFromParam($s,"function","stringifyDuration"),this.translationPackage=HyperFormula.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=configValueFromParamCheck(Ds,instanceOfSimpleDate,"IDate","nullDate"),this.leapYear1900=configValueFromParam(gs,"boolean","leapYear1900"),this.undoLimit=configValueFromParam(zs,"number","undoLimit"),this.useRegularExpressions=configValueFromParam(el,"boolean","useRegularExpressions"),this.useWildcards=configValueFromParam(Ys,"boolean","useWildcards"),this.matchWholeCell=configValueFromParam(Cs,"boolean","matchWholeCell"),validateNumberToBeAtLeast(this.undoLimit,"undoLimit",0),this.maxRows=configValueFromParam(ws,"number","maxRows"),validateNumberToBeAtLeast(this.maxRows,"maxRows",1),this.maxColumns=configValueFromParam(Es,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(us),validateNumberToBeAtLeast(this.maxColumns,"maxColumns",1),privatePool.set(this,{licenseKeyValidityState:checkLicenseKeyValidity(this.licenseKey)}),configCheckIfParametersNotInConflict({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),configCheckIfParametersNotInConflict({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(ts){const rs=[...configValueFromParamCheck(ts,Array.isArray,"array","currencySymbol")];return rs.forEach(ns=>{if(typeof ns!="string")throw new ExpectedValueOfTypeError("string[]","currencySymbol");if(ns==="")throw new ConfigValueEmpty("currencySymbol")}),rs}get licenseKeyValidityState(){return privatePool.get(this).licenseKeyValidityState}getConfig(){return getFullConfigFromPartial(this)}mergeConfig(ts){const rs=Object.assign({},this.getConfig(),ts);return Config.warnDeprecatedOptions(ts),new Config(rs,!1)}static warnDeprecatedOptions(ts){Config.warnDeprecatedIfUsed(ts.binarySearchThreshold,"binarySearchThreshold","1.1")}static warnDeprecatedIfUsed(ts,rs,ns,is){ts!==void 0&&console.warn(is===void 0?`${rs} option is deprecated since ${ns}`:`${rs} option is deprecated since ${ns}, please use ${is}`)}}Config.defaultConfig={accentSensitive:!1,binarySearchThreshold:20,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",chooseAddressMappingPolicy:new AlwaysDense,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:defaultParseToDateTime,precisionEpsilon:1e-13,precisionRounding:14,smartRounding:!0,stringifyDateTime:defaultStringifyDateTime,stringifyDuration:defaultStringifyDuration,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};function getFullConfigFromPartial(ss){var ts;const rs={};for(const ns in Config.defaultConfig){const is=(ts=ss[ns])!==null&&ts!==void 0?ts:Config.defaultConfig[ns];Array.isArray(is)?rs[ns]=[...is]:rs[ns]=is}return rs}function getDefaultConfig(){return getFullConfigFromPartial({})}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const dictionary={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ArrayPlugin extends FunctionPlugin{arrayformula(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ARRAYFORMULA"),ns=>ns)}arrayformulaArraySize(ts,rs){if(ts.args.length!==1)return ArraySize.error();const ns=this.metadata("ARRAYFORMULA");return ts.args.map(as=>{var os;return this.arraySizeForAst(as,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((os=ns==null?void 0:ns.arrayFunction)!==null&&os!==void 0?os:!1)))})[0]}arrayconstrain(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ARRAY_CONSTRAIN"),(ns,is,as)=>{is=Math.min(is,ns.height()),as=Math.min(as,ns.width());const os=ns.data,ls=[];for(let us=0;us<is;us++)ls.push(os[us].slice(0,as));return SimpleRangeValue.onlyValues(ls)})}arrayconstrainArraySize(ts,rs){if(ts.args.length!==3)return ArraySize.error();const ns=this.metadata("ARRAY_CONSTRAIN"),is=ts.args.map(ls=>{var us;return this.arraySizeForAst(ls,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((us=ns==null?void 0:ns.arrayFunction)!==null&&us!==void 0?us:!1)))});let{height:as,width:os}=is[0];return ts.args[1].type===AstNodeType.NUMBER&&(as=Math.min(as,ts.args[1].value)),ts.args[2].type===AstNodeType.NUMBER&&(os=Math.min(os,ts.args[2].value)),as<1||os<1||!Number.isInteger(as)||!Number.isInteger(os)?ArraySize.error():new ArraySize(os,as)}filter(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FILTER"),(ns,...is)=>{for(const ls of is)if(ns.width()!==ls.width()||ns.height()!==ls.height())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);if(ns.width()>1&&ns.height()>1)return new CellError(ErrorType.NA,ErrorMessage.WrongDimension);const as=ns.data,os=[];for(let ls=0;ls<ns.height();ls++){const us=[];for(let cs=0;cs<ns.width();cs++){let ps=!0;for(const ds of is)if(coerceScalarToBoolean(ds.data[ls][cs])!==!0){ps=!1;break}ps&&us.push(as[ls][cs])}us.length>0&&os.push(us)}return os.length>0?SimpleRangeValue.onlyValues(os):new CellError(ErrorType.NA,ErrorMessage.EmptyRange)})}filterArraySize(ts,rs){if(ts.args.length<=1)return ArraySize.error();const ns=this.metadata("FILTER"),is=ts.args.map(ls=>{var us;return this.arraySizeForAst(ls,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((us=ns==null?void 0:ns.arrayFunction)!==null&&us!==void 0?us:!1)))}),as=Math.max(...is.map(ls=>ls.width)),os=Math.max(...is.map(ls=>ls.height));return new ArraySize(as,os)}}ArrayPlugin.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",arraySizeMethod:"arrayformulaArraySize",arrayFunction:!0,parameters:[{argumentType:ArgumentTypes.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",arraySizeMethod:"arrayconstrainArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",arraySizeMethod:"filterArraySize",arrayFunction:!0,parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AbsPlugin extends FunctionPlugin{abs(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ABS"),Math.abs)}}AbsPlugin.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const MAX_48BIT_INTEGER=0xffffffffffff,SHIFT_MIN_POSITIONS=-53,SHIFT_MAX_POSITIONS=53;class BitShiftPlugin extends FunctionPlugin{bitlshift(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BITLSHIFT"),shiftLeft)}bitrshift(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BITRSHIFT"),shiftRight)}}BitShiftPlugin.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]}};function shiftLeft(ss,ts){return ts<0?shiftRight(ss,-ts):validate(ss*Math.pow(2,ts))}function shiftRight(ss,ts){return ts<0?shiftLeft(ss,-ts):validate(Math.floor(ss/Math.pow(2,ts)))}function validate(ss){return ss>MAX_48BIT_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.BitshiftLong):ss}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class BitwiseLogicOperationsPlugin extends FunctionPlugin{bitand(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BITAND"),(ns,is)=>ns&is)}bitor(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BITOR"),(ns,is)=>ns|is)}bitxor(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BITXOR"),(ns,is)=>ns^is)}}BitwiseLogicOperationsPlugin.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class BooleanPlugin extends FunctionPlugin{literalTrue(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TRUE"),()=>!0)}literalFalse(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FALSE"),()=>!1)}conditionalIf(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IF"),(ns,is,as)=>ns?is:as)}and(ts,rs){return this.runFunction(ts.args,rs,this.metadata("AND"),(...ns)=>!ns.some(is=>!is))}or(ts,rs){return this.runFunction(ts.args,rs,this.metadata("OR"),(...ns)=>ns.some(is=>is))}not(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NOT"),ns=>!ns)}xor(ts,rs){return this.runFunction(ts.args,rs,this.metadata("XOR"),(...ns)=>{let is=0;return ns.forEach(as=>{as&&is++}),is%2===1})}switch(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SWITCH"),(ns,...is)=>{const as=is.length;let os=0;for(;os+1<as;os+=2)if(!(is[os]instanceof CellError)&&this.arithmeticHelper.eq(ns,is[os]))return is[os+1];return os<as?is[os]:new CellError(ErrorType.NA,ErrorMessage.NoDefault)})}iferror(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IFERROR"),(ns,is)=>ns instanceof CellError?is:ns)}ifna(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IFNA"),(ns,is)=>ns instanceof CellError&&ns.type===ErrorType.NA?is:ns)}choose(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHOOSE"),(ns,...is)=>ns>is.length?new CellError(ErrorType.NUM,ErrorMessage.Selector):is[ns-1])}}BooleanPlugin.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:ArgumentTypes.BOOLEAN},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,defaultValue:!1,passSubtype:!0}]},AND:{method:"and",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:ArgumentTypes.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CharPlugin extends FunctionPlugin{char(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHAR"),ns=>ns<1||ns>=256?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCharCode(Math.trunc(ns)))}unichar(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHAR"),ns=>ns<1||ns>=1114112?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCodePoint(Math.trunc(ns)))}}CharPlugin.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:ArgumentTypes.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CodePlugin extends FunctionPlugin{code(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CODE"),ns=>ns.length===0?new CellError(ErrorType.VALUE,ErrorMessage.EmptyString):ns.charCodeAt(0))}unicode(ts,rs){return this.runFunction(ts.args,rs,this.metadata("UNICODE"),ns=>{var is;return(is=ns.codePointAt(0))!==null&&is!==void 0?is:new CellError(ErrorType.VALUE,ErrorMessage.EmptyString)})}}CodePlugin.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:ArgumentTypes.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:ArgumentTypes.STRING}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CountBlankPlugin extends FunctionPlugin{countblank(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COUNTBLANK"),(...ns)=>{let is=0;return ns.forEach(as=>{as===EmptyValue&&is++}),is})}}CountBlankPlugin.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class CountUniquePlugin extends FunctionPlugin{countunique(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COUNTUNIQUE"),(...ns)=>{const is=new Set,as=new Set;for(const os of ns)os instanceof CellError?as.add(os.type):os!==""&&is.add(os);return is.size+as.size})}}CountUniquePlugin.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DateTimePlugin extends FunctionPlugin{constructor(){super(...arguments),this.isoweeknumCore=ts=>{const rs=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(ts)),ns=this.dateTimeHelper.numberToSimpleDate(ts),is=this.dateTimeHelper.dateToNumber({year:ns.year,month:1,day:1}),as=this.dateTimeHelper.relativeNumberToAbsoluteNumber(is),os=as+((4-as)%7+7)%7,ls=Math.floor((rs-1)/7)-Math.floor((os-1)/7)+1;return ls===0?this.isoweeknumCore(ts-7)+1:ls},this.days360Core=(ts,rs,ns)=>{const is=this.dateTimeHelper.numberToSimpleDate(ts),as=this.dateTimeHelper.numberToSimpleDate(rs);let os,ls;return ns?(os=toBasisEU(is),ls=toBasisEU(as)):[os,ls]=this.dateTimeHelper.toBasisUS(is,as),360*(ls.year-os.year)+30*(ls.month-os.month)+ls.day-os.day}}date(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DATE"),(ns,is,as)=>{const os=Math.trunc(as);let ls=Math.trunc(is),us=Math.trunc(ns);us<this.dateTimeHelper.getEpochYearZero()&&(us+=this.dateTimeHelper.getEpochYearZero());const cs=Math.floor((ls-1)/12);us+=cs,ls-=cs*12;const ps={year:us,month:ls,day:1};if(this.dateTimeHelper.isValidDate(ps)){let ds=this.dateTimeHelper.dateToNumber(ps)+(os-1);return ds=this.dateTimeHelper.getWithinBounds(ds),ds===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):ds}return new CellError(ErrorType.VALUE,ErrorMessage.InvalidDate)})}time(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TIME"),(ns,is,as)=>{const os=timeToNumber({hours:Math.trunc(ns),minutes:Math.trunc(is),seconds:Math.trunc(as)});return os<0?new CellError(ErrorType.NUM,ErrorMessage.NegativeTime):os%1})}eomonth(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EOMONTH"),(ns,is)=>{const as=this.dateTimeHelper.numberToSimpleDate(ns);let os=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth(offsetMonth(as,is)));return os=this.dateTimeHelper.getWithinBounds(os),os===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):os})}day(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DAY"),ns=>this.dateTimeHelper.numberToSimpleDate(ns).day)}days(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DAYS"),(ns,is)=>Math.trunc(ns)-Math.trunc(is))}month(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MONTH"),ns=>this.dateTimeHelper.numberToSimpleDate(ns).month)}year(ts,rs){return this.runFunction(ts.args,rs,this.metadata("YEAR"),ns=>this.dateTimeHelper.numberToSimpleDate(ns).year)}hour(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HOUR"),ns=>numberToSimpleTime(roundToNearestSecond(ns)%1).hours)}minute(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MINUTE"),ns=>numberToSimpleTime(roundToNearestSecond(ns)%1).minutes)}second(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SECOND"),ns=>numberToSimpleTime(roundToNearestSecond(ns)%1).seconds)}text(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TEXT"),(ns,is)=>format(ns,is,this.config,this.dateTimeHelper))}weekday(ts,rs){return this.runFunction(ts.args,rs,this.metadata("WEEKDAY"),(ns,is)=>{const as=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(ns));if(is===3)return(as-1)%7;const os=weekdayOffsets.get(is);return os===void 0?new CellError(ErrorType.NUM,ErrorMessage.BadMode):(as-os)%7+1})}weeknum(ts,rs){return this.runFunction(ts.args,rs,this.metadata("WEEKNUM"),(ns,is)=>{const as=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(ns)),os=this.dateTimeHelper.numberToSimpleDate(ns),ls=this.dateTimeHelper.dateToNumber({year:os.year,month:1,day:1}),us=this.dateTimeHelper.relativeNumberToAbsoluteNumber(ls);if(is===21)return this.isoweeknumCore(ns);const cs=weekdayOffsets.get(is);return cs===void 0?new CellError(ErrorType.NUM,ErrorMessage.BadMode):Math.floor((as-cs)/7)-Math.floor((us-cs)/7)+1})}isoweeknum(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DATEVALUE"),ns=>{const{dateTime:is}=this.dateTimeHelper.parseDateTimeFromConfigFormats(ns);return is===void 0?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):instanceOfSimpleDate(is)?(instanceOfSimpleTime(is)?Math.trunc(timeToNumber(is)):0)+this.dateTimeHelper.dateToNumber(is):0})}timevalue(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TIMEVALUE"),ns=>{const is=this.dateTimeHelper.dateStringToDateNumber(ns);return is===void 0?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):getRawValue(is)%1})}now(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NOW"),()=>{const ns=new Date(Date.now());return timeToNumber({hours:ns.getHours(),minutes:ns.getMinutes(),seconds:ns.getSeconds()})+this.dateTimeHelper.dateToNumber({year:ns.getFullYear(),month:ns.getMonth()+1,day:ns.getDate()})})}today(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TODAY"),()=>{const ns=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:ns.getFullYear(),month:ns.getMonth()+1,day:ns.getDate()})})}edate(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EDATE"),(ns,is)=>{const as=this.dateTimeHelper.numberToSimpleDate(ns),os=truncateDayInMonth(offsetMonth(as,is));let ls=this.dateTimeHelper.dateToNumber(os);return ls=this.dateTimeHelper.getWithinBounds(ls),ls===void 0?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):ls})}datedif(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DATEDIF"),(ns,is,as)=>{if(ns>is)return new CellError(ErrorType.NUM,ErrorMessage.StartEndDate);if(as==="D")return Math.floor(is)-Math.floor(ns);const os=this.dateTimeHelper.numberToSimpleDate(ns),ls=this.dateTimeHelper.numberToSimpleDate(is);switch(as){case"M":return(ls.year-os.year)*12+(ls.month-os.month)-(ls.day<os.day?1:0);case"YM":return(12+(ls.month-os.month)-(ls.day<os.day?1:0))%12;case"Y":return ls.month>os.month||ls.month===os.month&&ls.day>=os.day?ls.year-os.year:ls.year-os.year-1;case"MD":if(ls.day>=os.day)return ls.day-os.day;{const us=ls.month===1?12:ls.month-1,cs=ls.month===1?ls.year-1:ls.year;return this.dateTimeHelper.daysInMonth(cs,us)+ls.day-os.day}case"YD":return ls.month>os.month||ls.month===os.month&&ls.day>=os.day?Math.floor(is)-this.dateTimeHelper.dateToNumber({year:ls.year,month:os.month,day:os.day}):Math.floor(is)-Math.floor(ns)-365*(ls.year-os.year-1)-this.dateTimeHelper.leapYearsCount(ls.year-1)+this.dateTimeHelper.leapYearsCount(os.year);default:return new CellError(ErrorType.NUM,ErrorMessage.BadMode)}})}days360(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DAYS360"),this.days360Core)}yearfrac(ts,rs){return this.runFunction(ts.args,rs,this.metadata("YEARFRAC"),(ns,is,as)=>{switch(ns=Math.trunc(ns),is=Math.trunc(is),ns>is&&([ns,is]=[is,ns]),as){case 0:return this.days360Core(ns,is,!1)/360;case 1:return(is-ns)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(ns),this.dateTimeHelper.numberToSimpleDate(is));case 2:return(is-ns)/360;case 3:return(is-ns)/365;case 4:return this.days360Core(ns,is,!0)/360}throw new Error("Should not be reachable.")})}interval(ts,rs){return this.runFunction(ts.args,rs,this.metadata("INTERVAL"),ns=>{ns=Math.trunc(ns);const is=ns%60;ns=Math.trunc(ns/60);const as=ns%60;ns=Math.trunc(ns/60);const os=ns%24;ns=Math.trunc(ns/24);const ls=ns%30;ns=Math.trunc(ns/30);const us=ns%12,cs=Math.trunc(ns/12);return"P"+(cs>0?cs+"Y":"")+(us>0?us+"M":"")+(ls>0?ls+"D":"")+"T"+(os>0?os+"H":"")+(as>0?as+"M":"")+(is>0?is+"S":"")})}networkdays(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NETWORKDAYS"),(ns,is,as)=>this.networkdayscore(ns,is,1,as))}networkdaysintl(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NETWORKDAYS.INTL"),(ns,is,as,os)=>this.networkdayscore(ns,is,as,os))}workday(ts,rs){return this.runFunction(ts.args,rs,this.metadata("WORKDAY"),(ns,is,as)=>this.workdaycore(ns,is,1,as))}workdayintl(ts,rs){return this.runFunction(ts.args,rs,this.metadata("WORKDAY.INTL"),(ns,is,as,os)=>this.workdaycore(ns,is,as,os))}networkdayscore(ts,rs,ns,is){ts=Math.trunc(ts),rs=Math.trunc(rs);let as=1;ts>rs&&([ts,rs]=[rs,ts],as=-1);const os=computeWeekendPattern(ns);if(os instanceof CellError)return os;const ls=this.simpleRangeToFilteredHolidays(os,is);return ls instanceof CellError?ls:as*this.countWorkdays(ts,rs,os,ls)}workdaycore(ts,rs,ns,is){ts=Math.trunc(ts),rs=Math.trunc(rs);const as=computeWeekendPattern(ns);if(as instanceof CellError)return as;const os=this.simpleRangeToFilteredHolidays(as,is);if(os instanceof CellError)return os;if(rs>0){let ls=1;for(;this.countWorkdays(ts+1,ts+ls,as,os)<rs;)ls*=2;let us=1;for(;us+1<ls;){const cs=Math.trunc((us+ls)/2);this.countWorkdays(ts+1,ts+cs,as,os)<rs?us=cs:ls=cs}return ts+ls}else if(rs<0){rs*=-1;let ls=1;for(;this.countWorkdays(ts-ls,ts-1,as,os)<rs;)ls*=2;let us=1;for(;us+1<ls;){const cs=Math.trunc((us+ls)/2);this.countWorkdays(ts-cs,ts-1,as,os)<rs?us=cs:ls=cs}return ts-ls}else return ts}countWorkdays(ts,rs,ns,is){const as=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(rs)),os=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(ts));let ls=0;for(let us=0;us<7;us++)ns.charAt(us)==="0"&&(ls+=Math.floor((as+6-us)/7),ls-=Math.floor((os-1+6-us)/7));return ls-=lowerBound(rs+1,is)-lowerBound(ts,is),ls}simpleRangeToFilteredHolidays(ts,rs){var ns;const is=(ns=rs==null?void 0:rs.valuesFromTopLeftCorner())!==null&&ns!==void 0?ns:[];for(const os of is)if(os instanceof CellError)return os;const as=[];for(const os of is)if(os!==EmptyValue)if(isExtendedNumber(os))as.push(Math.trunc(getRawValue(os)));else return new CellError(ErrorType.VALUE,ErrorMessage.WrongType);return[...new Set(as)].sort((os,ls)=>os-ls).filter(os=>{const us=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(os)-1)%7;return ts.charAt(us)==="0"})}}DateTimePlugin.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:ArgumentTypes.STRING}],returnNumberType:NumberType.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:ArgumentTypes.STRING}],returnNumberType:NumberType.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NOERROR,defaultValue:1},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NOERROR,defaultValue:1},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]}};function lowerBound(ss,ts){if(ts.length===0||ss<=ts[0])return 0;if(ts[ts.length-1]<ss)return ts.length;let rs=0,ns=ts.length-1;for(;rs+1<ns;){const is=Math.floor((ns+rs)/2);ts[is]>=ss?ns=is:rs=is}return ns}function computeWeekendPattern(ss){var ts;return typeof ss!="number"&&typeof ss!="string"?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):typeof ss=="string"?ss.length!==7||!/^(0|1)*$/.test(ss)||ss==="1111111"?new CellError(ErrorType.NUM,ErrorMessage.WeekendString):ss:(ts=workdayPatterns.get(ss))!==null&&ts!==void 0?ts:new CellError(ErrorType.NUM,ErrorMessage.BadMode)}const weekdayOffsets=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),workdayPatterns=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DegreesPlugin extends FunctionPlugin{degrees(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DEGREES"),ns=>ns*(180/Math.PI))}}DegreesPlugin.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class DeltaPlugin extends FunctionPlugin{delta(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DELTA"),(ns,is)=>ns===is?1:0)}}DeltaPlugin.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ExpPlugin extends FunctionPlugin{exp(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EXP"),Math.exp)}}ExpPlugin.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class FinancialPlugin extends FunctionPlugin{pmt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PMT"),pmtCore)}ipmt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IPMT"),ipmtCore)}ppmt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PPMT"),ppmtCore)}fv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FV"),fvCore)}cumipmt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CUMIPMT"),(ns,is,as,os,ls,us)=>{if(os>ls)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);let cs=0;for(let ps=os;ps<=ls;ps++)cs+=ipmtCore(ns,ps,is,as,0,us);return cs})}cumprinc(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CUMPRINC"),(ns,is,as,os,ls,us)=>{if(os>ls)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);let cs=0;for(let ps=os;ps<=ls;ps++)cs+=ppmtCore(ns,ps,is,as,0,us);return cs})}db(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DB"),(ns,is,as,os,ls)=>{if(ls===12&&os>as||os>as+1)return new CellError(ErrorType.NUM,ErrorMessage.PeriodLong);if(is>=ns)return 0;const us=Math.round((1-Math.pow(is/ns,1/as))*1e3)/1e3,cs=ns*us*ls/12;if(os===1)return cs;let ps=cs;for(let ds=0;ds<os-2;ds++)ps+=(ns-ps)*us;return os===as+1?(ns-ps)*us*(12-ls)/12:(ns-ps)*us})}ddb(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DDB"),(ns,is,as,os,ls)=>{if(os>as)return new CellError(ErrorType.NUM);let us=ls/as,cs;us>=1?(us=1,os===1?cs=ns:cs=0):cs=ns*Math.pow(1-us,os-1);const ps=ns*Math.pow(1-us,os);return Math.max(cs-Math.max(is,ps),0)})}dollarde(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DOLLARDE"),(ns,is)=>{if(is<1)return new CellError(ErrorType.DIV_BY_ZERO);for(is=Math.trunc(is);is>10;)is/=10;return Math.trunc(ns)+(ns-Math.trunc(ns))*10/is})}dollarfr(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DOLLARFR"),(ns,is)=>{if(is<1)return new CellError(ErrorType.DIV_BY_ZERO);for(is=Math.trunc(is);is>10;)is/=10;return Math.trunc(ns)+(ns-Math.trunc(ns))*is/10})}effect(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EFFECT"),(ns,is)=>(is=Math.trunc(is),Math.pow(1+ns/is,is)-1))}ispmt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISPMT"),(ns,is,as,os)=>as===0?new CellError(ErrorType.DIV_BY_ZERO):os*ns*(is/as-1))}nominal(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NOMINAL"),(ns,is)=>(is=Math.trunc(is),(Math.pow(ns+1,1/is)-1)*is))}nper(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NPER"),(ns,is,as,os,ls)=>ns===0?is===0?new CellError(ErrorType.DIV_BY_ZERO):(-as-os)/is:(ls&&(is*=1+ns),Math.log((is-os*ns)/(as*ns+is))/Math.log(1+ns)))}rate(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RATE"),(ns,is,as,os,ls,us)=>{if(us<=-1)return new CellError(ErrorType.VALUE);const cs=1e-7,ps=50;let ds=us;ls=ls?1:0;for(let fs=0;fs<ps;fs++){if(ds<=-1)return new CellError(ErrorType.NUM);let hs;if(Math.abs(ds)<cs)hs=as*(1+ns*ds)+is*(1+ds*ls)*ns+os;else{const gs=Math.pow(1+ds,ns);hs=as*gs+is*(1/ds+ls)*(gs-1)+os}if(Math.abs(hs)<cs)return ds;let ys;if(Math.abs(ds)<cs)ys=as*ns+is*ls*ns;else{const gs=Math.pow(1+ds,ns),bs=ns*Math.pow(1+ds,ns-1);ys=as*bs+is*(1/ds+ls)*bs+is*(-1/(ds*ds))*(gs-1)}ds-=hs/ys}return new CellError(ErrorType.NUM)})}pv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PV"),(ns,is,as,os,ls)=>(ls=ls?1:0,ns===-1?is===0?new CellError(ErrorType.NUM):new CellError(ErrorType.DIV_BY_ZERO):ns===0?-as*is-os:((1-Math.pow(1+ns,is))*as*(1+ns*ls)/ns-os)/Math.pow(1+ns,is)))}rri(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RRI"),(ns,is,as)=>is===0||as<0&&is>0||as>0&&is<0?new CellError(ErrorType.NUM):Math.pow(as/is,1/ns)-1)}sln(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SLN"),(ns,is,as)=>as===0?new CellError(ErrorType.DIV_BY_ZERO):(ns-is)/as)}syd(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SYD"),(ns,is,as,os)=>os>as?new CellError(ErrorType.NUM):(ns-is)*(as-os+1)*2/(as*(as+1)))}tbilleq(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TBILLEQ"),(ns,is,as)=>{if(ns=Math.round(ns),is=Math.round(is),ns>=is)return new CellError(ErrorType.NUM);const os=this.dateTimeHelper.numberToSimpleDate(ns),ls=this.dateTimeHelper.numberToSimpleDate(is);if(ls.year>os.year+1||ls.year===os.year+1&&(ls.month>os.month||ls.month===os.month&&ls.day>os.day))return new CellError(ErrorType.NUM);const us=360-as*(is-ns);return us===0?0:us<0?new CellError(ErrorType.NUM):365*as/us})}tbillprice(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TBILLPRICE"),(ns,is,as)=>{if(ns=Math.round(ns),is=Math.round(is),ns>=is)return new CellError(ErrorType.NUM);const os=this.dateTimeHelper.numberToSimpleDate(ns),ls=this.dateTimeHelper.numberToSimpleDate(is);if(ls.year>os.year+1||ls.year===os.year+1&&(ls.month>os.month||ls.month===os.month&&ls.day>os.day))return new CellError(ErrorType.NUM);const us=360-as*(is-ns);return us===0?0:us<0?new CellError(ErrorType.NUM):100*(1-as*(is-ns)/360)})}tbillyield(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TBILLYIELD"),(ns,is,as)=>{if(ns=Math.round(ns),is=Math.round(is),ns>=is)return new CellError(ErrorType.NUM);const os=this.dateTimeHelper.numberToSimpleDate(ns),ls=this.dateTimeHelper.numberToSimpleDate(is);return ls.year>os.year+1||ls.year===os.year+1&&(ls.month>os.month||ls.month===os.month&&ls.day>os.day)?new CellError(ErrorType.NUM):(100-as)*360/(as*(is-ns))})}fvschedule(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FVSCHEDULE"),(ns,is)=>{const as=is.valuesFromTopLeftCorner();for(const os of as)if(os instanceof CellError)return os;for(const os of as)if(isExtendedNumber(os))ns*=1+getRawValue(os);else if(os!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);return ns})}npv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NPV"),(ns,...is)=>{const as=this.arithmeticHelper.coerceNumbersExactRanges(is);return as instanceof CellError?as:npvCore(ns,as)})}mirr(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MIRR"),(ns,is,as)=>{const os=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner());if(os instanceof CellError)return os;let ls=!1,us=!1;const cs=[],ps=[];for(const ys of os)ys>0?(ls=!0,cs.push(ys),ps.push(0)):ys<0?(us=!0,ps.push(ys),cs.push(0)):(ps.push(0),cs.push(0));if(!ls||!us)return new CellError(ErrorType.DIV_BY_ZERO);const ds=os.length,fs=npvCore(as,cs);if(fs instanceof CellError)return fs;const hs=npvCore(is,ps);return hs instanceof CellError?hs:Math.pow(-fs*Math.pow(1+as,ds)/hs/(1+is),1/(ds-1))-1})}pduration(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PDURATION"),(ns,is,as)=>(Math.log(as)-Math.log(is))/Math.log(1+ns))}xnpv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("XNPV"),(ns,is,as)=>{const os=is.valuesFromTopLeftCorner();for(const fs of os)if(typeof fs!="number")return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);const ls=os,us=as.valuesFromTopLeftCorner();for(const fs of us)if(typeof fs!="number")return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected);const cs=us;if(cs.length!==ls.length)return new CellError(ErrorType.NUM,ErrorMessage.EqualLength);const ps=cs.length;let ds=0;if(cs[0]<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);for(let fs=0;fs<ps;fs++){if(cs[fs]=Math.floor(cs[fs]),cs[fs]<cs[0])return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);ds+=ls[fs]/Math.pow(1+ns,(cs[fs]-cs[0])/365)}return ds})}}FinancialPlugin.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:NumberType.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:NumberType.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:.1}],returnNumberType:NumberType.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE}],returnNumberType:NumberType.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1,returnNumberType:NumberType.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:-1},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]}};function pmtCore(ss,ts,rs,ns,is){if(ss===0)return(-rs-ns)/ts;{const as=Math.pow(1+ss,ts);return(ns*ss+rs*ss*as)*(is?1/(1+ss):1)/(1-as)}}function ipmtCore(ss,ts,rs,ns,is,as){const os=pmtCore(ss,rs,ns,is,as);return ts===1?ss*(as?0:-ns):ss*(as?fvCore(ss,ts-2,os,ns,as)-os:fvCore(ss,ts-1,os,ns,as))}function fvCore(ss,ts,rs,ns,is){if(ss===0)return-ns-rs*ts;{const as=Math.pow(1+ss,ts);return rs*(is?1+ss:1)*(1-as)/ss-ns*as}}function ppmtCore(ss,ts,rs,ns,is,as){return pmtCore(ss,rs,ns,is,as)-ipmtCore(ss,ts,rs,ns,is,as)}function npvCore(ss,ts){let rs=0;for(let ns=ts.length-1;ns>=0;ns--){if(rs+=ts[ns],ss===-1){if(rs===0)continue;return new CellError(ErrorType.DIV_BY_ZERO)}rs/=1+ss}return rs}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class FormulaTextPlugin extends FunctionPlugin{formulatext(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("FORMULATEXT"),()=>new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber),ns=>{var is;return(is=this.serialization.getCellFormula(ns))!==null&&is!==void 0?is:new CellError(ErrorType.NA,ErrorMessage.Formula)})}}FormulaTextPlugin.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class InformationPlugin extends FunctionPlugin{isbinary(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISBINARY"),ns=>/^[01]{1,10}$/.test(ns))}iserr(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISERR"),ns=>ns instanceof CellError&&ns.type!==ErrorType.NA)}iserror(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISERROR"),ns=>ns instanceof CellError)}isformula(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("ISFORMULA"),()=>new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber),ns=>this.dependencyGraph.addressMapping.getCell(ns)instanceof FormulaVertex)}isblank(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISBLANK"),ns=>ns===EmptyValue)}isna(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISNA"),ns=>ns instanceof CellError&&ns.type==ErrorType.NA)}isnumber(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISNUMBER"),isExtendedNumber)}islogical(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISLOGICAL"),ns=>typeof ns=="boolean")}isref(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISREF"),ns=>ns instanceof CellError&&(ns.type==ErrorType.REF||ns.type==ErrorType.CYCLE))}istext(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISTEXT"),ns=>typeof ns=="string")}isnontext(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISNONTEXT"),ns=>typeof ns!="string")}column(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("COLUMN"),()=>rs.formulaAddress.col+1,ns=>ns.col+1)}columns(ts,rs){if(ts.args.length!==1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(ts.args.some(is=>is.type===AstNodeType.EMPTY))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);let ns=ts.args[0];for(;ns.type===AstNodeType.PARENTHESIS;)ns=ns.expression;if(ns.type===AstNodeType.CELL_RANGE||ns.type===AstNodeType.COLUMN_RANGE)return ns.end.col-ns.start.col+1;if(ns.type===AstNodeType.CELL_REFERENCE)return 1;if(ns.type===AstNodeType.ROW_RANGE)return this.config.maxColumns;{const is=this.evaluateAst(ns,rs);return is instanceof SimpleRangeValue?is.width():is instanceof CellError?is:1}}row(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("ROW"),()=>rs.formulaAddress.row+1,ns=>ns.row+1)}rows(ts,rs){if(ts.args.length!==1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(ts.args.some(is=>is.type===AstNodeType.EMPTY))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);let ns=ts.args[0];for(;ns.type===AstNodeType.PARENTHESIS;)ns=ns.expression;if(ns.type===AstNodeType.CELL_RANGE||ns.type===AstNodeType.ROW_RANGE)return ns.end.row-ns.start.row+1;if(ns.type===AstNodeType.CELL_REFERENCE)return 1;if(ns.type===AstNodeType.COLUMN_RANGE)return this.config.maxRows;{const is=this.evaluateAst(ns,rs);return is instanceof SimpleRangeValue?is.height():is instanceof CellError?is:1}}index(ts,rs){return this.runFunction(ts.args,rs,this.metadata("INDEX"),(ns,is,as)=>{var os,ls,us,cs,ps,ds;return as<1||is<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):as>ns.width()||is>ns.height()?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(ds=(us=(ls=(os=ns==null?void 0:ns.data)===null||os===void 0?void 0:os[is-1])===null||ls===void 0?void 0:ls[as-1])!==null&&us!==void 0?us:(ps=(cs=ns==null?void 0:ns.data)===null||cs===void 0?void 0:cs[0])===null||ps===void 0?void 0:ps[0])!==null&&ds!==void 0?ds:new CellError(ErrorType.VALUE,ErrorMessage.CellRangeExpected)})}na(ts,rs){return new CellError(ErrorType.NA)}sheet(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("SHEET"),()=>rs.formulaAddress.sheet+1,ns=>ns.sheet+1,ns=>{const is=this.dependencyGraph.sheetMapping.get(ns);return is!==void 0?is+1:new CellError(ErrorType.NA,ErrorMessage.SheetRef)})}sheets(ts,rs){return this.runFunctionWithReferenceArgument(ts.args,rs,this.metadata("SHEETS"),()=>this.dependencyGraph.sheetMapping.numberOfSheets(),()=>1,()=>new CellError(ErrorType.VALUE,ErrorMessage.CellRefExpected))}}InformationPlugin.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:ArgumentTypes.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:ArgumentTypes.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:ArgumentTypes.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class IsEvenPlugin extends FunctionPlugin{iseven(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISEVEN"),ns=>ns%2===0)}}IsEvenPlugin.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class IsOddPlugin extends FunctionPlugin{isodd(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ISODD"),ns=>ns%2===1)}}IsOddPlugin.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class LogarithmPlugin extends FunctionPlugin{log10(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LOG10"),Math.log10)}log(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LOG"),(ns,is)=>Math.log(ns)/Math.log(is))}ln(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LN"),Math.log)}}LogarithmPlugin.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:ArgumentTypes.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const PI=parseFloat(Math.PI.toFixed(14));class MathConstantsPlugin extends FunctionPlugin{pi(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PI"),()=>PI)}sqrtpi(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SQRTPI"),ns=>Math.sqrt(PI*ns))}}MathConstantsPlugin.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function arraySizeForMultiplication(ss,ts){return new ArraySize(ts.width,ss.height)}function arraySizeForPoolFunction(ss,ts,rs){return new ArraySize(1+(ss.width-ts)/rs,1+(ss.height-ts)/rs)}class MatrixPlugin extends FunctionPlugin{mmult(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MMULT"),(ns,is)=>{if(!ns.hasOnlyNumbers()||!is.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);if(is.height()!==ns.width())return new CellError(ErrorType.VALUE,ErrorMessage.ArrayDimensions);const as=arraySizeForMultiplication(ns.size,is.size),os=this.createKernel(function(ls,us,cs){let ps=0;for(let ds=0;ds<cs;++ds)ps+=ls[this.thread.y][ds]*us[ds][this.thread.x];return ps},as)(ns.rawNumbers(),is.rawNumbers(),ns.width());return SimpleRangeValue.onlyNumbers(os)})}mmultArraySize(ts,rs){if(ts.args.length!==2)return ArraySize.error();const ns=this.metadata("MMULT"),is=ts.args.map(ls=>{var us;return this.arraySizeForAst(ls,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((us=ns==null?void 0:ns.arrayFunction)!==null&&us!==void 0?us:!1)))}),[as,os]=is;return arraySizeForMultiplication(as,os)}maxpool(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MAXPOOL"),(ns,is,as=is)=>{if(!ns.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);const os=arraySizeForPoolFunction(ns.size,is,as),ls=this.createKernel(function(us,cs,ps){const ds=this.thread.x*ps,fs=this.thread.y*ps;let hs=us[fs][ds];for(let ys=0;ys<cs;ys++)for(let gs=0;gs<cs;gs++)hs=Math.max(hs,us[fs+ys][ds+gs]);return hs},os)(ns.rawNumbers(),is,as);return SimpleRangeValue.onlyNumbers(ls)})}medianpool(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MEDIANPOOL"),(ns,is,as=is)=>{if(!ns.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);const os=arraySizeForPoolFunction(ns.size,is,as),ls=this.createKernel(function(us,cs,ps){const ds=this.thread.x*ps,fs=this.thread.y*ps;let hs=us[fs][ds];for(let Ts=0;Ts<cs;Ts++)for(let Cs=0;Cs<cs;Cs++)hs=Math.max(hs,us[fs+Ts][ds+Cs]);let ys=us[fs][ds];for(let Ts=0;Ts<cs;Ts++)for(let Cs=0;Cs<cs;Cs++)ys=Math.min(ys,us[fs+Ts][ds+Cs]);const gs=cs*cs;let bs=ys,vs=hs,Ns=42;for(let Ts=0;Ts<32;Ts++){const Cs=(bs+vs)/2;let xs=0;for(let As=0;As<cs;As++)for(let ws=0;ws<cs;ws++)us[fs+As][ds+ws]>Cs&&xs++;if(cs%2===0)if(xs===gs/2){Ns=Cs;break}else xs>gs/2?bs=Cs:vs=Cs;else if(xs===(gs-1)/2){Ns=Cs;break}else xs>(gs-1)/2?bs=Cs:vs=Cs}return Ns},os)(ns.rawNumbers(),is,as);return SimpleRangeValue.onlyNumbers(ls)})}maxpoolArraySize(ts,rs){if(ts.args.length<2||ts.args.length>3)return ArraySize.error();const ns=this.metadata("MAXPOOL"),as=ts.args.map(cs=>{var ps;return this.arraySizeForAst(cs,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((ps=ns==null?void 0:ns.arrayFunction)!==null&&ps!==void 0?ps:!1)))})[0],os=ts.args[1];let ls;os.type===AstNodeType.NUMBER?ls=os.value:ls=1;let us=ls;if(ts.args.length===3){const cs=ts.args[2];cs.type===AstNodeType.NUMBER?us=cs.value:us=1}return ls>as.width||ls>as.height||us>ls||(as.width-ls)%us!==0||(as.height-ls)%us!==0?ArraySize.error():arraySizeForPoolFunction(as,ls,us)}medianpoolArraySize(ts,rs){return this.maxpoolArraySize(ts,rs)}transpose(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TRANSPOSE"),ns=>{const is=ns.rawData(),as=ns.size,os=[];for(let ls=0;ls<as.width;++ls){os[ls]=[];for(let us=0;us<as.height;++us)os[ls][us]=is[us][ls]}return SimpleRangeValue.onlyValues(os)})}transposeArraySize(ts,rs){if(ts.args.length!==1)return ArraySize.error();const ns=this.metadata("MMULT"),is=ts.args.map(os=>{var ls;return this.arraySizeForAst(os,new InterpreterState(rs.formulaAddress,rs.arraysFlag||((ls=ns==null?void 0:ns.arrayFunction)!==null&&ls!==void 0?ls:!1)))}),[as]=is;return new ArraySize(as.height,as.width)}createKernel(ts,rs){return function(...ns){const is=[];for(let as=0;as<rs.height;++as){is.push([]);for(let os=0;os<rs.width;++os)is[as][os]=ts.apply({thread:{x:os,y:as}},ns)}return is}}}MatrixPlugin.implementedFunctions={MMULT:{method:"mmult",arraySizeMethod:"mmultArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",arraySizeMethod:"transposeArraySize",parameters:[{argumentType:ArgumentTypes.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",arraySizeMethod:"maxpoolArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",arraySizeMethod:"medianpoolArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class MedianPlugin extends FunctionPlugin{median(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MEDIAN"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);return is instanceof CellError?is:is.length===0?new CellError(ErrorType.NUM,ErrorMessage.OneValue):(is.sort((as,os)=>as-os),is.length%2===0?(is[is.length/2-1]+is[is.length/2])/2:is[Math.floor(is.length/2)])})}large(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LARGE"),(ns,is)=>{const as=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner());return as instanceof CellError?as:(as.sort((os,ls)=>os-ls),is=Math.trunc(is),is>as.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):as[as.length-is])})}small(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SMALL"),(ns,is)=>{const as=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner());return as instanceof CellError?as:(as.sort((os,ls)=>os-ls),is=Math.trunc(is),is>as.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):as[is-1])})}}MedianPlugin.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,minValue:1}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ModuloPlugin extends FunctionPlugin{mod(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MOD"),(ns,is)=>is===0?new CellError(ErrorType.DIV_BY_ZERO):ns%is)}}ModuloPlugin.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function zeroForInfinite$1(ss){return isExtendedNumber(ss)&&!Number.isFinite(getRawValue(ss))?0:ss}class MomentsAggregate{constructor(ts,rs,ns){this.sumsq=ts,this.sum=rs,this.count=ns}static single(ts){return new MomentsAggregate(ts*ts,ts,1)}compose(ts){return new MomentsAggregate(this.sumsq+ts.sumsq,this.sum+ts.sum,this.count+ts.count)}averageValue(){if(this.count>0)return this.sum/this.count}varSValue(){if(this.count>1)return(this.sumsq-this.sum*this.sum/this.count)/(this.count-1)}varPValue(){if(this.count>0)return(this.sumsq-this.sum*this.sum/this.count)/this.count}}MomentsAggregate.empty=new MomentsAggregate(0,0,0);class NumericAggregationPlugin extends FunctionPlugin{constructor(){super(...arguments),this.addWithEpsilonRaw=(ts,rs)=>this.arithmeticHelper.addWithEpsilonRaw(ts,rs)}sum(ts,rs){return this.doSum(ts.args,rs)}sumsq(ts,rs){return this.reduce(ts.args,rs,0,"SUMSQ",this.addWithEpsilonRaw,ns=>Math.pow(getRawValue(ns),2),strictlyNumbers)}max(ts,rs){return this.doMax(ts.args,rs)}maxa(ts,rs){const ns=this.reduce(ts.args,rs,Number.NEGATIVE_INFINITY,"MAXA",(is,as)=>Math.max(is,as),getRawValue,numbersBooleans);return zeroForInfinite$1(ns)}min(ts,rs){return this.doMin(ts.args,rs)}mina(ts,rs){const ns=this.reduce(ts.args,rs,Number.POSITIVE_INFINITY,"MINA",(is,as)=>Math.min(is,as),getRawValue,numbersBooleans);return zeroForInfinite$1(ns)}count(ts,rs){return this.doCount(ts.args,rs)}counta(ts,rs){return this.doCounta(ts.args,rs)}average(ts,rs){return this.doAverage(ts.args,rs)}averagea(ts,rs){var ns;const is=this.reduce(ts.args,rs,MomentsAggregate.empty,"_AGGREGATE_A",(as,os)=>as.compose(os),as=>MomentsAggregate.single(getRawValue(as)),numbersBooleans);return is instanceof CellError?is:(ns=is.averageValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}vars(ts,rs){return this.doVarS(ts.args,rs)}varp(ts,rs){return this.doVarP(ts.args,rs)}vara(ts,rs){var ns;const is=this.reduceAggregateA(ts.args,rs);return is instanceof CellError?is:(ns=is.varSValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}varpa(ts,rs){var ns;const is=this.reduceAggregateA(ts.args,rs);return is instanceof CellError?is:(ns=is.varPValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}stdevs(ts,rs){return this.doStdevS(ts.args,rs)}stdevp(ts,rs){return this.doStdevP(ts.args,rs)}stdeva(ts,rs){const ns=this.reduceAggregateA(ts.args,rs);if(ns instanceof CellError)return ns;{const is=ns.varSValue();return is===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(is)}}stdevpa(ts,rs){const ns=this.reduceAggregateA(ts.args,rs);if(ns instanceof CellError)return ns;{const is=ns.varPValue();return is===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(is)}}product(ts,rs){return this.doProduct(ts.args,rs)}subtotal(ts,rs){if(ts.args.length<2)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);const ns=this.coerceToType(this.evaluateAst(ts.args[0],rs),{argumentType:ArgumentTypes.NUMBER},rs),is=ts.args.slice(1);switch(ns){case 1:case 101:return this.doAverage(is,rs);case 2:case 102:return this.doCount(is,rs);case 3:case 103:return this.doCounta(is,rs);case 4:case 104:return this.doMax(is,rs);case 5:case 105:return this.doMin(is,rs);case 6:case 106:return this.doProduct(is,rs);case 7:case 107:return this.doStdevS(is,rs);case 8:case 108:return this.doStdevP(is,rs);case 9:case 109:return this.doSum(is,rs);case 10:case 110:return this.doVarS(is,rs);case 11:case 111:return this.doVarP(is,rs);default:return new CellError(ErrorType.VALUE,ErrorMessage.BadMode)}}reduceAggregate(ts,rs){return this.reduce(ts,rs,MomentsAggregate.empty,"_AGGREGATE",(ns,is)=>ns.compose(is),ns=>MomentsAggregate.single(getRawValue(ns)),strictlyNumbers)}reduceAggregateA(ts,rs){return this.reduce(ts,rs,MomentsAggregate.empty,"_AGGREGATE_A",(ns,is)=>ns.compose(is),ns=>MomentsAggregate.single(getRawValue(ns)),numbersBooleans)}doAverage(ts,rs){var ns;const is=this.reduceAggregate(ts,rs);return is instanceof CellError?is:(ns=is.averageValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}doVarS(ts,rs){var ns;const is=this.reduceAggregate(ts,rs);return is instanceof CellError?is:(ns=is.varSValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}doVarP(ts,rs){var ns;const is=this.reduceAggregate(ts,rs);return is instanceof CellError?is:(ns=is.varPValue())!==null&&ns!==void 0?ns:new CellError(ErrorType.DIV_BY_ZERO)}doStdevS(ts,rs){const ns=this.reduceAggregate(ts,rs);if(ns instanceof CellError)return ns;{const is=ns.varSValue();return is===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(is)}}doStdevP(ts,rs){const ns=this.reduceAggregate(ts,rs);if(ns instanceof CellError)return ns;{const is=ns.varPValue();return is===void 0?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(is)}}doCount(ts,rs){return this.reduce(ts,rs,0,"COUNT",(ns,is)=>ns+is,getRawValue,ns=>isExtendedNumber(ns)?1:0)}doCounta(ts,rs){return this.reduce(ts,rs,0,"COUNTA",(ns,is)=>ns+is,getRawValue,ns=>ns===EmptyValue?0:1)}doMax(ts,rs){const ns=this.reduce(ts,rs,Number.NEGATIVE_INFINITY,"MAX",(is,as)=>Math.max(is,as),getRawValue,strictlyNumbers);return zeroForInfinite$1(ns)}doMin(ts,rs){const ns=this.reduce(ts,rs,Number.POSITIVE_INFINITY,"MIN",(is,as)=>Math.min(is,as),getRawValue,strictlyNumbers);return zeroForInfinite$1(ns)}doSum(ts,rs){return this.reduce(ts,rs,0,"SUM",this.addWithEpsilonRaw,getRawValue,strictlyNumbers)}doProduct(ts,rs){return this.reduce(ts,rs,1,"PRODUCT",(ns,is)=>ns*is,getRawValue,strictlyNumbers)}reduce(ts,rs,ns,is,as,os,ls){return ts.length<1?new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber):ts.reduce((us,cs)=>{if(us instanceof CellError)return us;if(cs.type===AstNodeType.CELL_RANGE||cs.type===AstNodeType.COLUMN_RANGE||cs.type===AstNodeType.ROW_RANGE){const ds=this.evaluateRange(cs,rs,ns,is,as,os,ls);return ds instanceof CellError?ds:as(ds,us)}let ps;if(ps=this.evaluateAst(cs,rs),ps instanceof SimpleRangeValue)return Array.from(ps.valuesFromTopLeftCorner()).map(ls).filter(fs=>fs!==void 0).map(fs=>fs instanceof CellError?fs:os(fs)).reduce((fs,hs)=>fs instanceof CellError?fs:hs instanceof CellError?hs:as(fs,hs),us);if(cs.type===AstNodeType.CELL_REFERENCE){if(ps=ls(ps),ps===void 0)return us}else if(ps=this.coerceScalarToNumberOrError(ps),ps=ls(ps),ps===void 0)return us;return ps instanceof CellError?ps:as(us,os(ps))},ns)}evaluateRange(ts,rs,ns,is,as,os,ls){let us;try{us=AbsoluteCellRange.fromAst(ts,rs.formulaAddress)}catch(ds){if(ds instanceof SheetsNotEqual)return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);throw ds}const cs=this.dependencyGraph.getRange(us.start,us.end);if(cs===void 0)throw new Error("Range does not exists in graph");let ps=cs.getFunctionValue(is);return ps===void 0&&(ps=this.getRangeValues(is,us,cs,os,ls).reduce((fs,hs)=>fs instanceof CellError?fs:hs instanceof CellError?hs:as(fs,hs),ns),cs.setFunctionValue(is,ps)),ps}getRangeValues(ts,rs,ns,is,as){const os=[],{smallerRangeVertex:ls,restRange:us}=this.dependencyGraph.rangeMapping.findSmallerRange(rs);let cs;if(ls!==void 0&&this.dependencyGraph.existsEdge(ls,ns)){const ps=ls.getFunctionValue(ts);if(ps!==void 0)os.push(ps);else for(const ds of ls.range.addresses(this.dependencyGraph)){const fs=as(this.dependencyGraph.getScalarValue(ds));fs instanceof CellError?os.push(fs):fs!==void 0&&os.push(is(fs))}cs=us}else cs=rs;for(const ps of cs.addresses(this.dependencyGraph)){const ds=as(this.dependencyGraph.getScalarValue(ps));ds instanceof CellError?os.push(ds):ds!==void 0&&os.push(is(ds))}return os}}NumericAggregationPlugin.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1}},NumericAggregationPlugin.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};function strictlyNumbers(ss){if(isExtendedNumber(ss)||ss instanceof CellError)return ss}function numbersBooleans(ss){return typeof ss=="boolean"?coerceBooleanToNumber(ss):isExtendedNumber(ss)||ss instanceof CellError?ss:typeof ss=="string"?0:void 0}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class PowerPlugin extends FunctionPlugin{power(ts,rs){return this.runFunction(ts.args,rs,this.metadata("POWER"),Math.pow)}}PowerPlugin.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RadiansPlugin extends FunctionPlugin{radians(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RADIANS"),ns=>ns*(Math.PI/180))}}RadiansPlugin.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const MAX_LENGTH=10,DECIMAL_NUMBER_OF_BITS=255,MIN_BASE=2,MAX_BASE=36,ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";class RadixConversionPlugin extends FunctionPlugin{dec2bin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DEC2BIN"),(ns,is)=>decimalToBaseWithExactPadding(ns,2,is))}dec2oct(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DEC2OCT"),(ns,is)=>decimalToBaseWithExactPadding(ns,8,is))}dec2hex(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DEC2HEX"),(ns,is)=>decimalToBaseWithExactPadding(ns,16,is))}bin2dec(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BIN2DEC"),ns=>{const is=coerceStringToBase(ns,2,MAX_LENGTH);return is===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):twoComplementToDecimal(is,2)})}bin2oct(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BIN2OCT"),(ns,is)=>{const as=coerceStringToBase(ns,2,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(as,2),8,is)})}bin2hex(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BIN2HEX"),(ns,is)=>{const as=coerceStringToBase(ns,2,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(as,2),16,is)})}oct2dec(ts,rs){return this.runFunction(ts.args,rs,this.metadata("OCT2DEC"),ns=>{const is=coerceStringToBase(ns,8,MAX_LENGTH);return is===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):twoComplementToDecimal(is,8)})}oct2bin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("OCT2BIN"),(ns,is)=>{const as=coerceStringToBase(ns,8,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(as,8),2,is)})}oct2hex(ts,rs){return this.runFunction(ts.args,rs,this.metadata("OCT2HEX"),(ns,is)=>{const as=coerceStringToBase(ns,8,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(as,8),16,is)})}hex2dec(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HEX2DEC"),ns=>{const is=coerceStringToBase(ns,16,MAX_LENGTH);return is===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):twoComplementToDecimal(is,16)})}hex2bin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HEX2BIN"),(ns,is)=>{const as=coerceStringToBase(ns,16,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(as,16),2,is)})}hex2oct(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HEX2OCT"),(ns,is)=>{const as=coerceStringToBase(ns,16,MAX_LENGTH);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(as,16),8,is)})}base(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BASE"),decimalToBaseWithMinimumPadding)}decimal(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DECIMAL"),(ns,is)=>{const as=coerceStringToBase(ns,is,DECIMAL_NUMBER_OF_BITS);return as===void 0?new CellError(ErrorType.NUM,ErrorMessage.NotHex):parseInt(as,is)})}}RadixConversionPlugin.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},DECIMAL:{method:"decimal",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE}]},BASE:{method:"base",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:DECIMAL_NUMBER_OF_BITS}]}};function coerceStringToBase(ss,ts,rs){const ns=ALPHABET.substr(0,ts),is=new RegExp(`^[${ns}]+$`);if(!(ss.length>rs||!is.test(ss)))return ss}function decimalToBaseWithExactPadding(ss,ts,rs){if(ss>maxValFromBase(ts))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLarge);if(ss<minValFromBase(ts))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseSmall);const ns=decimalToRadixComplement(ss,ts);return rs===void 0||ss<0?ns:ns.length>rs?new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLong):padLeft(ns,rs)}function minValFromBase(ss){return-Math.pow(ss,MAX_LENGTH)/2}function maxValFromBase(ss){return-minValFromBase(ss)-1}function decimalToBaseWithMinimumPadding(ss,ts,rs){const ns=decimalToRadixComplement(ss,ts);return rs!==void 0&&rs>ns.length?padLeft(ns,rs):ns}function decimalToRadixComplement(ss,ts){const rs=ss<0?Math.pow(ts,MAX_LENGTH):0;return(ss+rs).toString(ts).toUpperCase()}function twoComplementToDecimal(ss,ts){const rs=parseInt(ss,ts),ns=Math.pow(ts,MAX_LENGTH);return rs>=ns/2?rs-ns:rs}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RandomPlugin extends FunctionPlugin{rand(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RAND"),Math.random)}randbetween(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RANDBETWEEN"),(ns,is)=>is<ns?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(ns=Math.ceil(ns),is=Math.floor(is)+1,ns===is&&(is+=1),ns+Math.floor(Math.random()*(is-ns))))}}RandomPlugin.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],isVolatile:!0}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function findNextOddNumber(ss){const ts=Math.ceil(ss);return ts%2===1?ts:ts+1}function findNextEvenNumber(ss){const ts=Math.ceil(ss);return ts%2===0?ts:ts+1}class RoundingPlugin extends FunctionPlugin{roundup(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ROUNDDOWN"),(ns,is)=>{const as=Math.pow(10,is);return ns<0?-Math.ceil(-ns*as)/as:Math.ceil(ns*as)/as})}rounddown(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ROUNDDOWN"),(ns,is)=>{const as=Math.pow(10,is);return ns<0?-Math.floor(-ns*as)/as:Math.floor(ns*as)/as})}round(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ROUND"),(ns,is)=>{const as=Math.pow(10,is);return ns<0?-Math.round(-ns*as)/as:Math.round(ns*as)/as})}intFunc(ts,rs){return this.runFunction(ts.args,rs,this.metadata("INT"),ns=>ns<0?-Math.floor(-ns):Math.floor(ns))}even(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EVEN"),ns=>ns<0?-findNextEvenNumber(-ns):findNextEvenNumber(ns))}odd(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ODD"),ns=>ns<0?-findNextOddNumber(-ns):findNextOddNumber(ns))}ceilingmath(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CEILING.MATH"),(ns,is,as)=>is===0||ns===0?0:(is=Math.abs(is),as===1&&ns<0&&(is=-is),Math.ceil(ns/is)*is))}ceiling(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CEILING"),(ns,is)=>ns===0?0:is===0?new CellError(ErrorType.DIV_BY_ZERO):ns>0&&is<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.ceil(ns/is)*is)}ceilingprecise(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CEILING.PRECISE"),(ns,is)=>is===0||ns===0?0:(is=Math.abs(is),Math.ceil(ns/is)*is))}floormath(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FLOOR.MATH"),(ns,is,as)=>is===0||ns===0?0:(is=Math.abs(is),as===1&&ns<0&&(is*=-1),Math.floor(ns/is)*is))}floor(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FLOOR"),(ns,is)=>ns===0?0:is===0?new CellError(ErrorType.DIV_BY_ZERO):ns>0&&is<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.floor(ns/is)*is)}floorprecise(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FLOOR.PRECISE"),(ns,is)=>is===0||ns===0?0:(is=Math.abs(is),Math.floor(ns/is)*is))}}RoundingPlugin.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]}},RoundingPlugin.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class SqrtPlugin extends FunctionPlugin{sqrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SQRT"),Math.sqrt)}}SqrtPlugin.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */function*empty(){}function split(ss){const ts=ss[Symbol.iterator](),{done:rs,value:ns}=ts.next();return rs?{rest:empty()}:{value:ns,rest:ts}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */const findSmallerRangeForMany=(ss,ts,rs)=>{if(rs.end.row>rs.start.row){const ns=simpleCellAddress(rs.end.sheet,rs.end.col,rs.end.row-1),is=ss.getRange(rs.start,ns);if(is!==void 0)return{smallerRangeVertex:is,restValuesRange:rs.withStart(simpleCellAddress(rs.start.sheet,rs.start.col,rs.end.row)),restConditionRanges:ts.map(as=>as.withStart(simpleCellAddress(as.start.sheet,as.start.col,as.end.row)))}}return{restValuesRange:rs,restConditionRanges:ts}};class CriterionFunctionCompute{constructor(ts,rs,ns,is,as){this.interpreter=ts,this.cacheKey=rs,this.reduceInitialValue=ns,this.composeFunction=is,this.mapFunction=as,this.dependencyGraph=this.interpreter.dependencyGraph}compute(ts,rs){for(const as of rs)if(!as.conditionRange.sameDimensionsAs(ts))return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength);const ns=this.tryToGetRangeVertexForRangeValue(ts),is=rs.map(as=>this.tryToGetRangeVertexForRangeValue(as.conditionRange));if(ns&&is.every(as=>as!==void 0)){const as=rs.map(us=>us.criterionPackage.raw).join(","),os=this.findAlreadyComputedValueInCache(ns,this.cacheKey(rs),as);if(os!==void 0)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),os;const ls=this.buildNewCriterionCache(this.cacheKey(rs),rs.map(us=>us.conditionRange.range),ts.range);return ls.has(as)||ls.set(as,[this.evaluateRangeValue(ts,rs),rs.map(us=>us.criterionPackage.lambda)]),ns.setCriterionFunctionValues(this.cacheKey(rs),ls),is.forEach(us=>{us!==void 0&&us.addDependentCacheRange(ns)}),ls.get(as)[0]}else return this.evaluateRangeValue(ts,rs)}tryToGetRangeVertexForRangeValue(ts){const rs=ts.range;if(rs!==void 0)return this.dependencyGraph.getRange(rs.start,rs.end)}reduceFunction(ts){let rs=this.reduceInitialValue;for(const ns of ts)rs=this.composeFunction(rs,ns);return rs}findAlreadyComputedValueInCache(ts,rs,ns){return ts.getCriterionFunctionValue(rs,ns)}evaluateRangeValue(ts,rs){const ns=rs.map(ls=>ls.criterionPackage.lambda),is=Array.from(ts.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),as=rs.map(ls=>ls.conditionRange.iterateValuesFromTopLeftCorner()),os=ifFilter(ns,as,is);return this.reduceFunction(os)}buildNewCriterionCache(ts,rs,ns){const is=this.dependencyGraph.getRange(ns.start,ns.end),{smallerRangeVertex:as,restConditionRanges:os,restValuesRange:ls}=findSmallerRangeForMany(this.dependencyGraph,rs,ns);let us;as!==void 0&&this.dependencyGraph.existsEdge(as,is)?us=as.getCriterionFunctionValues(ts):us=new Map;const cs=new Map;return us.forEach(([ps,ds],fs)=>{const hs=ifFilter(ds,os.map(gs=>getRangeValues(this.dependencyGraph,gs)),Array.from(getRangeValues(this.dependencyGraph,ls)).map(this.mapFunction)[Symbol.iterator]()),ys=this.composeFunction(ps,this.reduceFunction(hs));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),cs.set(fs,[ys,ds])}),cs}}class Condition{constructor(ts,rs){this.conditionRange=ts,this.criterionPackage=rs}}function*getRangeValues(ss,ts){for(const rs of ts.addresses(ss))yield getRawValue(ss.getScalarValue(rs))}function*ifFilter(ss,ts,rs){for(const ns of rs){const is=ts.map(os=>split(os));if(!is.every(os=>Object.prototype.hasOwnProperty.call(os,"value")))return;const as=is.map(os=>getRawValue(os.value));zip(as,ss).every(([os,ls])=>ls(os))&&(yield ns),ts=is.map(os=>os.rest)}}function zip(ss,ts){const rs=[];for(let ns=0;ns<Math.min(ss.length,ts.length);ns++)rs.push([ss[ns],ts[ns]]);return rs}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class AverageResult{constructor(ts,rs){this.sum=ts,this.count=rs}static single(ts){return new AverageResult(ts,1)}compose(ts){return new AverageResult(this.sum+ts.sum,this.count+ts.count)}averageValue(){if(this.count>0)return this.sum/this.count}}AverageResult.empty=new AverageResult(0,0);function conditionalAggregationFunctionCacheKey(ss){return ts=>{const rs=ts.map(ns=>`${ns.conditionRange.range.sheet},${ns.conditionRange.range.start.col},${ns.conditionRange.range.start.row}`);return[ss,...rs].join(",")}}function zeroForInfinite(ss){return isExtendedNumber(ss)&&!Number.isFinite(getRawValue(ss))?0:ss}function mapToRawScalarValue(ss){if(ss instanceof CellError)return ss;if(isExtendedNumber(ss))return getRawValue(ss)}class ConditionalAggregationPlugin extends FunctionPlugin{sumif(ts,rs){const ns="SUMIF",is=(as,os,ls)=>this.computeConditionalAggregationFunction(ls??as,[as,os],ns,0,(us,cs)=>this.arithmeticHelper.nonstrictadd(us,cs),mapToRawScalarValue);return this.runFunction(ts.args,rs,this.metadata(ns),is)}sumifs(ts,rs){const ns="SUMIFS",is=(as,...os)=>this.computeConditionalAggregationFunction(as,os,ns,0,(ls,us)=>this.arithmeticHelper.nonstrictadd(ls,us),mapToRawScalarValue);return this.runFunction(ts.args,rs,this.metadata(ns),is)}averageif(ts,rs){const ns="AVERAGEIF",is=(as,os,ls)=>{const us=this.computeConditionalAggregationFunction(ls??as,[as,os],ns,AverageResult.empty,(cs,ps)=>cs.compose(ps),cs=>isExtendedNumber(cs)?AverageResult.single(getRawValue(cs)):AverageResult.empty);return us instanceof CellError?us:us.averageValue()||new CellError(ErrorType.DIV_BY_ZERO)};return this.runFunction(ts.args,rs,this.metadata(ns),is)}countif(ts,rs){const ns="COUNTIF",is=(as,os)=>this.computeConditionalAggregationFunction(as,[as,os],ns,0,(ls,us)=>ls+us,()=>1);return this.runFunction(ts.args,rs,this.metadata(ns),is)}countifs(ts,rs){const ns="COUNTIFS",is=(...as)=>this.computeConditionalAggregationFunction(as[0],as,ns,0,(os,ls)=>os+ls,()=>1);return this.runFunction(ts.args,rs,this.metadata(ns),is)}minifs(ts,rs){const ns="MINIFS",is=(os,ls)=>ls===void 0||os===void 0?ls===void 0?os:ls:Math.min(os,ls),as=(os,...ls)=>{const us=this.computeConditionalAggregationFunction(os,ls,ns,Number.POSITIVE_INFINITY,is,mapToRawScalarValue);return zeroForInfinite(us)};return this.runFunction(ts.args,rs,this.metadata(ns),as)}maxifs(ts,rs){const ns="MAXIFS",is=(os,ls)=>ls===void 0||os===void 0?ls===void 0?os:ls:Math.max(os,ls),as=(os,...ls)=>{const us=this.computeConditionalAggregationFunction(os,ls,ns,Number.NEGATIVE_INFINITY,is,mapToRawScalarValue);return zeroForInfinite(us)};return this.runFunction(ts.args,rs,this.metadata(ns),as)}computeConditionalAggregationFunction(ts,rs,ns,is,as,os){const ls=[];for(let us=0;us<rs.length;us+=2){const cs=rs[us],ps=this.interpreter.criterionBuilder.fromCellValue(rs[us+1],this.arithmeticHelper);if(ps===void 0)return new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion);ls.push(new Condition(cs,ps))}return new CriterionFunctionCompute(this.interpreter,conditionalAggregationFunctionCacheKey(ns),is,as,os).compute(ts,ls)}}ConditionalAggregationPlugin.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class SumprodPlugin extends FunctionPlugin{sumproduct(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SUMPRODUCT"),(...ns)=>{const is=ns[0].width(),as=ns[0].height();for(const us of ns)if(us.width()!==is||us.height()!==as)return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength);let os=0;const ls=ns.map(us=>us.iterateValuesFromTopLeftCorner());for(let us=0;us<is*as;us++){let cs=1;for(const ps of ls){const ds=ps.next().value;if(ds instanceof CellError)return ds;const fs=this.coerceScalarToNumberOrError(ds);isExtendedNumber(fs)?cs*=getRawValue(fs):cs=0}os+=cs}return os})}}SumprodPlugin.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:ArgumentTypes.RANGE}],repeatLastArgs:1}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class TextPlugin extends FunctionPlugin{concatenate(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CONCATENATE"),(...ns)=>"".concat(...ns))}split(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SPLIT"),(ns,is)=>{const as=ns.split(" ");return is>=as.length||is<0?new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds):as[is]})}len(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LEN"),ns=>ns.length)}lower(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LOWER"),ns=>ns.toLowerCase())}trim(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TRIM"),ns=>ns.replace(/^ +| +$/g,"").replace(/ +/g," "))}proper(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PROPER"),ns=>ns.replace(/\p{L}+/gu,is=>is.charAt(0).toUpperCase()+is.substring(1).toLowerCase()))}clean(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CLEAN"),ns=>ns.replace(/[\u0000-\u001F]/g,""))}exact(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EXACT"),(ns,is)=>ns===is)}rept(ts,rs){return this.runFunction(ts.args,rs,this.metadata("REPT"),(ns,is)=>is<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeCount):ns.repeat(is))}right(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RIGHT"),(ns,is)=>is<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):is===0?"":ns.slice(-is))}left(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LEFT"),(ns,is)=>is<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):ns.slice(0,is))}mid(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MID"),(ns,is,as)=>is<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):as<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):ns.substring(is-1,is+as-1))}replace(ts,rs){return this.runFunction(ts.args,rs,this.metadata("REPLACE"),(ns,is,as,os)=>is<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):as<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):ns.substring(0,is-1)+os+ns.substring(is+as-1))}search(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SEARCH"),(ns,is,as)=>{if(as<1||as>is.length)return new CellError(ErrorType.VALUE,ErrorMessage.LengthBounds);const os=is.substring(as-1).toLowerCase();let ls;return this.arithmeticHelper.requiresRegex(ns)?ls=this.arithmeticHelper.searchString(ns,os):ls=os.indexOf(ns.toLowerCase()),ls=ls+as,ls>0?ls:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)})}substitute(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SUBSTITUTE"),(ns,is,as,os)=>{const ls=new RegExp(is,"g");if(os===void 0)return ns.replace(ls,as);if(os<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne);let us,cs=0;for(;(us=ls.exec(ns))!==null;)if(os===++cs)return ns.substring(0,us.index)+as+ns.substring(ls.lastIndex);return ns})}find(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FIND"),(ns,is,as)=>{if(as<1||as>is.length)return new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds);const ls=is.substring(as-1).indexOf(ns)+as;return ls>0?ls:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)})}t(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T"),ns=>ns instanceof CellError||typeof ns=="string"?ns:"")}upper(ts,rs){return this.runFunction(ts.args,rs,this.metadata("UPPER"),ns=>ns.toUpperCase())}}TextPlugin.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:ArgumentTypes.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:ArgumentTypes.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:ArgumentTypes.STRING}]},MID:{method:"mid",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:ArgumentTypes.STRING}]},T:{method:"t",parameters:[{argumentType:ArgumentTypes.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:ArgumentTypes.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:ArgumentTypes.STRING}]},REPT:{method:"rept",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:ArgumentTypes.STRING}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class TrigonometryPlugin extends FunctionPlugin{acos(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ACOS"),Math.acos)}asin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ASIN"),Math.asin)}cos(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COS"),Math.cos)}sin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SIN"),Math.sin)}tan(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TAN"),Math.tan)}atan(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ATAN"),Math.atan)}atan2(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ATAN2"),(ns,is)=>ns===0&&is===0?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(is,ns))}cot(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COT"),ns=>ns===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tan(ns))}acot(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ACOT"),ns=>ns===0?PI/2:Math.atan(1/ns))}sec(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SEC"),ns=>1/Math.cos(ns))}csc(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CSC"),ns=>ns===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sin(ns))}sinh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SINH"),Math.sinh)}asinh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ASINH"),Math.asinh)}cosh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COSH"),Math.cosh)}acosh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ACOSH"),Math.acosh)}tanh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TANH"),Math.tanh)}atanh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ATANH"),Math.atanh)}coth(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COTH"),ns=>ns===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tanh(ns))}acoth(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ACOTH"),ns=>ns===0?new CellError(ErrorType.NUM,ErrorMessage.NonZero):Math.atanh(1/ns))}sech(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SECH"),ns=>1/Math.cosh(ns))}csch(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CSCH"),ns=>ns===0?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sinh(ns))}}TrigonometryPlugin.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:ArgumentTypes.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:ArgumentTypes.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:ArgumentTypes.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RowSearchStrategy extends AdvancedFind{constructor(ts,rs){super(rs),this.config=ts,this.dependencyGraph=rs}find(ts,rs,ns){typeof ts=="string"&&(ts=forceNormalizeString(ts));const is=rs.range;return is===void 0?rs.valuesFromTopLeftCorner().map(getRawValue).indexOf(ts):ns?rangeLowerBound(is,ts,this.dependencyGraph,"col"):this.dependencyGraph.computeListOfValuesInRange(is).findIndex(as=>(as=getRawValue(as),as=typeof as=="string"?forceNormalizeString(as):as,as===ts))}}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class LookupPlugin extends FunctionPlugin{constructor(){super(...arguments),this.rowSearch=new RowSearchStrategy(this.config,this.dependencyGraph)}vlookup(ts,rs){return this.runFunction(ts.args,rs,this.metadata("VLOOKUP"),(ns,is,as,os)=>{const ls=is.range;return ls===void 0?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):as<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):as>ls.width()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):this.doVlookup(zeroIfEmpty(ns),is,as-1,os)})}hlookup(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HLOOKUP"),(ns,is,as,os)=>{const ls=is.range;return ls===void 0?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):as<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):as>ls.height()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):this.doHlookup(zeroIfEmpty(ns),is,as-1,os)})}match(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MATCH"),(ns,is,as)=>this.doMatch(zeroIfEmpty(ns),is,as))}searchInRange(ts,rs,ns,is){return!ns&&typeof ts=="string"&&this.arithmeticHelper.requiresRegex(ts)?is.advancedFind(this.arithmeticHelper.eqMatcherFunction(ts),rs):is.find(ts,rs,ns)}doVlookup(ts,rs,ns,is){this.dependencyGraph.stats.start(StatType.VLOOKUP);const as=rs.range;let os;as===void 0?os=SimpleRangeValue.onlyValues(rs.data.map(cs=>[cs[0]])):os=SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(as.start,1,as.height()),this.dependencyGraph);const ls=this.searchInRange(ts,os,is,this.columnSearch);if(this.dependencyGraph.stats.end(StatType.VLOOKUP),ls===-1)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);let us;if(as===void 0)us=rs.data[ls][ns];else{const cs=simpleCellAddress(as.sheet,as.start.col+ns,as.start.row+ls);us=this.dependencyGraph.getCellValue(cs)}return us instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):us}doHlookup(ts,rs,ns,is){const as=rs.range;let os;as===void 0?os=SimpleRangeValue.onlyValues([rs.data[0]]):os=SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(as.start,as.width(),1),this.dependencyGraph);const ls=this.searchInRange(ts,os,is,this.rowSearch);if(ls===-1)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);let us;if(as===void 0)us=rs.data[ns][ls];else{const cs=simpleCellAddress(as.sheet,as.start.col+ls,as.start.row+ns);us=this.dependencyGraph.getCellValue(cs)}return us instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):us}doMatch(ts,rs,ns){if(rs.width()>1&&rs.height()>1)return new CellError(ErrorType.NA);if(rs.width()===1){const is=this.columnSearch.find(ts,rs,ns!==0);return is===-1?new CellError(ErrorType.NA,ErrorMessage.ValueNotFound):is+1}else{const is=this.rowSearch.find(ts,rs,ns!==0);return is===-1?new CellError(ErrorType.NA,ErrorMessage.ValueNotFound):is+1}}}LookupPlugin.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!0}]},MATCH:{method:"match",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]}};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class RomanPlugin extends FunctionPlugin{roman(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ROMAN"),(ns,is)=>(ns=Math.trunc(ns),is===!1?is=4:is===!0&&(is=0),is=getRawValue(this.coerceScalarToNumberOrError(is)),is instanceof CellError?is:(is=Math.trunc(is),is<0?new CellError(ErrorType.VALUE,ErrorMessage.ValueSmall):is>4?new CellError(ErrorType.VALUE,ErrorMessage.ValueLarge):romanMode(ns,is))))}arabic(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ARABIC"),ns=>{ns=ns.trim().toUpperCase();let is=!1;if(ns.startsWith("-")&&(ns=ns.slice(1),is=!0,ns===""))return new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman);const as={input:ns,acc:0};return eatToken(as,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),eatToken(as,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),eatToken(as,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),eatToken(as,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),eatToken(as,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),eatToken(as,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),eatToken(as,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),eatToken(as,{token:"IX",val:9}),eatToken(as,{token:"V",val:5},{token:"IV",val:4}),eatToken(as,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),as.input!==""?new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman):is?-as.acc:as.acc})}}RomanPlugin.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:1,lessThan:4e3},{argumentType:ArgumentTypes.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:ArgumentTypes.STRING}]}};function eatToken(ss,...ts){for(const rs of ts)if(ss.input.startsWith(rs.token)){ss.input=ss.input.slice(rs.token.length),ss.acc+=rs.val;break}}function romanMode(ss,ts){const rs={val:ss%1e3,acc:"M".repeat(Math.floor(ss/1e3))};return ts===4&&(absorb(rs,"IM",999,1e3),absorb(rs,"ID",499,500)),ts>=3&&(absorb(rs,"VM",995,1e3),absorb(rs,"VD",495,500)),ts>=2&&(absorb(rs,"XM",990,1e3),absorb(rs,"XD",490,500)),ts>=1&&(absorb(rs,"LM",950,1e3),absorb(rs,"LD",450,500)),absorb(rs,"CM",900,1e3),absorb(rs,"CD",400,500),absorb(rs,"D",500,900),rs.acc+="C".repeat(Math.floor(rs.val/100)),rs.val%=100,ts>=2&&(absorb(rs,"IC",99,100),absorb(rs,"IL",49,50)),ts>=1&&(absorb(rs,"VC",95,100),absorb(rs,"VL",45,50)),absorb(rs,"XC",90,100),absorb(rs,"XL",40,50),absorb(rs,"L",50,90),rs.acc+="X".repeat(Math.floor(rs.val/10)),rs.val%=10,absorb(rs,"IX",9,10),absorb(rs,"IV",4,5),absorb(rs,"V",5,9),rs.acc+="I".repeat(rs.val),rs.acc}function absorb(ss,ts,rs,ns){ss.val>=rs&&ss.val<ns&&(ss.val-=rs,ss.acc+=ts)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class SimpleArithmerticPlugin extends FunctionPlugin{add(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}SimpleArithmerticPlugin.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:ArgumentTypes.STRING,passSubtype:!0},{argumentType:ArgumentTypes.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]}};/**
   * @license
   bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

   Apache License
   Version 2.0, January 2004
   http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

   "License" shall mean the terms and conditions for use, reproduction,
   and distribution as defined by Sections 1 through 9 of this document.

   "Licensor" shall mean the copyright owner or entity authorized by
   the copyright owner that is granting the License.

   "Legal Entity" shall mean the union of the acting entity and all
   other entities that control, are controlled by, or are under common
   control with that entity. For the purposes of this definition,
   "control" means (i) the power, direct or indirect, to cause the
   direction or management of such entity, whether by contract or
   otherwise, or (ii) ownership of fifty percent (50%) or more of the
   outstanding shares, or (iii) beneficial ownership of such entity.

   "You" (or "Your") shall mean an individual or Legal Entity
   exercising permissions granted by this License.

   "Source" form shall mean the preferred form for making modifications,
   including but not limited to software source code, documentation
   source, and configuration files.

   "Object" form shall mean any form resulting from mechanical
   transformation or translation of a Source form, including but
   not limited to compiled object code, generated documentation,
   and conversions to other media types.

   "Work" shall mean the work of authorship, whether in Source or
   Object form, made available under the License, as indicated by a
   copyright notice that is included in or attached to the work
   (an example is provided in the Appendix below).

   "Derivative Works" shall mean any work, whether in Source or Object
   form, that is based on (or derived from) the Work and for which the
   editorial revisions, annotations, elaborations, or other modifications
   represent, as a whole, an original work of authorship. For the purposes
   of this License, Derivative Works shall not include works that remain
   separable from, or merely link (or bind by name) to the interfaces of,
   the Work and Derivative Works thereof.

   "Contribution" shall mean any work of authorship, including
   the original version of the Work and any modifications or additions
   to that Work or Derivative Works thereof, that is intentionally
   submitted to Licensor for inclusion in the Work by the copyright owner
   or by an individual or Legal Entity authorized to submit on behalf of
   the copyright owner. For the purposes of this definition, "submitted"
   means any form of electronic, verbal, or written communication sent
   to the Licensor or its representatives, including but not limited to
   communication on electronic mailing lists, source code control systems,
   and issue tracking systems that are managed by, or on behalf of, the
   Licensor for the purpose of discussing and improving the Work, but
   excluding communication that is conspicuously marked or otherwise
   designated in writing by the copyright owner as "Not a Contribution."

   "Contributor" shall mean Licensor and any individual or Legal Entity
   on behalf of whom a Contribution has been received by Licensor and
   subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
   this License, each Contributor hereby grants to You a perpetual,
   worldwide, non-exclusive, no-charge, royalty-free, irrevocable
   copyright license to reproduce, prepare Derivative Works of,
   publicly display, publicly perform, sublicense, and distribute the
   Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
   this License, each Contributor hereby grants to You a perpetual,
   worldwide, non-exclusive, no-charge, royalty-free, irrevocable
   (except as stated in this section) patent license to make, have made,
   use, offer to sell, sell, import, and otherwise transfer the Work,
   where such license applies only to those patent claims licensable
   by such Contributor that are necessarily infringed by their
   Contribution(s) alone or by combination of their Contribution(s)
   with the Work to which such Contribution(s) was submitted. If You
   institute patent litigation against any entity (including a
   cross-claim or counterclaim in a lawsuit) alleging that the Work
   or a Contribution incorporated within the Work constitutes direct
   or contributory patent infringement, then any patent licenses
   granted to You under this License for that Work shall terminate
   as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
   Work or Derivative Works thereof in any medium, with or without
   modifications, and in Source or Object form, provided that You
   meet the following conditions:

   (a) You must give any other recipients of the Work or
   Derivative Works a copy of this License; and

   (b) You must cause any modified files to carry prominent notices
   stating that You changed the files; and

   (c) You must retain, in the Source form of any Derivative Works
   that You distribute, all copyright, patent, trademark, and
   attribution notices from the Source form of the Work,
   excluding those notices that do not pertain to any part of
   the Derivative Works; and

   (d) If the Work includes a "NOTICE" text file as part of its
   distribution, then any Derivative Works that You distribute must
   include a readable copy of the attribution notices contained
   within such NOTICE file, excluding those notices that do not
   pertain to any part of the Derivative Works, in at least one
   of the following places: within a NOTICE text file distributed
   as part of the Derivative Works; within the Source form or
   documentation, if provided along with the Derivative Works; or,
   within a display generated by the Derivative Works, if and
   wherever such third-party notices normally appear. The contents
   of the NOTICE file are for informational purposes only and
   do not modify the License. You may add Your own attribution
   notices within Derivative Works that You distribute, alongside
   or as an addendum to the NOTICE text from the Work, provided
   that such additional attribution notices cannot be construed
   as modifying the License.

   You may add Your own copyright statement to Your modifications and
   may provide additional or different license terms and conditions
   for use, reproduction, or distribution of Your modifications, or
   for any such Derivative Works as a whole, provided Your use,
   reproduction, and distribution of the Work otherwise complies with
   the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
   names, trademarks, service marks, or product names of the Licensor,
   except as required for reasonable and customary use in describing the
   origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
   agreed to in writing, Licensor provides the Work (and each
   Contributor provides its Contributions) on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
   implied, including, without limitation, any warranties or conditions
   of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
   PARTICULAR PURPOSE. You are solely responsible for determining the
   appropriateness of using or redistributing the Work and assume any
   risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
   whether in tort (including negligence), contract, or otherwise,
   unless required by applicable law (such as deliberate and grossly
   negligent acts) or agreed to in writing, shall any Contributor be
   liable to You for damages, including any direct, indirect, special,
   incidental, or consequential damages of any character arising as a
   result of this License or out of the use or inability to use the
   Work (including but not limited to damages for loss of goodwill,
   work stoppage, computer failure or malfunction, or any and all
   other commercial damages or losses), even if such Contributor
   has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
   the Work or Derivative Works thereof, You may choose to offer,
   and charge a fee for, acceptance of support, warranty, indemnity,
   or other liability obligations and/or rights consistent with this
   License. However, in accepting such obligations, You may act only
   on Your own behalf and on Your sole responsibility, not on behalf
   of any other Contributor, and only if You agree to indemnify,
   defend, and hold each Contributor harmless for any liability
   incurred by, or claims asserted against, such Contributor by reason
   of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

   To apply the Apache License to your work, attach the following
   boilerplate notice, with the fields enclosed by brackets "{}"
   replaced with your own identifying information. (Don't include
   the brackets!)  The text should be enclosed in the appropriate
   comment syntax for the file format. We also recommend that a
   file or class name and description of purpose be included on the
   same "printed page" as the copyright notice for easier
   identification within third-party archives.

   Copyright (C) 2013-present   SheetJS LLC

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   */var M$2=Math;function _horner(ss,ts){for(var rs=0,ns=0;rs<ss.length;++rs)ns=ts*ns+ss[rs];return ns}function _bessel_iter(ss,ts,rs,ns,is){if(ts===0)return rs;if(ts===1)return ns;for(var as=2/ss,os=ns,ls=1;ls<ts;++ls)os=ns*ls*as+is*rs,rs=ns,ns=os;return os}function _bessel_wrap(ss,ts,rs,ns,is){return function(os,ls){if(ns){if(os===0)return ns==1?-1/0:1/0;if(os<0)return NaN}if(ls===0)return ss(os);if(ls===1)return ts(os);if(ls<0)return NaN;ls|=0;var us=ss(os),cs=ts(os);return _bessel_iter(os,ls,us,cs,is)}}var besselj=function(){var ss=.636619772,ts=[57568490574,-13362590354,6516196407e-1,-1121442418e-2,77392.33017,-184.9052456].reverse(),rs=[57568490411,1029532985,9494680718e-3,59272.64853,267.8532712,1].reverse(),ns=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),is=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934935152e-16].reverse();function as(ds){var fs=0,hs=0,ys=0,gs=ds*ds;if(ds<8)hs=_horner(ts,gs),ys=_horner(rs,gs),fs=hs/ys;else{var bs=ds-.785398164;gs=64/gs,hs=_horner(ns,gs),ys=_horner(is,gs),fs=M$2.sqrt(ss/ds)*(M$2.cos(bs)*hs-M$2.sin(bs)*ys*8/ds)}return fs}var os=[72362614232,-7895059235,2423968531e-1,-2972611439e-3,15704.4826,-30.16036606].reverse(),ls=[144725228442,2300535178,1858330474e-2,99447.43394,376.9991397,1].reverse(),us=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),cs=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function ps(ds){var fs=0,hs=0,ys=0,gs=ds*ds,bs=M$2.abs(ds)-2.356194491;return Math.abs(ds)<8?(hs=ds*_horner(os,gs),ys=_horner(ls,gs),fs=hs/ys):(gs=64/gs,hs=_horner(us,gs),ys=_horner(cs,gs),fs=M$2.sqrt(ss/M$2.abs(ds))*(M$2.cos(bs)*hs-M$2.sin(bs)*ys*8/M$2.abs(ds)),ds<0&&(fs=-fs)),fs}return function ds(fs,hs){if(hs=Math.round(hs),!isFinite(fs))return isNaN(fs)?fs:0;if(hs<0)return(hs%2?-1:1)*ds(fs,-hs);if(fs<0)return(hs%2?-1:1)*ds(-fs,hs);if(hs===0)return as(fs);if(hs===1)return ps(fs);if(fs===0)return 0;var ys=0;if(fs>hs)ys=_bessel_iter(fs,hs,as(fs),ps(fs),-1);else{for(var gs=2*M$2.floor((hs+M$2.floor(M$2.sqrt(40*hs)))/2),bs=!1,vs=0,Ns=0,Ts=1,Cs=0,xs=2/fs,As=gs;As>0;As--)Cs=As*xs*Ts-vs,vs=Ts,Ts=Cs,M$2.abs(Ts)>1e10&&(Ts*=1e-10,vs*=1e-10,ys*=1e-10,Ns*=1e-10),bs&&(Ns+=Ts),bs=!bs,As==hs&&(ys=vs);Ns=2*Ns-Ts,ys/=Ns}return ys}}(),bessely=function(){var ss=.636619772,ts=[-2957821389,7062834065,-5123598036e-1,1087988129e-2,-86327.92757,228.4622733].reverse(),rs=[40076544269,7452499648e-1,7189466438e-3,47447.2647,226.1030244,1].reverse(),ns=[1,-.001098628627,2734510407e-14,-2073370639e-15,2093887211e-16].reverse(),is=[-.01562499995,.0001430488765,-6911147651e-15,7621095161e-16,-934945152e-16].reverse();function as(ds){var fs=0,hs=0,ys=0,gs=ds*ds,bs=ds-.785398164;return ds<8?(hs=_horner(ts,gs),ys=_horner(rs,gs),fs=hs/ys+ss*besselj(ds,0)*M$2.log(ds)):(gs=64/gs,hs=_horner(ns,gs),ys=_horner(is,gs),fs=M$2.sqrt(ss/ds)*(M$2.sin(bs)*hs+M$2.cos(bs)*ys*8/ds)),fs}var os=[-4900604943e3,127527439e4,-51534381390,7349264551e-1,-4237922726e-3,8511.937935].reverse(),ls=[249958057e5,424441966400,3733650367,2245904002e-2,102042.605,354.9632885,1].reverse(),us=[1,.00183105,-3516396496e-14,2457520174e-15,-240337019e-15].reverse(),cs=[.04687499995,-.0002002690873,8449199096e-15,-88228987e-14,105787412e-15].reverse();function ps(ds){var fs=0,hs=0,ys=0,gs=ds*ds,bs=ds-2.356194491;return ds<8?(hs=ds*_horner(os,gs),ys=_horner(ls,gs),fs=hs/ys+ss*(besselj(ds,1)*M$2.log(ds)-1/ds)):(gs=64/gs,hs=_horner(us,gs),ys=_horner(cs,gs),fs=M$2.sqrt(ss/ds)*(M$2.sin(bs)*hs+M$2.cos(bs)*ys*8/ds)),fs}return _bessel_wrap(as,ps,"BESSELY",1,-1)}(),besseli=function(){var ss=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),ts=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function rs(os){return os<=3.75?_horner(ss,os*os/(3.75*3.75)):M$2.exp(M$2.abs(os))/M$2.sqrt(M$2.abs(os))*_horner(ts,3.75/M$2.abs(os))}var ns=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),is=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function as(os){return os<3.75?os*_horner(ns,os*os/(3.75*3.75)):(os<0?-1:1)*M$2.exp(M$2.abs(os))/M$2.sqrt(M$2.abs(os))*_horner(is,3.75/M$2.abs(os))}return function os(ls,us){if(us=Math.round(us),us===0)return rs(ls);if(us===1)return as(ls);if(us<0)return NaN;if(M$2.abs(ls)===0)return 0;if(ls==1/0)return 1/0;var cs=0,ps,ds=2/M$2.abs(ls),fs=0,hs=1,ys=0,gs=2*M$2.round((us+M$2.round(M$2.sqrt(40*us)))/2);for(ps=gs;ps>0;ps--)ys=ps*ds*hs+fs,fs=hs,hs=ys,M$2.abs(hs)>1e10&&(hs*=1e-10,fs*=1e-10,cs*=1e-10),ps==us&&(cs=fs);return cs*=os(ls,0)/hs,ls<0&&us%2?-cs:cs}}(),besselk=function(){var ss=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),ts=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();function rs(os){return os<=2?-M$2.log(os/2)*besseli(os,0)+_horner(ss,os*os/4):M$2.exp(-os)/M$2.sqrt(os)*_horner(ts,2/os)}var ns=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),is=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();function as(os){return os<=2?M$2.log(os/2)*besseli(os,1)+1/os*_horner(ns,os*os/4):M$2.exp(-os)/M$2.sqrt(os)*_horner(is,2/os)}return _bessel_wrap(rs,as,"BESSELK",2,1)}();/**
   * @license
   Copyright (c) 2013 jStat

   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated documentation files (the "Software"), to deal
   in the Software without restriction, including without limitation the rights
   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the Software is
   furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included in
   all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
   */function erf(ss){const ts=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let rs=ts.length-1,ns=!1,is=0,as=0,os,ls,us,cs;if(ss===0)return 0;for(ss<0&&(ss=-ss,ns=!0),os=2/(2+ss),ls=4*os-2;rs>0;rs--)us=is,is=ls*is-as+ts[rs],as=us;return cs=os*Math.exp(-ss*ss+.5*(ts[0]+ls*is)-as),ns?cs-1:1-cs}function erfc(ss){return 1-erf(ss)}function erfcinv(ss){let ts=0,rs,ns,is,as;if(ss>=2)return-100;if(ss<=0)return 100;for(as=ss<1?ss:2-ss,is=Math.sqrt(-2*Math.log(as/2)),rs=-.70711*((2.30753+is*.27061)/(1+is*(.99229+is*.04481))-is);ts<2;ts++)ns=erfc(rs)-as,rs+=ns/(1.1283791670955126*Math.exp(-rs*rs)-rs*ns);return ss<1?rs:-rs}const exponential={pdf:(ss,ts)=>ss<0?0:ts*Math.exp(-ts*ss),cdf:(ss,ts)=>ss<0?0:1-Math.exp(-ts*ss)};function gammafn(ss){const ts=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],rs=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let ns=!1,is=0,as=0,os=0,ls=ss,us,cs,ps,ds;if(ss>171.6243769536076)return 1/0;if(ls<=0)if(ds=ls%1,ds)ns=(ls&1?-1:1)*Math.PI/Math.sin(Math.PI*ds),ls=1-ls;else return 1/0;for(ps=ls,ls<1?cs=ls++:cs=(ls-=is=(ls|0)-1)-1,us=0;us<8;++us)os=(os+ts[us])*cs,as=as*cs+rs[us];if(ds=os/as+1,ps<ls)ds/=ps;else if(ps>ls)for(us=0;us<is;++us)ds*=ls,ls++;return ns&&(ds=ns/ds),ds}const gamma={pdf:function ss(ts,rs,ns){return ts<0?0:ts===0&&rs===1?1/ns:Math.exp((rs-1)*Math.log(ts)-ts/ns-gammaln(rs)-rs*Math.log(ns))},cdf:function ss(ts,rs,ns){return ts<0?0:lowRegGamma(rs,ts/ns)},inv:function(ss,ts,rs){return gammapinv(ss,ts)*rs}};function gammaln(ss){let ts=0;const rs=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let ns=1.000000000190015,is,as,os;for(os=(as=is=ss)+5.5,os-=(is+.5)*Math.log(os);ts<6;ts++)ns+=rs[ts]/++as;return Math.log(2.5066282746310007*ns/is)-os}function lowRegGamma(ss,ts){const rs=gammaln(ss);let ns=ss,is=1/ss,as=is,os=ts+1-ss,ls=1/1e-30,us=1/os,cs=us,ps=1;const ds=-~(Math.log(ss>=1?ss:1/ss)*8.5+ss*.4+17);let fs;if(ts<0||ss<=0)return NaN;if(ts<ss+1){for(;ps<=ds;ps++)is+=as*=ts/++ns;return is*Math.exp(-ts+ss*Math.log(ts)-rs)}for(;ps<=ds;ps++)fs=-ps*(ps-ss),os+=2,us=fs*us+os,ls=os+fs/ls,us=1/us,cs*=us*ls;return 1-cs*Math.exp(-ts+ss*Math.log(ts)-rs)}function gammapinv(ss,ts){let rs=0;const ns=ts-1,is=1e-8,as=gammaln(ts);let os,ls,us,cs,ps,ds,fs;if(ss>=1)return Math.max(100,ts+100*Math.sqrt(ts));if(ss<=0)return 0;for(ts>1?(ds=Math.log(ns),fs=Math.exp(ns*(ds-1)-as),ps=ss<.5?ss:1-ss,us=Math.sqrt(-2*Math.log(ps)),os=(2.30753+us*.27061)/(1+us*(.99229+us*.04481))-us,ss<.5&&(os=-os),os=Math.max(.001,ts*Math.pow(1-1/(9*ts)-os/(3*Math.sqrt(ts)),3))):(us=1-ts*(.253+ts*.12),ss<us?os=Math.pow(ss/us,1/ts):os=1-Math.log(1-(ss-us)/(1-us)));rs<12;rs++){if(os<=0)return 0;if(ls=lowRegGamma(ts,os)-ss,ts>1?us=fs*Math.exp(-(os-ns)+ns*(Math.log(os)-ds)):us=Math.exp(-os+ns*Math.log(os)-as),cs=ls/us,os-=us=cs/(1-.5*Math.min(1,cs*((ts-1)/os-1))),os<=0&&(os=.5*(os+us)),Math.abs(us)<is*os)break}return os}const normal={pdf:function ss(ts,rs,ns){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(ns)-Math.pow(ts-rs,2)/(2*ns*ns))},cdf:function ss(ts,rs,ns){return .5*(1+erf((ts-rs)/Math.sqrt(2*ns*ns)))},inv:function(ss,ts,rs){return-1.4142135623730951*rs*erfcinv(2*ss)+ts}},beta={pdf:function ss(ts,rs,ns){return ts>1||ts<0?0:rs==1&&ns==1?1:rs<512&&ns<512?Math.pow(ts,rs-1)*Math.pow(1-ts,ns-1)/betafn(rs,ns):Math.exp((rs-1)*Math.log(ts)+(ns-1)*Math.log(1-ts)-betaln(rs,ns))},cdf:function ss(ts,rs,ns){return ts>1||ts<0?+(ts>1):ibeta(ts,rs,ns)},inv:function ss(ts,rs,ns){return ibetainv(ts,rs,ns)}};function betafn(ss,ts){if(!(ss<=0||ts<=0))return ss+ts>170?Math.exp(betaln(ss,ts)):gammafn(ss)*gammafn(ts)/gammafn(ss+ts)}function betaln(ss,ts){return gammaln(ss)+gammaln(ts)-gammaln(ss+ts)}function ibetainv(ss,ts,rs){var ns=1e-8,is=ts-1,as=rs-1,os=0,ls,us,cs,ps,ds,fs,hs,ys,gs,bs,vs;if(ss<=0)return 0;if(ss>=1)return 1;for(ts>=1&&rs>=1?(cs=ss<.5?ss:1-ss,ps=Math.sqrt(-2*Math.log(cs)),hs=(2.30753+ps*.27061)/(1+ps*(.99229+ps*.04481))-ps,ss<.5&&(hs=-hs),ys=(hs*hs-3)/6,gs=2/(1/(2*ts-1)+1/(2*rs-1)),bs=hs*Math.sqrt(ys+gs)/gs-(1/(2*rs-1)-1/(2*ts-1))*(ys+5/6-2/(3*gs)),hs=ts/(ts+rs*Math.exp(2*bs))):(ls=Math.log(ts/(ts+rs)),us=Math.log(rs/(ts+rs)),ps=Math.exp(ts*ls)/ts,ds=Math.exp(rs*us)/rs,bs=ps+ds,ss<ps/bs?hs=Math.pow(ts*bs*ss,1/ts):hs=1-Math.pow(rs*bs*(1-ss),1/rs)),vs=-gammaln(ts)-gammaln(rs)+gammaln(ts+rs);os<10;os++){if(hs===0||hs===1)return hs;if(fs=ibeta(hs,ts,rs)-ss,ps=Math.exp(is*Math.log(hs)+as*Math.log(1-hs)+vs),ds=fs/ps,hs-=ps=ds/(1-.5*Math.min(1,ds*(is/hs-as/(1-hs)))),hs<=0&&(hs=.5*(hs+ps)),hs>=1&&(hs=.5*(hs+ps+1)),Math.abs(ps)<ns*hs&&os>0)break}return hs}function ibeta(ss,ts,rs){var ns=ss===0||ss===1?0:Math.exp(gammaln(ts+rs)-gammaln(ts)-gammaln(rs)+ts*Math.log(ss)+rs*Math.log(1-ss));return ss<0||ss>1?!1:ss<(ts+1)/(ts+rs+2)?ns*betacf(ss,ts,rs)/ts:1-ns*betacf(1-ss,rs,ts)/rs}function betacf(ss,ts,rs){var ns=1e-30,is=1,as=ts+rs,os=ts+1,ls=ts-1,us=1,cs=1-as*ss/os,ps,ds,fs,hs;for(Math.abs(cs)<ns&&(cs=ns),cs=1/cs,hs=cs;is<=100&&(ps=2*is,ds=is*(rs-is)*ss/((ls+ps)*(ts+ps)),cs=1+ds*cs,Math.abs(cs)<ns&&(cs=ns),us=1+ds/us,Math.abs(us)<ns&&(us=ns),cs=1/cs,hs*=cs*us,ds=-(ts+is)*(as+is)*ss/((ts+ps)*(os+ps)),cs=1+ds*cs,Math.abs(cs)<ns&&(cs=ns),us=1+ds/us,Math.abs(us)<ns&&(us=ns),cs=1/cs,fs=cs*us,hs*=fs,!(Math.abs(fs-1)<3e-7));is++);return hs}const binomial={pdf:function(ss,ts,rs){return rs===0||rs===1?ts*rs===ss?1:0:combination(ts,ss)*Math.pow(rs,ss)*Math.pow(1-rs,ts-ss)},cdf:function(ss,ts,rs){var ns,is=1e-10;if(ss<0)return 0;if(ss>=ts)return 1;if(rs<0||rs>1||ts<=0)return NaN;ss=Math.floor(ss);var as=rs,os=ss+1,ls=ts-ss,us=os+ls,cs=Math.exp(gammaln(us)-gammaln(ls)-gammaln(os)+os*Math.log(as)+ls*Math.log(1-as));return as<(os+1)/(us+2)?ns=cs*betinc(as,os,ls,is):ns=1-cs*betinc(1-as,ls,os,is),Math.round((1-ns)*(1/is))/(1/is)}};function betinc(ss,ts,rs,ns){for(var is=0,as=1,os=1,ls=1,us=0,cs=0,ps;Math.abs((os-cs)/os)>ns;)cs=os,ps=-(ts+us)*(ts+rs+us)*ss/(ts+2*us)/(ts+2*us+1),is=os+ps*is,as=ls+ps*as,us=us+1,ps=us*(rs-us)*ss/(ts+2*us-1)/(ts+2*us),os=is+ps*os,ls=as+ps*ls,is=is/ls,as=as/ls,os=os/ls,ls=1;return os/ts}function combination(ss,ts){return ss>170||ts>170?Math.exp(combinationln(ss,ts)):factorial(ss)/factorial(ts)/factorial(ss-ts)}function combinationln(ss,ts){return factorialln(ss)-factorialln(ts)-factorialln(ss-ts)}function factorialln(ss){return ss<0?NaN:gammaln(ss+1)}function factorial(ss){return ss<0?NaN:gammafn(ss+1)}const chisquare={pdf:function ss(ts,rs){return ts<0?0:ts===0&&rs===2?.5:Math.exp((rs/2-1)*Math.log(ts)-ts/2-rs/2*Math.log(2)-gammaln(rs/2))},cdf:function ss(ts,rs){return ts<0?0:lowRegGamma(rs/2,ts/2)},inv:function(ss,ts){return 2*gammapinv(ss,.5*ts)}},centralF={pdf:function ss(ts,rs,ns){var is,as,os;return ts<0?0:rs<=2?ts===0&&rs<2?1/0:ts===0&&rs===2?1:1/betafn(rs/2,ns/2)*Math.pow(rs/ns,rs/2)*Math.pow(ts,rs/2-1)*Math.pow(1+rs/ns*ts,-(rs+ns)/2):(is=rs*ts/(ns+ts*rs),as=ns/(ns+ts*rs),os=rs*as/2,os*binomial.pdf((rs-2)/2,(rs+ns-2)/2,is))},cdf:function ss(ts,rs,ns){return ts<0?0:ibeta(rs*ts/(rs*ts+ns),rs/2,ns/2)},inv:function ss(ts,rs,ns){return ns/(rs*(1/ibetainv(ts,rs/2,ns/2)-1))}},weibull={pdf:function ss(ts,rs,ns){return ts<0||rs<0||ns<0?0:ns/rs*Math.pow(ts/rs,ns-1)*Math.exp(-Math.pow(ts/rs,ns))},cdf:function ss(ts,rs,ns){return ts<0?0:1-Math.exp(-Math.pow(ts/rs,ns))}},poisson={pdf:function ss(ts,rs){return rs<0||ts%1!==0||ts<0?0:Math.pow(rs,ts)*Math.exp(-rs)/factorial(ts)},cdf:function ss(ts,rs){var ns=0;if(ts<0)return 0;for(var is=0;ns<=ts;ns++)is+=poisson.pdf(ns,rs);return is}},hypgeom={pdf:function ss(ts,rs,ns,is){if(ts<0||ts<ns-(rs-is))return 0;if(ts>is||ts>ns)return 0;if(ns*2>rs)return is*2>rs?hypgeom.pdf(rs-ns-is+ts,rs,rs-ns,rs-is):hypgeom.pdf(is-ts,rs,rs-ns,is);if(is*2>rs)return hypgeom.pdf(ns-ts,rs,ns,rs-is);if(ns<is)return hypgeom.pdf(ts,rs,is,ns);for(var as=1,os=0,ls=0;ls<ts;ls++){for(;as>1&&os<is;)as*=1-ns/(rs-os),os++;as*=(is-ls)*(ns-ls)/((ls+1)*(rs-ns-is+ls+1))}for(;os<is;os++)as*=1-ns/(rs-os);return Math.min(1,Math.max(0,as))},cdf:function ss(ts,rs,ns,is){if(ts<0||ts<ns-(rs-is))return 0;if(ts>=is||ts>=ns)return 1;if(ns*2>rs)return is*2>rs?ss(rs-ns-is+ts,rs,rs-ns,rs-is):1-hypgeom.cdf(is-ts-1,rs,rs-ns,is);if(is*2>rs)return 1-hypgeom.cdf(ns-ts-1,rs,ns,rs-is);if(ns<is)return hypgeom.cdf(ts,rs,is,ns);for(var as=1,os=1,ls=0,us=0;us<ts;us++){for(;as>1&&ls<is;){var cs=1-ns/(rs-ls);os*=cs,as*=cs,ls++}os*=(is-us)*(ns-us)/((us+1)*(rs-ns-is+us+1)),as+=os}for(;ls<is;ls++)as*=1-ns/(rs-ls);return Math.min(1,Math.max(0,as))}},studentt={pdf:function ss(ts,rs){return rs=rs>1e100?1e100:rs,1/(Math.sqrt(rs)*betafn(.5,rs/2))*Math.pow(1+ts*ts/rs,-((rs+1)/2))},cdf:function ss(ts,rs){var ns=rs/2;return ibeta((ts+Math.sqrt(ts*ts+rs))/(2*Math.sqrt(ts*ts+rs)),ns,ns)},inv:function(ss,ts){var rs=ibetainv(2*Math.min(ss,1-ss),.5*ts,.5);return rs=Math.sqrt(ts*(1-rs)/rs),ss>.5?rs:-rs}},lognormal={pdf:function ss(ts,rs,ns){return ts<=0?0:Math.exp(-Math.log(ts)-.5*Math.log(2*Math.PI)-Math.log(ns)-Math.pow(Math.log(ts)-rs,2)/(2*ns*ns))},cdf:function ss(ts,rs,ns){return ts<0?0:.5+.5*erf((Math.log(ts)-rs)/Math.sqrt(2*ns*ns))},inv:function(ss,ts,rs){return Math.exp(-1.4142135623730951*rs*erfcinv(2*ss)+ts)}},negbin={pdf:function ss(ts,rs,ns){return ts!==ts>>>0?!1:ts<0?0:combination(ts+rs-1,rs-1)*Math.pow(1-ns,ts)*Math.pow(ns,rs)},cdf:function ss(ts,rs,ns){var is=0,as=0;if(ts<0)return 0;for(;as<=ts;as++)is+=negbin.pdf(as,rs,ns);return is}};function sum(ss){for(var ts=0,rs=ss.length;--rs>=0;)ts+=ss[rs];return ts}function mean(ss){return sum(ss)/ss.length}function sumsqerr(ss){for(var ts=mean(ss),rs=0,ns=ss.length,is;--ns>=0;)is=ss[ns]-ts,rs+=is*is;return rs}function variance(ss,ts){return sumsqerr(ss)/(ss.length-(ts?1:0))}function stdev(ss,ts){return Math.sqrt(variance(ss,ts))}function normalci(){var ss=[].slice.call(arguments),ts=new Array(2),rs;return ss.length===4?rs=Math.abs(normal.inv(ss[1]/2,0,1)*ss[2]/Math.sqrt(ss[3])):rs=Math.abs(normal.inv(ss[1]/2,0,1)*stdev(ss[2])/Math.sqrt(ss[2].length)),ts[0]=ss[0]-rs,ts[1]=ss[0]+rs,ts}function tci(){var ss=[].slice.call(arguments),ts=new Array(2),rs;return ss.length===4?rs=Math.abs(studentt.inv(ss[1]/2,ss[3]-1)*ss[2]/Math.sqrt(ss[3])):rs=Math.abs(studentt.inv(ss[1]/2,ss[2].length-1)*stdev(ss[2],!0)/Math.sqrt(ss[2].length)),ts[0]=ss[0]-rs,ts[1]=ss[0]+rs,ts}function product(ss){for(var ts=1,rs=ss.length;--rs>=0;)ts*=ss[rs];return ts}function geomean(ss){return Math.pow(product(ss),1/ss.length)}function covariance(ss,ts){var rs=mean(ss),ns=mean(ts),is=ss.length,as=new Array(is),os;for(os=0;os<is;os++)as[os]=(ss[os]-rs)*(ts[os]-ns);return sum(as)/(is-1)}function corrcoeff(ss,ts){return covariance(ss,ts)/stdev(ss,1)/stdev(ts,1)}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class StatisticalPlugin extends FunctionPlugin{erf(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ERF"),(ns,is)=>is===void 0?erf(ns):erf(is)-erf(ns))}erfc(ts,rs){return this.runFunction(ts.args,rs,this.metadata("ERFC"),erfc)}expondist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("EXPON.DIST"),(ns,is,as)=>as?exponential.cdf(ns,is):exponential.pdf(ns,is))}fisher(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FISHER"),ns=>Math.log((1+ns)/(1-ns))/2)}fisherinv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FISHERINV"),ns=>1-2/(Math.exp(2*ns)+1))}gamma(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GAMMA"),gammafn)}gammadist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GAMMA.DIST"),(ns,is,as,os)=>os?gamma.cdf(ns,is,as):gamma.pdf(ns,is,as))}gammaln(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GAMMALN"),gammaln)}gammainv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GAMMA.INV"),gamma.inv)}gauss(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GAUSS"),ns=>normal.cdf(ns,0,1)-.5)}betadist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BETA.DIST"),(ns,is,as,os,ls,us)=>ns<=ls?new CellError(ErrorType.NUM,ErrorMessage.ValueSmall):ns>=us?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(ns=(ns-ls)/(us-ls),os?beta.cdf(ns,is,as):beta.pdf(ns,is,as)))}betainv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BETA.INV"),(ns,is,as,os,ls)=>os>=ls?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):beta.inv(ns,is,as)*(ls-os)+os)}binomialdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BINOM.DIST"),(ns,is,as,os)=>ns>is?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(ns=Math.trunc(ns),is=Math.trunc(is),os?binomial.cdf(ns,is,as):binomial.pdf(ns,is,as)))}binomialinv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BINOM.INV"),(ns,is,as)=>{ns=Math.trunc(ns);let os=-1,ls=ns;for(;ls>os+1;){const us=Math.trunc((os+ls)/2);binomial.cdf(us,ns,is)>=as?ls=us:os=us}return ls})}besselifn(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BESSELI"),(ns,is)=>besseli(ns,Math.trunc(is)))}besseljfn(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BESSELJ"),(ns,is)=>besselj(ns,Math.trunc(is)))}besselkfn(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BESSELK"),(ns,is)=>besselk(ns,Math.trunc(is)))}besselyfn(ts,rs){return this.runFunction(ts.args,rs,this.metadata("BESSELY"),(ns,is)=>bessely(ns,Math.trunc(is)))}chisqdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHISQ.DIST"),(ns,is,as)=>(is=Math.trunc(is),as?chisquare.cdf(ns,is):chisquare.pdf(ns,is)))}chisqdistrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHISQ.DIST.RT"),(ns,is)=>1-chisquare.cdf(ns,Math.trunc(is)))}chisqinv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHISQ.INV"),(ns,is)=>chisquare.inv(ns,Math.trunc(is)))}chisqinvrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHISQ.INV.RT"),(ns,is)=>chisquare.inv(1-ns,Math.trunc(is)))}fdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("F.DIST"),(ns,is,as,os)=>(is=Math.trunc(is),as=Math.trunc(as),os?centralF.cdf(ns,is,as):centralF.pdf(ns,is,as)))}fdistrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("F.DIST.RT"),(ns,is,as)=>1-centralF.cdf(ns,Math.trunc(is),Math.trunc(as)))}finv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("F.INV"),(ns,is,as)=>centralF.inv(ns,Math.trunc(is),Math.trunc(as)))}finvrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("F.INV.RT"),(ns,is,as)=>centralF.inv(1-ns,Math.trunc(is),Math.trunc(as)))}weibulldist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("WEIBULL.DIST"),(ns,is,as,os)=>os?weibull.cdf(ns,as,is):weibull.pdf(ns,as,is))}poissondist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("POISSON.DIST"),(ns,is,as)=>(ns=Math.trunc(ns),as?poisson.cdf(ns,is):poisson.pdf(ns,is)))}hypgeomdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HYPGEOM.DIST"),(ns,is,as,os,ls)=>ns>is||ns>as||is>os||as>os?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):ns+os<as+is?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(ns=Math.trunc(ns),is=Math.trunc(is),as=Math.trunc(as),os=Math.trunc(os),ls?hypgeom.cdf(ns,os,as,is):hypgeom.pdf(ns,os,as,is)))}tdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.DIST"),(ns,is,as)=>(is=Math.trunc(is),as?studentt.cdf(ns,is):studentt.pdf(ns,is)))}tdist2t(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.DIST.2T"),(ns,is)=>(1-studentt.cdf(ns,Math.trunc(is)))*2)}tdistrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.DIST.RT"),(ns,is)=>1-studentt.cdf(ns,Math.trunc(is)))}tdistold(ts,rs){return this.runFunction(ts.args,rs,this.metadata("TDIST"),(ns,is,as)=>as*(1-studentt.cdf(ns,Math.trunc(is))))}tinv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.INV"),(ns,is)=>studentt.inv(ns,Math.trunc(is)))}tinv2t(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.INV.2T"),(ns,is)=>studentt.inv(1-ns/2,Math.trunc(is)))}lognormdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LOGNORM.DIST"),(ns,is,as,os)=>os?lognormal.cdf(ns,is,as):lognormal.pdf(ns,is,as))}lognorminv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LOGNORM.INV"),(ns,is,as)=>lognormal.inv(ns,is,as))}normdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NORM.DIST"),(ns,is,as,os)=>os?normal.cdf(ns,is,as):normal.pdf(ns,is,as))}norminv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NORM.INV"),(ns,is,as)=>normal.inv(ns,is,as))}normsdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NORM.S.DIST"),(ns,is)=>is?normal.cdf(ns,0,1):normal.pdf(ns,0,1))}normsinv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NORM.S.INV"),ns=>normal.inv(ns,0,1))}phi(ts,rs){return this.runFunction(ts.args,rs,this.metadata("PHI"),ns=>normal.pdf(ns,0,1))}negbinomdist(ts,rs){return this.runFunction(ts.args,rs,this.metadata("NEGBINOM.DIST"),(ns,is,as,os)=>(ns=Math.trunc(ns),is=Math.trunc(is),os?negbin.cdf(ns,is,as):negbin.pdf(ns,is,as)))}confidencenorm(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CONFIDENCE.NORM"),(ns,is,as)=>normalci(1,ns,is,Math.trunc(as))[1]-1)}confidencet(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CONFIDENCE.T"),(ns,is,as)=>(as=Math.trunc(as),as===1?new CellError(ErrorType.DIV_BY_ZERO):tci(1,ns,is,as)[1]-1))}standardize(ts,rs){return this.runFunction(ts.args,rs,this.metadata("STANDARDIZE"),(ns,is,as)=>(ns-is)/as)}}StatisticalPlugin.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:ArgumentTypes.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10},{argumentType:ArgumentTypes.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]}},StatisticalPlugin.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class MathPlugin extends FunctionPlugin{fact(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FACT"),ns=>{ns=Math.trunc(ns);let is=1;for(let as=1;as<=ns;as++)is*=as;return is})}factdouble(ts,rs){return this.runFunction(ts.args,rs,this.metadata("FACTDOUBLE"),ns=>{ns=Math.trunc(ns);let is=1;for(let as=ns;as>=1;as-=2)is*=as;return is})}combin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COMBIN"),(ns,is)=>is>ns?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(ns=Math.trunc(ns),is=Math.trunc(is),combin(ns,is)))}combina(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COMBINA"),(ns,is)=>(ns=Math.trunc(ns),is=Math.trunc(is),ns+is-1>=1030?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):ns===0&&is===0?1:combin(ns+is-1,is)))}gcd(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GCD"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(ns);if(is instanceof CellError)return is;let as=0;for(const os of is){if(os<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);as=binaryGCD(as,Math.trunc(os))}return as>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):as})}lcm(ts,rs){return this.runFunction(ts.args,rs,this.metadata("LCM"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(ns);if(is instanceof CellError)return is;let as=1;for(const os of is){if(os<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);as=binaryLCM(as,Math.trunc(os))}return as>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):as})}mround(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MROUND"),(ns,is)=>is===0?0:ns>0&&is<0||ns<0&&is>0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.round(ns/is)*is)}multinomial(ts,rs){return this.runFunction(ts.args,rs,this.metadata("MULTINOMIAL"),(...ns)=>{let is=0,as=1;for(let os of ns){if(os<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);os=Math.trunc(os);for(let ls=1;ls<=os;ls++)as*=(is+ls)/ls;is+=os}return Math.round(as)})}quotient(ts,rs){return this.runFunction(ts.args,rs,this.metadata("QUOTIENT"),(ns,is)=>is===0?new CellError(ErrorType.DIV_BY_ZERO):Math.trunc(ns/is))}seriessum(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SERIESSUM"),(ns,is,as,os)=>{const ls=this.arithmeticHelper.manyToOnlyNumbersDropNulls(os.valuesFromTopLeftCorner());if(ls instanceof CellError)return ls;let us=0;ls.reverse();for(const cs of ls)us*=Math.pow(ns,as),us+=cs;return us*Math.pow(ns,is)})}sign(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SIGN"),ns=>ns>0?1:ns<0?-1:0)}sumx2my2(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SUMX2MY2"),(ns,is)=>{const as=ns.valuesFromTopLeftCorner(),os=is.valuesFromTopLeftCorner();if(as.length!==os.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const ls=as.length;let us=0;for(let cs=0;cs<ls;cs++){const ps=as[cs],ds=os[cs];if(ps instanceof CellError)return ps;if(ds instanceof CellError)return ds;typeof ps=="number"&&typeof ds=="number"&&(us+=Math.pow(ps,2)-Math.pow(ds,2))}return us})}sumx2py2(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SUMX2PY2"),(ns,is)=>{const as=ns.valuesFromTopLeftCorner(),os=is.valuesFromTopLeftCorner();if(as.length!==os.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const ls=as.length;let us=0;for(let cs=0;cs<ls;cs++){const ps=as[cs],ds=os[cs];if(ps instanceof CellError)return ps;if(ds instanceof CellError)return ds;typeof ps=="number"&&typeof ds=="number"&&(us+=Math.pow(ps,2)+Math.pow(ds,2))}return us})}sumxmy2(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SUMXMY2"),(ns,is)=>{const as=ns.valuesFromTopLeftCorner(),os=is.valuesFromTopLeftCorner();if(as.length!==os.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const ls=as.length;let us=0;for(let cs=0;cs<ls;cs++){const ps=as[cs],ds=os[cs];if(ps instanceof CellError)return ps;if(ds instanceof CellError)return ds;typeof ps=="number"&&typeof ds=="number"&&(us+=Math.pow(ps-ds,2))}return us})}}MathPlugin.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,lessThan:1030},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:ArgumentTypes.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]}};function combin(ss,ts){2*ts>ss&&(ts=ss-ts);let rs=1;for(let ns=1;ns<=ts;ns++)rs*=(ss-ts+ns)/ns;return Math.round(rs)}function binaryGCD(ss,ts){for(ss<ts&&([ss,ts]=[ts,ss]);ts>0;)[ss,ts]=[ts,ss%ts];return ss}function binaryLCM(ss,ts){return ss===0||ts===0?0:ss*(ts/binaryGCD(ss,ts))}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class ComplexPlugin extends FunctionPlugin{complex(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COMPLEX"),(ns,is,as)=>as!=="i"&&as!=="j"?new CellError(ErrorType.VALUE,ErrorMessage.ShouldBeIorJ):coerceComplexToString([ns,is],as))}imabs(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMABS"),abs)}imaginary(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMAGINARY"),([ns,is])=>is)}imreal(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMREAL"),([ns,is])=>ns)}imargument(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMARGUMENT"),([ns,is])=>ns===0&&is===0?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(is,ns))}imconjugate(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCONJUGATE"),([ns,is])=>coerceComplexToString([ns,-is]))}imcos(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCOS"),ns=>coerceComplexToString(cos(ns)))}imcosh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCOSH"),ns=>coerceComplexToString(cosh(ns)))}imcot(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCOT"),ns=>coerceComplexToString(div(cos(ns),sin(ns))))}imcsc(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCSC"),ns=>coerceComplexToString(div([1,0],sin(ns))))}imcsch(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMCSCH"),ns=>coerceComplexToString(div([1,0],sinh(ns))))}imsec(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSEC"),ns=>coerceComplexToString(div([1,0],cos(ns))))}imsech(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSECH"),ns=>coerceComplexToString(div([1,0],cosh(ns))))}imsin(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSIN"),ns=>coerceComplexToString(sin(ns)))}imsinh(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSINH"),ns=>coerceComplexToString(sinh(ns)))}imtan(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMTAN"),ns=>coerceComplexToString(div(sin(ns),cos(ns))))}imdiv(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMDIV"),(ns,is)=>coerceComplexToString(div(ns,is)))}improduct(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMPRODUCT"),(...ns)=>{const is=this.arithmeticHelper.coerceComplexExactRanges(ns);if(is instanceof CellError)return is;let as=[1,0];for(const os of is)as=mul(as,os);return coerceComplexToString(as)})}imsum(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSUM"),(...ns)=>{const is=this.arithmeticHelper.coerceComplexExactRanges(ns);if(is instanceof CellError)return is;let as=[0,0];for(const os of is)as=add(as,os);return coerceComplexToString(as)})}imsub(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSUB"),(ns,is)=>coerceComplexToString(sub(ns,is)))}imexp(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMEXP"),ns=>coerceComplexToString(exp(ns)))}imln(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMLN"),ns=>coerceComplexToString(ln$1(ns)))}imlog10(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMLOG10"),ns=>{const[is,as]=ln$1(ns),os=Math.log(10);return coerceComplexToString([is/os,as/os])})}imlog2(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMLOG2"),ns=>{const[is,as]=ln$1(ns),os=Math.log(2);return coerceComplexToString([is/os,as/os])})}impower(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMPOWER"),(ns,is)=>coerceComplexToString(power(ns,is)))}imsqrt(ts,rs){return this.runFunction(ts.args,rs,this.metadata("IMSQRT"),ns=>coerceComplexToString(power(ns,.5)))}}ComplexPlugin.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:ArgumentTypes.COMPLEX}]}};function add([ss,ts],[rs,ns]){return[ss+rs,ts+ns]}function sub([ss,ts],[rs,ns]){return[ss-rs,ts-ns]}function mul([ss,ts],[rs,ns]){return[ss*rs-ts*ns,ss*ns+rs*ts]}function div([ss,ts],[rs,ns]){const is=Math.pow(rs,2)+Math.pow(ns,2),[as,os]=mul([ss,ts],[rs,-ns]);return[as/is,os/is]}function cos([ss,ts]){return[Math.cos(ss)*Math.cosh(ts),-Math.sin(ss)*Math.sinh(ts)]}function cosh([ss,ts]){return[Math.cosh(ss)*Math.cos(ts),Math.sinh(ss)*Math.sin(ts)]}function sin([ss,ts]){return[Math.sin(ss)*Math.cosh(ts),Math.cos(ss)*Math.sinh(ts)]}function sinh([ss,ts]){return[Math.sinh(ss)*Math.cos(ts),Math.cosh(ss)*Math.sin(ts)]}function exp([ss,ts]){return[Math.exp(ss)*Math.cos(ts),Math.exp(ss)*Math.sin(ts)]}function abs([ss,ts]){return Math.sqrt(ss*ss+ts*ts)}function ln$1([ss,ts]){return[Math.log(abs([ss,ts])),Math.atan2(ts,ss)]}function power(ss,ts){const[rs,ns]=ln$1(ss);return exp([ts*rs,ts*ns])}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class StatisticalAggregationPlugin extends FunctionPlugin{avedev(ts,rs){return this.runFunction(ts.args,rs,this.metadata("AVEDEV"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);if(is instanceof CellError)return is;if(is.length===0)return new CellError(ErrorType.DIV_BY_ZERO);const as=mean(is);return is.reduce((os,ls)=>os+Math.abs(ls-as),0)/is.length})}devsq(ts,rs){return this.runFunction(ts.args,rs,this.metadata("DEVSQ"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);return is instanceof CellError?is:is.length===0?0:sumsqerr(is)})}geomean(ts,rs){return this.runFunction(ts.args,rs,this.metadata("GEOMEAN"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);if(is instanceof CellError)return is;if(is.length===0)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);for(const as of is)if(as<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);return geomean(is)})}harmean(ts,rs){return this.runFunction(ts.args,rs,this.metadata("HARMEAN"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);if(is instanceof CellError)return is;if(is.length===0)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);for(const as of is)if(as<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);return is.length/is.reduce((as,os)=>as+1/os,0)})}correl(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CORREL"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);return as instanceof CellError?as:as[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):corrcoeff(as[0],as[1])})}rsq(ts,rs){return this.runFunction(ts.args,rs,this.metadata("RSQ"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);return as instanceof CellError?as:as[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):Math.pow(corrcoeff(as[0],as[1]),2)})}covariancep(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COVARIANCE.P"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);if(as instanceof CellError)return as;const os=as[0].length;return os<1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.OneValue):os===1?0:covariance(as[0],as[1])*(os-1)/os})}covariances(ts,rs){return this.runFunction(ts.args,rs,this.metadata("COVARIANCE.S"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);return as instanceof CellError?as:as[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(as[0],as[1])})}ztest(ts,rs){return this.runFunction(ts.args,rs,this.metadata("Z.TEST"),(ns,is,as)=>{const os=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner());if(os instanceof CellError)return os;const ls=os.length;if(as===void 0){if(ls<2)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);as=stdev(os,!0)}return ls<1?new CellError(ErrorType.NA,ErrorMessage.OneValue):as===0?new CellError(ErrorType.DIV_BY_ZERO):1-normal.cdf((mean(os)-is)/(as/Math.sqrt(ls)),0,1)})}ftest(ts,rs){return this.runFunction(ts.args,rs,this.metadata("F.TEST"),(ns,is)=>{const as=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner()),os=this.arithmeticHelper.manyToExactNumbers(is.valuesFromTopLeftCorner());if(as instanceof CellError)return as;if(os instanceof CellError)return os;if(as.length<=1||os.length<=1)return new CellError(ErrorType.DIV_BY_ZERO);const ls=variance(as,!0),us=variance(os,!0);if(ls===0||us===0)return new CellError(ErrorType.DIV_BY_ZERO);const cs=ls/us,ps=centralF.cdf(cs,as.length-1,os.length-1);return 2*Math.min(ps,1-ps)})}steyx(ts,rs){return this.runFunction(ts.args,rs,this.metadata("STEYX"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);if(as instanceof CellError)return as;const os=as[0].length;return os<=2?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues):Math.sqrt((sumsqerr(as[0])-Math.pow(covariance(as[0],as[1])*(os-1),2)/sumsqerr(as[1]))/(os-2))})}slope(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SLOPE"),(ns,is)=>{if(ns.numberOfElements()!==is.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const as=parseTwoArrays(ns,is);if(as instanceof CellError)return as;const os=as[0].length;return os<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(as[0],as[1])*(os-1)/sumsqerr(as[1])})}chisqtest(ts,rs){return this.runFunction(ts.args,rs,this.metadata("CHISQ.TEST"),(ns,is)=>{const as=ns.height(),os=ns.width();if(is.height()!==as||is.width()!==os)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);const ls=parseTwoArrays(ns,is);if(ls instanceof CellError)return ls;if(ls[0].length<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);let us=0;for(let cs=0;cs<ls[0].length;cs++){if(ls[1][cs]===0)return new CellError(ErrorType.DIV_BY_ZERO);us+=Math.pow(ls[0][cs]-ls[1][cs],2)/ls[1][cs]}return us<0?new CellError(ErrorType.NUM,ErrorMessage.NaN):1-chisquare.cdf(us,as>1&&os>1?(as-1)*(os-1):as*os-1)})}ttest(ts,rs){return this.runFunction(ts.args,rs,this.metadata("T.TEST"),(ns,is,as,os)=>{const ls=this.arithmeticHelper.manyToExactNumbers(ns.valuesFromTopLeftCorner()),us=this.arithmeticHelper.manyToExactNumbers(is.valuesFromTopLeftCorner());if(ls instanceof CellError)return ls;if(us instanceof CellError)return us;const cs=ls.length,ps=us.length;if(os===1){if(ps!==cs)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);if(cs<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const ds=Array(cs);for(let ys=0;ys<cs;ys++)ds[ys]=ls[ys]-us[ys];const fs=stdev(ds,!0);if(fs===0)return new CellError(ErrorType.DIV_BY_ZERO);const hs=Math.abs(Math.sqrt(cs)*mean(ds)/fs);return as*(1-studentt.cdf(hs,cs-1))}else if(os===2){if(cs<=1||ps<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const ds=(sumsqerr(ls)+sumsqerr(us))/(cs+ps-2);if(ds===0)return new CellError(ErrorType.DIV_BY_ZERO);const fs=Math.abs((mean(ls)-mean(us))/Math.sqrt(ds*(1/cs+1/ps)));return as*(1-studentt.cdf(fs,cs+ps-2))}else{if(cs<=1||ps<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);const ds=variance(ls,!0),fs=variance(us,!0);if(ds===0&&fs===0)return new CellError(ErrorType.DIV_BY_ZERO);const hs=Math.abs((mean(ls)-mean(us))/Math.sqrt(ds/cs+fs/ps)),ys=Math.pow(ds/cs+fs/ps,2)/(Math.pow(ds/cs,2)/(cs-1)+Math.pow(fs/ps,2)/(ps-1));return as*(1-studentt.cdf(hs,ys))}})}skew(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SKEW"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);if(is instanceof CellError)return is;const as=is.length;if(as<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);const os=mean(is),ls=stdev(is,!0);return ls===0?new CellError(ErrorType.DIV_BY_ZERO):is.reduce((us,cs)=>us+Math.pow((cs-os)/ls,3),0)*as/(as-1)/(as-2)})}skewp(ts,rs){return this.runFunction(ts.args,rs,this.metadata("SKEW.P"),(...ns)=>{const is=this.arithmeticHelper.coerceNumbersExactRanges(ns);if(is instanceof CellError)return is;const as=is.length;if(as<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);const os=mean(is),ls=stdev(is,!1);return ls===0?new CellError(ErrorType.DIV_BY_ZERO):is.reduce((us,cs)=>us+Math.pow((cs-os)/ls,3),0)/as})}}StatisticalAggregationPlugin.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:2},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1}},StatisticalAggregationPlugin.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};function parseTwoArrays(ss,ts){const rs=ss.iterateValuesFromTopLeftCorner(),ns=ts.iterateValuesFromTopLeftCorner();let is,as;const os=[],ls=[];for(;is=rs.next(),as=ns.next(),!is.done&&!as.done;){const us=is.value,cs=as.value;if(us instanceof CellError)return us;if(cs instanceof CellError)return cs;isExtendedNumber(us)&&isExtendedNumber(cs)&&(os.push(getRawValue(us)),ls.push(getRawValue(cs)))}return[os,ls]}/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */var plugins=Object.freeze({__proto__:null,AbsPlugin,ArrayPlugin,BitShiftPlugin,BitwiseLogicOperationsPlugin,BooleanPlugin,CharPlugin,CodePlugin,ComplexPlugin,ConditionalAggregationPlugin,CountBlankPlugin,CountUniquePlugin,DateTimePlugin,DegreesPlugin,DeltaPlugin,ExpPlugin,FinancialPlugin,FormulaTextPlugin,InformationPlugin,IsEvenPlugin,IsOddPlugin,LogarithmPlugin,LookupPlugin,MathConstantsPlugin,MathPlugin,MatrixPlugin,MedianPlugin,ModuloPlugin,NumericAggregationPlugin,PowerPlugin,RadiansPlugin,RadixConversionPlugin,RandomPlugin,RomanPlugin,RoundingPlugin,SimpleArithmerticPlugin,SqrtPlugin,StatisticalAggregationPlugin,StatisticalPlugin,SumprodPlugin,TextPlugin,TrigonometryPlugin});/**
 * @license
 * Copyright (c) 2022 Handsoncode. All rights reserved.
 */class HyperFormulaNS extends HyperFormula{}HyperFormulaNS.HyperFormula=HyperFormula,HyperFormulaNS.ErrorType=ErrorType,HyperFormulaNS.CellType=CellType,HyperFormulaNS.CellValueType=CellValueType,HyperFormulaNS.CellValueDetailedType=CellValueDetailedType,HyperFormulaNS.DetailedCellError=DetailedCellError,HyperFormulaNS.ExportedCellChange=ExportedCellChange,HyperFormulaNS.ExportedNamedExpressionChange=ExportedNamedExpressionChange,HyperFormulaNS.ConfigValueTooBigError=ConfigValueTooBigError,HyperFormulaNS.ConfigValueTooSmallError=ConfigValueTooSmallError,HyperFormulaNS.EvaluationSuspendedError=EvaluationSuspendedError,HyperFormulaNS.ExpectedOneOfValuesError=ExpectedOneOfValuesError,HyperFormulaNS.ExpectedValueOfTypeError=ExpectedValueOfTypeError,HyperFormulaNS.FunctionPlugin=FunctionPlugin,HyperFormulaNS.FunctionPluginValidationError=FunctionPluginValidationError,HyperFormulaNS.InvalidAddressError=InvalidAddressError,HyperFormulaNS.InvalidArgumentsError=InvalidArgumentsError,HyperFormulaNS.LanguageNotRegisteredError=LanguageNotRegisteredError,HyperFormulaNS.LanguageAlreadyRegisteredError=LanguageAlreadyRegisteredError,HyperFormulaNS.MissingTranslationError=MissingTranslationError,HyperFormulaNS.NamedExpressionDoesNotExistError=NamedExpressionDoesNotExistError,HyperFormulaNS.NamedExpressionNameIsAlreadyTakenError=NamedExpressionNameIsAlreadyTakenError,HyperFormulaNS.NamedExpressionNameIsInvalidError=NamedExpressionNameIsInvalidError,HyperFormulaNS.NoOperationToRedoError=NoOperationToRedoError,HyperFormulaNS.NoOperationToUndoError=NoOperationToUndoError,HyperFormulaNS.NoRelativeAddressesAllowedError=NoRelativeAddressesAllowedError,HyperFormulaNS.NoSheetWithIdError=NoSheetWithIdError,HyperFormulaNS.NoSheetWithNameError=NoSheetWithNameError,HyperFormulaNS.NotAFormulaError=NotAFormulaError,HyperFormulaNS.NothingToPasteError=NothingToPasteError,HyperFormulaNS.ProtectedFunctionTranslationError=ProtectedFunctionTranslationError,HyperFormulaNS.SheetNameAlreadyTakenError=SheetNameAlreadyTakenError,HyperFormulaNS.SheetSizeLimitExceededError=SheetSizeLimitExceededError,HyperFormulaNS.SourceLocationHasArrayError=SourceLocationHasArrayError,HyperFormulaNS.TargetLocationHasArrayError=TargetLocationHasArrayError,HyperFormulaNS.UnableToParseError=UnableToParseError;const defaultLanguage=Config.defaultConfig.language;HyperFormula.registerLanguage(defaultLanguage,dictionary),HyperFormula.languages[dictionary.langCode]=dictionary;for(const ss of Object.getOwnPropertyNames(plugins))ss.startsWith("_")||HyperFormula.registerFunctionPlugin(plugins[ss]);class Spreadsheet extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{onChange:this.onChange.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},ts.minNumRows={createComponentOfType:"number",createStateVariable:"minNumRows",defaultValue:4,public:!0,forRenderer:!0},ts.minNumColumns={createComponentOfType:"number",createStateVariable:"minNumColumns",defaultValue:4,public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize"},ts.columnHeaders={createComponentOfType:"boolean",createStateVariable:"columnHeaders",defaultValue:!0,public:!0,forRenderer:!0},ts.rowHeaders={createComponentOfType:"boolean",createStateVariable:"rowHeaders",defaultValue:!0,public:!0,forRenderer:!0},ts.fixedRowsTop={createComponentOfType:"integer",createStateVariable:"fixedRowsTop",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},ts.fixedColumnsLeft={createComponentOfType:"integer",createStateVariable:"fixedColumnsLeft",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},ts.hiddenColumns={createComponentOfType:"numberList",createStateVariable:"hiddenColumns",defaultValue:[],public:!0,forRenderer:!0},ts.hiddenRows={createComponentOfType:"numberList",createStateVariable:"hiddenRows",defaultValue:[],public:!0,forRenderer:!0},ts}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]},{group:"rows",componentTypes:["row"]},{group:"columns",componentTypes:["column"]},{group:"cellBlocks",componentTypes:["cellBlock"]},{group:"dataFrames",componentTypes:["dataFrame"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.cellNameToRowCol={additionalStateVariablesDefined:["cellNamesByRowCol"],returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childGroups:["cells","rows","columns","cellBlocks"],variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:rs,componentInfoObjects:ns}){let is=determineCellMapping({cellRelatedChildren:rs.cellRelatedChildren,componentInfoObjects:ns});return{setValue:{cellNameToRowCol:is.cellNameToRowCol,cellNamesByRowCol:is.cellNamesByRowCol}}}},ts.numRows={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["numRows"]}}),definition({dependencyValues:rs}){let ns=rs.minNumRows;return Number.isFinite(ns)||(ns=4),ns=Math.max(ns,rs.cellNamesByRowCol.length),rs.dataFrameChild.length>0&&(ns=Math.max(ns,rs.dataFrameChild[0].stateValues.numRows)),{setValue:{numRows:ns}}}},ts.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["numColumns"]}}),definition({dependencyValues:rs}){let ns=rs.minNumColumns;Number.isFinite(ns)||(ns=4);for(let is of rs.cellNamesByRowCol)is&&(ns=Math.max(ns,is.length));return rs.dataFrameChild.length>0&&(ns=Math.max(ns,rs.dataFrameChild[0].stateValues.numColumns)),{setValue:{numColumns:ns}}}},ts.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},forRenderer:!0,returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},numRows:{dependencyType:"stateVariable",variableName:"numRows"}}),definition({dependencyValues:rs}){if(rs.heightAttr===null){let ns;return Number.isFinite(rs.numRows)&&rs.numRows>=0?ns=40+rs.numRows*23:ns=132,{setValue:{height:{size:ns,isAbsolute:!0}}}}return{setValue:{height:rs.heightAttr.stateValues.componentSize}}}},ts.cells={public:!0,shadowingInstructions:{createComponentOfType:"cell",returnWrappingComponents(rs){return rs==="cell"?[]:rs==="row"?[["row"]]:rs==="column"?[["column"]]:[["row"],["cellBlock"]]}},forRenderer:!0,isArray:!0,entryPrefixes:["cell","row","column","range","rows","columns"],nDimensions:2,defaultValueByArrayKey:()=>"",hasEssential:!0,shadowVariable:!0,stateVariablesDeterminingDependencies:["cellNamesByRowCol"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnEntryDimensions:rs=>["range","rows","columns"].includes(rs)?2:1,getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="cell"){let as,os,ls=/^([a-zA-Z]+)([1-9]\d*)$/,us=ns.match(ls);if(us)os=us[1],as=us[2];else{let ds=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(us=ns.match(ds),us)as=us[1],os=us[2];else return[]}let cs=normalizeIndex(as),ps=normalizeIndex(os);return cs>=0&&ps>=0?is&&!(cs<is[0]&&ps<is[1])?[]:[String(cs)+","+String(ps)]:[]}else if(rs==="row"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return[String(as)+",0"];if(!(as<is[0]))return[];let os=[],ls=String(as)+",";for(let us=0;us<is[1];us++)os.push(ls+us);return os}else if(rs==="column"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return["0,"+String(as)];if(!(as<is[1]))return[];let os=[],ls=","+String(as);for(let us=0;us<is[0];us++)os.push(us+ls);return os}else if(rs==="range"){let as,os,ls,us,cs=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,ps=ns.match(cs);if(ps)os=normalizeIndex(ps[1]),as=normalizeIndex(ps[2]),us=normalizeIndex(ps[3]),ls=normalizeIndex(ps[4]);else{let bs=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(ps=ns.match(bs),ps)as=normalizeIndex(ps[1]),os=normalizeIndex(ps[2]),ls=normalizeIndex(ps[3]),us=normalizeIndex(ps[4]);else return[]}if(!(as>=0&&ls>=0&&os>=0&&us>=0))return[];if(!is)return[String(as)+","+String(os)];let ds=Math.min(Math.min(as,ls),is[0]-1),fs=Math.min(Math.max(as,ls),is[0]-1),hs=Math.min(Math.min(os,us),is[1]-1),ys=Math.min(Math.max(os,us),is[1]-1),gs=[];for(let bs=ds;bs<=fs;bs++){let vs=[],Ns=String(bs)+",";for(let Ts=hs;Ts<=ys;Ts++)vs.push(Ns+Ts);gs.push(vs)}return gs}else{if(!is)return[String(0)+","+String(0)];let as=[];for(let os=0;os<is[0];os++){let ls=[],us=String(os)+",";for(let cs=0;cs<is[1];cs++)ls.push(us+cs);as.push(ls)}return as}},arrayVarNameFromArrayKey(rs){return"cell("+rs.split(",").map(ns=>Number(ns)+1).join(",")+")"},arrayVarNameFromPropIndex(rs,ns){if(ns==="cells"||ns==="rows")return rs.length===1?"row"+rs[0]:`cell(${rs[0]},${rs[1]})`;if(ns==="columns")return rs.length===1?"column"+rs[0]:`cell(${rs[1]},${rs[0]})`;if(ns.slice(0,3)==="row")return`cell(${ns.slice(3)},${rs[0]})`;if(ns.slice(0,6)==="column"){let is=ns.slice(6);return`cell(${rs[0]},${is})`}return null},returnArrayDependenciesByKey({stateValues:rs,arrayKeys:ns}){let is={},as=rs.cellNamesByRowCol;for(let ls of ns){let[us,cs]=ls.split(",");as[us]&&as[us][cs]&&(is[ls]={cellText:{dependencyType:"stateVariable",componentName:as[us][cs],variableName:"text",variablesOptional:!0}})}return{dependenciesByKey:is,globalDependencies:{dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["dataFrame","numRows","numColumns"]}}}},arrayDefinitionByKey({dependencyValuesByKey:rs,globalDependencyValues:ns,arrayKeys:is}){let as={},os={},ls=null,us,cs;ns.dataFrameChild.length>0&&(ls=ns.dataFrameChild[0],us=ls.stateValues.numRows,cs=ls.stateValues.numColumns);for(let ds of is){let[fs,hs]=ds.split(",");rs[ds].cellText!==void 0?as[ds]=rs[ds].cellText:fs<us&&hs<cs?as[ds]=ls.stateValues.dataFrame.data[fs][hs]:os[ds]=!0}let ps={};return Object.keys(as).length>0&&(ps.setValue={cells:as}),Object.keys(os).length>0&&(ps.useEssentialOrDefaultValue={cells:os}),ps},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,dependencyNamesByKey:ns}){let is=[];for(let as in rs.cells)if(ns[as].cellText!==void 0)is.push({setDependency:ns[as].cellText,desiredValue:rs.cells[as]});else{let os=rs.cells[as];is.push({setEssentialValue:"cells",value:{[as]:os===null?"":String(os)}})}return{success:!0,instructions:is}}},ts.evaluatedCells={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"cell",returnWrappingComponents(rs){return rs==="evaluatedCell"?[]:rs==="evaluatedRow"?[["row"]]:rs==="evaluatedColumn"?[["column"]]:[["row"],["cellBlock"]]}},entryPrefixes:["evaluatedCell","evaluatedRow","evaluatedColumn","evaluatedRange","evaluatedRows","evaluatedColumns"],nDimensions:2,stateVariablesDeterminingDependencies:["cellNamesByRowCol"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnEntryDimensions:rs=>["evaluatedRange","evaluatedRows","evaluatedColumns"].includes(rs)?2:1,getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="evaluatedCell"){let as,os,ls=/^([a-zA-Z]+)([1-9]\d*)$/,us=ns.match(ls);if(us)os=us[1],as=us[2];else{let ds=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(us=ns.match(ds),us)as=us[1],os=us[2];else return[]}let cs=normalizeIndex(as),ps=normalizeIndex(os);return cs>=0&&ps>=0?is&&!(cs<is[0]&&ps<is[1])?[]:[String(cs)+","+String(ps)]:[]}else if(rs==="evaluatedRow"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return[String(as)+",0"];if(!(as<is[0]))return[];let os=[],ls=String(as)+",";for(let us=0;us<is[1];us++)os.push(ls+us);return os}else if(rs==="evaluatedColumn"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return["0,"+String(as)];if(!(as<is[1]))return[];let os=[],ls=","+String(as);for(let us=0;us<is[0];us++)os.push(us+ls);return os}else if(rs==="evaluatedRange"){let as,os,ls,us,cs=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,ps=ns.match(cs);if(ps)os=normalizeIndex(ps[1]),as=normalizeIndex(ps[2]),us=normalizeIndex(ps[3]),ls=normalizeIndex(ps[4]);else{let bs=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(ps=ns.match(bs),ps)as=normalizeIndex(ps[1]),os=normalizeIndex(ps[2]),ls=normalizeIndex(ps[3]),us=normalizeIndex(ps[4]);else return[]}if(!(as>=0&&ls>=0&&os>=0&&us>=0))return[];if(!is)return[String(as)+","+String(os)];let ds=Math.min(Math.min(as,ls),is[0]-1),fs=Math.min(Math.max(as,ls),is[0]-1),hs=Math.min(Math.min(os,us),is[1]-1),ys=Math.min(Math.max(os,us),is[1]-1),gs=[];for(let bs=ds;bs<=fs;bs++){let vs=[],Ns=String(bs)+",";for(let Ts=hs;Ts<=ys;Ts++)vs.push(Ns+Ts);gs.push(vs)}return gs}else{if(!is)return[String(0)+","+String(0)];let as=[];for(let os=0;os<is[0];os++){let ls=[],us=String(os)+",";for(let cs=0;cs<is[1];cs++)ls.push(us+cs);as.push(ls)}return as}},arrayVarNameFromArrayKey(rs){return"evaluatedCell("+rs.split(",").map(ns=>Number(ns)+1).join(",")+")"},arrayVarNameFromPropIndex(rs,ns){if(ns==="evaluatedCells"||ns==="evaluatedRows")return rs.length===1?"evaluatedRow"+rs[0]:`evaluatedCell(${rs[0]},${rs[1]})`;if(ns==="evaluatedColumns")return rs.length===1?"evaluatedColumn"+rs[0]:`evaluatedCell(${rs[1]},${rs[0]})`;if(ns.slice(0,12)==="evaluatedRow")return`evaluatedCell(${ns.slice(12)},${rs[0]})`;if(ns.slice(0,15)==="evaluatedColumn"){let is=ns.slice(15);return`evaluatedCell(${rs[0]},${is})`}return null},returnArrayDependenciesByKey:()=>({globalDependencies:{cells:{dependencyType:"stateVariable",variableName:"cells"}}}),arrayDefinitionByKey({globalDependencyValues:rs}){let is=HyperFormula.buildFromArray(rs.cells,{licenseKey:"gpl-v3"}).getSheetValues(0),as={};for(let os in is){let ls=is[os];for(let us in ls)as[[os,us]]=ls[us]}return{setValue:{evaluatedCells:as}}}},ts.pointsInCells={isArray:!0,nDimensions:2,public:!0,shadowingInstructions:{createComponentOfType:"point"},entryPrefixes:["pointsInCell","pointsInRow","pointsInColumn","pointsInRange","pointsInRows","pointsInColumns"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numRows,rs.numColumns]},returnEntryDimensions:rs=>["pointsInRange","pointsInRows","pointsInColumns"].includes(rs)?2:1,getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="pointsInCell"){let as,os,ls=/^([a-zA-Z]+)([1-9]\d*)$/,us=ns.match(ls);if(us)os=us[1],as=us[2];else{let ds=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(us=ns.match(ds),us)as=us[1],os=us[2];else return[]}let cs=normalizeIndex(as),ps=normalizeIndex(os);return cs>=0&&ps>=0?is&&!(cs<is[0]&&ps<is[1])?[]:[String(cs)+","+String(ps)]:[]}else if(rs==="pointsInRow"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return[String(as),",0"];if(!(as>=0&&as<is[0]))return[];let os=[],ls=String(as)+",";for(let us=0;us<is[1];us++)os.push(ls+us);return os}else if(rs==="pointsInColumn"){let as=normalizeIndex(ns);if(!(as>=0))return[];if(!is)return["0,"+String(as)];if(!(as<is[1]))return[];let os=[],ls=","+String(as);for(let us=0;us<is[0];us++)os.push(us+ls);return os}else if(rs==="pointsInRange"){let as,os,ls,us,cs=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,ps=ns.match(cs);if(ps)os=normalizeIndex(ps[1]),as=normalizeIndex(ps[2]),us=normalizeIndex(ps[3]),ls=normalizeIndex(ps[4]);else{let bs=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(ps=ns.match(bs),ps)as=normalizeIndex(ps[1]),os=normalizeIndex(ps[2]),ls=normalizeIndex(ps[3]),us=normalizeIndex(ps[4]);else return[]}if(!(as>=0&&ls>=0&&os>=0&&us>=0))return[];if(!is)return[String(as)+","+String(os)];let ds=Math.min(Math.min(as,ls),is[0]-1),fs=Math.min(Math.max(as,ls),is[0]-1),hs=Math.min(Math.min(os,us),is[1]-1),ys=Math.min(Math.max(os,us),is[1]-1),gs=[];for(let bs=ds;bs<=fs;bs++){let vs=[],Ns=String(bs)+",";for(let Ts=hs;Ts<=ys;Ts++)vs.push(Ns+Ts);gs.push(vs)}return gs}else{if(!is)return[String(0)+","+String(0)];let as=[];for(let os=0;os<is[0];os++){let ls=[],us=String(os)+",";for(let cs=0;cs<is[1];cs++)ls.push(us+cs);as.push(ls)}return as}},arrayVarNameFromArrayKey(rs){return"pointsInCell("+rs.split(",").map(ns=>Number(ns)+1).join(",")+")"},arrayVarNameFromPropIndex(rs,ns){if(ns==="pointsInCells"||ns==="pointsInRows")return rs.length===1?"pointsInRow"+rs[0]:`pointsInCell(${rs[0]},${rs[1]})`;if(ns==="pointsInColumns")return rs.length===1?"pointsInColumn"+rs[0]:`pointsInCell(${rs[1]},${rs[0]})`;if(ns.slice(0,11)==="pointsInRow")return`pointsInCell(${ns.slice(11)},${rs[0]})`;if(ns.slice(0,14)==="pointsInColumn"){let is=ns.slice(14);return`pointsInCell(${rs[0]},${is})`}return null},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs){let as=is.split(",").map(os=>Number(os)+1).join(",");ns[is]={cellText:{dependencyType:"stateVariable",variableName:`evaluatedCell(${as})`,variablesOptional:!0}}}return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].cellText;if(!os){is[as]=null;continue}let ls;try{ls=Context.fromAst(textToAst.convert(os))}catch{is[as]=null;continue}Array.isArray(ls.tree)&&vectorOperators.includes(ls.tree[0])?is[as]=ls:is[as]=null}return{setValue:{pointsInCells:is}}}},ts}async onChange({changes:ts,source:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){if(ts){let os={};for(let ls of ts){let[us,cs,ps,ds]=ls;os[[us,cs]]=ds===null?"":ds}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"cells",value:os}],actionId:ns,sourceInformation:is,skipRendererUpdate:as,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:os}})}else this.coreFunctions.resolveAction({actionId:ns})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Spreadsheet,"componentType","spreadsheet");function determineCellMapping({cellRelatedChildren:ss,rowOffset:ts=0,colOffset:rs=0,cellNameToRowCol:ns={},cellNamesByRowCol:is=[],componentInfoObjects:as}){var os=ts,ls=rs,us=rs,cs=ts,ps=rs,ds=ts,fs=rs;for(let hs of ss)if(as.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:"cell"})){let ys=hs,gs=normalizeIndex(ys.stateValues.rowNum),bs=normalizeIndex(ys.stateValues.colNum);gs===void 0?(gs=os,bs===void 0?bs=us:bs=bs+rs):(gs=gs+ts,bs===void 0?bs=ls:bs=bs+rs),addCellToMapping({cell:ys,rowIndex:gs,colIndex:bs,cellNameToRowCol:ns,cellNamesByRowCol:is}),ds=Math.max(gs,ds),fs=Math.max(bs,fs),os=gs,ls=bs,us=bs+1}else if(as.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:"row"})){let ys=hs,gs=normalizeIndex(ys.stateValues.rowNum);gs===void 0?gs=cs:gs=gs+ts;let bs=ys.stateValues.prescribedCellsWithColNum,vs=rs;for(let Ns of bs){let Ts=normalizeIndex(Ns.stateValues.colNum);Ts===void 0?Ts=vs:Ts=Ts+rs,addCellToMapping({cell:Ns,rowIndex:gs,colIndex:Ts,cellNameToRowCol:ns,cellNamesByRowCol:is}),vs=Ts+1,ds=Math.max(gs,ds),fs=Math.max(Ts,fs)}cs=gs+1,os=gs+1,ls=rs,us=ls}else if(as.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:"column"})){let ys=hs,gs=normalizeIndex(ys.stateValues.colNum);gs===void 0?gs=ps:gs=gs+rs;let bs=ys.stateValues.prescribedCellsWithRowNum,vs=ts;for(let Ns of bs){let Ts=normalizeIndex(Ns.stateValues.rowNum);Ts===void 0?Ts=vs:Ts=Ts+ts,addCellToMapping({cell:Ns,rowIndex:Ts,colIndex:gs,cellNameToRowCol:ns,cellNamesByRowCol:is}),vs=Ts+1,ds=Math.max(Ts,ds),fs=Math.max(gs,fs)}ps=gs+1,os=ts,ls=gs+1,us=ls}else if(as.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:"cellBlock"})){let ys=hs,gs=normalizeIndex(ys.stateValues.rowNum),bs=normalizeIndex(ys.stateValues.colNum);gs===void 0?(gs=os,bs===void 0?bs=us:bs=bs+rs):(gs=gs+ts,bs===void 0?bs=ls:bs=bs+rs);let vs=determineCellMapping({cellRelatedChildren:ys.stateValues.prescribedCellsRowsColumnsBlocks,rowOffset:gs,colOffset:bs,cellNameToRowCol:ns,cellNamesByRowCol:is,componentInfoObjects:as});ds=Math.max(vs.maxRowIndex,ds),fs=Math.max(vs.maxColIndex,fs),os=gs,ls=bs,us=vs.maxColIndex+1}return{maxRowIndex:ds,maxColIndex:fs,cellNameToRowCol:ns,cellNamesByRowCol:is}}function addCellToMapping({cell:ss,rowIndex:ts,colIndex:rs,cellNameToRowCol:ns,cellNamesByRowCol:is}){if(ns[ss.componentName]=[ts,rs],is[ts]===void 0&&(is[ts]=[]),is[ts][rs]!==void 0){console.warn(`Cell is overwriting previous cell at rowNum=${ts+1}, colNum=${rs+1}`);let as=is[ts][rs];ns[as]=null}is[ts][rs]=ss.componentName}class DiscreteSimulationResultList extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{onChange:this.onChange.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},ts.minNumRows={createComponentOfType:"number",createStateVariable:"minNumRows",defaultValue:1,public:!0,forRenderer:!0},ts.minNumColumns={createComponentOfType:"number",createStateVariable:"minNumColumns",defaultValue:1,public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize"},ts.columnHeaders={createComponentOfType:"boolean",createStateVariable:"columnHeaders",defaultValue:!0,public:!0,forRenderer:!0},ts.rowHeaders={createComponentOfType:"boolean",createStateVariable:"rowHeaders",defaultValue:!0,public:!0,forRenderer:!0},ts.fixedRowsTop={createComponentOfType:"integer",createStateVariable:"fixedRowsTop",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},ts.fixedColumnsLeft={createComponentOfType:"integer",createStateVariable:"fixedColumnsLeft",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},ts.hiddenColumns={createComponentOfType:"numberList",createStateVariable:"hiddenColumns",defaultValue:[],public:!0,forRenderer:!0},ts.hiddenRows={createComponentOfType:"numberList",createStateVariable:"hiddenRows",defaultValue:[],public:!0,forRenderer:!0},ts.allIterates={createComponentOfType:"mathList",createStateVariable:"allIterates",defaultValue:[]},ts.headerRow={createComponentOfType:"textList",createStateVariable:"headerRow",defaultValue:null},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=rs.displayDigitsAttr===null||ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.cells={forRenderer:!0,shadowVariable:!0,returnDependencies:()=>({allIterates:{dependencyType:"stateVariable",variableName:"allIterates"},headerRow:{dependencyType:"stateVariable",variableName:"headerRow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition({dependencyValues:rs,usedDefault:ns}){let is=[],as=1,os=!1;if(rs.allIterates.length>0&&Array.isArray(rs.allIterates[0].tree)&&vectorOperators.includes(rs.allIterates[0].tree[0])&&(as=rs.allIterates[0].tree.length-1,os=!0),rs.headerRow){let ls=[],us=Math.min(rs.headerRow.length,as+1);for(let cs=0;cs<us;cs++)ls.push(rs.headerRow[cs]);is.push(ls)}for(let[ls,us]of rs.allIterates.entries()){let cs=[ls.toString()];for(let ps=0;ps<as;ps++){let ds=us;os&&(ds=ds.get_component(ps));let fs=roundForDisplay({value:ds,dependencyValues:rs,usedDefault:ns});try{cs.push(fs.toString())}catch{cs.push("")}}is.push(cs)}return{setValue:{cells:is}}}},ts.numRows={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cells:{dependencyType:"stateVariable",variableName:"cells"}}),definition({dependencyValues:rs}){let ns=rs.minNumRows;return Number.isFinite(ns)||(ns=4),ns=Math.max(ns,rs.cells.length),{setValue:{numRows:ns}}}},ts.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cells:{dependencyType:"stateVariable",variableName:"cells"}}),definition({dependencyValues:rs}){let ns=rs.minNumColumns;Number.isFinite(ns)||(ns=4);for(let is of rs.cells)is&&(ns=Math.max(ns,is.length));return{setValue:{numColumns:ns}}}},ts.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},forRenderer:!0,returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},numRows:{dependencyType:"stateVariable",variableName:"numRows"}}),definition({dependencyValues:rs}){if(rs.heightAttr===null){let ns;return Number.isFinite(rs.numRows)&&rs.numRows>=0?ns=50+rs.numRows*20:ns=130,{setValue:{height:{size:ns,isAbsolute:!0}}}}return{setValue:{height:rs.heightAttr.stateValues.componentSize}}}},ts}async onChange({changes:ts,source:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){if(ts){let os={};for(let ls of ts){let[us,cs,ps,ds]=ls;os[[us,cs]]=ds===null?"":ds}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"cells",value:os}],actionId:ns,sourceInformation:is,skipRendererUpdate:as,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:os}})}else this.coreFunctions.resolveAction({actionId:ns})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(DiscreteSimulationResultList,"componentType","DiscreteSimulationResultList"),Ms(DiscreteSimulationResultList,"rendererType","spreadsheet");class DiscreteSimulationResultPolyline extends GraphicalComponent{constructor(ts){super(ts),Object.assign(this.actions,{movePolyline:this.movePolyline.bind(this),finalizePolylinePosition:this.finalizePolylinePosition.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.allIterates={createComponentOfType:"mathList",createStateVariable:"allIteratesSub",defaultValue:[]},ts.seriesNumber={createComponentOfType:"number",createStateVariable:"seriesNumber",defaultValue:null},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var as;let ns;((as=rs.document)==null?void 0:as.stateValues.theme)==="dark"?ns=rs.selectedStyle.lineColorWordDarkMode:ns=rs.selectedStyle.lineColorWord;let is=rs.selectedStyle.lineWidthWord;return rs.selectedStyle.lineStyleWord&&(is&&(is+=" "),is+=rs.selectedStyle.lineStyleWord),is&&(is+=" "),is+=ns,{setValue:{styleDescription:is}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" polyline"}}}},ts.allIterates={returnDependencies:()=>({allIteratesSub:{dependencyType:"stateVariable",variableName:"allIteratesSub"}}),definition:function({dependencyValues:rs}){return{setValue:{allIterates:rs.allIteratesSub.filter(ns=>Number.isFinite(ns.tree)||Array.isArray(ns.tree)&&vectorOperators.includes(ns.tree[0])&&ns.tree.slice(1).every(Number.isFinite))}}}},ts.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}),definition:function({dependencyValues:rs}){return{setValue:{nVertices:rs.allIterates.length}}}},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:function({dependencyValues:rs}){return{setValue:{nDimensions:2}}}},ts.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents(rs){return rs==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]}},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="vertexX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="vertices")return rs.length===1?"vertex"+rs[0]:`vertexX${rs[0]}_${rs[1]}`;if(ns.slice(0,6)==="vertex"){let is=Number(ns.slice(6));if(Number.isInteger(is)&&is>0)return`vertexX${is}_${rs[0]}`}return null},getAllArrayKeys(rs,ns=!0,is){function as(os){if(os.length===1)return Array.from(Array(os[0]),(ls,us)=>String(us));{let ls=os[0],us=as(os.slice(1)),cs=[];for(let ps=0;ps<ls;ps++)ns?cs.push(...us.map(ds=>ps+","+ds)):cs.push(us.map(ds=>ps+","+ds));return cs}}if(is){if(is.length===0||!rs)return[];{let os=[...rs];return os[0]=is[0],as(os)}}else return!rs||rs.length===0?[]:as(rs)},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:rs}){return[rs.nVertices,2]},returnArrayDependenciesByKey(){return{globalDependencies:{seriesNumber:{dependencyType:"stateVariable",variableName:"seriesNumber"},allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arraySize:ns}){let is={};for(let as=0;as<ns[0];as++){is[`${as},0`]=Context.fromAst(as);let os=rs.allIterates[as];rs.seriesNumber!==null&&(os=os.get_component(rs.seriesNumber-1)),is[`${as},1`]=os}return{setValue:{vertices:is}}}},ts.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:rs}){return[rs.nVertices]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(is)+1)}};return{dependenciesByKey:ns}},arrayDefinitionByKey({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=rs[as].vertex.map(ls=>ls.evaluate_to_constant());os.every(ls=>Number.isFinite(ls))||(os=Array(os.length).fill(NaN)),is[as]=os}return{setValue:{numericalVertices:is}}}},ts.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:rs}){var ds,fs,hs,ys;let ns=rs.nDimensions,is=rs.nVertices,as=rs.numericalVertices,os=[],ls,us,cs=(ds=as[0])==null?void 0:ds[0],ps=(fs=as[0])==null?void 0:fs[1];for(let gs=1;gs<is;gs++)if(ls=cs,us=ps,cs=(hs=as[gs])==null?void 0:hs[0],ps=(ys=as[gs])==null?void 0:ys[1],!(Number.isFinite(ls)&&Number.isFinite(us)&&Number.isFinite(cs)&&Number.isFinite(ps)))os.push(null);else{let bs=cs-ls,vs=ps-us;bs===0&&vs===0?os.push(null):os.push([bs,vs])}return{setValue:{nearestPoint:function({variables:gs,scales:bs}){var Vs,Is;let vs=bs[0],Ns=bs[1];if(ns!==2||is===0)return{};let Ts=1/0,Cs={},xs=(Vs=gs.x1)==null?void 0:Vs.evaluate_to_constant(),As=(Is=gs.x2)==null?void 0:Is.evaluate_to_constant(),ws,Es,Ss=as[0][0],Ds=as[0][1];for(let Os=1;Os<is;Os++){ws=Ss,Es=Ds,Ss=as[Os][0],Ds=as[Os][1];let Ps=os[Os-1];if(Ps===null)continue;let $s=Ps[0]/vs,Rs=Ps[1]/Ns,ks=$s*$s+Rs*Rs,_s=((xs-ws)/vs*$s+(As-Es)/Ns*Rs)/ks,Bs;_s<=0?Bs={x1:ws,x2:Es}:_s>=1?Bs={x1:Ss,x2:Ds}:Bs={x1:ws+_s*$s*vs,x2:Es+_s*Rs*Ns};let Us=Math.pow((xs-Bs.x1)/vs,2)+Math.pow((As-Bs.x2)/Ns,2);Us<Ts&&(Ts=Us,Cs=Bs)}return gs.x3!==void 0&&Object.keys(Cs).length>0&&(Cs.x3=0),Cs}}}}},ts}async movePolyline({pointCoords:ts,transient:rs,sourceDetails:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){let ls={};for(let us in ts)ls[us+",0"]=Context.fromAst(ts[us][0]),ls[us+",1"]=Context.fromAst(ts[us][1]);return rs?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:ls,sourceDetails:ns}],transient:!0,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:ls,sourceDetails:ns}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:ts}}})}async finalizePolylinePosition({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.actions.movePolyline({pointCoords:await this.stateValues.numericalVertices,transient:!1,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}Ms(DiscreteSimulationResultPolyline,"componentType","discreteSimulationResultPolyline"),Ms(DiscreteSimulationResultPolyline,"rendererType","polyline");class Cell extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},ts.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},ts.colSpan={createComponentOfType:"integer",createStateVariable:"colSpan",defaultValue:1,public:!0,forRenderer:!0},ts.halign={createComponentOfType:"text"},ts.bottom={createComponentOfType:"text"},ts.right={createComponentOfType:"text"},ts.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.halign={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"left",returnDependencies:()=>({halignAttr:{dependencyType:"attributeComponent",attributeName:"halign",variableNames:["value"]},parentHalign:{dependencyType:"parentStateVariable",variableName:"halign"},tabularHalign:{dependencyType:"ancestor",componentType:"tabular",variableNames:["halign"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.halignAttr!==null){let is=rs.halignAttr.stateValues.value;return["left","center","right","justify"].includes(is)||(is="left"),{setValue:{halign:is}}}else return!ns.parentHalign&&rs.parentHalign?{setValue:{halign:rs.parentHalign}}:!ns.tabularHalign&&rs.tabularHalign?{setValue:{halign:rs.tabularHalign.stateValues.halign}}:{useEssentialOrDefaultValue:{halign:!0}}}},ts.bottom={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"none",returnDependencies:()=>({bottomAttr:{dependencyType:"attributeComponent",attributeName:"bottom",variableNames:["value"]},parentBottom:{dependencyType:"parentStateVariable",variableName:"bottom"},tabularBottom:{dependencyType:"ancestor",componentType:"tabular",variableNames:["bottom"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.bottomAttr!==null){let is=rs.bottomAttr.stateValues.value;return["none","minor","medium","major"].includes(is)||(is="none"),{setValue:{bottom:is}}}else return!ns.parentBottom&&rs.parentBottom?{setValue:{bottom:rs.parentBottom}}:!ns.tabularBottom&&rs.tabularBottom?{setValue:{bottom:rs.tabularBottom.stateValues.bottom}}:{useEssentialOrDefaultValue:{bottom:!0}}}},ts.right={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"none",returnDependencies:()=>({rightAttr:{dependencyType:"attributeComponent",attributeName:"right",variableNames:["value"]},tabularRight:{dependencyType:"ancestor",componentType:"tabular",variableNames:["right"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.rightAttr!==null){let is=rs.rightAttr.stateValues.value;return["none","minor","medium","major"].includes(is)||(is="none"),{setValue:{right:is}}}else return!ns.tabularRight&&rs.tabularRight?{setValue:{right:rs.tabularRight.stateValues.right}}:{useEssentialOrDefaultValue:{right:!0}}}},ts.inHeader={public:!0,shadowingInstructions:{createComponentOfType:"booloean"},forRenderer:!0,defaultValue:!1,returnDependencies:()=>({parentHeader:{dependencyType:"parentStateVariable",variableName:"header"}}),definition({dependencyValues:rs}){return{setValue:{inHeader:rs.parentHeader===!0}}}},ts.onlyMathChild={returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"]},otherChildren:{dependencyType:"child",childGroups:["anything"]}}),definition:({dependencyValues:rs})=>({setValue:{onlyMathChild:rs.mathChild.length===1&&rs.otherChildren.length===0}})},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({children:{dependencyType:"child",childGroups:["maths","anything"],variableNames:["text"],variablesOptional:!0},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition({dependencyValues:rs}){if(rs.children.length===0)return{useEssentialOrDefaultValue:{text:{defaultValue:rs.prefill}}};let ns="";for(let is of rs.children)typeof is=="object"?is.stateValues.text&&(ns+=is.stateValues.text):ns+=is.toString();return{setValue:{text:ns}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.children.length===0?{success:!0,instructions:[{setEssentialValue:"text",value:rs.text===null?"":String(rs.text)}]}:ns.children.length===1?typeof ns.children[0]=="object"&&ns.children[0].stateValues.text===void 0?{success:!1}:{success:!0,instructions:[{setDependency:"children",desiredValue:rs.text,childIndex:0,variableIndex:0}]}:{success:!1}}},ts.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["onlyMathChild"],returnDependencies({stateValues:rs}){return rs.onlyMathChild?{mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}:{text:{dependencyType:"stateVariable",variableName:"text"}}},definition({dependencyValues:rs}){if(rs.mathChild)return{setValue:{math:rs.mathChild[0].stateValues.value}};{let ns;try{ns=Context.fromAst(textToAst.convert(rs.text))}catch{ns=Context.fromAst("")}return{setValue:{math:ns}}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is,workspace:as}){return ns.mathChild?{success:!0,instructions:[{setDependency:"mathChild",desiredValue:rs.math,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"text",desiredValue:(await preprocessMathInverseDefinition({desiredValue:rs.math,stateValues:is,variableName:"math",workspace:as})).desiredValue.toString()}]}}},ts.number={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({math:{dependencyType:"stateVariable",variableName:"math"}}),definition({dependencyValues:rs}){return{setValue:{number:rs.math.evaluate_to_constant()}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setDependency:"math",desiredValue:Context.fromAst(rs.number)}]}}},ts}}Ms(Cell,"componentType","cell"),Ms(Cell,"rendererType","cell"),Ms(Cell,"renderChildren",!0),Ms(Cell,"includeBlankStringChildren",!0),Ms(Cell,"primaryStateVariableForDefinition","text"),Ms(Cell,"adapters",["text","math","number"]);class Row extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},ts.header={createComponentOfType:"boolean",createStateVariable:"header",defaultValue:!1,public:!0,forRenderer:!0},ts.halign={createComponentOfType:"text"},ts.valign={createComponentOfType:"text"},ts.left={createComponentOfType:"text"},ts.bottom={createComponentOfType:"text"},ts}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.halign={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"left",hasEssential:!0,returnDependencies:()=>({halignAttr:{dependencyType:"attributeComponent",attributeName:"halign",variableNames:["value"]},parentHalign:{dependencyType:"parentStateVariable",variableName:"halign"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.halignAttr!==null){let is=rs.halignAttr.stateValues.value;return["left","center","right","justify"].includes(is)||(is="left"),{setValue:{halign:is}}}else return rs.parentHalign!==null&&!ns.parentHalign?{setValue:{halign:rs.parentHalign}}:{useEssentialOrDefaultValue:{halign:!0}}}},ts.valign={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"middle",hasEssential:!0,returnDependencies:()=>({valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},parentValign:{dependencyType:"parentStateVariable",variableName:"valign"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.valignAttr!==null){let is=rs.valignAttr.stateValues.value;return["top","middle","bottom"].includes(is)||(is="middle"),{setValue:{valign:is}}}else return rs.parentValign!==null&&!ns.parentValign?{setValue:{valign:rs.parentValign}}:{useEssentialOrDefaultValue:{valign:!0}}}},ts.left={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"none",hasEssential:!0,returnDependencies:()=>({leftAttr:{dependencyType:"attributeComponent",attributeName:"left",variableNames:["value"]},parentLeft:{dependencyType:"parentStateVariable",variableName:"left"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.leftAttr!==null){let is=rs.leftAttr.stateValues.value;return["none","minor","medium","major"].includes(is)||(is="none"),{setValue:{left:is}}}else return rs.parentLeft!==null&&!ns.parentLeft?{setValue:{left:rs.parentLeft}}:{useEssentialOrDefaultValue:{left:!0}}}},ts.bottom={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"none",hasEssential:!0,returnDependencies:()=>({bottomAttr:{dependencyType:"attributeComponent",attributeName:"bottom",variableNames:["value"]},parentBottom:{dependencyType:"parentStateVariable",variableName:"bottom"}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.bottomAttr!==null){let is=rs.bottomAttr.stateValues.value;return["none","minor","medium","major"].includes(is)||(is="none"),{setValue:{bottom:is}}}else return rs.parentBottom!==null&&!ns.parentBottom?{setValue:{bottom:rs.parentBottom}}:{useEssentialOrDefaultValue:{bottom:!0}}}},ts.prescribedCellsWithColNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childGroups:["cells"],variableNames:["colNum"]}}),definition({dependencyValues:rs}){return{setValue:{prescribedCellsWithColNum:rs.cellChildren}}}},ts}}Ms(Row,"componentType","row"),Ms(Row,"rendererType","row"),Ms(Row,"renderChildren",!0);class Column extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},ts}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.prescribedCellsWithRowNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childGroups:["cells"],variableNames:["rowNum"]}}),definition({dependencyValues:rs}){return{setValue:{prescribedCellsWithRowNum:rs.cellChildren}}}},ts}}Ms(Column,"componentType","column"),Ms(Column,"rendererType","containerBlock"),Ms(Column,"renderChildren",!0);class CellBlock extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},ts.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},ts}static returnChildGroups(){return[{group:"children",componentTypes:["cell","row","column","cellblock"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.prescribedCellsRowsColumnsBlocks={returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childGroups:["children"],variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:rs}){return{setValue:{prescribedCellsRowsColumnsBlocks:rs.cellRelatedChildren}}}},ts}}Ms(CellBlock,"componentType","cellBlock"),Ms(CellBlock,"rendererType","containerBlock");class Tabular extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:null,public:!0,forRenderer:!0},ts.halign={createComponentOfType:"text",createStateVariable:"halign",defaultValue:"left",public:!0,validValues:["left","center","right","justify"]},ts.valign={createComponentOfType:"text",createStateVariable:"valign",defaultValue:"middle",public:!0,validValues:["top","middle","bottom"]},ts.top={createComponentOfType:"text",createStateVariable:"top",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"],forRenderer:!0},ts.left={createComponentOfType:"text",createStateVariable:"left",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},ts.bottom={createComponentOfType:"text",createStateVariable:"bottom",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},ts.right={createComponentOfType:"text",createStateVariable:"right",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},ts}static returnChildGroups(){return[{group:"rows",componentTypes:["row"]}]}static returnStateVariableDefinitions(){return super.returnStateVariableDefinitions()}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Tabular,"componentType","tabular"),Ms(Tabular,"rendererType","tabular"),Ms(Tabular,"renderChildren",!0);class Table extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.suppressTableNameInTitle={createComponentOfType:"boolean",createStateVariable:"suppressTableNameInTitle",defaultValue:!1,forRenderer:!0},ts.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!0,forRenderer:!0},ts}static returnChildGroups(){return[{group:"titles",componentTypes:["title"]},{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.tableEnumeration={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],additionalStateVariablesDefined:[{variableName:"tableName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies({stateValues:rs}){let ns={};return rs.number&&(ns.tableCounter={dependencyType:"counter",counterName:"table"}),ns},definition({dependencyValues:rs}){if(rs.tableCounter===void 0)return{setValue:{tableEnumeration:null,tableName:"Table"}};let ns=String(rs.tableCounter),is="Table "+ns;return{setValue:{tableEnumeration:ns,tableName:is}}}},ts.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition({dependencyValues:rs}){let ns=null;return rs.titleChild.length>0&&(ns=rs.titleChild[0].componentName),{setValue:{titleChildName:ns}}}},ts.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]}}),definition({dependencyValues:rs}){let ns=null;return rs.titleChild.length>0&&(ns=rs.titleChild[0].stateValues.text),{setValue:{title:ns}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Table,"componentType","table"),Ms(Table,"renderChildren",!0);class Figure extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.suppressFigureNameInCaption={createComponentOfType:"boolean",createStateVariable:"suppressFigureNameInCaption",defaultValue:!1,forRenderer:!0},ts.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!0,forRenderer:!0},ts}static returnChildGroups(){return[{group:"captions",componentTypes:["caption"]},{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.figureEnumeration={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],additionalStateVariablesDefined:[{variableName:"figureName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies({stateValues:rs}){let ns={};return rs.number&&(ns.figureCounter={dependencyType:"counter",counterName:"figure"}),ns},definition({dependencyValues:rs}){if(rs.figureCounter===void 0)return{setValue:{figureEnumeration:null,figureName:"Figure"}};let ns=String(rs.figureCounter),is="Figure "+ns;return{setValue:{figureEnumeration:ns,figureName:is}}}},ts.captionChildName={forRenderer:!0,returnDependencies:()=>({captionChild:{dependencyType:"child",childGroups:["captions"]}}),definition({dependencyValues:rs}){let ns=null;return rs.captionChild.length>0&&(ns=rs.captionChild[0].componentName),{setValue:{captionChildName:ns}}}},ts.caption={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({captionChild:{dependencyType:"child",childGroups:["captions"],variableNames:["text"]}}),definition({dependencyValues:rs}){let ns=null;return rs.captionChild.length>0&&(ns=rs.captionChild[0].stateValues.text),{setValue:{caption:ns}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Figure,"componentType","figure"),Ms(Figure,"renderChildren",!0);class TextListFromString extends InlineComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:ns.reduce(function(as,os){return typeof os=="string"?[...as,...os.split(/\s+/).filter(ls=>ls)]:[...as,os]},[])}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition:function({dependencyValues:rs}){return{setValue:{nComponents:rs.stringChildren.length}}}},ts.texts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["text"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs}){let ns={};for(let is of rs)ns[is]={stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"],childIndices:[is]}};return{dependenciesByKey:ns}},arrayDefinitionByKey:function({dependencyValuesByKey:rs,arrayKeys:ns}){let is={};for(let as of ns)rs[as].stringChild.length===1&&(is[as]=rs[as].stringChild[0]);return{setValue:{texts:is}}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"texts"},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.texts.join(", ")}})},ts}}Ms(TextListFromString,"componentType","textListFromString"),Ms(TextListFromString,"rendererType","asList"),Ms(TextListFromString,"renderChildren",!0),Ms(TextListFromString,"stateVariableForAttributeValue","texts");class VariantControl extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.nVariants={createPrimitiveOfType:"integer"},ts.uniqueVariants={createPrimitiveOfType:"boolean"},ts.variantsToInclude={createComponentOfType:"textListFromString"},ts.variantsToExclude={createComponentOfType:"textListFromString"},ts.variantNames={createComponentOfType:"textListFromString"},ts.seeds={createComponentOfType:"textListFromString"},ts}}Ms(VariantControl,"componentType","variantControl"),Ms(VariantControl,"rendererType");class SelectFromSequence extends Sequence{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},ts.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},ts.sortResults={createComponentOfType:"boolean",createStateVariable:"sortResults",defaultValue:!1,public:!0},ts.excludeCombinations={createComponentOfType:"_componentListOfListsWithSelectableType"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();ts.excludedCombinations={returnDependencies:()=>({excludeCombinations:{dependencyType:"attributeComponent",attributeName:"excludeCombinations",variableNames:["lists"]},type:{dependencyType:"stateVariable",variableName:"type"},numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"}}),definition:function({dependencyValues:ns}){if(ns.excludeCombinations!==null){let is=ns.excludeCombinations.stateValues.lists.map(as=>as.slice(0,ns.numberToSelect)).filter(as=>as.length===ns.numberToSelect);if(ns.type==="number")for(;;){let as=mergeContainingCombinations(is);if(as.merged)is=as.combinations;else break}return{setValue:{excludedCombinations:is}}}else return{setValue:{excludedCombinations:[]}}}},ts.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:ns}){return{setValue:{variants:ns.variants}}}},ts.selectedValues={immutable:!0,hasEssential:!0,shadowVariable:!0,additionalStateVariablesDefined:[{variableName:"selectedIndices",hasEssential:!0,shadowVariable:!0,immutable:!0}],returnDependencies:({sharedParameters:ns})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},excludedCombinations:{dependencyType:"stateVariable",variableName:"excludedCombinations"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"},sortResults:{dependencyType:"stateVariable",variableName:"sortResults"},variants:{dependencyType:"stateVariable",variableName:"variants"},variantRng:{dependencyType:"value",value:ns.variantRng,doNotProxy:!0}}),definition:makeSelection},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition({dependencyValues:ns,componentName:is}){return{setValue:{generatedVariantInfo:{indices:ns.selectedIndices,meta:{createdBy:is}}}}}};let rs=ts.readyToExpandWhenResolved.returnDependencies;return ts.readyToExpandWhenResolved.returnDependencies=function(){let ns=rs();return ns.selectedValues={dependencyType:"stateVariable",variableName:"selectedValues"},ns},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns}){var ps;let is=await ts.stateValues.type;is==="letters"&&(is="text");let as=(ps=ts.attributes.newNamespace)==null?void 0:ps.primitive,os={};for(let ds of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])ds in ts.attributes&&(os[ds]=ts.attributes[ds]);let ls={};Object.keys(os).length>0&&(ls=convertAttributesForComponentType({attributes:os,componentType:is,componentInfoObjects:rs,compositeCreatesNewNamespace:as,flags:ns}));let us=[];for(let ds of await ts.stateValues.selectedValues)us.push({componentType:is,attributes:ls,state:{value:ds,fixed:!0}});return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:us,parentName:ts.componentName,parentCreatesNewNamespace:as,componentInfoObjects:rs}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:ts}){var Ns,Ts,Cs,xs,As,ws,Es,Ss,Ds,Vs,Is,Os,Ps,$s;let rs=1,ns=!1,is=ts.attributes.type.primitive,as=(Ns=ts.attributes.numberToSelect)==null?void 0:Ns.component;if(as)if(as.componentType==="integer"&&((Ts=as.children)==null?void 0:Ts.length)===1&&typeof as.children[0]=="string"){if(rs=Number(as.children[0]),!(Number.isInteger(rs)&&rs>=0))return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't a non-negative integer."),{success:!1}}else return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't constant number."),{success:!1};let os=(Cs=ts.attributes.withReplacement)==null?void 0:Cs.component;if(os)if(os.componentType==="boolean")if(((xs=os.children)==null?void 0:xs.length)===1&&typeof os.children[0]=="string")ns=os.children[0].toLowerCase()==="true";else if((os.children===void 0||os.children.length===0)&&typeof((As=os.state)==null?void 0:As.value)=="boolean")ns=os.state.value;else return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};else return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};let ls={from:null,to:null,step:null,length:null},us=(ws=ts.attributes.from)==null?void 0:ws.component;if(us){let Rs=us.children[0];if(((Es=Rs.children)==null?void 0:Es.length)===1&&typeof Rs.children[0]=="string"){let ks;if(is==="number"){if(ks=Number(Rs.children[0]),!Number.isFinite(ks))return console.log("cannot determine unique variants of selectFromSequence of number type as from isn't a number."),{success:!1}}else if(is==="letters"){if(ks=lettersToNumber$1(Rs.children[0]),!Number.isFinite(ks))return console.log("cannot determine unique variants of selectFromSequence of letters type as from isn't a combination of letters."),{success:!1}}else{let _s=getFromText({functionSymbols:["f","g"]});try{ks=_s(Rs.children[0])}catch{return console.log("cannot determine unique variants of selectFromSequence of math type as from isn't a valid math expression."),{success:!1}}}ls.from=ks}else return console.log("cannot determine unique variants of selectFromSequence as from isn't a constant."),{success:!1}}let cs=(Ss=ts.attributes.to)==null?void 0:Ss.component;if(cs){let Rs=cs.children[0];if(((Ds=Rs.children)==null?void 0:Ds.length)===1&&typeof Rs.children[0]=="string"){let ks;if(is==="number"){if(ks=Number(Rs.children[0]),!Number.isFinite(ks))return console.log("cannot determine unique variants of selectFromSequence of number type as to isn't a number."),{success:!1}}else if(is==="letters"){if(ks=lettersToNumber$1(Rs.children[0]),!Number.isFinite(ks))return console.log("cannot determine unique variants of selectFromSequence of letters type as to isn't a combination of letters."),{success:!1}}else{let _s=getFromText({functionSymbols:["f","g"]});try{ks=_s(Rs.children[0])}catch{return console.log("cannot determine unique variants of selectFromSequence of math type as to isn't a valid math expression."),{success:!1}}}ls.to=ks}else return console.log("cannot determine unique variants of selectFromSequence as to isn't a constant."),{success:!1}}let ps=(Vs=ts.attributes.step)==null?void 0:Vs.component;if(ps)if(((Is=ps.children)==null?void 0:Is.length)===1&&typeof ps.children[0]=="string"){let Rs;if(is==="number"){if(Rs=Number(ps.children[0]),!Number.isFinite(Rs))return console.log("cannot determine unique variants of selectFromSequence of number type as step isn't a number."),{success:!1}}else if(is==="letters"){if(Rs=Number(ps.children[0]),!Number.isInteger(Rs))return console.log("cannot determine unique variants of selectFromSequence of letters type as step isn't an integer."),{success:!1}}else{let ks=getFromText({functionSymbols:["f","g"]});try{Rs=ks(ps.children[0])}catch{return console.log("cannot determine unique variants of selectFromSequence of math type as step isn't a valid math expression."),{success:!1}}}ls.step=Rs}else return console.log("cannot determine unique variants of selectFromSequence as step isn't a constant."),{success:!1};let ds=(Os=ts.attributes.length)==null?void 0:Os.component;if(ds)if(((Ps=ds.children)==null?void 0:Ps.length)===1&&typeof ds.children[0]=="string"){let Rs=Number(ds.children[0]);if(!Number.isInteger(Rs))return console.log("cannot determine unique variants of selectFromSequence as length isn't an integer."),{success:!1};ls.length=Rs}else return console.log("cannot determine unique variants of selectFromSequence as length isn't a constant."),{success:!1};if(ts.attributes.excludeCombinations)return console.log("have not implemented unique variants of a selectFromSequence with excludeCombinations"),{success:!1};let fs=[],hs=($s=ts.attributes.exclude)==null?void 0:$s.component;if(hs){if(is==="math")return console.log("have not implemented unique variants of a selectFromSequence of type math with exclude"),{success:!1};if(!hs.children.every(Rs=>{var ks;return((ks=Rs.children)==null?void 0:ks.length)===1&&typeof Rs.children[0]=="string"}))return console.log("have not implemented unique variants of a selectFromSequence with non-constant exclude"),{success:!1};if(is==="letters"?fs=hs.children.map(Rs=>lettersToNumber$1(Rs.children[0])):fs=hs.children.map(Rs=>Number(Rs.children[0])),!fs.every(Number.isFinite))return console.log("have not implemented unique variants of a selectFromSequence with non-constant exclude"),{success:!1}}ls=calculateSequenceParameters(ls);let ys=ls.length,gs=[];if(fs.length>0&&is!=="math"){fs.sort((Rs,ks)=>Rs-ks),fs=fs.filter((Rs,ks,_s)=>Rs!=_s[ks-1]);for(let Rs of fs){if(Rs<ls.from)continue;let ks=(Rs-ls.from)/ls.step;if(ks>ls.length-1+1e-10)break;Math.abs(ks-Math.round(ks))<1e-10&&(ys--,gs.push(ks))}}if(ys<=0)return{success:!1};let bs={excludeIndices:gs,nOptions:ys,numberToSelect:rs,withReplacement:ns};ts.variants.uniqueVariantData=bs;let vs;if(ns||rs===1)vs=Math.pow(ys,rs);else{vs=ys;for(let Rs=ys-1;Rs>ys-rs;Rs--)vs*=Rs}return ts.variants.numberOfVariants=vs,{success:!0,numberOfVariants:vs}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs}){var fs;let ns=(fs=ts.variants)==null?void 0:fs.numberOfVariants;if(ns===void 0)return{success:!1};if(!Number.isInteger(rs)||rs<1||rs>ns)return{success:!1};let is=ts.variants.uniqueVariantData,as=is.excludeIndices,os=is.nOptions,ls=is.numberToSelect,us=is.withReplacement,cs=function(hs){let ys=hs;for(let gs of as)ys>=gs&&ys++;return ys};return ls===1?{success:!0,desiredVariant:{indices:[cs(rs-1)+1]}}:{success:!0,desiredVariant:{indices:enumerateSelectionCombinations({numberOfIndices:ls,numberOfOptions:os,maxNumber:rs,withReplacement:us})[rs-1].map(cs).map(hs=>hs+1)}}}}Ms(SelectFromSequence,"componentType","selectFromSequence"),Ms(SelectFromSequence,"assignNamesToReplacements",!0),Ms(SelectFromSequence,"createsVariants",!0);function makeSelection({dependencyValues:ss}){if(ss.numberToSelect<1)return{setEssentialValue:{selectedValues:[],selectedIndices:[]},setValue:{selectedValues:[],selectedIndices:[]}};let ts=1;if(ss.withReplacement||(ts=ss.numberToSelect),ts>ss.length)throw Error("Cannot select "+ts+" values from a sequence of length "+ss.length);if(ss.variants&&ss.variants.desiredVariant!==void 0){let as=ss.variants.desiredVariant.indices;if(as!==void 0){if(as.length!==ss.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(as=as.map(Number),!as.every(Number.isInteger))throw Error("All indices specified for select must be integers");let os=ss.length;as=as.map(us=>((us-1)%os+os)%os+1);let ls=[];for(let us of as){let cs=returnSequenceValueForIndex({index:us-1,from:ss.from,step:ss.step,length:ss.length,exclude:ss.exclude,type:ss.type,lowercase:ss.lowercase});if(cs===null)throw Error("Specified index of selectfromsequence that was excluded");ls.push(cs)}if(checkForExcludedCombination({type:ss.type,excludedCombinations:ss.excludedCombinations,values:ls}))throw Error("Specified indices of selectfromsequence that was an excluded combination");return{setEssentialValue:{selectedValues:ls,selectedIndices:as},setValue:{selectedValues:ls,selectedIndices:as}}}}let rs=ss.excludedCombinations.length;if(ss.type==="number"){rs=0;let as=ss.length-ss.exclude.length;for(let os of ss.excludedCombinations){let ls=os.reduce((us,cs)=>us+(Number.isNaN(cs)?1:0),0);if(ls>0)if(ss.withReplacement)rs+=Math.pow(as,ls);else{let us=as-ss.numberToSelect+ls,cs=us;for(let ps=1;ps<ls;ps++)cs*=us-ps;rs+=cs}else rs+=1}}let ns,is;if(rs===0){let as=selectValuesAndIndices({stateValues:ss,numberUniqueRequired:ts,numberToSelect:ss.numberToSelect,withReplacement:ss.withReplacement,rng:ss.variantRng});ns=as.selectedValues,is=as.selectedIndices}else{let as=ss.length-ss.exclude.length;if(ss.withReplacement)as=Math.pow(as,ss.numberToSelect);else{let ls=as;for(let us=1;us<ss.numberToSelect;us++)as*=ls-us}if(rs>.7*as){let ls=0;for(let us=0;us<ss.length;us++)returnSequenceValueForIndex({index:us,from:ss.from,step:ss.step,length:ss.length,exclude:ss.exclude,type:ss.type})!==null&&ls++;if(ss.withReplacement)ls=Math.pow(ls,ss.numberToSelect);else{let us=ls;for(let cs=1;cs<ss.numberToSelect;cs++)ls*=us-cs}if(rs>.7*ls)if(ss.type==="number"&&ss.excludedCombinations.some(us=>us.some(Number.isNaN))){let us=estimateNumberOfDuplicateCombinations(ss.excludedCombinations,ss.length-ss.exclude.length,ss.withReplacement);if(rs-=us,rs>.7*ls)throw Error("Excluded over 70% of combinations in selectFromSequence")}else throw Error("Excluded over 70% of combinations in selectFromSequence")}let os=!1;for(let ls=0;ls<200;ls++){let us=selectValuesAndIndices({stateValues:ss,numberUniqueRequired:ts,numberToSelect:ss.numberToSelect,withReplacement:ss.withReplacement,rng:ss.variantRng});if(ns=us.selectedValues,is=us.selectedIndices,!checkForExcludedCombination({type:ss.type,excludedCombinations:ss.excludedCombinations,values:ns})){os=!0;break}}if(!os)throw Error("By extremely unlikely fluke, couldn't select combination of random values")}if(ss.sortResults){let as=[];for(let[os,ls]of ns.entries())as.push({value:ls,index:is[os]});ss.type==="number"?as.sort((os,ls)=>os.value-ls.value):ss.type==="letters"&&as.sort((os,ls)=>lettersToNumber$1(os.value)-lettersToNumber$1(ls.value)),ns=as.map(os=>os.value),is=as.map(os=>os.index)}return{setEssentialValue:{selectedValues:ns,selectedIndices:is},setValue:{selectedValues:ns,selectedIndices:is}}}function selectValuesAndIndices({stateValues:ss,numberUniqueRequired:ts=1,numberToSelect:rs=1,withReplacement:ns=!1,rng:is}){let as=[],os=[];if(ss.exclude.length+ts<.5*ss.length){for(let ps=0;ps<rs;ps++){let ds=!1,fs,hs;for(let ys=0;ys<100;ys++){let gs=is();if(hs=Math.floor(gs*ss.length)+1,!(!ns&&os.includes(hs))&&(fs=returnSequenceValueForIndex({index:hs-1,from:ss.from,step:ss.step,exclude:ss.exclude,type:ss.type,lowercase:ss.lowercase}),fs!==null)){ds=!0;break}}if(!ds)throw Error("By extremely unlikely fluke, couldn't select random value");as.push(fs),os.push(hs)}return{selectedValues:as,selectedIndices:os}}let ls=returnSequenceValues(ss,!0),us=ls.length;if(ts>us)throw Error("Cannot select "+ts+" unique values from sequence of length "+us);if(ts===1){for(let ps=0;ps<rs;ps++){let ds=is(),fs=Math.floor(ds*us);os.push(ls[fs].originalIndex+1),as.push(ls[fs].value)}return{selectedValues:as,selectedIndices:os}}for(let ps=ls.length-1;ps>0;ps--){const ds=is(),fs=Math.floor(ds*(ps+1));[ls[ps],ls[fs]]=[ls[fs],ls[ps]]}let cs=ls.slice(0,rs);return as=cs.map(ps=>ps.value),os=cs.map(ps=>ps.originalIndex+1),{selectedValues:as,selectedIndices:os}}function checkForExcludedCombination({type:ss,excludedCombinations:ts,values:rs}){return ss==="math"?ts.some(ns=>ns.every((is,as)=>is.equals(rs[as]))):ss==="number"?ts.some(ns=>ns.every((is,as)=>Number.isNaN(is)||Math.abs(is-rs[as])<=1e-14*Math.max(Math.abs(is),Math.abs(rs[as])))):ts.some(ns=>ns.every((is,as)=>is===rs[as]))}function mergeContainingCombinations(ss){if(ss.length===0)return{merged:!1,combinations:[]};let ts=[ss[0]],rs=!1;for(let ns of ss.slice(1)){let is=[],as=!1;for(let os of ts){if(as){is.push(os);continue}let ls=[];as=!0;let us=null;for(let cs=0;cs<ns.length;cs++){let ps=ns[cs],ds=os[cs];if(Number.isNaN(ps))if(Number.isNaN(ds))ls.push(NaN);else if(us===2){as=!1;break}else ls.push(NaN),us=1;else if(Number.isNaN(ds))if(us===1){as=!1;break}else ls.push(NaN),us=2;else if(ps===ds)ls.push(ps);else{as=!1;break}}as?is.push(ls):is.push(os)}as?rs=!0:is.push(ns),ts=is}return{merged:rs,combinations:ts}}function estimateNumberOfDuplicateCombinations(ss,ts,rs){let ns=ss.length;if(ns===0)return 0;let is=[];for(let os=0;os<ns;os++){let ls=ss[os];for(let us=os+1;us<ns;us++){let cs=ss[us],ps=!0,ds=[];for(let fs=0;fs<ls.length;fs++){let hs=ls[fs],ys=cs[fs];if(Number.isNaN(hs))Number.isNaN(ys)?ds.push(NaN):ds.push(ys);else if(Number.isNaN(ys))ds.push(hs);else if(hs===ys)ds.push(hs);else{ps=!1;break}}if(ps)if(rs)is.push(ds);else{let fs=ds.filter(hs=>!Number.isNaN(hs));[...new Set(fs)].length===fs.length&&is.push(ds)}}}for(;;){let os=mergeContainingCombinations(is);if(os.merged)is=os.combinations;else break}let as=0;if(is.length>0)for(let os of is){let ls=os.reduce((us,cs)=>us+(Number.isNaN(cs)?1:0),0);if(ls>0)if(rs)as+=Math.pow(ts,ls);else{let us=ts-os.length+ls,cs=us;for(let ps=1;ps<ls;ps++)cs*=us-ps;as+=cs}else as+=1}return as-=estimateNumberOfDuplicateCombinations(is,ts,rs),as}class Select extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},ts.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},ts.type={createPrimitiveOfType:"string"},ts.addLevelToAssignNames={createPrimitiveOfType:"boolean",createStateVariable:"addLevelToAssignNames",defaultValue:!1},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions();function rs({matchedChildren:ns,componentAttributes:is,componentInfoObjects:as}){if(!ns.every(cs=>typeof cs=="string"||cs.doenetAttributes&&cs.doenetAttributes.createdFromMacro))return{success:!1};let os;is.type?os=is.type:os="math",["math","text","number","boolean"].includes(os)||(console.warn(`Invalid type ${os}`),os="math");let us=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:os,forceComponentType:!0})({matchedChildren:ns,componentInfoObjects:as});return us.success?{success:!0,newChildren:us.newChildren.map(ds=>({componentType:"option",children:[ds]})),newAttributes:{addLevelToAssignNames:{primitive:!0}}}:{success:!1}}return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"options",componentTypes:["option"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:rs}){return{setValue:{variants:rs.variants}}}},ts.currentVariantName={returnDependencies:({sharedParameters:rs})=>({variantName:{dependencyType:"value",value:rs.variantName}}),definition:({dependencyValues:rs})=>({setValue:{currentVariantName:rs.variantName}})},ts.allVariantNames={returnDependencies:({sharedParameters:rs})=>({allVariantNames:{dependencyType:"value",value:rs.allVariantNames}}),definition:({dependencyValues:rs})=>({setValue:{allVariantNames:rs.allVariantNames}})},ts.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childGroups:["options"],variableNames:["selectForVariants","selectWeight"]}}),definition({dependencyValues:rs}){return{setValue:{optionChildren:rs.optionChildren,nOptions:rs.optionChildren.length}}}},ts.availableVariants={returnDependencies:()=>({optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},allVariantNames:{dependencyType:"stateVariable",variableName:"allVariantNames"}}),definition:function({dependencyValues:rs}){let ns={};for(let[is,as]of rs.optionChildren.entries())for(let os of as.stateValues.selectForVariants){let ls=os.toLowerCase();ns[ls]===void 0&&(ns[ls]=[]),ns[ls].push(is+1)}for(let is in ns)if(ns[is].length!==rs.numberToSelect)throw Error("Invalid variant name for select.  Variant name "+is+" appears in "+ns[is].length+" options but number to select is "+numberToSelect);if(Object.keys(ns).length>0){for(let is of rs.allVariantNames)if(!(is in ns))throw Error("Some variants are specified for select but no options are specified for possible variant name: "+is);for(let is in ns)if(!rs.allVariantNames.includes(is))throw Error("Variant name "+is+" that is specified for select is not a possible variant name.")}return{setValue:{availableVariants:ns}}}},ts.selectedIndices={immutable:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:({sharedParameters:rs})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},currentVariantName:{dependencyType:"stateVariable",variableName:"currentVariantName"},variants:{dependencyType:"stateVariable",variableName:"variants"},availableVariants:{dependencyType:"stateVariable",variableName:"availableVariants"},variantRng:{dependencyType:"value",value:rs.variantRng,doNotProxy:!0}}),definition:function({dependencyValues:rs}){if(!(rs.numberToSelect>=1)||rs.nOptions===0)return{setEssentialValue:{selectedIndices:[]},setValue:{selectedIndices:[]}};if(rs.variants&&rs.variants.desiredVariant!==void 0){let ps=rs.variants.desiredVariant.indices;if(ps!==void 0){if(ps.length!==rs.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(ps=ps.map(Number),!ps.every(Number.isInteger))throw Error("All indices specified for select must be integers");let ds=rs.nOptions;return ps=ps.map(fs=>((fs-1)%ds+ds)%ds+1),{setEssentialValue:{selectedIndices:ps},setValue:{selectedIndices:ps}}}}let ns=rs.availableVariants[rs.currentVariantName];if(ns!==void 0){if(rs.numberToSelect>1){ns=[...ns];for(let ps=rs.numberToSelect-1;ps>0;ps--){const ds=rs.variantRng(),fs=Math.floor(ds*(ps+1));[ns[ps],ns[fs]]=[ns[fs],ns[ps]]}}return{setEssentialValue:{selectedIndices:ns},setValue:{selectedIndices:ns}}}let is=[],as=1;if(rs.withReplacement||(as=rs.numberToSelect),as>rs.nOptions)throw Error("Cannot select "+as+" components from only "+rs.nOptions);let os=rs.optionChildren.map(ps=>ps.stateValues.selectWeight),ls=os.reduce((ps,ds)=>ps+ds);os=os.map(ps=>ps/ls);let us=os.reduce((ps,ds,fs)=>[...ps,ds+(ps[fs-1]||0)],[]),cs=[...Array(us.length).keys()].map(ps=>ps+1);for(let ps=0;ps<rs.numberToSelect;ps++){let ds=rs.variantRng(),fs=-1,hs=us.length-1;for(;fs<hs-1;){let gs=Math.floor((fs+hs)/2);us[gs]>ds?hs=gs:fs=gs}let ys=cs[hs];is.push(ys),!rs.withReplacement&&ps<rs.numberToSelect-1&&(os.splice(hs,1),cs.splice(hs,1),ls=os.reduce((gs,bs)=>gs+bs),os=os.map(gs=>gs/ls),us=os.reduce((gs,bs,vs)=>[...gs,bs+(gs[vs-1]||0)],[]))}return{setEssentialValue:{selectedIndices:is},setValue:{selectedIndices:is}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={providePreviousValuesInDefinition:!0,returnDependencies:({componentInfoObjects:rs})=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(rs.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns,previousValues:is}){let as={indices:rs.selectedIndices,meta:{createdBy:ns}},os=as.subvariants=[];for(let ls of rs.variantDescendants)ls.stateValues.isVariantComponent?os.push(ls.stateValues.generatedVariantInfo):ls.stateValues.generatedVariantInfo&&os.push(...ls.stateValues.generatedVariantInfo.subvariants);for(let[ls,us]of os.entries())if(!us.subvariants&&is.generatedVariantInfo){let cs=is.generatedVariantInfo.subvariants;cs[ls].subvariants&&(os[ls]=Object.assign({},os[ls]),os[ls].subvariants=cs[ls].subvariants)}return{setValue:{generatedVariantInfo:as}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns}){var ps,ds,fs;let is=[],as=await ts.stateValues.optionChildren;for(let hs of await ts.stateValues.selectedIndices){let ys=as[hs-1].componentName,gs=rs[ys],bs=deepClone(await gs.stateValues.serializedChildren),vs={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},gs.doenetAttributes),children:bs,originalName:ys};gs.attributes.newNamespace&&(vs.attributes={newNamespace:{primitive:!0}}),is.push(vs)}let os=gatherVariantComponents({serializedComponents:is,componentInfoObjects:ns});if(ts.variants&&ts.variants.desiredVariant!==void 0){let hs=ts.variants.desiredVariant;if(hs!==void 0&&hs.subvariants!==void 0)for(let ys in hs.subvariants){let gs=hs.subvariants[ys],bs=os[ys];if(bs===void 0)break;bs.variants.desiredVariant=gs}}let ls=(ps=ts.attributes.newNamespace)==null?void 0:ps.primitive,us=ts.doenetAttributes.assignNames;us&&await ts.stateValues.addLevelToAssignNames&&(us=us.map(hs=>[hs]));for(let hs of is)!((fs=(ds=hs.attributes)==null?void 0:ds.newNamespace)!=null&&fs.primitive)&&hs.children&&markToCreateAllUniqueNames(hs.children);let cs=[];for(let[hs,ys]of is.entries()){let gs=processAssignNames({assignNames:us,serializedComponents:[ys],parentName:ts.componentName,parentCreatesNewNamespace:ls,componentInfoObjects:ns,indOffset:hs});cs.push(gs.serializedComponents[0])}return{replacements:cs}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){var ds,fs,hs,ys,gs,bs,vs,Ns;let ns=(ds=ts.variants)==null?void 0:ds.numberOfVariants;if(ns!==void 0)return{success:!0,numberOfVariants:ns};let is=1,as=!1,os=(fs=ts.attributes.numberToSelect)==null?void 0:fs.component;if(os)if(os.componentType==="integer"&&((hs=os.children)==null?void 0:hs.length)===1&&typeof os.children[0]=="string"){if(is=Number(os.children[0]),!(Number.isInteger(is)&&is>=0))return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't a non-negative integer."),{success:!1}}else return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't constant number."),{success:!1};let ls=(ys=ts.attributes.withReplacement)==null?void 0:ys.component;if(ls)if(ls.componentType==="boolean")if(((gs=ls.children)==null?void 0:gs.length)===1&&typeof ls.children[0]=="string")as=ls.children[0].toLowerCase()==="true";else if((ls.children===void 0||ls.children.length===0)&&typeof((bs=ls.state)==null?void 0:bs.value)=="boolean")as=ls.state.value;else return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};else return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};for(let Ts of ts.children)if((vs=Ts.attributes)!=null&&vs.selectWeight||(Ns=Ts.attributes)!=null&&Ns.selectForVariants)return console.log("Unique variants for select disabled if have an option with selectWeight or selectForVariants specified"),{success:!1};ts.variants===void 0&&(ts.variants={});let us=gatherVariantComponents({serializedComponents:ts.children,componentInfoObjects:rs});ts.variants.descendantVariantComponents=us;let cs=[];for(let Ts of us){let xs=rs.allComponentClasses[Ts.componentType].determineNumberOfUniqueVariants({serializedComponent:Ts,componentInfoObjects:rs});if(!xs.success)return{success:!1};cs.push(xs.numberOfVariants)}let ps={numberOfVariantsByChild:cs,numberToSelect:is,withReplacement:as};if(cs.length===0)ns=1;else if(as||is===1){let Ts=cs.reduce((Cs,xs)=>Cs+xs);ns=Math.pow(Ts,is)}else{let Ts=cs.length;if(is>Ts)return{success:!1};let Cs=cs[0];if(cs.slice(1).every(As=>As===Cs)){let As=Ts;for(let ws=Ts-1;ws>Ts-is;ws--)As*=ws;ns=As*Math.pow(Cs,is)}else ns=countOptions(cs,is)}return ts.variants.numberOfVariants=ns,ts.variants.uniqueVariants=!0,ts.variants.uniqueVariantData=ps,{success:!0,numberOfVariants:ns}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){var Ss;let is=(Ss=ts.variants)==null?void 0:Ss.numberOfVariants;if(is===void 0)return{success:!1};if(!Number.isInteger(rs)||rs<1||rs>is)return{success:!1};let as=ts.variants.uniqueVariantData,os=as.numberOfVariantsByChild,ls=as.numberToSelect,us=as.withReplacement,cs=ts.children.length,ps=ts.children;if(os.length===0)return{success:!0,desiredVariant:{indices:[]}};let ds;ls===1?ds=[...Array(cs).keys()].map(Ds=>[Ds]):ds=enumerateSelectionCombinations({numberOfIndices:ls,numberOfOptions:cs,withReplacement:us});let fs=ds.length,hs=ds.map(Ds=>({combination:Ds,numberOfPossibilities:Ds.reduce((Vs,Is)=>Vs*os[Is],1)})),ys=[...Array(fs).keys()],gs=0,bs=ys.length,vs,Ns,Ts=rs-1;for(;bs>0;){let Vs=ys.map(Is=>hs[Is]).reduce((Is,Os)=>Math.min(Is,Os.numberOfPossibilities),1/0)-gs;if(Ts<Vs*bs){vs=ys[Ts%bs],Ns=gs+Math.floor(Ts/bs)+1;break}else gs+=Vs,Ts-=Vs*bs,ys=ys.filter(Is=>hs[Is].numberOfPossibilities>gs),bs=ys.length}let Cs=ds[vs],xs=enumerateCombinations({numberOfOptionsByIndex:Cs.map(Ds=>os[Ds]),maxNumber:Ns})[Ns-1].map(Ds=>Ds+1),As=[],ws=!1;for(let[Ds,Vs]of Cs.entries())if(os[Vs]>1){let Is=ps[Vs],Ps=ns.allComponentClasses[Is.componentType].getUniqueVariant({serializedComponent:Is,variantIndex:xs[Ds],componentInfoObjects:ns});if(!Ps.success)return{success:!1};As.push(Ps.desiredVariant),ws=!0}else As.push({});let Es={indices:Cs.map(Ds=>Ds+1)};return ws&&(Es.subvariants=As),{success:!0,desiredVariant:Es}}}Ms(Select,"componentType","select"),Ms(Select,"assignNamesToReplacements",!0),Ms(Select,"createsVariants",!0),Ms(Select,"includeBlankStringChildren",!0),Ms(Select,"removeBlankStringChildrenPostSugar",!0);let countOptions=function(ss,ts){if(ts===0)return 0;if(ts===1)return ss.reduce((ns,is)=>ns+is);let rs=0;for(let ns in ss){let is=ss[ns],as=[...ss];as.splice(ns,1),rs+=is*countOptions(as,ts-1)}return rs};class AnimateFromSequence extends BaseComponent{constructor(ts){super(ts),Object.assign(this.actions,{changedAnimationOn:this.changedAnimationOn.bind(this),advanceAnimation:this.advanceAnimation.bind(this),startAnimation:this.startAnimation.bind(this),stopAnimation:this.stopAnimation.bind(this),toggleAnimation:this.toggleAnimation.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject(),rs=returnStandardSequenceAttributes();return Object.assign(ts,rs),ts.prop={createPrimitiveOfType:"string"},ts.componentIndex={createComponentOfType:"integer",createStateVariable:"componentIndex",defaultValue:null,public:!0},ts.propIndex={createComponentOfType:"numberList",createStateVariable:"propIndex",defaultValue:null,public:!0},ts.animationOn={createComponentOfType:"boolean",createStateVariable:"animationOn",defaultValue:!1,public:!0,triggerActionOnChange:"changedAnimationOn"},ts.animationMode={createComponentOfType:"text",createStateVariable:"animationMode",defaultValue:"increase",validValues:["increase","decrease","increase once","decrease once","oscillate"],toLowerCase:!0,public:!0},ts.animationInterval={createComponentOfType:"number",createStateVariable:"animationInterval",defaultValue:1e3,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnStandardSequenceStateVariableDefinitions();return Object.assign(ts,rs),ts.possibleValues={additionalStateVariablesDefined:["numberValues"],returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition({dependencyValues:ns}){let is=returnSequenceValues(ns);return{setValue:{possibleValues:is,numberValues:is.length}}}},ts.selectedIndex={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{selectedIndex:!0}}},async inverseDefinition({desiredStateVariableValues:ns,stateValues:is}){return{success:!0,instructions:[{setEssentialValue:"selectedIndex",value:Context.math.mod(ns.selectedIndex-1,await is.numberValues)+1}]}}},ts.value={public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({possibleValues:{dependencyType:"stateVariable",variableName:"possibleValues"},selectedIndex:{dependencyType:"stateVariable",variableName:"selectedIndex"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:ns}){return{setValue:{value:ns.possibleValues[ns.selectedIndex-1]},setCreateComponentOfType:{value:ns.type}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as}){if(is.type==="number"){let os=ns.value;if(os instanceof Context.class&&(os=os.evaluate_to_constant()),!Number.isFinite(os))return{success:!1};let ls=-1,us=is.possibleValues.length-1;for(;ls<us-1;){let ps=Math.floor((ls+us)/2);await as.step*(is.possibleValues[ps]-os)>0?us=ps:ls=ps}let cs=us;return ls!==-1&&Math.abs(os-is.possibleValues[ls])<Math.abs(os-is.possibleValues[us])&&(cs=ls),{success:!0,instructions:[{setDependency:"selectedIndex",desiredValue:cs+1}]}}else{let os=ns.value,ls=is.possibleValues.indexOf(os);return ls===-1?{success:!1}:{success:!0,instructions:[{setDependency:"selectedIndex",desiredValue:ls+1}]}}}},ts.currentAnimationDirection={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,returnDependencies:()=>({animationMode:{dependencyType:"stateVariable",variableName:"animationMode"}}),definition({dependencyValues:ns}){return{useEssentialOrDefaultValue:{currentAnimationDirection:{get defaultValue(){return ns.animationMode.substring(0,8)==="decrease"?"decrease":"increase"}}}}},inverseDefinition({desiredStateVariableValues:ns}){let is=ns.currentAnimationDirection.toLowerCase();return["increase","decrease"].includes(is)||(is="increase"),{success:!0,instructions:[{setEssentialValue:"currentAnimationDirection",value:is}]}}},ts.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:ns})=>({setValue:{target:ns.target}})},ts.targetComponent={returnDependencies(){return{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:ns}){let is=null;return ns.targetComponent&&(is=ns.targetComponent),{setValue:{targetComponent:is}}}},ts.propName={returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:ns}){return{setValue:{propName:ns.propName}}}},ts.targetIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:ns,componentInfoObjects:is}){let as={};return ns.targetComponent!==null&&(is.isCompositeComponent({componentType:ns.targetComponent.componentType,includeNonStandard:!1})?as.targets={dependencyType:"replacement",compositeName:ns.targetComponent.componentName,recursive:!0,componentIndex:ns.componentIndex}:(ns.componentIndex===null||ns.componentIndex===1)&&(as.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),as},definition({dependencyValues:ns}){let is=null;return ns.targets&&(is=ns.targets,Array.isArray(is)||(is=[is])),{setValue:{targetIdentities:is}}}},ts.targets={stateVariablesDeterminingDependencies:["targetIdentities","propName","propIndex"],returnDependencies:function({stateValues:ns}){let is={targetIdentities:{dependencyType:"stateVariable",variableName:"targetIdentities"}};if(ns.targetIdentities!==null)for(let[as,os]of ns.targetIdentities.entries()){let ls;if(ns.propName){let us=ns.propIndex;us&&(us=[...us]),ls={dependencyType:"stateVariable",componentName:os.componentName,variableName:ns.propName,returnAsComponentObject:!0,variablesOptional:!0,propIndex:us,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}}else ls={dependencyType:"stateVariable",componentName:os.componentName,variableName:"value",returnAsComponentObject:!0,variablesOptional:!0};is["target"+as]=ls}return is},definition({dependencyValues:ns}){let is=null;if(ns.targetIdentities!==null){is=[];for(let as in ns.targetIdentities)ns["target"+as]&&is.push(ns["target"+as])}return{setValue:{targets:is}}}},ts.valueToIndex={returnDependencies:()=>({possibleValues:{dependencyType:"stateVariable",variableName:"possibleValues"}}),definition:function({dependencyValues:ns}){let is={};for(let[as,os]of ns.possibleValues.entries())is[os]=as;return{setValue:{valueToIndex:is}}}},ts}async changedAnimationOn({stateValues:ts,previousValues:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){let os=[];if(ts.animationOn)if(rs.animationOn)this.coreFunctions.resolveAction({actionId:ns});else{let ls=await this.stateValues.currentAnimationDirection,us=await this.stateValues.animationMode,cs=await this.stateValues.numberValues,ps=await this.stateValues.selectedIndex,ds=await this.findIndexFromTarget();ls==="increase"?ds===cs&&(us==="increase once"?ds=1:us==="oscillate"&&(ls="decrease",os.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:ls}))):ls==="decrease"&&ds===1&&(us==="decrease once"?ds=cs:us==="oscillate"&&(ls="increase",os.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:ls}))),ds!==ps&&os.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedIndex",value:ds});let fs=await this.getUpdateInstructionsToSetTargetsToValue((await this.stateValues.possibleValues)[Context.math.mod(ds-1,cs)]);os.push(...fs),await this.coreFunctions.performUpdate({updateInstructions:os,actionId:ns,sourceInformation:is,skipRendererUpdate:!0,event:{verb:"played",object:{componentName:this.componentName,componentType:this.componentType},context:{startIndex:ds,animationDirection:ls,animationMode:us}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ns,sourceInformation:is,skipRendererUpdate:as}),this.animationId=nanoid(),await this.coreFunctions.requestAnimationFrame({action:{actionName:"advanceAnimation",componentName:this.componentName},delay:await this.stateValues.animationInterval,animationId:this.animationId,actionArgs:{previousAnimationId:this.animationId}})}else rs.animationOn?(await this.coreFunctions.cancelAnimationFrame(this.animationId),this.canceledAnimationId=this.animationId,await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ns,sourceInformation:is,skipRendererUpdate:as}),this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType},context:{endIndex:await this.stateValues.selectedIndex}})):this.coreFunctions.resolveAction({actionId:ns})}async findIndexFromTarget(){let ts=await this.stateValues.targets,rs=await this.stateValues.selectedIndex;if(ts===null)return rs;let ns=ts[0],is;if(ns!=null&&ns.stateValues&&(is=Object.keys(ns.stateValues)[0]),!is)return rs;let as=ns.stateValues[is],os=await this.stateValues.type;if(os==="number"&&as instanceof Context.class&&(as=as.evaluate_to_constant(),!Number.isFinite(as)))return rs;let ls=(await this.stateValues.valueToIndex)[as];if(ls!==void 0)return ls+1;if(os!=="number")return rs;let us=await this.stateValues.possibleValues,cs=function(ds=0,fs=us.length-1){if(fs<=ds+1)return as>us[ds]?fs:ds;let hs=Math.round((fs+ds)/2);return as>us[hs]?cs(hs,fs):cs(ds,hs)},ps=cs();if(ps!==0){let ds=us[ps-1],fs=us[ps],hs=Math.abs(as-ds),ys=Math.abs(as-fs);hs<ys&&ps--}return ps+1}async advanceAnimation({previousAnimationId:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=await this.stateValues.animationOn;if(ts===this.canceledAnimationId||!as){this.coreFunctions.resolveAction({actionId:rs});return}let os,ls=!0,us,cs=await this.stateValues.animationMode,ps=await this.findIndexFromTarget();await this.stateValues.currentAnimationDirection==="decrease"?(os=ps-1,os<=1&&(cs==="decrease once"?ls=!1:cs==="oscillate"&&(us="increase"))):(os=ps+1,os>=await this.stateValues.numberValues&&(cs==="increase once"?ls=!1:cs==="oscillate"&&(us="decrease")));let ds=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedIndex",value:os}],fs=await this.getUpdateInstructionsToSetTargetsToValue((await this.stateValues.possibleValues)[Context.math.mod(os-1,await this.stateValues.numberValues)]);ds.push(...fs),ls||ds.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!1}),us&&ds.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:us}),await this.coreFunctions.performUpdate({updateInstructions:ds,actionId:rs,sourceInformation:ns,skipRendererUpdate:is}),ls&&(this.animationId=nanoid(),await this.coreFunctions.requestAnimationFrame({action:{actionName:"advanceAnimation",componentName:this.componentName},delay:await this.stateValues.animationInterval,animationId:this.animationId,actionArgs:{previousAnimationId:this.animationId}}))}startAnimation({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!0}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}stopAnimation({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!1}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}async toggleAnimation({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!await this.stateValues.animationOn}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}async getUpdateInstructionsToSetTargetsToValue(ts){let rs=await this.stateValues.targets;if(rs==null)return[];let ns=[];for(let is of rs){let as=Object.keys(is.stateValues)[0];if(as===void 0){await this.stateValues.propName?console.warn(`Cannot animate prop="${await this.stateValues.propName}" of ${await this.stateValues.target} as could not find prop ${await this.stateValues.propName} on a component of type ${is.componentType}`):console.warn(`Cannot animate ${await this.stateValues.target} as could not find a value state variable on a component of type ${is.componentType}`);continue}ns.push({updateType:"updateValue",componentName:is.componentName,stateVariable:as,value:ts})}return ns}}Ms(AnimateFromSequence,"componentType","animateFromSequence"),Ms(AnimateFromSequence,"rendererType"),Ms(AnimateFromSequence,"acceptTarget",!0);class Evaluate extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},ts.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},ts.function={createComponentOfType:"function"},ts.input={createComponentOfType:"mathList"},ts.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},ts}static returnChildGroups(){return[]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.codePre,delete ts.expressionWithCodes,delete ts.mathChildrenFunctionSymbols,delete ts.codesAdjacentToStrings,delete ts.mathChildrenByVectorComponent,delete ts.mathChildrenWithCanBeModified,delete ts.unordered,ts.canBeModified={returnDependencies:()=>({}),definition:()=>({setValue:{canBeModified:!1}})},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displayDigits"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}else if(rs.functionAttr){let is=ns.functionAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.functionAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<=os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.functionAttr.stateValues.displayDigits}}}:{setValue:{displayDigits:rs.functionAttr.stateValues.displayDigits}}}else return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displayDecimals"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.displayDecimalsAttr!==null?{setValue:{displayDecimals:rs.displayDecimalsAttr.stateValues.value}}:rs.functionAttr?ns.functionAttr?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:rs.functionAttr.stateValues.displayDecimals}}}:{setValue:{displayDecimals:rs.functionAttr.stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displaySmallAsZero"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.displaySmallAsZeroAttr!==null?{setValue:{displaySmallAsZero:rs.displaySmallAsZeroAttr.stateValues.value}}:rs.functionAttr?ns.functionAttr?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:rs.functionAttr.stateValues.displaySmallAsZero}}}:{setValue:{displaySmallAsZero:rs.functionAttr.stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["padZeros"]}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.padZerosAttr!==null?{setValue:{padZeros:rs.padZerosAttr.stateValues.value}}:rs.functionAttr?ns.functionAttr?{useEssentialOrDefaultValue:{padZeros:{defaultValue:rs.functionAttr.stateValues.padZeros}}}:{setValue:{padZeros:rs.functionAttr.stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.inputMaths={returnDependencies:()=>({inputAttr:{dependencyType:"attributeComponent",attributeName:"input",variableNames:["maths"]}}),definition({dependencyValues:rs}){return rs.inputAttr?{setValue:{inputMaths:rs.inputAttr.stateValues.maths}}:{setValue:{inputMaths:[]}}}},ts.unnormalizedValue={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies(){return{inputMaths:{dependencyType:"stateVariable",variableName:"inputMaths"},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","numericalfs","symbolic","nInputs"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}}},definition({dependencyValues:rs}){let ns=rs.functionAttr;if(!ns)return{setValue:{unnormalizedValue:Context.fromAst("")}};let is;return!rs.forceNumeric&&(ns.stateValues.symbolic||rs.forceSymbolic)?is=returnSymbolicFunctionForEvaluate({nInputs:ns.stateValues.nInputs,symbolicfs:ns.stateValues.symbolicfs}):is=returnNumericFunctionForEvaluate({nInputs:ns.stateValues.nInputs,numericalfs:ns.stateValues.numericalfs}),{setValue:{unnormalizedValue:is(rs.inputMaths)}}}},ts.formula={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies(){return{inputMaths:{dependencyType:"stateVariable",variableName:"inputMaths"},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","nInputs"]}}},definition({dependencyValues:rs}){let ns=rs.functionAttr;return ns?{setValue:{formula:returnSymbolicFunctionForEvaluate({nInputs:ns.stateValues.nInputs,symbolicfs:ns.stateValues.symbolicfs})(rs.inputMaths)}}:{setValue:{formula:Context.fromAst("")}}}},ts.fReevaluate={returnDependencies(){return{functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","numericalfs","symbolic","nInputs"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}}},definition({dependencyValues:rs}){let ns=rs.functionAttr;if(!ns)return{setValue:{fReevaluate:as=>Context.fromAst("")}};let is;return!rs.forceNumeric&&(ns.stateValues.symbolic||rs.forceSymbolic)?is=returnSymbolicFunctionForEvaluate({nInputs:ns.stateValues.nInputs,symbolicfs:ns.stateValues.symbolicfs}):is=returnNumericFunctionForEvaluate({nInputs:ns.stateValues.nInputs,numericalfs:ns.stateValues.numericalfs}),{setValue:{fReevaluate:is}}}},ts.fReevaluateDefinition={returnDependencies(){return{functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["fDefinitions","symbolic","nInputs"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}}},definition({dependencyValues:rs}){let ns=rs.functionAttr;if(!ns)return{setValue:{fReevaluateDefinition:{}}};let is;return!rs.forceNumeric&&(ns.stateValues.symbolic||rs.forceSymbolic)?is={functionType:"numericForEvaluate",nInputs:ns.stateValues.nInputs,fDefinitions:ns.stateValues.fDefinitions}:is={functionType:"numericForEvaluate",nInputs:ns.stateValues.nInputs,fDefinitions:ns.stateValues.fDefinitions},{setValue:{fReevaluateDefinition:is}}}},ts}}Ms(Evaluate,"componentType","evaluate"),Ms(Evaluate,"rendererType","math"),Ms(Evaluate,"variableForPlainMacro");function sampleFromRandomNumbers({type:ss,numberOfSamples:ts,standardDeviation:rs,mean:ns,to:is,from:as,step:os,nDiscreteValues:ls,rng:us}){if(ss==="gaussian"){if(!(rs>=0)||!Number.isFinite(ns)){let ps="Invalid mean ("+ns+") or standard deviation ("+rs+") for a gaussian random variable.";return console.warn(ps),Array(ts).fill(NaN)}let cs=[];for(let ps=0;ps<ts;ps++){let ds=0,fs=0;for(;ds===0;)ds=us();for(;fs===0;)fs=us();let hs=Math.sqrt(-2*Math.log(ds))*Math.cos(2*Math.PI*fs);cs.push(ns+rs*hs)}return cs}else if(ss==="uniform"){let cs=[],ps=is-as;for(let ds=0;ds<ts;ds++)cs.push(as+us()*ps);return cs}else{let cs=[];if(ls>0)for(let ps=0;ps<ts;ps++){let ds=Math.floor(us()*ls);cs.push(as+os*ds)}return cs}}class SampleRandomNumbers extends CompositeComponent{constructor(ts){super(ts),Object.assign(this.actions,{resample:this.resample.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.numberOfSamples={createComponentOfType:"number",createStateVariable:"numberOfSamples",defaultValue:1,public:!0},ts.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:"uniform",public:!0,toLowerCase:!0,validValues:["uniform","discreteuniform","gaussian"]},ts.mean={createComponentOfType:"number",createStateVariable:"specifiedMean",defaultValue:0},ts.standardDeviation={createComponentOfType:"number",createStateVariable:"specifiedStandardDeviation",defaultValue:1},ts.variance={createComponentOfType:"number",createStateVariable:"specifiedVariance",defaultValue:1},ts.from={createComponentOfType:"number",createStateVariable:"specifiedFrom",defaultValue:null},ts.to={createComponentOfType:"number",createStateVariable:"specifiedTo",defaultValue:null},ts.step={createComponentOfType:"number",createStateVariable:"specifiedStep",defaultValue:1},ts.displayDigits={leaveRaw:!0},ts.displayDecimals={leaveRaw:!0},ts.displaySmallAsZero={leaveRaw:!0},ts.padZeros={leaveRaw:!0},ts.variantDeterminesSeed={createComponentOfType:"boolean",createStateVariable:"variantDeterminesSeed",defaultValue:!1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.step={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"}}),definition({dependencyValues:rs}){let ns;return rs.type==="discreteuniform"?ns=rs.specifiedStep:ns=null,{setValue:{step:ns}}}},ts.from={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"to",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"nDiscreteValues"}],returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},step:{dependencyType:"stateVariable",variableName:"step"}}),definition({dependencyValues:rs}){if(!["discreteuniform","uniform"].includes(rs.type))return{setValue:{from:null,to:null,nDiscreteValues:null}};let ns=rs.step,is=rs.specifiedFrom,as=rs.specifiedTo,os=null;return as===null?(is===null&&(is=0),rs.type==="uniform"?as=is+1:(as=is+ns,os=2)):is===null?rs.type==="uniform"?is=0:(os=Math.floor((as-0)/ns+1),os<1?(os=0,is=null):is=as-(os-1)*ns):rs.type==="discreteuniform"&&(os=Math.floor((as-is)/ns+1),os<1?os=0:as=is+(os-1)*ns),{setValue:{from:is,to:as,nDiscreteValues:os}}}},ts.mean={stateVariablesDeterminingDependencies:["type"],public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({stateValues:rs}){let ns={type:{dependencyType:"stateVariable",variableName:"type"}};return rs.type==="gaussian"?ns.specifiedMean={dependencyType:"stateVariable",variableName:"specifiedMean"}:(ns.from={dependencyType:"stateVariable",variableName:"from"},ns.to={dependencyType:"stateVariable",variableName:"to"}),ns},definition({dependencyValues:rs}){let ns;return rs.type==="gaussian"?ns=rs.specifiedMean:ns=(rs.from+rs.to)/2,{setValue:{mean:ns}}}},ts.variance={stateVariablesDeterminingDependencies:["type"],public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({stateValues:rs}){let ns={type:{dependencyType:"stateVariable",variableName:"type"}};return rs.type==="gaussian"?(ns.specifiedVariance={dependencyType:"stateVariable",variableName:"specifiedVariance"},ns.specifiedStandardDeviation={dependencyType:"stateVariable",variableName:"specifiedStandardDeviation"}):(ns.from={dependencyType:"stateVariable",variableName:"from"},ns.to={dependencyType:"stateVariable",variableName:"to"},rs.type==="discreteuniform"&&(ns.step={dependencyType:"stateVariable",variableName:"step"},ns.nDiscreteValues={dependencyType:"stateVariable",variableName:"nDiscreteValues"})),ns},definition({dependencyValues:rs,usedDefault:ns}){let is;return rs.type==="gaussian"?ns.specifiedVariance&&!ns.specifiedStandardDeviation?is=rs.specifiedStandardDeviation**2:is=rs.specifiedVariance:rs.type==="discreteuniform"?is=(rs.nDiscreteValues**2-1)*rs.step**2/12:is=(rs.to-rs.from)**2/12,{setValue:{variance:is}}}},ts.standardDeviation={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({variance:{dependencyType:"stateVariable",variableName:"variance"}}),definition:({dependencyValues:rs})=>({setValue:{standardDeviation:Math.sqrt(rs.variance)}})},ts.sampledValues={shadowVariable:!0,hasEssential:!0,stateVariablesDeterminingDependencies:["variantDeterminesSeed"],returnDependencies({stateValues:rs,sharedParameters:ns}){let is={numberOfSamples:{dependencyType:"stateVariable",variableName:"numberOfSamples"},type:{dependencyType:"stateVariable",variableName:"type"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},nDiscreteValues:{dependencyType:"stateVariable",variableName:"nDiscreteValues"},mean:{dependencyType:"stateVariable",variableName:"mean"},standardDeviation:{dependencyType:"stateVariable",variableName:"standardDeviation"}};return rs.variantDeterminesSeed?is.rng={dependencyType:"value",value:ns.variantRng,doNotProxy:!0}:is.rng={dependencyType:"value",value:ns.rngWithDateSeed,doNotProxy:!0},is},definition({dependencyValues:rs}){if(rs.numberOfSamples<1)return{setEssentialValue:{sampledValues:[]},setValue:{sampledValues:[]}};let ns=sampleFromRandomNumbers(rs);return{setEssentialValue:{sampledValues:ns},setValue:{sampledValues:ns}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"sampledValues",value:rs.sampledValues}]}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({sampledValues:{dependencyType:"stateVariable",variableName:"sampledValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:rs})=>({variantSeed:{dependencyType:"value",value:rs.variantSeed}}),definition({dependencyValues:rs,componentName:ns}){return{setValue:{generatedVariantInfo:{seed:rs.variantSeed,meta:{createdBy:ns}}}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,startNum:ns=0,flags:is}){var cs;let as=(cs=ts.attributes.newNamespace)==null?void 0:cs.primitive,os={};for(let ps of["displayDigits","displaySmallAsZero","displayDecimals","padZeros"])ps in ts.attributes&&(os[ps]=ts.attributes[ps]);let ls=[];for(let ps of(await ts.stateValues.sampledValues).slice(ns)){let ds={};Object.keys(os).length>0&&(ds=convertAttributesForComponentType({attributes:os,componentType:"number",componentInfoObjects:rs,compositeCreatesNewNamespace:as,flags:is})),ls.push({componentType:"number",attributes:ds,state:{value:ps}})}return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:ls,parentName:ts.componentName,parentCreatesNewNamespace:as,indOffset:ns,componentInfoObjects:rs}).serializedComponents}}static async calculateReplacementChanges({component:ts,componentInfoObjects:rs,flags:ns}){let is=[],as=await ts.stateValues.sampledValues;if(as.length<ts.replacements.length){let ls=ts.replacements.length-as.length;if(ls!==ts.replacementsToWithhold){let us={changeType:"changeReplacementsToWithhold",replacementsToWithhold:ls};is.push(us)}}else{if(ts.replacementsToWithhold>0){let ls={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};is.push(ls)}if(as.length>ts.replacements.length){let ls=await this.createSerializedReplacements({component:ts,componentInfoObjects:rs,startNum:ts.replacements.length,flags:ns}),us={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:ts.replacements.length,numberReplacementsToReplace:0,serializedReplacements:ls.replacements,assignNamesOffset:ts.replacements.length};is.push(us)}}let os=Math.min(ts.replacements.length,as.length);for(let ls=0;ls<os;ls++){let us={changeType:"updateStateVariables",component:ts.replacements[ls],stateChanges:{value:as[ls]}};is.push(us)}return is}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns});let is=rs.variantRng().toString().slice(2,8)+ +new Date;rs.rngWithDateSeed=new rs.rngClass(is)}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){return{success:!1}}async resample({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=sampleFromRandomNumbers({type:await this.stateValues.type,numberOfSamples:await this.stateValues.numberOfSamples,standardDeviation:await this.stateValues.standardDeviation,mean:await this.stateValues.mean,to:await this.stateValues.to,from:await this.stateValues.from,step:await this.stateValues.step,nDiscreteValues:await this.stateValues.nDiscreteValues,rng:await this.stateValues.variantDeterminesSeed?this.sharedParameters.variantRng:this.sharedParameters.rngWithDateSeed});return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"sampledValues",value:is}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}Ms(SampleRandomNumbers,"componentType","sampleRandomNumbers"),Ms(SampleRandomNumbers,"assignNamesToReplacements",!0),Ms(SampleRandomNumbers,"createsVariants",!0),Ms(SampleRandomNumbers,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class SelectRandomNumbers extends SampleRandomNumbers{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.numberOfSamples,ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:rs}){return{setValue:{variants:rs.variants}}}},ts.step.immutable=!0,ts.from.immutable=!0,ts.from.additionalStateVariablesDefined[0].immutable=!0,ts.from.additionalStateVariablesDefined[1].immutable=!0,ts.mean.immutable=!0,ts.variance.immutable=!0,ts.standardDeviation.immutable=!0,delete ts.sampledValues,ts.selectedValues={immutable:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:({sharedParameters:rs})=>({numberOfSamples:{dependencyType:"stateVariable",variableName:"numberToSelect"},type:{dependencyType:"stateVariable",variableName:"type"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},nDiscreteValues:{dependencyType:"stateVariable",variableName:"nDiscreteValues"},mean:{dependencyType:"stateVariable",variableName:"mean"},standardDeviation:{dependencyType:"stateVariable",variableName:"standardDeviation"},variants:{dependencyType:"stateVariable",variableName:"variants"},rng:{dependencyType:"value",value:rs.variantRng,doNotProxy:!0}}),definition({dependencyValues:rs}){if(rs.numberOfSamples<1)return{setEssentialValue:{selectedValues:[]},setValue:{selectedValues:[]}};if(rs.variants&&rs.variants.desiredVariant){let is=rs.variants.desiredVariant.values;if(is){if(is.length!==rs.numberOfSamples)throw Error("Number of values specified for selectRandomNumber must match number to select");return{setEssentialValue:{selectedValues:is},setValue:{selectedValues:is}}}}let ns=sampleFromRandomNumbers(rs);return{setEssentialValue:{selectedValues:ns},setValue:{selectedValues:ns}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:()=>({selectedValues:{dependencyType:"stateVariable",variableName:"selectedValues"}}),definition({dependencyValues:rs,componentName:ns}){return{setValue:{generatedVariantInfo:{values:rs.selectedValues,meta:{createdBy:ns}}}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({selectedValues:{dependencyType:"stateVariable",variableName:"selectedValues"}}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns}){var us;let is=(us=ts.attributes.newNamespace)==null?void 0:us.primitive,as={};for(let cs of["displayDigits","displaySmallAsZero","displayDecimals","padZeros"])cs in ts.attributes&&(as[cs]=ts.attributes[cs]);let os=[];for(let cs of await ts.stateValues.selectedValues){let ps={};Object.keys(as).length>0&&(ps=convertAttributesForComponentType({attributes:as,componentType:"number",componentInfoObjects:rs,compositeCreatesNewNamespace:is,flags:ns})),os.push({componentType:"number",attributes:ps,state:{value:cs}})}return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:os,parentName:ts.componentName,parentCreatesNewNamespace:is,componentInfoObjects:rs}).serializedComponents}}}Ms(SelectRandomNumbers,"componentType","selectRandomNumbers"),Ms(SelectRandomNumbers,"createsVariants",!0),delete SelectRandomNumbers.stateVariableToEvaluateAfterReplacements,delete SelectRandomNumbers.calculateReplacementChanges;class Substitute extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"math",toLowerCase:!0,validValues:["math","text"],public:!0},ts.match={createComponentOfType:"_componentWithSelectableType",createStateVariable:"match",defaultValue:null},ts.replacement={createComponentOfType:"_componentWithSelectableType",createStateVariable:"replacement",defaultValue:null},ts.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numberspreserveorder"]},ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer"},ts.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},ts.padZeros={createComponentOfType:"boolean"},ts.matchWholeWord={createComponentOfType:"boolean",createStateVariable:"matchWholeWord",defaultValue:!1,public:!0},ts.matchCase={createComponentOfType:"boolean",createStateVariable:"matchCase",defaultValue:!1,public:!0},ts.preserveCase={createComponentOfType:"boolean",createStateVariable:"preserveCase",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=[];function rs({matchedChildren:ns,componentAttributes:is}){let as=is.type;return["math","text"].includes(as)||(as="math"),{success:!0,newChildren:[{componentType:as,children:ns}]}}return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displayDigits"],variablesOptional:!0}}),definition({dependencyValues:rs,usedDefault:ns}){var is;if(rs.type!=="math")return{setValue:{displayDigits:null}};if(rs.displayDigitsAttr!==null){let as=ns.displayDigitsAttr,os=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(as||os)){let ls=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<ls&&(as=!0)}return as?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}else if(rs.child.length===1){let as=(is=ns.child[0])==null?void 0:is.displayDigits,os=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;return as||!os?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.child[0].stateValues.displayDigits}}}:{setValue:{displayDigits:rs.child[0].stateValues.displayDigits}}}else return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displayDecimals"],variablesOptional:!0}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.type!=="math"?{setValue:{displayDecimals:null}}:rs.displayDecimalsAttr!==null&&!ns.displayDecimalsAttr?{setValue:{displayDecimals:rs.displayDecimalsAttr.stateValues.value}}:rs.child.length===1&&!(ns.child[0]&&ns.child[0].displayDecimals)?{setValue:{displayDecimals:rs.child[0].stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displaySmallAsZero"],variablesOptional:!0}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.type!=="math"?{setValue:{displaySmallAsZero:null}}:rs.displaySmallAsZeroAttr!==null&&!ns.displaySmallAsZeroAttr?{setValue:{displaySmallAsZero:rs.displaySmallAsZeroAttr.stateValues.value}}:rs.child.length===1&&!(ns.child[0]&&ns.child[0].displaySmallAsZero)?{setValue:{displaySmallAsZero:rs.child[0].stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["padZeros"],variablesOptional:!0}}),definition({dependencyValues:rs,usedDefault:ns}){return rs.type!=="math"?{setValue:{padZeros:null}}:rs.padZerosAttr!==null&&!ns.padZerosAttr?{setValue:{padZeros:rs.padZerosAttr.stateValues.value}}:rs.child.length===1&&!(ns.child[0]&&ns.child[0].padZeros)?{setValue:{padZeros:rs.child[0].stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.originalValue={returnDependencies:()=>({child:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition({dependencyValues:rs}){return rs.child.length>0?{setValue:{originalValue:rs.child[0].stateValues.value}}:{setValue:{originalValue:null}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.child.length>0?{success:!0,instructions:[{setDependency:"child",desiredValue:rs.originalValue,childIndex:0,variableIndex:0}]}:{success:!1}}},ts.value={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},originalValue:{dependencyType:"stateVariable",variableName:"originalValue"},match:{dependencyType:"stateVariable",variableName:"match"},replacement:{dependencyType:"stateVariable",variableName:"replacement"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},matchWholeWord:{dependencyType:"stateVariable",variableName:"matchWholeWord"},matchCase:{dependencyType:"stateVariable",variableName:"matchCase"},preserveCase:{dependencyType:"stateVariable",variableName:"preserveCase"}}),definition({dependencyValues:rs}){if(rs.originalValue===null)return{setValue:{value:null}};if(rs.match===null||rs.replacement===null)return{setValue:{value:rs.originalValue}};if(rs.type==="text"){let ns=rs.originalValue,is,as="g";rs.matchCase||(as="gi"),rs.matchWholeWord?is=new RegExp("\\b"+escapeRegExp(rs.match)+"\\b",as):is=new RegExp(escapeRegExp(rs.match),as);let os=rs.replacement;if(rs.preserveCase){let ls=returnPreserveCaseReplacer(os);ns=ns.replace(is,ls)}else ns=ns.replace(is,os);return{setValue:{value:ns}}}else{let ns=rs.originalValue.subscripts_to_strings();return ns=ns.substitute({[rs.match.subscripts_to_strings().tree]:rs.replacement.subscripts_to_strings()}),ns=ns.strings_to_subscripts(),ns=normalizeMathExpression({value:ns,simplify:rs.simplify}),{setValue:{value:ns}}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){if(ns.type==="text"){let is=rs.value,as,os,ls="g";ns.matchCase||(ls="gi");let us=ns.match,cs=ns.replacement;if(ns.matchWholeWord)if(as=new RegExp("\\b"+escapeRegExp(us)+"\\b",ls),ns.matchCase&&ns.preserveCase){let ps=returnPreserveCaseReplacer(cs);os=new RegExp("\\b"+escapeRegExp(ps(us))+"\\b",ls)}else os=new RegExp("\\b"+escapeRegExp(cs)+"\\b",ls);else if(as=new RegExp(escapeRegExp(us),ls),ns.matchCase&&ns.preserveCase){let ps=returnPreserveCaseReplacer(cs);os=new RegExp(escapeRegExp(ps(us)),ls)}else os=new RegExp(escapeRegExp(cs),ls);return ns.originalValue.search(os)!==-1||is.search(as)!==-1?{success:!1}:(is=is.replace(os,us),{success:!0,instructions:[{setDependency:"originalValue",desiredValue:is}]})}else{let is=rs.value.subscripts_to_strings(),as=ns.match.subscripts_to_strings(),os=ns.replacement.subscripts_to_strings();return typeof as.tree=="string"&&typeof os.tree=="string"?ns.originalValue.variables(!0).includes(os.tree)?{success:!1}:is.variables().includes(as.tree)?{success:!1}:(is=is.substitute({[os.tree]:as}),is=is.strings_to_subscripts(),{success:!0,instructions:[{setDependency:"originalValue",desiredValue:is}]}):{success:!1}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns}){var us;let is=(us=ts.attributes.newNamespace)==null?void 0:us.primitive,as=await ts.stateValues.type,os={componentType:as,state:{value:await ts.stateValues.value},downstreamDependencies:{[ts.componentName]:[{dependencyType:"referenceShadow",compositeName:ts.componentName,propVariable:"value"}]}};if(as==="math"){let cs={},ps={displayDigits:"integer",displayDecimals:"integer",displaySmallAsZero:"number",padZeros:"boolean"};for(let ds in ps){let fs={componentType:ps[ds],downstreamDependencies:{[ts.componentName]:[{compositeName:ts.componentName,dependencyType:"referenceShadow",propVariable:ds}]}};cs[ds]={component:fs}}os.attributes=cs}return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:[os],parentName:ts.componentName,parentCreatesNewNamespace:is,componentInfoObjects:rs}).serializedComponents}}}Ms(Substitute,"componentType","substitute"),Ms(Substitute,"assignNamesToReplacements",!0),Ms(Substitute,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");function escapeRegExp(ss){return ss.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function returnPreserveCaseReplacer(ss){return function(ts){return ts.toUpperCase()===ts?ss.toUpperCase():ts.toLowerCase()===ts?ss.toLowerCase():ts[0].match(/[a-z]/)?ss[0].toLowerCase()+ss.substring(1):ts[0].match(/[A-Z]/)?ss[0].toUpperCase()+ss.substring(1):ss}}class PeriodicSet extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.minIndex={createComponentOfType:"integer",createStateVariable:"minIndex",defaultValue:-1/0,public:!0},ts.maxIndex={createComponentOfType:"integer",createStateVariable:"maxIndex",defaultValue:1/0,public:!0},ts.offsets={createComponentOfType:"mathList",createStateVariable:"offsets",defaultValue:null,public:!0},ts.period={createComponentOfType:"math",createStateVariable:"period",defaultValue:null,public:!0},ts.minIndexAsList={createComponentOfType:"integer",createStateVariable:"minIndexAsList",defaultValue:-1,public:!0},ts.maxIndexAsList={createComponentOfType:"integer",createStateVariable:"maxIndexAsList",defaultValue:1,public:!0},ts}static returnChildGroups(){return[]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.codePre,delete ts.expressionWithCodes,delete ts.mathChildrenFunctionSymbols,delete ts.codesAdjacentToStrings,delete ts.mathChildrenByVectorComponent,delete ts.mathChildrenWithCanBeModified,delete ts.unordered,ts.canBeModified={returnDependencies:()=>({}),definition:()=>({setValue:{canBeModified:!1}})},ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.mathListParentDisplayDigits!==null)if(ns.mathListParentDisplayDigits)is=!0,as=rs.mathListParentDisplayDigits;else return{setValue:{displayDigits:rs.mathListParentDisplayDigits}};if(rs.numberListParentDisplayDigits!==null)if(ns.numberListParentDisplayDigits)is=!0,as=rs.numberListParentDisplayDigits;else return{setValue:{displayDigits:rs.numberListParentDisplayDigits}};if(!(rs.numberListParentDisplayDecimals!==null&&!ns.numberListParentDisplayDecimals||rs.mathListParentDisplayDecimals!==null&&!ns.mathListParentDisplayDecimals)&&rs.displayDigitsAttr!==null)if(ns.displayDigitsAttr)is=!0,as=rs.displayDigitsAttr.stateValues.value;else return{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}};return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.mathListParentDisplayDecimals!==null)if(ns.mathListParentDisplayDecimals)is=!0,as=rs.mathListParentDisplayDecimals;else return{setValue:{displayDecimals:rs.mathListParentDisplayDecimals}};if(rs.numberListParentDisplayDecimals!==null)if(ns.numberListParentDisplayDecimals)is=!0,as=rs.numberListParentDisplayDecimals;else return{setValue:{displayDecimals:rs.numberListParentDisplayDecimals}};if(rs.displayDecimalsAttr!==null)if(ns.displayDecimalsAttr)is=!0,as=rs.displayDecimalsAttr.stateValues.value;else return{setValue:{displayDecimals:rs.displayDecimalsAttr.stateValues.value}};return is?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},ts.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.mathListParentDisplaySmallAsZero!==null)if(ns.mathListParentDisplaySmallAsZero)is=!0,as=rs.mathListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:rs.mathListParentDisplaySmallAsZero}};if(rs.numberListParentDisplaySmallAsZero!==null)if(ns.numberListParentDisplaySmallAsZero)is=!0,as=rs.numberListParentDisplaySmallAsZero;else return{setValue:{displaySmallAsZero:rs.numberListParentDisplaySmallAsZero}};if(rs.displaySmallAsZeroAttr!==null)if(ns.displaySmallAsZeroAttr)is=!0,as=rs.displaySmallAsZeroAttr.stateValues.value;else return{setValue:{displaySmallAsZero:rs.displaySmallAsZeroAttr.stateValues.value}};return is?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:as}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},ts.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){let is=!1,as;if(rs.mathListParentPadZeros!==null)if(ns.mathListParentPadZeros)is=!0,as=rs.mathListParentPadZeros;else return{setValue:{padZeros:rs.mathListParentPadZeros}};if(rs.numberListParentPadZeros!==null)if(ns.numberListParentPadZeros)is=!0,as=rs.numberListParentPadZeros;else return{setValue:{padZeros:rs.numberListParentPadZeros}};if(rs.padZerosAttr!==null)if(ns.padZerosAttr)is=!0,as=rs.padZerosAttr.stateValues.value;else return{setValue:{padZeros:rs.padZerosAttr.stateValues.value}};return is?{useEssentialOrDefaultValue:{padZeros:{defaultValue:as}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},ts.nOffsets={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({offsets:{dependencyType:"stateVariable",variableName:"offsets"}}),definition({dependencyValues:rs}){let ns=0;return rs.offsets!==null&&(ns=rs.offsets.length),{setValue:{nOffsets:ns}}}},ts.unnormalizedValue={returnDependencies:()=>({offsets:{dependencyType:"stateVariable",variableName:"offsets"},period:{dependencyType:"stateVariable",variableName:"period"},minIndex:{dependencyType:"stateVariable",variableName:"minIndex"},maxIndex:{dependencyType:"stateVariable",variableName:"maxIndex"}}),definition({dependencyValues:rs}){if(rs.offsets===null||rs.offsets.length===0||rs.offsets.length===1&&rs.offsets[0].tree===""||rs.period===null||rs.period.tree==="")return{setValue:{unnormalizedValue:Context.fromAst("")}};let ns=[],is=rs.period.tree,as=rs.minIndex,os=rs.maxIndex;for(let us of rs.offsets)ns.push(["tuple",us.tree,is,as,os]);return{setValue:{unnormalizedValue:Context.fromAst(["periodic_set",...ns])}}}},ts.redundantOffsets={additionalStateVariablesDefined:["uniqueOffsets"],public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({nOffsets:{dependencyType:"stateVariable",variableName:"nOffsets"},offsets:{dependencyType:"stateVariable",variableName:"offsets"},period:{dependencyType:"stateVariable",variableName:"period"}}),definition({dependencyValues:rs}){let ns=!1,is=[];if(rs.period!==null){let as=rs.period.evaluate_to_constant();if(!Number.isNaN(as))for(let os=0;os<rs.nOffsets;os++){let ls=!0;for(let us=0;us<os;us++){let cs=rs.offsets[os].subtract(rs.offsets[us]).evaluate_to_constant();if(Math.abs(cs%as)<1e-10*as){ns=!0,ls=!1;break}}ls&&is.push(rs.offsets[os])}}return{setValue:{redundantOffsets:ns,uniqueOffsets:is}}}},ts.asList={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({uniqueOffsets:{dependencyType:"stateVariable",variableName:"uniqueOffsets"},period:{dependencyType:"stateVariable",variableName:"period"},minIndexAsList:{dependencyType:"stateVariable",variableName:"minIndexAsList"},maxIndexAsList:{dependencyType:"stateVariable",variableName:"maxIndexAsList"}}),definition({dependencyValues:rs}){let ns=[];if(rs.period!==null){let is=rs.period.evaluate_to_constant();if(!Number.isNaN(is)){let as=rs.period.simplify(),os=!0,ls=[];for(let us of rs.uniqueOffsets){let cs=us.evaluate_to_constant();if(Number.isNaN(cs)){os=!1;break}else{let ps=us.subtract(as.multiply(Math.floor(cs/is))).simplify(),ds=ps.evaluate_to_constant();ls.push({num:ds,offset:ps})}}if(os){ns.push(Context.fromAst(["ldots"])),ls.sort((ps,ds)=>ps.num-ds.num);let us=-1,cs=1;Number.isFinite(rs.minIndexAsList)&&(us=rs.minIndexAsList),Number.isFinite(rs.maxIndexAsList)&&(cs=rs.maxIndexAsList);for(let ps=us;ps<=cs;ps++)for(let ds of ls)ns.push(ds.offset.add(as.multiply(ps)).simplify());ns.push(Context.fromAst(["ldots"]))}}}return{setValue:{asList:ns}}}},ts}}Ms(PeriodicSet,"componentType","periodicSet"),Ms(PeriodicSet,"rendererType");class Image extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{moveImage:this.moveImage.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize",createStateVariable:"specifiedWidth",defaultValue:null},ts.size={createComponentOfType:"text",createStateVariable:"specifiedSize",defaultValue:"medium",toLowerCase:!0,validValues:sizePossibilities},ts.aspectRatio={createComponentOfType:"number"},ts.height={createComponentOfType:"_componentSize"},ts.displayMode={createComponentOfType:"text",createStateVariable:"displayMode",validValues:["block","inline"],defaultValue:"block",forRenderer:!0,public:!0},ts.horizontalAlign={createComponentOfType:"text",createStateVariable:"horizontalAlign",toLowerCase:!0,validValues:["center","left","right"],defaultValue:"center",forRenderer:!0,public:!0},ts.description={createComponentOfType:"text",createStateVariable:"description",defaultValue:"",public:!0,forRenderer:!0},ts.source={createComponentOfType:"text",createStateVariable:"source",defaultValue:"",public:!0,forRenderer:!0},ts.asFileName={createComponentOfType:"text",createStateVariable:"asFileName",defaultValue:null,public:!0,forRenderer:!0},ts.mimeType={createComponentOfType:"text",createStateVariable:"mimeType",defaultValue:null,public:!0,forRenderer:!0},ts.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},ts.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},ts.anchor={createComponentOfType:"point"},ts.positionFromAnchor={createComponentOfType:"text",createStateVariable:"positionFromAnchor",defaultValue:"center",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right","center"]},ts.rotate={createComponentOfType:"number",createStateVariable:"rotate",defaultValue:0,public:!0,forRenderer:!0},ts.styleNumber.defaultValue=0,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions(),rs=returnSelectedStyleStateVariableDefinition();return Object.assign(ts,rs),ts.size={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({specifiedSize:{dependencyType:"stateVariable",variableName:"specifiedSize"},specifiedWidth:{dependencyType:"stateVariable",variableName:"specifiedWidth"},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xscale"]}}),definition({dependencyValues:ns,usedDefault:is}){const as="medium";if(is.specifiedSize){if(is.specifiedWidth)return{setValue:{size:as}};{let os=ns.specifiedWidth;if(os===null)return{setValue:{size:as}};let{isAbsolute:ls,size:us}=os,cs;if(ls){let ps;if(ns.graphAncestor){let ds=ns.graphAncestor.stateValues.xscale;ps=orderedPercentWidthMidpoints.map(fs=>fs/100*ds)}else ps=orderedWidthMidpoints;for(let[ds,fs]of ps.entries())if(us<=fs){cs=sizePossibilities[ds];break}cs||(cs=as)}else{for(let[ps,ds]of orderedPercentWidthMidpoints.entries())if(us<=ds){cs=sizePossibilities[ps];break}cs||(cs=as)}return{setValue:{size:cs}}}}else return{setValue:{size:ns.specifiedSize}}},inverseDefinition({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"specifiedSize",desiredValue:ns.size}]}}},ts.width={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},returnDependencies:()=>({specifiedSize:{dependencyType:"stateVariable",variableName:"specifiedSize"},size:{dependencyType:"stateVariable",variableName:"size"},specifiedWidth:{dependencyType:"stateVariable",variableName:"specifiedWidth"},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xscale"]}}),definition({dependencyValues:ns,usedDefault:is}){const as="medium";if(ns.graphAncestor)if(ns.graphAncestor.stateValues.xscale,is.specifiedSize){if(is.specifiedWidth)return{setValue:{width:{isAbsolute:!1,size:percentWidthsBySize[as]}}};{let os=ns.specifiedWidth,ls;return os?ls=os:ls={isAbsolute:!1,size:percentWidthsBySize[as]},{setValue:{width:ls}}}}else return{setValue:{width:{isAbsolute:!1,size:percentWidthsBySize[ns.size]}}};else return{setValue:{width:{isAbsolute:!0,size:widthsBySize[ns.size]}}}},inverseDefinition({desiredStateVariableValues:ns}){return{success:!0,instructions:[{setDependency:"specifiedWidth",desiredValue:ns.width}]}}},ts.widthForGraph={forRenderer:!0,returnDependencies:()=>({width:{dependencyType:"stateVariable",variableName:"width"},graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xscale"]}}),definition({dependencyValues:ns}){let is=ns.width;return ns.graphAncestor&&!is.isAbsolute&&(is={isAbsolute:!0,size:is.size/100*ns.graphAncestor.stateValues.xscale}),{setValue:{widthForGraph:is}}}},ts.aspectRatio={public:!0,forRenderer:!0,hasEssential:!0,defaultValue:null,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]}}),definition({dependencyValues:ns}){if(ns.aspectRatioAttr!==null){let is=ns.aspectRatioAttr.stateValues.value;return Number.isFinite(is)||(is=null),{setValue:{aspectRatio:is}}}else return{useEssentialOrDefaultValue:{aspectRatio:!0}}},inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is}){if(is.aspectRatioAttr!==null)return{success:!0,instructions:[{setDependency:"aspectRatioAttr",desiredValue:ns.aspectRatio,variableIndex:0}]};{let as=ns.aspectRatio;return as>0||(as=null),{success:!0,instructions:[{setEssentialValue:"aspectRatio",value:as}]}}}},ts.cid={forRenderer:!0,returnDependencies:()=>({source:{dependencyType:"stateVariable",variableName:"source"}}),definition:function({dependencyValues:ns}){if(!ns.source||ns.source.substring(0,7).toLowerCase()!=="doenet:")return{setValue:{cid:null}};let is=null,as=ns.source.match(/[:&]cid=([^&]+)/i);return as&&(is=as[1]),{setValue:{cid:is}}}},ts.anchor={defaultValue:Context.fromText("(0,0)"),public:!0,forRenderer:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"point"},returnDependencies:()=>({anchorAttr:{dependencyType:"attributeComponent",attributeName:"anchor",variableNames:["coords"]}}),definition({dependencyValues:ns}){return ns.anchorAttr?{setValue:{anchor:ns.anchorAttr.stateValues.coords}}:{useEssentialOrDefaultValue:{anchor:!0}}},async inverseDefinition({desiredStateVariableValues:ns,dependencyValues:is,stateValues:as,initialChange:os}){return os&&!await as.draggable?{success:!1}:is.anchorAttr?{success:!0,instructions:[{setDependency:"anchorAttr",desiredValue:ns.anchor,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"anchor",value:ns.anchor}]}}},ts}async moveImage({x:ts,y:rs,z:ns,transient:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=["vector"];return ts!==void 0&&(us[1]=ts),rs!==void 0&&(us[2]=rs),ns!==void 0&&(us[3]=ns),is?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],transient:is,actionId:as,sourceInformation:os,skipRendererUpdate:ls}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"anchor",value:Context.fromAst(us)}],actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:ts,y:rs,z:ns}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Image,"componentType","image");class Video extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVideoStarted:this.recordVideoStarted.bind(this),recordVideoWatched:this.recordVideoWatched.bind(this),recordVideoPaused:this.recordVideoPaused.bind(this),recordVideoSkipped:this.recordVideoSkipped.bind(this),recordVideoCompleted:this.recordVideoCompleted.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this),recordVideoReady:this.recordVideoReady.bind(this),playVideo:this.playVideo.bind(this),pauseVideo:this.pauseVideo.bind(this),setTime:this.setTime.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize"},ts.size={createComponentOfType:"text"},ts.aspectRatio={createComponentOfType:"number"},ts.height={createComponentOfType:"_componentSize"},ts.displayMode={createComponentOfType:"text",createStateVariable:"displayMode",validValues:["block","inline"],defaultValue:"block",forRenderer:!0,public:!0},ts.horizontalAlign={createComponentOfType:"text",createStateVariable:"horizontalAlign",validValues:["center","left","right"],defaultValue:"center",forRenderer:!0,public:!0},ts.youtube={createComponentOfType:"text",createStateVariable:"youtube",defaultValue:null,public:!0,forRenderer:!0},ts.source={createComponentOfType:"text",createStateVariable:"source",defaultValue:null,public:!0,forRenderer:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.size={public:!0,defaultValue:"full",hasEssential:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({sizeAttr:{dependencyType:"attributeComponent",attributeName:"size",variableNames:["value"]},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]}}),definition({dependencyValues:rs}){const ns="full";if(rs.sizeAttr){let is=rs.sizeAttr.stateValues.value.toLowerCase();return sizePossibilities.includes(is)||(is=ns),{setValue:{size:is}}}else if(rs.widthAttr){let is=rs.widthAttr.stateValues.componentSize;if(is===null)return{setValue:{size:ns}};let{isAbsolute:as,size:os}=is,ls;if(as){for(let[us,cs]of orderedWidthMidpoints.entries())if(os<=cs){ls=sizePossibilities[us];break}ls||(ls=ns)}else{for(let[us,cs]of orderedPercentWidthMidpoints.entries())if(os<=cs){ls=sizePossibilities[us];break}ls||(ls=ns)}return{setValue:{size:ls}}}else return{useEssentialOrDefaultValue:{size:!0}}}},ts.width={public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},returnDependencies:()=>({size:{dependencyType:"stateVariable",variableName:"size"}}),definition({dependencyValues:rs}){return{setValue:{width:{isAbsolute:!0,size:widthsBySize[rs.size]}}}}},ts.aspectRatio={public:!0,forRenderer:!0,defaultValue:"16 / 9",hasEssential:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]},width:{dependencyType:"stateVariable",variableName:"width"}}),definition({dependencyValues:rs}){if(rs.aspectRatioAttr!==null){let ns=rs.aspectRatioAttr.stateValues.value;return Number.isFinite(ns)||(ns=1),{setValue:{aspectRatio:ns}}}else return{useEssentialOrDefaultValue:{aspectRatio:!0}}}},ts.state={hasEssential:!0,defaultValue:"initializing",forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},ignoreFixed:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{state:!0}}},inverseDefinition({desiredStateVariableValues:rs}){let ns=rs.state.toLowerCase();return["stopped","playing"].includes(ns)?{success:!0,instructions:[{setEssentialValue:"state",value:ns}]}:{success:!1}}},ts.time={hasEssential:!0,defaultValue:0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"number"},ignoreFixed:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{time:!0}}},inverseDefinition({desiredStateVariableValues:rs}){let ns=rs.time;return ns>=0?{success:!0,instructions:[{setEssentialValue:"time",value:ns}]}:{success:!1}}},ts.duration={hasEssential:!0,defaultValue:null,public:!0,shadowingInstructions:{createComponentOfType:"number"},ignoreFixed:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{duration:!0}}),inverseDefinition:({desiredStateVariableValues:rs})=>({success:!0,instructions:[{setEssentialValue:"duration",value:rs.duration}]})},ts.segmentsWatched={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{segmentsWatched:!0}}),inverseDefinition:({desiredStateVariableValues:rs})=>({success:!0,instructions:[{setEssentialValue:"segmentsWatched",value:rs.segmentsWatched}]})},ts.secondsWatched={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({segmentsWatched:{dependencyType:"stateVariable",variableName:"segmentsWatched"}}),definition({dependencyValues:rs}){let ns=0;return rs.segmentsWatched&&(ns=rs.segmentsWatched.reduce((is,as)=>is+as[1]-as[0],0)),{setValue:{secondsWatched:ns}}}},ts.fractionWatched={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({secondsWatched:{dependencyType:"stateVariable",variableName:"secondsWatched"},duration:{dependencyType:"stateVariable",variableName:"duration"}}),definition({dependencyValues:rs}){return{setValue:{fractionWatched:rs.secondsWatched/rs.duration}}}},ts}recordVideoStarted({beginTime:ts,duration:rs,rate:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){this.coreFunctions.requestRecordEvent({verb:"played",object:{componentName:this.componentName,componentType:this.componentType,duration:rs},context:{startingPoint:ts,rate:ns}}),this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"playing"}],actionId:is,sourceInformation:as,skipRendererUpdate:os,overrideReadOnly:!0})}async recordVideoWatched({beginTime:ts,endTime:rs,duration:ns,rates:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){this.coreFunctions.requestRecordEvent({verb:"watched",object:{componentName:this.componentName,componentType:this.componentType,duration:ns},context:{startingPoint:ts,endingPoint:rs,rates:is}});let us=await this.stateValues.segmentsWatched,cs;if(ts<1?ts=0:rs>ns-2&&(rs=ns),!us)cs=[[ts,rs]];else{cs=[];let ps=!1;for(let[ds,fs]of us.entries()){if(rs<fs[0]-1){cs.push([ts,rs]),cs.push(...us.slice(ds)),ps=!0;break}else if(ts>fs[1]+1){cs.push(fs);continue}ts=Math.min(fs[0],ts),rs=Math.max(fs[1],rs)}ps||cs.push([ts,rs])}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"segmentsWatched",value:cs}],actionId:as,sourceInformation:os,skipRendererUpdate:!0,canSkipUpdatingRenderer:!0}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:as,sourceInformation:os,skipRendererUpdate:ls})}recordVideoPaused({endTime:ts,duration:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType,duration:rs},context:{endingPoint:ts}}),this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"stopped"}],actionId:ns,sourceInformation:is,skipRendererUpdate:as,overrideReadOnly:!0})}recordVideoSkipped({beginTime:ts,endTime:rs,duration:ns}){this.coreFunctions.requestRecordEvent({verb:"skipped",object:{componentName:this.componentName,componentType:this.componentType,duration:ns},context:{startingPoint:ts,endingPoint:rs}})}recordVideoCompleted({duration:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){this.coreFunctions.requestRecordEvent({verb:"completed",object:{componentName:this.componentName,componentType:this.componentType,duration:ts}}),this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"stopped"}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,overrideReadOnly:!0})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}recordVideoReady({duration:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"stopped"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"duration",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,overrideReadOnly:!0,doNotSave:!0})}async playVideo({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"playing"}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,overrideReadOnly:!0})}async pauseVideo({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"state",value:"stopped"}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,overrideReadOnly:!0})}setTime({time:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"time",value:ts}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,overrideReadOnly:!0})}}Ms(Video,"componentType","video");class Embed extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:500,isAbsolute:!0},public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:500,isAbsolute:!0},public:!0,forRenderer:!0},ts.geogebra={createComponentOfType:"text",createStateVariable:"geogebra",defaultValue:null,public:!0,forRenderer:!0},ts.encodedGeogebraContent={createComponentOfType:"text",createStateVariable:"encodedGeogebraContent",defaultValue:null,public:!0,forRenderer:!0},ts.fromMathInsight={createComponentOfType:"text",createStateVariable:"fromMathInsight",defaultValue:null,public:!0,forRenderer:!0},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Embed,"componentType","embed");class Hint extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{revealHint:this.revealHint.bind(this),closeHint:this.closeHint.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"titles",componentTypes:["title"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.showHints={forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},showHintsFlag:{dependencyType:"flag",flagName:"showHints"}}),definition({dependencyValues:rs}){return{setValue:{showHints:rs.showHintsFlag&&!rs.hide}}}},ts.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:!0}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"open",value:rs.open}]}}},ts.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition({dependencyValues:rs}){let ns=null;return rs.titleChild.length>0&&(ns=rs.titleChild[rs.titleChild.length-1].componentName),{setValue:{titleChildName:ns}}}},ts.childIndicesToRender={returnDependencies:()=>({titleChildren:{dependencyType:"child",childGroups:["titles"]},allChildren:{dependencyType:"child",childGroups:["anything","titles"]},titleChildName:{dependencyType:"stateVariable",variableName:"titleChildName"}}),definition({dependencyValues:rs}){let ns=[],is=rs.titleChildren.map(as=>as.componentName);for(let[as,os]of rs.allChildren.entries())(typeof os!="object"||!is.includes(os.componentName)||os.componentName===rs.titleChildName)&&ns.push(as);return{setValue:{childIndicesToRender:ns}}}},ts.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]}}),definition({dependencyValues:rs}){return rs.titleChild.length===0?{setValue:{title:"Hint"}}:{setValue:{title:rs.titleChild[rs.titleChild.length-1].stateValues.text}}}},ts}async revealHint({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],overrideReadOnly:!0,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}async closeHint({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],overrideReadOnly:!0,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Hint,"componentType","hint"),Ms(Hint,"renderChildren",!0),Ms(Hint,"includeBlankStringChildren",!0);class Solution extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{revealSolution:this.revealSolution.bind(this),closeSolution:this.closeSolution.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.hide={createComponentOfType:"boolean"},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return{success:!0,newChildren:[{componentType:"_solutionContainer",children:ns}]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.hide={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({hideAttr:{dependencyType:"attributeComponent",attributeName:"hide",variableNames:["value"]},displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:rs}){return rs.displayMode==="none"?{setValue:{hide:!0}}:rs.hideAttr!==null?{setValue:{hide:rs.hideAttr.stateValues.value}}:{useEssentialOrDefaultValue:{hide:!0}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.displayMode==="none"?{success:!1}:ns.hideAttr!==null?{success:!0,instructions:[{setDependency:"hideAttr",desiredValue:rs.hide,variableIndex:0}]}:{success:!0,instructions:[{setSetVariable:"hide",value:rs.hide}]}}},ts.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:rs}){return rs.displayMode==="displayed"?{setValue:{open:!0}}:rs.displayMode==="none"?{setValue:{open:!1}}:{useEssentialOrDefaultValue:{open:!0}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.displayMode==="displayed"||ns.displayMode==="none"?{success:!1}:{success:!0,instructions:[{setEssentialValue:"open",value:rs.open}]}}},ts.canBeClosed={forRenderer:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:rs}){return rs.displayMode==="button"?{setValue:{canBeClosed:!0}}:{setValue:{canBeClosed:!1}}}},ts.message={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"",hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{message:!0}}),inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"message",value:rs.message}]}}},ts}async revealSolution({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let{allowView:is,message:as,scoredComponent:os}=await this.coreFunctions.recordSolutionView(),ls=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:is},{updateType:"updateValue",componentName:this.componentName,stateVariable:"message",value:as}],us;return is&&(ls.push({updateType:"updateValue",componentName:os,stateVariable:"viewedSolution",value:!0}),us={verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}),await this.coreFunctions.performUpdate({updateInstructions:ls,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:us,overrideReadOnly:!0})}async closeSolution({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],overrideReadOnly:!0,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Solution,"componentType","solution"),Ms(Solution,"renderChildren",!0),Ms(Solution,"sendToRendererEvenIfHidden",!0),Ms(Solution,"includeBlankStringChildren",!0);class IntComma extends Text{static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:ts,oldName:"value",newName:"originalValue"}),ts.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType},returnDependencies:()=>({originalValue:{dependencyType:"stateVariable",variableName:"originalValue"}}),definition:function({dependencyValues:rs}){let ns=rs.originalValue,is=/^(-?\d+)(\d{3})/,as=ns.match(is);for(;as!==null;)ns=ns.replace(is,"$1,$2"),as=ns.match(is);return{setValue:{value:ns}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.value}})},ts}}Ms(IntComma,"componentType","intcomma"),Ms(IntComma,"rendererType","text");const e$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");var t$1=function(ss){let ts=(ss=ss||"_")+"-";for(let rs=0;rs<7;rs++)ts+=e$1[Math.floor(Math.random()*e$1.length)];return ts};let r$1={"!":"","?":"",'"':'"',"'":"","-":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",I:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""},a$1={};Object.keys(r$1).forEach(function(ss){r$1[ss].split("").forEach(function(ts){a$1[ts]=ss})});var n$1=ss=>{let ts=ss.split("");return ts.forEach((rs,ns)=>{a$1[rs]&&(ts[ns]=a$1[rs])}),ts.join("")};const i$1=/([A-Z]\.)+[A-Z]?,?$/,o$1=/^[A-Z]\.,?$/,s$1=/[A-Z]{2,}('s|,)?$/,l$1=/([a-z]\.)+[a-z]\.?$/;var u$1=function(ss){return i$1.test(ss)===!0||l$1.test(ss)===!0||o$1.test(ss)===!0||s$1.test(ss)===!0};const c$2=n$1,h$1=u$1,d$1=/[a-z\u00C0-\u00FF] ?\/ ?[a-z\u00C0-\u00FF]/,g$1=function(ss){let ts=ss=(ss=(ss=ss||"").toLowerCase()).trim();return ss=c$2(ss),d$1.test(ss)===!0&&(ss=ss.replace(/\/.*/,"")),ss=(ss=(ss=(ss=(ss=(ss=(ss=ss.replace(/^[#@]/,"")).replace(/[,;.!?]+$/,"")).replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'")).replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"')).replace(/\u2026/g,"...")).replace(/\u2013/g,"-")).replace(/([aeiou][ktrp])in$/,"$1ing"),/^(re|un)-?[^aeiou]./.test(ss)===!0&&(ss=ss.replace("-","")),h$1(ss)&&(ss=ss.replace(/\./g,"")),/^[:;]/.test(ss)===!1&&(ss=(ss=(ss=ss.replace(/\.{3,}$/g,"")).replace(/[",\.!:;\?\)]+$/g,"")).replace(/^['"\(]+/g,"")),(ss=(ss=ss.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())===""&&(ss=ts),ss=ss.replace(/([0-9]),([0-9])/g,"$1$2")},p$1=function(ss){return ss=(ss=ss.replace(/[']s$/,"")).replace(/s[']$/,"s")},m$1=/^[ \n\t\.\[\](){}:,!\-?;\/&*^%+=~\|\u0022\uFF02\u0027\u201C\u201F\u201B\u201E\u2E42\u201A\u2035\u2036\u2037\u301D\u0060\u301F]+/,f$1=/[ \n\t\.'\[\](){}:,!\-?;\/&*@^#+=~\|\u0022\uFF02\u201D\u00B4\u301E]+$/,b$1=/\//,y$1=/[']/,v$1=/^[a-z]\.([a-z]\.)+/i,w$1=/^[-+\.][0-9]/,k$1=/^'[0-9]{2}/;var A$1=ss=>{let ts=ss,rs="",ns="";(ss=(ss=ss.replace(m$1,os=>(rs=os,rs!=="-"&&rs!=="+"&&rs!=="."||!w$1.test(ss)?rs==="'"&&k$1.test(ss)?(rs="",os):"":(rs="",os)))).replace(f$1,os=>(ns=os,y$1.test(os)&&/[sn][']$/.test(ts)&&y$1.test(rs)===!1?(ns=ns.replace(y$1,""),"'"):v$1.test(ss)===!0?(ns=ns.replace(/\./,""),"."):"")))===""&&(ts=ts.replace(/ *$/,os=>(ns=os||"","")),ss=ts,rs="",ns=ns);let is=g$1(ss);const as={text:ss,clean:is,reduced:p$1(is),pre:rs,post:ns};return b$1.test(ss)&&ss.split(b$1).forEach(os=>{as.alias=as.alias||{},as.alias[os.trim()]=!0}),as},D$1={};(function(ss){const ts=/^[A-Z][a-z'\u00C0-\u00FF]/,rs=/^[A-Z]+s?$/;ss.toUpperCase=function(){return this.text=this.text.toUpperCase(),this},ss.toLowerCase=function(){return this.text=this.text.toLowerCase(),this},ss.toTitleCase=function(){return this.text=this.text.replace(/^ *[a-z\u00C0-\u00FF]/,ns=>ns.toUpperCase()),this},ss.isUpperCase=function(){return rs.test(this.text)},ss.isTitleCase=function(){return ts.test(this.text)},ss.titleCase=ss.isTitleCase})(D$1);var $$1={};(function(ss){const ts=/(\u0022|\uFF02|\u0027|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\u00AB|\u2039|\u2035|\u2036|\u2037|\u301D|\u0060|\u301F)/,rs=/(\u0022|\uFF02|\u0027|\u201D|\u2019|\u201D|\u2019|\u201D|\u201D|\u2019|\u00BB|\u203A|\u2032|\u2033|\u2034|\u301E|\u00B4|\u301E)/;ss.hasPost=function(ns){return this.post.indexOf(ns)!==-1},ss.hasPre=function(ns){return this.pre.indexOf(ns)!==-1},ss.hasQuote=function(){return ts.test(this.pre)||rs.test(this.post)},ss.hasQuotation=ss.hasQuote,ss.hasComma=function(){return this.hasPost(",")},ss.hasPeriod=function(){return this.hasPost(".")===!0&&this.hasPost("...")===!1},ss.hasExclamation=function(){return this.hasPost("!")},ss.hasQuestionMark=function(){return this.hasPost("?")||this.hasPost("")},ss.hasEllipses=function(){return this.hasPost("..")||this.hasPost("")||this.hasPre("..")||this.hasPre("")},ss.hasSemicolon=function(){return this.hasPost(";")},ss.hasSlash=function(){return/\//.test(this.text)},ss.hasHyphen=function(){const ns=/^(-||)$/;return ns.test(this.post)||ns.test(this.pre)},ss.hasDash=function(){const ns=/ (-||) /;return ns.test(this.post)||ns.test(this.pre)},ss.hasContraction=function(){return!!this.implicit},ss.addPunctuation=function(ns){return ns!==","&&ns!==";"||(this.post=this.post.replace(ns,"")),this.post=ns+this.post,this}})($$1);var P$1={};const E$1=function(ss,ts,rs=3){if(ss===ts)return 1;if(ss.length<rs||ts.length<rs)return 0;const ns=function(as,os){let ls=as.length,us=os.length;if(ls===0)return us;if(us===0)return ls;let cs=(us>ls?us:ls)+1;if(Math.abs(ls-us)>(cs||100))return cs||100;let ps,ds,fs,hs,ys,gs,bs=[];for(let vs=0;vs<cs;vs++)bs[vs]=[vs],bs[vs].length=cs;for(let vs=0;vs<cs;vs++)bs[0][vs]=vs;for(let vs=1;vs<=ls;++vs)for(ds=as[vs-1],ps=1;ps<=us;++ps){if(vs===ps&&bs[vs][ps]>4)return ls;fs=os[ps-1],hs=ds===fs?0:1,ys=bs[vs-1][ps]+1,(gs=bs[vs][ps-1]+1)<ys&&(ys=gs),(gs=bs[vs-1][ps-1]+hs)<ys&&(ys=gs);let Ns=vs>1&&ps>1&&ds===os[ps-2]&&as[vs-2]===fs&&(gs=bs[vs-2][ps-2]+hs)<ys;bs[vs][ps]=Ns?gs:ys}return bs[ls][us]}(ss,ts);let is=Math.max(ss.length,ts.length);return 1-(is===0?0:ns/is)};let H$1=function(){};H$1=function(ss,ts,rs,ns){let is=function(as,os,ls,us){if(os.id===as.id||os.anything===!0)return!0;if(os.start===!0&&ls!==0||os.end===!0&&ls!==us-1)return!1;if(os.word!==void 0){if(as.implicit!==null&&as.implicit===os.word||as.alias!==void 0&&as.alias.hasOwnProperty(os.word)||os.soft===!0&&os.word===as.root)return!0;if(os.fuzzy!==void 0){let cs=E$1(os.word,as.reduced);if(cs>os.fuzzy||os.soft===!0&&(cs=E$1(os.word,as.root),cs>os.fuzzy))return!0}return os.word===as.clean||os.word===as.text||os.word===as.reduced}return os.tag!==void 0?as.tags[os.tag]===!0:os.method!==void 0?typeof as[os.method]=="function"&&as[os.method]()===!0:os.regex!==void 0?os.regex.test(as.clean):os.fastOr!==void 0?!(!as.implicit||os.fastOr.hasOwnProperty(as.implicit)!==!0)||os.fastOr.hasOwnProperty(as.reduced)||os.fastOr.hasOwnProperty(as.text):os.choices!==void 0&&(os.operator==="and"?os.choices.every(cs=>H$1(as,cs,ls,us)):os.choices.some(cs=>H$1(as,cs,ls,us)))}(ss,ts,rs,ns);return ts.negative===!0?!is:is};const j$1=H$1,N$1=u$1,x$1={};P$1.doesMatch=function(ss,ts,rs){return j$1(this,ss,ts,rs)},P$1.isAcronym=function(){return N$1(this.text)},P$1.isImplicit=function(){return this.text===""&&!!this.implicit},P$1.isKnown=function(){return Object.keys(this.tags).some(ss=>x$1[ss]!==!0)},P$1.setRoot=function(ss){let ts=ss.transforms,rs=this.implicit||this.clean;if(this.tags.Plural&&(rs=ts.toSingular(rs,ss)),this.tags.Verb&&!this.tags.Negative&&!this.tags.Infinitive){let ns=null;this.tags.PastTense?ns="PastTense":this.tags.Gerund?ns="Gerund":this.tags.PresentTense?ns="PresentTense":this.tags.Participle?ns="Participle":this.tags.Actor&&(ns="Actor"),rs=ts.toInfinitive(rs,ss,ns)}this.root=rs};var F$1={};const C$1=n$1,B$1=/[\s-]/,G$1=/^[A-Z-]+$/;F$1.textOut=function(ss,ts,rs){ss=ss||{};let ns=this.text,is=this.pre,as=this.post;return ss.reduced===!0&&(ns=this.reduced||""),ss.root===!0&&(ns=this.root||""),ss.implicit===!0&&this.implicit&&(ns=this.implicit||""),ss.normal===!0&&(ns=this.clean||this.text||""),ss.root===!0&&(ns=this.root||this.reduced||""),ss.unicode===!0&&(ns=C$1(ns)),ss.titlecase===!0&&(this.tags.ProperNoun&&!this.titleCase()||(this.tags.Acronym?ns=ns.toUpperCase():G$1.test(ns)&&!this.tags.Acronym&&(ns=ns.toLowerCase()))),ss.lowercase===!0&&(ns=ns.toLowerCase()),ss.acronyms===!0&&this.tags.Acronym&&(ns=ns.replace(/\./g,"")),ss.whitespace!==!0&&ss.root!==!0||(is="",as=" ",B$1.test(this.post)!==!1&&!ss.last||this.implicit||(as="")),ss.punctuation!==!0||ss.root||(this.hasPost(".")===!0?as="."+as:this.hasPost("?")===!0?as="?"+as:this.hasPost("!")===!0?as="!"+as:this.hasPost(",")===!0?as=","+as:this.hasEllipses()===!0&&(as="..."+as)),ts!==!0&&(is=""),rs!==!0&&(as=""),ss.abbreviations===!0&&this.tags.Abbreviation&&(as=as.replace(/^\./,"")),is+ns+as};var z$1={};const I$1={Auxiliary:1,Possessive:1},O$1=function(ss,ts){let rs=Object.keys(ss.tags);const ns=ts.tags;return rs=rs.sort((is,as)=>I$1[as]||!ns[as]?-1:ns[as]?ns[is]?ns[is].lineage.length>ns[as].lineage.length?1:ns[is].isA.length>ns[as].isA.length?-1:0:0:1),rs},T$2={text:!0,tags:!0,implicit:!0,whitespace:!0,clean:!1,id:!1,index:!1,offset:!1,bestTag:!1};z$1.json=function(ss,ts){ss=ss||{};let rs={};return(ss=Object.assign({},T$2,ss)).text&&(rs.text=this.text),ss.normal&&(rs.normal=this.clean),ss.tags&&(rs.tags=Object.keys(this.tags)),ss.clean&&(rs.clean=this.clean),(ss.id||ss.offset)&&(rs.id=this.id),ss.implicit&&this.implicit!==null&&(rs.implicit=this.implicit),ss.whitespace&&(rs.pre=this.pre,rs.post=this.post),ss.bestTag&&(rs.bestTag=O$1(this,ts)[0]),rs};var V$1=Object.assign({},D$1,$$1,P$1,F$1,z$1),M$1={},J$1={};function L$1(){return typeof window<"u"&&window.document}const S$1=function(ss,ts){for(ss=ss.toString();ss.length<ts;)ss+=" ";return ss};J$1.logTag=function(ss,ts,rs){if(L$1())return void console.log("%c"+S$1(ss.clean,3)+"  + "+ts+" ","color: #6accb2;");let ns="\x1B[33m"+S$1(ss.clean,15)+"\x1B[0m + \x1B[32m"+ts+"\x1B[0m ";rs&&(ns=S$1(ns,35)+" "+rs),console.log(ns)},J$1.logUntag=function(ss,ts,rs){if(L$1())return void console.log("%c"+S$1(ss.clean,3)+"  - "+ts+" ","color: #AB5850;");let ns="\x1B[33m"+S$1(ss.clean,3)+" \x1B[31m - #"+ts+"\x1B[0m ";rs&&(ns=S$1(ns,35)+" "+rs),console.log(ns)},J$1.isArray=function(ss){return Object.prototype.toString.call(ss)==="[object Array]"},J$1.titleCase=ss=>ss.charAt(0).toUpperCase()+ss.substr(1);const _$1=J$1,K$1=function(ss,ts,rs,ns){let is=ns.tags;if(ts===""||ts==="."||ts==="-"||(ts[0]==="#"&&(ts=ts.replace(/^#/,"")),ts=_$1.titleCase(ts),ss.tags[ts]===!0))return;const as=ns.isVerbose();as===!0&&_$1.logTag(ss,ts,rs),ss.tags[ts]=!0,is.hasOwnProperty(ts)===!0&&(is[ts].isA.forEach(os=>{ss.tags[os]=!0,as===!0&&_$1.logTag(ss," "+os)}),ss.unTag(is[ts].notA,"",ns))},q$1=J$1,W$1=/^[a-z]/,R$1=function(ss,ts,rs,ns){const is=ns.isVerbose();if(ts==="*")return ss.tags={},ss;var as;ts=ts.replace(/^#/,""),W$1.test(ts)===!0&&(ts=(as=ts).charAt(0).toUpperCase()+as.substr(1)),ss.tags[ts]===!0&&(delete ss.tags[ts],is===!0&&q$1.logUntag(ss,ts,rs));const os=ns.tags;if(os[ts]){let ls=os[ts].lineage;for(let us=0;us<ls.length;us++)ss.tags[ls[us]]===!0&&(delete ss.tags[ls[us]],is===!0&&q$1.logUntag(ss," - "+ls[us]))}return ss},U$1=function(ss,ts,rs){const ns=rs.tags;if(ts[0]==="#"&&(ts=ts.replace(/^#/,"")),ns[ts]===void 0)return!0;let is=ns[ts].notA||[];for(let as=0;as<is.length;as++)if(ss.tags[is[as]]===!0)return!1;return ns[ts].isA===void 0||U$1(ss,ns[ts].isA,rs)},Q$1=function(ss,ts,rs,ns){if(typeof ts!="string")for(let is=0;is<ts.length;is++)K$1(ss,ts[is],rs,ns);else K$1(ss,ts,rs,ns)},Z$1=function(ss,ts,rs,ns){if(typeof ts!="string"&&ts)for(let is=0;is<ts.length;is++)R$1(ss,ts[is],rs,ns);else R$1(ss,ts,rs,ns)},X$1=U$1;M$1.tag=function(ss,ts,rs){return Q$1(this,ss,ts,rs),this},M$1.tagSafe=function(ss,ts,rs){return X$1(this,ss,rs)&&Q$1(this,ss,ts,rs),this},M$1.unTag=function(ss,ts,rs){return Z$1(this,ss,ts,rs),this},M$1.canBe=function(ss,ts){return X$1(this,ss,ts)};const Y$1=t$1,ee$1=A$1,te$1=V$1,re$1=M$1;let ae$1=class{constructor(ts=""){ts=String(ts);let rs=ee$1(ts);this.text=rs.text||"",this.clean=rs.clean,this.reduced=rs.reduced,this.root=null,this.implicit=null,this.pre=rs.pre||"",this.post=rs.post||"",this.tags={},this.prev=null,this.next=null,this.id=Y$1(rs.clean),this.isA="Term",rs.alias&&(this.alias=rs.alias)}set(ts){let rs=ee$1(ts);return this.text=rs.text,this.clean=rs.clean,this.reduced=rs.reduced,this.root=null,this.implicit=null,this}};ae$1.prototype.clone=function(){let ss=new ae$1(this.text);return ss.pre=this.pre,ss.post=this.post,ss.clean=this.clean,ss.reduced=this.reduced,ss.root=this.root,ss.implicit=this.implicit,ss.tags=Object.assign({},this.tags),ss},Object.assign(ae$1.prototype,te$1),Object.assign(ae$1.prototype,re$1);var ne$1=ae$1,ie$1={terms:function(ss){if(this.length===0)return[];if(this.cache.terms)return ss!==void 0?this.cache.terms[ss]:this.cache.terms;let ts=[this.pool.get(this.start)];for(let rs=0;rs<this.length-1;rs+=1){let ns=ts[ts.length-1].next;if(ns===null){console.error("Compromise error: Linked list broken in phrase '"+this.start+"'");break}let is=this.pool.get(ns);if(ts.push(is),ss!==void 0&&ss===rs)return ts[ss]}return ss===void 0&&(this.cache.terms=ts),ss!==void 0?ts[ss]:ts},clone:function(ss){if(ss){let rs=this.buildFrom(this.start,this.length);return rs.cache=this.cache,rs}let ts=this.terms().map(rs=>rs.clone());return ts.forEach((rs,ns)=>{this.pool.add(rs),ts[ns+1]&&(rs.next=ts[ns+1].id),ts[ns-1]&&(rs.prev=ts[ns-1].id)}),this.buildFrom(ts[0].id,ts.length)},lastTerm:function(){let ss=this.terms();return ss[ss.length-1]},hasId:function(ss){if(this.length===0||!ss)return!1;if(this.start===ss)return!0;if(this.cache.terms){let rs=this.cache.terms;for(let ns=0;ns<rs.length;ns++)if(rs[ns].id===ss)return!0;return!1}let ts=this.start;for(let rs=0;rs<this.length-1;rs+=1){let ns=this.pool.get(ts);if(ns===void 0)return console.error(`Compromise error: Linked list broken. Missing term '${ts}' in phrase '${this.start}'
`),!1;if(ns.next===ss)return!0;ts=ns.next}return!1},wordCount:function(){return this.terms().filter(ss=>ss.text!=="").length},fullSentence:function(){let ss=this.terms(0);for(;ss.prev;)ss=this.pool.get(ss.prev);let ts=ss.id,rs=1;for(;ss.next;)ss=this.pool.get(ss.next),rs+=1;return this.buildFrom(ts,rs)}},oe$1={};oe$1.text=function(ss={},ts,rs){typeof ss=="string"&&(ss=ss==="normal"?{whitespace:!0,unicode:!0,lowercase:!0,punctuation:!0,acronyms:!0,abbreviations:!0,implicit:!0,normal:!0}:ss==="clean"?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,normal:!0}:ss==="reduced"?{punctuation:!1,titlecase:!1,lowercase:!0,whitespace:!0,unicode:!0,implicit:!0,reduced:!0}:ss==="implicit"?{punctuation:!0,implicit:!0,whitespace:!0,trim:!0}:ss==="root"?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,root:!0}:{});let ns=this.terms(),is=!1;ns[0]&&ns[0].prev===null&&ns[ns.length-1].next===null&&(is=!0);let as=ns.reduce((os,ls,us)=>{if(us===0&&ls.text===""&&ls.implicit!==null&&!ss.implicit)return os;ss.last=rs&&us===ns.length-1;let cs=!0,ps=!0;return is===!1&&(us===0&&ts&&(cs=!1),us===ns.length-1&&rs&&(ps=!1)),os+ls.textOut(ss,cs,ps)},"");return is===!0&&rs&&(as=as.replace(/ +$/,"")),ss.trim===!0&&(as=as.trim()),as};var se$1={trim:function(){let ss=this.terms();if(ss.length>0){ss[0].pre=ss[0].pre.replace(/^\s+/,"");let ts=ss[ss.length-1];ts.post=ts.post.replace(/\s+$/,"")}return this}},le$1={};const ue$1=/[.?!]\s*$/,ce$1=function(ss,ts){ts[0].pre=ss[0].pre;let rs=ss[ss.length-1],ns=ts[ts.length-1];ns.post=function(is,as){return ue$1.test(as)?as+is.match(/\s*$/):is}(rs.post,ns.post),rs.post="",rs.post===""&&(rs.post+=" ")},he$1=/ /,de$1=function(ss,ts,rs){let ns=ss.terms(),is=ts.terms();ce$1(ns,is),function(us,cs,ps){let ds=us[us.length-1],fs=cs[cs.length-1],hs=ds.next;ds.next=cs[0].id,fs.next=hs,hs&&(ps.get(hs).prev=fs.id);let ys=us[0].id;ys&&(cs[0].prev=ys)}(ns,is,ss.pool);let as=[ss],os=ss.start,ls=[rs];return ls=ls.concat(rs.parents()),ls.forEach(us=>{let cs=us.list.filter(ps=>ps.hasId(os));as=as.concat(cs)}),as=function(us){return us.filter((cs,ps)=>us.indexOf(cs)===ps)}(as),as.forEach(us=>{us.length+=ts.length}),ss.cache={},ss},ge$1=function(ss,ts,rs){const ns=ss.start;let is=ts.terms();(function(ls){let us=ls[ls.length-1];he$1.test(us.post)===!1&&(us.post+=" ")})(is),function(ls,us,cs){let ps=cs[cs.length-1];ps.next=ls.start;let ds=ls.pool,fs=ds.get(ls.start);fs.prev&&(ds.get(fs.prev).next=us.start),cs[0].prev=ls.terms(0).prev,ls.terms(0).prev=ps.id}(ss,ts,is);let as=[ss],os=[rs];return os=os.concat(rs.parents()),os.forEach(ls=>{let us=ls.list.filter(cs=>cs.hasId(ns)||cs.hasId(ts.start));as=as.concat(us)}),as=function(ls){return ls.filter((us,cs)=>ls.indexOf(us)===cs)}(as),as.forEach(ls=>{ls.length+=ts.length,ls.start===ns&&(ls.start=ts.start),ls.cache={}}),ss},pe$1=function(ss,ts){let rs=ts.pool(),ns=ss.terms(),is=rs.get(ns[0].prev)||{},as=rs.get(ns[ns.length-1].next)||{};ns[0].implicit&&is.implicit&&(is.set(is.implicit),is.post+=" "),function(os,ls,us,cs){let ps=os.parents();ps.push(os),ps.forEach(ds=>{let fs=ds.list.find(hs=>hs.hasId(ls));fs&&(fs.length-=us,fs.start===ls&&(fs.start=cs.id),fs.cache={})}),os.list=os.list.filter(ds=>!(!ds.start||!ds.length))}(ts,ss.start,ss.length,as),is&&(is.next=as.id),as&&(as.prev=is.id)};le$1.append=function(ss,ts){return de$1(this,ss,ts),this},le$1.prepend=function(ss,ts){return ge$1(this,ss,ts),this},le$1.delete=function(ss){return pe$1(this,ss),this},le$1.replace=function(ss,ts){let rs=this.length;de$1(this,ss,ts);let ns=this.buildFrom(this.start,this.length);ns.length=rs,pe$1(ns,ts)},le$1.splitOn=function(ss){let ts=this.terms(),rs={before:null,match:null,after:null},ns=ts.findIndex(ls=>ls.id===ss.start);if(ns===-1)return rs;let is=ts.slice(0,ns);is.length>0&&(rs.before=this.buildFrom(is[0].id,is.length));let as=ts.slice(ns,ns+ss.length);as.length>0&&(rs.match=this.buildFrom(as[0].id,as.length));let os=ts.slice(ns+ss.length,ts.length);return os.length>0&&(rs.after=this.buildFrom(os[0].id,os.length,this.pool)),rs};var me$2={json:function(ss={},ts){let rs={};return ss.text&&(rs.text=this.text()),ss.normal&&(rs.normal=this.text("normal")),ss.clean&&(rs.clean=this.text("clean")),ss.reduced&&(rs.reduced=this.text("reduced")),ss.implicit&&(rs.implicit=this.text("implicit")),ss.root&&(rs.root=this.text("root")),ss.trim&&(rs.text&&(rs.text=rs.text.trim()),rs.normal&&(rs.normal=rs.normal.trim()),rs.reduced&&(rs.reduced=rs.reduced.trim())),ss.terms&&(ss.terms===!0&&(ss.terms={}),rs.terms=this.terms().map(ns=>ns.json(ss.terms,ts))),rs}},fe$1={lookAhead:function(ss){ss||(ss=".*");let ts=this.pool,rs=[];const ns=function(os){let ls=ts.get(os);ls&&(rs.push(ls),ls.prev&&ns(ls.next))};let is=this.terms(),as=is[is.length-1];return ns(as.next),rs.length===0?[]:this.buildFrom(rs[0].id,rs.length).match(ss)},lookBehind:function(ss){ss||(ss=".*");let ts=this.pool,rs=[];const ns=function(as){let os=ts.get(as);os&&(rs.push(os),os.prev&&ns(os.prev))};let is=ts.get(this.start);return ns(is.prev),rs.length===0?[]:this.buildFrom(rs[rs.length-1].id,rs.length).match(ss)}},be$1=Object.assign({},ie$1,oe$1,se$1,le$1,me$2,fe$1),ye$1={},ve$1,we$1=function(ss,ts){if(ts.length===0)return!0;for(let rs=0;rs<ts.length;rs+=1){let ns=ts[rs];if(ns.optional!==!0&&ns.negative!==!0&&ns.start===!0&&rs>0||ns.anything===!0&&ns.negative===!0)return!0}return!1},ke$1={};(ve$1=ke$1).getGreedy=function(ss,ts){let rs=Object.assign({},ss.regs[ss.r],{start:!1,end:!1}),ns=ss.t;for(;ss.t<ss.terms.length;ss.t+=1){if(ts&&ss.terms[ss.t].doesMatch(ts,ss.start_i+ss.t,ss.phrase_length))return ss.t;let is=ss.t-ns+1;if(rs.max!==void 0&&is===rs.max)return ss.t;if(ss.terms[ss.t].doesMatch(rs,ss.start_i+ss.t,ss.phrase_length)===!1)return rs.min!==void 0&&is<rs.min?null:ss.t}return ss.t},ve$1.greedyTo=function(ss,ts){let rs=ss.t;if(!ts)return ss.terms.length;for(;rs<ss.terms.length;rs+=1)if(ss.terms[rs].doesMatch(ts,ss.start_i+rs,ss.phrase_length)===!0)return rs;return null},ve$1.isEndGreedy=function(ss,ts){if(ss.end===!0&&ss.greedy===!0&&ts.start_i+ts.t<ts.phrase_length-1){let rs=Object.assign({},ss,{end:!1});if(ts.terms[ts.t].doesMatch(rs,ts.start_i+ts.t,ts.phrase_length)===!0)return!0}return!1},ve$1.doOrBlock=function(ss,ts=0){let rs=ss.regs[ss.r],ns=!1;for(let is=0;is<rs.choices.length;is+=1){let as=rs.choices[is];if(ns=as.every((os,ls)=>{let us=0,cs=ss.t+ls+ts+us;if(ss.terms[cs]===void 0)return!1;let ps=ss.terms[cs].doesMatch(os,cs+ss.start_i,ss.phrase_length);if(ps===!0&&os.greedy===!0)for(let ds=1;ds<ss.terms.length;ds+=1){let fs=ss.terms[cs+ds];if(fs){if(fs.doesMatch(os,ss.start_i+ds,ss.phrase_length)!==!0)break;us+=1}}return ts+=us,ps}),ns){ts+=as.length;break}}return ns&&rs.greedy===!0?ve$1.doOrBlock(ss,ts):ts},ve$1.doAndBlock=function(ss){let ts=0;return ss.regs[ss.r].choices.every(rs=>{let ns=rs.every((is,as)=>{let os=ss.t+as;return ss.terms[os]!==void 0&&ss.terms[os].doesMatch(is,os,ss.phrase_length)});return ns===!0&&rs.length>ts&&(ts=rs.length),ns})===!0&&ts},ve$1.getGroup=function(ss,ts,rs){if(ss.groups[ss.groupId])return ss.groups[ss.groupId];const ns=ss.terms[ts].id;return ss.groups[ss.groupId]={group:String(rs),start:ns,length:0},ss.groups[ss.groupId]};const Ae$1=t$1,De=ke$1;var $e$1=function(ss,ts,rs,ns){let is={t:0,terms:ss,r:0,regs:ts,groups:{},start_i:rs,phrase_length:ns,hasGroup:!1,groupId:null,previousGroup:null};for(;is.r<ts.length;is.r+=1){let as=ts[is.r];if(is.hasGroup=typeof as.named=="string"||typeof as.named=="number",is.hasGroup===!0){const us=ts[is.r-1];us&&us.named===as.named&&is.previousGroup?is.groupId=is.previousGroup:(is.groupId=Ae$1(as.named),is.previousGroup=is.groupId)}if(!is.terms[is.t]){if(ts.slice(is.r).some(us=>!us.optional)===!1)break;return null}if(as.anything===!0&&as.greedy===!0){let us=De.greedyTo(is,ts[is.r+1]);if(us===null||us===0||as.min!==void 0&&us-is.t<as.min)return null;if(as.max!==void 0&&us-is.t>as.max){is.t=is.t+as.max;continue}is.hasGroup===!0&&(De.getGroup(is,is.t,as.named).length=us-is.t),is.t=us;continue}if(as.choices!==void 0&&as.operator==="or"){let us=De.doOrBlock(is);if(us){if(as.negative===!0)return null;is.hasGroup===!0&&(De.getGroup(is,is.t,as.named).length+=us),is.t+=us;continue}if(!as.optional)return null}if(as.choices!==void 0&&as.operator==="and"){let us=De.doAndBlock(is);if(us){if(as.negative===!0)return null;is.hasGroup===!0&&(De.getGroup(is,is.t,as.named).length+=us),is.t+=us;continue}if(!as.optional)return null}let os=is.terms[is.t],ls=os.doesMatch(as,is.start_i+is.t,is.phrase_length);if(as.anything===!0||ls===!0||De.isEndGreedy(as,is)){let us=is.t;if(as.optional&&ts[is.r+1]&&as.negative)continue;if(as.optional&&ts[is.r+1]){let cs=os.doesMatch(ts[is.r+1],is.start_i+is.t,is.phrase_length);if(as.negative||cs){let ps=is.terms[is.t+1];ps&&ps.doesMatch(ts[is.r+1],is.start_i+is.t,is.phrase_length)||(is.r+=1)}}if(is.t+=1,as.end===!0&&is.t!==is.terms.length&&as.greedy!==!0||as.greedy===!0&&(is.t=De.getGreedy(is,ts[is.r+1]),is.t===null||as.min&&as.min>is.t||as.end===!0&&is.start_i+is.t!==ns))return null;if(is.hasGroup===!0){const cs=De.getGroup(is,us,as.named);is.t>1&&as.greedy?cs.length+=is.t-us:cs.length++}}else{if(as.negative){let us=Object.assign({},as);if(us.negative=!1,is.terms[is.t].doesMatch(us,is.start_i+is.t,is.phrase_length)===!0)return null}if(as.optional!==!0){if(is.terms[is.t].isImplicit()&&ts[is.r-1]&&is.terms[is.t+1]){if(is.terms[is.t-1]&&is.terms[is.t-1].implicit===ts[is.r-1].word)return null;if(is.terms[is.t+1].doesMatch(as,is.start_i+is.t,is.phrase_length)){is.t+=2;continue}}return null}}}return{match:is.terms.slice(0,is.t),groups:is.groups}},Pe$1=function(ss,ts,rs){if(!rs||rs.length===0)return rs;if(ts.some(ns=>ns.end)){let ns=ss[ss.length-1];rs=rs.filter(({match:is})=>is.indexOf(ns)!==-1)}return rs};const Ee$1=/(?:^|\s)([\!\[\^]*(?:<[^<]*>)?\/.*?[^\\\/]\/[\?\]\+\*\$~]*)(?:\s|$)/,He=/([\!\[\^]*(?:<[^<]*>)?\([^\)]+[^\\\)]\)[\?\]\+\*\$~]*)(?:\s|$)/,je$1=/ /g,Ne$1=ss=>/^[\!\[\^]*(<[^<]*>)?\//.test(ss)&&/\/[\?\]\+\*\$~]*$/.test(ss),xe$1=function(ss){return ss=(ss=ss.map(ts=>ts.trim())).filter(ts=>ts)};var Fe$1=function(ss){let ts=ss.split(Ee$1),rs=[];ts.forEach(is=>{Ne$1(is)?rs.push(is):rs=rs.concat(is.split(He))}),rs=xe$1(rs);let ns=[];return rs.forEach(is=>{(as=>/^[\!\[\^]*(<[^<]*>)?\(/.test(as)&&/\)[\?\]\+\*\$~]*$/.test(as))(is)||Ne$1(is)?ns.push(is):ns=ns.concat(is.split(je$1))}),ns=xe$1(ns),ns};const Ce$1=/\{([0-9]+,?[0-9]*)\}/,Be=/&&/,Ge=new RegExp(/^<\s*?(\S+)\s*?>/),ze$1=function(ss){return ss[ss.length-1]},Ie=function(ss){return ss[0]},Oe$1=function(ss){return ss.substr(1)},Te=function(ss){return ss.substr(0,ss.length-1)},Ve$1=function(ss){return ss=Oe$1(ss),ss=Te(ss)},Me$1=function(ss){let ts={};for(let ns=0;ns<2;ns+=1){if(ze$1(ss)==="$"&&(ts.end=!0,ss=Te(ss)),Ie(ss)==="^"&&(ts.start=!0,ss=Oe$1(ss)),(Ie(ss)==="["||ze$1(ss)==="]")&&(ts.named=!0,Ie(ss)==="["?ts.groupType=ze$1(ss)==="]"?"single":"start":ts.groupType="end",ss=(ss=ss.replace(/^\[/,"")).replace(/\]$/,""),Ie(ss)==="<")){const is=Ge.exec(ss);is.length>=2&&(ts.named=is[1],ss=ss.replace(is[0],""))}if(ze$1(ss)==="+"&&(ts.greedy=!0,ss=Te(ss)),ss!=="*"&&ze$1(ss)==="*"&&ss!=="\\*"&&(ts.greedy=!0,ss=Te(ss)),ze$1(ss)==="?"&&(ts.optional=!0,ss=Te(ss)),Ie(ss)==="!"&&(ts.negative=!0,ss=Oe$1(ss)),Ie(ss)==="("&&ze$1(ss)===")"){Be.test(ss)?(ts.choices=ss.split(Be),ts.operator="and"):(ts.choices=ss.split("|"),ts.operator="or"),ts.choices[0]=Oe$1(ts.choices[0]);let is=ts.choices.length-1;ts.choices[is]=Te(ts.choices[is]),ts.choices=ts.choices.map(as=>as.trim()),ts.choices=ts.choices.filter(as=>as),ts.choices=ts.choices.map(as=>as.split(/ /g).map(Me$1)),ss=""}if(Ie(ss)==="/"&&ze$1(ss)==="/")return ss=Ve$1(ss),ts.regex=new RegExp(ss),ts;if(Ie(ss)==="~"&&ze$1(ss)==="~")return ss=Ve$1(ss),ts.soft=!0,ts.word=ss,ts}return Ce$1.test(ss)===!0&&(ss=ss.replace(Ce$1,(ns,is)=>{let as=is.split(/,/g);return as.length===1?(ts.min=Number(as[0]),ts.max=Number(as[0])):(ts.min=Number(as[0]),ts.max=Number(as[1]||999)),ts.greedy=!0,ts.optional=!0,""})),Ie(ss)==="#"?(ts.tag=Oe$1(ss),ts.tag=(rs=ts.tag).charAt(0).toUpperCase()+rs.substr(1),ts):Ie(ss)==="@"?(ts.method=Oe$1(ss),ts):ss==="."?(ts.anything=!0,ts):ss==="*"?(ts.anything=!0,ts.greedy=!0,ts.optional=!0,ts):(ss&&(ss=(ss=ss.replace("\\*","*")).replace("\\.","."),ts.word=ss.toLowerCase()),ts);var rs},Je=Fe$1,Le=Me$1,Se=function(ss,ts={}){return ss.filter(rs=>rs.groupType).length>0&&(ss=function(rs){let ns,is=!1,as=-1;for(let os=0;os<rs.length;os++){const ls=rs[os];ls.groupType!=="single"||ls.named!==!0?(ls.groupType==="start"&&(is=!0,typeof ls.named=="string"||typeof ls.named=="number"?ns=ls.named:(as+=1,ns=as)),is&&(ls.named=ns),ls.groupType==="end"&&(is=!1)):(as+=1,ls.named=as)}return rs}(ss)),ts.fuzzy||(ss=function(rs){return rs.map(ns=>{if(ns.choices!==void 0&&ns.choices.every(is=>{if(is.length!==1)return!1;let as=is[0];return as.word!==void 0&&as.negative!==!0&&as.optional!==!0&&as.method!==!0})===!0){let is={};ns.choices.forEach(as=>{is[as[0].word]=!0}),ns.fastOr=is,delete ns.choices}return ns})}(ss)),ss};var _e=function(ss,ts={}){if(ss==null||ss==="")return[];if(typeof ss=="object"){if(function(ns){return Object.prototype.toString.call(ns)==="[object Array]"}(ss)){if(ss.length===0||!ss[0])return[];if(typeof ss[0]=="object")return ss;if(typeof ss[0]=="string")return function(ns){return[{choices:ns.map(is=>[{word:is}]),operator:"or"}]}(ss)}return ss&&ss.isA==="Doc"?function(ns){if(!ns||!ns.list||!ns.list[0])return[];let is=[];return ns.list.forEach(as=>{let os=[];as.terms().forEach(ls=>{os.push(ls.id)}),is.push(os)}),[{idBlocks:is}]}(ss):[]}typeof ss=="number"&&(ss=String(ss));let rs=Je(ss);return rs=rs.map(ns=>Le(ns)),rs=Se(rs,ts),rs=function(ns,is){return is.fuzzy===!0&&(is.fuzzy=.85),typeof is.fuzzy=="number"&&(ns=ns.map(as=>(is.fuzzy>0&&as.word&&(as.fuzzy=is.fuzzy),as.choices&&as.choices.forEach(os=>{os.forEach(ls=>{ls.fuzzy=is.fuzzy})}),as))),ns}(rs,ts),rs};const Ke=we$1,qe=$e$1,We=Pe$1,Re=_e,Ue=function(ss,ts){let rs=[],ns=ts[0].idBlocks;for(let is=0;is<ss.length;is+=1)ns.forEach(as=>{as.length!==0&&as.every((os,ls)=>ss[is+ls].id===os)&&(rs.push({match:ss.slice(is,is+as.length)}),is+=as.length-1)});return rs};var Qe=function(ss,ts,rs=!1){if(typeof ts=="string"&&(ts=Re(ts)),Ke(ss,ts)===!0)return[];const ns=ts.filter(os=>os.optional!==!0&&os.negative!==!0).length;let is=ss.terms(),as=[];if(ts[0].idBlocks){let os=Ue(is,ts);if(os&&os.length>0)return We(is,ts,os)}if(ts[0].start===!0){let os=qe(is,ts,0,is.length);return os&&os.match&&os.match.length>0&&(os.match=os.match.filter(ls=>ls),as.push(os)),We(is,ts,as)}for(let os=0;os<is.length&&!(os+ns>is.length);os+=1){let ls=qe(is.slice(os),ts,os,is.length);if(ls&&ls.match&&ls.match.length>0&&(os+=ls.match.length-1,ls.match=ls.match.filter(us=>us),as.push(ls),rs===!0))return We(is,ts,as)}return We(is,ts,as)};const Ze=Qe,Xe=Qe,Ye=function(ss,ts){let rs={};Ze(ss,ts).forEach(({match:os})=>{os.forEach(ls=>{rs[ls.id]=!0})});let ns=ss.terms(),is=[],as=[];return ns.forEach(os=>{rs[os.id]!==!0?as.push(os):as.length>0&&(is.push(as),as=[])}),as.length>0&&is.push(as),is};ye$1.match=function(ss,ts=!1){let rs=Xe(this,ss,ts);return rs=rs.map(({match:ns,groups:is})=>{let as=this.buildFrom(ns[0].id,ns.length,is);return as.cache.terms=ns,as}),rs},ye$1.has=function(ss){return Xe(this,ss,!0).length>0},ye$1.not=function(ss){let ts=Ye(this,ss);return ts=ts.map(rs=>this.buildFrom(rs[0].id,rs.length)),ts},ye$1.canBe=function(ss,ts){let rs=[],ns=this.terms(),is=!1;for(let as=0;as<ns.length;as+=1){let os=ns[as].canBe(ss,ts);os===!0&&(is===!0?rs[rs.length-1].push(ns[as]):rs.push([ns[as]]),is=os)}return rs=rs.filter(as=>as.length>0).map(as=>this.buildFrom(as[0].id,as.length)),rs};const et=be$1,tt=ye$1;class rt{constructor(ts,rs,ns){this.start=ts,this.length=rs,this.isA="Phrase",Object.defineProperty(this,"pool",{enumerable:!1,writable:!0,value:ns}),Object.defineProperty(this,"cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"groups",{enumerable:!1,writable:!0,value:{}})}}rt.prototype.buildFrom=function(ss,ts,rs){let ns=new rt(ss,ts,this.pool);return rs&&Object.keys(rs).length>0?ns.groups=rs:ns.groups=this.groups,ns},Object.assign(rt.prototype,tt),Object.assign(rt.prototype,et);const at={term:"terms"};Object.keys(at).forEach(ss=>rt.prototype[ss]=rt.prototype[at[ss]]);var nt=rt;class it{constructor(ts={}){Object.defineProperty(this,"words",{enumerable:!1,value:ts})}add(ts){return this.words[ts.id]=ts,this}get(ts){return this.words[ts]}remove(ts){delete this.words[ts]}merge(ts){return Object.assign(this.words,ts.words),this}stats(){return{words:Object.keys(this.words).length}}}it.prototype.clone=function(){let ss=Object.keys(this.words).reduce((ts,rs)=>{let ns=this.words[rs].clone();return ts[ns.id]=ns,ts},{});return new it(ss)};var ot=it,st=ss=>{ss.forEach((ts,rs)=>{rs>0&&(ts.prev=ss[rs-1].id),ss[rs+1]&&(ts.next=ss[rs+1].id)})};const lt=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,ut=/\S/,ct=/[ .][A-Z]\.? *$/i,ht=/(?:\u2026|\.{2,}) *$/,dt=/((?:\r?\n|\r)+)/,gt=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,pt=/^\s+/,mt=function(ss,ts,rs,ns){if(ns.hasLetter=function(os,ls){return ls||gt.test(os)}(ts,ns.hasLetter),!ns.hasLetter||function(os,ls){return ls.indexOf(".")!==-1&&ct.test(os)}(ss,ts)||function(os,ls){return ls.indexOf(".")!==-1&&ht.test(os)}(ss,ts))return!1;let is=ss.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),as=is[is.length-1].toLowerCase();return!rs.hasOwnProperty(as)};var ft=function(ss,ts){let rs=ts.cache.abbreviations;ss=ss||"";let ns=[],is=[];if(!(ss=String(ss))||typeof ss!="string"||ut.test(ss)===!1)return ns;let as=function(us){let cs=[],ps=us.split(dt);for(let ds=0;ds<ps.length;ds++){let fs=ps[ds].split(lt);for(let hs=0;hs<fs.length;hs++)cs.push(fs[hs])}return cs}(ss=ss.replace(""," "));for(let us=0;us<as.length;us++){let cs=as[us];if(cs!==void 0&&cs!==""){if(ut.test(cs)===!1){if(is[is.length-1]){is[is.length-1]+=cs;continue}if(as[us+1]){as[us+1]=cs+as[us+1];continue}}is.push(cs)}}let os=is[0]||"";const ls={hasLetter:!1};for(let us=0;us<is.length;us++){let cs=is[us];is[us+1]&&mt(cs,os,rs,ls)===!1?(os=is[us+1]||"",is[us+1]=cs+os):cs&&cs.length>0&&(ns.push(cs),os=is[us+1]||"",ls.hasLetter=!1),is[us]=""}if(ns.length===0)return[ss];for(let us=1;us<ns.length;us+=1){let cs=ns[us].match(pt);cs!==null&&(ns[us-1]+=cs[0],ns[us]=ns[us].replace(pt,""))}return ns};const bt=/\S/,yt=/^[!?.]+$/,vt=/(\S+)/,wt=/[a-z] ?\/ ?[a-z]*$/;let kt=[".","?","!",":",";","-","","","--","...","(",")","[","]",'"',"'","`"];kt=kt.reduce((ss,ts)=>(ss[ts]=!0,ss),{});const At=function(ss){return/^(re|un|micro|macro|trans|bi|mono|over)-?[^aeiou]./.test(ss)===!0||/^([a-z\u00C0-\u00FF/]+)(-||)(like|ish|less|able)/i.test(ss)===!0?!1:/^([a-z\u00C0-\u00FF`"'/]+)(-||)([a-z0-9\u00C0-\u00FF].*)/i.test(ss)===!0?!0:/^([0-9]{1,4})(-||)([a-z\u00C0-\u00FF`"'/-]+$)/i.test(ss)===!0},Dt=function(ss){let ts=[];const rs=ss.split(/[-]/);let ns="-",is=ss.match(/[-]/);is&&is[0]&&(ns=is);for(let as=0;as<rs.length;as++)as===rs.length-1?ts.push(rs[as]):ts.push(rs[as]+ns);return ts},$t=ne$1,Pt=nt,Et=ot,Ht=st,jt=ft,Nt=function(ss){let ts=[],rs=[];if(typeof(ss=ss||"")=="number"&&(ss=String(ss)),function(as){return Object.prototype.toString.call(as)==="[object Array]"}(ss))return ss;const ns=ss.split(vt);for(let as=0;as<ns.length;as++)At(ns[as])!==!0?rs.push(ns[as]):rs=rs.concat(Dt(ns[as]));let is="";for(let as=0;as<rs.length;as++){let os=rs[as];bt.test(os)===!0&&kt.hasOwnProperty(os)===!1&&yt.test(os)===!1?(ts.length>0?(ts[ts.length-1]+=is,ts.push(os)):ts.push(is+os),is=""):is+=os}return is&&(ts.length===0&&(ts[0]=""),ts[ts.length-1]+=is),ts=function(as){for(let os=1;os<as.length-1;os++)wt.test(as[os])&&(as[os-1]+=as[os]+as[os+1],as[os]=null,as[os+1]=null);return as}(ts),ts=function(as){const os=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?(-||) ?$/,ls=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let us=0;us<as.length-1;us+=1)as[us+1]&&os.test(as[us])&&ls.test(as[us+1])&&(as[us]=as[us]+as[us+1],as[us+1]=null);return as}(ts),ts=ts.filter(as=>as),ts};var xt=function(ss="",ts,rs){let ns=null;return typeof ss!="string"&&(typeof ss=="number"?ss=String(ss):function(is){return Object.prototype.toString.call(is)==="[object Array]"}(ss)&&(ns=ss)),ns=ns||jt(ss,ts),ns=ns.map(is=>Nt(is)),rs=rs||new Et,ns.map(is=>{is=is.map(os=>{let ls=new $t(os);return rs.add(ls),ls}),Ht(is);let as=new Pt(is[0].id,is.length,rs);return as.cache.terms=is,as})};const Ft=ne$1,Ct=nt,Bt=ot,Gt=st;var zt=function(ss,ts){let rs=new Bt;return ss.map((ns,is)=>{let as=ns.terms.map((os,ls)=>{let us=new Ft(os.text);return us.pre=os.pre!==void 0?os.pre:"",os.post===void 0&&(os.post=" ",ls>=ns.terms.length-1&&(os.post=". ",is>=ns.terms.length-1&&(os.post="."))),us.post=os.post!==void 0?os.post:" ",os.tags&&os.tags.forEach(cs=>us.tag(cs,"",ts)),rs.add(us),us});return Gt(as),new Ct(as[0].id,as.length,rs)})};const It=["Person","Place","Organization"],Ot=["Noun","Verb","Adjective","Adverb","Value","QuestionWord"],Tt={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adverb:"cyan"},Vt=function(ss){return Object.keys(ss).forEach(ts=>{ss[ts].color?ss[ts].color=ss[ts].color:Tt[ts]?ss[ts].color=Tt[ts]:ss[ts].isA.some(rs=>!!Tt[rs]&&(ss[ts].color=Tt[rs],!0))}),ss},Mt=function(ss){return Object.keys(ss).forEach(ts=>{let rs=ss[ts],ns=rs.isA.length;for(let is=0;is<ns;is++){let as=rs.isA[is];ss[as]&&(rs.isA=rs.isA.concat(ss[as].isA))}rs.isA=function(is){return is.filter((as,os,ls)=>ls.indexOf(as)===os)}(rs.isA)}),ss},Jt=function(ss){let ts=Object.keys(ss);return ts.forEach(rs=>{let ns=ss[rs];ns.notA=ns.notA||[],ns.isA.forEach(is=>{if(ss[is]&&ss[is].notA){let as=typeof ss[is].notA=="string"?[ss[is].isA]:ss[is].notA||[];ns.notA=ns.notA.concat(as)}});for(let is=0;is<ts.length;is++){const as=ts[is];ss[as].notA.indexOf(rs)!==-1&&ns.notA.push(as)}ns.notA=function(is){return is.filter((as,os,ls)=>ls.indexOf(as)===os)}(ns.notA)}),ss},Lt=function(ss){let ts=Object.keys(ss);return ts.forEach(rs=>{let ns=ss[rs];ns.lineage=[];for(let is=0;is<ts.length;is++)ss[ts[is]].isA.indexOf(rs)!==-1&&ns.lineage.push(ts[is])}),ss};var St=function(ss){return ss=function(ts){return Object.keys(ts).forEach(rs=>{let ns=ts[rs];ns.isA=ns.isA||[],typeof ns.isA=="string"&&(ns.isA=[ns.isA]),ns.notA=ns.notA||[],typeof ns.notA=="string"&&(ns.notA=[ns.notA])}),ts}(ss),ss=Mt(ss),ss=Jt(ss),ss=Vt(ss),ss=Lt(ss)};const _t={Noun:{notA:["Verb","Adjective","Adverb"]},Singular:{isA:"Noun",notA:"Plural"},ProperNoun:{isA:"Noun"},Person:{isA:["ProperNoun","Singular"],notA:["Place","Organization","Date"]},FirstName:{isA:"Person"},MaleName:{isA:"FirstName",notA:["FemaleName","LastName"]},FemaleName:{isA:"FirstName",notA:["MaleName","LastName"]},LastName:{isA:"Person",notA:["FirstName"]},NickName:{isA:"Person",notA:["FirstName","LastName"]},Honorific:{isA:"Noun",notA:["FirstName","LastName","Value"]},Place:{isA:"Singular",notA:["Person","Organization"]},Country:{isA:["Place","ProperNoun"],notA:["City"]},City:{isA:["Place","ProperNoun"],notA:["Country"]},Region:{isA:["Place","ProperNoun"]},Address:{isA:"Place"},Organization:{isA:["Singular","ProperNoun"],notA:["Person","Place"]},SportsTeam:{isA:"Organization"},School:{isA:"Organization"},Company:{isA:"Organization"},Plural:{isA:"Noun",notA:["Singular"]},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun",notA:It},Actor:{isA:"Noun",notA:It},Activity:{isA:"Noun",notA:["Person","Place"]},Unit:{isA:"Noun",notA:It},Demonym:{isA:["Noun","ProperNoun"],notA:It},Possessive:{isA:"Noun"}},Kt={Verb:{notA:["Noun","Adjective","Adverb","Value","Expression"]},PresentTense:{isA:"Verb",notA:["PastTense","FutureTense"]},Infinitive:{isA:"PresentTense",notA:["PastTense","Gerund"]},Imperative:{isA:"Infinitive"},Gerund:{isA:"PresentTense",notA:["PastTense","Copula","FutureTense"]},PastTense:{isA:"Verb",notA:["FutureTense"]},FutureTense:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb",notA:["Infinitive"]},PerfectTense:{isA:"Verb",notA:"Gerund"},Pluperfect:{isA:"Verb"},Participle:{isA:"PastTense"},PhrasalVerb:{isA:"Verb"},Particle:{isA:"PhrasalVerb"},Auxiliary:{notA:["Noun","Adjective","Value"]}},qt={Value:{notA:["Verb","Adjective","Adverb"]},Ordinal:{isA:"Value",notA:["Cardinal"]},Cardinal:{isA:"Value",notA:["Ordinal"]},Fraction:{isA:"Value",notA:["Noun"]},RomanNumeral:{isA:"Cardinal",notA:["Ordinal","TextValue"]},TextValue:{isA:"Value",notA:["NumericValue"]},NumericValue:{isA:"Value",notA:["TextValue"]},Money:{isA:"Cardinal"},Percent:{isA:"Value"}},Wt={Adjective:{notA:["Noun","Verb","Adverb","Value"]},Comparable:{isA:["Adjective"]},Comparative:{isA:["Adjective"]},Superlative:{isA:["Adjective"],notA:["Comparative"]},NumberRange:{},Adverb:{notA:["Noun","Verb","Adjective","Value"]},Date:{notA:["Verb","Adverb","Preposition","Adjective"]},Month:{isA:["Date","Singular"],notA:["Year","WeekDay","Time"]},WeekDay:{isA:["Date","Noun"]},Timezone:{isA:["Date","Noun"],notA:["Adjective","ProperNoun"]},Time:{isA:["Date"],notA:["AtMention"]},Determiner:{notA:Ot},Conjunction:{notA:Ot},Preposition:{notA:Ot},QuestionWord:{notA:["Determiner"]},Currency:{isA:["Noun"]},Expression:{notA:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{notA:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email"]},PhoneNumber:{notA:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{isA:["Noun"],notA:["HashTag","Verb","Adjective","Value","Email"]},Emoji:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Email:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{notA:["Plural","RomanNumeral"]},Negative:{notA:["Noun","Adjective","Value"]},Condition:{notA:["Verb","Adjective","Noun","Value"]}},Rt=St,Ut=function(ss,ts){Object.keys(ss).forEach(rs=>{ts[rs]=ss[rs]})};var Qt=(()=>{let ss={};return Ut(_t,ss),Ut(Kt,ss),Ut(qt,ss),Ut(Wt,ss),ss=Rt(ss),ss})();const Zt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",Xt=Zt.split("").reduce(function(ss,ts,rs){return ss[ts]=rs,ss},{});var Yt=function(ss){if(Xt[ss]!==void 0)return Xt[ss];let ts=0,rs=1,ns=36,is=1;for(;rs<ss.length;ts+=ns,rs++,ns*=36);for(let as=ss.length-1;as>=0;as--,is*=36){let os=ss.charCodeAt(as)-48;os>10&&(os-=7),ts+=os*is}return ts};const er=function(ss,ts,rs){const ns=Yt(ts);return ns<ss.symCount?ss.syms[ns]:rs+ns+1-ss.symCount};var tr=function(ss){const ts={nodes:ss.split(";"),syms:[],symCount:0};return ss.match(":")&&function(rs){const ns=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let is=0;is<rs.nodes.length;is++){const as=ns.exec(rs.nodes[is]);if(!as){rs.symCount=is;break}rs.syms[Yt(as[1])]=Yt(as[2])}rs.nodes=rs.nodes.slice(rs.symCount,rs.nodes.length)}(ts),function(rs){const ns=[],is=(as,os)=>{let ls=rs.nodes[as];ls[0]==="!"&&(ns.push(os),ls=ls.slice(1));const us=ls.split(/([A-Z0-9,]+)/g);for(let cs=0;cs<us.length;cs+=2){const ps=us[cs],ds=us[cs+1];if(!ps)continue;const fs=os+ps;if(ds===","||ds===void 0){ns.push(fs);continue}const hs=er(rs,ds,as);is(hs,fs)}};return is(0,""),ns}(ts)};const rr={Comparative:"truebetter",Superlative:"trueearlier",PresentTense:"trueis,sounds",Value:"truea few",Noun:"truea5b4c2f1here,ie,lit,m0no doubt,pd,tce;a,d;t,y;a,ca,o0;l,rp;a,l;d,l,rc",Copula:"truea1is,w0;as,ere;m,re",PastTense:"truebe3came,d2had,lied,meant,sa2taken,w0;as,e0;nt,re;id;en,gan",Condition:"trueif,lest,unless",Preposition:"true'o,-,aLbIcHdGexcept,fFiDmidQnotwithstandiRoBpSqua,sAt6u3vi2w0;/o,hereNith0;!in,oR;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oJ;ans,ince,o that;',f0n2ut;!f;f,n0;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;sides,tween;ri6;',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut",Gerund:"trueaccord0be0develop0go0result0stain0;ing",Negative:"truen0;ever,o0;!n,t",QuestionWord:"truehow3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Plural:"truerecords",Conjunction:"true&,aFbBcuz,how9in caEno8o7p5supposing,t2v1wh0yet;eth9ile;ers4s;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh",Abbreviation:"truea0Jb0Gc0Ad08e05f02g01h00iYjWkanVlTmNnKoJpFque,rDs8t6u5v2w0;is0r,y0B;!c;a,b,e1i0ol,s,t;tro,vo;r,t;niv,safa,t;ce,e0;l,mp,nn,x;ask,e2fc,gt,i1q,r,s,t,u0;pt,rg;r,tu;c,nJp0;!t;b,d,e0;pGs,v;a,d,ennNhd,l,p,r1s0vt;!eud;ef,o0;b,f,n;ct,kla,nt;e0ov;b0e;!r;a4d,essrs,i1lle,me,r7s0t;!tr;n1s0;c,ter;!n;!j,r,sc;at,it,lb,ng,t0;!d;!s;an,d,r,u0;l,n;a,da,e,n0;c,f;on,wy;a,en,ov;e1ig,l0m,r,t,y;!a;b,m;a,g,ng,s1tc,x0;!p;p,q,t;ak,e0ist,r;c,f,pt,t;a3ca,l,m2o0pl,res,yn;!l0m1nn,rp;!o;dr;!l0pt;!if;a,c,l1r0;ig,os;!dg,vd;d4l3p2r1ss0tty,ug,ve;n,t;c,iz;prox,r,t;!ta;!j,m,v",Pronoun:"true'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!'s",Singular:"true0:16;1:13;2:19;a16b0Tc0Kd0De0Af05g00hWiVjel0kitty,lTmPnOoNpHquestionGrEs9t6u4w3;ay,om03;nc10s 3;doll0Lst0N; rex,a4h3ic,ragedy,v show;ere,i2;l0x return;i6ky,omeoNt3uper bowl,yst15;ep4ri2u3;de0Yff;faTmoT;st1ze;al0i2o3;om,se;! mark;a7i1la6r4u3;dQrpoI;e3ie0Hobl0V;roga00ss releaG;te,y1;rt,te0N;bjWceJthers,verview;othi2umb1;a5ee08o3;del,m3nopo0rni2th1;!my;n,yf0;i3unch;ne;ci2nsect;ead start,o3uman right;l0me4u3;se;! run;adf0entlem6irl02laci1od,rand4u3;l0y; slam,fa3mo3;th1;an;a6ella,ly,ol0r4un3;di2;ee market,iWo3;nti1sP;mi0th1;conomy,gg,ner7ven4x3;ampTecu9;i2t;ad8e5inn1o3ragonf0ude;cumentGg3i0l0or;gy;ath,t3;ec3;tive;!dy;a9eili2h7i5o3redit card;ttage,u3;ri1sin;ty,vil w3;ar;andeli1ocol3;ate;n3rF;ary;aCel0lesJo8r5u3;n3tterf0;ti2;eakfa4o3;!th1;st;dy,tt5y3;!fri3;end;le;nki2r3;ri1;er;d5l0noma0u3;nt;ly; homin5verti3;si2;ng;em",FemaleName:"true0:J3;1:J7;2:IG;3:IF;4:IX;5:IK;6:JO;7:H0;8:JG;9:JK;A:HN;B:HY;C:IT;D:IP;E:JD;F:HC;G:I0;aGRbFLcDPdCYeBOfB4gADh9Ti9Gj8Gk7Gl60m49n3No3Jp37qu36r2Ds16t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof2;e3Uf2la,ra;h3iKlIna,ynH;ab,ep;da,ma;da,h3iHra;nab;aKeJi0Fol5BuIvH;etAonDO;i0na;le0sen2;el,gm3Jn,rGJs8W;aoHme0nyi;m62yAE;aMendDYhiDFiH;dele8lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;cIktoriBMlAole7viH;anC3enJ0;kF9tor2;da,lA9nus,rHs0;a,nHoniH4;a,iFQ;leHnesH4;nIHrH;i1y;g8rHxH5;su5te;aYeUhRiNoLrIuHy3;i,la;acIZiHu0L;c2na,sH;hBPta;nHr0H;iBNya;aJffaEOnHs6;a,gtiH;ng;!nFQra;aIeHomasi0;a,l9Po8Ares1;l2ndolwethu;g9Go88rIssH;!a,ie;eHi,ri9;sa,za;bPlNmLnJrIs6tHwa0;ia0um;a63yn;iHya;a,ka,s6;arB6e3iHmEDra;!ka;a,iH;a,t6;at6it6;a0Fcarlet3We0BhXiTkye,neza0oRtNuIyH;bIBlvi1;e,ha,mayIEni7sIzH;an3MetAie,y;anHi9;!a,e,nH;aDe;aJeH;fHl5GphH;an4;cHZr5;b2fiA8m0OnHphi1;d3ia,ja,ya;er3lJmon1nIobh8PtH;a,i;dy;lEPv2;aMeIirHo0risF7y5;a,lDK;ba,e0i5lJrH;iHrDOyl;!d8Hfa;ia,lDX;hd,iMki3nJrIu0w0yH;la,ma,na;i,le8on,ron;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye81vH;da,inj;e0ife;en1i0ma;anA5bNd3Nh1RiBkMlLmJndIrHs6vannaD;aDi0;ra,y;aHi3;nt6ra;lDKma,ome;ee0in8Ru3;in1ri0;a05e00hYiVoIuH;by,thDH;bScRghQl2KnPsJwIxH;anAXie,y;an,e0;aIeHie,lE; merBLann9ll1marDBt7;!lHnn1;iHyn;e,nH;a,d9K;da,i,na;ayy8D;hel62io;bDKer7yn;a,cIkHmas,n9Fta,ya;ki,o;helGki;ea,iannGDoH;da,n1K;an0bJem9Agi0iInHta,y0;a88ee;han83na;a,eH;cEAkaD;bi0chIe,i0mo0nHquEKvCy0;di,ia;aEIelHiB;!e,le;een4ia0;aNeMhKipaluk,oJrHute66;iHudenCQ;scil3LyamvaB;lly,rt2;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r5t3;ige,m0TnKo5rvaDGtIulH;a,etAin1;ricHsy,tBY;a,e,ia;do3i06;ctav2dIfCZis6lHphCZumC3yunbileg;a,ga,iv2;eHvAC;l2tA;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aDeCma;ll1mi;aNcLhariBOkKlaJna,sHta,vi;anHha;ur;!y;a,iDTki;hoGk9VolH;a,eDJ;!mh;hir,lHna,risFsreC;!a,lBT;asuLdKh2i6CnJomi9rgEPtHzanin zah3;aHhal4;li1s6;cy,etA;a,e8iEV;nngu30;a09ckenz4e01iMoJrignayani,uriDDyH;a,rH;a,lNna,tG;bi0i3llBInH;a,iH;ca,ka,qD3;a,cTkaSlNmi,nLrItzi,yH;ar;aIiam,lH;anEO;!l,nB;dy,eHh,n4;nhGrva;aKdJiCPlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5EgNi,lKrH;edi79iIjem,on,yH;em,l;em,sF;an4iHliF;nHsCE;a,da;!an,han;b0DcASd0Be,g09ha,i08ja,l06n04rLsoum60tKuIv82x9IyHz4;a,bell,ra,soB9;de,rH;a,eC;h8Fild1t4;a,cYgUiKjor4l7Sn4s6tJwa,yH;!aHbe6Wja8lAE;m,nBH;a,ha,in1;!aJbCBeIja,lEna,sHt64;!a,ol,sa;!l1H;! Jh,mInH;!a,e,n1;!awit,i;aliAHcJeduarBfernIjHlui5Y;o6Ful2;anB;ecil2la3;arJeIie,oHr44ueriA;!t;!ry;et42i37;el4Ui76y;dHon,ue5;akran7y;ak,en,iHk,lo3O;a,ka,nB;a,re,s4te;daHg4;!l3A;alEd4elHge,isDBon0;ei8in1yn;el,le;a0Ne0CiYoQuLyH;d2la,nH;!a,dIeBGnHsCL;!a,eBF;a,sCJ;aCWcJel0PiFlIna,pHz;e,i7;a,u,wa;iHy;a0Se,ja,l2JnB;is,l1SrJttIuHvel4;el5is1;e,ie;aKeIi9na,rH;a86i9;lHn1t7;ei;!in1;aSbb9CdRepa,lMnJsIv2zH;!a,be5LetAz4;a,etA;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lHy;iHy;aA0e;!aH;!n5F;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx4y5;iHt4;c2t2;e2LlCG;la,nHra;a,ie,o3;a,or1;a,gh,laH;!ni;!h,nH;a,d3e,n5P;cOdon97iNkes6mi9Ana,rMtJurIvHxmi,y5;ern1in2;a,e54ie,yn;as6iIoH;nya,ya;fa,s6;a,isF;a,la;ey,ie,y;a04eZhXiOlAKoNrJyH;lHra;a,ee,ie;istHy6D;a,en,iIyH;!na;!e,n59;nul,ri,urtnB0;aOerNlAZmJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stC;!na,ra;aHei3ongordzol;dij1w5;el7QiKjsi,lJnIrH;a,i,ri;d3na,za;ey,i,lBDs4y;ra,s6;bi7cAJdiat7IeB2iRlQmPnyakuma19rNss6KtKvi7yH;!e,lH;a,eH;e,i8L;a6DeIhHi4NlEri0y;ar6Ber6Bie,leCrB2y;!lyn8Gri0;a,en,iHl5Soli0yn;!ma,n3VsF;a5il1;ei8Ei,l4;a,tl6L;a07eYiVoNuH;anLdKliHst63;a8HeHsF;!n8tH;!a,te;e5Ji3Jy;a,i7;!anNcelEd6RelGhan7RlLni,sIva0yH;a,ce;eHie;fHlEph5U;a,in1;eHie;en,n1;!a,e,n41;lHng;!i1ClH;!i1B;anMle0nJrIsH;i8Csi8C;i,ri;!a,elGif2CnH;a,etAiHy;!e,f2A;a,e8EiInH;a,e8DiH;e,n1;cMd1mi,nIque4Xsmin3Ovie3y8zH;min9;a9eIiH;ce,e,n1s;!lHsFt0F;e,le;inIk4lEquelH;in1yn;da,ta;lRmPnOo0rNsIvaHzaro;!a0lu,na;aJiIlaHob84;!n9N;do3;!belHdo3;!a,e,l39;a77en1i0ma;a,di3es,gr6Yji;a8elBogH;en1;a,e8iHo0se;a0na;aSeOiJoHusFyacin2B;da,ll4rten23snH;a,i9Q;lImaH;ri;aIdHlaI;a,egard;ry;ath1CiJlInriet7rmi8sH;sa,t1B;en2Sga,mi;di;bi2Dil8IlNnMrJsItHwa,yl8Iz7H;i5St4;n5Yti;iHmo51ri52;etH;!te;aDnaD;a,ey,l4;a03eXiSlQoOrKunJwH;enHyne1Q;!dolE;ay,el;acIetHiselB;a,chC;e,ieH;!la;ld1AogooH;sh;adys,enHor2yn2H;a,da,na;aKgi,lIna,ov89selHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald3Pi,m3Ctru8B;etAi4W;a,eHna;s26vieve;ma;bIil,le,mHrnet,yG;al5Ni5;i5FrielH;a,l1;aVeSiRloOoz2rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0O;n1s61;!ca;!rH;a,encH;e,ia;en,o0;lIn0rnH;!anB;ec2ic2;jr,n7rKtHy9;emIiHma,ouma7;ha,ma,n;eh;ah,iBrah,za0;cr4Nd0Ne0Mi0Lk7l04mWn4YrTsNtMuLvH;aJelIiH;!e,ta;in0Gyn;!ngel2S;geni1la,ni45;h5Sta;mLperanKtH;eIhHrel5;er;l30r9;za;a,eralB;iHma,nest2Jyn;cHka,n;a,ka;a,eMiJmH;aHie,y;!li8;lHn1;ee,iHy;a,e,ja;lHrald;da,y;aWeUiNlMma,no3oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c2da,f,nMsJzaH;!betHve7;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a;!in1na;leCs6;vi;eIiHna,wi0;e,th;l,n;aYeMh2iLjeneKoHul30;lor5Tminiq4In3FrHtt4;a,eCis,la,othHthy;ea,y;ba;an0AnaDon8x4ya;anQbPde,eOiMja,lJmetr2nHsir5K;a,iH;ce,se;a,iIla,orHphi8;es,is;a,l6D;dHrdH;re;!d5Cna;!b2HoraDra;a,d3nH;!a,e;hl2i0l0HmNnLphn1rIvi1XyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,etAiH;!ca,el1Cka,z;arHia;is;a0Se0Oh05i03lVoKrIynH;di,th2;istHy05;al,i0;lPnMrIurH;tn1E;aJd2NiHn2Nri8;!nH;a,e,n1;!l1X;cepci59n4sH;tanHuelo;ce,za;eHleC;en,tA;aJeoIotH;il51;!pat3;ir9rJudH;etAiH;a,ne;a,e,iH;ce,sZ;a3er3ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Ren,iHy;!an1e,n1;deJlseIrH;!i9yl;a,y;li8;nMrH;isKlImH;ai8;a,eHotA;n1tA;!sa;d3elGtH;al,elG;cIlH;esAi44;el2ilH;e,ia,y;itlZlYmilXndWrOsMtHy5;aKeJhHri0;erHleCrEy;in1;ri0;li0ri0;a33sH;a32ie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,o7y;ne,y;na,sF;a0Hi0H;a,e,l1;is7l4;in,yn;a0Ie02iZlXoUrH;andSeQiJoIyH;an0nn;nwEok9;an3DdgLg0XtH;n2XtH;!aInH;ey,i,y;ny;etH;!t9;an0e,nH;da,na;i9y;bbi9glarIlo05nH;i7n4;ka;ancHossom,ythe;a,he;an17lja0nHsm3I;i7tH;ou;aUcky,linTni7rPssOtJulaDvH;!erlH;ey,y;hJsy,tH;e,iHy9;e,na;!anH;ie,y;!ie;nHt6yl;adIiH;ce;etAi8;ay,da;!triH;ce,z;rbJyaH;rmH;aa;a3ie,o3ra;a2Sb2Md23g1Zi1Qj5l16m0Xn09oi,r04sUtTuPvOwa,yIzH;ra,u0;aKes6gJlIseH;!l;in;un;!nH;a,na;a,i2Ir2J;drJgus1RrIsteH;ja;el2;a,ey,i,y;aahua,he0;hIi2Gja,mi7s2DtrH;id;aMlIraqHt21;at;eIi9yH;!n;e,iHy;gh;!nH;ti;iJleIo6pi7;ta;en,n1tA;aHelG;!n1J;a00dje5eYgUiSjQnJohito,toHya;inetAnH;el5ia;!aKeIiHmJ;e,ka;!mHtA;ar4;!belIliFmU;sa;!le;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tA;te;! JbImHstasiNya;ar2;el;cla3jul2pau5;aLberKeliJiHy;e,l2naH;!ta;a,ja;!ly;hGiIl2nB;da;a,ra;le;aWba,ePiMlKma,thJyH;a,c2sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c2is6jaKksaKna,sJxH;aHia;!nd3;ia,saH;nd3;ra;ia;i0nIyH;ah,na;a,is,naDoud;la;c6da,leCmNnLsH;haDlH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lEsH;on;yn;!lH;i8yn;ne;aKbIiHrL;!gaK;ey,i9y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Actor:"trueaJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJecretary,oldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt",Honorific:"truea01bYcQdPeOfiJgIhon,jr,king,lHmCoffic00p7queen,r3s0taoiseach,vice6;e1fc,gt,ir,r,u0;ltRpt,rg;cond liInBrgeaJ;abbi,e0;ar1p9s,v0;!erend; admirX;astOhd,r0vt;esideDi1of0;!essM;me mini4nce0;!ss;a3essrs,i2lle,me,r1s0;!tr;!s;stK;gistrate,j,r6yF;i3lb,t;en,ov;eld mar3rst l0;ady,i0;eutena0;nt;shG;sq,xcellency;et,oct6r,utchess;apt6hance4mdr,o0pl;lonel,m2ngress0unci3;m0wom0;an;dr,mand5;ll0;or;!ain;ldg,rig0;!adi0;er;d0sst,tty,yatullah;j,m0v;!ir0;al",SportsTeam:"true0:1A;1:1H;2:1G;a1Eb16c0Td0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Bm01newToQpJqueens parkIreal salt lake,sAt5utah jazz,vancouver whitecaps,w3yW;ashington 3est ham0Rh10;natio1Oredski2wizar0W;ampa bay 6e5o3;ronto 3ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasC;buccanee0ra0K;a7eattle 5heffield0Kporting kansas0Wt3;. louis 3oke0V;c1Frams;marine0s3;eah15ounG;cramento Rn 3;antonio spu0diego 3francisco gJjose earthquak1;char08paA; ran07;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat1steele0;il3oenix su2;adelphia 3li1;eagl1philNunE;dr1;akland 3klahoma city thunder,rlando magic;athle0Mrai3;de0; 3castle01;england 7orleans 6york 3;city fc,g4je0FknXme0Fred bul0Yy3;anke1;ian0D;pelica2sain0C;patrio0Brevolut3;ion;anchester Be9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Fvi3;kings;imberwolv1wi2;rewe0uc0K;dolphi2heat,marli2;mphis grizz3ts;li1;cXu08;a4eicesterVos angeles 3;clippe0dodDla9; galaxy,ke0;ansas city 3nE;chiefs,roya0E; pace0polis colU;astr06dynamo,rockeTtexa2;olden state warrio0reen bay pac3;ke0;.c.Aallas 7e3i05od5;nver 5troit 3;lio2pisto2ti3;ge0;broncZnuggeM;cowbo4maver3;ic00;ys; uQ;arCelKh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki1;brow2cavalie0india2;bengaWre3;ds;arlotte horAicago 3;b4cubs,fire,wh3;iteB;ea0ulR;diff3olina panthe0; c3;ity;altimore 9lackburn rove0oston 5rooklyn 3uffalo bilN;ne3;ts;cel4red3; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 3;brav1falco2h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls",Uncountable:"true0:1J;a1Qb1Ic19d16e0Zf0Tg0Mh0Hi0Dj0Cknowled1Pl07mXnWoVpRrMsBt6vi5w1;a3ea0Ai2oo1;d,l;ldlife,ne;rmth,t0;neg16ol0Btae;e4h3oothpaste,r1una;affSou1;ble,sers,t;ermod1Lund0;a,nnis;a9cene09eri0Wh8il7kittl0Wnow,o6p4t2u1;g0Znshi0P;ati1Ke1;am,el;ace1De1;ci0Red;ap,cc0;k,v0;eep,ingl0O;d0Cfe17l1nd,tish;m10t;a4e2ic1;e,ke0L;c1laxa0Hsearch;ogni0Grea0G;bi0Hin;aOe3hys17last8o1ress03;l1rk,w0;it15y9;a11trY;bstetr13il,xygen;ational securi0Vews;a8e6ilk,o3u1;mps,s1;ic;n1o0G;ey,o1;gamy;a1chan0V;sl03t;chine1il,themat0T; learn09ry;aught0e3i2ogi0Qu1;ck,g0G;ce,ghtn06ngui0OteratL;a1isK;th0;ewel8usti0J;ce,mp1nformaStself;a1ortan0H;ti1;en0F;a4isto3o1;ck1mework,n1spitali09;ey;ry;ir,libut,ppiB;ene4o2r1um,ymna0B;aAound;l1ssip;d,f; 1t08;editOpo1;ol;i5lour,o2urnit1;ure;od,rgive1uri0wl;ne1;ss;c7sh;conomZduca6lectr5n3quip4thZvery1;body,o1thF;ne;joy1tertain1;ment;iciNonU;tiG;ar2iabet1raugh2;es;ts;a8elcius,h4ivPl3o1urrency;al,ld w1nfusiBttB;ar;assMoth3;aos,e1;e2w1;ing;se;r5sh;a5eef,i2lood,owls,read,utt0;er;lliar2s1;on;ds;g1ss;ga1;ge;c6dvi5ero3ir2mnes1rt,thlet8;ty;craft;b5d1naut5;ynam4;ce;id,ou1;st1;ics",Infinitive:"true0:6S;1:76;2:5C;3:74;4:73;5:67;6:6F;7:6Y;8:6Q;9:72;A:70;B:5X;C:6X;D:6L;E:77;F:5B;a6Kb66c57d4De3Xf3Jg3Dh37i2Uj2Sk2Ql2Hm26n23o1Yp1Jr0Rs06tYuTvOwHyG;awn,e31ield;aJe1Zhist6iIoGre6D;nd0rG;k,ry;pe,sh,th0;lk,nHrGsh,tDve;n,raE;d0t;aJiHoG;te,w;eGsC;!w;l6Jry;nHpGr4se;gra4Pli41;dGi9lo5Zpub3Q;erGo;mi5Cw1I;aMeLhKig5SoJrHuGwi7;ne,rn;aGe0Mi5Uu7y;de,in,nsf0p,v5J;r2ZuD;ank,reatB;nd,st;ke pa53lk,rg1Qs9;aZcWeVhTi4Dkip,lSmRnee3Lo52pQtJuGwitD;bmCck,ff0gge7ppHrGspe5;ge,pri1rou4Zvi3;ly,o36;aLeKoJrHuG;dy,mb6;aFeGi3;ngthBss,tD;p,re;m,p;in,ke,r0Qy;la58oil,rink6;e1Zi6o3J;am,ip;a2iv0oG;ck,rtBut;arDem,le5n1r3tt6;aHo2rG;atDew;le,re;il,ve;a05eIisk,oHuG;in,le,sh;am,ll;a01cZdu8fYgXje5lUmTnt,pQquPsKtJvGwa5V;eGiew,o36;al,l,rG;se,t;aFi2u44;eJi7oItG;!o2rG;i5uc20;l3rt;mb6nt,r3;e7i2;air,eHlGo43r0K;a8y;at;aFemb0i3Zo3;aHeGi3y;a1nt;te,x;a5Dr0J;act1Yer,le5u1;a13ei3k5PoGyc6;gni2Cnci6rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlOoMrIuG;b21ll,mp,rGsh;cha1s4Q;ai1eIiEoG;cGdu8greAhibCmi1te7vi2W;eAlaim;di5pa2ss,veE;iEp,rtr46sGur;e,t;aHead,uG;g,n4;n,y;ck,le;fo34mCsi7;ck,iErt4Mss,u1;bJccur,ff0pera9utweIverGwe;co47lap,ta22u1wG;helm;igh;ser3taF;eHotG;e,i8;ed,gle5;aMeLiIoHuG;ltip3Grd0;nit13ve;nHrr12sreprG;eseE;d,g6us;asu2lt,n0Nr4;intaFna4rHtG;ch,t0;ch,kGry;et;aMeLiJoGu1C;aHck,oGve;k,sB;d,n;ft,g35ke,mCnk,st2YveG;!n;a2Fc0Et;b0Nck,uG;gh,nD;iGno34;ck,ll,ss;am,oFuG;d4mp;gno2mQnGss3H;cOdica9flu0MhNsKtIvG;eGol3;nt,st;erGrodu8;a5fe2;i7tG;aGru5;ll;abCibC;lu1Fr1D;agi24pG;lemeEo22ro3;aKeIi2oHuG;nt,rry;n02pe,st;aGlp;d,t;nd6ppBrm,te;aKloAove1PrIuG;arGeAi15;ant39d;aGip,ow,umb6;b,sp;in,th0ze;aReaQiOlMoJrHuncG;ti3J;acGeshB;tu2;cus,lHrG;ce,eca7m,s30;d,l24;a1ZoG;at,od,w;gu2lGni1Xt,x;e,l;r,tu2;il,stBvG;or;a15cho,le5mSnPstNvalua9xG;a0AcLerKi7pGte19;a18eHi2laFoGreA;rt,se;ct,riG;en8;ci1t;el,han4;abGima9;li1J;ab6couXdHfor8ga4han8j03riDsu2t0vG;isi2Vy;!u2;body,er4pG;hasiGow0;ze;a07eUiLoKrHuG;mp;aHeAiG;ft;g,in;d4ubt;ff0p,re5sHvG;iZor8;aKcHliGmiApl1Btingui14;ke;oGuA;uGv0;ra4;gr1YppG;ear,ro3;cOeNfLliv0ma0Fny,pKsHterG;mi0G;cribe,er3iHtrG;oy;gn,re;a0Be0Ai5osC;eGi0By;at,ct;m,pB;iIlHrG;ea1;a2i06;de;ma4n8rGte;e,kB;a0Ae09h06i9l04oJrG;aHeGoAu0Hy;a9dC;ck,ve;llZmSnHok,py,uGv0;gh,nt;cePdu5fMsKtIvG;eGin8;rt,y;aFin0VrG;a7ibu9ol;iGtitu9;d0st;iHoGroE;rm;gu2rm;rn;biLfoKmaJpG;a2laF;in;re;nd;rt;ne;ap1e5;aGip,o1;im,w;aHeG;at,ck,w;llen4n4r4se;a1nt0;ll,ncIrGt0u1;eGry;!en;el;aSePloOoMrIuG;lGry;ly;igHuG;sh;htB;en;a7mb,o7rrGth0un8;ow;ck;ar,lHnefCtrG;ay;ie3ong;ng,se;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waC;acIeHra5;ct;m0Fnd;h,k;k,sG;eIiHocia9uG;me;gn,st;mb6rt;le;chHgGri3;ue;!i3;eaJlIroG;aDve;ch;aud,y;l,r;noun8sw0tG;icipa9;ce;lHt0;er;e4ow;ee;rd;aRdIju7mCoR;it;st;!reA;ss;cJhie3knowled4tiva9;te;ge;ve;eIouEu1;se;nt;pt;on",Unit:"true0:19;a14b12c0Od0Ne0Lf0Gg0Ch09in0Hjoule0k02l00mNnMoLpIqHsqCt7volts,w6y4z321;g,s;c,f,n;b,e2;a0Nb,d0Dears old,o1;tt0H;att0b;able4b3d,e2on1sp;!ne0;a2r0D;!l,sp;spo04; ft,uare 1;c0Id0Hf3i0Fkilo0Jm1ya0E;e0Mil1;e0li0H;eet0o0D;t,uart0;ascals,e2i1ou0Pt;c0Mnt0;rcent,t02;hms,uYz;an0JewtT;/s,b,e9g,i3l,m2p1,;h,s;!;!/h,cro5l1;e1li08;! pFs1;! 1;anEpD;g06s0B;gQter1;! 2s1;! 1;per second;b,i00m,u1x;men0x0;b,elvin0g,ilo2m1nR;!/h,ph,;byZgXmeter1;! p2s1;! p1;er1; hour;e1g,r0z;ct1rtz0;aXogQ;al2b,igAra1;in0m0;!l1;on0;a4emtPl2t1;,; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!,;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s",Organization:"true0:46;a3Ab2Qc2Ad21e1Xf1Tg1Lh1Gi1Dj19k17l13m0Sn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0Xou1w0X;gov,tu2S;a3e1orld trade organizati41;lls fargo,st1;fie22inghou16;l1rner br3D;-m11gree31l street journ25m11;an halNeriz3Wisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Rps;es35i1;lev2Xted natio2Uv; mobi2Kaco bePd bMeAgi frida9h3im horto2Tmz,o1witt2W;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen33daily ma2Xguess w2holli0rolling st1Ms1w2;mashing pumpki2Ouprem0;ho;ea1lack eyed pe3Fyrds;ch bo1tl0;ys;l2s1;co,la m12;efoni07us;a6e4ieme2Gnp,o2pice gir5ta1ubaru;rbucks,to2N;ny,undgard1;en;a2Rx pisto1;ls;few25insbu26msu1X;.e.m.,adiohead,b6e3oyal 1yan2X;b1dutch she4;ank;/max,aders dige1Ed 1vl32;bu1c1Uhot chili peppe2Klobst28;ll;c,s;ant2Vizno2F;an5bs,e3fiz24hilip morrBi2r1;emier27octer & gamb1Rudenti14;nk floyd,zza hut;psi28tro1uge08;br2Qchina,n2Q; 2ason1Xda2G;ld navy,pec,range juli2xf1;am;us;a9b8e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0K;l,s;c,st1Etflix,w1; 1sweek;kids on the block,york08;a,c;nd1Us2t1;ional aca2Fo,we0Q;a,cYd0O;aAcdonald9e5i3lb,o1tv,yspace;b1Nnsanto,ody blu0t1;ley crue,or0O;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;'s,s;c's milk,tt13z1Y;'ore09a3e1g,ittle caesa1Ktd;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1K;art;iffy lu0Lo3pmorgan1sa;! cha1;se;hnson & johns1Sy d1R;bm,hop,n1tv;c,g,te1;l,rpol; & m,asbro,ewlett-packaTi3o1sbc,yundai;me dep1n1J;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Iu1;cci,ns n ros0;ldman sachs,o1;dye1g0B;ar;axo smith kliZencore;electr0Im1;oto0V;a3bi,da,edex,i1leetwood mac,oGrito-l0A;at,nancial1restoV; tim0;cebook,nnie mae;b06sa,u3xxon1; m1m1;ob0H;!rosceptics;aiml0Ae5isney,o3u1;nkin donuts,po0Wran dur1;an;j,w j1;on0;a,f leppa3ll,p2r spiegZstiny's chi1;ld;eche mode,t;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra05;al;!ca c5l4m1o0Ast05;ca2p1;aq;st;dplMgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Hy;dbury,pital o1rl's jr;ne;aGbc,eCfAl6mw,ni,o2p,r1;exiteeWos;ei3mbardiJston 1;glo1pizza;be;ng;ack & deckFo2ue c1;roX;ckbuster video,omingda1;le; g1g1;oodriN;cht3e ge0n & jer2rkshire hathaw1;ay;ryH;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bXcSdidRerosmith,ig,lLmFnheuser-busEol,ppleAr7s3t&t,v2y1;er;is,on;hland2s1;n,ociated F; o1;il;by4g2m1;co;os; compu2bee1;'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c",Demonym:"true0:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an",Possessive:"trueanyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne",Currency:"true$,aud,bScQdLeurKfJgbp,hkd,iIjpy,kGlEp8r7s3usd,x2y1z0,,,,,,,,,,,;lotyS;en,uanR;af,of;h0t5;e0il5;k0q0;elM;iel,oubleLp,upeeL;e2ound st0;er0;lingI;n0soH;ceGn0;ies,y;e0i8;i,mpi7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s",City:"true0:73;1:61;2:6G;3:5U;4:5R;a68b54c4Id4Ae46f3Yg3Jh38i2Zj2Uk2Dl22m1Kn19o16p0Uq0Sr0Ls01tPuOvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3J;greb,nzib5G;ang2e5okoha3Uunfu;katerin3Jrev0;a5n0O;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1K;hi5Zkl3C;l63xford;aw;a6ern2i5ladivost5Molgogr6K;en3lni6R;lenc6Dncouv2Yr3ughn;lan bat1Drumqi,trecht;aDbilisi,eCheBi9o8r7u5;l21n63r5;in,ku;ipoli,ondh62;kyo,m34ron1QulouS;an5jua3l2Zmisoa6Era3;j4Xshui; hag65ssaloni2L;gucigal28hr0l av1W;briz,i6llinn,mpe5Ang5rtu,shk2X;i2Msh0;an,chu1n0p2Iyu0;aEeDh8kopje,owe1It7u5ydney;ra5zh51;ba0Jt;aten is59ockholm,rasbou6Auttga31;an8e6i5;jiazhua1llo1m60y0;f54n5;ya1zh4L;gh3Ot4U;att4Ao1Yv49;cramen18int DlBn5o paulo,ppo3Wrajevo; 7aa,t5;a 5ia3Io domin3I;a3fe,m1O;antonCdie3Gfrancisco,j5ped3Ssalv8;o5u0;se;em,v5z2B;ad0I;lou59peters29;aAe9i7o5;me,sar5t5A;io;ga,o5yadh;! de janei3I;cife,ykjavik;b4Uip4lei2Mnc2Swalpindi;ingdao,u5;ez2i0Q;aEeDhCiBo8r7u6yong5;ya1;eb5Aya1;ag54etor53;rt5zn0; 5la4Fo;au prin0Nelizabe29sa05;ls3Srae5Ctts2B;iladelph4Ynom pe1Doenix;r26tah tik3I;ler00naji,r4Pt5;na,r36;ak47des0Lm1Rr6s5ttawa;a3Ylo;an,d07;a8ew6i5ovosibir1Oyc;ng2Hs; 5cast39;del27orlea46taip16york;g8iro4Xn5pl2Zshv36v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0Y;aFeCi9o6u5;mb2Cni28sc40;gadishu,nt6s5;c17ul;evideo,re31;ami,l6n18s5;kolc,sissauga;an,waukee;cca,d5lbour2Pmph41;an,ell5i3;in,n;cau,drAkass2Tl9n8r5shh4A;aca6ib5rakesh,se2N;or;i1Ty;a4EchEdal12i47;mo;id;aCeiAi8o6u5vRy2;anLckn0Rdhia3;n5s angel28;d2g bea1O;brev2De3Kma5nz,sb2verpo2A;!ss29;c5pzig;est0C; p6g5ho2Yn0Gusan27;os;az,la35;aHharFiClaipeBo9rak0Hu7y5;iv,o5;to;ala lump4n5;mi1sh0;be,hi0Llka2Zpavog4si5wlo2;ce;da;ev,n5rkuk;gSsha5;sa;k5toum;iv;bIdu3llakuric0Tmpa3Gn6ohsiu1ra5un1Lwaguc0T;c0Sj;d5o,p4;ah1Vy;a7e6i5ohannesZ;l1Xn0;dd37rusalem;ip4k5;ar2J;bad0mph1QnBrkutYs8ta01z5zm7;m6tapala5;pa;ir;fah0l6tanb5;ul;am2Zi2I;che2d5;ianap2Lo21;aBe8o5yder2W; chi mi6ms,nolulu,u5;st2;nh;f6lsin5rakli2;ki;ei;ifa,lifax,m7n5rb1Dva3;gAnov5oi;er;bu2Wilt2;aFdanEenDhCiPlasgBo9raz,u5;a5jr21;dal6ng5yaquil;zh1H;aja2Lupe;ld coa18then5;bu2P;ow;ent;e0Toa;sk;lw7n5za;dhi5gt1C;nag0S;ay;aisal26es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Nl paso;in5mont2;bur5;gh;aAe8ha0Visp4o7resd0Ju5;b5esseldorf,rb0shanbe;ai,l0G;ha,nggu0rtmu11;hradRl5troit;hi;donghHe5k08li0masc1Xr es sala1HugavpiY;gu,je2;aKebu,hAo5raio03uriti1P;lo7n6penhag0Ar5;do1Nk;akLst0V;gVm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;n5ttogr12;digarh,g5;ch8sha,zh06;i9lga8mayenJn6pe town,r5;acCdiff;ber18c5;un;ry;ro;aUeMhJirmingh0ToIr9u5;chareRdapeRenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil0Mtisla7zzav5;il5;le;va;goZst2;op6ubaneshw5;ar;al;iBl9ng8r5;g6l5n;in;en;aluru,hazi;fa5grade,o horizonte;st;ji1rut;ghd0BkGnAot9r7s6yan n4;ur;el,r07;celo3ranquil09;na;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a04b01cc00ddis abaZgartaYhmedWizawl,lQmNnHqaZrEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a6chora5kaNtwerp;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 8buquerq7e5giers,maty;ppo,xandr5;ia;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Country:"true0:39;1:2M;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om3DpZqat1KrXsKtCu6v4wal3yemTz2;a25imbabwe;es,lis and futu2Y;a2enezue32ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2Y;k.,s.2; 28a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Ys and caic1U; and 2-2;toba1K;go,kel0Znga;iw2Wji2nz2S;ki2U;aCcotl1eBi8lov7o5pa2Cri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Rriname;lomon1Wmal0uth 2;afr2JkLsud2P;ak0en0;erra leoEn2;gapo1Xt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele25luc0mart20;epublic of ir0Dom2Duss0w2;an26;a3eHhilippinTitcairn1Lo2uerto riM;l1rtugE;ki2Cl3nama,pua new0Ura2;gu6;au,esti2;ne;aAe8i6or2;folk1Hth3w2;ay; k2ern mariana1C;or0N;caragua,ger2ue;!ia;p2ther19w zeal1;al;mib0u2;ru;a6exi5icro0Ao2yanm05;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagasc00l6r4urit3yot2;te;an0i15;shall0Wtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed01;a5e4i2uxembourg;b2echtenste11thu1F;er0ya;ban0Hsotho;os,tv0;azakh1Ee3iriba03o2uwait,yrgyz1E;rWsovo;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an",Region:"true0:2M;1:2S;2:2J;a2Pb2Cc1Yd1Tes1Sf1Qg1Kh1Gi1Bj17k12l0Zm0On07o05pZqWrTsKtFuCv9w5y3zacatec2T;akut0o0Du3;cat2k07;a4est 3isconsin,yomi1L;bengal,vi6;rwick2Ashington3;! dc;er4i3;rgin0;acruz,mont;dmurt0t3;ah,tar3; 2Ka0W;a5e4laxca1Qripu1Wu3;scaDva;langa1nnessee,x2E;bas0Um3smNtar24;aulip2Cil nadu;a8i6o4taf10u3ylh1E;ffYrr03s19;me1Bno1Puth 3;cVdU;ber0c3kkim,naloa;hu2ily;n4skatchew2xo3;ny; luis potosi,ta catari1;a3hode9;j3ngp06;asth2shahi;ingh24u3;e3intana roo;bec,en5reta0Q;ara7e5rince edward3unjab; i3;sl0A;i,nnsylv3rnambu0A;an0;!na;axa0Xdisha,h3klaho1Zntar3reg6ss0Ax0F;io;aIeDo5u3;evo le3nav0V;on;r3tt16va scot0;f8mandy,th3; 3ampton15;c5d4yo3;rk13;ako1M;aroli1;olk;bras1Lva0Bw3; 4foundland3;! and labrador;brunswick,hamp0Wjers3mexiRyork state;ey;galOyarit;a9eghala0Mi5o3;nta1r3;dov0elos;ch5dlanCn4ss3zor11;issippi,ouri;as geraOneso18;ig2oac2;dhy12harasht0Gine,ni4r3ssachusetts;anhao,i el,ylF;p3toba;ur;anca0Ie3incoln0IouisH;e3iR;ds;a5e4h3omi;aka06ul1;ntucky,ra01;bardino,lmyk0ns0Qr3;achay,el0nata0X;alis5har3iangxi;kh3;and;co;daho,llino6n3owa;d4gush3;et0;ia1;is;a5ert4i3un2;dalFm0D;fordZ;mpYrya1waii;ansu,eorg0lou7oa,u3;an4erre3izhou,jarat;ro;ajuato,gdo3;ng;cesterS;lori3uji2;da;sex;ageTe6o4uran3;go;rs3;et;lawaLrbyK;aEeaDh8o3rimea ,umbr0;ahui6l5nnectic4rsi3ventry;ca;ut;i02orado;la;e4hattisgarh,i3uvash0;apQhuahua;chn4rke3;ss0;ya;ra;lFm3;bridge6peche;a8ihar,r7u3;ck3ryat0;ingham3;shi3;re;emen,itish columb0;h0ja cal7lk6s3v6;hkorto3que;st2;an;ar0;iforn0;ia;dygea,guascalientes,lAndhr8r4ss3;am;izo1kans4un3;achal 6;as;na;a 3;pradesh;a5ber4t3;ai;ta;ba4s3;ka;ma",Place:"truea0Eb0Bc04d03e02f00gVhUiRjfk,kOlMmJneGoFpBque,rd,s9t6u5v4w1y0;akutOyz;ake isFis1y0;!o;!c;a,ostok,t;laanbaatar,p02safa,t;ahiti,e1he 0;bronx,hamptons;nn,x;a0fo,oho,t,under7yd;khalNsk;a2e1h0itcairn;l,x;k,nnN;!cif04;kla,nt,rd;b1w eng0;land;!r;a1co,i0t,uc;dNnn;gadZlibu,nhattZ;a0gw,hr;s,x;an1osrae,rasnoyar0ul;sk;!s;a1cn,da,nd0st;ianRochina;!x;arlem,kg,nd,oHwy;a3re0;at 0enwich;brita0lakH;in;!y village;co,l0ra;!a;urope,vergladC;ak,en,fw,ist,own4xb;al5dg,gk,h2l1o0rA;lo,nn;!t;a1ina0uuk;town;morro,tham;!if;cn,e1kk,l0rooklyn;vd;l air,verly hills;frica,lta,m7n3r2sia,tl1ve,zor0;es;!ant2;ct1iz;adyr,tarct0;ic0; oce0;an;ericas,s",MaleName:"true0:E4;1:D5;2:DN;3:AX;4:D1;5:CF;6:B5;7:CV;8:C7;9:DJ;A:DK;B:A5;C:C1;aCNbBKcAId9Ge8Mf84g7Hh6Ti6Dj5Dk51l4Cm34n2So2Mp2Equ2Cr1Ls11t0Eu0Dv07wTxSyIzD;aDor0;cDh9Skaria,n5V;hEkD;!aCL;ar5VeCK;aLoFuD;sDu2JvBX;if,uf;nFsEusD;ouf,sD;ef;aDg;s,tD;an,h0;hli,nBLssX;avi3ho4;aMeKiFoDyaC1;jcie8Blfgang,odrow,utD;!er;lDnst1;bFey,frD0lD;aBCiD;am,e,s;e9Eur;i,nde6sD;!l8t1;de,lErrAyD;l1ne;lDt3;aA9y;aGiDladimir,ojte7Y;cEha0kt68nceDrgAIva0;!nt;e3Ut66;lentDnA4;in4X;ghBUlyss5Bnax,sm0;aXeShOiMoHrFuEyD;!l3ro7s1;n9r5B;avAVeDist0oy,um0;ntANv5Yy;bGdFmDny;!as,mDoharu;aCSie,y;!d;iBy;mDt5;!my,othy;adFeoEia8FomD;!as;!do8O;!de5;dGrD;en9KrD;an9JeDy;ll,n9I;!dy;dgh,ha,iDnn3req,tsu4S;cB4ka;aTcotRePhLiJoHpenc3tDur1Uylve9Jzym1;anFeDua8C;f0phBSvDwa8B;e61ie;!islaw,l8;lom1nBEuD;leyma7ta;dDlBm1yabonga;!dhart7An8;aFeD;lDrm0;d1t1;h7Tne,qu0Zun,wn,y7;aDbasti0k29l4Qrg4Nth,ymoAT;m5n;!tD;!ie,y;lEmDnti2Dq5Aul;!ke5LmCu4;ik,vato7W;aXeTheA9iPoHuEyD;an,ou;b7MdEf5pe7RssD;!elBY;ol3Ey;an,bJc66dIel,geHh0landBPmGnFry,sEyD;!ce;coe,s;!aAGnC;an,eo;l46r;e5Ng3n8olfo,ri79;bCeB7;cDl8;ar6Pc6OhEkDo;!ey,ie,y;a99ie;gEid,ubAx,yDza;an1InY;gA8iD;naA4s;ch70fa4lHmGndFpha4sEul,wi2HyD;an,mo82;h7Vm5;alBDol2Uy;iATon;f,ph;ent2inD;cy,t1;aIeGhilFier72ol,rD;aka16eD;m,st1;!ip,lip;dALrcy,tD;ar,e3Gr1X;b4Kdra7Ft4ZulD;!o17;ctav3Fi3liv3mAFndrej,rHsEtDum9wA;is,to;aEc9k9m0vD;al5Z;ma;i,l53vL;aLeJiFoDu3A;aDel,j5l0ma0r3K;h,m;cEg4i49kD;!au,h7Uola;holBkDolB;!olB;al,d,il,ls1vD;il8Y;hom,thD;anDy;!a4i4;aZeWiMoHuEyD;l2Jr1;hamEr6XstaD;fa,p5C;ed,mH;di0We,hamFis2FntEsDussa;es,he;e,y;ad,ed,mD;ad,ed;cIgu4hai,kGlFnEtchD;!e6;a8Aik;house,o0Bt1;ae5YeA4olD;aj;ah,hDk8;aEeD;al,l;el,l;hElv2rD;le,ri6v2;di,met;ay0ck,hTjd,ks2DlRmadWnQrKs1tFuricExD;!imilian9Nwe6;e,io;eGhEiBtDus,yB;!eo,hew,ia;eDis;us,w;j,o;cHio,kGlFqu7Dsha6tDv2;iDy;!m,n;in,on;!el,oPus;!el9IoOus;iGu4;achDcolm,ik;ai,y;amEdi,eDmoud;sh;adDm5T;ou;aXeQiOlo3EoKuEyD;le,nd1;cGiFkDth3uk;aDe;!s;gi,s,z;as,iaD;no;g0nn7SrenFuDv8Jwe6;!iD;e,s;!zo;am,oD;n4r;a8Cevi,la5JnIoGst3thaFvD;eDi;nte;bo;!nD;!a6Sel;!ny;mFnErDur5Hwr5H;ry,s;ce,d1;ar,o5A;aLeGhaled,iDrist5Iu4Vy6X;er0p,rD;by,k,ollD;os;en0iGnDrmit,v44;!dEnDt5Z;e1Ay;a6ri59;r,th;cp3j5m66na73rEsp9them,uD;ri;im,l;a02eUiSoGuD;an,lDst2;en,iD;an,en,o,us;aNeLhnKkubBnIrGsD;eEhDi8Bue;!ua;!ph;dDge;an,i,on;!aDny;h,s,th5I;!ath5Hie,nC;!l,sDy;ph;o,qu2;an,mD;!mC;d,ffIrFsD;sDus;!e;a6BemEmai7oDry;me,ni0Y;i7Ty;!e60rD;ey,y;cKdAkImHrFsEvi3yD;!dAs1;on,p3;ed,od,rDv56;e5Nod;al,es4Xis1;a,e,oDub;b,v;k,ob,quD;es;aWbQchiPgNkeMlija,nuLonut,rJsFtDv0;ai,suD;ki;aEha0i7DmaDsac;el,il;ac,iaD;h,s;a,vinDw2;!g;k,nngu5S;!r;nacDor;io;ka;ai,rahD;im;aPeJoIuDyd9;be2KgGmber4WsD;eyEsD;a2e2;in,n;h,o;m3ra3Gsse2wa4B;aHctGitGnrErD;be2Dm0;iDy;!q11;or;th;bMlLmza,nKo,rFsEyD;a4JdA;an,s0;lGo50rFuDv8;hi4Gki,tD;a,o;is1y;an,ey;k,s;!im;ib;aVeRiPlenOoLrHuD;ilEsD;!tavo;herme,lerD;mo;aFegDov3;!g,orD;io,y;dy,h5Wnt;nzaErD;an,d1;lo;!n;lbe5Ano,oD;rg3Hvan5A;ne,oFrD;aDry;ld,rd5H;ffr8rge;brElArDv2;la28r3Sth,y;e3EielD;!i5;aTePiNlLorr0NrD;anFedDitz;!dCeDri2B;ri2A;cFkD;!ie,lD;in,yn;esLisD;!co,z36;etch3oD;yd;d4lDnn,onn;ip;deriFliEng,rnD;an06;pe,x;co;bi0di,hd;ar04dZfrYit0lSmKnHo2rFsteb0th0uge7vDymAzra;an,eD;ns,re36;gi,i0DnDrol,v2w2;est4Pie;oEriqDzo;ue;ch;aJerIiEmD;aIe2Z;lErD;!h0;!iD;o,s;s1y;nu4;be0Cd1iGliFmEt1viDwood;n,s;er,o;ot1Ys;!as,j4NsD;ha;a2en;!dCg9mGoEuEwD;a2Din;arD;do;o0Wu0W;l,nD;est;a01eRiOoHrGuFwEylD;an,l0;ay7ight;a7dl8nc0st2;ag0ew;minGnEri0ugDvydBy2D;!lB;!a2MnDov0;e6ie,y;go,iDykB;cDk;!k;armuEeDll1on,rk;go;id;anKj0lbeJmetri5nHon,rGsFvEwDxt3;ay7ey;en,in;hawn,mo0B;ek,ri0I;is,nDv3;is,y;rt;!dD;re;an,lNmLnKrGvD;e,iD;! lucDd;as,ca;en,iFne6rDyl;eDin,yl;l3Bn;n,o,us;!e,i4ny;iDon;an,en,on;e,lB;as;a09e07hYiar0lNoIrGuEyrD;il,us;rtD;!is;aDistob0U;ig;dy,lGnErD;ey,neli5y;or,rD;ad;by,e,in,l2t1;aIeFiDyK;fDnt;fo0Ft1;meEt5velaD;nd;nt;rFuEyD;!t1;de;enD;ce;aIeGrisEuD;ck;!tD;i0oph3;st3;er;d,rDs;b4leD;s,y;cDdric,s9;il;lGmer1rD;ey,lEro6y;ll;!os,t1;eb,v2;a07eZiVlaUoRrEuDyr1;ddy,rtK;aLeGiFuEyD;an,ce,on;ce,no;an,ce;nEtD;!t;dEtD;!on;an,on;dEndD;en,on;!foDl8y;rd;bErDyd;is;!by;i7ke;bFlEshD;al;al,lC;ek;nHrDshoi;at,nEtD;!r1C;aDie;rd14;!edict,iEjam2nC;ie,y;to;kaMlazs,nHrD;n8rDt;eDy;tt;ey;dDeE;ar,iD;le;ar17b0Vd0Rf0Pgust2hm0Mi0Jja0Il04m00nSputsiRrIsaHuFveEyDziz;a0kh0;ry;gust5st2;us;hi;aKchJiIjun,maHnFon,tDy0;hDu09;ur;av,oD;ld;an,nd0H;!el,ki;ie;ta;aq;as,dIgel0CtD;hoGoD;i7nD;!i09y;ne;ny;er,reDy;!as,i,s,w;iFmaDos;nu4r;el;ne,r,t;an,bePdAeJfHi,lGonFphXt1vD;aNin;on;so,zo;an,en;onTrD;edU;c,jaGksandFssaGxD;!andD;er,ru;ar,er;ndD;ro;rtN;ni;dAm9;ar;en;ad,eD;d,t;in;onD;so;aEi,olfDri0vik;!o;mDn;!a;dHeGraEuD;!bakr,lfazl;hDm;am;!l;allIelFoulaye,ulD;!lDrF;ah,o;! rD;ahm0;an;ah;av,on",LastName:"true0:9F;1:9V;2:9H;3:9X;4:9N;5:8J;6:9K;7:A0;8:9E;9:88;A:6E;B:77;C:6J;a9Ub8Lc7Kd6Xe6Rf6Dg5Vh58i54j4Pk45l3Nm2Rn2Eo26p1Nquispe,r17s0Ft05vVwOxNyGzD;aytsADhD;aDou,u;ng,o;aGeun7ZiDoshiA9un;!lD;diDmaz;rim,z;maDng;da,guc97mo6UsDzaB;aBhiA7;iao,u;aHeGiEoDright,u;jc8Sng;lDmm0nkl0sniewsB;liA1s3;b0iss,lt0;a5Rgn0lDng,tanabe;k0sh;aHeGiEoDukA;lk5roby5;dAllalDnogr2Zr0Zss0val37;ba,obos;lasEsel7N;lGn dFrg8EsEzD;qu7;ily9Oqu7silj9O;en b35ijk,yk;enzue95verde;aLeix1JhHi4j6ka3IoGrFsui,uD;om4ZrD;c4n0un1;an,embl8TynisB;dor95lst31m2rr9th;at5Mi7LoD;mErD;are6Ylaci64;ps3s0Y;hirAkah8Dnaka;a00chWeThPiNmKoItFuEvDzabo;en8Aobod34;ar7bot2lliv4zuB;aEein0oD;i67j3Lyan8V;l6rm0;kol5lovy5re6Psa,to,uD;ng,sa;iDy5Z;rn5tD;!h;l5YmDngh,rbu;mo6Do6J;aFeDimizu;hu,vchD;en7Cuk;la,r17;gu8mDoh,pulve8Trra4R;jDyD;on5;evi6Filtz,miDneid0roed0ulz,warz;dEtD;!z;!t;ar42h6ito,lFnDr2saBto,v2;ch7d0AtDz;a4Pe,os;as,ihAm3Zo0Q;aOeNiKoGuEyD;a66oo,u;bio,iz,sD;so,u;bEc7Bdrigue57g03j73mDosevelt,ssi,ta7Nux,w3Z;a4Be0O;ertsDins3;!on;bei0LcEes,vDzzo;as,e8;ci,hards3;ag4es,it0ut0y9;dFmEnDsmu7Zv5F;tan1;ir7os;ic,u;aSeLhJiGoErDut6;asad,if5Zochazk1W;lishc24pDrti62u55we66;e2Tov48;cEe09nD;as,to;as60hl0;aDillips;k,m,n5K;de3AetIna,rGtD;ersErovDtersC;!a,ic;en,on;eDic,ry,ss3;i8ra,tz,z;ers;h71k,rk0tEvD;ic,l3T;el,t2O;bJconnor,g2ClGnei5PrEzD;demir,turk;ella3MtDwe5N;ega,iz;iDof6GsC;vDyn1F;ei8;aPri1;aLeJguy1iFoDune44ym4;rodahl,vDwak;ak3Uik5otn56;eEkolDlsCx3;ic,ov6X;ls1miD;!n1;ils3mD;co42ec;gy,kaEray4varD;ro;jiDmu8shiD;ma;aXcVeQiPoIuD;lGnFrDssoli5T;atDpUr68;i,ov2;oz,te4B;d0l0;h4lIo0HrEsDza0Z;er,s;aFeEiDoz5r3Ete4B;!n6F;au,i8no,t4M;!l9;i2Rl0;crac5Ohhail5kke3Qll0;hmeGij0j2ElFndErci0ssiDyer19;!er;e3Bo2Z;n0Io;dAti;cartDlaughl6;hy;dMe6Dgnu5Ei0jer34kLmJnci59rFtEyD;er,r;ei,ic,su1N;iEkAqu9roqu6tinD;ez,s;a54c,nD;!o;a52mD;ad5;e5Oin1;rig4Ns1;aSeMiIoGuEyD;!nch;k2nDo;d,gu;mbarDpe2Rvr2;di;!nDu,yana1R;coln,dD;bDholm;erg;bed5TfeGhtFitn0kaEn6rDw2G;oy;!j;in1on1;bvDvD;re;iDmmy,rsCu,voie;ne,t11;aTennedy,h4iSlQnez46oJrGuEvar4woD;k,n;cerDmar58znets5;a,o2G;aDem0i2Zyeziu;sni3PvD;ch3U;bay4Frh0Jsk0TvaFwalDzl5;czDsB;yk;cFlD;!cDen3Q;huk;!ev2ic,s;e6uiveD;rt;eff0l2mu8nnun1;hn,lloe,minsBrEstra31to,ur,yDzl5;a,s0;j0GlsC;aMenLha2Pim0QoEuD;ng,r2;e2JhFnErge2Ju2NvD;anA;es,ss3;anEnsD;en,on,t3;nesDsC;en,s1;ki26s1;cGkob3RnsDrv06;en,sD;enDon;!s;ks3obs1;brahimAglesi3Ake4Ll0CnoZoneFshikEto,vanoD;u,v4A;awa;scu;aPeIitchcock,jaltal6oFrist46uD;!aDb0gh9ynh;m4ng;a23dz2fEjga2Sk,rDx3B;ak0Yvat;er,fm3B;iGmingw3NnErD;nand7re8;dDriks1;ers3;kkiEnD;on1;la,n1;dz2g1lvoLmJnsCqIrr0SsFuEyD;as36es;g1ng;anEhiD;mo0Q;i,ov08;ue;alaD;in1;rs1;aMeorgLheorghe,iJjonIoGrEuDw3;o,staf2Utierr7zm4;ayDg2iffitUub0;li1G;lub3Rme0JnD;calv9zale0I;aj,i;l,mDordaL;en7;iev3B;gnJlGmaFnd2No,rDs2Nuthi0;cDza;ia;ge;eaElD;agh0i,o;no;e,on;ab0erMiIjeldsted,lor9oGrFuD;cDent9ji3F;hs;an1Wiedm4;ntaDrt6st0urni0;na;lipEsD;ch0;ovD;!ic;hatAnandeVrD;arDei8;a,i;ov2;dHinste6riksCsDva0D;cob2ZpDtra2X;inoDosiM;za;en,s3;er,is3wards;aUeMiKjurhuJoHrisco0YuEvorakD;!oQ;arte,boEmitru,rDt2U;and,ic;is;g4he0Hmingu7n2Ord19tD;to;us;aDmitr29ssanayake;s,z; GbnaFlEmirDrvis1Lvi,w4;!ov2;gado,ic;th;bo0groot,jo03lEsilDvri9;va;a cruz,e3uD;ca;hl,mcevsBnErw6t2EviD;d5es,s;ieDku1S;ls1;ki;a05e00hNiobMlarkLoFrD;ivDuz;elli;h1lGntFop0rDs26x;byn,reD;a,ia;i,rer0O;em4liD;ns;!e;anu;aLeIiu,oGriDuJwe;stD;eDiaD;ns1;i,ng,uFwDy;!dhury;!n,onEuD;ng;!g;kEnDtterjee,v7;!d,g;ma,raboD;rty;bGl09ng2rD;eghetEnD;a,y;ti;an,ota0M;cer9lder3mpbeIrFstDvadi08;iDro;llo;doEt0uDvalho;so;so,zo;ll;es;a09eXhUiSlNoGrFyD;rne,tyD;qi;ank5iem,ooks,yant;gdan5nFruya,su,uchEyHziD;c,n5;ard;darDik;enD;ko;ov;aEondD;al;nEzD;ev2;co;ancRshwD;as;a01oDuiy4;umDwmD;ik;ckNethov1gu,ktLnJrD;gGisFnD;ascoDds1;ni;ha;er,mD;ann;gtDit7nett;ss3;asD;hi;er,ham;b2ch,ez,hMiley,kk0nHrDu0;bEnDua;es,i0;ieDosa;ri;dDik;a8yopadhyD;ay;ra;er;k,ng;ic;cosZdYguilXkhtXlSnJrGsl4yD;aEd6;in;la;aEsl4;an;ujo,ya;dFgelD;ovD;!a;ersGov,reD;aDjL;ss1;en;en,on,s3;on;eksejGiyGmeiFvD;ar7es;ez;da;ev;ar;ams;ta",WeekDay:"truefri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"trueaBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il",Date:"trueago,t2week0yesterd4; e0e0;nd;mr2o0;d0morrow;ay;!w",FirstName:"trueaLblair,cHdevGgabrieFhinaEjCk9l8m4nelly,quinn,re3s0;h0umit;ay,e0iloh;a,lby;g6ne;a1el0ina,org5;!okuh9;naia,r0;ion,lo;ashawn,uca;asCe1ir0rE;an;lsAnyat2rry;am0ess6ie,ude;ie,m5;ta;le;an,on;as2h0;arl0eyenne;ie;ey,sidy;lex2ndr1ubr0;ey;a,ea;is",Person:"trueashton kutchTbScNdLeJgastOhHinez,jFkEleDmCnettKoBp9r4s3t2v0;a0irgin maH;lentino rossi,n go3;aylor,heresa may,iger woods,yra banks;addam hussain,carlett johanssKlobodan milosevic,uC;ay romano,e3o1ush limbau0;gh;d stewart,nald0;inho,o;ese witherspoFilly;a0ipJ;lmIris hiltD;prah winfrFra;essiaen,itt romnEubarek;bron james,e;anye west,iefer sutherland,obe bryant;aime,effers8k rowli0;ng;alle ber0itlBulk hogan;ry;ff0meril lagasse,zekiel;ie;a0enzel washingt2ick wolf;lt1nte;ar1lint0;on;dinal wols1son0;! palm2;ey;arack obama,rock;er",Verb:"trueawak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en",PhrasalVerb:"true0:7L;1:79;2:7X;3:7N;4:72;5:80;6:7P;7:6V;8:78;9:7J;A:6W;B:5Z;C:7S;D:7K;a81b6Lc5Rd5Me5Lf4Kg41h3Kiron0j3Gk3Bl2Vm2Jn2Ho2Fp1Wquiet7Ar1Js0CtSuQvacuum 1wHyammer9zE;eroBip FonE;e0k0;by,up;aLeHhGiForErit5G;d 1k33;mp0n2Vpe0r7s7;eel Dip 85;aFiEn2J;gh 09rd0;n Dr E;d2in,o5J;it 61k7lk6rm 6Csh 7Nt6Qv51;rge9sE;e AherB;aTeRhPiLoJrGuEype 69;ckBrn E;d2in,o3Sup;aFiEot0y 2I;ckle6Rp 7T;ck6Qde Y;ne6Pp Es4O;d2o73up;ck GdFe Egh6Bme0p o0Gre0;aw3ba4d2in,up;e 61y 1;by,o7D;ink Erow 6D;ba4ov8up;aEe 5Zll53;m 1r X;ck9ke Flk E;ov8u54;aEba4d2in,o3Cup;ba4ft8p59w3;a0Jc0Ie0Ch08i05l01m00nZoYpTquare StKuIwE;earGiE;ngFtch E;aw3ba4o77; by;ck Eit 1m 1ss0;in,up;aJe0WiIoGrEuc3G;aigh1WiE;ke 6Gn3A;p Erm1Z;by,in,o6T;n3Br 1tc3T;c3Amp0nd Er6Zve6y 1;ba4d2up;d2o6Pup;ar37eHiGlFrEur9;ing9uc7;a3Fit 5B;l13n 1;e5Sll0;be2Wrt0;ap 4Sow D;ash 5Foke0;eep FiEow A;c3Wp 1;in,oE;ff,v8;gn 4XngFt Ez7;d2o5up; al54le0;aGoEu4T;ot Eut0w 6D;aw3ba4f3Go67;c2PdeBk58ve6;e Ill1And HtE; Etl4H;d2in,o5upE;!on;aw3ba4d2in,o27up;o5Mto;al51out0rap51;il6v7;aPeMiLoHuE;b 4Ule0n Estl7;aEba4d2in5Jo3Ut39u3S;c26w3;ll Got FuE;g2Tnd6;a27f30o5;arCin,o5;ng 53p6;aEel6inBnt0;c5Dd E;o31u0I;c24t0;aSeRiPlNoLrIsyc2HuE;ll Gt E;aEba4d2in,o1Ot3Gup;p3Lw3;ap3Kd2in,o5t3Eup;attle9ess FiHoE;p 1;ah1Oon;iEp 5Hr3Yur4Jwer 5H;nt0;ay4DuE;gBmp A;ck Eg0le9n Ap4A;o2Yup;el 4KncilB;c42ir 3Un0ss GtFy E;ba4o54; d2c24;aw3ba4o18;pEw3X;e3Wt D;arrow46erd0oE;d6te45;aMeJiIoGuE;ddl7lE;l 3I;c1Dp 1uth6ve E;al3Nd2in,o5up;ss0x 1;asur7lFss E;a1Gup;t A;ke Fn ArEs1Px0;k Ary6;do,o48up;aRePiKoEuck0;aIc3Hg HoEse0;k Ese3F;aft8ba4d2forw2Jin46ov8uE;nd8p;in,o0M;d A;e HghtGnFsEv1V;ten 4M;e 1k 1; 1e37;arCd2;av1Jt 37velE; o3U;c7p 1sh Etch9ugh6y20;in3Uo5;eFick6nock E;d2o3Q;eEyB;l 2Pp E;aw3ba4d2fTin,o07to,up;aGoFuE;ic7mpB;ke31t35;c3Azz 1;aQeLiIoFuE;nker32rry 1s0W;lEneBrse2X;d Ee 1;ba4d2fast,o01up;de Ft E;ba4on,up;aw3o5;aElp0;d Gl 2Ar Et 1;fEof;rom;in,oTu1H;c02m 1nFve Ez25;it,to;d Eg 2FkerG;d2in,o5;aTeMive Kloss 22oGrFunE; f0N;in3How 2B; Eof 21;aFb1Dit,oErCt0Pu18;ff,n,v8;bo5ft8hKw3;aw3ba4d2in,oEup,w3;ff,n,ut;aJek0t E;aFb17d2oErCup;ff,n,ut,v8;cFhEl1XrCt,w3;ead;ross;r 1;d aFnE;g 1;bo5;a08e01iSlOoKrGuE;cEel 1;k 1;eFighten Eown9y 1;aw3o2S;eEshe1N; 1z7;lGol E;aEwi1G;bo5rC;d Alow 1;aFeEip0;sh0;g Ake0mErE;e 2R;gLlJnHrFsEzzle0;h 2P;e Em 1;aw3ba4up;d0isE;h 1;e El 19;aw3fJ;ht ba4ure0;eJnFsE;s 1;cGd E;fEo25;or;e D;dVl 1;cIll Erm0t0W;ap04bGd2in,oFtE;hrough;ff,ut,v8;a4ehi20;e 0L;at0dge0nd 0Ky7;oHrE;aFess Aop E;aw3bUin,o1E;g9w9; 0Dubl7;aXhUlean AoHrEut 10;ack9eep Eoss D;by,d2oEup;n,ut;me HoFuntE; o1Q;k 1l E;d2o1I;aKbJforHin,oGtFuE;nd8;ogeth8;ut,v8;th,wE;ard;a4y;pErCw3;art;eEipB;ck Der E;on,up;lKncel0rHsGtch FveB; in;o19up;h Dt6;ry FvE;e Y;aw3o15;l Em05;aEba4d2o13up;rCw3;a0Ke0Bl04oVrJuE;bblGcklWil02lk AndlWrn 08st FtEy 13zz6;t D;in,o5up;e E;ov8;anOeaMiFush E;o0Oup;ghIng E;aFba4d2forEin,o5up;th;bo5lErCw3;ong;teE;n 1;k E;d2in,o5up;ch0;arLgKil An7oHssGttlFunce Ex D;aw3ba4;e A; arC;k Dt 1;e 1;d2up; d2;d 1;aJeed0oEurt0;cGw E;aw3ba4d2o5up;ck;k E;in,oL;ck0nk0st6; oKaHef 1nd E;d2ov8up;er;up;r0t E;d2in,oEup;ff,ut;ff,nE;to;ck Kil0nGrgFsE;h D;ain9e D;g Dk9; on;in,o5; o5;aw3d2o5up;ay;cNdJsk Guction6; oE;ff;arCo5;ouE;nd;d E;d2oEup;ff,n;own;t E;o5up;ut",Modal:"truec5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ay,ight,ust;an,o0;uld",Adjective:"true0:7P;1:84;2:83;3:8A;4:7W;5:5S;6:4N;7:4O;8:58;9:6I;A:81;a6Wb6Gc63d5Je54f4Hg49h3Wi39j37k36l2Vm2Ln2Bo1Wp1Dquack,r12s0Ft07uMvJwByear5;arp0eFholeEiDoB;man5oBu6P;d6Rzy;despr7Ls5S;!sa7;eClBste2A;co1Nl o4W;!k5;aCiBola4M;b89ce versa,ol5H;ca3gabo6Gnilla;ltUnHpCrb5Msu4tterB;!mo7G; Eb1SpDsBti1M;ca7etBide dKtairs;!ti2;er,i3U;f36to da1;aLbeco75convin29deIeHfair,ivers4knGprecedVrEsCwB;iel3Nritt6A;i1XuB;pervis0spec3Y;eBu5;cognHgul6Tl6T;own;ndi2v64xpect0;cid0rB;!grou5ZsB;iz0tood;b7pp0Dssu6UuthorB;iz0;i26ra;aGeEhDi6AoCrB;i1oubl0us3M;geth8p,rp6Vuc67;ough4Wril33;en60l32mpBrr2X;o6Ati2;boo,lBn;ent0;aWcVeThSiQmug,nobbi3LoOpNqueami3LtFuBymb6H;bDi gener5DpBrpri6D;erBre0N;! dup8b,i2C;du0seq52;anda77eGiFrBunni2y3F;aightCiB;ki2p0; fBfB;or5K;ll,r5S;aBreotyp0;dfa6Cmi2;a55ec2Gir1Hlend6Cot on; call0le,mb8phist1XrBu0Vvi48;d6Ary;gnifica3nB;ce51g7;am2Re8ocki2ut;cBda1em5lfi32ni1Wpa6Jre6;o1Er42;at5Gient28reec5G;cr0me;aJeEiCoB;bu60tt51uQy4;ghtBv4;!-2Bf9;ar,bel,condi1du6Dfres5AlEpublic42sCtard0vB;ea26;is4CoB;lu1na3;aQe1Cuc4A;b5TciBllyi2;al,st;aOeLicayu6lac5Ropuli5QrCuB;bl5Jmp0n51;eGiDoB;!b07fu5RmiBp8;ne3si2;mCor,sBva1;ti6;a53e;ci5MmB;a0EiB;er,um;ac20rBti1;feAma2XpleBv38;xi2;rBst;allelDtB;-tiBi4;me;!ed;bLffJkIld fashion0nHpGrg1Eth8utFvB;al,erB;!all,niCt,wB;eiBrouB;ght;do0Ter,g2Qsi4B;en,posi1; boa5Og2Oli6;!ay; gua5MbBli6;eat;eDsB;cBer0Eole1;e6u3O;d2Xse;aJeIiHoBua4X;nFrCtB;ab7;thB;!eB;rn;chala3descri58stop;ght5;arby,cessa44ighbor5xt;k0usia1A;aIeGiDoBultip7;bi7derBl0Vnth5ot,st;a1n;nBx0;dblo0RiaBor;tu37;ande3Qdi4NnaBre;ci2;cBgenta,in,j01keshift,le,mmoth,ny,sculi6;ab33ho;aKeFiCoBu15;uti14vi2;mCteraB;l,te;it0;ftEgBth4;al,eCitiB;ma1;nda3K;!-0C;ngu3Zst,tt8;ap1Xind5no0A;agg0uB;niMstifi0veni7;de4gno4Klleg4mQnEpso 20rB;a1rB;eleBita0J;va3; KaJbr0corIdGfluenQiQnFsEtCviB;go0Fti2;aAen3SoxB;ic3B;a6i2Vul0D;a1er,oce3;iCoB;or;reA;deq3Qppr33;fBsitu,vitro;ro3;mFpB;arDerfeAoBrop8;li1rtB;a3ed;ti4;eBi0S;d2Vn3C;aIeFiDoBumdr3I;ne36ok0rrBs08ur5;if2Z;ghfalut1QspB;an2X;aClB;liYpf9;li2;lEnDrB;d04roB;wi2;dy;f,low0;ainf9ener2Oiga24lHoGraDuB;ilBng ho;ty;cCtB;ef9is;ef9;ne,od;ea2Iob4;aTeNinMlKoFrB;a1VeDoz1MustB;raB;ti2;e2Gq10tf9;oDrB; keeps,eBm8tuna1;g03ign;liB;sh;aBue3;g31tte1P;al,i1;dFmCrB;ti7;a7ini6;ne;le; up;bl0i3l27r Cux,voB;ri1uri1;oBreac1E;ff;aLfficie3lKmHnFreAthere4veExB;aAcess,pe1QtraCuB;be2Nl0E;!va1E;n,ryday; BcouraEti0O;rou1sui1;erCiB;ne3;gi2;abo23dMe17i1;g8sB;t,ygB;oi2;er;aReJiDoBrea14ue;mina3ne,ubB;le,tf9;dact1Bfficu1OsCvB;er1K;creDeas0gruntl0hone1FordCtB;a3ressM;er5;et; HadpGfFgene1PliDrang0spe1PtCvoB;ut;ail0ermin0;be1Mca1ghB;tf9;ia3;an;facto;i5magBngeroUs0G;ed,i2;ly;ertaMhief,ivil,oDrB;aBowd0u0G;mp0vZz0;loImGnCrrBve0P;eAu1I;cre1fu0LgrDsCtB;empo0Dra0E;ta3;ue3;mer08pleB;te,x;ni4ss4;in;aNeIizarHlFoCrB;and new,isk,okN;gCna fiUttom,urgeoB;is;us;ank,indB;!i2;re;autif9hiDloCnBst,yoD;eUt;v0w;nd;ul;ckCnkru0WrrB;en;!wards; priori,b0Mc0Jd09fra08g04h03lYmWntiquVppSrMsIttracti06utheHvEwB;aCkB;wa0T;ke,re;ant garCerB;age;de;ntU;leep,piDsuDtonB;isB;hi2;ri2;ab,bitEroDtiB;fiB;ci4;ga3;raB;ry;are3etiNrB;oprB;ia1;at0;aJuB;si2;arEcohCeBiIl,oof;rt;olB;ic;mi2;ead;ainDgressiConiB;zi2;ve;st;id; IeGuFvB;aCerB;se;nc0;ed;lt;pt,qB;ua1;hoc,infinitB;um;cuCtu4u1;al;ra1;erLlKoIruHsCuB;nda3;e3oCtraA;ct;lu1rbi2;ng;te;pt;aBve;rd;aze,e;ra3;nt",Comparable:"true0:41;1:4I;2:45;3:2Y;4:4B;5:3X;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Jm1Dn17o15p0Vqu0Tr0KsTtMuIvFw7y6za13;ell27ou4;aBe9hi1Yi7r6;o4y;ck0Ode,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sK;m,y;a7e6ulgar;nge5rda2xi4;g9in,st;g0n6pco3Mse5;like0t6;i1r6;ue;aAen9hi8i7ough,r6;anqu2Oen1ue;dy,g3Sme0ny,r09;ck,n,rs2P;d40se;ll,me,rt,s6wd45;te5;aVcarUeThRiQkin0FlMmKoHpGqua1FtAu7w6;eet,ift;b7dd13per0Gr6;e,re2H;sta2Ft3;aAe9iff,r7u6;pXr1;a6ict,o4;ig3Fn0U;a1ep,rn;le,rk;e22i3Fright0;ci28ft,l7o6re,ur;n,thi4;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g35m6;!y;ek,nd3D;ck,l0mp3;a6iTort,rill,y;dy,ll0Xrp;cu0Rve0Rxy;ce,ed,y;d,fe,int0l1Vv14;aBe9i8o6ude;mantic,o1Isy,u6;gh,nd;ch,pe,tzy;a6d,mo0H;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aEhoDi1QlCoBr8u6;ny,r6;e,p3;egna2ic7o6;fouYud;ey,k0;li04or,te1B;ain,easa2;ny;in5le;dd,f6i0ld,ranQ;fi10;aAe8i7o6;b3isy,rm15sy;ce,mb3;a6w;r,t;ive,rr01;aAe8ild,o7u6;nda19te;ist,o1;a6ek,llX;n,s0ty;d,tuQ;aBeAi9o6ucky;f0Un7o1Du6ve0w17y0T;d,sy;e0g;g1Tke0tt3ve0;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti4;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b3id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te5;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t3uiY;u1y;aIeeb3iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get5mG;my;erce8n6rm;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi4;gey,lm8r6;e5i4;ful;!i4;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i4;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd",TextOrdinal:"truebGeDf9hundredHmGnin7qu6s4t0zeroH;enGh1rFwe0;lfFn9;ir0ousandE;d,t4;e0ixt9;cond,ptAvent8xtA;adr9int9;et0th;e6ie8;i2o0;r0urt3;tie5;ft1rst;ight0lev1;e0h,ie2;en1;illion0;th",Cardinal:"truebHeEf8hundred,mHnineAone,qu6s4t0zero;en,h2rGw0;e0o;lve,n8;irt9ousandEree;e0ix5;pt1ven4xt1;adr0int0;illion;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illion0;!s",Expression:"truea02b01dXeVfuck,gShLlImHnGoDpBshAtsk,u7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la",Adverb:"truea08by 06d02eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,well,ye0;p,s; to,wards5;h1iny bit,o0wiO;o,t6ward;en,us;eldom,o0uch;!me1rt0; of;hYtimes,w09;a1e0;alT;ndomSthN;ar excellDer0oint blank; Nhaps;f3n0;ce0ly;! 0;ag02moW; courIten;ewKo0; longEt 0;onIwithstanding;aybe,eanwhiAore0;!ovB;! aboU;deed,steV;en0;ce;or2u0;lArther0;!moJ; 0ev3;examp0good,suH;le;n1v0;er; mas0ough;se;e0irect1; 1finite0;ly;ju8trop;far,n0;ow; DbroCd nauseam,gBl6ny3part,s2t 0w4;be6l0mo6wor6;arge,ea5; soon,ide;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori",Determiner:"trueaBboth,d9e6few,l4mu8neiDown,plenty,s3th2various,wh0;at0ich0;evC;at,e4is,ose;everal,ome;a,e0;!ast,s;a1i6l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er"},ar=function(ss){const ts=ss.split("|").reduce((ns,is)=>{const as=is.split("");return ns[as[0]]=as[1],ns},{}),rs={};return Object.keys(ts).forEach(function(ns){const is=tr(ts[ns]);ns==="true"&&(ns=!0);for(let as=0;as<is.length;as++){const os=is[as];rs.hasOwnProperty(os)===!0?Array.isArray(rs[os])===!1?rs[os]=[rs[os],ns]:rs[os].push(ns):rs[os]=ns}}),rs};let nr={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",her:["Possessive","Pronoun"],his:["Possessive","Pronoun"],their:["Possessive","Pronoun"],themselves:["Possessive","Pronoun"],your:["Possessive","Pronoun"],our:["Possessive","Pronoun"],my:["Possessive","Pronoun"],its:["Possessive","Pronoun"]};const ir={Unit:(ss,ts)=>{ss[ts]=["Abbreviation","Unit"]},Cardinal:(ss,ts)=>{ss[ts]=["TextValue","Cardinal"]},TextOrdinal:(ss,ts)=>{ss[ts]=["Ordinal","TextValue"],ss[ts+"s"]=["TextValue","Fraction"]},Singular:(ss,ts,rs)=>{ss[ts]="Singular";let ns=rs.transforms.toPlural(ts,rs);ss[ns]=ss[ns]||"Plural"},Infinitive:(ss,ts,rs)=>{ss[ts]="Infinitive";let ns=rs.transforms.conjugate(ts,rs),is=Object.keys(ns);for(let as=0;as<is.length;as++){let os=ns[is[as]];ss[os]=ss[os]||is[as]}},Comparable:(ss,ts,rs)=>{ss[ts]="Comparable";let ns=rs.transforms.adjectives(ts),is=Object.keys(ns);for(let as=0;as<is.length;as++){let os=ns[is[as]];ss[os]=ss[os]||is[as]}},PhrasalVerb:(ss,ts,rs)=>{ss[ts]=["PhrasalVerb","Infinitive"];let ns=ts.split(" "),is=rs.transforms.conjugate(ns[0],rs),as=Object.keys(is);for(let os=0;os<as.length;os++){let ls=is[as[os]]+" "+ns[1];ss[ls]=ss[ls]||["PhrasalVerb",as[os]],rs.hasCompound[is[as[os]]]=!0}},Demonym:(ss,ts,rs)=>{ss[ts]="Demonym";let ns=rs.transforms.toPlural(ts,rs);ss[ns]=ss[ns]||["Demonym","Plural"]}},or=function(ss,ts,rs){Object.keys(ss).forEach(ns=>{let is=ss[ns];is!=="Abbreviation"&&is!=="Unit"||(rs.cache.abbreviations[ns]=!0);let as=ns.split(" ");as.length>1&&(rs.hasCompound[as[0]]=!0),ir[is]===void 0?ts[ns]!==void 0?(typeof ts[ns]=="string"&&(ts[ns]=[ts[ns]]),typeof is=="string"?ts[ns].push(is):ts[ns]=ts[ns].concat(is)):ts[ns]=is:ir[is](ts,ns,rs)})};var sr={buildOut:function(ss){let ts=Object.assign({},nr);return Object.keys(rr).forEach(rs=>{let ns=ar(rr[rs]);Object.keys(ns).forEach(is=>{ns[is]=rs}),or(ns,ts,ss)}),ts},addWords:or},lr=function(ss){let ts=ss.irregulars.nouns,rs=Object.keys(ts);for(let as=0;as<rs.length;as++){const os=rs[as];ss.words[os]="Singular",ss.words[ts[os]]="Plural"}let ns=ss.irregulars.verbs,is=Object.keys(ns);for(let as=0;as<is.length;as++){const os=is[as];ss.words[os]=ss.words[os]||"Infinitive";let ls=ss.transforms.conjugate(os,ss);ls=Object.assign(ls,ns[os]),Object.keys(ls).forEach(us=>{ss.words[ls[us]]=ss.words[ls[us]]||us,ss.words[ls[us]]==="Participle"&&(ss.words[ls[us]]=us)})}};const ur={g:"Gerund",prt:"Participle",perf:"PerfectTense",pst:"PastTense",fut:"FuturePerfect",pres:"PresentTense",pluperf:"Pluperfect",a:"Actor"};let cr={act:{a:"_or"},ache:{pst:"ached",g:"aching"},age:{g:"ageing",pst:"aged",pres:"ages"},aim:{a:"_er",g:"_ing",pst:"_ed"},arise:{prt:"_n",pst:"arose"},babysit:{a:"_ter",pst:"babysat"},ban:{a:"",g:"_ning",pst:"_ned"},be:{a:"",g:"am",prt:"been",pst:"was",pres:"is"},beat:{a:"_er",g:"_ing",prt:"_en"},become:{prt:"_"},begin:{g:"_ning",prt:"begun",pst:"began"},being:{g:"are",pst:"were",pres:"are"},bend:{prt:"bent"},bet:{a:"_ter",prt:"_"},bind:{pst:"bound"},bite:{g:"biting",prt:"bitten",pst:"bit"},bleed:{pst:"bled",prt:"bled"},blow:{prt:"_n",pst:"blew"},boil:{a:"_er"},brake:{prt:"broken"},break:{pst:"broke"},breed:{pst:"bred"},bring:{pst:"brought",prt:"brought"},broadcast:{pst:"_"},budget:{pst:"_ed"},build:{pst:"built",prt:"built"},burn:{prt:"_ed"},burst:{prt:"_"},buy:{pst:"bought",prt:"bought"},can:{a:"",fut:"_",g:"",pst:"could",perf:"could",pluperf:"could",pres:"_"},catch:{pst:"caught"},choose:{g:"choosing",prt:"chosen",pst:"chose"},cling:{prt:"clung"},come:{prt:"_",pst:"came",g:"coming"},compete:{a:"competitor",g:"competing",pst:"_d"},cost:{pst:"_"},creep:{prt:"crept"},cut:{prt:"_"},deal:{pst:"_t",prt:"_t"},develop:{a:"_er",g:"_ing",pst:"_ed"},die:{g:"dying",pst:"_d"},dig:{g:"_ging",pst:"dug",prt:"dug"},dive:{prt:"_d"},do:{pst:"did",pres:"_es"},draw:{prt:"_n",pst:"drew"},dream:{prt:"_t"},drink:{prt:"drunk",pst:"drank"},drive:{g:"driving",prt:"_n",pst:"drove"},drop:{g:"_ping",pst:"_ped"},eat:{a:"_er",g:"_ing",prt:"_en",pst:"ate"},edit:{pst:"_ed",g:"_ing"},egg:{pst:"_ed"},fall:{prt:"_en",pst:"fell"},feed:{prt:"fed",pst:"fed"},feel:{a:"_er",pst:"felt"},fight:{pst:"fought",prt:"fought"},find:{pst:"found"},flee:{g:"_ing",prt:"fled"},fling:{prt:"flung"},fly:{prt:"flown",pst:"flew"},forbid:{pst:"forbade"},forget:{g:"_ing",prt:"forgotten",pst:"forgot"},forgive:{g:"forgiving",prt:"_n",pst:"forgave"},free:{a:"",g:"_ing"},freeze:{g:"freezing",prt:"frozen",pst:"froze"},get:{pst:"got",prt:"gotten"},give:{g:"giving",prt:"_n",pst:"gave"},go:{prt:"_ne",pst:"went",pres:"goes"},grow:{prt:"_n"},guide:{pst:"_d"},hang:{pst:"hung",prt:"hung"},have:{g:"having",pst:"had",prt:"had",pres:"has"},hear:{pst:"_d",prt:"_d"},hide:{prt:"hidden",pst:"hid"},hit:{prt:"_"},hold:{pst:"held",prt:"held"},hurt:{pst:"_",prt:"_"},ice:{g:"icing",pst:"_d"},imply:{pst:"implied",pres:"implies"},is:{a:"",g:"being",pst:"was",pres:"_"},keep:{prt:"kept"},kneel:{prt:"knelt"},know:{prt:"_n"},lay:{pst:"laid",prt:"laid"},lead:{pst:"led",prt:"led"},leap:{prt:"_t"},leave:{pst:"left",prt:"left"},lend:{prt:"lent"},lie:{g:"lying",pst:"lay"},light:{pst:"lit",prt:"lit"},log:{g:"_ging",pst:"_ged"},loose:{prt:"lost"},lose:{g:"losing",pst:"lost"},make:{pst:"made",prt:"made"},mean:{pst:"_t",prt:"_t"},meet:{a:"_er",g:"_ing",pst:"met",prt:"met"},miss:{pres:"_"},name:{g:"naming"},patrol:{g:"_ling",pst:"_led"},pay:{pst:"paid",prt:"paid"},prove:{prt:"_n"},puke:{g:"puking"},put:{prt:"_"},quit:{prt:"_"},read:{pst:"_",prt:"_"},ride:{prt:"ridden"},reside:{pst:"_d"},ring:{pst:"rang",prt:"rung"},rise:{fut:"will have _n",g:"rising",prt:"_n",pst:"rose",pluperf:"had _n"},rub:{g:"_bing",pst:"_bed"},run:{g:"_ning",prt:"_",pst:"ran"},say:{pst:"said",prt:"said",pres:"_s"},seat:{pst:"sat",prt:"sat"},see:{g:"_ing",prt:"_n",pst:"saw"},seek:{prt:"sought"},sell:{pst:"sold",prt:"sold"},send:{prt:"sent"},set:{prt:"_"},sew:{prt:"_n"},shake:{prt:"_n"},shave:{prt:"_d"},shed:{g:"_ding",pst:"_",pres:"_s"},shine:{pst:"shone",prt:"shone"},shoot:{pst:"shot",prt:"shot"},show:{pst:"_ed"},shut:{prt:"_"},sing:{prt:"sung",pst:"sang"},sink:{pst:"sank",pluperf:"had sunk"},sit:{pst:"sat"},ski:{pst:"_ied"},slay:{prt:"slain"},sleep:{prt:"slept"},slide:{pst:"slid",prt:"slid"},smash:{pres:"_es"},sneak:{prt:"snuck"},speak:{fut:"will have spoken",prt:"spoken",pst:"spoke",perf:"have spoken",pluperf:"had spoken"},speed:{prt:"sped"},spend:{prt:"spent"},spill:{prt:"_ed",pst:"spilt"},spin:{g:"_ning",pst:"spun",prt:"spun"},spit:{prt:"spat"},split:{prt:"_"},spread:{pst:"_"},spring:{prt:"sprung"},stand:{pst:"stood"},steal:{a:"_er",pst:"stole"},stick:{pst:"stuck"},sting:{pst:"stung"},stink:{pst:"stunk",prt:"stunk"},stream:{a:"_er"},strew:{prt:"_n"},strike:{g:"striking",pst:"struck"},suit:{a:"_er",g:"_ing",pst:"_ed"},sware:{prt:"sworn"},swear:{pst:"swore"},sweep:{prt:"swept"},swim:{g:"_ming",pst:"swam"},swing:{pst:"swung"},take:{fut:"will have _n",pst:"took",perf:"have _n",pluperf:"had _n"},teach:{pst:"taught",pres:"_es"},tear:{pst:"tore"},tell:{pst:"told"},think:{pst:"thought"},thrive:{prt:"_d"},tie:{g:"tying",pst:"_d"},undergo:{prt:"_ne"},understand:{pst:"understood"},upset:{prt:"_"},wait:{a:"_er",g:"_ing",pst:"_ed"},wake:{pst:"woke"},wear:{pst:"wore"},weave:{prt:"woven"},wed:{pst:"wed"},weep:{prt:"wept"},win:{g:"_ning",pst:"won"},wind:{prt:"wound"},withdraw:{pst:"withdrew"},wring:{prt:"wrung"},write:{g:"writing",prt:"written",pst:"wrote"}},hr=Object.keys(cr);for(let ss=0;ss<hr.length;ss++){const ts=hr[ss];let rs={};Object.keys(cr[ts]).forEach(ns=>{let is=cr[ts][ns];is=is.replace("_",ts),rs[ur[ns]]=is}),cr[ts]=rs}var dr=cr;const gr={b:[{reg:/([^aeiou][aeiou])b$/i,repl:{pr:"$1bs",pa:"$1bbed",gr:"$1bbing"}}],d:[{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/([^aeiou][ou])d$/i,repl:{pr:"$1ds",pa:"$1dded",gr:"$1dding"}}],e:[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(t|sh?)(ake)$/i,repl:{pr:"$1$2s",pa:"$1ook",gr:"$1aking",ar:"$1$2r"}},{reg:/w(ake)$/i,repl:{pr:"w$1s",pa:"woke",gr:"waking",ar:"w$1r"}},{reg:/m(ake)$/i,repl:{pr:"m$1s",pa:"made",gr:"making",ar:"m$1r"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}}],g:[{reg:/([^aeiou][aou])g$/i,repl:{pr:"$1gs",pa:"$1gged",gr:"$1gging"}}],h:[{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}}],k:[{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}}],m:[{reg:/([^aeiou][aeiou])m$/i,repl:{pr:"$1ms",pa:"$1mmed",gr:"$1mming"}}],n:[{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],p:[{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/([^aeiou][aeiou])p$/i,repl:{pr:"$1ps",pa:"$1pped",gr:"$1pping"}},{reg:/([aeiu])p$/i,repl:{pr:"$1ps",pa:"$1p",gr:"$1pping"}}],r:[{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],s:[{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}],t:[{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])t$/i,repl:{pr:"$1ts",pa:"$1t",gr:"$1tting"}},{reg:/([^aeiou][aeiou])t$/i,repl:{pr:"$1ts",pa:"$1tted",gr:"$1tting"}}],w:[{reg:/(.llow)$/i,repl:{pr:"$1s",pa:"$1ed"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}}],y:[{reg:/(i|f|rr)y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}}],z:[{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},pr={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},mr=function(ss,ts){let rs={},ns=Object.keys(ts.repl);for(let is=0;is<ns.length;is+=1){let as=ns[is];rs[pr[as]]=ss.replace(ts.reg,ts.repl[as])}return rs},fr=/[bcdfghjklmnpqrstvwxz]y$/,br=function(ss=""){let ts=ss[ss.length-1];if(gr.hasOwnProperty(ts)===!0){for(let rs=0;rs<gr[ts].length;rs+=1)if(gr[ts][rs].reg.test(ss)===!0)return mr(ss,gr[ts][rs])}return{}},yr={Gerund:ss=>ss.charAt(ss.length-1)==="e"?ss.replace(/e$/,"ing"):ss+"ing",PresentTense:ss=>ss.charAt(ss.length-1)==="s"?ss+"es":fr.test(ss)===!0?ss.slice(0,-1)+"ies":ss+"s",PastTense:ss=>ss.charAt(ss.length-1)==="e"?ss+"d":ss.substr(-2)==="ed"?ss:fr.test(ss)===!0?ss.slice(0,-1)+"ied":ss+"ed"};var vr=function(ss="",ts){let rs={};return ts&&ts.irregulars&&ts.irregulars.verbs.hasOwnProperty(ss)===!0&&(rs=Object.assign({},ts.irregulars.verbs[ss])),rs=Object.assign({},br(ss),rs),rs.Gerund===void 0&&(rs.Gerund=yr.Gerund(ss)),rs.PastTense===void 0&&(rs.PastTense=yr.PastTense(ss)),rs.PresentTense===void 0&&(rs.PresentTense=yr.PresentTense(ss)),rs};const wr=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],kr=[/ary$/],Ar={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},Dr=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}],$r=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],Pr=[/ary$/,/ous$/],Er={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},Hr=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}],jr={toSuperlative:function(ss){if(Ar.hasOwnProperty(ss))return Ar[ss];for(let ts=0;ts<Dr.length;ts++)if(Dr[ts].reg.test(ss))return ss.replace(Dr[ts].reg,Dr[ts].repl);for(let ts=0;ts<kr.length;ts++)if(kr[ts].test(ss)===!0)return null;for(let ts=0;ts<wr.length;ts++)if(wr[ts].test(ss)===!0)return ss.charAt(ss.length-1)==="e"?ss+"st":ss+"est";return ss+"est"},toComparative:function(ss){if(Er.hasOwnProperty(ss))return Er[ss];for(let ts=0;ts<Hr.length;ts++)if(Hr[ts].reg.test(ss)===!0)return ss.replace(Hr[ts].reg,Hr[ts].repl);for(let ts=0;ts<Pr.length;ts++)if(Pr[ts].test(ss)===!0)return null;for(let ts=0;ts<$r.length;ts++)if($r[ts].test(ss)===!0)return ss+"er";return/e$/.test(ss)===!0?ss+"r":ss+"er"}};var Nr=function(ss){let ts={},rs=jr.toSuperlative(ss);rs&&(ts.Superlative=rs);let ns=jr.toComparative(ss);return ns&&(ts.Comparative=ns),ts};const xr={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/([ti])a$/i,"$1a"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},Fr=/(x|ch|sh|s|z)$/;var Cr=function(ss="",ts){let rs=ts.irregulars.nouns;if(rs.hasOwnProperty(ss))return rs[ss];let ns=function(is){let as=is[is.length-1];if(xr.hasOwnProperty(as)===!0)for(let os=0;os<xr[as].length;os+=1){let ls=xr[as][os][0];if(ls.test(is)===!0)return is.replace(ls,xr[as][os][1])}return null}(ss);return ns!==null?ns:Fr.test(ss)?ss+"es":ss+"s"};const Br=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(eas)es$/i,"$1e"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]];var Gr=function(ss,ts){let rs=ts.irregulars.nouns,ns=(is=rs,Object.keys(is).reduce((as,os)=>(as[is[os]]=os,as),{}));var is;if(ns.hasOwnProperty(ss))return ns[ss];for(let as=0;as<Br.length;as++)if(Br[as][0].test(ss)===!0)return ss=ss.replace(Br[as][0],Br[as][1]);return ss},zr={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/(..)(p|d|t|g){2}ing$/i,to:"$1$2"},{reg:/(ll|ss|zz)ing$/i,to:"$1"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea[dklnrtv])ing$/i,to:"$1"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(z)ing$/i,to:"$1e"},{reg:/(a[gdkvtc])ing$/i,to:"$1e"},{reg:/(u[rtcbn])ing$/i,to:"$1e"},{reg:/([^o]o[bdknprv])ing$/i,to:"$1e"},{reg:/([tbckg]l)ing$/i,to:"$1e"},{reg:/(c|s)ing$/i,to:"$1e"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/ea(rn|l|m)ed$/i,to:"ea$1"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(dd)ed$/i,to:"$1"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([aeiou][^aeiou])ed$/i,to:"$1e"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]};let Ir={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"]};Ir=Object.keys(Ir).reduce((ss,ts)=>(Ir[ts].forEach(rs=>ss[rs]=ts),ss),{});const Or=zr,Tr=Ir,Vr=Qt,Mr=sr,Jr=lr,Lr=St,Sr={nouns:{addendum:"addenda",alga:"algae",alumna:"alumnae",alumnus:"alumni",analysis:"analyses",antenna:"antennae",appendix:"appendices",avocado:"avocados",axis:"axes",bacillus:"bacilli",barracks:"barracks",beau:"beaux",bus:"buses",cactus:"cacti",chateau:"chateaux",child:"children",circus:"circuses",clothes:"clothes",corpus:"corpora",criterion:"criteria",curriculum:"curricula",database:"databases",deer:"deer",diagnosis:"diagnoses",echo:"echoes",embargo:"embargoes",epoch:"epochs",foot:"feet",formula:"formulae",fungus:"fungi",genus:"genera",goose:"geese",halo:"halos",hippopotamus:"hippopotami",index:"indices",larva:"larvae",leaf:"leaves",libretto:"libretti",loaf:"loaves",man:"men",matrix:"matrices",memorandum:"memoranda",modulus:"moduli",mosquito:"mosquitoes",mouse:"mice",nebula:"nebulae",nucleus:"nuclei",octopus:"octopi",opus:"opera",ovum:"ova",ox:"oxen",parenthesis:"parentheses",person:"people",phenomenon:"phenomena",prognosis:"prognoses",quiz:"quizzes",radius:"radii",referendum:"referenda",rodeo:"rodeos",sex:"sexes",shoe:"shoes",sombrero:"sombreros",stimulus:"stimuli",stomach:"stomachs",syllabus:"syllabi",synopsis:"synopses",tableau:"tableaux",thesis:"theses",thief:"thieves",tooth:"teeth",tornado:"tornados",tuxedo:"tuxedos",vertebra:"vertebrae"},verbs:dr},_r={conjugate:vr,adjectives:Nr,toPlural:Cr,toSingular:Gr,toInfinitive:function(ss,ts,rs){if(!ss)return"";if(ts.words.hasOwnProperty(ss)===!0){let ns=ts.irregulars.verbs,is=Object.keys(ns);for(let as=0;as<is.length;as++){let os=Object.keys(ns[is[as]]);for(let ls=0;ls<os.length;ls++)if(ss===ns[is[as]][os[ls]])return is[as]}}if((rs=rs||function(ns){let is=ns.substr(ns.length-3);if(Tr.hasOwnProperty(is)===!0)return Tr[is];let as=ns.substr(ns.length-2);return Tr.hasOwnProperty(as)===!0?Tr[as]:ns.substr(ns.length-1)==="s"?"PresentTense":null}(ss))&&Or[rs])for(let ns=0;ns<Or[rs].length;ns++){const is=Or[rs][ns];if(is.reg.test(ss)===!0)return ss.replace(is.reg,is.to)}return ss}};let Kr=!1;class qr{constructor(){Object.defineProperty(this,"words",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"hasCompound",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"irregulars",{enumerable:!1,value:Sr,writable:!0}),Object.defineProperty(this,"tags",{enumerable:!1,value:Object.assign({},Vr),writable:!0}),Object.defineProperty(this,"transforms",{enumerable:!1,value:_r,writable:!0}),Object.defineProperty(this,"taggers",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"cache",{enumerable:!1,value:{abbreviations:{}}}),this.words=Mr.buildOut(this),Jr(this)}verbose(ts){return Kr=ts,this}isVerbose(){return Kr}addWords(ts){let rs={};Object.keys(ts).forEach(ns=>{let is=ts[ns];ns=ns.toLowerCase().trim(),rs[ns]=is}),Mr.addWords(rs,this.words,this)}addConjugations(ts){return Object.assign(this.irregulars.verbs,ts),this}addPlurals(ts){return Object.assign(this.irregulars.nouns,ts),this}addTags(ts){return ts=Object.assign({},ts),this.tags=Object.assign(this.tags,ts),this.tags=Lr(this.tags),this}postProcess(ts){return this.taggers.push(ts),this}stats(){return{words:Object.keys(this.words).length,plurals:Object.keys(this.irregulars.nouns).length,conjugations:Object.keys(this.irregulars.verbs).length,compounds:Object.keys(this.hasCompound).length,postProcessors:this.taggers.length}}}const Wr=function(ss){return JSON.parse(JSON.stringify(ss))};qr.prototype.clone=function(){let ss=new qr;return ss.words=Object.assign({},this.words),ss.hasCompound=Object.assign({},this.hasCompound),ss.irregulars=Wr(this.irregulars),ss.tags=Wr(this.tags),ss.transforms=this.transforms,ss.taggers=this.taggers,ss};var Rr=qr,Ur={};(function(ss){ss.all=function(){return this.parents()[0]||this},ss.parent=function(){return this.from?this.from:this},ss.parents=function(ts){let rs=[];const ns=function(is){is.from&&(rs.push(is.from),ns(is.from))};return ns(this),rs=rs.reverse(),typeof ts=="number"?rs[ts]:rs},ss.clone=function(ts){let rs=this.list.map(ns=>ns.clone(ts));return this.buildFrom(rs)},ss.wordCount=function(){return this.list.reduce((ts,rs)=>ts+=rs.wordCount(),0)},ss.wordcount=ss.wordCount})(Ur);var Qr={};(function(ss){ss.first=function(ts){return ts===void 0?this.get(0):this.slice(0,ts)},ss.last=function(ts){if(ts===void 0)return this.get(this.list.length-1);let rs=this.list.length;return this.slice(rs-ts,rs)},ss.slice=function(ts,rs){let ns=this.list.slice(ts,rs);return this.buildFrom(ns)},ss.eq=function(ts){let rs=this.list[ts];return rs===void 0?this.buildFrom([]):this.buildFrom([rs])},ss.get=ss.eq,ss.firstTerms=function(){return this.match("^.")},ss.firstTerm=ss.firstTerms,ss.lastTerms=function(){return this.match(".$")},ss.lastTerm=ss.lastTerms,ss.termList=function(ts){let rs=[];for(let ns=0;ns<this.list.length;ns++){let is=this.list[ns].terms();for(let as=0;as<is.length;as++)if(rs.push(is[as]),ts!==void 0&&rs[ts]!==void 0)return rs[ts]}return rs},ss.groups=function(ts){return ts===void 0?function(rs){let ns={};const is={};for(let os=0;os<rs.list.length;os++){const ls=rs.list[os],us=Object.keys(ls.groups).map(cs=>ls.groups[cs]);for(let cs=0;cs<us.length;cs++){const{group:ps,start:ds,length:fs}=us[cs];is[ps]||(is[ps]=[]),is[ps].push(ls.buildFrom(ds,fs))}}const as=Object.keys(is);for(let os=0;os<as.length;os++){const ls=as[os];ns[ls]=rs.buildFrom(is[ls])}return ns}(this):(typeof ts=="number"&&(ts=String(ts)),function(rs,ns){const is=[];for(let as=0;as<rs.list.length;as++){const os=rs.list[as];let ls=Object.keys(os.groups);ls=ls.filter(us=>os.groups[us].group===ns),ls.forEach(us=>{is.push(os.buildFrom(os.groups[us].start,os.groups[us].length))})}return rs.buildFrom(is)}(this,ts)||this.buildFrom([]))},ss.group=ss.groups,ss.sentences=function(ts){let rs=[];return this.list.forEach(ns=>{rs.push(ns.fullSentence())}),typeof ts=="number"?this.buildFrom([rs[ts]]):this.buildFrom(rs)},ss.sentence=ss.sentences})(Qr);var Zr={},Xr=function(ss,ts){if(ss._cache&&ss._cache.set===!0){let{words:rs,tags:ns}=function(is){let as=[],os=[];return is.forEach(ls=>{ls.optional!==!0&&ls.negative!==!0&&(ls.tag!==void 0&&as.push(ls.tag),ls.word!==void 0&&os.push(ls.word))}),{tags:as,words:os}}(ts);for(let is=0;is<rs.length;is++)if(ss._cache.words[rs[is]]===void 0)return!1;for(let is=0;is<ns.length;is++)if(ss._cache.tags[ns[is]]===void 0)return!1}return!0};(function(ss){const ts=_e,rs=Xr;ss.match=function(ns,is={}){typeof is!="string"&&typeof is!="number"&&is!==null||(is={group:is});let as=ts(ns,is);if(as.length===0)return this.buildFrom([]);if(rs(this,as)===!1)return this.buildFrom([]);let os=this.list.reduce((ls,us)=>ls.concat(us.match(as)),[]);return is.group!==void 0&&is.group!==null&&is.group!==""?this.buildFrom(os).groups(is.group):this.buildFrom(os)},ss.not=function(ns,is={}){let as=ts(ns,is);if(as.length===0||rs(this,as)===!1)return this;let os=this.list.reduce((ls,us)=>ls.concat(us.not(as)),[]);return this.buildFrom(os)},ss.matchOne=function(ns,is={}){let as=ts(ns,is);if(rs(this,as)===!1)return this.buildFrom([]);for(let os=0;os<this.list.length;os++){let ls=this.list[os].match(as,!0);return this.buildFrom(ls)}return this.buildFrom([])},ss.if=function(ns,is={}){let as=ts(ns,is);if(rs(this,as)===!1)return this.buildFrom([]);let os=this.list.filter(ls=>ls.has(as)===!0);return this.buildFrom(os)},ss.ifNo=function(ns,is={}){let as=ts(ns,is),os=this.list.filter(ls=>ls.has(as)===!1);return this.buildFrom(os)},ss.has=function(ns,is={}){let as=ts(ns,is);return rs(this,as)!==!1&&this.list.some(os=>os.has(as)===!0)},ss.lookAhead=function(ns,is={}){ns||(ns=".*");let as=ts(ns,is),os=[];return this.list.forEach(ls=>{os=os.concat(ls.lookAhead(as))}),os=os.filter(ls=>ls),this.buildFrom(os)},ss.lookAfter=ss.lookAhead,ss.lookBehind=function(ns,is={}){ns||(ns=".*");let as=ts(ns,is),os=[];return this.list.forEach(ls=>{os=os.concat(ls.lookBehind(as))}),os=os.filter(ls=>ls),this.buildFrom(os)},ss.lookBefore=ss.lookBehind,ss.before=function(ns,is={}){let as=ts(ns,is),os=this.if(as).list.map(ls=>{let us=ls.terms().map(ds=>ds.id),cs=ls.match(as)[0],ps=us.indexOf(cs.start);return ps===0||ps===-1?null:ls.buildFrom(ls.start,ps)});return os=os.filter(ls=>ls!==null),this.buildFrom(os)},ss.after=function(ns,is={}){let as=ts(ns,is),os=this.if(as).list.map(ls=>{let us=ls.terms(),cs=us.map(ys=>ys.id),ps=ls.match(as)[0],ds=cs.indexOf(ps.start);if(ds===-1||!us[ds+ps.length])return null;let fs=us[ds+ps.length].id,hs=ls.length-ds-ps.length;return ls.buildFrom(fs,hs)});return os=os.filter(ls=>ls!==null),this.buildFrom(os)},ss.hasAfter=function(ns,is={}){return this.filter(as=>as.lookAfter(ns,is).found)},ss.hasBefore=function(ns,is={}){return this.filter(as=>as.lookBefore(ns,is).found)}})(Zr);var Yr={};const ea=function(ss,ts,rs,ns){let is=[];typeof ss=="string"&&(is=ss.split(" ")),ts.list.forEach(as=>{let os=as.terms();rs===!0&&(os=os.filter(ls=>ls.canBe(ss,ts.world))),os.forEach((ls,us)=>{is.length>1?is[us]&&is[us]!=="."&&ls.tag(is[us],ns,ts.world):ls.tag(ss,ns,ts.world)})})};Yr.tag=function(ss,ts){return ss?(ea(ss,this,!1,ts),this):this},Yr.tagSafe=function(ss,ts){return ss?(ea(ss,this,!0,ts),this):this},Yr.unTag=function(ss,ts){return this.list.forEach(rs=>{rs.terms().forEach(ns=>ns.unTag(ss,ts,this.world))}),this},Yr.canBe=function(ss){if(!ss)return this;let ts=this.world,rs=this.list.reduce((ns,is)=>ns.concat(is.canBe(ss,ts)),[]);return this.buildFrom(rs)};var ta={map:function(ss){if(!ss)return this;let ts=this.list.map((rs,ns)=>{let is=this.buildFrom([rs]);is.from=null;let as=ss(is,ns);return as&&as.list&&as.list[0]?as.list[0]:as});return ts=ts.filter(rs=>rs),ts.length===0?this.buildFrom(ts):typeof ts[0]!="object"||ts[0].isA!=="Phrase"?ts:this.buildFrom(ts)},forEach:function(ss,ts){return ss?(this.list.forEach((rs,ns)=>{let is=this.buildFrom([rs]);ts===!0&&(is.from=null),ss(is,ns)}),this):this},filter:function(ss){if(!ss)return this;let ts=this.list.filter((rs,ns)=>{let is=this.buildFrom([rs]);return is.from=null,ss(is,ns)});return this.buildFrom(ts)},find:function(ss){if(!ss)return this;let ts=this.list.find((rs,ns)=>{let is=this.buildFrom([rs]);return is.from=null,ss(is,ns)});return ts?this.buildFrom([ts]):void 0},some:function(ss){return ss?this.list.some((ts,rs)=>{let ns=this.buildFrom([ts]);return ns.from=null,ss(ns,rs)}):this},random:function(ss){if(!this.found)return this;let ts=Math.floor(Math.random()*this.list.length);if(ss===void 0){let rs=[this.list[ts]];return this.buildFrom(rs)}return ts+ss>this.length&&(ts=this.length-ss,ts=ts<0?0:ts),this.slice(ts,ts+ss)}},ra={},aa=function(ss,ts,rs){let ns=function(as,os=[]){let ls={};return as.forEach((us,cs)=>{let ps=!0;os[cs]!==void 0&&(ps=os[cs]);let ds=function(fs){return fs.split(/[ -]/g)}(us=(us=(us||"").toLowerCase()).replace(/[,;.!?]+$/,"")).map(fs=>fs.trim());ls[ds[0]]=ls[ds[0]]||{},ds.length===1?ls[ds[0]].value=ps:(ls[ds[0]].more=ls[ds[0]].more||[],ls[ds[0]].more.push({rest:ds.slice(1),value:ps}))}),ls}(ss,ts),is=[];for(let as=0;as<rs.list.length;as++){const os=rs.list[as];let ls=os.terms().map(us=>us.reduced);for(let us=0;us<ls.length;us++)ns[ls[us]]!==void 0&&(ns[ls[us]].more!==void 0&&ns[ls[us]].more.forEach(cs=>{ls[us+cs.rest.length]!==void 0&&cs.rest.every((ps,ds)=>ps===ls[us+ds+1])===!0&&is.push({id:os.terms()[us].id,value:cs.value,length:cs.rest.length+1})}),ns[ls[us]].value!==void 0&&is.push({id:os.terms()[us].id,value:ns[ls[us]].value,length:1}))}return is};(function(ss){const ts=aa;ss.lookup=function(rs){let ns=[],is=(as=rs)&&Object.prototype.toString.call(as)==="[object Object]";var as;is===!0&&(rs=Object.keys(rs).map(us=>(ns.push(rs[us]),us))),typeof rs=="string"&&(rs=[rs]),this._cache.set!==!0&&this.cache();let os=ts(rs,ns,this),ls=this.list[0];if(is===!0){let us={};return os.forEach(cs=>{us[cs.value]=us[cs.value]||[],us[cs.value].push(ls.buildFrom(cs.id,cs.length))}),Object.keys(us).forEach(cs=>{us[cs]=this.buildFrom(us[cs])}),us}return os=os.map(us=>ls.buildFrom(us.id,us.length)),this.buildFrom(os)},ss.lookUp=ss.lookup})(ra);var na={cache:function(ss){ss=ss||{};let ts={},rs={};return this._cache.words=ts,this._cache.tags=rs,this._cache.set=!0,this.list.forEach((ns,is)=>{ns.cache=ns.cache||{},ns.terms().forEach(as=>{ts[as.reduced]&&!ts.hasOwnProperty(as.reduced)||(ts[as.reduced]=ts[as.reduced]||[],ts[as.reduced].push(is),Object.keys(as.tags).forEach(os=>{rs[os]=rs[os]||[],rs[os].push(is)}),ss.root&&(as.setRoot(this.world),ts[as.root]=[is]))})}),this},uncache:function(){return this._cache={},this.list.forEach(ss=>{ss.cache={}}),this.parents().forEach(ss=>{ss._cache={},ss.list.forEach(ts=>{ts.cache={}})}),this}},ia={};const oa=xt;ia.replaceWith=function(ss,ts={}){return ss?(ts===!0&&(ts={keepTags:!0}),ts===!1&&(ts={keepTags:!1}),ts=ts||{},this.uncache(),this.list.forEach(rs=>{let ns,is=ss;if(typeof ss=="function"&&(is=ss(rs)),is&&typeof is=="object"&&is.isA==="Doc")ns=is.list,this.pool().merge(is.pool());else{if(typeof is!="string")return;{ts.keepCase!==!1&&rs.terms(0).isTitleCase()&&(is=(as=is).charAt(0).toUpperCase()+as.substr(1)),ns=oa(is,this.world,this.pool());let os=this.buildFrom(ns);os.tagger(),ns=os.list}}var as;if(ts.keepTags===!0){let os=rs.json({terms:{tags:!0}}).terms;ns[0].terms().forEach((ls,us)=>{os[us]&&ls.tagSafe(os[us].tags,"keptTag",this.world)})}rs.replace(ns[0],this)}),this):this.delete()},ia.replace=function(ss,ts,rs){return ts===void 0?this.replaceWith(ss,rs):(this.match(ss).replaceWith(ts,rs),this)};var sa={};(function(ss){const ts=xt,rs=function(is){return is&&Object.prototype.toString.call(is)==="[object Object]"},ns=function(is,as){let os=ts(is,as.world)[0],ls=as.buildFrom([os]);return ls.tagger(),as.list=ls.list,as};ss.append=function(is=""){return is?this.found?(this.uncache(),this.list.forEach(as=>{let os;rs(is)&&is.isA==="Doc"?os=is.list[0].clone():typeof is=="string"&&(os=ts(is,this.world,this.pool())[0]),this.buildFrom([os]).tagger(),as.append(os,this)}),this):ns(is,this):this},ss.insertAfter=ss.append,ss.insertAt=ss.append,ss.prepend=function(is){return is?this.found?(this.uncache(),this.list.forEach(as=>{let os;rs(is)&&is.isA==="Doc"?os=is.list[0].clone():typeof is=="string"&&(os=ts(is,this.world,this.pool())[0]),this.buildFrom([os]).tagger(),as.prepend(os,this)}),this):ns(is,this):this},ss.insertBefore=ss.prepend,ss.concat=function(){this.uncache();let is=this.list.slice(0);for(let as=0;as<arguments.length;as++){let os=arguments[as];if(typeof os=="string"){let ls=ts(os,this.world);is=is.concat(ls)}else os.isA==="Doc"?is=is.concat(os.list):os.isA==="Phrase"&&is.push(os)}return this.buildFrom(is)},ss.delete=function(is){this.uncache();let as=this;return is&&(as=this.match(is)),as.list.forEach(os=>os.delete(this)),this},ss.remove=ss.delete})(sa);var la={};const ua={clean:!0,reduced:!0,root:!0};la.text=function(ss){ss=ss||{};let ts=!1;this.parents().length===0&&(ts=!0),(ss==="root"||typeof ss=="object"&&ss.root)&&this.list.forEach(ns=>{ns.terms().forEach(is=>{is.root===null&&is.setRoot(this.world)})});let rs=this.list.reduce((ns,is,as)=>{const os=!ts&&as===0,ls=!ts&&as===this.list.length-1;return ns+is.text(ss,os,ls)},"");return ua[ss]!==!0&&ss.reduced!==!0&&ss.clean!==!0&&ss.root!==!0||(rs=rs.trim()),rs};var ca={},ha=function(ss,ts,rs){let ns=function(is){let as=0,os=0,ls={};return is.termList().forEach(us=>{ls[us.id]={index:os,start:as+us.pre.length,length:us.text.length},as+=us.pre.length+us.text.length+us.post.length,os+=1}),ls}(ss.all());(rs.terms.index||rs.index)&&ts.forEach(is=>{is.terms.forEach(as=>{as.index=ns[as.id].index}),is.index=is.terms[0].index}),(rs.terms.offset||rs.offset)&&ts.forEach(is=>{is.terms.forEach(as=>{as.offset=ns[as.id]||{}}),is.offset={index:is.terms[0].offset.index,start:is.terms[0].offset.start-is.text.indexOf(is.terms[0].text),length:is.text.length}})};(function(ss){const ts=ha,rs={text:!0,terms:!0,trim:!0};ss.json=function(ns={}){if(typeof ns=="number"&&this.list[ns])return this.list[ns].json(rs);(ns=function(as){return(as=Object.assign({},rs,as)).unique&&(as.reduced=!0),as.offset&&(as.text=!0,as.terms&&as.terms!==!0||(as.terms={}),as.terms.offset=!0),(as.index||as.terms.index)&&(as.terms=as.terms===!0?{}:as.terms,as.terms.id=!0),as}(ns)).root===!0&&this.list.forEach(as=>{as.terms().forEach(os=>{os.root===null&&os.setRoot(this.world)})});let is=this.list.map(as=>as.json(ns,this.world));if((ns.terms.offset||ns.offset||ns.terms.index||ns.index)&&ts(this,is,ns),ns.frequency||ns.freq||ns.count){let as={};this.list.forEach(os=>{let ls=os.text("reduced");as[ls]=as[ls]||0,as[ls]+=1}),this.list.forEach((os,ls)=>{is[ls].count=as[os.text("reduced")]})}if(ns.unique){let as={};is=is.filter(os=>as[os.reduced]!==!0&&(as[os.reduced]=!0,!0))}return is},ss.data=ss.json})(ca);var da={},ga={exports:{}};(function(ss){const ts="\x1B[0m",rs=function(as,os){for(as=as.toString();as.length<os;)as+=" ";return as},ns={green:"#7f9c6c",red:"#914045",blue:"#6699cc",magenta:"#6D5685",cyan:"#2D85A8",yellow:"#e6d7b3",black:"#303b50"},is={green:function(as){return"\x1B[32m"+as+ts},red:function(as){return"\x1B[31m"+as+ts},blue:function(as){return"\x1B[34m"+as+ts},magenta:function(as){return"\x1B[35m"+as+ts},cyan:function(as){return"\x1B[36m"+as+ts},yellow:function(as){return"\x1B[33m"+as+ts},black:function(as){return"\x1B[30m"+as+ts}};ga.exports=function(as){return typeof window<"u"&&window.document?(function(os){let ls=os.world.tags;os.list.forEach(us=>{console.log(`
%c"`+us.text()+'"',"color: #e6d7b3;"),us.terms().forEach(cs=>{let ps=Object.keys(cs.tags),ds=cs.text||"-";cs.implicit&&(ds="["+cs.implicit+"]");let fs="'"+ds+"'";fs=rs(fs,8);let hs=ps.find(gs=>ls[gs]&&ls[gs].color),ys="steelblue";ls[hs]&&(ys=ls[hs].color,ys=ns[ys]),console.log(`   ${fs}  -  %c${ps.join(", ")}`,`color: ${ys||"steelblue"};`)})})}(as),as):(console.log(is.blue("=====")),as.list.forEach(os=>{console.log(is.blue("  -----")),os.terms().forEach(ls=>{let us=Object.keys(ls.tags),cs=ls.text||"-";ls.implicit&&(cs="["+ls.implicit+"]"),cs=is.yellow(cs);let ps="'"+cs+"'";ps=rs(ps,18);let ds=is.blue("   ")+ps+"  - "+function(fs,hs){return(fs=fs.map(ys=>{if(!hs.tags.hasOwnProperty(ys))return ys;const gs=hs.tags[ys].color||"blue";return is[gs](ys)})).join(", ")}(us,as.world);console.log(ds)})}),console.log(""),as)}})();const pa=ga.exports,ma=function(ss){let ts=ss.json({text:!1,terms:!1,reduced:!0}),rs={};ts.forEach(is=>{rs[is.reduced]||(is.count=0,rs[is.reduced]=is),rs[is.reduced].count+=1});let ns=Object.keys(rs).map(is=>rs[is]);return ns.sort((is,as)=>is.count>as.count?-1:is.count<as.count?1:0),ns};da.debug=function(){return pa(this),this},da.out=function(ss){if(ss==="text")return this.text();if(ss==="normal")return this.text("normal");if(ss==="json")return this.json();if(ss==="offset"||ss==="offsets")return this.json({offset:!0});if(ss==="array")return this.json({terms:!1}).map(ts=>ts.text).filter(ts=>ts);if(ss==="freq"||ss==="frequency")return ma(this);if(ss==="terms"){let ts=[];return this.json({text:!1,terms:{text:!0}}).forEach(rs=>{let ns=rs.terms.map(is=>is.text);ns=ns.filter(is=>is),ts=ts.concat(ns)}),ts}return ss==="tags"?this.list.map(ts=>ts.terms().reduce((rs,ns)=>(rs[ns.clean||ns.implicit]=Object.keys(ns.tags),rs),{})):ss==="debug"?(pa(this),this):this.text()};var fa={};const ba={alpha:(ss,ts)=>{let rs=ss.text("clean"),ns=ts.text("clean");return rs<ns?-1:rs>ns?1:0},length:(ss,ts)=>{let rs=ss.text().trim().length,ns=ts.text().trim().length;return rs<ns?1:rs>ns?-1:0},wordCount:(ss,ts)=>{let rs=ss.wordCount(),ns=ts.wordCount();return rs<ns?1:rs>ns?-1:0}};ba.alphabetical=ba.alpha,ba.wordcount=ba.wordCount;const ya={index:!0,sequence:!0,seq:!0,sequential:!0,chron:!0,chronological:!0};fa.sort=function(ss){return(ss=ss||"alpha")==="freq"||ss==="frequency"||ss==="topk"?function(ts){let rs={};const ns={case:!0,punctuation:!1,whitespace:!0,unicode:!0};return ts.list.forEach(is=>{let as=is.text(ns);rs[as]=rs[as]||0,rs[as]+=1}),ts.list.sort((is,as)=>{let os=rs[is.text(ns)],ls=rs[as.text(ns)];return os<ls?1:os>ls?-1:0}),ts}(this):ya.hasOwnProperty(ss)?function(ts){let rs={};return ts.json({terms:{offset:!0}}).forEach(ns=>{rs[ns.terms[0].id]=ns.terms[0].offset.start}),ts.list=ts.list.sort((ns,is)=>rs[ns.start]>rs[is.start]?1:rs[ns.start]<rs[is.start]?-1:0),ts}(this):typeof(ss=ba[ss]||ss)=="function"?(this.list=this.list.sort(ss),this):this},fa.reverse=function(){let ss=[].concat(this.list);return ss=ss.reverse(),this.buildFrom(ss)},fa.unique=function(){let ss=[].concat(this.list),ts={};return ss=ss.filter(rs=>{let ns=rs.text("reduced").trim()||rs.text("implicit").trim();return ts.hasOwnProperty(ns)!==!0&&(ts[ns]=!0,!0)}),this.buildFrom(ss)};var va={};const wa=n$1,ka=/[\[\]{}:,\-;\/*\^%=~|]/g,Aa=/['"]+/g,Da={whitespace:function(ss){let ts=ss.list.map(rs=>rs.terms());ts.forEach((rs,ns)=>{rs.forEach((is,as)=>{is.hasDash()!==!0?(is.pre=is.pre.replace(/\s/g,""),is.post=is.post.replace(/\s/g,""),(rs.length-1!==as||ts[ns+1])&&(is.implicit&&is.text||is.hasHyphen()!==!0&&(is.post+=" "))):is.post=" - "})})},punctuation:function(ss){ss.forEach(ts=>{ts.hasHyphen()===!0&&(ts.post=" "),ts.pre=ts.pre.replace(ka,""),ts.post=ts.post.replace(ka,""),ts.post=ts.post.replace(/\.\.\./,""),/!/.test(ts.post)===!0&&(ts.post=ts.post.replace(/!/g,""),ts.post="!"+ts.post),/\?/.test(ts.post)===!0&&(ts.post=ts.post.replace(/[\?!]*/,""),ts.post="?"+ts.post)})},unicode:function(ss){ss.forEach(ts=>{ts.isImplicit()!==!0&&(ts.text=wa(ts.text))})},quotations:function(ss){ss.forEach(ts=>{ts.post=ts.post.replace(Aa,""),ts.pre=ts.pre.replace(Aa,"")})},adverbs:function(ss){ss.match("#Adverb").not("(not|nary|seldom|never|barely|almost|basically|so)").remove()},abbreviations:function(ss){ss.list.forEach(ts=>{let rs=ts.terms();rs.forEach((ns,is)=>{ns.tags.Abbreviation===!0&&rs[is+1]&&(ns.post=ns.post.replace(/^\./,""))})})}},$a={whitespace:!0,unicode:!0,punctuation:!0,emoji:!0,acronyms:!0,abbreviations:!0,case:!1,contractions:!1,parentheses:!1,quotations:!1,adverbs:!1,possessives:!1,verbs:!1,nouns:!1,honorifics:!1},Pa={light:{},medium:{case:!0,contractions:!0,parentheses:!0,quotations:!0,adverbs:!0}};Pa.heavy=Object.assign({},Pa.medium,{possessives:!0,verbs:!0,nouns:!0,honorifics:!0}),va.normalize=function(ss){typeof(ss=ss||{})=="string"&&(ss=Pa[ss]||{}),ss=Object.assign({},$a,ss),this.uncache();let ts=this.termList();return ss.case&&this.toLowerCase(),ss.whitespace&&Da.whitespace(this),ss.unicode&&Da.unicode(ts),ss.punctuation&&Da.punctuation(ts),ss.emoji&&this.remove("(#Emoji|#Emoticon)"),ss.acronyms&&this.acronyms().strip(),ss.abbreviations&&Da.abbreviations(this),(ss.contraction||ss.contractions)&&this.contractions().expand(),ss.parentheses&&this.parentheses().unwrap(),(ss.quotations||ss.quotes)&&Da.quotations(ts),ss.adverbs&&Da.adverbs(this),(ss.possessive||ss.possessives)&&this.possessives().strip(),ss.verbs&&this.verbs().toInfinitive(),(ss.nouns||ss.plurals)&&this.nouns().toSingular(),ss.honorifics&&this.remove("#Honorific"),this};var Ea={};(function(ss){const ts=_e;ss.splitOn=function(rs){if(!rs)return this.parent().splitOn(this);let ns=ts(rs),is=[];return this.list.forEach(as=>{let os=as.match(ns);if(os.length===0)return void is.push(as);let ls=as;os.forEach(us=>{let cs=ls.splitOn(us);cs.before&&is.push(cs.before),cs.match&&is.push(cs.match),ls=cs.after}),ls&&is.push(ls)}),this.buildFrom(is)},ss.splitAfter=function(rs){if(!rs)return this.parent().splitAfter(this);let ns=ts(rs),is=[];return this.list.forEach(as=>{let os=as.match(ns);if(os.length===0)return void is.push(as);let ls=as;os.forEach(us=>{let cs=ls.splitOn(us);cs.before&&cs.match?(cs.before.length+=cs.match.length,is.push(cs.before)):cs.match&&is.push(cs.match),ls=cs.after}),ls&&is.push(ls)}),this.buildFrom(is)},ss.split=ss.splitAfter,ss.splitBefore=function(rs){if(!rs)return this.parent().splitBefore(this);let ns=ts(rs),is=[];return this.list.forEach(as=>{let os=as.match(ns);if(os.length===0)return void is.push(as);let ls=as;os.forEach(us=>{let cs=ls.splitOn(us);cs.before&&is.push(cs.before),cs.match&&cs.after&&(cs.match.length+=cs.after.length),ls=cs.match}),ls&&is.push(ls)}),this.buildFrom(is)},ss.segment=function(rs,ns){rs=rs||{},ns=ns||{text:!0};let is=this,as=Object.keys(rs);return as.forEach(os=>{is=is.splitOn(os)}),is.list.forEach(os=>{for(let ls=0;ls<as.length;ls+=1)if(os.has(as[ls]))return void(os.segment=rs[as[ls]])}),is.list.map(os=>{let ls=os.json(ns);return ls.segment=os.segment||null,ls})}})(Ea);var Ha={};const ja=function(ss,ts){let rs=ss.world;return ss.list.forEach(ns=>{ns.terms().forEach(is=>is[ts](rs))}),ss};Ha.toLowerCase=function(){return ja(this,"toLowerCase")},Ha.toUpperCase=function(){return ja(this,"toUpperCase")},Ha.toTitleCase=function(){return ja(this,"toTitleCase")},Ha.toCamelCase=function(){return this.list.forEach(ss=>{let ts=ss.terms();ts.forEach((rs,ns)=>{ns!==0&&rs.toTitleCase(),ns!==ts.length-1&&(rs.post="")})}),this};var Na={};(function(ss){ss.pre=function(ts,rs){return ts===void 0?this.list[0].terms(0).pre:(this.list.forEach(ns=>{let is=ns.terms(0);rs===!0?is.pre+=ts:is.pre=ts}),this)},ss.post=function(ts,rs){return ts===void 0?this.list.map(ns=>{let is=ns.terms();return is[is.length-1].post}):(this.list.forEach(ns=>{let is=ns.terms(),as=is[is.length-1];rs===!0?as.post+=ts:as.post=ts}),this)},ss.trim=function(){return this.list=this.list.map(ts=>ts.trim()),this},ss.hyphenate=function(){return this.list.forEach(ts=>{let rs=ts.terms();rs.forEach((ns,is)=>{is!==0&&(ns.pre=""),rs[is+1]&&(ns.post="-")})}),this},ss.dehyphenate=function(){const ts=/(-||)/;return this.list.forEach(rs=>{rs.terms().forEach(ns=>{ts.test(ns.post)&&(ns.post=" ")})}),this},ss.deHyphenate=ss.dehyphenate,ss.toQuotations=function(ts,rs){return ts=ts||'"',rs=rs||'"',this.list.forEach(ns=>{let is=ns.terms();is[0].pre=ts+is[0].pre;let as=is[is.length-1];as.post=rs+as.post}),this},ss.toQuotation=ss.toQuotations,ss.toParentheses=function(ts,rs){return ts=ts||"(",rs=rs||")",this.list.forEach(ns=>{let is=ns.terms();is[0].pre=ts+is[0].pre;let as=is[is.length-1];as.post=rs+as.post}),this}})(Na);var xa={join:function(ss){this.uncache();let ts=this.list[0],rs=ts.length,ns={};for(let as=1;as<this.list.length;as++){const os=this.list[as];ns[os.start]=!0;let ls=ts.lastTerm();ss&&(ls.post+=ss),ls.next=os.start,os.terms(0).prev=ls.id,ts.length+=os.length,ts.cache={}}let is=ts.length-rs;return this.parents().forEach(as=>{as.list.forEach(os=>{let ls=os.terms();for(let us=0;us<ls.length;us++)if(ls[us].id===ts.start){os.length+=is;break}os.cache={}}),as.list=as.list.filter(os=>ns[os.start]!==!0)}),this.buildFrom([ts])}},Fa={};const Ca=/[,\)"';:\-\.]/,Ba=function(ss,ts){if(!ss.found)return;let rs=ss.termList();for(let ns=0;ns<rs.length-1;ns++){const is=rs[ns];if(Ca.test(is.post))return}rs.forEach(ns=>{ns.implicit=ns.clean}),rs[0].text+=ts,rs.slice(1).forEach(ns=>{ns.text=""});for(let ns=0;ns<rs.length-1;ns++){const is=rs[ns];is.post=is.post.replace(/ /,"")}};Fa.contract=function(){let ss=this.not("@hasContraction"),ts=ss.match("(we|they|you) are");return Ba(ts,"'re"),ts=ss.match("(he|she|they|it|we|you) will"),Ba(ts,"'ll"),ts=ss.match("(he|she|they|it|we) is"),Ba(ts,"'s"),ts=ss.match("#Person is"),Ba(ts,"'s"),ts=ss.match("#Person would"),Ba(ts,"'d"),ts=ss.match("(is|was|had|would|should|could|do|does|have|has|can) not"),Ba(ts,"n't"),ts=ss.match("(i|we|they) have"),Ba(ts,"'ve"),ts=ss.match("(would|should|could) have"),Ba(ts,"'ve"),ts=ss.match("i am"),Ba(ts,"'m"),ts=ss.match("going to"),this};var Ga=Object.assign({},Ur,Qr,Zr,Yr,ta,ra,na,ia,sa,la,ca,da,fa,va,Ea,Ha,Na,xa,Fa);let za={};[["terms","."],["hyphenated","@hasHyphen ."],["adjectives","#Adjective"],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["adverbs","#Adverb"],["pronouns","#Pronoun"],["conjunctions","#Conjunction"],["prepositions","#Preposition"]].forEach(ss=>{za[ss[0]]=function(ts){let rs=this.match(ss[1]);return typeof ts=="number"&&(rs=rs.get(ts)),rs}}),za.emojis=za.emoji,za.atmentions=za.atMentions,za.words=za.terms,za.phoneNumbers=function(ss){let ts=this.splitAfter("@hasComma");return ts=ts.match("#PhoneNumber+"),typeof ss=="number"&&(ts=ts.get(ss)),ts},za.money=function(ss){let ts=this.match("#Money #Currency?");return typeof ss=="number"&&(ts=ts.get(ss)),ts},za.places=function(ss){let ts=this.match("(#City && @hasComma) (#Region|#Country)"),rs=this.not(ts).splitAfter("@hasComma");return rs=rs.concat(ts),rs.sort("index"),rs=rs.match("#Place+"),typeof ss=="number"&&(rs=rs.get(ss)),rs},za.organizations=function(ss){let ts=this.clauses();return ts=ts.match("#Organization+"),typeof ss=="number"&&(ts=ts.get(ss)),ts},za.entities=function(ss){let ts=this.clauses(),rs=ts.people();return rs=rs.concat(ts.places()),rs=rs.concat(ts.organizations()),rs=rs.not(["someone","man","woman","mother","brother","sister","father"]),rs.sort("sequence"),typeof ss=="number"&&(rs=rs.get(ss)),rs},za.things=za.entities,za.topics=za.entities;var Ia=za;const Oa=/^(under|over)-?.{3}/,Ta=function(ss,ts,rs){let ns=rs.words,is=ss[ts].reduced+" "+ss[ts+1].reduced;return ns[is]!==void 0&&ns.hasOwnProperty(is)===!0?(ss[ts].tag(ns[is],"lexicon-two",rs),ss[ts+1].tag(ns[is],"lexicon-two",rs),1):ts+2<ss.length&&(is+=" "+ss[ts+2].reduced,ns[is]!==void 0&&ns.hasOwnProperty(is)===!0)?(ss[ts].tag(ns[is],"lexicon-three",rs),ss[ts+1].tag(ns[is],"lexicon-three",rs),ss[ts+2].tag(ns[is],"lexicon-three",rs),2):ts+3<ss.length&&(is+=" "+ss[ts+3].reduced,ns[is]!==void 0&&ns.hasOwnProperty(is)===!0)?(ss[ts].tag(ns[is],"lexicon-four",rs),ss[ts+1].tag(ns[is],"lexicon-four",rs),ss[ts+2].tag(ns[is],"lexicon-four",rs),ss[ts+3].tag(ns[is],"lexicon-four",rs),3):0};var Va=function(ss,ts){let rs=ts.words,ns=ts.hasCompound;for(let is=0;is<ss.length;is+=1){let as=ss[is].clean;if(ns[as]===!0&&is+1<ss.length){let os=Ta(ss,is,ts);if(os>0){is+=os;continue}}if(rs[as]===void 0||rs.hasOwnProperty(as)!==!0)if(as===ss[is].reduced||rs.hasOwnProperty(ss[is].reduced)!==!0){if(Oa.test(as)===!0){let os=as.replace(/^(under|over)-?/,"");rs.hasOwnProperty(os)===!0&&ss[is].tag(rs[os],"noprefix-lexicon",ts)}}else ss[is].tag(rs[ss[is].reduced],"lexicon",ts);else ss[is].tag(rs[as],"lexicon",ts)}return ss};const Ma=/[\'`]$/,Ja=/^(m|k|cm|km|m)\/(s|h|hr)$/,La=[[/^[\w\.]+@[\w\.]+\.[a-z]{2,3}$/,"Email"],[/^#[a-z0-9_\u00C0-\u00FF]{2,}$/,"HashTag"],[/^@1?[0-9](am|pm)$/i,"Time"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time"],[/^@\w{2,}$/,"AtMention"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url"],[/^[a-z0-9./].+\.(com|net|gov|org|ly|edu|info|biz|dev|ru|jp|de|in|uk|br|io|ai)/,"Url"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time"],[/^[PMCE]ST$/,"Time"],[/^utc ?[+-]?[0-9]+?$/,"Time"],[/^[a-z0-9]*? o\'?clock$/,"Time"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}\/[0-9]{1,2}\/[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date"],[/^gmt[+-][0-9][0-9]?$/i,"Timezone"],[/^utc[+-][0-9][0-9]?$/i,"Timezone"],[/^ma?c\'.*/,"LastName"],[/^o\'[drlkn].*/,"LastName"],[/^ma?cd[aeiou]/,"LastName"],[/^(lol)+[sz]$/,"Expression"],[/^woo+a*?h?$/,"Expression"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^[-+]?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6][-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(k|m|b|bn)?\+?$/,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]\+?$/,["Money","Value"]],[/^[-+]?[\$]?[0-9]([0-9,.])+?(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"]],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"]],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"]],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"]],[/^[0-9.]{1,3}[a-z]{0,2}[-][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"]],[/^[0-9][0-9]?(:[0-9][0-9])?(am|pm)? ?[-] ?[0-9][0-9]?(:[0-9][0-9])?(am|pm)?$/,["Time","NumberRange"]],[/^[0-9.]+([a-z]{1,4})$/,"Value"]],Sa=/^[IVXLCDM]{2,}$/,_a=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,Ka="Adjective",qa="Infinitive",Wa="PresentTense",Ra="Singular",Ua="PastTense",Qa="Expression",Za="Adjective",Xa="Infinitive",Ya="PresentTense",en="Singular",tn="PastTense",rn="Adverb",an="Plural",nn="Verb",on="LastName",sn={a:[[/.[aeiou]na$/,"Noun"],[/.[oau][wvl]ska$/,"LastName"],[/.[^aeiou]ica$/,Ra],[/^([hyj]a)+$/,Qa]],c:[[/.[^aeiou]ic$/,Ka]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,Ua],[/.[aeo]{2}[bdgmnprvz]ed$/,Ua],[/.[aeiou][sg]hed$/,Ua],[/.[aeiou]red$/,Ua],[/.[aeiou]r?ried$/,Ua],[/.[bcdgtr]led$/,Ua],[/.[aoui]f?led$/,Ua],[/.[iao]sed$/,Ua],[/[aeiou]n?[cs]ed$/,Ua],[/[aeiou][rl]?[mnf]ed$/,Ua],[/[aeiou][ns]?c?ked$/,Ua],[/[aeiou][nl]?ged$/,Ua],[/.[tdbwxz]ed$/,Ua],[/[^aeiou][aeiou][tvx]ed$/,Ua],[/.[cdlmnprstv]ied$/,Ua],[/[^aeiou]ard$/,Ra],[/[aeiou][^aeiou]id$/,Ka],[/.[vrl]id$/,Ka]],e:[[/.[lnr]ize$/,qa],[/.[^aeiou]ise$/,qa],[/.[aeiou]te$/,qa],[/.[^aeiou][ai]ble$/,Ka],[/.[^aeiou]eable$/,Ka],[/.[ts]ive$/,Ka],[/[a-z]-like$/,Ka]],h:[[/.[^aeiouf]ish$/,Ka],[/.v[iy]ch$/,"LastName"],[/^ug?h+$/,Qa],[/^uh[ -]?oh$/,Qa],[/[a-z]-ish$/,Ka]],i:[[/.[oau][wvl]ski$/,"LastName"]],k:[[/^(k){2}$/,Qa]],l:[[/.[gl]ial$/,Ka],[/.[^aeiou]ful$/,Ka],[/.[nrtumcd]al$/,Ka],[/.[^aeiou][ei]al$/,Ka]],m:[[/.[^aeiou]ium$/,Ra],[/[^aeiou]ism$/,Ra],[/^h*u*m+$/,Qa],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,Ka],[/[^aeiou]ician$/,"Actor"],[/[aeiou][ktrp]in$/,"Gerund"]],o:[[/^no+$/,Qa],[/^(yo)+$/,Qa],[/^woo+[pt]?$/,Qa]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,Ra],[/[^i]fer$/,qa],[/.[^aeiou][ao]pher$/,"Actor"],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,Ka],[/[aeiou].*ist$/,Ka],[/^[a-z]et$/,"Verb"]],s:[[/.[^aeiou]ises$/,Wa],[/.[rln]ates$/,Wa],[/.[^z]ens$/,"Verb"],[/.[lstrn]us$/,Ra],[/.[aeiou]sks$/,Wa],[/.[aeiou]kes$/,Wa],[/[aeiou][^aeiou]is$/,Ra],[/[a-z]\'s$/,"Noun"],[/^yes+$/,Qa]],v:[[/.[^aeiou][ai][kln]ov$/,"LastName"]],y:[[/.[cts]hy$/,Ka],[/.[st]ty$/,Ka],[/.[gk]y$/,Ka],[/.[tnl]ary$/,Ka],[/.[oe]ry$/,Ra],[/[rdntkbhs]ly$/,"Adverb"],[/...lly$/,"Adverb"],[/[bszmp]{2}y$/,Ka],[/.(gg|bb|zz)ly$/,Ka],[/.[ai]my$/,Ka],[/[ea]{2}zy$/,Ka],[/.[^aeiou]ity$/,Ra]]},ln=[null,null,{ea:en,ia:"Noun",ic:Za,ly:rn,"'n":nn,"'t":nn},{oed:tn,ued:tn,xed:tn," so":rn,"'ll":"Modal","'re":"Copula",azy:Za,eer:"Noun",end:nn,ped:tn,ffy:Za,ify:Xa,ing:"Gerund",ize:Xa,lar:Za,mum:Za,nes:Ya,nny:Za,oid:Za,ous:Za,que:Za,rol:en,sis:en,zes:Ya},{amed:tn,aped:tn,ched:tn,lked:tn,nded:tn,cted:tn,dged:tn,akis:on,cede:Xa,chuk:on,czyk:on,ects:Ya,ends:nn,enko:on,ette:en,fies:Ya,fore:rn,gate:Xa,gone:Za,ices:an,ints:an,ines:an,ions:an,less:rn,llen:Za,made:Za,nsen:on,oses:Ya,ould:"Modal",some:Za,sson:on,tage:Xa,teen:"Value",tion:en,tive:Za,tors:"Noun",vice:en},{tized:tn,urned:tn,eased:tn,ances:an,bound:Za,ettes:an,fully:rn,ishes:Ya,ities:an,marek:on,nssen:on,ology:"Noun",ports:an,rough:Za,tches:Ya,tieth:"Ordinal",tures:an,wards:rn,where:rn},{auskas:on,keeper:"Actor",logist:"Actor",teenth:"Value"},{opoulos:on,borough:"Place",sdottir:on}],un=/^(\u00a9|\u00ae|[\u2319-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/,cn={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"<3":!0,"</3":!0,"<\\3":!0},hn={lexicon:Va,punctuation:function(ss,ts,rs){let ns=ss[ts];if(Ma.test(ns.text)&&!Ma.test(ns.pre)&&!Ma.test(ns.post)&&ns.clean.length>2){let is=ns.clean[ns.clean.length-2];if(is==="s")return void ns.tag(["Possessive","Noun"],"end-tick",rs);is==="n"&&ns.tag(["Gerund"],"chillin",rs)}Ja.test(ns.text)&&ns.tag("Unit","per-sec",rs)},regex:function(ss,ts){let rs=ss.text;for(let ns=0;ns<La.length;ns+=1)if(La[ns][0].test(rs)===!0){ss.tagSafe(La[ns][1],"prefix #"+ns,ts);break}ss.text.length>=2&&Sa.test(rs)&&_a.test(rs)&&ss.tag("RomanNumeral","xvii",ts)},suffix:function(ss,ts){(function(rs,ns){const is=rs.clean.length;let as=7;is<=as&&(as=is-1);for(let os=as;os>1;os-=1){let ls=rs.clean.substr(is-os,is);if(ln[ls.length].hasOwnProperty(ls)===!0){let us=ln[ls.length][ls];rs.tagSafe(us,"suffix -"+ls,ns);break}}})(ss,ts),function(rs,ns){let is=rs.clean,as=is[is.length-1];if(sn.hasOwnProperty(as)===!0){let os=sn[as];for(let ls=0;ls<os.length;ls+=1)if(os[ls][0].test(is)===!0){rs.tagSafe(os[ls][1],`endReg ${as} #${ls}`,ns);break}}}(ss,ts)},emoji:(ss,ts)=>{let rs=ss.pre+ss.text+ss.post;var ns;rs=rs.trim(),rs=rs.replace(/[.!?,]$/,""),(is=>!(is.charAt(0)!==":"||is.match(/:.?$/)===null||is.match(" ")||is.length>35))(rs)===!0&&(ss.tag("Emoji","comma-emoji",ts),ss.text=rs,ss.pre=ss.pre.replace(":",""),ss.post=ss.post.replace(":","")),ss.text.match(un)&&(ss.tag("Emoji","unicode-emoji",ts),ss.text=rs),ns=(ns=rs).replace(/^[:;]/,":"),cn.hasOwnProperty(ns)===!0&&(ss.tag("Emoticon","emoticon-emoji",ts),ss.text=rs)}};var dn=function(ss,ts){let rs=ss.world;hn.lexicon(ts,rs);for(let ns=0;ns<ts.length;ns+=1){let is=ts[ns];hn.punctuation(ts,ns,rs),hn.regex(is,rs),hn.suffix(is,rs),hn.emoji(is,rs)}return ss};const gn={beforeThisWord:{there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},afterThisWord:{i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},beforeThisPos:{Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",Pluperfect:"Noun",PerfectTense:"Verb"},afterThisPos:{Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"}},pn=Object.keys(gn.afterThisPos),mn=Object.keys(gn.beforeThisPos);var fn=function(ss,ts){for(let rs=0;rs<ss.length;rs+=1){let ns=ss[rs];if(ns.isKnown()===!0)continue;let is=ss[rs-1];if(is){if(gn.afterThisWord.hasOwnProperty(is.clean)===!0){let ls=gn.afterThisWord[is.clean];ns.tag(ls,"after-"+is.clean,ts);continue}let os=pn.find(ls=>is.tags[ls]);if(os!==void 0){let ls=gn.afterThisPos[os];ns.tag(ls,"after-"+os,ts);continue}}let as=ss[rs+1];if(as){if(gn.beforeThisWord.hasOwnProperty(as.clean)===!0){let ls=gn.beforeThisWord[as.clean];ns.tag(ls,"before-"+as.clean,ts);continue}let os=mn.find(ls=>as.tags[ls]);if(os!==void 0){let ls=gn.beforeThisPos[os];ns.tag(ls,"before-"+os,ts);continue}}}};const bn=/^[A-Z][a-z'\u00C0-\u00FF]/,yn=/[0-9]/;var vn=function(ss){let ts=ss.world;ss.list.forEach(rs=>{let ns=rs.terms();for(let is=1;is<ns.length;is++){const as=ns[is];bn.test(as.text)===!0&&yn.test(as.text)===!1&&as.tags.Date===void 0&&as.tag("ProperNoun","titlecase-noun",ts)}})};const wn=/^(re|un)-?[a-z\u00C0-\u00FF]/,kn=/^(re|un)-?/;var An=function(ss,ts){let rs=ts.words;ss.forEach(ns=>{if(ns.isKnown()!==!0&&wn.test(ns.clean)===!0){let is=ns.clean.replace(kn,"");is&&is.length>3&&rs[is]!==void 0&&rs.hasOwnProperty(is)===!0&&ns.tag(rs[is],"stem-"+is,ts)}})};const Dn=["Uncountable","Pronoun","Place","Value","Person","Month","WeekDay","Holiday"],$n={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/s[aeiou]+ns$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/is$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i]},Pn=[/ss$/,/sis$/,/[^aeiou][uo]s$/,/'s$/],En=[/i$/,/ae$/];var Hn=function(ss,ts){if(ss.tags.Noun&&!ss.tags.Acronym){let rs=ss.clean;if(ss.tags.Singular||ss.tags.Plural)return;if(rs.length<=3)return void ss.tag("Singular","short-singular",ts);if(Dn.find(ns=>ss.tags[ns]))return;if($n.isPlural.find(ns=>ns.test(rs)))return void ss.tag("Plural","plural-rules",ts);if($n.isSingular.find(ns=>ns.test(rs)))return void ss.tag("Singular","singular-rules",ts);if(/s$/.test(rs)===!0)return Pn.find(ns=>ns.test(rs))?void 0:void ss.tag("Plural","plural-fallback",ts);if(En.find(ns=>ns.test(rs)))return;ss.tag("Singular","singular-fallback",ts)}};let jn=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(function(ss,ts){return ss[ts]="Noun",ss},{});const Nn=function(ss){return!!ss.tags.Noun&&!(ss.tags.Pronoun||ss.tags.Comma||ss.tags.Possessive)&&!!(ss.tags.Organization||ss.tags.Acronym||ss.tags.Place||ss.titleCase())},xn=/^[A-Z]('s|,)?$/,Fn=/([A-Z]\.){2}[A-Z]?/i,Cn={I:!0,A:!0},Bn={neighbours:fn,case:vn,stem:An,plural:Hn,organizations:function(ss,ts){for(let rs=0;rs<ss.length;rs+=1){let ns=ss[rs];if(jn[ns.clean]!==void 0&&jn.hasOwnProperty(ns.clean)===!0){let is=ss[rs-1];if(is!==void 0&&Nn(is)===!0){is.tagSafe("Organization","org-word-1",ts),ns.tagSafe("Organization","org-word-2",ts);continue}let as=ss[rs+1];if(as!==void 0&&as.clean==="of"&&ss[rs+2]&&Nn(ss[rs+2])){ns.tagSafe("Organization","org-of-word-1",ts),as.tagSafe("Organization","org-of-word-2",ts),ss[rs+2].tagSafe("Organization","org-of-word-3",ts);continue}}}},acronyms:function(ss,ts){ss.forEach(rs=>{rs.tags.RomanNumeral!==!0&&(Fn.test(rs.text)===!0&&rs.tag("Acronym","period-acronym",ts),rs.isUpperCase()&&function(ns,is){let as=ns.reduced;return!!ns.tags.Acronym||!is.words[as]&&!(as.length>5)&&ns.isAcronym()}(rs,ts)?(rs.tag("Acronym","acronym-step",ts),rs.tag("Noun","acronym-infer",ts)):!Cn.hasOwnProperty(rs.text)&&xn.test(rs.text)&&(rs.tag("Acronym","one-letter-acronym",ts),rs.tag("Noun","one-letter-infer",ts)),rs.tags.Organization&&rs.text.length<=3&&rs.tag("Acronym","acronym-org",ts),rs.tags.Organization&&rs.isUpperCase()&&rs.text.length<=6&&rs.tag("Acronym","acronym-org-case",ts))})}};var Gn=function(ss,ts){let rs=ss.world;return Bn.neighbours(ts,rs),Bn.case(ss),Bn.stem(ts,rs),ts.forEach(ns=>{ns.isKnown()===!1&&ns.tag("Noun","noun-fallback",ss.world)}),Bn.organizations(ts,rs),Bn.acronyms(ts,rs),ts.forEach(ns=>{Bn.plural(ns,ss.world)}),ss};const zn=/n't$/,In={"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],dont:["do","not"],dun:["do","not"]},On=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z]{1,2})$/i,Tn={ll:"will",ve:"have",re:"are",m:"am","n't":"not"},Vn={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],ive:["i","have"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],howd:["how","did"],whatd:["what","did"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]},Mn=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]s$/i,Jn={that:!0,there:!0},Ln={here:!0,there:!0,everywhere:!0},Sn=/[a-z\u00C0-\u00FF]'d$/,_n={how:!0,what:!0},Kn=/^([0-9.]{1,3}[a-z]{0,2}) ?[-] ?([0-9]{1,3}[a-z]{0,2})$/i,qn=/^([0-9][0-9]?(:[0-9][0-9])?(am|pm)?) ?[-] ?([0-9][0-9]?(:[0-9][0-9])?(am|pm)?)$/i,Wn=/^(l|c|d|j|m|n|qu|s|t)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z\u00C0-\u00FF]+)$/i,Rn={l:"le",c:"ce",d:"de",j:"je",m:"me",n:"ne",qu:"que",s:"se",t:"tu"},Un=Va,Qn=xt,Zn=function(ss,ts){return In.hasOwnProperty(ss.clean)===!0?In[ss.clean]:ss.clean==="ain't"||ss.clean==="aint"?function(rs,ns){let is=ns.terms(),as=is.indexOf(rs),os=is.slice(0,as).find(ls=>ls.tags.Noun);return os&&os.tags.Plural?["are","not"]:["is","not"]}(ss,ts):zn.test(ss.clean)===!0?[ss.clean.replace(zn,""),"not"]:null},Xn=function(ss){let ts=ss.text.match(On);return ts===null?null:Tn.hasOwnProperty(ts[2])?[ts[1],Tn[ts[2]]]:null},Yn=function(ss){return Vn.hasOwnProperty(ss.clean)?Vn[ss.clean]:null},ei=function(ss,ts,rs){let ns=ss.text.match(Mn);if(ns!==null){if(((is,as)=>{if(is.tags.Possessive)return!0;if(is.tags.Pronoun||is.tags.QuestionWord||Jn.hasOwnProperty(is.reduced))return!1;let os=as.get(is.next);if(!os)return!0;if(os.tags.Verb)return!!os.tags.Infinitive||!!os.tags.PresentTense;if(os.tags.Noun)return Ln.hasOwnProperty(os.reduced)!==!0;let ls=as.get(os.next);return!(!ls||!ls.tags.Noun||ls.tags.Pronoun)||(os.tags.Adjective||os.tags.Adverb||os.tags.Verb,!1)})(ss,ts.pool)===!0)return ss.tag("#Possessive","isPossessive",rs),null;if(ns!==null)return((is,as)=>{let os=as.terms(),ls=os.indexOf(is);return os.slice(ls+1,ls+3).find(us=>us.tags.PastTense)})(ss,ts)?[ns[1],"has"]:[ns[1],"is"]}return null},ti=function(ss,ts){if(Sn.test(ss.clean)){let rs=ss.clean.replace(/'d$/,""),ns=ts.terms(),is=ns.indexOf(ss),as=ns.slice(is+1,is+4);for(let os=0;os<as.length;os++){let ls=as[os];if(ls.tags.Verb)return ls.tags.PastTense?[rs,"had"]:_n[rs]===!0?[rs,"did"]:[rs,"would"]}return[rs,"would"]}return null},ri=function(ss){if(ss.tags.PhoneNumber===!0)return null;let ts=ss.text.match(Kn);return ts!==null?[ts[1],"to",ts[2]]:(ts=ss.text.match(qn),ts!==null?[ts[1],"to",ts[4]]:null)},ai=function(ss){let ts=ss.text.match(Wn);if(ts===null||Rn.hasOwnProperty(ts[1])===!1)return null;let rs=[Rn[ts[1]],ts[2]];return rs[0]&&rs[1]?rs:null},ni=/^[0-9]+$/,ii=/^[0-9]+(st|nd|rd|th)$/,oi=/^[0-9:]+(am|pm)?$/,si=function(ss,ts){let rs=Qn(ss.join(" "),ts.world,ts.pool())[0],ns=rs.terms();Un(ns,ts.world);let is=ns[0];return ii.test(is.text)&&ns[2]?(ns[0].tag("Ordinal","ord-range",ts.world),ns[2].tag("Ordinal","ord-range",ts.world)):ni.test(is.text)&&ns[2]?(ns[0].tag("Cardinal","num-range",ts.world),ns[2].tag("Cardinal","num-range",ts.world)):oi.test(is.text)&&ns[1]&&ns[2]&&(ns[0].tag("Time","time-range",ts.world),ns[1].tag("Date","time-range",ts.world),ns[2].tag("Time","time-range",ts.world)),ns.forEach(as=>{as.implicit=as.text,as.text="",as.clean="",as.pre="",as.post="",Object.keys(as.tags).length===0&&(as.tags.Noun=!0)}),rs};var li=function(ss){let ts=ss.world;return ss.list.forEach(rs=>{let ns=rs.terms();for(let is=0;is<ns.length;is+=1){let as=ns[is],os=Zn(as,rs);if(os=os||Xn(as),os=os||Yn(as),os=os||ei(as,rs,ts),os=os||ti(as,rs),os=os||ri(as),os=os||ai(as),os!==null){let ls=si(os,ss);rs.has("#NumberRange")===!0&&ss.buildFrom([ls]).tag("NumberRange"),ls.terms(0).text=as.text,rs.buildFrom(as.id,1,ss.pool()).replace(ls,ss,!0)}}}),ss};const ui=function(ss,ts){let rs=ss._cache.tags[ts]||[];return rs=rs.map(ns=>ss.list[ns]),ss.buildFrom(rs)};var ci=function(ss){let ts=ui(ss,"Infinitive");return ts.found&&(ts=ts.ifNo("@hasQuestionMark"),ts=ts.ifNo("(i|we|they)"),ts.not("will be").match("[#Infinitive] (#Determiner|#Possessive) #Noun").notIf("(our|their)").match("#Infinitive").tag("Imperative","shut-the"),ts.match("^[#Infinitive] #Adverb?$",0).tag("Imperative","go-fast"),ts.match("[(do && #Infinitive)] not? #Verb",0).tag("Imperative","do-not"),ts.match("[#Infinitive] (it|some) (#Comparative|#Preposition|please|now|again)",0).tag("Imperative","do-it")),ts=function(rs,ns){let is=rs._cache.words[ns]||[];return is=is.map(as=>rs.list[as]),rs.buildFrom(is)}(ss,"like"),ts.match("#Adverb like").notIf("(really|generally|typically|usually|sometimes|often|just) [like]").tag("Adverb","adverb-like"),ts=ui(ss,"Adjective"),ts.match("#Determiner #Adjective$").notIf("(#Comparative|#Superlative)").terms(1).tag("Noun","the-adj-1"),ts=ui(ss,"FirstName"),ts.match("#FirstName (#Noun|@titleCase)").ifNo("^#Possessive").ifNo("(#Pronoun|#Plural)").ifNo("@hasComma .").lastTerm().tag("#LastName","firstname-noun"),ts=ui(ss,"Value"),ts=ts.match("#Value #PresentTense").ifNo("#Copula"),ts.found&&(ts.has("(one|1)")===!0?ts.terms(1).tag("Singular","one-presentTense"):ts.terms(1).tag("Plural","value-presentTense")),ss.match("^(well|so|okay)").tag("Expression","well-"),ss.match("#Value [of a second]",0).unTag("Value","of-a-second"),ss.match("#Value [seconds]",0).unTag("Value","30-seconds").tag(["Unit","Plural"]),ts=ui(ss,"Gerund"),ts.match("(be|been) (#Adverb|not)+? #Gerund").not("#Verb$").tag("Auxiliary","be-walking"),ss.match("(try|use|attempt|build|make) #Verb").ifNo("(@hasComma|#Negative|#PhrasalVerb|#Copula|will|be)").lastTerm().tag("#Noun","do-verb"),ts=ui(ss,"Possessive"),ts=ts.match("#Possessive [#Infinitive]",0),ts.lookBehind("(let|made|make|force|ask)").found||ts.tag("Noun","her-match"),ss},hi=function(ss){let ts={};for(let rs=0;rs<ss.length;rs++)ts[ss[rs]]=!0;return Object.keys(ts)},di=[{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"u r",tag:"Pronoun Copula",reason:"u r"},{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"#Noun #Actor",tag:"Actor",reason:"thing-doer"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Copula just [like]",group:0,tag:"Preposition",reason:"like-preposition"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"^how",tag:"QuestionWord",reason:"how-question"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"^which",tag:"QuestionWord",reason:"which-question"},{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"}],gi={adverbAdjective:["dark","bright","flat","light","soft","pale","dead","dim","faux","little","wee","sheer","most","near","good","extra","all"],personDate:["april","june","may","jan","august","eve"],personMonth:["january","april","may","june","jan","sep"],personAdjective:["misty","rusty","dusty","rich","randy","young"],personVerb:["pat","wade","ollie","will","rob","buck","bob","mark","jack"],personPlace:["darwin","hamilton","paris","alexandria","houston","kobe","santiago","salvador","sydney","victoria"],personNoun:["art","baker","berg","bill","brown","charity","chin","christian","cliff","daisy","dawn","dick","dolly","faith","franco","gene","green","hall","hill","holly","hope","jean","jewel","joy","kelvin","king","kitty","lane","lily","melody","mercedes","miles","olive","penny","ray","reed","robin","rod","rose","sky","summer","trinity","van","viola","violet","wang","white"]};const pi=`(${gi.personDate.join("|")})`;var mi=[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"this [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"next [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"last [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"[(march|may)] the? #Value",group:0,tag:"Month",reason:"march-5th"},{match:"#Value of? [(march|may)]",group:0,tag:"Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:`in [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`during [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`on [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`by [${pi}]`,group:0,tag:"Date",reason:"by-june"},{match:`after [${pi}]`,group:0,tag:"Date",reason:"after-june"},{match:`#Date [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:pi+" #Value",tag:"Date",reason:"june-5th"},{match:pi+" #Date",tag:"Date",reason:"june-5th"},{match:pi+" #ProperNoun",tag:"Person",reason:"june-smith",safe:!0},{match:pi+" #Acronym? (#ProperNoun && !#Month)",tag:"Person",reason:"june-smith-jr"},{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}];const fi=`(${gi.personAdjective.join("|")})`;var bi=[{match:"[all] #Determiner? #Noun",group:0,tag:"Adjective",reason:"all-noun"},{match:`#Adverb [${fi}]`,group:0,tag:"Adjective",reason:"really-rich"},{match:fi+" #Person",tag:"Person",reason:"randy-smith"},{match:fi+" #Acronym? #ProperNoun",tag:"Person",reason:"rusty-smith"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"(a|an) [#Gerund]",group:0,tag:"Adjective",reason:"a|an"},{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(it|he|she|everything|something) #Adverb? was #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"it-was-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,tag:"Infinitive",reason:"shut-the"},{match:"the [said] #Noun",group:0,tag:"Adjective",reason:"the-said-card"},{match:"#Noun (that|which|whose) [#PastTense && !#Copula] #Noun",group:0,tag:"Adjective",reason:"that-past-noun"}],yi=[{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"(#Verb && !#Modal) (all|every|each|most|some|no) [#PresentTense]",group:0,tag:"Noun",reason:"all-presentTense"},{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adj-presentTense"},{match:"^#Adjective [#PresentTense]",group:0,tag:"Noun",reason:"start adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",reason:"many-poses"},{match:"#Adverb #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"very-big-dream"},{match:"#Adjective [#Infinitive] #Noun",group:0,tag:"Noun",reason:"good-wait-staff"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adorable-little-store"},{match:"#Preposition #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"of-basic-training"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",reason:"early-warning"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"higher-costs"},{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"(his|her|its) [#Adjective]",group:0,tag:"Noun",reason:"his-fine"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"more #Noun",tag:"Noun",reason:"more-noun"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",reason:"noun-list"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Noun",reason:"bit-2"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner #Adverb [#Infinitive]",group:0,tag:"Noun",reason:"the-reason"},{match:"(the|this|those|these) #Adjective [#Verb]",group:0,tag:"Noun",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)",group:0,tag:"Noun",reason:"the-adj-2"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner [#Infinitive] #Noun",group:0,tag:"Noun",reason:"determiner7"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"#Determiner [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",reason:"noun-of-noun"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"#Possessive [#Gerund]",group:0,tag:"Noun",reason:"her-polling"},{match:"(his|her|its) [#PresentTense]",group:0,tag:"Noun",reason:"its-polling"},{match:"(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun",group:0,tag:"Noun",reason:"technical-noun"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(the|those|these|a|an) #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"det-inf"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense]",group:0,tag:"Noun",reason:"det-pres"},{match:"(the|those|these|a|an) #Adjective? [#PastTense]",group:0,tag:"Noun",reason:"det-past"},{match:"(this|that) [#Gerund]",group:0,tag:"Noun",reason:"this-gerund"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(#Noun && @hasHyphen) #Verb",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"[#Verb] than",group:0,tag:"Noun",reason:"correction"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Noun [#Infinitive] (#Preposition|#Noun)",group:0,tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Copula [#Infinitive] #Noun",group:0,tag:"Noun",reason:"is-pres-noun"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"#Gerund #Adjective to [#Infinitive]",group:0,tag:"Noun",reason:"running-to"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"co #Noun",tag:"Actor",reason:"co-noun"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"},{match:"a #Noun+ or #Adverb+? [#Verb]",group:0,tag:"Noun",reason:"noun-or-noun"},{match:"[#Gerund] system",group:0,tag:"Noun",reason:"operating-system"},{match:"#PastTense (until|as|through|without) [#PresentTense]",group:0,tag:"Noun",reason:"waited-until-release"},{match:"#Gerund like #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"like-hot-cakes"},{match:"some #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"some-reason"},{match:"for some [#PresentTense]",group:0,tag:"Noun",reason:"for-some-reason"},{match:"(same|some|the|that|a) kind of [#PresentTense]",group:0,tag:"Noun",reason:"some-kind-of"},{match:"(same|some|the|that|a) type of [#PresentTense]",group:0,tag:"Noun",reason:"some-type-of"},{match:"#Gerund #Adjective #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"doing-better-for-x"},{match:"(get|got|have|had) #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"got-better-aim"},{match:"#Pronoun #Infinitive [#Gerund] #PresentTense",group:0,tag:"Noun",reason:"tipping-sucks"}],vi=[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"(#Verb && !#Modal) [like]",group:0,tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"(#PresentTense && !#Copula) [(hard|quick|long|bright|slow|fast|backwards|forwards)]",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:`[${`(${gi.adverbAdjective.join("|")})`}] #Adjective`,group:0,tag:"Adverb",reason:"dark-green"},{match:"#Adverb [#Adverb]$",group:0,tag:"Adjective",reason:"kinda-sparkly"},{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"},{match:"[super] #Adjective #Noun",group:0,tag:"Adverb",reason:"super-strong"}],wi=[{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"(#Value|a) [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"a #Value",tag:"Value",reason:"a-value"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"(hundred|thousand|million|billion|trillion|quadrillion)+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"!once [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"}];const ki=`(${gi.personVerb.join("|")})`;var Ai=[{match:"[#Adjective] #Possessive #Noun",group:0,tag:"Verb",reason:"gerund-his-noun"},{match:"[#Adjective] (us|you)",group:0,tag:"Gerund",reason:"loving-you"},{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Gerund",reason:"slowly-adj"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"do (simply|just|really|not)+ [(#Adjective|like)]",group:0,tag:"Verb",reason:"do-simply-like"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"(this|that) [#Plural]",group:0,tag:"PresentTense",reason:"this-verbs"},{match:"[#Copula (#Adverb|not)+?] (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"#Adverb+? [(#Modal|did)+ (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|will|have|had)] (not|#Adverb)+? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? be (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"(#Modal|had|has) (#Adverb|not)+? been (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-foo"},{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"#PhrasalVerb [#PhrasalVerb]",group:0,tag:"Particle",reason:"phrasal-particle"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"},{match:"[will #Adverb? not? #Adverb? be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|to|toward)",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"will [#Adjective]",group:0,tag:"Verb",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [#Adjective] to #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"[#PresentTense] (are|were|was) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:`#Modal [${ki}]`,group:0,tag:"Verb",reason:"would-mark"},{match:`#Adverb [${ki}]`,group:0,tag:"Verb",reason:"really-mark"},{match:"(to|#Modal) [mark]",group:0,tag:"PresentTense",reason:"to-mark"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:ki+" #Person",tag:"Person",reason:"rob-smith"},{match:ki+" #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"},{match:"(become|fall|grow) #Adverb? [#PastTense]",group:0,tag:"Adjective",reason:"overly-weakened"},{match:"(a|an) #Adverb [#Participle] #Noun",group:0,tag:"Adjective",reason:"completely-beaten"},{match:"whose [#PresentTense] #Copula",group:0,tag:"Noun",reason:"whos-name-was"},{match:"#PhrasalVerb #PhrasalVerb #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"given-up-on-x"}],Di=[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)",tag:"Region",reason:"foo-district"},{match:"(district|region|province|municipality|territory|burough|state) of #ProperNoun",tag:"Region",reason:"district-of-Foo"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"}];const $i=gi,Pi=`(${$i.personNoun.join("|")})`,Ei=`(${$i.personMonth.join("|")})`;var Hi=[{match:"[(1st|2nd|first|second)] #Honorific",group:0,tag:"Honorific",reason:"ordinal-honorific"},{match:"[(private|general|major|corporal|lord|lady|secretary|premier)] #Honorific? #Person",group:0,tag:"Honorific",reason:"ambg-honorifics"},{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(lady|queen|sister) #ProperNoun",tag:"FemaleName",reason:"lady-titlecase",safe:!0},{match:"(king|pope|father) #ProperNoun",tag:"MaleName",reason:"pope-titlecase",safe:!0},{match:"[(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill)] #LastName",group:0,tag:"FirstName",reason:"maybe-lastname"},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"NickName",reason:"first-noun-last"},{match:"#Possessive [#FirstName]",group:0,tag:"Person",reason:"possessive-name"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-latname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Honorific #Person",tag:"Person",reason:"honorific-person"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",reason:"saint-foo"},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)",tag:"Person",reason:"bill-green"},{match:Pi+" #Person",tag:"Person",reason:"ray-smith",safe:!0},{match:Pi+" #Acronym? #ProperNoun",tag:"Person",reason:"ray-a-smith",safe:!0},{match:`#Infinitive #Determiner? #Adjective? #Noun? (to|for) [${Ei}]`,group:0,tag:"Person",reason:"ambig-person"},{match:`#Infinitive [${Ei}]`,group:0,tag:"Person",reason:"infinitive-person"},{match:`[${Ei}] #Modal`,group:0,tag:"Person",reason:"ambig-modal"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:`#Modal [${Ei}]`,group:0,tag:"Person",reason:"modal-ambig"},{match:`#Copula [${Ei}]`,group:0,tag:"Person",reason:"is-may"},{match:`[${Ei}] #Copula`,group:0,tag:"Person",reason:"may-is"},{match:`that [${Ei}]`,group:0,tag:"Person",reason:"that-month"},{match:`with [${Ei}]`,group:0,tag:"Person",reason:"with-month"},{match:`for [${Ei}]`,group:0,tag:"Person",reason:"for-month"},{match:`this [${Ei}]`,group:0,tag:"Month",reason:"this-may"},{match:`next [${Ei}]`,group:0,tag:"Month",reason:"next-may"},{match:`last [${Ei}]`,group:0,tag:"Month",reason:"last-may"},{match:`#Date [${Ei}]`,group:0,tag:"Month",reason:"date-may"},{match:`[${Ei}] the? #Value`,group:0,tag:"Month",reason:"may-5th"},{match:`#Value of [${Ei}]`,group:0,tag:"Month",reason:"5th-of-may"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",reason:"title-de-title",safe:!0},{match:"#Singular #Acronym #LastName",tag:"#Person",reason:"title-acro-noun",safe:!0},{match:"#FirstName (#Noun && #ProperNoun) #ProperNoun?",tag:"Person",reason:"firstname-titlecase"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von) #Person]",group:0,tag:"LastName",reason:"de-firstname"},{match:`[${`(${$i.personPlace.join("|")})`}] (#ProperNoun && !#Place)`,group:0,tag:"FirstName",reason:"place-firstname"}];const ji=_e,Ni=hi;let xi=[];xi=xi.concat(di),xi=xi.concat(mi),xi=xi.concat(bi),xi=xi.concat(yi),xi=xi.concat(vi),xi=xi.concat(wi),xi=xi.concat(Ai),xi=xi.concat(Di),xi=xi.concat([{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"}]),xi=xi.concat(Hi);let Fi=[];xi.forEach(ss=>{ss.reg=ji(ss.match);let ts=function(rs){let ns=[];if(rs.reg.filter(is=>is.fastOr!==void 0).length===1){let is=rs.reg.findIndex(as=>as.fastOr!==void 0);Object.keys(rs.reg[is].fastOr).forEach(as=>{let os=Object.assign({},rs);os.reg=os.reg.slice(0),os.reg[is]=Object.assign({},os.reg[is]),os.reg[is].word=as,delete os.reg[is].operator,delete os.reg[is].fastOr,ns.push(os)})}return ns}(ss);ts.length>0?Fi=Fi.concat(ts):Fi.push(ss)}),Fi.forEach(ss=>(ss.required=function(ts){let rs=[],ns=[];return ts.forEach(is=>{is.optional!==!0&&is.negative!==!0&&(is.tag!==void 0&&rs.push(is.tag),is.word!==void 0&&ns.push(is.word))}),{tags:Ni(rs),words:Ni(ns)}}(ss.reg),ss));const Ci=Fi,Bi=hi,Gi=ci,zi=function(ss){Ci.forEach(ts=>{let rs=[];ts.required.words.forEach(os=>{rs.push(ss._cache.words[os]||[])}),ts.required.tags.forEach(os=>{rs.push(ss._cache.tags[os]||[])});let ns=function(os){if(os.length===0)return[];let ls={};os.forEach(cs=>{cs=Bi(cs);for(let ps=0;ps<cs.length;ps++)ls[cs[ps]]=ls[cs[ps]]||0,ls[cs[ps]]+=1});let us=Object.keys(ls);return us=us.filter(cs=>ls[cs]===os.length),us=us.map(cs=>Number(cs)),us}(rs);if(ns.length===0)return;let is=ns.map(os=>ss.list[os]),as=ss.buildFrom(is).match(ts.reg,ts.group);as.found&&(ts.safe===!0?as.tagSafe(ts.tag,ts.reason):as.tag(ts.tag,ts.reason))})},Ii=dn,Oi=Gn,Ti=li,Vi=function(ss){return zi(ss),Gi(ss),ss};var Mi=function(ss){let ts=ss.termList();return ss=Ii(ss,ts),ss=Oi(ss,ts),(ss=Ti(ss)).cache(),(ss=Vi(ss)).uncache(),ss.world.taggers.forEach(rs=>{rs(ss)}),ss},Ji=function(ss){class ts extends ss{stripPeriods(){return this.termList().forEach(ns=>{ns.tags.Abbreviation===!0&&ns.next&&(ns.post=ns.post.replace(/^\./,""));let is=ns.text.replace(/\./,"");ns.set(is)}),this}addPeriods(){return this.termList().forEach(ns=>{ns.post=ns.post.replace(/^\./,""),ns.post="."+ns.post}),this}}return ts.prototype.unwrap=ts.prototype.stripPeriods,ss.prototype.abbreviations=function(rs){let ns=this.match("#Abbreviation");return typeof rs=="number"&&(ns=ns.get(rs)),new ts(ns.list,this,this.world)},ss};const Li=/\./;var Si=function(ss){class ts extends ss{stripPeriods(){return this.termList().forEach(ns=>{let is=ns.text.replace(/\./g,"");ns.set(is)}),this}addPeriods(){return this.termList().forEach(ns=>{let is=ns.text.replace(/\./g,"");is=is.split("").join("."),Li.test(ns.post)===!1&&(is+="."),ns.set(is)}),this}}return ts.prototype.unwrap=ts.prototype.stripPeriods,ts.prototype.strip=ts.prototype.stripPeriods,ss.prototype.acronyms=function(rs){let ns=this.match("#Acronym");return typeof rs=="number"&&(ns=ns.get(rs)),new ts(ns.list,this,this.world)},ss},_i=function(ss){return ss.prototype.clauses=function(ts){let rs=this.if("@hasComma").notIf("@hasComma @hasComma").notIf("@hasComma . .? (and|or) .").notIf("(#City && @hasComma) #Country").notIf("(#WeekDay && @hasComma) #Date").notIf("(#Date && @hasComma) #Year").notIf("@hasComma (too|also)$").match("@hasComma"),ns=this.splitAfter(rs),is=ns.quotations();ns=ns.splitOn(is);let as=ns.parentheses();ns=ns.splitOn(as);let os=ns.if("#Copula #Adjective #Conjunction (#Pronoun|#Determiner) #Verb").match("#Conjunction");ns=ns.splitBefore(os);let ls=ns.if("if .{2,9} then .").match("then");ns=ns.splitBefore(ls),ns=ns.splitBefore("as well as ."),ns=ns.splitBefore("such as ."),ns=ns.splitBefore("in addition to ."),ns=ns.splitAfter("@hasSemicolon"),ns=ns.splitAfter("@hasDash");let us=ns.filter(cs=>cs.wordCount()>5&&cs.match("#Verb+").length>=2);if(us.found){let cs=us.splitAfter("#Noun .* #Verb .* #Noun+");ns=ns.splitOn(cs.eq(0))}return typeof ts=="number"&&(ns=ns.get(ts)),new ss(ns.list,this,this.world)},ss},Ki=function(ss){class ts extends ss{constructor(ns,is,as){super(ns,is,as),this.contracted=null}expand(){return this.list.forEach(ns=>{let is=ns.terms(),as=is[0].isTitleCase();is.forEach((os,ls)=>{os.set(os.implicit||os.text),os.implicit=void 0,ls<is.length-1&&os.post===""&&(os.post+=" ")}),as&&is[0].toTitleCase()}),this}}return ss.prototype.contractions=function(rs){let ns=this.match("@hasContraction+");return typeof rs=="number"&&(ns=ns.get(rs)),new ts(ns.list,this,this.world)},ss.prototype.expanded=ss.prototype.isExpanded,ss.prototype.contracted=ss.prototype.isContracted,ss},qi=function(ss){const ts=function(ns){let is=ns.splitAfter("@hasComma").splitOn("(and|or) not?").not("(and|or) not?"),as=ns.match("[.] (and|or)",0);return{things:is,conjunction:ns.match("(and|or) not?"),beforeLast:as,hasOxford:as.has("@hasComma")}};class rs extends ss{conjunctions(){return this.match("(and|or)")}parts(){return this.splitAfter("@hasComma").splitOn("(and|or) not?")}items(){return ts(this).things}add(is){return this.forEach(as=>{let os=ts(as).beforeLast;os.append(is),os.termList(0).addPunctuation(",")}),this}remove(is){return this.items().if(is).remove()}hasOxfordComma(){return this.filter(is=>ts(is).hasOxford)}addOxfordComma(){let is=this.items(),as=is.eq(is.length-2);return as.found&&as.has("@hasComma")===!1&&as.post(", "),this}removeOxfordComma(){let is=this.items(),as=is.eq(is.length-2);return as.found&&as.has("@hasComma")===!0&&as.post(" "),this}}return rs.prototype.things=rs.prototype.items,ss.prototype.lists=function(ns){let is=this.if("@hasComma+ .? (and|or) not? ."),as=is.match("(#Noun|#Adjective|#Determiner|#Article)+ #Conjunction not? (#Article|#Determiner)? #Adjective? #Noun+").if("#Noun"),os=is.match("(#Adjective|#Adverb)+ #Conjunction not? #Adverb? #Adjective+"),ls=is.match("(#Verb|#Adverb)+ #Conjunction not? #Adverb? #Verb+"),us=as.concat(os);return us=us.concat(ls),us=us.if("@hasComma"),typeof ns=="number"&&(us=is.get(ns)),new rs(us.list,this,this.world)},ss};const Wi={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},Ri={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},Ui=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i],Qi={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/men$/i,/.tia$/i,/(m|l)ice$/i]},Zi=/s$/,Xi={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"},Yi=function(ss){return ss.has("#Plural")===!0||ss.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)")!==!0},eo=function(ss){if(ss.has("#Person")||ss.has("#Place"))return"";if(ss.has("#Plural"))return"the";let ts=ss.text("normal").trim();if(Wi.hasOwnProperty(ts))return Wi[ts];let rs=ts.substr(0,1);if(ss.has("^@isAcronym")&&Ri.hasOwnProperty(rs))return"an";for(let ns=0;ns<Ui.length;ns++)if(Ui[ns].test(ts))return"a";return/^[aeiou]/i.test(ts)?"an":"a"},to=function(ss){return!Qi.isSingular.find(ts=>ts.test(ss))&&(Zi.test(ss)===!0||!!Qi.isPlural.find(ts=>ts.test(ss))||null)},ro=function(ss){let ts=ss.text("text").trim();return Xi.hasOwnProperty(ts)?(ss.replaceWith(Xi[ts],!0),void ss.tag("Possessive","toPossessive")):/s$/.test(ts)?(ts+="'",ss.replaceWith(ts,!0),void ss.tag("Possessive","toPossessive")):(ts+="'s",ss.replaceWith(ts,!0),void ss.tag("Possessive","toPossessive"))},ao=function(ss){let ts={main:ss};if(ss.has("#Noun (of|by|for) .")){let rs=ss.splitAfter("[#Noun+]",0);ts.main=rs.eq(0),ts.post=rs.eq(1)}return ts},no={json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0];is.article=eo(ns),rs.push(is)}),ts!==null?rs[ts]:rs},adjectives:function(){let ss=this.lookAhead("^(that|who|which)? (was|is|will)? be? #Adverb? #Adjective+");return ss=ss.concat(this.lookBehind("#Adjective+ #Adverb?$")),ss=ss.match("#Adjective"),ss.sort("index")},isPlural:function(){return this.if("#Plural")},hasPlural:function(){return this.filter(ss=>Yi(ss))},toPlural:function(ss){let ts=this.world.transforms.toPlural;return this.forEach(rs=>{if(rs.has("#Plural")||Yi(rs)===!1)return;let ns=ao(rs).main,is=ns.text("reduced");if((ns.has("#Singular")||to(is)!==!0)&&(is=ts(is,this.world),ns.replace(is).tag("#Plural"),ss)){let as=ns.lookBefore("(an|a) #Adjective?$").not("#Adjective");as.found===!0&&as.remove()}}),this},toSingular:function(ss){let ts=this.world.transforms.toSingular;return this.forEach(rs=>{if(rs.has("^#Singular+$")||Yi(rs)===!1)return;let ns=ao(rs).main,is=ns.text("reduced");if((ns.has("#Plural")||to(is)===!0)&&(is=ts(is,this.world),ns.replace(is).tag("#Singular"),ss)){let as=rs,os=rs.lookBefore("#Adjective");os.found&&(as=os);let ls=eo(as);as.insertBefore(ls)}}),this},toPossessive:function(){return this.forEach(ss=>{ro(ss)}),this}};var io=function(ss){class ts extends ss{}return Object.assign(ts.prototype,no),ss.prototype.nouns=function(rs,ns={}){let is=this.match("(#City && @hasComma) (#Region|#Country)"),as=this.not(is).splitAfter("@hasComma");as=as.concat(is);let os=as.quotations();return os.found&&(as=as.splitOn(os.eq(0))),as=as.match("#Noun+ (of|by)? the? #Noun+?"),ns.keep_anaphora!==!0&&(as=as.not("#Pronoun"),as=as.not("(there|these)"),as=as.not("(#Month|#WeekDay)"),as=as.not("(my|our|your|their|her|his)")),as=as.not("(of|for|by|the)$"),typeof rs=="number"&&(as=as.get(rs)),new ts(as.list,this,this.world)},ss};const oo=/\(/,so=/\)/;var lo=function(ss){class ts extends ss{unwrap(){return this.list.forEach(ns=>{let is=ns.terms(0);is.pre=is.pre.replace(oo,"");let as=ns.lastTerm();as.post=as.post.replace(so,"")}),this}}return ss.prototype.parentheses=function(rs){let ns=[];return this.list.forEach(is=>{let as=is.terms();for(let os=0;os<as.length;os+=1){const ls=as[os];if(oo.test(ls.pre)){for(let us=os;us<as.length;us+=1)if(so.test(as[us].post)){let cs=us-os+1;ns.push(is.buildFrom(ls.id,cs)),os=us;break}}}}),typeof rs=="number"?(ns=ns[rs]?[ns[rs]]:[],new ts(ns,this,this.world)):new ts(ns,this,this.world)},ss},uo=function(ss){class ts extends ss{constructor(ns,is,as){super(ns,is,as),this.contracted=null}strip(){return this.list.forEach(ns=>{ns.terms().forEach(is=>{let as=is.text.replace(/'s$/,"");is.set(as||is.text)})}),this}}return ss.prototype.possessives=function(rs){let ns=this.match("#Noun+? #Possessive");return typeof rs=="number"&&(ns=ns.get(rs)),new ts(ns.list,this,this.world)},ss};const co={'"':'"',"":"","'":"'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","`":"","":""},ho=RegExp("("+Object.keys(co).join("|")+")");var go=function(ss){class ts extends ss{unwrap(){return this}}return ss.prototype.quotations=function(rs){let ns=[];return this.list.forEach(is=>{let as=is.terms();for(let os=0;os<as.length;os+=1){const ls=as[os];if(ho.test(ls.pre)){let us=(ls.pre.match(ho)||[])[0],cs=co[us];for(let ps=os;ps<as.length;ps+=1)if(as[ps].post.indexOf(cs)!==-1){let ds=ps-os+1;ns.push(is.buildFrom(ls.id,ds)),os=ps;break}}}}),typeof rs=="number"?(ns=ns[rs]?[ns[rs]]:[],new ts(ns,this,this.world)):new ts(ns,this,this.world)},ss.prototype.quotes=ss.prototype.quotations,ss},po=function(ss,ts){let rs=ss.verb,ns=rs.text("reduced");if(rs.has("#Infinitive"))return ns;let is=null;return rs.has("#PastTense")?is="PastTense":rs.has("#Gerund")?is="Gerund":rs.has("#PresentTense")?is="PresentTense":rs.has("#Participle")?is="Participle":rs.has("#Actor")&&(is="Actor"),ts.transforms.toInfinitive(ns,ts,is)},mo=function(ss){let ts=ss.verb;if(ts.has("(are|were|does)")||ss.auxiliary.has("(are|were|does)"))return!0;let rs=function(ns){return ns.lookBehind("#Noun+").last()}(ts);return!rs.has("(he|she|many|both)")&&(!!rs.has("(we|they|you|i)")||!rs.has("#Person")&&(!!rs.has("#Plural")||!rs.has("#Singular")&&!ts.has("(is|am|do|was)")&&!(ss.auxiliary.has("(is|am|do|was)")&&!ss.negative.found)&&null))};const fo=po,bo=mo;var yo=function(ss){let ts=ss.lookBehind(),rs=ts.nouns(null,{keep_anaphora:!0}).last();return rs.found||(rs=ts.match("(that|this|each)").last(),rs=rs.tag("#Noun").nouns()),rs};const vo=yo,wo=mo,ko=po,Ao=ss=>{let ts=!1,rs=wo(ss),ns=ss.negative.found;ss.verb.lookBehind("i (#Adverb|#Verb)?$").found&&(ts=!0);let is={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return rs&&(is.PastTense="were",is.PresentTense="are",is.Infinitive="are"),ts===!0&&(is.PastTense="was",is.PresentTense="am",is.Infinitive="am"),ns&&(is.PastTense+=" not",is.PresentTense+=" not",is.FutureTense="will not be",is.Infinitive+=" not",is.PerfectTense="not "+is.PerfectTense,is.Pluperfect="not "+is.Pluperfect,is.Gerund="not "+is.Gerund),is},Do=function(ss){let ts=ss.verb.text();return{PastTense:ts+" have",PresentTense:ts,FutureTense:ts,Infinitive:ts}},$o=mo;var Po=function(ss,ts){let rs=ss.verb;if(rs.has("#Copula")||rs.out("normal")==="be"&&ss.auxiliary.has("will"))return Ao(ss);if(ss.auxiliary.has("are")&&rs.has("#Gerund")){let us=ss.original.clone(),cs=us.clone().replace("are","were"),ps=us.clone().replace("are","will be"),ds=ko(ss,ts);return{PastTense:cs.text(),PresentTense:us.text(),FutureTense:ps.text(),Infinitive:ds}}if(rs.has("#Modal"))return Do(ss);let ns=ko(ss,ts);if(!ns)return{};let is=ts.transforms.conjugate(ns,ts);is.Infinitive=ns;let as=$o(ss);as===!0&&(is.PresentTense=is.Infinitive);let os=ss.verb.termList(0).hasHyphen();if(ss.particle.found){let us=ss.particle.text(),cs=os===!0?"-":" ";Object.keys(is).forEach(ps=>is[ps]+=cs+us)}const ls=ss.negative.found;return is.FutureTense=is.FutureTense||"will "+is.Infinitive,ls&&(is.PastTense="did not "+is.Infinitive,is.FutureTense="will not "+is.Infinitive,as?(is.PresentTense="do not "+is.Infinitive,is.Infinitive="do not "+is.Infinitive):(is.PresentTense="does not "+is.Infinitive,is.Infinitive="does not "+is.Infinitive),is.Gerund="not "+is.Gerund),is};const Eo=Po;var Ho={useParticiple:function(ss){return!!ss.auxiliary.has("(could|should|would|may|can|must)")||!!ss.auxiliary.has("am .+? being")||!!ss.auxiliary.has("had .+? been")},toParticiple:function(ss,ts){if(ss.auxiliary.has("(have|had)")&&ss.verb.has("#Participle"))return;let rs=Eo(ss,ts),ns=rs.Participle||rs.PastTense;ns&&ss.verb.replaceWith(ns,!1),ss.auxiliary.has("am .+? being")&&(ss.auxiliary.remove("am"),ss.auxiliary.replace("being","have been")),ss.auxiliary.has("have")||ss.auxiliary.append("have"),ss.verb.tag("Participle","toParticiple"),ss.auxiliary.replace("can","could"),ss.auxiliary.replace("be have","have been"),ss.auxiliary.replace("not have","have not"),ss.auxiliary.tag("Auxiliary")}};const jo=function(ss,ts){let rs=ss.verb;if(!ss.negative.found){if(ss.auxiliary.found)return ss.auxiliary.eq(0).append("not"),void(ss.auxiliary.has("#Modal have not")&&ss.auxiliary.replace("have not","not have"));if(rs.has("(#Copula|will|has|had|do)"))rs.append("not");else{if(rs.has("#PastTense")){let ns=fo(ss,ts);return rs.replaceWith(ns,!0),void rs.prepend("did not")}if(rs.has("#PresentTense")){let ns=fo(ss,ts);return rs.replaceWith(ns,!0),void(bo(ss)?rs.prepend("do not"):rs.prepend("does not"))}if(rs.has("#Gerund")){let ns=fo(ss,ts);return rs.replaceWith(ns,!0),void rs.prepend("not")}bo(ss)?rs.prepend("does not"):rs.prepend("do not")}}},No=function(ss){let ts={adverb:ss.match("#Adverb+"),negative:ss.match("#Negative"),auxiliary:ss.match("#Auxiliary+").not("(#Negative|#Adverb)"),particle:ss.match("#Particle"),verb:ss.match("#Verb+").not("(#Adverb|#Negative|#Auxiliary|#Particle)"),original:ss,subject:vo(ss)};if(ts.verb.has("(#PresentTense|#PastTense|#Infinitive) #Gerund$")&&(ts.verb=ts.verb.not("#Gerund$")),!ts.verb.found)return Object.keys(ts).forEach(rs=>{ts[rs]=ts[rs].not(".")}),ts.verb=ss,ts;if(ts.adverb&&ts.adverb.found){let rs=ts.adverb.text("reduced")+"$";ss.has(rs)&&(ts.adverbAfter=!0)}return ts},xo=mo,Fo=yo,Co=Po,{toParticiple:Bo,useParticiple:Go}=Ho,zo=function(ss){return ss.auxiliary.remove("(will|are|am|being)"),ss.auxiliary.remove("(did|does)"),ss.auxiliary.remove("(had|has|have)"),ss.particle.remove(),ss.negative.remove(),ss},Io={json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0],as=No(ns);is.parts={},Object.keys(as).forEach(os=>{as[os]&&as[os].isA==="Doc"?is.parts[os]=as[os].text("normal"):is.parts[os]=as[os]}),is.isNegative=ns.has("#Negative"),is.conjugations=Co(as,this.world),rs.push(is)}),ts!==null?rs[ts]:rs},adverbs:function(){let ss=[];this.forEach(rs=>{let ns=No(rs).adverb;ns.found&&(ss=ss.concat(ns.list))});let ts=this.lookBehind("#Adverb+$");return ts.found&&(ss=ts.list.concat(ss)),ts=this.lookAhead("^#Adverb+"),ts.found&&(ss=ss.concat(ts.list)),this.buildFrom(ss)},isPlural:function(){let ss=[];return this.forEach(ts=>{let rs=No(ts);xo(rs,this.world)===!0&&ss.push(ts.list[0])}),this.buildFrom(ss)},isSingular:function(){let ss=[];return this.forEach(ts=>{let rs=No(ts);xo(rs,this.world)===!1&&ss.push(ts.list[0])}),this.buildFrom(ss)},conjugate:function(){let ss=[];return this.forEach(ts=>{let rs=No(ts),ns=Co(rs,this.world);ss.push(ns)}),ss},toPastTense:function(){return this.forEach(ss=>{let ts=No(ss);if(Go(ts))return void Bo(ts,this.world);if(ss.has("#Imperative")||ss.has("be")&&ss.lookBehind("to$").found)return;if(ts.verb.has("#Gerund")&&ts.auxiliary.has("(is|will|was)"))return void ss.replace("is","was");let rs=Co(ts,this.world).PastTense;rs&&(ts=zo(ts),ts.verb.replaceWith(rs,!1),ts.auxiliary.remove("(do|did|will)"))}),this},toPresentTense:function(){return this.forEach(ss=>{if(ss.has("#Imperative"))return;let ts=No(ss),rs=Co(ts,this.world),ns=rs.PresentTense;if(ss.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(ns=rs.Infinitive),ns){if(ts.auxiliary.has("(have|had) been"))return ts.auxiliary.replace("(have|had) been","am being"),void(rs.Particle&&(ns=rs.Particle||rs.PastTense));ts.verb.replaceWith(ns,!1),ts.verb.tag("PresentTense"),ts=zo(ts),ts.auxiliary.remove("#Modal"),ts.auxiliary.remove("(do|did|will)")}}),this},toFutureTense:function(){return this.forEach(ss=>{let ts=No(ss);if(Go(ts)||ss.has("#Imperative"))return;let rs=Co(ts,this.world).FutureTense;rs&&(ts=zo(ts),ts.auxiliary.remove("#Modal"),ts.verb.replaceWith(rs,!1),ts.verb.tag("FutureTense"),ts.auxiliary.remove("(do|did|will)"))}),this},toInfinitive:function(){return this.forEach(ss=>{let ts=No(ss),rs=Co(ts,this.world).Infinitive;rs&&(ss.replaceWith(rs,!1),ss.tag("Infinitive"))}),this},toGerund:function(){return this.forEach(ss=>{let ts=No(ss),rs=Co(ts,this.world).Gerund;rs&&(ss.replaceWith(rs,!1),ss.tag("Gerund"))}),this},toParticiple:function(){return this.forEach(ss=>{let ts=No(ss),rs=!ts.auxiliary.found;Bo(ts,this.world),rs&&(ts.verb.prepend(ts.auxiliary.text()),ts.auxiliary.remove())}),this},isNegative:function(){return this.if("#Negative")},isPositive:function(){return this.ifNo("#Negative")},isImperative:function(){return this.if("#Imperative")},toNegative:function(){return this.list.forEach(ss=>{let ts=this.buildFrom([ss]),rs=No(ts);jo(rs,ts.world)}),this},toPositive:function(){let ss=this.match("do not #Verb");return ss.found&&ss.remove("do not"),this.remove("#Negative")},subject:function(){let ss=[];return this.forEach(ts=>{let rs=Fo(ts);rs.list[0]&&ss.push(rs.list[0])}),this.buildFrom(ss)}},Oo=Ia,To=[Ji,Si,_i,Ki,qi,io,lo,uo,go,function(ss){class ts extends ss{}return Object.assign(ts.prototype,Io),ts.prototype.negate=ts.prototype.toNegative,ss.prototype.verbs=function(rs){let ns=this.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+");ns=ns.not("^#Adverb+"),ns=ns.not("#Adverb+$");let is=ns.match("(#Adverb && @hasComma) #Adverb"),as=ns.not(is).splitAfter("@hasComma");return as=as.concat(is),as.sort("index"),as=as.if("#Verb"),as.has("(is|was)$")&&(as=as.splitBefore("(is|was)$")),as.has("#PresentTense #Adverb #PresentTense")&&(as=as.splitBefore("#Adverb #PresentTense")),typeof rs=="number"&&(as=as.get(rs)),new ts(as.list,this,this.world)},ss},function(ss){class ts extends ss{}return ss.prototype.people=function(rs){let ns=this.splitAfter("@hasComma");return ns=ns.match("#Person+"),typeof rs=="number"&&(ns=ns.get(rs)),new ts(ns.list,this,this.world)},ss}],Vo={misc:Ga,selections:Ia},Mo=Mi,Jo=xt,Lo=function(ss){return Object.keys(Oo).forEach(ts=>ss.prototype[ts]=Oo[ts]),To.forEach(ts=>ts(ss)),ss};class So{constructor(ts,rs,ns){this.list=ts,Object.defineProperty(this,"from",{enumerable:!1,value:rs,writable:!0}),ns===void 0&&rs!==void 0&&(ns=rs.world),Object.defineProperty(this,"world",{enumerable:!1,value:ns,writable:!0}),Object.defineProperty(this,"_cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"found",{get:()=>this.list.length>0}),Object.defineProperty(this,"length",{get:()=>this.list.length}),Object.defineProperty(this,"isA",{get:()=>"Doc"})}tagger(){return Mo(this)}pool(){return this.list.length>0?this.list[0].pool:this.all().list[0].pool}}So.prototype.buildFrom=function(ss){return ss=ss.map(ts=>ts.clone(!0)),new So(ss,this,this.world)},So.prototype.fromText=function(ss){let ts=Jo(ss,this.world,this.pool());return this.buildFrom(ts)},Object.assign(So.prototype,Vo.misc),Object.assign(So.prototype,Vo.selections),Lo(So);const _o={untag:"unTag",and:"match",notIf:"ifNo",only:"if",onlyIf:"if"};Object.keys(_o).forEach(ss=>So.prototype[ss]=So.prototype[_o[ss]]);const Ko=Va,qo=xt,Wo=zt,Ro=So,Uo=nt,Qo=ne$1,Zo=ot,Xo=function(ss){let ts=ss.termList();return Ko(ts,ss.world),ss.world.taggers.forEach(rs=>{rs(ss)}),ss},Yo=_e;var es=function ss(ts){let rs=ts;const ns=function(is="",as){as&&rs.addWords(as);let os=qo(is,rs),ls=new Ro(os,null,rs);return ls.tagger(),ls};return ns.tokenize=function(is="",as){let os=rs;as&&(os=os.clone(),os.words={},os.addWords(as));let ls=qo(is,os),us=new Ro(ls,null,os);return(as||us.world.taggers.length>0)&&Xo(us),us},ns.extend=function(is){return is(Ro,rs,this,Uo,Qo,Zo),this},ns.fromJSON=function(is){let as=Wo(is,rs);return new Ro(as,null,rs)},ns.clone=function(){return ss(rs.clone())},ns.verbose=function(is=!0){return rs.verbose(is),this},ns.world=function(){return rs},ns.parseMatch=function(is,as){return Yo(is,as)},ns.version="13.11.4",ns.import=ns.load,ns.plugin=ns.extend,ns}(new Rr),nlp=es,e=function(ss,ts){let rs=ss.match("#Value+? #Money+ #Currency+ (and #Money+ #Currency+)+?");return ss.match("#Money").forEach(ns=>{ns.lookAfter("#Currency").found||(rs=rs.concat(ns))}),typeof ts=="number"&&(rs=rs.get(ts)),rs};const n="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty";var t=function(ss,ts){let rs=ss.match("#Value+");if(rs.has("#NumericValue #NumericValue")&&(rs.has("#Value @hasComma #Value")?rs.splitAfter("@hasComma"):rs.has("#NumericValue #Fraction")?rs.splitAfter("#NumericValue #Fraction"):rs=rs.splitAfter("#NumericValue")),rs.has("#Value #Value #Value")&&!rs.has("#Multiple")&&rs.has("("+n+") #Cardinal #Cardinal")&&(rs=rs.splitAfter("("+n+") #Cardinal")),rs.has("#Value #Value")){rs.has("#NumericValue #NumericValue")&&(rs=rs.splitOn("#Year")),rs.has("("+n+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(rs=rs.splitAfter("("+n+")"));let ns=rs.match("#Cardinal #Cardinal");if(ns.found&&!rs.has("(point|decimal|#Fraction)")&&!ns.has("#Cardinal (#Multiple|point|decimal)")){let is=rs.has(`(one|two|three|four|five|six|seven|eight|nine) (${n})`),as=ns.has("("+n+") #Cardinal"),os=ns.has("#Multiple #Value");is||as||os||ns.terms().forEach(ls=>{rs=rs.splitOn(ls)})}rs.match("#Ordinal #Ordinal").match("#TextValue").found&&!rs.has("#Multiple")&&(rs.has("("+n+") #Ordinal")||(rs=rs.splitAfter("#Ordinal"))),rs.has("#Ordinal #Cardinal")&&(rs=rs.splitBefore("#Cardinal+")),rs.has("#TextValue #NumericValue")&&!rs.has("("+n+"|#Multiple)")&&(rs=rs.splitBefore("#NumericValue+"))}return rs.has("#NumberRange")&&(rs=rs.splitAfter("#NumberRange")),typeof ts=="number"&&(rs=rs.get(ts)),rs},r=function(ss,ts){let rs=ss.match("#Fraction+");return rs=rs.filter(ns=>!ns.lookBehind("#Value and$").found),typeof ts=="number"&&(rs=rs.eq(ts)),rs},a=function(ss,ts){let rs=ss.match("#Percent+");return rs=rs.concat(ss.match("[#Cardinal] percent",0)),typeof ts=="number"&&(rs=rs.eq(ts)),rs},i={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}};const s=i,o=i,u=ss=>{const ts=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}];for(let rs=0;rs<ts.length;rs++)if(ts[rs].reg.test(ss)===!0)return{amount:ts[rs].mult,str:ss.replace(ts[rs].reg,"")};return{amount:1,str:ss}},l=i,m=(ss,ts)=>{if(s.ones.hasOwnProperty(ss)){if(ts.ones||ts.teens)return!1}else if(s.teens.hasOwnProperty(ss)){if(ts.ones||ts.teens||ts.tens)return!1}else if(s.tens.hasOwnProperty(ss)&&(ts.ones||ts.teens||ts.tens))return!1;return!0},c$1=function(ss){let ts="0.";for(let rs=0;rs<ss.length;rs++){let ns=ss[rs];if(o.ones.hasOwnProperty(ns)===!0)ts+=o.ones[ns];else if(o.teens.hasOwnProperty(ns)===!0)ts+=o.teens[ns];else if(o.tens.hasOwnProperty(ns)===!0)ts+=o.tens[ns];else{if(/^[0-9]$/.test(ns)!==!0)return 0;ts+=ns}}return parseFloat(ts)},h=ss=>ss=(ss=(ss=(ss=(ss=(ss=(ss=(ss=ss.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$]/,"")).replace(/[%$]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),f=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,d={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},y=ss=>Object.keys(ss).reduce((ts,rs)=>ts+=ss[rs],0);var p=function(ss){if(d.hasOwnProperty(ss)===!0)return d[ss];if(ss==="a"||ss==="an")return 1;const ts=u(ss);let rs=null,ns={},is=0,as=!1;const os=(ss=ts.str).split(/[ -]/);for(let ls=0;ls<os.length;ls++){let us=os[ls];if(us=h(us),!us||us==="and")continue;if(us==="-"||us==="negative"){as=!0;continue}if(us.charAt(0)==="-"&&(as=!0,us=us.substr(1)),us==="point")return is+=y(ns),is+=c$1(os.slice(ls+1,os.length)),is*=ts.amount,is;const cs=us.match(f);if(cs){const ps=parseFloat(cs[1].replace(/[, ]/g,"")),ds=parseFloat(cs[2].replace(/[, ]/g,""));ds&&(is+=ps/ds||0)}else{if(l.tens.hasOwnProperty(us)&&ns.ones&&Object.keys(ns).length===1&&(is=100*ns.ones,ns={}),m(us,ns)===!1)return null;if(/^[0-9\.]+$/.test(us))ns.ones=parseFloat(us);else if(l.ones.hasOwnProperty(us)===!0)ns.ones=l.ones[us];else if(l.teens.hasOwnProperty(us)===!0)ns.teens=l.teens[us];else if(l.tens.hasOwnProperty(us)===!0)ns.tens=l.tens[us];else if(l.multiples.hasOwnProperty(us)===!0){let ps=l.multiples[us];if(ps===rs)return null;if(ps===100&&os[ls+1]!==void 0){const ds=os[ls+1];l.multiples[ds]&&(ps*=l.multiples[ds],ls+=1)}rs===null||ps<rs?(is+=(y(ns)||1)*ps,rs=ps,ns={}):(is+=y(ns),rs=ps,is=(is||1)*ps,ns={})}}}return is+=y(ns),is*=ts.amount,is*=as?-1:1,is===0&&Object.keys(ns).length===0?null:is};const b=/s$/,g=p,x=function(ss){let ts=ss.text("reduced");return g(ts)};let $={half:2,halve:2,quarter:4};var v=function(ss){let ts=function(rs){let ns=rs.text("reduced");return $.hasOwnProperty(ns)?{numerator:1,denominator:$[ns]}:null}(ss=ss.clone())||function(rs){let ns=rs.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return ns&&ns[1]&&ns[0]?{numerator:Number(ns[1]),denominator:Number(ns[2])}:null}(ss)||function(rs){let ns=rs.match("[<num>#Value+] out of every? [<den>#Value+]");if(ns.found!==!0)return null;let{num:is,den:as}=ns.groups();return is&&as?(is=x(is),as=x(as),typeof is=="number"&&typeof as=="number"?{numerator:is,denominator:as}:null):null}(ss)||function(rs){let ns=rs.match("[<num>(#Cardinal|a)+] [<dem>#Fraction+]");if(ns.found!==!0)return null;let{num:is,dem:as}=ns.groups();is=is.has("a")?1:x(is);let os=as.text("reduced");return b.test(os)&&(os=os.replace(b,""),as.replaceWith(os)),as=$.hasOwnProperty(os)?$[os]:x(as),typeof is=="number"&&typeof as=="number"?{numerator:is,denominator:as}:null}(ss)||function(rs){let ns=rs.match("^#Ordinal$");return ns.found!==!0?null:rs.lookAhead("^of .")?{numerator:1,denominator:x(ns)}:null}(ss)||null;return ts!==null&&ts.numerator&&ts.denominator&&(ts.decimal=ts.numerator/ts.denominator,ts.decimal=(rs=>{let ns=Math.round(1e3*rs)/1e3;return ns===0&&rs!==0?rs:ns})(ts.decimal)),ts};const w=p,k=v;var C=function(ss){let ts=ss.text("reduced"),rs=/[0-9],[0-9]/.test(ss.text("text")),ns=function(ls,us,cs){let ps=(ls=ls.replace(/,/g,"")).split(/^([^0-9]*)([0-9.,]*)([^0-9]*)$/);if(ps&&ps[2]&&us.terms().length<2){let ds=parseFloat(ps[2]||ls);typeof ds!="number"&&(ds=null);let fs=ps[3]||"";return fs!=="st"&&fs!=="nd"&&fs!=="rd"&&fs!=="th"||(fs=""),fs!=="m"&&fs!=="M"||(ds*=1e6,fs=""),fs!=="k"&&fs!=="k"||(ds*=1e3,fs=""),ds=cs?1/ds:ds,{prefix:ps[1]||"",num:ds,suffix:fs}}return null}(ts,ss);if(ns!==null)return ns.hasComma=rs,ns;let is=ss.match("#Fraction #Fraction+$");is=is.found===!1?ss.match("^#Fraction$"):is;let as=null;is.found&&(as=k(is),ts=(ss=(ss=ss.not(is)).not("and$")).text("reduced"));let os=0;return ts&&(os=w(ts)||0),as&&as.decimal&&(os+=as.decimal),{hasComma:rs,prefix:"",num:os,suffix:""}},O=function(ss){if(ss<1e6)return String(ss);let ts;return ts=typeof ss=="number"?ss.toFixed(0):ss,ts.indexOf("e+")===-1?ts:ts.replace(".","").split("e+").reduce(function(rs,ns){return rs+Array(ns-rs.length+2).join(0)})};const V=O,F=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],M=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],E=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],N=function(ss){let ts=[];if(ss>100)return ts;for(let rs=0;rs<F.length;rs++)ss>=F[rs][1]&&(ss-=F[rs][1],ts.push(F[rs][0]));return M[ss]&&ts.push(M[ss]),ts};var P=function(ss){if(ss===0||ss==="0")return"zero";ss>1e21&&(ss=V(ss));let ts=[];ss<0&&(ts.push("minus"),ss=Math.abs(ss));let rs=function(ns){let is=ns,as=[];return E.forEach(os=>{if(ns>=os[0]){let ls=Math.floor(is/os[0]);is-=ls*os[0],ls&&as.push({unit:os[1],count:ls})}}),as}(ss);for(let ns=0;ns<rs.length;ns++){let is=rs[ns].unit;is==="one"&&(is="",ts.length>1&&ts.push("and")),ts=ts.concat(N(rs[ns].count)),ts.push(is)}return ts=ts.concat((ns=>{const is=["zero","one","two","three","four","five","six","seven","eight","nine"];let as=[],os=V(ns).match(/\.([0-9]+)/);if(!os||!os[0])return as;as.push("point");let ls=os[0].split("");for(let us=0;us<ls.length;us++)as.push(is[ls[us]]);return as})(ss)),ts=ts.filter(ns=>ns),ts.length===0&&(ts[0]=""),ts.join(" ")};const z=O,A=P,j={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"};var q=ss=>{let ts=A(ss).split(" "),rs=ts[ts.length-1];return j.hasOwnProperty(rs)?ts[ts.length-1]=j[rs]:ts[ts.length-1]=rs.replace(/y$/,"i")+"th",ts.join(" ")},S={prefixes:{"":"cents",$:"dollars","":"pounds","":"yen","":"euros","":"coln","":"baht","":"kip","":"won","":"rupees","":"ruble","":"liras"},suffixes:{"%":"percent",s:"seconds",cm:"centimetres",km:"kilometres"}};const T$1=O,R=P,L=function(ss){if(!ss&&ss!==0)return null;let ts=ss%100;if(ts>10&&ts<20)return String(ss)+"th";const rs={0:"th",1:"st",2:"nd",3:"rd"};let ns=z(ss),is=ns.slice(ns.length-1,ns.length);return ns+=rs[is]?rs[is]:"th",ns},W=q,B=S.prefixes,D=S.suffixes,U={usd:!0,eur:!0,jpy:!0,gbp:!0,cad:!0,aud:!0,chf:!0,cny:!0,hkd:!0,nzd:!0,kr:!0,rub:!0},K=function(ss){return B.hasOwnProperty(ss.prefix)&&(ss.suffix+=B[ss.prefix],ss.prefix=""),D.hasOwnProperty(ss.suffix)&&(ss.suffix=D[ss.suffix]),U.hasOwnProperty(ss.suffix)&&(ss.suffix=ss.suffix.toUpperCase()),ss.suffix&&(ss.suffix=" "+ss.suffix),ss};var Y=function(ss,ts,rs){let ns=String(ss.num);return ts?(ss=K(ss),rs?(ns=W(ns),`${ss.prefix||""}${ns}${ss.suffix||""}`):(ns=R(ns),`${ss.prefix||""}${ns}${ss.suffix||""}`)):rs?(ns=L(ns),`${(ss=K(ss)).prefix||""}${ns}${ss.suffix||""}`):(ss.hasComma===!0&&(ns=ss.num.toLocaleString()),ns=T$1(ns),`${ss.prefix||""}${ns}${ss.suffix||""}`)};const G=C,H=function(ss,ts,rs){if(ss===!1)return;let ns=ts.lookAhead("^(#Unit|#Noun)");ns.has("(#Address|#Money|#Percent)")||ts.has("#Ordinal")||(rs.num===1?ns.nouns().toSingular():ns.has("#Singular")&&ns.nouns().toPlural())},I=Y,Q=p;let Z={json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0],as=G(ns);is.prefix=as.prefix,is.number=as.num,is.suffix=as.suffix,is.cardinal=I(as,!1,!1),is.ordinal=I(as,!1,!0),is.textCardinal=I(as,!0,!1),is.textOrdinal=I(as,!0,!0),rs.push(is)}),ts!==null?rs[ts]:rs},units:function(){let ss=this.lookAhead("(#Unit|#Noun)+");return ss=ss.splitAfter("@hasComma").first(),ss=ss.not("#Pronoun"),ss.first()},isOrdinal:function(){return this.if("#Ordinal")},isCardinal:function(){return this.if("#Cardinal")},toNumber:function(){return this.forEach(ss=>{let ts=G(ss);if(ts.num===null)return;let rs=I(ts,!1,ss.has("#Ordinal"));ss.replaceWith(rs,!0),ss.tag("NumericValue")}),this},toLocaleString:function(){return this.forEach(ss=>{let ts=G(ss);if(ts.num===null)return;ts.num=ts.num.toLocaleString();let rs=I(ts,!1,ss.has("#Ordinal"));ss.replaceWith(rs,!0)}),this},toText:function(){return this.forEach(ss=>{let ts=G(ss);if(ts.num===null)return;let rs=I(ts,!0,ss.has("#Ordinal"));ss.replaceWith(rs,!0),ss.tag("TextValue")}),this},toCardinal:function(ss){return this.if("#Ordinal").forEach(ts=>{let rs=G(ts);if(rs.num===null)return;let ns=I(rs,ts.has("#TextValue"),!1);if(ts.has("#NumberRange")){let is=ts.termList()[0];is.text&&is.post===""&&(is.post=" ")}ts.replaceWith(ns,!0),ts.tag("Cardinal"),H(ss,ts,rs)}),this},toOrdinal:function(){return this.if("#Cardinal").forEach(ss=>{let ts=G(ss);if(ts.num===null)return;let rs=I(ts,ss.has("#TextValue"),!0);if(ss.has("#NumberRange")){let is=ss.termList()[0];is.text&&is.post===""&&(is.post=" ")}ss.replaceWith(rs,!0),ss.tag("Ordinal");let ns=this.lookAhead("^#Plural");ns.found&&ns.nouns().toSingular()}),this},isEqual:function(ss){return this.filter(ts=>G(ts).num===ss)},greaterThan:function(ss){return this.filter(ts=>G(ts).num>ss)},lessThan:function(ss){return this.filter(ts=>G(ts).num<ss)},between:function(ss,ts){return this.filter(rs=>{let ns=G(rs).num;return ns>ss&&ns<ts})},set:function(ss,ts){return ss===void 0||(typeof ss=="string"&&(ss=Q(ss)),this.forEach(rs=>{let ns=G(rs);if(ns.num=ss,ns.num===null)return;let is=I(ns,rs.has("#TextValue"),rs.has("#Ordinal"));(rs=rs.not("#Currency")).replaceWith(is,!0),H(ts,rs,ns)})),this},add:function(ss,ts){return ss?(typeof ss=="string"&&(ss=Q(ss)),this.forEach(rs=>{let ns=G(rs);if(ns.num===null)return;ns.num+=ss;let is=I(ns,rs.has("#TextValue"),rs.has("#Ordinal"));(rs=rs.not("#Currency")).replaceWith(is,!0),H(ts,rs,ns)}),this):this},subtract:function(ss,ts){return this.add(-1*ss,ts)},increment:function(ss){return this.add(1,ss),this},decrement:function(ss){return this.add(-1,ss),this},romanNumerals:function(ss){let ts=this.match("#RomanNumeral").numbers();return typeof ss=="number"&&(ts=ts.get(ss)),ts},normalize:function(){const ss={"%":!0};return this.forEach(ts=>{let rs=G(ts);if(rs.num!==null&&rs.suffix&&ss[rs.suffix]!==!0){let ns=rs.prefix||"";ts=ts.replaceWith(ns+rs.num+" "+rs.suffix)}}),this},get:function(ss){let ts=[];return this.forEach(rs=>{ts.push(G(rs).num)}),ss!==void 0?ts[ss]||null:ts||null}};Z.toNice=Z.toLocaleString,Z.isBetween=Z.between,Z.minus=Z.subtract,Z.plus=Z.add,Z.equals=Z.isEqual;var J=Z;const X=C,_=function(ss){let ts=X(ss).num;return typeof ts=="number"?ts/100:null};var ee={get:function(ss){let ts=[];return this.forEach(rs=>{let ns=_(rs);ns!==null&&ts.push(ns)}),ss!==void 0?ts[ss]||null:ts||null},json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0],as=_(ns);if(is.number=as,as!==null){let os=100*as;is.textNumber=`${os} percent`,is.cardinal=`${os}%`}rs.push(is)}),ts!==null?rs[ts]||{}:rs},toFraction:function(){return this.forEach(ss=>{let ts=_(ss);if(ts!==null){ts*=100,ts=Math.round(100*ts)/100;let rs=`${ts}/100`;this.replace(ss,rs)}}),this}},ne=[{dem:"american",name:"dollar",iso:"usd",sub:"cent",sym:["$","US$","U$"]},{name:"euro",iso:"eur",sub:"cent",sym:[""]},{dem:"british",name:"pound",iso:"gbp",sub:"penny",alias:{sterling:!0},sym:[""]},{name:"renminbi",iso:"cny",plural:"yun",alias:{yuan:!0},sym:[""]},{dem:"japanese",name:"yen",iso:"jpy",sub:"sen",sym:["","",""]},{dem:"swedish",name:"krona",iso:"sek",sub:"re",alias:{ore:!0,kronor:!0},sym:["kr"]},{dem:"estonian",name:"kroon",iso:"eek",sub:"sent",sym:["kr"]},{dem:"norwegian",name:"krone",iso:"nok",sub:"re",sym:["kr"]},{dem:"icelandic",name:"krna",iso:"isk",sym:["kr"]},{dem:"danish",name:"krone",iso:"dkk",sub:"re",sym:["kr."]},{dem:"zambian",name:"kwacha",iso:"zmw",sub:"ngwee",sym:["K"]},{dem:"malawian",name:"kwacha",iso:"mwk",sub:"tambala",sym:["K"]},{dem:"greek",name:"drachma",iso:"grd",sub:"leptn",sym:[".",".",""]},{dem:"eastern caribbean",name:"dollar",iso:"xcd",sub:"cent",sym:["$"]},{dem:"finnish",name:"markka",iso:"fim",sub:"penni",sym:["mk"]},{dem:"polish",name:"zoty",iso:"pln",sub:"grosz",sym:["z"]},{dem:"slovenian",name:"tolar",iso:"sit",sub:"stotin",sym:[]},{dem:"australian",name:"dollar",iso:"aud",sub:"cent",sym:["$","A$","AU$"]},{dem:"deutsche",name:"mark",iso:"dem",sub:"pfennig",sym:["DM"]},{dem:"thai",name:"baht",iso:"thb",sub:"satang",sym:[""]},{dem:"canadian",name:"dollar",iso:"cad",sub:"cent",sym:["$","Can$","C$","CA$","CAD"]},{dem:"mexican",name:"peso",iso:"mxn",sub:"centavo",sym:["$","Mex$"]},{dem:"spanish",name:"peseta",iso:"esp",sub:"cntimo",sym:["Pta"]},{dem:"new zealand",name:"dollar",iso:"nzd",sub:"cent",sym:["$","NZ$"]},{dem:"chilean",name:"peso",iso:"clp",sub:"centavo",sym:["Cifro","$"]},{dem:"nigerian",name:"naira",iso:"ngn",sub:"kobo",sym:[""]},{dem:"austrian",name:"schilling",iso:"ats",sub:"groschen",sym:["S","S"]},{dem:"guatemalan",name:"quetzal",iso:"gtq",sub:"centavo",sym:["Q"]},{dem:"philippine",name:"peso",iso:"php",sub:"sentimo",sym:[""]},{dem:"hungarian",name:"forint",iso:"huf",sym:["Ft"]},{dem:"russian",name:"ruble",iso:"rub",sub:"kopeyka",sym:["","","."]},{dem:"kuwaiti",name:"dinar",iso:"kwd",sub:"fils",sym:[".","KD"]},{dem:"israeli",name:"new shekel",iso:"ils",sub:"agora",sym:[""]},{dem:"latvian",name:"lats",iso:"lvl",sub:"santms",sym:["Ls"]},{dem:"kazakhstani",name:"tenge",iso:"kzt",sub:"tyn",sym:[""]},{dem:"iraqi",name:"dinar",iso:"iqd",sub:"fils",sym:["."]},{dem:"bahamian",name:"dollar",iso:"bsd",sub:"cent",sym:["$","B$"]},{dem:"seychellois",name:"rupee",iso:"scr",sub:"cent",sym:["SCR","SR"]},{dem:"albanian",name:"lek",iso:"all",sub:"qindark",sym:["L"]},{dem:"bulgarian",name:"lev",iso:"bgn",sub:"stotinka",sym:["."]},{dem:"irish",name:"pound",iso:"iep",sym:["","IR"]},{name:"cfp franc",iso:"xpf",sym:["f"]},{dem:"south african",name:"rand",iso:"zar",sub:"cent",sym:["R"]},{dem:"south korean",name:"won",iso:"krw",sub:"jeon",plural:"won",sym:[""]},{dem:"north korean",name:"won",iso:"kpw",sub:"chon",plural:"won",sym:[""]},{dem:"portuguese",name:"escudo",iso:"pte",sub:"centavo",sym:[]},{dem:"ghanaian",name:"cedi",iso:"ghs",sub:"pesewa",sym:["GH"]},{dem:"hong kong",name:"dollar",iso:"hkd",sub:"",sym:["$"]},{dem:"new taiwan",name:"dollar",iso:"twd",sub:"dime",sym:["NT$"]},{dem:"east german",name:"mark",iso:"ddm",sub:"pfennig",sym:["M"]},{dem:"namibian",name:"dollar",iso:"nad",sub:"cent",sym:["$"]},{dem:"malaysian",name:"ringgit",iso:"myr",sub:"sen",sym:["RM"]},{dem:"swiss",name:"franc",iso:"chf",sym:["Rp."]},{dem:"panamanian",name:"balboa",iso:"pab",sub:"centsimo",sym:["B/."]},{dem:"indonesian",name:"rupiah",iso:"idr",sub:"sen",sym:["Rp"]},{dem:"brunei",name:"dollar",iso:"bnd",sub:"sen",sym:["$","B$"]},{dem:"venezuelan",name:"bolvar",iso:"vef",sub:"cntimo",sym:["Bs.F","Bs."]},{dem:"macedonian",name:"denar",iso:"mkd",sub:"deni",sym:["den"]},{dem:"mauritanian",name:"ouguiya",iso:"mru",sub:"khoums",sym:["UM"]},{dem:"argentine",name:"peso",iso:"ars",sub:"centavo",sym:["$"]},{dem:"libyan",name:"dinar",iso:"lyd",sub:"dirham",sym:["LD","."]},{dem:"jordanian",name:"dinar",iso:"jod",sub:"dirham",sym:["."]},{dem:"french",name:"franc",iso:"frf",sub:"centime",sym:["F","Fr","FF",""]},{dem:"syrian",name:"pound",iso:"syp",sub:"piastre",sym:["LS","S"]},{dem:"belize",name:"dollar",iso:"bzd",sub:"cent",sym:["$"]},{dem:"saudi",name:"riyal",iso:"sar",sub:"halalah",sym:["SAR","."," "]},{dem:"surinamese",name:"dollar",iso:"srd",sub:"cent",sym:["$"]},{dem:"singapore",name:"dollar",iso:"sgd",sub:"cent",sym:["S$","$"]},{dem:"nepalese",name:"rupee",iso:"npr",sub:"paisa",sym:[" ","Re"]},{dem:"nicaraguan",name:"crdoba",iso:"nio",sub:"centavo",sym:["C$"]},{dem:"bangladeshi",name:"taka",iso:"bdt",sub:"poysha",sym:[""]},{dem:"indian",name:"rupee",iso:"inr",sub:"paisa",sym:[""]},{dem:"maldivian",name:"rufiyaa",iso:"mvr",sub:"laari",sym:["Rf","MRf","MVR",". "]},{dem:"sri lankan",name:"rupee",iso:"lkr",sub:"cents",sym:["Rs","",""]},{dem:"bhutanese",name:"ngultrum",iso:"btn",sub:"chhertum",sym:["Nu."]},{dem:"turkish",name:"lira",iso:"try",sub:"kuru",sym:["YTL"]},{dem:"serbian",name:"dinar",iso:"rsd",sub:"para",sym:["din",""]},{dem:"bosnia and herzegovina",name:"convertible mark",iso:"bam",sub:"fening",sym:["KM"]},{dem:"botswana",name:"pula",iso:"bwp",sub:"thebe",sym:["p"]},{dem:"swazi",name:"lilangeni",iso:"szl",sub:"cent",sym:["L","E"]},{dem:"lithuanian",name:"litas",iso:"ltl",sub:"centas",sym:["Lt","ct"]},{dem:"mauritian",name:"rupee",iso:"mur",sub:"cent",sym:[""]},{dem:"pakistani",name:"rupee",iso:"pkr",sub:"paisa",sym:[""]},{dem:"maltese",name:"lira",iso:"mtl",sub:"cent",sym:["","Lm"]},{dem:"cypriot",name:"pound",iso:"cyp",sub:"cent",sym:[""]},{dem:"moldovan",name:"leu",iso:"mdl",sym:["l"]},{dem:"croatian",name:"kuna",iso:"hrk",sub:"lipa",sym:["kn"]},{dem:"afghan",name:"afghani",iso:"afn",sub:"pul",sym:["","Af","Afs"]},{dem:"ecuadorian",name:"sucre",iso:"ecs",sub:"centavo",sym:["S/."]},{dem:"sierra leonean",name:"leone",iso:"sll",sub:"cent",sym:["Le"]}];const te=ne,re=C,ae={};let ie={};te.forEach(ss=>{ss.sym.forEach(ts=>{ae[ts]=ae[ts]||ss.iso}),ae[ss.iso]=ae[ss.iso]||ss.iso,ss.sub&&(ie[ss.sub]=!0)});let se=`(${Object.keys(ie).join("|")})`;const oe=Y,ue=function(ss){let ts=0,rs=ss.match(`and #Money+ ${se}`);if(rs.found){ss=ss.not(rs);let us=re(rs.match("#Value+"));us&&us.num&&(ts=us.num/100)}let ns=re(ss),is=ns.num||0;is+=ts;let as=((os=ns).suffix&&ae.hasOwnProperty(os.suffix)?te.find(us=>us.iso===ae[os.suffix]):os.prefix&&ae.hasOwnProperty(os.prefix)?te.find(us=>us.iso===ae[os.prefix]):null)||function(us){let cs=us.match("#Currency+");cs.nouns().toSingular();let ps=cs.text("reduced");return te.find(ds=>(ps===`${ds.dem} ${ds.name}`||ps===ds.iso||ps===ds.sub||ps===ds.name||!(!ds.alias||ds.alias[ps]!==!0))&&ds)}(ss)||{};var os;let ls="";return as&&as.sym&&(ls=as.sym[0],is&&ss.has(`${se}`)&&(is/=100)),{num:is,iso:as.iso,demonym:as.dem,currency:as.name,plural:as.plural,symbol:ls}},le=function(ss=""){return ss.replace(/\w\S*/g,function(ts){return ts.charAt(0).toUpperCase()+ts.substr(1).toLowerCase()})};var me$1={get:function(ss){let ts=[];return this.forEach(rs=>{ts.push(ue(rs))}),ss!==void 0?ts[ss]||null:ts||null},currency:function(ss){let ts=[];return this.forEach(rs=>{let ns=ue(rs);ns&&ts.push(ns)}),typeof ss=="number"?ts[ss]||null:ts||null},json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0],as=ue(ns);if(is.number=as.num,as.iso&&(is.iso=as.iso.toUpperCase(),is.symbol=as.symbol,is.currency=le(as.demonym)+" "+le(as.currency)),is.textFmt=oe(as,!0,!1),as.currency){let os=as.currency;as.num!==1&&(os=as.plural||os+"s"),is.textFmt+=" "+os}rs.push(is)}),ts!==null?rs[ts]||{}:rs}},ce={};const he=P,fe=q;ce.toText=function(ss){if(!ss.numerator||!ss.denominator)return"";let ts=he(ss.numerator),rs=fe(ss.denominator);return ss.denominator===2&&(rs="half"),ts&&rs?(ss.numerator!==1&&(rs+="s"),`${ts} ${rs}`):""},ce.textCardinal=function(ss){return!ss.numerator||!ss.denominator?"":`${he(ss.numerator)} out of ${he(ss.denominator)}`},ce.toDecimal=function(ss){return ss.decimal};const de=v,ye=ce,pe={get:function(ss){let ts=[];return this.forEach(rs=>{ts.push(de(rs))}),ss!==void 0?ts[ss]||null:ts||null},toDecimal(){return this.forEach(ss=>{let ts=de(ss);if(ts){let rs=ye.toDecimal(ts);ss.replaceWith(String(rs),!0),ss.tag("NumericValue"),ss.unTag("Fraction")}}),this},json:function(ss){let ts=null;typeof ss=="number"&&(ts=ss,ss=null),ss=ss||{text:!0,normal:!0,trim:!0,terms:!0};let rs=[];return this.forEach(ns=>{let is=ns.json(ss)[0],as=de(ns)||{},os=ye.toDecimal(as);is.numerator=as.numerator,is.denominator=as.denominator,is.number=os,is.textOrdinal=ye.toText(as),is.textCardinal=ye.textCardinal(as),rs.push(is)}),ts!==null?rs[ts]||{}:rs},normalize:function(){return this.forEach(ss=>{let ts=de(ss);if(ts&&typeof ts.numerator=="number"&&typeof ts.denominator=="number"){let rs=`${ts.numerator}/${ts.denominator}`;this.replace(ss,rs)}}),this},toText:function(ss){let ts=[];return this.forEach(rs=>{let ns=de(rs)||{},is=ye.toText(ns);rs.replaceWith(is,!0),rs.tag("Fraction")}),ss!==void 0?ts[ss]:ts},toPercentage:function(){return this.forEach(ss=>{let ts=de(ss);if(ts.decimal||ts.decimal===0){let rs=100*ts.decimal;rs=Math.round(100*rs)/100,this.replace(ss,`${rs}%`)}}),this}};pe.toNumber=pe.toDecimal;var be=pe;const ge=function(ss){return ss.match("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("#Multiple","fraction-tagger"),ss.match("[(half|quarter)] of? (a|an)",0).tag("Fraction","millionth"),ss.match("#Adverb [half]",0).tag("Fraction","nearly-half"),ss.match("[half] the",0).tag("Fraction","half-the"),ss.match("#Value (halves|halfs|quarters)").tag("Fraction","two-halves"),ss.match("a #Ordinal").tag("Fraction","a-quarter"),ss.match("(#Fraction && /s$/)").lookBefore("#Cardinal+$").tag("Fraction"),ss.match("[#Cardinal+ #Ordinal] of .",0).tag("Fraction","ordinal-of"),ss.match("[(#NumericValue && #Ordinal)] of .",0).tag("Fraction","num-ordinal-of"),ss.match("(a|one) #Cardinal?+ #Ordinal").tag("Fraction","a-ordinal"),ss.match("#Cardinal+ out? of every? #Cardinal").tag("Fraction","fraction-tagger"),ss},xe=function(ss){const ts="money-tagger";ss.match("#Money and #Money #Currency?").tag("Money","money-and-money"),ss.match("#Money").not("#TextValue").match("/\\.[0-9]{3}$/").unTag("#Money","three-decimal money"),ss.ifNo("#Value").match("#Currency #Verb").unTag("Currency","no-currency"),ss.match("#Value #Currency [and] #Value (cents|ore|centavos|sens)",0).tag("Money",ts);let rs=ss.match("[<num>#Value] [<currency>(mark|rand|won|rub|ore)]");return rs.group("num").tag("Money",ts),rs.group("currency").tag("Currency",ts),ss};var $e=function(ss){(ss=xe(ss)).match("the [/[0-9]+s$/]").tag("#Plural","number-tag"),ss.match("half a? #Value").tag("Value","half-a-value"),ss.match("#Value [and a (half|quarter)]",0).tag(["TextValue","#Fraction"],"value-and-a-half"),(ss=ge(ss)).match("#Cardinal and #Fraction #Fraction").tag("Value","number-tag")};const ve={mark:!0,sucre:!0,leone:!0,afghani:!0,rand:!0,try:!0,mop:!0,won:!0,all:!0,rub:!0,eek:!0,sit:!0,bam:!0,npr:!0,leu:!0};let we={kronor:"Currency"};ne.forEach(ss=>{ss.iso&&!ve[ss.iso]&&(we[ss.iso]=["Acronym","Currency"]);let ts=ss.name;if(ts&&!ve[ts]&&(we[ts]="Currency",we[ts+"s"]="Currency"),ss.dem){let rs=ss.dem;we[`${rs} ${ts}`]="Currency",we[`${rs} ${ts}s`]="Currency"}ss.sub&&(we[ss.sub]="Currency")});const ke=e,Ce=t,Oe=r,Ve=a,Fe=J,Me=ee,Ee=me$1,Ne=be,Pe=$e,ze={Fraction:{isA:["Value"]},Multiple:{isA:"Value"}},Ae=we;var je=function(ss,ts){ts.addWords(Ae),ts.addTags(ze),ts.postProcess(Pe);class rs extends ss{}Object.assign(rs.prototype,Fe);class ns extends rs{}Object.assign(ns.prototype,Ee);class is extends rs{}Object.assign(is.prototype,Ne);class as extends rs{}Object.assign(as.prototype,Me);const os={numbers:function(ls){let us=Ce(this,ls);return new rs(us.list,this,this.world)},percentages:function(ls){let us=Ve(this,ls);return new as(us.list,this,this.world)},fractions:function(ls){let us=Oe(this,ls);return new is(us.list,this,this.world)},money:function(ls){let us=ke(this,ls);return new ns(us.list,this,this.world)}};return os.values=os.numbers,os.percents=os.percentages,Object.assign(ss.prototype,os),ss},compromise_numbers=je;nlp.extend(compromise_numbers);class Pluralize extends Text{static createAttributesObject(){let ts=super.createAttributesObject();return ts.pluralForm={createComponentOfType:"text",createStateVariable:"pluralForm",defaultValue:null,public:!0},ts.basedOnNumber={createComponentOfType:"number",createStateVariable:"basedOnNumber",defaultValue:null,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:ts,oldName:"value",newName:"valuePrePluralize"}),ts.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valuePrePluralize:{dependencyType:"stateVariable",variableName:"valuePrePluralize"},pluralForm:{dependencyType:"stateVariable",variableName:"pluralForm"},basedOnNumber:{dependencyType:"stateVariable",variableName:"basedOnNumber"}}),definition:function({dependencyValues:rs}){let ns=nlp(rs.valuePrePluralize),is=ns.values().toNumber().all().terms().json();if(is.length===0)return{setValue:{value:rs.valuePrePluralize}};let as;if(rs.basedOnNumber!==null&&(as=numberDesignatesPlural(rs.basedOnNumber)),is.length===1)return as===void 0&&(as=!0),as?rs.pluralForm!==null?{setValue:{value:rs.pluralForm}}:{setValue:{value:ns.nouns().toPlural().all().out("text")}}:{setValue:{value:rs.valuePrePluralize}};if(as===void 0){let ls=[],us=[],cs=ns.nouns().json();for(let[fs,hs]of is.entries()){let ys=cs[ls.length];hs.terms[0].tags.includes("Value")&&us.push(fs),ys!==void 0&&ys.text===hs.text&&ls.push(fs)}as=[];let ps=ns.values().numbers().json(),ds=-1;for(let fs of ls){for(;Number(us[ds+1])<Number(fs);)ds++;ps[ds]&&numberDesignatesPlural(Number(ps[ds].normal))?as.push(!0):as.push(!1)}}if(as===!1)return{setValue:{value:rs.valuePrePluralize}};let os=nlp(rs.valuePrePluralize);if(rs.pluralForm!==null)for(let[ls,us]of ns.nouns().data().entries())(as===!0||as[ls]===!0)&&os.replace(us.text,rs.pluralForm);else{let ls=ns.nouns().json().length;for(let us=0;us<ls;us++)(as===!0||as[us]===!0)&&os.nouns(us).toPlural().all()}return{setValue:{value:os.out("text")}}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.value}})},ts}}Ms(Pluralize,"componentType","pluralize"),Ms(Pluralize,"rendererType","text");function numberDesignatesPlural(ss){return ss!==1}class Feedback extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateHide:this.updateHide.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.hide,ts.condition={createComponentOfType:"boolean"},ts.updateWith={createTargetComponentNames:!0},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.updateWithComponentNames={chainActionOnActionOfStateVariableTargets:{triggeredAction:"updateHide"},returnDependencies:()=>({updateWith:{dependencyType:"attributeTargetComponentNames",attributeName:"updateWith"}}),definition({dependencyValues:rs}){return rs.updateWith?{setValue:{updateWithComponentNames:rs.updateWith.map(ns=>ns.absoluteName)}}:{setValue:{updateWithComponentNames:[]}}}},ts.hideWhenUpdated={returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]},showFeedback:{dependencyType:"flag",flagName:"showFeedback"}}),definition:function({dependencyValues:rs}){if(!rs.showFeedback)return{setValue:{hideWhenUpdated:!0}};let ns;return rs.condition===null?ns=!1:ns=!rs.condition.stateValues.value,{setValue:{hideWhenUpdated:ns}}}},ts.hide={forRenderer:!0,defaultValue:!0,hasEssential:!0,returnDependencies:()=>({updateWith:{dependencyType:"attributeTargetComponentNames",attributeName:"updateWith"},condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]},showFeedback:{dependencyType:"flag",flagName:"showFeedback"}}),definition:function({dependencyValues:rs}){if(rs.updateWith)return{useEssentialOrDefaultValue:{hide:!0}};if(!rs.showFeedback)return{setValue:{hide:!0}};let ns;return rs.condition===null?ns=!1:ns=!rs.condition.stateValues.value,{setValue:{hide:ns}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.updateWith?{success:!0,instructions:[{setEssentialValue:"hide",value:rs.hide}]}:{success:!1}}},ts.feedbackText={forRenderer:!0,defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{feedbackText:!0}})},ts}async updateHide({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"hide",value:await this.stateValues.hideWhenUpdated}];return await this.coreFunctions.performUpdate({updateInstructions:is,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Feedback,"componentType","feedback"),Ms(Feedback,"renderChildren",!0),Ms(Feedback,"primaryStateVariableForDefinition","feedbackText");class CollaborateGroups extends BaseComponent{static returnChildLogic(ts){let rs=super.returnChildLogic(ts),ns=rs.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0}),is=breakStringsAndOthersIntoComponentsByStringCommas(),as=rs.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,logicToWaitOnSugar:["atLeastZeroPoints"],replacementFunction:is});return rs.newOperator({name:"pointsXorSugar",operator:"xor",propositions:[as,ns],setAsBase:!0}),rs}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.collaborateGroups={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["xs","coords","nDimensions"]}}),definition:function({dependencyValues:rs}){let ns={};for(let as of rs.pointChildren)if(as.stateValues.nDimensions!==2)console.warn(`invalid collaborate group: ${as.stateValues.coords.toString()}`);else{let os=as.stateValues.xs[0].evaluate_to_constant(),ls=as.stateValues.xs[1].evaluate_to_constant();Number.isInteger(os)&&os>0&&Number.isInteger(ls)&&ls>0?(ns[os]===void 0&&(ns[os]=[]),ns[os].push(ls)):console.warn(`invalid collaborate group: ${as.stateValues.coords.toString()}`)}return{setValue:{collaborateGroups:{groups:ns,matchGroup:function({groupNumber:as,numberOfGroups:os}={}){if(os>1){let ls=ns[os];return ls===void 0?!1:ls.includes(as)}else return!0}}}}}},ts}}Ms(CollaborateGroups,"componentType","collaborateGroups"),Ms(CollaborateGroups,"rendererType"),Ms(CollaborateGroups,"stateVariableForAttributeValue","collaborateGroups");class CollaborateGroupSetup extends BaseComponent{static returnChildLogic(ts){let rs=super.returnChildLogic(ts);return rs.newLeaf({name:"atMostOnePossibleNumberOfGroups",componentType:"possibleNumberOfGroups",comparison:"atMost",number:1,setAsBase:!0}),rs}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.possibleNumberOfGroups={returnDependencies:()=>({pngChild:{dependencyType:"child",childLogicName:"atMostOnePossibleNumberOfGroups",variableNames:["numbers"]}}),definition:function({dependencyValues:rs}){return rs.pngChild.length===0?{setValue:{possibleNumberOfGroups:[1]}}:{setValue:{possibleNumberOfGroups:rs.pngChild[0].stateValues.numbers}}}},ts}}Ms(CollaborateGroupSetup,"componentType","collaborateGroupSetup");class ConsiderAsResponses extends BaseComponent{static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.childrenWithNValues={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["nValues"],variablesOptional:!0}}),definition:({dependencyValues:rs})=>({setValue:{childrenWithNValues:rs.children}})},ts.childrenAsResponses={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["value","values","componentType"],variablesOptional:!0}}),definition:({dependencyValues:rs})=>({setValue:{childrenAsResponses:rs.children}})},ts}}Ms(ConsiderAsResponses,"componentType","considerAsResponses"),Ms(ConsiderAsResponses,"rendererType");class Case extends Template{static createAttributesObject(){let ts=super.createAttributesObject();return ts.condition={createComponentOfType:"boolean"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.conditionSatisfied={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:rs}){let ns;return rs.condition===null?ns=!0:ns=rs.condition.stateValues.value,{setValue:{conditionSatisfied:ns}}}},ts}static createSerializedReplacements({component:ts,componentInfoObjects:rs}){return ts.stateValues.conditionSatisfied?super.createSerializedReplacements({component:ts,componentInfoObjects:rs}):{replacements:[]}}}Ms(Case,"componentType","case");var dist={},formats={};Object.defineProperty(formats,"__esModule",{value:!0}),formats.FORMAT_PLAIN=formats.FORMAT_HTML=formats.FORMATS=void 0;var FORMAT_HTML="html";formats.FORMAT_HTML=FORMAT_HTML;var FORMAT_PLAIN="plain";formats.FORMAT_PLAIN=FORMAT_PLAIN;var FORMATS=[FORMAT_HTML,FORMAT_PLAIN];formats.FORMATS=FORMATS;var units={};Object.defineProperty(units,"__esModule",{value:!0}),units.UNIT_WORDS=units.UNIT_WORD=units.UNIT_SENTENCES=units.UNIT_SENTENCE=units.UNIT_PARAGRAPHS=units.UNIT_PARAGRAPH=units.UNITS=void 0;var UNIT_WORDS="words";units.UNIT_WORDS=UNIT_WORDS;var UNIT_WORD="word";units.UNIT_WORD=UNIT_WORD;var UNIT_SENTENCES="sentences";units.UNIT_SENTENCES=UNIT_SENTENCES;var UNIT_SENTENCE="sentence";units.UNIT_SENTENCE=UNIT_SENTENCE;var UNIT_PARAGRAPHS="paragraphs";units.UNIT_PARAGRAPHS=UNIT_PARAGRAPHS;var UNIT_PARAGRAPH="paragraph";units.UNIT_PARAGRAPH=UNIT_PARAGRAPH;var UNITS=[UNIT_WORDS,UNIT_WORD,UNIT_SENTENCES,UNIT_SENTENCE,UNIT_PARAGRAPHS,UNIT_PARAGRAPH];units.UNITS=UNITS;var words={};Object.defineProperty(words,"__esModule",{value:!0}),words.WORDS=void 0;var WORDS=["ad","adipisicing","aliqua","aliquip","amet","anim","aute","cillum","commodo","consectetur","consequat","culpa","cupidatat","deserunt","do","dolor","dolore","duis","ea","eiusmod","elit","enim","esse","est","et","eu","ex","excepteur","exercitation","fugiat","id","in","incididunt","ipsum","irure","labore","laboris","laborum","Lorem","magna","minim","mollit","nisi","non","nostrud","nulla","occaecat","officia","pariatur","proident","qui","quis","reprehenderit","sint","sit","sunt","tempor","ullamco","ut","velit","veniam","voluptate"];words.WORDS=WORDS;var LoremIpsum={},lineEndings={};Object.defineProperty(lineEndings,"__esModule",{value:!0}),lineEndings.LINE_ENDINGS=void 0;var LINE_ENDINGS={POSIX:`
`,WIN32:`\r
`};lineEndings.LINE_ENDINGS=LINE_ENDINGS;var generator={},util={},capitalize={};(function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=function(is){var as=is.trim();return as.charAt(0).toUpperCase()+as.slice(1)},rs=ts;ss.default=rs})(capitalize);var isNodeExports={},isNode={get exports(){return isNodeExports},set exports(ss){isNodeExports=ss}};(function(ss,ts){Object.defineProperty(ts,"__esModule",{value:!0}),ts.default=void 0;var rs=function(){return!!ss.exports},ns=rs;ts.default=ns})(isNode,isNodeExports);var isReactNative={};(function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=function(){var is=!1;try{is=navigator.product==="ReactNative"}catch{is=!1}return is},rs=ts;ss.default=rs})(isReactNative);var isWindows={},platforms={};Object.defineProperty(platforms,"__esModule",{value:!0}),platforms.SUPPORTED_PLATFORMS=void 0;var SUPPORTED_PLATFORMS={DARWIN:"darwin",LINUX:"linux",WIN32:"win32"};platforms.SUPPORTED_PLATFORMS=SUPPORTED_PLATFORMS,function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=platforms,rs=function(){var as=!1;try{as=browser$1.platform===ts.SUPPORTED_PLATFORMS.WIN32}catch{as=!1}return as},ns=rs;ss.default=ns}(isWindows);var makeArrayOfLength={};(function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=function(){var is=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return Array.apply(null,Array(is)).map(function(as,os){return os})},rs=ts;ss.default=rs})(makeArrayOfLength);var makeArrayOfStrings={};(function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=rs(makeArrayOfLength);function rs(as){return as&&as.__esModule?as:{default:as}}var ns=function(os,ls){var us=(0,ts.default)(os);return us.map(function(){return ls()})},is=ns;ss.default=is})(makeArrayOfStrings),function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),Object.defineProperty(ss,"capitalize",{enumerable:!0,get:function(){return ts.default}}),Object.defineProperty(ss,"isNode",{enumerable:!0,get:function(){return rs.default}}),Object.defineProperty(ss,"isReactNative",{enumerable:!0,get:function(){return ns.default}}),Object.defineProperty(ss,"isWindows",{enumerable:!0,get:function(){return is.default}}),Object.defineProperty(ss,"makeArrayOfLength",{enumerable:!0,get:function(){return as.default}}),Object.defineProperty(ss,"makeArrayOfStrings",{enumerable:!0,get:function(){return os.default}});var ts=ls(capitalize),rs=ls(isNodeExports),ns=ls(isReactNative),is=ls(isWindows),as=ls(makeArrayOfLength),os=ls(makeArrayOfStrings);function ls(us){return us&&us.__esModule?us:{default:us}}}(util),function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=words,rs=util;function ns(cs,ps){if(!(cs instanceof ps))throw new TypeError("Cannot call a class as a function")}function is(cs,ps){for(var ds=0;ds<ps.length;ds++){var fs=ps[ds];fs.enumerable=fs.enumerable||!1,fs.configurable=!0,"value"in fs&&(fs.writable=!0),Object.defineProperty(cs,fs.key,fs)}}function as(cs,ps,ds){return ps&&is(cs.prototype,ps),ds&&is(cs,ds),Object.defineProperty(cs,"prototype",{writable:!1}),cs}function os(cs,ps,ds){return ps in cs?Object.defineProperty(cs,ps,{value:ds,enumerable:!0,configurable:!0,writable:!0}):cs[ps]=ds,cs}var ls=function(){function cs(){var ps=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ds=ps.sentencesPerParagraph,fs=ds===void 0?{max:7,min:3}:ds,hs=ps.wordsPerSentence,ys=hs===void 0?{max:15,min:5}:hs,gs=ps.random;ps.seed;var bs=ps.words,vs=bs===void 0?ts.WORDS:bs;if(ns(this,cs),os(this,"sentencesPerParagraph",void 0),os(this,"wordsPerSentence",void 0),os(this,"random",void 0),os(this,"words",void 0),fs.min>fs.max)throw new Error("Minimum number of sentences per paragraph (".concat(fs.min,") cannot exceed maximum (").concat(fs.max,")."));if(ys.min>ys.max)throw new Error("Minimum number of words per sentence (".concat(ys.min,") cannot exceed maximum (").concat(ys.max,")."));this.sentencesPerParagraph=fs,this.words=vs,this.wordsPerSentence=ys,this.random=gs||Math.random}return as(cs,[{key:"generateRandomInteger",value:function(ds,fs){return Math.floor(this.random()*(fs-ds+1)+ds)}},{key:"generateRandomWords",value:function(ds){var fs=this,hs=this.wordsPerSentence,ys=hs.min,gs=hs.max,bs=ds||this.generateRandomInteger(ys,gs);return(0,rs.makeArrayOfLength)(bs).reduce(function(vs,Ns){return"".concat(fs.pluckRandomWord()," ").concat(vs)},"").trim()}},{key:"generateRandomSentence",value:function(ds){return"".concat((0,rs.capitalize)(this.generateRandomWords(ds)),".")}},{key:"generateRandomParagraph",value:function(ds){var fs=this,hs=this.sentencesPerParagraph,ys=hs.min,gs=hs.max,bs=ds||this.generateRandomInteger(ys,gs);return(0,rs.makeArrayOfLength)(bs).reduce(function(vs,Ns){return"".concat(fs.generateRandomSentence()," ").concat(vs)},"").trim()}},{key:"pluckRandomWord",value:function(){var ds=0,fs=this.words.length-1,hs=this.generateRandomInteger(ds,fs);return this.words[hs]}}]),cs}(),us=ls;ss.default=us}(generator),function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var ts=formats,rs=lineEndings,ns=as(generator),is=util;function as(fs){return fs&&fs.__esModule?fs:{default:fs}}function os(fs,hs){if(!(fs instanceof hs))throw new TypeError("Cannot call a class as a function")}function ls(fs,hs){for(var ys=0;ys<hs.length;ys++){var gs=hs[ys];gs.enumerable=gs.enumerable||!1,gs.configurable=!0,"value"in gs&&(gs.writable=!0),Object.defineProperty(fs,gs.key,gs)}}function us(fs,hs,ys){return hs&&ls(fs.prototype,hs),ys&&ls(fs,ys),Object.defineProperty(fs,"prototype",{writable:!1}),fs}function cs(fs,hs,ys){return hs in fs?Object.defineProperty(fs,hs,{value:ys,enumerable:!0,configurable:!0,writable:!0}):fs[hs]=ys,fs}var ps=function(){function fs(){var hs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ys=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ts.FORMAT_PLAIN,gs=arguments.length>2?arguments[2]:void 0;if(os(this,fs),this.format=ys,this.suffix=gs,cs(this,"generator",void 0),ts.FORMATS.indexOf(ys.toLowerCase())===-1)throw new Error("".concat(ys," is an invalid format. Please use ").concat(ts.FORMATS.join(" or "),"."));this.generator=new ns.default(hs)}return us(fs,[{key:"getLineEnding",value:function(){return this.suffix?this.suffix:!(0,is.isReactNative)()&&(0,is.isNode)()&&(0,is.isWindows)()?rs.LINE_ENDINGS.WIN32:rs.LINE_ENDINGS.POSIX}},{key:"formatString",value:function(ys){return this.format===ts.FORMAT_HTML?"<p>".concat(ys,"</p>"):ys}},{key:"formatStrings",value:function(ys){var gs=this;return ys.map(function(bs){return gs.formatString(bs)})}},{key:"generateWords",value:function(ys){return this.formatString(this.generator.generateRandomWords(ys))}},{key:"generateSentences",value:function(ys){return this.formatString(this.generator.generateRandomParagraph(ys))}},{key:"generateParagraphs",value:function(ys){var gs=this.generator.generateRandomParagraph.bind(this.generator);return this.formatStrings((0,is.makeArrayOfStrings)(ys,gs)).join(this.getLineEnding())}}]),fs}(),ds=ps;ss.default=ds}(LoremIpsum),function(ss){Object.defineProperty(ss,"__esModule",{value:!0}),Object.defineProperty(ss,"LoremIpsum",{enumerable:!0,get:function(){return is.default}}),ss.loremIpsum=void 0;var ts=formats,rs=units,ns=words,is=as(LoremIpsum);function as(ls){return ls&&ls.__esModule?ls:{default:ls}}var os=function(){var us=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},cs=us.count,ps=cs===void 0?1:cs,ds=us.format,fs=ds===void 0?ts.FORMAT_PLAIN:ds,hs=us.paragraphLowerBound,ys=hs===void 0?3:hs,gs=us.paragraphUpperBound,bs=gs===void 0?7:gs,vs=us.random,Ns=us.sentenceLowerBound,Ts=Ns===void 0?5:Ns,Cs=us.sentenceUpperBound,xs=Cs===void 0?15:Cs,As=us.units,ws=As===void 0?rs.UNIT_SENTENCES:As,Es=us.words,Ss=Es===void 0?ns.WORDS:Es,Ds=us.suffix,Vs=Ds===void 0?"":Ds,Is={random:vs,sentencesPerParagraph:{max:bs,min:ys},words:Ss,wordsPerSentence:{max:xs,min:Ts}},Os=new is.default(Is,fs,Vs);switch(ws){case rs.UNIT_PARAGRAPHS:case rs.UNIT_PARAGRAPH:return Os.generateParagraphs(ps);case rs.UNIT_SENTENCES:case rs.UNIT_SENTENCE:return Os.generateSentences(ps);case rs.UNIT_WORDS:case rs.UNIT_WORD:return Os.generateWords(ps);default:return""}};ss.loremIpsum=os}(dist);class Lorem extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.minSentencesPerParagraph={createComponentOfType:"number",createStateVariable:"minSentencesPerParagraph",defaultValue:4,public:!0},ts.maxSentencesPerParagraph={createComponentOfType:"number",createStateVariable:"maxSentencesPerParagraph",defaultValue:8,public:!0},ts.minWordsPerSentence={createComponentOfType:"number",createStateVariable:"minWordsPerSentence",defaultValue:4,public:!0},ts.maxWordsPerSentence={createComponentOfType:"number",createStateVariable:"maxWordsPerSentence",defaultValue:8,public:!0},ts.generateWords={createComponentOfType:"number",createStateVariable:"generateWords",defaultValue:null},ts.generateSentences={createComponentOfType:"number",createStateVariable:"generateSentences",defaultValue:null},ts.generateParagraphs={createComponentOfType:"number",createStateVariable:"generateParagraphs",defaultValue:null},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.readyToExpandWhenResolved={returnDependencies:()=>({minSentencesPerParagraph:{dependencyType:"stateVariable",variableName:"minSentencesPerParagraph"},maxSentencesPerParagraph:{dependencyType:"stateVariable",variableName:"maxSentencesPerParagraph"},minWordsPerSentence:{dependencyType:"stateVariable",variableName:"minWordsPerSentence"},maxWordsPerSentence:{dependencyType:"stateVariable",variableName:"maxWordsPerSentence"},generateWords:{dependencyType:"stateVariable",variableName:"generateWords"},generateSentences:{dependencyType:"stateVariable",variableName:"generateSentences"},generateParagraphs:{dependencyType:"stateVariable",variableName:"generateParagraphs"}}),markStale:()=>({updateReplacements:!0}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:rs,componentInfoObjects:ns})=>({variantSeed:{dependencyType:"value",value:rs.variantSeed}}),definition({dependencyValues:rs,componentName:ns}){return{setValue:{generatedVariantInfo:{seed:rs.variantSeed,meta:{createdBy:ns}}}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs}){var ls;const ns=new dist.LoremIpsum({sentencesPerParagraph:{max:await ts.stateValues.maxSentencesPerParagraph,min:await ts.stateValues.minSentencesPerParagraph},wordsPerSentence:{max:await ts.stateValues.maxWordsPerSentence,min:await ts.stateValues.minWordsPerSentence},random:ts.sharedParameters.variantRng});let is=[];if(await ts.stateValues.generateParagraphs!==null){let us=await ts.stateValues.generateParagraphs;Number.isInteger(us)&&us>0&&(is=ns.generateParagraphs(us).split(`
`).map(ps=>({componentType:"p",children:[ps]})))}else if(await ts.stateValues.generateSentences!==null){let us=await ts.stateValues.generateSentences;if(Number.isInteger(us)&&us>0){let cs=ns.generateSentences(us).split(". ");for(let ps of cs.slice(0,cs.length-1))is.push({componentType:"text",children:[ps+"."]}),is.push(" ");is.push({componentType:"text",children:[cs[cs.length-1]]})}}else if(await ts.stateValues.generateWords!==null){let us=await ts.stateValues.generateWords;if(Number.isInteger(us)&&us>0){let cs=ns.generateWords(us).split(" ").map(ps=>({componentType:"text",children:[ps]}));is.push(cs[0]);for(let ps of cs.slice(1))is.push(" "),is.push(ps)}}let as=(ls=ts.attributes.newNamespace)==null?void 0:ls.primitive;return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:is,parentName:ts.componentName,parentCreatesNewNamespace:as,componentInfoObjects:rs}).serializedComponents}}static async calculateReplacementChanges({component:ts,componentInfoObjects:rs}){let ns=await this.createSerializedReplacements({component:ts,componentInfoObjects:rs});return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:ns.replacements}]}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns})}}Ms(Lorem,"componentType","lorem"),Ms(Lorem,"assignNamesToReplacements",!0),Ms(Lorem,"createsVariants",!0),Ms(Lorem,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");function returnStandardTriggeringAttributes(ss){return{triggerWhen:{createComponentOfType:"boolean",createStateVariable:"triggerWhen",defaultValue:!1,triggerActionOnChange:ss},triggerWith:{createTargetComponentNames:!0},triggerWhenObjectsClicked:{createTargetComponentNames:!0},triggerWhenObjectsFocused:{createTargetComponentNames:!0}}}function addStandardTriggeringStateVariableDefinitions(ss,ts){ss.insideTriggerSet={returnDependencies:()=>({parentTriggerSet:{dependencyType:"parentStateVariable",parentComponentType:"triggerSet",variableName:"updateValueAndActionsToTrigger"}}),definition({dependencyValues:is}){return{setValue:{insideTriggerSet:is.parentTriggerSet!==null}}}},ss.triggerWith={returnDependencies:()=>({triggerWith:{dependencyType:"attributeTargetComponentNames",attributeName:"triggerWith"},triggerWhenObjectsClicked:{dependencyType:"attributeTargetComponentNames",attributeName:"triggerWhenObjectsClicked"},triggerWhenObjectsFocused:{dependencyType:"attributeTargetComponentNames",attributeName:"triggerWhenObjectsFocused"},triggerWhen:{dependencyType:"attributeComponent",attributeName:"triggerWhen"},insideTriggerSet:{dependencyType:"stateVariable",variableName:"insideTriggerSet"}}),definition({dependencyValues:is}){if(is.triggerWhen||is.insideTriggerSet)return{setValue:{triggerWith:null}};{let as=[];if(is.triggerWith!==null)for(let os of is.triggerWith)as.push({target:os.absoluteName});if(is.triggerWhenObjectsClicked!==null)for(let os of is.triggerWhenObjectsClicked)as.push({target:os.absoluteName,triggeringAction:"click"});if(is.triggerWhenObjectsFocused!==null)for(let os of is.triggerWhenObjectsFocused)as.push({target:os.absoluteName,triggeringAction:"down"});return as.length===0&&(as=null),{setValue:{triggerWith:as}}}}},ss.triggerWithTargetIds={chainActionOnActionOfStateVariableTargets:{triggeredAction:ts},returnDependencies:()=>({triggerWith:{dependencyType:"stateVariable",variableName:"triggerWith"}}),definition({dependencyValues:is}){let as=[];if(is.triggerWith)for(let os of is.triggerWith){let ls=os.target;os.triggeringAction&&(ls+="|"+os.triggeringAction),as.includes(ls)||as.push(ls)}return{setValue:{triggerWithTargetIds:as}}},markStale(){return{updateActionChaining:!0}}};let rs=ss.hidden.returnDependencies,ns=ss.hidden.definition;ss.hidden.returnDependencies=function(is){let as=rs(is);return as.triggerWhen={dependencyType:"attributeComponent",attributeName:"triggerWhen"},as.triggerWith={dependencyType:"stateVariable",variableName:"triggerWith"},as.insideTriggerSet={dependencyType:"stateVariable",variableName:"insideTriggerSet"},as},ss.hidden.definition=function(is){return is.dependencyValues.triggerWhen||is.dependencyValues.triggerWith||is.dependencyValues.insideTriggerSet?{setValue:{hidden:!0}}:ns(is)}}class UpdateValue extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateValue:this.updateValue.bind(this),updateValueIfTriggerNewlyTrue:this.updateValueIfTriggerNewlyTrue.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"math",toLowerCase:!0,validValues:["math","number","boolean","text"]},ts.prop={createPrimitiveOfType:"string"},ts.newValue={createComponentOfType:"_componentWithSelectableType"},ts.componentIndex={createComponentOfType:"integer",createStateVariable:"componentIndex",defaultValue:null,public:!0},ts.propIndex={createComponentOfType:"numberList",createStateVariable:"propIndex",defaultValue:null,public:!0};let rs=returnStandardTriggeringAttributes("updateValueIfTriggerNewlyTrue");return Object.assign(ts,rs),ts.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{"":"full",true:"full",false:"none"},validValues:["none","full","numbers","numberspreserveorder"]},ts}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();addStandardTriggeringStateVariableDefinitions(ts,"updateValue");let rs=returnLabelStateVariableDefinitions();return Object.assign(ts,rs),ts.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:ns})=>({setValue:{target:ns.target}})},ts.targetComponent={returnDependencies(){return{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:ns}){let is=null;return ns.targetComponent&&(is=ns.targetComponent),{setValue:{targetComponent:is}}}},ts.propName={returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:ns}){return{setValue:{propName:ns.propName}}}},ts.targetIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:ns,componentInfoObjects:is}){let as={};return ns.targetComponent!==null&&(is.isCompositeComponent({componentType:ns.targetComponent.componentType,includeNonStandard:!1})?as.targets={dependencyType:"replacement",compositeName:ns.targetComponent.componentName,recursive:!0,componentIndex:ns.componentIndex}:(ns.componentIndex===null||ns.componentIndex===1)&&(as.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),as},definition({dependencyValues:ns}){let is=null;return ns.targets&&(is=ns.targets,Array.isArray(is)||(is=[is])),{setValue:{targetIdentities:is}}}},ts.targets={stateVariablesDeterminingDependencies:["targetIdentities","propName","propIndex"],returnDependencies:function({stateValues:ns}){let is={targetIdentities:{dependencyType:"stateVariable",variableName:"targetIdentities"}};if(ns.targetIdentities!==null)for(let[as,os]of ns.targetIdentities.entries()){let ls;if(ns.propName){let us=ns.propIndex;us&&(us=[...us]),ls={dependencyType:"stateVariable",componentName:os.componentName,variableName:ns.propName,returnAsComponentObject:!0,variablesOptional:!0,propIndex:us,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}}else ls={dependencyType:"componentIdentity",componentName:os.componentName};is["target"+as]=ls}return is},definition({dependencyValues:ns}){let is=null;if(ns.targetIdentities!==null){is=[];for(let as in ns.targetIdentities)ns["target"+as]&&is.push(ns["target"+as])}return{setValue:{targets:is}}}},ts.newValue={returnDependencies:()=>({newValueAttr:{dependencyType:"attributeComponent",attributeName:"newValue",variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"},simplify:{dependencyType:"stateVariable",variableName:"simplify"}}),definition:function({dependencyValues:ns}){if(ns.newValueAttr===null)return{setValue:{newValue:null}};let is=ns.newValueAttr.stateValues.value;return ns.type==="math"&&(is=normalizeMathExpression({value:is,simplify:ns.simplify})),{setValue:{newValue:is}}}},ts}async updateValue({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.targets,as=await this.stateValues.newValue;if(is===null||as===null)return;let os=[];for(let ls of is){let us="value";if(ls.stateValues&&(us=Object.keys(ls.stateValues)[0],us===void 0)){console.warn(`Cannot update prop="${await this.stateValues.propName}" of ${await this.stateValues.target} as could not find prop ${await this.stateValues.propName} on a component of type ${ls.componentType}`);continue}os.push({updateType:"updateValue",componentName:ls.componentName,stateVariable:us,value:as})}return await this.coreFunctions.performUpdate({updateInstructions:os,actionId:ts,sourceInformation:rs,skipRendererUpdate:!0,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:as,responseText:as.toString()}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}async updateValueIfTriggerNewlyTrue({stateValues:ts,previousValues:rs,actionId:ns}){if(await ts.triggerWhen&&rs.triggerWhen===!1&&!await this.stateValues.insideTriggerSet)return await this.updateValue({actionId:ns,skipRendererUpdate:!0});this.coreFunctions.resolveAction({actionId:ns})}}Ms(UpdateValue,"componentType","updateValue"),Ms(UpdateValue,"acceptTarget",!0);class CallAction extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{callAction:this.callAction.bind(this),callActionIfTriggerNewlyTrue:this.callActionIfTriggerNewlyTrue.bind(this)})}static keepChildrenSerialized({serializedComponent:ts,componentInfoObjects:rs}){if(ts.children===void 0)return[];{let ns=[];for(let[is,as]of ts.children.entries())rs.componentIsSpecifiedType(as,"label")||ns.push(is);return ns}}static createAttributesObject(){let ts=super.createAttributesObject();ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0},ts.actionName={createComponentOfType:"text",createStateVariable:"actionName",defaultValue:null,public:!0};let rs=returnStandardTriggeringAttributes("callActionIfTriggerNewlyTrue");return Object.assign(ts,rs),ts.numbers={createComponentOfType:"numberList"},ts.number={createComponentOfType:"number"},ts}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();addStandardTriggeringStateVariableDefinitions(ts,"callAction");let rs=returnLabelStateVariableDefinitions();return Object.assign(ts,rs),ts.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:ns})=>({setValue:{target:ns.target}})},ts.targetComponent={returnDependencies(){return{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:ns}){let is=null;return ns.targetComponent&&(is=ns.targetComponent),{setValue:{targetComponent:is}}}},ts.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition({dependencyValues:ns}){let is=null;return ns.targetComponent&&(is=ns.targetComponent.componentName),{setValue:{targetName:is}}}},ts}async callAction({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.stateValues.targetName,as=await this.stateValues.actionName;if(is!==null&&as!==null){let os={sourceInformation:rs,skipRendererUpdate:!0};this.serializedChildren.length>0&&(os.serializedComponents=deepClone(this.serializedChildren)),this.attributes.number&&(os.number=await this.attributes.number.component.stateValues.value),this.attributes.numbers&&(os.numbers=await this.attributes.numbers.component.stateValues.numbers),ts&&(os.actionId=ts),await this.coreFunctions.performAction({componentName:is,actionName:as,args:os,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType}},caseInsensitiveMatch:!0}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}else this.coreFunctions.resolveAction({actionId:ts})}async callActionIfTriggerNewlyTrue({stateValues:ts,previousValues:rs,actionId:ns}){if(ts.triggerWhen&&rs.triggerWhen===!1&&!await this.stateValues.insideTriggerSet)return await this.callAction({actionId:ns});this.coreFunctions.resolveAction({actionId:ns})}}Ms(CallAction,"componentType","callAction"),Ms(CallAction,"acceptTarget",!0);class triggerSet extends InlineComponent{constructor(ts){super(ts),Object.assign(this.actions,{triggerActions:this.triggerActions.bind(this),triggerActionsIfTriggerNewlyTrue:this.triggerActionsIfTriggerNewlyTrue.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();ts.labelIsName={createComponentOfType:"boolean",createStateVariable:"labelIsName",defaultValue:!1,public:!0};let rs=returnStandardTriggeringAttributes("triggerActionsIfTriggerNewlyTrue");return Object.assign(ts,rs),ts}static returnChildGroups(){return[{group:"updateValuesCallActions",componentTypes:["updateValue","callAction"]},{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();addStandardTriggeringStateVariableDefinitions(ts,"triggerActions");let rs=returnLabelStateVariableDefinitions();return Object.assign(ts,rs),ts.updateValueAndActionsToTrigger={returnDependencies:()=>({updateValueAndCallActionChildren:{dependencyType:"child",childGroups:["updateValuesCallActions"]}}),definition({dependencyValues:ns}){return{setValue:{updateValueAndActionsToTrigger:ns.updateValueAndCallActionChildren}}}},ts}async triggerActions({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){for(let is of await this.stateValues.updateValueAndActionsToTrigger)this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:is.componentType,baseComponentType:"updateValue"})?await this.coreFunctions.performAction({componentName:is.componentName,actionName:"updateValue",args:{actionId:ts,sourceInformation:rs,skipRendererUpdate:!0}}):this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:is.componentType,baseComponentType:"callAction"})&&await this.coreFunctions.performAction({componentName:is.componentName,actionName:"callAction",args:{actionId:ts,sourceInformation:rs,skipRendererUpdate:!0}});return this.coreFunctions.resolveAction({actionId:ts}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}async triggerActionsIfTriggerNewlyTrue({stateValues:ts,previousValues:rs,actionId:ns}){if(ts.triggerWhen&&rs.triggerWhen===!1)return await this.triggerActions({actionId:ns,skipRendererUpdate:!0});this.coreFunctions.resolveAction({actionId:ns})}}Ms(triggerSet,"componentType","triggerSet");class FunctionIterates extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.nIterates={createComponentOfType:"integer",createStateVariable:"nIterates",defaultValue:0,public:!0},ts.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},ts.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},ts.initialValue={createComponentOfType:"math",createStateVariable:"initialValue",defaultValue:Context.fromAst("")},ts.function={createComponentOfType:"function"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["nInputs","nOutputs"]}}),definition({dependencyValues:rs}){return rs.functionAttr?rs.functionAttr.stateValues.nInputs!==rs.functionAttr.stateValues.nOutputs?(console.warn("Function iterates are possible only if the number of inputs is equal to the number of outputs"),{setValue:{nDimensions:0}}):{setValue:{nDimensions:rs.functionAttr.stateValues.nInputs}}:{setValue:{nDimensions:0}}}},ts.allIterates={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","numericalfs","symbolic"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition({dependencyValues:rs}){let ns=[],is=rs.functionAttr,as=rs.initialValue,os=!rs.forceNumeric&&(is.stateValues.symbolic||rs.forceSymbolic),ls=rs.nIterates;if(!is||rs.nDimensions===0||!(rs.nDimensions===1||Array.isArray(as.tree)&&vectorOperators.includes(as.tree[0])&&as.tree.length===rs.nDimensions+1))return ns=Array(ls).fill(Context.fromAst("")),{setValue:{allIterates:ns}};if(os)if(rs.nDimensions===1){let us=is.stateValues.symbolicfs[0],cs=as;for(let ps=0;ps<ls;ps++)cs=us(cs),ns.push(cs)}else{let us=is.stateValues.symbolicfs,cs=as.tree.slice(1);for(let ps=0;ps<ls;ps++){let ds=[];for(let fs=0;fs<rs.nDimensions;fs++)ds.push(us[fs](...cs).tree);ns.push(Context.fromAst(["vector",...ds])),cs=ds}}else if(rs.nDimensions===1){let us=is.stateValues.numericalfs[0],cs=as.evaluate_to_constant();if(Number.isNaN(cs))ns=Array(ls).fill(Context.fromAst(""));else for(let ps=0;ps<ls;ps++)cs=us(cs),ns.push(Context.fromAst(cs))}else{let us=is.stateValues.numericalfs,cs=as.tree.slice(1).map(ps=>Context.fromAst(ps).evaluate_to_constant());for(let ps=0;ps<ls;ps++){let ds=[];for(let fs=0;fs<rs.nDimensions;fs++)ds.push(us[fs](...cs));ns.push(Context.fromAst(["vector",...ds])),cs=ds}}return{setValue:{allIterates:ns}}}},ts.allIteratesWithInitial={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}),definition({dependencyValues:rs}){return{setValue:{allIteratesWithInitial:[rs.initialValue,...rs.allIterates]}}}},ts.iterates={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["iterate"],returnArraySizeDependencies:()=>({nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),returnArraySize({dependencyValues:rs}){return[rs.nIterates]},returnArrayDependenciesByKey(){return{globalDependencies:{allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arraySize:ns}){let is={};for(let as=0;as<ns[0];as++)is[as]=rs.allIterates[as];return{setValue:{iterates:is}}}},ts.finalIterate={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["nIterates"],returnDependencies({stateValues:rs}){return!Number.isFinite(rs.nIterates)||rs.nIterates<0?{}:rs.nIterates>0?{finalIterate:{dependencyType:"stateVariable",variableName:`iterate${rs.nIterates}`}}:{finalIterate:{dependencyType:"stateVariable",variableName:"initialValue"}}},definition({dependencyValues:rs}){return{setValue:{finalIterate:rs.finalIterate}}}},ts}}Ms(FunctionIterates,"componentType","functionIterates"),Ms(FunctionIterates,"rendererType");class Module extends Template{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.styleNumber,ts}}Ms(Module,"componentType","module"),Ms(Module,"renderedDefault",!0),Ms(Module,"acceptAnyAttribute",!0);class CustomAttribute extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.componentType={createPrimitiveOfType:"string"},ts.attribute={createPrimitiveOfType:"string"},ts.defaultValue={leaveRaw:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.componentNameForAttributes={returnDependencies:()=>({parentVariableContainingName:{dependencyType:"parentStateVariable",variableName:"componentNameForAttributes"}}),definition({dependencyValues:rs}){return{setValue:{componentNameForAttributes:rs.parentVariableContainingName}}}},ts.attributeName={returnDependencies:()=>({attribute:{dependencyType:"attributePrimitive",attributeName:"attribute"}}),definition({dependencyValues:rs}){return{setValue:{attributeName:rs.attribute}}}},ts.readyToExpandWhenResolved={stateVariablesDeterminingDependencies:["componentNameForAttributes"],returnDependencies:({stateValues:rs})=>({componentIdentity:{dependencyType:"componentIdentity",componentName:rs.componentNameForAttributes}}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,components:rs,workspace:ns,componentInfoObjects:is,flags:as}){var Ts;let os=(Ts=ts.attributes.newNamespace)==null?void 0:Ts.primitive,ls=is.componentTypeLowerCaseMapping[ts.attributes.componentType.primitive.toLowerCase()];if(!is.allComponentClasses[ls])return console.warn(`Could not find component type ${ls}`),{replacements:[]};let cs=rs[await ts.stateValues.componentNameForAttributes],ps={};for(let Cs in cs.attributes)ps[Cs.toLowerCase()]=Cs;let ds=await ts.stateValues.attributeName,fs=ps[ds.toLowerCase()],hs=cs.attributes[fs];if(hs===void 0){if(ts.attributes.defaultValue===void 0)return console.warn("Cannot create component from attribute if neither attribute nor default value specified"),{replacements:[]};hs=ts.attributes.defaultValue}let ys=cs.constructor,gs=Object.keys(ys.createAttributesObject()).map(Cs=>Cs.toLowerCase());if(gs.push("name","target","assignnames"),gs.includes(ds.toLowerCase()))return console.warn(`Cannot add attribute ${ds} of a ${ys.componentType} as it already exists in ${ys.componentType} class`),{replacements:[]};let vs=componentFromAttribute({attrObj:{createComponentOfType:ls},value:hs,componentInfoObjects:is}).component;if(vs.children&&(applyMacros(vs.children,is),os)){for(let Cs of vs.children)if(Cs.componentType==="copy"){let xs=Cs.doenetAttributes.target;/[a-zA-Z_]/.test(xs[0])&&(Cs.doenetAttributes.target="../"+xs)}}return applySugar({serializedComponents:[vs],isAttributeComponent:!0,componentInfoObjects:is}),setTNamesToAbsolute([vs]),{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:[vs],parentName:ts.componentName,parentCreatesNewNamespace:os,componentInfoObjects:is}).serializedComponents}}}Ms(CustomAttribute,"componentType","customAttribute"),Ms(CustomAttribute,"assignNamesToReplacements",!0);class Setup extends CompositeComponent{static returnChildGroups(){return[{group:"styleDefinitions",componentTypes:["styleDefinitions"]},{group:"feedbackDefinitions",componentTypes:["feedbackDefinitions"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.componentNameForAttributes={returnDependencies:()=>({sourceCompositeIdentity:{dependencyType:"sourceCompositeIdentity"}}),definition({dependencyValues:rs}){let ns=null;return rs.sourceCompositeIdentity&&(ns=rs.sourceCompositeIdentity.componentName),{setValue:{componentNameForAttributes:ns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}}Ms(Setup,"componentType","setup");class Footnote extends InlineComponent{static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns="";for(let is of rs.inlineChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"?ns+=is.stateValues.text:ns+=" ";return{setValue:{text:ns}}}},ts.footnoteTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({footnoteCounter:{dependencyType:"counter",counterName:"footnote"}}),definition({dependencyValues:rs}){return{setValue:{footnoteTag:String(rs.footnoteCounter)}}}},ts}}Ms(Footnote,"componentType","footnote"),Ms(Footnote,"renderChildren",!0),Ms(Footnote,"includeBlankStringChildren",!0);class Caption extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static returnChildGroups(){return[{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlinesBlocks"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:rs}){let ns="";for(let is of rs.inlineChildren)typeof is!="object"?ns+=is.toString():typeof is.stateValues.text=="string"?ns+=is.stateValues.text:ns+=" ";return{setValue:{text:ns}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Caption,"componentType","caption"),Ms(Caption,"rendererType","containerInline"),Ms(Caption,"renderChildren",!0),Ms(Caption,"includeBlankStringChildren",!0);class Endpoint extends Point{static createAttributesObject(){let ts=super.createAttributesObject();return ts.open={createComponentOfType:"boolean",createStateVariable:"open",defaultValue:!1,public:!0,forRenderer:!0},ts.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},ts}async switchPoint({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!await this.stateValues.open}],actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{open:!await this.stateValues.open}}});this.coreFunctions.resolveAction({actionId:ts})}}Ms(Endpoint,"componentType","endpoint"),Ms(Endpoint,"rendererType","point");class Sort extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.sortVectorsBy={createComponentOfType:"text",createStateVariable:"sortVectorsBy",defaultValue:"displacement",public:!0,toLowerCase:!0,validValues:["displacement","tail"]},ts.sortByComponent={createComponentOfType:"integer",createStateVariable:"sortByComponent",defaultValue:"1",public:!0},ts.sortByProp={createPrimitiveOfType:"string"},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.propName={returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"sortByProp"}}),definition:function({dependencyValues:rs}){return{setValue:{propName:rs.propName}}}},ts.componentNamesForValues={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["componentNamesInList"],variablesOptional:!0}}),definition({dependencyValues:rs}){let ns=[];for(let is of rs.children)is.stateValues.componentNamesInList?ns.push(...is.stateValues.componentNamesInList):ns.push(is.componentName);return{setValue:{componentNamesForValues:ns}}}},ts.sortedValues={stateVariablesDeterminingDependencies:["componentNamesForValues","sortByComponent","propName"],returnDependencies({stateValues:rs}){let ns={sortVectorsBy:{dependencyType:"stateVariable",variableName:"sortVectorsBy"},sortByComponent:{dependencyType:"stateVariable",variableName:"sortByComponent"},propName:{dependencyType:"stateVariable",variableName:"propName"}};if(rs.propName)for(let[is,as]of rs.componentNamesForValues.entries())ns[`component${is}`]={dependencyType:"stateVariable",componentName:as,variableName:rs.propName,variablesOptional:!0,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,returnAsComponentObject:!0};else for(let[is,as]of rs.componentNamesForValues.entries())ns[`component${is}`]={dependencyType:"multipleStateVariables",componentName:as,variableNames:["value",`x${rs.sortByComponent}`,`tailX${rs.sortByComponent}`],variablesOptional:!0};return ns},definition({dependencyValues:rs,componentInfoObjects:ns}){let is=[],as=!0;for(let os in rs){if(os.substring(0,9)!=="component")continue;let ls=rs[os];if(rs.propName){let us=Object.values(ls.stateValues)[0];is.push({componentName:ls.componentName,numericalValue:Number(us),textValue:String(us)}),Number.isFinite(us)||(as=!1)}else if(ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"number"}))is.push({componentName:ls.componentName,numericalValue:ls.stateValues.value,textValue:String(ls.stateValues.value)});else if(ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"text"})){let us=NaN,cs=ls.stateValues.value;is.push({componentName:ls.componentName,numericalValue:us,textValue:cs}),as=!1}else if(ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"math"})){let us=ls.stateValues.value.evaluate_to_constant();Number.isNaN(us)&&(as=!1),is.push({componentName:ls.componentName,numericalValue:us,textValue:ls.stateValues.value.toString()})}else if(ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"point"})){let us=ls.stateValues[`x${rs.sortByComponent}`],cs=NaN,ps="";us&&(cs=us.evaluate_to_constant(),Number.isNaN(cs)&&(as=!1),ps=us.toString()),is.push({componentName:ls.componentName,numericalValue:cs,textValue:ps})}else if(ns.isInheritedComponentType({inheritedComponentType:ls.componentType,baseComponentType:"vector"})){let us=NaN,cs="",ps=ls.stateValues[`x${rs.sortByComponent}`];rs.sortVectorsBy==="displacement"?ps=ls.stateValues[`x${rs.sortByComponent}`]:ps=ls.stateValues[`tailX${rs.sortByComponent}`],ps&&(us=ps.evaluate_to_constant(),Number.isNaN(us)&&(as=!1),cs=ps.toString()),is.push({componentName:ls.componentName,numericalValue:us,textValue:cs})}}return as?is.sort((os,ls)=>os.numericalValue-ls.numericalValue):is.sort((os,ls)=>os.textValue>ls.textValue?1:os.textValue<ls.textValue?-1:0),{setValue:{sortedValues:is}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({sortedValues:{dependencyType:"stateVariable",variableName:"sortedValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns,workspace:is}){let as=[],os=[];for(let us of await ts.stateValues.sortedValues){let cs;us.listInd===void 0?cs=rs[us.componentName]:cs=rs[us.componentName].activeChildren[us.listInd],cs&&(os.push(cs.componentName),as.push(await cs.serialize({sourceAttributesToIgnoreRecursively:["isResponse"]})))}is.uniqueIdentifiersUsed=[],as=postProcessCopy({serializedComponents:as,componentName:ts.componentName,uniqueIdentifiersUsed:is.uniqueIdentifiersUsed,addShadowDependencies:!0,markAsPrimaryShadow:!0});let ls=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:as,parentName:ts.componentName,parentCreatesNewNamespace:await ts.stateValues.newNamespace,componentInfoObjects:ns});return is.componentsCopied=os,{replacements:ls.serializedComponents}}static async calculateReplacementChanges({component:ts,components:rs,componentInfoObjects:ns,workspace:is}){let as=[];for(let us of await ts.stateValues.sortedValues){let cs;us.listInd===void 0?cs=rs[us.componentName]:cs=rs[us.componentName].activeChildren[us.listInd],cs&&as.push(cs.componentName)}if(as.length==is.componentsCopied.length&&is.componentsCopied.every((us,cs)=>us===as[cs]))return[];let os=(await this.createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns,workspace:is})).replacements;return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:os}]}}Ms(Sort,"componentType","sort"),Ms(Sort,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved"),Ms(Sort,"assignNamesToReplacements",!0);class Shuffle extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.originalComponentNames={additionalStateVariablesDefined:["nComponents"],returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["componentNamesInList"],variablesOptional:!0}}),definition({dependencyValues:rs}){let ns=[];for(let is of rs.children)is.stateValues.componentNamesInList?ns.push(...is.stateValues.componentNamesInList):ns.push(is.componentName);return{setValue:{originalComponentNames:ns,nComponents:ns.length}}}},ts.componentOrder={returnDependencies({sharedParameters:rs}){return{variantSeed:{dependencyType:"value",value:rs.variantSeed},rngClass:{dependencyType:"value",value:rs.rngClass,doNotProxy:!0},nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},variants:{dependencyType:"variants"}}},definition({dependencyValues:rs}){var ls,us;let ns=rs.nComponents,is=(us=(ls=rs.variants)==null?void 0:ls.desiredVariant)==null?void 0:us.indices;if(is!==void 0)if(is.length!==ns)console.warn("Ignoring indices specified for shuffle as number of indices doesn't match number of components.");else{if(is=is.map(Number),!is.every(Number.isInteger))throw Error("All indices specified for shuffle must be integers");if(!is.every(cs=>cs>=1&&cs<=ns))console.warn("Ignoring indices specified for shuffle as some indices out of range.");else return{setValue:{componentOrder:is}}}let as=rs.rngClass(rs.variantSeed+"co"),os=[...Array(ns).keys()].map(cs=>cs+1);for(let cs=ns-1;cs>0;cs--){const ps=as(),ds=Math.floor(ps*(cs+1));[os[cs],os[ds]]=[os[ds],os[cs]]}return{setValue:{componentOrder:os}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({sortedValues:{dependencyType:"stateVariable",variableName:"componentOrder"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.generatedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:rs,sharedParameters:ns})=>({variantSeed:{dependencyType:"value",value:ns.variantSeed},componentOrder:{dependencyType:"stateVariable",variableName:"componentOrder"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(rs.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns}){let is={seed:rs.variantSeed,meta:{createdBy:ns},indices:rs.componentOrder},as=is.subvariants=[];for(let os of rs.variantDescendants)os.stateValues.isVariantComponent?as.push(os.stateValues.generatedVariantInfo):os.stateValues.generatedVariantInfo&&as.push(...os.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:is,isVariantComponent:!0}}}},ts}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns})}static async createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns,workspace:is}){let as=[],os=[],ls=await ts.stateValues.originalComponentNames;for(let cs of await ts.stateValues.componentOrder){let ps=rs[ls[cs-1]];ps&&(os.push(ps.componentName),as.push(await ps.serialize({sourceAttributesToIgnoreRecursively:["isResponse"]})))}is.uniqueIdentifiersUsed=[],as=postProcessCopy({serializedComponents:as,componentName:ts.componentName,uniqueIdentifiersUsed:is.uniqueIdentifiersUsed,addShadowDependencies:!0,markAsPrimaryShadow:!0});let us=processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:as,parentName:ts.componentName,parentCreatesNewNamespace:await ts.stateValues.newNamespace,componentInfoObjects:ns});return is.componentsCopied=os,{replacements:us.serializedComponents}}static async calculateReplacementChanges({component:ts,components:rs,componentInfoObjects:ns,workspace:is}){let as=[],os=await ts.stateValues.originalComponentNames;for(let cs of await ts.stateValues.componentOrder){let ps=rs[os[cs-1]];ps&&as.push(ps.componentName)}if(as.length==is.componentsCopied.length&&is.componentsCopied.every((cs,ps)=>cs===as[ps]))return[];let ls=(await this.createSerializedReplacements({component:ts,components:rs,componentInfoObjects:ns,workspace:is})).replacements;return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:ls}]}static determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs}){var ls,us,cs;let ns=0;for(let ps of ts.children)if(rs.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"_composite"}))if((ls=ps.attributes.createComponentOfType)!=null&&ls.primitive)if(((us=ps.attributes.nComponents)==null?void 0:us.primitive)!==void 0){let ds=Number((cs=ps.attributes.nComponents)==null?void 0:cs.primitive);if(Number.isInteger(ds)&&ds>=0)ns+=ds;else return{success:!1}}else ns++;else return{success:!1};else ns++;let is=1;for(let ps=2;ps<=ns;ps++)is*=ps;let as=super.determineNumberOfUniqueVariants({serializedComponent:ts,componentInfoObjects:rs});if(!as.success)return{success:!1};let os=as.numberOfVariants*is;return ts.variants.numberOfVariants=os,ts.variants.uniqueVariantData={numberOfVariantsByDescendant:ts.variants.uniqueVariantData.numberOfVariantsByDescendant,numberOfPermutations:is,nComponents:ns},{success:!0,numberOfVariants:os}}static getUniqueVariant({serializedComponent:ts,variantIndex:rs,componentInfoObjects:ns}){var Ns;let is=(Ns=ts.variants)==null?void 0:Ns.numberOfVariants;if(is===void 0)return{success:!1};if(!Number.isInteger(rs)||rs<1||rs>is)return{success:!1};let as=ts.variants.uniqueVariantData.numberOfVariantsByDescendant,os=ts.variants.descendantVariantComponents,ls=ts.variants.uniqueVariantData.numberOfPermutations,us=ts.variants.uniqueVariantData.nComponents,cs=[...as];cs.push(ls);let ps=enumerateCombinations({numberOfOptionsByIndex:cs,maxNumber:rs})[rs-1].map(Ts=>Ts+1),ds=ps.pop(),fs=ps,hs=[...Array(us).keys()].map(Ts=>Ts+1),ys=enumeratePermutations({values:hs,maxNumber:ds})[ds-1],gs=!1,bs=[];for(let Ts=0;Ts<as.length;Ts++)if(as[Ts]>1){let Cs=os[Ts],As=ns.allComponentClasses[Cs.componentType].getUniqueVariant({serializedComponent:Cs,variantIndex:fs[Ts],componentInfoObjects:ns});if(!As.success)return{success:!1};bs.push(As.desiredVariant),gs=!0}else bs.push({});let vs={indices:ys};return gs&&(vs.subvariants=bs),{success:!0,desiredVariant:vs}}}Ms(Shuffle,"componentType","shuffle"),Ms(Shuffle,"createsVariants",!0),Ms(Shuffle,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved"),Ms(Shuffle,"assignNamesToReplacements",!0);class SolveEquations extends InlineComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.variables={createComponentOfType:"variables"},ts.nDiscretizationPoints={createComponentOfType:"number",createStateVariable:"nDiscretizationPoints",defaultValue:100,public:!0},ts.minVar={createComponentOfType:"number",createStateVariable:"minVar",defaultValue:null},ts.maxVar={createComponentOfType:"number",createStateVariable:"maxVar",defaultValue:null},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){return ns.every(is=>typeof is=="string"||is.doenetAttributes&&is.doenetAttributes.createdFromMacro)?ns.length===1&&typeof ns[0]!="string"?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:ns}]}:{success:!1}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions({numerics:ts}){let rs=super.returnStateVariableDefinitions({numerics:ts});return rs.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({}),returnArraySize({dependencyValues:ns}){return[1]},returnArrayDependenciesByKey({arrayKeys:ns}){return{globalDependencies:{variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]}}}},arrayDefinitionByKey({globalDependencyValues:ns,arraySize:is,arrayKeys:as,usedDefault:os}){let ls=[];return ns.variablesAttr!==null&&(ls=ns.variablesAttr.stateValues.variables),{setValue:{variables:returnNVariables(is[0],ls)}}}},rs.variable={isAlias:!0,targetVariableName:"variable1"},rs.allSolutions={returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},variables:{dependencyType:"stateVariable",variableName:"variables"},minVar:{dependencyType:"stateVariable",variableName:"minVar"},maxVar:{dependencyType:"stateVariable",variableName:"maxVar"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"}}),definition({dependencyValues:ns}){if(ns.mathChild.length===0)return{setValue:{allSolutions:[]}};let is=ns.mathChild[0].stateValues.value;if(!(Array.isArray(is.tree)&&is.tree.length===3&&is.tree[0]==="="))return{setValue:{allSolutions:[]}};let as=ns.minVar,os=ns.maxVar,ls=[],us=ns.variables[0].subscripts_to_strings().tree,cs=Context.fromAst(["+",is.tree[1],["-",is.tree[2]]]).subscripts_to_strings(),ps=cs.f(),ds=ws=>ps({[us]:ws}),fs=ws=>normalizeMathExpression({value:cs.substitute({[us]:ws}).strings_to_subscripts(),simplify:!0,expand:!0}).evaluate_to_constant(),hs=function(ws){try{return ds(ws)}catch{return NaN}},ys=function(ws){try{return ds(ws)}catch{let Ss=fs(ws);return Ss!==null?Ss:NaN}};if(Number.isFinite(as)||(as=-10),Number.isFinite(os)||(os=10),as>os)return{setValue:{allSolutions:[]}};let gs=[as,os],bs=[as];for(let ws=0;ws<gs.length-1;ws++){let Es=gs[ws],Ss=gs[ws+1],Ds=ns.nDiscretizationPoints,Vs=(Ss-Es)/Ds;for(let Is=1;Is<Ds;Is++)bs.push(Es+Is*Vs);bs.push(Ss)}let vs=2*bs[0]-bs[1],Ns=2*bs[bs.length-1]-bs[bs.length-2];bs=[vs,...bs,Ns];let Ts=bs.map(ys),Cs=bs[0],xs=Ts[0];for(let ws=0;ws<bs.length;ws++){let Es=bs[ws],Ss=Ts[ws];if(!Number.isFinite(Ss)||!Number.isFinite(xs)){let Ds,Vs;if(Number.isFinite(Ss)?(Ds=Es,Vs=Cs):Number.isFinite(xs)&&(Ds=Cs,Vs=Es),Ds!==void 0){for(;;){let Is=(Ds+Vs)/2;if(Is===Ds||Is===Vs)break;Number.isFinite(hs(Is))?Ds=Is:Vs=Is}[Es,Cs].includes(Ds)||(bs.splice(ws,0,Ds),Ts.splice(ws,0,hs(Ds)))}}Cs=Es,xs=Ss}ls=[],Cs=bs[0],xs=Ts[0],xs===0&&ls.push(Cs);for(let ws=1;ws<bs.length;ws++){let Es=bs[ws],Ss=Ts[ws];if(Ss===0){let Ds=!1;if(ws<bs.length-1){let Vs=bs[ws+1],Is=Ts[ws+1],Os=Cs,Ps=xs;if(xs*Is>0){for(let $s=0;$s<10;$s++)if(Cs=.1*Cs+.9*Es,Vs=.1*Vs+.9*Es,xs=hs(Cs),Is=hs(Vs),xs*Is<0){xs*Ps<0?(ls.push(ts.fzero(hs,[Os,Cs])),ls.push(Es)):(ls.includes(Es)||ls.push(Es),Es=Vs,Ss=Is),Ds=!0;break}}}!Ds&&!ls.includes(Es)&&ls.push(Es)}else if(Ss*xs<0)ls.push(ts.fzero(hs,[Cs,Es]));else if(xs!==0&&ws<bs.length-1){let Ds=bs[ws+1],Vs=Ts[ws+1];if((xs-Ss)*(Vs-Ss)>0&&(Ss>0&&xs>Ss||Ss<0&&xs<Ss)){let Is;xs>Ss?Is=hs:Is=Ps=>-hs(Ps);let Os=ts.fminbr(Is,[Cs,Ds],void 0,1e-10);if(Os.success){let Ps=Os.x,$s=hs(Ps);$s*xs<0?(ls.push(ts.fzero(hs,[Cs,Ps])),Es=Ps,Ss=$s):$s===0&&ls.push(Ps)}}}Cs=Es,xs=Ss}return ls=ls.filter(ws=>ws>=as&&ws<=os),{setValue:{allSolutions:ls.map(ws=>Context.fromAst(ws))}}}},rs.numberSolutions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allSolutions:{dependencyType:"stateVariable",variableName:"allSolutions"}}),definition({dependencyValues:ns}){return{setValue:{numberSolutions:ns.allSolutions.length}}}},rs.solutions={public:!0,shadowingInstructions:{createComponentOfType:"math"},isArray:!0,entryPrefixes:["solution"],returnArraySizeDependencies:()=>({numberSolutions:{dependencyType:"stateVariable",variableName:"numberSolutions"}}),returnArraySize({dependencyValues:ns}){return[ns.numberSolutions]},returnArrayDependenciesByKey(){return{globalDependencies:{allSolutions:{dependencyType:"stateVariable",variableName:"allSolutions"}}}},arrayDefinitionByKey({globalDependencyValues:ns}){let is={};for(let as=0;as<ns.__array_size[0];as++)is[as]=ns.allSolutions[as];return{setValue:{solutions:is}}}},rs}}Ms(SolveEquations,"componentType","solveEquations"),Ms(SolveEquations,"rendererType");class SolutionContainer extends Template{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.rendered,ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.rendered={returnDependencies:()=>({parentOpen:{dependencyType:"parentStateVariable",variableName:"open"}}),markStale:()=>({updateReplacements:!0}),definition({dependencyValues:rs}){return{setValue:{rendered:!!rs.parentOpen}}}},ts}static async calculateReplacementChanges({component:ts,componentInfoObjects:rs}){if(await ts.stateValues.rendered&&ts.replacements.length===0){let ns=(await this.createSerializedReplacements({component:ts,componentInfoObjects:rs})).replacements;return ns.length>0?[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:0,serializedReplacements:ns}]:[]}else return[]}}Ms(SolutionContainer,"componentType","_solutionContainer"),Ms(SolutionContainer,"stateVariableToEvaluateAfterReplacements","open");class SubsetOfRealsInput extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{addPoint:this.addPoint.bind(this),deletePoint:this.deletePoint.bind(this),movePoint:this.movePoint.bind(this),togglePoint:this.togglePoint.bind(this),toggleInterval:this.toggleInterval.bind(this),clear:this.clear.bind(this),setToR:this.setToR.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.xmin={createComponentOfType:"number",createStateVariable:"xmin",defaultValue:-10,public:!0,forRenderer:!0},ts.xmax={createComponentOfType:"number",createStateVariable:"xmax",defaultValue:10,public:!0,forRenderer:!0},ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:800,public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:300,public:!0,forRenderer:!0},ts.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},ts.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:.5,public:!0},ts.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:Context.fromAst("x"),public:!0},ts.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},ts.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},ts.bindValueTo={createComponentOfType:"subsetOfReals"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.subsetValue={public:!0,shadowingInstructions:{createComponentOfType:"subsetOfReals"},hasEssential:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["subsetValue"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"},variable:{dependencyType:"stateVariable",variableName:"variable"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:function({dependencyValues:rs}){return rs.bindValueTo?{setValue:{subsetValue:rs.bindValueTo.stateValues.subsetValue}}:{useEssentialOrDefaultValue:{subsetValue:{get defaultValue(){return parseValueIntoSubset({inputString:rs.prefill,format:rs.format,variable:rs.variable})}}}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:rs.subsetValue,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"subsetValue",value:rs.subsetValue}]}}},ts.pointsFromSubset={additionalStateVariablesDefined:["intervalsFromSubset"],returnDependencies:()=>({subsetValue:{dependencyType:"stateVariable",variableName:"subsetValue"}}),definition({dependencyValues:rs}){function ns(cs,ps){var hs;let ds=[],fs=[];if(cs.points&&(ds=cs.points),cs.intervals&&(fs=cs.intervals),ps.points){let ys=ds.map(gs=>gs.value);for(let gs of ps.points){let bs=ys.indexOf(gs.value);bs===-1?ds.push(gs):(hs=ds[bs]).inSubset||(hs.inSubset=gs.inSubset)}}return ps.intervals&&fs.push(...ps.intervals),{points:ds,intervals:fs}}function is(cs){if(cs===null||cs.isEmpty())return{};if(cs instanceof theModule.Union){let ps=[],ds=[];for(let fs of cs.subsets){let hs=is(fs);({points:ps,intervals:ds}=ns({points:ps,intervals:ds},hs))}return{points:ps,intervals:ds}}else{if(cs instanceof theModule.RealLine)return{intervals:[[-1/0,1/0]]};if(cs instanceof theModule.Singleton)return{points:[{value:cs.element,inSubset:!0}]};if(cs instanceof theModule.OpenInterval){let ps=[[cs.left,cs.right]],ds=[];return Number.isFinite(cs.left)&&ds.push({value:cs.left,inSubset:!1}),Number.isFinite(cs.right)&&ds.push({value:cs.right,inSubset:!1}),{intervals:ps,points:ds}}}return{}}let{points:as,intervals:os}=is(rs.subsetValue),ls=as||[],us=os||[];return ls.sort((cs,ps)=>cs.value-ps.value),us.sort((cs,ps)=>cs[0]-ps[0]),{setValue:{pointsFromSubset:ls,intervalsFromSubset:us}}}},ts.additionalPoints={defaultValue:[],hasEssential:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{additionalPoints:!0}}},inverseDefinition({desiredStateVariableValues:rs}){return rs.additionalPoints.every(Number.isFinite)?{success:!0,instructions:[{setEssentialValue:"additionalPoints",value:[...rs.additionalPoints].sort((ns,is)=>ns-is)}]}:{success:!1}}},ts.points={additionalStateVariablesDefined:[{variableName:"intervals",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({pointsFromSubset:{dependencyType:"stateVariable",variableName:"pointsFromSubset"},intervalsFromSubset:{dependencyType:"stateVariable",variableName:"intervalsFromSubset"},additionalPoints:{dependencyType:"stateVariable",variableName:"additionalPoints"}}),definition({dependencyValues:rs}){let ns=[...rs.pointsFromSubset],is=[...rs.intervalsFromSubset],as=[...rs.additionalPoints].sort((hs,ys)=>hs-ys),os=[],ls=[],us=0,cs=1/0,ps=0;as.length>0&&(cs=as[0]);let ds=is[0],fs=-1/0;ns.push({value:1/0,inSubset:!1});for(let hs of ns){let ys=!1;for(ds&&ds[0]<hs.value&&(ys=!0);cs<hs.value;)cs!==fs&&(os.push({value:cs,inSubset:ys,isAdditional:!0,additionalPointInd:ps}),ls.push({left:fs,right:cs,inSubset:ys}),fs=cs),ps++,cs=as[ps],cs===void 0&&(cs=1/0);os.push(hs),ls.push({left:fs,right:hs.value,inSubset:ys}),fs=hs.value,ys&&(us++,ds=is[us])}return os=os.slice(0,os.length-1),{setValue:{points:os,intervals:ls}}}},ts}async addPoint({value:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=await this.stateValues.dx,os=Math.round(Math.max(await this.stateValues.xmin,Math.min(await this.stateValues.xmax,ts))/as)*as,ls=[...await this.stateValues.pointsFromSubset],us=[...await this.stateValues.intervalsFromSubset],cs=[...await this.stateValues.additionalPoints];if(!cs.includes(os)&&!ls.map(ds=>ds.value).includes(os)){let ds=!1;for(let fs of us)if(fs[0]<os&&fs[1]>os){ds=!0;break}if(ds)return cs.push(os),await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:cs}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{addedPoint:os,intervalsFromSubset:us,pointsFromSubset:ls,additionalPoints:cs}}});{ls.push({value:os,inSubset:!0});let fs=await this.createUpdateInstructions({intervalsFromSubset:us,pointsFromSubset:ls,modifiedAdditionalPoints:!1,additionalPoints:cs});return await this.coreFunctions.performUpdate({updateInstructions:fs,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{addedPoint:os,intervalsFromSubset:us,pointsFromSubset:ls,additionalPoints:cs}}})}}this.coreFunctions.resolveAction({actionId:rs})}async deletePoint({pointInd:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=await this.stateValues.points[ts],os=[...await this.stateValues.additionalPoints],ls=[...await this.stateValues.pointsFromSubset],us=[...await this.stateValues.intervalsFromSubset];if(as.isAdditional)return os.splice(as.additionalPointInd,1),await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:os}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{deletedPoint:as.value,intervalsFromSubset:us,pointsFromSubset:ls,additionalPoints:os}}});{let cs=!1,ps=ls.map(ys=>ys.value).indexOf(as.value),ds=us.map(ys=>ys[1]).indexOf(as.value),fs=us.map(ys=>ys[0]).indexOf(as.value);if(ds!==-1)if(fs!==-1)us[ds]=[us[ds][0],us[fs][1]],us.splice(fs,1),ls.splice(ps,1);else{let ys=(await this.stateValues.points)[ts-1];ys&&ys.isAdditional?(us[ds]=[us[ds][0],ys.value],os.splice(as.additionalPointInd,1),cs=!0,ls.splice(ps,1,ys)):(us.splice(ds,1),ls.splice(ps,1),ys&&!ys.inSubset&&us.map(bs=>bs[1]).indexOf(ys.value)===-1&&(os.push(ys.value),cs=!0))}else if(fs!==-1){let ys=(await this.stateValues.points)[ts+1];ys&&ys.isAdditional?(us[fs]=[ys.value,us[fs][1]],os.splice(as.additionalPointInd,1),cs=!0,ls.splice(ps,1,ys)):(us.splice(fs,1),ls.splice(ps,1),ys&&!ys.inSubset&&us.map(bs=>bs[0]).indexOf(ys.value)===-1&&(os.push(ys.value),cs=!0))}else ls.splice(ps,1);let hs=await this.createUpdateInstructions({intervalsFromSubset:us,pointsFromSubset:ls,modifiedAdditionalPoints:cs,additionalPoints:os});return await this.coreFunctions.performUpdate({updateInstructions:hs,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{deletedPoint:as.value,intervalsFromSubset:us,pointsFromSubset:ls,additionalPoints:os}}})}}async createUpdateInstructions({intervalsFromSubset:ts,pointsFromSubset:rs,modifiedAdditionalPoints:ns,additionalPoints:is}){let as=await this.stateValues.dx,os=ps=>Math.round(ps/as)*as,ls=[];for(let ps of ts)ls.push(new theModule.OpenInterval(os(ps[0]),os(ps[1])));for(let ps of rs)ps.inSubset&&ls.push(new theModule.Singleton(os(ps.value)));let us;ls.length===0?us=new theModule.EmptySet:ls.length===1?us=ls[0]:us=new theModule.Union(ls);let cs=[{componentName:this.componentName,updateType:"updateValue",stateVariable:"subsetValue",value:us}];return ns&&cs.push({componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:is.map(os)}),cs}async movePoint({pointInd:ts,value:rs,transient:ns,actionId:is,sourceInformation:as={},skipRendererUpdate:os=!1}){let ls=await this.stateValues.dx,us=Math.round(Math.max(await this.stateValues.xmin,Math.min(await this.stateValues.xmax,rs))/ls)*ls,cs=await this.stateValues.points,ps=cs[ts],ds=cs[ts-1];ds&&(us=Math.max(us,ds.value+ls));let fs=cs[ts+1];fs&&(us=Math.min(us,fs.value-ls));let hs=[...await this.stateValues.additionalPoints],ys=[...await this.stateValues.pointsFromSubset],gs=[...await this.stateValues.intervalsFromSubset];if(ps.isAdditional)return hs[ps.additionalPointInd]=us,ns?await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:hs}],transient:!0,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:hs}],actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{movedPoint:us,intervalsFromSubset:gs,pointsFromSubset:ys,additionalPoints:hs}}});{let bs=ys.map(Cs=>Cs.value).indexOf(ps.value),vs=gs.map(Cs=>Cs[1]).indexOf(ps.value),Ns=gs.map(Cs=>Cs[0]).indexOf(ps.value);ys[bs]={value:us,inSubset:ys[bs].inSubset},vs!==-1&&(gs[vs]=[gs[vs][0],us]),Ns!==-1&&(gs[Ns]=[us,gs[Ns][1]]);let Ts=await this.createUpdateInstructions({intervalsFromSubset:gs,pointsFromSubset:ys,modifiedAdditionalPoints:!1});return ns?await this.coreFunctions.performUpdate({updateInstructions:Ts,transient:!0,actionId:is,sourceInformation:as,skipRendererUpdate:os}):await this.coreFunctions.performUpdate({updateInstructions:Ts,actionId:is,sourceInformation:as,skipRendererUpdate:os,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{movedPoint:us,intervalsFromSubset:gs,pointsFromSubset:ys,additionalPoints:hs}}})}}async togglePoint({pointInd:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=(await this.stateValues.points)[ts],os=[...await this.stateValues.pointsFromSubset],ls=[...await this.stateValues.intervalsFromSubset],us=[...await this.stateValues.additionalPoints],cs=!1;if(as.isAdditional)if(us.splice(as.additionalPointInd,1),cs=!0,as.inSubset){for(let[ds,fs]of ls.entries())if(fs[0]<as.value&&fs[1]>as.value){let hs=[[fs[0],as.value],[as.value,fs[1]]];ls.splice(ds,1,...hs);break}}else os.push({value:as.value,inSubset:!0});else{let ds=os.map(ys=>ys.value).indexOf(as.value),fs=ls.map(ys=>ys[1]).indexOf(as.value),hs=ls.map(ys=>ys[0]).indexOf(as.value);fs!==-1?hs!==-1?(ls[fs]=[ls[fs][0],ls[hs][1]],ls.splice(hs,1),os.splice(ds,1),us.push(as.value),cs=!0):os[ds]={value:as.value,inSubset:!as.inSubset}:hs!==-1?os[ds]={value:as.value,inSubset:!as.inSubset}:(os.splice(ds,1),us.push(as.value),cs=!0)}let ps=await this.createUpdateInstructions({intervalsFromSubset:ls,pointsFromSubset:os,modifiedAdditionalPoints:cs,additionalPoints:us});return await this.coreFunctions.performUpdate({updateInstructions:ps,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{toggledPoint:as.value,intervalsFromSubset:ls,pointsFromSubset:os,additionalPoints:us}}})}async toggleInterval({intervalInd:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){let as=(await this.stateValues.intervals)[ts],os=await this.stateValues.points,ls=os[ts-1],us=os[ts],cs=[...await this.stateValues.pointsFromSubset],ps=[...await this.stateValues.intervalsFromSubset],ds=[...await this.stateValues.additionalPoints],fs=!1;if(as.inSubset){let ys,gs;for(let[bs,vs]of ps.entries())if(vs[0]<=as.left&&vs[1]>=as.right){gs=vs,ys=bs;break}if(as.left===gs[0])if(as.right===gs[1]){if(ps.splice(ys,1),ls&&!ls.inSubset&&ps.map(vs=>vs[1]).indexOf(ls.value)===-1){let vs=cs.map(Ns=>Ns.value).indexOf(ls.value);cs.splice(vs,1),ds.push(ls.value),fs=!0}if(us&&!us.inSubset&&ps.map(vs=>vs[0]).indexOf(us.value)===-1){let vs=cs.map(Ns=>Ns.value).indexOf(us.value);cs.splice(vs,1),ds.push(us.value),fs=!0}}else{if(ps[ys]=[as.right,gs[1]],ls&&!ls.inSubset&&ps.map(vs=>vs[1]).indexOf(ls.value)===-1){let vs=cs.map(Ns=>Ns.value).indexOf(ls.value);cs.splice(vs,1),ds.push(ls.value),fs=!0}cs.push({value:us.value,inSubset:!0}),ds.splice(us.additionalPointInd,1),fs=!0}else if(as.right===gs[1]){if(ps[ys]=[gs[0],as.left],us&&!us.inSubset&&ps.map(vs=>vs[0]).indexOf(us.value)===-1){let vs=cs.map(Ns=>Ns.value).indexOf(us.value);cs.splice(vs,1),ds.push(us.value),fs=!0}cs.push({value:ls.value,inSubset:!0}),ds.splice(ls.additionalPointInd,1),fs=!0}else{let bs=[[gs[0],as.left],[as.right,gs[1]]];ps.splice(ys,1,...bs),cs.push({value:ls.value,inSubset:!0}),cs.push({value:us.value,inSubset:!0}),ds.splice(us.additionalPointInd,1),ds.splice(ls.additionalPointInd,1),fs=!0}}else{let ys=ps.map(bs=>bs[1]).indexOf(as.left),gs=ps.map(bs=>bs[0]).indexOf(as.right);if(ys===-1)gs===-1?(ps.push([as.left,as.right]),us&&us.isAdditional&&(ds.splice(us.additionalPointInd,1),fs=!0),ls&&ls.isAdditional&&(ds.splice(ls.additionalPointInd,1),fs=!0)):(us.inSubset?(ps[gs]=[as.left,ps[gs][1]],ds.push(us.value),fs=!0):ps.push([as.left,as.right]),ls&&ls.isAdditional&&(ds.splice(ls.additionalPointInd,1),fs=!0));else if(gs===-1)ls.inSubset?(ps[ys]=[ps[ys][0],as.right],ds.push(ls.value),fs=!0):ps.push([as.left,as.right]),us&&us.isAdditional&&(ds.splice(us.additionalPointInd,1),fs=!0);else if(ls.inSubset)if(us.inSubset){let bs=[ps[ys][0],ps[gs][1]];ps.splice(ys,2,bs),ds.push(ls.value),ds.push(us.value),fs=!0}else ps[ys]=[ps[ys][0],as.right],ds.push(ls.value),fs=!0;else us.inSubset?(ps[gs]=[as.left,ps[gs][1]],ds.push(us.value),fs=!0):ps.push([as.left,as.right])}let hs=await this.createUpdateInstructions({intervalsFromSubset:ps,pointsFromSubset:cs,modifiedAdditionalPoints:fs,additionalPoints:ds});return await this.coreFunctions.performUpdate({updateInstructions:hs,actionId:rs,sourceInformation:ns,skipRendererUpdate:is,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{toggledInterval:[as.left,as.right],intervalsFromSubset:ps,pointsFromSubset:cs,additionalPoints:ds}}})}async clear({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.createUpdateInstructions({intervalsFromSubset:[],pointsFromSubset:[],modifiedAdditionalPoints:!0,additionalPoints:[]});return await this.coreFunctions.performUpdate({updateInstructions:is,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{cleared:!0,intervalsFromSubset:[],pointsFromSubset:[],additionalPoints:[]}}})}async setToR({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=await this.createUpdateInstructions({intervalsFromSubset:[[-1/0,1/0]],pointsFromSubset:[],modifiedAdditionalPoints:!0,additionalPoints:[]});return await this.coreFunctions.performUpdate({updateInstructions:is,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{setToR:!0,intervalsFromSubset:[[-1/0,1/0]],pointsFromSubset:[],additionalPoints:[]}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(SubsetOfRealsInput,"componentType","subsetOfRealsInput"),Ms(SubsetOfRealsInput,"variableForPlainMacro","subsetValue"),Ms(SubsetOfRealsInput,"variableForPlainCopy","subsetValue");function parseValueIntoSubset({inputString:ss,format:ts,variable:rs}){if(!ss)return new theModule.EmptySet;let ns;if(ts==="latex")try{ns=Context.fromLatex(ss)}catch{return console.warn(`Invalid latex for subsetOfRealsInput: ${ss}`),new theModule.EmptySet}else if(ts==="text")try{ns=Context.fromText(ss)}catch{return console.warn(`Invalid text for subsetOfRealsInput: ${ss}`),new theModule.EmptySet}return buildSubsetFromMathExpression(ns,rs)}class SubsetOfReals extends MathComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.createIntervals.defaultValue=!0,ts.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:Context.fromAst("x")},ts.displayMode={createComponentOfType:"text",createStateVariable:"displayMode",defaultValue:"intervals",public:!0,toLowerCase:!0,validValues:["intervals","inequalities"]},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:ts,oldName:"unnormalizedValue",newName:"unnormalizedValuePreliminary"}),ts.value.shadowingInstructions.createComponentOfType="math",ts.haveSingleSubsetChild={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"]}}),definition({dependencyValues:rs,componentInfoObjects:ns}){return{setValue:{haveSingleSubsetChild:rs.mathChildren.length===1&&rs.mathChildren.filter(as=>ns.isInheritedComponentType({inheritedComponentType:as.componentType,baseComponentType:"subsetOfReals"})).length===1}}}},ts.subsetValue={stateVariablesDeterminingDependencies:["haveSingleSubsetChild"],returnDependencies({stateValues:rs}){let ns={haveSingleSubsetChild:{dependencyType:"stateVariable",variableName:"haveSingleSubsetChild"}};return rs.haveSingleSubsetChild?ns.subsetChild={dependencyType:"child",childGroups:["maths"],variableNames:["subsetValue"]}:(ns.unnormalizedValuePreliminary={dependencyType:"stateVariable",variableName:"unnormalizedValuePreliminary"},ns.variable={dependencyType:"stateVariable",variableName:"variable"}),ns},definition({dependencyValues:rs}){let ns;return rs.haveSingleSubsetChild?ns=rs.subsetChild[0].stateValues.subsetValue:ns=buildSubsetFromMathExpression(rs.unnormalizedValuePreliminary,rs.variable),{setValue:{subsetValue:ns}}},async inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns,stateValues:is}){return ns.haveSingleSubsetChild?{success:!0,instructions:[{setDependency:"subsetChild",desiredValue:rs.subsetValue,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"unnormalizedValuePreliminary",desiredValue:mathExpressionFromSubsetValue({subsetValue:rs.subsetValue,variable:ns.variable,displayMode:await is.displayMode})}]}}},ts.unnormalizedValue={returnDependencies:()=>({subsetValue:{dependencyType:"stateVariable",variableName:"subsetValue"},displayMode:{dependencyType:"stateVariable",variableName:"displayMode"},variable:{dependencyType:"stateVariable",variableName:"variable"}}),definition({dependencyValues:rs}){return{setValue:{unnormalizedValue:mathExpressionFromSubsetValue(rs)}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return{success:!0,instructions:[{setDependency:"subsetValue",desiredValue:buildSubsetFromMathExpression(rs.unnormalizedValue,ns.variable)}]}}},ts}}Ms(SubsetOfReals,"componentType","subsetOfReals"),Ms(SubsetOfReals,"rendererType","math"),Ms(SubsetOfReals,"primaryStateVariableForDefinition","subsetValue");function mathExpressionFromSubsetValue({subsetValue:ss,variable:ts,displayMode:rs="intervals"}){function ns(as){return as===null?"":rs==="intervals"?as.closedInterval?["interval",["tuple",as.left,as.right],["tuple",!0,!0]]:as.openClosedInterval?["interval",["tuple",as.left,as.right],["tuple",!1,!0]]:as.closedOpenInterval?["interval",["tuple",as.left,as.right],["tuple",!0,!1]]:as.toMathExpression().tree:as.closedInterval?["lts",["tuple",as.left,ts,as.right],["tuple",!1,!1]]:as.openClosedInterval?as.left===-1/0?["le",ts,as.right]:["lts",["tuple",as.left,ts,as.right],["tuple",!0,!1]]:as.closedOpenInterval?as.right===1/0?["ge",ts,as.left]:["lts",["tuple",as.left,ts,as.right],["tuple",!1,!0]]:as instanceof theModule.OpenInterval?as.left===-1/0?["<",ts,as.right]:as.right===1/0?[">",ts,as.left]:["lts",["tuple",as.left,ts,as.right],["tuple",!0,!0]]:as instanceof theModule.Singleton?["=",ts,as.element]:as.isEmpty()?["in",ts,""]:as instanceof theModule.RealLine?["in",ts,"R"]:null}let is;if(ss instanceof theModule.Union){let as=ss.subsets.filter(us=>us instanceof theModule.Singleton),os=ss.subsets.filter(us=>us instanceof theModule.OpenInterval);for(let us=0;us<as.length;us++){let cs=as[us].element;for(let ps=0;ps<os.length;ps++){let ds=os[ps];cs===ds.left?(ds.openClosedInterval?(ds.closedInterval=!0,delete ds.openClosedInterval):(ds={left:ds.left,right:ds.right,closedOpenInterval:!0},os.splice(ps,1,ds)),as.splice(us,1),us--):cs===ds.right&&(ds.closedOpenInterval?(ds.closedInterval=!0,delete ds.closedOpenInterval):(ds={left:ds.left,right:ds.right,openClosedInterval:!0},os.splice(ps,1,ds)),as.splice(us,1),us--)}}let ls=[...os,...as].sort((us,cs)=>(us.left===void 0?us.element:us.left)-(cs.left===void 0?cs.element:cs.left)).map(us=>ns(us));ls.length>1?rs==="intervals"?is=Context.fromAst(["union",...ls]):is=Context.fromAst(["or",...ls]):is=Context.fromAst(ls[0])}else is=Context.fromAst(ns(ss));return is}class Split extends CompositeComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"text",toLowerCase:!0,validValues:["text"]},ts.splitBy={createComponentOfType:"text",createStateVariable:"splitBy",defaultValue:"letter",toLowerCase:!0,validValues:["letter","word","comma"]},ts}static returnSugarInstructions(){let ts=[];function rs({matchedChildren:ns,componentAttributes:is}){let as=is.type;return["text"].includes(as)||(as="text"),{success:!0,newChildren:[{componentType:as,children:ns}]}}return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.originalValue={returnDependencies:()=>({child:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition({dependencyValues:rs}){return rs.child.length>0?{setValue:{originalValue:rs.child[0].stateValues.value}}:{setValue:{originalValue:null}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.child.length>0?{success:!0,instructions:[{setDependency:"child",desiredValue:rs.originalValue,childIndex:0,variableIndex:0}]}:{success:!1}}},ts.splitValues={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},originalValue:{dependencyType:"stateVariable",variableName:"originalValue"},splitBy:{dependencyType:"stateVariable",variableName:"splitBy"}}),definition({dependencyValues:rs}){if(rs.originalValue===null)return{setValue:{splitValues:[]}};let ns=[];return rs.splitBy==="letter"?ns=[...rs.originalValue]:rs.splitBy==="word"?ns=rs.originalValue.split(/\s+/):rs.splitBy==="comma"?ns=rs.originalValue.split(/\s*,\s*/):ns=[rs.originalValue],{setValue:{splitValues:ns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({splitValues:{dependencyType:"stateVariable",variableName:"splitValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs}){var os;let ns=(os=ts.attributes.newNamespace)==null?void 0:os.primitive,is={componentType:"textList",state:{textsShadow:await ts.stateValues.splitValues},downstreamDependencies:{[ts.componentName]:[{dependencyType:"referenceShadow",compositeName:ts.componentName,propVariable:"splitValues"}]}};return{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:[is],parentName:ts.componentName,parentCreatesNewNamespace:ns,componentInfoObjects:rs}).serializedComponents}}}Ms(Split,"componentType","split"),Ms(Split,"assignNamesToReplacements",!0),Ms(Split,"stateVariableToEvaluateAfterReplacements","readyToExpandWhenResolved");class BestFitLine extends Line{static createAttributesObject(){let ts=super.createAttributesObject();return delete ts.draggable,delete ts.equation,delete ts.through,delete ts.slope,ts.points={createComponentOfType:"_pointListComponent"},ts}static returnSugarInstructions(){return[]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.draggable={shadowingInstructions:{createComponentOfType:"boolean"},public:!0,forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{draggable:!1}})},ts.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({}),definition:()=>({setValue:{nDimensions:2}})},delete ts.nPointsPrescribed,delete ts.basedOnSlope,delete ts.dForSlope,delete ts.essentialPoint1x,delete ts.essentialPoint1y,delete ts.equationIdentity,delete ts.equation.stateVariablesDeterminingDependencies,ts.equation.returnDependencies=()=>({points:{dependencyType:"attributeComponent",attributeName:"points",variableNames:["points","nDimensions"]},variables:{dependencyType:"stateVariable",variableName:"variables"}}),ts.equation.definition=function({dependencyValues:rs}){if(!rs.points||rs.points.stateValues.nDimensions<2||rs.points.stateValues.points.length<1){let gs=Context.fromAst("");return{setValue:{equation:gs,coeff0:gs,coeffvar1:gs,coeffvar2:gs}}}let ns=[],is=[];for(let gs of rs.points.stateValues.points){let bs=gs.slice(0,2).map(vs=>vs&&vs.evaluate_to_constant());bs.every(Number.isFinite)&&(ns.push([1,bs[0]]),is.push([bs[1]]))}if(ns.length===0){let gs=Context.fromAst("");return{setValue:{equation:gs,coeff0:gs,coeffvar1:gs,coeffvar2:gs}}}ns=Context.math.matrix(ns),is=Context.math.matrix(is);let as=Context.math.transpose(ns),os=Context.math.multiply(as,is),ls=Context.math.multiply(as,ns),us=Context.math.lusolve(ls,os),cs=Context.fromAst(Context.math.subset(us,Context.math.index(0,0))),ps=Context.fromAst(Context.math.subset(us,Context.math.index(1,0))),ds=Context.fromAst(-1),fs=rs.variables,hs=Context.fromAst(["+",["*","a","x"],"c"]).substitute({a:ps,c:cs,x:fs[0],y:fs[1]}).simplify();return{setValue:{equation:Context.fromAst(["=","y","r"]).substitute({r:hs}),coeff0:cs,coeffvar1:ps,coeffvar2:ds}}},delete ts.equation.inverseDefinition,delete ts.points.stateVariablesDeterminingDependencies,ts.points.returnArrayDependenciesByKey=function(){return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},ts}}Ms(BestFitLine,"componentType","bestFitLine"),Ms(BestFitLine,"rendererType","line");class RegionBetweenCurveXAxis extends GraphicalComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.boundaryValues={createComponentOfType:"numberList",createStateVariable:"boundaryValues",defaultValue:[0,1],forRenderer:!0,public:!0},ts.function={createComponentOfType:"function"},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"},document:{dependencyType:"ancestor",componentType:"document",variableNames:["theme"]}}),definition:function({dependencyValues:rs}){var is;let ns;return((is=rs.document)==null?void 0:is.stateValues.theme)==="dark"?ns=rs.selectedStyle.fillColorWordDarkMode:ns=rs.selectedStyle.fillColorWord,{setValue:{styleDescription:ns}}}},ts.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:rs}){return{setValue:{styleDescriptionWithNoun:rs.styleDescription+" region"}}}},ts.function={additionalStateVariablesDefined:[{variableName:"haveFunction",forRenderer:!0},{variableName:"fDefinition",forRenderer:!0}],returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["numericalfs","nInputs","nOutputs","fDefinition"]}}),definition({dependencyValues:rs}){return rs.functionAttr===null||rs.functionAttr.stateValues.nInputs!==1||rs.functionAttr.stateValues.nOutputs!==1?{setValue:{function:()=>NaN,haveFunction:!1,fDefinition:{}}}:{setValue:{function:rs.functionAttr.stateValues.numericalfs[0],haveFunction:!0,fDefinition:rs.functionAttr.stateValues.fDefinition}}}},ts}}Ms(RegionBetweenCurveXAxis,"componentType","regionBetweenCurveXAxis");class RegionHalfPlane extends GraphicalComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.horizontal={createComponentOfType:"boolean",createStateVariable:"horizontal",defaultValue:!0,public:!0},ts.boundaryValue={createComponentOfType:"number",createStateVariable:"boundaryValue",defaultValue:0,public:!0},ts.greaterThan={createComponentOfType:"boolean",createStateVariable:"greaterThan",defaultValue:!0,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.nearestPoint={returnDependencies:()=>({horizontal:{dependencyType:"stateVariable",variableName:"horizontal"},boundaryValue:{dependencyType:"stateVariable",variableName:"boundaryValue"},greaterThan:{dependencyType:"stateVariable",variableName:"greaterThan"}}),definition({dependencyValues:rs}){let ns=rs.boundaryValue;return{setValue:{nearestPoint:function({variables:is,scales:as}){if(!Number.isFinite(ns))return{};if(rs.horizontal)if(rs.greaterThan)if(is.x1<ns){let os=Object.assign({},is);return os.x1=ns,os}else return{};else if(is.x1>ns){let os=Object.assign({},is);return os.x1=ns,os}else return{};else if(rs.greaterThan)if(is.x2<ns){let os=Object.assign({},is);return os.x2=ns,os}else return{};else if(is.x2>ns){let os=Object.assign({},is);return os.x2=ns,os}else return{}}}}}},ts}}Ms(RegionHalfPlane,"componentType","regionHalfPlane"),Ms(RegionHalfPlane,"rendererType");class CodeEditor extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateImmediateValue:this.updateImmediateValue.bind(this),updateValue:this.updateValue.bind(this),updateComponents:this.updateComponents.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(){let ts=super.createAttributesObject();return ts.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},ts.bindValueTo={createComponentOfType:"text"},ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:600,isAbsolute:!0},forRenderer:!0,public:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:400,isAbsolute:!0},forRenderer:!0,public:!0},ts.viewerRatio={createComponentOfType:"number",createStateVariable:"viewerRatio",defaultValue:.5,forRenderer:!0,public:!0},ts.showResults={createComponentOfType:"boolean",createStateVariable:"showResults",defaultValue:!1,forRenderer:!0,public:!0},ts.renderedName={createPrimitiveOfType:"string"},ts.staticName={createPrimitiveOfType:"string"},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentAttributes:is}){if(ns.length>0)return{success:!1};let as={componentType:"codeViewer",children:[{componentType:"renderDoenetML"}]},os=[as];if(is.renderedName&&(as.attributes={renderedName:{primitive:is.renderedName}},as.children[0].props={name:is.renderedName}),is.staticName){let ls={componentType:"codeViewer",attributes:{hide:{component:{componentType:"boolean",state:{value:!0}}}},children:[{componentType:"renderDoenetML",props:{name:is.staticName}}]};os.push(ls)}return{success:!0,newChildren:os}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"codeViewers",componentTypes:["codeViewer"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.viewerHeight={returnDependencies:()=>({height:{dependencyType:"stateVariable",variableName:"height"},viewerRatio:{dependencyType:"stateVariable",variableName:"viewerRatio"}}),definition:function({dependencyValues:rs}){if(!rs.height.isAbsolute)throw Error("Codeeditor relative height not implemented");return{setValue:{viewerHeight:{size:rs.height.size*rs.viewerRatio,isAbsolute:!0}}}}},ts.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:rs}){return rs.bindValueTo?{setValue:{value:rs.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:rs.prefill}}}},inverseDefinition:function({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:rs.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:rs.value}]}}},ts.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs,changes:ns,justUpdatedForNewComponent:is}){return ns.value&&!is?{setValue:{immediateValue:rs.value},makeEssential:{immediateValue:!0}}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:rs.value}}}},inverseDefinition:function({desiredStateVariableValues:rs,initialChange:ns,shadowedVariable:is}){let as=[{setEssentialValue:"immediateValue",value:rs.immediateValue}];return ns||is||as.push({setDependency:"value",desiredValue:rs.immediateValue}),{success:!0,instructions:as}}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:rs}){return{setValue:{text:rs.value}}}},ts.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"text"}})},ts.viewerChild={returnDependencies:()=>({viewerChild:{dependencyType:"child",childGroups:["codeViewers"]}}),definition({dependencyValues:rs}){return rs.viewerChild.length>0?{setValue:{viewerChild:rs.viewerChild}}:{setValue:{viewerChild:null}}}},ts}updateImmediateValue({text:ts,actionId:rs,sourceInformation:ns={},skipRendererUpdate:is=!1}){if(this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:rs});else return this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:ts},{updateType:"setComponentNeedingUpdateValue",componentName:this.componentName}],actionId:rs,sourceInformation:ns,skipRendererUpdate:is})}updateValue({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){if(!this.stateValues.disabled&&this.stateValues.immediateValue!==this.stateValues.value){let is=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"},{updateType:"unsetComponentNeedingUpdateValue"}],as={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue}};return this.stateValues.answerAncestor&&(as.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.performUpdate({updateInstructions:is,actionId:ts,sourceInformation:rs,skipRendererUpdate:!0,event:as}).then(()=>{this.coreFunctions.triggerChainedActions({componentName:this.componentName,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns}),this.attributes.staticName&&this.definingChildren.length===2&&this.definingChildren[1].componentType==="codeViewer"&&this.coreFunctions.performAction({componentName:this.definingChildren[1].componentName,actionName:"updateComponents",args:{sourceInformation:rs,skipRendererUpdate:ns}})})}else this.coreFunctions.resolveAction({actionId:ts})}async updateComponents(){this.definingChildren.length===1&&this.definingChildren[0].componentType==="codeViewer"&&await this.coreFunctions.performAction({componentName:this.definingChildren[0].componentName,actionName:"updateComponents"})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(CodeEditor,"componentType","codeEditor"),Ms(CodeEditor,"variableForPlainMacro","value"),Ms(CodeEditor,"variableForPlainCopy","value"),Ms(CodeEditor,"renderChildren",!0),Ms(CodeEditor,"processWhenJustUpdatedForNewComponent",!0);class CodeViewer extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateComponents:this.updateComponents.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.codeSource={createTargetComponentNames:!0},ts.width={createComponentOfType:"_componentSize"},ts.height={createComponentOfType:"_componentSize"},ts.hasCodeEditorParent={createComponentOfType:"boolean"},ts.renderedName={createPrimitiveOfType:"string"},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns,componentAttributes:is}){if(ns.length>0)return{success:!1};let as={componentType:"renderDoenetML"};return is.codeSource&&(as.attributes={codeSource:{targetComponentNames:is.codeSource}}),is.renderedName&&(as.props={name:is.renderedName}),{success:!0,newChildren:[as]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"children",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.hasCodeEditorParent={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({codeEditorParent:{dependencyType:"parentIdentity",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:rs}){return rs.codeEditorParent?{setValue:{hasCodeEditorParent:!0}}:{setValue:{hasCodeEditorParent:!1}}}},ts.width={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,forRenderer:!0,defaultValue:{size:600,isAbsolute:!0},returnDependencies:()=>({widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},parentWidth:{dependencyType:"parentStateVariable",variableName:"width",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:rs}){return rs.widthAttr?{setValue:{width:rs.widthAttr.stateValues.componentSize}}:rs.parentWidth?{setValue:{width:rs.parentWidth}}:{useEssentialOrDefaultValue:{width:!0}}}},ts.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,forRenderer:!0,defaultValue:{size:400,isAbsolute:!0},returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},parentViewerHeight:{dependencyType:"parentStateVariable",variableName:"viewerHeight",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:rs}){return rs.heightAttr?{setValue:{height:rs.heightAttr.stateValues.componentSize}}:rs.parentViewerHeight?{setValue:{height:rs.parentViewerHeight}}:{useEssentialOrDefaultValue:{height:!0}}}},ts.codeSourceComponentName={returnDependencies:()=>({codeSource:{dependencyType:"attributeTargetComponentNames",attributeName:"codeSource"}}),definition({dependencyValues:rs}){var is;let ns;return((is=rs.codeSource)==null?void 0:is.length)===1?ns=rs.codeSource[0].absoluteName:ns=null,{setValue:{codeSourceComponentName:ns}}}},ts.codeSource={returnDependencies:()=>({codeSourceComponentName:{dependencyType:"stateVariable",variableName:"codeSourceComponentName"},codeEditorParent:{dependencyType:"parentIdentity",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:rs}){return rs.codeSourceComponentName?{setValue:{codeSource:rs.codeSourceComponentName}}:rs.codeEditorParent?{setValue:{codeSource:rs.codeEditorParent.componentName}}:{setValue:{codeSource:null}}}},ts}async updateComponents(){this.definingChildren.length===1&&this.definingChildren[0].componentType==="renderDoenetML"&&await this.coreFunctions.performAction({componentName:this.definingChildren[0].componentName,actionName:"updateComponents"})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(CodeViewer,"componentType","codeViewer"),Ms(CodeViewer,"renderChildren",!0),Ms(CodeViewer,"includeBlankStringChildren",!0);class RenderDoenetML extends CompositeComponent{constructor(ts){super(ts),Object.assign(this.actions,{updateComponents:this.updateComponents.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.assignNamesSkip={createPrimitiveOfType:"number"},ts.codeSource={createTargetComponentNames:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.codeSourceComponentName={returnDependencies:()=>({codeSource:{dependencyType:"attributeTargetComponentNames",attributeName:"codeSource"}}),definition({dependencyValues:rs}){var is;let ns;return((is=rs.codeSource)==null?void 0:is.length)===1?ns=rs.codeSource[0].absoluteName:ns=null,{setValue:{codeSourceComponentName:ns}}}},ts.codeSource={returnDependencies:()=>({codeSourceComponentName:{dependencyType:"stateVariable",variableName:"codeSourceComponentName"},parentCodeSource:{dependencyType:"parentStateVariable",parentComponentType:"codeViewer",variableName:"codeSource"}}),definition:function({dependencyValues:rs}){return rs.codeSourceComponentName?{setValue:{codeSource:rs.codeSourceComponentName}}:rs.parentCodeSource?{setValue:{codeSource:rs.parentCodeSource}}:{setValue:{codeSource:null}}}},ts.doenetML={stateVariablesDeterminingDependencies:["codeSource"],returnDependencies:({stateValues:rs})=>({doenetML:{dependencyType:"stateVariable",componentName:rs.codeSource,variableName:"text",variablesOptional:!0}}),definition({dependencyValues:rs}){let ns="";return rs.doenetML&&(ns=rs.doenetML,typeof ns!="string"&&(ns="")),{setValue:{doenetML:ns}}}},ts.readyToExpandWhenResolved={returnDependencies:()=>({doenetML:{dependencyType:"stateVariable",variableName:"doenetML"}}),definition(){return{setValue:{readyToExpandWhenResolved:!0}}}},ts.triggerUpdates={defaultValue:!0,hasEssential:!0,returnDependencies:()=>({}),markStale(){return{updateReplacements:!0}},definition(){return{useEssentialOrDefaultValue:{triggerUpdates:{}}}},inverseDefinition({desiredStateVariableValues:rs}){return{success:!0,instructions:[{setEssentialValue:"triggerUpdates",value:rs.triggerUpdates}]}}},ts.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},ts.generatedVariantInfo={returnDependencies:({sharedParameters:rs,componentInfoObjects:ns})=>({variantSeed:{dependencyType:"value",value:rs.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(ns.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:rs,componentName:ns}){let is={seed:rs.variantSeed,meta:{createdBy:ns}},as=is.subvariants=[];for(let os of rs.variantDescendants)os.stateValues.isVariantComponent?as.push(os.stateValues.generatedVariantInfo):os.stateValues.generatedVariantInfo&&as.push(...os.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:is}}}},ts}static async createSerializedReplacements({component:ts,componentInfoObjects:rs,flags:ns,workspace:is}){let as=[],os=(await ts.stateValues.doenetML).trim();is.previousDoenetML=os;try{as=(await expandDoenetMLsToFullSerializedComponents({cids:[],doenetMLs:[os],componentInfoObjects:rs,flags:ns})).fullSerializedComponents[0]}catch(cs){return console.warn("error in user entered doenetML"),console.warn(cs.message),{replacements:[]}}let ls=ts.componentName.split("/").map(cs=>({namespace:cs,componentCounts:{},namesUsed:{}}));return createComponentNames({serializedComponents:as,componentInfoObjects:rs,namespaceStack:ls}),restrictTNamesToNamespace({components:as,namespace:`${ts.componentName}/`}),{replacements:processAssignNames({assignNames:ts.doenetAttributes.assignNames,serializedComponents:as,parentName:ts.componentName,parentCreatesNewNamespace:!0,componentInfoObjects:rs,originalNamesAreConsistent:!0}).serializedComponents}}static async calculateReplacementChanges({component:ts,componentChanges:rs,componentInfoObjects:ns,flags:is,workspace:as}){let os=(await ts.stateValues.doenetML).trim();if(as.previousDoenetML===os)return[];as.previousDoenetML=os;let ls=(await this.createSerializedReplacements({component:ts,componentInfoObjects:ns,flags:is,workspace:as})).replacements;return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:ts.replacements.length,serializedReplacements:ls}]}static setUpVariant({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns}){setUpVariantSeedAndRng({serializedComponent:ts,sharedParameters:rs,descendantVariantComponents:ns,useSubpartVariantRng:!0})}async updateComponents({actionId:ts,sourceInformation:rs={},skipRendererUpdate:ns=!1}){let is=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"triggerUpdates",value:!0}];await this.coreFunctions.performUpdate({updateInstructions:is,actionId:ts,sourceInformation:rs,skipRendererUpdate:ns})}}Ms(RenderDoenetML,"componentType","renderDoenetML"),Ms(RenderDoenetML,"assignNamesToReplacements",!0),Ms(RenderDoenetML,"createsVariants",!0),Ms(RenderDoenetML,"stateVariableToEvaluateAfterReplacements","triggerUpdates");class HasSameFactoring extends BooleanComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:Context.fromAst("x")},ts.restrictDivision={createComponentOfType:"boolean",createStateVariable:"restrictDivision",defaultValue:!1},ts.monomialFactorMustMatch={createComponentOfType:"boolean",createStateVariable:"monomialFactorMustMatch",defaultValue:!1},ts.allowOnlySignDifferences={createComponentOfType:"boolean",createStateVariable:"allowOnlySignDifferences",defaultValue:!1},ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.parsedExpression,delete ts.mathChildrenByCode,ts.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},variable:{dependencyType:"stateVariable",variableName:"variable"},restrictDivision:{dependencyType:"stateVariable",variableName:"restrictDivision"},monomialFactorMustMatch:{dependencyType:"stateVariable",variableName:"monomialFactorMustMatch"},allowOnlySignDifferences:{dependencyType:"stateVariable",variableName:"allowOnlySignDifferences"}}),definition:function({dependencyValues:rs}){if(rs.mathChildren.length!==2)return{setValue:{value:!1}};let ns=rs.mathChildren[0].stateValues.value,is=rs.mathChildren[1].stateValues.value;if(checkEquality({object1:ns,object2:is,isUnordered:!1,partialMatches:!1,symbolicEquality:!1,allowedErrorInNumbers:rs.allowedErrorInNumbers,includeErrorInNumberExponents:rs.includeErrorInNumberExponents,allowedErrorIsAbsolute:rs.allowedErrorIsAbsolute,nSignErrorsMatched:rs.nSignErrorsMatched}).fraction_equal!==1)return{setValue:{value:!1}};if(Array.isArray(ns.tree)&&ns.tree[0]==="-"&&(ns=Context.fromAst(ns.tree[1])),Array.isArray(is.tree)&&is.tree[0]==="-"&&(is=Context.fromAst(is.tree[1])),!rs.restrictDivision&&!rs.monomialFactorMustMatch&&!rs.allowOnlySignDifferences&&(Array.isArray(ns.tree)&&ns.tree[0]==="/"&&Context.fromAst(ns.tree[2]).variables().length===0&&(ns=Context.fromAst(ns.tree[1]),Array.isArray(ns.tree)&&ns.tree[0]==="-"&&(ns=Context.fromAst(ns.tree[1]))),Array.isArray(is.tree)&&is.tree[0]==="/"&&Context.fromAst(is.tree[2]).variables().length===0&&(is=Context.fromAst(is.tree[1]),Array.isArray(is.tree)&&is.tree[0]==="-"&&(is=Context.fromAst(is.tree[1])))),ns=Context.fromAst(expandPositiveIntegerPowers(ns.tree)),is=Context.fromAst(expandPositiveIntegerPowers(is.tree)),Array.isArray(ns.tree)&&ns.tree[0]==="*"){if(!(Array.isArray(is.tree)&&is.tree[0]==="*"))return{setValue:{value:!1}}}else return Array.isArray(is.tree)&&is.tree[0]==="*"?{setValue:{value:!1}}:{setValue:{value:!0}};if(rs.monomialFactorMustMatch||rs.allowOnlySignDifferences){let ys=findMonomialFromFactors(ns.tree.slice(1)),gs=findMonomialFromFactors(is.tree.slice(1));if(!ys.equals(gs)){let bs=Context.fromAst(["-",gs.tree]);if(!ys.equals(bs))return{setValue:{value:!1}}}}if(rs.allowOnlySignDifferences){let ys=normalizeFactorSigns(ns),gs=normalizeFactorSigns(is);return{setValue:{value:ys.equalsViaSyntax(gs,{allowed_error_in_numbers:rs.allowedErrorInNumbers,include_error_in_number_exponents:rs.includeErrorInNumberExponents,allowed_error_is_absolute:rs.allowedErrorIsAbsolute})}}}let os=ns.tree.slice(1).filter(ys=>Context.fromAst(ys).variables().length>0),ls=is.tree.slice(1).filter(ys=>Context.fromAst(ys).variables().length>0);if(os.length!==ls.length)return{setValue:{value:!1}};let us=0,cs=0,ps=0,ds=0,fs=rs.variable.subscripts_to_strings().tree;for(let ys of os){let gs=Context.fromAst(ys).subscripts_to_strings().derivative(fs).derivative(fs).simplify();if(gs.tree===0)cs++;else if(gs.variables().length===0)us++;else return{setValue:{value:!1}}}for(let ys of ls){let gs=Context.fromAst(ys).subscripts_to_strings().derivative(fs).derivative(fs).simplify();if(gs.tree===0)ds++;else if(gs.variables().length===0)ps++;else return{setValue:{value:!1}}}return{setValue:{value:cs===ds&&us===ps}}}},ts}}Ms(HasSameFactoring,"componentType","hasSameFactoring"),Ms(HasSameFactoring,"rendererType","boolean");function expandPositiveIntegerPowers(ss){if(!Array.isArray(ss))return ss;if(ss[0]==="^"){let ts=ss[1],rs=ss[2];Number.isInteger(rs)&&rs>0&&(ss=["*",...Array(rs).fill(ts)])}if(ss[0]==="*"){let ts=ss;ss=["*"];for(let rs of ts.slice(1))if(Array.isArray(rs)&&rs[0]==="^"){let ns=rs[1],is=rs[2];Number.isInteger(is)&&is>0?ss.push(...Array(is).fill(ns)):ss.push(rs)}else ss.push(rs)}return ss}function findMonomialFromFactors(ss){let ts=[],rs=!1;for(let is of ss)if(typeof is=="string"||Context.fromAst(is).variables().length===0){if(!rs){if(ts.length>0)return Context.fromAst("");rs=!0}ts.push(is)}else rs=!1;let ns;return ts.length===0?ns=1:ts.length===1?ns=ts[0]:ns=["*",...ts],Context.fromAst(ns)}function normalizeFactorSigns(ss){let ts=ss.simplify().tree;if(ts[0]==="-"&&(ts=ts[1]),ts[0]!=="*")return Context.fromAst(ts).simplify();let rs=["*"];for(let ns of ts.slice(1))if(typeof ns=="number")ns<0?rs.push(-ns):rs.push(ns);else if(!Array.isArray(ns))rs.push(ns);else if(ns[0]==="-")rs.push(ns[1]);else if(ns[0]==="+"){let is=!1,as=ns[1];if(typeof as=="number")as<0&&(is=!0);else if(Array.isArray(as)){if(as[0]==="-")is=!0;else if(as[0]==="*"){let os=as[1];typeof os=="number"?os<0&&(is=!0):Array.isArray(os)&&os[0]==="-"&&(is=!0)}}is?rs.push(Context.fromAst(["-",ns]).simplify().tree):rs.push(ns)}else rs.push(ns);return Context.fromAst(rs).simplify()}class DataFrame extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.source={createComponentOfType:"text",createStateVariable:"source",required:!0,public:!0,forRenderer:!0},ts.hasHeader={createComponentOfType:"boolean",createStateVariable:"hasHeader",defaultValue:!0,public:!0},ts.columnTypes={createComponentOfType:"textList",createStateVariable:"columnTypesPrelim",defaultValue:[]},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.cid={forRenderer:!0,returnDependencies:()=>({source:{dependencyType:"stateVariable",variableName:"source"}}),definition:function({dependencyValues:rs}){if(!rs.source||rs.source.substring(0,7).toLowerCase()!=="doenet:")return{setValue:{cid:null}};let ns=null,is=rs.source.match(/[:&]cid=([^&]+)/i);return is&&(ns=is[1]),{setValue:{cid:ns}}}},ts.dataFrame={stateVariablesDeterminingDependencies:["cid","source"],additionalStateVariablesDefined:[{variableName:"numRows",public:!0,shadowingInstructions:{createComponentOfType:"integer"}},{variableName:"numColumns",public:!0,shadowingInstructions:{createComponentOfType:"integer"}},{variableName:"columnTypes",public:!0,shadowingInstructions:{createComponentOfType:"textList"}},{variableName:"columnNames",public:!0,shadowingInstructions:{createComponentOfType:"textList"}}],returnDependencies:({stateValues:rs})=>({fileContents:{dependencyType:"file",cid:rs.cid,uri:rs.source,fileType:"csv"},hasHeader:{dependencyType:"stateVariable",variableName:"hasHeader"},columnTypesPrelim:{dependencyType:"stateVariable",variableName:"columnTypesPrelim"}}),definition:function({dependencyValues:rs,componentName:ns}){var fs,hs;let is=[],as=[],os=rs.fileContents.trim().split(`
`).map(ys=>ys.trim().split(",").map(gs=>gs.trim())),ls=(fs=os[0])==null?void 0:fs.length,us=!1;for(let ys of os.slice(1))if(ys.length!==ls){us=!0;break}if(us)return console.warn(`Data has invalid shape.  Rows has inconsistent lengths. Found in componentName :${ns}`),{setValue:{dataFrame:null,numRows:ds,numColumns:ls,columnTypes:is,columnNames:as}};let cs={},ps=[];if(rs.hasHeader?(cs.columnNames=os[0].map(ys=>(['"',"'"].includes(ys[0])&&ys[ys.length-1]===ys[0]&&(ys=ys.substring(1,ys.length-1)),ys)),ps=os.slice(1)):(cs.columnNames=[...Array(ls).keys()].map(ys=>`col${ys+1}`),ps=os),[...new Set(cs.columnNames)].length<cs.columnNames)return console.warn(`Data has duplicate column names.  Found in componentName :${ns}`),{setValue:{dataFrame:null,numRows:ds,numColumns:ls,columnTypes:is,columnNames:as}};if(cs.columnNames.includes(""))return console.warn(`Data is missing a column name.  Found in componentName :${ns}`),{setValue:{dataFrame:null,numRows:ds,numColumns:ls,columnTypes:is,columnNames:as}};let ds=ps.length;cs.shape=[ds,ls];for(let ys=0;ys<ls;ys++){let gs=(hs=rs.columnTypesPrelim[ys])==null?void 0:hs.toLowerCase();if(["number","string"].includes(gs)||(gs="auto"),gs==="auto"){let bs=!1;for(let vs=0;vs<ds;vs++){let Ns=ps[vs][ys];if(Ns!==""){let Ts=Number(Ns);if(!Number.isFinite(Ts)){bs=!0;break}}}bs?gs="string":gs="number"}if(gs==="number")for(let bs=0;bs<ds;bs++)ps[bs][ys]===""?ps[bs][ys]=null:ps[bs][ys]=Number(ps[bs][ys]);else for(let bs=0;bs<ds;bs++){let vs=ps[bs][ys];['"',"'"].includes(vs[0])&&vs[vs.length-1]===vs[0]&&(vs=vs.substring(1,vs.length-1)),ps[bs][ys]=vs}is.push(gs)}return cs.data=ps,cs.columnTypes=is,{setValue:{dataFrame:cs,numRows:ds,numColumns:ls,columnTypes:is,columnNames:cs.columnNames}}}},ts.means={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["mean"],returnArraySizeDependencies:()=>({numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:rs}){return[rs.numColumns]},returnArrayDependenciesByKey(){return{globalDependencies:{dataFrame:{dependencyType:"stateVariable",variableName:"dataFrame"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},columnTypes:{dependencyType:"stateVariable",variableName:"columnTypes"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arrayKeys:ns}){let is={};for(let as of ns){let os=0,ls=0;if(rs.columnTypes[as]==="number"){for(let us=0;us<rs.numRows;us++){let cs=rs.dataFrame.data[us][as];cs!==null&&(os+=cs,ls++)}os/=ls}else os=NaN;is[as]=os}return{setValue:{means:is}}}},ts}}Ms(DataFrame,"componentType","dataFrame"),Ms(DataFrame,"rendererType");class SummaryStatistics extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.source={createTargetComponentNames:!0},ts.column={createComponentOfType:"text",createStateVariable:"desiredColumn",defaultValue:null},ts.statisticsToDisplay={createComponentOfType:"textList",createStateVariable:"statisticsToDisplayPrelim",defaultValue:["default"]},ts.byCategoryColumn={createComponentOfType:"text",createStateVariable:"byCategoryColumn",defaultValue:null,public:!0},ts.displayDigits={createComponentOfType:"integer"},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.statisticsToDisplay={public:!0,shadowingInstructions:{createComponentOfType:"textList"},returnDependencies:()=>({statisticsToDisplayPrelim:{dependencyType:"stateVariable",variableName:"statisticsToDisplayPrelim"}}),definition:function({dependencyValues:rs}){let ns=["mean","stdev","variance","stderr","count","minimum","quartile1","median","quartile3","maximum","range","sum"],is=[],as=rs.statisticsToDisplayPrelim.map(os=>os.toLowerCase());if(as.includes("default"))is=["mean","stdev","count","minimum","quartile1","median","quartile3","maximum"];else if(as.includes("all"))is=[...ns];else for(let os of ns)as.includes(os)&&is.push(os);return{setValue:{statisticsToDisplay:is}}}},ts.sourceName={returnDependencies:()=>({source:{dependencyType:"attributeTargetComponentNames",attributeName:"source"}}),definition({dependencyValues:rs}){var is;let ns;return((is=rs.source)==null?void 0:is.length)===1?ns=rs.source[0].absoluteName:ns=null,{setValue:{sourceName:ns}}}},ts.dataColumn={stateVariablesDeterminingDependencies:["sourceName"],additionalStateVariablesDefined:[{variableName:"columnName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies({stateValues:rs}){return{dataFrame:{dependencyType:"stateVariable",componentName:rs.sourceName,variableName:"dataFrame",variableOptional:!0},desiredColumn:{dependencyType:"stateVariable",variableName:"desiredColumn"}}},definition({dependencyValues:rs}){let ns=null,is=null;if(rs.dataFrame){let as=rs.dataFrame,os=as.columnNames.indexOf(rs.desiredColumn);if(os!==-1){is=rs.desiredColumn,ns=[];for(let ls of as.data)ls[os]!==null&&ns.push(ls[os])}}return{setValue:{dataColumn:ns,columnName:is}}}},ts.count={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=rs.dataColumn.length),{setValue:{count:ns}}}},ts.sum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=rs.dataColumn.reduce((is,as)=>is+as)),{setValue:{sum:ns}}}},ts.mean={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn!==null&&(ns=Context.math.mean(rs.dataColumn)),{setValue:{mean:ns}}}},ts.stdev={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Context.math.std(rs.dataColumn)),{setValue:{stdev:ns}}}},ts.variance={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Context.math.variance(rs.dataColumn)),{setValue:{variance:ns}}}},ts.stderr={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({stdev:{dependencyType:"stateVariable",variableName:"stdev"},count:{dependencyType:"stateVariable",variableName:"count"}}),definition({dependencyValues:rs}){let ns=null;return rs.stdev!==null&&(ns=rs.stdev/Math.sqrt(rs.count)),{setValue:{stderr:ns}}}},ts.minimum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Math.min(...rs.dataColumn)),{setValue:{minimum:ns}}}},ts.maximum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Math.max(...rs.dataColumn)),{setValue:{maximum:ns}}}},ts.median={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Context.math.median(rs.dataColumn)),{setValue:{median:ns}}}},ts.quartile1={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Context.math.quantileSeq(rs.dataColumn,.25)),{setValue:{quartile1:ns}}}},ts.quartile3={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:rs}){let ns=null;return rs.dataColumn&&(ns=Context.math.quantileSeq(rs.dataColumn,.75)),{setValue:{quartile3:ns}}}},ts.range={public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({minimum:{dependencyType:"stateVariable",variableName:"minimum"},maximum:{dependencyType:"stateVariable",variableName:"maximum"}}),definition({dependencyValues:rs}){let ns=null;return rs.minimum!==null&&(ns=rs.maximum-rs.minimum),{setValue:{range:ns}}}},ts.summaryStatistics={forRenderer:!0,stateVariablesDeterminingDependencies:["statisticsToDisplay"],returnDependencies({stateValues:rs}){let ns={displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}};return rs.statisticsToDisplay.includes("mean")&&(ns.mean={dependencyType:"stateVariable",variableName:"mean"}),rs.statisticsToDisplay.includes("stdev")&&(ns.stdev={dependencyType:"stateVariable",variableName:"stdev"}),rs.statisticsToDisplay.includes("variance")&&(ns.variance={dependencyType:"stateVariable",variableName:"variance"}),rs.statisticsToDisplay.includes("stderr")&&(ns.stderr={dependencyType:"stateVariable",variableName:"stderr"}),rs.statisticsToDisplay.includes("count")&&(ns.count={dependencyType:"stateVariable",variableName:"count"}),rs.statisticsToDisplay.includes("minimum")&&(ns.minimum={dependencyType:"stateVariable",variableName:"minimum"}),rs.statisticsToDisplay.includes("quartile1")&&(ns.quartile1={dependencyType:"stateVariable",variableName:"quartile1"}),rs.statisticsToDisplay.includes("median")&&(ns.median={dependencyType:"stateVariable",variableName:"median"}),rs.statisticsToDisplay.includes("quartile3")&&(ns.quartile3={dependencyType:"stateVariable",variableName:"quartile3"}),rs.statisticsToDisplay.includes("maximum")&&(ns.maximum={dependencyType:"stateVariable",variableName:"maximum"}),rs.statisticsToDisplay.includes("range")&&(ns.range={dependencyType:"stateVariable",variableName:"range"}),rs.statisticsToDisplay.includes("sum")&&(ns.sum={dependencyType:"stateVariable",variableName:"sum"}),ns},definition({dependencyValues:rs,usedDefault:ns}){let is={};return rs.mean!==void 0&&(is.mean=roundForDisplay({value:rs.mean,dependencyValues:rs,usedDefault:ns})),rs.stdev!==void 0&&(is.stdev=roundForDisplay({value:rs.stdev,dependencyValues:rs,usedDefault:ns})),rs.variance!==void 0&&(is.variance=roundForDisplay({value:rs.variance,dependencyValues:rs,usedDefault:ns})),rs.stderr!==void 0&&(is.stderr=roundForDisplay({value:rs.stderr,dependencyValues:rs,usedDefault:ns})),rs.count!==void 0&&(is.count=roundForDisplay({value:rs.count,dependencyValues:rs,usedDefault:ns})),rs.minimum!==void 0&&(is.minimum=roundForDisplay({value:rs.minimum,dependencyValues:rs,usedDefault:ns})),rs.quartile1!==void 0&&(is.quartile1=roundForDisplay({value:rs.quartile1,dependencyValues:rs,usedDefault:ns})),rs.median!==void 0&&(is.median=roundForDisplay({value:rs.median,dependencyValues:rs,usedDefault:ns})),rs.quartile3!==void 0&&(is.quartile3=roundForDisplay({value:rs.quartile3,dependencyValues:rs,usedDefault:ns})),rs.maximum!==void 0&&(is.maximum=roundForDisplay({value:rs.maximum,dependencyValues:rs,usedDefault:ns})),rs.range!==void 0&&(is.range=roundForDisplay({value:rs.range,dependencyValues:rs,usedDefault:ns})),rs.sum!==void 0&&(is.sum=roundForDisplay({value:rs.sum,dependencyValues:rs,usedDefault:ns})),{setValue:{summaryStatistics:is}}}},ts}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(SummaryStatistics,"componentType","summaryStatistics");class Chart extends BlockComponent{constructor(ts){super(ts),Object.assign(this.actions,{changeAxisLimits:this.changeAxisLimits.bind(this),recordVisibilityChange:this.recordVisibilityChange.bind(this)})}static createAttributesObject(){let ts=super.createAttributesObject();return ts.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:"histogram",toLowerCase:!0,validValues:["histogram","dotplot","frequencytable","box","bar"],forRenderer:!0},ts.column={createComponentOfType:"text",createStateVariable:"desiredColumn",defaultValue:null},ts.xmin={createComponentOfType:"number",createStateVariable:"xminPrelim",defaultValue:-10},ts.xmax={createComponentOfType:"number",createStateVariable:"xmaxPrelim",defaultValue:10},ts.ymin={createComponentOfType:"number",createStateVariable:"yminPrelim",defaultValue:-10},ts.ymax={createComponentOfType:"number",createStateVariable:"ymaxPrelim",defaultValue:10},ts.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},ts.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},ts.identicalAxisScales={createComponentOfType:"boolean",createStateVariable:"identicalAxisScales",defaultValue:!1,public:!0,forRenderer:!0},ts.displayXAxis={createComponentOfType:"boolean",createStateVariable:"displayXAxis",defaultValue:!0,public:!0,forRenderer:!0},ts.displayYAxis={createComponentOfType:"boolean",createStateVariable:"displayYAxis",defaultValue:!0,public:!0,forRenderer:!0},ts.displayXAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayXAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},ts.displayYAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayYAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},ts.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},ts.xlabelPosition={createComponentOfType:"text",createStateVariable:"xlabelPosition",defaultValue:"right",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["right","left"]},ts.ylabel={createComponentOfType:"text",createStateVariable:"ylabel",defaultValue:"",public:!0,forRenderer:!0},ts.ylabelPosition={createComponentOfType:"text",createStateVariable:"ylabelPosition",defaultValue:"top",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["top","bottom"]},ts.ylabelAlignment={createComponentOfType:"text",createStateVariable:"ylabelAlignment",defaultValue:"left",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["left","right"]},ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.dataFrame={forRenderer:!0,returnDependencies(){return{targetComponent:{dependencyType:"targetComponent",variableNames:["dataFrame"],variablesOptional:!0}}},definition({dependencyValues:rs}){var is;console.log("definition of dataFrame",rs);let ns=null;return(is=rs.targetComponent)!=null&&is.stateValues.dataFrame&&(ns=rs.targetComponent.stateValues.dataFrame),{setValue:{dataFrame:ns}}}},ts.columnName={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"colInd",forRenderer:!0}],returnDependencies(){return{desiredColumn:{dependencyType:"stateVariable",variableName:"desiredColumn"},dataFrame:{dependencyType:"stateVariable",variableName:"dataFrame"}}},definition({dependencyValues:rs}){let ns=null,is=null;return rs.dataFrame&&(is=rs.dataFrame.columnNames.indexOf(rs.desiredColumn),is!==-1?ns=rs.desiredColumn:is=null),{setValue:{columnName:ns,colInd:is}}}},ts.xmin={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},xminPrelim:{dependencyType:"stateVariable",variableName:"xminPrelim"}};return rs.identicalAxisScales&&(ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.width={dependencyType:"stateVariable",variableName:"width"},ns.height={dependencyType:"stateVariable",variableName:"height"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(!rs.identicalAxisScales)return{setValue:{xmin:rs.xminPrelim}};if(!ns.xminPrelim)return{setValue:{xmin:rs.xminPrelim}};let as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim;if(os&&ls){let cs=rs.width.size/rs.height.size,ps=(rs.ymaxPrelim-rs.yminPrelim)*cs;return as?{setValue:{xmin:rs.xmaxPrelim-ps}}:{setValue:{xmin:-ps/2}}}else return as?{setValue:{xmin:rs.xmaxPrelim-20}}:{setValue:{xmin:-10}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){return await ns.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xminPrelim",desiredValue:rs.xmin}]}}},ts.xmax={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},xmaxPrelim:{dependencyType:"stateVariable",variableName:"xmaxPrelim"}};return rs.identicalAxisScales&&(ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.width={dependencyType:"stateVariable",variableName:"width"},ns.height={dependencyType:"stateVariable",variableName:"height"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(!rs.identicalAxisScales)return{setValue:{xmax:rs.xmaxPrelim}};let is=!ns.xminPrelim,as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim,us=os&&ls,cs=is&&as,ps=rs.xminPrelim;if(us){let ds=rs.width.size/rs.height.size,fs=(rs.ymaxPrelim-rs.yminPrelim)*ds;if(cs){let hs=rs.xmaxPrelim-ps,ys=Math.max(hs,fs);return{setValue:{xmax:ps+ys}}}else return is?{setValue:{xmax:ps+fs}}:as?{setValue:{xmax:rs.xmaxPrelim}}:{setValue:{xmax:fs/2}}}else return as?{setValue:{xmax:rs.xmaxPrelim}}:is?{setValue:{xmax:ps+20}}:{setValue:{xmax:10}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){return await ns.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xmaxPrelim",desiredValue:rs.xmax}]}}},ts.ymin={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},yminPrelim:{dependencyType:"stateVariable",variableName:"yminPrelim"}};return rs.identicalAxisScales&&(ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},ns.width={dependencyType:"stateVariable",variableName:"width"},ns.height={dependencyType:"stateVariable",variableName:"height"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(!rs.identicalAxisScales)return{setValue:{ymin:rs.yminPrelim}};if(!ns.yminPrelim)return{setValue:{ymin:rs.yminPrelim}};let as=!ns.ymaxPrelim,os=!ns.xminPrelim,ls=!ns.xmaxPrelim,us=os&&ls,cs=rs.width.size/rs.height.size;if(us){let ps=(rs.xmaxPrelim-rs.xminPrelim)/cs;return as?{setValue:{ymin:rs.ymaxPrelim-ps}}:{setValue:{ymin:-ps/2}}}else return as?{setValue:{ymin:rs.ymaxPrelim-20/cs}}:{setValue:{ymin:-10/cs}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){return await ns.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"yminPrelim",desiredValue:rs.ymin}]}}},ts.ymax={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:rs}){let ns={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},ymaxPrelim:{dependencyType:"stateVariable",variableName:"ymaxPrelim"}};return rs.identicalAxisScales&&(ns.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},ns.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},ns.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},ns.width={dependencyType:"stateVariable",variableName:"width"},ns.height={dependencyType:"stateVariable",variableName:"height"}),ns},definition({dependencyValues:rs,usedDefault:ns}){if(!rs.identicalAxisScales)return{setValue:{ymax:rs.ymaxPrelim}};let is=!ns.xminPrelim,as=!ns.xmaxPrelim,os=!ns.yminPrelim,ls=!ns.ymaxPrelim,us=os&&ls,cs=is&&as,ps=rs.yminPrelim,ds=rs.width.size/rs.height.size;if(cs){let fs=(rs.xmaxPrelim-rs.xminPrelim)/ds;if(us){let hs=rs.ymaxPrelim-ps,ys=Math.max(hs,fs);return{setValue:{ymax:ps+ys}}}else return os?{setValue:{ymax:ps+fs}}:ls?{setValue:{ymax:rs.ymaxPrelim}}:{setValue:{ymax:fs/2}}}else return ls?{setValue:{ymax:rs.ymaxPrelim}}:os?{setValue:{ymax:ps+20/ds}}:{setValue:{ymax:10/ds}}},async inverseDefinition({desiredStateVariableValues:rs,stateValues:ns}){return await ns.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"ymaxPrelim",desiredValue:rs.ymax}]}}},ts.xscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({xmin:{dependencyType:"stateVariable",variableName:"xmin"},xmax:{dependencyType:"stateVariable",variableName:"xmax"}}),definition({dependencyValues:rs}){return{setValue:{xscale:rs.xmax-rs.xmin}}}},ts.yscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({ymin:{dependencyType:"stateVariable",variableName:"ymin"},ymax:{dependencyType:"stateVariable",variableName:"ymax"}}),definition({dependencyValues:rs}){return{setValue:{yscale:rs.ymax-rs.ymin}}}},ts}async changeAxisLimits({xmin:ts,xmax:rs,ymin:ns,ymax:is,actionId:as,sourceInformation:os={},skipRendererUpdate:ls=!1}){let us=[];return ts!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmin",value:ts}),rs!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmax",value:rs}),ns!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymin",value:ns}),is!==void 0&&us.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymax",value:is}),await this.coreFunctions.performUpdate({updateInstructions:us,actionId:as,sourceInformation:os,skipRendererUpdate:ls,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{xmin:ts,xmax:rs,ymin:ns,ymax:is}}})}recordVisibilityChange({isVisible:ts,actionId:rs}){this.coreFunctions.requestRecordEvent({verb:"visibilityChanged",object:{componentName:this.componentName,componentType:this.componentType},result:{isVisible:ts}}),this.coreFunctions.resolveAction({actionId:rs})}}Ms(Chart,"componentType","chart"),Ms(Chart,"acceptTarget",!0);class Legend extends GraphicalComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.position={createComponentOfType:"text",createStateVariable:"position",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft"]},ts.displayClosedSwatches={createComponentOfType:"boolean",createStateVariable:"displayClosedSwatches",defaultValue:!1,public:!0},ts}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.graphicalElementNames={returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["graphicalDescendants"]}}),definition({dependencyValues:rs}){return rs.graphAncestor?{setValue:{graphicalElementNames:rs.graphAncestor.stateValues.graphicalDescendants.map(ns=>ns.componentName)}}:{setValue:{graphicalElementNames:null}}}},ts.legendElements={forRenderer:!0,stateVariablesDeterminingDependencies:["graphicalElementNames"],returnDependencies:({stateValues:rs})=>{let ns={labelChildren:{dependencyType:"child",childGroups:["labels"],variableNames:["value","hasLatex","forObjectComponentName"]},displayClosedSwatches:{dependencyType:"stateVariable",variableName:"displayClosedSwatches"}};if(rs.graphicalElementNames){ns.numGraphicalElements={dependencyType:"value",value:rs.graphicalElementNames.length};for(let[is,as]of rs.graphicalElementNames.entries())ns[`graphicalElement${is}`]={dependencyType:"multipleStateVariables",componentName:as,variableNames:["selectedStyle","styleNumber","filled"],variablesOptional:!0},ns[`graphicalElement${is}AdapterSource`]={dependencyType:"adapterSource",componentName:as},ns[`graphicalElement${is}ShadowSource`]={dependencyType:"shadowSource",componentName:as}}return ns},definition({dependencyValues:rs,componentInfoObjects:ns}){let is=[];if(rs.numGraphicalElements>0){let as=[],os=[],ls=[],us=[];for(let fs=0;fs<rs.numGraphicalElements;fs++){let hs=rs[`graphicalElement${fs}`],ys=rs[`graphicalElement${fs}AdapterSource`];if(ys&&(hs={...hs},hs.componentName=ys.componentName),hs.componentName.slice(0,3)==="/__"){let gs=rs[`graphicalElement${fs}ShadowSource`];gs&&(hs={...hs},hs.componentName=gs.componentName)}us.push(hs)}let cs=us.map(fs=>fs.componentName),ps=[],ds={};for(let fs of rs.labelChildren){let hs={value:fs.stateValues.value,hasLatex:fs.stateValues.hasLatex};if(fs.stateValues.forObjectComponentName){ds[fs.stateValues.forObjectComponentName]=hs;let ys=cs.indexOf(fs.stateValues.forObjectComponentName);if(ys!==-1){let gs=us[ys];ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"point"})?as.push(gs.stateValues.styleNumber):rs.displayClosedSwatches&&ns.allComponentClasses[gs.componentType].representsClosedPath?os.push(gs.stateValues.styleNumber):gs.componentType!=="legend"&&ls.push(gs.stateValues.styleNumber)}}ps.push({labelInfo:hs,forObject:fs.stateValues.forObjectComponentName})}for(let fs of ps){let hs;if(fs.forObject){let ys=cs.indexOf(fs.forObject);ys!==-1&&(hs=us[ys],us.splice(ys,1),cs.splice(ys,1))}else for(let ys=0;ys<us.length;ys++){let gs=us[ys];if(!(gs.componentName in ds)){if(ns.isInheritedComponentType({inheritedComponentType:gs.componentType,baseComponentType:"point"})){if(!as.includes(gs.stateValues.styleNumber)){hs=gs;break}}else if(rs.displayClosedSwatches&&ns.allComponentClasses[gs.componentType].representsClosedPath){if(!os.includes(gs.stateValues.styleNumber)){hs=gs;break}}else if(gs.componentType!=="legend"&&!ls.includes(gs.stateValues.styleNumber)){hs=gs;break}}}if(hs){let ys=hs.stateValues.selectedStyle,gs=hs.stateValues.styleNumber;ns.isInheritedComponentType({inheritedComponentType:hs.componentType,baseComponentType:"point"})?(as.push(gs),is.push({swatchType:"marker",markerStyle:ys.markerStyle,markerColor:ys.markerColor,markerSize:ys.markerSize,lineOpacity:ys.lineOpacity,label:fs.labelInfo})):rs.displayClosedSwatches&&ns.allComponentClasses[hs.componentType].representsClosedPath?(os.push(gs),is.push({swatchType:"rectangle",lineStyle:ys.lineStyle,lineColor:ys.lineColor,lineWidth:ys.lineWidth,lineOpacity:ys.lineOpacity,fillColor:ys.fillColor,filled:hs.stateValues.filled,fillOpacity:ys.fillOpacity,label:fs.labelInfo})):(ls.push(gs),is.push({swatchType:"line",lineStyle:ys.lineStyle,lineColor:ys.lineColor,lineWidth:ys.lineWidth,lineOpacity:ys.lineOpacity,label:fs.labelInfo}))}}}return{setValue:{legendElements:is}}}},ts.graphLimits={forRenderer:!0,returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]}}),definition({dependencyValues:rs}){return rs.graphAncestor?{setValue:{graphLimits:rs.graphAncestor.stateValues}}:{setValue:{graphLimits:null}}}},ts}}Ms(Legend,"componentType","legend");class MatchesPattern extends BooleanComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.pattern={createComponentOfType:"math"},ts.allowImplicitIdentities={createComponentOfType:"boolean",createStateVariable:"allowImplicitIdentities",defaultValue:!1,public:!0},ts.allowPermutations={createComponentOfType:"boolean",createStateVariable:"allowPermutations",defaultValue:!0,public:!0},ts.requireNumericMatches={createComponentOfType:"boolean",createStateVariable:"requireNumericMatches",defaultValue:!1,public:!0},ts.requireVariableMatches={createComponentOfType:"boolean",createStateVariable:"requireVariableMatches",defaultValue:!1,public:!0},ts.excludeMatches={createComponentOfType:"mathList",createStateVariable:"excludeMatches",defaultValue:[],public:!0},ts.matchExpressionWithBlanks={createComponentOfType:"boolean",createStateVariable:"matchExpressionWithBlanks",defaultValue:!1,public:!0},ts}static returnSugarInstructions(){let ts=[],rs=function({matchedChildren:ns,componentInfoObjects:is}){return ns.length===0||ns.length===1&&is.componentIsSpecifiedType(ns[0],"math")?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:ns}]}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.parsedExpression,delete ts.mathChildrenByCode,ts.pattern={additionalStateVariablesDefined:["patternVariables"],returnDependencies:()=>({patternAttr:{dependencyType:"attributeComponent",attributeName:"pattern",variableNames:["value"]}}),definition({dependencyValues:rs}){let ns=[];if(!rs.patternAttr)return{setValue:{pattern:"",patternVariables:ns}};let is=rs.patternAttr.stateValues.value.variables(),as=26*27+1;function os(us){if(us===""){let cs=numberToLetters(as);for(as++;is.includes(cs);)cs=numberToLetters(as),as++;return ns.push(cs),cs}else return Array.isArray(us)?[us[0],...us.slice(1).map(os)]:us}return{setValue:{pattern:os(rs.patternAttr.stateValues.value.tree),patternVariables:ns}}}},ts.value={additionalStateVariablesDefined:[{variableName:"allPatternMatches"}],public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({pattern:{dependencyType:"stateVariable",variableName:"pattern"},patternVariables:{dependencyType:"stateVariable",variableName:"patternVariables"},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},allowImplicitIdentities:{dependencyType:"stateVariable",variableName:"allowImplicitIdentities"},allowPermutations:{dependencyType:"stateVariable",variableName:"allowPermutations"},requireNumericMatches:{dependencyType:"stateVariable",variableName:"requireNumericMatches"},requireVariableMatches:{dependencyType:"stateVariable",variableName:"requireVariableMatches"},excludeMatches:{dependencyType:"stateVariable",variableName:"excludeMatches"},matchExpressionWithBlanks:{dependencyType:"stateVariable",variableName:"matchExpressionWithBlanks"}}),definition:function({dependencyValues:rs}){if(rs.mathChildren.length===0)return{setValue:{value:!1,allPatternMatches:[]}};let ns=rs.mathChildren[0].stateValues.value;if(ns.variables().includes("")&&!rs.matchExpressionWithBlanks)return{setValue:{value:!1,allPatternMatches:[]}};let is={};if(rs.requireNumericMatches){let cs=ps=>!Number.isNaN(Context.fromAst(ps).evaluate_to_constant());rs.patternVariables.forEach(ps=>is[ps]=cs)}else if(rs.requireVariableMatches){let cs=ps=>typeof ps=="string";rs.patternVariables.forEach(ps=>is[ps]=cs)}else rs.patternVariables.forEach(cs=>is[cs]=!0);let as={variables:is,allow_permutations:rs.allowPermutations};rs.allowImplicitIdentities&&(as.allow_implicit_identities=rs.patternVariables);let os=ns.match(rs.pattern,as),ls=!1,us=[];return os&&(Object.values(os).map(cs=>Context.fromAst(cs)).some(cs=>rs.excludeMatches.some(ps=>cs.variables().some(ds=>ps.equalsViaSyntax(Context.fromAst(ds)))))||(ls=!0,us=rs.patternVariables.map(cs=>Context.fromAst(os[cs])))),{setValue:{value:ls,allPatternMatches:us}}}},ts.nMatches={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allPatternMatches:{dependencyType:"stateVariable",variableName:"allPatternMatches"}}),definition({dependencyValues:rs}){return{setValue:{nMatches:rs.allPatternMatches.length},checkForActualChange:{nMatches:!0}}}},ts.patternMatches={public:!0,shadowingInstructions:{createComponentOfType:"math"},isArray:!0,nDimensions:1,entryPrefixes:["patternMatch"],returnArraySizeDependencies:()=>({nMatches:{dependencyType:"stateVariable",variableName:"nMatches"}}),returnArraySize({dependencyValues:rs}){return[rs.nMatches]},returnArrayDependenciesByKey(){return{globalDependencies:{allPatternMatches:{dependencyType:"stateVariable",variableName:"allPatternMatches"}}}},arrayDefinitionByKey({globalDependencyValues:rs}){let ns={};for(let is=0;is<rs.__array_size[0];is++)ns[is]=rs.allPatternMatches[is];return{setValue:{patternMatches:ns}}}},ts}}Ms(MatchesPattern,"componentType","matchesPattern"),Ms(MatchesPattern,"rendererType","boolean");class Matrix extends MathComponent{static returnChildGroups(){return[{group:"rows",componentTypes:["matrixRow"]},{group:"columns",componentTypes:["matrixColumn"]},{group:"maths",componentTypes:["math"]}]}static createAttributesObject(){let ts=super.createAttributesObject();return ts.displayDigits={createComponentOfType:"integer"},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts.defaultEntry={createComponentOfType:"math",createStateVariable:"defaultEntry",defaultValue:Context.fromAst(0)},ts.nRows={createComponentOfType:"integer"},ts.nColumns={createComponentOfType:"integer"},ts}static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){var as,os,ls,us;let is=[];for(let cs of ns)cs.doenetAttributes||(cs.doenetAttributes={}),cs.componentType==="column"?(cs.doenetAttributes.createNameFromComponentType="column",cs.componentType="matrixColumn"):cs.componentType==="row"&&(cs.doenetAttributes.createNameFromComponentType="row",cs.componentType="matrixRow"),((os=(as=cs.attributes)==null?void 0:as.createComponentOfType)==null?void 0:os.primitive)==="column"?(cs.doenetAttributes.createNameFromComponentType="column",cs.attributes.createComponentOfType.primitive="matrixColumn"):((us=(ls=cs.attributes)==null?void 0:ls.createComponentOfType)==null?void 0:us.primitive)==="row"&&(cs.doenetAttributes.createNameFromComponentType="row",cs.attributes.createComponentOfType.primitive="matrixRow"),is.push(cs);return{success:!0,newChildren:is}};return ts.push({replacementFunction:rs}),ts}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return delete ts.displayDecimals,delete ts.displaySmallAsZero,delete ts.padZeros,delete ts.codePre,delete ts.mathChildrenFunctionSymbols,delete ts.expressionWithCodes,delete ts.mathChildrenWithCanBeModified,delete ts.codesAdjacentToStrings,delete ts.canBeModified,delete ts.mathChildrenByVectorComponent,ts.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:rs,usedDefault:ns}){if(rs.displayDigitsAttr!==null){let is=ns.displayDigitsAttr,as=rs.displayDecimalsAttr===null||ns.displayDecimalsAttr;if(!(is||as)){let os=rs.displayDigitsAttr.shadowDepth;rs.displayDecimalsAttr.shadowDepth<os&&(is=!0)}return is?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:rs.displayDigitsAttr.stateValues.value}}}:{setValue:{displayDigits:rs.displayDigitsAttr.stateValues.value}}}return{useEssentialOrDefaultValue:{displayDigits:!0}}}},ts.unordered={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({}),definition(){return{setValue:{unordered:!1}}}},ts.matrixSizePre={returnDependencies:()=>({rowChildren:{dependencyType:"child",childGroups:["rows"],variableNames:["nComponents"]},colChildren:{dependencyType:"child",childGroups:["columns"],variableNames:["nComponents"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["matrixSize"]},nRowsAttr:{dependencyType:"attributeComponent",attributeName:"nRows",variableNames:["value"]},nColumnsAttr:{dependencyType:"attributeComponent",attributeName:"nColumns",variableNames:["value"]}}),definition({dependencyValues:rs}){let ns=null,is=null;return rs.nRowsAttr&&(ns=rs.nRowsAttr.stateValues.value,Number.isFinite(ns)&&ns>0||(ns=null)),rs.nColumnsAttr&&(is=rs.nColumnsAttr.stateValues.value,Number.isFinite(is)&&is>0||(is=null)),rs.rowChildren.length>0?(ns===null&&(ns=rs.rowChildren.length),is===null&&(is=Math.max(1,...rs.rowChildren.map(as=>as.stateValues.nComponents)))):rs.colChildren.length>0?(is===null&&(is=rs.colChildren.length),ns===null&&(ns=Math.max(1,...rs.colChildren.map(as=>as.stateValues.nComponents)))):rs.mathChildren.length===1?(ns===null&&(ns=rs.mathChildren[0].stateValues.matrixSize[0]),is===null&&(is=rs.mathChildren[0].stateValues.matrixSize[1])):ns===null?is===null?(ns=0,is=0):ns=1:is===null&&(is=1),{setValue:{matrixSizePre:[ns,is]}}}},ts.matrixPre={isArray:!0,nDimensions:2,hasEssential:!0,returnArraySizeDependencies:()=>({matrixSizePre:{dependencyType:"stateVariable",variableName:"matrixSizePre"}}),returnArraySize({dependencyValues:rs}){return rs.matrixSizePre},returnArrayDependenciesByKey:({arrayKeys:rs})=>{let ns={defaultEntry:{dependencyType:"stateVariable",variableName:"defaultEntry"},rowChildIdentities:{dependencyType:"child",childGroups:["rows"]},colChildIdentities:{dependencyType:"child",childGroups:["columns"]}},is={};for(let as of rs){let[os,ls]=as.split(",");is[as]={rowChild:{dependencyType:"child",childGroups:["rows"],childIndices:[os],variableNames:["math"+(Number(ls)+1)]},colChild:{dependencyType:"child",childGroups:["columns"],childIndices:[ls],variableNames:["math"+(Number(os)+1)]},mathChild:{dependencyType:"child",childGroups:["maths"],childIndices:[0],variableNames:["matrixEntry"+(Number(os)+1)+"_"+(Number(ls)+1)]}}}return{globalDependencies:ns,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,arraySize:as}){var ps,ds,fs;let os={},ls={},us=rs.rowChildIdentities.length>0,cs=rs.colChildIdentities.length>0;for(let hs of is){let[ys,gs]=hs.split(","),bs;us?bs=(ps=ns[hs].rowChild[0])==null?void 0:ps.stateValues["math"+(Number(gs)+1)]:cs?bs=(ds=ns[hs].colChild[0])==null?void 0:ds.stateValues["math"+(Number(ys)+1)]:bs=(fs=ns[hs].mathChild[0])==null?void 0:fs.stateValues["matrixEntry"+(Number(ys)+1)+"_"+(Number(gs)+1)],bs===void 0?ls[hs]={defaultValue:rs.defaultEntry}:os[hs]=bs}return{setValue:{matrixPre:os},useEssentialOrDefaultValue:{matrixPre:ls}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as}){var ps,ds,fs;let os=[],ls={},us=ns.rowChildIdentities.length>0,cs=ns.colChildIdentities.length>0;for(let hs in rs.matrixPre){let[ys,gs]=hs.split(",");us?((ps=is[hs].rowChild[0])==null?void 0:ps.stateValues["math"+(Number(gs)+1)])===void 0?ls[hs]=rs.matrixPre[hs]:os.push({setDependency:as[hs].rowChild,desiredValue:rs.matrixPre[hs],childIndex:0,variableIndex:0}):cs?((ds=is[hs].colChild[0])==null?void 0:ds.stateValues["math"+(Number(ys)+1)])===void 0?ls[hs]=rs.matrixPre[hs]:os.push({setDependency:as[hs].colChild,desiredValue:rs.matrixPre[hs],childIndex:0,variableIndex:0}):((fs=is[hs].mathChild[0])==null?void 0:fs.stateValues["matrixEntry"+(Number(ys)+1)+"_"+(Number(gs)+1)])===void 0?ls[hs]=rs.matrixPre[hs]:os.push({setDependency:as[hs].mathChild,desiredValue:rs.matrixPre[hs],childIndex:0,variableIndex:0})}return Object.keys(ls).length>0&&os.push({setEssentialValue:"matrixPre",value:ls}),{success:!0,instructions:os}}},ts.unnormalizedValue={returnDependencies:()=>({matrixPre:{dependencyType:"stateVariable",variableName:"matrixPre"},matrixSizePre:{dependencyType:"stateVariable",variableName:"matrixSizePre"}}),definition({dependencyValues:rs}){let ns=["tuple"];for(let as=0;as<rs.matrixSizePre[0];as++)ns.push(["tuple",...rs.matrixPre[as].map(os=>os.tree)]);return{setValue:{unnormalizedValue:Context.fromAst(["matrix",["tuple",...rs.matrixSizePre],ns])}}},inverseDefinition({dependencyValues:rs,desiredStateVariableValues:ns}){var os,ls;let is=ns.unnormalizedValue.tree;if(!(Array.isArray(is)&&is[0]==="matrix"&&((os=is[1])==null?void 0:os[1])===rs.matrixSizePre[0]&&((ls=is[1])==null?void 0:ls[2])===rs.matrixSizePre[1]))return{success:!1};let as={};for(let us=0;us<rs.matrixSizePre[0];us++)for(let cs=0;cs<rs.matrixSizePre[1];cs++)as[`${us},${cs}`]=Context.fromAst(is[2][us+1][cs+1]);return{success:!0,instructions:[{setDependency:"matrixPre",desiredValue:as}]}}},ts.canBeModified={returnDependencies:()=>({modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"}}),definition({dependencyValues:rs}){return{setValue:{canBeModified:rs.modifyIndirectly&&!rs.fixed}}}},ts}}Ms(Matrix,"componentType","matrix"),Ms(Matrix,"rendererType","math");class EigenDecomposition extends BaseComponent{static createAttributesObject(){let ts=super.createAttributesObject();return ts.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:14,public:!0},ts.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},ts.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},ts.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},ts}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.decomposition={returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}),definition({dependencyValues:rs}){if(rs.mathChild.length===0)return{setValue:{decomposition:null}};let ns=rs.mathChild[0].stateValues.value.tree;if(!Array.isArray(ns)||ns[0]!=="matrix")return{setValue:{decomposition:null}};let is=ns[1][1],as=ns[1][2];if(!(Number.isInteger(is)&&as===is))return{setValue:{decomposition:null}};let os=[];for(let us=0;us<is;us++){let cs=[],ps=ns[2][us+1]||[];for(let ds=0;ds<as;ds++){let fs=ps[ds+1];if(fs==null)return{setValue:{decomposition:null}};if(typeof fs=="number"||typeof(fs==null?void 0:fs.re)=="number"&&typeof(fs==null?void 0:fs.im)=="number")cs.push(fs);else try{fs=Context.fromAst(fs).evaluate_to_constant(),typeof fs=="number"||typeof(fs==null?void 0:fs.re)=="number"&&typeof(fs==null?void 0:fs.im)=="number"?cs.push(fs):cs.push(NaN)}catch{cs.push(NaN)}}os.push(cs)}let ls;try{ls=Context.math.eigs(os)}catch{return console.warn("Could not calculate eigenvalues of matrix"),{setValue:{decomposition:null}}}return{setValue:{decomposition:ls}}}},ts.eigenvalues={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},entryPrefixes:["eigenvalue"],returnArraySizeDependencies:()=>({decomposition:{dependencyType:"stateVariable",variableName:"decomposition"}}),returnArraySize({dependencyValues:rs}){let ns;return rs.decomposition?ns=rs.decomposition.values.length:ns=0,[ns]},returnArrayDependenciesByKey(){return{globalDependencies:{decomposition:{dependencyType:"stateVariable",variableName:"decomposition"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arraySize:ns}){let is=[];for(let as=0;as<ns[0];as++)is.push(rs.decomposition.values[as]);return{setValue:{eigenvalues:is}}}},ts.eigenvectors={isArray:!0,public:!0,nDimensions:2,shadowingInstructions:{createComponentOfType:"number",attributesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents(rs){return rs==="eigenvectorX"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]}},getArrayKeysFromVarName({arrayEntryPrefix:rs,varEnding:ns,arraySize:is}){if(rs==="eigenvectorX"){let as=ns.split("_").map(os=>Number(os)-1);return as.length===2&&as.every((os,ls)=>Number.isInteger(os)&&os>=0)?is?as.every((os,ls)=>os<is[ls])?[String(as)]:[]:[String(as)]:[]}else{let as=Number(ns)-1;return Number.isInteger(as)&&as>=0?is?as<is[0]?Array.from(Array(is[1]),(os,ls)=>as+","+ls):[]:[as+",0"]:[]}},arrayVarNameFromPropIndex(rs,ns){if(ns==="eigenvectors")return rs.length===1?"eigenvector"+rs[0]:`eigenvectorX${rs[0]}_${rs[1]}`;if(ns.slice(0,11)==="eigenvector"){let is=Number(ns.slice(11));if(Number.isInteger(is)&&is>0)return`eigenvectorX${is}_${rs[0]}`}return null},entryPrefixes:["eigenvectorX","eigenvector"],returnArraySizeDependencies:()=>({decomposition:{dependencyType:"stateVariable",variableName:"decomposition"}}),returnArraySize({dependencyValues:rs}){let ns;return rs.decomposition?ns=rs.decomposition.values.length:ns=0,[ns,ns]},returnArrayDependenciesByKey(){return{globalDependencies:{decomposition:{dependencyType:"stateVariable",variableName:"decomposition"}}}},arrayDefinitionByKey({globalDependencyValues:rs,arraySize:ns}){let is={};for(let as=0;as<ns[0];as++){let os=[],ls=0;for(let us=0;us<ns[0];us++){let cs=rs.decomposition.vectors[us][as];os.push(cs),ls+=Context.math.square(Context.math.abs(cs))}ls=Math.sqrt(ls),os=os.map(us=>Context.math.divide(us,ls));for(let us=0;us<ns[0];us++)is[`${as},${us}`]=os[us]}return{setValue:{eigenvectors:is}}}},ts}}Ms(EigenDecomposition,"componentType","eigenDecomposition"),Ms(EigenDecomposition,"rendererType");class Latex extends Text{static returnChildGroups(){return[{group:"mathTextLike",componentTypes:["math","m","md","latex","string","text","_singleCharacterInline","_inlineRenderInlineChildren"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.value.returnDependencies=()=>({mathTextLikeChildren:{dependencyType:"child",childGroups:["mathTextLike"],variableNames:["text","latex"]}}),ts.value.definition=function({dependencyValues:rs}){if(rs.mathTextLikeChildren.length===0)return{useEssentialOrDefaultValue:{value:!0}};let ns="";for(let is of rs.mathTextLikeChildren)typeof is=="string"?ns+=is:is.stateValues.latex!==void 0?ns+=is.stateValues.latex:ns+=is.stateValues.text;return{setValue:{value:ns}}},ts.value.inverseDefinition=function({desiredStateVariableValues:rs,dependencyValues:ns}){var as;let is=ns.mathTextLikeChildren.length;return is>1?{success:!1}:is===1?{success:!0,instructions:[{setDependency:"textLikeChildren",desiredValue:rs.value,childIndex:0,variableIndex:((as=ns.textLikeChildren[0].stateValues)==null?void 0:as.latex)===void 0?0:1}]}:{success:!0,instructions:[{setEssentialValue:"value",value:rs.value===null?"":String(rs.value)}]}},ts.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:rs})=>({setValue:{text:rs.value}}),inverseDefinition:({desiredStateVariableValues:rs})=>({success:!0,instructions:[{setDependency:"value",desiredValue:rs.text}]})},ts.latex={isAlias:!0,targetVariableName:"value"},ts}}Ms(Latex,"componentType","latex"),Ms(Latex,"rendererType","text");const unitConversions={"":1,px:1,pixel:1,pixels:1,"%":1,em:100,in:96,inch:96,inches:96,pt:1.333333333333,mm:3.7795296,millimeter:3.7795296,millimeters:3.7795296,cm:37.795296,centimeter:37.795296,centimeters:37.795296};class ComponentSize extends InlineComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=ns[ns.length-1];if(typeof is=="string"){let as=/([a-zA-z]+|%)$/,os=is.trim(),ls=os.match(as);if(ls){let us=ls[1];if(us in unitConversions){let cs=os.slice(0,ls.index),ps=ns.slice(0,ns.length-1);return cs.length>0&&ps.push(cs),{success:!0,newChildren:[{componentType:"number",children:ps},us]}}}}return{success:!0,newChildren:[{componentType:"number",children:ns}]}};return ts.push({childrenRegex:/..+/,replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"numbers",componentTypes:["number"]},{group:"componentSizes",componentTypes:["_componentSize"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.componentSize={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,returnDependencies:()=>({componentSizeChild:{dependencyType:"child",childGroups:["componentSizes"],variableNames:["componentSize"]},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},parentDefaultAbsoluteSize:{dependencyType:"parentStateVariable",variableName:"defaultAbsoluteSize"}}),definition({dependencyValues:rs}){let ns=rs.parentDefaultAbsoluteSize===void 0?!1:rs.parentDefaultAbsoluteSize;if(rs.stringChild.length===0)return rs.numberChild.length===0?rs.componentSizeChild.length===0?{useEssentialOrDefaultValue:{componentSize:{defaultValue:{size:100,isAbsolute:ns}}}}:{setValue:{componentSize:rs.componentSizeChild[0].stateValues.componentSize}}:{setValue:{componentSize:{size:rs.numberChild[0].stateValues.value,isAbsolute:!0}}};{let is,as;if(rs.numberChild.length>0)is=rs.numberChild[0].stateValues.value,as=rs.stringChild[0].trim();else{let cs=rs.stringChild[0].trim().match(/^(-?[\d.]+)\s*(.*)$/);if(cs===null)return{setValue:{componentSize:null}};is=cs[1],as=cs[2].trim()}if(is=Number(is),!Number.isFinite(is))return{setValue:{componentSize:null}};let os=!(as==="%"||as==="em"),ls=unitConversions[as];return ls===void 0&&(ls=1),{setValue:{componentSize:{size:ls*is,isAbsolute:os}}}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){if(ns.stringChild.length===0)return ns.numberChild.length===0?ns.componentSizeChild.length===0?{success:!0,instructions:[{setEssentialValue:"componentSize",value:rs.componentSize}]}:{success:!0,instructions:[{setDependency:"componentSizeChild",desiredValue:rs.componentSize,childIndex:0,variableIndex:0}]}:rs.componentSize.isAbsolute?{success:!0,instructions:[{setDependency:"numberChild",desiredValue:rs.componentSize.size,childIndex:0,variableIndex:0}]}:{success:!1};if(ns.numberChild.length>0){let is=ns.stringChild[0].trim(),as=!(is==="%"||is==="em");if(rs.componentSize.isAbsolute!==as)return{success:!1};let os=unitConversions[is];return os===void 0&&(os=1),{success:!0,instructions:[{setDependency:"numberChild",desiredValue:rs.componentSize.size/os,childIndex:0,variableIndex:0}]}}else{let is=rs.componentSize.size;return rs.componentSize.isAbsolute?is+="px":is+="%",{success:!0,instructions:[{setDependency:"stringChild",desiredValue:is,childIndex:0,variableIndex:0}]}}}},ts.number={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:rs}){let ns=null;return rs.componentSize&&(ns=rs.componentSize.size),{setValue:{number:ns}}},inverseDefinition({desiredStateVariableValues:rs,dependencyValues:ns}){return ns.componentSize?{success:!0,instructions:[{setDependency:"componentSize",desiredValue:{size:rs.number,isAbsolute:ns.componentSize.isAbsolute}}]}:{success:!1}}},ts.math=mathStateVariableFromNumberStateVariable({numberVariableName:"number",mathVariableName:"math",isPublic:!0}),ts.isAbsolute={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:rs}){let ns=null;return rs.componentSize&&(ns=rs.componentSize.isAbsolute),{setValue:{isAbsolute:ns}}}},ts.text={forRenderer:!0,returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:rs}){let ns="";return rs.componentSize&&(ns=rs.componentSize.size,rs.componentSize.isAbsolute?ns+="px":ns+="%"),{setValue:{text:ns}}}},ts}}Ms(ComponentSize,"componentType","_componentSize"),Ms(ComponentSize,"rendererType","text"),Ms(ComponentSize,"primaryStateVariableForDefinition","componentSize"),Ms(ComponentSize,"stateVariableForAttributeValue","componentSize"),Ms(ComponentSize,"adapters",["number","math"]);class ComponentSizeList extends BaseComponent{static returnSugarInstructions(){let ts=super.returnSugarInstructions(),rs=function({matchedChildren:ns}){let is=[],as=[],os=function(){as.length>0&&(is.push({componentType:"_componentSize",children:as}),as=[])};for(let ls of ns)if(typeof ls=="string"){let us=ls.split(/\s+/);us[0].length===0&&(os(),us=us.slice(1));for(let[cs,ps]of us.entries())ps.length>0?(as.push(ps),cs<us.length-1&&os()):os()}else as.push(ls);return os(),{success:!0,newChildren:is}};return ts.push({replacementFunction:rs}),ts}static returnChildGroups(){return[{group:"componentSizes",componentTypes:["_componentSize"]},{group:"componentSizeLists",componentTypes:["_componentSizeList"]}]}static returnStateVariableDefinitions(){let ts=super.returnStateVariableDefinitions();return ts.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},ts.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{componentSizeListChildren:{dependencyType:"child",childGroups:["componentSizeLists"],variableNames:["nComponents"]},componentSizeAndComponentSizeListChildren:{dependencyType:"child",childGroups:["componentSizes","componentSizeLists"],skipComponentNames:!0}}},definition:function({dependencyValues:rs,componentInfoObjects:ns}){let is=0,as=[],os=0;for(let[ls,us]of rs.componentSizeAndComponentSizeListChildren.entries())if(ns.isInheritedComponentType({inheritedComponentType:us.componentType,baseComponentType:"_componentSizeList"})){let cs=rs.componentSizeListChildren[os];os++;for(let ps=0;ps<cs.stateValues.nComponents;ps++)as[is+ps]=[ls,ps];is+=cs.stateValues.nComponents}else as[is]=[ls,0],is+=1;return{setValue:{nComponents:is,childIndexByArrayKey:as},checkForActualChange:{nComponents:!0}}}},ts.componentSizes={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},isArray:!0,entryPrefixes:["componentSize"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:rs}){return[rs.nComponents]},returnArrayDependenciesByKey({arrayKeys:rs,stateValues:ns}){let is={},as={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let os of rs){let ls=[],us="1";ns.childIndexByArrayKey[os]&&(ls=[ns.childIndexByArrayKey[os][0]],us=ns.childIndexByArrayKey[os][1]+1),is[os]={componentSizeAndComponentSizeListChildren:{dependencyType:"child",childGroups:["componentSizes","componentSizeLists"],variableNames:["componentSize","componentSize"+us],variablesOptional:!0,childIndices:ls}}}return{globalDependencies:as,dependenciesByKey:is}},arrayDefinitionByKey({globalDependencyValues:rs,dependencyValuesByKey:ns,arrayKeys:is,componentInfoObjects:as}){let os={};for(let ls of is){let us=ns[ls].componentSizeAndComponentSizeListChildren[0];if(us)if(as.isInheritedComponentType({inheritedComponentType:us.componentType,baseComponentType:"_componentSizeList"})){let cs=rs.childIndexByArrayKey[ls][1]+1;os[ls]=us.stateValues["componentSize"+cs]}else os[ls]=us.stateValues.componentSize}return{setValue:{componentSizes:os}}},inverseArrayDefinitionByKey({desiredStateVariableValues:rs,globalDependencyValues:ns,dependencyValuesByKey:is,dependencyNamesByKey:as,arraySize:os,componentInfoObjects:ls}){let us=[];for(let cs in rs.componentSizes){if(!is[cs])continue;let ps=is[cs].componentSizeAndComponentSizeListChildren[0];ps&&(ls.isInheritedComponentType({inheritedComponentType:ps.componentType,baseComponentType:"_componentSizeList"})?us.push({setDependency:as[cs].componentSizeAndComponentSizeListChildren,desiredValue:rs.componentSizes[cs],childIndex:0,variableIndex:1}):us.push({setDependency:as[cs].componentSizeAndComponentSizeListChildren,desiredValue:rs.componentSizes[cs],childIndex:0,variableIndex:0}))}return{success:!0,instructions:us}}},ts.nValues={isAlias:!0,targetVariableName:"nComponents"},ts.values={isAlias:!0,targetVariableName:"componentSizes"},ts}}Ms(ComponentSizeList,"componentType","_componentSizeList"),Ms(ComponentSizeList,"rendererType","asList"),Ms(ComponentSizeList,"renderChildren",!0),Ms(ComponentSizeList,"stateVariableForAttributeValue","componentSizes");var ComponentSize$1=Object.freeze({__proto__:null,ComponentSize,ComponentSizeList});const componentTypeArray=[...Object.values(Aliases),...Object.values(MMeMen),...Object.values(MdMdnMrow),...Object.values(BooleanOperators),...Object.values(BooleanOperatorsOfMath),...Object.values(MathOperators),...Object.values(FunctionOperators),...Object.values(TextOperatorsOfMath),...Object.values(Extrema$1),...Object.values(ParagraphMarkup),...Object.values(SingleCharacterComponents),...Object.values(Sectioning),...Object.values(Lists),...Object.values(DynamicalSystems),...Object.values(Chemistry),...Object.values(FeedbackDefinitions$1),...Object.values(StyleDefinitions$1),...Object.values(SideBySide$1),...Object.values(ComponentWithSelectableType$1),...Object.values(Indexing),...Object.values(Divisions),...Object.values(Verbatim),...Object.values(Paginator$1),...Object.values(MatrixInput$1),Document,Text,TextList$1,TextList,P$2,BooleanComponent,BooleanList,MathComponent,MathList,TupleList,NumberList,NumberListFromString,Copy,Extract,Collect,Ref,Point,Coords,Line,LineSegment,Ray,Polyline,Polygon,Triangle,Rectangle,RegularPolygon,Circle,Parabola,Curve,BezierControls,ControlVectors,Vector,Angle,Answer,Award,When,MathInput,Textinput,BooleanInput,Choiceinput,Choice,NumberComponent,Integer,Graph$1,Variables,Variable,Function$1,PiecewiseFunction,Interval,Template,Option$1,Sequence,Slider,Spreadsheet,DiscreteSimulationResultList,DiscreteSimulationResultPolyline,Cell,Row,Column,CellBlock,Tabular,Table,Figure,Markers,Panel,Map$1,Sources,Pegboard,Constraints,ConstrainToGrid,ConstrainToGraph,AttractToGrid,ConstrainTo,AttractTo,ConstraintUnion,AttractToConstraint,Intersection,ConstrainToAngles,AttractToAngles,ConditionalContent,AsList,VariantControl,TextListFromString,SelectFromSequence,Select,Group,AnimateFromSequence,Evaluate,SelectRandomNumbers,SampleRandomNumbers,Substitute,PeriodicSet,Image,Video,Embed,Hint,Solution,IntComma,Pluralize,Feedback,CollaborateGroups,CollaborateGroupSetup,ConsiderAsResponses,Case,Lorem,UpdateValue,CallAction,triggerSet,FunctionIterates,Module,CustomAttribute,Setup,Footnote,Caption,Endpoint,Sort,Shuffle,SolveEquations,SolutionContainer,SubsetOfRealsInput,SubsetOfReals,Split,BestFitLine,RegionBetweenCurveXAxis,RegionHalfPlane,CodeEditor,CodeViewer,RenderDoenetML,HasSameFactoring,DataFrame,SummaryStatistics,Chart,Legend,Label,MatchesPattern,Matrix,EigenDecomposition,Latex,BaseComponent,InlineComponent,BlockComponent,GraphicalComponent,ConstraintComponent,Input,CompositeComponent,PointListComponent,IntervalListComponent,LineListComponent,VectorListComponent,AngleListComponent,BooleanOperator,BooleanBaseOperatorOfMath,MathOperator,MathOperatorOneInput,FunctionOperator,...Object.values(ComponentSize$1),SectioningComponent,InlineRenderInlineChildren,TextOrInline,SingleCharacter];function allComponentClasses(){const ss={},ts=new Set;for(let rs of componentTypeArray){let ns=rs.componentType;if(ns===void 0)throw Error("Cannot create component as componentType is undefined for class "+rs);let is=ns.toLowerCase();if(ts.has(is))throw Error("component type "+ns+" defined in two classes");ss[ns]=rs,ts.add(is)}return ss}function componentTypesCreatingVariants(){const ss={},ts=new Set;for(let rs of componentTypeArray)if(rs.createsVariants){let ns=rs.componentType;if(ns===void 0)throw Error("Cannot create component as componentType is undefined for class "+rs);let is=ns.toLowerCase();if(ts.has(is))throw Error("component type "+ns+" defined in two classes");ss[ns]=rs,ts.add(is)}return ss}function createComponentInfoObjects(){let ss=allComponentClasses(),ts=componentTypesCreatingVariants(),rs={};for(let cs in ss)rs[cs.toLowerCase()]=cs;let ns={};for(let cs in ss)Object.defineProperty(ns,cs,{get:function(){let ps=ss[cs].returnStateVariableInfo();return delete ns[cs],ns[cs]=ps}.bind(this),configurable:!0});let is={};for(let cs in ss)Object.defineProperty(is,cs,{get:function(){let ps=ss[cs].returnStateVariableInfo({onlyPublic:!0});return delete is[cs],is[cs]=ps}.bind(this),configurable:!0});function as({inheritedComponentType:cs,baseComponentType:ps}){if(cs===ps)return!0;if(cs==="string")return ps==="_base"||ps==="_inline";if(ps==="string")return!1;let ds=ss[ps];return ds?ds.isPrototypeOf(ss[cs]):!1}function os({componentType:cs,includeNonStandard:ps=!0}){let ds=ss[cs];return ds?as({inheritedComponentType:cs,baseComponentType:"_composite"})&&(ps||!ds.treatAsComponentForRecursiveReplacements):!1}let ls=(cs,ps)=>as({inheritedComponentType:cs,baseComponentType:ps});return{allComponentClasses:ss,componentTypesCreatingVariants:ts,componentTypeLowerCaseMapping:rs,isInheritedComponentType:as,isCompositeComponent:os,stateVariableInfo:ns,publicStateVariableInfo:is,componentIsSpecifiedType:(cs,ps)=>{var ds,fs;return ls(cs.componentType,ps)||ls((fs=(ds=cs.attributes)==null?void 0:ds.createComponentOfType)==null?void 0:fs.primitive,ps)}}}function promisifyRequest(ss){return new Promise((ts,rs)=>{ss.oncomplete=ss.onsuccess=()=>ts(ss.result),ss.onabort=ss.onerror=()=>rs(ss.error)})}function createStore(ss,ts){const rs=indexedDB.open(ss);rs.onupgradeneeded=()=>rs.result.createObjectStore(ts);const ns=promisifyRequest(rs);return(is,as)=>ns.then(os=>as(os.transaction(ts,is).objectStore(ts)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function set(ss,ts,rs=defaultGetStore()){return rs("readwrite",ns=>(ns.put(ts,ss),promisifyRequest(ns.transaction)))}const toastType=Object.freeze({ERROR:{timeout:-1,background:"rgba(193, 41, 46, 1)",gradientEnd:"rgba()"},ALERT:{timeout:-1,background:"rgba(255, 230, 0, 1)"},ACTION:{timeout:-1,background:"rgba()"},INFO:{timeout:3e3,background:"rgba(26, 90, 153,1)"},SUCCESS:{timeout:3e3,background:"rgba(41, 193, 67,  1)"},CONFIRMATION:{timeout:5e3,background:"rgba(26,90,153,1)"}});var axiosExports$1={},axios$3={get exports(){return axiosExports$1},set exports(ss){axiosExports$1=ss}},axiosExports={},axios$2={get exports(){return axiosExports},set exports(ss){axiosExports=ss}},bind$2=function ss(ts,rs){return function(){for(var is=new Array(arguments.length),as=0;as<is.length;as++)is[as]=arguments[as];return ts.apply(rs,is)}},bind$1=bind$2,toString$1=Object.prototype.toString,kindOf=function(ss){return function(ts){var rs=toString$1.call(ts);return ss[rs]||(ss[rs]=rs.slice(8,-1).toLowerCase())}}(Object.create(null));function kindOfTest(ss){return ss=ss.toLowerCase(),function(rs){return kindOf(rs)===ss}}function isArray$1(ss){return Array.isArray(ss)}function isUndefined(ss){return typeof ss>"u"}function isBuffer$1(ss){return ss!==null&&!isUndefined(ss)&&ss.constructor!==null&&!isUndefined(ss.constructor)&&typeof ss.constructor.isBuffer=="function"&&ss.constructor.isBuffer(ss)}var isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(ss){var ts;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ts=ArrayBuffer.isView(ss):ts=ss&&ss.buffer&&isArrayBuffer(ss.buffer),ts}function isString(ss){return typeof ss=="string"}function isNumber(ss){return typeof ss=="number"}function isObject(ss){return ss!==null&&typeof ss=="object"}function isPlainObject(ss){if(kindOf(ss)!=="object")return!1;var ts=Object.getPrototypeOf(ss);return ts===null||ts===Object.prototype}var isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction(ss){return toString$1.call(ss)==="[object Function]"}function isStream(ss){return isObject(ss)&&isFunction(ss.pipe)}function isFormData(ss){var ts="[object FormData]";return ss&&(typeof FormData=="function"&&ss instanceof FormData||toString$1.call(ss)===ts||isFunction(ss.toString)&&ss.toString()===ts)}var isURLSearchParams=kindOfTest("URLSearchParams");function trim(ss){return ss.trim?ss.trim():ss.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function forEach(ss,ts){if(!(ss===null||typeof ss>"u"))if(typeof ss!="object"&&(ss=[ss]),isArray$1(ss))for(var rs=0,ns=ss.length;rs<ns;rs++)ts.call(null,ss[rs],rs,ss);else for(var is in ss)Object.prototype.hasOwnProperty.call(ss,is)&&ts.call(null,ss[is],is,ss)}function merge(){var ss={};function ts(is,as){isPlainObject(ss[as])&&isPlainObject(is)?ss[as]=merge(ss[as],is):isPlainObject(is)?ss[as]=merge({},is):isArray$1(is)?ss[as]=is.slice():ss[as]=is}for(var rs=0,ns=arguments.length;rs<ns;rs++)forEach(arguments[rs],ts);return ss}function extend(ss,ts,rs){return forEach(ts,function(is,as){rs&&typeof is=="function"?ss[as]=bind$1(is,rs):ss[as]=is}),ss}function stripBOM(ss){return ss.charCodeAt(0)===65279&&(ss=ss.slice(1)),ss}function inherits(ss,ts,rs,ns){ss.prototype=Object.create(ts.prototype,ns),ss.prototype.constructor=ss,rs&&Object.assign(ss.prototype,rs)}function toFlatObject(ss,ts,rs){var ns,is,as,os={};ts=ts||{};do{for(ns=Object.getOwnPropertyNames(ss),is=ns.length;is-- >0;)as=ns[is],os[as]||(ts[as]=ss[as],os[as]=!0);ss=Object.getPrototypeOf(ss)}while(ss&&(!rs||rs(ss,ts))&&ss!==Object.prototype);return ts}function endsWith(ss,ts,rs){ss=String(ss),(rs===void 0||rs>ss.length)&&(rs=ss.length),rs-=ts.length;var ns=ss.indexOf(ts,rs);return ns!==-1&&ns===rs}function toArray(ss){if(!ss)return null;var ts=ss.length;if(isUndefined(ts))return null;for(var rs=new Array(ts);ts-- >0;)rs[ts]=ss[ts];return rs}var isTypedArray=function(ss){return function(ts){return ss&&ts instanceof ss}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array)),utils$b={isArray:isArray$1,isArrayBuffer,isBuffer:isBuffer$1,isFormData,isArrayBufferView,isString,isNumber,isObject,isPlainObject,isUndefined,isDate,isFile,isBlob,isFunction,isStream,isURLSearchParams,isStandardBrowserEnv,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,isTypedArray,isFileList},utils$a=utils$b;function encode(ss){return encodeURIComponent(ss).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$1=function ss(ts,rs,ns){if(!rs)return ts;var is;if(ns)is=ns(rs);else if(utils$a.isURLSearchParams(rs))is=rs.toString();else{var as=[];utils$a.forEach(rs,function(us,cs){us===null||typeof us>"u"||(utils$a.isArray(us)?cs=cs+"[]":us=[us],utils$a.forEach(us,function(ds){utils$a.isDate(ds)?ds=ds.toISOString():utils$a.isObject(ds)&&(ds=JSON.stringify(ds)),as.push(encode(cs)+"="+encode(ds))}))}),is=as.join("&")}if(is){var os=ts.indexOf("#");os!==-1&&(ts=ts.slice(0,os)),ts+=(ts.indexOf("?")===-1?"?":"&")+is}return ts},utils$9=utils$b;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function ss(ts,rs,ns){return this.handlers.push({fulfilled:ts,rejected:rs,synchronous:ns?ns.synchronous:!1,runWhen:ns?ns.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function ss(ts){this.handlers[ts]&&(this.handlers[ts]=null)},InterceptorManager$1.prototype.forEach=function ss(ts){utils$9.forEach(this.handlers,function(ns){ns!==null&&ts(ns)})};var InterceptorManager_1=InterceptorManager$1,utils$8=utils$b,normalizeHeaderName$1=function ss(ts,rs){utils$8.forEach(ts,function(is,as){as!==rs&&as.toUpperCase()===rs.toUpperCase()&&(ts[rs]=is,delete ts[as])})},utils$7=utils$b;function AxiosError$2(ss,ts,rs,ns,is){Error.call(this),this.message=ss,this.name="AxiosError",ts&&(this.code=ts),rs&&(this.config=rs),ns&&(this.request=ns),is&&(this.response=is)}utils$7.inherits(AxiosError$2,Error,{toJSON:function ss(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var prototype=AxiosError$2.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(ss){descriptors[ss]={value:ss}}),Object.defineProperties(AxiosError$2,descriptors),Object.defineProperty(prototype,"isAxiosError",{value:!0}),AxiosError$2.from=function(ss,ts,rs,ns,is,as){var os=Object.create(prototype);return utils$7.toFlatObject(ss,os,function(us){return us!==Error.prototype}),AxiosError$2.call(os,ss.message,ts,rs,ns,is),os.name=ss.name,as&&Object.assign(os,as),os};var AxiosError_1=AxiosError$2,transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ts=0,rs=ss.length;ts<rs;++ts)lookup[ts]=ss[ts],revLookup[ss.charCodeAt(ts)]=ts;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(ss){inited||init();var ts,rs,ns,is,as,os,ls=ss.length;if(ls%4>0)throw new Error("Invalid string. Length must be a multiple of 4");as=ss[ls-2]==="="?2:ss[ls-1]==="="?1:0,os=new Arr(ls*3/4-as),ns=as>0?ls-4:ls;var us=0;for(ts=0,rs=0;ts<ns;ts+=4,rs+=3)is=revLookup[ss.charCodeAt(ts)]<<18|revLookup[ss.charCodeAt(ts+1)]<<12|revLookup[ss.charCodeAt(ts+2)]<<6|revLookup[ss.charCodeAt(ts+3)],os[us++]=is>>16&255,os[us++]=is>>8&255,os[us++]=is&255;return as===2?(is=revLookup[ss.charCodeAt(ts)]<<2|revLookup[ss.charCodeAt(ts+1)]>>4,os[us++]=is&255):as===1&&(is=revLookup[ss.charCodeAt(ts)]<<10|revLookup[ss.charCodeAt(ts+1)]<<4|revLookup[ss.charCodeAt(ts+2)]>>2,os[us++]=is>>8&255,os[us++]=is&255),os}function tripletToBase64(ss){return lookup[ss>>18&63]+lookup[ss>>12&63]+lookup[ss>>6&63]+lookup[ss&63]}function encodeChunk(ss,ts,rs){for(var ns,is=[],as=ts;as<rs;as+=3)ns=(ss[as]<<16)+(ss[as+1]<<8)+ss[as+2],is.push(tripletToBase64(ns));return is.join("")}function fromByteArray(ss){inited||init();for(var ts,rs=ss.length,ns=rs%3,is="",as=[],os=16383,ls=0,us=rs-ns;ls<us;ls+=os)as.push(encodeChunk(ss,ls,ls+os>us?us:ls+os));return ns===1?(ts=ss[rs-1],is+=lookup[ts>>2],is+=lookup[ts<<4&63],is+="=="):ns===2&&(ts=(ss[rs-2]<<8)+ss[rs-1],is+=lookup[ts>>10],is+=lookup[ts>>4&63],is+=lookup[ts<<2&63],is+="="),as.push(is),as.join("")}function read(ss,ts,rs,ns,is){var as,os,ls=is*8-ns-1,us=(1<<ls)-1,cs=us>>1,ps=-7,ds=rs?is-1:0,fs=rs?-1:1,hs=ss[ts+ds];for(ds+=fs,as=hs&(1<<-ps)-1,hs>>=-ps,ps+=ls;ps>0;as=as*256+ss[ts+ds],ds+=fs,ps-=8);for(os=as&(1<<-ps)-1,as>>=-ps,ps+=ns;ps>0;os=os*256+ss[ts+ds],ds+=fs,ps-=8);if(as===0)as=1-cs;else{if(as===us)return os?NaN:(hs?-1:1)*(1/0);os=os+Math.pow(2,ns),as=as-cs}return(hs?-1:1)*os*Math.pow(2,as-ns)}function write(ss,ts,rs,ns,is,as){var os,ls,us,cs=as*8-is-1,ps=(1<<cs)-1,ds=ps>>1,fs=is===23?Math.pow(2,-24)-Math.pow(2,-77):0,hs=ns?0:as-1,ys=ns?1:-1,gs=ts<0||ts===0&&1/ts<0?1:0;for(ts=Math.abs(ts),isNaN(ts)||ts===1/0?(ls=isNaN(ts)?1:0,os=ps):(os=Math.floor(Math.log(ts)/Math.LN2),ts*(us=Math.pow(2,-os))<1&&(os--,us*=2),os+ds>=1?ts+=fs/us:ts+=fs*Math.pow(2,1-ds),ts*us>=2&&(os++,us/=2),os+ds>=ps?(ls=0,os=ps):os+ds>=1?(ls=(ts*us-1)*Math.pow(2,is),os=os+ds):(ls=ts*Math.pow(2,ds-1)*Math.pow(2,is),os=0));is>=8;ss[rs+hs]=ls&255,hs+=ys,ls/=256,is-=8);for(os=os<<is|ls,cs+=is;cs>0;ss[rs+hs]=os&255,hs+=ys,os/=256,cs-=8);ss[rs+hs-ys]|=gs*128}var toString={}.toString,isArray=Array.isArray||function(ss){return toString.call(ss)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global$2.TYPED_ARRAY_SUPPORT!==void 0?global$2.TYPED_ARRAY_SUPPORT:!0,kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(ss,ts){if(kMaxLength()<ts)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(ss=new Uint8Array(ts),ss.__proto__=Buffer.prototype):(ss===null&&(ss=new Buffer(ts)),ss.length=ts),ss}function Buffer(ss,ts,rs){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer))return new Buffer(ss,ts,rs);if(typeof ss=="number"){if(typeof ts=="string")throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,ss)}return from(this,ss,ts,rs)}Buffer.poolSize=8192,Buffer._augment=function(ss){return ss.__proto__=Buffer.prototype,ss};function from(ss,ts,rs,ns){if(typeof ts=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&ts instanceof ArrayBuffer?fromArrayBuffer(ss,ts,rs,ns):typeof ts=="string"?fromString(ss,ts,rs):fromObject(ss,ts)}Buffer.from=function(ss,ts,rs){return from(null,ss,ts,rs)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&Buffer[Symbol.species]);function assertSize(ss){if(typeof ss!="number")throw new TypeError('"size" argument must be a number');if(ss<0)throw new RangeError('"size" argument must not be negative')}function alloc(ss,ts,rs,ns){return assertSize(ts),ts<=0?createBuffer(ss,ts):rs!==void 0?typeof ns=="string"?createBuffer(ss,ts).fill(rs,ns):createBuffer(ss,ts).fill(rs):createBuffer(ss,ts)}Buffer.alloc=function(ss,ts,rs){return alloc(null,ss,ts,rs)};function allocUnsafe(ss,ts){if(assertSize(ts),ss=createBuffer(ss,ts<0?0:checked(ts)|0),!Buffer.TYPED_ARRAY_SUPPORT)for(var rs=0;rs<ts;++rs)ss[rs]=0;return ss}Buffer.allocUnsafe=function(ss){return allocUnsafe(null,ss)},Buffer.allocUnsafeSlow=function(ss){return allocUnsafe(null,ss)};function fromString(ss,ts,rs){if((typeof rs!="string"||rs==="")&&(rs="utf8"),!Buffer.isEncoding(rs))throw new TypeError('"encoding" must be a valid string encoding');var ns=byteLength(ts,rs)|0;ss=createBuffer(ss,ns);var is=ss.write(ts,rs);return is!==ns&&(ss=ss.slice(0,is)),ss}function fromArrayLike(ss,ts){var rs=ts.length<0?0:checked(ts.length)|0;ss=createBuffer(ss,rs);for(var ns=0;ns<rs;ns+=1)ss[ns]=ts[ns]&255;return ss}function fromArrayBuffer(ss,ts,rs,ns){if(ts.byteLength,rs<0||ts.byteLength<rs)throw new RangeError("'offset' is out of bounds");if(ts.byteLength<rs+(ns||0))throw new RangeError("'length' is out of bounds");return rs===void 0&&ns===void 0?ts=new Uint8Array(ts):ns===void 0?ts=new Uint8Array(ts,rs):ts=new Uint8Array(ts,rs,ns),Buffer.TYPED_ARRAY_SUPPORT?(ss=ts,ss.__proto__=Buffer.prototype):ss=fromArrayLike(ss,ts),ss}function fromObject(ss,ts){if(internalIsBuffer(ts)){var rs=checked(ts.length)|0;return ss=createBuffer(ss,rs),ss.length===0||ts.copy(ss,0,0,rs),ss}if(ts){if(typeof ArrayBuffer<"u"&&ts.buffer instanceof ArrayBuffer||"length"in ts)return typeof ts.length!="number"||isnan(ts.length)?createBuffer(ss,0):fromArrayLike(ss,ts);if(ts.type==="Buffer"&&isArray(ts.data))return fromArrayLike(ss,ts.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(ss){if(ss>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return ss|0}Buffer.isBuffer=isBuffer;function internalIsBuffer(ss){return!!(ss!=null&&ss._isBuffer)}Buffer.compare=function ss(ts,rs){if(!internalIsBuffer(ts)||!internalIsBuffer(rs))throw new TypeError("Arguments must be Buffers");if(ts===rs)return 0;for(var ns=ts.length,is=rs.length,as=0,os=Math.min(ns,is);as<os;++as)if(ts[as]!==rs[as]){ns=ts[as],is=rs[as];break}return ns<is?-1:is<ns?1:0},Buffer.isEncoding=function ss(ts){switch(String(ts).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function ss(ts,rs){if(!isArray(ts))throw new TypeError('"list" argument must be an Array of Buffers');if(ts.length===0)return Buffer.alloc(0);var ns;if(rs===void 0)for(rs=0,ns=0;ns<ts.length;++ns)rs+=ts[ns].length;var is=Buffer.allocUnsafe(rs),as=0;for(ns=0;ns<ts.length;++ns){var os=ts[ns];if(!internalIsBuffer(os))throw new TypeError('"list" argument must be an Array of Buffers');os.copy(is,as),as+=os.length}return is};function byteLength(ss,ts){if(internalIsBuffer(ss))return ss.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(ss)||ss instanceof ArrayBuffer))return ss.byteLength;typeof ss!="string"&&(ss=""+ss);var rs=ss.length;if(rs===0)return 0;for(var ns=!1;;)switch(ts){case"ascii":case"latin1":case"binary":return rs;case"utf8":case"utf-8":case void 0:return utf8ToBytes(ss).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return rs*2;case"hex":return rs>>>1;case"base64":return base64ToBytes(ss).length;default:if(ns)return utf8ToBytes(ss).length;ts=(""+ts).toLowerCase(),ns=!0}}Buffer.byteLength=byteLength;function slowToString(ss,ts,rs){var ns=!1;if((ts===void 0||ts<0)&&(ts=0),ts>this.length||((rs===void 0||rs>this.length)&&(rs=this.length),rs<=0)||(rs>>>=0,ts>>>=0,rs<=ts))return"";for(ss||(ss="utf8");;)switch(ss){case"hex":return hexSlice(this,ts,rs);case"utf8":case"utf-8":return utf8Slice(this,ts,rs);case"ascii":return asciiSlice(this,ts,rs);case"latin1":case"binary":return latin1Slice(this,ts,rs);case"base64":return base64Slice(this,ts,rs);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,ts,rs);default:if(ns)throw new TypeError("Unknown encoding: "+ss);ss=(ss+"").toLowerCase(),ns=!0}}Buffer.prototype._isBuffer=!0;function swap(ss,ts,rs){var ns=ss[ts];ss[ts]=ss[rs],ss[rs]=ns}Buffer.prototype.swap16=function ss(){var ts=this.length;if(ts%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var rs=0;rs<ts;rs+=2)swap(this,rs,rs+1);return this},Buffer.prototype.swap32=function ss(){var ts=this.length;if(ts%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var rs=0;rs<ts;rs+=4)swap(this,rs,rs+3),swap(this,rs+1,rs+2);return this},Buffer.prototype.swap64=function ss(){var ts=this.length;if(ts%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var rs=0;rs<ts;rs+=8)swap(this,rs,rs+7),swap(this,rs+1,rs+6),swap(this,rs+2,rs+5),swap(this,rs+3,rs+4);return this},Buffer.prototype.toString=function ss(){var ts=this.length|0;return ts===0?"":arguments.length===0?utf8Slice(this,0,ts):slowToString.apply(this,arguments)},Buffer.prototype.equals=function ss(ts){if(!internalIsBuffer(ts))throw new TypeError("Argument must be a Buffer");return this===ts?!0:Buffer.compare(this,ts)===0},Buffer.prototype.inspect=function ss(){var ts="",rs=INSPECT_MAX_BYTES;return this.length>0&&(ts=this.toString("hex",0,rs).match(/.{2}/g).join(" "),this.length>rs&&(ts+=" ... ")),"<Buffer "+ts+">"},Buffer.prototype.compare=function ss(ts,rs,ns,is,as){if(!internalIsBuffer(ts))throw new TypeError("Argument must be a Buffer");if(rs===void 0&&(rs=0),ns===void 0&&(ns=ts?ts.length:0),is===void 0&&(is=0),as===void 0&&(as=this.length),rs<0||ns>ts.length||is<0||as>this.length)throw new RangeError("out of range index");if(is>=as&&rs>=ns)return 0;if(is>=as)return-1;if(rs>=ns)return 1;if(rs>>>=0,ns>>>=0,is>>>=0,as>>>=0,this===ts)return 0;for(var os=as-is,ls=ns-rs,us=Math.min(os,ls),cs=this.slice(is,as),ps=ts.slice(rs,ns),ds=0;ds<us;++ds)if(cs[ds]!==ps[ds]){os=cs[ds],ls=ps[ds];break}return os<ls?-1:ls<os?1:0};function bidirectionalIndexOf(ss,ts,rs,ns,is){if(ss.length===0)return-1;if(typeof rs=="string"?(ns=rs,rs=0):rs>2147483647?rs=2147483647:rs<-2147483648&&(rs=-2147483648),rs=+rs,isNaN(rs)&&(rs=is?0:ss.length-1),rs<0&&(rs=ss.length+rs),rs>=ss.length){if(is)return-1;rs=ss.length-1}else if(rs<0)if(is)rs=0;else return-1;if(typeof ts=="string"&&(ts=Buffer.from(ts,ns)),internalIsBuffer(ts))return ts.length===0?-1:arrayIndexOf(ss,ts,rs,ns,is);if(typeof ts=="number")return ts=ts&255,Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?is?Uint8Array.prototype.indexOf.call(ss,ts,rs):Uint8Array.prototype.lastIndexOf.call(ss,ts,rs):arrayIndexOf(ss,[ts],rs,ns,is);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(ss,ts,rs,ns,is){var as=1,os=ss.length,ls=ts.length;if(ns!==void 0&&(ns=String(ns).toLowerCase(),ns==="ucs2"||ns==="ucs-2"||ns==="utf16le"||ns==="utf-16le")){if(ss.length<2||ts.length<2)return-1;as=2,os/=2,ls/=2,rs/=2}function us(hs,ys){return as===1?hs[ys]:hs.readUInt16BE(ys*as)}var cs;if(is){var ps=-1;for(cs=rs;cs<os;cs++)if(us(ss,cs)===us(ts,ps===-1?0:cs-ps)){if(ps===-1&&(ps=cs),cs-ps+1===ls)return ps*as}else ps!==-1&&(cs-=cs-ps),ps=-1}else for(rs+ls>os&&(rs=os-ls),cs=rs;cs>=0;cs--){for(var ds=!0,fs=0;fs<ls;fs++)if(us(ss,cs+fs)!==us(ts,fs)){ds=!1;break}if(ds)return cs}return-1}Buffer.prototype.includes=function ss(ts,rs,ns){return this.indexOf(ts,rs,ns)!==-1},Buffer.prototype.indexOf=function ss(ts,rs,ns){return bidirectionalIndexOf(this,ts,rs,ns,!0)},Buffer.prototype.lastIndexOf=function ss(ts,rs,ns){return bidirectionalIndexOf(this,ts,rs,ns,!1)};function hexWrite(ss,ts,rs,ns){rs=Number(rs)||0;var is=ss.length-rs;ns?(ns=Number(ns),ns>is&&(ns=is)):ns=is;var as=ts.length;if(as%2!==0)throw new TypeError("Invalid hex string");ns>as/2&&(ns=as/2);for(var os=0;os<ns;++os){var ls=parseInt(ts.substr(os*2,2),16);if(isNaN(ls))return os;ss[rs+os]=ls}return os}function utf8Write(ss,ts,rs,ns){return blitBuffer(utf8ToBytes(ts,ss.length-rs),ss,rs,ns)}function asciiWrite(ss,ts,rs,ns){return blitBuffer(asciiToBytes(ts),ss,rs,ns)}function latin1Write(ss,ts,rs,ns){return asciiWrite(ss,ts,rs,ns)}function base64Write(ss,ts,rs,ns){return blitBuffer(base64ToBytes(ts),ss,rs,ns)}function ucs2Write(ss,ts,rs,ns){return blitBuffer(utf16leToBytes(ts,ss.length-rs),ss,rs,ns)}Buffer.prototype.write=function ss(ts,rs,ns,is){if(rs===void 0)is="utf8",ns=this.length,rs=0;else if(ns===void 0&&typeof rs=="string")is=rs,ns=this.length,rs=0;else if(isFinite(rs))rs=rs|0,isFinite(ns)?(ns=ns|0,is===void 0&&(is="utf8")):(is=ns,ns=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var as=this.length-rs;if((ns===void 0||ns>as)&&(ns=as),ts.length>0&&(ns<0||rs<0)||rs>this.length)throw new RangeError("Attempt to write outside buffer bounds");is||(is="utf8");for(var os=!1;;)switch(is){case"hex":return hexWrite(this,ts,rs,ns);case"utf8":case"utf-8":return utf8Write(this,ts,rs,ns);case"ascii":return asciiWrite(this,ts,rs,ns);case"latin1":case"binary":return latin1Write(this,ts,rs,ns);case"base64":return base64Write(this,ts,rs,ns);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,ts,rs,ns);default:if(os)throw new TypeError("Unknown encoding: "+is);is=(""+is).toLowerCase(),os=!0}},Buffer.prototype.toJSON=function ss(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(ss,ts,rs){return ts===0&&rs===ss.length?fromByteArray(ss):fromByteArray(ss.slice(ts,rs))}function utf8Slice(ss,ts,rs){rs=Math.min(ss.length,rs);for(var ns=[],is=ts;is<rs;){var as=ss[is],os=null,ls=as>239?4:as>223?3:as>191?2:1;if(is+ls<=rs){var us,cs,ps,ds;switch(ls){case 1:as<128&&(os=as);break;case 2:us=ss[is+1],(us&192)===128&&(ds=(as&31)<<6|us&63,ds>127&&(os=ds));break;case 3:us=ss[is+1],cs=ss[is+2],(us&192)===128&&(cs&192)===128&&(ds=(as&15)<<12|(us&63)<<6|cs&63,ds>2047&&(ds<55296||ds>57343)&&(os=ds));break;case 4:us=ss[is+1],cs=ss[is+2],ps=ss[is+3],(us&192)===128&&(cs&192)===128&&(ps&192)===128&&(ds=(as&15)<<18|(us&63)<<12|(cs&63)<<6|ps&63,ds>65535&&ds<1114112&&(os=ds))}}os===null?(os=65533,ls=1):os>65535&&(os-=65536,ns.push(os>>>10&1023|55296),os=56320|os&1023),ns.push(os),is+=ls}return decodeCodePointsArray(ns)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(ss){var ts=ss.length;if(ts<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,ss);for(var rs="",ns=0;ns<ts;)rs+=String.fromCharCode.apply(String,ss.slice(ns,ns+=MAX_ARGUMENTS_LENGTH));return rs}function asciiSlice(ss,ts,rs){var ns="";rs=Math.min(ss.length,rs);for(var is=ts;is<rs;++is)ns+=String.fromCharCode(ss[is]&127);return ns}function latin1Slice(ss,ts,rs){var ns="";rs=Math.min(ss.length,rs);for(var is=ts;is<rs;++is)ns+=String.fromCharCode(ss[is]);return ns}function hexSlice(ss,ts,rs){var ns=ss.length;(!ts||ts<0)&&(ts=0),(!rs||rs<0||rs>ns)&&(rs=ns);for(var is="",as=ts;as<rs;++as)is+=toHex(ss[as]);return is}function utf16leSlice(ss,ts,rs){for(var ns=ss.slice(ts,rs),is="",as=0;as<ns.length;as+=2)is+=String.fromCharCode(ns[as]+ns[as+1]*256);return is}Buffer.prototype.slice=function ss(ts,rs){var ns=this.length;ts=~~ts,rs=rs===void 0?ns:~~rs,ts<0?(ts+=ns,ts<0&&(ts=0)):ts>ns&&(ts=ns),rs<0?(rs+=ns,rs<0&&(rs=0)):rs>ns&&(rs=ns),rs<ts&&(rs=ts);var is;if(Buffer.TYPED_ARRAY_SUPPORT)is=this.subarray(ts,rs),is.__proto__=Buffer.prototype;else{var as=rs-ts;is=new Buffer(as,void 0);for(var os=0;os<as;++os)is[os]=this[os+ts]}return is};function checkOffset(ss,ts,rs){if(ss%1!==0||ss<0)throw new RangeError("offset is not uint");if(ss+ts>rs)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function ss(ts,rs,ns){ts=ts|0,rs=rs|0,ns||checkOffset(ts,rs,this.length);for(var is=this[ts],as=1,os=0;++os<rs&&(as*=256);)is+=this[ts+os]*as;return is},Buffer.prototype.readUIntBE=function ss(ts,rs,ns){ts=ts|0,rs=rs|0,ns||checkOffset(ts,rs,this.length);for(var is=this[ts+--rs],as=1;rs>0&&(as*=256);)is+=this[ts+--rs]*as;return is},Buffer.prototype.readUInt8=function ss(ts,rs){return rs||checkOffset(ts,1,this.length),this[ts]},Buffer.prototype.readUInt16LE=function ss(ts,rs){return rs||checkOffset(ts,2,this.length),this[ts]|this[ts+1]<<8},Buffer.prototype.readUInt16BE=function ss(ts,rs){return rs||checkOffset(ts,2,this.length),this[ts]<<8|this[ts+1]},Buffer.prototype.readUInt32LE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),(this[ts]|this[ts+1]<<8|this[ts+2]<<16)+this[ts+3]*16777216},Buffer.prototype.readUInt32BE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),this[ts]*16777216+(this[ts+1]<<16|this[ts+2]<<8|this[ts+3])},Buffer.prototype.readIntLE=function ss(ts,rs,ns){ts=ts|0,rs=rs|0,ns||checkOffset(ts,rs,this.length);for(var is=this[ts],as=1,os=0;++os<rs&&(as*=256);)is+=this[ts+os]*as;return as*=128,is>=as&&(is-=Math.pow(2,8*rs)),is},Buffer.prototype.readIntBE=function ss(ts,rs,ns){ts=ts|0,rs=rs|0,ns||checkOffset(ts,rs,this.length);for(var is=rs,as=1,os=this[ts+--is];is>0&&(as*=256);)os+=this[ts+--is]*as;return as*=128,os>=as&&(os-=Math.pow(2,8*rs)),os},Buffer.prototype.readInt8=function ss(ts,rs){return rs||checkOffset(ts,1,this.length),this[ts]&128?(255-this[ts]+1)*-1:this[ts]},Buffer.prototype.readInt16LE=function ss(ts,rs){rs||checkOffset(ts,2,this.length);var ns=this[ts]|this[ts+1]<<8;return ns&32768?ns|4294901760:ns},Buffer.prototype.readInt16BE=function ss(ts,rs){rs||checkOffset(ts,2,this.length);var ns=this[ts+1]|this[ts]<<8;return ns&32768?ns|4294901760:ns},Buffer.prototype.readInt32LE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),this[ts]|this[ts+1]<<8|this[ts+2]<<16|this[ts+3]<<24},Buffer.prototype.readInt32BE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),this[ts]<<24|this[ts+1]<<16|this[ts+2]<<8|this[ts+3]},Buffer.prototype.readFloatLE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),read(this,ts,!0,23,4)},Buffer.prototype.readFloatBE=function ss(ts,rs){return rs||checkOffset(ts,4,this.length),read(this,ts,!1,23,4)},Buffer.prototype.readDoubleLE=function ss(ts,rs){return rs||checkOffset(ts,8,this.length),read(this,ts,!0,52,8)},Buffer.prototype.readDoubleBE=function ss(ts,rs){return rs||checkOffset(ts,8,this.length),read(this,ts,!1,52,8)};function checkInt(ss,ts,rs,ns,is,as){if(!internalIsBuffer(ss))throw new TypeError('"buffer" argument must be a Buffer instance');if(ts>is||ts<as)throw new RangeError('"value" argument is out of bounds');if(rs+ns>ss.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function ss(ts,rs,ns,is){if(ts=+ts,rs=rs|0,ns=ns|0,!is){var as=Math.pow(2,8*ns)-1;checkInt(this,ts,rs,ns,as,0)}var os=1,ls=0;for(this[rs]=ts&255;++ls<ns&&(os*=256);)this[rs+ls]=ts/os&255;return rs+ns},Buffer.prototype.writeUIntBE=function ss(ts,rs,ns,is){if(ts=+ts,rs=rs|0,ns=ns|0,!is){var as=Math.pow(2,8*ns)-1;checkInt(this,ts,rs,ns,as,0)}var os=ns-1,ls=1;for(this[rs+os]=ts&255;--os>=0&&(ls*=256);)this[rs+os]=ts/ls&255;return rs+ns},Buffer.prototype.writeUInt8=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(ts=Math.floor(ts)),this[rs]=ts&255,rs+1};function objectWriteUInt16(ss,ts,rs,ns){ts<0&&(ts=65535+ts+1);for(var is=0,as=Math.min(ss.length-rs,2);is<as;++is)ss[rs+is]=(ts&255<<8*(ns?is:1-is))>>>(ns?is:1-is)*8}Buffer.prototype.writeUInt16LE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts&255,this[rs+1]=ts>>>8):objectWriteUInt16(this,ts,rs,!0),rs+2},Buffer.prototype.writeUInt16BE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts>>>8,this[rs+1]=ts&255):objectWriteUInt16(this,ts,rs,!1),rs+2};function objectWriteUInt32(ss,ts,rs,ns){ts<0&&(ts=4294967295+ts+1);for(var is=0,as=Math.min(ss.length-rs,4);is<as;++is)ss[rs+is]=ts>>>(ns?is:3-is)*8&255}Buffer.prototype.writeUInt32LE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[rs+3]=ts>>>24,this[rs+2]=ts>>>16,this[rs+1]=ts>>>8,this[rs]=ts&255):objectWriteUInt32(this,ts,rs,!0),rs+4},Buffer.prototype.writeUInt32BE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts>>>24,this[rs+1]=ts>>>16,this[rs+2]=ts>>>8,this[rs+3]=ts&255):objectWriteUInt32(this,ts,rs,!1),rs+4},Buffer.prototype.writeIntLE=function ss(ts,rs,ns,is){if(ts=+ts,rs=rs|0,!is){var as=Math.pow(2,8*ns-1);checkInt(this,ts,rs,ns,as-1,-as)}var os=0,ls=1,us=0;for(this[rs]=ts&255;++os<ns&&(ls*=256);)ts<0&&us===0&&this[rs+os-1]!==0&&(us=1),this[rs+os]=(ts/ls>>0)-us&255;return rs+ns},Buffer.prototype.writeIntBE=function ss(ts,rs,ns,is){if(ts=+ts,rs=rs|0,!is){var as=Math.pow(2,8*ns-1);checkInt(this,ts,rs,ns,as-1,-as)}var os=ns-1,ls=1,us=0;for(this[rs+os]=ts&255;--os>=0&&(ls*=256);)ts<0&&us===0&&this[rs+os+1]!==0&&(us=1),this[rs+os]=(ts/ls>>0)-us&255;return rs+ns},Buffer.prototype.writeInt8=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(ts=Math.floor(ts)),ts<0&&(ts=255+ts+1),this[rs]=ts&255,rs+1},Buffer.prototype.writeInt16LE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts&255,this[rs+1]=ts>>>8):objectWriteUInt16(this,ts,rs,!0),rs+2},Buffer.prototype.writeInt16BE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts>>>8,this[rs+1]=ts&255):objectWriteUInt16(this,ts,rs,!1),rs+2},Buffer.prototype.writeInt32LE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts&255,this[rs+1]=ts>>>8,this[rs+2]=ts>>>16,this[rs+3]=ts>>>24):objectWriteUInt32(this,ts,rs,!0),rs+4},Buffer.prototype.writeInt32BE=function ss(ts,rs,ns){return ts=+ts,rs=rs|0,ns||checkInt(this,ts,rs,4,2147483647,-2147483648),ts<0&&(ts=4294967295+ts+1),Buffer.TYPED_ARRAY_SUPPORT?(this[rs]=ts>>>24,this[rs+1]=ts>>>16,this[rs+2]=ts>>>8,this[rs+3]=ts&255):objectWriteUInt32(this,ts,rs,!1),rs+4};function checkIEEE754(ss,ts,rs,ns,is,as){if(rs+ns>ss.length)throw new RangeError("Index out of range");if(rs<0)throw new RangeError("Index out of range")}function writeFloat(ss,ts,rs,ns,is){return is||checkIEEE754(ss,ts,rs,4),write(ss,ts,rs,ns,23,4),rs+4}Buffer.prototype.writeFloatLE=function ss(ts,rs,ns){return writeFloat(this,ts,rs,!0,ns)},Buffer.prototype.writeFloatBE=function ss(ts,rs,ns){return writeFloat(this,ts,rs,!1,ns)};function writeDouble(ss,ts,rs,ns,is){return is||checkIEEE754(ss,ts,rs,8),write(ss,ts,rs,ns,52,8),rs+8}Buffer.prototype.writeDoubleLE=function ss(ts,rs,ns){return writeDouble(this,ts,rs,!0,ns)},Buffer.prototype.writeDoubleBE=function ss(ts,rs,ns){return writeDouble(this,ts,rs,!1,ns)},Buffer.prototype.copy=function ss(ts,rs,ns,is){if(ns||(ns=0),!is&&is!==0&&(is=this.length),rs>=ts.length&&(rs=ts.length),rs||(rs=0),is>0&&is<ns&&(is=ns),is===ns||ts.length===0||this.length===0)return 0;if(rs<0)throw new RangeError("targetStart out of bounds");if(ns<0||ns>=this.length)throw new RangeError("sourceStart out of bounds");if(is<0)throw new RangeError("sourceEnd out of bounds");is>this.length&&(is=this.length),ts.length-rs<is-ns&&(is=ts.length-rs+ns);var as=is-ns,os;if(this===ts&&ns<rs&&rs<is)for(os=as-1;os>=0;--os)ts[os+rs]=this[os+ns];else if(as<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(os=0;os<as;++os)ts[os+rs]=this[os+ns];else Uint8Array.prototype.set.call(ts,this.subarray(ns,ns+as),rs);return as},Buffer.prototype.fill=function ss(ts,rs,ns,is){if(typeof ts=="string"){if(typeof rs=="string"?(is=rs,rs=0,ns=this.length):typeof ns=="string"&&(is=ns,ns=this.length),ts.length===1){var as=ts.charCodeAt(0);as<256&&(ts=as)}if(is!==void 0&&typeof is!="string")throw new TypeError("encoding must be a string");if(typeof is=="string"&&!Buffer.isEncoding(is))throw new TypeError("Unknown encoding: "+is)}else typeof ts=="number"&&(ts=ts&255);if(rs<0||this.length<rs||this.length<ns)throw new RangeError("Out of range index");if(ns<=rs)return this;rs=rs>>>0,ns=ns===void 0?this.length:ns>>>0,ts||(ts=0);var os;if(typeof ts=="number")for(os=rs;os<ns;++os)this[os]=ts;else{var ls=internalIsBuffer(ts)?ts:utf8ToBytes(new Buffer(ts,is).toString()),us=ls.length;for(os=0;os<ns-rs;++os)this[os+rs]=ls[os%us]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(ss){if(ss=stringtrim(ss).replace(INVALID_BASE64_RE,""),ss.length<2)return"";for(;ss.length%4!==0;)ss=ss+"=";return ss}function stringtrim(ss){return ss.trim?ss.trim():ss.replace(/^\s+|\s+$/g,"")}function toHex(ss){return ss<16?"0"+ss.toString(16):ss.toString(16)}function utf8ToBytes(ss,ts){ts=ts||1/0;for(var rs,ns=ss.length,is=null,as=[],os=0;os<ns;++os){if(rs=ss.charCodeAt(os),rs>55295&&rs<57344){if(!is){if(rs>56319){(ts-=3)>-1&&as.push(239,191,189);continue}else if(os+1===ns){(ts-=3)>-1&&as.push(239,191,189);continue}is=rs;continue}if(rs<56320){(ts-=3)>-1&&as.push(239,191,189),is=rs;continue}rs=(is-55296<<10|rs-56320)+65536}else is&&(ts-=3)>-1&&as.push(239,191,189);if(is=null,rs<128){if((ts-=1)<0)break;as.push(rs)}else if(rs<2048){if((ts-=2)<0)break;as.push(rs>>6|192,rs&63|128)}else if(rs<65536){if((ts-=3)<0)break;as.push(rs>>12|224,rs>>6&63|128,rs&63|128)}else if(rs<1114112){if((ts-=4)<0)break;as.push(rs>>18|240,rs>>12&63|128,rs>>6&63|128,rs&63|128)}else throw new Error("Invalid code point")}return as}function asciiToBytes(ss){for(var ts=[],rs=0;rs<ss.length;++rs)ts.push(ss.charCodeAt(rs)&255);return ts}function utf16leToBytes(ss,ts){for(var rs,ns,is,as=[],os=0;os<ss.length&&!((ts-=2)<0);++os)rs=ss.charCodeAt(os),ns=rs>>8,is=rs%256,as.push(is),as.push(ns);return as}function base64ToBytes(ss){return toByteArray(base64clean(ss))}function blitBuffer(ss,ts,rs,ns){for(var is=0;is<ns&&!(is+rs>=ts.length||is>=ss.length);++is)ts[is+rs]=ss[is];return is}function isnan(ss){return ss!==ss}function isBuffer(ss){return ss!=null&&(!!ss._isBuffer||isFastBuffer(ss)||isSlowBuffer(ss))}function isFastBuffer(ss){return!!ss.constructor&&typeof ss.constructor.isBuffer=="function"&&ss.constructor.isBuffer(ss)}function isSlowBuffer(ss){return typeof ss.readFloatLE=="function"&&typeof ss.slice=="function"&&isFastBuffer(ss.slice(0,0))}var utils$6=utils$b;function toFormData$1(ss,ts){ts=ts||new FormData;var rs=[];function ns(as){return as===null?"":utils$6.isDate(as)?as.toISOString():utils$6.isArrayBuffer(as)||utils$6.isTypedArray(as)?typeof Blob=="function"?new Blob([as]):Buffer.from(as):as}function is(as,os){if(utils$6.isPlainObject(as)||utils$6.isArray(as)){if(rs.indexOf(as)!==-1)throw Error("Circular reference detected in "+os);rs.push(as),utils$6.forEach(as,function(us,cs){if(!utils$6.isUndefined(us)){var ps=os?os+"."+cs:cs,ds;if(us&&!os&&typeof us=="object"){if(utils$6.endsWith(cs,"{}"))us=JSON.stringify(us);else if(utils$6.endsWith(cs,"[]")&&(ds=utils$6.toArray(us))){ds.forEach(function(fs){!utils$6.isUndefined(fs)&&ts.append(ps,ns(fs))});return}}is(us,ps)}}),rs.pop()}else ts.append(os,ns(as))}return is(ss),ts}var toFormData_1=toFormData$1,settle,hasRequiredSettle;function requireSettle(){if(hasRequiredSettle)return settle;hasRequiredSettle=1;var ss=AxiosError_1;return settle=function(rs,ns,is){var as=is.config.validateStatus;!is.status||!as||as(is.status)?rs(is):ns(new ss("Request failed with status code "+is.status,[ss.ERR_BAD_REQUEST,ss.ERR_BAD_RESPONSE][Math.floor(is.status/100)-4],is.config,is.request,is))},settle}var cookies,hasRequiredCookies;function requireCookies(){if(hasRequiredCookies)return cookies;hasRequiredCookies=1;var ss=utils$b;return cookies=ss.isStandardBrowserEnv()?function(){return{write:function(ns,is,as,os,ls,us){var cs=[];cs.push(ns+"="+encodeURIComponent(is)),ss.isNumber(as)&&cs.push("expires="+new Date(as).toGMTString()),ss.isString(os)&&cs.push("path="+os),ss.isString(ls)&&cs.push("domain="+ls),us===!0&&cs.push("secure"),document.cookie=cs.join("; ")},read:function(ns){var is=document.cookie.match(new RegExp("(^|;\\s*)("+ns+")=([^;]*)"));return is?decodeURIComponent(is[3]):null},remove:function(ns){this.write(ns,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),cookies}var isAbsoluteURL$1=function ss(ts){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(ts)},combineURLs$1=function ss(ts,rs){return rs?ts.replace(/\/+$/,"")+"/"+rs.replace(/^\/+/,""):ts},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function ss(ts,rs){return ts&&!isAbsoluteURL(rs)?combineURLs(ts,rs):rs},parseHeaders,hasRequiredParseHeaders;function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders;hasRequiredParseHeaders=1;var ss=utils$b,ts=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders=function(ns){var is={},as,os,ls;return ns&&ss.forEach(ns.split(`
`),function(cs){if(ls=cs.indexOf(":"),as=ss.trim(cs.substr(0,ls)).toLowerCase(),os=ss.trim(cs.substr(ls+1)),as){if(is[as]&&ts.indexOf(as)>=0)return;as==="set-cookie"?is[as]=(is[as]?is[as]:[]).concat([os]):is[as]=is[as]?is[as]+", "+os:os}}),is},parseHeaders}var isURLSameOrigin,hasRequiredIsURLSameOrigin;function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin;hasRequiredIsURLSameOrigin=1;var ss=utils$b;return isURLSameOrigin=ss.isStandardBrowserEnv()?function(){var rs=/(msie|trident)/i.test(navigator.userAgent),ns=document.createElement("a"),is;function as(os){var ls=os;return rs&&(ns.setAttribute("href",ls),ls=ns.href),ns.setAttribute("href",ls),{href:ns.href,protocol:ns.protocol?ns.protocol.replace(/:$/,""):"",host:ns.host,search:ns.search?ns.search.replace(/^\?/,""):"",hash:ns.hash?ns.hash.replace(/^#/,""):"",hostname:ns.hostname,port:ns.port,pathname:ns.pathname.charAt(0)==="/"?ns.pathname:"/"+ns.pathname}}return is=as(window.location.href),function(ls){var us=ss.isString(ls)?as(ls):ls;return us.protocol===is.protocol&&us.host===is.host}}():function(){return function(){return!0}}(),isURLSameOrigin}var CanceledError_1,hasRequiredCanceledError;function requireCanceledError(){if(hasRequiredCanceledError)return CanceledError_1;hasRequiredCanceledError=1;var ss=AxiosError_1,ts=utils$b;function rs(ns){ss.call(this,ns??"canceled",ss.ERR_CANCELED),this.name="CanceledError"}return ts.inherits(rs,ss,{__CANCEL__:!0}),CanceledError_1=rs,CanceledError_1}var parseProtocol,hasRequiredParseProtocol;function requireParseProtocol(){return hasRequiredParseProtocol||(hasRequiredParseProtocol=1,parseProtocol=function(ts){var rs=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ts);return rs&&rs[1]||""}),parseProtocol}var xhr,hasRequiredXhr;function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var ss=utils$b,ts=requireSettle(),rs=requireCookies(),ns=buildURL$1,is=buildFullPath$1,as=requireParseHeaders(),os=requireIsURLSameOrigin(),ls=transitional,us=AxiosError_1,cs=requireCanceledError(),ps=requireParseProtocol();return xhr=function(fs){return new Promise(function(ys,gs){var bs=fs.data,vs=fs.headers,Ns=fs.responseType,Ts;function Cs(){fs.cancelToken&&fs.cancelToken.unsubscribe(Ts),fs.signal&&fs.signal.removeEventListener("abort",Ts)}ss.isFormData(bs)&&ss.isStandardBrowserEnv()&&delete vs["Content-Type"];var xs=new XMLHttpRequest;if(fs.auth){var As=fs.auth.username||"",ws=fs.auth.password?unescape(encodeURIComponent(fs.auth.password)):"";vs.Authorization="Basic "+btoa(As+":"+ws)}var Es=is(fs.baseURL,fs.url);xs.open(fs.method.toUpperCase(),ns(Es,fs.params,fs.paramsSerializer),!0),xs.timeout=fs.timeout;function Ss(){if(xs){var Is="getAllResponseHeaders"in xs?as(xs.getAllResponseHeaders()):null,Os=!Ns||Ns==="text"||Ns==="json"?xs.responseText:xs.response,Ps={data:Os,status:xs.status,statusText:xs.statusText,headers:Is,config:fs,request:xs};ts(function(Rs){ys(Rs),Cs()},function(Rs){gs(Rs),Cs()},Ps),xs=null}}if("onloadend"in xs?xs.onloadend=Ss:xs.onreadystatechange=function(){!xs||xs.readyState!==4||xs.status===0&&!(xs.responseURL&&xs.responseURL.indexOf("file:")===0)||setTimeout(Ss)},xs.onabort=function(){xs&&(gs(new us("Request aborted",us.ECONNABORTED,fs,xs)),xs=null)},xs.onerror=function(){gs(new us("Network Error",us.ERR_NETWORK,fs,xs,xs)),xs=null},xs.ontimeout=function(){var Os=fs.timeout?"timeout of "+fs.timeout+"ms exceeded":"timeout exceeded",Ps=fs.transitional||ls;fs.timeoutErrorMessage&&(Os=fs.timeoutErrorMessage),gs(new us(Os,Ps.clarifyTimeoutError?us.ETIMEDOUT:us.ECONNABORTED,fs,xs)),xs=null},ss.isStandardBrowserEnv()){var Ds=(fs.withCredentials||os(Es))&&fs.xsrfCookieName?rs.read(fs.xsrfCookieName):void 0;Ds&&(vs[fs.xsrfHeaderName]=Ds)}"setRequestHeader"in xs&&ss.forEach(vs,function(Os,Ps){typeof bs>"u"&&Ps.toLowerCase()==="content-type"?delete vs[Ps]:xs.setRequestHeader(Ps,Os)}),ss.isUndefined(fs.withCredentials)||(xs.withCredentials=!!fs.withCredentials),Ns&&Ns!=="json"&&(xs.responseType=fs.responseType),typeof fs.onDownloadProgress=="function"&&xs.addEventListener("progress",fs.onDownloadProgress),typeof fs.onUploadProgress=="function"&&xs.upload&&xs.upload.addEventListener("progress",fs.onUploadProgress),(fs.cancelToken||fs.signal)&&(Ts=function(Is){xs&&(gs(!Is||Is&&Is.type?new cs:Is),xs.abort(),xs=null)},fs.cancelToken&&fs.cancelToken.subscribe(Ts),fs.signal&&(fs.signal.aborted?Ts():fs.signal.addEventListener("abort",Ts))),bs||(bs=null);var Vs=ps(Es);if(Vs&&["http","https","file"].indexOf(Vs)===-1){gs(new us("Unsupported protocol "+Vs+":",us.ERR_BAD_REQUEST,fs));return}xs.send(bs)})},xhr}var _null,hasRequired_null;function require_null(){return hasRequired_null||(hasRequired_null=1,_null=null),_null}var utils$5=utils$b,normalizeHeaderName=normalizeHeaderName$1,AxiosError$1=AxiosError_1,transitionalDefaults=transitional,toFormData=toFormData_1,DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(ss,ts){!utils$5.isUndefined(ss)&&utils$5.isUndefined(ss["Content-Type"])&&(ss["Content-Type"]=ts)}function getDefaultAdapter(){var ss;return(typeof XMLHttpRequest<"u"||typeof browser$1<"u"&&Object.prototype.toString.call(browser$1)==="[object process]")&&(ss=requireXhr()),ss}function stringifySafely(ss,ts,rs){if(utils$5.isString(ss))try{return(ts||JSON.parse)(ss),utils$5.trim(ss)}catch(ns){if(ns.name!=="SyntaxError")throw ns}return(rs||JSON.stringify)(ss)}var defaults$3={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function ss(ts,rs){if(normalizeHeaderName(rs,"Accept"),normalizeHeaderName(rs,"Content-Type"),utils$5.isFormData(ts)||utils$5.isArrayBuffer(ts)||utils$5.isBuffer(ts)||utils$5.isStream(ts)||utils$5.isFile(ts)||utils$5.isBlob(ts))return ts;if(utils$5.isArrayBufferView(ts))return ts.buffer;if(utils$5.isURLSearchParams(ts))return setContentTypeIfUnset(rs,"application/x-www-form-urlencoded;charset=utf-8"),ts.toString();var ns=utils$5.isObject(ts),is=rs&&rs["Content-Type"],as;if((as=utils$5.isFileList(ts))||ns&&is==="multipart/form-data"){var os=this.env&&this.env.FormData;return toFormData(as?{"files[]":ts}:ts,os&&new os)}else if(ns||is==="application/json")return setContentTypeIfUnset(rs,"application/json"),stringifySafely(ts);return ts}],transformResponse:[function ss(ts){var rs=this.transitional||defaults$3.transitional,ns=rs&&rs.silentJSONParsing,is=rs&&rs.forcedJSONParsing,as=!ns&&this.responseType==="json";if(as||is&&utils$5.isString(ts)&&ts.length)try{return JSON.parse(ts)}catch(os){if(as)throw os.name==="SyntaxError"?AxiosError$1.from(os,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):os}return ts}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:require_null()},validateStatus:function ss(ts){return ts>=200&&ts<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$5.forEach(["delete","get","head"],function ss(ts){defaults$3.headers[ts]={}}),utils$5.forEach(["post","put","patch"],function ss(ts){defaults$3.headers[ts]=utils$5.merge(DEFAULT_CONTENT_TYPE)});var defaults_1=defaults$3,utils$4=utils$b,defaults$2=defaults_1,transformData$1=function ss(ts,rs,ns){var is=this||defaults$2;return utils$4.forEach(ns,function(os){ts=os.call(is,ts,rs)}),ts},isCancel$1,hasRequiredIsCancel;function requireIsCancel(){return hasRequiredIsCancel||(hasRequiredIsCancel=1,isCancel$1=function(ts){return!!(ts&&ts.__CANCEL__)}),isCancel$1}var utils$3=utils$b,transformData=transformData$1,isCancel=requireIsCancel(),defaults$1=defaults_1,CanceledError=requireCanceledError();function throwIfCancellationRequested(ss){if(ss.cancelToken&&ss.cancelToken.throwIfRequested(),ss.signal&&ss.signal.aborted)throw new CanceledError}var dispatchRequest$1=function ss(ts){throwIfCancellationRequested(ts),ts.headers=ts.headers||{},ts.data=transformData.call(ts,ts.data,ts.headers,ts.transformRequest),ts.headers=utils$3.merge(ts.headers.common||{},ts.headers[ts.method]||{},ts.headers),utils$3.forEach(["delete","get","head","post","put","patch","common"],function(is){delete ts.headers[is]});var rs=ts.adapter||defaults$1.adapter;return rs(ts).then(function(is){return throwIfCancellationRequested(ts),is.data=transformData.call(ts,is.data,is.headers,ts.transformResponse),is},function(is){return isCancel(is)||(throwIfCancellationRequested(ts),is&&is.response&&(is.response.data=transformData.call(ts,is.response.data,is.response.headers,ts.transformResponse))),Promise.reject(is)})},utils$2=utils$b,mergeConfig$2=function ss(ts,rs){rs=rs||{};var ns={};function is(ps,ds){return utils$2.isPlainObject(ps)&&utils$2.isPlainObject(ds)?utils$2.merge(ps,ds):utils$2.isPlainObject(ds)?utils$2.merge({},ds):utils$2.isArray(ds)?ds.slice():ds}function as(ps){if(utils$2.isUndefined(rs[ps])){if(!utils$2.isUndefined(ts[ps]))return is(void 0,ts[ps])}else return is(ts[ps],rs[ps])}function os(ps){if(!utils$2.isUndefined(rs[ps]))return is(void 0,rs[ps])}function ls(ps){if(utils$2.isUndefined(rs[ps])){if(!utils$2.isUndefined(ts[ps]))return is(void 0,ts[ps])}else return is(void 0,rs[ps])}function us(ps){if(ps in rs)return is(ts[ps],rs[ps]);if(ps in ts)return is(void 0,ts[ps])}var cs={url:os,method:os,data:os,baseURL:ls,transformRequest:ls,transformResponse:ls,paramsSerializer:ls,timeout:ls,timeoutMessage:ls,withCredentials:ls,adapter:ls,responseType:ls,xsrfCookieName:ls,xsrfHeaderName:ls,onUploadProgress:ls,onDownloadProgress:ls,decompress:ls,maxContentLength:ls,maxBodyLength:ls,beforeRedirect:ls,transport:ls,httpAgent:ls,httpsAgent:ls,cancelToken:ls,socketPath:ls,responseEncoding:ls,validateStatus:us};return utils$2.forEach(Object.keys(ts).concat(Object.keys(rs)),function(ds){var fs=cs[ds]||as,hs=fs(ds);utils$2.isUndefined(hs)&&fs!==us||(ns[ds]=hs)}),ns},data,hasRequiredData;function requireData(){return hasRequiredData||(hasRequiredData=1,data={version:"0.27.2"}),data}var VERSION=requireData().version,AxiosError=AxiosError_1,validators$1={};["object","boolean","number","function","string","symbol"].forEach(function(ss,ts){validators$1[ss]=function(ns){return typeof ns===ss||"a"+(ts<1?"n ":" ")+ss}});var deprecatedWarnings={};validators$1.transitional=function ss(ts,rs,ns){function is(as,os){return"[Axios v"+VERSION+"] Transitional option '"+as+"'"+os+(ns?". "+ns:"")}return function(as,os,ls){if(ts===!1)throw new AxiosError(is(os," has been removed"+(rs?" in "+rs:"")),AxiosError.ERR_DEPRECATED);return rs&&!deprecatedWarnings[os]&&(deprecatedWarnings[os]=!0,console.warn(is(os," has been deprecated since v"+rs+" and will be removed in the near future"))),ts?ts(as,os,ls):!0}};function assertOptions(ss,ts,rs){if(typeof ss!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);for(var ns=Object.keys(ss),is=ns.length;is-- >0;){var as=ns[is],os=ts[as];if(os){var ls=ss[as],us=ls===void 0||os(ls,as,ss);if(us!==!0)throw new AxiosError("option "+as+" must be "+us,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(rs!==!0)throw new AxiosError("Unknown option "+as,AxiosError.ERR_BAD_OPTION)}}var validator$1={assertOptions,validators:validators$1},utils$1=utils$b,buildURL=buildURL$1,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,buildFullPath=buildFullPath$1,validator=validator$1,validators=validator.validators;function Axios$1(ss){this.defaults=ss,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function ss(ts,rs){typeof ts=="string"?(rs=rs||{},rs.url=ts):rs=ts||{},rs=mergeConfig$1(this.defaults,rs),rs.method?rs.method=rs.method.toLowerCase():this.defaults.method?rs.method=this.defaults.method.toLowerCase():rs.method="get";var ns=rs.transitional;ns!==void 0&&validator.assertOptions(ns,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var is=[],as=!0;this.interceptors.request.forEach(function(hs){typeof hs.runWhen=="function"&&hs.runWhen(rs)===!1||(as=as&&hs.synchronous,is.unshift(hs.fulfilled,hs.rejected))});var os=[];this.interceptors.response.forEach(function(hs){os.push(hs.fulfilled,hs.rejected)});var ls;if(!as){var us=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(us,is),us=us.concat(os),ls=Promise.resolve(rs);us.length;)ls=ls.then(us.shift(),us.shift());return ls}for(var cs=rs;is.length;){var ps=is.shift(),ds=is.shift();try{cs=ps(cs)}catch(fs){ds(fs);break}}try{ls=dispatchRequest(cs)}catch(fs){return Promise.reject(fs)}for(;os.length;)ls=ls.then(os.shift(),os.shift());return ls},Axios$1.prototype.getUri=function ss(ts){ts=mergeConfig$1(this.defaults,ts);var rs=buildFullPath(ts.baseURL,ts.url);return buildURL(rs,ts.params,ts.paramsSerializer)},utils$1.forEach(["delete","get","head","options"],function ss(ts){Axios$1.prototype[ts]=function(rs,ns){return this.request(mergeConfig$1(ns||{},{method:ts,url:rs,data:(ns||{}).data}))}}),utils$1.forEach(["post","put","patch"],function ss(ts){function rs(ns){return function(as,os,ls){return this.request(mergeConfig$1(ls||{},{method:ts,headers:ns?{"Content-Type":"multipart/form-data"}:{},url:as,data:os}))}}Axios$1.prototype[ts]=rs(),Axios$1.prototype[ts+"Form"]=rs(!0)});var Axios_1=Axios$1,CancelToken_1,hasRequiredCancelToken;function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var ss=requireCanceledError();function ts(rs){if(typeof rs!="function")throw new TypeError("executor must be a function.");var ns;this.promise=new Promise(function(os){ns=os});var is=this;this.promise.then(function(as){if(is._listeners){var os,ls=is._listeners.length;for(os=0;os<ls;os++)is._listeners[os](as);is._listeners=null}}),this.promise.then=function(as){var os,ls=new Promise(function(us){is.subscribe(us),os=us}).then(as);return ls.cancel=function(){is.unsubscribe(os)},ls},rs(function(os){is.reason||(is.reason=new ss(os),ns(is.reason))})}return ts.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ts.prototype.subscribe=function(ns){if(this.reason){ns(this.reason);return}this._listeners?this._listeners.push(ns):this._listeners=[ns]},ts.prototype.unsubscribe=function(ns){if(this._listeners){var is=this._listeners.indexOf(ns);is!==-1&&this._listeners.splice(is,1)}},ts.source=function(){var ns,is=new ts(function(os){ns=os});return{token:is,cancel:ns}},CancelToken_1=ts,CancelToken_1}var spread,hasRequiredSpread;function requireSpread(){return hasRequiredSpread||(hasRequiredSpread=1,spread=function(ts){return function(ns){return ts.apply(null,ns)}}),spread}var isAxiosError,hasRequiredIsAxiosError;function requireIsAxiosError(){if(hasRequiredIsAxiosError)return isAxiosError;hasRequiredIsAxiosError=1;var ss=utils$b;return isAxiosError=function(rs){return ss.isObject(rs)&&rs.isAxiosError===!0},isAxiosError}var utils=utils$b,bind=bind$2,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(ss){var ts=new Axios(ss),rs=bind(Axios.prototype.request,ts);return utils.extend(rs,Axios.prototype,ts),utils.extend(rs,ts),rs.create=function(is){return createInstance(mergeConfig(ss,is))},rs}var axios$1=createInstance(defaults);axios$1.Axios=Axios,axios$1.CanceledError=requireCanceledError(),axios$1.CancelToken=requireCancelToken(),axios$1.isCancel=requireIsCancel(),axios$1.VERSION=requireData().version,axios$1.toFormData=toFormData_1,axios$1.AxiosError=AxiosError_1,axios$1.Cancel=axios$1.CanceledError,axios$1.all=function ss(ts){return Promise.all(ts)},axios$1.spread=requireSpread(),axios$1.isAxiosError=requireIsAxiosError(),axios$2.exports=axios$1,axiosExports.default=axios$1,function(ss){ss.exports=axiosExports}(axios$3);var axios=getDefaultExportFromCjs(axiosExports$1);class Core{constructor({doenetML:ts,doenetId:rs,activityCid:ns,pageNumber:is,attemptNumber:as=1,itemNumber:os=1,serverSaveId:ls,activityVariantIndex:us,requestedVariant:cs,requestedVariantIndex:ps,previousComponentTypeCounts:ds={},flags:fs={},theme:hs,prerender:ys=!1,stateVariableChanges:gs={},coreId:bs,updateDataOnContentChange:vs}){this.coreId=bs,this.doenetId=rs,this.activityCid=ns,this.pageNumber=is,this.attemptNumber=as,this.itemNumber=os,this.activityVariantIndex=us,this.doenetML=ts,this.serverSaveId=ls,this.updateDataOnContentChange=vs,this.numerics=new Numerics,this.flags=fs,this.theme=hs,this.finishCoreConstruction=this.finishCoreConstruction.bind(this),this.getStateVariableValue=this.getStateVariableValue.bind(this),this.componentInfoObjects=createComponentInfoObjects(),this.previousComponentTypeCounts=ds,this.coreFunctions={requestUpdate:this.requestUpdate.bind(this),performUpdate:this.performUpdate.bind(this),requestAction:this.requestAction.bind(this),performAction:this.performAction.bind(this),resolveAction:this.resolveAction.bind(this),triggerChainedActions:this.triggerChainedActions.bind(this),requestRecordEvent:this.requestRecordEvent.bind(this),requestAnimationFrame:this.requestAnimationFrame.bind(this),cancelAnimationFrame:this.cancelAnimationFrame.bind(this),recordSolutionView:this.recordSolutionView.bind(this),requestComponentDoenetML:this.requestComponentDoenetML.bind(this),copyToClipboard:this.copyToClipboard.bind(this),navigateToTarget:this.navigateToTarget.bind(this)},this.updateInfo={componentsToUpdateRenderers:new Set([]),compositesToExpand:new Set([]),compositesToUpdateReplacements:new Set([]),inactiveCompositesToUpdateReplacements:new Set([]),componentsToUpdateActionChaining:{},unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},compositesBeingExpanded:[],stateVariableUpdatesForMissingComponents:JSON.parse(JSON.stringify(gs,serializedComponentsReplacer),serializedComponentsReviver),stateVariablesToEvaluate:[]},this.cumulativeStateVariableChanges=JSON.parse(JSON.stringify(gs,serializedComponentsReplacer),serializedComponentsReviver),this.requestedVariantIndex=ps,this.requestedVariant=cs,this.visibilityInfo={componentsCurrentlyVisible:{},infoToSend:{},timeLastSent:new Date,saveDelay:6e4,saveTimerId:null,suspendDelay:3*6e4,suspendTimerId:null,suspended:!1,documentHasBeenVisible:!1},this.parameterStack=new ParameterStack,this.parameterStack.parameters.rngClass=prng_alea,this.parameterStack.parameters.prerender=ys,this.initialized=!1,this.initializedPromiseResolves=[],this.resolveInitialized=()=>{this.initializedPromiseResolves.forEach(Ns=>Ns(!0)),this.initialized=!0},this.getInitializedPromise=()=>this.initialized?Promise.resolve(!0):new Promise((Ns,Ts)=>{this.initializedPromiseResolves.push(Ns)}),cidFromText(ts).then(Ns=>expandDoenetMLsToFullSerializedComponents({cids:[Ns],doenetMLs:[ts],componentInfoObjects:this.componentInfoObjects,flags:this.flags})).then(this.finishCoreConstruction).catch(Ns=>{postMessage({messageType:"inErrorState",coreId:this.coreId,args:{errMsg:Ns.message}})})}async finishCoreConstruction({cids:ts,fullSerializedComponents:rs}){this.cid=ts[0];let ns=rs[0];addDocumentIfItsMissing(ns),createComponentNames({serializedComponents:ns,componentInfoObjects:this.componentInfoObjects}),this.componentIndexArray=extractComponentNamesAndIndices(ns);let{rangePieces:is}=extractRangeIndexPieces({componentArray:this.componentIndexArray});this.componentRangePieces=is,postMessage({messageType:"componentRangePieces",coreId:this.coreId,args:{componentRangePieces:this.componentRangePieces}}),this.documentName=ns[0].componentName,ns[0].state||(ns[0].state={}),ns[0].state.theme=this.theme,ns[0].doenetAttributes.cid=this.cid,this._components={},this.componentsToRender={},this.componentsWithChangedChildrenToRender=new Set([]),this.stateVariableChangeTriggers={},this.actionsChangedToActions={},this.originsOfActionsChangedToActions={},this.essentialValuesSavedInDefinition={},this.saveStateToDBTimerId=null,this.rendererState={__componentNeedingUpdateValue:null},this.rendererVariablesByComponentType={};for(let os in this.componentInfoObjects.allComponentClasses)Object.defineProperty(this.rendererVariablesByComponentType,os,{get:function(){let ls=this.componentInfoObjects.allComponentClasses[os].returnStateVariableInfo({onlyForRenderer:!0}).stateVariableDescriptions;return delete this.rendererVariablesByComponentType[os],this.rendererVariablesByComponentType[os]=ls}.bind(this),configurable:!0});this.processQueue=[],this.stopProcessingRequests=!1,this.dependencies=new DependencyHandler({_components:this._components,componentInfoObjects:this.componentInfoObjects,core:this}),this.unmatchedChildren={};let as=getNumberOfVariants({serializedComponent:ns[0],componentInfoObjects:this.componentInfoObjects}).numberOfVariants;if(!this.requestedVariant){if(this.requestedVariantIndex=((this.requestedVariantIndex-1)%as+as)%as+1,ns[0].variants.uniqueVariants){let ls=this.componentInfoObjects.allComponentClasses[ns[0].componentType].getUniqueVariant({serializedComponent:ns[0],variantIndex:this.requestedVariantIndex,componentInfoObjects:this.componentInfoObjects});ls.success&&(this.requestedVariant=ls.desiredVariant)}this.requestedVariant||(this.requestedVariant={index:this.requestedVariantIndex})}this.parameterStack.parameters.variant=this.requestedVariant,ns[0].variants.desiredVariant=this.parameterStack.parameters.variant,await this.addComponents({serializedComponents:ns,initialAdd:!0}),this.updateInfo.componentsToUpdateRenderers.clear(),await this.document.stateValues.itemCreditAchieved,this.canonicalGeneratedVariantString=JSON.stringify(await this.document.stateValues.generatedVariantInfo,serializedComponentsReplacer),this.canonicalItemVariantStrings=(await this.document.stateValues.itemVariantInfo).map(os=>JSON.stringify(os,serializedComponentsReplacer)),this.coreInfo={generatedVariantString:this.canonicalGeneratedVariantString,allPossibleVariants:deepClone(await this.document.sharedParameters.allPossibleVariants),rendererTypesInDocument:deepClone(this.rendererTypesInDocument),documentToRender:this.documentRendererInstructions},this.coreInfoString=JSON.stringify(this.coreInfo,serializedComponentsReplacer),this.messageViewerReady(),this.resolveInitialized()}async onDocumentFirstVisible(){this.requestRecordEvent({verb:"experienced",object:{componentName:this.document.componentName,componentType:"document"}});let ts=function(rs){let ns=rs.stateValues.scoredDescendants;if(Array.isArray(ns))for(let is of ns){if(is.componentType==="answer")return!0;if(ts(is))return!0}return!1};await this.document.stateValues.scoredDescendants,ts(this.document)||this.saveSubmissions({pageCreditAchieved:await this.document.stateValues.creditAchieved,suppressToast:!0}),setTimeout(this.sendVisibilityChangedEvents.bind(this),this.visibilityInfo.saveDelay)}async messageViewerReady(){postMessage({messageType:"initializeRenderers",coreId:this.coreId,args:{coreInfo:this.coreInfo}}),postMessage({messageType:"coreCreated",coreId:this.coreId})}async postUpdateRenderers(ts,rs=!1){postMessage({messageType:"updateRenderers",coreId:this.coreId,args:ts,init:rs})}async addComponents({serializedComponents:ts,parentName:rs,indexOfDefiningChildren:ns,initialAdd:is=!1,assignNamesOffset:as}){Array.isArray(ts)||(ts=[ts]);let os,ls=[],us="";if(!is){if(os=this._components[rs],!os)return console.warn(`Cannot add children to parent ${rs} as ${rs} does not exist`),[];ls=[{componentName:rs,componentClass:os.constructor},...os.ancestors],this.parameterStack.push(os.sharedParameters,!1),this.nTimesAddedComponents?this.nTimesAddedComponents++:this.nTimesAddedComponents=1,us=`addComponents${this.nTimesAddedComponents}`}let cs=await this.createIsolatedComponents({serializedComponents:ts,ancestors:ls,createNameContext:us});if(is||this.parameterStack.pop(),cs.success!==!0)throw Error(cs.message);const ps=cs.components;let ds={},fs={};if(ps.forEach(hs=>fs[hs.componentName]=hs),is){if(ps.length!==1)throw Error("Initial components need to be an array of just one component.");if(this.document=ps[0],await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0),this.updateInfo.stateVariablesToEvaluate){let gs=this.updateInfo.stateVariablesToEvaluate;this.updateInfo.stateVariablesToEvaluate=[];for(let{componentName:bs,stateVariable:vs}of gs){let Ns=this._components[bs];Ns&&Ns.state[vs]&&await this.getStateVariableValue({component:Ns,stateVariable:vs})}}await this.replacementChangesFromCompositesToUpdate();let hs=await this.initializeRenderedComponentInstruction(this.document);if(this.updateInfo.compositesToUpdateReplacements.size>0){await this.replacementChangesFromCompositesToUpdate();let gs=[...this.updateInfo.componentsToUpdateRenderers];this.updateInfo.componentsToUpdateRenderers.clear(),await this.updateRendererInstructions({componentNamesToUpdate:gs})}this.documentRendererInstructions=hs.componentToRender;let ys=[{instructionType:"updateRendererStates",rendererStatesToUpdate:hs.rendererStatesToUpdate}];if(this.postUpdateRenderers({updateInstructions:ys},!0),hs.rendererStatesToForceUpdate.length>0){let gs=[{instructionType:"updateRendererStates",rendererStatesToUpdate:hs.rendererStatesToForceUpdate}];this.postUpdateRenderers({updateInstructions:gs})}await this.processStateVariableTriggers(!0)}else{if(os===void 0)throw Error("Must specify parent when adding components.");ns===void 0&&(ns=os.definingChildren.length);let hs=await this.addChildrenAndRecurseToShadows({parent:os,indexOfDefiningChildren:ns,newChildren:ps,assignNamesOffset:as});if(!hs.success)throw Error("Couldn't satisfy child logic result.  Need informative error message");if(Object.assign(fs,hs.addedComponents),Object.assign(ds,hs.deletedComponents),await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0),this.updateInfo.stateVariablesToEvaluate){let ys=this.updateInfo.stateVariablesToEvaluate;this.updateInfo.stateVariablesToEvaluate=[];for(let{componentName:gs,stateVariable:bs}of ys){let vs=this._components[gs];vs&&vs.state[bs]&&await this.getStateVariableValue({component:vs,stateVariable:bs})}}if(await this.replacementChangesFromCompositesToUpdate(),await this.updateRendererInstructions({componentNamesToUpdate:await this.componentAndRenderedDescendants(os)}),this.updateInfo.compositesToUpdateReplacements.size>0){await this.replacementChangesFromCompositesToUpdate();let ys=[...this.updateInfo.componentsToUpdateRenderers];this.updateInfo.componentsToUpdateRenderers.clear(),await this.updateRendererInstructions({componentNamesToUpdate:ys})}await this.processStateVariableTriggers(!0)}return ps}async updateRendererInstructions({componentNamesToUpdate:ts,sourceOfUpdate:rs={},actionId:ns}){let is=[],as=[],os=[],ls={},us=this.componentsWithChangedChildrenToRender;this.componentsWithChangedChildrenToRender=new Set([]);for(let cs of us)if(cs in this.componentsToRender){let ps=[],ds=this._components[cs],fs=[];if(ds&&ds.constructor.renderChildren){ds.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:ds,expandComposites:!0,forceExpandComposites:!0}),fs=await this.returnActiveChildrenIndicesToRender(ds);let gs=0;for(let[bs,vs]of ds.activeChildren.entries())fs.includes(bs)&&(vs.rendererType?(ps.push(`nameType:${vs.componentName};${vs.componentType}`),gs++):typeof vs=="string"?(ps.push(`string${gs}:${vs}`),gs++):typeof vs=="number"&&(ps.push(`number${gs}:${vs.toString()}`),gs++))}let hs=this.componentsToRender[cs].children,ys=[];for(let[gs,bs]of hs.entries())bs.componentName?ys.push(`nameType:${bs.componentName};${bs.componentType}`):typeof bs=="string"?ys.push(`string${gs}:${bs}`):typeof bs=="number"&&ys.push(`number${gs}:${bs.toString()}`);if(ps.length!==ys.length||ps.some((gs,bs)=>gs!==ys[bs])){for(let bs of hs)if(bs.componentName){let vs=this.deleteFromComponentsToRender({componentName:bs.componentName,recurseToChildren:!0,componentsWithChangedChildrenToRenderInProgress:us});is.push(...vs)}let gs=[];if(fs.length>0){for(let[bs,vs]of ds.activeChildren.entries())if(fs.includes(bs))if(vs.rendererType){let Ns=await this.initializeRenderedComponentInstruction(vs,us);gs.push(Ns.componentToRender),os.push(...Ns.rendererStatesToUpdate)}else typeof vs=="string"?gs.push(vs):typeof vs=="number"&&gs.push(vs.toString())}this.componentsToRender[cs].children=gs,ls[cs]=gs,us.delete(cs),ts.includes(cs)||ts.push(cs)}}for(let cs of ts)if(cs in this.componentsToRender){let ps=this._components[cs];if(ps){let ds={};for(let hs in ps.state)if(ps.state[hs].forRenderer){let ys=removeFunctionsMathExpressionClass(await ps.state[hs].value);ds[hs]=ys}let fs={componentName:cs,stateValues:ds,rendererType:ps.rendererType};this.rendererState[cs]||(this.rendererState[cs]={}),this.rendererState[cs].stateValues=ds,ls[cs]&&(fs.childrenInstructions=ls[cs],this.rendererState[cs].childrenInstructions=ls[cs]),os.push(fs)}}if(os.length>0){let cs={instructionType:"updateRendererStates",rendererStatesToUpdate:os,sourceOfUpdate:rs};as.splice(0,0,cs)}this.postUpdateRenderers({updateInstructions:as,actionId:ns})}async initializeRenderedComponentInstruction(ts,rs=new Set([])){if(ts.rendererType===void 0)return;ts.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:ts,expandComposites:!0});let ns=[],is=[],as={},os={},ls=!1;for(let fs in ts.state)ts.state[fs].forRenderer&&(as[fs]=removeFunctionsMathExpressionClass(await ts.state[fs].value),ts.state[fs].alwaysUpdateRenderer&&(ls=!0));ls&&(os=as);let us=ts.componentName,cs=[];if(ts.constructor.renderChildren){let fs=await this.returnActiveChildrenIndicesToRender(ts);for(let[hs,ys]of ts.activeChildren.entries())if(fs.includes(hs))if(ys.rendererType){let gs=await this.initializeRenderedComponentInstruction(ys,rs);cs.push(gs.componentToRender),ns.push(...gs.rendererStatesToUpdate),is.push(...gs.rendererStatesToForceUpdate)}else typeof ys=="string"?cs.push(ys):typeof ys=="number"&&cs.push(ys.toString())}ns.push({componentName:us,stateValues:as,childrenInstructions:cs}),Object.keys(os).length>0&&is.push({componentName:us,stateValues:os}),this.rendererState[us]={stateValues:as,childrenInstructions:cs},rs.delete(us);let ps={};for(let fs in ts.actions)ps[fs]={actionName:fs,componentName:ts.componentName};for(let fs in ts.externalActions){let hs=await ts.externalActions[fs];hs&&(ps[fs]={actionName:fs,componentName:hs.componentName})}let ds={componentName:us,effectiveName:ts.componentOrAdaptedName,componentType:ts.componentType,rendererType:ts.rendererType,actions:ps};return this.componentsToRender[us]={children:cs},{componentToRender:ds,rendererStatesToUpdate:ns,rendererStatesToForceUpdate:is}}deleteFromComponentsToRender({componentName:ts,recurseToChildren:rs=!0,componentsWithChangedChildrenToRenderInProgress:ns}){let is=[ts];if(rs){let as=this.componentsToRender[ts];if(as)for(let os of as.children){let ls=this.deleteFromComponentsToRender({componentName:os.componentName,recurseToChildren:rs,componentsWithChangedChildrenToRenderInProgress:ns});is.push(...ls)}}return delete this.componentsToRender[ts],ns.delete(ts),is}async processStateVariableTriggers(ts=!1){let rs=!1;for(let ns in this.stateVariableChangeTriggers){let is=this._components[ns];for(let as in this.stateVariableChangeTriggers[ns]){let os=this.stateVariableChangeTriggers[ns][as],ls=await is.state[as].value;if(ls!==os.previousValue){let us=os.previousValue;os.previousValue=ls,is.actions[os.action]&&(await this.performAction({componentName:ns,actionName:os.action,args:{stateValues:{[as]:ls},previousValues:{[as]:us},skipRendererUpdate:!0}}),rs=!0)}}}rs&&ts&&this.updateAllChangedRenderers()}async expandAllComposites(ts,rs=!1){let ns=await this.expandCompositesOfDescendants(ts,rs),is=!0;for(;is;){is=!1;for(let as of ns){let os=this._components[as],ls=!1;for(let us of os.unexpandedCompositesNotReady){let cs=this._components[us];if(cs.state.readyToExpandWhenResolved.isResolved){ls=!0;break}else if((await this.dependencies.resolveItem({componentName:cs.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",force:rs,recurseUpstream:!0})).success){ls=!0;break}}if(ls){let us=this._components[as];await this.deriveChildResultsFromDefiningChildren({parent:us,expandComposites:!0,forceExpandComposites:rs}),is=!0}}}}async expandCompositesOfDescendants(ts,rs=!1){let ns=[];ts.childrenMatched||(await this.deriveChildResultsFromDefiningChildren({parent:ts,expandComposites:!0,forceExpandComposites:rs}),ts.unexpandedCompositesNotReady.length>0?ns.push(ts.componentName):await this.dependencies.resolveBlockersFromChangedActiveChildren(ts,rs));for(let is in ts.attributes){let as=ts.attributes[is].component;if(as){let os=await this.expandCompositesOfDescendants(as,rs);ns.push(...os)}}for(let is in ts.allChildren){let as=ts.allChildren[is].component;if(typeof as!="object")continue;let os=await this.expandCompositesOfDescendants(as,rs);ns.push(...os)}return ns}async componentAndRenderedDescendants(ts){if(!(ts!=null&&ts.componentName))return[];let rs=[ts.componentName];if(ts.constructor.renderChildren){ts.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:ts,expandComposites:!0});for(let ns of ts.activeChildren)rs.push(...await this.componentAndRenderedDescendants(ns))}return rs}async createIsolatedComponents({serializedComponents:ts,ancestors:rs,shadow:ns=!1,createNameContext:is=""}){var ls;let as="/";if(rs.length>0){let us=rs[0].componentName,cs=this.components[us];(ls=cs.attributes.newNamespace)!=null&&ls.primitive?as=cs.componentName+"/":as=getNamespaceFromName(cs.componentName)}return{success:!0,components:(await this.createIsolatedComponentsSub({serializedComponents:ts,ancestors:rs,shadow:ns,namespaceForUnamed:as,createNameContext:is})).components}}async createIsolatedComponentsSub({serializedComponents:ts,ancestors:rs,shadow:ns=!1,createNameContext:is="",namespaceForUnamed:as="/",componentsReplacementOf:os}){let ls=[];for(let[cs,ps]of ts.entries()){if(typeof ps!="object"){ls.push(ps);continue}if(ps.createdComponent===!0){let gs=this._components[ps.componentName];ls.push(gs),this.setAncestors(gs,rs);continue}let ds=this.componentInfoObjects.allComponentClasses[ps.componentType];if(ds===void 0)throw Error("Cannot create component of type "+ps.componentType);ps.doenetAttributes||(ps.doenetAttributes={});let fs=ps.componentName;if(fs===void 0){let bs=rs[0].componentName+"|"+is+"|";ps.uniqueIdentifier?bs+=ps.uniqueIdentifier:bs+=cs,fs=createUniqueName(ps.componentType.toLowerCase(),bs),fs=as+fs}let ys=(await this.createChildrenThenComponent({serializedComponent:ps,componentName:fs,ancestors:rs,componentClass:ds,shadow:ns,namespaceForUnamed:as,componentsReplacementOf:os})).newComponent;ls.push(ys)}return{components:ls}}async createChildrenThenComponent({serializedComponent:ts,componentName:rs,ancestors:ns,componentClass:is,shadow:as=!1,namespaceForUnamed:os="/",componentsReplacementOf:ls}){let us=ts.children,cs=[],ps=[],ds=[{componentName:rs,componentClass:is},...ns],fs=this.parameterStack.parameters;this.parameterStack.push();let hs=this.parameterStack.parameters;if(is.descendantCompositesMustHaveAReplacement&&!as?(hs.compositesMustHaveAReplacement=!0,hs.compositesDefaultReplacementType=is.descendantCompositesDefaultReplacementType):(is.descendantCompositesMustHaveAReplacement===!1||as)&&(hs.compositesMustHaveAReplacement=!1),is.modifySharedParameters&&is.modifySharedParameters({sharedParameters:hs,serializedComponent:ts}),ts.doenetAttributes.pushSharedParameters)for(let Cs of ts.doenetAttributes.pushSharedParameters){let xs=Cs.parameterName;xs in hs?hs[xs]=[...hs[xs]]:hs[xs]=[],hs[xs].push(Cs.value)}if(ts.doenetAttributes.addToSharedParameters)for(let Cs of ts.doenetAttributes.addToSharedParameters){let xs=Cs.parameterName;xs in hs?hs[xs]=Object.assign({},hs[xs]):hs[xs]={},hs[xs][Cs.key]=Cs.value}if(us!==void 0){if(is.preprocessSerializedChildren&&is.preprocessSerializedChildren({serializedChildren:us,attributes:ts.attributes,componentName:rs}),is.setUpVariant){let Cs=gatherVariantComponents({serializedComponents:us,componentInfoObjects:this.componentInfoObjects});is.setUpVariant({serializedComponent:ts,sharedParameters:hs,descendantVariantComponents:Cs})}if(is.keepChildrenSerialized){let Cs=new Set([]),xs=is.keepChildrenSerialized({serializedComponent:ts,componentInfoObjects:this.componentInfoObjects});for(let ws of xs){if(Cs.has(Number(ws)))throw Error("Invalid instructions to keep children serialized from "+is.componentType+": child repeated");Cs.add(Number(ws)),ps.push(us[ws])}let As=[];for(let[ws,Es]of us.entries())Cs.has(ws)||As.push(Es);As.length>0&&(cs=(await this.createIsolatedComponentsSub({serializedComponents:As,ancestors:ds,shadow:as,namespaceForUnamed:os})).components)}else cs=(await this.createIsolatedComponentsSub({serializedComponents:us,ancestors:ds,shadow:as,namespaceForUnamed:os})).components}let ys={};if(ts.attributes)for(let Cs in ts.attributes)if(ts.attributes[Cs].component){let As=await this.createIsolatedComponentsSub({serializedComponents:[ts.attributes[Cs].component],ancestors:ds,shadow:as,namespaceForUnamed:os,createNameContext:`attribute|${Cs}`});ys[Cs]={component:As.components[0]}}else ys[Cs]=ts.attributes[Cs];let gs={};ts.downstreamDependencies&&Object.assign(gs,ts.downstreamDependencies);let bs=await this.createStateVariableDefinitions({componentClass:is,prescribedDependencies:gs,componentName:rs});delete this.updateInfo.deletedComponents[rs],delete this.updateInfo.deletedStateVariables[rs];let vs=new is({componentName:rs,ancestors:ns,definingChildren:cs,stateVariableDefinitions:bs,serializedChildren:ps,serializedComponent:ts,attributes:ys,componentInfoObjects:this.componentInfoObjects,coreFunctions:this.coreFunctions,flags:this.flags,shadow:as,numerics:this.numerics,sharedParameters:hs,parentSharedParameters:fs});this.registerComponent(vs),ls&&(vs.replacementOf=ls),ts.adaptedFrom&&(vs.adaptedFrom=this._components[ts.adaptedFrom],vs.adaptedFrom.adapterUsed=vs);for(let Cs in gs){let xs=gs[Cs];for(let As of xs)if(As.dependencyType==="referenceShadow"){let ws={componentName:Cs};Object.assign(ws,As),delete ws.dependencyType,vs.shadows=ws;let Es=this._components[Cs];if(Es.shadowedBy||(Es.shadowedBy=[]),Es.shadowedBy.push(vs),As.isPrimaryShadow&&(Es.primaryShadow=vs.componentName,this.dependencies.updateTriggers.primaryShadowDependencies[Cs]))for(let Ss of this.dependencies.updateTriggers.primaryShadowDependencies[Cs])await Ss.recalculateDownstreamComponents();break}}ts.unlinkedCopySource&&(vs.unlinkedCopySource=ts.unlinkedCopySource),await this.deriveChildResultsFromDefiningChildren({parent:vs,expandComposites:!1}),await this.initializeComponentStateVariables(vs),await this.dependencies.setUpComponentDependencies(vs);let Ns=await this.dependencies.checkForDependenciesOnNewComponent(rs);for(let Cs of Ns)await this.markStateVariableAndUpstreamDependentsStale({component:this._components[Cs.componentName],varName:Cs.varName});return await this.checkForStateVariablesUpdatesForNewComponent(rs),await this.dependencies.resolveStateVariablesIfReady({component:vs}),await this.checkForActionChaining({component:vs}),this.parameterStack.pop(),{newComponent:vs}}async checkForStateVariablesUpdatesForNewComponent(ts){if(ts in this.updateInfo.stateVariableUpdatesForMissingComponents){let rs=await this.processNewStateVariableValues({[ts]:this.updateInfo.stateVariableUpdatesForMissingComponents[ts]}),ns=this._components[ts];if(ns.constructor.processWhenJustUpdatedForNewComponent||rs.foundIgnore)for(let is in this.updateInfo.stateVariableUpdatesForMissingComponents[ts])ns.state[is]&&(this.updateInfo.stateVariablesToEvaluate.push({componentName:ts,stateVariable:is}),ns.state[is].justUpdatedForNewComponent=!0,rs.foundIgnore&&(ns.reprocessAfterEvaluate=this.updateInfo.stateVariableUpdatesForMissingComponents[ts]));delete this.updateInfo.stateVariableUpdatesForMissingComponents[ts]}}async deriveChildResultsFromDefiningChildren({parent:ts,expandComposites:rs=!0,forceExpandComposites:ns=!1}){if(this.derivingChildResults||(this.derivingChildResults=[]),this.derivingChildResults.includes(ts.componentName))return{success:!1,skipping:!0};this.derivingChildResults.push(ts.componentName);let is=await this.expandCompositeOfDefiningChildren(ts,ts.definingChildren,rs,ns);ts.unexpandedCompositesReady=is.unexpandedCompositesReady,ts.unexpandedCompositesNotReady=is.unexpandedCompositesNotReady;let as;ts.activeChildren&&(as=ts.activeChildren.map(us=>us.componentName?us.componentName:us)),ts.activeChildren=ts.definingChildren.slice(),ts.allChildren={},ts.allChildrenOrdered=[];for(let us=0;us<ts.activeChildren.length;us++){let cs=ts.activeChildren[us],ps;typeof cs=="object"&&(ps=cs.componentName,ts.allChildren[ps]={activeChildrenIndex:us,definingChildrenIndex:us,component:cs},ts.allChildrenOrdered.push(ps))}await this.replaceCompositeChildren(ts);let os=await this.matchChildrenToChildGroups(ts);if(os.success)delete this.unmatchedChildren[ts.componentName],ts.childrenMatchedWithPlaceholders=!0;else{ts.childrenMatchedWithPlaceholders=!1;let us=os.unmatchedChildren.map(cs=>cs.componentType).join(", ");this.unmatchedChildren[ts.componentName]={message:`invalid children of type(s): ${us}`}}await this.dependencies.addBlockersFromChangedActiveChildren({parent:ts});let ls=this.derivingChildResults.indexOf(ts.componentName);return this.derivingChildResults.splice(ls,1),ts.constructor.renderChildren&&(as&&as.length==ts.activeChildren.length&&ts.activeChildren.every((cs,ps)=>cs.componentName?cs.componentName===as[ps]:cs===as[ps])||this.componentsWithChangedChildrenToRender.add(ts.componentName)),os}async expandCompositeOfDefiningChildren(ts,rs,ns,is){let as=[],os=[];for(let ls=0;ls<rs.length;ls++){let us=rs[ls];if(us instanceof this.componentInfoObjects.allComponentClasses._composite){if(this.findChildGroup(us.componentType,ts.constructor).success)continue;if(!us.isExpanded){if(us.state.readyToExpandWhenResolved.isResolved){if(!ns){as.push(us.componentName),this.updateInfo.compositesToExpand.add(us.componentName);continue}}else if(ns){if(!(await this.dependencies.resolveItem({componentName:us.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",expandComposites:ns,force:is})).success){os.push(us.componentName),this.updateInfo.compositesToExpand.add(us.componentName);continue}}else{os.push(us.componentName),this.updateInfo.compositesToExpand.add(us.componentName);continue}await this.expandCompositeComponent(us)}let cs=await this.expandCompositeOfDefiningChildren(ts,us.replacements,ns,is);as.push(...cs.unexpandedCompositesReady),os.push(...cs.unexpandedCompositesNotReady)}}return{unexpandedCompositesReady:as,unexpandedCompositesNotReady:os}}async matchChildrenToChildGroups(ts){ts.childMatchesByGroup={};for(let is in ts.constructor.childGroupIndsByName)ts.childMatchesByGroup[is]=[];let rs=!0,ns=[];for(let[is,as]of ts.activeChildren.entries()){let os=typeof as!="object"?typeof as:as.componentType,ls=this.findChildGroup(os,ts.constructor);ls.success?(ts.childMatchesByGroup[ls.group].push(is),ls.adapterIndUsed!==void 0&&await this.substituteAdapter({parent:ts,childInd:is,adapterIndUsed:ls.adapterIndUsed})):(rs=!1,ns.push(as))}return{success:rs,unmatchedChildren:ns}}findChildGroup(ts,rs){let ns=this.findChildGroupNoAdapters(ts,rs);if(ns.success)return ns;if(ts==="string")return{success:!1};let is=this.componentInfoObjects.allComponentClasses[ts],as=is.nAdapters;for(let os=0;os<as;os++){let ls=is.getAdapterComponentType(os,this.componentInfoObjects.publicStateVariableInfo);if(ns=this.findChildGroupNoAdapters(ls,rs),ns.success)return ns.adapterIndUsed=os,ns}return this.findChildGroupNoAdapters(ts,rs,!0)}findChildGroupNoAdapters(ts,rs,ns=!1){if(rs.childGroupOfComponentType[ts])return{success:!0,group:rs.childGroupOfComponentType[ts]};for(let is of rs.childGroups)for(let as of is.componentTypes)if(this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:ts,baseComponentType:as})){if(is.matchAfterAdapters&&!ns)continue;if(!(as==="_base"&&this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:ts,baseComponentType:"_composite"})))return rs.childGroupOfComponentType[ts]=is.group,{success:!0,group:is.group}}return{success:!1}}async returnActiveChildrenIndicesToRender(ts){let rs=[],ns=1/0;"nChildrenToRender"in ts.state&&(ns=await ts.stateValues.nChildrenToRender);let is=null;"childIndicesToRender"in ts.state&&(is=await ts.stateValues.childIndicesToRender);for(let[as,os]of ts.activeChildren.entries()){if(as>=ns)break;if(!(is&&!is.includes(as)))if(typeof os=="object")(os.constructor.sendToRendererEvenIfHidden||!await os.stateValues.hidden)&&rs.push(as);else{let ls=!1;if(ts.compositeReplacementActiveRange){for(let us of ts.compositeReplacementActiveRange)if(await this._components[us.compositeName].stateValues.hidden&&us.firstInd<=as&&us.lastInd>=as){ls=!0;break}}ls||rs.push(as)}}return rs}async substituteAdapter({parent:ts,childInd:rs,adapterIndUsed:ns}){var ls;let is=ts.activeChildren[rs],as;is.componentName?as=is.getAdapter(ns):as={componentType:this.componentInfoObjects.allComponentClasses[is.componentType].getAdapterComponentType(ns,this.componentInfoObjects.publicStateVariableInfo),placeholderInd:is.placeholderInd+"adapt"};let os=is.adapterUsed;if(os===void 0||os.componentType!==as.componentType)if(is.componentName){let us;(ls=ts.attributes.newNamespace)!=null&&ls.primitive?us=ts.componentName+"/":us=getNamespaceFromName(ts.componentName),as.adaptedFrom=is.componentName,os=(await this.createIsolatedComponentsSub({serializedComponents:[as],shadow:!0,ancestors:is.ancestors,createNameContext:is.componentName+"|adapter",namespaceForUnamed:us})).components[0]}else as.adaptedFrom=is,os=as;if(ts.activeChildren.splice(rs,1,os),is.componentName&&(delete ts.allChildren[is.componentName].activeChildrenIndex,ts.allChildren[os.componentName]={activeChildrenIndex:rs,component:os}),is.componentName){let us=ts.allChildrenOrdered.indexOf(is.componentName);ts.allChildrenOrdered.splice(us+1,0,os.componentName)}else{let us=ts.allChildrenOrdered.indexOf(is.placeholderInd);ts.allChildrenOrdered.splice(us+1,0,os.placeholderInd)}}async expandCompositeComponent(ts){if(!("readyToExpandWhenResolved"in ts.state))throw Error(`Could not find state variable readyToExpandWhenResolved of composite ${ts.componentName}`);if(!ts.state.readyToExpandWhenResolved.isResolved)return this.updateInfo.compositesToExpand.add(ts.componentName),{success:!1};if(this.updateInfo.compositesToExpand.delete(ts.componentName),this.updateInfo.compositesBeingExpanded.push(ts.componentName),ts.parent){if(ts.parent.unexpandedCompositesReady){let is=ts.parent.unexpandedCompositesReady.indexOf(ts.componentName);is!==-1&&ts.parent.unexpandedCompositesReady.splice(is,1)}if(ts.parent.unexpandedCompositesNotReady){let is=ts.parent.unexpandedCompositesNotReady.indexOf(ts.componentName);is!==-1&&ts.parent.unexpandedCompositesNotReady.splice(is,1)}}if(ts.shadows)return await this.expandShadowingComposite(ts);let rs=await ts.constructor.createSerializedReplacements({component:this.components[ts.componentName],components:this.components,workspace:ts.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});if(ts.constructor.stateVariableToEvaluateAfterReplacements&&await ts.stateValues[ts.constructor.stateVariableToEvaluateAfterReplacements],rs.replacements){let is=rs.replacements;await this.createAndSetReplacements({component:ts,serializedReplacements:is})}else throw Error(`Invalid createSerializedReplacements of ${ts.componentName}`);let ns=this.updateInfo.compositesBeingExpanded.indexOf(ts.componentName);if(ns===-1)throw Error(`Something is wrong as we lost track that we were expanding ${ts.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(ns,1),{success:!0,compositesExpanded:[ts.componentName]}}async expandShadowingComposite(ts){var fs,hs,ys,gs,bs;if(this.updateInfo.compositesBeingExpanded.includes(ts.shadows.componentName)){let vs=this._components[ts.shadows.componentName];for(;vs.shadows;)vs=this._components[vs.shadows.componentName];throw Error(`Circular reference involving ${vs.componentName}`)}let rs=this._components[ts.shadows.componentName],ns=[];if(!rs.isExpanded){let vs=await this.expandCompositeComponent(rs);if(!vs.success)throw Error(`expand result of ${ts.componentName} was not a success even though ready to expand.`);ns.push(...vs.compositesExpanded)}let is=[],as=await ts.stateValues.sourceAttributesToIgnore,os=await ts.stateValues.sourceAttributesToIgnoreRecursively;for(let vs of rs.replacements)typeof vs=="object"?is.push(await vs.serialize({sourceAttributesToIgnore:as,sourceAttributesToIgnoreRecursively:os})):is.push(vs);let ls=ts.replacementsWorkspace.uniqueIdentifiersUsed=[],us=ts.shadows.compositeName;is=postProcessCopy({serializedComponents:is,componentName:us,uniqueIdentifiersUsed:ls});let cs=(fs=ts.attributes.newNamespace)==null?void 0:fs.primitive;if(ts.attributes.isResponse){let vs=ts.constructor.createAttributesObject();for(let Ns of is){if(typeof Ns!="object")continue;Ns.attributes||(Ns.attributes={});let Ts=convertAttributesForComponentType({attributes:{isResponse:ts.attributes.isResponse},componentType:Ns.componentType,componentInfoObjects:this.componentInfoObjects,compositeAttributesObj:vs,compositeCreatesNewNamespace:cs});Object.assign(Ns.attributes,Ts)}}if(ts.constructor.assignNamesToReplacements){let vs=this.components[us],Ns=(hs=vs.attributes.newNamespace)==null?void 0:hs.primitive,Ts=vs.doenetAttributes.assignNames,Cs=Ts==null?void 0:Ts.some(Array.isArray),xs=(ys=vs.attributes.assignNewNamespaces)==null?void 0:ys.primitive,As=this._components[vs.doenetAttributes.targetComponentName],ws;As&&(ws=!this.componentInfoObjects.isCompositeComponent({componentType:As.componentType,includeNonStandard:!1})&&((gs=As.attributes.newNamespace)==null?void 0:gs.primitive));let Es=!Cs&&(cs||ws||Ns&&!Ts||xs),Ss=ts.doenetAttributes.assignNames;if(Ss&&await ts.stateValues.addLevelToAssignNames&&(Ss=Ss.map(Vs=>[Vs])),is=processAssignNames({assignNames:Ss,serializedComponents:is,parentName:ts.componentName,parentCreatesNewNamespace:cs,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:Es,shadowingComposite:!0}).serializedComponents,(As==null?void 0:As.componentName)===rs.componentName&&vs.doenetAttributes.fromCopyTarget){let Vs=deepClone(vs.serializedChildren);this.componentInfoObjects.allComponentClasses[ts.componentType].includeBlankStringChildren||(Vs=Vs.filter(Ps=>typeof Ps!="string"||Ps.trim()!==""));let Os=processAssignNames({assignNames:Ss,serializedComponents:Vs,parentName:ts.componentName,parentCreatesNewNamespace:(bs=vs.attributes.assignNewNamespaces)==null?void 0:bs.primitive,indOffset:is.length,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:!0});is.push(...Os.serializedComponents)}}else{let vs=cs;is=processAssignNames({serializedComponents:is,parentName:ts.componentName,parentCreatesNewNamespace:cs,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:vs,shadowingComposite:!0}).serializedComponents}is=(await verifyReplacementsMatchSpecifiedType({component:ts,replacements:is,assignNames:ts.doenetAttributes.assignNames,componentInfoObjects:this.componentInfoObjects,compositeAttributesObj:ts.constructor.createAttributesObject(),flags:this.flags})).replacements,await this.createAndSetReplacements({component:ts,serializedReplacements:is}),rs.replacementsToWithhold>0&&(ts.replacementsToWithhold=rs.replacementsToWithhold);let ds=this.updateInfo.compositesBeingExpanded.indexOf(ts.componentName);if(ds===-1)throw Error(`Something is wrong as we lost track that we were expanding ${ts.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(ds,1),ns.push(ts.componentName),{success:!0,compositesExpanded:ns}}async createAndSetReplacements({component:ts,serializedReplacements:rs}){var as;this.parameterStack.push(ts.sharedParameters,!1);let ns;(as=ts.attributes.newNamespace)!=null&&as.primitive?ns=ts.componentName+"/":ns=getNamespaceFromName(ts.componentName);let is=await this.createIsolatedComponentsSub({serializedComponents:rs,ancestors:ts.ancestors,shadow:!0,createNameContext:ts.componentName+"|replacements",namespaceForUnamed:ns,componentsReplacementOf:ts});this.parameterStack.pop(),ts.replacements=is.components,await this.dependencies.addBlockersFromChangedReplacements(ts),ts.isExpanded=!0}async replaceCompositeChildren(ts){var ns;delete ts.placeholderActiveChildrenIndices,delete ts.placeholderActiveChildrenIndicesByComposite,delete ts.compositeReplacementActiveRange;let rs=0;for(let is=0;is<ts.activeChildren.length;is++){let as=ts.activeChildren[is];if(as instanceof this.componentInfoObjects.allComponentClasses._composite){if(this.findChildGroup(as.componentType,ts.constructor).success)continue;let os=!1;if(!as.isExpanded)if((ns=as.attributes.createComponentOfType)!=null&&ns.primitive)os=!0;else continue;let ls;if(os){let ps;as.attributes.nComponents?ps=as.attributes.nComponents.primitive:ps=1;let ds=this.componentInfoObjects.componentTypeLowerCaseMapping[as.attributes.createComponentOfType.primitive.toLowerCase()];ls=[];for(let hs=0;hs<ps;hs++)ls.push({componentType:ds,fromComposite:as.componentName,placeholderInd:rs}),rs++;ts.hasPlaceholderActiveChildren=!0;let fs=[...Array(ps).keys()].map(hs=>hs+is);ts.placeholderActiveChildrenIndices||(ts.placeholderActiveChildrenIndices=[]),ts.placeholderActiveChildrenIndices.push(...fs),ts.placeholderActiveChildrenIndicesByComposite||(ts.placeholderActiveChildrenIndicesByComposite={}),ts.placeholderActiveChildrenIndicesByComposite[as.componentName]=fs}else await this.markWithheldReplacementsInactive(as),ls=as.replacements,as.replacementsToWithhold>0&&(ls=ls.slice(0,-as.replacementsToWithhold)),(!ts.constructor.includeBlankStringChildren||ts.constructor.removeBlankStringChildrenPostSugar)&&(ls=ls.filter(ps=>typeof ps!="string"||/\S/.test(ps)));ts.compositeReplacementActiveRange||(ts.compositeReplacementActiveRange=[]);for(let ps of ts.compositeReplacementActiveRange)ps.lastInd>=is&&(ps.lastInd+=ls.length-1);ts.compositeReplacementActiveRange.push({compositeName:as.componentName,target:await as.stateValues.target,firstInd:is,lastInd:is+ls.length-1}),ts.activeChildren.splice(is,1,...ls);let us=ts.allChildren[as.componentName];delete us.activeChildrenIndex;for(let ps=0;ps<ls.length;ps++){let ds=ls[ps];ds.componentName&&(ts.allChildren[ds.componentName]={activeChildrenIndex:is+ps,component:ds})}let cs=ts.allChildrenOrdered.indexOf(as.componentName);if(ts.allChildrenOrdered.splice(cs+1,0,...ls.filter(ps=>typeof ps=="object").map(ps=>ps.componentName?ps.componentName:ps.placeholderInd)),ls.length!==1){let ps=ls.length-1;for(let ds=is+ls.length;ds<ts.activeChildren.length;ds++){let fs=ts.activeChildren[ds];fs.componentName&&(ts.allChildren[fs.componentName].activeChildrenIndex+=ps)}}is--}}}async markWithheldReplacementsInactive(ts){let rs=ts.replacements.length;await ts.stateValues.isInactiveCompositeReplacement?rs=0:ts.replacementsToWithhold>0&&(rs-=ts.replacementsToWithhold);for(let ns of ts.replacements.slice(0,rs))await this.changeInactiveComponentAndDescendants(ns,!1);for(let ns of ts.replacements.slice(rs))await this.changeInactiveComponentAndDescendants(ns,!0);if(!await ts.stateValues.isInactiveCompositeReplacement){let ns=ts.componentName;this.updateInfo.inactiveCompositesToUpdateReplacements.has(ns)&&(this.updateInfo.inactiveCompositesToUpdateReplacements.delete(ns),this.updateInfo.compositesToUpdateReplacements.add(ns))}}async changeInactiveComponentAndDescendants(ts,rs){if(typeof ts=="object"&&await ts.stateValues.isInactiveCompositeReplacement!==rs){ts.state.isInactiveCompositeReplacement.value=rs,await this.markUpstreamDependentsStale({component:ts,varName:"isInactiveCompositeReplacement"}),this.dependencies.recordActualChangeInUpstreamDependencies({component:ts,varName:"isInactiveCompositeReplacement"});for(let ns in ts.allChildren)await this.changeInactiveComponentAndDescendants(this._components[ns],rs);for(let ns in ts.attributes){let is=ts.attributes[ns].component;is&&await this.changeInactiveComponentAndDescendants(this._components[is.componentName],rs)}ts.replacements&&await this.markWithheldReplacementsInactive(ts)}}findShadowedChildInSerializedComponents({serializedComponents:ts,shadowedComponentName:rs}){for(let ns of ts){if(ns.originalName===rs)return ns;if(ns.children){let is=this.findShadowedChildInSerializedComponents({serializedComponents:ns.children,shadowedComponentName:rs});if(is)return is}}}async createStateVariableDefinitions({componentClass:ts,prescribedDependencies:rs,componentName:ns}){let is;if(rs)for(let ls in rs){let us=rs[ls];for(let cs of us)if(cs.dependencyType==="referenceShadow"){if(ls===ns)throw Error(`circular reference involving ${ns}`);is={linkSource:"referenceShadow",targetName:ls,compositeName:cs.compositeName,propVariable:cs.propVariable,arrayStateVariable:cs.arrayStateVariable,arrayKey:cs.arrayKey,ignorePrimaryStateVariable:cs.ignorePrimaryStateVariable,substituteForPrimaryStateVariable:cs.substituteForPrimaryStateVariable,firstLevelReplacement:cs.firstLevelReplacement,additionalStateVariableShadowing:cs.additionalStateVariableShadowing}}else cs.dependencyType==="adapter"&&(is={linkSource:"adapter",adapterTargetIdentity:cs.adapterTargetIdentity,adapterVariable:cs.adapterVariable,substituteForPrimaryStateVariable:cs.substituteForPrimaryStateVariable,stateVariablesToShadow:cs.stateVariablesToShadow})}let as={};is||this.createAttributeStateVariableDefinitions({stateVariableDefinitions:as,componentClass:ts});let os=ts.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(as),numerics:this.numerics});return Object.assign(as,os),is&&(is.linkSource==="adapter"?this.createAdapterStateVariableDefinitions({redefineDependencies:is,stateVariableDefinitions:as,componentClass:ts}):await this.createReferenceShadowStateVariableDefinitions({redefineDependencies:is,stateVariableDefinitions:as,componentClass:ts})),as}createAttributeStateVariableDefinitions({componentClass:ts,stateVariableDefinitions:rs}){let ns=ts.createAttributesObject();for(let is in ns){let as=ns[is];if(!as.createStateVariable)continue;let os=as.createStateVariable,ls=rs[os]={isAttribute:!0,hasEssential:!0};if(as.public)if(ls.public=!0,ls.shadowingInstructions={},as.createPrimitiveOfType)ls.shadowingInstructions.createComponentOfType=as.createPrimitiveOfType,ls.shadowingInstructions.createComponentOfType==="string"?ls.shadowingInstructions.createComponentOfType="text":ls.shadowingInstructions.createComponentOfType==="stringArray"?ls.shadowingInstructions.createComponentOfType="textList":ls.shadowingInstructions.createComponentOfType==="numberArray"&&(ls.shadowingInstructions.createComponentOfType="numberList");else{if(as.createTargetComponentNames)throw Error("Cannot make a public state variable from an attribute with createTargetComponentNames");ls.shadowingInstructions.createComponentOfType=as.createComponentOfType}let us;if(as.createComponentOfType){let ps=this.componentInfoObjects.allComponentClasses[as.createComponentOfType];if(!ps)throw Error(`Component type ${as.createComponentOfType} does not exist so cannot create state variable for attribute ${is} of componentType ${ts.componentType}.`);us=as.componentStateVariableForAttributeValue,us===void 0&&(us=ps.stateVariableForAttributeValue,us===void 0&&(us="value"))}ls.returnDependencies=function(){let ps={};return as.fallBackToParentStateVariable&&(ps.parentValue={dependencyType:"parentStateVariable",variableName:as.fallBackToParentStateVariable}),as.createPrimitiveOfType?ps.attributePrimitive={dependencyType:"attributePrimitive",attributeName:is}:as.createTargetComponentNames?ps.attributeTargetComponentNames={dependencyType:"attributeTargetComponentNames",attributeName:is}:ps.attributeComponent={dependencyType:"attributeComponent",attributeName:is,variableNames:[us]},ps},ls.definition=function({dependencyValues:ps,usedDefault:ds}){let fs;if(ps.attributeComponent)fs=ps.attributeComponent.stateValues[us];else if(ps.attributePrimitive!==void 0&&ps.attributePrimitive!==null)fs=ps.attributePrimitive;else if(ps.attributeTargetComponentNames!==void 0&&ps.attributeTargetComponentNames!==null)fs=ps.attributeTargetComponentNames;else return ps.parentValue!==void 0&&ps.parentValue!==null&&!ds.parentValue?{setValue:{[os]:ps.parentValue},checkForActualChange:{[os]:!0}}:{useEssentialOrDefaultValue:{[os]:!0},checkForActualChange:{[os]:!0}};return fs=validateAttributeValue({value:fs,attributeSpecification:as,attribute:is}),{setValue:{[os]:fs},checkForActualChange:{[os]:!0}}},as.noInverse||(ls.inverseDefinition=async function({desiredStateVariableValues:ps,dependencyValues:ds,usedDefault:fs}){if(!ds.attributeComponent){if(ds.attributePrimitive!==void 0&&ds.attributePrimitive!==null)return{success:!1};if(ds.attributeTargetComponentNames!==void 0&&ds.attributeTargetComponentNames!==null)return{success:!1};if(ds.parentValue!==void 0&&ds.parentValue!==null&&!fs.parentValue)return{success:!0,instructions:[{setDependency:"parentValue",desiredValue:ps[os]}]};{let ys=validateAttributeValue({value:ps[os],attributeSpecification:as,attribute:is});return{success:!0,instructions:[{setEssentialValue:os,value:ys}]}}}return{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:ps[os],variableIndex:0}]}});let cs=["forRenderer","defaultValue","propagateToProps","triggerActionOnChange"];for(let ps of cs)ps in as&&(ls[ps]=as[ps])}}createAdapterStateVariableDefinitions({redefineDependencies:ts,stateVariableDefinitions:rs,componentClass:ns}){let is=this._components[ts.adapterTargetIdentity.componentName],as=ns.createAttributesObject();for(let us in as){let cs=as[us];if(!cs.createStateVariable)continue;let ps=cs.createStateVariable,ds=rs[ps]={isAttribute:!0,hasEssential:!0};if(cs.public)if(ds.public=!0,ds.shadowingInstructions={},cs.createPrimitiveOfType)ds.shadowingInstructions.createComponentOfType=cs.createPrimitiveOfType,ds.shadowingInstructions.createComponentOfType==="string"?ds.shadowingInstructions.createComponentOfType="text":ds.shadowingInstructions.createComponentOfType==="stringArray"?ds.shadowingInstructions.createComponentOfType="textList":ds.shadowingInstructions.createComponentOfType==="numberArray"&&(ds.shadowingInstructions.createComponentOfType="numberList");else{if(cs.createTargetComponentNames)throw Error("Cannot make a public state variable from an attribute with createTargetComponentNames");ds.shadowingInstructions.createComponentOfType=cs.createComponentOfType}ps in is.state?ds.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:ts.adapterTargetIdentity.componentName,variableName:ps}}):ds.returnDependencies=()=>({}),ds.definition=function({dependencyValues:hs,usedDefault:ys}){return hs.adapterTargetVariable===void 0||ys.adapterTargetVariable?{useEssentialOrDefaultValue:{[ps]:!0},checkForActualChange:{[ps]:!0}}:{setValue:{[ps]:hs.adapterTargetVariable},checkForActualChange:{[ps]:!0}}},cs.noInverse||(ds.inverseDefinition=async function({desiredStateVariableValues:hs,dependencyValues:ys}){return ys.adapterTargetVariable===void 0?{success:!0,instructions:[{setEssentialValue:ps,value:hs[ps]}]}:{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:hs[ps]}]}});let fs=["forRenderer","defaultValue","propagateToProps"];for(let hs of fs)hs in cs&&(ds[hs]=cs[hs])}let os="value";ts.substituteForPrimaryStateVariable?os=ts.substituteForPrimaryStateVariable:ns.primaryStateVariableForDefinition&&(os=ns.primaryStateVariableForDefinition);let ls=rs[os];ls.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:ts.adapterTargetIdentity.componentName,variableName:ts.adapterVariable}}),ls.set?ls.definition=function({dependencyValues:us}){return{setValue:{[os]:ls.set(us.adapterTargetVariable)}}}:ls.definition=function({dependencyValues:us}){return{setValue:{[os]:us.adapterTargetVariable}}},ls.inverseDefinition=function({desiredStateVariableValues:us}){return{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:us[os]}]}},ts.stateVariablesToShadow&&this.modifyStateDefsToBeShadows({stateVariablesToShadow:ts.stateVariablesToShadow,stateVariableDefinitions:rs,targetComponent:is})}async createReferenceShadowStateVariableDefinitions({redefineDependencies:ts,stateVariableDefinitions:rs,componentClass:ns}){let is=this._components[ts.targetName];ts.propVariable&&!is.state[ts.propVariable]&&this.checkIfArrayEntry({stateVariable:ts.propVariable,component:is})&&await this.createFromArrayEntry({stateVariable:ts.propVariable,component:is});let as=ns.createAttributesObject();for(let us in as){let cs=as[us],ps=cs.createStateVariable;if(!ps)continue;let ds=rs[ps]={isAttribute:!0,hasEssential:!0};if(cs.createComponentOfType,cs.public)if(ds.public=!0,ds.shadowingInstructions={},cs.createPrimitiveOfType)ds.shadowingInstructions.createComponentOfType=cs.createPrimitiveOfType,ds.shadowingInstructions.createComponentOfType==="string"?ds.shadowingInstructions.createComponentOfType="text":ds.shadowingInstructions.createComponentOfType==="stringArray"?ds.shadowingInstructions.createComponentOfType="textList":ds.shadowingInstructions.createComponentOfType==="numberArray"&&(ds.shadowingInstructions.createComponentOfType="numberList");else{if(cs.createTargetComponentNames)throw Error("Cannot make a public state variable from an attribute with createTargetComponentNames");ds.shadowingInstructions.createComponentOfType=cs.createComponentOfType}let fs;if(cs.createComponentOfType){let gs=this.componentInfoObjects.allComponentClasses[cs.createComponentOfType];if(!gs)throw Error(`Component type ${cs.createComponentOfType} does not exist so cannot create state variable for attribute ${us} of componentType ${ns.componentType}.`);fs=cs.componentStateVariableForAttributeValue,fs===void 0&&(fs=gs.stateVariableForAttributeValue,fs===void 0&&(fs="value"))}let hs={};cs.createPrimitiveOfType?hs.attributePrimitive={dependencyType:"attributePrimitive",attributeName:us}:cs.createTargetComponentNames?hs.attributeTargetComponentNames={dependencyType:"attributeTargetComponentNames",attributeName:us}:hs.attributeComponent={dependencyType:"attributeComponent",attributeName:us,variableNames:[fs]},cs.fallBackToParentStateVariable&&(hs.parentValue={dependencyType:"parentStateVariable",variableName:cs.fallBackToParentStateVariable}),ds.returnDependencies=()=>hs,ds.definition=function({dependencyValues:gs,usedDefault:bs}){let vs;if(gs.attributeComponent)vs=gs.attributeComponent.stateValues[fs];else if(gs.attributePrimitive!==void 0&&gs.attributePrimitive!==null)vs=gs.attributePrimitive;else if(gs.attributeTargetComponentNames!==void 0&&gs.attributeTargetComponentNames!==null)vs=gs.attributeTargetComponentNames;else return gs.parentValue!==void 0&&gs.parentValue!==null&&!bs.parentValue?{setValue:{[ps]:gs.parentValue},checkForActualChange:{[ps]:!0}}:{useEssentialOrDefaultValue:{[ps]:!0},checkForActualChange:{[ps]:!0}};return vs=validateAttributeValue({value:vs,attributeSpecification:cs,attribute:us}),{setValue:{[ps]:vs},checkForActualChange:{[ps]:!0}}},cs.noInverse||(ds.inverseDefinition=async function({desiredStateVariableValues:gs,dependencyValues:bs,stateValues:vs,workspace:Ns}){if(!bs.attributeComponent){if(bs.attributePrimitive!==void 0&&bs.attributePrimitive!==null)return{success:!1};if(bs.attributeTargetComponentNames!==void 0&&bs.attributeTargetComponentNames!==null)return{success:!1};if(bs.parentValue!==void 0&&bs.parentValue!==null&&!usedDefault.parentValue)return{success:!0,instructions:[{setDependency:"parentValue",desiredValue:gs[ps]}]};{let Cs=validateAttributeValue({value:gs[ps],attributeSpecification:cs,attribute:us});return{success:!0,instructions:[{setEssentialValue:ps,value:Cs}]}}}return{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:gs[ps],variableIndex:0}]}});let ys=["forRenderer","defaultValue","propagateToProps"];for(let gs of ys)gs in cs&&(ds[gs]=cs[gs])}if(ts.propVariable){if(!ts.ignorePrimaryStateVariable){let us="value";ts.substituteForPrimaryStateVariable?us=ts.substituteForPrimaryStateVariable:ns.primaryStateVariableForDefinition&&(us=ns.primaryStateVariableForDefinition);let cs=rs[us];if(!cs)throw ts.substituteForPrimaryStateVariable?Error(`Invalid public state variable of componentType ${ns.componentType}: substituteForPrimaryStateVariable ${ts.substituteForPrimaryStateVariable} does not exist`):Error(`Cannot have a public state variable with componentType ${ns.componentType} as the class doesn't have a primary state variable for definition`);cs.isShadow=!0,cs.returnDependencies=()=>({targetVariable:{dependencyType:"stateVariable",componentName:is.componentName,variableName:ts.propVariable}});let ps=!1;is.state[ts.propVariable].defaultValue!==void 0&&(cs.defaultValue=is.state[ts.propVariable].defaultValue,cs.set&&(cs.defaultValue=cs.set(cs.defaultValue)),cs.hasEssential=!0,ps=!0),cs.set?cs.definition=function({dependencyValues:ds,usedDefault:fs}){let hs=cs.set(ds.targetVariable);return ps&&fs.targetVariable?{useEssentialOrDefaultValue:{[us]:{defaultValue:hs}},alwaysShadow:[us]}:{setValue:{[us]:hs},alwaysShadow:[us]}}:cs.definition=function({dependencyValues:ds,usedDefault:fs}){return ps&&fs.targetVariable?{useEssentialOrDefaultValue:{[us]:{defaultValue:ds.targetVariable}},alwaysShadow:[us]}:{setValue:{[us]:ds.targetVariable},alwaysShadow:[us]}},cs.inverseDefinition=function({desiredStateVariableValues:ds}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:ds[us]}]}}}if(ts.additionalStateVariableShadowing){let us=[],cs=[];for(let ps in ts.additionalStateVariableShadowing)us.push(ps),cs.push(ts.additionalStateVariableShadowing[ps].stateVariableToShadow);this.modifyStateDefsToBeShadows({stateVariablesToShadow:us,stateVariableDefinitions:rs,targetComponent:is,differentStateVariablesInTarget:cs})}return}let os=!1;if("readyToExpandWhenResolved"in rs){os=!0;let us=rs.readyToExpandWhenResolved,cs=us.returnDependencies.bind(us),ps=us.definition;us.returnDependencies=function(ds){let fs=cs(ds);return fs.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:is.componentName,variableName:"readyToExpandWhenResolved"},fs},us.definition=function(ds){let fs=ps(ds);return fs.setValue&&fs.setValue.readyToExpandWhenResolved&&(ds.dependencyValues.targetReadyToExpandWhenResolved||(fs.setValue.readyToExpandWhenResolved=!1)),fs}}let ls=[];for(let us in is.state){let cs=is.state[us];(cs.shadowVariable||cs.isShadow)&&ls.push(us)}this.modifyStateDefsToBeShadows({stateVariablesToShadow:ls,stateVariableDefinitions:rs,foundReadyToExpandWhenResolved:os,targetComponent:is})}modifyStateDefsToBeShadows({stateVariablesToShadow:ts,stateVariableDefinitions:rs,foundReadyToExpandWhenResolved:ns,targetComponent:is,differentStateVariablesInTarget:as=[]}){let os={};for(let[ls,us]of ts.entries()){let cs=rs[us];if(cs===void 0)if(us.slice(0,8)==="__array_")cs=rs[us]={};else continue;if(cs.isShadow=!0,cs.additionalStateVariablesDefined)for(let ds of cs.additionalStateVariablesDefined)ts.includes(ds)||(os[ds]||(os[ds]=[]),os[ds].push(us));delete cs.additionalStateVariablesDefined,ns||delete cs.stateVariablesDeterminingDependencies;let ps=cs.public&&cs.shadowingInstructions.hasVariableComponentType;if(cs.isArray){let ds=as[ls];cs.returnArrayDependenciesByKey=function({arrayKeys:fs}){let hs={};for(let gs of fs)hs[gs]={targetVariable:{dependencyType:"stateVariable",componentName:is.componentName,variableName:ds||this.arrayVarNameFromArrayKey(gs)}};let ys={};return ps&&(ys.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:is.componentName,variableName:us}),cs.inverseShadowToSetEntireArray&&(ys.targetArray={dependencyType:"stateVariable",componentName:is.componentName,variableName:us}),{globalDependencies:ys,dependenciesByKey:hs}},cs.arrayDefinitionByKey=function({globalDependencyValues:fs,dependencyValuesByKey:hs,arrayKeys:ys}){var vs;let gs={};for(let Ns of ys)"targetVariable"in hs[Ns]?gs[Ns]=hs[Ns].targetVariable:gs[Ns]=(vs=cs.defaultValueByArrayKey)==null?void 0:vs.call(cs,Ns);let bs={setValue:{[us]:gs},alwaysShadow:[us]};return"targetVariableComponentType"in fs&&(bs.setCreateComponentOfType={[us]:fs.targetVariableComponentType}),bs},cs.inverseArrayDefinitionByKey=function({desiredStateVariableValues:fs,dependencyValuesByKey:hs,dependencyNamesByKey:ys,arraySize:gs,initialChange:bs}){if(cs.inverseShadowToSetEntireArray)return{success:!0,instructions:[{setDependency:"targetArray",desiredValue:fs[us],treatAsInitialChange:bs}]};let vs=[];for(let Ns in fs[us])hs[Ns]&&vs.push({setDependency:ys[Ns].targetVariable,desiredValue:fs[us][Ns],shadowedVariable:!0});return{success:!0,instructions:vs}}}else{let ds=()=>({});ns&&(ds=cs.returnDependencies.bind(cs));let fs=as[ls];fs||(fs=us),cs.returnDependencies=function(hs){let ys=Object.assign({},ds(hs));return ys.targetVariable={dependencyType:"stateVariable",componentName:is.componentName,variableName:fs},ps&&(ys.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:is.componentName,variableName:fs}),ys},cs.definition=function({dependencyValues:hs,usedDefault:ys}){let gs={alwaysShadow:[us]};return"targetVariableComponentType"in hs&&(gs.setCreateComponentOfType={[us]:hs.targetVariableComponentType}),ys.targetVariable&&"defaultValue"in cs&&cs.hasEssential?gs.useEssentialOrDefaultValue={[us]:{defaultValue:hs.targetVariable}}:gs.setValue={[us]:hs.targetVariable},gs},cs.excludeDependencyValuesInInverseDefinition=!0,cs.inverseDefinition=function({desiredStateVariableValues:hs}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:hs[us],shadowedVariable:!0}]}}}}for(let ls in os)this.modifyStateDefToDeleteVariableReferences({varNamesToDelete:os[ls],stateDef:rs[ls]})}modifyStateDefToDeleteVariableReferences({varNamesToDelete:ts,stateDef:rs}){for(let is of ts){let as=rs.additionalStateVariablesDefined.indexOf(is);rs.additionalStateVariablesDefined.splice(as,1)}let ns=rs.definition;rs.definition=function(is){let as=ns(is);for(let os in as)if(Array.isArray(as[os]))for(let ls of ts){let us=as[os].indexOf(ls);us!==-1&&as[os].splice(us,1)}else for(let ls of ts)delete as[os][ls];return as}}async initializeComponentStateVariables(ts){for(let rs in ts.state)ts.state[rs].isAlias?(ts.stateVarAliases||(ts.stateVarAliases={}),ts.stateVarAliases[rs]=ts.state[rs].targetVariableName,delete ts.state[rs]):await this.initializeStateVariable({component:ts,stateVariable:rs})}async initializeStateVariable({component:ts,stateVariable:rs,arrayStateVariable:ns,arrayEntryPrefix:is}){let as=this.getStateVariableValue;ts.state[rs]||(ts.state[rs]={});let os=ts.state[rs];if(os.isResolved=!1,Object.defineProperty(os,"value",{get:()=>as({component:ts,stateVariable:rs}),configurable:!0}),is!==void 0?await this.initializeArrayEntryStateVariable({stateVarObj:os,arrayStateVariable:ns,arrayEntryPrefix:is,component:ts,stateVariable:rs}):os.isArray&&await this.initializeArrayStateVariable({stateVarObj:os,component:ts,stateVariable:rs}),os.triggerActionOnChange){let ls=this.stateVariableChangeTriggers[ts.componentName];ls||(ls=this.stateVariableChangeTriggers[ts.componentName]={}),ls[rs]={action:os.triggerActionOnChange}}}async checkForActionChaining({component:ts,stateVariables:rs}){if(ts){rs||(rs=Object.keys(ts.state));for(let ns of rs){let is=ts.state[ns];if(is.chainActionOnActionOfStateVariableTargets){let as=is.chainActionOnActionOfStateVariableTargets,os=await is.value,ls=this.originsOfActionsChangedToActions[ts.componentName],us;ls&&(us=ls[ns]),us||(us=[]);let cs=[];if(Array.isArray(os)){cs=[...os];for(let ps of cs){let ds=us.indexOf(ps);if(ds===-1){let fs=this.actionsChangedToActions[ps];fs||(fs=this.actionsChangedToActions[ps]=[]),fs.push({componentName:ts.componentName,actionName:as.triggeredAction,stateVariableDefiningChain:ns,args:{}})}else us.splice(ds,1)}}for(let ps of us){let ds=this.actionsChangedToActions[ps];if(ds){let fs=[];for(let hs of ds)(hs.componentName!==ts.componentName||hs.stateVariableDefiningChain!==ns)&&fs.push(hs);this.actionsChangedToActions[ps]=fs}}cs.length>0?(ls||(ls=this.originsOfActionsChangedToActions[ts.componentName]={}),ls[ns]=cs):ls&&(delete ls[ns],Object.keys(ls).length===0&&delete this.originsOfActionsChangedToActions[ts.componentName])}}}}async initializeArrayEntryStateVariable({stateVarObj:ts,arrayStateVariable:rs,arrayEntryPrefix:ns,component:is,stateVariable:as}){ts.isArrayEntry=!0,ts.arrayStateVariable=rs;let os=is.state[rs];if(ts.definition=os.definition,ts.inverseDefinition=os.inverseDefinition,ts.markStale=os.markStale,ts.freshnessInfo=os.freshnessInfo,ts.getPreviousDependencyValuesForMarkStale=os.getPreviousDependencyValuesForMarkStale,ts.provideEssentialValuesInDefinition=os.provideEssentialValuesInDefinition,ts.providePreviousValuesInDefinition=os.providePreviousValuesInDefinition,ts.nDimensions=os.returnEntryDimensions(ns),ts.entryPrefix=ns,ts.varEnding=as.slice(ns.length),os.createWorkspace&&(ts.createWorkspace=!0,ts.workspace=os.workspace),os.basedOnArrayKeyStateVariables&&(ts.basedOnArrayKeyStateVariables=!0),os.additionalStateVariablesDefined){ts.additionalStateVariablesDefined=[];let us=os.entryPrefixes.indexOf(ns);for(let cs of os.additionalStateVariablesDefined){let ps=is.state[cs];if(ps.isArray){let fs=ps.entryPrefixes[us]+ts.varEnding;ts.additionalStateVariablesDefined.push(fs)}else ts.additionalStateVariablesDefined.push(cs)}}if(os.shadowingInstructions&&(ts.shadowingInstructions={},ts.wrappingComponents=os.shadowingInstructions.returnWrappingComponents(ns),os.shadowingInstructions.attributesToShadow&&(ts.shadowingInstructions.attributesToShadow=os.shadowingInstructions.attributesToShadow),os.shadowingInstructions.createComponentOfType)){let us=os.entryPrefixes.indexOf(ns);os.shadowingInstructions.createComponentOfType[us]&&(ts.shadowingInstructions.createComponentOfType=[os.shadowingInstructions.createComponentOfType[us]])}if(os.getEntryValues?ts.getValueFromArrayValues=async function(){return await os.getEntryValues({varName:as})}:ts.getValueFromArrayValues=async function(){let us=await ts.arrayKeys;if(us.length===0)return;let cs=[];for(let ps of us)cs.push(os.getArrayValue({arrayKey:ps}));return cs.length===1?cs[0]:cs},ts.arraySizeStateVariable=os.arraySizeStateVariable,ts._arrayKeys=[],ts._unflattenedArrayKeys=[],Object.defineProperty(ts,"arrayKeys",{get:function(){return(async()=>(await os.arraySize,ts._arrayKeys))()}}),Object.defineProperty(ts,"unflattenedArrayKeys",{get:function(){return(async()=>(await os.arraySize,ts._unflattenedArrayKeys))()}}),is.state[ts.arraySizeStateVariable].initiallyResolved){let us=await os.arraySize,cs=os.getArrayKeysFromVarName({arrayEntryPrefix:ts.entryPrefix,varEnding:ts.varEnding,arraySize:us,nDimensions:os.nDimensions});ts._unflattenedArrayKeys=cs,ts._arrayKeys=flattenDeep(cs);let ps=os.varNamesIncludingArrayKeys;for(let ds of ts._arrayKeys)ps[ds]||(ps[ds]=[]),ps[ds].push(as)}if(os.arrayEntryNames.push(as),Object.defineProperty(ts,"arraySize",{get:()=>os.arraySize}),Object.defineProperty(ts,"arrayEntrySize",{get:function(){return(async()=>{let us=await ts.unflattenedArrayKeys,cs=[],ps=[us];for(let ds=0;ds<ts.nDimensions;ds++)ps=ps[0],cs.push(ps.length);return cs.reverse(),cs})()}}),os.stateVariablesDeterminingDependencies){ts.stateVariablesDeterminingDependencies||(ts.stateVariablesDeterminingDependencies=[]);for(let us of os.stateVariablesDeterminingDependencies)ts.stateVariablesDeterminingDependencies.includes(us)||ts.stateVariablesDeterminingDependencies.push(us)}let ls=os.returnDependencies.bind(os);ts.returnDependencies=async function(us){us.arraySize=await ts.arraySize,us.arrayKeys=await ts.arrayKeys;let cs=await ls(us),ps=Object.keys(os.dependencyNames.namesByKey).length;return ts.numberNamesInPreviousReturnDep!==ps&&(us.changedDependency=!0),ts.numberNamesInPreviousReturnDep=ps,cs}}async initializeArrayStateVariable({stateVarObj:ts,component:rs,stateVariable:ns}){ts.arrayValues=[],ts.nDimensions===void 0&&(ts.nDimensions=1),ts.nDimensions>1?(ts.keyToIndex=ls=>ls.split(",").map(us=>Number(us)),ts.setArrayValue=function({value:ls,arrayKey:us,arraySize:cs,arrayValues:ps=ts.arrayValues}){let ds=ts.keyToIndex(us),fs=ds.length;if(!fs>ts.nDimensions)return console.warn("Cannot set array value.  Number of dimensions is too large."),{nFailures:1};let hs=ps,ys=cs;for(let bs of ds.slice(0,ds.length-1))if(bs>=0&&bs<ys[0])hs[bs]||(hs[bs]=[]),hs=hs[bs],ys=ys.slice(1);else return console.warn("ignore setting array value out of bounds"),{nFailures:1};let gs=0;if(fs<ts.nDimensions){let bs=function(Ns,Ts,Cs){if(!Array.isArray(Ns))return console.warn("ignoring array values with insufficient dimensions"),{nFailures:1};let xs=0,As=Cs[0];if(Ns.length>As&&(console.warn("ignoring array values of out bounds"),xs+=Ns.length-As,Ns=Ns.slice(0,As)),Cs.length===1)for(let[ws,Es]of Ns.entries())Ts[ws]=Es;else for(let[ws,Es]of Ns.entries()){Ts[ws]||(Ts=[]);let Ss=bs(Es,Ts[ws],Cs[ws]);xs+=Ss.nFailures}return{nFailures:xs}},vs=bs(ls,hs,ys);gs+=vs.nFailures}else hs[ds[ds.length-1]]=ls;return{nFailures:gs}},ts.getArrayValue=function({arrayKey:ls,arrayValues:us=ts.arrayValues}){let cs=ts.keyToIndex(ls),ps=us;for(let ds of cs.slice(0,cs.length-1))if(ps=ps[ds],!ps)return;return ps[cs[cs.length-1]]},ts.getAllArrayKeys||(ts.getAllArrayKeys=function(ls,us=!0,cs){function ps(fs,hs){for(let[ys,gs]of fs.entries())Array.isArray(gs)?ps(gs,hs):fs[ys]=hs+","+gs}function ds(fs){if(fs.length===1)return Array.from(Array(fs[0]),(hs,ys)=>String(ys));{let hs=fs[0],ys=ds(fs.slice(1)),gs=[];for(let bs=0;bs<hs;bs++)if(us)gs.push(...ys.map(vs=>bs+","+vs));else{let vs=deepClone(ys);ps(vs,bs),gs.push(vs)}return gs}}return cs?cs.length===0?[]:ds(cs):!ls||ls.length===0?[]:ds(ls)}),ts.arrayVarNameFromArrayKey||(ts.arrayVarNameFromArrayKey=function(ls){return is[0]+ls.split(",").map(us=>Number(us)+1).join("_")}),ts.arrayVarNameFromPropIndex||(ts.arrayVarNameFromPropIndex=function(ls,us){return is[0]+[...ls.map(cs=>Math.round(Number(cs))),...Array(ts.nDimensions-ls.length).fill(1)].join("_")}),ts.adjustArrayToNewArraySize=async function(){function ls(cs,ps){if(cs.length=ps[0],ps.length>1){let ds=ps.slice(1);for(let[fs,hs]of cs.entries())hs||(hs=cs[fs]=[]),ls(hs,ds)}}let us=await ts.arraySize;ls(ts.arrayValues,us)}):(ts.keyToIndex=ls=>Number(ls),ts.setArrayValue=function({value:ls,arrayKey:us,arraySize:cs,arrayValues:ps=ts.arrayValues}){let ds=ts.keyToIndex(us);return ds>=0&&ds<cs[0]?(ps[ds]=ls,{nFailures:0}):(console.warn(`Ignoring setting array values out of bounds: ${us} of ${ns}`),{nFailures:1})},ts.getArrayValue=function({arrayKey:ls,arrayValues:us=ts.arrayValues}){return us[ls]},ts.getAllArrayKeys||(ts.getAllArrayKeys=function(ls,us,cs){return cs?cs.length===0?[]:Array.from(Array(cs[0]),(ps,ds)=>String(ds)):!ls||ls.length===0?[]:Array.from(Array(ls[0]),(ps,ds)=>String(ds))}),ts.arrayVarNameFromArrayKey||(ts.arrayVarNameFromArrayKey=function(ls){return is[0]+String(Number(ls)+1)}),ts.arrayVarNameFromPropIndex||(ts.arrayVarNameFromPropIndex=function(ls,us){return is[0]+ls[0]}),ts.adjustArrayToNewArraySize=async function(){let ls=await ts.arraySize;ts.arrayValues.length=ls[0]}),ts.getArrayKeysFromVarName||(ts.getArrayKeysFromVarName=returnDefaultGetArrayKeysFromVarName(ts.nDimensions)),ts.indexToKey=ls=>String(ls);let is=ts.entryPrefixes;is||(is=ts.entryPrefixes=[ns]),rs.arrayEntryPrefixes||(rs.arrayEntryPrefixes={});for(let ls of is)rs.arrayEntryPrefixes[ls]=ns;ts.returnEntryDimensions||(ts.returnEntryDimensions=()=>1),ts.shadowingInstructions&&(ts.shadowingInstructions.returnWrappingComponents||(ts.shadowingInstructions.returnWrappingComponents=ls=>[]),ts.wrappingComponents=ts.shadowingInstructions.returnWrappingComponents()),ts.usedDefaultByArrayKey={},ts.arrayEntryNames=[],ts.varNamesIncludingArrayKeys={};let as=[ns];ts.additionalStateVariablesDefined&&as.push(...ts.additionalStateVariablesDefined),ts.returnDependencies=async function(ls){ls.arraySize=await ts.arraySize;for(let cs in ls.stateValues)cs.slice(0,8)==="__array_"&&delete ls.stateValues[cs];if(ls.arrayKeys===void 0&&(ls.arrayKeys=ts.getAllArrayKeys(ls.arraySize)),!ts.dependencyNames&&(ts.dependencyNames={namesByKey:{},keysByName:{},global:[]},ts.additionalStateVariablesDefined))for(let cs of ts.additionalStateVariablesDefined)rs.state[cs].dependencyNames=ts.dependencyNames;let us={};if(ts.basedOnArrayKeyStateVariables&&ls.arrayKeys.length>1)for(let cs of ls.arrayKeys)for(let ps of as){let ds=rs.state[ps];us[ps+"_"+cs]={dependencyType:"stateVariable",variableName:ds.arrayVarNameFromArrayKey(cs)}}else{let cs=ts.returnArrayDependenciesByKey(ls);cs.globalDependencies&&(ts.dependencyNames.global=Object.keys(cs.globalDependencies),Object.assign(us,cs.globalDependencies)),cs.dependenciesByKey||(cs.dependenciesByKey={});for(let ps of ls.arrayKeys){ps in ts.dependencyNames.namesByKey||(ls.changedDependency=!0),ts.dependencyNames.namesByKey[ps]={};for(let ds in cs.dependenciesByKey[ps]){let fs="__"+ps+"_"+ds;us[fs]=cs.dependenciesByKey[ps][ds],ts.dependencyNames.namesByKey[ps][ds]=fs,ts.dependencyNames.keysByName[fs]||(ts.dependencyNames.keysByName[fs]=[]),ts.dependencyNames.keysByName[fs].includes(ps)||ts.dependencyNames.keysByName[fs].push(ps)}}ts.dependencyNames.global.push("__array_size")}return us.__array_size={dependencyType:"stateVariable",variableName:ts.arraySizeStateVariable},us},ts.getCurrentFreshness=function({freshnessInfo:ls,arrayKeys:us,arraySize:cs}){us===void 0&&(us=ts.getAllArrayKeys(cs));let ps=ls.freshByKey,ds=ls.freshArraySize?1:0;for(let fs of us)ps[fs]&&(ds+=1);return ds>0?ds===us.length+1?{fresh:{[ns]:!0}}:{partiallyFresh:{[ns]:ds}}:{fresh:{[ns]:!1}}},ts.markStale=function({freshnessInfo:ls,changes:us,arrayKeys:cs,arraySize:ps}){let ds={};cs===void 0&&(cs=ts.getAllArrayKeys(ps)),ts.markStaleByKey&&(ds=ts.markStaleByKey({arrayKeys:cs,changes:us}));let fs=ls.freshByKey;if(us.__array_size)return ls.freshArraySize=!1,ls.freshByKey={},ds.fresh={[ns]:!1},ds;if(Object.keys(fs).length===0)return ls.freshByKey={},ls.freshArraySize?(ds.partiallyFresh={[ns]:1},ds):(ds.fresh={[ns]:!1},ds);for(let ys in us){if(ts.dependencyNames.global.includes(ys))return ls.freshByKey={},ls.freshArraySize?(ds.partiallyFresh={[ns]:1},ds):(ds.fresh={[ns]:!1},ds);if(ts.basedOnArrayKeyStateVariables&&cs.length>1)delete fs[ys];else for(let gs of ts.dependencyNames.keysByName[ys])delete fs[gs]}let hs=ls.freshArraySize?1:0;for(let ys of cs)fs[ys]&&(hs+=1);return hs>0?hs===cs.length+1?(ds.fresh={[ns]:!0},ds):(ds.partiallyFresh={[ns]:hs},ds):(ds.fresh={[ns]:!1},ds)},ts.freshenOnNoChanges=function({arrayKeys:ls,freshnessInfo:us,arraySize:cs}){let ps=us.freshByKey;ls===void 0&&(ls=ts.getAllArrayKeys(cs));for(let ds of ls)ps[ds]=!0};function os(ls,us,cs){let ps={},ds={};for(let gs of ts.dependencyNames.global)ps[gs]=ls[gs],ds[gs]=cs[gs];let fs={},hs={},ys={};for(let gs of us)if(fs[gs]={},hs[gs]={},gs in ts.dependencyNames.namesByKey){ys[gs]=!0;for(let bs in ts.dependencyNames.namesByKey[gs]){let vs=ts.dependencyNames.namesByKey[gs][bs];vs in ls?(fs[gs][bs]=ls[vs],hs[gs][bs]=cs[vs]):ys[gs]=!1}}return{globalDependencyValues:ps,globalUsedDefault:ds,dependencyValuesByKey:fs,usedDefaultByKey:hs,foundAllDependencyValuesForKey:ys}}if(ts.definition=function(ls){if(ls.arrayKeys===void 0&&(ls.arrayKeys=ts.getAllArrayKeys(ls.arraySize)),ts.basedOnArrayKeyStateVariables&&ls.arrayKeys.length>1)return{};{let us=os(ls.dependencyValues,ls.arrayKeys,ls.usedDefault),cs=us.globalDependencyValues,ps=us.globalUsedDefault,ds=us.dependencyValuesByKey,fs=us.usedDefaultByKey,hs=us.foundAllDependencyValuesForKey;delete ls.dependencyValues,ls.globalDependencyValues=cs,ls.globalUsedDefault=ps,ls.dependencyValuesByKey=ds,ls.usedDefaultByKey=fs;let ys=[],gs=ls.freshnessInfo.freshByKey;for(let vs of ls.arrayKeys)!gs[vs]&&hs[vs]&&(gs[vs]=!0,ys.push(vs));let bs;if(ys.length===0)bs={};else{if(ls.arrayKeys=ys,!ts.arrayDefinitionByKey)throw Error(`For ${ns} of ${rs.componentType}, arrayDefinitionByKey must be a function`);if(bs=ts.arrayDefinitionByKey(ls),bs.setValue&&bs.setValue[ns])for(let vs in bs.setValue[ns])gs[vs]=!0;if(bs.useEssentialOrDefaultValue&&bs.useEssentialOrDefaultValue[ns])for(let vs in bs.useEssentialOrDefaultValue[ns])gs[vs]=!0}if(!ls.freshnessInfo.freshArraySize){if(ls.changes.__array_size&&(bs.arraySizeChanged=[ns],ts.additionalStateVariablesDefined))for(let vs of ts.additionalStateVariablesDefined)rs.state[vs].isArray&&bs.arraySizeChanged.push(vs);ls.freshnessInfo.freshArraySize=!0}return bs}},ts.inverseDefinition=function(ls){if(!ts.inverseArrayDefinitionByKey)return{success:!1};if(ls.arrayKeys===void 0&&(ls.arrayKeys=ts.getAllArrayKeys(ls.arraySize)),ts.basedOnArrayKeyStateVariables&&ls.arrayKeys.length>1){let us=[];for(let cs of as)for(let ps in ls.desiredStateVariableValues[cs]){let ds=cs+"_"+ps;ds in ls.dependencyValues&&us.push({setDependency:ds,desiredValue:ls.desiredStateVariableValues[cs][ps],treatAsInitialChange:ls.initialChange})}return{success:!0,instructions:us}}else{let us=os(ls.dependencyValues,ls.arrayKeys,ls.usedDefault),cs=us.globalDependencyValues,ps=us.globalUsedDefault,ds=us.dependencyValuesByKey,fs=us.usedDefaultByKey;delete ls.dependencyValues,ls.globalDependencyValues=cs,ls.globalUsedDefault=ps,ls.dependencyValuesByKey=ds,ls.usedDefaultByKey=fs,ls.dependencyNamesByKey=ts.dependencyNames.namesByKey;let hs={};for(let gs in ls.desiredStateVariableValues)if(Array.isArray(ls.desiredStateVariableValues[gs]))hs[gs]=ls.desiredStateVariableValues[gs];else{hs[gs]={};for(let bs in ls.desiredStateVariableValues[gs])ls.arrayKeys.includes(bs)&&(hs[gs][bs]=ls.desiredStateVariableValues[gs][bs])}return ls.desiredStateVariableValues=hs,ts.inverseArrayDefinitionByKey(ls)}},await this.createArraySizeStateVariable({stateVarObj:ts,component:rs,stateVariable:ns}),ts.arraySizeStale=!0,ts.previousArraySize=[],Object.defineProperty(ts,"arraySize",{get:function(){return(async()=>rs.state[ts.arraySizeStateVariable].initiallyResolved?(ts.arraySizeStale&&await ts.recalculateArraySizeDependentQuantities(),await rs.stateValues[ts.arraySizeStateVariable]):[])()}}),ts.recalculateArraySizeDependentQuantities=async function(){let ls=await rs.stateValues[ts.arraySizeStateVariable];if(ts.previousArraySize.length!==ls.length||ts.previousArraySize.some((us,cs)=>us!=ls[cs])){ts.previousArraySize=[...ls];let us=ts.varNamesIncludingArrayKeys={};for(let cs of ts.arrayEntryNames){let ps=rs.state[cs],ds=ts.getArrayKeysFromVarName({arrayEntryPrefix:ps.entryPrefix,varEnding:ps.varEnding,arraySize:ls,nDimensions:ts.nDimensions});ps._unflattenedArrayKeys=ds,ps._arrayKeys=flattenDeep(ds);for(let fs of ps._arrayKeys)us[fs]||(us[fs]=[]),us[fs].push(cs)}}ts.arraySizeStale=!1},!ts.freshnessInfo&&(ts.freshnessInfo={freshByKey:{}},ts.additionalStateVariablesDefined))for(let ls of ts.additionalStateVariablesDefined)rs.state[ls]||(rs.state[ls]={}),rs.state[ls].freshnessInfo=ts.freshnessInfo}async createArraySizeStateVariable({stateVarObj:ts,component:rs,stateVariable:ns}){let is=[ns];ts.additionalStateVariablesDefined&&is.push(...ts.additionalStateVariablesDefined),is.sort();let as="__array_size_"+is.join("_");if(ts.arraySizeStateVariable=as,ts.stateVariablesDeterminingDependencies?([...ts.stateVariablesDeterminingDependencies],ts.stateVariablesDeterminingDependencies.push(as)):ts.stateVariablesDeterminingDependencies=[as],rs.state[as]){if(rs.state[as].isShadow){let os=rs.state[as];os.markStale=function(){for(let ls of is)rs.state[ls].arraySizeStale=!0;return{}}}return}rs.state[as]={returnDependencies:ts.returnArraySizeDependencies,definition({dependencyValues:os}){let ls=ts.returnArraySize({dependencyValues:os});for(let[us,cs]of ls.entries())Number.isInteger(cs)&&cs>=0||(ls[us]=0);return{setValue:{[as]:ls}}},markStale(){for(let os of is)rs.state[os].arraySizeStale=!0;return{}}},ts.stateVariablesDeterminingArraySizeDependencies&&(rs.state[as].stateVariablesDeterminingDependencies=ts.stateVariablesDeterminingArraySizeDependencies),await this.initializeStateVariable({component:rs,stateVariable:as})}async arrayEntryNamesFromPropIndex({stateVariables:ts,component:rs,propIndex:ns}){let is=[];for(let as of ts){let os=rs.state[as];if(!os){if(!this.checkIfArrayEntry({stateVariable:as,component:rs})){is.push(as);continue}await this.createFromArrayEntry({stateVariable:as,component:rs}),os=rs.state[as]}let ls;os.isArray?ls=os.arrayVarNameFromPropIndex(ns,as):os.isArrayEntry?ls=rs.state[os.arrayStateVariable].arrayVarNameFromPropIndex(ns,as):(console.warn(`Cannot get propIndex from ${as} of ${rs.componentName} as it is not an array or array entry state variable`),ls=as),ls?is.push(ls):(console.warn(`Cannot get propIndex from ${as} of ${rs.componentName}`),is.push(as))}return is}recursivelyReplaceCompositesWithReplacements({replacements:ts,recurseNonStandardComposites:rs=!1,forceExpandComposites:ns=!1,includeWithheldReplacements:is=!1}){let as=[],os=[],ls=[],us=[];for(let cs of ts)if(this.componentInfoObjects.isCompositeComponent({componentType:cs.componentType,includeNonStandard:rs}))if(as.push(cs.componentName),cs.isExpanded||(cs.state.readyToExpandWhenResolved.isResolved?ls.push(cs.componentName):us.push(cs.componentName)),cs.isExpanded){let ps=cs.replacements;!is&&cs.replacementsToWithhold>0&&(ps=ps.slice(0,-cs.replacementsToWithhold));let ds=this.recursivelyReplaceCompositesWithReplacements({replacements:ps,recurseNonStandardComposites:rs,forceExpandComposites:ns,includeWithheldReplacements:is});as.push(...ds.compositesFound),os.push(...ds.newReplacements),ls.push(...ds.unexpandedCompositesReady),us.push(...ds.unexpandedCompositesNotReady)}else os.push(cs);else os.push(cs);return{compositesFound:as,newReplacements:os,unexpandedCompositesReady:ls,unexpandedCompositesNotReady:us}}async getStateVariableValue({component:ts,stateVariable:rs}){var fs,hs,ys,gs,bs;let ns=ts.state[rs];if(!ns)throw Error(`Can't get value of ${rs} of ${ts.componentName} as it doesn't exist.`);if(ts.reprocessAfterEvaluate){let vs=ts.reprocessAfterEvaluate;delete this._components[ts.componentName].reprocessAfterEvaluate;for(let Ns in vs)ts.state[Ns]&&await this.getStateVariableValue({component:ts,stateVariable:Ns});await this.processNewStateVariableValues({[ts.componentName]:vs})}let is=ns.additionalStateVariablesDefined,as=[rs];is&&as.push(...is);let os=!1;for(let vs of as){if(!ts.state[vs].isResolved&&!(await this.dependencies.resolveItem({componentName:ts.componentName,type:"stateVariable",stateVariable:vs,force:!0})).success)throw Error(`Can't get value of ${rs} of ${ts.componentName} as ${vs} couldn't be resolved.`);ts.state[vs].justUpdatedForNewComponent&&(delete this._components[ts.componentName].state[vs].justUpdatedForNewComponent,os=!0)}let ls=await this.getStateVariableDefinitionArguments({component:ts,stateVariable:rs});ls.componentInfoObjects=this.componentInfoObjects,ls.justUpdatedForNewComponent=os,ls.freshnessInfo=ns.freshnessInfo;let us=ls.arraySize,cs;if(Object.keys(ls.changes).length===0&&ns._previousValue!==void 0&&!ns.forceRecalculation){let vs=[rs];is&&vs.push(...is),cs={noChanges:vs},ns.freshenOnNoChanges&&ns.freshenOnNoChanges(ls)}else delete ns.forceRecalculation,cs=ns.definition(ls);let ps={[rs]:!1},ds={};if(is)for(let vs of is)ps[vs]=!1;for(let vs in cs.setValue){if(!(vs in ts.state))throw Error(`Definition of state variable ${rs} of ${ts.componentName} returned value of ${vs}, which isn't a state variable.`);let Ns;if(vs in ps)ps[vs]=!0,ts.state[vs].isArray?ds[vs]||(ds[vs]={arrayKeysChanged:{}}):ds[vs]=!0;else{if(ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){for(let Ts of ts.state[vs].arrayEntryNames)if(Ts in ps){Ns=Ts,ps[Ts]=!0,ds[Ts]=!0;break}}if(!Ns)throw Error(`Attempting to set value of stateVariable ${vs} in definition of ${rs} of ${ts.componentName}, but it's not listed as an additional state variable defined.`)}if(!ts.state[vs].isResolved&&(!Ns||!ts.state[Ns].isResolved))throw Error(`Attempting to set value of stateVariable ${vs} of ${ts.componentName} while it is still unresolved!`);if(ts.state[vs].isArray){ds[vs]||(ds[vs]={arrayKeysChanged:{}});let Ts={};cs.checkForActualChange&&cs.checkForActualChange[vs]&&(Ts=cs.checkForActualChange[vs]);for(let Cs in cs.setValue[vs])if(Ts[Cs]){let xs=ts.state[vs].getArrayValue({arrayKey:Cs}),As=cs.setValue[vs][Cs];xs!==As&&(ts.state[vs].setArrayValue({value:cs.setValue[vs][Cs],arrayKey:Cs,arraySize:us}),ts.state[vs].usedDefaultByArrayKey[Cs]=!1,ds[vs].arrayKeysChanged[Cs]=!0)}else ts.state[vs].setArrayValue({value:cs.setValue[vs][Cs],arrayKey:Cs,arraySize:us}),ts.state[vs].usedDefaultByArrayKey[Cs]=!1,ds[vs].arrayKeysChanged[Cs]=!0}else if(delete ts.state[vs].value,ts.state[vs].value=cs.setValue[vs],delete ts.state[vs].usedDefault,(fs=cs.checkForActualChange)!=null&&fs[vs]){let Ts=ts.state[vs].value,Cs=ts.state[vs]._previousValue;(Ts===Cs||Array.isArray(Ts)&&Array.isArray(Cs)&&Ts.length===Cs.length&&Ts.every((xs,As)=>xs===Cs[As]))&&delete ds[vs]}}for(let vs in cs.useEssentialOrDefaultValue){if(!(vs in ts.state))throw Error(`Definition of state variable ${rs} of ${ts.componentName} requested essential or default value of ${vs}, which isn't a state variable.`);if(!ts.state[vs].hasEssential)throw Error(`Definition of state variable ${rs} of ${ts.componentName} requested essential or default value of ${vs}, but hasEssential is not set.`);let Ns;if(vs in ps)ps[vs]=!0,ts.state[vs].isArray?ds[vs]||(ds[vs]={arrayKeysChanged:{}}):ds[vs]=!0;else{if(ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){for(let xs of ts.state[vs].arrayEntryNames)if(xs in ps){Ns=xs,ps[xs]=!0,ds[xs]=!0;break}}if(!Ns)throw Error(`Attempting to set value of stateVariable ${vs} in definition of ${rs} of ${ts.componentName}, but it's not listed as an additional state variable defined.`)}if(!ts.state[vs].isResolved&&(!Ns||!ts.state[Ns].isResolved))throw Error(`Attempting to set value of stateVariable ${vs} of ${ts.componentName} while it is still unresolved!`);let Ts=vs;ts.state[vs].essentialVarName&&(Ts=ts.state[vs].essentialVarName);let Cs=ts.essentialState[Ts];if(ts.state[vs].isArray){ds[vs]||(ds[vs]={arrayKeysChanged:{}});let xs={};cs.checkForActualChange&&cs.checkForActualChange[vs]&&(xs=cs.checkForActualChange[vs]);for(let As in cs.useEssentialOrDefaultValue[vs]){let ws;xs[As]&&(ws=ts.state[vs].getArrayValue({arrayKey:As}));let Es;if(Array.isArray(Cs)?Es=ts.state[vs].getArrayValue({arrayKey:As,arrayValues:Cs}):Cs=ts.essentialState[Ts]=[],Es!==void 0)ts.state[vs].setArrayValue({value:Es,arrayKey:As,arraySize:us});else{let Ss=cs.useEssentialOrDefaultValue[vs][As].defaultValue;if(Ss!==void 0)ts.state[vs].setArrayValue({value:Ss,arrayKey:As,arraySize:us}),ts.state[vs].usedDefaultByArrayKey[As]=!0;else if(((ys=(hs=ts.state[vs]).defaultValueByArrayKey)==null?void 0:ys.call(hs,As))!==void 0)ts.state[vs].setArrayValue({value:ts.state[vs].defaultValueByArrayKey(As),arrayKey:As,arraySize:us}),ts.state[vs].usedDefaultByArrayKey[As]=!0;else throw Error(`Neither value nor default value specified; state variable: ${vs}, component: ${ts.componentName}, arrayKey: ${As}.`)}xs[As]?ts.state[vs].getArrayValue({arrayKey:As})!==ws&&(ds[vs].arrayKeysChanged[As]=!0):ds[vs].arrayKeysChanged[As]=!0}}else{if(Cs!==void 0)delete ts.state[vs].value,ts.state[vs].value=Cs;else{let xs=cs.useEssentialOrDefaultValue[vs].defaultValue;if(xs!==void 0)delete ts.state[vs].value,ts.state[vs].value=xs,ts.state[vs].usedDefault=!0;else if(ts.state[vs].defaultValue!==void 0)delete ts.state[vs].value,ts.state[vs].value=ts.state[vs].defaultValue,ts.state[vs].usedDefault=!0;else throw Error(`Neither value nor default value specified; state variable: ${vs}, component: ${ts.componentName}.`)}if((gs=cs.checkForActualChange)!=null&&gs[vs]){let xs=ts.state[vs].value,As=ts.state[vs]._previousValue;(xs===As||Array.isArray(xs)&&Array.isArray(As)&&xs.length===As.length&&xs.every((ws,Es)=>ws===As[Es]))&&delete ds[vs]}}}for(let vs in cs.markAsUsedDefault){if(!ts.state[vs].isResolved)throw Error(`Marking state variable as used default when it isn't yet resolved: ${vs} of ${ts.componentName}`);if(!(vs in ps)){let Ns;if(ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){for(let Ts of ts.state[vs].arrayEntryNames)if(Ts in ps){Ns=Ts;break}}if(!Ns)throw Error(`Marking state variable  ${vs} as used default in definition of ${rs} of ${ts.componentName}, but it's not listed as an additional state variable defined.`)}if(Array.isArray())for(let Ns in cs.markAsUsedDefault[vs])cs.markAsUsedDefault[vs][Ns]&&(ts.state[vs].usedDefaultByArrayKey[Ns]=!0);else cs.markAsUsedDefault[vs]&&(ts.state[vs].usedDefault=!0)}if(cs.noChanges)for(let vs of cs.noChanges){if(ts.state[vs].isResolved||(ts.state[vs].isResolved=!0),!(vs in ps)){let Ns;if(ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){for(let Ts of ts.state[vs].arrayEntryNames)if(Ts in ps){Ns=Ts;break}}if(!Ns)throw Error(`Claiming stateVariable ${vs} is unchanged in definition of ${rs} of ${ts.componentName}, but it's not listed as an additional state variable defined.`)}ps[vs]=!0,(Object.getOwnPropertyDescriptor(ts.state[vs],"value").get||ts.state[vs].immutable)&&(delete ts.state[vs].value,ts.state[vs].value=ts.state[vs]._previousValue)}for(let vs in cs.setEssentialValue){if(!(vs in ts.state))throw Error(`Definition of state variable ${rs} of ${ts.componentName} tried to make ${vs} essential, which isn't a state variable.`);if(!(vs in ps)){let Ts;if(ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){for(let Cs of ts.state[vs].arrayEntryNames)if(Cs in ps){Ts=Cs;break}}if(!Ts)throw Error(`Attempting to set essential value of stateVariable ${vs} in definition of ${rs} of ${ts.componentName}, but it's not listed as an additional state variable defined.`)}if(!ts.state[vs].hasEssential)throw Error(`Attempting to set the essential value of stateVariable ${vs} in definition of ${rs} of ${ts.componentName}, but it does not have an essential value`);if(!(ts.state[vs].shadowVariable||ts.state[vs].doNotShadowEssential))throw Error(`Attempting to set the essential value of stateVariable ${vs} in definition of ${rs} of ${ts.componentName}, but it is not allowed unless the state variable is shadowed or the essential state is not shadowed.`);this.essentialValuesSavedInDefinition[ts.componentName]||(this.essentialValuesSavedInDefinition[ts.componentName]={});let Ns=vs;if(ts.state[vs].essentialVarName&&(Ns=ts.state[vs].essentialVarName),ts.state[vs].isArray){let Ts=ts.essentialState[Ns];Array.isArray(Ts)||(Ts=ts.essentialState[Ns]=[]),this.essentialValuesSavedInDefinition[ts.componentName][vs]||(this.essentialValuesSavedInDefinition[ts.componentName][vs]={mergeObject:!0});for(let Cs in cs.setEssentialValue[vs])ts.state[vs].setArrayValue({value:cs.setEssentialValue[vs][Cs],arrayKey:Cs,arraySize:us,arrayValues:Ts}),this.essentialValuesSavedInDefinition[ts.componentName][vs][Cs]=cs.setEssentialValue[vs][Cs]}else ts.essentialState[Ns]=cs.setEssentialValue[vs],this.essentialValuesSavedInDefinition[ts.componentName][vs]=cs.setEssentialValue[vs]}if(cs.setCreateComponentOfType)for(let vs in cs.setCreateComponentOfType){if(!((bs=ts.state[vs].shadowingInstructions)!=null&&bs.hasVariableComponentType))throw Error(`Cannot set type of ${vs} of ${ts.componentName} as it it does not have the hasVariableComponentType attribute.`);let Ns=!1,Ts=ts.state[vs].shadowingInstructions;Ts||(Ts=ts.state[vs].shadowingInstructions={});let Cs=Ts.createComponentOfType,xs=cs.setCreateComponentOfType[vs];if(Array.isArray(Cs)?Array.isArray(xs)?(Cs.length!==xs.length||Cs.some((As,ws)=>As!=xs[ws]))&&(Ns=!0):Ns=!0:Array.isArray(xs)?Ns=!0:Ns=Cs!==xs,Ns&&(ds[vs]=!0),Ts.createComponentOfType=cs.setCreateComponentOfType[vs],ts.state[vs].isArray&&ts.state[vs].arrayEntryNames){let As=cs.setCreateComponentOfType[vs],ws=Array.isArray(As);for(let Es of ts.state[vs].arrayEntryNames)if(ws){let Ss=await ts.state[Es].arrayKeys,Ds=[];for(let Vs of Ss){let Is=ts.state[vs].keyToIndex(Vs);Ds.push(As[Is])}ts.state[Es].shadowingInstructions.createComponentOfType=Ds}else ts.state[Es].shadowingInstructions.createComponentOfType=As}}if(cs.arraySizeChanged)for(let vs of cs.arraySizeChanged)await ts.state[vs].adjustArrayToNewArraySize(),ds[vs]===void 0?ds[vs]={arrayKeysChanged:{}}:ds[vs]===!0&&(ds[vs]={allArrayKeysChanged:!0,arrayKeysChanged:{}}),ds[vs].arraySizeChanged=!0;for(let vs in ps){if(!(ps[vs]||ts.state[vs].isArrayEntry||ts.state[vs].isArray))throw Error(`definition of ${rs} of ${ts.componentName} didn't return value of ${vs}`);ts.state[vs].isArray?(delete ts.state[vs].value,ts.state[vs].value=ts.state[vs].arrayValues):ts.state[vs].isArrayEntry&&(delete ts.state[vs].value,ts.state[vs].value=await ts.state[vs].getValueFromArrayValues())}for(let vs in ds)if(this.dependencies.recordActualChangeInUpstreamDependencies({component:ts,varName:vs,changes:ds[vs]}),ts.state[vs].isArray){let Ns=[];if(ds[vs]===!0||ds[vs].allArrayKeysChanged||ds.arraySizeChanged)ts.state[vs].arrayEntryNames&&(Ns=ts.state[vs].arrayEntryNames);else{let Ts=ts.state[vs].varNamesIncludingArrayKeys;for(let Cs in ds[vs].arrayKeysChanged){let xs=Ts[Cs];xs&&Ns.push(...xs)}}Ns=[...new Set(Ns)];for(let Ts of Ns)this.dependencies.recordActualChangeInUpstreamDependencies({component:ts,varName:Ts})}return await ns.value}async getStateVariableDefinitionArguments({component:ts,stateVariable:rs,excludeDependencyValues:ns}){let is;ns?is={}:is=await this.dependencies.getStateVariableDependencyValues({component:ts,stateVariable:rs}),is.componentName=ts.componentName;let as=ts.state[rs];if(as.isArrayEntry?(is.arrayKeys=await as.arrayKeys,is.arraySize=await as.arraySize):as.isArray&&(is.arraySize=await as.arraySize),as.createWorkspace&&(is.workspace=as.workspace),as.providePreviousValuesInDefinition||as.provideEssentialValuesInDefinition){let os=[rs];if(as.additionalStateVariablesDefined&&os.push(...as.additionalStateVariablesDefined),as.providePreviousValuesInDefinition){let ls={};for(let us of os)ts.state[us].isArrayEntry&&(us=ts.state[us].arrayStateVariable),ls[us]=ts.state[us]._previousValue;is.previousValues=ls}if(as.provideEssentialValuesInDefinition){let ls={};for(let us of os){ts.state[us].isArrayEntry&&(us=ts.state[us].arrayStateVariable);let cs=us;ts.state[us].essentialVarName&&(cs=ts.state[us].essentialVarName),ls[us]=ts.essentialState[cs]}is.essentialValues=ls}}return is}async recordActualChangeInStateVariable({componentName:ts,varName:rs}){let ns=this._components[ts];await this.markStateVariableAndUpstreamDependentsStale({component:ns,varName:rs});let is=[rs];ns.state[rs].additionalStateVariablesDefined&&is.push(...ns.state[rs].additionalStateVariablesDefined);for(let as of is)ns.state[as].forceRecalculation=!0,this.dependencies.recordActualChangeInUpstreamDependencies({component:ns,varName:as})}findCaseInsensitiveMatches({stateVariables:ts,componentClass:rs}){let ns=this.componentInfoObjects.stateVariableInfo[rs.componentType],is=[];for(let as of ts){let os=!1,ls=as.toLowerCase();for(let ds in ns.stateVariableDescriptions)if(ls===ds.toLowerCase()){os=!0,is.push(ds);break}if(os)continue;let us=!1,cs=ls;ls.substring(0,13)==="__array_size_"&&(us=!0,cs=ls.substring(13));for(let ds in ns.aliases)if(cs===ds.toLowerCase()){us&&(ds="__array_size_"+ds),is.push(ds),os=!0;break}if(os)continue;let ps=Object.keys(ns.arrayEntryPrefixes).sort((ds,fs)=>fs.length-ds.length);for(let ds of ps)if(ls.substring(0,ds.length)===ds.toLowerCase()){let fs=ns.arrayEntryPrefixes[ds].arrayVariableName,hs=ns.stateVariableDescriptions[fs];if(hs.getArrayKeysFromVarName({arrayEntryPrefix:ds,varEnding:as.substring(ds.length),nDimensions:hs.nDimensions}).length>0){let gs=ds+ls.substring(ds.length);os=!0,is.push(gs);break}}os||is.push(as)}return is}matchPublicStateVariables({stateVariables:ts,componentClass:rs}){let ns=this.componentInfoObjects.publicStateVariableInfo[rs.componentType],is=[];for(let as of ts){if(as in ns.stateVariableDescriptions){is.push(as);continue}let os=as;if(os in ns.aliases&&(os=ns.aliases[os],os in ns.stateVariableDescriptions)){is.push(os);continue}let ls=!1,us=Object.keys(ns.arrayEntryPrefixes).sort((cs,ps)=>ps.length-cs.length);for(let cs of us)if(os.substring(0,cs.length)===cs){let ps=ns.arrayEntryPrefixes[cs].arrayVariableName,ds=ns.stateVariableDescriptions[ps];if(ds.getArrayKeysFromVarName({arrayEntryPrefix:cs,varEnding:os.substring(cs.length),nDimensions:ds.nDimensions}).length>0){ls=!0;break}}ls?is.push(as):is.push("__not_public_"+as)}return is}substituteAliases({stateVariables:ts,componentClass:rs}){let ns=[],is=this.componentInfoObjects.stateVariableInfo[rs.componentType];for(let as of ts){let os=!1;as.substring(0,13)==="__array_size_"&&(os=!0,as=as.substring(13)),as=as in is.aliases?is.aliases[as]:as,os&&(as="__array_size_"+as),ns.push(as)}return ns}publicCaseInsensitiveAliasSubstitutions({stateVariables:ts,componentClass:rs}){let ns=this.findCaseInsensitiveMatches({stateVariables:ts,componentClass:rs});return ns=this.matchPublicStateVariables({stateVariables:ns,componentClass:rs}),ns=this.substituteAliases({stateVariables:ns,componentClass:rs}),ns}checkIfArrayEntry({stateVariable:ts,component:rs}){for(let ns in rs.arrayEntryPrefixes)if(ts.substring(0,ns.length)===ns){let is=rs.arrayEntryPrefixes[ns],as=rs.state[is];if(as.getArrayKeysFromVarName({arrayEntryPrefix:ns,varEnding:ts.substring(ns.length),nDimensions:as.nDimensions}).length>0)return!0}return!1}async createFromArrayEntry({stateVariable:ts,component:rs,initializeOnly:ns=!1}){if(!rs.arrayEntryPrefixes)throw Error(`Unknown state variable ${ts} of ${rs.componentName}`);let is=Object.keys(rs.arrayEntryPrefixes).sort((as,os)=>os.length-as.length);for(let as of is)if(ts.substring(0,as.length)===as){let os=rs.arrayEntryPrefixes[as],ls=rs.state[os];if(ls.getArrayKeysFromVarName({arrayEntryPrefix:as,varEnding:ts.substring(as.length),nDimensions:ls.nDimensions}).length>0){let cs=rs.arrayEntryPrefixes[as];if(await this.initializeStateVariable({component:rs,stateVariable:ts,arrayStateVariable:cs,arrayEntryPrefix:as}),ns)return;let ps=[ts];if(rs.state[ts].additionalStateVariablesDefined){ps.push(...rs.state[ts].additionalStateVariablesDefined);for(let fs of rs.state[ts].additionalStateVariablesDefined)rs.state[fs]||await this.createFromArrayEntry({stateVariable:fs,component:rs,initializeOnly:!0})}await this.dependencies.setUpStateVariableDependencies({component:rs,stateVariable:ts,allStateVariablesAffected:ps,core:this});let ds=[];for(let fs of ps)this.dependencies.checkForCircularDependency({componentName:rs.componentName,varName:fs}),ds.push(fs),rs.state[fs].determineDependenciesStateVariable&&ds.push(rs.state[fs].determineDependenciesStateVariable);await this.dependencies.resolveStateVariablesIfReady({component:rs,stateVariables:ds});return}}throw Error(`Unknown state variable ${ts} of ${rs.componentName}`)}async markStateVariableAndUpstreamDependentsStale({component:ts,varName:rs}){rs in this.rendererVariablesByComponentType[ts.componentType]&&this.updateInfo.componentsToUpdateRenderers.add(ts.componentName);let ns={[rs]:ts.state[rs]};ts.state[rs].additionalStateVariablesDefined&&ts.state[rs].additionalStateVariablesDefined.forEach(ds=>ns[ds]=ts.state[ds]);let is=await this.lookUpCurrentFreshness({component:ts,varName:rs,allStateVariablesAffectedObj:ns}),as=[],os=[],ls=0;for(let ds in ns){let fs=ns[ds];Object.getOwnPropertyDescriptor(fs,"value").get||fs.immutable?is&&(is.fresh&&is.fresh[ds]?os.push(ds):is.partiallyFresh&&is.partiallyFresh[ds]&&(ls+=is.partiallyFresh[ds])):as.push(ds)}os.push(...as);let us=os.length>0||ls>0,cs={};for(let ds in ns)cs[ds]=!0;let ps=!1;if(us){let ds=await this.processMarkStale({component:ts,varName:rs,allStateVariablesAffectedObj:ns});if(ds.fresh)for(let hs in ds.fresh)ds.fresh[hs]&&delete cs[hs];let fs=0;for(let hs in ns){if(os.includes(hs)&&!(ds.fresh&&ds.fresh[hs])){ps=!0;break}ds.partiallyFresh&&ds.partiallyFresh[hs]&&(fs+=ds.partiallyFresh[hs])}if(fs<ls&&(ps=!0),ds.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.add(ts.componentName),ds.updateParentRenderedChildren){for(let hs of ts.ancestors)if(!this.componentInfoObjects.allComponentClasses._composite.isPrototypeOf(hs.componentCase)){hs.componentClass.renderChildren&&this.componentsWithChangedChildrenToRender.add(hs.componentName);break}}if(ds.updateRenderedChildren&&this.componentsWithChangedChildrenToRender.add(ts.componentName),ds.updateActionChaining){let hs=this.updateInfo.componentsToUpdateActionChaining[ts.componentName];hs||(hs=this.updateInfo.componentsToUpdateActionChaining[ts.componentName]=[]);for(let ys in ns)hs.includes(ys)||hs.push(ys)}if(ds.updateDependencies)for(let hs of ds.updateDependencies)ts.state[hs].needDependenciesUpdated=!0;this.flags.autoSubmit&&ds.answerCreditPotentiallyChanged&&this.recordAnswerToAutoSubmit(ts.componentName)}for(let ds in cs){let fs=ns[ds];if(delete fs.recursiveDependencyValues,as.includes(ds)){fs._previousValue=await fs.value,Array.isArray(fs._previousValue)&&(fs._previousValue=[...fs._previousValue]),delete fs.value;let hs=this.getStateVariableValue;Object.defineProperty(fs,"value",{get:()=>hs({component:ts,stateVariable:ds}),configurable:!0})}}if(ps)for(let ds in cs)await this.markUpstreamDependentsStale({component:ts,varName:ds})}async lookUpCurrentFreshness({component:ts,varName:rs,allStateVariablesAffectedObj:ns}){let is=ts.state[rs];if(!is.getCurrentFreshness)return;let as=is.freshnessInfo,os,ls;if(is.isArrayEntry&&(os=is._arrayKeys),is.isArrayEntry||is.isArray){let cs=ts.state[is.arraySizeStateVariable];ls=cs._previousValue,!(Object.getOwnPropertyDescriptor(cs,"value").get||cs.immutable)&&(ls=await cs.value),Array.isArray(ls)||(ls=[])}let us=is.getCurrentFreshness({freshnessInfo:as,arrayKeys:os,arraySize:ls});if(us.partiallyFresh){for(let cs in ns)if(ns[cs].isArrayEntry){let ps=ns[cs].arrayStateVariable;us.partiallyFresh[cs]=us.partiallyFresh[ps],delete us.partiallyFresh[ps]}}if(us.fresh){for(let cs in ns)if(ns[cs].isArrayEntry){let ps=ns[cs].arrayStateVariable;ps in us.fresh&&(us.fresh[cs]=us.fresh[ps],delete us.fresh[ps])}}return us}async processMarkStale({component:ts,varName:rs,allStateVariablesAffectedObj:ns}){let is=ts.state[rs];if(!is.markStale||!is.initiallyResolved){let ds={};return Object.keys(ns).forEach(fs=>ds[fs]=!1),{fresh:ds}}let as={},os=this.dependencies.downstreamDependencies[ts.componentName][rs];for(let ds in os){let fs=os[ds],hs={},ys=!1;fs.componentIdentityChanged&&(hs.componentIdentityChanged=!0,ys=!0),fs.componentIdentitiesChanged&&(hs.componentIdentitiesChanged=!0,ys=!0),fs.valuesChanged&&(hs.valuesChanged=fs.valuesChanged,ys=!0),ys&&(as[ds]=hs)}let ls=is.freshnessInfo,us,cs;if(is.isArrayEntry&&(us=is._arrayKeys),is.isArrayEntry||is.isArray){let ds=ts.state[is.arraySizeStateVariable];cs=ds._previousValue,!(Object.getOwnPropertyDescriptor(ds,"value").get||ds.immutable)&&(cs=await ds.value),Array.isArray(cs)||(cs=[])}let ps=is.markStale({freshnessInfo:ls,changes:as,arrayKeys:us,arraySize:cs});if(ps.partiallyFresh){for(let ds in ns)if(ns[ds].isArrayEntry){let fs=ns[ds].arrayStateVariable;ps.partiallyFresh[ds]=ps.partiallyFresh[fs],delete ps.partiallyFresh[fs]}}if(ps.fresh){for(let ds in ns)if(ns[ds].isArrayEntry){let fs=ns[ds].arrayStateVariable;fs in ps.fresh&&(ps.fresh[ds]=ps.fresh[fs],delete ps.fresh[fs])}}return ps}async markUpstreamDependentsStale({component:ts,varName:rs}){let ns=ts.componentName,is=this.getStateVariableValue,as=this.dependencies.upstreamDependencies[ns][rs],os;if(ts.state[rs]&&(os=ts.state[rs].freshnessInfo),as)for(let ls of as){let us=!1;if(ls.markStale&&await ls.markStale(),ls.downstreamComponentNames){let cs=ls.downstreamComponentNames.indexOf(ns);if(cs===-1)continue;if(ls.mappedDownstreamVariableNamesByComponent){if(ls.mappedDownstreamVariableNamesByComponent[cs].indexOf(rs)===-1)throw Error(`something went wrong as ${rs} not a downstreamVariable of ${ls.dependencyName}`);ls.dependencyType==="determineDependencies"&&(ls.recalculateDependencies=!0),ls.valuesChanged||(ls.valuesChanged=[]),ls.valuesChanged[cs]||(ls.valuesChanged[cs]={}),ls.valuesChanged[cs][rs]||(ls.valuesChanged[cs][rs]={}),ls.valuesChanged[cs][rs].potentialChange=!0,os&&(ls.valuesChanged[cs][rs].freshnessInfo=os),us=!0}else rs===ls.downstreamVariableNameIfNoVariables&&(ls.valuesChanged||(ls.valuesChanged={[ls.downstreamVariableNameIfNoVariables]:{}}),ls.componentIdentityChanged=!0,ls.valuesChanged[ls.downstreamVariableNameIfNoVariables].potentialChange=!0,us=!0)}if(us){for(let Ts of ls.upstreamVariableNames)if(Ts in this.rendererVariablesByComponentType[this.components[ls.upstreamComponentName].componentType]){this.updateInfo.componentsToUpdateRenderers.add(ls.upstreamComponentName);break}let cs=ls.upstreamVariableNames[0],ps=this._components[ls.upstreamComponentName],ds={};ls.upstreamVariableNames.forEach(Ts=>ds[Ts]=ps.state[Ts]);let fs=await this.lookUpCurrentFreshness({component:ps,varName:cs,allStateVariablesAffectedObj:ds}),hs=[],ys=[],gs=0;for(let Ts in ds){let Cs=ds[Ts];Object.getOwnPropertyDescriptor(Cs,"value").get||Cs.immutable?fs&&(fs.fresh&&fs.fresh[Ts]?ys.push(Ts):fs.partiallyFresh&&fs.partiallyFresh[Ts]&&(gs+=fs.partiallyFresh[Ts])):hs.push(Ts)}ys.push(...hs);let bs=ys.length>0||gs>0,vs={};for(let Ts in ds)vs[Ts]=!0;let Ns=!1;if(bs){let Ts=await this.processMarkStale({component:ps,varName:cs,allStateVariablesAffectedObj:ds});if(Ts.fresh)for(let xs in Ts.fresh)Ts.fresh[xs]&&delete vs[xs];let Cs=0;for(let xs in ds){if(ys.includes(xs)&&!(Ts.fresh&&Ts.fresh[xs])){Ns=!0;break}Ts.partiallyFresh&&Ts.partiallyFresh[xs]&&(Cs+=Ts.partiallyFresh[xs])}if(Cs<gs&&(Ns=!0),Ts.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.add(ls.upstreamComponentName),Ts.updateParentRenderedChildren){for(let xs of ps.ancestors)if(!this.componentInfoObjects.allComponentClasses._composite.isPrototypeOf(xs.componentCase)){xs.componentClass.renderChildren&&this.componentsWithChangedChildrenToRender.add(xs.componentName);break}}if(Ts.updateRenderedChildren&&this.componentsWithChangedChildrenToRender.add(ts.componentName),Ts.updateActionChaining){let xs=this.updateInfo.componentsToUpdateActionChaining[ls.componentName];xs||(xs=this.updateInfo.componentsToUpdateActionChaining[ls.componentName]=[]);for(let As in ds)xs.includes(As)||xs.push(As)}if(Ts.updateDependencies)for(let xs of Ts.updateDependencies)ts.state[xs].needDependenciesUpdated=!0;this.flags.autoSubmit&&Ts.answerCreditPotentiallyChanged&&this.recordAnswerToAutoSubmit(ps.componentName)}for(let Ts in vs){let Cs=ds[Ts];delete Cs.recursiveDependencyValues,hs.includes(Ts)&&(Cs._previousValue=await Cs.value,Array.isArray(Cs._previousValue)&&(Cs._previousValue=[...Cs._previousValue]),delete Cs.value,Object.defineProperty(Cs,"value",{get:()=>is({component:ps,stateVariable:Ts}),configurable:!0}))}if(Ns)for(let Ts in vs)await this.markUpstreamDependentsStale({component:ps,varName:Ts})}}}registerComponent(ts){if(ts.componentName in this._components)throw Error(`Duplicate componentName: ${ts.componentName}`);this._components[ts.componentName]=ts}deregisterComponent(ts,rs=!0){if(rs===!0)for(let ns in ts.allChildren)this.deregisterComponent(ts.allChildren[ns].component);delete this._components[ts.componentName]}setAncestors(ts,rs=[]){ts.ancestors=rs;let ns=[{componentName:ts.componentName,componentClass:ts.constructor},...ts.ancestors];for(let is in ts.allChildren){let as=this._components[is];this.setAncestors(as,ns)}for(let is in ts.attributes){let as=ts.attributes[is].component;as&&this.setAncestors(as,ns)}}async addChildrenAndRecurseToShadows({parent:ts,indexOfDefiningChildren:rs,newChildren:ns,assignNamesOffset:is}){var us;this.spliceChildren(ts,rs,ns);let as=await this.processNewDefiningChildren({parent:ts}),os={},ls={};if(!as.success)return as;for(let cs of ns)typeof cs=="object"&&(os[cs.componentName]=cs);if(ts.shadowedBy)for(let cs of ts.shadowedBy){if(cs.shadows.propVariable)continue;let ps=this._components[cs.shadows.compositeName],ds=await ps.stateValues.sourceAttributesToIgnore,fs=await ps.stateValues.sourceAttributesToIgnoreRecursively,hs=[];for(let xs of ns)typeof xs=="object"?hs.push(await xs.serialize({sourceAttributesToIgnore:ds,sourceAttributesToIgnoreRecursively:fs})):hs.push(xs);hs=postProcessCopy({serializedComponents:hs,componentName:cs.shadows.compositeName});let ys=(us=cs.attributes.newNamespace)==null?void 0:us.primitive,gs=ys;hs=processAssignNames({indOffset:is,serializedComponents:hs,parentName:cs.componentName,parentCreatesNewNamespace:ys,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:gs}).serializedComponents;let vs=this._components[cs.componentName];this.parameterStack.push(vs.sharedParameters,!1);let Ns;ys?Ns=cs.componentName+"/":Ns=getNamespaceFromName(cs.componentName);let Ts=await this.createIsolatedComponentsSub({serializedComponents:hs,ancestors:cs.ancestors,createNameContext:cs.componentName+"|addChildren|"+is,namespaceForUnamed:Ns});this.parameterStack.pop();let Cs=await this.addChildrenAndRecurseToShadows({parent:vs,indexOfDefiningChildren:rs,newChildren:Ts.components,assignNamesOffset:is});if(!Cs.success)throw Error("was able to add components to parent but not shadows!");Object.assign(os,Cs.addedComponents)}return{success:!0,deletedComponents:ls,addedComponents:os}}async processNewDefiningChildren({parent:ts,expandComposites:rs=!0}){this.parameterStack.push(ts.sharedParameters,!1);let ns=await this.deriveChildResultsFromDefiningChildren({parent:ts,expandComposites:rs});this.parameterStack.pop();let is=[{componentName:ts.componentName,componentClass:ts.constructor},...ts.ancestors];for(let as in ts.allChildren){let os=this._components[as];this.setAncestors(os,is)}return ns}spliceChildren(ts,rs,ns){let is=ts.definingChildren.length;if(!Number.isInteger(rs)||rs>is||rs<0)throw Error("Can't add children at index "+rs+". Invalid index.");ts.definingChildren.splice(rs,0,...ns)}async deleteComponents({components:ts,deleteUpstreamDependencies:rs=!0,skipProcessingChildrenOfParents:ns=[]}){Array.isArray(ts)||(ts=[ts]);const is={};this.determineComponentsToDelete({components:ts,deleteUpstreamDependencies:rs,componentsToDelete:is});const as={};for(let us in is){let cs=is[us],ps=this.components[cs.parentName];if(ps===void 0||ps.componentName in is)continue;let ds=as[cs.parentName];ds===void 0&&(ds={parent:this._components[cs.parentName],childNamesToBeDeleted:new Set},as[cs.parentName]=ds),ds.childNamesToBeDeleted.add(us)}let os=[];for(let us in is){let cs=this._components[us];if(cs.replacementOf){let ps=cs.replacementOf,fs=ps.replacements.map(hs=>hs.componentName).indexOf(us);fs!==-1&&(ps.replacements.splice(fs,1),os.includes(ps.componentName)||os.push(ps.componentName))}}for(let us of os)us in is||await this.dependencies.addBlockersFromChangedReplacements(this._components[us]);let ls=[];for(let us in as){let cs=as[us],ps=cs.parent;ls.push(ps);for(let ds=ps.definingChildren.length-1;ds>=0;ds--){let fs=ps.definingChildren[ds];cs.childNamesToBeDeleted.has(fs.componentName)&&ps.definingChildren.splice(ds,1)}ns.includes(ps.componentName)||await this.processNewDefiningChildren({parent:ps,expandComposites:!1})}for(let us in is){let cs=this._components[us];if(cs.shadows){let ps=this._components[cs.shadows.componentName];ps.shadowedBy.length===1?delete ps.shadowedBy:ps.shadowedBy.splice(ps.shadowedBy.indexOf(cs),1)}this.dependencies.deleteAllDownstreamDependencies({component:cs});for(let ps in this.dependencies.upstreamDependencies[cs.componentName]){let ds=this.dependencies.upstreamDependencies[cs.componentName][ps];for(let fs of ds)if(fs.specifiedComponentName&&fs.specifiedComponentName in is){let hs=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[fs.specifiedComponentName];hs||(hs=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[fs.specifiedComponentName]=[]),hs.includes(fs)||hs.push(fs)}}await this.dependencies.deleteAllUpstreamDependencies({component:cs}),this.updateInfo.deletedStateVariables[cs.componentName]||(this.updateInfo.deletedStateVariables[cs.componentName]=[]),this.updateInfo.deletedStateVariables[cs.componentName].push(...Object.keys(cs.state)),this.updateInfo.deletedComponents[cs.componentName]=!0,delete this.unmatchedChildren[cs.componentName],delete this.stateVariableChangeTriggers[cs.componentName]}for(let us in is){let cs=this._components[us];this.deregisterComponent(cs,!1),this.updateInfo.componentsToUpdateRenderers.delete(us),this.updateInfo.compositesToUpdateReplacements.delete(us),this.updateInfo.inactiveCompositesToUpdateReplacements.delete(us)}return{success:!0,deletedComponents:is,parentsOfDeleted:ls}}determineComponentsToDelete({components:ts,deleteUpstreamDependencies:rs,componentsToDelete:ns}){for(let is of ts){if(typeof is!="object"||is.componentName in ns)continue;ns[is.componentName]=this._components[is.componentName];let as=Object.values(is.allChildren).map(os=>os.component);for(let os in is.attributes){let ls=is.attributes[os].component;ls&&as.push(ls)}is.adaptedFrom!==void 0&&as.push(is.adaptedFrom),rs===!0&&(is.shadowedBy&&as.push(...is.shadowedBy),is.adapterUsed&&as.push(is.adapterUsed),is.replacements&&as.push(...is.replacements)),this.determineComponentsToDelete({components:as,deleteUpstreamDependencies:rs,componentsToDelete:ns})}}async updateCompositeReplacements({component:ts,componentChanges:rs,sourceOfUpdate:ns}){var ps;let is={},as={},os=new Set;if(ts.shadows)return{success:!0,deletedComponents:is,addedComponents:as,parentsOfDeleted:os};let ls=this.components[ts.componentName];ts.replacements||(ts.replacements=[]),await ts.stateValues.readyToExpandWhenResolved;const us=await ts.constructor.calculateReplacementChanges({component:ls,componentChanges:rs,components:this.components,workspace:ts.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});ts.constructor.stateVariableToEvaluateAfterReplacements&&await ts.stateValues[ts.constructor.stateVariableToEvaluateAfterReplacements];for(let ds of us)if(ds.changeType==="add"){ds.replacementsToWithhold!==void 0&&await this.adjustReplacementsToWithhold({component:ts,change:ds,componentChanges:rs});let fs=this._components[ts.componentName];this.parameterStack.push(fs.sharedParameters,!1);let hs,ys={[ts.componentName]:calculateAllComponentsShadowing(ts)},gs=ds.numberReplacementsToReplace,bs=ds.firstReplacementInd;if(gs>0&&ds.changeTopLevelReplacements&&await this.deleteReplacementsFromShadowsThenComposite({change:ds,composite:ts,componentChanges:rs,sourceOfUpdate:ns,parentsOfDeleted:os,deletedComponents:is,addedComponents:as,processNewChildren:!1}),ds.serializedReplacements){let Ns=ds.serializedReplacements,Ts;(ps=ts.attributes.newNamespace)!=null&&ps.primitive?Ts=ts.componentName+"/":Ts=getNamespaceFromName(ts.componentName),hs=(await this.createIsolatedComponentsSub({serializedComponents:Ns,ancestors:ts.ancestors,createNameContext:ts.componentName+"|replacements",namespaceForUnamed:Ts,componentsReplacementOf:ts})).components}else throw Error("Invalid replacement change.");this.parameterStack.pop();let vs={[ts.componentName]:{newComponents:hs,parent:ds.parent}};if(fs.shadowedBy&&ys[fs.componentName].length>0){let Ns=await this.createShadowedReplacements({replacementsToShadow:hs,componentToShadow:fs,parentToShadow:ds.parent,currentShadowedBy:ys,assignNamesOffset:ds.assignNamesOffset,componentChanges:rs,sourceOfUpdate:ns,parentsOfDeleted:os,deletedComponents:is,addedComponents:as});Object.assign(vs,Ns)}for(let Ns in vs){let Ts=this._components[Ns];if(!Ts)continue;let Cs=vs[Ns].newComponents;if(!Ts.isExpanded){await this.expandCompositeComponent(Ts);let xs={changeType:"addedReplacements",composite:Ts,newReplacements:Ts.replacements,topLevel:!0,firstIndex:0,numberDeleted:0};rs.push(xs);continue}for(let xs of Cs)typeof xs=="object"&&(as[xs.componentName]=xs);if(ds.changeTopLevelReplacements===!0){let xs=this._components[Ts.parentName];Ts.replacements.splice(bs,0,...Cs),await this.dependencies.addBlockersFromChangedReplacements(Ts);let As={changeType:"addedReplacements",composite:Ts,newReplacements:Cs,topLevel:!0,firstIndex:bs,numberDeleted:gs};rs.push(As),await this.processNewDefiningChildren({parent:xs,expandComposites:!1}),(await this.componentAndRenderedDescendants(xs)).forEach(Es=>this.updateInfo.componentsToUpdateRenderers.add(Es))}else{let xs=this._components[vs[Ns].parent.componentName];this.spliceChildren(xs,ds.indexOfDefiningChildren,Cs),await this.processNewDefiningChildren({parent:xs});for(let Es of Cs)typeof Es=="object"&&(as[Es.componentName]=Es);(await this.componentAndRenderedDescendants(xs)).forEach(Es=>this.updateInfo.componentsToUpdateRenderers.add(Es));let ws={changeType:"addedReplacements",composite:Ts,newReplacements:Cs};rs.push(ws)}}}else if(ds.changeType==="delete")ds.replacementsToWithhold!==void 0&&await this.adjustReplacementsToWithhold({component:ts,change:ds,componentChanges:rs}),await this.deleteReplacementsFromShadowsThenComposite({change:ds,composite:ts,componentsToDelete:ds.components,componentChanges:rs,sourceOfUpdate:ns,parentsOfDeleted:os,deletedComponents:is,addedComponents:as});else if(ds.changeType==="updateStateVariables"){let fs={},hs={};for(let ys in ds.stateChanges){let gs={componentName:ds.component.componentName,stateVariable:ys,value:ds.stateChanges[ys],overrideFixed:!0};await this.requestComponentChanges({instruction:gs,initialChange:!1,workspace:fs,newStateVariableValues:hs})}await this.processNewStateVariableValues(hs)}else ds.changeType==="changeReplacementsToWithhold"&&(ds.replacementsToWithhold!==void 0&&await this.adjustReplacementsToWithhold({component:ts,change:ds,componentChanges:rs}),await this.processChildChangesAndRecurseToShadows(ts));return{success:!0,deletedComponents:is,addedComponents:as,parentsOfDeleted:os}}async deleteReplacementsFromShadowsThenComposite({change:ts,composite:rs,componentsToDelete:ns,componentChanges:is,sourceOfUpdate:as,parentsOfDeleted:os,deletedComponents:ls,addedComponents:us,processNewChildren:cs=!0}){let ps=[];if(!rs.isExpanded)return ps;if(rs.shadowedBy)for(let ds of rs.shadowedBy){if(ds.shadows.propVariable)continue;let fs;if(ns){fs=[];for(let ys of ns){let gs;if(ys.shadowedBy){for(let bs of ys.shadowedBy)if(!bs.shadows.propVariable&&bs.shadows.compositeName===ds.shadows.compositeName){gs=bs;break}}gs?fs.push(gs):console.error(`could not find shadowing component of ${ys.componentName}`)}}let hs=await this.deleteReplacementsFromShadowsThenComposite({change:ts,composite:ds,componentsToDelete:fs,componentChanges:is,sourceOfUpdate:as,parentsOfDeleted:os,deletedComponents:ls,addedComponents:us,processNewChildren:cs});ps.push(...hs)}if(ts.changeTopLevelReplacements){let ds=ts.firstReplacementInd,fs=ts.numberReplacementsToDelete;ts.changeType==="add"&&(fs=ts.numberReplacementsToReplace);let hs=rs.replacements.splice(ds,fs);await this.dependencies.addBlockersFromChangedReplacements(rs);let ys=await this.deleteComponents({components:hs,componentChanges:is,sourceOfUpdate:as,skipProcessingChildrenOfParents:[rs.parentName]});if(cs&&await this.processNewDefiningChildren({parent:this._components[rs.parentName],expandComposites:!1}),ys.success===!1)throw Error("Couldn't delete components on composite update");for(let Ts of ys.parentsOfDeleted)os.add(Ts.componentName),(await this.componentAndRenderedDescendants(Ts)).forEach(xs=>this.updateInfo.componentsToUpdateRenderers.add(xs));let gs={};for(let Ts in ys.deletedComponents){let xs=ys.deletedComponents[Ts].parentName;gs[xs]===void 0&&(gs[xs]=[]),gs[xs].push(Ts)}let bs={changeType:"deletedReplacements",composite:rs,topLevel:!0,firstIndex:ds,numberDeleted:fs,deletedNamesByParent:gs,deletedComponents:ys.deletedComponents};is.push(bs),Object.assign(ls,ys.deletedComponents);let vs=this._components[rs.parentName];(await this.componentAndRenderedDescendants(vs)).forEach(Ts=>this.updateInfo.componentsToUpdateRenderers.add(Ts))}else{let ds=ns.length,fs=await this.deleteComponents({components:ns,deleteUpstreamDependencies:!1,componentChanges:is,sourceOfUpdate:as});if(fs.success===!1)throw Error("Couldn't delete components prescribed by composite");for(let gs of fs.parentsOfDeleted)os.add(gs.componentName),(await this.componentAndRenderedDescendants(gs)).forEach(vs=>this.updateInfo.componentsToUpdateRenderers.add(vs));let hs={};for(let gs in fs.deletedComponents){let vs=fs.deletedComponents[gs].parentName;hs[vs]===void 0&&(hs[vs]=[]),hs[vs].push(gs)}let ys={changeType:"deletedReplacements",composite:rs,numberDeleted:ds,deletedNamesByParent:hs,deletedComponents:fs.deletedComponents};is.push(ys),Object.assign(ls,fs.deletedComponents),Object.assign(us,fs.addedComponents)}return ps}async processChildChangesAndRecurseToShadows(ts){let rs=this._components[ts.parentName];if(await this.processNewDefiningChildren({parent:rs,expandComposites:!1}),(await this.componentAndRenderedDescendants(rs)).forEach(is=>this.updateInfo.componentsToUpdateRenderers.add(is)),ts.shadowedBy)for(let is of ts.shadowedBy)is.shadows.propVariable||await this.processChildChangesAndRecurseToShadows(is)}async createShadowedReplacements({replacementsToShadow:ts,componentToShadow:rs,parentToShadow:ns,currentShadowedBy:is,assignNamesOffset:as,componentChanges:os,sourceOfUpdate:ls,parentsOfDeleted:us,deletedComponents:cs,addedComponents:ps}){var ys,gs;let ds=calculateAllComponentsShadowing(rs);if(!is[rs.componentName]||!ds.every(bs=>is[rs.componentName].includes(bs)))throw Error(`circular reference involving ${rs.componentName}`);this.updateInfo.compositesBeingExpanded.push(rs.componentName);let fs={};for(let bs of rs.shadowedBy)if(!bs.shadows.propVariable){if(this.updateInfo.compositesBeingExpanded.includes(bs.componentName))throw Error(`circular dependence involving ${bs.componentName}`);if(bs.shadowedBy&&(is[bs.componentName]=calculateAllComponentsShadowing(bs)),bs.isExpanded){let vs=[],Ns=this._components[bs.shadows.compositeName],Ts=await Ns.stateValues.sourceAttributesToIgnore,Cs=await Ns.stateValues.sourceAttributesToIgnoreRecursively;for(let Vs of ts)typeof Vs=="object"?vs.push(await Vs.serialize({sourceAttributesToIgnore:Ts,sourceAttributesToIgnoreRecursively:Cs})):vs.push(Vs);vs=postProcessCopy({serializedComponents:vs,componentName:bs.shadows.compositeName});let xs=(ys=bs.attributes.newNamespace)==null?void 0:ys.primitive;if(bs.attributes.isResponse){let Vs=bs.constructor.createAttributesObject();for(let Is of vs){if(typeof Is!="object")continue;Is.attributes||(Is.attributes={});let Os=convertAttributesForComponentType({attributes:{isResponse:bs.attributes.isResponse},componentType:Is.componentType,componentInfoObjects:this.componentInfoObjects,compositeAttributesObj:Vs,compositeCreatesNewNamespace:xs});Object.assign(Is.attributes,Os)}}if(bs.constructor.assignNamesToReplacements){let Vs=bs.shadows.compositeName,Is=this.components[Vs],Os=(gs=Is.attributes.newNamespace)==null?void 0:gs.primitive,Ps=Is.doenetAttributes.assignNames,$s=xs||Os&&!Ps,Rs=bs.doenetAttributes.assignNames;Rs&&await bs.stateValues.addLevelToAssignNames&&(Rs=Rs.map(_s=>[_s])),vs=processAssignNames({assignNames:Rs,indOffset:as,serializedComponents:vs,parentName:bs.componentName,parentCreatesNewNamespace:xs,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:$s}).serializedComponents}else{let Vs=xs;vs=processAssignNames({indOffset:as,serializedComponents:vs,parentName:bs.componentName,parentCreatesNewNamespace:xs,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:Vs}).serializedComponents}let As,ws=this._components[bs.componentName];this.parameterStack.push(ws.sharedParameters,!1);let Es;xs?Es=bs.componentName+"/":Es=getNamespaceFromName(bs.componentName);let Ss=await this.createIsolatedComponentsSub({serializedComponents:vs,ancestors:bs.ancestors,createNameContext:bs.componentName+"|replacements",namespaceForUnamed:Es,componentsReplacementOf:bs});this.parameterStack.pop(),As=Ss.components;let Ds;if(ns){if(ns.shadowedBy){for(let Vs of ns.shadowedBy)if(!Vs.shadows.propVariable&&Vs.shadows.compositeName===bs.shadows.compositeName){Ds=Vs;break}}Ds||console.error(`could not find shadowing parent of ${ns.componentName}`)}if(fs[bs.componentName]={newComponents:As,parent:Ds},bs.shadowedBy&&is[bs.componentName].length>0){let Vs=await this.createShadowedReplacements({replacementsToShadow:As,componentToShadow:bs,parentToShadow:Ds,currentShadowedBy:is,assignNamesOffset:as,componentChanges:os,sourceOfUpdate:ls,parentsOfDeleted:us,deletedComponents:cs,addedComponents:ps});Object.assign(fs,Vs)}}}let hs=this.updateInfo.compositesBeingExpanded.indexOf(rs.componentName);if(hs===-1)throw Error(`Something is wrong as we lost track that we were expanding ${component.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(hs,1),fs}async adjustReplacementsToWithhold({component:ts,change:rs,componentChanges:ns}){let is=[],as=rs.replacementsToWithhold,os;if(ts.replacementsToWithhold!==void 0?os=as-ts.replacementsToWithhold:os=as,os<0){is.push(ts.componentName);let ls=ts.replacements.length-as,us=ts.replacements.length-as+os,cs=ts.replacements.slice(us,ls),ps={changeType:"addedReplacements",composite:ts,topLevel:!0,newReplacements:cs,firstIndex:us,numberDeleted:0};ns.push(ps)}else if(os>0){is.push(ts.componentName);let ls=ts.replacements.length-as,us=ls+os,cs=ts.replacements.slice(ls,us),ps={};for(let fs of cs){let hs=fs.parentName;ps[hs]===void 0&&(ps[hs]=[]),ps[hs].push(fs.componentName)}let ds={changeType:"deletedReplacements",composite:ts,topLevel:!0,firstIndex:ls,numberDeleted:os,deletedNamesByParent:ps,deletedComponents:cs};ns.push(ds)}if(ts.replacementsToWithhold=as,await this.dependencies.addBlockersFromChangedReplacements(ts),ts.shadowedBy)for(let ls of ts.shadowedBy){if(ls.shadows.propVariable)continue;let us=await this.adjustReplacementsToWithhold({component:ls,change:rs,componentChanges:ns});is.push(...us)}return is}get rendererTypesInDocument(){return this.document.allPotentialRendererTypes}get components(){return this._components}set components(ts){return null}async executeProcesses(){if(!this.stopProcessingRequests){for(;this.processQueue.length>0;){let ts=this.processQueue.splice(0,1)[0],rs;if(ts.type==="update")(!ts.skippable||this.processQueue.length<2)&&(rs=await this.performUpdate(ts));else if(ts.type==="action")(!ts.skippable||this.processQueue.length<2)&&(rs=await this.performAction(ts));else if(ts.type==="recordEvent")rs=await this.performRecordEvent(ts);else throw Error(`Unrecognized process type: ${ts.type}`);ts.resolve(rs)}this.processing=!1}}requestAction({componentName:ts,actionName:rs,args:ns,event:is}){return new Promise((as,os)=>{let ls=ns==null?void 0:ns.skippable;this.processQueue.push({type:"action",componentName:ts,actionName:rs,args:ns,skippable:ls,event:is,resolve:as,reject:os}),this.processing||(this.processing=!0,this.executeProcesses())})}async performAction({componentName:ts,actionName:rs,args:ns,event:is,caseInsensitiveMatch:as}){if(rs==="setTheme"&&!ts)return await this.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.documentName,stateVariable:"theme",value:ns.theme}],actionId:ns.actionId,doNotSave:!0});let os=this.components[ts];if(os&&os.actions){let ls=os.actions[rs];if(!ls&&as){let us=rs.toLowerCase();for(let cs in os.actions)if(cs.toLowerCase()===us){ls=os.actions[cs],rs=cs;break}}if(ls)return is&&this.requestRecordEvent(is),ns||(ns={}),await ls(ns)}if(!os&&rs==="recordVisibilityChange"&&(ns==null?void 0:ns.isVisible)===!1)return this.requestRecordEvent({verb:"visibilityChanged",object:{componentName:ts},result:{isVisible:!1}}),this.resolveAction({actionId:ns.actionId});os&&console.warn(`Cannot run action ${rs} on component ${ts}`)}resolveAction({actionId:ts}){ts&&postMessage({messageType:"resolveAction",coreId:this.coreId,args:{actionId:ts}})}async triggerChainedActions({componentName:ts,triggeringAction:rs,actionId:ns,sourceInformation:is={},skipRendererUpdate:as=!1}){for(let ls in this.updateInfo.componentsToUpdateActionChaining)await this.checkForActionChaining({component:this.components[ls],stateVariables:this.updateInfo.componentsToUpdateActionChaining[ls]});this.updateInfo.componentsToUpdateActionChaining={};let os=ts;if(rs&&(os+="|"+rs),this.actionsChangedToActions[os])for(let ls of this.actionsChangedToActions[os])ls={...ls},ls.args?ls.args={...ls.args}:ls.args={},ls.args.skipRendererUpdate=!0,await this.performAction(ls);as||await this.updateAllChangedRenderers(is,ns)}async requestUpdate({updateInstructions:ts,transient:rs=!1,event:ns,skippable:is=!1,overrideReadOnly:as=!1}){if(this.flags.readOnly&&!as){let os={};for(let ls of ts){let us=os[ls.componentName];us||(us=os[ls.componentName]={}),ls.sourceDetails&&Object.assign(us,ls.sourceDetails)}await this.updateRendererInstructions({componentNamesToUpdate:ts.map(ls=>ls.componentName),sourceOfUpdate:{sourceInformation:os}});return}return new Promise((os,ls)=>{this.processQueue.push({type:"update",updateInstructions:ts,transient:rs,event:ns,skippable:is,resolve:os,reject:ls}),this.processing||(this.processing=!0,this.executeProcesses())})}async performUpdate({updateInstructions:ts,actionId:rs,event:ns,overrideReadOnly:is=!1,doNotSave:as=!1,canSkipUpdatingRenderer:os=!1,skipRendererUpdate:ls=!1,sourceInformation:us={},suppressToast:cs=!1}){var ys;if(this.flags.readOnly&&!is){if(!os){for(let gs of ts){let bs=us[gs.componentName];bs||(bs=us[gs.componentName]={}),gs.sourceDetails&&Object.assign(bs,gs.sourceDetails)}await this.updateRendererInstructions({componentNamesToUpdate:ts.map(gs=>gs.componentName),sourceOfUpdate:{sourceInformation:us},actionId:rs})}return}let ps={},ds=[],fs={},hs=[];for(let gs of ts){if(gs.componentName){let bs=us[gs.componentName];bs||(bs=us[gs.componentName]={}),gs.sourceDetails&&Object.assign(bs,gs.sourceDetails)}if(gs.updateType==="updateValue")await this.requestComponentChanges({instruction:gs,workspace:fs,newStateVariableValues:ps});else if(gs.updateType==="addComponents")await this.addComponents({serializedComponents:gs.serializedComponents,parentName:gs.parentName,assignNamesOffset:gs.assignNamesOffset});else if(gs.updateType==="deleteComponents"){if(gs.componentNames.length>0){let bs=[];for(let vs of gs.componentNames){let Ns=this._components[vs];Ns?bs.push(Ns):console.warn(`Cannot delete ${vs} as it doesn't exist.`)}bs.length>0&&await this.deleteComponents({components:bs})}}else gs.updateType==="executeUpdate"?(await this.executeUpdateStateVariables(ps),ds.push(ps),ps={}):gs.updateType==="recordItemSubmission"?hs.push(gs):gs.updateType==="setComponentNeedingUpdateValue"?this.rendererState.__componentNeedingUpdateValue=gs.componentName:gs.updateType==="unsetComponentNeedingUpdateValue"&&(this.rendererState.__componentNeedingUpdateValue=null)}if(await this.executeUpdateStateVariables(ps),ds.push(ps),os||ts.forEach(gs=>{gs.componentName&&this.updateInfo.componentsToUpdateRenderers.add(gs.componentName)}),await this.processStateVariableTriggers(),ls||await this.updateAllChangedRenderers(us,rs),Object.keys(this.unmatchedChildren).length>0){let gs="";for(let bs in this.unmatchedChildren)this._components[bs].isShadow||(gs+=`Invalid children for ${bs}: ${this.unmatchedChildren[bs].message} `);gs&&console.warn(gs)}if(hs.length>0){let gs=[...new Set(hs.map(Ns=>Ns.itemNumber))],bs=await this.document.stateValues.creditAchieved,vs=await this.document.stateValues.itemCreditAchieved;if(ns){if(ns.context||(ns.context={}),ns.context.item=gs[0],ns.context.itemCreditAchieved=vs[gs[0]-1],gs.length>1){ns.context.additionalItemCreditAchieved={};for(let Ns of gs)ns.context.additionalItemCreditAchieved[Ns]=vs[Ns-1]}ns.context.pageCreditAchieved=await this.document.stateValues.creditAchieved}this.itemNumber>0&&this.saveSubmissions({pageCreditAchieved:bs,suppressToast:cs})}if(Object.keys(this.essentialValuesSavedInDefinition).length>0){for(let gs in this.essentialValuesSavedInDefinition){let bs=(ys=this._components[gs])==null?void 0:ys.essentialState;if(bs){this.cumulativeStateVariableChanges[gs]||(this.cumulativeStateVariableChanges[gs]={});for(let vs in this.essentialValuesSavedInDefinition[gs])if(bs[vs]!==void 0){let Ns=this.cumulativeStateVariableChanges[gs][vs];typeof Ns=="object"&&Ns!==null&&Ns.mergeObject?Object.assign(Ns,removeFunctionsMathExpressionClass(bs[vs])):this.cumulativeStateVariableChanges[gs][vs]=removeFunctionsMathExpressionClass(bs[vs])}}}this.essentialValuesSavedInDefinition={}}for(let gs of ds)for(let bs in gs){this.cumulativeStateVariableChanges[bs]||(this.cumulativeStateVariableChanges[bs]={});for(let vs in gs[bs]){let Ns=this.cumulativeStateVariableChanges[bs][vs];typeof Ns=="object"&&Ns!==null&&Ns.mergeObject?Object.assign(Ns,removeFunctionsMathExpressionClass(gs[bs][vs])):this.cumulativeStateVariableChanges[bs][vs]=removeFunctionsMathExpressionClass(gs[bs][vs])}}as||(clearTimeout(this.savePageStateTimeoutID),this.savePageStateTimeoutID=setTimeout(()=>{this.saveState()},1e3)),await this.document.stateValues.itemCreditAchieved,ns&&this.requestRecordEvent(ns)}async updateAllChangedRenderers(ts={},rs){let ns=[...this.updateInfo.componentsToUpdateRenderers];if(this.updateInfo.componentsToUpdateRenderers.clear(),await this.updateRendererInstructions({componentNamesToUpdate:ns,sourceOfUpdate:{sourceInformation:ts,local:!0},actionId:rs}),this.updateInfo.compositesToUpdateReplacements.size>0){await this.replacementChangesFromCompositesToUpdate();let is=[...this.updateInfo.componentsToUpdateRenderers];this.updateInfo.componentsToUpdateRenderers.clear(),await this.updateRendererInstructions({componentNamesToUpdate:is,sourceOfUpdate:{sourceInformation:ts,local:!0},actionId:rs})}}requestRecordEvent(ts){return this.resumeVisibilityMeasuring(),ts.verb==="visibilityChanged"?this.processVisibilityChangedEvent(ts):new Promise((rs,ns)=>{this.processQueue.push({type:"recordEvent",event:ts,resolve:rs,reject:ns}),this.processing||(this.processing=!0,this.executeProcesses())})}async performRecordEvent({event:ts}){if(!this.flags.allowSaveEvents)return;ts.result||(ts.result={}),ts.context||(ts.context={});const rs={doenetId:this.doenetId,activityCid:this.activityCid,pageCid:this.cid,pageNumber:this.pageNumber,attemptNumber:this.attemptNumber,activityVariantIndex:this.activityVariantIndex,pageVariantIndex:this.requestedVariant.index,verb:ts.verb,object:JSON.stringify(ts.object,serializedComponentsReplacer),result:JSON.stringify(removeFunctionsMathExpressionClass(ts.result),serializedComponentsReplacer),context:JSON.stringify(ts.context,serializedComponentsReplacer),timestamp:new Date().toISOString().slice(0,19).replace("T"," "),version:"0.1.1"};try{let ns=await axios.post("/api/recordEvent.php",rs)}catch(ns){console.error(`Error saving event: ${ns.message}`)}}processVisibilityChangedEvent(ts){let rs=ts.object.componentName;if(ts.result.isVisible)this.visibilityInfo.componentsCurrentlyVisible[rs]||(this.visibilityInfo.componentsCurrentlyVisible[rs]=new Date),rs===this.documentName&&(this.visibilityInfo.documentHasBeenVisible||(this.visibilityInfo.documentHasBeenVisible=!0,this.onDocumentFirstVisible()));else{let is=this.visibilityInfo.componentsCurrentlyVisible[rs];if(is){delete this.visibilityInfo.componentsCurrentlyVisible[rs];let as=(new Date-Math.max(is,this.visibilityInfo.timeLastSent))/1e3;this.visibilityInfo.infoToSend[rs]?this.visibilityInfo.infoToSend[rs]+=as:this.visibilityInfo.infoToSend[rs]=as}}}sendVisibilityChangedEvents(){let ts={...this.visibilityInfo.infoToSend};this.visibilityInfo.infoToSend={};let rs=this.visibilityInfo.timeLastSent;this.visibilityInfo.timeLastSent=new Date;let ns={...this.visibilityInfo.componentsCurrentlyVisible};for(let as in ns){let os=(this.visibilityInfo.timeLastSent-Math.max(rs,ns[as]))/1e3;ts[as]?ts[as]+=os:ts[as]=os}for(let as in ts)ts[as]=Math.round(ts[as]),ts[as]||delete ts[as];let is;if(Object.keys(ts).length>0){let as={object:{componentName:this.documentName,componentType:"document"},verb:"isVisible",result:ts};is=new Promise((os,ls)=>{this.processQueue.push({type:"recordEvent",event:as,resolve:os,reject:ls}),this.processing||(this.processing=!0,this.executeProcesses())})}return this.visibilityInfo.suspended||(clearTimeout(this.visibilityInfo.saveTimerId),this.visibilityInfo.saveTimerId=setTimeout(this.sendVisibilityChangedEvents.bind(this),this.visibilityInfo.saveDelay)),is}async suspendVisibilityMeasuring(){clearTimeout(this.visibilityInfo.saveTimerId),clearTimeout(this.visibilityInfo.suspendTimerId),this.visibilityInfo.suspended||(this.visibilityInfo.suspended=!0,await this.sendVisibilityChangedEvents())}resumeVisibilityMeasuring(){this.visibilityInfo.suspended&&(this.visibilityInfo.suspended=!1,this.visibilityInfo.timeLastSent=new Date,clearTimeout(this.visibilityInfo.saveTimerId),this.visibilityInfo.saveTimerId=setTimeout(this.sendVisibilityChangedEvents.bind(this),this.visibilityInfo.saveDelay)),clearTimeout(this.visibilityInfo.suspendTimerId),this.visibilityInfo.suspendTimerId=setTimeout(this.suspendVisibilityMeasuring.bind(this),this.visibilityInfo.suspendDelay)}async executeUpdateStateVariables(ts){if(await this.processNewStateVariableValues(ts),(await this.replacementChangesFromCompositesToUpdate()).updatedComposites&&(await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0),this.updateInfo.stateVariablesToEvaluate)){let ns=this.updateInfo.stateVariablesToEvaluate;this.updateInfo.stateVariablesToEvaluate=[];for(let{componentName:is,stateVariable:as}of ns){let os=this._components[is];os&&os.state[as]&&await this.getStateVariableValue({component:os,stateVariable:as})}}await this.replacementChangesFromCompositesToUpdate()}async replacementChangesFromCompositesToUpdate(){let ts=[...this.updateInfo.compositesToUpdateReplacements];this.updateInfo.compositesToUpdateReplacements.clear();let rs=new Set([]),ns=0,is=!1,as=[];for(;ts.length>0;){for(let os of ts){let ls=this._components[os];if(ls instanceof this.componentInfoObjects.allComponentClasses._composite&&ls.isExpanded)if(ls.state.readyToExpandWhenResolved.initiallyResolved)if(await ls.stateValues.isInactiveCompositeReplacement)this.updateInfo.inactiveCompositesToUpdateReplacements.add(os);else{let us=await this.updateCompositeReplacements({component:ls,componentChanges:as});Object.keys(us.addedComponents).length>0&&(is=!0),Object.keys(us.deletedComponents).length>0&&(is=!0)}else rs.add(os)}if(ts=[...this.updateInfo.compositesToUpdateReplacements],this.updateInfo.compositesToUpdateReplacements.clear(),ns++,ns>100)throw Error("Seem to have an infinite loop while calculating replacement changes")}return this.updateInfo.compositesToUpdateReplacements=rs,{updatedComposites:is}}async processNewStateVariableValues(ts){let rs=0,ns=!1;for(let is in ts){let as=this._components[is];if(as===void 0){let ls=this.updateInfo.stateVariableUpdatesForMissingComponents[is];ls===void 0&&(ls=this.updateInfo.stateVariableUpdatesForMissingComponents[is]={}),Object.assign(ls,ts[is]);continue}let os=ts[is];for(let ls in os){let us=as.state[ls];if(us===void 0){let ps=ls.match(/^__def_primitive_(\d+)$/);if(ps){let ds=Number(ps[1]);as.definingChildren[ds]=os[ls],await this.processNewDefiningChildren({parent:as,expandComposites:!1});continue}else if(ps=ls.match(/^__def_primitive_ignore_(\d+)$/),ps){let ds=Number(ps[1]);as.definingChildren[ds]=os[ls],ns=!0;continue}console.warn(`can't update state variable ${ls} of component ${is}, as it doesn't exist.`);continue}if(!us.hasEssential){console.warn(`can't update state variable ${ls} of component ${is}, as it does not have an essential state variable.`);continue}let cs=ls;if(as.state[ls].essentialVarName&&(cs=as.state[ls].essentialVarName),ls in this.rendererVariablesByComponentType[as.componentType]&&this.updateInfo.componentsToUpdateRenderers.add(as.componentName),us.isArray){let ps=as.essentialState[cs];Array.isArray(ps)||(ps=as.essentialState[cs]=[]);let ds=[];as.state[us.arraySizeStateVariable].initiallyResolved||await as.state[us.arraySizeStateVariable].value;let fs=await us.arraySize;for(let hs in os[ls]){if(hs==="mergeObject")continue;let ys=vs=>vs;us.set&&(ys=us.set);let gs=us.setArrayValue({value:ys(os[ls][hs]),arrayKey:hs,arraySize:fs,arrayValues:ps});us.usedDefaultByArrayKey[hs]=!1,rs+=gs.nFailures;let bs=us.varNamesIncludingArrayKeys[hs];bs&&ds.push(...bs)}for(let hs of ds)await this.recordActualChangeInStateVariable({componentName:is,varName:hs})}else{if(!us.hasEssential){console.warn(`can't update state variable ${ls} of component ${is}, as it does not have an essential state variable.`);continue}us.set?as.essentialState[cs]=us.set(os[ls]):as.essentialState[cs]=os[ls],delete us.usedDefault}await this.recordActualChangeInStateVariable({componentName:is,varName:ls})}}return{nFailures:rs,foundIgnore:ns}}async requestComponentChanges({instruction:ts,initialChange:rs=!0,workspace:ns,newStateVariableValues:is}){let as=this._components[ts.componentName],os=this.substituteAliases({stateVariables:[ts.stateVariable],componentClass:as.constructor})[0];ns[ts.componentName]===void 0&&(ns[ts.componentName]={});let ls=ns[ts.componentName],us=as.state[os],cs=us.additionalStateVariablesDefined,ps=[os];cs&&ps.push(...cs);for(let vs of ps)if(!as.state[vs].isResolved&&!(await this.dependencies.resolveItem({componentName:as.componentName,type:"stateVariable",stateVariable:vs,force:!0})).success)throw Error(`Can't get value of ${os} of ${as.componentName} as ${vs} couldn't be resolved.`);let ds=await this.getStateVariableDefinitionArguments({component:as,stateVariable:os,excludeDependencyValues:us.excludeDependencyValuesInInverseDefinition});ds.componentInfoObjects=this.componentInfoObjects,ds.initialChange=rs,ds.stateValues=as.stateValues,ds.overrideFixed=ts.overrideFixed,ds.shadowedVariable=ts.shadowedVariable,ds.sourceDetails=ts.sourceDetails;let fs=os;if(us.isArrayEntry){let vs=us.arrayStateVariable;fs=vs;let Ns={};if(ds.arrayKeys.length===1){if("value"in ts)Ns[ds.arrayKeys[0]]=ts.value;else if("valueOfStateVariable"in ts){let Ts=this.substituteAliases({stateVariables:[ts.valueOfStateVariable],componentClass:as.constructor})[0],Cs=as.state[Ts];if(Cs)Ns[ds.arrayKeys[0]]=await Cs.value;else throw Error(`Invalid instruction to change ${ts.stateVariable} of ${ts.componentName}, value of state variable ${ts.valueOfStateVariable} not found.`)}}else for(let[Ts,Cs]of ds.arrayKeys.entries())if(Array.isArray(ts.value))Ns[Cs]=ts.value[Ts];else if(ts.value instanceof Context.class)try{Ns[Cs]=ts.value.get_component(Ts)}catch{}ds.desiredStateVariableValues={[vs]:Ns}}else if("value"in ts)ds.desiredStateVariableValues={[os]:ts.value};else if("valueOfStateVariable"in ts){let vs=this.substituteAliases({stateVariables:[ts.valueOfStateVariable],componentClass:as.constructor})[0],Ns=as.state[vs];if(Ns)ds.desiredStateVariableValues={[os]:await Ns.value};else throw Error(`Invalid instruction to change ${ts.stateVariable} of ${ts.componentName}, value of state variable ${ts.valueOfStateVariable} not found.`)}let hs=ls[fs];if(hs===void 0&&(hs=ls[fs]={}),us.additionalStateVariablesDefined)for(let vs of us.additionalStateVariablesDefined){let Ns=vs;as.state[vs].isArray&&(Ns=us.arrayStateVariable);let Cs=ls[Ns];Cs&&(Object.assign(hs,Cs),ls[Ns]=hs)}if(ds.workspace=hs,ts.additionalStateVariableValues)for(let vs in ts.additionalStateVariableValues){if(!us.additionalStateVariablesDefined.includes(vs)){console.warn(`Can't invert ${vs} at the same time as ${os}, as not an additional state variable defined`);continue}ds.desiredStateVariableValues[vs]=ts.additionalStateVariableValues[vs]}if(!us.inverseDefinition){console.warn(`Cannot change state variable ${os} of ${as.componentName} as it doesn't have an inverse definition`);return}if(await as.stateValues.fixed&&!ts.overrideFixed&&!us.ignoreFixed){console.log(`Changing ${os} of ${as.componentName} did not succeed because fixed is true.`);return}if(!(rs||await as.stateValues.modifyIndirectly!==!1)){console.log(`Changing ${os} of ${as.componentName} did not succeed because modifyIndirectly is false.`);return}let ys=await us.inverseDefinition(ds);if(!ys.success)return;let gs=[],bs;for(let vs of ys.instructions){let Ns=!1;if(vs.setDependency){let Ts=vs.setDependency,Cs=this.dependencies.downstreamDependencies[as.componentName][os][Ts];if(["stateVariable","parentStateVariable"].includes(Cs.dependencyType)&&Cs.downstreamComponentNames.length===1){let xs=Cs.downstreamComponentNames[0],As=Cs.mappedDownstreamVariableNamesByComponent[0][0],ws=this._components[xs].state[As];if((ws.isArrayEntry||ws.isArray)&&!ws.doNotCombineInverseArrayInstructions){let Es=ws.isArrayEntry?ws.arrayStateVariable:As;if(bs&&!(bs.componentName===xs&&bs.stateVariable===Es&&bs.shadowedVariable===vs.shadowedVariable&&bs.treatAsInitialChange===vs.treatAsInitialChange)&&(gs.push(bs),bs=void 0),!(vs.additionalDependencyValues||ws.basedOnArrayKeyStateVariables))if(Ns=!0,bs||(bs={combinedArray:!0,componentName:xs,stateVariable:Es,shadowedVariable:vs.shadowedVariable,treatAsInitialChange:vs.treatAsInitialChange,desiredValue:{}}),ws.isArrayEntry){let Ss=await ws.arrayKeys;if(Ss.length===1)bs.desiredValue[Ss[0]]=vs.desiredValue;else for(let[Ds,Vs]of Ss.entries())bs.desiredValue[Vs]=vs.desiredValue[Ds]}else if(ws.nDimensions===1||!Array.isArray(vs.desiredValue))Object.assign(bs.desiredValue,vs.desiredValue);else{let Ss=(Ds,Vs)=>{if(Vs===1)return Object.assign({},Ds);{let Is={};for(let Os in Ds){let Ps=Ss(Ds[Os],Vs-1);for(let $s in Ps)Is[`${Os},${$s}`]=Ps[$s]}return Is}};Object.assign(bs.desiredValue,Ss(vs.desiredValue,ws.nDimensions))}}}}Ns||(bs&&(gs.push(bs),bs=void 0),gs.push(vs))}bs&&(gs.push(bs),bs=void 0);for(let vs of gs)if(vs.setEssentialValue){if(!ps.includes(vs.setEssentialValue)){let Ts=!1;if(us.isArrayEntry){let Cs=[us.arrayStateVariable];if(us.additionalStateVariablesDefined)for(let xs of us.additionalStateVariablesDefined){let As=as.state[xs];As.isArrayEntry&&Cs.push(As.arrayStateVariable)}Ts=Cs.includes(vs.setEssentialValue)}if(!Ts)throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: specified changing value of ${vs.setEssentialValue}, which is not a state variable defined with ${os}.`)}if(!as.state[vs.setEssentialValue].hasEssential)throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: can't set essential value of ${vs.setEssentialValue} if it is does not have an essential value.`);if(!("value"in vs))throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: setEssentialValue must specify a value`);let Ns=vs.value;if(Ns instanceof Context.class&&(Ns=(await preprocessMathInverseDefinition({desiredValue:Ns,stateValues:as.stateValues,variableName:vs.setEssentialValue,workspace:hs})).desiredValue),as.state[vs.setEssentialValue].doNotShadowEssential||as.state[vs.setEssentialValue].shadowVariable)this.calculateEssentialVariableChanges({component:as,varName:vs.setEssentialValue,value:Ns,newStateVariableValues:is,recurseToShadows:!1});else{let Ts=as;for(;Ts.shadows&&Ts.shadows.propVariable===void 0;)Ts=this._components[Ts.shadows.componentName];this.calculateEssentialVariableChanges({component:Ts,varName:vs.setEssentialValue,value:Ns,newStateVariableValues:is})}}else if(vs.setDependency){let Ns=vs.setDependency,Ts=this.dependencies.downstreamDependencies[as.componentName][os][Ns];if(Ts.dependencyType==="child"){let Cs=vs.childIndex;if(Ts.downstreamPrimitives[Cs]!==null){if(typeof vs.desiredValue==typeof Ts.downstreamPrimitives[Cs]){let xs=this._components[Ts.parentName],As=Ts.activeChildrenIndices[Cs];if(xs.compositeReplacementActiveRange){for(let Ds of xs.compositeReplacementActiveRange)if(Ds.firstInd<=As&&Ds.lastInd>=As)throw console.log(`parent: ${xs.componentName}, activeChildInd: ${As}`),console.log(xs.compositeReplacementActiveRange),console.log(vs),Error("Need to implement changing primitive replacements from composite")}let ws=As;if(xs.compositeReplacementActiveRange)for(let Ds of xs.compositeReplacementActiveRange)Ds.lastInd<ws&&(ws-=Ds.lastInd-Ds.firstInd);let Es=xs;for(;Es.shadows&&Es.shadows.propVariable===void 0;)Es=this._components[Es.shadows.componentName];let Ss;vs.ignoreChildChangeForComponent&&(Ss=xs.componentName),this.calculatePrimitiveChildChanges({parent:Es,definingInd:ws,newValue:vs.desiredValue,newStateVariableValues:is,markToIgnoreForParent:Ss})}}else{let xs=Ts.downstreamPrimitives.slice(0,Cs+1).filter(Ss=>!Ss).length-1,As=Ts.downstreamComponentNames[xs];if(!As)throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: ${Ns} child of index ${vs.childIndex} does not exist.`);let ws=Ts.mappedDownstreamVariableNamesByComponent[vs.childIndex][vs.variableIndex];if(!ws)throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: ${Ns} variable of index ${vs.variableIndex} does not exist.`);let Es={componentName:As,stateVariable:ws,value:vs.desiredValue,overrideFixed:ts.overrideFixed,arrayKey:vs.arrayKey};await this.requestComponentChanges({instruction:Es,initialChange:vs.treatAsInitialChange===!0,workspace:ns,newStateVariableValues:is})}}else if(["attributeComponent","shadowSource","adapterSource","targetComponent"].includes(Ts.dependencyType)){let Cs=Ts.downstreamComponentNames[0],xs=Ts.mappedDownstreamVariableNamesByComponent[0][vs.variableIndex];if(!xs)throw Error(`Invalid inverse definition of ${os} of ${as.componentName}: ${Ns} variable of index ${vs.variableIndex} does not exist.`);let As={componentName:Cs,stateVariable:xs,value:vs.desiredValue,overrideFixed:ts.overrideFixed,arrayKey:vs.arrayKey};await this.requestComponentChanges({instruction:As,initialChange:vs.treatAsInitialChange===!0,workspace:ns,newStateVariableValues:is})}else if(["stateVariable","parentStateVariable","adapterSourceStateVariable","sourceCompositeStateVariable"].includes(Ts.dependencyType)&&Ts.downstreamComponentNames.length===1){let Cs=Ts.downstreamComponentNames[0],xs=Ts.mappedDownstreamVariableNamesByComponent[0][0],As={componentName:Cs,stateVariable:xs,value:vs.desiredValue,overrideFixed:ts.overrideFixed,shadowedVariable:vs.shadowedVariable};if(vs.additionalDependencyValues){let ws=this.components[Cs].state[xs];for(let Es in vs.additionalDependencyValues){let Ss=this.dependencies.downstreamDependencies[as.componentName][os][Es];if(!(["stateVariable","parentStateVariable"].includes(Ss.dependencyType)&&Ss.downstreamComponentNames.length===1)){console.warn(`Can't simultaneously set additional dependency value ${Es} if it isn't a state variable`);continue}let Ds=Ss.mappedDownstreamVariableNamesByComponent[0][0];if(Ss.downstreamComponentNames[0]!==Cs||!ws.additionalStateVariablesDefined.includes(Ds)){console.warn(`Can't simultaneously set additional dependency value ${Es} if it doesn't correspond to additional state variable defined of ${Ns}'s state variable`);continue}As.additionalStateVariableValues||(As.additionalStateVariableValues={}),As.additionalStateVariableValues[Ds]=vs.additionalDependencyValues[Es]}}await this.requestComponentChanges({instruction:As,initialChange:vs.treatAsInitialChange===!0,workspace:ns,newStateVariableValues:is})}else throw Error(`unimplemented dependency type ${Ts.dependencyType} in requestComponentChanges`)}else if(vs.combinedArray){let Ns={componentName:vs.componentName,stateVariable:vs.stateVariable,value:vs.desiredValue,overrideFixed:ts.overrideFixed,shadowedVariable:vs.shadowedVariable};await this.requestComponentChanges({instruction:Ns,initialChange:vs.treatAsInitialChange===!0,workspace:ns,newStateVariableValues:is})}else throw console.log(vs),Error(`Unrecognized instruction in inverse definition of ${os} of ${as.componentName}`)}calculateEssentialVariableChanges({component:ts,varName:rs,value:ns,newStateVariableValues:is,recurseToShadows:as=!0}){if(is[ts.componentName]||(is[ts.componentName]={}),ts.state[rs].isArray?(is[ts.componentName][rs]||(is[ts.componentName][rs]={mergeObject:!0}),Object.assign(is[ts.componentName][rs],ns)):is[ts.componentName][rs]=ns,as&&ts.shadowedBy)for(let os of ts.shadowedBy)os.shadows.propVariable===void 0&&this.calculateEssentialVariableChanges({component:os,varName:rs,value:ns,newStateVariableValues:is})}calculatePrimitiveChildChanges({parent:ts,definingInd:rs,newValue:ns,newStateVariableValues:is,markToIgnoreForParent:as}){if(is[ts.componentName]||(is[ts.componentName]={}),ts.componentName===as?is[ts.componentName][`__def_primitive_ignore_${rs}`]=ns:is[ts.componentName][`__def_primitive_${rs}`]=ns,ts.shadowedBy)for(let os of ts.shadowedBy)os.shadows.propVariable===void 0&&this.calculatePrimitiveChildChanges({parent:os,definingInd:rs,newValue:ns,newStateVariableValues:is,markToIgnoreForParent:as})}async saveState(ts=!1){if(this.savePageStateTimeoutID=null,!this.flags.allowSaveState&&!this.flags.allowLocalState)return;let rs=nanoid();this.flags.allowLocalState&&await set(`${this.doenetId}|${this.pageNumber}|${this.attemptNumber}|${this.cid}`,{coreState:this.cumulativeStateVariableChanges,rendererState:this.rendererState,coreInfo:this.coreInfo,saveId:rs}),postMessage({messageType:"savedState",coreId:this.coreId}),this.flags.allowSaveState&&(this.pageStateToBeSavedToDatabase={cid:this.cid,coreInfo:this.coreInfoString,coreState:JSON.stringify(this.cumulativeStateVariableChanges,serializedComponentsReplacer),rendererState:JSON.stringify(this.rendererState,serializedComponentsReplacer),pageNumber:this.pageNumber,attemptNumber:this.attemptNumber,doenetId:this.doenetId,saveId:rs,serverSaveId:this.serverSaveId,updateDataOnContentChange:this.updateDataOnContentChange},this.changesToBeSaved=!0,await this.saveChangesToDatabase(ts))}async saveChangesToDatabase(ts){if(!this.changesToBeSaved)return;if(this.saveStateToDBTimerId!==null)if(ts)clearTimeout(this.saveStateToDBTimerId);else return;this.changesToBeSaved=!1,this.saveStateToDBTimerId=setTimeout(()=>{this.saveStateToDBTimerId=null,this.saveChangesToDatabase()},6e4);let rs;try{rs=await axios.post("/api/savePageState.php",this.pageStateToBeSavedToDatabase)}catch{postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"Error synchronizing data.  Changes not saved to the server.",toastType:toastType.ERROR}});return}if(console.log("result from saving to database:",rs.data),rs.status===null){postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"Error synchronizing data.  Changes not saved to the server.  Are you connected to the internet?",toastType:toastType.ERROR}});return}let ns=rs.data;if(!ns.success){postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:ns.message,toastType:toastType.ERROR}});return}this.serverSaveId=ns.saveId,this.flags.allowLocalState&&await set(`${this.doenetId}|${this.pageNumber}|${this.attemptNumber}|${this.cid}|ServerSaveId`,ns.saveId),ns.stateOverwritten&&(this.attemptNumber!==Number(ns.attemptNumber)||this.cid===ns.cid?(this.flags.allowLocalState&&await set(`${this.doenetId}|${this.pageNumber}|${ns.attemptNumber}|${ns.cid}`,{coreState:JSON.parse(ns.coreState,serializedComponentsReviver),rendererState:JSON.parse(ns.rendererState,serializedComponentsReviver),coreInfo:JSON.parse(ns.coreInfo,serializedComponentsReviver),saveId:ns.saveId}),postMessage({messageType:"resetPage",coreId:this.coreId,args:{changedOnDevice:ns.device,newCid:ns.cid,newAttemptNumber:Number(ns.attemptNumber)}})):postMessage({messageType:"inErrorState",coreId:this.coreId,args:{errMsg:"Content changed unexpectedly!"}}))}saveSubmissions({pageCreditAchieved:ts,suppressToast:rs=!1}){if(!this.flags.allowSaveSubmissions)return;const ns={doenetId:this.doenetId,attemptNumber:this.attemptNumber,credit:ts,itemNumber:this.itemNumber};console.log("payload for save credit for item",ns),axios.post("/api/saveCreditForItem.php",ns).then(is=>{if(is.status===null)postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"Credit not saved due to error.  Are you connected to the internet?",toastType:toastType.ERROR}});else if(!is.data.success)postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:`Credit not saved due to error: ${is.data.message}`,toastType:toastType.ERROR}});else{let as=is.data;postMessage({messageType:"updateCreditAchieved",coreId:this.coreId,args:{creditByItem:as.creditByItem.map(Number),creditForAssignment:Number(as.creditForAssignment),creditForAttempt:Number(as.creditForAttempt),showCorrectness:as.showCorrectness==="1",totalPointsOrPercent:Number(as.totalPointsOrPercent)}}),as.viewedSolution&&(rs||postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"No credit awarded since solution was viewed.",toastType:toastType.INFO}})),as.timeExpired&&(rs||postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"No credit awarded since the time allowed has expired.",toastType:toastType.INFO}})),as.pastDueDate&&(rs||postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"No credit awarded since the due date has passed.",toastType:toastType.INFO}})),as.exceededAttemptsAllowed&&(rs||postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"No credit awarded since no more attempts are allowed.",toastType:toastType.INFO}})),as.databaseError&&postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:"Credit not saved due to database error.",toastType:toastType.ERROR}})}}).catch(is=>{postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:`Credit not saved due to error: ${is.message}`,toastType:toastType.ERROR}})})}async recordSolutionView(){if(!this.flags.allowSaveSubmissions)return{allowView:!0,message:"",scoredComponent:this.documentName};try{const ts=await axios.post("/api/reportSolutionViewed.php",{doenetId:this.doenetId,itemNumber:this.itemNumber,pageNumber:this.pageNumber,attemptNumber:this.attemptNumber});if(ts.status===null){let rs="Cannot show solution due to error.  Are you connected to the internet?";return postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:rs,toastType:toastType.ERROR}}),{allowView:!1,message:rs,scoredComponent:this.documentName}}else{let rs=ts.data;return rs.success?{allowView:!0,message:"",scoredComponent:this.documentName}:{allowView:!1,message:`Cannot show solution due to error: ${rs.message}`,scoredComponent:this.documentName}}}catch{let rs="Cannot show solution due to error.";return postMessage({messageType:"sendToast",coreId:this.coreId,args:{message:rs,toastType:toastType.ERROR}}),{allowView:!1,message:rs,scoredComponent:this.documentName}}}get scoredItemWeights(){return(async()=>(await this.document.stateValues.scoredDescendants).map(ts=>ts.stateValues.weight))()}requestAnimationFrame(ts){postMessage({messageType:"requestAnimationFrame",coreId:this.coreId,args:ts})}cancelAnimationFrame(ts){postMessage({messageType:"cancelAnimationFrame",coreId:this.coreId,args:ts})}handleVisibilityChange({visible:ts}){ts?this.resumeVisibilityMeasuring():this.suspendVisibilityMeasuring()}handleNavigatingToComponent(ts){var ns;let rs=this._components[ts];(ns=rs==null?void 0:rs.actions)!=null&&ns.revealSection&&this.requestAction({componentName:rs.componentName,actionName:"revealSection"})}async terminate(){let ts=function(){return new Promise((rs,ns)=>{setTimeout(rs,100)})};if(await this.suspendVisibilityMeasuring(),this.submitAnswersTimeout&&(clearTimeout(this.submitAnswersTimeout),await this.autoSubmitAnswers()),this.stopProcessingRequests=!0,this.processing)for(let rs=0;rs<10&&(await ts(),!!this.processing);rs++);this.savePageStateTimeoutID?(clearTimeout(this.savePageStateTimeoutID),await this.saveState(!0)):await this.saveChangesToDatabase(!0)}recordAnswerToAutoSubmit(ts){this.answersToSubmit||(this.answersToSubmit=[]),this.answersToSubmit.includes(ts)||this.answersToSubmit.push(ts),clearTimeout(this.submitAnswersTimeout),this.submitAnswersTimeout=setTimeout(()=>{this.autoSubmitAnswers()},1e3)}async autoSubmitAnswers(){let ts=this.answersToSubmit;this.answersToSubmit=[];for(let rs of ts)this._components[rs].actions.submitAnswer&&await this.requestAction({componentName:rs,actionName:"submitAnswer"})}requestComponentDoenetML(ts,rs){let ns=this.components[ts];if(!ns)return null;let is=ns.doenetMLrange;if(!is)return null;let as,os;if(rs){if(is.selfCloseBegin!==void 0)return"";as=is.openEnd+1,os=is.closeBegin}else as=is.openBegin!==void 0?is.openBegin:is.selfCloseBegin,os=is.closeEnd!==void 0?is.closeEnd:is.selfCloseEnd;let ls=this.doenetML.slice(as-1,os);rs&&(ls[0]===`
`&&(ls=ls.slice(1)),ls=ls.replace(/\n[ \t]*$(?!\n)/,""));let us=ls.split(`
`),cs=us.slice(1).reduce((ps,ds)=>Math.min(ps,ds.trim().length>1?ds.search(/\S|$/):1/0),1/0);return Number.isFinite(cs)&&cs>0&&(us=us.map(ps=>{let ds=Math.min(cs,ps.search(/\S|$/));return ps.slice(ds)}),ls=us.join(`
`)),ls+=`
`,ls}copyToClipboard(ts,rs){typeof ts!="string"?this.resolveAction({actionId:rs}):postMessage({messageType:"copyToClipboard",coreId:this.coreId,args:{text:ts,actionId:rs}})}navigateToTarget(ts){postMessage({messageType:"navigateToTarget",coreId:this.coreId,args:ts})}}function validateAttributeValue({value:ss,attributeSpecification:ts,attribute:rs}){return ts.valueTransformations&&ss in ts.valueTransformations&&(ss=ts.valueTransformations[ss]),ts.transformNonFiniteTo!==void 0&&!Number.isFinite(ss)&&(ss=ts.transformNonFiniteTo),ts.toLowerCase&&(ss=ss.toLowerCase()),ts.trim&&(ss=ss.trim()),ts.validValues?ts.validValues.includes(ss)||(console.warn(`Invalid value ${ss} for attribute ${rs}, using value ${ts.defaultValue}`),ss=ts.defaultValue):ts.clamp&&(ss<ts.clamp[0]?ss=ts.clamp[0]:ss>ts.clamp[1]?ss=ts.clamp[1]:Number.isFinite(ss)||(ss=ts.defaultValue)),ss}function calculateAllComponentsShadowing(ss){let ts=[];if(ss.shadowedBy){for(let rs of ss.shadowedBy)if(!rs.shadows.propVariable){ts.push(rs.componentName);let ns=calculateAllComponentsShadowing(rs);ts.push(...ns)}}if(ss.replacementOf){let rs=calculateAllComponentsShadowing(ss.replacementOf);ts.push(...rs)}return ts}let core,queuedRequestActions=[];onmessage=function(ss){ss.data.messageType==="createCore"?createCore(ss.data.args):ss.data.messageType==="requestAction"?core!=null&&core.initialized?core.requestAction(ss.data.args):queuedRequestActions.push(ss.data.args):ss.data.messageType==="returnAllStateVariables"?(console.log("all components"),console.log(core._components),returnAllStateVariables(core).then(ts=>{postMessage({messageType:"returnAllStateVariables",args:ts})})):ss.data.messageType==="visibilityChange"?core.handleVisibilityChange(ss.data.args):ss.data.messageType==="terminate"?core.terminate().then(()=>{postMessage({messageType:"terminated"})}):ss.data.messageType==="navigatingToComponent"?core.handleNavigatingToComponent(ss.data.args.componentName):ss.data.messageType==="submitAllAnswers"&&core.requestAction({componentName:core.documentName,actionName:"submitAllAnswers",args:ss.data.args})};async function createCore(ss){core=new Core(ss),core.getInitializedPromise().then(()=>{for(let ts of queuedRequestActions)core.requestAction(ts);queuedRequestActions=[]})}async function returnAllStateVariables(ss){if(!ss.components)return{};let ts={};for(let rs in ss.components){let ns=ss.components[rs],is=ts[rs]={componentName:rs,componentType:ns.componentType,stateValues:{}};for(let as in ns.state)is.stateValues[as]=removeFunctionsMathExpressionClass(await ns.state[as].value);is.activeChildren=ns.activeChildren.map(as=>as.componentName?{componentName:as.componentName,componentType:as.componentType}:as),ns.replacements&&(is.replacements=ns.replacements.map(as=>as.componentName?{componentName:as.componentName,componentType:as.componentType}:as),ns.replacementsToWithhold!==void 0&&(is.replacementsToWithhold=ns.replacementsToWithhold)),is.sharedParameters=removeFunctionsMathExpressionClass(ns.sharedParameters)}return ts}function removeFunctionsMathExpressionClass(ss){if(ss instanceof Context.class)ss=ss.tree;else if(typeof ss=="function")ss=void 0;else if(Array.isArray(ss))ss=ss.map(ts=>removeFunctionsMathExpressionClass(ts));else if(typeof ss=="object"&&ss!==null){let ts={};for(let rs in ss)ts[rs]=removeFunctionsMathExpressionClass(ss[rs]);ss=ts}return ss}})();
