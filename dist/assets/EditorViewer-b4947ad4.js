import{r as i,a4 as ee,l as r,m as L,w as te,g as C,h as ne,R as w,f as oe,G as E,E as ae,c as se,ab as re,u as ie,Q as le,S as ue,v as j,k as ce,j as R,P as de}from"./index-51be1395.js";import{v as D,e as k,r as O,a as F,u as fe,t as N}from"./EditorViewerRecoil-d45e8de7.js";function me(n,o,t=window){const c=i.useRef(o);i.useEffect(()=>{c.current=o},[o]),i.useEffect(()=>{if(t==null)return;const d=l=>c.current(l);return t.addEventListener(n,d),()=>t.removeEventListener(n,d)},[n,t])}const $=()=>j(({snapshot:o,set:t})=>async()=>{const c=await o.getPromise(N),d=await o.getPromise(F);t(D,c),d&&t(O,l=>l+1)});function pe(){let n=ee();const o=n==null?void 0:n.doenetId,t=n==null?void 0:n.pageDoenetId,c=r(D),d=r(L("pageId")),l=r(L("linkPageId")),b=r(L("doenetId"));let u=d,y=b;l&&(u=l,y=l),o&&(u=t,y=o);const x=r(te),B=r(k),[K,U]=C(ne),z=w(oe),_=w(k),G=r(O),J=w(F),[A,q]=C(E(u)),f=r(E(b)),M=w(ae),{canUpload:H}=r(se),Q=$(),T=w(re);let a=ie();const g=i.useRef({}),P=i.useRef(null);le(y),ue(x);let v=!1,I=null;Object.keys(A).length>0&&(v=!0,f!=null&&f.isSinglePage&&!l?I=f==null?void 0:f.label:I=A.label),i.useEffect(()=>{const e=document.title;return I&&(document.title=`${I} - Doenet`),()=>{document.title=e}},[I]);let V=j(({snapshot:e,set:s})=>async m=>{let{data:S}=await ce.get(`/media/byPageId/${m}.doenet`);S=S.toString();let h=await e.getPromise(E(m)),Z=await e.getPromise(E(h.containingDoenetId));s(fe,S),s(N,S),s(D,S),s(k,m);let p=[];Z.type=="bank"&&p.push("AssignmentSettingsMenu"),h.type=="pageLink"&&(p.push("AssignmentSettingsMenu"),p.push("PageLink"),p.push("SupportingFilesMenu")),H!=="1"&&p.push("SupportingFilesMenu"),M(p)},[M]);if(i.useEffect(()=>(u!==""&&v?V(u):t&&q({containingDoenetId:o,doenetId:t,isSelected:!1,label:"Untitled",parentDoenetId:o,type:"page"}),()=>{_("")}),[V,_,t,u,v]),me("keydown",e=>{(e.keyCode===83&&e.metaKey||e.keyCode===83&&e.ctrlKey)&&(e.preventDefault(),Q())}),i.useEffect(()=>{var e,s;P.current!==a.key&&(((e=a.state)==null?void 0:e.previousScrollPosition)!==void 0&&P.current&&(g.current[P.current].lastScrollPosition=a.state.previousScrollPosition),g.current[a.key]&&((s=g.current[a.key])==null?void 0:s.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:g.current[a.key].lastScrollPosition}),g.current[a.key]={...a},P.current=a.key)},[a]),i.useEffect(()=>{const e=document.getElementById("mainPanel");T(e)},[]),x==="__not_found__")return R("h1",{children:"Content not found or no permission to view content"});if(u!==B)return null;let W=1,X="button";function Y(e,s){const m=JSON.parse(JSON.stringify(e));z({index:m.index,allPossibleVariants:s}),U({index:m.index})}return R(de,{doenetML:c,flags:{showCorrectness:!0,solutionDisplayMode:X,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},doenetId:b,attemptNumber:W,generatedVariantCallback:Y,requestedVariantIndex:K.index,setIsInErrorState:J,pageIsActive:!0},`pageViewer${G}`)}const Se=Object.freeze(Object.defineProperty({__proto__:null,default:pe,useUpdateViewer:$},Symbol.toStringTag,{value:"Module"}));export{Se as E,me as a,$ as u};
