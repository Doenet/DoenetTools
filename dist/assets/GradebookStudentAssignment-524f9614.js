import{R as C,p as ie,l as c,m as h,b as A,E as de,r as I,I as ce,j as n,a as m,F as W,k as Z}from"./index-51be1395.js";import{attemptData as me,studentData as ue,assignmentData as pe,overviewData as fe,Styles as be,Table as he}from"./Gradebook-8767184a.js";import{currentAttemptNumber as ge}from"./AssignmentViewer-cf7c4574.js";import{e as we}from"./RoleDropdown-eda41b84.js";import{A as ve}from"./ActivityViewer-b5fbacf1.js";import"./activityUtils-8068764c.js";import"./ActionButton-4f03b512.js";import"./ButtonGroup-9c5ec76b.js";import"./DropdownMenu-b4332b4c.js";import"./setPrototypeOf-51e8cf87.js";import"./visibility-sensor-31436047.js";function Le(){var O,R,j,G,H,_,$,B,U;const ee=C(ie);let g=c(h("courseId")),o=c(h("doenetId")),s=c(h("userId")),w=c(h("attemptNumber")),te=c(h("previousCrumb")),u=A(me(o)),S=A(ue);const L=C(ge);let T=A(pe),{canViewAndModifyGrades:D}=c(we(g));const N=C(de);let se=A(fe);const b=Number((O=T.contents[o])==null?void 0:O.totalPointsOrPercent),ae=(R=T.contents[o])==null?void 0:R.label,x=(G=(j=u==null?void 0:u.contents)==null?void 0:j[s])==null?void 0:G.attempts;let[a,E]=I.useState(null),[l,oe]=I.useState(null),r={},y=0;I.useEffect(()=>{if(x){let e=Object.keys(x).map(Number),t=Math.max(0,...e);w&&w<t&&(t=w),E(t),L(t)}else console.log(">>>>TODO TELL THEM YOU HAVENT TAKEN YET")},[x,E,L,w]),I.useEffect(()=>{N(D!=="1"?["GradeSettings"]:[])},[D,N]);let M=c(ce(g));if((M==null?void 0:M.canViewCourse)=="0")return n("h1",{children:"No Access to view this page."});if(!o||!s)return null;async function re(e,t,i){const{data:{success:v,message:Y,foundAttempt:p,attemptInfo:f,showSolutionInGradebook:le,paginate:q}}=await Z.get("/api/getGradebookAssignmentAttempts.php",{params:{courseId:e,doenetId:t,userId:i}});let k={},J={},P="none";le==="1"&&(P="button");for(let d of f){let K=d.attemptNumber,X=d.variantIndex,z=J[d.cid];if(z)k[K]={cid:d.cid,variantIndex:X,doenetML:z,solutionDisplayMode:P,paginate:q};else{const{data:Q}=await Z.get(`/media/${d.cid}.doenet`);J[d.cid]=Q,k[K]={cid:d.cid,variantIndex:X,doenetML:Q,solutionDisplayMode:P,paginate:q}}}oe(k)}if(l===null)return re(g,o,s),null;if(u.state=="hasValue"&&s!==null&&s!==""&&(y=Math.max(0,...Object.keys(l).map(Number))),r.headers=[{Header:"Score",Footer:"Possible Points",accessor:"score",disableFilters:!0}],r.rows=[],S.state=="hasValue"&&s!==null&&s!==""){let e={},t={};if(e.score="Percentage",t.score="Score",u.state=="hasValue"){for(let p=1;p<=y;p++){let f=u.contents[s].attempts[p];e["a"+p]=f?Math.round(f*1e3)/10+"%":"",t["a"+p]=f?Math.round(f*100*b)/100:""}let i=($=(_=(H=se.contents)==null?void 0:H[s])==null?void 0:_.assignments)==null?void 0:$[o],v=b*i,Y=Math.round(i*1e3)/10+"%";t.total=v,e.total=Y}r.rows.push(t),r.rows.push(e)}r.headers.push({Header:"Assignment Total",Footer:b,accessor:"total",disableFilters:!0});for(let e=1;e<=y;e++)r.headers.push({Header:"Attempt "+e,Footer:b,accessor:"a"+e,disableFilters:!0,Cell:t=>m("a",{onClick:()=>{ee({page:"course",tool:"gradebookStudentAssignment",view:"",params:{courseId:g,doenetId:o,userId:s,attemptNumber:e,previousCrumb:te}})},children:[" ",t.value," "]})});let F=null,V=null;if(a>0&&l[a]){let e=l[a].cid,t=l[a].variantIndex,i=l[a].solutionDisplayMode,v=l[a].paginate;F=n(ve,{cid:e,doenetId:o,userId:s,forceDisable:!0,forceShowCorrectness:!0,forceShowSolution:i!=="none",forceUnsuppressCheckwork:!0,flags:{showCorrectness:!0,readOnly:!0,solutionDisplayMode:i,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!0,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},attemptNumber:a,requestedVariantIndex:t,paginate:v},`activityViewer${o}`),V=m("div",{style:{paddingLeft:"8px"},children:["Viewing attempt number ",a]})}else V=m("div",{style:{paddingLeft:"8px"},children:["No content available for attempt number ",a]});let ne=`${(B=S.contents[s])==null?void 0:B.firstName} ${(U=S.contents[s])==null?void 0:U.lastName}`;return m(W,{children:[n("div",{style:{marginLeft:"18px"},children:m("b",{children:["Gradebook for ",ne]})}),n("div",{style:{paddingLeft:"18px"},children:n("b",{children:ae})}),m("div",{style:{paddingLeft:"18px"},children:[b," Points Possible"]}),n(be,{children:n(he,{columns:r.headers,data:r.rows})}),a>0?m(W,{children:[V,F]}):n("div",{children:"Click an attempt's grade to see your attempt"})]})}export{Le as default};
