import{l as k,m as E,v as F,I as G,a5 as L,aF as M,j as N,B as U}from"./index-51be1395.js";import{assignmentData as W,overviewData as X,gradeCategories as q}from"./Gradebook-8767184a.js";import"./RoleDropdown-eda41b84.js";import"./DropdownMenu-b4332b4c.js";import"./setPrototypeOf-51e8cf87.js";function Y(){const R=k(E("courseId")),D=F(({snapshot:d})=>async g=>{var h,x,S,A,T,B;const{label:O}=await d.getPromise(G(g));let V=`${O}.csv`,f,l=await d.getPromise(W),_=await d.getPromise(X);const{value:j}=await d.getPromise(L(g));let t={},I="Name,Email,External Id,Section,Withdrew,",a="Possible Points,,,,,";for(const{userId:o,email:i,roleId:v,withdrew:P,externalId:m,section:w,firstName:b,lastName:e}of j){const{isIncludedInGradebook:s}=await d.getPromise(M({courseId:g,roleId:v}));if(s!=="1")continue;const $=`${b} ${e}`.replaceAll('"','""');t[o]={courseTotal:0,csv:`"${$}",${i},${m},${w},${P==="1"?"X":""},`}}let y=0,C=Object.entries(l);C.sort((o,i)=>o[1].sortOrder<i[1].sortOrder?-1:1);for(let{category:o,scaleFactor:i=1,maximumNumber:v=1/0,maximumValue:P=1/0}of q){let m=[];for(const e in t)t[e][o]=[];for(const[e]of C){let s=(h=l[e])==null?void 0:h.category;if((s==null?void 0:s.toLowerCase())!==(o==null?void 0:o.toLowerCase()))continue;let $=(x=l[e])==null?void 0:x.label.replaceAll('"','""');I+=`"${$}",`;let n=((S=l==null?void 0:l[e])==null?void 0:S.totalPointsOrPercent)*1;a=`${a}${n},`,m.push(n);for(const r in t){let c=(T=(A=_[r])==null?void 0:A.assignments)==null?void 0:T[e];if(c===null&&((B=l==null?void 0:l[e])==null?void 0:B.isGloballyAssigned)==="0"){t[r].csv=`${t[r].csv},`;continue}let p=n*c;p=Math.round(p*100)/100,t[r].csv=`${t[r].csv}${p},`,t[r][o].push(p)}}m.sort((e,s)=>s-e).slice(0,v);let w=m.reduce((e,s)=>e+s,0)*i,b=Math.min(w,P);y+=b,I+=`${o} Total,`,a=`${a}${b},`;for(const e in t){let s=t[e][o];s=s.sort((r,c)=>c-r).slice(0,v);let $=s.reduce((r,c)=>r+c,0)*i,n=Math.min($,P);t[e].csv=`${t[e].csv}${n},`,t[e].courseTotal+=n}}I+="Course Total",a=`${a}${y}`,f=`${I}
${a}`;for(const o in t)f=`${f}
${t[o].csv}${t[o].courseTotal}`;var u=document.createElement("a");u.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(f)),u.setAttribute("download",V),document.body.appendChild(u),u.click(),document.body.removeChild(u)},[]);return N("div",{children:N(U,{value:"Download CSV",onClick:()=>{D(R)}})})}export{Y as default};
