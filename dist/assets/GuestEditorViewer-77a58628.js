import{e as v,a6 as w,s as O,l as F,ai as N,R as y,aj as _,a7 as T,ak as J,al as $,r as o,f as j,u as K,o as U,am as S,a5 as q,a4 as B,j as x,D as G,g as H,an as Q,E as z}from"./index-a1cd8b25.js";import{u as W,a as X}from"./EditorViewer-a283a32d.js";function ae(){const s=v(w),r=v(O("doenetId")),[u,E]=F(N),h=y(_),I=y(T),L=v(J),b=y($),[f,A]=o.useState(null),P=W(),[m,l]=o.useState(null);let k=j(),t=K();const c=o.useRef({}),d=o.useRef(null);o.useEffect(()=>{const e=document.title;return(async()=>{let a=await H.get("/api/getCidForAssignment.php",{params:{doenetId:r,latestAttemptOverrides:!1,publicOnly:!0,userCanViewSourceOnly:!0}}),n;if(!a.data.success||!a.data.cid){a.data.cid?l(`Error loading activity: ${a.data.message}`):l("Error loading activity: public content with public source not found");return}else n=a.data.cid;let g;try{g=await S(n,"doenet")}catch{l("Error loading activity: activity file not found");return}let p=await Q(g,n);if(p.errors.length>0){l(`Invalid activity definition: ${p.errors[0].message}`);return}let R=p.activityJSON;A(Y(R.children)),m&&l(null),document.title=`${a.data.label} - Doenet`})().catch(console.error),()=>{document.title=e}},[r]),o.useEffect(()=>{var e,i;d.current!==t.key&&(((e=t.state)==null?void 0:e.previousScrollPosition)!==void 0&&d.current&&(c.current[d.current].lastScrollPosition=t.state.previousScrollPosition),c.current[t.key]&&((i=c.current[t.key])==null?void 0:i.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:c.current[t.key].lastScrollPosition}),c.current[t.key]={...t},d.current=t.key)},[t]);let V=U(({snapshot:e,set:i})=>async a=>{const n=await S(a,"doenet");i(q,n),i(B,n),i(w,n)},[]);if(o.useEffect(()=>(f&&V(f),()=>{I("")}),[f]),X("keydown",e=>{e.keyCode===83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),P())}),m)return x("h1",{children:m});let C=1,D="button";function M(e,i){const a=JSON.parse(JSON.stringify(e));h({index:a.index,allPossibleVariants:i}),E({index:a.index})}return s?x(G,{doenetML:s,flags:{showCorrectness:!0,readOnly:!1,solutionDisplayMode:D,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},activityId:r,idsIncludeActivityId:!1,attemptNumber:C,generatedVariantCallback:M,requestedVariantIndex:u.index,setIsInErrorState:b,location:t,navigate:k,linkSettings:{viewURL:"/public?tool=editor",editURL:"/public?tool=editor",useQueryParameters:!0}},`pageViewer${L}`):null}function Y(s){if(!s||s.length==0)return null;for(let r of s){if(r.type==="page")return r.cid;{let u=z(r.children);if(u)return u}}return null}export{ae as default};
