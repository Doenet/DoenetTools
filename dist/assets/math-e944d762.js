import{ao as fe,bl as he,r as l,bw as ge,bo as re,bt as te,j as g,bp as me,bJ as pe,a as F,F as j,bm as V}from"./index-a1cd8b25.js";import{BoardContext as ye,TEXT_LAYER_OFFSET as ne}from"./graph-36cd2399.js";import"./css-14ccef8c.js";const Me=fe.memo(function oe(ie){let{name:w,id:C,SVs:e,actions:m,sourceOfUpdate:be,callAction:p}=he(ie);oe.ignoreActionsWithoutCore=()=>!0;let r=l.useRef(null),J=l.useRef(null),X=l.useRef(null);const n=l.useContext(ye);let v=l.useRef(null),O=l.useRef(null),G=l.useRef(!1),N=l.useRef(!1),h=l.useRef(!1),y=l.useRef(null),b=l.useRef(null),H=l.useRef(null),Y=l.useRef(null),P=l.useRef(!1),A=l.useRef(!1);P.current=e.fixed,A.current=!e.draggable||e.fixLocation||e.fixed;const{darkMode:_}=l.useContext(ge)||{};l.useEffect(()=>()=>{r.current!==null&&ae(),n&&n.off("move",K)},[]),l.useEffect(()=>{n&&n.on("move",K)},[n]);function le(){let o=_==="dark"?e.selectedStyle.textColorDarkMode:e.selectedStyle.textColor,a=_==="dark"?e.selectedStyle.backgroundColorDarkMode:e.selectedStyle.backgroundColor,d="";a&&(d+=`background-color: ${a}`);let c={visible:!e.hidden,fixed:P.current,layer:10*e.layer+ne,cssStyle:d,highlightCssStyle:d,strokeColor:o,strokeOpacity:1,highlightStrokeColor:o,highlightStrokeOpacity:.5,highlight:!A.current,useMathJax:!0,parse:!1},u;try{let t=re.fromAst(e.anchor),x=[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()];Number.isFinite(x[0])||(x[0]=0,c.visible=!1),Number.isFinite(x[1])||(x[1]=0,c.visible=!1),u=n.create("point",x,{visible:!1})}catch{c.visible=!1,u=n.create("point",[0,0],{visible:!1})}c.anchor=u;let{anchorx:B,anchory:S}=te(e.positionFromAnchor);c.anchorx=B,c.anchory=S,X.current=[B,S];let f,s;e.renderMode==="inline"?(f="\\(",s="\\)"):e.renderMode==="display"?(f="\\[",s="\\]"):e.renderMode==="numbered"?(f=`\\begin{gather}\\tag{${e.equationTag}}`,s="\\end{gather}"):e.renderMode==="align"?(f="\\begin{align}",s="\\end{align}"):(f="\\(",s="\\)");let i=n.create("text",[0,0,f+e.latex+s],c);i.isDraggable=!A.current,i.on("down",function(t){v.current=[t.x,t.y],O.current=[...u.coords.scrCoords],h.current=!1,G.current=!0,N.current=!1,P.current||p({action:m.mathFocused,args:{name:w}})}),i.on("hit",function(t){O.current=[...u.coords.scrCoords],h.current=!1,p({action:m.mathFocused,args:{name:w}})}),i.on("up",function(t){h.current?(p({action:m.moveMath,args:{x:y.current,y:b.current}}),h.current=!1):!N.current&&!P.current&&p({action:m.mathClicked,args:{name:w}}),G.current=!1}),i.on("keyfocusout",function(t){h.current&&(p({action:m.moveMath,args:{x:y.current,y:b.current}}),h.current=!1)}),i.on("drag",function(t){let x=t.type==="pointermove";(!x||Math.abs(t.x-v.current[0])>.1||Math.abs(t.y-v.current[1])>.1)&&(h.current=!0);let[I,$,q,L]=n.getBoundingBox(),W=i.size[0]/n.unitX,z=i.size[1]/n.unitY,Q=X.current[0],Z=X.current[1],U=0;Q==="middle"?U=-W/2:Q==="right"&&(U=-W);let E=0;Z==="middle"?E=-z/2:Z==="top"&&(E=-z);let se=I+.04*(q-I)-U-W,ce=q-.04*(q-I)-U,ue=L+.04*($-L)-E-z,de=$-.04*($-L)-E;if(x){var ee=n.origin.scrCoords;y.current=(O.current[1]+t.x-v.current[0]-ee[1])/n.unitX,b.current=(ee[2]-(O.current[2]+t.y-v.current[1]))/n.unitY}else y.current=u.X()+i.relativeCoords.usrCoords[1],b.current=u.Y()+i.relativeCoords.usrCoords[2];y.current=Math.min(ce,Math.max(se,y.current)),b.current=Math.min(de,Math.max(ue,b.current)),p({action:m.moveMath,args:{x:y.current,y:b.current,transient:!0,skippable:!0}}),i.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),u.coords.setCoordinates(JXG.COORDS_BY_USER,H.current)}),i.on("keydown",function(t){t.key==="Enter"&&(h.current&&(p({action:m.moveMath,args:{x:y.current,y:b.current}}),h.current=!1),p({action:m.mathClicked,args:{name:w}}))}),r.current=i,J.current=u,Y.current=e.positionFromAnchor,setTimeout(()=>{r.current&&(r.current.needsUpdate=!0,r.current.setText(f+e.latex+s),r.current.update(),n.updateRenderer())},1e3)}function K(o){G.current&&(Math.abs(o.x-v.current[0])>.1||Math.abs(o.y-v.current[1])>.1)&&(N.current=!0)}function ae(){r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),n.removeObject(r.current),r.current=null}if(n){let o;try{let a=re.fromAst(e.anchor);o=[a.get_component(0).evaluate_to_constant(),a.get_component(1).evaluate_to_constant()]}catch{o=[NaN,NaN]}if(H.current=o,r.current===null)le();else{r.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),J.current.coords.setCoordinates(JXG.COORDS_BY_USER,o);let a,d;e.renderMode==="inline"?(a="\\(",d="\\)"):e.renderMode==="display"?(a="\\[",d="\\]"):e.renderMode==="numbered"?(a=`\\begin{gather}\\tag{${e.equationTag}}`,d="\\end{gather}"):e.renderMode==="align"?(a="\\begin{align}",d="\\end{align}"):(a="\\(",d="\\)"),r.current.setText(a+e.latex+d);let c=!e.hidden;if(Number.isFinite(o[0])&&Number.isFinite(o[1])){let i=r.current.visProp.visible!==c;r.current.visProp.visible=c,r.current.visPropCalc.visible=c,i&&r.current.setAttribute({visible:c})}else r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;let u=10*e.layer+ne;r.current.visProp.layer!==u&&r.current.setAttribute({layer:u});let S=_==="dark"?e.selectedStyle.textColorDarkMode:e.selectedStyle.textColor,f=_==="dark"?e.selectedStyle.backgroundColorDarkMode:e.selectedStyle.backgroundColor,s="";if(f?s+=`background-color: ${f}`:s+="background-color: transparent",r.current.visProp.strokecolor!==S&&(r.current.visProp.strokecolor=S,r.current.visProp.highlightstrokecolor=S),r.current.visProp.cssstyle!==s&&(r.current.visProp.cssstyle=s,r.current.visProp.highlightcssstyle=s),r.current.visProp.highlight=!A.current,r.current.visProp.fixed=P.current,r.current.isDraggable=!A.current,r.current.needsUpdate=!0,e.positionFromAnchor!==Y.current){let{anchorx:i,anchory:t}=te(e.positionFromAnchor);r.current.visProp.anchorx=i,r.current.visProp.anchory=t,X.current=[i,t],Y.current=e.positionFromAnchor,r.current.fullUpdate()}else r.current.update();J.current.needsUpdate=!0,J.current.update(),n.updateRenderer()}return g("a",{name:C})}if(e.hidden)return null;let k,R;if(e.renderMode==="inline"?(k="\\(",R="\\)"):e.renderMode==="display"?(k="\\[",R="\\]"):e.renderMode==="numbered"?(k=`\\begin{gather}\\tag{${e.equationTag}}`,R="\\end{gather}"):e.renderMode==="align"?(k="\\begin{align}",R="\\end{align}"):(k="\\(",R="\\)"),!e.latexWithInputChildren)return null;let M=e.latexWithInputChildren.map(o=>typeof o=="number"?this.children[o]:k+o+R),D=[g("a",{name:C},C)];e.mrowChildNames&&D.push(...e.mrowChildNames.map(o=>{let a=me(o);return g("a",{name:a,id:a},a)}));let T=pe(_,e.selectedStyle);return M.length===0?F(j,{children:[D,g("span",{id:C,style:T})]}):M.length===1?F(j,{children:[D,g("span",{id:C,style:T,children:g(V.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:M[0]})})]}):M.length===2?F(j,{children:[D,g("span",{id:C,style:T,children:F(V.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:[M[0],M[1]]})})]}):F(j,{children:[D,g("span",{id:C,style:T,children:g(V.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:M[0]})})]})});export{Me as default};
