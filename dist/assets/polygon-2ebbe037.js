import{aw as I,bn as T,r as a,j as U,F as B}from"./index-2be4b65a.js";import{BoardContext as N,LINE_LAYER_OFFSET as O,VERTEX_LAYER_OFFSET as X}from"./graph-cc72c8b4.js";import"./css-14ccef8c.js";import"./visibility-sensor-69a0b294.js";const K=I.memo(function P(J){let{name:L,id:W,SVs:e,actions:p,sourceOfUpdate:k,callAction:h}=T(J);P.ignoreActionsWithoutCore=!0;const u=a.useContext(N);let r=a.useRef(null),y=a.useRef(null),C=a.useRef(null),x=a.useRef(null),g=a.useRef(null),w=a.useRef(null),b=a.useRef(null),S=a.useRef(null),V=a.useRef(null);V.current=e.numericalVertices,a.useEffect(()=>()=>{r.current&&D()},[]);function Y(){if(!(e.nVertices>=2))return null;let l=!e.draggable||e.fixed,i=!e.verticesDraggable||e.fixed;S.current={fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),visible:!i&&!e.hidden,withLabel:!1,layer:10*e.layer+X,highlight:!0};let n={highlight:!1,visible:!e.hidden,layer:10*e.layer+O,fixed:!0,strokeColor:e.selectedStyle.lineColor,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:e.selectedStyle.lineColor,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:_(e.selectedStyle.lineStyle)};const s=e.filled?e.selectedStyle.fillColor.toLowerCase():"none";let c={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:l,layer:10*e.layer+O,fillColor:s,fillOpacity:e.selectedStyle.fillOpacity,highlightFillColor:s,highlightFillOpacity:e.selectedStyle.fillOpacity*.5,highlight:!l,vertices:S.current,borders:n};c.label={highlight:!1},e.labelHasLatex&&(c.label.useMathJax=!0),e.applyStyleToLabel?c.label.strokeColor=e.selectedStyle.lineColor:c.label.strokeColor="#000000",e.filled&&(c.hasInnerPoints=!0),u.suspendUpdate();let v=[];for(let f of e.numericalVertices)v.push(u.create("point",[...f],S.current));let d=u.create("polygon",v,c);return R(d),d.on("drag",f=>E(-1,f)),d.on("up",f=>A(-1)),d.on("down",function(f){C.current=null,g.current=[f.x,f.y],w.current=d.vertices.map(m=>[...m.coords.scrCoords]),x.current===null&&h({action:p.mouseDownOnPolygon})}),u.unsuspendUpdate(),b.current=e.nVertices,d}function R(l){for(let i=0;i<e.nVertices;i++){let n=l.vertices[i];n.off("drag"),n.on("drag",s=>E(i,s)),n.off("up"),n.on("up",()=>A(i)),n.off("down"),n.on("down",s=>{C.current=null,g.current=[s.x,s.y],x.current=i,h({action:p.mouseDownOnPolygon})})}}function D(){for(let l=0;l<e.nVertices;l++){let i=r.current.vertices[l];i&&(i.off("drag"),i.off("up"),i.off("down"))}r.current.off("drag"),r.current.off("up"),r.current.off("down"),r.current.off("hit"),u.removeObject(r.current),r.current=null}function E(l,i){if(Math.abs(i.x-g.current[0])>.1||Math.abs(i.y-g.current[1])>.1)if(C.current=l,l===-1){y.current=j(i),h({action:p.movePolygon,args:{pointCoords:y.current,transient:!0,skippable:!0}});for(let n=0;n<e.nVertices;n++)r.current.vertices[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...V.current[n]])}else y.current={},y.current[l]=[r.current.vertices[l].X(),r.current.vertices[l].Y()],h({action:p.movePolygon,args:{pointCoords:y.current,transient:!0,skippable:!0,sourceDetails:{vertex:l}}}),r.current.vertices[l].coords.setCoordinates(JXG.COORDS_BY_USER,[...V.current[l]]),u.updateInfobox(r.current.vertices[l])}function A(l){C.current===l?h(l===-1?{action:p.movePolygon,args:{pointCoords:y.current}}:{action:p.movePolygon,args:{pointCoords:y.current,sourceDetails:{vertex:l}}}):C.current===null&&(x.current===null||l!==-1)&&h({action:p.polygonClicked}),l!==-1&&(x.current=null)}function j(l){var i=u.origin.scrCoords;let n=[];for(let s=0;s<r.current.vertices.length-1;s++){let c=(w.current[s][1]+l.x-g.current[0]-i[1])/u.unitX,v=(i[2]-(w.current[s][2]+l.y-g.current[1]))/u.unitY;n.push([c,v])}return n}if(u)if(!r.current)r.current=Y();else if(!(e.nVertices>=2))D();else{let l=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(l=!1),Number.isFinite(t[1])||(l=!1);if(e.nVertices>b.current){for(let t=b.current;t<e.nVertices;t++){let o=u.create("point",[...e.numericalVertices[t]],S.current);r.current.addPoints(o)}R(r.current)}else if(e.nVertices<b.current){for(let t=b.current-1;t>=e.nVertices;t--)r.current.vertices[t].off("drag"),r.current.vertices[t].off("down"),r.current.vertices[t].off("up"),r.current.removePoints(r.current.vertices[t]);R(r.current)}let i=!e.draggable||e.fixed,s=!(!e.verticesDraggable||e.fixed)&&!e.hidden;for(let t=0;t<e.nVertices;t++)r.current.vertices[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[t]]),r.current.vertices[t].needsUpdate=!0,r.current.vertices[t].update(),r.current.vertices[t].visProp.visible=s,r.current.vertices[t].visPropCalc.visible=s;if(k.sourceInformation&&L in k.sourceInformation){let t=k.sourceInformation[L].vertex;t!==void 0&&u.updateInfobox(r.current.vertices[t])}let c=!e.hidden;l||(c=!1),r.current.visProp.fixed=i,r.current.visProp.highlight=!i,r.current.visProp.visible=c,r.current.visPropCalc.visible=c;let v=10*e.layer+O,d=r.current.visProp.layer!==v,f,m;d&&(f=10*e.layer+O,m=10*e.layer+X,r.current.setAttribute({layer:v})),r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=e.selectedStyle.lineColor:r.current.label.visProp.strokecolor="#000000",r.current.label.needsUpdate=!0,r.current.label.update());const F=e.filled?e.selectedStyle.fillColor.toLowerCase():"none";r.current.visProp.fillcolor!==F&&(r.current.visProp.fillcolor=F,r.current.visProp.highlightfillcolor=F,r.current.visProp.hasinnerpoints=e.filled),r.current.visProp.fillopacity!==e.selectedStyle.fillOpacity&&(r.current.visProp.fillopacity=e.selectedStyle.fillOpacity,r.current.visProp.highlightfillopacity=e.selectedStyle.fillOpacity*.5),r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let t=0;t<r.current.borders.length;t++){let o=r.current.borders[t];o.visProp.visible=c,o.visPropCalc.visible=c,d&&o.setAttribute({layer:f}),o.visProp.strokecolor!==e.selectedStyle.lineColor&&(o.visProp.strokecolor=e.selectedStyle.lineColor,o.visProp.highlightstrokecolor=e.selectedStyle.lineColor),o.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(o.visProp.strokeopacity=e.selectedStyle.lineOpacity,o.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let G=_(e.selectedStyle.lineStyle);o.visProp.dash!==G&&(o.visProp.dash=G),o.visProp.strokewidth!==e.selectedStyle.lineWidth&&(o.visProp.strokewidth=e.selectedStyle.lineWidth,o.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),o.needsUpdate=!0,o.update()}if(d){S.current.layer=m;for(let t of r.current.vertices)t.setAttribute({layer:m}),t.needsUpdate=!0,t.update()}b.current=e.nVertices,u.updateRenderer()}return e.hidden?null:U(B,{children:U("a",{name:W})})});function _(P){return P==="solid"?0:P==="dashed"?2:P==="dotted"?1:0}export{K as default};
