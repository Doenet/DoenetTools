import{ao as N,bl as I,r as o,bw as V,j as k,F as A,bJ as q,a as z,bm as K}from"./index-a1cd8b25.js";import{BoardContext as Q,LINE_LAYER_OFFSET as W}from"./graph-36cd2399.js";import"./css-14ccef8c.js";const te=N.memo(function v(x){var E;let{name:y,id:R,SVs:e,actions:s,callAction:c}=I(x);v.ignoreActionsWithoutCore=()=>!0;const a=o.useContext(Q);let t=o.useRef({}),g=o.useRef(null),S=o.useRef(null),w=o.useRef(!1),L=o.useRef(!1),p=o.useRef(!1),O=o.useRef(null),J=o.useRef(null),u=o.useRef(null),D=o.useRef(null),P=o.useRef(!1),m=o.useRef(!1),F=o.useRef(!1);D.current=e.numericalPoints,P.current=e.fixed,m.current=!e.draggable||e.fixLocation||e.fixed,F.current=e.switchable&&!e.fixed;const{darkMode:G}=o.useContext(V)||{};o.useEffect(()=>()=>{Object.keys(t.current).length!==0&&X(),a&&a.off("move",M)},[]),o.useEffect(()=>{a&&a.on("move",M)},[a]);function j(){var C;if(((C=e.numericalPoints)==null?void 0:C.length)!==2||e.numericalPoints.some(r=>r.length!==2)){t.current={};return}let f=e.labelForGraph!=="",b=G==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var d={name:e.labelForGraph,visible:!e.hidden,withlabel:f,fixed:P.current,layer:10*e.layer+W,strokeColor:b,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:b,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:Y(e.selectedStyle.lineStyle,e.dashed),highlight:!m.current};if(f){let r,n,l;e.labelPosition==="upperright"?(l=[5,5],r="left",n="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],r="right",n="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],r="left",n="top"):(l=[-5,-5],r="right",n="top"),d.label={offset:l,anchorx:r,anchory:n,position:"top",highlight:!1},e.labelHasLatex&&(d.label.useMathJax=!0),e.applyStyleToLabel?d.label.strokeColor=b:d.label.strokeColor="var(--canvastext)"}else d.label={highlight:!1},e.labelHasLatex&&(d.label.useMathJax=!0);let _=[[...e.numericalPoints[0]],[...e.numericalPoints[1]]],i=a.create("line",_,d);i.isDraggable=!m.current,i.on("drag",function(r){let n=r.type==="pointermove";if((!n||Math.abs(r.x-g.current[0])>.1||Math.abs(r.y-g.current[1])>.1)&&(p.current=!0),u.current=[],n){var l=a.origin.scrCoords;for(let h=0;h<2;h++){let T=(S.current[h][1]+r.x-g.current[0]-l[1])/a.unitX,H=(l[2]-(S.current[h][2]+r.y-g.current[1]))/a.unitY;u.current.push([T,H])}}else u.current.push([i.point1.X(),i.point1.Y()]),u.current.push([i.point2.X(),i.point2.Y()]);c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1],transient:!0,skippable:!0}}),i.point1.coords.setCoordinates(JXG.COORDS_BY_USER,D.current[0]),i.point2.coords.setCoordinates(JXG.COORDS_BY_USER,D.current[1])}),i.on("up",function(r){p.current?c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}):!L.current&&!P.current&&(F.current?(c({action:s.switchLine}),c({action:s.lineClicked,args:{name:y}})):c({action:s.lineClicked,args:{name:y}})),w.current=!1}),i.on("keyfocusout",function(r){p.current&&(c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}),p.current=!1)}),i.on("down",function(r){p.current=!1,g.current=[r.x,r.y],S.current=[[...i.point1.coords.scrCoords],[...i.point2.coords.scrCoords]],w.current=!0,L.current=!1,P.current||c({action:s.lineFocused,args:{name:y}})}),i.on("hit",function(r){p.current=!1,S.current=[[...i.point1.coords.scrCoords],[...i.point2.coords.scrCoords]],c({action:s.lineFocused,args:{name:y}})}),i.on("keydown",function(r){r.key==="Enter"&&(p.current&&(c({action:s.moveLine,args:{point1coords:u.current[0],point2coords:u.current[1]}}),p.current=!1),F.current?(c({action:s.switchLine}),c({action:s.lineClicked,args:{name:y}})):c({action:s.lineClicked,args:{name:y}}))}),O.current=e.labelForGraph!=="",t.current=i}function M(f){w.current&&(Math.abs(f.x-g.current[0])>.1||Math.abs(f.y-g.current[1])>.1)&&(L.current=!0)}function X(){t.current.off("drag"),t.current.off("down"),t.current.off("hit"),t.current.off("up"),t.current.off("keyfocusout"),t.current.off("keydown"),a.removeObject(t.current),t.current={}}if(a){if(Object.keys(t.current).length===0)j();else if(((E=e.numericalPoints)==null?void 0:E.length)!==2||e.numericalPoints.some(f=>f.length!==2))X();else{let f=!0;for(let n of[e.numericalPoints[0],e.numericalPoints[1]])Number.isFinite(n[0])||(f=!1),Number.isFinite(n[1])||(f=!1);t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[1]);let b=!e.hidden;if(f){let n=t.current.visProp.visible!==b;t.current.visProp.visible=b,t.current.visPropCalc.visible=b,n&&t.current.setAttribute({visible:b})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;t.current.visProp.fixed=P.current,t.current.visProp.highlight=!m.current,t.current.isDraggable=!m.current;let d=10*e.layer+W;t.current.visProp.layer!==d&&t.current.setAttribute({layer:d});let i=G==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;t.current.visProp.strokecolor!==i&&(t.current.visProp.strokecolor=i,t.current.visProp.highlightstrokecolor=i),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let C=Y(e.selectedStyle.lineStyle,e.dashed);t.current.visProp.dash!==C&&(t.current.visProp.dash=C),t.current.name=e.labelForGraph;let r=e.labelForGraph!=="";if(r!=O.current&&(t.current.setAttribute({withlabel:r}),O.current=r),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel)if(t.current.label.needsUpdate=!0,e.applyStyleToLabel?t.current.label.visProp.strokecolor=i:t.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==J.current){let n,l,h;e.labelPosition==="upperright"?(h=[5,5],n="left",l="bottom"):e.labelPosition==="upperleft"?(h=[-5,5],n="right",l="bottom"):e.labelPosition==="lowerright"?(h=[5,-5],n="left",l="top"):(h=[-5,-5],n="right",l="top"),t.current.label.visProp.anchorx=n,t.current.label.visProp.anchory=l,t.current.label.visProp.offset=h,J.current=e.labelPosition,t.current.label.fullUpdate()}else t.current.label.update();a.updateRenderer()}return k(A,{children:k("a",{name:R})})}if(e.hidden)return null;let U="\\("+e.latex+"\\)",B=q(G,e.selectedStyle);return z(A,{children:[k("a",{name:R}),k("span",{id:R,style:B,children:k(K.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:U})})]})});function Y(v,x){return v==="dashed"||x?2:v==="solid"?0:v==="dotted"?1:0}export{te as default};
