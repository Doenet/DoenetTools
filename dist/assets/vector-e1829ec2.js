import{av as Z,bn as $,r as o,l as ee,bs as te,j as V,F as W,a as re,b9 as ne}from"./index-61b6fc23.js";import{BoardContext as oe,LINE_LAYER_OFFSET as B,VERTEX_LAYER_OFFSET as T}from"./graph-1ff63df5.js";import"./css-14ccef8c.js";import"./visibility-sensor-398e690f.js";const se=Z.memo(function O(z){let{name:_,id:A,SVs:e,actions:d,sourceOfUpdate:L,callAction:f}=$(z);O.ignoreActionsWithoutCore=!0;const n=o.useContext(oe);let t=o.useRef({}),l=o.useRef({}),i=o.useRef({}),x=o.useRef(!1),j=o.useRef(!1),a=o.useRef(!1),c=o.useRef(!1),D=o.useRef(null),w=o.useRef(null),R=o.useRef(null),U=o.useRef(!1),J=o.useRef(null);J.current=e.numericalEndpoints;const Y=ee(te);o.useEffect(()=>()=>{Object.keys(t.current).length!==0&&I()},[]);function H(){if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(r=>r.length!==2)){t.current={},l.current={},i.current={};return}let p=10*e.layer+B,h=10*e.layer+T,v=!e.draggable||e.fixed,m=Y==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;m=m.toLowerCase();var u={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:v,layer:p,strokeColor:m,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:m,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:N(e.selectedStyle.lineStyle),highlight:!v,lastArrow:{type:1,size:3,highlightSize:3}};let G=[[...e.numericalEndpoints[0]],[...e.numericalEndpoints[1]]],S=Object.assign({},u);Object.assign(S,{withLabel:!1,fixed:!1,highlight:!0,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:h});let E=Object.assign({},S),C=e.tailDraggable&&!e.fixed&&!e.hidden;E.visible=C;let g=n.create("point",G[0],E),k=Object.assign({},S),Q=e.headDraggable&&!e.fixed&&!e.hidden;k.visible=Q;let P=n.create("point",G[1],k);u.label={highlight:!1},e.labelHasLatex&&(u.label.useMathJax=!0),e.applyStyleToLabel?u.label.strokeColor=m:u.label.strokeColor="var(--canvastext)";let s=n.create("arrow",[g,P],u);g.on("drag",r=>F(r,0)),P.on("drag",r=>F(r,1)),s.on("drag",r=>F(r,-1)),g.on("up",r=>{!a.current&&c.current?f({action:d.moveVector,args:{tailcoords:R.current}}):!a.current&&!c.current&&f({action:d.vectorClicked}),D.current=null}),P.on("up",r=>{a.current&&!c.current?f({action:d.moveVector,args:{headcoords:w.current}}):!a.current&&!c.current&&f({action:d.vectorClicked}),D.current=null}),s.on("up",r=>{a.current&&c.current?f({action:d.moveVector,args:{headcoords:w.current,tailcoords:R.current}}):!a.current&&!c.current&&D.current===null&&f({action:d.vectorClicked})}),g.on("down",function(r){a.current=!1,c.current=!1,x.current=[r.x,r.y],D.current=1,f({action:d.mouseDownOnVector})}),P.on("down",function(r){a.current=!1,c.current=!1,x.current=[r.x,r.y],D.current=2,f({action:d.mouseDownOnVector})}),s.on("down",function(r){a.current=!1,c.current=!1,x.current=[r.x,r.y],j.current=[[...s.point1.coords.scrCoords],[...s.point2.coords.scrCoords]],f({action:d.mouseDownOnVector})});function F(r,y){if(Math.abs(r.x-x.current[0])>.1||Math.abs(r.y-x.current[1])>.1){y===0?c.current=!0:y===1?a.current=!0:(a.current=!0,c.current=!0);let X={transient:!0,skippable:!0};a.current&&(y===-1?w.current=M(r,1):w.current=[s.point2.X(),s.point2.Y()],X.headcoords=w.current),c.current&&(y===-1?R.current=M(r,0):R.current=[s.point1.X(),s.point1.Y()],X.tailcoords=R.current),(y===0||y===1)&&(X.sourceDetails={vertex:y}),f({action:d.moveVector,args:X}),s.point1.coords.setCoordinates(JXG.COORDS_BY_USER,J.current[0]),s.point2.coords.setCoordinates(JXG.COORDS_BY_USER,J.current[1]),y===0?n.updateInfobox(g):y===1&&n.updateInfobox(P)}}t.current=s,l.current=g,i.current=P}function I(){t.current.off("drag"),t.current.off("down"),t.current.off("up"),n.removeObject(t.current),t.current={},l.current.off("drag"),l.current.off("down"),l.current.off("up"),n.removeObject(l.current),l.current={},i.current.off("drag"),i.current.off("down"),i.current.off("up"),n.removeObject(i.current),i.current={}}function M(p,h){var v=n.origin.scrCoords;let m=(j.current[h][1]+p.x-x.current[0]-v[1])/n.unitX,u=(v[2]-(j.current[h][2]+p.y-x.current[1]))/n.unitY;return[m,u]}if(n){if(Object.keys(t.current).length===0)H();else if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(p=>p.length!==2))I();else{let p=!0;for(let b of[e.numericalEndpoints[0],e.numericalEndpoints[1]])Number.isFinite(b[0])||(p=!1),Number.isFinite(b[1])||(p=!1);t.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[0]),t.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[1]);let h=!e.hidden&&p,v=!e.draggable||e.fixed,u=e.tailDraggable&&!e.fixed&&h,S=e.headDraggable&&!e.fixed&&h;if(t.current.visProp.fixed=v,t.current.visProp.highlight=!v,t.current.visProp.visible=h,t.current.visPropCalc.visible=h,l.current.visProp.visible=u,l.current.visPropCalc.visible=u,i.current.visProp.visible=S,i.current.visPropCalc.visible=S,L.sourceInformation&&_ in L.sourceInformation){let b=L.sourceInformation[_];b.vertex===0?n.updateInfobox(l.current):b.vertex===1&&n.updateInfobox(i.current)}let E=10*e.layer+B;if(t.current.visProp.layer!==E){let b=10*e.layer+T;t.current.setAttribute({layer:E}),l.current.setAttribute({layer:b}),i.current.setAttribute({layer:b})}let C=Y==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;C=C.toLowerCase(),t.current.visProp.strokecolor!==C&&(t.current.visProp.strokecolor=C,t.current.visProp.highlightstrokecolor=C),t.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(t.current.visProp.strokewidth=e.selectedStyle.lineWidth,t.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),t.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(t.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,t.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let g=N(e.selectedStyle.lineStyle);t.current.visProp.dash!==g&&(t.current.visProp.dash=g),t.current.name=e.labelForGraph;let k=e.showLabel&&e.labelForGraph!=="";k!=U.current&&(t.current.setAttribute({withlabel:k}),U.current=k),t.current.needsUpdate=!0,t.current.update(),t.current.hasLabel&&(e.applyStyleToLabel?t.current.label.visProp.strokecolor=C:t.current.label.visProp.strokecolor="var(--canvastext)",t.current.label.needsUpdate=!0,t.current.label.update()),l.current.needsUpdate=!0,l.current.update(),i.current.needsUpdate=!0,i.current.update(),n.updateRenderer()}return V(W,{children:V("a",{name:A})})}if(e.hidden)return null;let q="\\("+e.latex+"\\)";return re(W,{children:[V("a",{name:A}),V("span",{id:A,children:V(ne.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:q})})]})});function N(O){return O==="solid"?0:O==="dashed"?2:O==="dotted"?1:0}export{se as default};
