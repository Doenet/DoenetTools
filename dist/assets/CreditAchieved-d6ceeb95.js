import{e as i,s as p,u as E,f as U,r as F,o as z,g as k,j as t,a as r,h as _,v as J,l as V,R as W,B as R,w as X,_ as q}from"./index-a1cd8b25.js";import{currentAttemptNumber as H,activityStatusAtom as K,creditAchievedAtom as O}from"./AssignmentViewer-5a072986.js";import{e as Q}from"./RoleDropdown-6cbb7a86.js";import{T as Y}from"./Textfield-07b7a0c1.js";import{overviewData as Z}from"./Gradebook-b70ece1a.js";import"./DropdownMenu-3b5a6419.js";const ee=_.div`
  border-bottom: 2px solid var(--canvastext);
  height: 2px;
  width: 230px;
`,u=_.div`
  position: absolute;
  right: 0px;
  top: 0px;
`,m=_.div`
  position: relative;
  background: ${e=>e.highlight?"var(--mainGray)":"var(--canvas)"};
  cursor: ${e=>e.isLink?"pointer":"auto"};
`;function te({score:e}){const b=J();let C=i(p("courseId")),h=i(p("doenetId")),o=i(p("userId")),{canViewAndModifyGrades:N}=i(Q(C));const[v,f]=V(O),[w,y]=F.useState(!1),[n,S]=F.useState(e),c=W(Z);return w?r("div",{style:{display:"flex",flexDirection:"column",rowGap:"4px"},children:[t("div",{children:"Final Score:"}),t(Y,{width:"menu",value:n,onChange:d=>{S(d.target.value)}}),t(R,{value:"Update",onClick:async()=>{if(isNaN(n)||n=="")b("Final Score needs to be a number.",X.ERROR);else{const{data:d}=await k.get("/api/saveActivityOverrideGrades.php",{params:{score:n,doenetId:h,userId:o}});let x=Number(n)/(v==null?void 0:v.totalPointsOrPercent);d.success&&(y(!1),f(I=>{let P={...I};return P.creditForAssignment=x,P}),c({doenetId:h,userId:o,credit:`${x}`}))}}})]}):N==1?r(m,{children:[r(q,{children:["Final Score ",t(R,{value:"Edit",onClick:()=>y(!0)}),":"," ",t(u,{"data-test":"Final Score",children:e})]})," "]}):r(m,{children:["Final Score: ",t(u,{"data-test":"Final Score",children:e})]})}function ce(){const e=i(H),b=i(p("doenetId")),C=i(p("userId")),h=i(p("tool")),o=i(K);let{search:N}=E(),v=U();const f=F.useRef(null);let[w,y]=F.useState(!1);const{creditByItem:n,creditForAttempt:S,creditForAssignment:c,totalPointsOrPercent:d}=i(O),x=z(({set:l})=>async(s,g,M,B)=>{const{data:a}=await k.get("/api/loadAssessmentCreditAchieved.php",{params:{attemptNumber:s,doenetId:g,userId:M,tool:B}});if(a.success){const T=a.creditByItem.map(Number),$=Number(a.creditForAssignment),D=Number(a.creditForAttempt);Number(a.creditOverride_for_assignment);const G=a.showCorrectness==="1",L=Number(a.totalPointsOrPercent);!G&&B.substring(0,9)!=="gradebook"?y(!0):l(O,j=>{let A={...j};return A.creditByItem=T,A.creditForAssignment=$,A.creditForAttempt=D,A.totalPointsOrPercent=L,A}),f.current=s}},[]);if(!n||!e||!b||!h)return null;if(o.activityAttemptNumberSetUp!==e)return f.current=o.activityAttemptNumberSetUp,null;if(f.current!==e)return x(e,b,C,h),null;if(w)return t("div",{style:{fontSize:"20px",textAlign:"center"},children:"Not Shown"});let I=0;c&&(I=Math.round(c*d*100)/100);let P=n.map((l,s)=>{let g;return o.itemWeights[s]===0?g=l===0?"Not started":l===1?"Complete":"In progress":g=(l?Math.round(l*1e3)/10:0)+"%",r(m,{highlight:o.currentPage===s+1,onClick:()=>v(N+`#page${s+1}`),isLink:!0,children:["Item ",s+1,":"," ",t(u,{"data-test":`Item ${s+1} Credit`,children:g})]},`creditByItem${s}`)});return r("div",{children:[r(m,{children:["Possible Points:"," ",t(u,{"data-test":"Possible Points",children:d})]}),t(te,{score:I}),t(ee,{}),t("b",{children:"Credit For:"}),r(m,{"data-test":"Attempt Container",children:["Attempt ",e,":"," ",r(u,{"data-test":"Attempt Percent",children:[S?Math.round(S*1e3)/10:0,"%"]})]}),t("div",{style:{marginLeft:"15px"},children:P}),r(m,{children:["Assignment:"," ",r(u,{"data-test":"Assignment Percent",children:[c?Math.round(c*1e3)/10:0,"%"]})]})]})}export{ce as default};
