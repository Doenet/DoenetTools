import{r as a,z as K,k as U,A as D,j as e,a as R,B as L,D as M}from"./index-1922ac75.js";import{T as $}from"./Textfield-38f593f0.js";var N={},V={get exports(){return N},set exports(m){N=m}};/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */(function(m,h){(function(v){var u;if(m.exports=v(),u=!0,!u){var I=window.Cookies,n=window.Cookies=v();n.noConflict=function(){return window.Cookies=I,n}}})(function(){function v(){for(var n=0,l={};n<arguments.length;n++){var o=arguments[n];for(var d in o)l[d]=o[d]}return l}function u(n){return n.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function I(n){function l(){}function o(i,c,t){if(!(typeof document>"u")){t=v({path:"/"},l.defaults,t),typeof t.expires=="number"&&(t.expires=new Date(new Date*1+t.expires*864e5)),t.expires=t.expires?t.expires.toUTCString():"";try{var y=JSON.stringify(c);/^[\{\[]/.test(y)&&(c=y)}catch{}c=n.write?n.write(c,i):encodeURIComponent(String(c)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),i=encodeURIComponent(String(i)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var g="";for(var p in t)t[p]&&(g+="; "+p,t[p]!==!0&&(g+="="+t[p].split(";")[0]));return document.cookie=i+"="+c+g}}function d(i,c){if(!(typeof document>"u")){for(var t={},y=document.cookie?document.cookie.split("; "):[],g=0;g<y.length;g++){var p=y[g].split("="),f=p.slice(1).join("=");!c&&f.charAt(0)==='"'&&(f=f.slice(1,-1));try{var C=u(p[0]);if(f=(n.read||n)(f,C)||u(f),c)try{f=JSON.parse(f)}catch{}if(t[C]=f,i===C)break}catch{}}return i?t[i]:t}}return l.set=o,l.get=function(i){return d(i,!1)},l.getJSON=function(i){return d(i,!0)},l.remove=function(i,c){o(i,"",v(c,{expires:-1}))},l.defaults={},l.withConverter=I,l}return I(function(){})})})(V);const W=N;function G(m){let[h,v]=a.useState(""),[u,I]=a.useState(""),[n,l]=a.useState(0),[o,d]=a.useState("beginning"),[i,c]=a.useState(!1),[t,y]=a.useState(""),[g,p]=a.useState(!1),[f,C]=a.useState(!1),[S,P]=a.useState(!1),[w,j]=a.useState(!1),[_,b]=a.useState(!0),[z,B]=a.useState(!0);const F=W.get(),T=a.useRef(null),O=a.useRef(null),A=K();function J(s){/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(s)?(b(!1),P(!0),p(!1)):(b(!0),P(!1),p(!0))}if(a.useEffect(()=>{/\d{9}/.test(u)?(B(!1),j(!0),C(!1)):u===""?(B(!0),j(!1),C(!1)):(B(!0),j(!1),C(!0)),O.current!==null&&!w?O.current.focus():T.current!==null&&!S&&T.current.focus()}),Object.keys(F).includes("JWT_JS"))return U.get("/api/loadProfile.php",{params:{}}).then(s=>{s.data.success==="1"&&(localStorage.setItem("Profile",JSON.stringify(s.data.profile)),location.href="/#/course")}).catch(s=>{console.log(s)}),null;if(o==="check code"){const r={params:{emailaddress:h,nineCode:u,deviceName:t}};return U.get("/api/checkCredentials.php",r).then(x=>{if(x.data.success){let k="1";x.data.existed&&(k="0");let E="0";n>0&&(E="1"),location.href=`/api/jwt.php?emailaddress=${encodeURIComponent(h)}&nineCode=${encodeURIComponent(u)}&deviceName=${t}&newAccount=${k}&stay=${E}`}else x.data.reason==="Code expired"?d("Code expired"):x.data.reason==="Invalid Code"&&(d("enter code"),A("Invalid code. Please try again.",D.ERROR))}).catch(x=>{console.error(x)}),d("Loading"),null}if(o==="Loading")return e("div",{children:e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:e("h2",{style:{textAlign:"center"},children:"Signing in..."})})});if(o==="Code expired")return R("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:[e("h2",{style:{textAlign:"center"},children:"Code Expired"}),e(L,{onClick:()=>{location.href="/#/signin"},value:"Restart Signin"})]});if(o==="enter code"||o==="Invalid Code"){if(!i){const r="/api/sendSignInEmail.php",k={params:{emailaddress:h}};U.get(r,k).then(E=>{y(E.data.deviceName)}).catch(E=>{this.setState({error:E})}),c(!0)}let s=e("h2",{style:{textAlign:"center"},children:"Email Sent!"});return o==="Invalid Code"&&(s=e("h2",{style:{textAlign:"center"},children:"Invalid Code. Try again."})),e("div",{style:m.style,children:R("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",margin:"20"},children:[s,R("div",{style:{weight:"bold",fontSize:"14px"},children:["Device Name: ",t]}),e("div",{children:e("p",{style:{fontSize:"14px"},children:"Check your email for a code to complete sign in."})}),e("p",{children:e($,{label:"Code (9 digit code):",ref:O,value:u,dataTest:"signinCodeInput",alert:f,onKeyDown:r=>{r.key==="Enter"&&w?d("check code"):r.key==="Enter"&&!w&&A("Invalid code format. Please enter 9 digits.",D.ERROR)},onBlur:()=>{!w&&!f&&A("Invalid code format. Please enter 9 digits.",D.ERROR)},onChange:r=>{I(r.target.value)}})}),e(L,{disabled:z,onClick:()=>{w&&d("check code")},dataTest:"signInButton",value:"Sign In"})]})})}if(o==="beginning"){let s=0;return n>0&&(s=1),e("div",{style:m.style,children:R("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",margin:"20"},children:[e("img",{style:{width:"250px",height:"250px"},alt:"Doenet Logo",src:"/media/Doenet_Logo_Frontpage.png"}),R("div",{children:[e("p",{style:{marginLeft:"2px"},children:e($,{dataTest:"email input",label:"Email Address:",ref:T,value:h,alert:g,onKeyDown:r=>{J(h),r.key==="Enter"&&S?d("enter code"):r.key==="Enter"&&!S&&A("Invalid email. Please try again.",D.ERROR)},onBlur:()=>{J(h),!S&&!g&&A("Invalid email. Please try again.",D.ERROR)},onChange:r=>{v(r.target.value)}})}),R("p",{style:{fontSize:"14px"},children:[e(M,{checked:s,onClick:r=>{l(s?0:24e4)}})," ","Stay Logged In"]}),e(L,{disabled:_,onClick:()=>{S&&d("enter code")},dataTest:"sendEmailButton",value:"Send Email"})]})]})})}return e("div",{style:m.style,children:e("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",margin:"20"},children:e("h2",{style:{textAlign:"center"},children:"Loading..."})})})}export{G as default};
