import{r,l as a,m as y,x as Q,g as W,h as X,R as w,f as Y,H as P,G as Z,c as ee,ac as te,u as ne,S as oe,T as ae,w as M,k as se,j as A,P as re}from"./index-e32334a0.js";import{v as b,e as v,r as V,a as h,u as ie,t as D}from"./EditorViewerRecoil-3acd5a83.js";function le(u,i,t=window){const l=r.useRef(i);r.useEffect(()=>{l.current=i},[i]),r.useEffect(()=>{if(t==null)return;const n=c=>l.current(c);return t.addEventListener(u,n),()=>t.removeEventListener(u,n)},[u,t])}const C=()=>M(({snapshot:i,set:t})=>async()=>{const l=await i.getPromise(D),n=await i.getPromise(h);t(b,l),n&&t(V,c=>c+1)});function ue(){const u=a(b),i=a(y("pageId")),t=a(y("linkPageId")),l=a(y("doenetId"));let n=i,c=l;t&&(n=t,c=t);const k=a(Q),R=a(v),[j,F]=W(X),N=w(Y),O=w(v),$=a(V),B=w(h),x=a(P(n)),d=a(P(l)),L=w(Z),{canUpload:K}=a(ee),z=C(),G=w(te);let o=ne();const p=r.useRef({}),I=r.useRef(null);oe(c),ae(k);let E=!1,g=null;Object.keys(x).length>0&&(E=!0,d!=null&&d.isSinglePage&&!t?g=d==null?void 0:d.label:g=x.label),r.useEffect(()=>{const e=document.title;return g&&(document.title=`${g} - Doenet`),()=>{document.title=e}},[g]);let H=M(({snapshot:e,set:s})=>async f=>{let{data:S}=await se.get(`/media/byPageId/${f}.doenet`);S=S.toString();let _=await e.getPromise(P(f)),q=await e.getPromise(P(_.containingDoenetId));s(ie,S),s(D,S),s(b,S),s(v,f);let m=[];q.type=="bank"&&m.push("AssignmentSettingsMenu"),_.type=="pageLink"&&(m.push("AssignmentSettingsMenu"),m.push("PageLink"),m.push("SupportingFilesMenu")),K!=="1"&&m.push("SupportingFilesMenu"),L(m)},[L]);if(r.useEffect(()=>(n!==""&&E&&H(n),()=>{O("")}),[n,E]),le("keydown",e=>{(e.keyCode===83&&e.metaKey||e.keyCode===83&&e.ctrlKey)&&(e.preventDefault(),z())}),r.useEffect(()=>{var e,s;I.current!==o.key&&(((e=o.state)==null?void 0:e.previousScrollPosition)!==void 0&&I.current&&(p.current[I.current].lastScrollPosition=o.state.previousScrollPosition),p.current[o.key]&&((s=p.current[o.key])==null?void 0:s.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:p.current[o.key].lastScrollPosition}),p.current[o.key]={...o},I.current=o.key)},[o]),r.useEffect(()=>{const e=document.getElementById("mainPanel");G(e)},[]),k==="__not_found__")return A("h1",{children:"Content not found or no permission to view content"});if(n!==R)return null;let J=1,T="button";function U(e,s){const f=JSON.parse(JSON.stringify(e));N({index:f.index,allPossibleVariants:s}),F({index:f.index})}return A(re,{doenetML:u,flags:{showCorrectness:!0,solutionDisplayMode:T,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},doenetId:l,attemptNumber:J,generatedVariantCallback:U,requestedVariantIndex:j.index,setIsInErrorState:B,pageIsActive:!0},`pageViewer${$}`)}const fe=Object.freeze(Object.defineProperty({__proto__:null,default:ue,useUpdateViewer:C},Symbol.toStringTag,{value:"Module"}));export{fe as E,le as a,C as u};
