import{av as D,bn as _,r as n,l as T,bs as A,j as O,F as X}from"./index-c4368a4c.js";import{BoardContext as J,LINE_LAYER_OFFSET as x}from"./graph-1607d76e.js";import"./css-14ccef8c.js";import"./visibility-sensor-b5fe0a55.js";const N=D.memo(function u(E){let{name:W,id:F,SVs:e,actions:p,sourceOfUpdate:M,callAction:f}=_(E);u.ignoreActionsWithoutCore=!0;const c=n.useContext(J);let r=n.useRef(null),d=n.useRef(!1),g=n.useRef(!1),b=n.useRef(!1),v=n.useRef(!1),h=n.useRef(null),m=n.useRef(null),S=n.useRef(null);m.current=e.numericalEndpoint,S.current=e.numericalThroughpoint;const R=T(A);n.useEffect(()=>()=>{Object.keys(r.current).length!==0&&k()},[]);function G(){if(e.numericalEndpoint.length!==2||e.numericalThroughpoint.length!==2){r.current=null;return}let i=!e.draggable||e.fixed,l=R==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;l=l.toLowerCase();var o={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",layer:10*e.layer+x,fixed:i,strokeColor:l,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:l,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:w(e.selectedStyle.lineStyle),highlight:!i,straightFirst:!1};o.label={highlight:!1},e.labelHasLatex&&(o.label.useMathJax=!0),e.applyStyleToLabel?o.label.strokeColor=l:o.label.strokeColor="var(--canvastext)";let s=[[...e.numericalEndpoint],[...e.numericalThroughpoint]],a=c.create("line",s,o);a.on("drag",function(t){(Math.abs(t.x-d.current[0])>.1||Math.abs(t.y-d.current[1])>.1)&&(b.current=!0,h.current=L(t),f({action:p.moveRay,args:{endpointcoords:h.current[0],throughcoords:h.current[1],transient:!0,skippable:!0}})),r.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,m.current),r.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,S.current)}),a.on("up",function(t){b.current?f({action:p.moveRay,args:{endpointcoords:h.current[0],throughcoords:h.current[1]}}):f({action:p.rayClicked})}),a.on("down",function(t){b.current=!1,d.current=[t.x,t.y],g.current=[[...a.point1.coords.scrCoords],[...a.point2.coords.scrCoords]],f({action:p.mouseDownOnRay})}),v.current=e.showLabel&&e.labelForGraph!=="",r.current=a}function k(){r.current.off("drag"),r.current.off("down"),r.current.off("up"),c.removeObject(r.current),r.current=null}function L(i){var l=c.origin.scrCoords;let o=[];for(let s=0;s<2;s++){let a=(g.current[s][1]+i.x-d.current[0]-l[1])/c.unitX,t=(l[2]-(g.current[s][2]+i.y-d.current[1]))/c.unitY;o.push([a,t])}return o}if(c)if(r.current===null)G();else if(e.numericalEndpoint.length!==2||e.numericalThroughpoint.length!==2)k();else{let i=!0;for(let y of[e.numericalEndpoint,e.numericalThroughpoint])Number.isFinite(y[0])||(i=!1),Number.isFinite(y[1])||(i=!1);r.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoint),r.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalThroughpoint);let l=!e.hidden;if(i){let y=r.current.visProp.visible!==l;r.current.visProp.visible=l,r.current.visPropCalc.visible=l,y&&r.current.setAttribute({visible:l})}else r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;let o=!e.draggable||e.fixed;r.current.visProp.fixed=o,r.current.visProp.highlight=!o;let s=10*e.layer+x;r.current.visProp.layer!==s&&r.current.setAttribute({layer:s});let t=R==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;t=t.toLowerCase(),r.current.visProp.strokecolor!==t&&(r.current.visProp.strokecolor=t,r.current.visProp.highlightstrokecolor=t),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let P=w(e.selectedStyle.lineStyle);r.current.visProp.dash!==P&&(r.current.visProp.dash=P),r.current.name=e.labelForGraph;let C=e.showLabel&&e.labelForGraph!=="";C!=v.current&&(r.current.setAttribute({withlabel:C}),v.current=C),r.current.needsUpdate=!0,r.current.update(),r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=t:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),c.updateRenderer()}return e.hidden?null:O(X,{children:O("a",{name:F})})});function w(u){return u==="solid"?0:u==="dashed"?2:u==="dotted"?1:0}export{N as default};
