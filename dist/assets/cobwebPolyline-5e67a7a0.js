import{aw as J,bn as L,r as u,bs as X,j as A,F as N}from"./index-404de25b.js";import{BoardContext as I,LINE_LAYER_OFFSET as k,VERTEX_LAYER_OFFSET as U}from"./graph-5cf31fdb.js";import"./css-14ccef8c.js";import"./visibility-sensor-6e6ccf6e.js";const M=J.memo(function f(V){let{name:R,id:j,SVs:e,actions:w,sourceOfUpdate:S,callAction:E}=L(V);f.ignoreActionsWithoutCore=!0;const o=u.useContext(I);let h=u.useRef(null),x=u.useRef(null),l=u.useRef(null),t=u.useRef(null),P=u.useRef(null),C=u.useRef(null),p=u.useRef(null),c=u.useRef(null),_=u.useRef(null);_.current=e.numericalVertices,u.useEffect(()=>()=>{l.current&&D()},[]);function G(){let n={visible:!e.hidden,withLabel:!1,fixed:!0,layer:10*e.layer+k,strokeColor:"green",highlightStrokeColor:"green",strokeWidth:3,dash:F("solid")},g=X(e.fDefinition);h.current=o.create("functiongraph",[g],n);let b={visible:!e.hidden,withLabel:!1,fixed:!0,layer:10*e.layer+k,strokeColor:"gray",highlightStrokeColor:"gray",strokeWidth:2,dash:F("solid")};x.current=o.create("line",[[0,0],[1,1]],b);let m=!0;for(let i of e.numericalVertices)Number.isFinite(i[0])||(m=!1),Number.isFinite(i[1])||(m=!1);let v={name:e.labelForGraph,visible:!e.hidden&&m,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:!0,layer:10*e.layer+k,strokeColor:e.selectedStyle.lineColor,highlightStrokeColor:e.selectedStyle.lineColor,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:F(e.selectedStyle.lineStyle)};v.label={highlight:!1},e.labelHasLatex&&(v.label.useMathJax=!0),c.current={fixed:!e.draggable||e.fixed,visible:!e.hidden&&m&&e.draggable,withLabel:!0,name:"A",layer:10*e.layer+U,fillColor:e.selectedStyle.markerColor,strokeColor:e.selectedStyle.markerColor,size:e.selectedStyle.markerSize,face:Y(e.selectedStyle.markerStyle)},e.draggable?(c.current.highlightFillColor="#EEEEEE",c.current.highlightStrokeColor="#C3D9FF",c.current.showInfoBox=!0):(c.current.highlightFillColor=e.selectedStyle.markerColor,c.current.highlightStrokeColor=e.selectedStyle.markerColor,c.current.showInfoBox=!1),t.current=[];let a=e.variable.toString();for(let i=0;i<e.nPoints;i++){let d=Object.assign({},c.current);i===0?d.name=`(${a}_0,0)`:i%2===1?d.name=`(${a}_${(i-1)/2}, ${a}_${(i+1)/2})`:d.name=`(${a}_${i/2}, ${a}_${i/2})`,i!==e.nPoints-1&&(d.visible=!1),t.current.push(o.create("point",[...e.numericalVertices[i]],d))}let r=[],s=[];e.numericalVertices.forEach(i=>{r.push(i[0]),s.push(i[1])});let y=o.create("curve",[r,s],v);for(let i=0;i<e.nPoints;i++)t.current[i].on("drag",d=>$(i)),t.current[i].on("up",d=>O(i)),t.current[i].on("down",d=>C.current=null);return p.current=e.nPoints,y}function D(){o.removeObject(l.current),l.current=null,o.removeObject(h.current),h.current=null,o.removeObject(x.current),x.current=null;for(let n=0;n<e.nPoints;n++)t.current[n]&&(t.current[n].off("drag"),t.current[n].off("up"),t.current[n].off("down"),o.removeObject(t.current[n]),delete t.current[n])}function $(n){C.current=n,P.current={},P.current[n]=[t.current[n].X(),t.current[n].Y()],E({action:w.movePolyline,args:{pointCoords:P.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),t.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[..._.current[n]]),o.updateInfobox(t.current[n])}function O(n){C.current===n&&E({action:w.movePolyline,args:{pointCoords:P.current,sourceDetails:{vertex:n}}})}if(o)if(!l.current)l.current=G();else{let n=X(e.fDefinition);h.current.Y=n,h.current.needsUpdate=!0,h.current.updateCurve();let g=!0;for(let r of e.numericalVertices)Number.isFinite(r[0])||(g=!1),Number.isFinite(r[1])||(g=!1);let b=e.variable.toString();if(e.nPoints>p.current)for(let r=p.current;r<e.nPoints;r++){let s=Object.assign({},c.current);r===0?s.name=`(${b}_0,0)`:r%2===1?s.name=`(${b}_${(r-1)/2}, ${b}_${(r+1)/2})`:s.name=`(${b}_${r/2}, ${b}_${r/2})`,r!==e.nPoints-1&&(s.visible=!1),t.current.push(o.create("point",[...e.numericalVertices[r]],s)),t.current[r].on("drag",y=>$(r)),t.current[r].on("up",y=>O(r)),t.current[r].on("down",y=>C.current=null)}else if(e.nPoints<p.current){for(let r=e.nPoints;r<p.current;r++){let s=t.current.pop();s.off("drag"),s.off("up"),s.off("down"),o.removeObject(s)}l.current.dataX.length=e.nPoints}p.current=e.nPoints;let m=l.current.transformMat[1][0],v=l.current.transformMat[2][0];for(let r=0;r<e.nPoints;r++)t.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[r]]),l.current.dataX[r]=e.numericalVertices[r][0]-m,l.current.dataY[r]=e.numericalVertices[r][1]-v;let a=!e.hidden;if(g){l.current.visProp.visible=a,l.current.visPropCalc.visible=a;for(let r=0;r<e.nPoints-1;r++)t.current[r].visProp.visible=!1,t.current[r].visPropCalc.visible=!1;e.nPoints>0&&e.draggable&&(t.current[e.nPoints-1].visProp.visible=a,t.current[e.nPoints-1].visPropCalc.visible=a)}else{l.current.visProp.visible=!1,l.current.visPropCalc.visible=!1;for(let r=0;r<e.nPoints;r++)t.current[r].visProp.visible=!1,t.current[r].visPropCalc.visible=!1}if(S.sourceInformation&&R in S.sourceInformation){let r=S.sourceInformation[R].vertex;Number.isFinite(r)&&o.updateInfobox(t.current[r])}l.current.needsUpdate=!0,l.current.update().updateVisibility();for(let r=0;r<e.nPoints;r++)t.current[r].needsUpdate=!0,t.current[r].update();e.nPoints>0&&(t.current[e.nPoints-1].setAttribute({withlabel:!0}),t.current[e.nPoints-1].label.needsUpdate=!0,t.current[e.nPoints-1].label.update()),o.updateRenderer()}return e.hidden?null:A(N,{children:A("a",{name:j})})});function F(f){return f==="solid"?0:f==="dashed"?2:f==="dotted"?1:0}function Y(f){return f==="triangle"?"triangleup":f}export{M as default};
