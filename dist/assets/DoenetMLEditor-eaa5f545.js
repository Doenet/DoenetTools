import{R as v,l as n,m as f,x as E,r as a,j as d}from"./index-e32334a0.js";import{C as M}from"./CodeMirror-0770073f.js";import{u as P}from"./useSaveDraft-c7a0943b.js";import{t as R,u as k,v as A,e as L}from"./EditorViewerRecoil-3acd5a83.js";function C(){const m=v(R),p=n(k),I=n(A),g=n(f("pageId")),c=n(f("linkPageId"));let l=g,s=!1;c&&(s=!0,l=c);const u=n(E),t=n(L);let D=a.useRef(null),e=a.useRef(null),r=a.useRef(!0);const{saveDraft:o}=P();return a.useEffect(()=>()=>{t!==""&&(o({pageId:t,courseId:u,backup:r.current}),e.current!==null&&clearTimeout(e.current),e.current=null)},[t,o,u]),a.useEffect(()=>{t!==""&&(o({pageId:t,courseId:u,backup:r.current}).then(({success:i})=>{i&&(r.current=!1)}),e.current!==null&&clearTimeout(e.current),e.current=null)},[I]),l!==t?(r.current=!0,null):d("div",{children:d(M,{readOnly:s,editorRef:D,setInternalValue:p,onBeforeChange:i=>{m(i),clearTimeout(e.current),e.current=setTimeout(function(){o({pageId:t,courseId:u,backup:r.current}).then(({success:x})=>{x&&(r.current=!1)}),e.current=null},3e3)}},"codemirror")})}export{C as default};
