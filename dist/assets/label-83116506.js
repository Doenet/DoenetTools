import{aw as W,bn as q,r as c,bo as M,j as y,a as U,b9 as H}from"./index-2be4b65a.js";import{BoardContext as I,TEXT_LAYER_OFFSET as N}from"./graph-cc72c8b4.js";import"./css-14ccef8c.js";import"./visibility-sensor-69a0b294.js";const te=W.memo(function Y(B){let{name:K,id:d,SVs:e,children:j,actions:L,callAction:O}=q(B);Y.ignoreActionsWithoutCore=!0;let t=c.useRef(null),x=c.useRef(null),b=c.useRef(null);const o=c.useContext(I);let h=c.useRef(!1),F=c.useRef(!1),g=c.useRef(!1),m=c.useRef(null),p=c.useRef(null),S=c.useRef(null),R=c.useRef(null);c.useEffect(()=>()=>{t.current!==null&&(t.current.off("drag"),t.current.off("down"),t.current.off("up"),o==null||o.removeObject(t.current),t.current=null)},[]);function D(){let s=!e.draggable||e.fixed,i={visible:!e.hidden,fixed:s,layer:10*e.layer+N,highlight:!s,useMathJax:e.hasLatex,parse:!1},u;try{let r=M.fromAst(e.anchor),f=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()];Number.isFinite(f[0])||(f[0]=0,i.visible=!1),Number.isFinite(f[1])||(f[1]=0,i.visible=!1),u=o.create("point",f,{visible:!1})}catch{i.visible=!1,u=o.create("point",[0,0],{visible:!1})}i.anchor=u;let a,l;e.positionFromAnchor==="center"?(a="middle",l="middle"):e.positionFromAnchor==="lowerleft"?(a="right",l="top"):e.positionFromAnchor==="lowerright"?(a="left",l="top"):e.positionFromAnchor==="upperleft"?(a="right",l="bottom"):e.positionFromAnchor==="upperright"?(a="left",l="bottom"):e.positionFromAnchor==="bottom"?(a="middle",l="top"):e.positionFromAnchor==="top"?(a="middle",l="bottom"):e.positionFromAnchor==="right"?(a="left",l="middle"):(a="right",l="middle"),i.anchorx=a,i.anchory=l,b.current=[a,l];let n=o.create("text",[0,0,e.value],i);n.on("down",function(r){h.current=[r.x,r.y],F.current=[...u.coords.scrCoords],g.current=!1}),n.on("up",function(r){g.current&&O({action:L.moveLabel,args:{x:m.current,y:p.current}}),g.current=!1}),n.on("drag",function(r){var f=o.origin.scrCoords;let[C,_,P,X]=o.getBoundingBox(),w=n.size[0]/o.unitX,J=n.size[1]/o.unitY,E=b.current[0],G=b.current[1],v=0;E==="middle"?v=-w/2:E==="right"&&(v=-w);let A=0;G==="middle"?A=-J/2:G==="top"&&(A=-J);let T=C+.04*(P-C)-v-w,z=P-.04*(P-C)-v,V=X+.04*(_-X)-A-J,k=_-.04*(_-X)-A;m.current=(F.current[1]+r.x-h.current[0]-f[1])/o.unitX,m.current=Math.min(z,Math.max(T,m.current)),p.current=(f[2]-(F.current[2]+r.y-h.current[1]))/o.unitY,p.current=Math.min(k,Math.max(V,p.current)),O({action:L.moveLabel,args:{x:m.current,y:p.current,transient:!0,skippable:!0}}),n.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),u.coords.setCoordinates(JXG.COORDS_BY_USER,S.current),(Math.abs(r.x-h.current[0])>.1||Math.abs(r.y-h.current[1])>.1)&&(g.current=!0)}),t.current=n,x.current=u,R.current=e.positionFromAnchor,e.hasLatex&&setTimeout(()=>{t.current&&(t.current.needsUpdate=!0,t.current.setText(e.value),t.current.update(),o==null||o.updateRenderer())},1e3)}if(o){let s;try{let i=M.fromAst(e.anchor);s=[i.get_component(0).evaluate_to_constant(),i.get_component(1).evaluate_to_constant()]}catch{s=[NaN,NaN]}if(S.current=s,t.current===null)D();else{t.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),x.current.coords.setCoordinates(JXG.COORDS_BY_USER,s),t.current.setText(e.value);let i=!e.hidden;if(Number.isFinite(s[0])&&Number.isFinite(s[1])){let n=t.current.visProp.visible!==i;t.current.visProp.visible=i,t.current.visPropCalc.visible=i,n&&t.current.setAttribute({visible:i})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let u=10*e.layer+N;t.current.visProp.layer!==u&&t.current.setAttribute({layer:u});let l=!e.draggable||e.fixed;if(t.current.visProp.highlight=!l,t.current.visProp.fixed=l,t.current.needsUpdate=!0,e.positionFromAnchor!==R.current){let n,r;e.positionFromAnchor==="center"?(n="middle",r="middle"):e.positionFromAnchor==="lowerleft"?(n="right",r="top"):e.positionFromAnchor==="lowerright"?(n="left",r="top"):e.positionFromAnchor==="upperleft"?(n="right",r="bottom"):e.positionFromAnchor==="upperright"?(n="left",r="bottom"):e.positionFromAnchor==="bottom"?(n="middle",r="top"):e.positionFromAnchor==="top"?(n="middle",r="bottom"):e.positionFromAnchor==="right"?(n="left",r="middle"):(n="right",r="middle"),t.current.visProp.anchorx=n,t.current.visProp.anchory=r,b.current=[n,r],R.current=e.positionFromAnchor,t.current.fullUpdate()}else t.current.update();x.current.needsUpdate=!0,x.current.update(),o.updateRenderer()}return y("a",{name:d})}if(e.hidden)return null;if(j.length>0)return U("span",{id:d,style:{marginRight:"12px"},children:[y("a",{name:d}),j]});{let s=e.value;return e.hasLatex&&(s=y(H.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:s})),U("span",{id:d,children:[y("a",{name:d}),s]})}});export{te as default};
