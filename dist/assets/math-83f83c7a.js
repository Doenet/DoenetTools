import{av as Z,bn as ee,r as u,bo as W,j as h,a as F,F as D,b9 as E}from"./index-7c464f87.js";import{BoardContext as te,TEXT_LAYER_OFFSET as $}from"./graph-fcef2c02.js";import"./css-14ccef8c.js";import"./visibility-sensor-82f19459.js";const se=Z.memo(function z(V){let{name:re,id:p,SVs:e,actions:G,sourceOfUpdate:ne,callAction:Y}=ee(V);z.ignoreActionsWithoutCore=!0;let t=u.useRef(null),M=u.useRef(null),R=u.useRef(null);const a=u.useContext(te);let y=u.useRef(!1),J=u.useRef(!1),_=u.useRef(!1),A=u.useRef(null),v=u.useRef(null),B=u.useRef(null),X=u.useRef(null);u.useEffect(()=>()=>{t.current!==null&&(t.current.off("drag"),t.current.off("down"),t.current.off("up"),a==null||a.removeObject(t.current),t.current=null)},[]);function k(){let o=!e.draggable||e.fixed,i={visible:!e.hidden,fixed:o,layer:10*e.layer+$,highlight:!o,useMathJax:!0,parse:!1},c;try{let r=W.fromAst(e.anchor),m=[r.get_component(0).evaluate_to_constant(),r.get_component(1).evaluate_to_constant()];Number.isFinite(m[0])||(m[0]=0,i.visible=!1),Number.isFinite(m[1])||(m[1]=0,i.visible=!1),c=a.create("point",m,{visible:!1})}catch{i.visible=!1,c=a.create("point",[0,0],{visible:!1})}i.anchor=c;let l,s;e.positionFromAnchor==="center"?(l="middle",s="middle"):e.positionFromAnchor==="lowerleft"?(l="right",s="top"):e.positionFromAnchor==="lowerright"?(l="left",s="top"):e.positionFromAnchor==="upperleft"?(l="right",s="bottom"):e.positionFromAnchor==="upperright"?(l="left",s="bottom"):e.positionFromAnchor==="bottom"?(l="middle",s="top"):e.positionFromAnchor==="top"?(l="middle",s="bottom"):e.positionFromAnchor==="right"?(l="left",s="middle"):(l="right",s="middle"),i.anchorx=l,i.anchory=s,R.current=[l,s];let f,d;e.renderMode==="inline"?(f="\\(",d="\\)"):e.renderMode==="display"?(f="\\[",d="\\]"):e.renderMode==="numbered"?(f=`\\begin{gather}\\tag{${e.equationTag}}`,d="\\end{gather}"):e.renderMode==="align"?(f="\\begin{align}",d="\\end{align}"):(f="\\(",d="\\)");let n=a.create("text",[0,0,f+e.latex+d],i);n.on("down",function(r){y.current=[r.x,r.y],J.current=[...c.coords.scrCoords],_.current=!1}),n.on("up",function(r){_.current&&Y({action:G.moveMath,args:{x:A.current,y:v.current}}),_.current=!1}),n.on("drag",function(r){var m=a.origin.scrCoords;let[O,T,U,j]=a.getBoundingBox(),N=n.size[0]/a.unitX,S=n.size[1]/a.unitY,q=R.current[0],I=R.current[1],P=0;q==="middle"?P=-N/2:q==="right"&&(P=-N);let w=0;I==="middle"?w=-S/2:I==="top"&&(w=-S);let L=O+.04*(U-O)-P-N,H=U-.04*(U-O)-P,K=j+.04*(T-j)-w-S,Q=T-.04*(T-j)-w;A.current=(J.current[1]+r.x-y.current[0]-m[1])/a.unitX,A.current=Math.min(H,Math.max(L,A.current)),v.current=(m[2]-(J.current[2]+r.y-y.current[1]))/a.unitY,v.current=Math.min(Q,Math.max(K,v.current)),Y({action:G.moveMath,args:{x:A.current,y:v.current,transient:!0,skippable:!0}}),n.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),c.coords.setCoordinates(JXG.COORDS_BY_USER,B.current),(Math.abs(r.x-y.current[0])>.1||Math.abs(r.y-y.current[1])>.1)&&(_.current=!0)}),t.current=n,M.current=c,X.current=e.positionFromAnchor,setTimeout(()=>{t.current&&(t.current.needsUpdate=!0,t.current.setText(f+e.latex+d),t.current.update(),a.updateRenderer())},1e3)}if(a){let o;try{let i=W.fromAst(e.anchor);o=[i.get_component(0).evaluate_to_constant(),i.get_component(1).evaluate_to_constant()]}catch{o=[NaN,NaN]}if(B.current=o,t.current===null)k();else{t.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),M.current.coords.setCoordinates(JXG.COORDS_BY_USER,o);let i,c;e.renderMode==="inline"?(i="\\(",c="\\)"):e.renderMode==="display"?(i="\\[",c="\\]"):e.renderMode==="numbered"?(i=`\\begin{gather}\\tag{${e.equationTag}}`,c="\\end{gather}"):e.renderMode==="align"?(i="\\begin{align}",c="\\end{align}"):(i="\\(",c="\\)"),t.current.setText(i+e.latex+c);let l=!e.hidden;if(Number.isFinite(o[0])&&Number.isFinite(o[1])){let n=t.current.visProp.visible!==l;t.current.visProp.visible=l,t.current.visPropCalc.visible=l,n&&t.current.setAttribute({visible:l})}else t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let s=10*e.layer+$;t.current.visProp.layer!==s&&t.current.setAttribute({layer:s});let d=!e.draggable||e.fixed;if(t.current.visProp.highlight=!d,t.current.visProp.fixed=d,t.current.needsUpdate=!0,e.positionFromAnchor!==X.current){let n,r;e.positionFromAnchor==="center"?(n="middle",r="middle"):e.positionFromAnchor==="lowerleft"?(n="right",r="top"):e.positionFromAnchor==="lowerright"?(n="left",r="top"):e.positionFromAnchor==="upperleft"?(n="right",r="bottom"):e.positionFromAnchor==="upperright"?(n="left",r="bottom"):e.positionFromAnchor==="bottom"?(n="middle",r="top"):e.positionFromAnchor==="top"?(n="middle",r="bottom"):e.positionFromAnchor==="right"?(n="left",r="middle"):(n="right",r="middle"),t.current.visProp.anchorx=n,t.current.visProp.anchory=r,R.current=[n,r],X.current=e.positionFromAnchor,t.current.fullUpdate()}else t.current.update();M.current.needsUpdate=!0,M.current.update(),a.updateRenderer()}return h("a",{name:p})}if(e.hidden)return null;let b,x;if(e.renderMode==="inline"?(b="\\(",x="\\)"):e.renderMode==="display"?(b="\\[",x="\\]"):e.renderMode==="numbered"?(b=`\\begin{gather}\\tag{${e.equationTag}}`,x="\\end{gather}"):e.renderMode==="align"?(b="\\begin{align}",x="\\end{align}"):(b="\\(",x="\\)"),!e.latexWithInputChildren)return null;let g=e.latexWithInputChildren.map(o=>typeof o=="number"?this.children[o]:b+o+x),C=[h("a",{name:p},p)];return e.mrowChildNames&&C.push(...e.mrowChildNames.map(o=>h("a",{name:o,id:o},o))),g.length===0?F(D,{children:[C,h("span",{id:p})]}):g.length===1?F(D,{children:[C,h("span",{id:p,children:h(E.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:g[0]})})]}):g.length===2?F(D,{children:[C,h("span",{id:p,children:F(E.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:[g[0],g[1]]})})]}):F(D,{children:[C,h("span",{id:p,children:h(E.MathJax,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:g[0]})})]})});export{se as default};
