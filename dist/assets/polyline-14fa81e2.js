import{aw as T,bn as U,r as a,j as G,F as W}from"./index-20518b4a.js";import{BoardContext as N,LINE_LAYER_OFFSET as L,VERTEX_LAYER_OFFSET as Y}from"./graph-dd706fbc.js";import"./css-14ccef8c.js";import"./visibility-sensor-e9f4df9a.js";const K=T.memo(function V(A){let{name:X,id:_,SVs:e,actions:h,sourceOfUpdate:w,callAction:y}=U(A);V.ignoreActionsWithoutCore=!0;const s=a.useContext(N);let r=a.useRef(null),l=a.useRef(null),g=a.useRef(null),m=a.useRef(null),k=a.useRef(null),v=a.useRef(null),F=a.useRef(null),C=a.useRef(null),P=a.useRef(null),x=a.useRef(null);x.current=e.numericalVertices,a.useEffect(()=>()=>{r.current&&D()},[]);function J(){if(e.numericalVertices.length!==e.nVertices||e.numericalVertices.some(i=>i.length!==2))return null;let n=!0;for(let i of e.numericalVertices)Number.isFinite(i[0])||(n=!1),Number.isFinite(i[1])||(n=!1);let u=!e.draggable||e.fixed,c={name:e.labelForGraph,visible:!e.hidden&&n,withLabel:e.showLabel&&e.labelForGraph!=="",layer:10*e.layer+L,fixed:u,strokeColor:e.selectedStyle.lineColor,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:e.selectedStyle.lineColor,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:j(e.selectedStyle.lineStyle),highlight:!u,lineCap:"butt"},d=!e.verticesDraggable||e.fixed;P.current=Object.assign({},c),Object.assign(P.current,{fixed:!1,highlight:!0,withLabel:!1,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*e.layer+Y}),(d||e.hidden||!n)&&(P.current.visible=!1),c.label={highlight:!1},e.labelHasLatex&&(c.label.useMathJax=!0),e.applyStyleToLabel?c.label.strokeColor=e.selectedStyle.lineColor:c.label.strokeColor="#000000",l.current=[];for(let i=0;i<e.nVertices;i++)l.current.push(s.create("point",[...e.numericalVertices[i]],P.current));let o=[],S=[];e.numericalVertices.forEach(i=>{o.push(i[0]),S.push(i[1])});let b=s.create("curve",[o,S],c);for(let i=0;i<e.nVertices;i++)l.current[i].on("drag",p=>O(i,p)),l.current[i].on("up",()=>E(i)),l.current[i].on("down",p=>{m.current=null,v.current=[p.x,p.y],k.current=i,y({action:h.mouseDownOnPolyline})});return b.on("drag",i=>O(-1,i)),b.on("up",()=>E(-1)),b.on("down",function(i){m.current=null,v.current=[i.x,i.y],F.current=b.points.map(p=>[...p.scrCoords]),k.current===null&&y({action:h.mouseDownOnPolyline})}),C.current=e.nVertices,b}function D(){r.current.off("drag"),r.current.off("down"),r.current.off("up"),s.removeObject(r.current),r.current=null;for(let n=0;n<e.nVertices;n++)l.current[n].off("drag"),l.current[n].off("down"),l.current[n].off("up"),s.removeObject(l.current[n]),delete l.current[n]}function O(n,u){if(Math.abs(u.x-v.current[0])>.1||Math.abs(u.y-v.current[1])>.1)if(m.current=n,n===-1){g.current=M(u),y({action:h.movePolyline,args:{pointCoords:g.current,transient:!0,skippable:!0}}),r.current.updateTransformMatrix();let c=r.current.transformMat[1][0],d=r.current.transformMat[2][0];for(let o=0;o<e.nVertices;o++)l.current[o].coords.setCoordinates(JXG.COORDS_BY_USER,[...x.current[o]]),r.current.dataX[o]=x.current[o][0]-c,r.current.dataY[o]=x.current[o][1]-d}else g.current={},g.current[n]=[l.current[n].X(),l.current[n].Y()],y({action:h.movePolyline,args:{pointCoords:g.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),l.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...x.current[n]]),s.updateInfobox(l.current[n])}function E(n){m.current===n?y(n===-1?{action:h.movePolyline,args:{pointCoords:g.current}}:{action:h.movePolyline,args:{pointCoords:g.current,sourceDetails:{vertex:n}}}):m.current===null&&(k.current===null||n!==-1)&&y({action:h.polylineClicked}),n!==-1&&(k.current=null)}function M(n){var u=s.origin.scrCoords;let c=[];for(let d=0;d<r.current.points.length;d++){let o=(F.current[d][1]+n.x-v.current[0]-u[1])/s.unitX,S=(u[2]-(F.current[d][2]+n.y-v.current[1]))/s.unitY;c.push([o,S])}return c}if(s)if(!r.current)r.current=J();else if(e.numericalVertices.length!==e.nVertices||e.numericalVertices.some(n=>n.length!==2))D();else{let n=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(n=!1),Number.isFinite(t[1])||(n=!1);let u=!e.draggable||e.fixed;r.current.visProp.fixed=u,r.current.visProp.highlight=!u;let c=10*e.layer+L,d=r.current.visProp.layer!==c,o=10*e.layer+Y;if(d&&(r.current.setAttribute({layer:c}),P.current.layer=o),e.nVertices>C.current)for(let t=C.current;t<e.nVertices;t++)l.current.push(s.create("point",[...e.numericalVertices[t]],P.current)),r.current.dataX.length=e.nVertices,l.current[t].on("drag",f=>O(t,!0)),l.current[t].on("up",f=>O(t,!1)),l.current[t].on("down",f=>m.current=null);else if(e.nVertices<C.current){for(let t=e.nVertices;t<C.current;t++){let f=l.current.pop();f.off("drag"),f.off("down"),f.off("up"),s.removeObject(f)}r.current.dataX.length=e.nVertices}C.current=e.nVertices,r.current.updateTransformMatrix();let S=r.current.transformMat[1][0],b=r.current.transformMat[2][0];for(let t=0;t<e.nVertices;t++)l.current[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[t]]),r.current.dataX[t]=e.numericalVertices[t][0]-S,r.current.dataY[t]=e.numericalVertices[t][1]-b;let i=!e.hidden;if(n){r.current.visProp.visible=i,r.current.visPropCalc.visible=i;let t=!e.verticesDraggable||e.fixed,f=i&&!t;for(let R=0;R<e.nVertices;R++)l.current[R].visProp.visible=f,l.current[R].visPropCalc.visible=f}else{r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;for(let t=0;t<e.nVertices;t++)l.current[t].visProp.visible=!1,l.current[t].visPropCalc.visible=!1}r.current.visProp.strokecolor!==e.selectedStyle.lineColor&&(r.current.visProp.strokecolor=e.selectedStyle.lineColor,r.current.visProp.highlightstrokecolor=e.selectedStyle.lineColor),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let p=j(e.selectedStyle.lineStyle);if(r.current.visProp.dash!==p&&(r.current.visProp.dash=p),r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=e.selectedStyle.lineColor:r.current.label.visProp.strokecolor="#000000",r.current.label.needsUpdate=!0,r.current.label.update()),w.sourceInformation&&X in w.sourceInformation){let t=w.sourceInformation[X].vertex;Number.isFinite(t)&&s.updateInfobox(l.current[t])}r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let t=0;t<e.nVertices;t++)d&&l.current[t].setAttribute({layer:o}),l.current[t].needsUpdate=!0,l.current[t].update();s.updateRenderer()}return e.hidden?null:G(W,{children:G("a",{name:_})})});function j(V){return V==="solid"?0:V==="dashed"?2:V==="dotted"?1:0}export{K as default};
