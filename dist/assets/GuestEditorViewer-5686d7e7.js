import{l as v,m as F,g as _,h as N,R as f,f as T,r,ac as J,u as O,w as $,ad as w,j as S,P as K,k as B,I as q}from"./index-b4c9ab18.js";import{u as G,a as H}from"./EditorViewer-af689505.js";import{p as U}from"./activityUtils-ccc6a30c.js";import{v as E,e as z,r as Q,a as W,u as X,t as Y}from"./EditorViewerRecoil-18753b37.js";function ie(){const i=v(E),o=v(F("doenetId")),[u,x]=_(N),P=f(T),h=f(z),A=v(Q),I=f(W),[m,C]=r.useState(null),V=G(),[p,l]=r.useState(null),L=f(J);let a=O();const c=r.useRef({}),d=r.useRef(null);r.useEffect(()=>{const e=document.title;return(async()=>{let t=await B.get("/api/getCidForAssignment.php",{params:{doenetId:o,latestAttemptOverrides:!1,publicOnly:!0,userCanViewSourceOnly:!0}}),s;if(!t.data.success||!t.data.cid){t.data.cid?l(`Error loading activity: ${t.data.message}`):l("Error loading activity: public content with public source not found");return}else s=t.data.cid;let g;try{g=await w(s,"doenet")}catch{l("Error loading activity: activity file not found");return}let y=U(g);if(!y.success){l(`Invalid activity definition: ${y.message}`);return}let R=y.activityJSON;C(Z(R.order)),p&&l(null),document.title=`${t.data.label} - Doenet`})().catch(console.error),()=>{document.title=e}},[o]),r.useEffect(()=>{var e,n;d.current!==a.key&&(((e=a.state)==null?void 0:e.previousScrollPosition)!==void 0&&d.current&&(c.current[d.current].lastScrollPosition=a.state.previousScrollPosition),c.current[a.key]&&((n=c.current[a.key])==null?void 0:n.lastScrollPosition)!==void 0&&document.getElementById("mainPanel").scroll({top:c.current[a.key].lastScrollPosition}),c.current[a.key]={...a},d.current=a.key)},[a]),r.useEffect(()=>{const e=document.getElementById("mainPanel");L(e)},[]);let k=$(({snapshot:e,set:n})=>async t=>{const s=await w(t,"doenet");n(X,s),n(Y,s),n(E,s)},[]);if(r.useEffect(()=>(m&&k(m),()=>{h("")}),[m]),H("keydown",e=>{e.keyCode===83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),V())}),p)return S("h1",{children:p});let M=1,D="button";function b(e,n){const t=JSON.parse(JSON.stringify(e));P({index:t.index,allPossibleVariants:n}),x({index:t.index})}return i?S(K,{doenetML:i,flags:{showCorrectness:!0,readOnly:!1,solutionDisplayMode:D,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!1,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},doenetId:o,attemptNumber:M,generatedVariantCallback:b,requestedVariantIndex:u.index,setIsInErrorState:I,pageIsActive:!0},`pageViewer${A}`):null}function Z(i){if(!(i!=null&&i.content)||i.content.length==0)return null;for(let o of i.content){if(o.type==="page")return o.cid;{let u=q(o.content);if(u)return u}}return null}export{ie as default};
