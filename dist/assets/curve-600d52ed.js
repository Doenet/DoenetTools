import{av as Pe,bn as Ce,r as h,bs as P,j as R,F as z}from"./index-7c464f87.js";import{BoardContext as ye,LINE_LAYER_OFFSET as he,VERTEX_LAYER_OFFSET as B,CONTROL_POINT_LAYER_OFFSET as pe}from"./graph-fcef2c02.js";import"./css-14ccef8c.js";import"./visibility-sensor-82f19459.js";const Fe=Pe.memo(function G(N){let{name:T,id:F,SVs:e,actions:x,sourceOfUpdate:E,callAction:w}=Ce(N);G.ignoreActionsWithoutCore=!0;const l=h.useContext(ye);let o=h.useRef(null),p=h.useRef(null),i=h.useRef(null),Q=h.useRef(null),O=h.useRef(null),S=h.useRef(null),V=h.useRef(!1),ne=h.useRef(null),k=h.useRef(null),Y=h.useRef(null),A=h.useRef(null),H=h.useRef(null),D=h.useRef(null),C=h.useRef(null),c=h.useRef([]),X=h.useRef(null),I=h.useRef(null),q=h.useRef(null),j=h.useRef(null),K=h.useRef([]),U=h.useRef([]);q.current=e.vectorControlDirections;let oe=h.useRef(null);oe.current=e.numericalThroughPoints;let le=h.useRef(null);le.current=e.numericalControlPoints,h.useEffect(()=>()=>{o.current&&Z()},[]);function ie(){if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)return null;var r={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:!0,layer:10*e.layer+he,strokeColor:e.selectedStyle.lineColor,strokeOpacity:e.selectedStyle.lineOpacity,strokeWidth:e.selectedStyle.lineWidth,dash:ge(e.selectedStyle.lineStyle,e.dashed),highlight:!1,lineCap:"butt"};if(e.showLabel&&e.labelForGraph!==""){let a,u,f;e.labelPosition==="upperright"?(f="urt",u=[-5,-10],a="right"):e.labelPosition==="upperleft"?(f="ulft",u=[5,-10],a="left"):e.labelPosition==="lowerright"?(f="lrt",u=[-5,10],a="right"):e.labelPosition==="lowerleft"?(f="llft",u=[5,10],a="left"):e.labelPosition==="top"?(f="top",u=[0,-10],a="left"):e.labelPosition==="bottom"?(f="bot",u=[0,10],a="left"):e.labelPosition==="left"?(f="lft",u=[10,0],a="left"):(f="rt",u=[-10,0],a="right"),r.label={offset:u,position:f,anchorx:a,highlight:!1},e.labelHasLatex&&(r.label.useMathJax=!0),e.applyStyleToLabel?r.label.strokeColor=e.selectedStyle.lineColor:r.label.strokeColor="#000000"}else r.label={highlight:!1},e.labelHasLatex&&(r.label.useMathJax=!0);let t;if(e.curveType==="parameterization"){let a=P(e.fDefinitions[0]),u=P(e.fDefinitions[1]);t=l.create("curve",[a,u,e.parMin,e.parMax],r)}else if(e.curveType==="bezier"){let a=P(e.fDefinitions[0]),u=P(e.fDefinitions[1]);t=l.create("curve",[a,u,e.parMin,e.parMax],r)}else{let a=P(e.fDefinitions[0]);if(e.flipFunction){let u=e.graphYmin,f=e.graphYmax,m=Math.max(u-(f-u)*.1,e.parMin),g=Math.min(f+(f-u)*.1,e.parMax);t=l.create("curve",[a,ee=>ee,m,g],r)}else{let u=e.graphXmin,f=e.graphXmax,m=Math.max(u-(f-u)*.1,e.parMin),g=Math.min(f+(f-u)*.1,e.parMax);t=l.create("functiongraph",[a,m,g],r)}ne.current=e.flipFunction}return Q.current=e.curveType,O.current=null,S.current=null,t.on("up",function(a){!V.current&&O.current===null&&S.current===null&&(e.switchable&&!e.fixed&&w({action:x.switchCurve}),w({action:x.curveClicked,args:{name:T}}))}),e.curveType==="bezier"?(l.on("up",fe),t.on("down",()=>{y(),w({action:x.mouseDownOnCurve,args:{name:T}})}),k.current={visible:!1,withLabel:!1,fixed:!0,strokeColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",layer:10*e.layer+B,strokeWidth:1,highlightStrokeWidth:1},Y.current={visible:!e.hidden,withLabel:!1,fixed:!1,fillColor:"none",strokeColor:"none",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+B,size:3},A.current={fillcolor:"var(--mainGray)",strokecolor:"var(--mainGray)"},H.current={fillcolor:"none",strokecolor:"none"},D.current={visible:!1,withLabel:!1,fixed:!1,fillColor:"var(--mainGray)",strokeColor:"var(--mainGray)",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+pe,size:2},e.draggable&&!e.fixed&&(ue(),e.bezierControlsAlwaysVisible&&($(),be()),l.updateRenderer(),C.current=e.numericalThroughPoints.length,j.current=[...e.vectorControlDirections])):t.on("down",function(a){V.current=!1,w({action:x.mouseDownOnCurve,args:{name:T}})}),t}function Z(){l.off("up",fe),o.current.off("down"),o.current.off("up"),l.removeObject(o.current),o.current=null,ce()}function ue(){p.current=[],i.current=[],c.current=[];for(let r=0;r<e.numericalThroughPoints.length;r++){let t=l.create("point",[...e.numericalThroughPoints[r]],Y.current);p.current.push(t);let a=l.create("point",[...e.numericalControlPoints[r][0]],D.current),u=l.create("point",[...e.numericalControlPoints[r][1]],D.current);i.current.push([a,u]);let f=l.create("segment",[t,a],k.current),m=l.create("segment",[t,u],k.current);c.current.push([f,m]),t.on("drag",g=>ae(r)),t.on("down",g=>de(r)),t.on("up",g=>se(r)),a.on("drag",g=>J(r,0)),u.on("drag",g=>J(r,1)),a.on("down",y),u.on("down",y),f.on("down",y),f.on("down",y),a.on("up",g=>W(r,0)),u.on("up",g=>W(r,1))}X.current=[]}function ce(){c.current.length>0&&(c.current.forEach(r=>r.forEach(t=>{t&&(t.off("down"),l.removeObject(t))})),c.current=[],i.current.forEach(r=>r.forEach(t=>{t&&(t.off("drag"),t.off("down"),t.off("up"),l.removeObject(t))})),i.current=[],p.current.forEach(r=>{r.off("drag"),r.off("down"),r.off("up"),l.removeObject(r)}),p.current=[])}function ae(r){S.current=r,K.current[r]=[p.current[r].X(),p.current[r].Y()],w({action:x.moveThroughPoint,args:{throughPoint:K.current[r],throughPointInd:r,transient:!0,skippable:!0}}),p.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,oe.current[r]),l.updateInfobox(p.current[r])}function se(r){S.current===r&&w({action:x.moveThroughPoint,args:{throughPoint:K.current[r],throughPointInd:r}})}function J(r,t){O.current=r+"_"+t,U.current[r]||(U.current[r]={}),U.current[r][t]=[i.current[r][t].X()-p.current[r].X(),i.current[r][t].Y()-p.current[r].Y()],w({action:x.moveControlVector,args:{controlVector:U.current[r][t],controlVectorInds:[r,t],transient:!0,skippable:!0}}),i.current[r][t].coords.setCoordinates(JXG.COORDS_BY_USER,[...le.current[r][t]]),l.updateInfobox(i.current[r][t])}function W(r,t){O.current===r+"_"+t&&w({action:x.moveControlVector,args:{controlVector:U.current[r][t],controlVectorInds:[r,t]}})}function $(){for(let r of p.current){for(let t in A.current)r.visProp[t]=A.current[t];r.needsUpdate=!0,r.update()}}function me(){for(let r of p.current){for(let t in H.current)r.visProp[t]=H.current[t];r.needsUpdate=!0,r.update()}}function ve(){for(let r of i.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());for(let r of c.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());X.current=[]}function be(){for(let r in i.current)_(r)}function fe(){!e.draggable||e.fixed||(I.current!==!0&&!e.bezierControlsAlwaysVisible&&(me(),ve(),l.updateRenderer()),I.current=!1)}function de(r,t){!e.draggable||e.fixed||(S.current=null,O.current=null,I.current=!0,$(),_(r),l.updateRenderer())}function _(r){if(!e.hiddenControls[r]){if(i.current[r][0]){let t=(r>0||e.extrapolateBackward)&&["symmetric","both","previous"].includes(q.current[r]);i.current[r][0].visProp.visible=t,i.current[r][0].visPropCalc.visible=t,i.current[r][0].needsUpdate=!0,i.current[r][0].update(),c.current[r][0].visProp.visible=t,c.current[r][0].visPropCalc.visible=t,c.current[r][0].needsUpdate=!0,c.current[r][0].update()}if(i.current[r][1]){let t=(r<p.current.length-1||e.extrapolateForward)&&["symmetric","both","next"].includes(q.current[r]);i.current[r][1].visProp.visible=t,i.current[r][1].visPropCalc.visible=t,i.current[r][1].needsUpdate=!0,i.current[r][1].update(),c.current[r][1].visProp.visible=t,c.current[r][1].visPropCalc.visible=t,c.current[r][1].needsUpdate=!0,c.current[r][1].update()}X.current[r]=!0}}function y(){!e.draggable||e.fixed||(S.current=null,O.current=null,I.current=!0,V.current=!1,$(),l.updateRenderer())}if(l)if(!o.current)o.current=ie();else if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)Z();else if(Q.current!==e.curveType||Q.current==="function"&&ne.current!==e.flipFunction)Z(),o.current=ie(),l.updateQuality===l.BOARD_QUALITY_LOW&&(l.itemsRenderedLowQuality[F]=o.current);else{l.updateQuality===l.BOARD_QUALITY_LOW&&(l.itemsRenderedLowQuality[F]=o.current),V.current=!0;let r=!e.hidden;o.current.name=e.labelForGraph,o.current.visProp.visible=r,o.current.visPropCalc.visible=r;let t=10*e.layer+he,a=o.current.visProp.layer!==t,u,f,m;a&&(u=10*e.layer+B,f=10*e.layer+B,m=10*e.layer+pe,o.current.setAttribute({layer:t}),k.current.layer=u,Y.current.layer=f,D.current.layer=m),o.current.visProp.strokecolor!==e.selectedStyle.lineColor&&(o.current.visProp.strokecolor=e.selectedStyle.lineColor,o.current.visProp.highlightstrokecolor=e.selectedStyle.lineColor),o.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(o.current.visProp.strokeopacity=e.selectedStyle.lineOpacity);let g=ge(e.selectedStyle.lineStyle,e.dashed);if(o.current.visProp.dash!==g&&(o.current.visProp.dash=g),o.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(o.current.visProp.strokewidth=e.selectedStyle.lineWidth),e.curveType==="parameterization"){let n=P(e.fDefinitions[0]),s=P(e.fDefinitions[1]);o.current.X=n,o.current.Y=s,o.current.minX=()=>e.parMin,o.current.maxX=()=>e.parMax}else if(e.curveType==="bezier")o.current.X=P(e.fDefinitions[0]),o.current.Y=P(e.fDefinitions[1]),o.current.minX=()=>e.parMin,o.current.maxX=()=>e.parMax;else{let n=P(e.fDefinitions[0]);if(e.flipFunction){o.current.X=n;let s=e.graphYmin,d=e.graphYmax,v=Math.max(s-(d-s)*.1,e.parMin),b=Math.min(d+(d-s)*.1,e.parMax);o.current.minX=()=>v,o.current.maxX=()=>b}else{o.current.Y=n;let s=e.graphXmin,d=e.graphXmax,v=Math.max(s-(d-s)*.1,e.parMin),b=Math.min(d+(d-s)*.1,e.parMax);o.current.minX=()=>v,o.current.maxX=()=>b}}if(o.current.needsUpdate=!0,o.current.updateCurve(),o.current.hasLabel&&(o.current.label.needsUpdate=!0,o.current.label.visPropCalc.visible=e.showLabel&&e.labelForGraph!=="",e.applyStyleToLabel?o.current.label.visProp.strokecolor=e.selectedStyle.lineColor:o.current.label.visProp.strokecolor="#000000",o.current.label.update()),e.curveType!=="bezier")return l.updateRenderer(),R(z,{children:R("a",{name:F})});if(!e.draggable||e.fixed)return c.current.length>0&&ce(),l.updateRenderer(),R(z,{children:R("a",{name:F})});if(c.current.length===0)return ue(),C.current=e.numericalThroughPoints.length,j.current=[...e.vectorControlDirections],l.updateRenderer(),R(z,{children:R("a",{name:F})});if(e.numericalThroughPoints.length>C.current){let n=C.current-1,s=Object.assign({},Y.current);p.current[n].visProp.fillcolor===A.current.fillcolor&&Object.assign(s,A.current);for(let d=C.current;d<e.numericalThroughPoints.length;d++){let v=l.create("point",[...e.numericalThroughPoints[d]],s);p.current.push(v);let b=l.create("point",[...e.numericalControlPoints[d][0]],D.current),L=l.create("point",[...e.numericalControlPoints[d][1]],D.current);i.current.push([b,L]);let re=l.create("segment",[v,b],k.current),te=l.create("segment",[v,L],k.current);c.current.push([re,te]),b.visProp.visible=!1,re.visProp.visible=!1,L.visProp.visible=!1,te.visProp.visible=!1,v.on("drag",M=>ae(d)),v.on("down",M=>de(d)),v.on("up",M=>se(d)),b.on("drag",M=>J(d,0)),b.on("down",y),b.on("up",M=>W(d,0)),L.on("drag",M=>J(d,1)),L.on("down",y),L.on("up",M=>W(d,1)),re.on("down",y),te.on("down",y)}X.current[n]&&_(n)}else if(e.numericalThroughPoints.length<C.current){for(let s=C.current-1;s>=e.numericalThroughPoints.length;s--){c.current[s][0].off("down"),c.current[s][1].off("down"),l.removeObject(c.current[s][0]),l.removeObject(c.current[s][1]),c.current.pop(),i.current[s][0].off("drag"),i.current[s][0].off("down"),i.current[s][0].off("up"),i.current[s][1].off("drag"),i.current[s][1].off("down"),i.current[s][1].off("up"),l.removeObject(i.current[s][0]),l.removeObject(i.current[s][1]),i.current.pop();let d=p.current.pop();d.off("drag"),d.off("down"),d.off("up"),l.removeObject(d)}let n=e.numericalThroughPoints.length-1;X.current[n]&&_(n)}let ee=Math.min(e.numericalThroughPoints.length,C.current);for(let n=0;n<ee;n++)j.current[n]!==e.vectorControlDirections[n]&&X.current[n]&&_(n),a&&(p.current[n].setAttribute({layer:f}),c.current[n][0].setAttribute({layer:u}),i.current[n][0].setAttribute({layer:m}),c.current[n][1].setAttribute({layer:u}),i.current[n][1].setAttribute({layer:m})),p.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalThroughPoints[n]]),p.current[n].needsUpdate=!0,p.current[n].update(),i.current[n][0].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][0]]),i.current[n][0].needsUpdate=!0,i.current[n][0].update(),c.current[n][0].needsUpdate=!0,c.current[n][0].update(),i.current[n][1].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][1]]),i.current[n][1].needsUpdate=!0,i.current[n][1].update(),c.current[n][1].needsUpdate=!0,c.current[n][1].update();for(let n=0;n<e.numericalThroughPoints.length;n++)p.current[n].visProp.visible=!e.hidden,p.current[n].visPropCalc.visible=!e.hidden;if(E.sourceInformation&&T in E.sourceInformation){let n=E.sourceInformation[T].throughPointMoved;n!==void 0?l.updateInfobox(p.current[n]):(n=E.sourceInformation[T].controlVectorMoved,n!==void 0&&l.updateInfobox(i.current[n[0]][n[1]]))}C.current=e.numericalThroughPoints.length,j.current=[...e.vectorControlDirections],l.updateRenderer()}return e.hidden?null:R(z,{children:R("a",{name:F})})});function ge(G,N){return G==="dashed"||N?2:G==="solid"?0:G==="dotted"?1:0}export{Fe as default};
