import{l as x,m as L,R as J,p as K,b as D,I as Q,j as d,N as W,a as P,F as X}from"./index-404de25b.js";import{assignmentData as Y,studentData as ee,overviewData as te,gradeCategories as se,Styles as oe,Table as re}from"./Gradebook-6711e381.js";import"./RoleDropdown-445d5eea.js";import"./DropdownMenu-c371d5a2.js";import"./setPrototypeOf-51e8cf87.js";function ce(){var B,T;let C=x(L("courseId")),a=x(L("userId"));const k=J(K);let o=D(Y),v=D(ee),I=D(te),M=x(Q(C));if((M==null?void 0:M.canViewCourse)=="0")return d("h1",{children:"No Access to view this page."});let s={};s.headers=[{Header:"Assignment",Footer:"Course Total",accessor:"assignment",disableFilters:!0,disableSortBy:!0}],s.rows=[];let c=0,n=0;if(o.state=="hasValue"&&v.state==="hasValue"&&I.state==="hasValue"&&a!==null&&a!==""){let u=0,V=Object.entries(o.contents);V.sort((g,r)=>g[1].sortOrder<r[1].sortOrder?-1:1);for(let{category:g,scaleFactor:r=1,maximumNumber:h=1/0,maximumValue:p=1/0}of se){s.rows.push({assignment:g});let m=[],S=[],w=[],N=!0;for(let[e]of V){let t=o.contents[e].category;if((t==null?void 0:t.toLowerCase())!==g.toLowerCase())continue;let j="-",y=o.contents[e].totalPointsOrPercent*1,A=I.contents[a].assignments[e];if(A===null&&o.contents[e].isGloballyAssigned==="0")continue;let F=y*A;const H=o.contents[e].assignedDate;S.push(y),m.push(F),F=Math.round(F*100)/100;let Z=Math.round(A*1e3)/10+"%";const q=W(H);(H==null||A>0||q<new Date)&&(j=y,w.push(y),N=!1);let E=d("a",{onClick:()=>{k({page:"course",tool:"gradebookStudentAssignment",view:"",params:{courseId:C,userId:a,doenetId:e,previousCrumb:"student"}})},style:{paddingLeft:"15px"},children:o.contents[e].label});s.rows.push({assignment:E,possiblepoints:y,assignedpoints:j,score:F,percentage:Z})}let G=m.length;m=m.sort((e,t)=>t-e).slice(0,h),w=w.sort((e,t)=>t-e).slice(0,h);let z=m.reduce((e,t)=>e+t,0)*r,U=w.reduce((e,t)=>e+t,0)*r,b=Math.min(z,p),i=Math.min(U,p);N&&(i="-"),S=S.sort((e,t)=>t-e).slice(0,h);let _=S.reduce((e,t)=>e+t,0)*r,l=Math.min(_,p),$="0%";l!==0&&($=Math.round(b/l*1e3)/10+"%"),n+=b,u+=l,i!="-"&&(c+=i,i=Math.round(i*100)/100),b=Math.round(b*100)/100,l=Math.round(l*100)/100;let f=[];G>h&&f.push(`top ${h} scores`),r!==1&&f.push(`rescaling by ${r*100}%`),_>p&&f.push(`a cap of ${p} points`),s.rows.push({assignment:P("b",{children:[`Subtotal for ${g}`,f.length>0&&P("div",{style:{fontSize:".7em"},children:["Based on ",f.join(",")]})]}),score:b,possiblepoints:l,assignedpoints:i,percentage:$})}let R=Math.round(n/u*1e3)/10+"%";n=Math.round(n*100)/100,u=Math.round(u*100)/100,c=Math.round(c*100)/100,s.headers.push({Header:"Possible Points",Footer:u,accessor:"possiblepoints",disableFilters:!0,disableSortBy:!0},{Header:"Assigned Points",Footer:c,accessor:"assignedpoints",disableFilters:!0,disableSortBy:!0},{Header:"Score",Footer:n,accessor:"score",disableFilters:!0,disableSortBy:!0},{Header:"Percentage",Footer:R,accessor:"percentage",disableFilters:!0,disableSortBy:!0})}let O=`${(B=v.contents[a])==null?void 0:B.firstName} ${(T=v.contents[a])==null?void 0:T.lastName}`;return P(X,{children:[d("div",{style:{marginLeft:"18px"},children:P("b",{children:["Gradebook for ",O]})}),d("div",{style:{marginLeft:"18px"},children:P("b",{children:["Current Score ",n,"/",c]})}),d(oe,{children:d(re,{disableSortBy:!0,columns:s.headers,data:s.rows})})]})}export{ce as default};
