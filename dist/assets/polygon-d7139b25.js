import{av as T,bn as B,r as d,l as N,bs as H,j as X,F as z}from"./index-ab5ab855.js";import{BoardContext as q,LINE_LAYER_OFFSET as V,VERTEX_LAYER_OFFSET as M}from"./graph-7de05658.js";import"./css-14ccef8c.js";import"./visibility-sensor-7b80a154.js";const ee=T.memo(function S(W){let{name:A,id:Y,SVs:e,actions:y,sourceOfUpdate:R,callAction:v}=B(W);S.ignoreActionsWithoutCore=!0;const c=d.useContext(q);let r=d.useRef(null),g=d.useRef(null),m=d.useRef(null),O=d.useRef(null),b=d.useRef(null),D=d.useRef(null),P=d.useRef(null),x=d.useRef(null),F=d.useRef(null);F.current=e.numericalVertices;const w=N(H);d.useEffect(()=>()=>{r.current&&E()},[]);function j(){if(!(e.nVertices>=2))return null;let l=!e.draggable||e.fixed,i=!e.verticesDraggable||e.fixed,o=w==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;o=o.toLowerCase();let s=w==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;s=e.filled?s.toLowerCase():"none",x.current={fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),visible:!i&&!e.hidden,withLabel:!1,layer:10*e.layer+M,highlight:!0};let f={highlight:!1,visible:!e.hidden,layer:10*e.layer+V,fixed:!0,strokeColor:o,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:o,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:J(e.selectedStyle.lineStyle)},a={name:e.labelForGraph,visible:!e.hidden,withLabel:e.showLabel&&e.labelForGraph!=="",fixed:l,layer:10*e.layer+V,fillColor:s,fillOpacity:e.selectedStyle.fillOpacity,highlightFillColor:s,highlightFillOpacity:e.selectedStyle.fillOpacity*.5,highlight:!l,vertices:x.current,borders:f};a.label={highlight:!1},e.labelHasLatex&&(a.label.useMathJax=!0),e.applyStyleToLabel?a.label.strokeColor=o:a.label.strokeColor="var(--canvastext)",e.filled&&(a.hasInnerPoints=!0),c.suspendUpdate();let C=[];for(let u of e.numericalVertices)C.push(c.create("point",[...u],x.current));let p=c.create("polygon",C,a);return L(p),p.on("drag",u=>_(-1,u)),p.on("up",u=>G(-1)),p.on("down",function(u){m.current=null,b.current=[u.x,u.y],D.current=p.vertices.map(h=>[...h.coords.scrCoords]),O.current===null&&v({action:y.mouseDownOnPolygon})}),c.unsuspendUpdate(),P.current=e.nVertices,p}function L(l){for(let i=0;i<e.nVertices;i++){let o=l.vertices[i];o.off("drag"),o.on("drag",s=>_(i,s)),o.off("up"),o.on("up",()=>G(i)),o.off("down"),o.on("down",s=>{m.current=null,b.current=[s.x,s.y],O.current=i,v({action:y.mouseDownOnPolygon})})}}function E(){for(let l=0;l<e.nVertices;l++){let i=r.current.vertices[l];i&&(i.off("drag"),i.off("up"),i.off("down"))}r.current.off("drag"),r.current.off("up"),r.current.off("down"),r.current.off("hit"),c.removeObject(r.current),r.current=null}function _(l,i){if(Math.abs(i.x-b.current[0])>.1||Math.abs(i.y-b.current[1])>.1)if(m.current=l,l===-1){g.current=I(i),v({action:y.movePolygon,args:{pointCoords:g.current,transient:!0,skippable:!0}});for(let o=0;o<e.nVertices;o++)r.current.vertices[o].coords.setCoordinates(JXG.COORDS_BY_USER,[...F.current[o]])}else g.current={},g.current[l]=[r.current.vertices[l].X(),r.current.vertices[l].Y()],v({action:y.movePolygon,args:{pointCoords:g.current,transient:!0,skippable:!0,sourceDetails:{vertex:l}}}),r.current.vertices[l].coords.setCoordinates(JXG.COORDS_BY_USER,[...F.current[l]]),c.updateInfobox(r.current.vertices[l])}function G(l){m.current===l?v(l===-1?{action:y.movePolygon,args:{pointCoords:g.current}}:{action:y.movePolygon,args:{pointCoords:g.current,sourceDetails:{vertex:l}}}):m.current===null&&(O.current===null||l!==-1)&&v({action:y.polygonClicked}),l!==-1&&(O.current=null)}function I(l){var i=c.origin.scrCoords;let o=[];for(let s=0;s<r.current.vertices.length-1;s++){let f=(D.current[s][1]+l.x-b.current[0]-i[1])/c.unitX,a=(i[2]-(D.current[s][2]+l.y-b.current[1]))/c.unitY;o.push([f,a])}return o}if(c)if(!r.current)r.current=j();else if(!(e.nVertices>=2))E();else{let l=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(l=!1),Number.isFinite(t[1])||(l=!1);if(e.nVertices>P.current){for(let t=P.current;t<e.nVertices;t++){let n=c.create("point",[...e.numericalVertices[t]],x.current);r.current.addPoints(n)}L(r.current)}else if(e.nVertices<P.current){for(let t=P.current-1;t>=e.nVertices;t--)r.current.vertices[t].off("drag"),r.current.vertices[t].off("down"),r.current.vertices[t].off("up"),r.current.removePoints(r.current.vertices[t]);L(r.current)}let i=!e.draggable||e.fixed,s=!(!e.verticesDraggable||e.fixed)&&!e.hidden;for(let t=0;t<e.nVertices;t++)r.current.vertices[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[t]]),r.current.vertices[t].needsUpdate=!0,r.current.vertices[t].update(),r.current.vertices[t].visProp.visible=s,r.current.vertices[t].visPropCalc.visible=s;if(R.sourceInformation&&A in R.sourceInformation){let t=R.sourceInformation[A].vertex;t!==void 0&&c.updateInfobox(r.current.vertices[t])}let f=!e.hidden;l||(f=!1),r.current.visProp.fixed=i,r.current.visProp.highlight=!i,r.current.visProp.visible=f,r.current.visPropCalc.visible=f;let a=10*e.layer+V,C=r.current.visProp.layer!==a,p,u;C&&(p=10*e.layer+V,u=10*e.layer+M,r.current.setAttribute({layer:a}));let h=w==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;h=h.toLowerCase();let k=w==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;k=e.filled?k.toLowerCase():"none",r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=h:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),r.current.visProp.fillcolor!==k&&(r.current.visProp.fillcolor=k,r.current.visProp.highlightfillcolor=k,r.current.visProp.hasinnerpoints=e.filled),r.current.visProp.fillopacity!==e.selectedStyle.fillOpacity&&(r.current.visProp.fillopacity=e.selectedStyle.fillOpacity,r.current.visProp.highlightfillopacity=e.selectedStyle.fillOpacity*.5),r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let t=0;t<r.current.borders.length;t++){let n=r.current.borders[t];n.visProp.visible=f,n.visPropCalc.visible=f,C&&n.setAttribute({layer:p}),n.visProp.strokecolor!==h&&(n.visProp.strokecolor=h,n.visProp.highlightstrokecolor=h),n.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(n.visProp.strokeopacity=e.selectedStyle.lineOpacity,n.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let U=J(e.selectedStyle.lineStyle);n.visProp.dash!==U&&(n.visProp.dash=U),n.visProp.strokewidth!==e.selectedStyle.lineWidth&&(n.visProp.strokewidth=e.selectedStyle.lineWidth,n.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),n.needsUpdate=!0,n.update()}if(C){x.current.layer=u;for(let t of r.current.vertices)t.setAttribute({layer:u}),t.needsUpdate=!0,t.update()}P.current=e.nVertices,c.updateRenderer()}return e.hidden?null:X(z,{children:X("a",{name:Y})})});function J(S){return S==="solid"?0:S==="dashed"?2:S==="dotted"?1:0}export{ee as default};
