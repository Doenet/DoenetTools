import{R as k,p as ue,e as c,s as b,b as A,y as pe,f as me,u as fe,r as w,o as he,G as ve,j as r,a as u,F as W,g as Z,D as be}from"./index-66847aab.js";import{attemptData as ge,studentData as Se,assignmentData as Ae,overviewData as we,Styles as ye,Table as Ie}from"./Gradebook-99969a7b.js";import{currentAttemptNumber as Ne,activityStatusAtom as xe}from"./AssignmentViewer-28bf5d8d.js";import{e as Le}from"./RoleDropdown-98d497ff.js";import"./DropdownMenu-fd0518ab.js";function De(){var O,_,G,j,H,U,$,B,Y;const ee=k(ue);let g=c(b("courseId")),o=c(b("doenetId")),a=c(b("userId")),S=c(b("attemptNumber")),te=c(b("previousCrumb")),p=A(ge(o)),y=A(Se);const D=k(Ne);let F=A(Ae),{canViewAndModifyGrades:R}=c(Le(g));const I=k(pe);let ae=A(we),se=me(),oe=fe();const v=Number((O=F.contents[o])==null?void 0:O.totalPointsOrPercent),ie=(_=F.contents[o])==null?void 0:_.label,N=(j=(G=p==null?void 0:p.contents)==null?void 0:G[a])==null?void 0:j.attempts;let[s,T]=w.useState(null),[l,ne]=w.useState(null),n={},x=0;w.useEffect(()=>{if(N){let e=Object.keys(N).map(Number),t=Math.max(0,...e);S&&S<t&&(t=S),T(t),D(t)}else console.log(">>>>TODO TELL THEM YOU HAVENT TAKEN YET")},[N,T,D,S]),w.useEffect(()=>{I(R!=="1"?["GradeSettings"]:[])},[R,I]);const re=he(({set:e})=>async({itemWeights:t,currentPage:i,activityAttemptNumberSetUp:m})=>{e(xe,{itemWeights:t,currentPage:i,activityAttemptNumberSetUp:m})});let L=c(ve(g));if((L==null?void 0:L.canViewCourse)=="0")return r("h1",{children:"No Access to view this page."});if(!o||!a)return null;async function le(e,t,i){const{data:{success:m,message:C,foundAttempt:f,attemptInfo:h,showSolutionInGradebook:ce,paginate:q}}=await Z.get("/api/getGradebookAssignmentAttempts.php",{params:{courseId:e,doenetId:t,userId:i}});let M={},J={},V="none";ce==="1"&&(V="button");for(let d of h){let K=d.attemptNumber,Q=d.variantIndex,X=J[d.cid];if(X)M[K]={cid:d.cid,variantIndex:Q,doenetML:X,solutionDisplayMode:V,paginate:q};else{const{data:z}=await Z.get(`/media/${d.cid}.doenet`);J[d.cid]=z,M[K]={cid:d.cid,variantIndex:Q,doenetML:z,solutionDisplayMode:V,paginate:q}}}ne(M)}if(l===null)return le(g,o,a),null;if(p.state=="hasValue"&&a!==null&&a!==""&&(x=Math.max(0,...Object.keys(l).map(Number))),n.headers=[{Header:"Score",Footer:"Possible Points",accessor:"score",disableFilters:!0}],n.rows=[],y.state=="hasValue"&&a!==null&&a!==""){let e={},t={};if(e.score="Percentage",t.score="Score",p.state=="hasValue"){for(let f=1;f<=x;f++){let h=p.contents[a].attempts[f];e["a"+f]=h?Math.round(h*1e3)/10+"%":"",t["a"+f]=h?Math.round(h*100*v)/100:""}let i=($=(U=(H=ae.contents)==null?void 0:H[a])==null?void 0:U.assignments)==null?void 0:$[o],m=Math.round(v*i*100)/100,C=Math.round(i*1e3)/10+"%";t.total=m,e.total=C}n.rows.push(t),n.rows.push(e)}n.headers.push({Header:"Assignment Total",Footer:v,accessor:"total",disableFilters:!0});for(let e=1;e<=x;e++)n.headers.push({Header:"Attempt "+e,Footer:v,accessor:"a"+e,disableFilters:!0,Cell:t=>u("a",{onClick:()=>{ee({page:"course",tool:"gradebookStudentAssignment",view:"",params:{courseId:g,doenetId:o,userId:a,attemptNumber:e,previousCrumb:te}})},children:[" ",t.value," "]})});let E=null,P=null;if(s>0&&l[s]){let e=l[s].cid,t=l[s].variantIndex,i=l[s].solutionDisplayMode,m=l[s].paginate;E=r(be,{cid:e,activityId:o,userId:a,forceDisable:!0,forceShowCorrectness:!0,forceShowSolution:i!=="none",forceUnsuppressCheckwork:!0,flags:{showCorrectness:!0,readOnly:!0,solutionDisplayMode:i,showFeedback:!0,showHints:!0,autoSubmit:!1,allowLoadState:!0,allowSaveState:!1,allowLocalState:!1,allowSaveSubmissions:!1,allowSaveEvents:!1},attemptNumber:s,idsIncludeActivityId:!1,requestedVariantIndex:t,updateActivityStatusCallback:re,paginate:m,location:oe,navigate:se,apiURLs:{loadActivityState:"/api/loadActivityState.php",saveActivityState:"/api/saveActivityState.php",initAssignmentAttempt:"/api/initAssignmentAttempt.php",recordEvent:"/api/recordEvent.php",saveCompleted:"/api/saveCompleted.php",loadPageState:"/api/loadPageState.php",savePageState:"/api/savePageState.php",saveCreditForItem:"/api/saveCreditForItem.php",reportSolutionViewed:"/api/reportSolutionViewed.php"},linkSettings:{viewURL:"/course?tool=assignment",editURL:"/public?tool=editor",useQueryParameters:!0}},`activityViewer${o}`),P=u("div",{style:{paddingLeft:"8px"},children:["Viewing attempt number ",s]})}else P=u("div",{style:{paddingLeft:"8px"},children:["No content available for attempt number ",s]});let de=`${(B=y.contents[a])==null?void 0:B.firstName} ${(Y=y.contents[a])==null?void 0:Y.lastName}`;return u(W,{children:[r("div",{style:{marginLeft:"18px"},children:u("b",{children:["Gradebook for ",de]})}),r("div",{style:{paddingLeft:"18px"},children:r("b",{children:ie})}),u("div",{style:{paddingLeft:"18px"},children:[v," Points Possible"]}),r(ye,{children:r(Ie,{columns:n.headers,data:n.rows})}),s>0?u(W,{children:[P,E]}):r("div",{children:"Click an attempt's grade to see your attempt"})]})}export{De as default};
