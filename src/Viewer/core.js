var _f=Object.create,Wn=Object.defineProperty,$f=Object.getPrototypeOf,zf=Object.prototype.hasOwnProperty,Hf=Object.getOwnPropertyNames,jf=Object.getOwnPropertyDescriptor;var qf=o=>Wn(o,"__esModule",{value:!0});var we=(o,t)=>()=>(t||(t={exports:{}},o(t.exports,t)),t.exports),ye=(o,t)=>{for(var e in t)Wn(o,e,{get:t[e],enumerable:!0})},Kf=(o,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Hf(t))!zf.call(o,n)&&n!=="default"&&Wn(o,n,{get:()=>t[n],enumerable:!(e=jf(t,n))||e.enumerable});return o},Mt=o=>Kf(qf(Wn(o!=null?_f($f(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);var Vn=we((Xn,cl)=>{(function(o,t){typeof Xn=="object"?cl.exports=Xn=t():typeof define=="function"&&define.amd?define([],t):o.CryptoJS=t()})(Xn,function(){var o=o||function(t,e){var n;if(typeof window!="undefined"&&window.crypto&&(n=window.crypto),!n&&typeof window!="undefined"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof window!="undefined"&&window.crypto&&(n=window.crypto),!n)try{n=require("crypto")}catch(b){}var r=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch(b){}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch(b){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function b(){}return function(g){var C;return b.prototype=g,C=new b,b.prototype=null,C}}(),i={},s=i.lib={},l=s.Base=function(){return{extend:function(b){var g=a(this);return b&&g.mixIn(b),(!g.hasOwnProperty("init")||this.init===g.init)&&(g.init=function(){g.$super.init.apply(this,arguments)}),g.init.prototype=g,g.$super=this,g},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var g in b)b.hasOwnProperty(g)&&(this[g]=b[g]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=s.WordArray=l.extend({init:function(b,g){b=this.words=b||[],g!=e?this.sigBytes=g:this.sigBytes=b.length*4},toString:function(b){return(b||d).stringify(this)},concat:function(b){var g=this.words,C=b.words,T=this.sigBytes,v=b.sigBytes;if(this.clamp(),T%4)for(var N=0;N<v;N++){var V=C[N>>>2]>>>24-N%4*8&255;g[T+N>>>2]|=V<<24-(T+N)%4*8}else for(var N=0;N<v;N+=4)g[T+N>>>2]=C[N>>>2];return this.sigBytes+=v,this},clamp:function(){var b=this.words,g=this.sigBytes;b[g>>>2]&=4294967295<<32-g%4*8,b.length=t.ceil(g/4)},clone:function(){var b=l.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var g=[],C=0;C<b;C+=4)g.push(r());return new u.init(g,b)}}),c=i.enc={},d=c.Hex={stringify:function(b){for(var g=b.words,C=b.sigBytes,T=[],v=0;v<C;v++){var N=g[v>>>2]>>>24-v%4*8&255;T.push((N>>>4).toString(16)),T.push((N&15).toString(16))}return T.join("")},parse:function(b){for(var g=b.length,C=[],T=0;T<g;T+=2)C[T>>>3]|=parseInt(b.substr(T,2),16)<<24-T%8*4;return new u.init(C,g/2)}},p=c.Latin1={stringify:function(b){for(var g=b.words,C=b.sigBytes,T=[],v=0;v<C;v++){var N=g[v>>>2]>>>24-v%4*8&255;T.push(String.fromCharCode(N))}return T.join("")},parse:function(b){for(var g=b.length,C=[],T=0;T<g;T++)C[T>>>2]|=(b.charCodeAt(T)&255)<<24-T%4*8;return new u.init(C,g)}},m=c.Utf8={stringify:function(b){try{return decodeURIComponent(escape(p.stringify(b)))}catch(g){throw new Error("Malformed UTF-8 data")}},parse:function(b){return p.parse(unescape(encodeURIComponent(b)))}},f=s.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=m.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var g,C=this._data,T=C.words,v=C.sigBytes,N=this.blockSize,V=N*4,x=v/V;b?x=t.ceil(x):x=t.max((x|0)-this._minBufferSize,0);var w=x*N,D=t.min(w*4,v);if(w){for(var I=0;I<w;I+=N)this._doProcessBlock(T,I);g=T.splice(0,w),C.sigBytes-=D}return new u.init(g,D)},clone:function(){var b=l.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0}),h=s.Hasher=f.extend({cfg:l.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){b&&this._append(b);var g=this._doFinalize();return g},blockSize:512/32,_createHelper:function(b){return function(g,C){return new b.init(C).finalize(g)}},_createHmacHelper:function(b){return function(g,C){return new y.HMAC.init(b,C).finalize(g)}}}),y=i.algo={};return i}(Math);return o})});var pl=we((Zn,dl)=>{(function(o,t){typeof Zn=="object"?dl.exports=Zn=t(Vn()):typeof define=="function"&&define.amd?define(["./core"],t):t(o.CryptoJS)})(Zn,function(o){return function(){var t=o,e=t.lib,n=e.WordArray,r=e.Hasher,a=t.algo,i=[],s=a.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,u){for(var c=this._hash.words,d=c[0],p=c[1],m=c[2],f=c[3],h=c[4],y=0;y<80;y++){if(y<16)i[y]=l[u+y]|0;else{var b=i[y-3]^i[y-8]^i[y-14]^i[y-16];i[y]=b<<1|b>>>31}var g=(d<<5|d>>>27)+h+i[y];y<20?g+=(p&m|~p&f)+1518500249:y<40?g+=(p^m^f)+1859775393:y<60?g+=(p&m|p&f|m&f)-1894007588:g+=(p^m^f)-899497514,h=f,f=m,m=p<<30|p>>>2,p=d,d=g}c[0]=c[0]+d|0,c[1]=c[1]+p|0,c[2]=c[2]+m|0,c[3]=c[3]+f|0,c[4]=c[4]+h|0},_doFinalize:function(){var l=this._data,u=l.words,c=this._nDataBytes*8,d=l.sigBytes*8;return u[d>>>5]|=128<<24-d%32,u[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),u[(d+64>>>9<<4)+15]=c,l.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var l=r.clone.call(this);return l._hash=this._hash.clone(),l}});t.SHA1=r._createHelper(s),t.HmacSHA1=r._createHmacHelper(s)}(),o.SHA1})});var fl=we((Jn,ml)=>{(function(o,t){typeof Jn=="object"?ml.exports=Jn=t(Vn()):typeof define=="function"&&define.amd?define(["./core"],t):t(o.CryptoJS)})(Jn,function(o){return function(){var t=o,e=t.lib,n=e.WordArray,r=t.enc,a=r.Base64={stringify:function(s){var l=s.words,u=s.sigBytes,c=this._map;s.clamp();for(var d=[],p=0;p<u;p+=3)for(var m=l[p>>>2]>>>24-p%4*8&255,f=l[p+1>>>2]>>>24-(p+1)%4*8&255,h=l[p+2>>>2]>>>24-(p+2)%4*8&255,y=m<<16|f<<8|h,b=0;b<4&&p+b*.75<u;b++)d.push(c.charAt(y>>>6*(3-b)&63));var g=c.charAt(64);if(g)for(;d.length%4;)d.push(g);return d.join("")},parse:function(s){var l=s.length,u=this._map,c=this._reverseMap;if(!c){c=this._reverseMap=[];for(var d=0;d<u.length;d++)c[u.charCodeAt(d)]=d}var p=u.charAt(64);if(p){var m=s.indexOf(p);m!==-1&&(l=m)}return i(s,l,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function i(s,l,u){for(var c=[],d=0,p=0;p<l;p++)if(p%4){var m=u[s.charCodeAt(p-1)]<<p%4*2,f=u[s.charCodeAt(p)]>>>6-p%4*2,h=m|f;c[d>>>2]|=h<<24-d%4*8,d++}return n.create(c,d)}}(),o.enc.Base64})});var xd=we(W=>{"use strict";var be=typeof Symbol=="function"&&Symbol.for,_s=be?Symbol.for("react.element"):60103,$s=be?Symbol.for("react.portal"):60106,fr=be?Symbol.for("react.fragment"):60107,hr=be?Symbol.for("react.strict_mode"):60108,br=be?Symbol.for("react.profiler"):60114,yr=be?Symbol.for("react.provider"):60109,gr=be?Symbol.for("react.context"):60110,zs=be?Symbol.for("react.async_mode"):60111,vr=be?Symbol.for("react.concurrent_mode"):60111,Cr=be?Symbol.for("react.forward_ref"):60112,Nr=be?Symbol.for("react.suspense"):60113,kh=be?Symbol.for("react.suspense_list"):60120,Tr=be?Symbol.for("react.memo"):60115,Vr=be?Symbol.for("react.lazy"):60116,Ph=be?Symbol.for("react.block"):60121,Rh=be?Symbol.for("react.fundamental"):60117,Bh=be?Symbol.for("react.responder"):60118,Fh=be?Symbol.for("react.scope"):60119;function Re(o){if(typeof o=="object"&&o!==null){var t=o.$$typeof;switch(t){case _s:switch(o=o.type,o){case zs:case vr:case fr:case br:case hr:case Nr:return o;default:switch(o=o&&o.$$typeof,o){case gr:case Cr:case Vr:case Tr:case yr:return o;default:return t}}case $s:return t}}}function Vd(o){return Re(o)===vr}W.AsyncMode=zs;W.ConcurrentMode=vr;W.ContextConsumer=gr;W.ContextProvider=yr;W.Element=_s;W.ForwardRef=Cr;W.Fragment=fr;W.Lazy=Vr;W.Memo=Tr;W.Portal=$s;W.Profiler=br;W.StrictMode=hr;W.Suspense=Nr;W.isAsyncMode=function(o){return Vd(o)||Re(o)===zs};W.isConcurrentMode=Vd;W.isContextConsumer=function(o){return Re(o)===gr};W.isContextProvider=function(o){return Re(o)===yr};W.isElement=function(o){return typeof o=="object"&&o!==null&&o.$$typeof===_s};W.isForwardRef=function(o){return Re(o)===Cr};W.isFragment=function(o){return Re(o)===fr};W.isLazy=function(o){return Re(o)===Vr};W.isMemo=function(o){return Re(o)===Tr};W.isPortal=function(o){return Re(o)===$s};W.isProfiler=function(o){return Re(o)===br};W.isStrictMode=function(o){return Re(o)===hr};W.isSuspense=function(o){return Re(o)===Nr};W.isValidElementType=function(o){return typeof o=="string"||typeof o=="function"||o===fr||o===vr||o===br||o===hr||o===Nr||o===kh||typeof o=="object"&&o!==null&&(o.$$typeof===Vr||o.$$typeof===Tr||o.$$typeof===yr||o.$$typeof===gr||o.$$typeof===Cr||o.$$typeof===Rh||o.$$typeof===Bh||o.$$typeof===Fh||o.$$typeof===Ph)};W.typeOf=Re});var wd=we(U=>{"use strict";import.meta.env.NODE_ENV!=="production"&&function(){"use strict";var o=typeof Symbol=="function"&&Symbol.for,t=o?Symbol.for("react.element"):60103,e=o?Symbol.for("react.portal"):60106,n=o?Symbol.for("react.fragment"):60107,r=o?Symbol.for("react.strict_mode"):60108,a=o?Symbol.for("react.profiler"):60114,i=o?Symbol.for("react.provider"):60109,s=o?Symbol.for("react.context"):60110,l=o?Symbol.for("react.async_mode"):60111,u=o?Symbol.for("react.concurrent_mode"):60111,c=o?Symbol.for("react.forward_ref"):60112,d=o?Symbol.for("react.suspense"):60113,p=o?Symbol.for("react.suspense_list"):60120,m=o?Symbol.for("react.memo"):60115,f=o?Symbol.for("react.lazy"):60116,h=o?Symbol.for("react.block"):60121,y=o?Symbol.for("react.fundamental"):60117,b=o?Symbol.for("react.responder"):60118,g=o?Symbol.for("react.scope"):60119;function C(M){return typeof M=="string"||typeof M=="function"||M===n||M===u||M===a||M===r||M===d||M===p||typeof M=="object"&&M!==null&&(M.$$typeof===f||M.$$typeof===m||M.$$typeof===i||M.$$typeof===s||M.$$typeof===c||M.$$typeof===y||M.$$typeof===b||M.$$typeof===g||M.$$typeof===h)}function T(M){if(typeof M=="object"&&M!==null){var na=M.$$typeof;switch(na){case t:var Kn=M.type;switch(Kn){case l:case u:case n:case a:case r:case d:return Kn;default:var el=Kn&&Kn.$$typeof;switch(el){case s:case c:case f:case m:case i:return el;default:return na}}case e:return na}}}var v=l,N=u,V=s,x=i,w=t,D=c,I=n,A=f,S=m,O=e,k=a,R=r,P=d,F=!1;function L(M){return F||(F=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),_(M)||T(M)===l}function _(M){return T(M)===u}function $(M){return T(M)===s}function z(M){return T(M)===i}function qe(M){return typeof M=="object"&&M!==null&&M.$$typeof===t}function $e(M){return T(M)===c}function Et(M){return T(M)===n}function Rf(M){return T(M)===f}function Bf(M){return T(M)===m}function Ff(M){return T(M)===e}function Lf(M){return T(M)===a}function Ef(M){return T(M)===r}function Mf(M){return T(M)===d}U.AsyncMode=v,U.ConcurrentMode=N,U.ContextConsumer=V,U.ContextProvider=x,U.Element=w,U.ForwardRef=D,U.Fragment=I,U.Lazy=A,U.Memo=S,U.Portal=O,U.Profiler=k,U.StrictMode=R,U.Suspense=P,U.isAsyncMode=L,U.isConcurrentMode=_,U.isContextConsumer=$,U.isContextProvider=z,U.isElement=qe,U.isForwardRef=$e,U.isFragment=Et,U.isLazy=Rf,U.isMemo=Bf,U.isPortal=Ff,U.isProfiler=Lf,U.isStrictMode=Ef,U.isSuspense=Mf,U.isValidElementType=C,U.typeOf=T}()});var js=we((dA,Hs)=>{"use strict";import.meta.env.NODE_ENV==="production"?Hs.exports=xd():Hs.exports=wd()});var Sd=we((pA,Dd)=>{"use strict";var Ad=Object.getOwnPropertySymbols,Lh=Object.prototype.hasOwnProperty,Eh=Object.prototype.propertyIsEnumerable;function Mh(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function _h(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var n=Object.getOwnPropertyNames(t).map(function(a){return t[a]});if(n.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(a){r[a]=a}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch(a){return!1}}Dd.exports=_h()?Object.assign:function(o,t){for(var e,n=Mh(o),r,a=1;a<arguments.length;a++){e=Object(arguments[a]);for(var i in e)Lh.call(e,i)&&(n[i]=e[i]);if(Ad){r=Ad(e);for(var s=0;s<r.length;s++)Eh.call(e,r[s])&&(n[r[s]]=e[r[s]])}}return n}});var xr=we((mA,Id)=>{"use strict";var $h="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";Id.exports=$h});var Bd=we((fA,Od)=>{"use strict";var qs=function(){};import.meta.env.NODE_ENV!=="production"&&(kd=xr(),wr={},Pd=Function.call.bind(Object.prototype.hasOwnProperty),qs=function(o){var t="Warning: "+o;typeof console!="undefined"&&console.error(t);try{throw new Error(t)}catch(e){}});var kd,wr,Pd;function Rd(o,t,e,n,r){if(import.meta.env.NODE_ENV!=="production"){for(var a in o)if(Pd(o,a)){var i;try{if(typeof o[a]!="function"){var s=Error((n||"React class")+": "+e+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof o[a]+"`.");throw s.name="Invariant Violation",s}i=o[a](t,a,n,e,null,kd)}catch(u){i=u}if(i&&!(i instanceof Error)&&qs((n||"React class")+": type specification of "+e+" `"+a+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof i+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),i instanceof Error&&!(i.message in wr)){wr[i.message]=!0;var l=r?r():"";qs("Failed "+e+" type: "+i.message+(l??""))}}}}Rd.resetWarningCache=function(){import.meta.env.NODE_ENV!=="production"&&(wr={})};Od.exports=Rd});var Ed=we((hA,Fd)=>{"use strict";var zh=js(),Hh=Sd(),on=xr(),Ld=Bd(),jh=Function.call.bind(Object.prototype.hasOwnProperty),ln=function(){};import.meta.env.NODE_ENV!=="production"&&(ln=function(o){var t="Warning: "+o;typeof console!="undefined"&&console.error(t);try{throw new Error(t)}catch(e){}});function Dr(){return null}Fd.exports=function(o,t){var e=typeof Symbol=="function"&&Symbol.iterator,n="@@iterator";function r(A){var S=A&&(e&&A[e]||A[n]);if(typeof S=="function")return S}var a="<<anonymous>>",i={array:c("array"),bool:c("boolean"),func:c("function"),number:c("number"),object:c("object"),string:c("string"),symbol:c("symbol"),any:d(),arrayOf:p,element:m(),elementType:f(),instanceOf:h,node:C(),objectOf:b,oneOf:y,oneOfType:g,shape:T,exact:v};function s(A,S){return A===S?A!==0||1/A==1/S:A!==A&&S!==S}function l(A){this.message=A,this.stack=""}l.prototype=Error.prototype;function u(A){if(import.meta.env.NODE_ENV!=="production")var S={},O=0;function k(P,F,L,_,$,z,qe){if(_=_||a,z=z||L,qe!==on){if(t){var $e=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw $e.name="Invariant Violation",$e}else if(import.meta.env.NODE_ENV!=="production"&&typeof console!="undefined"){var Et=_+":"+L;!S[Et]&&O<3&&(ln("You are manually calling a React.PropTypes validation function for the `"+z+"` prop on `"+_+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),S[Et]=!0,O++)}}return F[L]==null?P?F[L]===null?new l("The "+$+" `"+z+"` is marked as required "+("in `"+_+"`, but its value is `null`.")):new l("The "+$+" `"+z+"` is marked as required in "+("`"+_+"`, but its value is `undefined`.")):null:A(F,L,_,$,z)}var R=k.bind(null,!1);return R.isRequired=k.bind(null,!0),R}function c(A){function S(O,k,R,P,F,L){var _=O[k],$=x(_);if($!==A){var z=w(_);return new l("Invalid "+P+" `"+F+"` of type "+("`"+z+"` supplied to `"+R+"`, expected ")+("`"+A+"`."))}return null}return u(S)}function d(){return u(Dr)}function p(A){function S(O,k,R,P,F){if(typeof A!="function")return new l("Property `"+F+"` of component `"+R+"` has invalid PropType notation inside arrayOf.");var L=O[k];if(!Array.isArray(L)){var _=x(L);return new l("Invalid "+P+" `"+F+"` of type "+("`"+_+"` supplied to `"+R+"`, expected an array."))}for(var $=0;$<L.length;$++){var z=A(L,$,R,P,F+"["+$+"]",on);if(z instanceof Error)return z}return null}return u(S)}function m(){function A(S,O,k,R,P){var F=S[O];if(!o(F)){var L=x(F);return new l("Invalid "+R+" `"+P+"` of type "+("`"+L+"` supplied to `"+k+"`, expected a single ReactElement."))}return null}return u(A)}function f(){function A(S,O,k,R,P){var F=S[O];if(!zh.isValidElementType(F)){var L=x(F);return new l("Invalid "+R+" `"+P+"` of type "+("`"+L+"` supplied to `"+k+"`, expected a single ReactElement type."))}return null}return u(A)}function h(A){function S(O,k,R,P,F){if(!(O[k]instanceof A)){var L=A.name||a,_=I(O[k]);return new l("Invalid "+P+" `"+F+"` of type "+("`"+_+"` supplied to `"+R+"`, expected ")+("instance of `"+L+"`."))}return null}return u(S)}function y(A){if(!Array.isArray(A))return import.meta.env.NODE_ENV!=="production"&&(arguments.length>1?ln("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):ln("Invalid argument supplied to oneOf, expected an array.")),Dr;function S(O,k,R,P,F){for(var L=O[k],_=0;_<A.length;_++)if(s(L,A[_]))return null;var $=JSON.stringify(A,function(qe,$e){var Et=w($e);return Et==="symbol"?String($e):$e});return new l("Invalid "+P+" `"+F+"` of value `"+String(L)+"` "+("supplied to `"+R+"`, expected one of "+$+"."))}return u(S)}function b(A){function S(O,k,R,P,F){if(typeof A!="function")return new l("Property `"+F+"` of component `"+R+"` has invalid PropType notation inside objectOf.");var L=O[k],_=x(L);if(_!=="object")return new l("Invalid "+P+" `"+F+"` of type "+("`"+_+"` supplied to `"+R+"`, expected an object."));for(var $ in L)if(jh(L,$)){var z=A(L,$,R,P,F+"."+$,on);if(z instanceof Error)return z}return null}return u(S)}function g(A){if(!Array.isArray(A))return import.meta.env.NODE_ENV!=="production"&&ln("Invalid argument supplied to oneOfType, expected an instance of array."),Dr;for(var S=0;S<A.length;S++){var O=A[S];if(typeof O!="function")return ln("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+D(O)+" at index "+S+"."),Dr}function k(R,P,F,L,_){for(var $=0;$<A.length;$++){var z=A[$];if(z(R,P,F,L,_,on)==null)return null}return new l("Invalid "+L+" `"+_+"` supplied to "+("`"+F+"`."))}return u(k)}function C(){function A(S,O,k,R,P){return N(S[O])?null:new l("Invalid "+R+" `"+P+"` supplied to "+("`"+k+"`, expected a ReactNode."))}return u(A)}function T(A){function S(O,k,R,P,F){var L=O[k],_=x(L);if(_!=="object")return new l("Invalid "+P+" `"+F+"` of type `"+_+"` "+("supplied to `"+R+"`, expected `object`."));for(var $ in A){var z=A[$];if(!!z){var qe=z(L,$,R,P,F+"."+$,on);if(qe)return qe}}return null}return u(S)}function v(A){function S(O,k,R,P,F){var L=O[k],_=x(L);if(_!=="object")return new l("Invalid "+P+" `"+F+"` of type `"+_+"` "+("supplied to `"+R+"`, expected `object`."));var $=Hh({},O[k],A);for(var z in $){var qe=A[z];if(!qe)return new l("Invalid "+P+" `"+F+"` key `"+z+"` supplied to `"+R+"`.\nBad object: "+JSON.stringify(O[k],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(A),null,"  "));var $e=qe(L,z,R,P,F+"."+z,on);if($e)return $e}return null}return u(S)}function N(A){switch(typeof A){case"number":case"string":case"undefined":return!0;case"boolean":return!A;case"object":if(Array.isArray(A))return A.every(N);if(A===null||o(A))return!0;var S=r(A);if(S){var O=S.call(A),k;if(S!==A.entries){for(;!(k=O.next()).done;)if(!N(k.value))return!1}else for(;!(k=O.next()).done;){var R=k.value;if(R&&!N(R[1]))return!1}}else return!1;return!0;default:return!1}}function V(A,S){return A==="symbol"?!0:S?S["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&S instanceof Symbol:!1}function x(A){var S=typeof A;return Array.isArray(A)?"array":A instanceof RegExp?"object":V(S,A)?"symbol":S}function w(A){if(typeof A=="undefined"||A===null)return""+A;var S=x(A);if(S==="object"){if(A instanceof Date)return"date";if(A instanceof RegExp)return"regexp"}return S}function D(A){var S=w(A);switch(S){case"array":case"object":return"an "+S;case"boolean":case"date":case"regexp":return"a "+S;default:return S}}function I(A){return!A.constructor||!A.constructor.name?a:A.constructor.name}return i.checkPropTypes=Ld,i.resetWarningCache=Ld.resetWarningCache,i.PropTypes=i,i}});var zd=we((bA,Md)=>{"use strict";var qh=xr();function _d(){}function $d(){}$d.resetWarningCache=_d;Md.exports=function(){function o(n,r,a,i,s,l){if(l!==qh){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}o.isRequired=o;function t(){return o}var e={array:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:t,element:o,elementType:o,instanceOf:t,node:o,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:$d,resetWarningCache:_d};return e.PropTypes=e,e}});var qd=we((yA,Ks)=>{import.meta.env.NODE_ENV!=="production"?(Hd=js(),jd=!0,Ks.exports=Ed()(Hd.isElement,jd)):Ks.exports=zd()();var Hd,jd});var of=we((iO,sf)=>{var pt=function(o){o==null&&(o=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,o.constructor==Array?this.init_by_array(o,o.length):this.init_seed(o)};pt.prototype.init_seed=function(o){for(this.mt[0]=o>>>0,this.mti=1;this.mti<this.N;this.mti++){var o=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((o&4294901760)>>>16)*1812433253<<16)+(o&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};pt.prototype.init_by_array=function(o,t){var e,n,r;for(this.init_seed(19650218),e=1,n=0,r=this.N>t?this.N:t;r;r--){var a=this.mt[e-1]^this.mt[e-1]>>>30;this.mt[e]=(this.mt[e]^(((a&4294901760)>>>16)*1664525<<16)+(a&65535)*1664525)+o[n]+n,this.mt[e]>>>=0,e++,n++,e>=this.N&&(this.mt[0]=this.mt[this.N-1],e=1),n>=t&&(n=0)}for(r=this.N-1;r;r--){var a=this.mt[e-1]^this.mt[e-1]>>>30;this.mt[e]=(this.mt[e]^(((a&4294901760)>>>16)*1566083941<<16)+(a&65535)*1566083941)-e,this.mt[e]>>>=0,e++,e>=this.N&&(this.mt[0]=this.mt[this.N-1],e=1)}this.mt[0]=2147483648};pt.prototype.random_int=function(){var o,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var e;for(this.mti==this.N+1&&this.init_seed(5489),e=0;e<this.N-this.M;e++)o=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+this.M]^o>>>1^t[o&1];for(;e<this.N-1;e++)o=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+(this.M-this.N)]^o>>>1^t[o&1];o=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^o>>>1^t[o&1],this.mti=0}return o=this.mt[this.mti++],o^=o>>>11,o^=o<<7&2636928640,o^=o<<15&4022730752,o^=o>>>18,o>>>0};pt.prototype.random_int31=function(){return this.random_int()>>>1};pt.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};pt.prototype.random=function(){return this.random_int()*(1/4294967296)};pt.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};pt.prototype.random_long=function(){var o=this.random_int()>>>5,t=this.random_int()>>>6;return(o*67108864+t)*(1/9007199254740992)};sf.exports=pt});var Of=we((ea,If)=>{(function(o,t){typeof ea=="object"?If.exports=ea=t(Vn()):typeof define=="function"&&define.amd?define(["./core"],t):t(o.CryptoJS)})(ea,function(o){return function(t){var e=o,n=e.lib,r=n.WordArray,a=n.Hasher,i=e.algo,s=[],l=[];(function(){function d(h){for(var y=t.sqrt(h),b=2;b<=y;b++)if(!(h%b))return!1;return!0}function p(h){return(h-(h|0))*4294967296|0}for(var m=2,f=0;f<64;)d(m)&&(f<8&&(s[f]=p(t.pow(m,1/2))),l[f]=p(t.pow(m,1/3)),f++),m++})();var u=[],c=i.SHA256=a.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(d,p){for(var m=this._hash.words,f=m[0],h=m[1],y=m[2],b=m[3],g=m[4],C=m[5],T=m[6],v=m[7],N=0;N<64;N++){if(N<16)u[N]=d[p+N]|0;else{var V=u[N-15],x=(V<<25|V>>>7)^(V<<14|V>>>18)^V>>>3,w=u[N-2],D=(w<<15|w>>>17)^(w<<13|w>>>19)^w>>>10;u[N]=x+u[N-7]+D+u[N-16]}var I=g&C^~g&T,A=f&h^f&y^h&y,S=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),O=(g<<26|g>>>6)^(g<<21|g>>>11)^(g<<7|g>>>25),k=v+O+I+l[N]+u[N],R=S+A;v=T,T=C,C=g,g=b+k|0,b=y,y=h,h=f,f=k+R|0}m[0]=m[0]+f|0,m[1]=m[1]+h|0,m[2]=m[2]+y|0,m[3]=m[3]+b|0,m[4]=m[4]+g|0,m[5]=m[5]+C|0,m[6]=m[6]+T|0,m[7]=m[7]+v|0},_doFinalize:function(){var d=this._data,p=d.words,m=this._nDataBytes*8,f=d.sigBytes*8;return p[f>>>5]|=128<<24-f%32,p[(f+64>>>9<<4)+14]=t.floor(m/4294967296),p[(f+64>>>9<<4)+15]=m,d.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var d=a.clone.call(this);return d._hash=this._hash.clone(),d}});e.SHA256=a._createHelper(c),e.HmacSHA256=a._createHmacHelper(c)}(Math),o.SHA256})});var Pf=we((ta,kf)=>{(function(o,t){typeof ta=="object"?kf.exports=ta=t(Vn()):typeof define=="function"&&define.amd?define(["./core"],t):t(o.CryptoJS)})(ta,function(o){return o.enc.Hex})});var Sa={};ye(Sa,{Columns:()=>xl,Condition:()=>Bl,Description:()=>Ol,Else:()=>Fl,Input:()=>Il,Keyword:()=>kl,RightHandSide:()=>Sl,Seed:()=>Al,SortResults:()=>Rl,Target:()=>Pl,Title:()=>wl,Variant:()=>Dl,externalContent:()=>Ll});function te(o){return o.reduce((t,e)=>Array.isArray(e)?t.concat(te(e)):t.concat(e),[])}function ra(o,t){return console.log(`levels: ${t}`),o.reduce((e,n)=>Array.isArray(n)&&t>1?e.concat(ra(n,t-1)):e.concat(n),[])}var aa=class{constructor({parentComponentType:t,componentInfoObjects:e,components:n}){this.logicComponents={},this.parentComponentType=t,this.componentInfoObjects=e,this.components=n}setParentComponentType(t){this.parentComponentType=t}deleteAllLogic(){for(let t in this.logicComponents)t.substring(0,1)!=="_"&&delete this.logicComponents[t];delete this.baseLogic}newLeaf({name:t,componentType:e,comparison:n,number:r,requireConsecutive:a,condition:i,allowSpillover:s,excludeComponentTypes:l,excludeCompositeReplacements:u,setAsBase:c=!1,...d}){if(t===void 0)throw Error("Error in child logic of "+this.parentComponentType+": child logic leaf must be named");if(t.substring(0,1)==="_")throw Error("Error in child logic of "+this.parentComponentType+": child logic leaf name cannot begin with _");if(t in this.logicComponents)throw Error("Error in child logic of "+this.parentComponentType+": name "+t+" duplicated");if(Object.keys(d).length>0)throw Error("Error in child logic of "+this.parentComponentType+": unexpected arguments to child logic leaf named "+t);let p=new tl({name:t,componentType:e,excludeComponentTypes:l,excludeCompositeReplacements:u,comparison:n,number:r,requireConsecutive:a,condition:i,allowSpillover:s,parentComponentType:this.parentComponentType,componentInfoObjects:this.componentInfoObjects,components:this.components});return this.logicComponents[t]=p,c&&(this.baseLogic=p),p}newOperator({name:t,operator:e,propositions:n,sequenceMatters:r,requireConsecutive:a,allowSpillover:i,setAsBase:s=!1,...l}){if(t===void 0)throw Error("Error in child logic of "+this.parentComponentType+": child logic operator must be named");if(t.substring(0,1)==="_")throw Error("Error in child logic of "+this.parentComponentType+": child logic operator name cannot begin with _");if(t in this.logicComponents)throw Error("Error in child logic of "+this.parentComponentType+": name "+t+" duplicated");if(Object.keys(l).length>0)throw Error("Error in child logic of "+this.parentComponentType+": unexpected arguments to child logic operator named "+t);let u=new nl({name:t,operator:e,propositions:n,sequenceMatters:r,requireConsecutive:a,allowSpillover:i,parentComponentType:this.parentComponentType,componentInfoObjects:this.componentInfoObjects,components:this.components});return this.logicComponents[t]=u,s&&(this.baseLogic=u),u}getLogicComponent(t){return this.logicComponents[t]}applyLogic({activeChildren:t,maxAdapterNumber:e=0}){if(this.baseLogic===void 0)return t.length===0?this.logicResult={success:!0,childMatches:[]}:this.logicResult={success:!1,message:t.length+" extra children."},this.logicResult;try{this.logicResult=this.baseLogic.applyLogic({activeChildren:t,maxAdapterNumber:e})}catch(n){return console.warn("error encountered when evaluating child logic"),console.warn(n),this.logicResult={success:!1,message:n.message},this.logicResult}if(this.logicResult.success){let n=te(this.logicResult.childMatches);n.length!==t.length&&(this.logicResult={success:!1,message:t.length-n.length+" extra children."})}return this.logicResult}checkIfChildInLogic(t){return this.baseLogic===void 0?!1:this.baseLogic.checkIfChildInLogic(t)}returnMatches(t){if(this.baseLogic===void 0)return;if(this.logicResult.success!==!0)return t in this.logicComponents?[]:void 0;let e=this.baseLogic.indicesFromNames[t];if(e===void 0)return;let n=this.logicResult.childMatches;for(let r of e)if(n=n[r],n===void 0)return[];return n=te(n),n.sort((r,a)=>r-a),n}},rl=aa,Un=class{constructor({name:t,parentComponentType:e,componentInfoObjects:n,components:r}){this.name=t,this.parentComponentType=e,this.componentInfoObjects=n,this.components=r}applyLogic(){}checkIfChildInLogic(){}setIndicesFromNames(){this.indicesFromNames={}}},tl=class extends Un{constructor({name:t,componentType:e,excludeComponentTypes:n,excludeCompositeReplacements:r=!1,comparison:a="exactly",number:i=1,requireConsecutive:s=!1,condition:l,allowSpillover:u=!0,parentComponentType:c,componentInfoObjects:d,components:p}){super({name:t,parentComponentType:c,componentInfoObjects:d,components:p});if(this.componentType=e,this.excludeComponentTypes=n,this.excludeCompositeReplacements=r,this.comparison=a,this.number=i,this.requireConsecutive=s,this.condition=l,this.allowSpillover=u,!["atLeast","atMost","exactly"].includes(a))throw Error("Error in leaf "+t+" from child logic of "+this.parentComponentType+": comparision must be 'atLeast', 'atMost', or 'exactly'");if(!(Number.isInteger(i)&&i>=0))throw Error("Error in leaf "+t+" from child logic of "+this.parentComponentType+": number must be a non-negative integer");this.maxMatches=Infinity,this.allowSpillover&&(this.comparison==="atMost"||this.comparison==="exactly")&&(this.maxMatches=this.number),this.setIndicesFromNames()}setIndicesFromNames(){this.indicesFromNames={},this.indicesFromNames[this.name]=[]}applyLogic({activeChildren:t,previouslyMatched:e=[],maxAdapterNumber:n}){let r=[],a={};if(this.componentType in this.componentInfoObjects.allComponentClasses)for(let s=0;s<t.length;s++){if(e.includes(s))continue;let l=t[s],u=this.checkIfChildInLogic(l);if(u)r.push(s);else{let c;l.componentName?c=l.constructor.nAdapters:c=this.componentInfoObjects.allComponentClasses[l.componentType].nAdapters;let d=Math.min(n,c);for(let p=0;p<d;p++){let m;if(l.componentName?m=l.getAdapter(p):m={componentType:this.componentInfoObjects.allComponentClasses[l.componentType].getAdapterComponentType(p,this.componentInfoObjects.publicStateVariableInfo)},u=this.checkIfChildInLogic(m),u){r.push(s),a[s]=m;break}}}if(r.length===this.maxMatches)break}let i=r.length;if(this.comparison==="atLeast"){if(i<this.number)return{success:!1,message:"Need at least "+this.number+" "+this.componentType+" children, but found "+i+"."}}else if(this.comparison==="exactly"){if(i!==this.number)return{success:!1,message:"Need "+this.number+" "+this.componentType+" children, but found "+i+"."}}else if(this.comparison==="atMost"&&i>this.number)return{success:!1,message:"Need at most "+this.number+" "+this.componentType+" children, but found "+i+"."};if(this.requireConsecutive===!0){for(let s=1;s<i;s++)if(r[s]!==r[s-1]+1)return{success:!1,message:this.componentType+" children must be consecutive."}}return{success:!0,childMatches:r,adapterResults:a}}checkIfChildInLogic(t){let e=!1;if(this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:this.componentType})){if(e=!0,this.componentType==="_base"&&this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"_composite"})&&(e=!1),this.condition&&!this.condition(t))e=!1;else if(this.excludeComponentTypes){for(let n of this.excludeComponentTypes)if(this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:n})){e=!1;break}}e&&this.excludeCompositeReplacements&&t.replacementOf&&(e=!1)}return e}},nl=class extends Un{constructor({name:t,operator:e,propositions:n=[],sequenceMatters:r=!1,requireConsecutive:a=!1,allowSpillover:i=!0,parentComponentType:s,componentInfoObjects:l,components:u}){super({name:t,parentComponentType:s,componentInfoObjects:l,components:u});this.operator=e,this.propositions=n,this.sequenceMatters=r,this.requireConsecutive=a,this.allowSpillover=i;for(let c of n){if(!(c instanceof Un))throw Error("Error in operator "+t+" from child logic of "+this.parentComponentType+": each proposition must be a child logic leaf or operator");if(!["and","or","xor"].includes(e))throw Error("Error in operator "+t+" from child logic of "+this.parentComponentType+": operator must be 'and', 'or', or 'xor'")}this.setIndicesFromNames()}setIndicesFromNames(){this.indicesFromNames={},this.indicesFromNames[this.name]=[];for(let t in this.propositions){let e=this.propositions[t];for(let n in e.indicesFromNames){if(n in this.indicesFromNames)throw Error("Child logic name used multiple times: "+n);let r=e.indicesFromNames[n];this.indicesFromNames[n]=[t,...r]}}}applyLogic({activeChildren:t,previouslyMatched:e=[],maxAdapterNumber:n}){let r=[],a={},i=0,s=[],l=e.slice(0);for(let u of this.propositions){let c=u.applyLogic({activeChildren:t,previouslyMatched:l,maxAdapterNumber:n});if(c.name=u.name,s.push(c),c.success===!0)i++,r.push(c.childMatches),a=Object.assign(a,c.adapterResults),this.operator!=="xor"&&(l=[...l,...te(c.childMatches)]);else{if(this.operator==="and")return{success:!1,message:c.message};r.push([])}}if(this.operator==="or"){if(i===0){let u="Or criterion not matched. (";for(let c of s)u+=c.message+" ";return u+=")",{success:!1,message:u}}}else if(this.operator==="xor"){if(i===0||!this.allowSpillover&&i>1){let u="Xor criterion not matched. (";if(i===0)for(let c of s)u+=c.message+" ";else u+=i+" criteria matched and spillover not allowed.";return u+=")",{success:!1,message:u}}if(i>1){let u=Infinity,c;for(let d in r){let p=r[d],m=te(p);if(m.length>0){let f=Math.min(...m);f<u&&(u=f,c=d)}}for(let d in r)d!==c&&(r[d]=[]);c!==void 0&&(a=s[c].adapterResults)}}if(i>1&&this.sequenceMatters===!0){let u=-1;for(let c of r){let d=te(c);if(d.length>0){if(Math.min(...d)<=u)return{success:!1,message:"Active children were in wrong order."};u=Math.max(...d)}}}if(this.requireConsecutive===!0){let u=te(r);u.sort((d,p)=>d-p);let c=u.length;for(let d=1;d<c;d++)if(u[d]!==u[d-1]+1)return{success:!1,message:"Active children must be consecutive."}}return{success:!0,childMatches:r,adapterResults:a}}checkIfChildInLogic(t){return this.propositions.some(e=>e.checkIfChildInLogic(t))}};var al={get:function(o,t){if(t==="__isReadOnlyProxy")return!0;let e=o[t];return e!==null&&typeof e=="object"&&e.__isReadOnlyProxy!==!0?new Proxy(e,al):e},set:function(o,t,e){throw Error("Property "+t+" is read-only")},deleteProperty:function(o,t){throw Error("Property "+t+" is read-only")}},q=al;function ia(){return{get:function(o,t){let e=o[t];return e!==void 0&&(e.isArray&&(e.public||e.trackChanges)?e=new Proxy(e.value,il({variable:t,nDimensions:e.nDimensions})):(e=e.value,e!==null&&typeof e=="object"&&e.__isReadOnlyProxy!==!0&&(e=new Proxy(e,q)))),e},set:function(o,t,e){throw Error("Property "+t+" is read-only")},deleteProperty:function(o,t){throw Error("Property "+t+" is read-only")}}}function il({variable:o,nDimensions:t,indicesSoFar:e=[]}){return{variable:o,nDimensions:t,indicesSoFar:e,get:function(n,r){let a=n[r];return a!==null&&typeof a=="object"&&t>1&&(a=new Proxy(a,il({variable:this.variable,nDimensions:this.nDimensions-1,indicesSoFar:[...this.indicesSoFar,r]}))),a},set:function(n,r,a){throw Error("Property "+r+" is read-only")},deleteProperty:function(n,r){throw Error("Property "+r+" is read-only")}}}import sa from"math-expressions";function H(o,t,e){if(Object(o)!==o||o instanceof Function||t!==void 0&&o instanceof t)return o;if(o instanceof sa.class)return o.copy();if(e===void 0&&(e=new WeakMap),Array.isArray(o))return[...o.map(r=>H(r,t,e))];if(o.constructor===Object&&Object.entries(o).length===0)return{};if(e.has(o))return e.get(o);try{var n=new o.constructor}catch(r){n=Object.create(Object.getPrototypeOf(o))}return o instanceof Map?Array.from(o,([r,a])=>n.set(H(r,t,e),H(a,t,e))):o instanceof Set&&Array.from(o,r=>n.add(H(r,t,e))),e.set(o,n),Object.assign(n,...Object.keys(o).map(r=>({[r]:H(o[r],t,e)})))}function _t(o,t,e){var n,r;function a(i,s){var l;if(Number.isNaN(i)&&Number.isNaN(s)||i===s)return!0;if(e!==void 0&&i instanceof e&&s instanceof e)return i.componentName===s.componentName;if(i instanceof sa.class&&s instanceof sa.class)return i.equalsViaSyntax(s);if(typeof i=="function"&&typeof s=="function"||i instanceof Date&&s instanceof Date||i instanceof RegExp&&s instanceof RegExp||i instanceof String&&s instanceof String||i instanceof Number&&s instanceof Number)return i.toString()===s.toString();if(!(i instanceof Object&&s instanceof Object)||i.isPrototypeOf(s)||s.isPrototypeOf(i)||i.constructor!==s.constructor||i.prototype!==s.prototype||n.indexOf(i)>-1||r.indexOf(s)>-1)return!1;for(l in s){if(s.hasOwnProperty(l)!==i.hasOwnProperty(l))return!1;if(typeof s[l]!=typeof i[l])return!1}for(l in i){if(s.hasOwnProperty(l)!==i.hasOwnProperty(l))return!1;if(typeof s[l]!=typeof i[l])return!1;switch(typeof i[l]){case"object":case"function":if(n.push(i),r.push(s),!a(i[l],s[l]))return!1;n.pop(),r.pop();break;default:if(i[l]!==s[l])return!1;break}}return!0}return n=[],r=[],a(o,t)}var oa=class{constructor({componentName:t,ancestors:e,serializedComponent:n,definingChildren:r,serializedChildren:a,childLogic:i,attributes:s,stateVariableDefinitions:l,componentInfoObjects:u,coreFunctions:c,flags:d,shadow:p,numerics:m,parentSharedParameters:f,sharedParameters:h}){this.numerics=m,this.parentSharedParameters=f,this.sharedParameters=h,this.componentName=t,this.ancestors=e,this.counters={},this.componentInfoObjects=u,this.coreFunctions=c,this.flags=d,p===!0&&(this.isShadow=!0),this.definingChildren=r,this.definingChildren===void 0&&(this.definingChildren=[]),this.serializedChildren=a,this.childLogic=i,this.attributes=s,this.state={};for(let y in l)this.state[y]=Object.assign({},l[y]);this.stateValues=new Proxy(this.state,ia()),n.state&&(this.potentialEssentialState=new Proxy(n.state,q)),this.doenetAttributes={},n.doenetAttributes!==void 0&&Object.assign(this.doenetAttributes,n.doenetAttributes),n.variants!==void 0&&(this.variants=n.variants)}static componentType="_base";static get rendererType(){return this.componentType}get componentType(){return this.constructor.componentType}get rendererType(){return this.constructor.rendererType}get allPotentialRendererTypes(){if(!this.rendererType)return[];let t=[this.rendererType];for(let e in this.state){let n=this.state[e];if(n.public){let r=n.componentType;Array.isArray(r)||(r=[r]),n.wrappingComponents&&r.push(...te(n.wrappingComponents).map(a=>typeof a=="object"?a.componentType:a));for(let a of r){let i=this.componentInfoObjects.allComponentClasses[a];if(i){let s=i.rendererType;s&&!t.includes(s)&&t.push(s)}}}}for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}return t}readOnlyProxyHandler=q;potentialRendererTypesFromSerializedComponents(t){let e=[];for(let n of t){let a=this.componentInfoObjects.allComponentClasses[n.componentType].rendererType;if(a&&!e.includes(a)&&e.push(a),n.children){let i=this.potentialRendererTypesFromSerializedComponents(n.children);for(let s of i)e.includes(s)||e.push(s)}}return e}get childLogicSatisfied(){return this.childLogic.logicResult&&this.childLogic.logicResult.success&&!this.placeholderActiveChildrenIndices}get childLogicSatisfiedWithPlaceholders(){return this.childLogic.logicResult&&this.childLogic.logicResult.success}static createAttributesObject({flags:t={}}={}){return{hide:{createComponentOfType:"boolean",createStateVariable:"hide",defaultValue:!1,public:!0},disabled:{createComponentOfType:"boolean",createStateVariable:"disabled",defaultValue:!!t.readOnly,public:!0,forRenderer:!0,propagateToDescendants:!0},modifyIndirectly:{createComponentOfType:"boolean",createStateVariable:"modifyIndirectly",defaultValue:!0,public:!0,propagateToProps:!0},fixed:{createComponentOfType:"boolean",createStateVariable:"fixed",defaultValue:!1,public:!0},styleNumber:{createComponentOfType:"number",createStateVariable:"styleNumber",defaultValue:1,public:!0,propagateToDescendants:!0},isResponse:{createComponentOfType:"boolean",createStateVariable:"isResponse",defaultValue:!1,public:!0},newNamespace:{createPrimitiveOfType:"boolean"}}}static returnSugarInstructions(){return[]}static returnChildLogic({componentInfoObjects:t,components:e}){return new rl({parentComponentType:this.componentType,componentInfoObjects:t,components:e})}static returnStateVariableDefinitions(){let t={};return t.hidden={public:!0,componentType:"boolean",forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide",variablesOptional:!0},parentHidden:{dependencyType:"parentStateVariable",variableName:"hidden"},parentOverrideChildHide:{dependencyType:"parentStateVariable",variableName:"overrideChildHide"},sourceCompositeHidden:{dependencyType:"sourceCompositeStateVariable",variableName:"hidden"},adapterSourceHidden:{dependencyType:"adapterSourceDependency",variableName:"hidden"}}),definition:({dependencyValues:e})=>({newValues:{hidden:e.parentHidden===!0||e.sourceCompositeHidden===!0||e.adapterSourceHidden===!0||e.hide===!0&&!e.parentOverrideChildHide}})},t.isInactiveCompositeReplacement={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{isInactiveCompositeReplacement:{variablesToCheck:["isInactiveCompositeReplacement"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:{variableName:"isInactiveCompositeReplacement",value:e.isInactiveCompositeReplacement}}]}}},t}static returnNormalizedStateVariableDefinitions({attributeNames:t,numerics:e}){let n=this.returnStateVariableDefinitions({attributeNames:t,numerics:e});if(!n)throw Error(`Error in state variable definitions of ${this.componentType}: returnStateVariableDefinitions did not return anything`);let r=function(s){for(let[l,u]of s.entries())typeof u=="object"&&(s[l]=u.variableName)},a=["returnDependencies","definition","inverseDefinition","stateVariablesDeterminingDependencies","isArray","nDimensions","returnArraySizeDependencies","returnArraySize","returnArrayDependenciesByKey","arrayDefinitionByKey","inverseArrayDefinitionByKey","basedOnArrayKeyStateVariables","markStale","getPreviousDependencyValuesForMarkStale","determineDependenciesImmediately"],i={};for(let s in n){let l=n[s];if(i[s]=l,l.additionalStateVariablesDefined){for(let[u,c]of l.additionalStateVariablesDefined.entries()){let d={};for(let m of a)m in l&&(d[m]=l[m]);d.additionalStateVariablesDefined=[...l.additionalStateVariablesDefined],d.additionalStateVariablesDefined[u]=s,r(d.additionalStateVariablesDefined);let p=c;typeof c=="object"&&(p=c.variableName,c=Object.assign({},c),delete c.variableName,Object.assign(d,c)),i[p]=d}r(l.additionalStateVariablesDefined)}}return i}static returnStateVariableInfo({onlyPublic:t=!1,flags:e}){let n=this.createAttributesObject({flags:e}),r={},a={},i={};for(let l in n){let u=n[l].componentType;r[l]={componentType:u||l,public:!0}}let s=this.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(r)});for(let l in s){let u=s[l];if(u.isAlias){i[l]=u.targetVariableName;continue}if((!t||u.public)&&(r[l]={componentType:u.componentType,public:u.public,containsComponentNamesToCopy:u.containsComponentNamesToCopy},u.isArray&&(r[l].isArray=!0,r[l].nDimensions=u.nDimensions===void 0?1:u.nDimensions,r[l].wrappingComponents=u.returnWrappingComponents?u.returnWrappingComponents():[],u.entryPrefixes)))for(let c of u.entryPrefixes)a[c]={arrayVariableName:l,nDimensions:u.returnEntryDimensions?u.returnEntryDimensions(c):1,wrappingComponents:u.returnWrappingComponents?u.returnWrappingComponents(c):[]}}return{stateVariableDescriptions:r,arrayEntryPrefixes:a,aliases:i}}get parentName(){if(!(this.ancestors===void 0||this.ancestors.length===0))return this.ancestors[0].componentName}getAllChildrenDownstreamComponentNames(t=!1){let e=Object.keys(this.allChildren),n=Object.keys(this.downstreamDependencies);return t!==!0&&(n=n.filter(r=>this.downstreamDependencies[r].inactive!==!0)),[...e,...n]}get allDescendants(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;t=[...t,e,...n.allDescendants]}return t}static useChildrenForReference=!0;static get stateVariablesShadowedForReference(){return[]}returnSerializeInstructions(){return{}}serialize(t={}){let e=!0,n=[];if(t.forCopy)e=!0;else{let s=this.returnSerializeInstructions();s.skipChildren&&(e=!1),s.stateVariables&&(n=s.stateVariables)}let r={componentType:this.componentType},a=[];if(e){for(let s of this.definingChildren)a.push(s.serialize(t));if(this.serializedChildren!==void 0)for(let s of this.serializedChildren)a.push(this.copySerializedComponent({serializedComponent:s,parameters:t}));a.length>0&&(r.children=a)}let i=this.constructor.createAttributesObject({flags:this.flags});r.attributes={};for(let s in this.attributes){let l=this.attributes[s];l.componentType?i[s].copyComponentOnReference&&(r.attributes[s]=l.serialize(t)):r.attributes[s]=l}if(t.forCopy){r.originalName=this.componentName,r.originalDoenetAttributes=H(this.doenetAttributes),r.doenetAttributes=H(this.doenetAttributes);for(let s in this.attributes);r.originalAttributes=H(r.attributes),delete r.doenetAttributes.prescribedName,delete r.doenetAttributes.assignNames}else{console.warn("serializing a component without forCopy set is not yet converted!!!!");let s={};for(let u in this._state)if(this.state[u].essential||n.includes(u)){let c=this.state[u].value;this.state[u].usedDefault||(s[u]=c)}Object.keys(s).length>0&&(r.state=s);let l=Object.assign({},this.doenetAttributes);Object.keys(l).length>0&&(r.doenetAttributes=l)}return r}copySerializedComponent({serializedComponent:t,parameters:e}){let n=[];if(t.children!==void 0)for(let a of t.children)n.push(this.copySerializedComponent({serializedComponent:a,parameters:e}));let r={componentType:t.componentType,originalName:t.componentName,originalNameFromSerializedComponent:!0,children:n,state:{},doenetAttributes:{}};return t.doenetAttributes!==void 0&&(r.originalDoenetAttributes=H(t.doenetAttributes),r.doenetAttributes=H(t.doenetAttributes),r.originalAttributes=H(t.attributes),r.attributes=H(t.attributes),delete r.doenetAttributes.prescribedName,delete r.doenetAttributes.assignNames),t.state!==void 0&&Object.assign(r.state,t.state),r}static adapters=[];static get nAdapters(){return this.adapters.length}getAdapter(t){if(t>=this.constructor.adapters.length)return;let e=this.constructor.adapters[t],n,r;typeof e=="string"?n=e:(n=e.stateVariable,r=e.componentType);let a=this.state[n];if(a===void 0||!a.public&&!r)throw Error("Invalid adapter "+n+" in "+this.componentType);return r===void 0&&(r=a.componentType),{componentType:r,downstreamDependencies:{[this.componentName]:[{dependencyType:"adapter",adapterVariable:n,adapterTargetIdentity:{componentName:this.componentName,componentType:this.componentType}}]}}}static getAdapterComponentType(t,e){if(t>=this.adapters.length)return;let n=this.adapters[t],r,a;if(typeof n=="string"?r=n:(r=n.stateVariable,a=n.componentType),a===void 0){let s=e[this.componentType].stateVariableDescriptions[r];if(!s)throw Error("Invalid adapter "+r+" in "+this.componentType);if(a=s.componentType,!a)throw Error(`Couldn't get adapter component type for ${r} of componentType ${this.componentType}`)}return a}},B=oa;var la=class extends B{static componentType="_inline"},E=la;import ca from"math-expressions";import De from"math-expressions";import J from"math-expressions";import Ne from"math-expressions";var Gn=["abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg","min","max","mean","median","floor","ceil","round","sum","prod","var","std","count","mod"],Z=new Ne.converters.textToAstObj({appliedFunctionSymbols:Gn}),Ke=new Ne.converters.latexToAstObj({appliedFunctionSymbols:Gn});function We({value:o,simplify:t,expand:e=!1,createVectors:n=!1,createIntervals:r=!1}){return n&&(o=o.tuples_to_vectors()),r&&(o=o.to_intervals()),e&&(o=o.expand()),t==="full"?o.simplify():t==="numbers"?o.evaluate_numbers():t==="numberspreserveorder"?o.evaluate_numbers({skip_ordering:!0}):o}function de(o){if(o!==void 0)return Number.isFinite(o)||o.evaluate_to_constant!==void 0&&(o=o.evaluate_to_constant(),Number.isFinite(o))?o:null}function ne(o){return o==null?Ne.fromAst("\uFF3F"):o instanceof Ne.class?o:typeof o=="number"||typeof o=="string"?Ne.fromAst(o):Ne.fromAst("\uFF3F")}function sl(o,t){if(!Number.isInteger(o)||o<1)return[];let e=t.length;if(e===0){if(o===1)return[Ne.fromAst("x")];if(o===2)return[Ne.fromAst("x"),Ne.fromAst("y")];if(o===3)return[Ne.fromAst("x"),Ne.fromAst("y"),Ne.fromAst("z")];{let a=[];for(let i=1;i<=o;i++)a.push(Ne.fromAst(Z.convert(`x_${i}`)));return a}}if(new Set(t.map(a=>a.toString())).size<e&&console.warn("Duplicate variables specified"),o<=e)return t.slice(0,o);let n=[...t.map(a=>a.toString())],r=[...t];for(let a=e+1;a<=o;a++){let i;a==1?o>3?i=["x_1"]:i=["x"]:a==2?o>3?i=["x_2","y_2"]:i=["y","x_2"]:a==3?o>3?i=["x_3","y_3","z_3"]:i=["z","x_3","z_3"]:i=["x","y","z","u","v","w","X","Y","Z"].map(l=>`${l}_${a}`);let s=!1;for(let l of i)if(!n.includes(l)){r.push(Ne.fromAst(Z.convert(l))),n.push(l),s=!0;break}if(!s){let l=i[0];r.push(Ne.fromAst(Z.convert(l))),n.push(l),console.warn("Variables added were not unique")}}return r}function ol({desiredVector:o,currentVector:t,workspace:e,workspaceKey:n}){if(o.tree[0]==="vector"&&t.tree[0]==="vector"){let r;e[n]?r=e[n].slice(0):r=t.tree.slice(0);for(let[a,i]of o.tree.entries())i!==void 0&&(r[a]=i);o=Ne.fromAst(r),e[n]=r}return o}var ua=class extends E{static componentType="math";static primaryStateVariableForDefinition="unnormalizedValue";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["unnormalizedValue"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0,validValues:["text","latex"]},e.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={createComponentOfType:"boolean",createStateVariable:"expand",defaultValue:!1,public:!0},e.displayDigits={createComponentOfType:"number",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"number",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"boolean",createStateVariable:"displaySmallAsZero",defaultValue:!1,public:!0},e.renderMode={createComponentOfType:"text",createStateVariable:"renderMode",defaultValue:"inline",public:!0,forRenderer:!0},e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.createVectors={createComponentOfType:"boolean",createStateVariable:"createVectors",defaultValue:!1,public:!0},e.createIntervals={createComponentOfType:"boolean",createStateVariable:"createIntervals",defaultValue:!1,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0});return e.newOperator({name:"stringsAndMaths",operator:"and",propositions:[n,r],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.valueShadow={defaultValue:J.fromAst("\uFF3F"),returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{valueShadow:{variablesToCheck:["value","valueShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"valueShadow",value:e.valueShadow}]}}},t.codePre={returnDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"]}}),definition:Wf},t.expressionWithCodes={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childLogicName:"stringsAndMaths",variableNames:["value"]},format:{dependencyType:"stateVariable",variableName:"format"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:Uf},t.unnormalizedValue={returnDependencies:()=>({mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","canBeModified"]},stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"}}),set:ne,defaultValue:J.fromAst("\uFF3F"),definition:Gf,inverseDefinition:Jf},t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({unnormalizedValue:{dependencyType:"stateVariable",variableName:"unnormalizedValue"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:function({dependencyValues:e}){let n=e.unnormalizedValue,{simplify:r,expand:a,createVectors:i,createIntervals:s}=e;return n=We({value:n,simplify:r,expand:a,createVectors:i,createIntervals:s}),{newValues:{value:n}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"unnormalizedValue",desiredValue:e.value}]}}},t.number={public:!0,componentType:"number",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let n=e.value.evaluate_to_constant();return n===null&&(n=NaN),{newValues:{number:n}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"value",desiredValue:J.fromAst(e.number)}]}}},t.isNumber={public:!0,componentType:"boolean",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{isNumber:Number.isFinite(e.value.tree)}}}},t.isNumeric={public:!0,componentType:"boolean",returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:"number"}}),definition:function({dependencyValues:e}){return{newValues:{isNumeric:Number.isFinite(e.number)}}}},t.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"}}),definition:function({dependencyValues:e,usedDefault:n}){let r;return n.displayDigits&&!n.displayDecimals?r=e.value.round_numbers_to_decimals(e.displayDecimals):(r=e.value.round_numbers_to_precision(e.displayDigits),e.displaySmallAsZero&&(r=r.evaluate_numbers({skip_ordering:!0,set_small_zero:!0}))),{newValues:{valueForDisplay:We({value:r,simplify:e.simplify,expand:e.expand})}}}},t.latex={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{latex:e.valueForDisplay.toLatex()}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){return{newValues:{latexWithInputChildren:[e.latex]}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.valueForDisplay.toString()}}}},t.codesAdjacentToStrings={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childLogicName:"stringsAndMaths"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:Xf},t.canBeModified={additionalStateVariablesDefined:["constantChildIndices","codeForExpression","inverseMaps","template","mathChildrenMapped"],returnDependencies:()=>({mathChildrenModifiable:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["canBeModified"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition:Zf},t.mathChildrenByArrayComponent={returnDependencies:()=>({codePre:{dependencyType:"stateVariable",variableName:"codePre"},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths"},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"}}),definition:function({dependencyValues:e}){if(e.expressionWithCodes===null)return{newValues:{mathChildrenByArrayComponent:null}};let n=e.expressionWithCodes.tree,r=e.mathChildren.length;if(r===0||!Array.isArray(n)||!["tuple","vector"].includes(n[0]))return{newValues:{mathChildrenByArrayComponent:null}};let a={},i=0,s=e.codePre+i;for(let l=1;l<n.length;l++){let u=n[l],c=a[l]=[];if(Array.isArray(u)){let d=te(u);for(;s in d;)c.push(i),i++,s=e.codePre+i}else u===s&&(c.push(i),i++,s=e.codePre+i);if(i>=r)break}return{newValues:{mathChildrenByArrayComponent:a}}}},t}static adapters=["number","text"]},pe=ua;function Wf({dependencyValues:o}){let t="math",e=!1;do{e=!1;for(let n of o.stringChildren)if(n.componentType==="string"&&n.stateValues.value.includes(t)===!0){e=!0,t+="m";break}}while(e);return{newValues:{codePre:t}}}function Uf({dependencyValues:o,changes:t}){if(!("stringMathChildren"in t&&t.stringMathChildren.componentIdentitiesChanged||"format"in t||"createIntervals"in t||"createVectors"in t))return{noChanges:["expressionWithCodes"]};if(o.stringMathChildren.length===0)return{newValues:{expressionWithCodes:null}};let e="",n=0,r,a="",i=0;for(let l of o.stringMathChildren){if(i>0&&l.compositeInd!==r){if(i>1){let u=e.trimEnd(),c=!1;if(u.length===0)c=!0;else{let d=u[u.length-1];if(!["{","[","(","|",","].includes(d))c=!0;else if(l.componentType!=="string")c=!0;else{let p=l.stateValues.value.trimStart();if(p.length===0)c=!0;else{let m=p[0];o.format==="latex"&&m==="\\"&&p.length>1&&(m=p[1]),["}","]",")","|",","].includes(m)||(c=!0)}}}c&&(a="("+a+")")}e+=a,a="",i=0}if(l.componentType==="string")e+=" "+l.stateValues.value+" ",a="",i=0;else{let u=o.codePre+n;n++;let c;o.format==="latex"?c="\\var{"+u+"}":c=" "+u+" ",l.compositeInd!==void 0?(l.compositeInd===r&&(a+=","),a+=c,i++):(e+=c,a="",i=0)}r=l.compositeInd}i>0&&(i>1&&(a="("+a+")"),e+=a);let s=null;if(e==="")s=J.fromAst("\uFF3F");else{if(o.format==="text")try{s=J.fromAst(Z.convert(e))}catch(l){s=J.fromAst("\uFF3F"),console.log("Invalid value for a math of text format: "+e)}else if(o.format==="latex")try{s=J.fromAst(Ke.convert(e))}catch(l){s=J.fromAst("\uFF3F"),console.log("Invalid value for a math of latex format: "+e)}o.createVectors&&(s=s.tuples_to_vectors()),o.createIntervals&&(s=s.to_intervals())}return{newValues:{expressionWithCodes:s},makeEssential:["expressionWithCodes"]}}function Gf({dependencyValues:o}={}){if(o.expressionWithCodes===null)return{newValues:{unnormalizedValue:o.valueShadow},makeEssential:["unnormalizedValue"]};let t={};for(let[n,r]of o.mathChildren.entries())t[o.codePre+n]=r.stateValues.value;let e=o.expressionWithCodes;return o.mathChildren.length>0&&(e=e.substitute(t)),{newValues:{unnormalizedValue:e},makeEssential:["unnormalizedValue"]}}function Xf({dependencyValues:o}){let t=[],e;for(let[n,r]of o.stringMathChildren.entries())if(r.componentType==="string"){let a=o.stringMathChildren[n+1];if(a!==void 0&&a.componentType==="string")continue;let i={};if(e!==void 0&&(o.format==="latex"?i.prevCode="\\var{"+o.codePre+e+"}":i.prevCode=o.codePre+e),a!==void 0){let s=0;e!==void 0&&(s=e+1),o.format==="latex"?i.nextCode="\\var{"+o.codePre+s+"}":i.nextCode=o.codePre+s}t.push(i)}else e===void 0?e=0:e++;return{newValues:{codesAdjacentToStrings:t}}}function Zf({dependencyValues:o}){if(!o.modifyIndirectly||o.fixed)return{newValues:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};if(o.mathChildrenModifiable.length===0)return{newValues:{canBeModified:!0,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};let t=[],e=[],n=[],r={};for(let[l,u]of o.mathChildrenModifiable.entries()){let c=o.codePre+l;u.stateValues.canBeModified===!0?(t.push(l),e.push(c)):(n.push(c),r[c]=l)}let a=o.codePre+"expr",i=J.utils.unflattenLeft(o.expressionWithCodes.tree),s=ll(i,e,a,n);if(s.foundLinear){let l={},u=s.template,c=new Set;for(let d in s.mappings){l[d]=s.mappings[d];let p=l[d].mathChildSub;if(p){let m=t[e.indexOf(p)];l[d].mathChildInd=m,c.add(Number(m))}}return c.has=c.has.bind(c),{newValues:{canBeModified:!0,constantChildIndices:r,codeForExpression:a,inverseMaps:l,template:u,mathChildrenMapped:c}}}return{newValues:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}}}function ll(o,t,e,n=[],r=[]){let a=J.variables(o);if(a.every(l=>!t.includes(l))&&a.every(l=>!n.includes(l))){let l={},u="x"+r.join("_");return l[u]={result:J.fromAst(e).simplify(),components:r},{foundLinear:!0,mappings:l,template:u}}if(!Array.isArray(o))return mt(o,t,e,r);let i=o[0],s=o.slice(1);if(i==="tuple"||i==="vector"||i==="list"){let l={mappings:{},template:[i]},u=0;for(let c=0;c<s.length;c++){let d=[...r,c],p=ll(s[c],t,e,n,d);p.foundLinear?(u++,l.mappings=Object.assign(l.mappings,p.mappings),l.template.push(p.template)):l.template.push("x"+d.join("_"))}return u===0?{foundLinear:!1}:(l.foundLinear=!0,l)}else return mt(o,t,e,r)}function mt(o,t,e,n=[]){if(typeof o=="string"&&t.includes(o)){let i={},s="x"+n.join("_");return i[s]={result:J.fromAst(e).simplify(),components:n,mathChildSub:o},{foundLinear:!0,mappings:i,template:s}}if(!Array.isArray(o))return{foundLinear:!1};let r=o[0],a=o.slice(1);return r==="-"?(e=["-",e],mt(a[0],t,e,n)):r==="+"?J.variables(a[0]).every(i=>!t.includes(i))?(e=["+",e,["-",a[0]]],mt(a[1],t,e,n)):J.variables(a[1]).every(i=>!t.includes(i))?(e=["+",e,["-",a[1]]],mt(a[0],t,e,n)):{foundLinear:!1}:r==="*"?J.variables(a[0]).every(i=>!t.includes(i))?(e=["/",e,a[0]],mt(a[1],t,e,n)):J.variables(a[1]).every(i=>!t.includes(i))?(e=["/",e,a[1]],mt(a[0],t,e,n)):{foundLinear:!1}:r==="/"?J.variables(a[1]).every(i=>!t.includes(i))?(e=["*",e,a[1]],mt(a[0],t,e,n)):{foundLinear:!1}:{foundLinear:!1}}function Jf({desiredStateVariableValues:o,dependencyValues:t,stateValues:e,workspace:n,overrideFixed:r}){if(!e.canBeModified&&!r)return{success:!1};let a=ne(o.unnormalizedValue),i=e.value,s;if((a.tree[0]==="tuple"||a.tree[0]==="vector")&&i&&i.tree[0]===a.tree[0]){let m;n.desiredExpressionAst?m=n.desiredExpressionAst.slice(0):m=i.tree.slice(0);let f=[],h=!1;for(let[y,b]of a.tree.entries())b===void 0?(h=!0,f.push(y)):m[y]=b;a=J.fromAst(m),n.desiredExpressionAst=m,h&&(s=f)}let l=t.mathChildren,u=t.stringChildren;if(l.length===0){let m=[];for(let h=0;h<u.length;h++)m.push({deferSettingDependency:"stringChildren",inverseDefinition:ul,childIndex:h,variableIndex:0,dependencyValues:{mathChildren:t.mathChildren,stringChildren:t.stringChildren}});let f=a.simplify();return m.push({setStateVariable:"unnormalizedValue",value:f}),u.length===0&&m.push({setDependency:"valueShadow",desiredValue:f}),{success:!0,instructions:m}}let c=Yf({expression:a,stateValues:e});if(!c)return{success:!1};let d=[],p=[];if(s&&e.mathChildrenByArrayComponent)for(let m of s)e.mathChildrenByArrayComponent[m]&&p.push(...e.mathChildrenByArrayComponent[m]);for(let[m,f]of l.entries())if(e.mathChildrenMapped.has(m)&&f.stateValues.canBeModified){if(!p.includes(m)){let h=c[m],y={},b=!1;for(let g in e.constantChildIndices){let C=e.constantChildIndices[g];y[g]=l[C].stateValues.value,b=!0}b&&(h=h.substitute(y)),h=h.simplify(),d.push({setDependency:"mathChildren",desiredValue:h,childIndex:m,variableIndex:0})}delete c[m]}if(u.length>0){let m=e.expressionWithCodes;for(let f in c){let h=e.inverseMaps[f];if(h.mathChildInd!==void 0)continue;let y=h.components;m=m.substitute_component(y,c[f])}d.push({setStateVariable:"expressionWithCodes",value:m});for(let f=0;f<u.length;f++)d.push({deferSettingDependency:"stringChildren",inverseDefinition:ul,childIndex:f,variableIndex:0,dependencyValues:{mathChildren:t.mathChildren,stringChildren:t.stringChildren}})}return{success:!0,instructions:d}}function ul({dependencyValues:o,stateValues:t}){let e=o.mathChildren,n=o.stringChildren;if(e.length===0){let a;t.format==="latex"?a=t.value.toLatex():a=t.value.toString();let i=[{setDependency:"stringChildren",desiredValue:a,childIndex:0,variableIndex:0}];for(let s=1;s<n.length;s++)i.push({setDependency:"stringChildren",desiredValue:"",childIndex:s,variableIndex:0});return{success:!0,instructions:i}}let r=[];if(n.length>0){let a;t.format==="latex"?a=t.expressionWithCodes.toLatex():a=t.expressionWithCodes.toString();for(let[i,s]of t.codesAdjacentToStrings.entries()){let l=a;Object.keys(s).length===0?r.push({setDependency:"stringChildren",desiredValue:"",childIndex:i,variableIndex:0}):(s.prevCode&&(l=l.split(s.prevCode)[1]),s.nextCode&&(l=l.split(s.nextCode)[0]),r.push({setDependency:"stringChildren",desiredValue:l,childIndex:i,variableIndex:0}))}}return{success:!0,instructions:r}}function Yf({expression:o,stateValues:t}){let e=J.utils.match(o.tree,t.template);if(!e&&(e=J.utils.match(o.tuples_to_vectors().tree,J.fromAst(t.template).tuples_to_vectors().tree),!e&&(e=J.utils.match(o.to_intervals().tree,J.fromAst(t.template).to_intervals().tree),!e&&(e=J.utils.match(o.tuples_to_vectors().to_intervals().tree,J.fromAst(t.template).tuples_to_vectors().to_intervals().tree),!e))))return!1;let n={};for(let r in e){let a={};a[t.codeForExpression]=e[r];let i=t.inverseMaps[r];if(i!==void 0){let s=r;i.mathChildInd!==void 0&&(s=i.mathChildInd),n[s]=i.result.substitute(a),n[s]=We({value:n[s],simplify:t.simplify,expand:t.expand,createvectors:t.createvectors,createintervals:t.createintervals})}}return n}function Pe({object1:o,object2:t,isUnordered:e=!1,partialMatches:n=!1,matchExactLocations:r=!1,symbolicEquality:a=!1,simplify:i="none",expand:s=!1,allowedErrorInNumbers:l=0,includeErrorInNumberExponents:u=!1,allowedErrorIsAbsolute:c=!1,nSignErrorsMatched:d=0}){let p=!1;if(o instanceof De.class){if(p=!0,!(t instanceof De.class))if(typeof t=="number"||typeof t=="string")t=De.fromAst(t);else return{fraction_equal:0}}else if(t instanceof De.class)if(p=!0,typeof o=="number"||typeof o=="string")o=De.fromAst(o);else return{fraction_equal:0};let m=function(T){return T instanceof De.class||(T=De.fromAst(T)),T=T.normalize_function_names().normalize_applied_functions(),i==="none"?l>0&&(T=T.constants_to_floats()):i==="numberspreserveorder"?T=T.evaluate_numbers({max_digits:Infinity,skip_ordering:!0}):i==="number"?T=T.evaluate_numbers({max_digits:Infinity}):T=T.evaluate_numbers({max_digits:Infinity,evaluate_functions:!0}),We({value:T,simplify:i,expand:s})},f;if(p?a?f=function(T,v){let N=m(T),V=m(v);if(d>0){V=JSON.parse(JSON.stringify(V),De.reviver);let x=function(D,I){return D=m(D),D.equalsViaSyntax(I,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})};return{fraction_equal:De.equalSpecifiedSignErrors(V,N,{equalityFunction:x,n_sign_errors:d})?1:0}}else return{fraction_equal:N.equalsViaSyntax(V,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})?1:0}}:f=function(T,v){let N=T,V=v;T instanceof De.class||(N=De.fromAst(T)),v instanceof De.class||(V=De.fromAst(v));let x=Array.isArray(T)&&T[0]==="discrete_infinite_set",w=Array.isArray(v)&&v[0]==="discrete_infinite_set";if(x||w){let D=N,I=V;x||(D=V,I=N);let A=D.equalsDiscreteInfinite(I,{match_partial:n});return A===!0?{fraction_equal:1}:A===!1?{fraction_equal:0}:{fraction_equal:A}}if(d>0){V=JSON.parse(JSON.stringify(V),De.reviver);let D=function(A,S){return A.equals(S,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})};return{fraction_equal:De.equalSpecifiedSignErrors(V,N,{equalityFunction:D,n_sign_errors:d})?1:0}}else return{fraction_equal:N.equals(V,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})?1:0}}:f=(T,v)=>({fraction_equal:_t(T,v)?1:0}),p){let T=o.tree[0],v=t.tree[0];if(T==="vector"){if(o=o.tree.slice(1),v==="list"||v==="interval"||v==="matrix"||v==="array"||v==="set")return{fraction_equal:0};v==="tuple"||v==="vector"?t=t.tree.slice(1):t=[t.tree]}else if(v==="vector"){if(t=t.tree.slice(1),T==="list"||T==="interval"||T==="matrix"||T==="array"||T==="set")return{fraction_equal:0};T==="tuple"?o=o.tree.slice(1):o=[o.tree]}else if(T==="interval"){r=!0;let N=o.tree[2],V=N[1],x=N[2];if(o=o.tree[1].slice(1),v==="list"||v==="matrix"||v==="set")return{fraction_equal:0};if(v==="tuple"){let w=t.tree.slice(1);if(w.length===2&&V===!1&&x===!1)t=w;else return{fraction_equal:0}}else if(v==="array"){let w=t.tree.slice(1);if(w.length===2&&V===!0&&x===!0)t=w;else return{fraction_equal:0}}else if(v==="interval"){let w=t.tree[2];if(w[1]!==V||w[2]!==x)return{fraction_equal:0};t=t.tree[1].slice(1)}else return{fraction_equal:0}}else if(v==="interval"){r=!0;let N=t.tree[2],V=N[1],x=N[2];if(t=t.tree[1].slice(1),T==="list"||T==="matrix"||T==="set")return{fraction_equal:0};if(T==="tuple"){let w=o.tree.slice(1);if(w.length===2&&V===!1&&x===!1)o=w;else return{fraction_equal:0}}else if(T==="array"){let w=o.tree.slice(1);if(w.length===2&&V===!0&&x===!0)o=w;else return{fraction_equal:0}}else return{fraction_equal:0}}else if(T==="matrix")if(v==="matrix")o=o.tree.slice(1),t=t.tree.slice(1);else return{fraction_equal:0};else{if(v==="matrix")return{fraction_equal:0};if(T==="set"){let N=[];for(let V of o.tree.slice(1))N.some(x=>f(x,V).fraction_equal===1)||N.push(V);if(o=N,e=!0,v==="tuple"||v==="array"||v==="list")return{fraction_equal:0};if(v==="set"){N=[];for(let V of t.tree.slice(1))N.some(x=>f(x,V).fraction_equal===1)||N.push(V);t=N}else t=[t.tree]}else if(v==="set"){let N=[];for(let V of t.tree.slice(1))N.some(x=>f(x,V).fraction_equal===1)||N.push(V);if(t=N,e=!0,T==="tuple"||T==="array"||T==="list")return{fraction_equal:0};o=[o.tree]}else if(T==="list"){if(o=o.tree.slice(1),v==="tuple"||v==="array")return{fraction_equal:0};v==="list"?t=t.tree.slice(1):t=[t.tree]}else if(v==="list"){if(t=t.tree.slice(1),T==="tuple"||T==="array")return{fraction_equal:0};o=[o.tree]}else if(T==="tuple"){if(o=o.tree.slice(1),v==="array")return{fraction_equal:0};v==="tuple"?t=t.tree.slice(1):t=[t.tree]}else if(v==="tuple"){if(t=t.tree.slice(1),T==="array")return{fraction_equal:0};o=[o.tree]}else if(T==="array")o=o.tree.slice(1),v==="array"?t=t.tree.slice(1):t=[t.tree];else if(v==="array")t=t.tree.slice(1),o=[o.tree];else return f(o.tree,t.tree)}}else if(Array.isArray(o))Array.isArray(t)||(t=[t]);else if(Array.isArray(t))o=[o];else return f(o,t);let h=o.length,y=t.length,b={fraction_equal:0};if(r&&(e=!1),!e){let T=0,v=Math.min(h,y);for(let x=0;x<v;x++)T+=f(o[x],t[x]).fraction_equal;if(h===y&&h===T)return b.fraction_equal=1,b;if(!n)return b;if(r)return b.fraction_equal=T/Math.max(h,y),b;let N=Array.from(Array(h+1),x=>Array(y+1).fill(0));for(let x=0;x<h;x++)for(let w=0;w<y;w++){let D=f(o[x],t[w]);N[x+1][w+1]=Math.max(N[x][w]+D.fraction_equal,N[x+1][w],N[x][w+1])}let V=N[h][y];return b.fraction_equal=V/Math.max(h,y),b}let g=new Set,C=0;for(let T of o){let v=-1,N=0;for(let[V,x]of t.entries()){if(g.has(V))continue;let w=f(T,x);w.fraction_equal>N&&(N=w.fraction_equal,v=V)}v!==-1&&(C+=N,g.add(v))}return h===y&&h===C&&(b.fraction_equal=1),n&&(b.fraction_equal=C/Math.max(h,y)),b}import Cn from"math-expressions";function St({logicTree:o,unorderedCompare:t=!1,simplifyOnCompare:e=!1,expandOnCompare:n=!1,dependencyValues:r}){let a=m=>St({logicTree:m,unorderedCompare:t,simplifyOnCompare:e,expandOnCompare:n,dependencyValues:r});if(!Array.isArray(o)){if(typeof o=="string"){let m=r.booleanChildrenByCode[o];if(m)return m.stateValues.value?1:0;{let f=r.mathChildrenByCode[o];if(f){let h=f.stateValues.value.simplify().evaluate_to_constant();return Number.isFinite(h)&&h!==0?1:0}else{if(o.toLowerCase()==="true")return 1;if(o.toLowerCase()==="false")return 0}}}else if(typeof o=="number")return o===0?0:1;return console.warn("Invalid format for boolean condition"),0}let i=o[0],s=o.slice(1);if(i==="not")return s.length!==1?(console.warn("Invalid format for boolean condition"),0):a(s[0])===0?1:0;if(i==="and")return r.matchPartial?s.reduce((m,f)=>m+a(f),0)/s.length:s.every(m=>a(m)===1)?1:0;if(i==="or")return r.matchPartial?s.reduce((m,f)=>Math.max(a(f),m),0):s.some(m=>a(m)===1)?1:0;let l=!1,u=!1,c=!1;s.forEach(function(m){typeof m=="string"&&(m in r.mathChildrenByCode||m in r.mathListChildrenByCode?l=!0:m in r.textChildrenByCode||m in r.textListChildrenByCode?u=!0:(m in r.booleanChildrenByCode||m in r.booleanListChildrenByCode)&&(c=!0))}.bind(this));let d=function(m){if(typeof m=="string"){let f=r.mathChildrenByCode[m];return f!==void 0?f.stateValues.value.tree:(f=r.mathListChildrenByCode[m],f!==void 0?["list",...f.stateValues.maths.map(h=>h.tree)]:m)}return Array.isArray(m)?[m[0],...m.slice(1).map(d)]:m}.bind(this);if(!["=","ne","<",">","le","ge","lts","gts","in","notin"].includes(i)){if(u||c)return console.warn("Invalid format for boolean condition"),0;let f=Cn.fromAst(d(o)).simplify().evaluate_to_constant();return Number.isFinite(f)&&f!==0?1:0}if(c){if(l||u)return console.warn("Invalid format for boolean condition"),0;let m=!1;if(s=s.map(function(f){if(typeof f=="string"){let h=r.booleanChildrenByCode[f];return h!==void 0?h.stateValues.value:(h=r.booleanListChildrenByCode[f],h!==void 0?h.stateValues.booleans:(f=f.toLowerCase().trim(),f==="true"||f==="t"?!0:f==="false"||f==="f"?!1:(console.warn("Invalid format for boolean condition"),m=!0,0)))}return console.warn("Invalid format for boolean condition"),m=!0,0}.bind(this)),m)return 0;if(i==="="){let f=s[0];if(r.matchPartial){let h=s.slice(1).map(b=>Pe({object1:f,object2:b,isUnordered:t,partialMatches:r.matchPartial}));return h.reduce((b,g)=>b+g.fraction_equal,0)/h.length}else return s.slice(1).every(h=>Pe({object1:f,object2:h,isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===1)?1:0}else return i==="ne"?s.length!==2?(console.warn("Invalid format for boolean condition"),0):Pe({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),0)}else if(u){if(l)return console.warn("Invalid format for boolean condition"),0;let m=!1,f=function(h,y=!1){if(typeof h=="string"){let b=r.textChildrenByCode[h];return b!==void 0?b.stateValues.value.trim():(b=r.textListChildrenByCode[h],b!==void 0?b.stateValues.texts.map(g=>g.trim()):h.trim())}return y&&Array.isArray(h)&&h[0]==="*"?h.slice(1).map(f).join(" "):(console.warn("Invalid format for boolean condition"),m=!0,"")}.bind(this);if(s=s.map(h=>f(h,!0)),m)return 0;if(i==="="){let h=s[0];if(r.matchPartial){let y=s.slice(1).map(g=>Pe({object1:h,object2:g,isUnordered:t,partialMatches:r.matchPartial}));return y.reduce((g,C)=>g+C.fraction_equal,0)/y.length}else return s.slice(1).every(y=>Pe({object1:h,object2:y,isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===1)?1:0}else return i==="ne"?s.length!==2?(console.warn("Invalid format for boolean condition"),0):Pe({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),0)}let p;if((i==="lts"||i==="gts")&&(p=s[1].slice(1),s=s[0].slice(1)),s=s.map(function(m){return Cn.fromAst(d(m))}),i==="="){let m=s[0];if(r.matchPartial){let f=s.slice(1).map(y=>Pe({object1:m,object2:y,isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}));return f.reduce((y,b)=>y+b.fraction_equal,0)/f.length}else return s.slice(1).every(f=>Pe({object1:m,object2:f,isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===1)?1:0}if(i==="ne")return Pe({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===0?1:0;if(i==="in"||i==="notin"){let m=s[0],h=s[1].tree;if(!(Array.isArray(h)&&h[0]==="set"))return console.warn("Invalid format for boolean condition"),0;if(r.matchPartial){let b=h.slice(1).map(g=>Pe({object1:m,object2:Cn.fromAst(g),isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched})).reduce((g,C)=>Math.max(g,C.fraction_equal),0);return i==="in"?b:1-b}else{let y=h.slice(1).some(b=>Pe({object1:m,object2:Cn.fromAst(b),isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===1);return i==="in"?y?1:0:y?0:1}}if(s=s.map(m=>m.simplify().evaluate_to_constant()),s.some(m=>m===null||Number.isNaN(m)))return 0;if(i==="<")return s[0]<s[1]?1:0;if(i===">")return s[0]>s[1]?1:0;if(i==="le")return s[0]<=s[1]?1:0;if(i==="ge")return s[0]>=s[1]?1:0;for(let m=0;m<p.length;m++)if(i==="lts"){if(p[m]===!0){if(!(s[m]<s[m+1]))return 0}else if(!(s[m]<=s[m+1]))return 0}else if(p[m]===!0){if(!(s[m]>s[m+1]))return 0}else if(!(s[m]>=s[m+1]))return 0;return 1}function $t({logicTree:o,nonMathCodes:t,foundNonMath:e=!1,init:n=!0}){if(!Array.isArray(o))return typeof o=="string"&&!e&&!n?Cn.fromAst(Z.convert(o)).tree:o;let r=o[0],a=o.slice(1);return["and","not","or"].includes(r)?r==="apply"?[r,a[0],...a.slice(1).map(i=>$t({logicTree:i,nonMathCodes:t,foundNonMath:e,init:n}))]:[r,...a.map(i=>$t({logicTree:i,nonMathCodes:t,foundNonMath:e,init:n}))]:(a.some(i=>t.includes(i))&&(e=!0),r==="apply"?[r,a[0],...a.slice(1).map(i=>$t({logicTree:i,nonMathCodes:t,foundNonMath:e,init:!1}))]:[r,...a.map(i=>$t({logicTree:i,nonMathCodes:t,foundNonMath:e,init:!1}))])}var Qf=new ca.converters.textToAstObj({splitSymbols:!1,appliedFunctionSymbols:Gn}),da=class extends E{static componentType="boolean";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroMathLists",componentType:"mathList",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),s=e.newLeaf({name:"atLeastZeroTextLists",componentType:"textList",comparison:"atLeast",number:0}),l=e.newLeaf({name:"atLeastZeroBooleans",componentType:"boolean",comparison:"atLeast",number:0}),u=e.newLeaf({name:"atLeastZeroBooleanLists",componentType:"booleanList",comparison:"atLeast",number:0});return e.newOperator({name:"stringsMathsTextsAndBooleans",operator:"and",propositions:[n,r,a,i,s,l,u],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans"},stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"]}}),definition:eh},t.mathChildrenByCode={additionalStateVariablesDefined:["mathListChildrenByCode","textChildrenByCode","textListChildrenByCode","booleanChildrenByCode","booleanListChildrenByCode"],returnDependencies:()=>({stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","booleans"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:e,componentInfoObjects:n}){let r={},a={},i={},s={},l={},u={},c=0,d=e.codePre;for(let p of e.stringMathTextBooleanChildren)if(p.componentType!=="string"){let m=d+c;n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"math"})?r[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"mathList"})?a[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"text"})?i[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"textList"})?s[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"boolean"})?l[m]=p:u[m]=p,c+=1}return{newValues:{mathChildrenByCode:r,mathListChildrenByCode:a,textChildrenByCode:i,textListChildrenByCode:s,booleanChildrenByCode:l,booleanListChildrenByCode:u}}}},t.value={public:!0,componentType:this.componentType,forRenderer:!0,defaultValue:!1,set:Boolean,returnDependencies:()=>({parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","unordered"],variablesOptional:!0},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","expand","simplify"]},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"}}),definition({dependencyValues:e}){if(e.stringMathTextBooleanChildren.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value","implicitValue"]}}};if(e.parsedExpression===null)return{newValues:{value:!1}};let n=!1;for(let a of e.stringMathTextBooleanChildren)a.stateValues.unordered&&(n=!0);return{newValues:{value:St({logicTree:e.parsedExpression.tree,unorderedCompare:n,dependencyValues:e})===1}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,componentInfoObjects:r}){if(n.stringMathTextBooleanChildren.length===0)return{success:!0,instructions:[{setStateVariable:"value",value:Boolean(e.value)}]};if(n.stringMathTextBooleanChildren.length===1){let a=n.stringMathTextBooleanChildren[0];if(a.componentType==="string")return{success:!0,instructions:[{setDependency:"stringMathTextBooleanChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]};if(r.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"boolean"}))return{success:!0,instructions:[{setDependency:"stringMathTextBooleanChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}}return{success:!1}}},t.text={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value?"true":"false"}}}},t}},Ae=da;function eh({dependencyValues:o,componentInfoObjects:t}){let e="comp",n=!0;for(;n;){n=!1;for(let u of o.stringChildren)if(u.stateValues.value.includes(e)){n=!0,e+="p";break}}let r="",a=0,i=[],s=0;for(let u of o.stringMathTextBooleanChildren)if(u.componentType==="string")r+=" "+o.stringChildren[s].stateValues.value+" ",s++;else{let c=e+a;r+=" "+c+" ",t.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"math"})||t.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"mathList"})||i.push(c),a+=1}let l=null;try{l=ca.fromAst(Qf.convert(r))}catch(u){}return l&&(l=ca.fromAst($t({logicTree:l.tree,nonMathCodes:i}))),{newValues:{codePre:e,parsedExpression:l}}}var pa=class extends E{static componentType="text";static includeBlankStringChildren=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0});return e.newOperator({name:"stringsAndTexts",operator:"and",propositions:[n,r],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({stringTextChildren:{dependencyType:"child",childLogicName:"stringsAndTexts",variableNames:["value"]}}),defaultValue:"",set:e=>e===null?"":String(e),definition:function({dependencyValues:e}){if(e.stringTextChildren.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:"value"}}};let n="";for(let r of e.stringTextChildren)n+=r.stateValues.value;return{newValues:{value:n}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){let r=n.stringTextChildren.length;return r>1?{success:!1}:r===1?{success:!0,instructions:[{setDependency:"stringTextChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value===null?"":String(e.value)}]}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({newValues:{text:e.value}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"value",desiredValue:e.text}]})},t}},Be=pa;var ma=class extends Be{static componentType="_textFromSingleStringChild";static rendererType="text";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"stringsAndTexts",componentType:"string",comparison:"atMost",number:1,excludeCompositeReplacements:!0,setAsBase:!0}),e}},Nn=ma;var fa=class extends pe{static componentType="_mathWithVariable";static rendererType="math";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:void 0,public:!0},e}},zt=fa;import"math-expressions";var ha=class extends E{static componentType="mathList";static rendererType="asList";static renderChildren=!0;static stateVariableForAttributeValue="maths";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.simplify={propagateToDescendants:!0,createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e.mergeMathLists={createComponentOfType:"boolean",createStateVariable:"mergeMathLists",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"math",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMathLists",componentType:"mathList",comparison:"atLeast",number:0});return e.newOperator({name:"mathAndMathLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",stateVariablesDeterminingDependencies:["mergeMathLists"],additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies({stateValues:e}){let n={maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}};return e.mergeMathLists?n.mathAndMathListChildren={dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["value","nComponents"],variablesOptional:!0}:(n.mathListChildren={dependencyType:"child",childLogicName:"atLeastZeroMathLists",variableNames:["nComponents"]},n.mathAndMathListChildren={dependencyType:"child",childLogicName:"mathAndMathLists",skipComponentNames:!0}),n},definition:function({dependencyValues:e,componentInfoObjects:n}){let r=0,a=[];if(e.mergeMathLists)for(let[s,l]of e.mathAndMathListChildren.entries())if(n.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"mathList"})){for(let u=0;u<l.stateValues.nComponents;u++)a[r+u]=[s,u];r+=l.stateValues.nComponents}else{let u=l.stateValues.value;if(u&&Array.isArray(u.tree)&&u.tree[0]==="list"){let c=u.tree.length-1;for(let d=0;d<c;d++)a[d+r]=[s,d];r+=c}else a[r]=[s,0],r+=1}else{let s=0;for(let[l,u]of e.mathAndMathListChildren.entries())if(n.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"mathList"})){let c=e.mathListChildren[s];s++;for(let d=0;d<c.stateValues.nComponents;d++)a[r+d]=[l,d];r+=c.stateValues.nComponents}else a[r]=[l,0],r+=1}let i=e.maximumNumber;return i!==null&&r>i&&(r=i,a=a.slice(0,i)),{newValues:{nComponents:r,childIndexByArrayKey:a},checkForActualChange:{nComponents:!0}}}},t.maths={public:!0,componentType:"math",isArray:!0,entryPrefixes:["math"],stateVariablesDeterminingDependencies:["mergeMathLists","childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},a={mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let i of e){let s=[],l="1";n.childIndexByArrayKey[i]&&(s=[n.childIndexByArrayKey[i][0]],l=n.childIndexByArrayKey[i][1]+1),r[i]={mathAndMathListChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["value","math"+l],variablesOptional:!0,childIndices:s}}}return{globalDependencies:a,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].mathAndMathListChildren[0];if(s)if(s.stateValues.value!==void 0){let l=s.stateValues.value;if(e.mergeMathLists&&Array.isArray(l.tree)&&l.tree[0]==="list"){let u=e.childIndexByArrayKey[i][1];a[i]=l.get_component(u)}else a[i]=l}else{let l=e.childIndexByArrayKey[i][1]+1;a[i]=s.stateValues["math"+l]}}return{newValues:{maths:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){if(n.mergeMathLists)return console.log("Have not implemented inverse definition for math list with mergeMathLists=true"),{success:!1};let s=[];for(let l in e.maths){if(!r[l])continue;let u=r[l].mathAndMathListChildren[0];u&&(u.stateValues.value!==void 0?s.push({setDependency:a[l].mathAndMathListChildren,desiredValue:e.maths[l],childIndex:0,variableIndex:0}):s.push({setDependency:a[l].mathAndMathListChildren,desiredValue:e.maths[l],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"maths"},t.latex={additionalStateVariablesDefined:["latexs"],public:!0,componentType:"text",returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["valueForDisplay","latex","latexs"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}}),definition:function({dependencyValues:e}){let n=[];for(let i of e.mathAndMathListChildren)if(i.stateValues.valueForDisplay){let s=i.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(s.tree)&&s.tree[0]==="list")for(let l=0;l<s.tree.length-1;l++)n.push(s.get_component(l).toLatex());else n.push(i.stateValues.latex)}else n.push(...i.stateValues.latexs);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{latex:n.join(", "),latexs:n}}}},t.text={public:!0,componentType:"text",additionalStateVariablesDefined:["texts"],returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}}),definition:function({dependencyValues:e}){let n=[];for(let i of e.mathAndMathListChildren)if(i.stateValues.valueForDisplay){let s=i.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(s.tree)&&s.tree[0]==="list")for(let l=0;l<s.tree.length-1;l++)n.push(s.get_component(l).toString());else n.push(i.stateValues.text)}else n.push(...i.stateValues.texts);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{text:n.join(", "),texts:n}}}},t}},ft=ha;var ba=class extends E{static componentType="_textOrInline";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return{newValues:{value:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({newValues:{text:e.value}})},t}},Tn=ba;import lN from"math-expressions";var hl=Mt(pl()),bl=Mt(fl()),th=/\+/g,nh=/\//g;function It(o,t){let e=bl.default.stringify((0,hl.default)(t)).slice(0,10).replace(th,"_").replace(nh,"-");return"__"+o+"_"+e}function Ue(o,t){let e=1,n=o+e;for(;t.includes(n);)e+=1,n=o+e;return t.push(n),n}function Ht(o){let t=o.lastIndexOf("/");if(t===-1)throw Error(`Encountered name ${o} that doesn't include a slash`);return o.slice(0,t+1)}function Yn(o){return null}function ht({childrenToComponentFunction:o,mustStripOffOuterParentheses:t=!1}){return function({matchedChildren:e}){let n=0,r=[],a=[],i=!1,s=e.length;if(t){let u=e[0];if(u.componentType!=="string"||u.state.value.trimLeft()[0]!=="(")return{success:!1}}for(let[u,c]of e.entries()){if(c.componentType!=="string"){a.push(c);continue}let d=c.state.value.trim();if(u===0&&t&&d[0]==="("){let m=e[s-1];if(m.componentType==="string"){let f=m.state.value.trimRight();f[f.length-1]===")"&&(i=!0,d=d.substring(1))}}let p=0;for(let m=0;m<d.length;m++){let f=d[m];if(f==="("&&n++,f===")"){if(n===0){if(i&&u===s-1&&m===d.length-1){d=d.substring(0,d.length-1);break}return{success:!1}}n--}f===","&&n===0&&(m>p&&a.push({componentType:"string",state:{value:d.substring(p,m)}}),r.push(a),a=[],p=m+1)}d.length>p&&a.push({componentType:"string",state:{value:d.substring(p,d.length)}})}if(n!==0)return{success:!1};r.push(a);let l=r.map(o);return{success:!0,newChildren:l}}}function jt({childrenList:o}){let t=0,e=[],n=[];for(let r of o){if(r.componentType!=="string"){n.push(r);continue}let a=r.state.value.trim(),i=0;for(let s=0;s<a.length;s++){let l=a[s];if(l==="("&&t++,l===")"){if(t===0)return{success:!1};t--}if(l===","&&t===0){if(s>i){let u=a.substring(i,s).trim();n.push({componentType:"string",state:{value:u}})}e.push(n),n=[],i=s+1}}if(a.length>i){let s=a.substring(i,a.length).trim();n.push({componentType:"string",state:{value:s}})}}return t!==0?{success:!1}:(e.push(n),{success:!0,pieces:e})}function Ge({componentList:o,removeParens:t=!1}){let e=0,n=[],r=[];for(let a of o){if(a.componentType!=="string"){e===0?n.push([a]):r.push(a);continue}let i=a.state.value.trim(),s=0;for(let l=0;l<i.length;l++){let u=i[l];if(u==="(")e===0&&t&&(s=l+1),e++;else if(u===")"){if(e===0)return{success:!1};if(e===1){if(l+1>s){let c=t?l:l+1,d=i.substring(s,c).trim();d.length>0&&r.push({componentType:"string",state:{value:d}})}n.push(r),r=[],s=l+1}e--}else if(e===0&&!u.match(/\s/))return{success:!1}}if(i.length>s){let l=i.substring(s,i.length).trim();r.push({componentType:"string",state:{value:l}})}}return e!==0?{success:!1}:(r.length>0&&n.push(r),{success:!0,pieces:n})}function Qn(o){if(o.length===0)return{foundVector:!1};if(o[0].componentType!=="string")return{foundVector:!1};let t=o[0].state.value;if(t.trim()[0]!=="(")return{foundVector:!1};if(o[o.length-1].componentType!=="string")return{foundVector:!1};let n=o[o.length-1].state.value;if(n.trim().slice(-1)!==")")return{foundVector:!1};let a=[];if(o.length===1){let u=t.trim().slice(1,-1).trim();u.length>0&&a.push({componentType:"string",state:{value:u}})}else{let u=t.trim().slice(1).trim();u.length>0&&a.push({componentType:"string",state:{value:u}}),a.push(...o.slice(1,-1)),u=n.trim().slice(0,-1).trim(),u.length>0&&a.push({componentType:"string",state:{value:u}})}let i=0,s=[],l=[];for(let u of a){if(u.componentType!=="string"){l.push(u);continue}let c=u.state.value.trim(),d=0,p=!1;for(let m=0;m<c.length;m++){let f=c[m];if(f==="("&&i++,f===")"){if(i===0)return{foundVector:!1};i--}if(f===","&&i===0){if(m>d){let h=c.substring(d,m).trim();l.push({componentType:"string",state:{value:h}})}s.push(l),l=[],d=m+1,p=!0}}if(p){if(c.length>d){let m=c.substring(d,c.length).trim();l.push({componentType:"string",state:{value:m}})}}else l.push(u)}return i!==0?{foundVector:!1}:(s.push(l),{foundVector:!0,vectorComponents:s})}function yl(o){let e=/<\/?\w+((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[\^'">\s]+))?)+\s*|\s*)\/?>/.exec(o);if(e===null)return!1;let n=e[0];n=n.toLowerCase();let r=e.index,a=n.split(" "),i=a[0].substring(1,a[0].length-1);a.length>1&&(i=a[0].substring(1,a[0].length)),i.substring(i.length-1,i.length)==="/"&&(i=i.substring(0,i.length-1));let s=e[1];s=s.trim();let l={},u=/\w+\s*=\s*["]/;for(e="not null";e!==null;)if(e=u.exec(s),e!==null){let d=s.substring(e.index+e[0].length-1,s.length),m=/"[^"\\]*(?:\\.[^"\\]*)*"/.exec(d),f=m[0].substring(1,m[0].length-1),y=e[0].split("=")[0].trim();if(y.substring(0,1)==="_")throw Error("The prop "+y+" is reserved for internal use only.");if(f=f.replace(/\\"/g,'"'),y in l)throw Error("Duplicate attribute "+y+" in tag "+i);l[y]=f,s=s.substring(0,e.index)+s.substring(e.index+e[0].length+m[0].length,s.length)}let c=/\w+\s*=\s*[']/;for(e="not null";e!==null;)if(e=c.exec(s),e!==null){let d=s.substring(e.index+e[0].length-1,s.length),m=/'[^'\\]*(?:\\.[^'\\]*)*'/.exec(d),f=m[0].substring(1,m[0].length-1),y=e[0].split("=")[0].trim();if(y.substring(0,1)==="_")throw Error("The prop "+y+" is reserved for internal use only.");if(f=f.replace(/\\'/g,"'"),y in l)throw Error("Duplicate attribute "+y+" in tag "+i);l[y]=f,s=s.substring(0,e.index)+s.substring(e.index+e[0].length+m[0].length,s.length)}if(/\S/.test(s)){let d=s.split(" ");for(let p of d)/\S/.test(p)&&(l[p]=!0)}return{tagString:n,tagType:i,tagIndex:r,tagProps:l}}function er(o,t=!0){if(o===void 0)return[];if(t){let a=o.search("<!--");for(;a!==-1;){let i=o.search("-->");i===-1?i=o.length:i=i+3,o=o.substring(0,a)+o.substring(i,o.length),a=o.search("<!--")}}let e=[],n="",r="";for(;o.length>0;){let a=yl(o);if(a===!1)return o.length>0&&e.push({componentType:"string",state:{value:o}}),e;if(a.tagString.substring(a.tagString.length-2,a.tagString.length-1)==="/")n=o.substring(0,a.tagIndex),r="",o=o.substring(a.tagIndex+a.tagString.length,o.length);else{let l=1,u=0,c=JSON.parse(JSON.stringify(a)),d=0,p="";for(;l>u;){if(d=Number(d)+Number(c.tagString.length)+Number(c.tagIndex),p=o.substring(d,o.length),c=yl(p),c===!1)throw Error("No matching </"+a.tagType+"> end tag");c.tagType===a.tagType&&l++,c.tagType==="/"+a.tagType&&u++}n=o.substring(0,a.tagIndex);let m=Number(a.tagIndex)+Number(a.tagString.length),f=Number(d)+Number(c.tagIndex);r=o.substring(m,f),o=o.substring(Number(f)+Number(c.tagString.length),o.length)}/\S/.test(n)?e.push({componentType:"string",state:{value:n}}):n.length>0&&e.push({componentType:"string",state:{value:n}});let s=[];if(r.length>0&&(s=er(r,!1)),e.push({componentType:a.tagType,children:s,props:a.tagProps}),!/\S/.test(o)){if(o.length>0&&e.push({componentType:"string",state:{value:o}}),t){let l,u;for(let[c,d]of e.entries())(d.componentType!=="string"||d.state.value.trim()!=="")&&(l===void 0&&(l=c),u=c);e=e.slice(l,u+1)}return e}}return e}function ya(o,t){for(let e of o)if(e.children){let n=t[e.componentType];n&&!n.includeBlankStringChildren&&(e.children=e.children.filter(r=>r.componentType!=="string"||r.state.value.trim()!=="")),ya(e.children,t)}}function ga({serializedComponents:o}){let t={},e={};for(let n of o)if(n.componentType==="copy"){if(n.attributes){let r=n.attributes.uri;if(r&&r.componentType){let a;if(r.state!==void 0&&(a=r.state.value),r.children!==void 0){for(let i of r.children)if(i.componentType==="string"){a=i.state.value;break}}if(a&&a.substring(0,7).toLowerCase()==="doenet:"){let i=a.substring(7);if(i.substring(0,10).toLowerCase()==="contentid="){let s=i.substring(10);t[s]===void 0&&(t[s]=[]),t[s].push(n)}else if(i.substring(0,12).toLowerCase()==="contentname="){let s=i.substring(12);e[s]===void 0&&(e[s]=[]),e[s].push(n)}}}}}else if(n.children!==void 0){let r=ga({serializedComponents:n.children});for(let a in r.contentIdComponents)t[a]===void 0&&(t[a]=[]),t[a].push(...r.contentIdComponents[a]);for(let a in r.contentNameComponents)e[a]===void 0&&(e[a]=[]),e[a].push(...r.contentNameComponents[a])}return{contentIdComponents:t,contentNameComponents:e}}function gl(o){if(o.length!==1||o[0].componentType!=="document"){let t=o.splice(0);o.push({componentType:"document",children:t})}}function va(o,t){for(let e of o){let n=t[e.componentType.toLowerCase()];if(n)e.componentType=n;else throw Error(`Invalid component type: ${e.componentType}`);e.children&&va(e.children,t)}}function tr(o,t,e){for(let n of o){let r=t.standardComponentClasses[n.componentType],a=r.createAttributesObject({flags:e}),i={};for(let l in a)i[l.toLowerCase()]=l;let s={};if(n.props)for(let l in n.props){let u=i[l.toLowerCase()],c=a[u];if(c){if(u in s)throw Error(`Cannot repeat prop ${u}`);s[u]=nr({attrObj:c,value:n.props[l],componentInfoObjects:t}),delete n.props[l]}else if(!["name","assignnames","tname"].includes(l.toLowerCase()))if(r.acceptAnyAttribute)s[l]=n.props[l],delete n.props[l];else throw Error(`Invalid attribute for component of type ${n.componentType}: ${l}`)}for(let l in a){let u=a[l];u.createPrimitiveOfType&&"defaultValue"in u&&!(l in s)&&(s[l]=nr({attrObj:u,value:u.defaultValue,componentInfoObjects:t}))}n.attributes=s,n.children!==void 0&&tr(n.children,t,e)}}function nr({attrObj:o,value:t,componentInfoObjects:e}){if(o.createComponentOfType){let n;return t===!0&&e.isInheritedComponentType({inheritedComponentType:o.createComponentOfType,baseComponentType:"boolean"})?n={componentType:o.createComponentOfType,state:{implicitValue:!0}}:n={componentType:o.createComponentOfType,children:[{componentType:"string",state:{value:String(t)}}]},n}else if(o.createPrimitiveOfType){let n;return o.createPrimitiveOfType==="boolean"?n=t===!0||t.trim().toLowerCase()==="true":o.createPrimitiveOfType==="number"?t===!0?n=NaN:n=Number(t):n=String(t),o.validationFunction&&(n=o.validationFunction(n)),n}}function Ca(o){let t=[];for(let e of o)if(e.preSugarInd!==void 0)t.push(e.preSugarInd);else if(e.doenetAttributes||(e.doenetAttributes={}),e.doenetAttributes.createdFromSugar=!0,e.children){let n=Ca(e.children);t.push(...n)}return t}function bt(o,t){for(let e of o)if(e.children&&(e.children=bt(e.children,t)),e.attributes)for(let n in e.attributes){let r=e.attributes[n];r.children&&(r.children=bt(r.children,t))}return o=rh(o,t),o}function rh(o,t){for(let e=0;e<o.length;e++){let n=o[e];if(n.componentType==="string"){let r=n.state.value,a=vl(r);if(a.success){let i=a.firstIndMatched,s=a.matchLength,l=a.nDollarSigns,u;if(a.additionalAttributes){let m=`<copy tname="${a.targetName}" ${a.additionalAttributes} />`,f=er(m);tr(f,t),Cl(f),f=bt(f,t),u=f}else{let m={tName:a.targetName,createdFromMacro:!0};a.additionalAttributes===void 0&&(m.isPlainMacro=!0),u=[{componentType:"copy",doenetAttributes:m}]}let c=1,d=r.substring(i+s);if(l===2){let m=r.slice(i+s).match(/^\s*\(/);if(!m)continue;let f=s+m[0].length,h=[],y=!1;r.length>i+f&&(y=!0,h.push({componentType:"string",state:{value:r.substring(i+f)}})),h.push(...o.slice(e+1));let b=ah({componentsFromMacro:u,remainingComponents:h,includeFirstInRemaining:y,componentInfoObjects:t});if(!b.success)continue;u=b.componentsFromMacro,c=b.lastComponentIndMatched+1,y||c++,d=""}let p=[];i>0&&p.push({componentType:"string",state:{value:r.substring(0,i)}}),p.push(...u),d.length>0&&p.push({componentType:"string",state:{value:d}}),o.splice(e,c,...p),i>0&&e++}}}return o}function vl(o){let t=/(\$\$?)(([a-zA-Z_]\w*\b)|\(([a-zA-Z0-9_:.\/\-]+)\s*(\)|{))/,e=0,n;for(;;){if(n=o.substring(e).match(t),!n)return{success:!1};if(n.index===0||o[e+n.index-1]!=="$")break;e+=n.index+n[0].length}let r=n.index+e,a=n[0].length,i=n[1].length;if(n[3])return{success:!0,firstIndMatched:r,matchLength:a,targetName:n[3],nDollarSigns:i};let s=n[4];if(n[5]===")")return{success:!0,firstIndMatched:r,matchLength:a,targetName:s,nDollarSigns:i};let l=o.substring(r+a),u=ih(l);if(u.success)return{success:!0,firstIndMatched:r,matchLength:a+u.parenInd+1,targetName:s,nDollarSigns:i,additionalAttributes:l.substring(0,u.braceInd)};{let c=vl(l);return c.success?{success:!0,firstIndMatched:r+a+c.firstIndMatched,matchLength:c.matchLength,targetName:c.targetName,nDollarSigns:c.nDollarSigns,additionalAttributes:c.additionalAttributes}:{success:!1}}}function ih(o){let t=0;for(let e=0;e<o.length;e++){let n=o[e];if(n==="}"){if(t===0){if(o.substring(e+1).trim()[0]===")"){let r=o.substring(e+1).indexOf(")")+e+1;return{success:!0,braceInd:e,parenInd:r}}return{success:!1}}t--}else n==="{"&&t++}return{success:!1}}function Cl(o){for(let t of o)t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createdFromMacro=!0,t.children&&Cl(t.children)}function ah({componentsFromMacro:o,remainingComponents:t,includeFirstInRemaining:e,componentInfoObjects:n}){let r=sh(t);if(r.success){let a=r.componentInd;t=t.slice(0,a+1);let i=t[a],s="";r.charInd+1<i.state.value.length&&(s=i.state.value.substring(r.charInd+1)),r.charInd>0?i.state.value=i.state.value.substring(0,r.charInd):t=t.slice(0,a);let c=jt({childrenList:t}).pieces.map(m=>bt(m,n)).map(m=>({componentType:"math",doenetAttributes:{createdFromMacro:!0},children:m})),p=[{componentType:"evaluate",doenetAttributes:{createdFromMacro:!0},children:[...o,{componentType:"input",doenetAttributes:{createdFromMacro:!0},children:c}]}];return s.length>0&&p.push({componentType:"string",state:{value:s}}),{success:!0,componentsFromMacro:p,lastComponentIndMatched:a}}}function sh(o){let t=0;for(let[e,n]of o.entries())if(n.componentType==="string"){let r=n.state.value;for(let a=0;a<r.length;a++){let i=r[a];if(i==="(")t++;else if(i===")"){if(t===0)return{success:!0,componentInd:e,charInd:a};t--}}}return{success:!1}}function Na(o){for(let t of o)t.componentType==="string"?t.state.value=t.state.value.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&dollar;/g,"$").replace(/&amp;/g,"&"):t.children&&Na(t.children)}function rr({serializedComponents:o,parentParametersFromSugar:t={},parentAttributes:e={},componentInfoObjects:n,parentUniqueId:r=""}){for(let[a,i]of o.entries()){let s=i.componentType,l=n.allComponentClasses[s];if(!l)throw console.log(n.allComponentClasses),Error(`Unrecognized component type ${s}`);let u=r+"|"+s+a,c={};for(let d in i.attributes){let p=i.attributes[d];p.componentType||(c[d]=p)}if(c=new Proxy(c,q),i.children){let d={};for(let[p,m]of l.returnSugarInstructions().entries()){if(i.children.length===0)break;let f=i.children.map(g=>g.componentType==="string"?"s":"n").join("");if(m.childrenRegex){let g=f.match(m.childrenRegex);if(!g||g[0].length!==i.children.length)continue}let h=H(i.children),y=0;for(let g of h)g.componentType!=="string"&&(g.preSugarInd=y,y++);let b=m.replacementFunction({matchedChildren:h,parentParametersFromSugar:t,parentAttributes:e,componentAttributes:c,uniqueId:u+"|sugar"+p,componentInfoObjects:n});if(b.success){if(b.newChildren){let g=b.newChildren,C=Ca(g);C.length!==y||!C.every((T,v)=>T===v)?console.error(`Invalid sugar for ${s} as didn't return original components in order`):(i.children=g,b.parametersForChildrenSugar&&Object.assign(d,b.parametersForChildrenSugar))}else if(b.newAttributes){let g=b.newAttributes,C=Object.keys(g)[0],T=[];for(let v in g)T.push(...Ca(g[v].children));T.length!==y||!T.sort().every((v,N)=>v===N)?console.error(`Invalid sugar for ${s} as didn't return original components in order`):(i.attributes||(i.attributes={}),Object.assign(i.attributes,g),i.children=[],b.parametersForChildrenSugar&&Object.assign(d,b.parametersForChildrenSugar))}}}rr({serializedComponents:i.children,parentParametersFromSugar:d,parentAttributes:c,componentInfoObjects:n,parentUniqueId:u})}if(i.attributes)for(let d in i.attributes){let p=i.attributes[d];p.componentType&&rr({serializedComponents:[p],parentAttributes:c,componentInfoObjects:n,parentUniqueId:u})}}}function Nl(o){let t=0,e=[];o=o.trim();let n=0;for(let a=0;a<o.length;a++){let i=o[a];if(i==="("){if(t===0){let s=o.substring(n,a).trim();s.length>0&&e.push(s),n=a}t++}else if(i===")"){if(t===0)return{success:!1};if(t===1){let s=o.substring(n+1,a).trim();if(s.length>0){let l=Nl(s);l.success===!0?e.push(l.pieces):e.push(s)}n=a+1}t--}else if(t===0&&i.match(/\s/)){let s=o.substring(n,a).trim();s.length>0&&e.push(s),n=a}}if(t!==0)return{success:!1};let r=o.substring(n,o.length).trim();return r.length>0&&e.push(r),{success:!0,pieces:e}}function qt({serializedComponents:o,namespaceStack:t=[],componentInfoObjects:e,parentDoenetAttributes:n={},parentName:r,useOriginalNames:a=!1,doenetAttributesByFullTName:i,indOffset:s=0,createNameContext:l=""}){t.length===0&&t.push({namespace:"",componentCounts:{},namesUsed:{}});let u=t.length-1,c=t[u];for(let[d,p]of o.entries()){let m=p.componentType,f=e.allComponentClasses[m],h=p.doenetAttributes;h===void 0&&(h=p.doenetAttributes={});let y=p.attributes;y||(y=p.attributes={});let b=h.prescribedName,g=h.assignNames,C=h.tName,T=m==="string"||h.isAttributeChild||h.createdFromSugar||h.createdFromMacro||h.createUniqueName,v;(y.newNamespace||a&&p.originalAttributes&&p.originalAttributes.newNamespace)&&(v=!0);let N=b!==void 0,V=p.props;if(V===void 0)V=p.props={};else for(let D in V){let I=D.toLowerCase();if(I==="name")if(b===void 0)b=V[D],delete V[D];else throw Error("Cannot define name twice for a component");else if(I==="assignnames")if(g===void 0){let A=Nl(V[D]);if(A.success)g=A.pieces;else throw Error("Invalid format for assignnames");delete V[D]}else throw Error("Cannot define assignNames twice for a component");else if(I==="tname")if(C===void 0)C=V[D],delete V[D];else throw Error("Cannot define tName twice for a component")}if(b){if(!N&&!h.createdFromSugar){if(!/[a-zA-Z]/.test(b.substring(0,1)))throw Error("Component name must begin with a letter");if(!/^[a-zA-Z0-9_\-]+$/.test(b))throw Error("Component name can contain only letters, numbers, hyphens, and underscores")}h.prescribedName=b}else if(T){let D=r+"|createUniqueName|";p.downstreamDependencies?D+=JSON.stringify(p.downstreamDependencies):D+=d+"|"+s+"|"+l,b=It(m,D)}if(!g&&a&&p.originalDoenetAttributes&&p.originalDoenetAttributes.assignNames&&(g=p.originalDoenetAttributes.assignNames),g){if(!f.assignNamesToReplacements)throw Error("Cannot assign names for component type "+p.componentType);if(h.assignNames=g,!h.createUniqueAssignNames){let I=te(g);for(let A of I){if(!/[a-zA-Z]/.test(A.substring(0,1)))throw Error("All assigned names must begin with a letter");if(!/^[a-zA-Z0-9_\-]+$/.test(A))throw Error("Assigned names can contain only letters, numbers, hyphens, and underscores")}if(I.length!==new Set(I).size)throw Error("Duplicate assigned names")}}v&&(y.newNamespace=v);let x=c.componentCounts[m];x===void 0&&(x=0),h.isAttributeChild||h.createdFromSugar||h.createdFromMacro||(c.componentCounts[m]=++x);let w="";for(let D=0;D<=u;D++)w+=t[D].namespace+"/";if(!b){if(a&&p.originalName){let D=p.originalName.lastIndexOf("/");b=p.originalName.substring(D+1)}b||(b="_"+m.toLowerCase()+x)}if(w+=b,p.componentName=w,b){if(b in c.namesUsed)throw Error("Duplicate component name "+w);c.namesUsed[b]=!0}if(!v&&g)for(let D of te(g)){if(D in c.namesUsed)throw Error(`Duplicate component name (from assignNames of ${w}): ${D}`);c.namesUsed[D]=!0}if(p.doenetAttributes.createUniqueAssignNames&&p.originalName){let D=p.doenetAttributes.assignNames=[],I=w+"|createUniqueName|assignNames|",A="",S;if(v)A=w+"/",S=p.originalName+"/";else{for(let k=0;k<=u;k++)A+=t[k].namespace+"/";let O=p.originalName.lastIndexOf("/");S=p.originalName.slice(0,O+1)}for(let[O,k]of p.doenetAttributes.originalAssignNames.entries()){let R=I+O,P=It("fromAssignNames",R);D.push(P);let F={componentName:A+P,originalName:S+k};Tl(F,i)}}if(Tl(p,i),C){if(!f.acceptTname)throw Error(`Component type ${m} does not accept a tname attribute`);h.tName=C,h.fullTName=oh({tName:C,oldFullTName:h.fullTName,namespaceStack:t,acceptDoubleUnderscore:h.createdFromSugar})}if(p.children)if(!v)qt({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:w,useOriginalNames:a,doenetAttributesByFullTName:i});else{let D={};g&&te(g).forEach(A=>D[A]=!0);let I={namespace:b,componentCounts:{},namesUsed:D};t.push(I),qt({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:w,useOriginalNames:a,doenetAttributesByFullTName:i}),t.pop()}if(p.attributes)for(let D in p.attributes){let I=p.attributes[D];I.componentType&&(I.doenetAttributes||(I.doenetAttributes={}),I.doenetAttributes.isAttributeChild=!0,qt({serializedComponents:[I],namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:w,useOriginalNames:a,doenetAttributesByFullTName:i,createNameContext:D}))}}return o}function oh({tName:o,oldFullTName:t,namespaceStack:e,acceptDoubleUnderscore:n}){if(!t&&/__/.test(o)&&!n)throw Error("Invalid reference target: "+o);let r=o,a;if(r.substring(0,1)==="/")a=r;else{let i=e.length-1;for(;r.substring(0,3)==="../";)r=r.substring(3),i--;if(i<0)throw Error("Target "+o+" not found");a="";for(let s=0;s<=i;s++)a+=e[s].namespace+"/";a+=r}return a}function Ta({serializedComponents:o,componentTypesCreatingVariants:t,allComponentClasses:e}){let n=[];for(let r of o)if(r.componentType in t&&(r.variants===void 0&&(r.variants={}),r.variants.isVariantComponent=!0,n.push(r)),r.children!==void 0){let i=Ta({serializedComponents:r.children,componentTypesCreatingVariants:t,allComponentClasses:e});if(i.length>0){r.variants===void 0&&(r.variants={});let s,l;for(let[u,c]of i.entries())if(c.componentType==="variantControl"){s=u,l=c;break}if(s!==void 0&&(r.variants.isVariantComponent||(r.variants.isVariantComponent=!0,n.push(r)),i.splice(s,1)),r.variants.descendantVariantComponents=i,r.variants.isVariantComponent||n.push(...i),l!==void 0){let u=!1;if(l.state!==void 0&&l.state.uniqueVariants!==void 0&&(u=l.state.uniqueVariants),l.attributes&&l.attributes.uniqueVariants!==void 0){let c=l.attributes.uniqueVariants;if(c.state!==void 0&&(c.state.implicitValue!==void 0&&(u=c.state.implicitValue),c.state.value!==void 0&&(u=c.state.value)),c.children!==void 0){for(let d of c.children)if(d.componentType==="string"){u=d.state.value;break}}}typeof u=="string"&&(u.trim().toLowerCase()==="true"?u=!0:u=!1),u&&(r.variants.uniqueVariants=!0,Vl({serializedComponent:r,allComponentClasses:e}))}}}return n}function Vl({serializedComponent:o,allComponentClasses:t}){let e=1;if(o.children!==void 0){for(let a of o.children)if(a.variants!==void 0&&(a.variants.isVariantComponent||a.variants.descendantVariantComponents!==void 0)){let i=Vl({serializedComponent:a,allComponentClasses:t});if(!i.success)return{success:!1};e*=i.numberOfVariants}}let n;o.variants===void 0&&(o.variants={});let r=t[o.componentType];if(r.determineNumberOfUniqueVariants!==void 0){let a=r.determineNumberOfUniqueVariants({serializedComponent:o});if(!a.success)return{success:!1};n=a.numberOfVariants,o.variants.uniqueVariantData=a.uniqueVariantData}return n===void 0&&(n=e),o.variants.numberOfVariants=n,{success:!0,numberOfVariants:n}}function j({assignNames:o=[],serializedComponents:t,parentName:e,parentCreatesNewNamespace:n,componentInfoObjects:r,indOffset:a=0,originalNamesAreConsistent:i=!1}){let s=t.length;xa(t);let l={},u=null;if(i){if(s>0&&t[0].originalName){let d=t[0].originalName.lastIndexOf("/");u=t[0].originalName.substring(0,d)}if(u!==null)for(let d of t)Va({namespace:u,components:[d],doenetAttributesByFullTName:l})}else for(let d=0;d<s;d++){let p=t[d];if(u=null,s>0&&p.originalName){let m=p.originalName.lastIndexOf("/");u=p.originalName.substring(0,m)}u!==null&&Va({namespace:u,components:[p],doenetAttributesByFullTName:l})}let c=[];for(let d=0;d<s;d++){let p=d+a,m=o[p],f=t[d];if(f.doenetAttributes||(f.doenetAttributes={}),!i&&(u=null,s>0&&f.originalName)){let h=f.originalName.lastIndexOf("/");u=f.originalName.substring(0,h)}if(Array.isArray(m))if(r.allComponentClasses[f.componentType].assignNamesToReplacements){let h=e+"|assignName|"+p.toString();f.doenetAttributes.prescribedName=It(f.componentType,h);let y=e;if(!n){let b=e.lastIndexOf("/");y=e.substring(0,b)}y+="/"+f.doenetAttributes.prescribedName,f.componentName=y,f.doenetAttributes.assignNames=m,c.push(f);continue}else console.warn(`Cannot assign names recursively to ${f.componentType}`),m=null;if(!m)if(i&&f.originalName)m=f.originalName.slice(u.length+1);else{let h=e+"|assignName|"+p.toString();m=It(f.componentType,h)}f.doenetAttributes.prescribedName=m,i&&!f.doenetAttributes.assignNames&&f.originalDoenetAttributes&&f.originalDoenetAttributes.assignNames&&(f.doenetAttributes.assignNames=f.originalDoenetAttributes.assignNames),lh({parentName:e,ind:p,component:f,parentCreatesNewNamespace:n,componentInfoObjects:r,doenetAttributesByFullTName:l,originalNamesAreConsistent:i}),c.push(f)}return{serializedComponents:c}}function lh({parentName:o,component:t,ind:e,parentCreatesNewNamespace:n,componentInfoObjects:r,doenetAttributesByFullTName:a,originalNamesAreConsistent:i}){let s=o.split("/");n||s.pop();let l=s.map(c=>({namespace:c,componentCounts:{},namesUsed:{}}));o[0]!=="/"&&l.splice(0,0,{componentCounts:{},namesUsed:{},namespace:""}),t.doenetAttributes||(t.doenetAttributes={}),t.attributes||(t.attributes={});let u;t.attributes.newNamespace||i?u=!0:(u=!1,t.children&&ar(t.children));for(let c in t.attributes){let d=t.attributes[c];d.componentType&&ar([d])}qt({serializedComponents:[t],namespaceStack:l,componentInfoObjects:r,parentName:o,useOriginalNames:u,doenetAttributesByFullTName:a,indOffset:e})}function Va({namespace:o,components:t,doenetAttributesByFullTName:e}){let n=o.length;for(let r of t){if(r.doenetAttributes&&r.doenetAttributes.tName){let a=r.doenetAttributes.fullTName;a.substring(0,n)!==o&&(r.doenetAttributes.tName=a),e[a]||(e[a]=[]),e[a].push(r.doenetAttributes)}r.children&&Va({namespace:o,components:r.children,doenetAttributesByFullTName:e})}}function Tl(o,t){if(o.originalName&&t&&t[o.originalName]&&o.componentName!==o.originalName)for(let e of t[o.originalName])e.tName=o.componentName,e.fullTName=o.componentName}function xa(o){for(let t of o)if(t.componentName&&(t.originalName=t.componentName,delete t.componentName),t.children&&xa(t.children),t.attributes)for(let e in t.attributes){let n=t.attributes[e];n.componentType&&xa([n])}}function ar(o){for(let t of o)if(t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createUniqueName=!0,t.doenetAttributes.assignNames&&(t.doenetAttributes.createUniqueAssignNames=!0,t.doenetAttributes.originalAssignNames=t.doenetAttributes.assignNames,delete t.doenetAttributes.assignNames),delete t.doenetAttributes.prescribedName,t.children&&ar(t.children),t.attributes)for(let e in t.attributes){let n=t.attributes[e];n.componentType&&ar([n])}}var wa=class extends B{constructor(t){super(t);this.replacementsWorkspace={}}static componentType="_composite";static rendererType=void 0;static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.replacements={returnDependencies:()=>({replacements:{dependencyType:"replacement"}}),definition:({dependencyValues:e})=>({newValues:{replacements:e.replacements}})},t.recursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0}}),definition:({dependencyValues:e})=>({newValues:{recursiveReplacements:e.recursiveReplacements}})},t.fullRecursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0,recurseNonStandardComposites:!0}}),definition:({dependencyValues:e})=>({newValues:{fullRecursiveReplacements:e.recursiveReplacements}})},t}static createSerializedReplacements(){return{replacements:[]}}static calculateReplacementChanges(){return[]}get allPotentialRendererTypes(){let t=[];if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}},G=wa;var Da=class extends G{static componentType="template";static treatAsComponentForRecursiveReplacements=!0;static includeBlankStringChildren=!0;static keepChildrenSerialized({serializedComponent:t}){return t.children===void 0?[]:Object.keys(t.children)}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.rendered={createComponentOfType:"boolean",createStateVariable:"rendered",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:e}){return{newValues:{serializedChildren:e.serializedChildren}}}},t.newNamespace={returnDependencies:()=>({newNamespace:{dependencyType:"attribute",attributeName:"newNamespace"}}),definition({dependencyValues:e}){return{newValues:{newNamespace:e.newNamespace}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({}),definition:function(){return{newValues:{readyToExpandWhenResolved:!0}}}},t}static createSerializedReplacements({component:t}){return t.stateValues.rendered?{replacements:H(t.state.serializedChildren.value)}:{replacements:[]}}get allPotentialRendererTypes(){return this.potentialRendererTypesFromSerializedComponents(this.stateValues.serializedChildren)}},Kt=Da;var Aa=class extends Kt{static componentType="option";static includeBlankStringChildren=!1;static assignNamesToReplacements=!0;static originalNamesAreConsistent=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.selectForVariants={createComponentOfType:"variants",createStateVariable:"selectForVariants",defaultValue:[],public:!0},e.selectWeight={createComponentOfType:"number",createStateVariable:"selectWeight",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return t.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:n}){let r=H(n.serializedChildren).filter(a=>a.componentType!=="string");return r.length!==n.serializedChildren.length&&console.warn(`String child of ${e.componentType} ignored.`),{newValues:{serializedChildren:r}}}},t}static createSerializedReplacements({component:t,componentInfoObjects:e}){if(t.stateValues.rendered){let n=H(t.state.serializedChildren.value);return{replacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:n,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:e,originalNamesAreConsistent:t.attributes.newNamespace||!t.doenetAttributes.assignNames}).serializedComponents}}else return{replacements:[]}}},yt=Aa;var xl=class extends Be{static componentType="columns";static rendererType="text"},wl=class extends Tn{static componentType="title";static rendererType="textOrInline"},Dl=class extends Nn{static componentType="variant";static rendererType="text"},Al=class extends Nn{static componentType="seed";static rendererType="text"},Sl=class extends zt{static componentType="righthandside";static rendererType="math"},Il=class extends ft{static componentType="input";static rendererType="asList"},Ol=class extends Tn{static componentType="description";static rendererType="textorinline"},kl=class extends Be{static componentType="keyword";static rendererType="text"},Pl=class extends Be{static componentType="target";static rendererType="text"},Rl=class extends Ae{static componentType="sortresults";static rendererType="boolean"},Bl=class extends Ae{static componentType="condition";static rendererType="boolean"},Fl=class extends yt{static componentType="else"},Ll=class extends Kt{static componentType="externalContent"};var Ia={};ye(Ia,{M:()=>Wt,Me:()=>El,Men:()=>Ml});import uh from"math-expressions";var Wt=class extends E{static componentType="m";static rendererType="math";static primaryStateVariableForDefinition="latex";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroMathLists",componentType:"mathList",comparison:"atLeast",number:0}),s=e.newLeaf({name:"atLeastZeroMs",componentType:"m",comparison:"atLeast",number:0}),l=e.newLeaf({name:"atLeastZeroMathInputs",componentType:"mathInput",comparison:"atLeast",number:0});return e.newOperator({name:"stringsTextsAndMaths",operator:"and",propositions:[n,r,a,i,s,l],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.latex={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({stringTextMathChildren:{dependencyType:"child",childLogicName:"stringsTextsAndMaths",variableNames:["latex","text"],variablesOptional:!0}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.stringTextMathChildren.length===0)return{useEssentialOrDefaultValue:{latex:{variablesToCheck:"latex"}}};let r="";for(let a of e.stringTextMathChildren)a.stateValues.latex?r+=a.stateValues.latex:a.stateValues.text&&(r+=a.stateValues.text);return{newValues:{latex:r}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({stringTextMathChildren:{dependencyType:"child",childLogicName:"stringsTextsAndMaths",variableNames:["latex","text"],variablesOptional:!0},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.stringTextMathChildren.length===0)return{newValues:{latexWithInputChildren:[e.latex]}};let r=[],a="",i=0;for(let s of e.stringTextMathChildren)n.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"mathInput"})?(a.length>0&&(r.push(a),a=""),r.push(i),i++):s.stateValues.latex?a+=s.stateValues.latex:s.stateValues.text&&(a+=s.stateValues.text);return a.length>0&&r.push(a),{newValues:{latexWithInputChildren:r}}}},t.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{renderMode:"inline"}})},t.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let n;try{n=uh.fromAst(Ke.convert(e.latex))}catch(r){return{newValues:{text:e.latex}}}return{newValues:{text:n.toString()}}}},t}},El=class extends Wt{static componentType="me";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"display"}}),t}},Ml=class extends Wt{static componentType="men";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"numbered"}}),t.equationTag={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({equationCounter:{dependencyType:"counter",counterName:"equation"}}),definition({dependencyValues:e}){return{newValues:{equationTag:String(e.equationCounter)}}}},t}};var Oa={};ye(Oa,{Md:()=>ka,Mdn:()=>_l,Mrow:()=>$l});import ch from"math-expressions";var ka=class extends E{static componentType="md";static rendererType="math";static primaryStateVariableForDefinition="latex";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["latex"]}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroMrows",componentType:"mrow",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mrowChildNames={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows"}}),definition:({dependencyValues:e})=>({newValues:{mrowChildNames:e.mrowChildren.map(n=>n.componentName)}})},t.latex={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows",variableNames:["latex","hide","equationTag","numbered"]}}),definition:function({dependencyValues:e}){if(e.mrowChildren.length>0){let n="";for(let r of e.mrowChildren)r.stateValues.hide||(n.length>0&&(n+="\\\\"),r.stateValues.numbered?n+=`\\tag{${r.stateValues.equationTag}}`:n+="\\notag ",n+=r.stateValues.latex);return{newValues:{latex:n}}}else return{useEssentialOrDefaultValue:{latex:{variablesToCheck:"latex"}}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows",variableNames:["latexWithInputChildren","hide","equationTag","numbered"]},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){if(e.mrowChildren.length>0){let n=[],r=0,a="";for(let i of e.mrowChildren)if(!i.stateValues.hide){a.length>0&&(a+="\\\\"),i.stateValues.numbered?a+=`\\tag{${i.stateValues.equationTag}}`:a+="\\notag ";for(let s of i.stateValues.latexWithInputChildren)typeof s=="number"?(a.length>0&&(n.push(a),a=""),n.push(r),r++):a+=s}return a.length>0&&n.push(a),{newValues:{latexWithInputChildren:n}}}else return{newValues:{latexWithInputChildren:[e.latex]}}}},t.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let n;try{n=e.stateValues.latex.split("\\\\").map(r=>ch.fromAst(Ke.convert(r)).toString()).join("\\\\")}catch(r){return{newValues:{text:e.stateValues.latex}}}return{newValues:{text:n}}}},t.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{renderMode:"align"}})},t.numbered={returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!1}})},t}},_l=class extends ka{static componentType="mdn";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numbered={returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!0}})},t}},$l=class extends Wt{static componentType="mrow";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.number={createComponentOfType:"boolean"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"display"}}),t.numbered={forRenderer:!0,returnDependencies:()=>({parentNumbered:{dependencyType:"parentStateVariable",variableName:"numbered"},numberAttr:{dependencyType:"attributeComponent",attributeName:"number",variableNames:["value"]}}),definition({dependencyValues:e}){let n;return e.numberAttr!==null?n=e.numberAttr.stateValues.value:n=e.parentNumbered,{newValues:{numbered:n}}}},t.equationTag={public:!0,componentType:"text",forRenderer:!0,stateVariablesDeterminingDependencies:["numbered"],returnDependencies({stateValues:e}){return e.numbered?{equationCounter:{dependencyType:"counter",counterName:"equation"}}:{}},definition({dependencyValues:e}){return e.equationCounter!==void 0?{newValues:{equationTag:String(e.equationCounter)}}:{newValues:{equationTag:null}}}},t}};var Ba={};ye(Ba,{And:()=>jl,Not:()=>Hl,Or:()=>ql,Xor:()=>Kl});var Pa=class extends Ae{static componentType="_booleanOperator";static rendererType="boolean";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastOneBoolean",componentType:"boolean",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();delete t.parsedExpression,delete t.mathChildrenByCode;let e=this;return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({booleanChildren:{dependencyType:"child",childLogicName:"atLeastOneBoolean",variableNames:["value"]}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.booleanChildren.map(r=>r.stateValues.value))}}}},t}},Ut=Pa;function nt({stateVariableDefinitions:o,oldName:t,newName:e}){let n=o[e]=o[t];if(delete o[t],n.additionalStateVariablesDefined){let l=n.additionalStateVariablesDefined.indexOf(t);l!==-1&&(n.additionalStateVariablesDefined[l]=e)}let r=n.definition,a=["newValues","useEssentialOrDefaultValue"],i=["noChanges","makeEssential","alwaysShadow"];n.definition=function(l){let u=r(l);for(let c of a)u[c]&&t in u[c]&&(u[c][e]=u[c][t],delete u[c][t]);for(let c of i)if(u[c]){let d=u[c].indexOf(t);d!==-1&&(u[c][d]=e)}return u};let s=n.inverseDefinition;n.inverseDefinition=function(l){let u=l.desiredStateVariableValues;u[t]=u[e],delete u[e];let c=s(l);if(c.success)for(let d of c.instructions)d.setStateVariable===t&&(d.setStateVariable=e);return c}}var Ra=class extends Ae{static componentType="_booleanOperatorOneInput";static rendererType="boolean";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return nt({stateVariableDefinitions:t,oldName:"value",newName:"valuePreOperator"}),t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"valuePreOperator"}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.value)}}}},t}},zl=Ra;var Hl=class extends zl{static componentType="not";static applyBooleanOperator(t){return!t}},jl=class extends Ut{static componentType="and";static applyBooleanOperator(t){return t.every(e=>e)}},ql=class extends Ut{static componentType="or";static applyBooleanOperator(t){return t.some(e=>e)}},Kl=class extends Ut{static componentType="xor";static applyBooleanOperator(t){return t.reduce((n,r)=>n+r,0)===1}};var La={};ye(La,{IsInteger:()=>Wl,IsNumber:()=>Ul});var Fa=class extends Ae{static componentType="_booleanOperatorOfMath";static rendererType="boolean";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastOneMath",componentType:"math",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();delete t.parsedExpression,delete t.mathChildrenByCode;let e=this;return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childLogicName:"atLeastOneMath",variableNames:["value"]}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.mathChildren.map(r=>r.stateValues.value))}}}},t}},xn=Fa;var Wl=class extends xn{static componentType="isinteger";static applyBooleanOperator(t){if(t.length===0)return!1;if(t.length!==1)return console.warn("IsInteger requires exactly one math child"),null;let e=t[0].evaluate_to_constant();if(!Number.isFinite(e))return!1;let n=Math.round(e);return Math.abs(n-e)<=1e-15*Math.abs(e)}},Ul=class extends xn{static componentType="isNumber";static applyBooleanOperator(t){if(t.length===0)return!1;if(t.length!==1)return console.warn("IsNumber requires exactly one math child"),null;let e=t[0].evaluate_to_constant();return Number.isFinite(e)}};var _a={};ye(_a,{Abs:()=>au,Ceil:()=>nu,ClampNumber:()=>Zl,ConvertSetToList:()=>tu,Count:()=>uu,Floor:()=>ru,Max:()=>du,Mean:()=>iu,Min:()=>cu,Mod:()=>pu,Product:()=>Xl,Round:()=>eu,StandardDeviation:()=>lu,Sum:()=>Gl,Variance:()=>$a,WrapNumberPeriodic:()=>Yl});import Gt from"math-expressions";var Ea=class extends pe{static componentType="_mathOperator";static rendererType="math";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},e.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:Number.isFinite(Number(s))?"number":"math",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0});return e.newOperator({name:"mathsAndNumbers",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["isNumber"],variablesOptional:!0}}),definition({dependencyValues:e}){let n;return e.forceNumeric?n=!0:e.forceSymbolic?n=!1:e.mathChildren.length===0?n=!0:n=e.mathChildren.every(r=>r.stateValues.isNumber),{newValues:{isNumericOperator:n}}}},delete t.codePre,delete t.expressionWithCodes,delete t.codesAdjacentToStrings,delete t.mathChildrenByArrayComponent,t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:e=>Gt.fromAst("\uFF3F")}})},t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:e=>Gt.fromAst("\uFF3F")}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:null}})},t.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseNumericOperator:null}})},t.unnormalizedValue={returnDependencies:()=>({mathNumberChildren:{dependencyType:"child",childLogicName:"mathsAndNumbers",variableNames:["value"]},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},numericOperator:{dependencyType:"stateVariable",variableName:"numericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.mathNumberChildren.length===0)return{newValues:{unnormalizedValue:Gt.fromAst("\uFF3F")}};if(e.isNumericOperator){let r=[];for(let a of e.mathNumberChildren)if(n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"number"}))r.push(a.stateValues.value);else{let i=a.stateValues.value.evaluate_to_constant();Number.isFinite(i)||(i=NaN),r.push(i)}return{newValues:{unnormalizedValue:Gt.fromAst(e.numericOperator(r))}}}else{let r=[];for(let a of e.mathNumberChildren)n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"number"})?r.push(Gt.fromAst(a.stateValues.value)):r.push(a.stateValues.value);return{newValues:{unnormalizedValue:e.mathOperator(r)}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){if(n.mathNumberChildren.length===0)return{success:!1};if(n.isNumericOperator)if(n.inverseNumericOperator){let r=[];for(let i of n.mathNumberChildren)if(componentInfoObjects.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"number"}))r.push(i.stateValues.value);else{let s=i.stateValues.value.evaluate_to_constant();Number.isFinite(s)||(s=NaN),r.push(s)}let a=n.inverseNumericOperator({desiredValue:e.unnormalizedValue.evaluate_to_constant(),inputs:r});return a.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:a.inputValue,childIndex:a.inputNumber,variableIndex:0}]}:{success:!1}}else return{success:!1};else if(n.inverseMathOperator){let r=[];for(let i of n.mathNumberChildren)componentInfoObjects.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"number"})?r.push(Gt.fromAst(i.stateValues.value)):r.push(i.stateValues.value);let a=n.inverseMathOperator({desiredValue:e.unnormalizedValue,inputs:r});return a.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:a.inputValue,childIndex:a.inputNumber,variableIndex:0}]}:{success:!1}}else return{success:!1}}},t.canBeModified={returnDependencies:()=>({modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},mathNumberChildren:{dependencyType:"child",childLogicName:"mathsAndNumbers"},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e}){return{newValues:{canBeModified:e.modifyIndirectly&&!e.fixed&&e.mathNumberChildren.length===1&&(e.isNumericOperator?e.inverseNumericOperator:e.inverseMathOperator)}}}},t}},ze=Ea;var Ma=class extends pe{static componentType="_mathOperatorOneInput";static rendererType="math";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:e=>me.fromAst("\uFF3F")}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:null}})},nt({stateVariableDefinitions:t,oldName:"unnormalizedValue",newName:"unnormalizedValuePreOperator"}),t.unnormalizedValue={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"unnormalizedValuePreOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"}}),definition:function({dependencyValues:e}){return{newValues:{unnormalizedValue:e.mathOperator(e.value)}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,componentName:r}){if(n.inverseMathOperator){let a=n.inverseMathOperator(e.unnormalizedValue);return{success:!0,instructions:[{setDependency:"value",desiredValue:a}]}}else return{success:!1}}},nt({stateVariableDefinitions:t,oldName:"canBeModified",newName:"canBeModifiedPreOperator"}),t.canBeModified={returnDependencies:()=>({canBeModifiedPreOperator:{dependencyType:"stateVariable",variableName:"canBeModifiedPreOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"}}),definition:function({dependencyValues:e}){let n=e.canBeModifiedPreOperator;return e.inverseMathOperator||(n=!1),{newValues:{canBeModified:n}}}},t}},Xe=Ma;import le from"math-expressions";var Gl=class extends ze{static componentType="sum";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>n+r)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.add(r))}}})},t}},Xl=class extends ze{static componentType="product";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>n*r)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.multiply(r))}}})},t}},Zl=class extends Xe{static componentType="clampNumber";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return Jl({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{inverseMathOperator:function(n){return Jl({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t}};function Jl({value:o,lowerValue:t,upperValue:e}){let n=o.evaluate_to_constant();return Number.isFinite(n)?le.fromAst(Math.max(t,Math.min(e,n))):le.fromAst(NaN)}var Yl=class extends Xe{static componentType="wrapNumberPeriodic";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return Ql({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{inverseMathOperator:function(n){return Ql({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t}};function Ql({value:o,lowerValue:t,upperValue:e}){let n=o.evaluate_to_constant();return Number.isFinite(n)?t===e?le.fromAst(t):(t>e&&([e,t]=[t,e]),le.fromAst(t+le.math.mod(n-t,e-t))):le.fromAst(NaN)}var eu=class extends Xe{static componentType="round";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.numberDecimals={createComponentOfType:"number",createStateVariable:"numberDecimals",defaultValue:0,public:!0},e.numberDigits={createComponentOfType:"number",createStateVariable:"numberDigits",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({numberDecimals:{dependencyType:"stateVariable",variableName:"numberDecimals"},numberDigits:{dependencyType:"stateVariable",variableName:"numberDigits"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){let r=n.evaluate_numbers({max_digits:Infinity,evaluate_functions:!0});return e.numberDigits!==null?r.round_numbers_to_precision(e.numberDigits):r.round_numbers_to_decimals(e.numberDecimals)}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},tu=class extends Xe{static componentType="convertSetToList";static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.unordered,e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.unordered={returnDependencies:()=>({}),definition:()=>({newValues:{unordered:!0},makeEssential:["unordered"]})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){if(e!==void 0&&Array.isArray(e.tree)&&e.tree[0]==="set"){let n=[];for(let r of e.tree.slice(1))n.some(a=>e.context.equalsViaSyntax(e.context.fromAst(a),e.context.fromAst(r)))||n.push(r);return e.context.fromAst(["list",...n])}return e}}})},t}},nu=class extends Xe{static componentType="ceil";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();if(!Number.isFinite(n))return e;let r=Math.round(n);return Math.abs((r-n)/n)<1e-15?le.fromAst(r):le.fromAst(Math.ceil(n))}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},ru=class extends Xe{static componentType="floor";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();if(!Number.isFinite(n))return e;let r=Math.round(n);return Math.abs((r-n)/n)<1e-15?le.fromAst(r):le.fromAst(Math.floor(n))}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},au=class extends Xe{static componentType="abs";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();return Number.isFinite(n)?le.fromAst(Math.abs(n)):le.fromAst(["apply","abs",e.tree])}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:function(e){let n=e,r=e.evaluate_to_constant();return Number.isFinite(r)&&r<0&&(n=le.fromAst(0)),n}}})},t}},iu=class extends ze{static componentType="mean";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){let n=e.reduce((r,a)=>r+a);return n/=e.length,n}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.add(r)).divide(e.length)}}})},t}},$a=class extends ze{static componentType="variance";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.population={createComponentOfType:"boolean",createStateVariable:"population",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({newValues:{numericOperator:function(n){return su(n,e.population)}}})},t.mathOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return ou(n,e.population)}}})},t}};function su(o,t){let e=0,n=0;for(let a of o)e+=a,n+=a*a;let r=o.length;return n-=e**2/r,t?n/=r:n/=r-1,n}function ou(o,t){let e=o.length,n=o.reduce((a,i)=>a.add(i)),r=o.slice(1).reduce((a,i)=>a.add(i.pow(2)),o[0].pow(2)).subtract(n.pow(2).divide(e));return t?r=r.divide(e):r=r.divide(e-1),r}var lu=class extends $a{static componentType="standardDeviation";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator.definition=({dependencyValues:e})=>({newValues:{numericOperator:function(n){return Math.sqrt(su(n,e.population))}}}),t.mathOperator.definition=({dependencyValues:e})=>({newValues:{mathOperator:function(n){return le.fromAst(["apply","sqrt",ou(n,e.population).tree])}}}),t}},uu=class extends ze{static componentType="count";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.length}}})},t}},cu=class extends ze{static componentType="min";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>Math.min(n,r),Infinity)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return le.fromAst(["apply","min",["tuple",...e.map(n=>n.tree)]])}}})},t}},du=class extends ze{static componentType="max";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>Math.max(n,r),-Infinity)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return le.fromAst(["apply","max",["tuple",...e.map(n=>n.tree)]])}}})},t}},pu=class extends ze{static componentType="mod";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.length!==2?NaN:le.math.mod(e[0],e[1])}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.length!==2?le.fromAst("\uFF3F"):le.fromAst(["apply","mod",["tuple",...e.map(n=>n.tree)]])}}})},t}};var ja={};ye(ja,{ClampFunction:()=>fu,Derivative:()=>bu,WrapFunctionPeriodic:()=>hu});import wn from"math-expressions";function Xt(){return[{styleNumber:1,lineColor:"blue",lineWidth:4,lineStyle:"solid",markerColor:"blue",markerStyle:"circle",markerSize:3},{styleNumber:2,lineColor:"green",lineWidth:2,lineStyle:"solid",markerColor:"green",markerStyle:"square",markerSize:4},{styleNumber:3,lineColor:"red",lineWidth:3,lineStyle:"solid",markerColor:"red",markerStyle:"triangle",markerSize:5},{styleNumber:4,lineColor:"purple",lineWidth:2,lineStyle:"solid",markerColor:"purple",markerStyle:"diamond",markerSize:4},{styleNumber:5,lineColor:"black",lineWidth:1,lineStyle:"solid",markerColor:"black",markerStyle:"circle",markerSize:2},{styleNumber:6,lineColor:"lightgray",lineWidth:1,lineStyle:"dotted",markerColor:"lightgray",markerStyle:"circle",markerSize:2}]}var za=class extends E{static componentType="function";static rendererType="math";static get stateVariablesShadowedForReference(){return["variable","numericalf","symbolicf","symbolic","isInterpolatedFunction","formula","prescribedPoints","prescribedMinima","prescribedMaxima","prescribedExtrema"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={createComponentOfType:"boolean",createStateVariable:"expand",defaultValue:!1,public:!0},e.xscale={createComponentOfType:"number",createStateVariable:"xscale",defaultValue:1,public:!0,propagateToDescendants:!0},e.yscale={createComponentOfType:"number",createStateVariable:"yscale",defaultValue:1,public:!0,propagateToDescendants:!0},e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"",public:!0,forRenderer:!0},e.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},e.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},e.formula={createComponentOfType:"math"},e.minima={createComponentOfType:"extrema"},e.maxima={createComponentOfType:"extrema"},e.extrema={createComponentOfType:"extrema"},e.through={createComponentOfType:"_pointListComponent"},e.throughSlopes={createComponentOfType:"mathList"},e.variable={createComponentOfType:"variable"},e.symbolic={createComponentOfType:"boolean"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:/s/,replacementFunction:({matchedChildren:e})=>({success:!0,newAttributes:{formula:{componentType:"math",children:e}}})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneFunction",componentType:"function",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions();return e.selectedStyle={forRenderer:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:n}){let r=n.ancestorWithStyle.stateValues.styleDefinitions;r||(r=Xt());let a;for(let i of r)n.styleNumber===i.styleNumber&&(a===void 0?a=i:a=Object.assign(Object.assign({},i),a));return a===void 0&&(a=r[0]),{newValues:{selectedStyle:a}}}},e.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:n}){let r="";return n.selectedStyle.lineWidth>=4?r+="thick ":n.selectedStyle.lineWidth<=1&&(r+="thin "),n.selectedStyle.lineStyle==="dashed"?r+="dashed ":n.selectedStyle.lineStyle==="dotted"&&(r+="dotted "),r+=n.selectedStyle.lineColor,{newValues:{styleDescription:r}}}},e.symbolic={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({symbolicAttr:{dependencyType:"attributeComponent",attributeName:"symbolic",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["symbolic"]}}),definition({dependencyValues:n}){return n.symbolicAttr!==null?{newValues:{symbolic:n.symbolicAttr.stateValues.value}}:n.functionChild.length===1?{newValues:{symbolic:n.functionChild[0].stateValues.symbolic}}:{useEssentialOrDefaultValue:{symbolic:{variablesToCheck:["symbolic"]}}}}},e.isInterpolatedFunction={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through"},minima:{dependencyType:"attributeComponent",attributeName:"minima"},maxima:{dependencyType:"attributeComponent",attributeName:"maxima"},extrema:{dependencyType:"attributeComponent",attributeName:"extrema"}}),definition({dependencyValues:n}){return{newValues:{isInterpolatedFunction:n.through||n.minima||n.maxima||n.extrema}}}},e.variable={public:!0,componentType:"variable",defaultValue:wn.fromAst("x"),returnDependencies:()=>({variableAttr:{dependencyType:"attributeComponent",attributeName:"variable",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["variable"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:n,usedDefault:r}){return n.isInterpolatedFunction?{newValues:{variable:wn.fromAst("\uFF3F")}}:n.functionChild.length===1?(n.variableAttr!==null&&console.warn("Variable for function is ignored when it has a function child"),{newValues:{variable:n.functionChild[0].stateValues.variable}}):n.variableAttr!==null?{newValues:{variable:n.variableAttr.stateValues.value}}:n.parentVariableForChild&&!r.parentVariableForChild?{newValues:{variable:n.parentVariableForChild}}:{useEssentialOrDefaultValue:{variable:{variablesToCheck:["variable"]}}}}},e.formula={public:!0,componentType:"formula",defaultValue:wn.fromAst(0),returnDependencies:()=>({formulaAttr:{dependencyType:"attributeComponent",attributeName:"formula",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["formula"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{formula:wn.fromAst("\uFF3F")}}:n.formulaAttr!==null?{newValues:{formula:n.formulaAttr.stateValues.value}}:n.functionChild.length===1?{newValues:{formula:n.functionChild[0].stateValues.formula}}:{useEssentialOrDefaultValue:{formula:{variablesToCheck:["formula"]}}}}},e.nPrescribedPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:n}){let r=0;return n.through!==null&&(r=n.through.stateValues.nPoints),{newValues:{nPrescribedPoints:r}}}},e.prescribedPoints={isArray:!0,entryPrefixes:["prescribedPoint"],returnArraySizeDependencies:()=>({nPrescribedPoints:{dependencyType:"stateVariable",variableName:"nPrescribedPoints"}}),returnArraySize({dependencyValues:n}){return[n.nPrescribedPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n){let i=Number(a)+1;r[a]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["point"+i]},throughSlopes:{dependencyType:"attributeComponent",attributeName:"throughSlopes",variableNames:["math"+i]}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].through;if(s!==null){let l=Number(i)+1,u=s.stateValues["point"+l],c=null,d=n[i].throughSlopes;d!==null&&(c=d.stateValues["math"+l],c===void 0&&(c=null)),a[i]={x:u[0],y:u[1],slope:c}}}return{newValues:{prescribedPoints:a}}}},e.prescribedMinima={returnDependencies:()=>({minima:{dependencyType:"attributeComponent",attributeName:"minima",variableNames:["extrema"]}}),definition({dependencyValues:n}){let r=[];return n.minima!==null&&(r=n.minima.stateValues.extrema.map(a=>({x:a[0],y:a[1]}))),{newValues:{prescribedMinima:r}}}},e.prescribedMaxima={returnDependencies:()=>({maxima:{dependencyType:"attributeComponent",attributeName:"maxima",variableNames:["extrema"]}}),definition({dependencyValues:n}){let r=[];return n.maxima!==null&&(r=n.maxima.stateValues.extrema.map(a=>({x:a[0],y:a[1]}))),{newValues:{prescribedMaxima:r}}}},e.prescribedExtrema={returnDependencies:()=>({extrema:{dependencyType:"attributeComponent",attributeName:"extrema",variableNames:["extrema"]}}),definition({dependencyValues:n}){let r=[];return n.extrema!==null&&(r=n.extrema.stateValues.extrema.map(a=>({x:a[0],y:a[1]}))),{newValues:{prescribedExtrema:r}}}},e.interpolationPoints={returnDependencies:()=>({xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"},prescribedPoints:{dependencyType:"stateVariable",variableName:"prescribedPoints"},prescribedMinima:{dependencyType:"stateVariable",variableName:"prescribedMinima"},prescribedMaxima:{dependencyType:"stateVariable",variableName:"prescribedMaxima"},prescribedExtrema:{dependencyType:"stateVariable",variableName:"prescribedExtrema"}}),definition:({dependencyValues:n})=>dh({dependencyValues:n,numerics:t})},e.xs={additionalStateVariablesDefined:["coeffs"],returnDependencies:()=>({interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"}}),definition:ph},e.symbolicf={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["symbolicf"]},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){if(n.isInterpolatedFunction){let r=mu(n);return{newValues:{symbolicf:function(a){wn.fromAst(r(a.evaluate_to_constant()))}}}}else return n.functionChild.length===1?{newValues:{symbolicf:n.functionChild[0].stateValues.symbolicf}}:{newValues:{symbolicf:ir(n)}}}},e.numericalf={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["numericalf"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{numericalf:mu(n)}}:n.functionChild.length===1?{newValues:{numericalf:n.functionChild[0].stateValues.numericalf}}:{newValues:{numericalf:sr(n)}}}},e.f={returnDependencies:()=>({symbolic:{dependencyType:"stateVariable",variableName:"symbolic"},symbolicf:{dependencyType:"stateVariable",variableName:"symbolicf"},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"}}),definition:function({dependencyValues:n}){return n.symbolic?{newValues:{f:n.symbolicf}}:{newValues:{f:n.numericalf}}}},e.latex={public:!0,componentType:"text",returnDependencies:()=>({formula:{dependencyType:"stateVariable",variableName:"formula"}}),definition:function({dependencyValues:n}){return{newValues:{latex:n.formula.toLatex()}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:n}){return{newValues:{latexWithInputChildren:[n.latex]}}}},e.allMinima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["allMinima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n,componentName:r}){if(n.isInterpolatedFunction){let a=n.xs,i=n.coeffs,s=t.eps,l=[];if(a===null)return{newValues:{allMinima:l}};let u=!1,c=i[0],d=a[1]-a[0];if(c[3]===0){if(c[2]>0){let p=-c[1]/(2*c[2]);p<=d-s?l.push([p+a[0],((c[3]*p+c[2])*p+c[1])*p+c[0]]):Math.abs(p-d)<s&&(u=!0)}}else{let p=4*c[2]*c[2]-12*c[3]*c[1];if(p>0){let m=Math.sqrt(p),f=(-2*c[2]+m)/(6*c[3]);f<=d-s?l.push([f+a[0],((c[3]*f+c[2])*f+c[1])*f+c[0]]):Math.abs(f-d)<s&&(u=!0)}}for(let p=1;p<a.length-2;p++)if(c=i[p],d=a[p+1]-a[p],c[3]===0)if(c[2]>0){let m=-c[1]/(2*c[2]);Math.abs(m)<s?u&&l.push([m+a[p],((c[3]*m+c[2])*m+c[1])*m+c[0]]):m>=s&&m<=d-s&&l.push([m+a[p],((c[3]*m+c[2])*m+c[1])*m+c[0]]),u=Math.abs(m-d)<s}else u=!1;else{let m=4*c[2]*c[2]-12*c[3]*c[1];if(m>0){let f=Math.sqrt(m),h=(-2*c[2]+f)/(6*c[3]);Math.abs(h)<s?u&&l.push([h+a[p],((c[3]*h+c[2])*h+c[1])*h+c[0]]):h>=s&&h<=d-s&&l.push([h+a[p],((c[3]*h+c[2])*h+c[1])*h+c[0]]),u=Math.abs(h-d)<s}else u=!1}if(c=i[a.length-2],c[3]===0){if(c[2]>0){let p=-c[1]/(2*c[2]);Math.abs(p)<s?u&&l.push([p+a[a.length-2],((c[3]*p+c[2])*p+c[1])*p+c[0]]):p>=s&&l.push([p+a[a.length-2],((c[3]*p+c[2])*p+c[1])*p+c[0]])}}else{let p=4*c[2]*c[2]-12*c[3]*c[1];if(p>0){let m=Math.sqrt(p),f=(-2*c[2]+m)/(6*c[3]);f>=s?l.push([f+a[a.length-2],((c[3]*f+c[2])*f+c[1])*f+c[0]]):Math.abs(f)<s&&u&&l.push([f+a[a.length-2],((c[3]*f+c[2])*f+c[1])*f+c[0]])}}return{newValues:{allMinima:l}}}else{if(n.functionChild&&n.functionChild.length===1)return{newValues:{allMinima:n.functionChild[0].stateValues.allMinima}};let a=n.numericalf,i=-100*n.xscale,s=100*n.xscale,l=1e3,u=(s-i)/l,c=[],d=!1,p=a(i);for(let m=0;m<l;m++){let f=i+m*u,h=i+(m+1)*u,y=p;if(p=a(h),Number.isNaN(y)||Number.isNaN(p))continue;let b=t.fminbr(a,[f,h]);if(b.success!==!0)continue;let g=b.x,C=b.fx;y<C?(d&&Number.isFinite(y)&&c.push([f,y]),d=!1):p<C?d=!0:(d=!1,C<p&&C<y&&C<a(g+b.tol)&&C<a(g-b.tol)&&Number.isFinite(C)&&c.push([g,C]))}return{newValues:{allMinima:c}}}}},e.numberMinima={public:!0,componentType:"number",returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}),definition({dependencyValues:n}){return{newValues:{numberMinima:n.allMinima.length},checkForActualChange:{numberMinima:!0}}}},e.minima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["minimum","minimumLocations","minimumLocation","minimumValues","minimumValue"],returnWrappingComponents(n){return n==="minimum"||n===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a}){if(["minimum","minimumLocation","minimumValue"].includes(n)){let i=Number(r)-1;return Number.isInteger(i)&&i>=0?!a||i<a[0]?n==="minimum"?[i+",0",i+",1"]:n==="minimumLocation"?[i+",0"]:[i+",1"]:[]:[]}else return n==="minimumLocations"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",0"):n==="minimumValues"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,a]=n.split(",");return a==="0"?"minimumLocation"+(Number(r)+1):"minimumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"}}),returnArraySize({dependencyValues:n}){return[n.numberMinima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let a=0;a<n.__array_size[0];a++)for(let i=0;i<2;i++){let s=`${a},${i}`;r[s]=n.allMinima[a][i]}return{newValues:{minima:r}}}},e.allMaxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["allMaxima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){if(n.isInterpolatedFunction){let r=n.xs,a=n.coeffs,i=t.eps,s=[];if(r===null)return{newValues:{allMaxima:s}};let l=!1,u=a[0],c=r[1]-r[0];if(u[3]===0){if(u[2]<0){let d=-u[1]/(2*u[2]);d<=c-i?s.push([d+r[0],((u[3]*d+u[2])*d+u[1])*d+u[0]]):Math.abs(d-c)<i&&(l=!0)}}else{let d=4*u[2]*u[2]-12*u[3]*u[1];if(d>0){let p=Math.sqrt(d),m=(-2*u[2]-p)/(6*u[3]);m<=c-i?s.push([m+r[0],((u[3]*m+u[2])*m+u[1])*m+u[0]]):Math.abs(m-c)<i&&(l=!0)}}for(let d=1;d<r.length-2;d++)if(u=a[d],c=r[d+1]-r[d],u[3]===0)if(u[2]<0){let p=-u[1]/(2*u[2]);Math.abs(p)<i?l&&s.push([p+r[d],((u[3]*p+u[2])*p+u[1])*p+u[0]]):p>=i&&p<=c-i&&s.push([p+r[d],((u[3]*p+u[2])*p+u[1])*p+u[0]]),l=Math.abs(p-c)<i}else l=!1;else{let p=4*u[2]*u[2]-12*u[3]*u[1];if(p>0){let m=Math.sqrt(p),f=(-2*u[2]-m)/(6*u[3]);Math.abs(f)<i?l&&s.push([f+r[d],((u[3]*f+u[2])*f+u[1])*f+u[0]]):f>=i&&f<=c-i&&s.push([f+r[d],((u[3]*f+u[2])*f+u[1])*f+u[0]]),l=Math.abs(f-c)<i}else l=!1}if(u=a[r.length-2],u[3]===0){if(u[2]<0){let d=-u[1]/(2*u[2]);Math.abs(d)<i?l&&s.push([d+r[r.length-2],((u[3]*d+u[2])*d+u[1])*d+u[0]]):d>=i&&s.push([d+r[r.length-2],((u[3]*d+u[2])*d+u[1])*d+u[0]])}}else{let d=4*u[2]*u[2]-12*u[3]*u[1];if(d>0){let p=Math.sqrt(d),m=(-2*u[2]-p)/(6*u[3]);m>=i?s.push([m+r[r.length-2],((u[3]*m+u[2])*m+u[1])*m+u[0]]):Math.abs(m)<i&&l&&s.push([m+r[r.length-2],((u[3]*m+u[2])*m+u[1])*m+u[0]])}}return{newValues:{allMaxima:s}}}else{if(n.functionChild&&n.functionChild.length===1)return{newValues:{allMaxima:n.functionChild[0].stateValues.allMaxima}};let r=p=>-n.numericalf(p),a=-100*n.xscale,i=100*n.xscale,s=1e3,l=(i-a)/s,u=[],c=!1,d=r(a);for(let p=0;p<s;p++){let m=a+p*l,f=a+(p+1)*l,h=d;if(d=r(f),Number.isNaN(h)||Number.isNaN(d))continue;let y=t.fminbr(r,[m,f]);if(y.success!==!0)continue;let b=y.x,g=y.fx;h<g?(c&&Number.isFinite(h)&&u.push([m,-h]),c=!1):d<g?c=!0:(c=!1,g<d&&g<h&&g<r(b+y.tol)&&g<r(b-y.tol)&&Number.isFinite(g)&&u.push([b,-g]))}return{newValues:{allMaxima:u}}}}},e.numberMaxima={public:!0,componentType:"number",returnDependencies:()=>({allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:n}){return{newValues:{numberMaxima:n.allMaxima.length},checkForActualChange:{numberMaxima:!0}}}},e.maxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["maximum","maximumLocations","maximumLocation","maximumValues","maximumValue"],returnWrappingComponents(n){return n==="maximum"||n===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a}){if(["maximum","maximumLocation","maximumValue"].includes(n)){let i=Number(r)-1;return Number.isInteger(i)&&i>=0?!a||i<a[0]?n==="maximum"?[i+",0",i+",1"]:n==="maximumLocation"?[i+",0"]:[i+",1"]:[]:[]}else return n==="maximumLocations"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",0"):n==="maximumValues"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,a]=n.split(",");return a==="0"?"maximumLocation"+(Number(r)+1):"maximumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),returnArraySize({dependencyValues:n}){return[n.numberMaxima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let a=0;a<n.__array_size[0];a++)for(let i=0;i<2;i++){let s=`${a},${i}`;r[s]=n.allMaxima[a][i]}return{newValues:{maxima:r}}}},e.numberExtrema={public:!0,componentType:"number",returnDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"},numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),definition:function({dependencyValues:n}){return{newValues:{numberExtrema:n.numberMinima+n.numberMaxima},checkForActualChange:{numberExtrema:!0}}}},e.allExtrema={returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"},allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:n}){return{newValues:{allExtrema:[...n.allMinima,...n.allMaxima].sort((a,i)=>a[0]-i[0])}}}},e.extrema={public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["extremum","extremumLocations","extremumLocation","extremumValues","extremumValue"],returnWrappingComponents(n){return n==="extremum"||n===void 0?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a}){if(["extremum","extremumLocation","extremumValue"].includes(n)){let i=Number(r)-1;return Number.isInteger(i)&&i>=0?!a||i<a[0]?n==="extremum"?[i+",0",i+",1"]:n==="extremumLocation"?[i+",0"]:[i+",1"]:[]:[]}else return n==="extremumLocations"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",0"):n==="extremumValues"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,a]=n.split(",");return a==="0"?"extremumLocation"+(Number(r)+1):"extremumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberExtrema:{dependencyType:"stateVariable",variableName:"numberExtrema"}}),returnArraySize({dependencyValues:n}){return[n.numberExtrema,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allExtrema:{dependencyType:"stateVariable",variableName:"allExtrema"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let a=0;a<n.__array_size[0];a++)for(let i=0;i<2;i++){let s=`${a},${i}`;r[s]=n.allExtrema[a][i]}return{newValues:{extrema:r}}}},e.functionChild={returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction"}}),definition:function({dependencyValues:n}){return n.functionChild.length===1?{newValues:{functionChild:n.functionChild[0]}}:{newValues:{functionChild:null}}}},e.returnNumericalDerivatives={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["returnNumericalDerivatives"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{returnNumericalDerivatives:mh(n)}}:n.functionChild.length===1&&n.functionChild[0].stateValues.returnNumericalDerivatives?{newValues:{returnNumericalDerivatives:n.functionChild[0].stateValues.returnNumericalDerivatives}}:{newValues:{returnNumericalDerivatives:null}}}},e}static adapters=[{stateVariable:"numericalf",componentType:"curve"},{stateVariable:"formula",componentType:"math"}]},or=za;function ir(o){let t=o.formula,e=o.variable.tree,n=o.simplify,r=o.expand;return a=>We({value:t.substitute({[e]:a}),simplify:n,expand:r})}function sr(o){let t;try{t=o.formula.f()}catch(n){t=()=>NaN}let e=o.variable.tree;return function(n){try{return t({[e]:n})}catch(r){return NaN}}}function dh({dependencyValues:o,numerics:t}){let e=[],n=[],r={maximum:o.prescribedMaxima,minimum:o.prescribedMinima,extremum:o.prescribedExtrema,point:o.prescribedPoints};for(let v in r)for(let N of r[v]){let V=null,x=null,w=null;if(N.x!==null&&(V=N.x.evaluate_to_constant(),!Number.isFinite(V))){console.warn(`Ignoring non-numerical ${v}`);continue}if(N.y!==null&&(x=N.y.evaluate_to_constant(),!Number.isFinite(x))){console.warn(`Ignoring non-numerical ${v}`);continue}if(N.slope!==null&&N.slope!==void 0&&(w=N.slope.evaluate_to_constant(),Number.isFinite(w)||(console.warn("Ignoring non-numerical slope"),w=null)),V===null){if(x===null){console.warn(`Ignoring empty ${v}`);continue}n.push({type:v,y:x,slope:w})}else e.push({type:v,x:V,y:x,slope:w})}e.sort((v,N)=>v.x-N.x),n.sort((v,N)=>v.y-N.y);let a=-Infinity,i=t.eps;for(let v=0;v<e.length;v++){let N=e[v];if(N.x<=a+i)return console.warn("Two points with locations too close together.  Can't define function"),{newValues:{interpolationPoints:null}};a=N.x}let s=o.xscale,l=o.yscale;a=void 0;let u,c,d=[],p=e[0];for(let v=0;v<e.length;v++){let N=p;p=e[v+1];let V=y({p:N,pNext:p,typePrev:c,xPrev:a,yPrev:u});c=V.type,a=V.x,u=V.y}let m=!1;for(e.length===0&&(m=!0);n.length>0;){let v;c===void 0?v=T({allowedTypes:["maximum","minimum","extremum"],comparison:"atLeast",value:-Infinity}):c==="maximum"?v=T({allowedTypes:["minimum","extremum"],comparison:"atMost",value:u-l}):c==="minimum"?v=T({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:u+l}):c==="point"&&(v=T({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:u+l}),v.success!==!0&&(v=T({allowedTypes:["minimum","extremum"],comparison:"atMost",value:u-l})));let N;v.success===!0?(N=v.point,n.splice(v.ind,1),m?(N.x=0,m=!1):N.x=a+s):(N=n.pop(),m?(N.x=0,m=!1):N.x=a+2*s);let V=y({p:N,typePrev:c,xPrev:a,yPrev:u});c=V.type,a=V.x,u=V.y}if(d.length===0&&d.push({type:"point",x:0,y:0,slope:0}),m=d[0],m.type==="maximum"){let v={type:"point",x:m.x-s,y:m.y-l,slope:2*l/s};d.splice(0,0,v)}else if(m.type==="minimum"){let v={type:"point",x:m.x-s,y:m.y+l,slope:-2*l/s};d.splice(0,0,v)}else if(m.type==="point")if(d.length===1)m.slope===null&&(m.slope=0);else{let v=d[1],N=(v.y-m.y)/(v.x-m.x);if(v.type==="maximum"||v.type==="minimum")m.slope===null&&(m.slope=2*N);else{d.length===2?m.slope===null&&(m.slope=N):(v.slope===null&&(v.slope=h({point:v,prevPoint:m,nextPoint:d[2]})),m.slope===null&&(m.slope=2*(m.y-v.y)/(m.x-v.x)-v.slope));let V={x:m.x-s,y:m.y-s*m.slope,slope:m.slope};d.splice(0,0,V)}}let f=d[d.length-1];if(f.type==="maximum"){let v={type:"point",x:f.x+s,y:f.y-l,slope:-2*l/s};d.push(v)}else if(f.type==="minimum"){let v={type:"point",x:f.x+s,y:f.y+l,slope:2*l/s};d.push(v)}else if(f.type==="point")if(d.length===1){let v={type:"point",x:f.x+s,y:f.y+m.slope*s,slope:m.slope};d.push(v)}else{let v=d[d.length-2],N=(v.y-f.y)/(v.x-f.x);if(v.type==="maximum"||v.type==="minimum")f.slope===null&&(f.slope=2*N);else{d.length===2?f.slope===null&&(f.slope=N):(v.slope===null&&(v.slope=h({point:v,prevPoint:d[d.length-3],nextPoint:f})),f.slope===null&&(f.slope=2*(v.y-f.y)/(v.x-f.x)-v.slope));let V={x:f.x+s,y:f.y+s*f.slope,slope:f.slope};d.push(V)}}for(let v=1;v<d.length-1;v++){let N=d[v];N.slope===null&&(N.slope=h({point:N,prevPoint:d[v-1],nextPoint:d[v+1]}))}return{newValues:{interpolationPoints:d}};function h({point:v,prevPoint:N,nextPoint:V}){let x=v.x-N.x,w=V.x-v.x,D=v.y-N.y,I=V.y-v.y,A=D/x,S=I/w,O=(A*w+S*x)/(x+w);return(Math.sign(A)+Math.sign(S))*Math.min(Math.abs(A),Math.abs(S),.5*Math.abs(O))}function y({p:v,pNext:N,typePrev:V,xPrev:x,yPrev:w}){let D;if(N!==void 0&&(D=N.y),v.type==="maximum")return b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N});if(v.type==="minimum")return g({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N});if(v.type==="extremum"){let I;if(V===void 0){if(N===void 0)return b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N});I=N.type}if(V==="maximum"||I==="maximum")return v.y!==null&&v.y>w-l?b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N}):I!==void 0&&v.y!==null&&v.y>N.y-l?b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N}):g({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N});if(V==="minimum"||I==="minimum")return v.y!==null&&v.y<w+l?g({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N}):I!==void 0&&v.y!==null&&v.y>N.y+l?g({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N}):b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N});if(V==="point"||I==="point"){let A="maximum";return(v.y===null&&N!==void 0&&N.type===maximum||v.y!==null&&v.y<=w-l||I!==void 0&&v.y!==null&&v.y>=N.y-l)&&(A="minimum"),A==="minimum"?g({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N}):b({x:v.x,y:v.y,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N})}}else if(v.type==="point")return C({x:v.x,y:v.y,slope:v.slope,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:N})}function b({x:v,y:N,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:I}){if(V===void 0)N===null&&(D===void 0?N=0:I.type==="maximum"?N=D:N=D+l);else if(V==="maximum"){N===null&&(D===void 0?N=w:I.type==="maximum"?N=Math.max(w,D):N=Math.max(w,D+l));let S=Math.min(w,N)-l,O=(v+x)/2,k,R,P=null,F=T({allowedTypes:["minimum","extremum"],comparison:"atMost",value:S});F.success===!0?(R="minimum",k=F.point.y,n.splice(F.ind,1),P=0):(R="point",k=S),d.push({type:R,x:O,y:k,slope:P})}else if(V==="minimum"){if(N===null)D===void 0?N=w+l:I.type==="maximum"?N=Math.max(w+l,D):N=Math.max(w,D)+l;else if(N<w+l){let S=[(2*x+v)/3,(x+2*v)/3],O=[w+l,N-l],k=["atLeast","atMost"],R=[["maximum","extremum"],["minimum","extremum"]];for(let P=0;P<2;P++){let F=S[P],L,_,$=null,z=T({allowedTypes:R[P],comparison:k[P],value:O[P]});z.success===!0?(_=R[P][0],L=z.point.y,n.splice(z.ind,1),$=0):(_="point",L=O[P],$=null),d.push({type:_,x:F,y:L,slope:$})}}}else if(V==="point"){if(N===null)D===void 0?N=w+l:I.type==="maximum"?N=Math.max(w+l,D):N=Math.max(w,D)+l;else if(N<w+l){let S=(v+x)/2,O,k,R=null,P=T({allowedTypes:["minimum","extremum"],comparison:"atMost",value:N-l});P.success===!0?(k="minimum",O=P.point.y,n.splice(P.ind,1),R=0):(k="point",O=N-l),d.push({type:k,x:S,y:O,slope:R})}}let A={type:"maximum",x:v,y:N,slope:0};return d.push(A),A}function g({x:v,y:N,typePrev:V,xPrev:x,yPrev:w,yNext:D,pNext:I}){if(V===void 0)N===null&&(D===void 0?N=0:I.type==="minimum"?N=D:N=D-l);else if(V==="maximum"){if(N===null)D===void 0?N=w-l:I.type==="minimum"?N=Math.min(w-l,D):N=Math.min(w,D)-l;else if(N>w-l){let S=[(2*x+v)/3,(x+2*v)/3],O=[w-l,N+l],k=["atMost","atLeast"],R=[["minimum","extremum"],["maximum","extremum"]];for(let P=0;P<2;P++){let F=S[P],L,_,$=null,z=T({allowedTypes:R[P],comparison:k[P],value:O[P]});z.success===!0?(_=R[P][0],L=z.point.y,n.splice(z.ind,1),$=0):(_="point",L=O[P],$=null),d.push({type:_,x:F,y:L,slope:$})}}}else if(V==="minimum"){N===null&&(D===void 0?N=w:I.type==="minimum"?N=Math.min(w,D):N=Math.min(w,D-l));let S=Math.max(w,N)+l,O=(v+x)/2,k,R,P=null,F=T({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:S});F.success===!0?(R="maximum",k=F.point.y,n.splice(F.ind,1),P=0):(R="point",k=S),d.push({type:R,x:O,y:k,slope:P})}else if(V==="point"){if(N===null)D===void 0?N=w-l:I.type==="minimum"?N=Math.min(w-l,D):N=Math.min(w,D)-l;else if(N>w-l){let S=(v+x)/2,O,k,R=null,P=T({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:N+l});P.success===!0?(k="maximum",O=P.point.y,n.splice(P.ind,1),R=0):(k="point",O=N+l),d.push({type:k,x:S,y:O,slope:R})}}let A={type:"minimum",x:v,y:N,slope:0};return d.push(A),A}function C({x:v,y:N,slope:V,typePrev:x,xPrev:w,yPrev:D,yNext:I,pNext:A}){if(x==="maximum"){if(N>D-l){let O=Math.min(D,N)-l,k=(v+w)/2,R,P,F=null,L=T({allowedTypes:["minimum","extremum"],comparison:"atMost",value:O});L.success===!0?(P="minimum",R=L.point.y,n.splice(L.ind,1),F=0):(P="point",R=D-l),d.push({type:P,x:k,y:R,slope:F})}}else if(x==="minimum"&&N<D+l){let O=Math.max(D,N)+l,k=(v+w)/2,R,P,F=null,L=T({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:O});L.success===!0?(P="maximum",R=L.point.y,n.splice(L.ind,1),F=0):(P="point",R=D+l),d.push({type:P,x:k,y:R,slope:F})}let S={type:"point",x:v,y:N,slope:V};return d.push(S),S}function T({allowedTypes:v,comparison:N,value:V}){let x=[];if(N==="atMost")x=Object.keys(n).reverse();else if(N==="atLeast")x=Object.keys(n);else return{success:!1};for(let w of v)for(let D of x){let I=n[D];if(I.type===w){if(N==="atMost"){if(I.y<=V)return{success:!0,ind:D,point:I}}else if(I.y>=V)return{success:!0,ind:D,point:I}}}return{success:!1}}}function ph({dependencyValues:o}){let t=function(s,l,u,c,d){return[s,u,(-3*s/d+3*l/d-2*u-c)/d,(2*s/d-2*l/d+u+c)/(d*d)]},e=o.interpolationPoints;if(e===null)return{newValues:{xs:null,coeffs:null}};let n=[],r=[],a,i=e[0];r.push(i.x);for(let s=1;s<e.length;s++){a=i,i=e[s];let l=t(a.y,i.y,a.slope,i.slope,i.x-a.x);Math.abs(l[3])<1e-14*Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]))&&(l[3]=0,Math.abs(l[2])<1e-14*Math.max(Math.abs(l[0]),Math.abs(l[1]))&&(l[2]=0)),n.push(l),r.push(i.x)}return{newValues:{xs:r,coeffs:n}}}function mu(o){let t=o.xs,e=o.coeffs,n=[];if(o.interpolationPoints&&(n=o.interpolationPoints.map(i=>i.y)),t===null)return i=>NaN;let r=t[0],a=t[t.length-1];return function(i){if(isNaN(i))return NaN;if(i<=r){i-=r;let p=e[0];return((p[3]*i+p[2])*i+p[1])*i+p[0]}if(i>=a){let p=t.length-2;i-=t[p];let m=e[p];return((m[3]*i+m[2])*i+m[1])*i+m[0]}for(var s=0,l,u=t.length-1;s<=u;){l=Math.floor(.5*(s+u));let p=t[l];if(p<i)s=l+1;else if(p>i)u=l-1;else return n[l]}let c=Math.max(0,u);i-=t[c];let d=e[c];return((d[3]*i+d[2])*i+d[1])*i+d[0]}}function mh(o){let t=o.xs,e=o.coeffs,n=t[0],r=t[t.length-1];return function(a=1){return a>3?i=>0:a<1||!Number.isInteger(a)||t==null?i=>NaN:function(i){if(isNaN(i))return NaN;if(i<=n){i-=n;let p=e[0];return a===1?(3*p[3]*i+2*p[2])*i+p[1]:a===2?6*p[3]*i+2*p[2]:6*p[3]}if(i>=r){let p=t.length-2;i-=t[p];let m=e[p];return a===1?(3*m[3]*i+2*m[2])*i+m[1]:a===2?6*m[3]*i+2*m[2]:6*m[3]}for(var s=0,l,u=t.length-1;s<=u;){l=Math.floor(.5*(s+u));let p=t[l];if(p<i)s=l+1;else if(p>i)u=l-1;else return a===1?e[l][1]:a===2?2*e[l][2]:6*e[l][3]}let c=Math.max(0,u);i-=t[c];let d=e[c];return a===1?(3*d[3]*i+2*d[2])*i+d[1]:a===2?6*d[3]*i+2*d[2]:6*d[3]}}}import Dn from"math-expressions";var Ha=class extends or{static componentType="_functionOperator";static returnSugarInstructions(){let t=[];return t.push({childrenRegex:/s/,replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"math",children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),r=e.newLeaf({name:"atMostOneFunctionForOperator",componentType:"function",comparison:"atMost",number:1});return e.newOperator({name:"functionXorMath",operator:"xor",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});e.isInterpolatedFunction={returnDependencies:()=>({}),definition:()=>({newValues:{isInterpolatedFunction:!1}})},delete e.nPrescribedPoints,delete e.prescribedPoints,delete e.prescribedMinima,delete e.prescribedMaxima,delete e.prescribedExtrema,delete e.interpolationPoints,delete e.xs;let n=e.variable.returnDependencies;e.variable.returnDependencies=function(){let a=n();return a.functionChild.childLogicName="atMostOneFunctionForOperator",a};let r=e.symbolic.returnDependencies;return e.symbolic.returnDependencies=function(){let a=r();return a.functionChild.childLogicName="atMostOneFunctionForOperator",a},e.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({newValues:{operatorBasedOnFormulaIfAvailable:!1}})},e.formula.returnDependencies=()=>({}),e.formula.definition=()=>({newValues:{formula:Dn.fromAst("\uFF3F")}}),e.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({newValues:{operatorComposesWithOriginal:!0}})},e.symbolicFunctionOperator={returnDependencies:()=>({}),definition:()=>({newValues:{symbolicFunctionOperator:a=>Dn.fromAst("\uFF3F")}})},e.numericalFunctionOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericalFunctionOperator:a=>NaN}})},e.formulaOperator={returnDependencies:()=>({}),definition:()=>({newValues:{formulaOperator:a=>Dn.fromAst("\uFF3F")}})},e.returnNumericalDerivatives={returnDependencies:()=>({}),definition:()=>({newValues:{returnNumericalDerivatives:null}})},e.formula={public:!0,componentType:"formula",additionalStateVariablesDefined:["operatorBasedOnFormula"],returnDependencies:()=>({operatorBasedOnFormulaIfAvailable:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormulaIfAvailable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["formula"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},formulaOperator:{dependencyType:"stateVariable",variableName:"formulaOperator"}}),definition:function({dependencyValues:a}){if(!a.operatorBasedOnFormulaIfAvailable||(a.functionChild.length===0||a.functionChild[0].stateValues.formula.tree==="\uFF3F")&&(a.mathChild.length===0||a.mathChild[0].stateValues.value.tree==="\uFF3F"))return{newValues:{formula:Dn.fromAst("\uFF3F"),operatorBasedOnFormula:!1}};let i;return a.functionChild.length===0?i=a.mathChild[0].stateValues.value:i=a.functionChild[0].stateValues.formula,{newValues:{formula:a.formulaOperator(i),operatorBasedOnFormula:!0}}}},e.symbolicf={returnDependencies:()=>({operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["symbolicf"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},symbolicFunctionOperator:{dependencyType:"stateVariable",variableName:"symbolicFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"}}),definition:function({dependencyValues:a}){if(a.operatorBasedOnFormula)return{newValues:{symbolicf:ir(a)}};if(a.operatorComposesWithOriginal)if(a.functionChild.length===0){if(a.mathChild.length===0)return{newValues:{symbolicf:i=>Dn.fromAst("\uFF3F")}};{let i=Object.assign({},a);i.formula=a.mathChild[0].stateValues.value;let s=ir(a);return{newValues:{symbolicf:l=>a.symbolicFunctionOperator(s(l))}}}}else{let i=a.functionChild[0].stateValues.symbolicf;return{newValues:{symbolicf:s=>a.symbolicFunctionOperator(i(s))}}}else return{newValues:{symbolicf:function(i){return a.symbolicFunctionOperator(i)}}}}},e.numericalf={returnDependencies:()=>({operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["numericalf"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"}}),definition:function({dependencyValues:a}){if(a.operatorBasedOnFormula)return{newValues:{numericalf:sr(a)}};if(a.operatorComposesWithOriginal)if(a.functionChild.length===0){if(a.mathChild.length===0)return{newValues:{numericalf:i=>NaN}};{let i=Object.assign({},a);i.formula=a.mathChild[0].stateValues.value;let s=sr(a);return{newValues:{numericalf:l=>a.numericalFunctionOperator(s(l))}}}}else{let i=a.functionChild[0].stateValues.numericalf;return{newValues:{numericalf:s=>a.numericalFunctionOperator(i(s))}}}else return{newValues:{numericalf:function(i){return a.numericalFunctionOperator(i)}}}}},e.functionChild={returnDependencies:()=>({}),definition:()=>({newValues:{functionChild:null}})},e.allMinima.returnDependencies=()=>({numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"}}),e.allMaxima.returnDependencies=()=>({numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"}}),e}},Zt=Ha;import lr from"math-expressions";var fu=class extends Zt{static componentType="clampFunction";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.numericalFunctionOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:n}){return{newValues:{numericalFunctionOperator:function(r){return Number.isFinite(r)?Math.max(n.lowerValue,Math.min(n.upperValue,r)):NaN}}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>lr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}},hu=class extends Zt{static componentType="wrapFunctionPeriodic";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.numericalFunctionOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:n}){return{newValues:{numericalFunctionOperator:function(r){if(!Number.isFinite(r))return NaN;let a=n.lowerValue,i=n.upperValue;return a===i?a:(a>i&&([i,a]=[a,i]),a+lr.math.mod(r-a,i-a))}}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>lr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}},bu=class extends Zt{static componentType="derivative";static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({newValues:{operatorBasedOnFormulaIfAvailable:!0}})},e.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({newValues:{operatorComposesWithOriginal:!1}})},e.formulaOperator={returnDependencies:()=>({variable:{dependencyType:"stateVariable",variableName:"variable"}}),definition({dependencyValues:n}){return{newValues:{formulaOperator:function(r){return r.derivative(n.variable.tree)}}}}},e.numericalFunctionOperator={returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["returnNumericalDerivatives"],variablesOptional:!0}}),additionalStateVariablesDefined:["returnNumericalDerivatives"],definition:function({dependencyValues:n}){return n.functionChild.length===0||!n.functionChild[0].stateValues.returnNumericalDerivatives?{newValues:{numericalFunctionOperator:r=>NaN,returnNumericalDerivatives:null}}:{newValues:{numericalFunctionOperator:n.functionChild[0].stateValues.returnNumericalDerivatives(1),returnNumericalDerivatives:(r=1)=>n.functionChild[0].stateValues.returnNumericalDerivatives(r+1)}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>lr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}};var qa={};ye(qa,{Extrema:()=>gu,Extremum:()=>yu});var yu=class extends B{static componentType="extremum";static rendererType=void 0;static get stateVariablesShadowedForReference(){return["location","value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.location={createComponentOfType:"math"},e.value={createComponentOfType:"math"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let i=ht({childrenToComponentFunction:s=>({componentType:"math",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});if(!i.success&&n.length===1)return{success:!0,newAttributes:{value:{componentType:"math",children:n}}};if(i.success){if(i.newChildren.length===1)return{success:!0,newAttributes:{value:i.newChildren[0]}};if(i.newChildren.length===2){let s=i.newChildren[0],l=i.newChildren[1],u={location:s,value:l};return(s.children.length===0||s.children.length===1&&s.children[0].componentType==="string"&&s.children[0].state.value.trim()==="")&&delete u.location,(l.children.length===0||l.children.length===1&&l.children[0].componentType==="string"&&l.children[0].state.value.trim()==="")&&delete u.value,{success:!0,newAttributes:u}}else return{success:!1}}return i};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOnePoint",componentType:"point",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t}),n=this;return e.value={public:!0,componentType:"math",defaultValue:null,additionalStateVariablesDefined:[{variableName:"location",public:!0,componentType:"math",defaultValue:null}],returnDependencies:()=>({extremumChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["nDimensions","xs"]},location:{dependencyType:"attributeComponent",attributeName:"location",variableNames:["value"]},value:{dependencyType:"attributeComponent",attributeName:"value",variableNames:["value"]}}),definition:function({dependencyValues:r}){let a,i;if(r.extremumChild.length===1){let p=r.extremumChild[0];p.stateValues.nDimensions!==2?(console.log("Cannot determine "+n.componentType+" from a point that isn't 2D"),a=null,i=null):(a=p.stateValues.xs[0],i=p.stateValues.xs[1])}else r.location!==null&&(a=r.location.stateValues.value),r.value!==null&&(i=r.value.stateValues.value);let s={},l={},u=!1,c=!1;a===void 0?(l.location={variablesToCheck:["location"]},c=!0):(s.location=a,u=!0),i===void 0?(l.value={variablesToCheck:["value"]},c=!0):(s.value=i,u=!0);let d={};return u&&(d.newValues=s),c&&(d.useEssentialOrDefaultValue=l),d}},e}},gu=class extends B{static componentType="extrema";static rendererType=void 0;static componentTypeSingular="extremum";static get componentTypeCapitalized(){return this.componentType.charAt(0).toUpperCase()+this.componentType.slice(1)}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=this,n=function({matchedChildren:r}){let a=Ge({componentList:r});return a.success!==!0?{success:!1}:{success:!0,newChildren:a.pieces.map(function(i){return i.length>1||i[0].componentType==="string"?{componentType:e.componentTypeSingular,children:i}:i[0]})}};return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroExtrema",componentType:this.componentTypeSingular,comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0});return e.newOperator({name:"extremaAndPoints",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return t["n"+e.componentTypeCapitalized]={additionalStateVariablesDefined:["childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"extremaAndPoints"}}),definition:function({dependencyValues:n}){return{newValues:{["n"+e.componentTypeCapitalized]:n.children.length,childIdentities:n.children}}}},t[e.componentType]={isArray:!0,nDimensions:2,entryPrefixes:[e.componentTypeSingular,e.componentTypeSingular+"Locations",e.componentTypeSingular+"Location",e.componentTypeSingular+"Values",e.componentTypeSingular+"Value"],stateVariablesDeterminingDependencies:["childIdentities"],getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a}){if([e.componentTypeSingular,e.componentTypeSingular+"Location",e.componentTypeSingular+"Value"].includes(n)){let i=Number(r)-1;return Number.isInteger(i)&&i>=0?!a||i<a[0]?n===e.componentTypeSingular?[i+",0",i+",1"]:n===e.componentTypeSingular+"Location"?[i+",0"]:[i+",1"]:[]:[]}else return n===e.componentTypeSingular+"Locations"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",0"):n===e.componentTypeSingular+"Values"?!a||r!==""?[]:Array.from(Array(a[0]),(i,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,a]=n.split(",");return a==="0"?e.componentTypeSingular+"Location"+(Number(r)+1):e.componentTypeSingular+"Value"+(Number(r)+1)},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a}){if(n==="pointX"){let i=r.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>s<a[l])?[String(i)]:[]:[String(i)]:[]}else{if(!a)return[];let i=Number(r)-1;return Number.isInteger(i)&&i>=0&&i<a[0]?Array.from(Array(a[1]),(s,l)=>i+","+l):[]}},returnArraySizeDependencies:()=>({nChildren:{dependencyType:"stateVariable",variableName:"n"+e.componentTypeCapitalized}}),returnArraySize({dependencyValues:n}){return[n.nChildren,2]},returnArrayDependenciesByKey({arrayKeys:n,stateValues:r}){let a={};for(let i of n){let[s,l]=i.split(","),u;r.childIdentities[s].componentType===e.componentTypeSingular?u=Number(l)===0?"location":"value":u="x"+(Number(l)+1),a[i]={child:{dependencyType:"child",childLogicName:"extremaAndPoints",variableNames:[u],childIndices:[s]}}}return{dependenciesByKey:a}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].child[0];if(s){let l=i.split(",")[1],u=Number(l)===0?"location":"value";u in s.stateValues?a[i]=s.stateValues[u]:a[i]=s.stateValues["x"+(Number(l)+1)]}}return{newValues:{[e.componentType]:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r}){let a=[];for(let i in n[e.componentType])a.push({setDependency:r[i].extremumChild,desiredValue:n[e.componentType][i],childIndex:0,variableIndex:0});return{success:!0,instructions:a}}},t}};var Ka={};ye(Ka,{Pattern:()=>vu,Replace:()=>Cu});var vu=class extends B{static componentType="pattern";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneChild",componentType:"_base",number:1,setAsBase:!0}),e}},Cu=class extends B{static componentType="replace";static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:i}){let s=i[0],l=s.state.value.split(",");if(l.length!==2)return{success:!1};let u=l.map(c=>({componentType:"string",state:{value:c.trim()}}));return{success:!0,newChildren:u,toDelete:[s.componentName]}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"exactlyTwoChildren",componentType:"_base",number:2});return e.newOperator({name:"SugarXorChildren",operator:"xor",propositions:[r,a],setAsBase:!0}),e}};var Ua={};ye(Ua,{Alert:()=>Tu,Em:()=>Nu,Q:()=>Vu,SQ:()=>xu,Term:()=>wu,c:()=>Du});var Wa=class extends E{static componentType="_inlineRenderInlineChildren";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"AtLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}},rt=Wa;var Nu=class extends rt{static componentType="em"},Tu=class extends rt{static componentType="alert"},Vu=class extends rt{static componentType="q"},xu=class extends rt{static componentType="sq"},wu=class extends rt{static componentType="term";static rendererType="alert"},Du=class extends rt{static componentType="c"};var Ga={};ye(Ga,{Mdash:()=>Su,NBSP:()=>Iu,Ndash:()=>Au});var Au=class extends E{static componentType="ndash"},Su=class extends E{static componentType="mdash"},Iu=class extends E{static componentType="nbsp"};var Ya={};ye(Ya,{AnswerSet:()=>Eu,Aside:()=>Bu,Example:()=>Lu,Exercise:()=>Fu,Paragraphs:()=>Ru,Problem:()=>Qa,Section:()=>Ou,StandinForFutureLayoutTag:()=>Mu,Subsection:()=>ku,Subsubsection:()=>Pu});var Xa=class extends B{static componentType="_block"},X=Xa;import Za from"math-expressions";function An({numberOfIndices:o,numberOfOptions:t,maxNumber:e=Infinity,withReplacement:n=!0}){if(o===1){let s=[...Array(t).keys()];return s=[...s.slice(1),0].slice(0,e),s=s.map(l=>[l]),s}let r=An({numberOfIndices:o-1,numberOfOptions:t,maxNumber:e,withReplacement:n}),a=[],i=0;for(let s of r)for(let l=1;l<=t;l++){let u=[l%t,...s.map(c=>(l+c)%t)];if(!(!n&&new Set(u).size<o)&&(a.push(u),i++,i>=e))return a}return a}function Jt({numberOfOptionsByIndex:o,maxNumber:t=Infinity}){let e=o.length;if(e===0)return[];let n=[];for(let f=0;f<e;f++){let h=[];for(let y=0;y<f;y++)h.push(Za.math.gcd(o[f],o[y]));n.push(h)}let r=n.reduce((f,h)=>[...h,...f],[]).reduce((f,h)=>Math.max(f,h),1);if(r===1){let f=o.reduce((y,b)=>y*b);f=Math.min(f,t);let h=[];for(let y=0;y<f;y++){let b=o.map(g=>y%g);h.push(b)}return h}if(e===2){let f=r,h=Za.math.lcm(...o),y=[],b=0;for(let g=0;g<f;g++)for(let C=0;C<h;C++){let T=[C%o[0],(C+g)%o[1]];if(y.push(T),b++,b>=t)return y}return y}let a=[];for(let f=0;f<e;f++){let h=[];for(let y=0;y<f;y++)n[f][y]>1?h.push(Za.math.lcm(o[f],o[y])):h.push(null);a.push(h)}let i=a.reduce((f,h)=>[...h,...f],[]).filter(f=>f!==null).reduce((f,h)=>Math.min(f,h),Infinity),s;for(let f=0;f<e;f++){for(let h=0;h<f;h++)if(a[f][h]===i){s=[h,f];break}if(s)break}let l=o[s[0]],u=o[s[1]],c=[l,u],d=o;d[s[0]]=l*u,d.splice(s[1],1);let p=Jt({numberOfOptionsByIndex:d,maxNumber:t}),m=Jt({numberOfOptionsByIndex:c,maxNumber:t});for(let f of p){let h=m[f[s[0]]];f.splice(s[0],1,h[0]),f.splice(s[1],0,h[1])}return p}function Yt({variantNumber:o,serializedComponent:t,allComponentClasses:e}){if(t.variants===void 0)return{success:!1};let n=t.variants.descendantVariantComponents;if(n===void 0)return{success:!1};let r=n.map(s=>s.variants.numberOfVariants),a=Jt({numberOfOptionsByIndex:r,maxNumber:o+1})[o],i=[];for(let[s,l]of n.entries()){let c=e[l.componentType].getUniqueVariant({serializedComponent:l,variantNumber:a[s],allComponentClasses:e});if(c.success)i.push(c.desiredVariant);else return{succss:!1}}return{success:!0,desiredVariants:i}}var Ja=class extends X{static componentType="_sectioningComponent";static renderChildren=!0;static setUpVariantIfVariantControlChild=!0;static get stateVariablesShadowedForReference(){return["title"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.aggregateScores={createComponentOfType:"boolean",createStateVariable:"aggregateScores",defaultValue:!1,public:!0},e.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},e.sectionWideCheckWork={createComponentOfType:"boolean",createStateVariable:"sectionWideCheckWork",defaultValue:!1,public:!0},e.delegateCheckWorkToAnswerNumber={createComponentOfType:"boolean",createStateVariable:"delegateCheckWorkToAnswerNumber",defaultValue:null,forRenderer:!0,public:!0},e.feedbackDefinitions={createComponentOfType:"feedbackDefinitions",createStateVariable:"feedbackDefinitions",propagateToDescendants:!0,mergeArrays:!0,public:!0},e.styleDefinitions={createComponentOfType:"styleDefinitions",createStateVariable:"styleDefinitions",propagateToDescendants:!0,mergeArrays:!0,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneVariantControl",componentType:"variantControl",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),a=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"variantTitleAndAnything",operator:"and",propositions:[n,r,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=this,e=super.returnStateVariableDefinitions();return e.enumeration={forRenderer:!0,returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["enumeration"]}}),definition({dependencyValues:n}){let r=[];return n.sectionAncestor&&r.push(...n.sectionAncestor.stateValues.enumeration),r.push(n.countAmongSiblings),{newValues:{enumeration:r}}}},e.sectionName={returnDependencies:()=>({}),definition:()=>({newValues:{sectionName:"Section"}})},e.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:n}){let r=null;return n.titleChild.length===1&&(r=n.titleChild[0].componentName),{newValues:{titleChildName:r}}}},e.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]},sectionName:{dependencyType:"stateVariable",variableName:"sectionName"},enumeration:{dependencyType:"stateVariable",variableName:"enumeration"}}),definition({dependencyValues:n}){if(n.titleChild.length===0){let r=t.defaultTitle;return r||(r=n.sectionName+" "+n.enumeration.join(".")),{newValues:{title:r}}}else return{newValues:{title:n.titleChild[0].stateValues.text}}}},e.containerTag={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{containerTag:"section"}})},e.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{level:1}})},e.viewedSolution={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:{variablesToCheck:["viewedSolution"]}}}),inverseDefinition({desiredStateVariableValues:n}){return{success:!0,instructions:[{setStateVariable:"viewedSolution",value:n.viewedSolution}]}}},e.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:n}){let r=[];for(let a of n.scoredDescendants)a.stateValues.aggregateScores||a.stateValues.scoredDescendants===void 0?r.push(a):r.push(...a.stateValues.scoredDescendants);return{newValues:{scoredDescendants:r}}}},e.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],recurseToMatchedChildren:!1}}),definition({dependencyValues:n}){return{newValues:{answerDescendants:n.answerDescendants}}}},e.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition({dependencyValues:n}){return{newValues:{justSubmitted:n.answerDescendants.every(r=>r.stateValues.justSubmitted)}}}},e.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition({dependencyValues:n}){return{newValues:{showCorrectness:n.showCorrectnessFlag!==!1}}}},e.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({newValues:{displayDigitsForCreditAchieved:3}})},e.creditAchieved={public:!0,componentType:"number",forRenderer:!0,defaultValue:0,stateVariablesPrescribingAdditionalAttributes:{displayDigits:"displayDigitsForCreditAchieved"},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,componentType:"number",stateVariablesPrescribingAdditionalAttributes:{displayDigits:"displayDigitsForCreditAchieved"}}],stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:n}){let r={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(n.aggregateScores){r.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[a,i]of n.scoredDescendants.entries())r["creditAchieved"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"creditAchieved"}}return r},definition({dependencyValues:n}){if(!n.aggregateScores)return{newValues:{creditAchieved:0,percentCreditAchieved:0}};let r=0,a=0;for(let[l,u]of n.scoredDescendants.entries()){let c=u.stateValues.weight;r+=n["creditAchieved"+l]*c,a+=c}let i=r/a,s=i*100;return{newValues:{creditAchieved:i,percentCreditAchieved:s}}}},e.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:n}){let r={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(n.aggregateScores){r.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[a,i]of n.scoredDescendants.entries())r["creditAchievedIfSubmit"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"creditAchievedIfSubmit"}}return r},definition({dependencyValues:n}){if(!n.aggregateScores)return{newValues:{creditAchievedIfSubmit:0}};let r=0,a=0;for(let[s,l]of n.scoredDescendants.entries()){let u=l.stateValues.weight;r+=n["creditAchievedIfSubmit"+s]*u,a+=u}return{newValues:{creditAchievedIfSubmit:r/a}}}},e.selectedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:n})=>({variantControlChild:{dependencyType:"child",childLogicName:"atMostOneVariantControl",variableNames:["selectedVariantNumber"]},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(n.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:n}){let r,a={};n.variantControlChild.length===1?(r=!0,a.index=n.variantControlChild[0].stateValues.selectedVariantNumber):r=!1;let i=a.subvariants=[];for(let s of n.variantDescendants)s.stateValues.isVariantComponent?i.push(s.stateValues.selectedVariantInfo):s.stateValues.selectedVariantInfo&&i.push(...s.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:a,isVariantComponent:r}}}},e.collapsible={componentType:"boolean",forRenderer:!0,returnDependencies:()=>({}),definition(){return{newValues:{collapsible:!1}}}},e.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:n}){return{success:!0,instructions:[{setStateVariable:"open",value:n.open}]}}},e.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:["createSubmitAllButtonOnAnswer"],returnDependencies:()=>({sectionWideCheckWork:{dependencyType:"stateVariable",variableName:"sectionWideCheckWork"},delegateCheckWorkToAnswerNumber:{dependencyType:"stateVariable",variableName:"delegateCheckWorkToAnswerNumber"},aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"},answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition({dependencyValues:n,componentName:r}){let a=!1,i=null;if(n.sectionWideCheckWork)if(!n.aggregateScores)console.warn(`Cannot create submit all button for ${r} because it doesn't aggegrate scores`);else{let s=null;if(n.delegateCheckWorkToAnswerNumber>0)s=n.answerDescendants[n.delegateCheckWorkToAnswerNumber-1];else if(n.delegateCheckWorkToAnswerNumber<0){let l=n.answerDescendants.length+n.delegateCheckWorkToAnswerNumber;s=n.answerDescendants[l]}s?i=s.componentName:a=!0}return{newValues:{createSubmitAllButton:a,createSubmitAllButtonOnAnswer:i}}}},e.suppressAnswerSubmitButtons={additionalStateVariablesDefined:["answerDelegatedForSubmitAll","componentNameForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"],forRenderer:!0,returnDependencies:()=>({createSubmitAllButton:{dependencyType:"stateVariable",variableName:"createSubmitAllButton"},createSubmitAllButtonOnAnswer:{dependencyType:"stateVariable",variableName:"createSubmitAllButtonOnAnswer"},justSubmitted:{dependencyType:"stateVariable",variableName:"justSubmitted"},creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons","answerDelegatedForSubmitAll","componentNameForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition({dependencyValues:n,componentName:r}){let a=!1,i=null,s=null,l=null,u=null;if(n.createSubmitAllButton||n.createSubmitAllButtonOnAnswer)s=r,a=!0,n.createSubmitAllButtonOnAnswer&&(i=n.createSubmitAllButtonOnAnswer,l=n.justSubmitted,u=n.creditAchieved);else if(n.sectionAncestor){let c=n.sectionAncestor.stateValues;a=c.suppressAnswerSubmitButtons,s=c.componentNameForSubmitAll,i=c.answerDelegatedForSubmitAll,l=c.justSubmittedForSubmitAll,u=c.creditAchievedForSubmitAll}return{newValues:{suppressAnswerSubmitButtons:a,componentNameForSubmitAll:s,answerDelegatedForSubmitAll:i,justSubmittedForSubmitAll:l,creditAchievedForSubmitAll:u}}}},e}actions={submitAllAnswers:this.submitAllAnswers.bind(this),revealSection:this.revealSection.bind(this),closeSection:this.closeSection.bind(this)};submitAllAnswers(){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{creditAchieved:this.stateValues.creditAchievedIfSubmit}});for(let t of this.stateValues.answerDescendants)this.coreFunctions.requestAction({componentName:t.componentName,actionName:"submitAnswer"})}revealSection(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}closeSection(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}static setUpVariant({serializedComponent:t,sharedParameters:e,definingChildrenSoFar:n,allComponentClasses:r}){let a;for(let s of n)if(s!==void 0&&s.componentType==="variantControl"){a=s;break}e.variant=a.state.selectedVariant.value,e.variantNumber=a.state.selectedVariantNumber.value,e.selectRng=a.state.selectRng.value,e.allPossibleVariants=a.state.variants.value,console.log("Variant for "+this.componentType+": "+e.variant);let i=t.variants.desiredVariant;if(i===void 0&&(i={}),i.subvariants===void 0&&t.variants.uniqueVariants){let s=this.getUniqueVariant({serializedComponent:t,variantNumber:e.variantNumber,allComponentClasses:r});s.success&&Object.assign(i,s.desiredVariant)}if(i!==void 0&&i.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0)for(let s in i.subvariants){let l=i.subvariants[s],u=t.variants.descendantVariantComponents[s];if(u===void 0)break;u.variants.desiredVariant=l}}static determineNumberOfUniqueVariants({serializedComponent:t}){if(t.children===void 0)return{success:!0};let e,n;for(let[i,s]of t.children.entries())if(s.componentType==="variantControl"||s.createdComponent&&components[s.componentName].componentType==="variantControl"){e=i,n=s;break}if(e===void 0)return{success:!0};let r=100;if(n.attributes&&n.attributes.nVariants!==void 0){let i=n.attributes.nVariants,s=!1;if(i.state!==void 0&&i.state.value!==void 0&&(r=Math.round(Number(i.state.value)),s=!0),i.children!==void 0&&i.children.length===1&&i.children[0].componentType==="string"&&(r=Math.round(Number(i.children[0].state.value)),s=!0),!s)return{success:!1}}t.variants===void 0&&(t.variants={});let a;if(t.variants.uniqueVariants){let i=1,s=[];t.variants.descendantVariantComponents!==void 0&&(s=t.variants.descendantVariantComponents.map(l=>l.variants.numberOfVariants),i=s.reduce((l,u)=>l*u,1),a={numberOfVariantsByDescendant:s}),r=Math.min(i,r)}return{success:!0,numberOfVariants:r,uniqueVariantData:a}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let a={index:e};if(t.variants.uniqueVariants){let i=Yt({variantNumber:e,serializedComponent:t,allComponentClasses:n});i.success?a.subvariants=i.desiredVariants:console.log("Failed to get unique variant for "+t.componentType)}return{success:!0,desiredVariant:a}}static includeBlankStringChildren=!0},Fe=Ja;var Ou=class extends Fe{static componentType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:1}}),t}},ku=class extends Fe{static componentType="subsection";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:2}}),t}},Pu=class extends Fe{static componentType="subsubsection";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:3}}),t}},Ru=class extends Fe{static componentType="paragraphs";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:4}}),t}},Bu=class extends Fe{static componentType="aside";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.collapsible.definition=()=>({newValues:{collapsible:!0}}),t.open.defaultValue=!1,t.level.definition=()=>({newValues:{level:3}}),t.containerTag.definition=()=>({newValues:{containerTag:"aside"}}),t}},Qa=class extends Fe{static componentType="problem";static rendererType="section";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.aggregateScores.defaultValue=!0,e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Problem"}}),t.level.definition=()=>({newValues:{level:3}}),t}},Fu=class extends Qa{static componentType="exercise";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Exercise"}}),t}},Lu=class extends Fe{static componentType="example";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Example"}}),t.level.definition=()=>({newValues:{level:3}}),t}},Eu=class extends Fe{static componentType="answerSet";static rendererType="section";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.aggregateScores.defaultValue=!0,e.sectionWideCheckWork={createComponentOfType:"boolean",createStateVariable:"sectionWideCheckWork",defaultValue:!0,public:!0,forRenderer:!0,ignorePropagationFromAncestors:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:null}}),t.containerTag.definition=()=>({newValues:{containerTag:"none"}}),t}},Mu=class extends Fe{static componentType="standinForFutureLayoutTag";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:3}}),t.containerTag.definition=()=>({newValues:{containerTag:"aside"}}),t}};var ei={};ye(ei,{Li:()=>$u,Ol:()=>ti,Ul:()=>_u});var ti=class extends X{static componentType="ol";static rendererType="list";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:void 0,public:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLis",componentType:"li",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!0}})},t}},_u=class extends ti{static componentType="ul";static rendererType="list";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!1}})},t}},$u=class extends B{static componentType="li";static rendererType="list";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0});return e.newOperator({name:"inlineOrBlock",operator:"or",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.item={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{item:!0}})},t}};var ui={};ye(ui,{CobwebPolyline:()=>Hu,HideInitialCondition:()=>qu,InitialCondition:()=>ju,InitialPoint:()=>Ku,ODESystem:()=>zu});import at from"math-expressions";var ni=class extends E{static componentType="odesystem";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.independentvariable={default:at.fromAst("t")},e.initialindependentvariablevalue={default:at.fromAst(0)},e.displaydigits={default:14},e.rendermode={default:"align"},e.chunksize={default:10},e.tolerance={default:1e-6},e.maxIterations={default:1e3},e.hideInitialCondition={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atMostOneVariables",componentType:"variables",comparison:"atMost",number:1}),r=e.newLeaf({name:"atLeastZeroRHSs",componentType:"righthandside",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroInitialConditions",componentType:"initialcondition",comparison:"atLeast",number:0});return e.newOperator({name:"ODEsystemLogic",operator:"and",propositions:[n,r,a],setAsBase:!0}),e}updateState(t={}){if(t.init===!0&&(this.makePublicStateVariableArray({variableName:"variables",componentType:"variable"}),this.makePublicStateVariableArrayEntry({entryName:"var",arrayVariableName:"variables"}),this.makePublicStateVariableArray({variableName:"rhss",componentType:"righthandside"}),this.makePublicStateVariableArrayEntry({entryName:"rhs",arrayVariableName:"rhss"}),this.makePublicStateVariableAlias({variableName:"rhs",targetName:"rhs",arrayIndex:"1"}),this.makePublicStateVariableArrayEntry({entryName:"righthandside",arrayVariableName:"rhss"}),this.makePublicStateVariableAlias({variableName:"righthandside",targetName:"rhs",arrayIndex:"1"}),this.makePublicStateVariableAlias({variableName:"righthandsides",targetName:"rhss"}),this.makePublicStateVariableArray({variableName:"initialconditions",componentType:"initialcondition"}),this.makePublicStateVariableArrayEntry({entryName:"initialcondition",arrayVariableName:"initialconditions"}),this.makePublicStateVariableAlias({variableName:"initialcondition",targetName:"initialcondition",arrayIndex:"1"}),this.makePublicStateVariableArray({variableName:"numericalsolutions",componentType:"function",stateVariableForRef:"numericF"}),this.makePublicStateVariableArrayEntry({entryName:"numericalsolution",arrayVariableName:"numericalsolutions"}),this.makePublicStateVariableAlias({variableName:"numericalsolution",targetName:"numericalsolution",arrayIndex:"1"})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.variables=!0,this.unresolvedState.rhss=!0,this.unresolvedState.initialconditions=!0,this.unresolvedState.numericalsolutions=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let i=this.childLogic.returnMatches("atMostOneVariables");i.length===1?this.state.variablesChild=this.activeChildren[i[0]]:(delete this.state.variablesChild,this.state.validVariables=[],this._state.variables.essential||(this.state.variables=[]));let s=this.childLogic.returnMatches("atLeastZeroRHSs");this.state.rhsChildren=s.map(u=>this.activeChildren[u]);let l=this.childLogic.returnMatches("atLeastZeroInitialConditions");this.state.initialConditionChildren=l.map(u=>this.activeChildren[u])}let r=e.getVariableChanges({component:this,variable:"variables"})||e.getVariableChanges({component:this,variable:"independentvariable"})||this.state.rhsChildren.some(i=>e.getVariableChanges({component:i,variable:"variable"}))||this.state.initialConditionChildren.some(i=>e.getVariableChanges({component:i,variable:"variable"}));if(this.state.variablesChild){if(this.state.variablesChild.unresolvedState.variables)this.unresolvedState.variables=!0;else if(n||r||e.getVariableChanges({component:this.state.variablesChild,variable:"variables"})){r=!0,this.state.variables=[...this.state.variablesChild.state.variables];for(let i=0;i<this.state.variables.length;i++){let s=this.state.variables[i];this.state.independentvariable.equals(s)&&console.warn("Variables of odesystem must be different than independent variable.");for(let l=0;l<i;l++)this.state.variables[l].equals(s)&&console.warn("Variables of odesystem must be unique.")}}this.state.variablesChild.unresolvedState.validVariables?this.unresolvedState.validVariables=!0:(n||r||e.getVariableChanges({component:this.state.variablesChild,variable:"validVariables"}))&&(r=!0,this.state.validVariables=[...this.state.variablesChild.state.validVariables])}else r&&(this.state.validVariables=[],this._state.variables.essential||(this.state.variables=[]));if(this.state.rhsChildren.some(i=>i.unresolvedState.variable||i.unresolvedState.value)||this.state.initialConditionChildren.some(i=>i.unresolvedState.variable||i.unresolvedState.value)){this.unresolvedState.variables=!0,this.unresolvedState.rhss=!0,this.unresolvedState.initialconditions=!0,this.unresolvedState.numericalsolutions=!0;return}let a=n||r||this.state.rhsChildren.some(i=>e.getVariableChanges({component:i,variable:"value"}))||this.state.initialConditionChildren.some(i=>e.getVariableChanges({component:i,variable:"value"}));if(a){this.state.rhss=[];let i=new Set,s=new Set;for(let[p,m]of this.state.rhsChildren.entries()){let f=m.state.variable,h;if(f!==void 0&&(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1))if(this.state.rhss[h]===void 0)this.state.rhss[h]=m.state.value,s.add(p);else{let y="Duplicate variable "+f+" in rhs of odesystem.";console.warn(y)}}for(let[p,m]of this.state.rhsChildren.entries()){if(s.has(p))continue;let f=m.state.variable,h;if(f===void 0)h=this.state.rhss.findIndex(y=>!y),h===-1&&(h=this.state.rhss.length),this.state.rhss[h]=m.state.value,f=this.state.variables[h],f===void 0&&(i.add(h),this.state.variables[h]=at.fromAst("\uFF3F\uFF3F"));else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1){let y="Duplicate variable "+f+" in rhs of odesystem.";if(t.init)throw Error(y);y+=" Repeated rhs with same variable are ignored",console.warn(y)}else h=this.state.variables.findIndex(y=>!y),h===-1&&(h=this.state.variables.length),this.state.rhss[h]=m.state.value,this.state.variables[h]=f,m._state.variable.additionalVars&&(this.state.validVariables[h]=m._state.variable.additionalVars.validVariable)}for(let p of i)this.state.variables[p]=void 0;s=new Set,this.state.initialconditions=[];let l=0,u=0;for(let[p,m]of this.state.initialConditionChildren.entries()){let f=m.state.variable,h;if(f===void 0)l++;else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1)if(u++,this.state.initialconditions[h]===void 0)this.state.initialconditions[h]=m.state.value,s.add(p);else{let y="Duplicate variable "+f+" in initial condtion of odesystem.";if(t.init)throw Error(y);y+=" Repeated initial conditions with same variable are ignored",console.warn(y)}}let c=this.state.variables.length-i.size-u,d=Math.max(0,l-c);for(let[p,m]of this.state.initialConditionChildren.entries()){if(s.has(p))continue;let f=m.state.variable,h;if(f===void 0){if(h=this.state.initialconditions.findIndex(y=>!y),h===-1&&(h=this.state.initialconditions.length),f=this.state.variables[h],f===void 0)if(d>0)d--,i.add(h),this.state.variables[h]=at.fromAst("\uFF3F\uFF3F");else for(;h<this.state.variables.length-1&&(h++,f=this.state.variables[h],f===void 0););this.state.initialconditions[h]=m.state.value}else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1){let y="Duplicate variable "+f+" in initial conditions of odesystem.";if(t.init)throw Error(y);y+=" Repeated initial conditions with same variable are ignored",console.warn(y)}else h=this.state.variables.findIndex(y=>!y),h===-1?h=this.state.variables.length:i.delete(h),this.state.initialconditions[h]=m.state.value,this.state.variables[h]=f}if(i.size>0){i=[...i].sort();let p=[];for(let m=0;m<this.state.variables.length;m++){let f;m<3?f=at.fromAst(["x","y","z"][m]):f=at.fromAst(["_","x",m+1]),this.state.variables.findIndex(h=>h&&h.equals(f))===-1&&p.push(f)}p.reverse();for(let m of i)this.state.variables[m]=p.pop()}this.state.nDimensions=this.state.variables.length;for(let p in this.state.variables)this.state.rhss[p]||(this.state.rhss[p]=at.fromAst(0)),this.state.initialconditions[p]||(this.state.initialconditions[p]=at.fromAst(0))}if(a||e.getVariableChanges({component:this,variable:"hideInitialCondition"})||e.getVariableChanges({component:this,variable:"displaydigits"})||e.getVariableChanges({component:this,variable:"independentvariable"})||e.getVariableChanges({component:this,variable:"initialindependentvariablevalue"})||e.getVariableChanges({component:this,variable:"initialconditions"})){let i=[];for(let[s,l]of this.state.rhss.entries()){let u=this.state.variables[s],c="\\frac{\\mathrm{d} "+u.toLatex()+" }{ \\mathrm{d} "+this.state.independentvariable.toLatex()+" } &= "+l.round_numbers_to_precision(this.state.displaydigits).toLatex();i.push(c)}if(!this.state.hideInitialCondition)for(let[s,l]of this.state.initialconditions.entries()){let c=this.state.variables[s].toLatex()+" ( "+this.state.initialindependentvariablevalue+" ) &= "+l.round_numbers_to_precision(this.state.displaydigits).toLatex();i.push(c)}this.state.latex=i.join("\\\\")}(a||e.getVariableChanges({component:this,variable:"chunksize"})||e.getVariableChanges({component:this,variable:"tolerance"})||e.getVariableChanges({component:this,variable:"maxIterations"})||e.getVariableChanges({component:this,variable:"independentvariable"})||e.getVariableChanges({component:this,variable:"initialindependentvariablevalue"})||e.getVariableChanges({component:this,variable:"initialconditions"}))&&(this.state.fnumericRHS=this.returnNumericRHSfunction(),this.state.t0=this.state.initialindependentvariablevalue.evaluate_to_constant(),this.state.x0s=this.state.initialconditions.map(i=>i.evaluate_to_constant()),!Number.isFinite(this.state.t0)||!this.state.x0s.every(i=>Number.isFinite(i))?this.state.nonNumericValues=!0:delete this.state.nonNumericValues,this.state.calculatedNumericSolutions=[],this.state.endingNumericalValues=[],this.state.maxPossibleTime=void 0,this.state.numericalsolutions=this.state.variables.map((i,s)=>this.returnNumericSolution(s)),e.addNewValue(this,"numericalsolutions"))}returnNumericRHSfunction(t){let e=this.state.rhss;if(t!==void 0){let i=e[t];if(i===void 0)return;e=[i]}let n;try{n=e.map(i=>i.subscripts_to_strings().f())}catch(i){return console.warn("Cannot define ODE RHS function.  Error creating mathjs function"),s=>NaN}if(this._state.independentvariable.additionalVars&&!this._state.independentvariable.additionalVars.validVariable)return console.warn("Can't define ODE RHS function with invalid independent variable."),i=>NaN;if(this.state.validVariables.some(i=>i===!1))return console.warn("Can't define ODE RHS function with dependent variables."),i=>NaN;let r=this.state.independentvariable.subscripts_to_strings().tree,a=this.state.variables.map(i=>i.subscripts_to_strings().tree);return a.includes(r)?(console.warn("Can't define ODE RHS function when independent variable is a dependent varaible"),i=>NaN):[...new Set(a)].length!==a.length?(console.warn("Can't define ODE RHS function with duplicate dependent varaible names"),i=>NaN):function(i,s){let l={[r]:i};Array.isArray(s)?s.forEach((u,c)=>l[a[c]]=u):l[a[0]]=s;try{return n.map(u=>u(l))}catch(u){return NaN}}}returnNumericSolution(t){return function(n){if(this.state.nonNumericValues)return NaN;if(!Number.isFinite(n))return NaN;if(n===this.state.t0)return t!==void 0?this.state.x0s[t]:this.state.x0s;let r=this.state.calculatedNumericSolutions.length,a=Math.ceil((n-this.state.t0)/this.state.chunksize)-1;if(a<0)return NaN;if(this.state.maxPossibleTime===void 0&&a>=r)for(let s=r;s<=a;s++){let l=this.state.endingNumericalValues[s-1];l===void 0&&(l=this.state.x0s);let u=this.state.t0+s*this.state.chunksize,c=at.math.dopri(u,u+this.state.chunksize,l,this.state.fnumericRHS,this.state.tolerance,this.state.maxIterations);this.state.endingNumericalValues.push(c.y[c.y.length-1]),this.state.calculatedNumericSolutions.push(c.at.bind(c));let d=c.x[c.x.length-1];if(d<(u+this.state.chunksize)*(1-1e-6)){this.state.maxPossibleTime=d;let p="For chunksize "+this.state.chunksize+" and tolerance "+this.state.tolerance+", odesystem";this.doenetAttributes.componentName!==void 0&&(p+=" ("+this.doenetAttributes.componentName+")"),p+=" hit maxiterations ("+this.state.maxIterations+") at t = "+this.state.maxPossibleTime+". Will not calculate solution beyond that time. Decrease chunksize, increase maxiterations, or increase tolerance to calculate further.",console.warn(p);break}}if(n>this.state.maxPossibleTime)return NaN;let i=this.state.calculatedNumericSolutions[a](n);return t!==void 0&&(i=i[t]),i}.bind(this)}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}this.renderer=new this.availableRenderers.math({key:this.componentName,mathLatex:this.state.latex,renderMode:this.state.rendermode})}updateRenderer(){this.renderer.updateMathLatex(this.state.latex)}},zu=ni;var ri=class extends B{static componentType="_graphical";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"",public:!0,forRenderer:!0},e.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},e.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.selectedStyle={forRenderer:!0,willNeverBeEssential:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:e}){let n=e.ancestorWithStyle.stateValues.styleDefinitions;n||(n=Xt());let r;for(let a of n)e.styleNumber===a.styleNumber&&(r===void 0?r=a:r=Object.assign(Object.assign({},a),r));return r===void 0&&(r=n[0]),{newValues:{selectedStyle:r}}}},t}},se=ri;import ai from"math-expressions";var ii=class extends se{static componentType="polyline";actions={movePolyline:this.movePolyline.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["vertices","nVertices"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.vertices={createComponentOfType:"_pointListComponent"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return e.vertices!==null?{newValues:{nVertices:e.vertices.stateValues.nPoints}}:{newValues:{nVertices:0}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies(){return{vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nDimensions"]}}},definition:function({dependencyValues:e}){return e.vertices!==null?{newValues:{nDimensions:e.vertices.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.vertices={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],returnWrappingComponents(e){return e==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="vertexX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},getAllArrayKeys(e,n=!0,r){function a(i){if(i.length===1)return Array.from(Array(i[0]),(s,l)=>String(l));{let s=i[0],l=a(i.slice(1)),u=[];for(let c=0;c<s;c++)n?u.push(...l.map(d=>c+","+d)):u.push(l.map(d=>c+","+d));return u}}if(r){if(r.length===0||!e)return[];{let i=[...e];return i[0]=r[0],a(i)}}else return!e||e.length===0?[]:a(e)},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nVertices,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[a,i]=r.split(","),s=Number(a)+1+"_"+(Number(i)+1);n[r]={vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+s]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let[i,s]=a.split(","),l=Number(i)+1+"_"+(Number(s)+1),u=e[a].vertices;u!==null&&u.stateValues["pointX"+l]?r[a]=u.stateValues["pointX"+l]:r[a]=ai.fromAst("\uFF3F")}return{newValues:{vertices:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:a,stateValues:i}){if(a&&!i.draggable)return{success:!1};let s=[];for(let l in e.vertices){let[u,c]=l.split(","),d=Number(u)+1+"_"+(Number(c)+1);if(n[l].vertices!==null&&n[l].vertices.stateValues["pointX"+d])s.push({setDependency:r[l].vertices,desiredValue:e.vertices[l],variableIndex:0});else return{success:!1}}return{success:!0,instructions:s}}},t.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:e}){return[e.nVertices]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(r)+1)}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].vertex.map(s=>s.evaluate_to_constant());i.every(s=>Number.isFinite(s))||(i=Array(i.length).fill(NaN)),r[a]=i}return{newValues:{numericalVertices:r}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},vertices:{dependencyType:"stateVariable",variableName:"vertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2||e.nVertices===0)return{};let r=Infinity,a={},i=n.x1.evaluate_to_constant(),s=n.x2.evaluate_to_constant(),l,u,c=e.vertices[0][0].evaluate_to_constant(),d=e.vertices[0][1].evaluate_to_constant();for(let p=1;p<e.nVertices;p++){if(l=c,u=d,c=e.vertices[p][0].evaluate_to_constant(),d=e.vertices[p][1].evaluate_to_constant(),!(Number.isFinite(l)&&Number.isFinite(u)&&Number.isFinite(c)&&Number.isFinite(d)))continue;let m=c-l,f=d-u,h=m*m+f*f;if(h===0)continue;let y=((i-l)*m+(s-u)*f)/h,b;y<=0?b={x1:l,x2:u}:y>=1?b={x1:c,x2:d}:b={x1:l+y*m,x2:u+y*f};let g=Math.pow(i-b.x1,2)+Math.pow(s-b.x2,2);g<r&&(r=g,a=b)}return n.x3!==void 0&&Object.keys(a).length>0&&(a.x3=0),a}}})},t}movePolyline(t,e,n){let r={};for(let a in t)r[a+",0"]=ai.fromAst(t[a][0]),r[a+",1"]=ai.fromAst(t[a][1]);e?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:r,sourceInformation:n}],transient:e}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:r,sourceInformation:n}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:t}}})}},Qt=ii;import gt from"math-expressions";var si=class extends Qt{static componentType="cobwebpolyline";static rendererType="cobwebpolyline";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.attractThreshold={default:.5},e.nPoints={default:1,clamp:[0,Infinity],forRenderer:!0},e.variable={default:gt.fromAst("x"),forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"exactlyOneInitialPoint",componentType:"initialpoint",number:1}),r=e.newLeaf({name:"exactlyOneFunction",componentType:"function",number:1});return e.newOperator({name:"initialPointAndFunction",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDimensions.returnDependencies=()=>({}),t.nDimensions.definition=()=>({newValues:{nDimensions:2}}),t.initialPoint={isArray:!0,entryPrefixes:["initialPointX"],returnWrappingComponents(e){return e==="initialPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let a=Number(r)+1;n[r]={initialPointChild:{dependencyType:"child",childLogicName:"exactlyOneInitialPoint",variableNames:["x"+a]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=Number(a)+1;e[a].initialPointChild.length===1?r[a]=e[a].initialPointChild[0].stateValues["x"+i]:r[a]=0}return{newValues:{initialPoint:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r}){let a=[];for(let i in e.initialPoint)if(n[i].initialPointChild.length===1&&n[i].initialPointChild[0].stateValues["x"+(Number(i)+1)])a.push({setDependency:r[i].initialPointChild,desiredValue:e.initialPoint[i],childIndex:0,variableIndex:0});else return{success:!1};return{success:!0,instructions:a}}},t.f={forRenderer:!0,returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"exactlyOneFunction",variableNames:["numericalf"]}}),definition({dependencyValues:e}){return e.functionChild.length===1?{newValues:{f:e.functionChild[0].stateValues.numericalf}}:{newValues:{f:null}}}},t.nVertices={isAlias:!0,targetVariableName:"nPoints"},t.nOriginalVertices={providePreviousValuesInDefinition:!0,returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e,previousValues:n}){let r=e.nVertices;return n.nOriginalVertices>r&&(r=n.nOriginalVertices),{newValues:{nOriginalVertices:r}}}},t.originalVertices={essential:!0,isArray:!0,nDimensions:2,entryPrefixes:["originalVertexX","originalVertex"],defaultEntryValue:gt.fromAst(0),getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="originalVertexX"){let a=n.split("_").map(i=>Number(i)-1);return a.length===2&&a.every((i,s)=>Number.isInteger(i)&&i>=0)?r?a.every((i,s)=>i<r[s])?[String(a)]:[]:[String(a)]:[]}else{if(!r)return[];let a=Number(n)-1;return Number.isInteger(a)&&a>=0&&a<r[0]?Array.from(Array(r[1]),(i,s)=>a+","+s):[]}},returnArraySizeDependencies:()=>({nOriginalVertices:{dependencyType:"stateVariable",variableName:"nOriginalVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nOriginalVertices-1,e.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let n={};for(let r of e){let a=r.split(",").map(i=>Number(i)+1).join("_");n[r]={variablesToCheck:["originalVertex"+a]}}return{useEssentialOrDefaultValue:{originalVertices:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[];for(let r in e.originalVertices)n.push({setStateVariable:"originalVertices",value:{[r]:e.originalVertices[r]}});return{success:!0,instructions:n}}},t.vertices.additionalStateVariablesDefined=[{variableName:"prelimCorrectVertices",entryPrefixes:["prelimCorrectVertexX","prelimCorrectVertex"],getArrayKeysFromVarName:function({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="prelimCorrectVertexX"){let a=n.split("_").map(i=>Number(i)-1);return a.length===2&&a.every((i,s)=>Number.isInteger(i)&&i>=0)?r?a.every((i,s)=>i<r[s])?[String(a)]:[]:[String(a)]:[]}else{if(!r)return[];let a=Number(n)-1;return Number.isInteger(a)&&a>=0&&a<r[0]?Array.from(Array(r[1]),(i,s)=>a+","+s):[]}}}],t.vertices.basedOnArrayKeyStateVariables=!0,t.vertices.returnArrayDependenciesByKey=function({arrayKeys:e}){let n={f:{dependencyType:"stateVariable",variableName:"f"},attractThreshold:{dependencyType:"stateVariable",variableName:"attractThreshold"}},r={};for(let a of e){let[i,s]=a.split(",");i==="0"?r[a]={initialPoint:{dependencyType:"stateVariable",variableName:"initialPointX"+(Number(s)+1)}}:r[a]={originalVertexX1:{dependencyType:"stateVariable",variableName:"originalVertexX"+i+"_1"},originalVertexX2:{dependencyType:"stateVariable",variableName:"originalVertexX"+i+"_2"},previousVertexX1:{dependencyType:"stateVariable",variableName:"vertexX"+i+"_1"},previousVertexX2:{dependencyType:"stateVariable",variableName:"vertexX"+i+"_2"}}}return{globalDependencies:n,dependenciesByKey:r}},t.vertices.arrayDefinitionByKey=function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={},i={};for(let s of r){let[l,u]=s.split(",");if(l==="0")a[s]=n[s].initialPoint,i[s]=null;else{let c,d;try{c=[n[s].originalVertexX1.evaluate_to_constant(),n[s].originalVertexX2.evaluate_to_constant()],d=[n[s].previousVertexX1.evaluate_to_constant(),n[s].previousVertexX2.evaluate_to_constant()]}catch(f){a[l+",0"]=gt.fromAst(0),a[l+",1"]=gt.fromAst(0),i[l+",0"]=!1;continue}let p;if(Number(l)%2==1){let f=e.f(d[0]);p=[d[0],f]}else p=[d[1],d[1]];Math.pow(c[0]-p[0],2)+Math.pow(c[1]-p[1],2)<e.attractThreshold*e.attractThreshold?(a[l+",0"]=gt.fromAst(p[0]),a[l+",1"]=gt.fromAst(p[1]),i[l+",0"]=!0):(a[l+",0"]=n[s].originalVertexX1,a[l+",1"]=n[s].originalVertexX2,i[l+",0"]=!1),i[l+",1"]=null}}return{newValues:{vertices:a,prelimCorrectVertices:i}}},t.vertices.inverseArrayDefinitionByKey=function({desiredStateVariableValues:e,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!a.draggable)return{success:!1};let i=[];for(let s in e.vertices){let[l,u]=s.split(",");l==="0"?i.push({setDependency:n[s].initialPoint,desiredValue:e.vertices[s]}):i.push({setDependency:n[s]["originalVertexX"+(Number(u)+1)],desiredValue:e.vertices[s]})}return{success:!0,instructions:i}},t.correctVertices={isArray:!0,public:!0,componentType:"boolean",entryPrefixes:["correctVertex"],returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:e}){return[e.nVertices-1]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={prelimCorrectVertex:{dependencyType:"stateVariable",variableName:"prelimCorrectVertexX"+(Number(r)+2)+"_1"}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)r[a]=e[a].prelimCorrectVertex;return{newValues:{correctVertices:r}}}},t.fractionCorrectVertices={public:!0,componentType:"number",additionalStateVariablesDefined:[{variableName:"nGradedVertices",public:!0,componentType:"number"},{variableName:"nCorrectVertices",public:!0,componentType:"number"}],returnDependencies:()=>({correctVertices:{dependencyType:"stateVariable",variableName:"correctVertices"}}),definition({dependencyValues:e}){let n=e.correctVertices.length,r,a;return n===0?(r=0,a=0):(a=e.correctVertices.reduce((i,s)=>i+s,0),r=a/n),{newValues:{fractionCorrectVertices:r,nGradedVertices:n,nCorrectVertices:a}}}},t.nIterateValues={public:!0,componentType:"number",returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nIterateValues:Math.ceil((e.nVertices+1)/2)}})},t.iterateValues={isArray:!0,public:!0,componentType:"number",entryPrefixes:["iterateValue"],returnArraySizeDependencies:()=>({nIterateValues:{dependencyType:"stateVariable",variableName:"nIterateValues"}}),returnArraySize({dependencyValues:e}){return[e.nIterateValues]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)r==="0"?n[r]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX1_1"}}:n[r]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX"+2*Number(r)+"_2"}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)r[a]=e[a].iterateValue;return{newValues:{iterateValues:r}}}},t.childrenToRender={returnDependencies:()=>({}),definition:()=>({newValues:{childrenToRender:[]}})},t}updateState(t={}){super.updateState(t),t.init&&(this.makePublicStateVariableArray({variableName:"iteratevalues",componentType:"number"}),this.makePublicStateVariableArrayEntry({entryName:"iteratevalue",arrayVariableName:"iteratevalues"}),this.makePublicStateVariableAlias({variableName:"lastvertex",targetName:"vertex",arrayIndex:"-1"}),this.state.draggablePoints=[]);let e=!1;(childrenChanged||trackChanges.getVariableChanges({component:this.state.initialPointChild,variable:"coords"})||trackChanges.getVariableChanges({component:this,variable:"vertices",index:0}))&&(this.state.initialPoint=this.state.initialPointChild.state.coords.copy(),this.state.vertices[0]=this.state.initialPoint,e=!0);let n=this.state.vertices.length;if(this.state.nPoints>n){let a=Math.min(this.state.nPoints,n+this.state.removedVertices.length);a>n&&(this.state.vertices.push(...this.state.removedVertices.slice(0,a-n)),this.state.removedVertices=this.state.removedVertices.slice(a-n),n=a);for(let i=n;i<this.state.nPoints;i++){let s=gt.fromAst(["tuple",0,0]);this.state.vertices.push(s)}}else this.state.nPoints<n&&(this.state.removedVertices=[...this.state.vertices.slice(this.state.nPoints),...this.state.removedVertices],this.state.vertices.length=this.state.nPoints,this.state.correctvertices.length=this.state.nPoints-1);this.state.draggablePoints.length!==this.state.nPoints&&(this.state.draggablePoints=new Array(this.state.nPoints).fill(!1),this.state.nPoints>1&&(this.state.draggablePoints[this.state.nPoints-1]=!0));let r=[];e?(r=[...Array(this.state.nPoints).keys()].slice(1),this.state.correctvertices=[]):this.state.nPoints>1&&(r=[this.state.nPoints-1]);for(let a of r){let i;if(a%2==1){let s=this.state.vertices[a-1],l=this.findFiniteNumericalValue(s.get_component(0)),u=this.state.f(l);i=[l,u]}else{let s=this.state.vertices[a-1],l=this.findFiniteNumericalValue(s.get_component(1));i=[l,l]}if(i!==void 0){let s=this.state.vertices[a],l=this.findFiniteNumericalValue(s.get_component(0)),u=this.findFiniteNumericalValue(s.get_component(1));Math.pow(l-i[0],2)+Math.pow(u-i[1],2)<this.state.attractThreshold*this.state.attractThreshold?(this.state.vertices[a]=gt.fromAst(["tuple",...i]),this.state.correctvertices[a-1]=!0):this.state.correctvertices[a-1]=!1}}this.state.iteratevalues=this.state.vertices.filter((a,i)=>i%2==1).map(a=>a.get_component(1).evaluate_to_constant())}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}if(this.unresolvedState.vertices===void 0){let t={movePolyline:this.movePolyline};this.renderer=new this.availableRenderers.polyline2d({key:this.componentName,actions:t,label:this.state.label,draggable:!1,layer:this.state.layer,visible:!this.state.hide,pointcoords:this.state.vertices.map(e=>[e.get_component(0).evaluate_to_constant(),e.get_component(1).evaluate_to_constant()]),color:this.state.selectedStyle.lineColor,width:this.state.selectedStyle.lineWidth,style:this.state.selectedStyle.lineStyle,pointColor:this.state.selectedStyle.markerColor,pointSize:this.state.selectedStyle.markerSize,pointStyle:this.state.selectedStyle.markerStyle})}}updateRenderer(){this.renderer.updatePolyline({visible:!this.state.hide,pointcoords:this.state.vertices.map(t=>[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()])})}calculateDownstreamChanges({stateVariablesToUpdate:t,stateVariableChangesToSave:e,dependenciesToUpdate:n}){let r={},a=new Set([]),i=Array(this.state.nPoints);for(let c in t)if(c==="vertices"){r[c]===void 0&&(r[c]={isArray:!0,changes:{arrayComponents:{}}});for(let d in t[c].changes.arrayComponents)a.add(Number(d)),i[d]=r[c].changes.arrayComponents[d]=t[c].changes.arrayComponents[d]}a.has(0)&&(n[this.state.initialPointChild.componentName]={coords:{changes:i[0]}});let s=this.updateShadowSources({newStateVariables:r,dependenciesToUpdate:n}),l=s.shadowedStateVariables,u=s.isReplacement;for(let c in r)this._state[c].essential===!0&&!l.has(c)&&!u&&(e[c]=r[c]);return!0}},Hu=si;import en from"math-expressions";var oi=class extends E{static componentType="number";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.displayDigits={createComponentOfType:"number",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displaySmallAsZero={createComponentOfType:"boolean",createStateVariable:"displaySmallAsZero",defaultValue:!1,public:!0},e.renderAsMath={createComponentOfType:"boolean",createStateVariable:"renderAsMath",defaultValue:!1,public:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:/..+/,replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"math",children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1}),r=e.newLeaf({name:"exactlyOneNumber",componentType:"number",number:1});return e.newOperator({name:"stringXorNumberXorSugar",operator:"xor",propositions:[r,n],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({numberChild:{dependencyType:"child",childLogicName:"exactlyOneNumber",variableNames:["value","canBeModified"]},stringChild:{dependencyType:"child",childLogicName:"atMostOneString",variableNames:["value"]}}),defaultValue:NaN,definition:function({dependencyValues:e}){if(e.numberChild.length===0){if(e.stringChild.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value"]}}};let n=Number(e.stringChild[0].stateValues.value);if(Number.isNaN(n))try{n=en.fromAst(Z.convert(e.stringChild[0].stateValues.value)).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return{newValues:{value:n}}}else return{newValues:{value:e.numberChild[0].stateValues.value}}},set:function(e){let n=Number(e);if(Number.isNaN(n))try{n=en.fromAst(Z.convert(e)).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return n},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,stateValues:r,overrideFixed:a}){if(!r.canBeModified&&!a)return{success:!1};let i=e.value;i instanceof en.class?(i=i.evaluate_to_constant(),Number.isFinite(i)||(i=NaN)):i=Number(i);let s;return n.numberChild.length===0?n.stringChild.length===0?s=[{setStateVariable:"value",value:i}]:s=[{setDependency:"stringChild",desiredValue:i.toString(),childIndex:0,variableIndex:0}]:s=[{setDependency:"numberChild",desiredValue:i,childIndex:0,variableIndex:0}],{success:!0,instructions:s}}},t.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:e}){let n=en.round_numbers_to_precision(e.value,e.displayDigits).tree;return e.displaySmallAsZero&&Math.abs(n)<1e-14&&(n=0),{newValues:{valueForDisplay:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.valueForDisplay.toString()}}}},t.math={public:!0,componentType:"math",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return Number.isNaN(e.value)?{newValues:{math:en.fromAst("\uFF3F")}}:{newValues:{math:en.fromAst(e.value)}}},inverseDefinition:function({desiredStateVariableValues:e}){let n=e.math.evaluate_to_constant();return n===null&&(n=NaN),{success:!0,instructions:[{setDependency:"value",desiredValue:n}]}}},t.canBeModified={returnDependencies:()=>({numberChildModifiable:{dependencyType:"child",childLogicName:"exactlyOneNumber",variableNames:["canBeModified"]},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"}}),definition:function({dependencyValues:e}){return!e.modifyIndirectly||e.fixed?{newValues:{canBeModified:!1}}:e.numberChildModifiable.length===1&&!e.numberChildModifiable[0].stateValues.canBeModified?{newValues:{canBeModified:!1}}:{newValues:{canBeModified:!0}}}},t}static adapters=["math","text"]},tn=oi;import vt from"math-expressions";var li=class extends se{static componentType="point";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["xs","nDimensions"]}static primaryStateVariableForDefinition="coordsShadow";static stateVariableForAttributeValue="coords";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.x={createComponentOfType:"math"},e.y={createComponentOfType:"math"},e.z={createComponentOfType:"math"},e.xs={createComponentOfType:"mathList"},e.coords={createComponentOfType:"coords"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let i=ht({childrenToComponentFunction:s=>({componentType:"math",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return!i.success&&n.length===1?{success:!0,newAttributes:{x:{componentType:"math",children:n}}}:(i.success&&(i.newAttributes={xs:{componentType:"mathList",children:i.newChildren}},delete i.newChildren),i)};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOnePoint",componentType:"point",comparison:"atMost",number:1}),r=e.newLeaf({name:"atMostOneConstraints",componentType:"constraints",comparison:"atMost",number:1});return e.newOperator({name:"pointWithConstraints",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){return{newValues:{styleDescription:e.selectedStyle.markerColor}}}},t.styleDescriptionWithNoun={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n=e.selectedStyle.markerColor;return e.selectedStyle.markerStyle==="circle"?n+=" point":n+=` ${e.selectedStyle.markerStyle}`,{newValues:{styleDescriptionWithNoun:n}}}},t.coordsShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{coordsShadow:{variablesToCheck:["coords","coordsShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e,stateValues:n,workspace:r}){let a=ol({desiredVector:e.coordsShadow,currentVector:n.coordsShadow,workspace:r,workspaceKey:"desiredCoords"});return{success:!0,instructions:[{setStateVariable:"coordsShadow",value:a}]}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]},x:{dependencyType:"attributeComponent",attributeName:"x"},y:{dependencyType:"attributeComponent",attributeName:"y"},z:{dependencyType:"attributeComponent",attributeName:"z"},xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e,changes:n}){let r=!1,a,i;if(e.coords!==null?(r=!0,a=e.coords.stateValues.value):e.coordsShadow&&(r=!0,a=e.coordsShadow),r){let s=a.tree;return Array.isArray(s)&&["tuple","vector"].includes(s[0])?i=s.length-1:i=1,{newValues:{nDimensions:i},checkForActualChange:{nDimensions:!0}}}else{if(e.xs!==null)return{newValues:{nDimensions:e.xs.stateValues.nComponents}};if(e.pointChild.length===1)return{newValues:{nDimensions:e.pointChild[0].stateValues.nDimensions}};e.z!==null?i=3:e.y!==null?i=2:e.x!==null?i=1:i=2}return{newValues:{nDimensions:i},checkForActualChange:{nDimensions:!0}}}},t.arrayVariableForConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{arrayVariableForConstraints:"unconstrainedXs"}})},t.arrayEntryPrefixForConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{arrayEntryPrefixForConstraints:"unconstrainedX"}})},t.nDimensionsForConstraints={isAlias:!0,targetVariableName:"nDimensions"},t.unconstrainedXs={isArray:!0,entryPrefixes:["unconstrainedX"],defaultEntryValue:vt.fromAst(0),returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]}},r={};for(let a of e){let i=Number(a)+1;r[a]={xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+i]},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["x"+i]}},a==="0"?r[a].component={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:a==="1"?r[a].component={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:a==="2"&&(r[a].component={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]})}return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={},i={},s=!1,l;if(e.coords!==null?(s=!0,l=e.coords.stateValues.value):e.coordsShadow&&(s=!0,l=e.coordsShadow),s){let c=l.tree;if(Array.isArray(c)&&["tuple","vector"].includes(c[0]))for(let d of r){let p=Number(d);(p>=0||p<c.length-1)&&(l.tree[p+1]===void 0?a[d]=vt.fromAst("\uFF3F"):a[d]=l.get_component(p).simplify())}else r.includes("0")&&(a[0]=l.simplify())}else for(let c of r){let d=Number(c)+1,p=n[c].xs;if(p!==null)a[c]=p.stateValues["math"+d].simplify();else{let m=n[c].pointChild;if(m.length===1)a[c]=m[0].stateValues["x"+d];else{let f=n[c].component;f!==null?a[c]=f.stateValues.value.simplify():i[c]={variablesToCheck:[{variableName:"xs",arrayIndex:c},{variableName:"coords",mathComponentIndex:c}]}}}}let u={};return Object.keys(a).length>0&&(u.newValues={unconstrainedXs:a}),Object.keys(i).length>0&&(u.useEssentialOrDefaultValue={unconstrainedXs:i}),u},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[],l=!1,u;if(n.coords!==null?(l=!0,u="coords"):n.coordsShadow!==null&&(l=!0,u="coordsShadow"),l){let c;if(i[0]===1)c=ne(e.unconstrainedXs[0]);else{let p=Array(i[0]+1);p[0]="vector";for(let m in e.unconstrainedXs){let f=e.unconstrainedXs[m];p[Number(m)+1]=f instanceof vt.class?f.tree:f}c=vt.fromAst(p)}let d={setDependency:u,desiredValue:c};return u==="coords"&&(d.childIndex=0,d.variableIndex=0),s.push(d),{success:!0,instructions:s}}else{for(let c of Object.keys(e.unconstrainedXs).reverse()){if(!r[c])continue;r[c].xs!==null?s.push({setDependency:a[c].xs,desiredValue:ne(e.unconstrainedXs[c]),childIndex:0,variableIndex:0}):r[c].pointChild.length===1?s.push({setDependency:a[c].pointChild,desiredValue:ne(e.unconstrainedXs[c]),childIndex:0,variableIndex:0}):r[c].component!==null?s.push({setDependency:a[c].component,desiredValue:e.unconstrainedXs[c],childIndex:0,variableIndex:0}):s.push({setStateVariable:"unconstrainedXs",value:{[c]:ne(e.unconstrainedXs[c])}})}return{success:!0,instructions:s}}}},t.xs={public:!0,componentType:"math",isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let a=Number(r)+1,i={};i.unconstrainedX={dependencyType:"stateVariable",variableName:`unconstrainedX${a}`},i.constraintsChild={dependencyType:"child",childLogicName:"atMostOneConstraints",variableNames:[`constraintResult${a}`]},n[r]=i}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)if(e[a].constraintsChild.length===1){let i=Number(a)+1;r[a]=ne(e[a].constraintsChild[0].stateValues["constraintResult"+i])}else r[a]=ne(e[a].unconstrainedX);return n.length>0?{newValues:{xs:r}}:{}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:a,stateValues:i}){if(a&&!i.draggable)return{success:!1};let s=[];for(let l of Object.keys(e.xs).reverse())!n[l]||(n[l].constraintsChild.length===1?s.push({setDependency:r[l].constraintsChild,desiredValue:e.xs[l],childIndex:0,variableIndex:0}):s.push({setDependency:r[l].unconstrainedX,desiredValue:e.xs[l]}));return{success:!0,instructions:s}}},t.x={isAlias:!0,targetVariableName:"x1"},t.y={isAlias:!0,targetVariableName:"x2"},t.z={isAlias:!0,targetVariableName:"x3"},t.coords={public:!0,componentType:"coords",forRenderer:!0,returnDependencies:()=>({xs:{dependencyType:"stateVariable",variableName:"xs"}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.xs)r?n.push(r.tree):n.push("\uFF3F");return n.length>1?n=["vector",...n]:n.length===1?n=n[0]:n="\uFF3F",{newValues:{coords:vt.fromAst(n)}}},inverseDefinition:function({desiredStateVariableValues:e,stateValues:n,initialChange:r}){if(r&&!n.draggable)return{success:!1};let a=[],i={},s=e.coords.tree;if(!(Array.isArray(s)&&["tuple","vector"].includes(s[0])))i[0]=e.coords;else for(let l=0;l<s.length-1;l++){let u=e.coords.get_component(l);u.tree!==void 0&&(i[l]=u)}return a.push({setDependency:"xs",desiredValue:i}),{success:!0,instructions:a}}},t.value={isAlias:!0,targetVariableName:"coords"},t.constraintUsed={public:!0,componentType:"boolean",returnDependencies:()=>({constraintsChild:{dependencyType:"child",childLogicName:"atMostOneConstraints",variableNames:["constraintUsed"]}}),definition:function({dependencyValues:e}){return e.constraintsChild.length===0?{newValues:{constraintUsed:!1}}:{newValues:{constraintUsed:e.constraintsChild[0].stateValues.constraintUsed}}}},t.numericalXs={public:!0,componentType:"number",isArray:!0,entryPrefixes:["numericalX"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let a=Number(r)+1;n[r]={x:{dependencyType:"stateVariable",variableName:`x${a}`}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].x;i?(i=e[a].x.evaluate_to_constant(),Number.isFinite(i)?r[a]=i:r[a]=NaN):r[a]=NaN}return{newValues:{numericalXs:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!a.draggable)return{success:!1};let i=[];for(let s in e.numericalXs)!dependencyValuesByKey[s]||i.push({setDependency:n[s].xs,desiredValue:e.numericalXs[s]});return{success:!0,instructions:i}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalXs:{dependencyType:"stateVariable",variableName:"numericalXs"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(){let n={};for(let r=1;r<=e.nDimensions;r++){let a=e.numericalXs[r-1];if(!Number.isFinite(a))return{};n["x"+r]=a}return n}}})},t}static adapters=["coords"];movePoint({x:t,y:e,z:n,transient:r}){let a={};t!==void 0&&(a[0]=vt.fromAst(t)),e!==void 0&&(a[1]=vt.fromAst(e)),n!==void 0&&(a[2]=vt.fromAst(n)),r?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:a}],transient:r}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:a}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:t,y:e,z:n}}})}actions={movePoint:this.movePoint.bind(new Proxy(this,this.readOnlyProxyHandler))}},ur=li;var ju=class extends zt{static componentType="initialcondition";static rendererType="math";""},qu=class extends Ae{static componentType="hideinitialcondition";static rendererType="boolean"},Ku=class extends ur{static componentType="initialpoint";static rendererType="point"};var ci={};ye(ci,{FeedbackDefinition:()=>Wu,FeedbackDefinitions:()=>Uu});var Wu=class extends B{static componentType="feedbackDefinition";static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.code={createComponentOfType:"text"},e.text={createComponentOfType:"text"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:()=>({codeAttr:{dependencyType:"attributeComponent",attributeName:"code",variableNames:["value"]},textAttr:{dependencyType:"attributeComponent",attributeName:"text",variableNames:["value"]}}),definition({dependencyValues:e}){let n={};return e.codeAttr!==null?n.feedbackCode=e.codeAttr.stateValues.value.toLowerCase():n.feedbackCode="",e.textAttr!==null&&(n.feedbackText=e.textAttr.stateValues.value),{newValues:{value:n}}}},t}},Uu=class extends B{static componentType="feedbackDefinitions";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroFeedbackDefinitions",componentType:"feedbackDefinition",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atMostOneFeedbackDefinitions",componentType:"feedbackDefinitions",comparison:"atMost",number:1});return e.newOperator({name:"feedbackDefinitionsXorFeedbackDefinition",operator:"xor",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDefinitions={returnDependencies:()=>({feedbackDefinitionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFeedbackDefinitions"},feedbackDefinitionsChild:{dependencyType:"child",childLogicName:"atMostOneFeedbackDefinitions",variableNames:["nDefinitions"]}}),definition({dependencyValues:e}){let n;return e.feedbackDefinitionsChild.length===1?n=e.feedbackDefinitionsChild[0].stateValues.nDefinitions:n=e.feedbackDefinitionChildren.length,{newValues:{nDefinitions:n}}}},t.value={isArray:!0,entryPrefixes:["feedbackDefinition"],returnArraySizeDependencies:()=>({nDefinitions:{dependencyType:"stateVariable",variableName:"nDefinitions"}}),returnArraySize({dependencyValues:e}){return[e.nDefinitions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={feedbackDefinitionChild:{dependencyType:"child",childLogicName:"atLeastZeroFeedbackDefinitions",variableNames:["value"],childIndices:[r]},feedbackDefinitionsChild:{dependencyType:"child",childLogicName:"atMostOneFeedbackDefinitions",variableNames:["feedbackDefinition"+(Number(r)+1)]}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].feedbackDefinitionChild;if(i.length===1)r[a]=i[0].stateValues.value;else{let s=e[a].feedbackDefinitionsChild;s.length===1&&(r[a]=s[0].stateValues["feedbackDefinition"+(Number(a)+1)])}}return{newValues:{value:r}}}},t}};var di={};ye(di,{StyleDefinition:()=>Gu,StyleDefinitions:()=>Xu});var cr={lineColor:{componentType:"text"},lineWidth:{componentType:"number"},lineStyle:{componentType:"text"},markerColor:{componentType:"text"},markerStyle:{componentType:"text"},markerSize:{componentType:"number"}},Gu=class extends B{static componentType="styleDefinition";static rendererType=void 0;static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);e.styleNumber={createPrimitiveOfType:"number"};for(let n in cr)e[n]={createComponentOfType:cr[n].componentType};return e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:function(){let e={styleNumber:{dependencyType:"attribute",attributeName:"styleNumber"}};for(let n in cr)e[n]={dependencyType:"attributeComponent",attributeName:n,variableNames:["value"]};return e},definition:function({dependencyValues:e}){let n={styleNumber:e.styleNumber};for(let r in cr)e[r]!==null&&(n[r]=e[r].stateValues.value);return{newValues:{value:n}}}},t}},Xu=class extends B{static componentType="styleDefinitions";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStyleDefinitions",componentType:"styleDefinition",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atMostOneStyleDefinitions",componentType:"styleDefinitions",comparison:"atMost",number:1});return e.newOperator({name:"styleDefinitionsXorStyleDefinition",operator:"xor",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDefinitions={returnDependencies:()=>({styleDefinitionChildren:{dependencyType:"child",childLogicName:"atLeastZeroStyleDefinitions"},styleDefinitionsChild:{dependencyType:"child",childLogicName:"atMostOneStyleDefinitions",variableNames:["nDefinitions"]}}),definition({dependencyValues:e}){let n;return e.styleDefinitionsChild.length===1?n=e.styleDefinitionsChild[0].stateValues.nDefinitions:n=e.styleDefinitionChildren.length,{newValues:{nDefinitions:n}}}},t.value={isArray:!0,entryPrefixes:["styleDefinition"],returnArraySizeDependencies:()=>({nDefinitions:{dependencyType:"stateVariable",variableName:"nDefinitions"}}),returnArraySize({dependencyValues:e}){return[e.nDefinitions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={styleDefinitionChild:{dependencyType:"child",childLogicName:"atLeastZeroStyleDefinitions",variableNames:["value"],childIndices:[r]},styleDefinitionsChild:{dependencyType:"child",childLogicName:"atMostOneStyleDefinitions",variableNames:["styleDefinition"+(Number(r)+1)]}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].styleDefinitionChild;if(i.length===1)r[a]=i[0].stateValues.value;else{let s=e[a].styleDefinitionsChild;s.length===1&&(r[a]=s[0].stateValues["styleDefinition"+(Number(a)+1)])}}return{newValues:{value:r}}}},t}};var pi={};ye(pi,{ComponentListOfListsWithSelectableType:()=>Yu,ComponentListWithSelectableType:()=>Ju,ComponentWithSelectableType:()=>dr});import Zu from"math-expressions";var dr=class extends B{static componentType="_componentWithSelectableType";static rendererType=void 0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value","type"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={createPrimitiveOfType:"text"},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneChild",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.type={returnDependencies:()=>({type:{dependencyType:"doenetAttribute",attributeName:"type"},parentType:{dependencyType:"parentStateVariable",variableName:"type"}}),definition:function({dependencyValues:e,componentName:n}){let r=e.type;return r||(r=e.parentType),r?["number","letters","math","text","boolean"].includes(r)||(console.warn(`Invalid type ${r}, setting type to number`),r="number"):r="number",{newValues:{type:r}}}},t.value={public:!0,hasVariableComponentType:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},atMostOneChild:{dependencyType:"child",childLogicName:"atMostOneChild",variableNames:["value"]}}),definition({dependencyValues:e}){let n;return e.atMostOneChild.length===1?n=mi(e.atMostOneChild[0].stateValues.value,e.type):n=null,{newValues:{value:n},setComponentType:{value:e.type}}}},t}},Ju=class extends dr{static componentType="_componentListWithSelectableType";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={createPrimitiveOfType:"text"},e}static returnSugarInstructions(){let t=[];function e({matchedChildren:n,componentAttributes:r,parentAttributes:a}){let i=r.type;return i||(i=a.type),i?["number","letters","math","text","boolean"].includes(i)||(console.warn(`Invalid type ${i}, setting type to number`),i="number"):i="number",n=n.reduce(function(s,l){return l.componentType==="string"?[...s,...l.state.value.split(/\s+/).filter(u=>u).map(u=>({componentType:"string",state:{value:u}}))]:[...s,l]},[]),{success:!0,newChildren:n}}return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"anythingForSelectedType",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.value,t.nValues={additionalStateVariablesDefined:["childForValue"],returnDependencies:()=>({anythingForSelectedType:{dependencyType:"child",childLogicName:"anythingForSelectedType",variableNames:["nValues"],variablesOptional:!0}}),definition({dependencyValues:e}){let n=0,r=[];for(let[a,i]of e.anythingForSelectedType.entries()){let s=Number.isInteger(i.stateValues.nValues)?i.stateValues.nValues:1;n+=s;for(let l=0;l<s;l++)r.push({child:a,valueIndex:l})}return{newValues:{nValues:n,childForValue:r}}}},t.values={public:!0,isArray:!0,entryPrefixes:["value"],stateVariablesDeterminingDependencies:["childForValue"],hasVariableComponentType:!0,returnArraySizeDependencies:()=>({nValues:{dependencyType:"stateVariable",variableName:"nValues"}}),returnArraySize({dependencyValues:e}){return[e.nValues]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={type:{dependencyType:"stateVariable",variableName:"type"}},a={};for(let i of e){let s=n.childForValue[i];a[i]={anythingForSelectedType:{dependencyType:"child",childLogicName:"anythingForSelectedType",variableNames:["value","values"],childIndices:[s.child],variablesOptional:!0},valueIndex:{dependencyType:"value",value:s.valueIndex}}}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,componentName:a}){let i={};for(let s of r)if(n[s].anythingForSelectedType&&n[s].anythingForSelectedType.length===1){let l=n[s].anythingForSelectedType[0],u;l.stateValues.values?u=l.stateValues.values[n[s].valueIndex]:u=l.stateValues.value,i[s]=mi(u,e.type)}return{newValues:{values:i},setComponentType:{values:e.type}}}},t}},Yu=class extends dr{static componentType="_componentListOfListsWithSelectableType";static componentTypeSingular="_componentListWithSelectableType";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={createPrimitiveOfType:"text"},e}static returnSugarInstructions(){let t=[],e=this,n=function({matchedChildren:r,componentAttributes:a,parentAttributes:i}){let s=Ge({componentList:r,removeParens:!0});if(s.success!==!0)return{success:!1};let l=a.type;return l||(l=i.type),l?["number","letters","math","text","boolean"].includes(l)||(console.warn(`Invalid type ${l}, setting type to number`),l="number"):l="number",{success:!0,newChildren:s.pieces.map(u=>({componentType:e.componentTypeSingular,props:{type:l},children:u}))}};return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastZeroLists",componentType:this.componentTypeSingular,comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.value,t.nLists={returnDependencies:()=>({listChildren:{dependencyType:"child",childLogicName:"atLeastZeroLists"}}),definition({dependencyValues:e}){return{newValues:{nLists:e.listChildren.length}}}},t.lists={isArray:!0,entryPrefixes:["list"],returnArraySizeDependencies:()=>({nLists:{dependencyType:"stateVariable",variableName:"nLists"}}),returnArraySize({dependencyValues:e}){return[e.nLists]},returnArrayDependenciesByKey({arrayKeys:e}){let n={type:{dependencyType:"stateVariable",variableName:"type"}},r={};for(let a of e)r[a]={listChildren:{dependencyType:"child",childLogicName:"atLeastZeroLists",variableNames:["values","type"],childIndices:[a]}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r)if(n[i].listChildren&&n[i].listChildren.length===1){let s=n[i].listChildren[0];s.stateValues.type===e.type?a[i]=s.stateValues.values:a[i]=s.stateValues.values.map(l=>mi(l,e.type))}return{newValues:{lists:a}}}},t}};function mi(o,t){if(Array.isArray(o)&&(o=o[0]),t==="number"){if(o instanceof Zu.class){let e=o.evaluate_to_constant();return Number.isFinite(e)||(e=NaN),e}return Number(o)}else if(t==="math"){if(typeof o=="string")try{return Zu.fromAst(Z.convert(o))}catch(e){}return ne(o)}else return t==="boolean"?Boolean(o):String(o)}var fi=class extends B{static componentType="document";static rendererType="section";static renderChildren=!0;static createsVariants=!0;static alwaysSetUpVariant=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.hide,delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.feedbackDefinitions={createComponentOfType:"feedbackDefinitions",createStateVariable:"feedbackDefinitions",get defaultValue(){return fh()},propagateToDescendants:!0,mergeArrayWithDefault:!0,public:!0},e.styleDefinitions={createComponentOfType:"styleDefinitions",createStateVariable:"styleDefinitions",get defaultValue(){return Xt()},propagateToDescendants:!0,mergeArrayWithDefault:!0,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneMeta",componentType:"meta",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atMostOneVariantControl",componentType:"variantControl",comparison:"atMost",number:1,allowSpillover:!1}),a=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),i=e.newLeaf({name:"atMostOneDescription",componentType:"description",comparison:"atMost",number:1}),s=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"variantTitleDescriptionMetaAnything",operator:"and",propositions:[r,a,i,n,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:e}){let n=null;return e.titleChild.length===1&&(n=e.titleChild[0].componentName),{newValues:{titleChildName:n}}}},t.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]}}),definition({dependencyValues:e}){return e.titleChild.length===0?{newValues:{title:""}}:{newValues:{title:e.titleChild[0].stateValues.text}}}},t.description={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({descriptionChild:{dependencyType:"child",childLogicName:"atMostOneDescription",variableNames:["text"]}}),definition({dependencyValues:e}){return e.descriptionChild.length===0?{newValues:{description:""}}:{newValues:{description:e.descriptionChild[0].stateValues.text}}}},t.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{level:0}})},t.viewedSolution={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:{variablesToCheck:["viewedSolution"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"viewedSolution",value:e.viewedSolution}]}}},t.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:e}){let n=[];for(let r of e.scoredDescendants)r.stateValues.aggregateScores||r.stateValues.scoredDescendants===void 0?n.push(r):n.push(...r.stateValues.scoredDescendants);return{newValues:{scoredDescendants:n}}}},t.nScoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}}),definition({dependencyValues:e}){return{newValues:{nScoredDescendants:e.scoredDescendants.length}}}},t.itemCreditAchieved={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize({dependencyValues:e}){return[e.nScoredDescendants]},stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let a of e){let i=n.scoredDescendants[a];i&&(r[a]={creditAchieved:{dependencyType:"stateVariable",componentName:i.componentName,variableName:"creditAchieved"}})}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)r[a]=e[a].creditAchieved;return{newValues:{itemCreditAchieved:r}}},markStaleByKey({arrayKeys:e,changes:n}){if(n.__array_size||n.__array_keys)return{itemScoreChanged:{itemNumbers:e}};let r=/^__(\d+)_/,a=[];for(let i in n){let s=r.exec(i);s&&a.push(s[1])}return{itemScoreChanged:{itemNumbers:a}}}},t.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({newValues:{displayDigitsForCreditAchieved:3}})},t.creditAchieved={public:!0,componentType:"number",defaultValue:0,stateVariablesPrescribingAdditionalAttributes:{displayDigits:"displayDigitsForCreditAchieved"},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,componentType:"number",stateVariablesPrescribingAdditionalAttributes:{displayDigits:"displayDigitsForCreditAchieved"}}],returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"},itemCreditAchieved:{dependencyType:"stateVariable",variableName:"itemCreditAchieved"}}),definition({dependencyValues:e}){let n=0,r=0;for(let[s,l]of e.scoredDescendants.entries()){let u=l.stateValues.weight;n+=e.itemCreditAchieved[s]*u,r+=u}let a=n/r,i=a*100;return{newValues:{creditAchieved:a,percentCreditAchieved:i}}}},t.selectedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:n})=>({variantNumber:{dependencyType:"value",value:e.variantNumber},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(n.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){let n={index:e.variantNumber},r=n.subvariants=[];for(let a of e.variantDescendants)a.stateValues.isVariantComponent?r.push(a.stateValues.selectedVariantInfo):a.stateValues.selectedVariantInfo&&r.push(...a.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n}}}},t}submitAllAnswers(){let t=[];for(let e of this.descendantsFound.answer)e.state.allAwardsJustSubmitted||t.push(e);if(this.answersToSubmitCounter=t.length,this.answersToSubmitCounter===0)this.externalFunctions.allAnswersSubmitted();else for(let e of t)e.submitAnswer()}static setUpVariant({serializedComponent:t,sharedParameters:e,definingChildrenSoFar:n,allComponentClasses:r}){let a;for(let s of n)if(s!==void 0&&s.componentType==="variantControl"){a=s;break}if(a===void 0){let s=100;t.variants.uniqueVariants&&(s=t.variants.numberOfVariants),e.allPossibleVariants=[...Array(s).keys()].map(Qu);let l,u=t.variants.desiredVariant;if(u!==void 0){if(u.index!==void 0){let p=Number(u.index);if(Number.isInteger(p))l=p%s,l<0&&(l+=s);else throw Error("Variant number "+u.index+" must be an integer")}else if(u.value!==void 0){if(typeof u.value=="string"){let p=e.allPossibleVariants.indexOf(u.value.toLowerCase());p!==-1&&(l=p)}l===void 0&&(console.log("Variant "+u.value+" is not valid, convert to variant index"),l=Math.abs(e.hashStringToInteger(JSON.stringify(u.value))%s),console.log(l))}}if(l===void 0){let p=e.selectRng.random();l=Math.floor(p*s)}let c=l+1,d=e.hashStringToInteger(c.toString());e.variantNumber=l,e.variant=Qu(l),e.selectRng=new e.rngClass(d),t.variants.generatedSelectParameters={selectRng:e.selectRng,variant:e.variant,allPossibleVariants:e.allPossibleVariants}}else e.variant=a.state.selectedVariant.value,e.variantNumber=a.state.selectedVariantNumber.value,e.selectRng=a.state.selectRng.value,e.allPossibleVariants=a.state.variants.value;console.log("Document variant: "+e.variant);let i=t.variants.desiredVariant;if(i===void 0&&(i={}),i.subvariants===void 0&&t.variants.uniqueVariants){let s=this.getUniqueVariant({serializedComponent:t,variantNumber:e.variantNumber,allComponentClasses:r});s.success&&Object.assign(i,s.desiredVariant)}if(i.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0)for(let s in i.subvariants){let l=i.subvariants[s],u=t.variants.descendantVariantComponents[s];if(u===void 0)break;u.variants.desiredVariant=l}}static determineNumberOfUniqueVariants({serializedComponent:t}){if(t.children===void 0)return{success:!0,numberOfVariants:1};let e,n;for(let[l,u]of t.children.entries())if(u.componentType==="variantControl"||u.createdComponent&&components[u.componentName].componentType==="variantControl"){e=l,n=u;break}let r=100;if(e!==void 0&&n.attributes&&n.attributes.nVariants!==void 0){let l=n.attributes.nVariants,u=!1;if(l.state!==void 0&&l.state.value!==void 0&&(r=Math.round(Number(l.state.value)),u=!0),l.children!==void 0&&l.children.length===1&&l.children[0].componentType==="string"&&(r=Math.round(Number(l.children[0].state.value)),u=!0),!u)return{success:!1}}let a,i=1,s=[];return t.variants.descendantVariantComponents!==void 0&&(s=t.variants.descendantVariantComponents.map(l=>l.variants.numberOfVariants),i=s.reduce((l,u)=>l*u,1),a={numberOfVariantsByDescendant:s}),r=Math.min(i,r),{success:!0,numberOfVariants:r,uniqueVariantData:a}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let a=Yt({variantNumber:e,serializedComponent:t,allComponentClasses:n});return a.success?{success:!0,desiredVariant:{subvariants:a.desiredVariants}}:(console.log("Failed to get unique variant for document."),{success:!1})}static includeBlankStringChildren=!0},ec=fi;function Qu(o){let t="";for(;;){let e=o%26;if(t=String.fromCharCode(97+e)+t,o<26)break;o=Math.floor(o/26)-1}return t}function fh(){return[{feedbackCode:"numericalerror",feedbackText:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?"},{feedbackCode:"goodjob",feedbackText:"Good job!"},{feedbackCode:"onesignerror",feedbackText:"Credit reduced because it appears that you made a sign error."},{feedbackCode:"twosignerrors",feedbackText:"Credit reduced because it appears that you made two sign errors."}]}var hi=class extends E{static componentType="string";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(){return{hide:{createComponentOfType:"boolean",createStateVariable:"hide",defaultValue:!1,public:!0}}}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:()=>({}),defaultValue:"",forRenderer:!0,set:String,definition:()=>({useEssentialOrDefaultValue:{value:{variablesToCheck:"value"}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"value",value:String(e.value)}]}}},t.text={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:e}){return{newValues:{text:e.value}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"value",desiredValue:e.text}]}}},t}},tc=hi;var bi=class extends E{static componentType="textList";static rendererType="asList";static renderChildren=!0;static stateVariableForAttributeValue="texts";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"text",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTextLists",componentType:"textList",comparison:"atLeast",number:0});return e.newOperator({name:"textAndTextLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},textListChildren:{dependencyType:"child",childLogicName:"atLeastZeroTextLists",variableNames:["nComponents"]},textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",skipComponentNames:!0}}},definition:function({dependencyValues:e,componentInfoObjects:n}){let r=0,a=[],i=0;for(let[l,u]of e.textAndTextListChildren.entries())if(n.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"textList"})){let c=e.textListChildren[i];i++;for(let d=0;d<c.stateValues.nComponents;d++)a[r+d]=[l,d];r+=c.stateValues.nComponents}else a[r]=[l,0],r+=1;let s=e.maximumNumber;return s!==null&&r>s&&(r=s,a=a.slice(0,s)),{newValues:{nComponents:r,childIndexByArrayKey:a},checkForActualChange:{nComponents:!0}}}},t.texts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["text"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},a={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let i of e){let s=[],l="1";n.childIndexByArrayKey[i]&&(s=[n.childIndexByArrayKey[i][0]],l=n.childIndexByArrayKey[i][1]+1),r[i]={textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","text"+l],variablesOptional:!0,childIndices:s}}}return{globalDependencies:a,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].textAndTextListChildren[0];if(s)if(s.stateValues.value!==void 0)a[i]=s.stateValues.value;else{let l=e.childIndexByArrayKey[i][1]+1;a[i]=s.stateValues["text"+l]}}return{newValues:{texts:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[];for(let l in e.texts){if(!r[l])continue;let u=r[l].textAndTextListChildren[0];u&&(u.stateValues.value!==void 0?s.push({setDependency:a[l].textAndTextListChildren,desiredValue:e.texts[l],childIndex:0,variableIndex:0}):s.push({setDependency:a[l].textAndTextListChildren,desiredValue:e.texts[l],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"texts"},t.text={public:!0,componentType:"text",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({newValues:{text:e.texts.join(", ")}})},t}},nc=bi;var yi=class extends E{static componentType="randomizedTextList";static stateVariableForAttributeValue="texts";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.unordered={default:!1},e.maximumNumber={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTextLists",componentType:"textList",comparison:"atLeast",number:0}),a=function({dependencyValues:l}){let u=l.stringChildren[0],c=u.stateValues.value.split(",").map(d=>({componentType:"text",state:{value:d.trim()}}));return{success:!0,newChildren:c,toDelete:[u.componentName]}},i=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,returnSugarDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"exactlyOneString",variableNames:["value"]}}),logicToWaitOnSugar:["atLeastZeroTexts"],replacementFunction:a}),s=e.newOperator({name:"textAndTextLists",operator:"and",propositions:[n,r]});return e.newOperator({name:"TextsXorSugar",operator:"xor",propositions:[i,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.texts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["text"],returnDependencies:()=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},childrenToRender:{dependencyType:"stateVariable",variableName:"childrenToRender"}}),definition:function({dependencyValues:e}){let n=[],r=e.textAndTextListChildren.map(a=>a.componentName);for(let a of e.childrenToRender){let i=r.indexOf(a),s=e.textAndTextListChildren[i];s.stateValues.texts?n.push(...s.stateValues.texts):n.push(s.stateValues.value)}return{newValues:{texts:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({newValues:{text:e.texts.join(", ")}})},t.nComponents={public:!0,componentType:"number",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:function({dependencyValues:e}){return{newValues:{nComponents:e.texts.length}}}},t.childrenToRender={returnDependencies:({sharedParameters:e})=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){let n=[];for(let i of e.textAndTextListChildren)i.stateValues.childrenToRender?n.push(...i.stateValues.childrenToRender):n.push(i.componentName);let r=e.maximumNumber;r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),console.log("randomizing children");for(let i=n.length-1;i>0;i--){let s=e.selectRng.random(),l=Math.floor(s*(i+1));[n[i],n[l]]=[n[l],n[i]]}let a=Math.ceil(e.selectRng.random()*n.length);return console.log(`numChildren: ${a}`),n=n.slice(0,a),{newValues:{childrenToRender:n}}}},t}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.aslist({key:this.componentName}))}},rc=yi;import"math-expressions";var gi=class extends E{static componentType="numberList";static rendererType="asList";static renderChildren=!0;static stateVariableForAttributeValue="numbers";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"number",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroNumberLists",componentType:"numberList",comparison:"atLeast",number:0});return e.newOperator({name:"numberAndNumberLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numberListChildren:{dependencyType:"child",childLogicName:"atLeastZeroNumberLists",variableNames:["nComponents"]},numberAndNumberListChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",skipComponentNames:!0}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=0,a=[],i=0;for(let[l,u]of e.numberAndNumberListChildren.entries())if(n.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"numberList"})){let c=e.numberListChildren[i];i++;for(let d=0;d<c.stateValues.nComponents;d++)a[r+d]=[l,d];r+=c.stateValues.nComponents}else a[r]=[l,0],r+=1;let s=e.maximumNumber;return s!==null&&r>s&&(r=s,a=a.slice(0,s)),{newValues:{nComponents:r,childIndexByArrayKey:a},checkForActualChange:{nComponents:!0}}}},t.numbers={public:!0,componentType:"number",isArray:!0,entryPrefixes:["number"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},a={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let i of e){let s=[],l="1";n.childIndexByArrayKey[i]&&(s=[n.childIndexByArrayKey[i][0]],l=n.childIndexByArrayKey[i][1]+1),r[i]={numberAndNumberListChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["value","number"+l],variablesOptional:!0,childIndices:s}}}return{globalDependencies:a,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].numberAndNumberListChildren[0];if(s)if(s.stateValues.value!==void 0)a[i]=s.stateValues.value;else{let l=e.childIndexByArrayKey[i][1]+1;a[i]=s.stateValues["number"+l]}}return{newValues:{numbers:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[];for(let l in e.numbers){if(!r[l])continue;let u=r[l].numberAndNumberListChildren[0];u&&(u.stateValues.value!==void 0?s.push({setDependency:a[l].numberAndNumberListChildren,desiredValue:e.numbers[l],childIndex:0,variableIndex:0}):s.push({setDependency:a[l].numberAndNumberListChildren,desiredValue:e.numbers[l],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"numbers"},t.text={public:!0,componentType:"text",additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numberAndNumberListChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e}){let n=[];for(let i of e.numberAndNumberListChildren)i.stateValues.valueForDisplay!==void 0?n.push(i.stateValues.text):n.push(...i.stateValues.texts);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{text:n.join(", "),texts:n}}}},t}},ac=gi;var vi=class extends X{static componentType="p";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.text={public:!0,componentType:"text",returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"?n+=r.stateValues.text:n+=" ";return{newValues:{text:n}}}},t}},ic=vi;var Ci=class extends E{static componentType="booleanList";static rendererType="asList";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"boolean",createStateVariable:"maximumNumber",defaultValue:void 0,public:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"boolean",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroBooleans",componentType:"boolean",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroBooleanLists",componentType:"booleanList",comparison:"atLeast",number:0});return e.newOperator({name:"booleanAndBooleanLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},booleanListChildren:{dependencyType:"child",childLogicName:"atLeastZeroBooleanLists",variableNames:["nComponents"]},booleanAndBooleanListChildren:{dependencyType:"child",childLogicName:"booleanAndBooleanLists",skipComponentNames:!0}}},definition:function({dependencyValues:e,componentInfoObjects:n}){let r=0,a=[],i=0;for(let[l,u]of e.booleanAndBooleanListChildren.entries())if(n.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"booleanList"})){let c=e.booleanListChildren[i];i++;for(let d=0;d<c.stateValues.nComponents;d++)a[r+d]=[l,d];r+=c.stateValues.nComponents}else a[r]=[l,0],r+=1;let s=e.maximumNumber;return s!==null&&r>s&&(r=s,a=a.slice(0,s)),{newValues:{nComponents:r,childIndexByArrayKey:a},checkForActualChange:{nComponents:!0}}}},t.booleans={public:!0,componentType:"boolean",isArray:!0,entryPrefixes:["boolean"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},a={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let i of e){let s=[],l="1";n.childIndexByArrayKey[i]&&(s=[n.childIndexByArrayKey[i][0]],l=n.childIndexByArrayKey[i][1]+1),r[i]={booleanAndBooleanListChildren:{dependencyType:"child",childLogicName:"booleanAndBooleanLists",variableNames:["value","boolean"+l],variablesOptional:!0,childIndices:s}}}return{globalDependencies:a,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].booleanAndBooleanListChildren[0];if(s)if(s.stateValues.value!==void 0)a[i]=s.stateValues.value;else{let l=e.childIndexByArrayKey[i][1]+1;a[i]=s.stateValues["boolean"+l]}}return{newValues:{booleans:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[];for(let l in e.booleans){if(!r[l])continue;let u=r[l].booleanAndBooleanListChildren[0];u&&(u.stateValues.value!==void 0?s.push({setDependency:a[l].booleanAndBooleanListChildren,desiredValue:e.booleans[l],childIndex:0,variableIndex:0}):s.push({setDependency:a[l].booleanAndBooleanListChildren,desiredValue:e.booleans[l],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"booleans"},t}},sc=Ci;function Te({serializedComponents:o,componentName:t,addShadowDependencies:e=!0,uniqueIdentifiersUsed:n=[],identifierPrefix:r=""}){for(let a in o){let i=o[a],s;if(i.originalName){if(s=r+i.originalName+"|shadow",e&&!i.originalNameFromSerializedComponent){let l={[i.originalName]:[{dependencyType:"referenceShadow",compositeName:t}]};if(i.state){let u=Object.keys(i.state);l[i.originalName].downstreamStateVariables=u,l[i.originalName].upstreamStateVariables=u}i.downstreamDependencies=l}}else s=r+i.componentType+"|shadowUnnamed";i.uniqueIdentifier=Ue(s,n),Te({serializedComponents:i.children,componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r});for(let l in i.attributes){let u=i.attributes[l];u.componentType&&(i.attributes[l]=Te({serializedComponents:[u],componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r})[0])}i.replacements&&Te({serializedComponents:i.replacements,componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r})}return o}function Ot({attributes:o,componentType:t,componentInfoObjects:e,compositeAttributesObj:n,compositeCreatesNewNamespace:r,flags:a}){let s=e.allComponentClasses[t].createAttributesObject({flags:a}),l={};for(let c in s)l[c.toLowerCase()]=c;let u={};for(let c in o){if(c in n)continue;let d=l[c.toLowerCase()],p=s[d];if(p){if(d in u)throw Error(`Cannot repeat prop ${d}`);if(u[d]=nr({attrObj:p,value:o[c],componentInfoObjects:e}),u[d].children&&(u[d].children=bt(u[d].children,e),r)){for(let m of u[d].children)if(m.componentType==="copy"){let f=m.doenetAttributes.tName;/[a-zA-Z_]/.test(f[0])&&(m.doenetAttributes.tName="../"+f)}}}}return u}var Ni=class extends G{static componentType="copy";static assignNamesToReplacements=!0;static acceptTname=!0;static acceptAnyAttribute=!0;static get stateVariablesShadowedForReference(){return["targetComponent","propName"]}static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.prop={createPrimitiveOfType:"text"},e.componentType={createPrimitiveOfType:"text"},e.nComponents={createPrimitiveOfType:"number"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.uri={createComponentOfType:"_textFromSingleStringChild",createStateVariable:"uri",defaultValue:null,public:!0},e.targetAttributesToIgnore={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnore",defaultValue:["hide"],public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneExternalContent",componentType:"externalContent",number:1,comparison:"atMost",setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.tName={returnDependencies:()=>({tName:{dependencyType:"doenetAttribute",attributeName:"tName"}}),definition:({dependencyValues:e})=>({newValues:{tName:e.tName}})},t.targetSourcesName={additionalStateVariablesDefined:["sourcesChildNumber"],stateVariablesDeterminingDependencies:["tName"],determineDependenciesImmediately:!0,returnDependencies:function({stateValues:e,sharedParameters:n}){let r=n.sourceNameMappings;if(!r)return{};let a=r[e.tName];return a?{targetSourcesName:{dependencyType:"value",value:a.name},sourcesChildNumber:{dependencyType:"value",value:a.childNumber}}:{}},definition:function({dependencyValues:e}){let n=e.targetSourcesName,r=e.sourcesChildNumber;return n||(n=null,r=null),{newValues:{targetSourcesName:n,sourcesChildNumber:r},makeEssential:["targetSourcesName","sourcesChildNumber"]}}},t.targetSources={stateVariablesDeterminingDependencies:["targetSourcesName"],determineDependenciesImmediately:!0,returnDependencies({stateValues:e}){return e.targetSourcesName?{targetSourcesComponent:{dependencyType:"componentIdentity",componentName:e.targetSourcesName}}:{}},definition:function({dependencyValues:e}){let n=e.targetSourcesComponent;return n||(n=null),{newValues:{targetSources:n}}}},t.sourceIndex={stateVariablesDeterminingDependencies:["tName"],determineDependenciesImmediately:!0,returnDependencies:function({stateValues:e,sharedParameters:n}){let r=n.sourceIndexMappings;if(!r)return{};let a=r[e.tName];return a===void 0?{}:{sourceIndex:{dependencyType:"value",value:a}}},definition:function({dependencyValues:e}){let n=e.sourceIndex;return n===void 0&&(n=null),{newValues:{sourceIndex:n},makeEssential:["sourceIndex"]}}},t.targetComponent={stateVariablesDeterminingDependencies:["targetSources","sourceIndex"],determineDependenciesImmediately:!0,returnDependencies({stateValues:e}){return e.sourceIndex!==null?{}:e.targetSources!==null?{targetSourcesChildren:{dependencyType:"stateVariable",componentName:e.targetSources.componentName,variableName:"childIdentities"},sourcesChildNumber:{dependencyType:"stateVariable",variableName:"sourcesChildNumber"}}:{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:e}){let n=null;return e.targetSourcesChildren?(n=e.targetSourcesChildren[e.sourcesChildNumber],n||(n=null)):e.targetComponent&&(n=e.targetComponent),{newValues:{targetComponent:n}}}},t.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e}){return e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:e}){return{newValues:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},t.contentId={additionalStateVariablesDefined:["contentName"],returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:e}){if(!e.uri||e.uri.substring(0,7).toLowerCase()!=="doenet:")return{newValues:{contentId:null,contentName:null}};let n=e.uri.substring(7),r=null,a=null;return n.substring(0,10).toLowerCase()==="contentid="?r=n.substring(10):n.substring(0,12).toLowerCase()==="contentname="&&(a=n.substring(12)),{newValues:{contentId:r,contentName:a}}}},t.serializedComponentsForContentId={returnDependencies:()=>({contentId:{dependencyType:"stateVariable",variableName:"contentId"},contentName:{dependencyType:"stateVariable",variableName:"contentName"},externalContentChild:{dependencyType:"child",childLogicName:"atMostOneExternalContent",variableNames:["serializedChildren","newNamespace"]}}),definition:function({dependencyValues:e}){if(!(e.contentId||e.contentName))return{newValues:{serializedComponentsForContentId:null}};let n=e.externalContentChild[0];if(!n)return{newValues:{serializedComponentsForContentId:null}};let r=n.stateValues.serializedChildren,a={componentType:"externalcontent",state:{rendered:!0},children:r,originalName:n.componentName};return n.stateValues.newNamespace&&(a.attributes={newNamespace:!0}),{newValues:{serializedComponentsForContentId:a}}}},t.propName={returnDependencies:()=>({propName:{dependencyType:"attribute",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{newValues:{propName:e.propName}}}},t.isPlainMacro={returnDependencies:()=>({isPlainMacro:{dependencyType:"doenetAttribute",attributeName:"isPlainMacro"}}),definition:function({dependencyValues:e}){return{newValues:{isPlainMacro:e.isPlainMacro}}}},t.replacementSourceIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:e,componentInfoObjects:n}){let r={};return e.targetComponent!==null&&(n.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})?r.targets={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,componentIndex:e.componentIndex}:(e.componentIndex===null||e.componentIndex===1)&&(r.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),r},definition({dependencyValues:e}){let n=null;return e.targets&&(n=e.targets,Array.isArray(n)||(n=[n])),{newValues:{replacementSourceIdentities:n}}}},t.effectivePropNameBySource={stateVariablesDeterminingDependencies:["replacementSourceIdentities","propName","isPlainMacro"],returnDependencies:function({stateValues:e,componentInfoObjects:n}){let r={replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}};if(e.replacementSourceIdentities!==null)for(let[a,i]of e.replacementSourceIdentities.entries()){let s=e.propName;e.isPlainMacro&&(s=n.allComponentClasses[i.componentType].variableForPlainMacro),s&&(r["propName"+a]={dependencyType:"value",value:s})}return r},definition({dependencyValues:e}){let n=null;if(e.replacementSourceIdentities!==null){n=[];for(let r in e.replacementSourceIdentities)e["propName"+r]&&(n[r]=e["propName"+r])}return{newValues:{effectivePropNameBySource:n}}}},t.replacementSources={stateVariablesDeterminingDependencies:["replacementSourceIdentities","propName","propIndex","isPlainMacro","effectivePropNameBySource"],returnDependencies:function({stateValues:e}){let n={replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}};if(!e.propName&&e.propIndex!==null)throw Error("You cannot specify a propIndex without specifying a prop.");if(e.replacementSourceIdentities!==null)for(let[r,a]of e.replacementSourceIdentities.entries()){let i=e.effectivePropNameBySource[r],s;i?s={dependencyType:"stateVariable",componentName:a.componentName,variableName:i,returnAsComponentObject:!0,variablesOptional:!0,propIndex:e.propIndex,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}:s={dependencyType:"componentIdentity",componentName:a.componentName},n["target"+r]=s}return n},definition({dependencyValues:e}){let n=null;if(e.replacementSourceIdentities!==null){n=[];for(let r in e.replacementSourceIdentities)e["target"+r]&&n.push(e["target"+r])}return{newValues:{replacementSources:n}}}},t.nComponentsSpecified={returnDependencies:()=>({nComponentsAttr:{dependencyType:"attribute",attributeName:"nComponents"},typeAttr:{dependencyType:"attribute",attributeName:"componentType"}}),definition({dependencyValues:e,componentInfoObjects:n}){let r;if(e.typeAttr){if(!(e.typeAttr in n.allComponentClasses))throw Error(`Invalid componentType ${e.typeAttr} of copy.`);e.nComponentsAttr!==void 0?r=e.nComponentsAttr:r=1}else{if(e.nComponentsAttr!==void 0)throw Error("You must specify a componentType when specifying nComponents for a copy.");r=null}return{newValues:{nComponentsSpecified:r}}}},t.readyToExpandWhenResolved={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e,componentInfoObjects:n}){let r={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"},serializedComponentsForContentId:{dependencyType:"stateVariable",variableName:"serializedComponentsForContentId"}};return e.targetComponent&&n.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})&&(r.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"readyToExpandWhenResolved"}),r},definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t.needsReplacementsUpdatedWhenStale={stateVariablesDeterminingDependencies:["targetComponent","replacementSourceIdentities","effectivePropNameBySource"],returnDependencies:function({stateValues:e,componentInfoObjects:n}){let r={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}};if(e.effectivePropNameBySource!==null){for(let[a,i]of e.effectivePropNameBySource.entries())if(i){let s=e.replacementSourceIdentities[a];r["sourceArraySize"+a]={dependencyType:"stateVariableArraySize",componentName:s.componentName,variableName:i,variablesOptional:!0,caseInsensitiveVariableMatch:!0},r["sourceComponentType"+a]={dependencyType:"stateVariableComponentType",componentName:s.componentName,variableName:i,variablesOptional:!0,caseInsensitiveVariableMatch:!0}}}return e.targetComponent!==null&&n.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})&&(r.allReplacementIdentities={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,variableNames:["isInactiveCompositeReplacement"]}),r},markStale(){return{updateReplacements:!0}},definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r,flags:a,resolveItem:i,publicCaseInsensitiveAliasSubstitutions:s}){n.numReplacementsBySource=[],n.propVariablesCopiedBySource=[],n.sourceNames=[],n.uniqueIdentifiersUsedBySource={};let l=this.createAttributesObject({flags:a});if(!i({componentName:t.componentName,type:"determineDependencies",stateVariable:"replacementSources",dependency:"__determine_dependencies",expandComposites:!1}).success)throw Error(`Couldn't resolve determineDependencies of replacementSources of ${t.componentName}`);if(t.stateValues.serializedComponentsForContentId){let f=[H(t.stateValues.serializedComponentsForContentId)];return f=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:f,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:r}).serializedComponents,{replacements:this.verifyReplacementsMatchSpecifiedType({component:t,replacements:f,workspace:n,componentInfoObjects:r,compositeAttributesObj:l}).replacements}}if(t.stateValues.sourceIndex!==null){let f=Ot({attributes:t.attributes,componentType:"number",componentInfoObjects:r,compositeAttributesObj:l,compositeCreatesNewNamespace:t.attributes.newNamespace}),h=[{componentType:"number",attributes:f,state:{value:t.stateValues.sourceIndex,fixed:!0}}],y=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:h,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:r});return{replacements:this.verifyReplacementsMatchSpecifiedType({component:t,replacements:y.serializedComponents,workspace:n,componentInfoObjects:r,compositeAttributesObj:l}).replacements}}if(!t.stateValues.targetComponent||!t.stateValues.replacementSourceIdentities)return{replacements:this.verifyReplacementsMatchSpecifiedType({component:t,replacements:[],workspace:n,componentInfoObjects:r,compositeAttributesObj:l}).replacements};let c=[],d=[],p=0;for(let f in t.stateValues.replacementSourceIdentities){let h=n.uniqueIdentifiersUsedBySource[f]=[],y;if(t.attributes.componentType){let C=t.stateValues.nComponentsSpecified,T=t.stateValues.replacementSourceIdentities.length;y=Math.floor(C/T);let v=C%T;f<v&&y++}let b=this.createReplacementForSource({component:t,sourceNum:f,components:e,numReplacementsSoFar:p,uniqueIdentifiersUsed:h,compositeAttributesObj:l,componentInfoObjects:r,nComponentsForSource:y,publicCaseInsensitiveAliasSubstitutions:s});n.propVariablesCopiedBySource[f]=b.propVariablesCopiedByReplacement;let g=b.serializedReplacements;d[f]=g.length,p+=g.length,c.push(...g)}return n.numReplacementsBySource=d,n.sourceNames=t.stateValues.replacementSourceIdentities.map(f=>f.componentName),{replacements:this.verifyReplacementsMatchSpecifiedType({component:t,replacements:c,workspace:n,componentInfoObjects:r,compositeAttributesObj:l}).replacements}}static verifyReplacementsMatchSpecifiedType({component:t,replacements:e,replacementChanges:n,workspace:r,componentInfoObjects:a,compositeAttributesObj:i}){let s=!1;if(!t.attributes.componentType)return{resetReplacements:!1,replacements:e,replacementChanges:n};let l=t.replacementsToWithhold,u;if(!n)u=e.map(c=>c.componentType);else{u=t.replacements.map(c=>c.componentType);for(let c of n)if(c.changeType==="add"){if(c.replacementsToWithhold!==void 0&&(l=c.replacementsToWithhold),!c.changeTopLevelReplacements)continue;if(c.serializedReplacements){let d=c.numberReplacementsToReplace;d>0||(d=0);let p=c.firstReplacementInd,m=c.serializedReplacements.map(f=>f.componentType);u.splice(p,d,...m)}}else if(c.changeType==="delete"){if(c.replacementsToWithhold!==void 0&&(l=c.replacementsToWithhold),c.changeTopLevelReplacements){let d=c.firstReplacementInd,p=c.numberReplacementsToDelete;u.splice(d,p)}}else c.changeType==="changeReplacementsToWithhold"&&c.replacementsToWithhold!==void 0&&(l=c.replacementsToWithhold)}if(l>0&&(u=u.slice(0,u.length-l)),u.length!==t.stateValues.nComponentsSpecified||!u.every(c=>c===t.attributes.componentType)){console.warn(`Replacements from copy ${t.componentName} do not match the specified componentType and number of components`),r.numReplacementsBySource=[],r.propVariablesCopiedBySource=[],r.sourceNames=[],r.uniqueIdentifiersUsedBySource={};let c=r.uniqueIdentifiersUsedBySource[0]=[];e=[];for(let p=0;p<t.stateValues.nComponentsSpecified;p++){let m=Ot({attributes:t.attributes,componentType:t.attributes.componentType,componentInfoObjects:a,compositeAttributesObj:i,compositeCreatesNewNamespace:t.attributes.newNamespace}),f=t.attributes.componentType+"|empty"+p,h=Ue(f,c);e.push({componentType:t.attributes.componentType,attributes:m,uniqueIdentifier:h})}if(e=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:e,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:a}).serializedComponents,r.numReplacementsBySource.push(e.length),n){n=[],t.replacementsToWithhold>0&&n.push({changeType:"changeReplacementsToWithhold",replacementsToWithhold:0});let p=0;t.replacements&&(p=t.replacements.length),n.push({changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:p,serializedReplacements:e})}}return{resetReplacements:s,replacements:e,replacementChanges:n}}static createReplacementForSource({component:t,sourceNum:e,components:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:a,compositeAttributesObj:i,componentInfoObjects:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u}){let c=t.stateValues.replacementSourceIdentities[e],d=n[c.componentName];if(d.stateValues.isInactiveCompositeReplacement)return{serializedReplacements:[]};if(t.stateValues.effectivePropNameBySource[e]){let f=Sn({component:t,components:n,replacementSource:c,propName:t.stateValues.effectivePropNameBySource[e],numReplacementsSoFar:r,uniqueIdentifiersUsed:a,compositeAttributesObj:i,componentInfoObjects:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u});return{serializedReplacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:f.serializedReplacements,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,indOffset:r,componentInfoObjects:s}).serializedComponents,propVariablesCopiedByReplacement:f.propVariablesCopiedByReplacement}}let p=[d.serialize({forCopy:!0})];p=Te({serializedComponents:p,componentName:t.componentName,uniqueIdentifiersUsed:a});for(let f of p){f.attributes||(f.attributes={});let h=Ot({attributes:t.attributes,componentType:f.componentType,componentInfoObjects:s,compositeAttributesObj:i,compositeCreatesNewNamespace:t.attributes.newNamespace});Object.assign(f.attributes,h)}return{serializedReplacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:p,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,indOffset:r,componentInfoObjects:s}).serializedComponents}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:a,flags:i,resolveItem:s,publicCaseInsensitiveAliasSubstitutions:l}){if(t.stateValues.serializedComponentsForContentId)return[];if(t.stateValues.sourceIndex!==null)return[];let u=this.createAttributesObject({flags:i});if(!t.stateValues.targetComponent||!t.stateValues.replacementSourceIdentities){let b=[];if(t.replacements.length>0){let C={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length};b.push(C)}return r.sourceNames=[],r.numReplacementsBySource=[],r.propVariablesCopiedBySource=[],this.verifyReplacementsMatchSpecifiedType({component:t,replacementChanges:b,workspace:r,componentInfoObjects:a,compositeAttributesObj:u}).replacementChanges}if(t.stateValues.targetInactive){let b=[],g=t.replacements.length;if(g>0){if(t.replacementsToWithhold!==g){let T={changeType:"changeReplacementsToWithhold",replacementsToWithhold:g};b.push(T)}b=this.verifyReplacementsMatchSpecifiedType({component:t,replacementChanges:b,workspace:r,componentInfoObjects:a,compositeAttributesObj:u}).replacementChanges}return b}let c=[];if(t.replacementsToWithhold>0){let b={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};c.push(b)}let d=0,p=[],m=[],f=Math.max(t.stateValues.replacementSourceIdentities.length,r.numReplacementsBySource.length),h=!1;for(let b=0;b<f;b++){let g;if(t.attributes.componentType){let A=t.stateValues.nComponentsSpecified,S=t.stateValues.replacementSourceIdentities.length;g=Math.floor(A/S);let O=A%S;b<O&&g++}let C=t.stateValues.replacementSourceIdentities[b];if(C===void 0){if(r.numReplacementsBySource[b]>0){if(!h){let A=r.numReplacementsBySource.slice(b).reduce((S,O)=>S+O,0);if(A>0){let S={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:d,numberReplacementsToDelete:A};c.push(S)}h=!0,r.numReplacementsBySource.slice(b).forEach((S,O)=>r.numReplacementsBySource[O]=0)}r.uniqueIdentifiersUsedBySource[b]=[]}p[b]=0,m.push([]);continue}let T=r.sourceNames[b],v=T===void 0||C.componentName!==T||h;if(!v)for(let A=0;A<r.numReplacementsBySource[b];A++){let S=t.replacements[d+A];if(S){if(!t.stateValues.effectivePropNameBySource[b]&&S.shadows.componentName!==t.stateValues.replacementSourceIdentities[b].componentName){v=!0;break}}else{v=!0;break}}if(v){let A=0;T!==void 0&&(A=r.numReplacementsBySource[b]);let S=A;h&&(S=0);let O=r.uniqueIdentifiersUsedBySource[b]=[],k=this.recreateReplacements({component:t,sourceNum:b,numReplacementsSoFar:d,numReplacementsToDelete:S,components:n,uniqueIdentifiersUsed:O,compositeAttributesObj:u,componentInfoObjects:a,nComponentsForSource:g,publicCaseInsensitiveAliasSubstitutions:l});d+=k.numReplacements,p[b]=k.numReplacements,m[b]=k.propVariablesCopiedByReplacement;let R=k.replacementInstruction;if(!h&&k.numReplacements!==A){let P=r.numReplacementsBySource.slice(b).reduce((F,L)=>F+L,0);R.numberReplacementsToReplace=P,h=!0,r.numReplacementsBySource.slice(b).forEach((F,L)=>r.numReplacementsBySource[L]=0)}c.push(R);continue}if(!t.stateValues.effectivePropNameBySource[b]){if(n[C.componentName].stateValues.isInactiveCompositeReplacement){if(r.numReplacementsBySource[b]===0){d+=r.numReplacementsBySource[b],p[b]=r.numReplacementsBySource[b];continue}}else if(r.numReplacementsBySource[b]>0){d+=r.numReplacementsBySource[b],p[b]=r.numReplacementsBySource[b];continue}}let N=r.uniqueIdentifiersUsedBySource[b]=[],V=this.createReplacementForSource({component:t,sourceNum:b,components:n,numReplacementsSoFar:d,uniqueIdentifiersUsed:N,compositeAttributesObj:u,componentInfoObjects:a,nComponentsForSource:g,publicCaseInsensitiveAliasSubstitutions:l}),x=V.propVariablesCopiedByReplacement,w=V.serializedReplacements,D=w.length,I=r.numReplacementsBySource[b];if(D!==I){let A=r.numReplacementsBySource.slice(b).reduce((O,k)=>O+k,0),S={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:d,numberReplacementsToReplace:A,serializedReplacements:w,assignNamesOffset:d};c.push(S),h=!0,r.numReplacementsBySource.slice(b).forEach((O,k)=>r.numReplacementsBySource[k]=0)}else for(let A=0;A<D;A++)if(x[A].length!==r.propVariablesCopiedBySource[b][A].length||r.propVariablesCopiedBySource[b][A].some((S,O)=>S!==x[A][O])||t.replacements[d+A].componentType!==w[A].componentType){let S={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:d+A,numberReplacementsToReplace:1,serializedReplacements:[w[A]],assignNamesOffset:d+A};c.push(S)}d+=D,p[b]=D,m[b]=x}return r.numReplacementsBySource=p,r.sourceNames=t.stateValues.replacementSourceIdentities.map(b=>b.componentName),r.propVariablesCopiedBySource=m,this.verifyReplacementsMatchSpecifiedType({component:t,replacementChanges:c,workspace:r,componentInfoObjects:a,compositeAttributesObj:u}).replacementChanges}static recreateReplacements({component:t,sourceNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:a,components:i,compositeAttributesObj:s,componentInfoObjects:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c}){let d=this.createReplacementForSource({component:t,sourceNum:e,numReplacementsSoFar:n,components:i,uniqueIdentifiersUsed:a,compositeAttributesObj:s,componentInfoObjects:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c}),p=d.propVariablesCopiedByReplacement,m=d.serializedReplacements,f={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:m,assignNamesOffset:n};return{numReplacements:m.length,propVariablesCopiedByReplacement:p,replacementInstruction:f}}},oc=Ni;function Sn({component:o,components:t,replacementSource:e,propName:n,uniqueIdentifiersUsed:r,compositeAttributesObj:a,componentInfoObjects:i,nComponentsForSource:s,publicCaseInsensitiveAliasSubstitutions:l}){let u=[],c=[],d=-1,p=t[e.componentName],m=l({stateVariables:[n],componentClass:p.constructor})[0];if(m===void 0||m.slice(0,12)==="__not_public")return console.warn(`Could not find prop ${n} on a component of type ${e.componentType}`),{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let f=p.state[m];if(f.isArray||f.isArrayEntry){let h,y;if(f.isArray?(h=f,y=f.getAllArrayKeys(f.arraySize,!1)):(h=p.state[f.arrayStateVariable],y=f.unflattenedArrayKeys),h.hasVariableComponentType&&(o.stateValues.replacementSources,!h.componentType))return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let b=f.wrappingComponents,g=b.length,C=s;if(C===void 0)if(f.isArray)C=f.arraySize.slice(0,f.arraySize.length-g).reduce((T,v)=>T*v,1);else if(f.arrayKeys.length===0)C=0;else if(g===0)C=f.arrayKeys.length;else if(g>=f.nDimensions)C=1;else if(g===f.nDimensions-1)C=y.length;else{let T=f.nDimensions-g-1;C=ra(y,T).length}else f.isArray?y=f.getAllArrayKeys(f.arraySize,!1,[C]):y=h.getArrayKeysFromVarName({arrayEntryPrefix:f.entryPrefix,varEnding:f.varEnding,arraySize:f.arraySize,desiredEntrySize:[C]});if(g===0){let T=te(y);for(let v=0;v<C;v++){d++;let N=c[d]=[],V=h.componentType;Array.isArray(V)&&(f.isArrayEntry?V=V[h.keyToIndex(f.arrayKeys[v])]:V=V[v]);let x=T[v];if(x){let w=h.arrayVarNameFromArrayKey(x);N.push(w);{let D=e.componentName+"|shadow|"+w,I=Ue(D,r),A=Ot({attributes:o.attributes,componentType:V,componentInfoObjects:i,compositeAttributesObj:a,compositeCreatesNewNamespace:o.attributes.newNamespace});u.push({componentType:V,attributes:A,downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:o.componentName,propVariable:w}]},uniqueIdentifier:I})}}else{let w=V+"|empty",D=Ue(w,r);u.push({componentType:V,uniqueIdentifier:D})}}}else{let T=function(V,x){let w=[],D=[];if(x>1)for(let A of V){let S=T(A,x-1);w.push(...S.pieces),D.push(...S.propVariablesCopiedByPiece)}else for(let A of V){let S=h.arrayVarNameFromArrayKey(A),O=[S];{let k=e.componentName+"|shadow|"+S,R=Ue(k,r),P=h.componentType;Array.isArray(P)&&(P=P[h.keyToIndex(A)]),w.push({componentType:P,downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:o.componentName,propVariable:S}]},uniqueIdentifier:R})}D.push(O)}let I=b[x-1];if(w.length>0&&I&&I.length>0){for(let A=I.length-1;A>=0;A--){let S=typeof I[A]=="object"?I[A].componentType:I[A],O=S+"|wrapper",k=Ue(O,r),R=[],P={};for(let F of w)if(F.isAttribute){let L=F.isAttribute;delete F.isAttribute,P[L]=F}else R.push(F);w=[{componentType:S,children:R,attributes:P,uniqueIdentifier:k}],typeof I[A]=="object"&&(I[A].doenetAttributes&&(w[0].doenetAttributes=Object.assign({},I[A].doenetAttributes)),I[A].isAttribute&&(w[0].isAttribute=I[A].isAttribute))}D=[te(D)]}return{pieces:w,propVariablesCopiedByPiece:D}},v=T(y,f.nDimensions),N=v.pieces;c=v.propVariablesCopiedByPiece;for(let V of N){V.attributes||(V.attributes={});let x=Ot({attributes:o.attributes,componentType:V.componentType,componentInfoObjects:i,compositeAttributesObj:a,compositeCreatesNewNamespace:o.attributes.newNamespace});Object.assign(V.attributes,x),V.downstreamDependencies={[e.componentName]:[{dependencyType:"referenceShadow",compositeName:o.componentName,propVariable:m,ignorePrimaryStateVariable:!0}]}}if(d+=N.length,u.push(...N),N.length<C)for(let V=N.length;V<C;V++){d++,c[d]=[];let x,w=b[0],D;w&&w.length>0?typeof w[0]=="object"?(x=w[0].componentType,D=Object.assign({},w[0].doenetAttributes)):x=w[0]:(x=h.componentType,Array.isArray(x)&&(f.isArrayEntry?x=x[h.keyToIndex(f.arrayKeys[V])]:x=x[V]));let I=x+"|empty",A=Ue(I,r),S={componentType:x,uniqueIdentifier:A};D&&(S.doenetAttributes=D),u.push(S)}else if(N>C)throw Error(`Something went wrong when creating replacements for ${o.componentName} as we ended up with too many replacements`)}}else{if(!f.componentType)return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};d++,(c[d]=[]).push(m);let y=p.componentName+"|shadow|"+m,b=Ue(y,r),g=Ot({attributes:o.attributes,componentType:f.componentType,componentInfoObjects:i,compositeAttributesObj:a,compositeCreatesNewNamespace:o.attributes.newNamespace});u.push({componentType:f.componentType,attributes:g,downstreamDependencies:{[p.componentName]:[{dependencyType:"referenceShadow",compositeName:o.componentName,propVariable:m}]},uniqueIdentifier:b})}return{serializedReplacements:u,propVariablesCopiedByReplacement:c}}var Ti=class extends G{static componentType="extract";static assignNamesToReplacements=!0;static acceptAnyAttribute=!0;static get stateVariablesShadowedForReference(){return["propName"]}static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.prop={createPrimitiveOfType:"text"},e.componentType={createPrimitiveOfType:"text"},e.nComponents={createPrimitiveOfType:"number"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",excludeComponentTypes:["_composite"],number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.propName={returnDependencies:()=>({propName:{dependencyType:"attribute",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{newValues:{propName:e.propName}}}},t.sourceComponents={stateVariablesDeterminingDependencies:["propName","componentIndex","propIndex"],returnDependencies:({stateValues:e})=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:[e.propName],variablesOptional:!0,componentIndex:e.componentIndex,propIndex:e.propIndex,publicCaseInsensitiveVariableMatch:!0,useMappedVariableNames:!0}}),definition:({dependencyValues:e})=>({newValues:{sourceComponents:e.children}})},t.readyToExpandWhenResolved={returnDependencies:()=>({replacementClasses:{dependencyType:"stateVariable",variableName:"sourceComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies(){return{sourceComponents:{dependencyType:"stateVariable",variableName:"sourceComponents"}}},markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}get allPotentialRendererTypes(){let t=[];if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r,flags:a,publicCaseInsensitiveAliasSubstitutions:i}){let s=[],l=[],u=0;n.propVariablesCopiedBySource=[],n.uniqueIdentifiersUsedBySource={};let c=this.createAttributesObject({flags:a});for(let d=0;d<t.stateValues.sourceComponents.length;d++)if(t.stateValues.sourceComponents[d]!==void 0){let p=n.uniqueIdentifiersUsedBySource[d]=[],m=this.createReplacementForSource({component:t,sourceNum:d,components:e,numReplacementsSoFar:u,uniqueIdentifiersUsed:p,componentInfoObjects:r,compositeAttributesObj:c,publicCaseInsensitiveAliasSubstitutions:i});n.propVariablesCopiedBySource[d]=m.propVariablesCopiedByReplacement;let f=m.serializedReplacements;l[d]=f.length,u+=f.length,s.push(...f)}else l[d]=0;return n.numReplacementsBySource=l,n.sourceNames=t.stateValues.sourceComponents.map(d=>d.componentName),{replacements:s}}static createReplacementForSource({component:t,components:e,sourceNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:a,componentInfoObjects:i,compositeAttributesObj:s,publicCaseInsensitiveAliasSubstitutions:l}){let u=Sn({component:t,components:e,replacementSource:t.stateValues.sourceComponents[n],propName:t.stateValues.propName,uniqueIdentifiersUsed:a,compositeAttributesObj:s,componentInfoObjects:i,publicCaseInsensitiveAliasSubstitutions:l}),c=u.serializedReplacements,d=u.propVariablesCopiedByReplacement;return c=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:c,parentName:t.componentName,indOffset:r,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:i}).serializedComponents,{serializedReplacements:c,propVariablesCopiedByReplacement:d}}static calculateReplacementChanges({component:t,components:e,workspace:n,componentInfoObjects:r,flags:a,publicCaseInsensitiveAliasSubstitutions:i}){let s=[],l=0,u=[],c=[],d=this.createAttributesObject({flags:a}),p=Math.max(t.stateValues.sourceComponents.length,n.numReplacementsBySource.length),m=!1;for(let f=0;f<p;f++){let h=t.stateValues.sourceComponents[f];if(h===void 0){if(n.numReplacementsBySource[f]>0){if(!m){let x=n.numReplacementsBySource.slice(f).reduce((w,D)=>w+D,0);if(x>0){let w={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:l,numberReplacementsToDelete:x};s.push(w)}m=!0,n.numReplacementsBySource.slice(f).forEach((w,D)=>n.numReplacementsBySource[D]=0)}n.uniqueIdentifiersUsedBySource[f]=[]}u[f]=0,c.push([]);continue}let y=n.sourceNames[f],b=y===void 0||h.componentName!==y||m;if(!b){for(let x=0;x<n.numReplacementsBySource[f];x++)if(!t.replacements[l+x]){b=!0;break}}if(b){let x=0;y!==void 0&&(x=n.numReplacementsBySource[f]);let w=x;m&&(w=0);let D=n.uniqueIdentifiersUsedBySource[f]=[],I=this.recreateReplacements({component:t,sourceNum:f,numReplacementsSoFar:l,numReplacementsToDelete:w,components:e,uniqueIdentifiersUsed:D,componentInfoObjects:r,compositeAttributesObj:d,publicCaseInsensitiveAliasSubstitutions:i});l+=I.numReplacements,u[f]=I.numReplacements,c[f]=I.propVariablesCopiedByReplacement;let A=I.replacementInstruction;if(!m&&I.numReplacements!==x){let S=n.numReplacementsBySource.slice(f).reduce((O,k)=>O+k,0);A.numberReplacementsToReplace=S,m=!0,n.numReplacementsBySource.slice(f).forEach((O,k)=>n.numReplacementsBySource[k]=0)}s.push(A);continue}let g=n.uniqueIdentifiersUsedBySource[f]=[],C=this.createReplacementForSource({component:t,sourceNum:f,components:e,numReplacementsSoFar:l,uniqueIdentifiersUsed:g,componentInfoObjects:r,compositeAttributesObj:d,publicCaseInsensitiveAliasSubstitutions:i}),T=C.propVariablesCopiedByReplacement,v=C.serializedReplacements,N=v.length,V=n.numReplacementsBySource[f];if(N!==V){let x=n.numReplacementsBySource.slice(f).reduce((D,I)=>D+I,0),w={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:l,numberReplacementsToReplace:x,serializedReplacements:v,assignNamesOffset:l};s.push(w),m=!0,n.numReplacementsBySource.slice(f).forEach((D,I)=>n.numReplacementsBySource[I]=0)}else for(let x=0;x<N;x++)if(T[x].length!==n.propVariablesCopiedBySource[f][x].length||n.propVariablesCopiedBySource[f][x].some((w,D)=>w!==T[x][D])){let w={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:l+x,numberReplacementsToReplace:1,serializedReplacements:[v[x]],assignNamesOffset:l+x};s.push(w)}l+=N,u[f]=N,c[f]=T}return n.numReplacementsBySource=u,n.sourceNames=t.stateValues.sourceComponents.map(f=>f.componentName),n.propVariablesCopiedBySource=c,s}static recreateReplacements({component:t,sourceNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:a,components:i,componentInfoObjects:s,compositeAttributesObj:l,publicCaseInsensitiveAliasSubstitutions:u}){let c=this.createReplacementForSource({component:t,sourceNum:e,numReplacementsSoFar:n,components:i,uniqueIdentifiersUsed:a,componentInfoObjects:s,compositeAttributesObj:l,publicCaseInsensitiveAliasSubstitutions:u}),d=c.propVariablesCopiedByReplacement,p=c.serializedReplacements,m={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:p,assignNamesOffset:n};return{numReplacements:p.length,propVariablesCopiedByReplacement:d,replacementInstruction:m}}},lc=Ti;var Vi=class extends G{static componentType="collect";static assignNamesToReplacements=!0;static acceptTname=!0;static get stateVariablesShadowedForReference(){return["targetComponent","propName","componentTypesToCollect"]}static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.prop={createPrimitiveOfType:"text"},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.targetAttributesToIgnore={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnore",defaultValue:["hide"],public:!0},e.componentTypes={createComponentOfType:"textList"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{newValues:{targetComponent:e.targetComponent}}}},t.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e}){return e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:e}){return{newValues:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},t.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition:function({dependencyValues:e}){return e.targetComponent===null?(console.warn("No copy target"),{newValues:{targetName:""}}):{newValues:{targetName:e.targetComponent.componentName}}}},t.propName={returnDependencies:()=>({propName:{dependencyType:"attribute",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{newValues:{propName:e.propName}}}},t.componentTypesToCollect={additionalStateVariablesDefined:["componentClassesToCollect"],returnDependencies:()=>({componentTypesAttr:{dependencyType:"attributeComponent",attributeName:"componentTypes",variableNames:["texts"]}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[],a=[];if(e.componentTypesAttr!==null)for(let i of e.componentTypesAttr.stateValues.texts){let s=n.componentTypeLowerCaseMapping[i.toLowerCase()],l=n.allComponentClasses[s];if(l)r.push(s),a.push(l);else{let u="Cannot collect component type "+i+". Component type not found.";console.warn(u)}}return{newValues:{componentTypesToCollect:r,componentClassesToCollect:a}}}},t.collectedComponents={stateVariablesDeterminingDependencies:["componentTypesToCollect","targetName","propName","componentIndex","propIndex"],returnDependencies:function({stateValues:e}){if(!e.targetName)return{};let n={dependencyType:"descendant",ancestorName:e.targetName,componentTypes:e.componentTypesToCollect,useReplacementsForComposites:!0,includeNonActiveChildren:!0,recurseToMatchedChildren:!1,componentIndex:e.componentIndex};return e.propName&&(n.variableNames=[e.propName],n.variablesOptional=!0,n.componentIndex=e.componentIndex,n.propIndex=e.propIndex,n.publicCaseInsensitiveVariableMatch=!0,n.useMappedVariableNames=!0),{descendants:n,maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}},definition:function({dependencyValues:e}){let n=e.descendants;if(n||(n=[]),e.maximumNumber!==null&&n.length>e.maximumNumber){let r=Math.max(0,Math.floor(e.maximumNumber));n=n.slice(0,r)}return{newValues:{collectedComponents:n}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition:()=>({newValues:{readyToExpandWhenResolved:!0}})},t.needsReplacementsUpdatedWhenStale={returnDependencies(){return{collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"}}},markStale(){return{updateReplacements:!0}},definition(){return{newValues:{needsReplacementsUpdatedWhenStale:!0}}}},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r,nComponentsForSource:a,publicCaseInsensitiveAliasSubstitutions:i}){if(!t.stateValues.targetComponent)return{replacements:[]};let s=[],l=[],u=0,c=[];n.propVariablesCopiedByCollected=[],n.uniqueIdentifiersUsedByCollected={};let d=this.createAttributesObject({});for(let p=0;p<t.stateValues.collectedComponents.length;p++)if(t.stateValues.collectedComponents[p]){let m=n.uniqueIdentifiersUsedByCollected[p]=[],f=this.createReplacementForCollected({component:t,collectedNum:p,components:e,numReplacementsSoFar:u,uniqueIdentifiersUsed:m,componentInfoObjects:r,compositeAttributesObj:d,nComponentsForSource:a,publicCaseInsensitiveAliasSubstitutions:i});n.propVariablesCopiedByCollected[p]=f.propVariablesCopiedByReplacement;let h=f.serializedReplacements;l[p]=h.length,u+=h.length,s.push(...h),c[p]=h.map(y=>y.componentName)}else l[p]=0,c[p]=[],n.propVariablesCopiedByCollected[p]=[];return n.numReplacementsByCollected=l,n.collectedNames=t.stateValues.collectedComponents.map(p=>p.componentName),n.replacementNamesByCollected=c,{replacements:s}}static createReplacementForCollected({component:t,components:e,collectedNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:a,componentInfoObjects:i,compositeAttributesObj:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u}){let c=t.stateValues.collectedComponents[n],d=c.componentName,p=e[d],m=[],f=[];if(!p)return{serializedReplacements:m,propVariablesCopiedByReplacement:f};if(t.stateValues.propName){let y=Sn({component:t,components:e,replacementSource:c,propName:t.stateValues.propName,uniqueIdentifiersUsed:a,compositeAttributesObj:s,componentInfoObjects:i,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u});m=y.serializedReplacements,f=y.propVariablesCopiedByReplacement}else{let y=[p.serialize({forCopy:!0})];m=Te({serializedComponents:y,componentName:t.componentName,uniqueIdentifiersUsed:a,identifierPrefix:n+"|"})}return m=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:m,parentName:t.componentName,indOffset:r,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:i}).serializedComponents,{serializedReplacements:m,propVariablesCopiedByReplacement:f}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:a,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:s}){let l=0;for(let b=0;b<r.numReplacementsByCollected.length;b++){let g=[];for(let[C,T]of r.replacementNamesByCollected[b].entries())!t.replacements[l]||t.replacements[l].componentName!==T?g.push(C):l++;for(let C of g.reverse())r.replacementNamesByCollected[b].splice(C,1),r.propVariablesCopiedByCollected[b].splice(C,1);r.numReplacementsByCollected[b]-=g.length}let u=[],c=0,d=[],p=[],m=[],f=Math.max(t.stateValues.collectedComponents.length,r.numReplacementsByCollected.length),h=!1,y=this.createAttributesObject({});for(let b=0;b<f;b++){let g=t.stateValues.collectedComponents[b];if(g===void 0){if(r.numReplacementsByCollected[b]>0){if(!h){let D=r.numReplacementsByCollected.slice(b).reduce((I,A)=>I+A,0);if(D>0){let I={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:c,numberReplacementsToDelete:D};u.push(I)}h=!0,r.numReplacementsByCollected.slice(b).forEach((I,A)=>r.numReplacementsByCollected[A]=0)}r.uniqueIdentifiersUsedByCollected[b]=[]}d[b]=0,p.push([]),m.push([]);continue}let C=r.collectedNames[b];if(C===void 0||g.componentName!==C||h){let D=0;C!==void 0&&(D=r.numReplacementsByCollected[b]);let I=D;h&&(I=0);let A=r.uniqueIdentifiersUsedByCollected[b]=[],S=this.recreateReplacements({component:t,collectedNum:b,numReplacementsSoFar:c,numReplacementsToDelete:I,components:n,uniqueIdentifiersUsed:A,componentInfoObjects:a,compositeAttributesObj:y,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:s});c+=S.numReplacements,d[b]=S.numReplacements,p[b]=S.propVariablesCopiedByReplacement;let O=S.replacementInstruction;if(m[b]=O.serializedReplacements.map(k=>k.componentName),!h&&S.numReplacements!==D){let k=r.numReplacementsByCollected.slice(b).reduce((R,P)=>R+P,0);O.numberReplacementsToReplace=k,h=!0,r.numReplacementsByCollected.slice(b).forEach((R,P)=>r.numReplacementsByCollected[P]=0)}u.push(O);continue}if(!t.stateValues.propName){c+=r.numReplacementsByCollected[b],d[b]=r.numReplacementsByCollected[b],m[b]=r.replacementNamesByCollected[b],p[b]=[];continue}let T=r.uniqueIdentifiersUsedByCollected[b]=[],v=this.createReplacementForCollected({component:t,collectedNum:b,components:n,numReplacementsSoFar:c,uniqueIdentifiersUsed:T,componentInfoObjects:a,compositeAttributesObj:y,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:s}),N=v.propVariablesCopiedByReplacement,V=v.serializedReplacements,x=V.length,w=r.numReplacementsByCollected[b];if(x!==w){let D=r.numReplacementsByCollected.slice(b).reduce((A,S)=>A+S,0),I={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c,numberReplacementsToReplace:D,serializedReplacements:V,assignNamesOffset:c};u.push(I),h=!0,r.numReplacementsByCollected.slice(b).forEach((A,S)=>r.numReplacementsByCollected[S]=0)}else for(let D=0;D<x;D++)if(N[D].length!==r.propVariablesCopiedByCollected[b][D].length||r.propVariablesCopiedByCollected[b][D].some((I,A)=>I!==N[D][A])){let I={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c+D,numberReplacementsToReplace:1,serializedReplacements:[V[D]],assignNamesOffset:c+D};u.push(I)}c+=x,d[b]=x,p[b]=N,m[b]=V.map(D=>D.componentName)}return r.numReplacementsByCollected=d,r.collectedNames=t.stateValues.collectedComponents.map(b=>b.componentName),r.propVariablesCopiedByCollected=p,r.replacementNamesByCollected=m,u}static recreateReplacements({component:t,collectedNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:a,components:i,componentInfoObjects:s,compositeAttributesObj:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c}){let d=this.createReplacementForCollected({component:t,collectedNum:e,components:i,numReplacementsSoFar:n,uniqueIdentifiersUsed:a,componentInfoObjects:s,compositeAttributesObj:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c}),p=d.propVariablesCopiedByReplacement,m=d.serializedReplacements,f={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:m,assignNamesOffset:n};return{numReplacements:m.length,propVariablesCopiedByReplacement:p,replacementInstruction:f}}},uc=Vi;var xi=class extends E{static componentType="ref";static renderChildren=!0;static acceptTname=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.textType={createComponentOfType:"text",createStateVariable:"textType",defaultValue:"type-global",public:!0},e.uri={createComponentOfType:"_textFromSingleStringChild",createStateVariable:"uri",defaultValue:null,public:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{newValues:{targetComponent:e.targetComponent}}}},t.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e}){return e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:e}){return{newValues:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},t.targetName={forRenderer:!0,returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},uri:{dependencyType:"stateVariable",variableName:"uri"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"}}),definition:function({dependencyValues:e}){return e.targetComponent===null||e.targetInactive?{newValues:{targetName:""}}:e.uri!==null?(console.warn("Haven't implemented ref with uri and tname, ignoring tname."),{newValues:{targetName:""}}):{newValues:{targetName:e.targetComponent.componentName}}}},t.contentId={returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition({dependencyValues:e}){if(e.uri!==null){let n=e.uri.match(/^\s*doenet\s*:\s*(\S*)\s*$/i);if(n!==null)return{newValues:{contentId:n[1]}}}return{newValues:{contentId:null}}}},t.linkText={public:!0,componentType:"text",forRenderer:!0,stateVariablesDeterminingDependencies:["targetName"],returnDependencies({stateValues:e}){let n={inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroAnything",variableNames:["text"],variablesOptional:!0},uri:{dependencyType:"stateVariable",variableName:"uri"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"}};return e.targetName&&(n.equationTag={dependencyType:"stateVariable",componentName:e.targetName,variableName:"equationTag",variablesOptional:!0},n.title={dependencyType:"stateVariable",componentName:e.targetName,variableName:"title",variablesOptional:!0}),n},definition:function({dependencyValues:e}){let n="";if(e.inlineChildren.length===0)e.uri!==null?n=e.uri:e.targetInactive||(e.title!==null?n=e.title:e.equationTag!==null&&(n="("+e.equationTag+")"));else for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return n||(n="???"),{newValues:{linkText:n}}}},t}},cc=xi;var wi=class extends pe{static componentType="coords";static rendererType="math";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.createVectors={createComponentOfType:"boolean",createStateVariable:"createVectors",defaultValue:!0,public:!0},e}},dc=wi;import K from"math-expressions";var Di=class extends se{static componentType="line";actions={moveLine:this.moveLine.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["points","variables"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.equation={createComponentOfType:"math"},e.through={createComponentOfType:"_pointListComponent"},e.variables={createComponentOfType:"variables"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:"s",replacementFunction:({matchedChildren:e})=>({success:!0,newAttributes:{equation:{componentType:"math",children:e}}})}),t}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nDimensions={public:!0,componentType:"number",stateVariablesDeterminingDependencies:["equationIdentity"],returnDependencies:function({stateValues:e}){return e.equationIdentity===null?{through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}:{equation:{dependencyType:"attributeComponent",attributeName:"equation"}}},definition:function({dependencyValues:e,changes:n}){return e.equation?n.equation&&n.equation.componentIdentitiesChanged?{newValues:{nDimensions:2},checkForActualChange:{nDimensions:!0}}:{noChanges:["nDimensions"]}:e.through?{newValues:{nDimensions:e.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.variables={isArray:!0,public:!0,componentType:"variable",entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{variables:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]}}}},arrayDefinitionByKey({globalDependencyValues:e,arraySize:n}){let r=[];return e.variables!==null&&(r=e.variables.stateValues.variables),{newValues:{variables:sl(n[0],r)}}}},t.equationIdentity={returnDependencies:()=>({equation:{dependencyType:"attributeComponent",attributeName:"equation"}}),definition:function({dependencyValues:e}){return e.equation!==null?{newValues:{equationIdentity:e.equation}}:{newValues:{equationIdentity:null}}}},t.points={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],returnWrappingComponents(e){return e==="pointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="pointX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},stateVariablesDeterminingDependencies:["equationIdentity"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[2,e.nDimensions]},returnArrayDependenciesByKey({stateValues:e,arrayKeys:n}){if(e.equationIdentity===null){let r={};for(let a of n){let[i,s]=a.split(","),l=Number(i)+1+"_"+(Number(s)+1);r[a]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+l]}}}return{dependenciesByKey:r}}else return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,arraySize:a,componentName:i}){if("coeff0"in e){let s=bh(e);if(s.success)return{newValues:{points:s.points}};{let l={};for(let u=0;u<a[0];u++)for(let c=0;c<a[1];c++)l[u+","+c]=K.fromAst("\uFF3F");return{newValues:{points:l}}}}else{let s={},l={};for(let c of r){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);n[c].through!==null&&n[c].through.stateValues["pointX"+m]?s[c]=n[c].through.stateValues["pointX"+m]:c==="0,0"?l[c]={defaultValue:K.fromAst(1)}:l[c]={defaultValue:K.fromAst(0)}}let u={};return Object.keys(s).length>0&&(u.newValues={points:s}),Object.keys(l).length>0&&(u.useEssentialOrDefaultValue={points:l}),u}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,initialChange:i,stateValues:s,workspace:l}){if(i&&!s.draggable)return{success:!1};if("coeff0"in n){l.desiredPoints||(l.desiredPoints={}),Object.assign(l.desiredPoints,e.points);let u,c,d,p;if(l.desiredPoints["0,0"]?u=l.desiredPoints["0,0"]:u=s.points[0][0],l.desiredPoints["0,1"]?c=l.desiredPoints["0,1"]:c=s.points[0][1],l.desiredPoints["1,0"]?d=l.desiredPoints["1,0"]:d=s.points[1][0],l.desiredPoints["1,1"]?p=l.desiredPoints["1,1"]:p=s.points[1][1],typeof u.tree=="number"&&typeof c.tree=="number"&&typeof d.tree=="number"&&typeof p.tree=="number"){let y=[u.tree,c.tree],b=[d.tree,p.tree],g=y[1]-b[1],C=b[0]-y[0],T=y[0]*b[1]-y[1]*b[0],v=Math.abs(g*s.coeffvar2-s.coeffvar1*C),N=[];return v<Math.abs(g*s.coeffvar2)*1e-12?(g!==0?T*=s.coeffvar1/g:T*=s.coeffvar2/C,N.push({setDependency:"coeff0",desiredValue:T,additionalDependencyValues:{coeffvar1:s.coeffvar1,coeffvar2:s.coeffvar2}})):N.push({setDependency:"coeff0",desiredValue:T,additionalDependencyValues:{coeffvar1:g,coeffvar2:C}}),N.push({setDependency:"lastPointsFromInverting",desiredValue:[y,b]}),{success:!0,instructions:N}}let m=c.subtract(p).simplify(),f=d.subtract(u).simplify(),h=u.multiply(p).subtract(c.multiply(d)).simplify();return{success:!0,instructions:[{setDependency:"coeff0",desiredValue:h,additionalDependencyValues:{coeffvar1:m,coeffvar2:f}}]}}else{let u=[];for(let c of Object.keys(e.points).reverse()){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);r[c].through!==null&&r[c].through.stateValues["pointX"+m]?u.push({setDependency:a[c].through,desiredValue:e.points[c],variableIndex:0}):u.push({setStateVariable:"points",value:{[c]:ne(e.points[c])}})}return{success:!0,instructions:u}}}},t.equation={public:!0,componentType:"math",forRenderer:!0,stateVariablesDeterminingDependencies:["equationIdentity"],additionalStateVariablesDefined:[{variableName:"coeff0",public:!0,componentType:"math"},{variableName:"coeffvar1",public:!0,componentType:"math"},{variableName:"coeffvar2",public:!0,componentType:"math"}],returnDependencies:function({stateValues:e}){let n={variables:{dependencyType:"stateVariable",variableName:"variables"}};return e.equationIdentity===null?(n.points={dependencyType:"stateVariable",variableName:"points"},n.nDimensions={dependencyType:"stateVariable",variableName:"nDimensions"}):n.equation={dependencyType:"attributeComponent",attributeName:"equation",variableNames:["value"]},n},definition:function({dependencyValues:e}){let n=e.variables,r=K.fromAst("\uFF3F");if(e.equation){let h=e.equation.stateValues.value,y=hh({equation:h,variables:n});if(!y.success)return{newValues:{equation:h,coeff0:r,coeffvar1:r,coeffvar2:r}};let{coeff0:b,coeffvar1:g,coeffvar2:C}=y;return{newValues:{equation:h,coeff0:b,coeffvar1:g,coeffvar2:C}}}let a=e.nDimensions;if(Number.isNaN(a))return console.warn("Line through points of undetermined dimensions"),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(a<2)return console.warn("Line must be through points of at least two dimensions"),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};let i=e.points[0][0],s=e.points[0][1],l=e.points[1][0],u=e.points[1][1],c=[...n.map(h=>h.toString())];for(let h=0;h<a;h++)if(i.variables().indexOf(c[h])!==-1||s.variables().indexOf(c[h])!==-1||l.variables().indexOf(c[h])!==-1||u.variables().indexOf(c[h])!==-1)return console.warn("Points through line depend on variables: "+c.join(", ")),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(a!==2)return{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(i.equals(l)&&s.equals(u)){let h=K.fromAst(0);return{newValues:{equation:r,coeff0:h,coeffvar1:h,coeffvar2:h}}}let d=s.subtract(u).simplify(),p=l.subtract(i).simplify(),m=i.multiply(u).subtract(s.multiply(l)).simplify();return{newValues:{equation:K.fromAst(["=",["+",["*","a","x"],["*","b","y"],"c"],0]).substitute({a:d,b:p,c:m,x:n[0],y:n[1]}).simplify(),coeff0:m,coeffvar1:d,coeffvar2:p}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){if(n.points)return console.log("Haven't implemented inverse definition of equation of line based on points"),{success:!1};if(e.equation)return{success:!0,instructions:[{setDependency:"equation",desiredValue:e.equation,variableIndex:0}]};if(!("coeff0"in e&&"coeffvar1"in e&&"coeffvar2"in e))return console.log("Haven't implemented inverting coeffs if not specifying all of them"),{success:!1};let r=K.fromAst(["=",0,["+",["*","a","x"],["*","b","y"],"c"]]).substitute({a:e.coeffvar1,b:e.coeffvar2,c:e.coeff0,x:n.variables[0],y:n.variables[1]}).simplify();return{success:!0,instructions:[{setDependency:"equation",desiredValue:r,variableIndex:0}]}}},t.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return Number.isNaN(e.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:e}){let n={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},r={};for(let a of e)r[a]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(a)+1)}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,componentName:a}){if(Number.isNaN(e.nDimensions))return{};let i={};for(let s of r){let l=n[s].point,u=[];for(let c=0;c<e.nDimensions;c++){let d=l[c].evaluate_to_constant();Number.isFinite(d)||(d=NaN),u.push(d)}i[s]=u}return{newValues:{numericalPoints:i}}}},t.numericalCoeff0={additionalStateVariablesDefined:["numericalCoeffvar1","numericalCoeffvar2"],returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){let n=e.coeff0.evaluate_to_constant();Number.isFinite(n)||(n=NaN);let r=e.coeffvar1.evaluate_to_constant();Number.isFinite(r)||(r=NaN);let a=e.coeffvar2.evaluate_to_constant();return Number.isFinite(a)||(a=NaN),{newValues:{numericalCoeff0:n,numericalCoeffvar1:r,numericalCoeffvar2:a}}}},t.slope={public:!0,componentType:"math",returnDependencies:()=>({coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){return{newValues:{slope:K.fromAst(["-",["/","a","b"]]).substitute({a:e.coeffvar1,b:e.coeffvar2}).simplify()}}}},t.xintercept={public:!0,componentType:"math",returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"}}),definition:({dependencyValues:e})=>({newValues:{xintercept:K.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar1}).simplify()}})},t.yintercept={public:!0,componentType:"math",returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:({dependencyValues:e})=>({newValues:{yintercept:K.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar2}).simplify()}})},t.lastPointsFromInverting={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{lastPointsFromInverting:{variableToCheck:"lastPointsFromInverting"}}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setStateVariable:"lastPointsFromInverting",value:e.lastPointsFromInverting}]})},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalCoeff0:{dependencyType:"stateVariable",variableName:"numericalCoeff0"},numericalCoeffvar1:{dependencyType:"stateVariable",variableName:"numericalCoeffvar1"},numericalCoeffvar2:{dependencyType:"stateVariable",variableName:"numericalCoeffvar2"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.numericalCoeffvar1,a=e.numericalCoeffvar2,i=e.numericalCoeff0;if(!(Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(i)))return{};let s=r*r+a*a;if(s===0)return{};let l=n.x1.evaluate_to_constant(),u=n.x2.evaluate_to_constant();if(!(Number.isFinite(l)&&Number.isFinite(u)))return{};let c={};return c.x1=(a*(a*l-r*u)-r*i)/s,c.x2=(r*(-a*l+r*u)-a*i)/s,n.x3!==void 0&&(c.x3=0),c}}})},t}static adapters=["equation"];moveLine({point1coords:t,point2coords:e,transient:n}){let r={"0,0":K.fromAst(t[0]),"0,1":K.fromAst(t[1]),"1,0":K.fromAst(e[0]),"1,1":K.fromAst(e[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:r}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:r}],event:{verb:"interacted",object:{componentId:this.componentName},result:{point1:t,point2:e}}})}},pc=Di;function hh({equation:o,variables:t}){let e=t[0],n=t[1],r=e.toString(),a=n.toString();o=o.expand().simplify();let i=K.fromAst(["+",o.tree[2],["-",o.tree[1]]]).expand().simplify(),s=[];Array.isArray(i.tree)&&i.tree[0]==="+"?s=i.tree.slice(1):s=[i.tree];let l=K.fromAst(0),u=K.fromAst(0),c=K.fromAst(0);for(let p of s){let m=d(p);if(!m.success)return{success:!1};l=l.add(m.coeffvar1),u=u.add(m.coeffvar2),c=c.add(m.coeff0)}return l=l.simplify(),u=u.simplify(),c=c.simplify(),{success:!0,coeff0:c,coeffvar1:l,coeffvar2:u};function d(p){let m=0,f=0,h=0;if(typeof p=="string")p===r?m=1:p===a?f=1:h=p;else if(typeof p=="number")h=p;else if(Array.isArray(p)){let y=p[0],b=p.slice(1);if(y==="-"){let g=d(b[0]);if(!g.success)return{success:!1};m=["-",g.coeffvar1.tree],f=["-",g.coeffvar2.tree],h=["-",g.coeff0.tree]}else{if(y==="+")return console.warn("Invalid format for equation of line in variables "+e+" and "+n),{success:!1};if(y==="*"){let g=-1,C=-1;for(let T=0;T<b.length;T++)if(e.equals(K.fromAst(b[T]))){g=T;break}else if(n.equals(K.fromAst(b[T]))){C=T;break}g!==-1?(b.splice(g,1),b.length===1?m=b[0]:m=["*"].concat(b)):C!==-1?(b.splice(C,1),b.length===1?f=b[0]:f=["*"].concat(b)):h=p}else if(y==="/"){let g=d(b[0]);if(!g.success)return{success:!1};m=["/",g.coeffvar1.tree,b[1]],f=["/",g.coeffvar2.tree,b[1]],h=["/",g.coeff0.tree,b[1]]}else y==="_"?e.equals(K.fromAst(p))?m=1:n.equals(K.fromAst(p))?f=1:h=p:h=p}}else return console.warn("Invalid format for equation of line in variables "+e+" and "+n),{success:!1};return{success:!0,coeffvar1:K.fromAst(m),coeffvar2:K.fromAst(f),coeff0:K.fromAst(h)}}}function bh({coeff0:o,coeffvar1:t,coeffvar2:e,variables:n,lastPointsFromInverting:r}){let a=n[0],i=n[1],s=a.toString(),l=i.toString();if(t.variables(!0).indexOf(s)!==-1||t.variables(!0).indexOf(l)!==-1||e.variables(!0).indexOf(s)!==-1||e.variables(!0).indexOf(l)!==-1||o.variables(!0).indexOf(s)!==-1||o.variables(!0).indexOf(l)!==-1)return console.warn("Invalid format for equation of line in variables "+s+" and "+l),{success:!1};let u=K.fromAst(0);if(t.equals(u)&&e.equals(u))return console.warn("Invalid format for equation of line in variables "+s+" and "+l),{success:!1};let c=t.evaluate_to_constant(),d=e.evaluate_to_constant(),p=o.evaluate_to_constant(),m,f,h,y,b={};if(Number.isFinite(p)&&Number.isFinite(c)&&Number.isFinite(d)){let g=c*c+d*d;if(g===0)return{success:!1};if(r){let C=r[0][0],T=r[0][1];m=(d*(d*C-c*T)-c*p)/g,f=(c*(-d*C+c*T)-d*p)/g,C=r[1][0],T=r[1][1],h=(d*(d*C-c*T)-c*p)/g,y=(c*(-d*C+c*T)-d*p)/g}else m=(2*d-c*p)/g,f=(-2*c-d*p)/g,h=(d-c*p)/g,y=-(c+d*p)/g;b["0,0"]=K.fromAst(m),b["0,1"]=K.fromAst(f),b["1,0"]=K.fromAst(h),b["1,1"]=K.fromAst(y)}else{let g=t.pow(2).add(e.pow(2));m=e.multiply(2).subtract(t.multiply(o)).divide(g),f=t.multiply(-2).subtract(e.multiply(o)).divide(g),h=e.subtract(t.multiply(o)).divide(g),y=t.add(e.multiply(o)).multiply(-1).divide(g),b["0,0"]=m,b["0,1"]=f,b["1,0"]=h,b["1,1"]=y}return{success:!0,points:b}}import nn from"math-expressions";var Ai=class extends se{static componentType="lineSegment";actions={moveLineSegment:this.moveLineSegment.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["endpoints"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.endpoints={createComponentOfType:"_pointListComponent"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){return e.endpointsAttr!==null?{newValues:{nDimensions:e.endpointsAttr.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.endpoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["endpointX","endpoint"],returnWrappingComponents(e){return e==="endpointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="endpointX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[2,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[a,i]=r.split(","),s=Number(a)+1+"_"+(Number(i)+1);n[r]={endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["pointX"+s]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,arraySize:r}){let a={},i={};for(let l of n){let[u,c]=l.split(","),d=Number(u)+1+"_"+(Number(c)+1);e[l].endpointsAttr!==null&&e[l].endpointsAttr.stateValues["pointX"+d]?a[l]=e[l].endpointsAttr.stateValues["pointX"+d]:l==="0,0"?i[l]={defaultValue:nn.fromAst(1)}:i[l]={defaultValue:nn.fromAst(0)}}let s={};return Object.keys(a).length>0&&(s.newValues={endpoints:a}),Object.keys(i).length>0&&(s.useEssentialOrDefaultValue={endpoints:i}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:a,stateValues:i}){if(a&&!i.draggable)return{success:!1};let s=[];for(let l in e.endpoints){let[u,c]=l.split(","),d=Number(u)+1+"_"+(Number(c)+1);n[l].endpointsAttr!==null&&n[l].endpointsAttr.stateValues["pointX"+d]?s.push({setDependency:r[l].endpointsAttr,desiredValue:e.endpoints[l],childIndex:0,variableIndex:0}):s.push({setStateVariable:"endpoints",value:{[l]:ne(e.endpoints[l])}})}return{success:!0,instructions:s}}},t.numericalEndpoints={isArray:!0,entryPrefixes:["numericalEndpoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return Number.isNaN(e.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:e}){let n={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},r={};for(let a of e)r[a]={endpoint:{dependencyType:"stateVariable",variableName:"endpoint"+(Number(a)+1)}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){if(Number.isNaN(e.nDimensions))return{};let a={};for(let i of r){let s=n[i].endpoint,l=[];for(let u=0;u<e.nDimensions;u++){let c=s[u].evaluate_to_constant();Number.isFinite(c)||(c=NaN),l.push(c)}a[i]=l}return{newValues:{numericalEndpoints:a}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},endpoints:{dependencyType:"stateVariable",variableName:"endpoints"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.endpoints[0][0].evaluate_to_constant(),a=e.endpoints[0][1].evaluate_to_constant(),i=e.endpoints[1][0].evaluate_to_constant(),s=e.endpoints[1][1].evaluate_to_constant();if(!(Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(i)&&Number.isFinite(s)))return{};let l=i-r,u=s-a,c=l*l+u*u;if(c===0)return{};let d=((n.x1-r)*l+(n.x2-a)*u)/c,p={};return d<=0?p={x1:r,x2:a}:d>=1?p={x1:i,x2:s}:p={x1:r+d*l,x2:a+d*u},n.x3!==void 0&&(p.x3=0),p}}})},t}moveLineSegment({point1coords:t,point2coords:e,transient:n}){let r={};t!==void 0&&(r["0,0"]=nn.fromAst(t[0]),r["0,1"]=nn.fromAst(t[1])),e!==void 0&&(r["1,0"]=nn.fromAst(e[0]),r["1,1"]=nn.fromAst(e[1])),n?this.coreFunctions.requestUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:r}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:r}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{point1:t,point2:e}}})}},mc=Ai;var Si=class extends Qt{static componentType="polygon";actions={movePolygon:this.movePolygon.bind(new Proxy(this,this.readOnlyProxyHandler))};get movePolygon(){return this.movePolyline}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},vertices:{dependencyType:"stateVariable",variableName:"vertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=Infinity,a={},i=n.x1.evaluate_to_constant(),s=n.x2.evaluate_to_constant(),l,u,c=e.vertices[e.nVertices-1][0].evaluate_to_constant(),d=e.vertices[e.nVertices-1][1].evaluate_to_constant();for(let p=0;p<e.nVertices;p++){if(l=c,u=d,c=e.vertices[p][0].evaluate_to_constant(),d=e.vertices[p][1].evaluate_to_constant(),!(Number.isFinite(l)&&Number.isFinite(u)&&Number.isFinite(c)&&Number.isFinite(d)))continue;let m=c-l,f=d-u,h=m*m+f*f;if(h===0)continue;let y=((i-l)*m+(s-u)*f)/h,b;y<=0?b={x1:l,x2:u}:y>=1?b={x1:c,x2:d}:b={x1:l+y*m,x2:u+y*f};let g=Math.pow(i-b.x1,2)+Math.pow(s-b.x2,2);g<r&&(r=g,a=b)}return n.x3!==void 0&&Object.keys(a).length>0&&(a.x3=0),a}}})},t}},rn=Si;import In from"math-expressions";var Ii=class extends rn{static componentType="triangle";static rendererType="polygon";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.vertices.returnArraySizeDependencies=()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),t.vertices.returnArraySize=function({dependencyValues:e}){return[3,e.nDimensions]},t.vertices.arrayDefinitionByKey=function({dependencyValuesByKey:e,arrayKeys:n}){let r={},a={};for(let i of n){let[s,l]=i.split(","),u=Number(s)+1+"_"+(Number(l)+1),c=e[i].vertices;if(c!==null&&c.stateValues["pointX"+u])r[i]=c.stateValues["pointX"+u];else{let d;s==="0"?l==="1"?d=In.fromAst(1):d=In.fromAst(0):s==="1"?l==="0"?d=In.fromAst(1):d=In.fromAst(0):d=In.fromAst(0),a[i]={variablesToCheck:["vertexX"+u],defaultValue:d}}}return{newValues:{vertices:r},useEssentialOrDefaultValue:{vertices:a}}},t.vertices.inverseArrayDefinitionByKey=function({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:a,stateValues:i}){if(a&&!i.draggable)return{success:!1};let s=[];for(let l in e.vertices){let[u,c]=l.split(","),d=Number(u)+1+"_"+(Number(c)+1);n[l].vertices!==null&&n[l].vertices.stateValues["pointX"+d]?s.push({setDependency:r[l].vertices,desiredValue:e.vertices[l],variableIndex:0}):s.push({setStateVariable:"vertices",value:{[l]:e.vertices[l].simplify()}})}return{success:!0,instructions:s}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{nVertices:3}})},t}},fc=Ii;import Le from"math-expressions";var Oi=class extends rn{static componentType="rectangle";static rendererType="polygon";static get stateVariablesShadowedForReference(){return["vertices","nVertices","nVerticesSpecified","haveSpecifiedCenter","specifiedWidth","specifiedHeight","specifiedCenter"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.vertices={createComponentOfType:"_pointListComponent"},e.center={createComponentOfType:"point"},e.width={createComponentOfType:"number"},e.height={createComponentOfType:"number"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVerticesSpecified={returnDependencies:()=>({verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return e.verticesAttr!==null?{newValues:{nVerticesSpecified:e.verticesAttr.stateValues.nPoints}}:{newValues:{nVerticesSpecified:0}}}},t.essentialVertex={isArray:!0,entryPrefixes:["essentialVertexX"],defaultEntryValue:Le.fromAst(0),returnArraySizeDependencies:()=>({nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}}),returnArraySize({dependencyValues:e}){return[e.nVerticesSpecified===0?2:0]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:e}){let n={};for(let r of e)n[r]={variablesToCheck:["essentialVertexX"+(Number(r)+1)]};return{useEssentialOrDefaultValue:{essentialVertex:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[];for(let r in e.essentialVertex)n.push({setStateVariable:"essentialVertex",value:{[r]:e.essentialVertex[r]}});return{success:!0,instructions:n}}},t.haveSpecifiedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:e})=>({newValues:{haveSpecifiedCenter:e.centerAttr!==null}})},t.specifiedCenter={isArray:!0,entryPrefixes:["specifiedCenterX"],returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:e}){return[e.haveSpecifiedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let a=Number(r)+1;n[r]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+a]}}}return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=Number(a)+1;e[a].centerAttr!==null&&(r[a]=e[a].centerAttr.stateValues["x"+i])}return{newValues:{specifiedCenter:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r}){let a=[];for(let i in e.specifiedCenter)n[i].centerAttr&&n[i].centerAttr!==null&&a.push({setDependency:r[i].centerAttr,desiredValue:e.specifiedCenter[i],variableIndex:0});return{success:!0,instructions:a}}},t.specifiedWidth={defaultValue:1,returnDependencies(){return{widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}},definition({dependencyValues:e}){return e.widthAttr!==null?{newValues:{specifiedWidth:e.widthAttr.stateValues.value}}:(e.haveSpecifiedCenter?1:0)+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedWidth:{variablesToCheck:["specifiedWidth"]}}}:{newValues:{specifiedWidth:null}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.widthAttr!==null?{success:!0,instructions:[{setDependency:"widthAttr",desiredValue:e.specifiedWidth,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"specifiedWidth",value:e.specifiedWidth}]}}},t.specifiedHeight={defaultValue:1,returnDependencies(){return{heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}},definition({dependencyValues:e}){return e.heightAttr!==null?{newValues:{specifiedHeight:e.heightAttr.stateValues.value}}:(e.haveSpecifiedCenter?1:0)+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedHeight:{variablesToCheck:["specifiedHeight"]}}}:{newValues:{specifiedHeight:null}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.heightAttr!==null?{success:!0,instructions:[{setDependency:"heightAttr",desiredValue:e.specifiedHeight,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"specifiedHeight",value:e.specifiedHeight}]}}},t.center={public:!0,isArray:!0,entryPrefixes:["centerX"],componentType:"math",returnWrappingComponents(e){return e==="centerX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let a=Number(r)+1;n[r]={vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_"+a},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_"+a}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].vertex0,s=e[a].vertex2;r[a]=i.add(s).divide(2).simplify()}return{newValues:{center:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,stateValues:a}){let i=[];for(let s in e.center){let l=Number(s),u=n[s].vertex0,c=n[s].vertex2,d=e.center[l].subtract(a.center[l]),p=u.add(d).simplify(),m=c.add(d).simplify();i.push({setDependency:r[s].vertex0,desiredValue:p},{setDependency:r[s].vertex2,desiredValue:m})}return{success:!0,instructions:i}}},t.width={public:!0,componentType:"number",returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_1"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_1"}}},definition({dependencyValues:e}){let n=e.vertex0.evaluate_to_constant(),r=e.vertex2.evaluate_to_constant();return{newValues:{width:Math.abs(n-r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n,stateValues:r}){let a=n.vertex0.evaluate_to_constant(),i=n.vertex2.evaluate_to_constant(),s=(i+a)/2,u=(i-a<0?-1:1)*Math.max(0,e.width)/2,c=Le.fromAst(s-u),d=Le.fromAst(s+u);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:c},{setDependency:"vertex2",desiredValue:d}]}}},t.height={public:!0,componentType:"number",returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_2"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_2"}}},definition({dependencyValues:e}){let n=e.vertex0.evaluate_to_constant(),r=e.vertex2.evaluate_to_constant();return{newValues:{height:Math.abs(n-r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){let r=n.vertex0.evaluate_to_constant(),a=n.vertex2.evaluate_to_constant(),i=(a+r)/2,l=(a-r<0?-1:1)*Math.max(0,e.height)/2,u=Le.fromAst(i-l),c=Le.fromAst(i+l);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:u},{setDependency:"vertex2",desiredValue:c}]}}},t.vertices={public:!0,componentType:"point",isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],returnWrappingComponents(e){return e==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="vertexX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},stateVariablesDeterminingDependencies:["nVerticesSpecified","haveSpecifiedCenter"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[4,2]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},a={nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}};if(n.nVerticesSpecified===0)if(a.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},n.haveSpecifiedCenter)for(let i of e){let[s,l]=i.split(",");r[i]={specifiedCenter:{dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(l)+1)}},l==="0"?r[i].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}:r[i].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"}}else for(let i of e){let[s,l]=i.split(",");r[i]={essentialVertex:{dependencyType:"stateVariable",variableName:"essentialVertexX"+(Number(l)+1)}},l==="0"?(s==="1"||s==="2")&&(r[i].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(s==="2"||s==="3")&&(r[i].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else if(n.nVerticesSpecified===1)if(a.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},n.haveSpecifiedCenter)for(let i of e){let[s,l]=i.split(","),u="1_"+(Number(l)+1);r[i]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+u]}},(l==="0"&&s==="1"||s==="2"||l==="1"&&s==="2"||s==="3")&&(r[i].specifiedCenter={dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(l)+1)})}else for(let i of e){let[s,l]=i.split(","),u="1_"+(Number(l)+1);r[i]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+u]}},l==="0"?(s==="1"||s==="2")&&(r[i].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(s==="2"||s==="3")&&(r[i].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else for(let i of e){let[s,l]=i.split(","),u="1_"+(Number(l)+1),c="2_"+(Number(l)+1),d;s==="0"?d=u:s==="2"?d=c:s==="1"?l==="0"?d=c:d=u:l==="0"?d=u:d=c,r[i]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+d]}}}return{dependenciesByKey:r,globalDependencies:a}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,globalDependencyValues:r}){let a={};if(r.nVerticesSpecified===0)if(r.haveSpecifiedCenter)for(let i of n){let[s,l]=i.split(","),u=e[i].specifiedCenter;if(l==="0"){let c=e[i].specifiedWidth;s==="0"||s==="3"?a[i]=u.subtract(c/2):a[i]=u.add(c/2)}else{let c=e[i].specifiedHeight;s==="0"||s==="1"?a[i]=u.subtract(c/2):a[i]=u.add(c/2)}}else for(let i of n){let[s,l]=i.split(","),u=e[i].essentialVertex;if(l==="0")if(s==="0"||s==="3")a[i]=u;else{let c=e[i].specifiedWidth;a[i]=u.add(c)}else if(s==="0"||s==="1")a[i]=u;else{let c=e[i].specifiedHeight;a[i]=u.add(c)}}else if(r.nVerticesSpecified===1)if(r.haveSpecifiedCenter)for(let i of n){let[s,l]=i.split(","),u=e[i].verticesAttr,c;if(u!==null&&Object.keys(u.stateValues).length===1?c=Object.values(u.stateValues)[0]:c=Le.fromAst("\uFF3F"),l==="0"&&(s==="0"||s==="3")||l==="1"&&(s==="0"||s==="1"))a[i]=c;else{let d=e[i].specifiedCenter;a[i]=c.add(d.subtract(c).multiply(2))}}else for(let i of n){let[s,l]=i.split(","),u=e[i].verticesAttr,c;if(u!==null&&Object.keys(u.stateValues).length===1?c=Object.values(u.stateValues)[0]:c=Le.fromAst("\uFF3F"),l==="0")if(s==="0"||s==="3")a[i]=c;else{let d=e[i].specifiedWidth;a[i]=c.add(d)}else if(s==="0"||s==="1")a[i]=c;else{let d=e[i].specifiedHeight;a[i]=c.add(d)}}else for(let i of n){let s=e[i].verticesAttr;s!==null&&Object.keys(s.stateValues).length===1?a[i]=Object.values(s.stateValues)[0]:a[i]=Le.fromAst("\uFF3F")}return{newValues:{vertices:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,globalDependencyValues:r,stateValues:a,workspace:i,initialChange:s,dependencyNamesByKey:l}){if(s&&!a.draggable)return{success:!1};i.v0||(i.v0=[...a.vertices[0]],i.v2=[...a.vertices[2]]);let u,c,d,p,m,f;for(let y in e.vertices){let[b,g]=y.split(","),C=e.vertices[y];b==="0"?i.v0[Number(g)]=C:b==="2"?i.v2[Number(g)]=C:b==="1"?g==="0"?i.v2[Number(g)]=C:i.v0[Number(g)]=C:g==="0"?i.v0[Number(g)]=C:i.v2[Number(g)]=C,g==="0"?(u=y,b==="0"||b==="3"?d=y:m=y):(c=y,b==="0"||b==="1"?p=y:f=y)}let h=[];if(r.nVerticesSpecified===0)if(r.haveSpecifiedCenter){if(u!==void 0){let y=i.v2[0].subtract(i.v0[0]).evaluate_to_constant(),b=i.v2[0].add(i.v0[0]).divide(2).simplify();h.push({setDependency:l[u].specifiedWidth,desiredValue:y},{setDependency:l[u].specifiedCenter,desiredValue:b})}if(c!==void 0){let y=i.v2[1].subtract(i.v0[1]).evaluate_to_constant(),b=i.v2[1].add(i.v0[1]).divide(2).simplify();h.push({setDependency:l[c].specifiedHeight,desiredValue:y},{setDependency:l[c].specifiedCenter,desiredValue:b})}}else{if(d!==void 0){let y=i.v0[0].simplify();h.push({setDependency:l[d].essentialVertex,desiredValue:y})}if(m!==void 0){let y=i.v2[0].subtract(i.v0[0]).evaluate_to_constant();h.push({setDependency:l[m].specifiedWidth,desiredValue:y})}if(p!==void 0){let y=i.v0[1].simplify();h.push({setDependency:l[p].essentialVertex,desiredValue:y})}if(f!==void 0){let y=i.v2[1].subtract(i.v0[1]).evaluate_to_constant();h.push({setDependency:l[f].specifiedHeight,desiredValue:y})}}else if(r.nVerticesSpecified===1)if(r.haveSpecifiedCenter){if(d!==void 0){let y=i.v0[0].simplify();h.push({setDependency:l[d].verticesAttr,desiredValue:y,variableIndex:0})}if(m!==void 0){let y=i.v2[0].add(i.v0[0]).divide(2).simplify();h.push({setDependency:l[m].specifiedCenter,desiredValue:y})}if(p!==void 0){let y=i.v0[1].simplify();h.push({setDependency:l[p].verticesAttr,desiredValue:y,variableIndex:0})}if(f!==void 0){let y=i.v2[1].add(i.v0[1]).divide(2).simplify();h.push({setDependency:l[f].specifiedCenter,desiredValue:y})}}else{if(d!==void 0){let y=i.v0[0].simplify();h.push({setDependency:l[d].verticesAttr,desiredValue:y,variableIndex:0})}if(m!==void 0){let y=i.v2[0].subtract(i.v0[0]).evaluate_to_constant();h.push({setDependency:l[m].specifiedWidth,desiredValue:y})}if(p!==void 0){let y=i.v0[1].simplify();h.push({setDependency:l[p].verticesAttr,desiredValue:y,variableIndex:0})}if(f!==void 0){let y=i.v2[1].subtract(i.v0[1]).evaluate_to_constant();h.push({setDependency:l[f].specifiedHeight,desiredValue:y})}}else d!==void 0&&h.push({setDependency:l[d].verticesAttr,desiredValue:i.v0[0],variableIndex:0}),m!==void 0&&h.push({setDependency:l[m].verticesAttr,desiredValue:i.v2[0],variableIndex:0}),p!==void 0&&h.push({setDependency:l[p].verticesAttr,desiredValue:i.v0[1],variableIndex:0}),f!==void 0&&h.push({setDependency:l[f].verticesAttr,desiredValue:i.v2[1],variableIndex:0});return{success:!0,instructions:h}}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{nVertices:4}})},t}movePolygon(t){let e=[],n={};for(let r in t)n[r+",0"]=Le.fromAst(t[r][0]),n[r+",1"]=Le.fromAst(t[r][1]);if(e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:n}),Object.keys(t).length===1){let r=Number(Object.keys(t)[0]),a=Le.fromAst(t[r][0]),i=Le.fromAst(t[r][1]),s=(r+2)%4,l=this.stateValues.vertices[s][0],u=this.stateValues.vertices[s][1];if(this.stateValues.nVerticesSpecified<2)if(this.stateValues.haveSpecifiedCenter){let c,d;r===0?(c=a.add(l).divide(2),d=i.add(u).divide(2)):r===1?d=i.add(u).divide(2):r===3&&(c=a.add(l).divide(2)),c!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{0:c.simplify()}}),d!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{1:d.simplify()}})}else{let c,d;r===0?(c=l.subtract(a),d=u.subtract(i)):r===1?d=u.subtract(i):r===3&&(c=l.subtract(a)),c!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedWidth",value:c.simplify()}),d!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedHeight",value:d.simplify()})}}this.coreFunctions.requestUpdate({updateInstructions:e})}},hc=Oi;import ge from"math-expressions";var ki=class extends se{static componentType="curve";static rendererType="curve";actions={moveControlVector:this.moveControlVector.bind(new Proxy(this,this.readOnlyProxyHandler)),moveThroughPoint:this.moveThroughPoint.bind(new Proxy(this,this.readOnlyProxyHandler)),changeVectorControlDirection:this.changeVectorControlDirection.bind(new Proxy(this,this.readOnlyProxyHandler))};static primaryStateVariableForDefinition="fShadow";static get stateVariablesShadowedForReference(){return["variableForChild","parMin","parMax","curveType","nThroughPoints","nDimensions","throughPoints"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.label.propagateToDescendants=!0,e.showLabel.propagateToDescendants=!0,e.layer.propagateToDescendants=!0,e.flipFunction={createComponentOfType:"boolean",createStateVariable:"flipFunction",defaultValue:!1,public:!0,forRenderer:!0},e.nDiscretizationPoints={createComponentOfType:"number",createStateVariable:"nDiscretizationPoints",defaultValue:100,public:!0},e.periodic={createComponentOfType:"boolean",createStateVariable:"periodic",defaultValue:!1,public:!0},e.splineTension={createComponentOfType:"number",createStateVariable:"splineTension",defaultValue:.8,clamp:[0,1],public:!0},e.extrapolateBackward={createComponentOfType:"boolean",createStateVariable:"extrapolateBackward",defaultValue:!1,public:!0,forRenderer:!0},e.extrapolateForward={createComponentOfType:"boolean",createStateVariable:"extrapolateForward",defaultValue:!1,public:!0,forRenderer:!0},e.splineForm={createComponentOfType:"text",createStateVariable:"splineForm",defaultValue:"centripetal",public:!0,toLowerCase:!0,validValues:["centripetal","uniform"]},e.variable={createComponentOfType:"variable",createStateVariable:"variableForChild",defaultValue:ge.fromAst("x")},e.through={createComponentOfType:"_pointListComponent"},e.parMin={createComponentOfType:"math"},e.parMax={createComponentOfType:"math"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let i=ht({childrenToComponentFunction:s=>({componentType:"function",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return i.success?i:{success:!0,newChildren:[{componentType:"function",children:n}]}};return t.push({childrenRegex:/s/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroFunctions",componentType:"function",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atMostOneBezierControls",componentType:"bezierControls",comparison:"atMost",number:1});return e.newOperator({name:"functionsXorControl",operator:"xor",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:n}){let r="";return n.selectedStyle.lineWidth>=4?r+="thick ":n.selectedStyle.lineWidth<=1&&(r+="thin "),n.selectedStyle.lineStyle==="dashed"?r+="dashed ":n.selectedStyle.lineStyle==="dotted"&&(r+="dotted "),r+=n.selectedStyle.lineColor,{newValues:{styleDescription:r}}}},e.curveType={forRenderer:!0,returnDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},through:{dependencyType:"attributeComponent",attributeName:"through"}}),definition({dependencyValues:n}){let r="function";return n.through!==null?r="bezier":n.functionChildren.length>1&&(r="parameterization"),{newValues:{curveType:r}}}},e.fShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fShadow:{variablesToCheck:["fShadow"]}}})},e.parMax={public:!0,componentType:"number",forRenderer:!0,defaultValue:10,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMaxAttr:{dependencyType:"attributeComponent",attributeName:"parMax",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"}}),definition:function({dependencyValues:n}){let r;if(n.curveType==="bezier")r=n.nThroughPoints-1,n.extrapolateForward&&(r*=2);else if(n.parMaxAttr!==null)r=n.parMaxAttr.stateValues.value.evaluate_to_constant(),Number.isFinite(r)||(r=NaN);else return{useEssentialOrDefaultValue:{parMax:{variablesToCheck:["parMax"]}}};return{newValues:{parMax:r}}}},e.parMin={forRenderer:!0,public:!0,componentType:"number",defaultValue:-10,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMinAttr:{dependencyType:"attributeComponent",attributeName:"parMin",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"}}),definition:function({dependencyValues:n}){let r;if(n.curveType==="bezier")r=0,n.extrapolateBackward&&(r=-(n.nThroughPoints-1));else if(n.parMinAttr!==null)r=n.parMinAttr.stateValues.value.evaluate_to_constant(),Number.isFinite(r)||(r=NaN);else return{useEssentialOrDefaultValue:{parMin:{variablesToCheck:["parMin"]}}};return{newValues:{parMin:r}}}},e.nThroughPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:n}){let r=0;return n.through!==null&&(r=n.through.stateValues.nPoints),{newValues:{nThroughPoints:r}}}},e.nDimensions={public:!0,componentType:"number",returnDependencies(){return{through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}},definition:function({dependencyValues:n}){return n.through!==null?{newValues:{nDimensions:n.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},e.throughPoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(n){return n==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a,desiredEntrySize:i}){if(n==="throughPointX"){let s=r.split("_").map(l=>Number(l)-1);return s.length===2&&s.every((l,u)=>Number.isInteger(l)&&l>=0)?i?s.every((l,u)=>i[u]>0)?[String(s)]:[]:a?s.every((l,u)=>l<a[u])?[String(s)]:[]:[String(s)]:[]}else{let s=Number(r)-1;return i?i[0]>0&&Number.isInteger(s)&&s>=0?Array.from(Array(a[1]),(l,u)=>s+","+u):[]:a?Number.isInteger(s)&&s>=0&&s<a[0]?Array.from(Array(a[1]),(l,u)=>s+","+u):[]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n){let[i,s]=a.split(","),l=Number(i)+1+"_"+(Number(s)+1);r[a]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+l]}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let[s,l]=i.split(","),u=Number(s)+1+"_"+(Number(l)+1),c=n[i].through;c!==null&&c.stateValues["pointX"+u]?a[i]=c.stateValues["pointX"+u]:a[i]=ge.fromAst(0)}return{newValues:{throughPoints:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,initialChange:i,stateValues:s}){if(i&&!s.draggable)return{success:!1};let l=[];for(let u in n.throughPoints){let[c,d]=u.split(","),p=Number(c)+1+"_"+(Number(d)+1);if(r[u].through!==null&&r[u].through.stateValues["pointX"+p])l.push({setDependency:a[u].through,desiredValue:n.throughPoints[u],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:l}}},e.numericalThroughPoints={isArray:!0,entryPrefixes:["numericalThroughPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n)r[a]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(a)+1)}};return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].throughPoint.map(l=>l.evaluate_to_constant());s.every(l=>Number.isFinite(l))||(s=Array(s.length).fill(NaN)),a[i]=s}return{newValues:{numericalThroughPoints:a}}}},e.haveBezierControls={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls"}}),definition({dependencyValues:n}){return{newValues:{haveBezierControls:n.controlChild.length===1}}}},e.vectorControlDirections={public:!0,componentType:"text",isArray:!0,entryPrefixes:["vectorControlDirection"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n)r[i]={controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls",variableNames:["direction"+(Number(i)+1)]}};return{dependenciesByKey:r,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].controlChild;s&&s.length===1?a[i]=s[0].stateValues["direction"+(Number(i)+1)]:a[i]="none"}return{newValues:{vectorControlDirections:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:a,globalDependencyValues:i}){if(!i.haveBezierControls)return{success:!1};let s=[],l={};for(let u in n.vectorControlDirections){let c=a[u].controlChild;c&&c.length===1?s.push({setDependency:r[u].controlChild,desiredValue:n.vectorControlDirections[u],childIndex:0,variableIndex:0}):l[u]=n.vectorControlDirections[u]}return Object.keys(l).length>0&&s.push({setStateVariable:"vectorControlDirections",value:l}),{success:!0,instructions:s}}},e.controlVectors={isArray:!0,public:!0,componentType:"math",entryPrefixes:["controlVectorX","controlVector"],nDimensions:3,stateVariablesDeterminingDependencies:["vectorControlDirections","nThroughPoints"],returnWrappingComponents(n){return n==="controlVectorX"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a,desiredEntrySize:i}){if(n==="controlVectorX"){let s=r.split("_").map(l=>Number(l)-1);return s.length===3&&s.every((l,u)=>Number.isInteger(l)&&l>=0)?i?s.every((l,u)=>i[u]>0)?[String(s)]:[]:a?s.every((l,u)=>l<a[u])?[String(s)]:[]:[String(s)]:[]}else{let s=r.split("_").map(l=>Number(l)-1);return i?i[0]>0&&s.length===2&&s.every((l,u)=>Number.isInteger(l)&&l>=0)?Array.from(Array(a[2]),(l,u)=>String(s)+","+u):[]:a?s.length===2&&s.every((l,u)=>Number.isInteger(l)&&l>=0&&l<a[u])?Array.from(Array(a[2]),(l,u)=>String(s)+","+u):[]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n,stateValues:r}){let a={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},splineTension:{dependencyType:"stateVariable",variableName:"splineTension"},splineForm:{dependencyType:"stateVariable",variableName:"splineForm"}},i={};for(let s of n){let l=s.split(",").map(f=>Number(f)),u=l.map(f=>f+1),c=u.join("_");i[s]={direction:{dependencyType:"stateVariable",variableName:"vectorControlDirection"+u[0]},controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls",variableNames:["control"+c]}};let d=l[0],p=r.vectorControlDirections[d],m=[];p==="none"?m=[d-1,d,d+1]:p==="previous"?m=[d,d+1]:p==="next"&&(m=[d-1,d]);for(let f of m)f>=0&&f<r.nThroughPoints&&(i[s]["throughPoint"+(f+1)]={dependencyType:"stateVariable",variableName:"throughPoint"+(f+1)})}return{globalDependencies:a,dependenciesByKey:i}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a){if(n.nDimensions!==2){i[s]=ge.fromAst(NaN);continue}if(s in i)continue;let l=s.split(",").map(f=>Number(f)),c=l.map(f=>f+1).join("_"),d=l[0],p=l[1],m=r[s].direction;if(m||(m="none"),m==="none"){let f=r[s]["throughPoint"+(d+1)],h,y;d>0&&(h=r[s]["throughPoint"+d]),d<n.nThroughPoints&&(y=r[s]["throughPoint"+(d+2)]);let{coordsNumeric:b,numericEntries:g}=bc({tau:n.splineTension,eps:t.eps,splineForm:n.splineForm,point1:h,point2:f,point3:y});for(let C=0;C<2;C++){let T=d+","+p+","+C,v=d+","+(1-p)+","+C;p===0?(i[T]=b[C],i[v]=ge.fromAst(-b[C].tree)):(i[T]=ge.fromAst(-b[C].tree),i[v]=b[C])}}else{let f=!1,h=r[s].controlChild;if(h.length===1){let y=h[0].stateValues["control"+c];y&&(f=!0,i[s]=y)}if(!f){let y=r[s]["throughPoint"+d],b=r[s]["throughPoint"+(d+1)],g=r[s]["throughPoint"+(d+2)],{coordsNumeric:C,numericEntries:T}=bc({tau:n.splineTension,eps:t.eps,splineForm:n.splineForm,point1:y||g,point2:b,point3:void 0});for(let v=0;v<2;v++){let N=d+","+p+","+v;i[N]=C[v]}}}}return{newValues:{controlVectors:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:a,globalDependencyValues:i}){if(!i.haveBezierControls||i.nDimensions!==2)return{success:!1};let s=[];for(let l in n.controlVectors){let d=l.split(",").map(m=>Number(m)).map(m=>m+1).join("_"),p=a[l].controlChild;p.length===1&&p[0].stateValues["control"+d]&&s.push({setDependency:r[l].controlChild,desiredValue:n.controlVectors[l],childIndex:0,variableIndex:0})}return{success:!0,instructions:s}}},e.numericalControlVectors={isArray:!0,entryPrefixes:["numericalControlVector"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n){let l=a.split(",").map(u=>Number(u)).map(u=>u+1).join("_");r[a]={controlVector:{dependencyType:"stateVariable",variableName:"controlVector"+l}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].controlVector.map(l=>l.tree);a[i]=s}return{newValues:{numericalControlVectors:a}}}},e.controlPoints={isArray:!0,public:!0,componentType:"math",entryPrefixes:["controlPointX","controlPoint"],nDimensions:3,returnWrappingComponents(n){return n==="controlPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:a,desiredEntrySize:i}){if(n==="controlPointX"){let s=r.split("_").map(l=>Number(l)-1);return s.length===3&&s.every((l,u)=>Number.isInteger(l)&&l>=0)?i?s.every((l,u)=>i[u]>0)?[String(s)]:[]:a?s.every((l,u)=>l<a[u])?[String(s)]:[]:[String(s)]:[]}else{let s=r.split("_").map(l=>Number(l)-1);return i?i[0]>0&&s.length===2&&s.every((l,u)=>Number.isInteger(l)&&l>=0)?Array.from(Array(a[2]),(l,u)=>String(s)+","+u):[]:a?s.length===2&&s.every((l,u)=>Number.isInteger(l)&&l>=0&&l<a[u])?Array.from(Array(a[2]),(l,u)=>String(s)+","+u):[]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n}){let r={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},a={};for(let i of n){let l=i.split(",").map(c=>Number(c)).map(c=>c+1),u=l.join("_");a[i]={throughPointX:{dependencyType:"stateVariable",variableName:"throughPointX"+l[0]+"_"+l[2]},controlVectorX:{dependencyType:"stateVariable",variableName:"controlVectorX"+u}}}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a)if(n.nDimensions!==2)i[s]=ge.fromAst(NaN);else{let l=r[s].controlVectorX;if(l){let u=r[s].throughPointX.evaluate_to_constant();Number.isFinite(u)||(u=NaN),i[s]=ge.fromAst(u+l.tree)}else i[s]=null}return{newValues:{controlPoints:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:a,globalDependencyValues:i}){if(!i.haveBezierControls||i.nDimensions!==2)return{success:!1};let s=[];for(let l in n.controlPoints)if(a[l].controlVectorX){let c=a[l].throughPointX,d=n.controlPoints[l];d.tree&&(d=d.tree);let p=ge.fromAst(["+",d,["-",c.tree]]);s.push({setDependency:r[l].controlVectorX,desiredValue:p})}return{success:!0,instructions:s}}},e.numericalControlPoints={isArray:!0,entryPrefixes:["numericalControlPoint"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n){let l=a.split(",").map(u=>Number(u)).map(u=>u+1).join("_");r[a]={controlPoint:{dependencyType:"stateVariable",variableName:"controlPoint"+l}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].controlPoint.map(l=>l.tree);a[i]=s}return{newValues:{numericalControlPoints:a}}}},e.splineCoeffs={isArray:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints-1]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n){let i=Number(a)+1,s=i+1;r[a]={previousPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+i},nextPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+s},previousVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+i+"_2"},nextVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+s+"_1"}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){let s=n[i].previousPoint,l=n[i].nextPoint,u=n[i].previousVector,c=n[i].nextVector,d=[];for(let p=0;p<2;p++)d.push(vh(s[p],l[p],3*u[p],-3*c[p]));a[i]=d}return{newValues:{splineCoeffs:a}}}},e.extrapolateBackwardCoeffs={returnDependencies:()=>({extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},throughPoint1:{dependencyType:"stateVariable",variableName:"numericalThroughPoint1"},throughPoint2:{dependencyType:"stateVariable",variableName:"numericalThroughPoint2"},controlVector:{dependencyType:"stateVariable",variableName:"numericalControlVector1_1"}}),definition({dependencyValues:n}){if(!n.extrapolateBackward)return{newValues:{extrapolateBackwardCoeffs:null}};let r=n.throughPoint1,a=n.throughPoint2,i=n.controlVector;if(!(r&&a&&i))return{newValues:{extrapolateBackwardCoeffs:null}};let s=[];s[0]=[r[0],-3*i[0]*4,0];let l=(a[0]-r[0]-3*i[0])*-16;return l!==0&&i[0]/l>0&&(s[0][2]=l),s[1]=[r[1],-3*i[1]*4,0],l=(a[1]-r[1]-3*i[1])*-16,l!==0&&i[1]/l>0&&(s[1][2]=l),{newValues:{extrapolateBackwardCoeffs:s}}}},e.extrapolateForwardCoeffs={stateVariablesDeterminingDependencies:["nThroughPoints"],returnDependencies({stateValues:n}){let r={extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"}};return n.nThroughPoints>=2&&(r.throughPoint1={dependencyType:"stateVariable",variableName:"numericalThroughPoint"+(n.nThroughPoints-1)},r.throughPoint2={dependencyType:"stateVariable",variableName:"numericalThroughPoint"+n.nThroughPoints},r.controlVector={dependencyType:"stateVariable",variableName:"numericalControlVector"+n.nThroughPoints+"_2"}),r},definition({dependencyValues:n}){if(!n.extrapolateForward)return{newValues:{extrapolateForwardCoeffs:null}};let r=n.throughPoint1,a=n.throughPoint2,i=n.controlVector;if(!(r&&a&&i))return{newValues:{extrapolateForwardCoeffs:null}};let s=[];s[0]=[a[0],3*i[0]*4,0];let l=(r[0]-a[0]-3*i[0])*-16;return l!==0&&i[0]/l>0&&(s[0][2]=l),s[1]=[a[1],3*i[1]*4,0],l=(r[1]-a[1]-3*i[1])*-16,l!==0&&i[1]/l>0&&(s[1][2]=l),{newValues:{extrapolateForwardCoeffs:s}}}},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),returnArraySize({dependencyValues:n}){return n.curveType==="bezier"?[2]:[Math.max(1,n.functionChildren.length)]},returnArrayDependenciesByKey({arrayKeys:n}){let r={curveType:{dependencyType:"stateVariable",variableName:"curveType"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},extrapolateBackwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateBackwardCoeffs"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},extrapolateForwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateForwardCoeffs"}},a={};for(let i of n)a[i]={functionChild:{dependencyType:"child",childLogicName:"atLeastZeroFunctions",variableNames:["numericalf"],childIndices:[i]}},Number(i)===0&&(a[i].fShadow={dependencyType:"stateVariable",variableName:"fShadow"});return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:a}){if(n.curveType==="bezier")return{newValues:{fs:Ch({globalDependencyValues:n,arrayKeys:a})}};let i={},s={};for(let l of a){let u=r[l].functionChild;u.length===1?i[l]=u[0].stateValues.numericalf:Number(l)===0&&r[l].fShadow?i[l]=r[l].fShadow:s[l]={variablesToCheck:[{variableName:"fs",arrayIndex:l}]}}return{newValues:{fs:i},useEssentialOrDefaultValue:{fs:s}}}},e.f={isAlias:!0,targetVariableName:"f1"},e.nearestPoint={returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},fs:{dependencyType:"stateVariable",variableName:"fs"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"},parMin:{dependencyType:"stateVariable",variableName:"parMin"},parMax:{dependencyType:"stateVariable",variableName:"parMax"},periodic:{dependencyType:"stateVariable",variableName:"periodic"}}),definition({dependencyValues:n}){let r=null;return n.curveType==="function"?r=yh({dependencyValues:n,numerics:t}):["parameterization","bezier"].includes(n.curveType)&&(r=gh({dependencyValues:n,numerics:t})),{newValues:{nearestPoint:r}}}},e}moveControlVector({controlVector:t,controlVectorInds:e,transient:n}){let r={[e+",0"]:ge.fromAst(t[0]),[e+",1"]:ge.fromAst(t[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:r,sourceInformation:{controlVectorMoved:e}}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:r,sourceInformation:{controlVectorMoved:e}}],event:{verb:"interacted",object:{componentId:this.componentName},result:{["controlVector"+e.join("_")]:t}}})}moveThroughPoint({throughPoint:t,throughPointInd:e,transient:n}){let r={[e+",0"]:ge.fromAst(t[0]),[e+",1"]:ge.fromAst(t[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:r,sourceInformation:{throughPointMoved:e}}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:r,sourceInformation:{throughPointMoved:e}}],event:{verb:"interacted",object:{componentId:this.componentName},result:{["throughPoint"+e]:t}}})}changeVectorControlDirection({direction:t,throughPointInd:e}){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vectorControlDirection",value:{[e]:t}}]})}},an=ki;function yh({dependencyValues:o,numerics:t}){let e=o.flipFunction,n=o.fs[0],r=o.nDiscretizationPoints;return function(a){let i,s;e?(s=a.x2.evaluate_to_constant(),i=n(s)):(i=a.x1.evaluate_to_constant(),s=n(i));let l=a.x1.evaluate_to_constant(),u=a.x2.evaluate_to_constant();if(!(Number.isFinite(l)&&Number.isFinite(u)))return Number.isFinite(i)&&Number.isFinite(s)?(C={x1:i,x2:x2Asx1AsFunction},a.x3!==void 0&&(C.x3=0),C):{};let c=function(N){let V=-10*Math.log(1/N-1),x=l,w=u;return e?(x-=n(V),w-=V):(x-=V,w-=n(V)),x*x+w*w},d=0,p=1,m=r,f=(p-d)/m,h=d,y=c(d),b=d,g=d+f;for(let N=1;N<=m;N++){let V=d+N*f,x=c(V);(x<y||Number.isNaN(y))&&(h=V,y=x,b=V-f,N===m?g=V:g=V+f)}let C=t.fminbr(c,[b,g]);h=C.x;let T=-10*Math.log(1/h-1),v=n(T);if(e&&([T,v]=[v,T]),Number.isFinite(i)&&Number.isFinite(s)){let N=Math.pow(i-l,2)+Math.pow(s-u,2),V=Math.pow(T-l,2)+Math.pow(v-u,2);if(N<100*V)return C={x1:i,x2:s},a.x3!==void 0&&(C.x3=0),C}return C={x1:T,x2:v},a.x3!==void 0&&(C.x3=0),C}}function gh({dependencyValues:o,numerics:t}){let e=o.fs,n=o.parMin,r=o.parMax,a=o.nDiscretizationPoints,i=o.periodic;return function(s){if(o.fs.length!==2)return{};let l=s.x1.evaluate_to_constant(),u=s.x2.evaluate_to_constant();if(!(Number.isFinite(l)&&Number.isFinite(u)))return{};let c=function(N){let V=l-e[0](N),x=u-e[1](N);return V*V+x*x},d=n,p=r,m=a,f=(p-d)/m,h=d,y=c(d),b=d,g=d+f;for(let N=1;N<=m;N++){let V=d+N*f,x=c(V);(x<y||Number.isNaN(y))&&(h=V,y=x,b=V-f,N===m?g=V:g=V+f)}i&&(Math.abs(h-d)<t.eps?b=d-f:Math.abs(h-p)<t.eps&&(g=p+f));let C=t.fminbr(c,[b,g]);h=C.x;let T=e[0](h),v=e[1](h);return C={x1:T,x2:v},s.x3!==void 0&&(C.x3=0),C}}function bc({tau:o,eps:t,point1:e,point2:n,point3:r,splineForm:a}){let i=function(m,f){let h=m[0]-f[0],y=m[1]-f[1];return Math.sqrt(h*h+y*y)},s,l,u;if(n)l=n.map(m=>m.evaluate_to_constant());else return{coordsNumeric:[ge.fromAst(NaN),ge.fromAst(NaN)],numericEntries:!1};if(r)u=r.map(m=>m.evaluate_to_constant()),e?s=e.map(m=>m.evaluate_to_constant()):s=[2*l[0]-u[0],2*l[1]-u[1]];else if(e)s=e.map(m=>m.evaluate_to_constant()),u=[2*l[0]-s[0],2*l[1]-s[1]];else return{coordsNumeric:[ge.fromAst(NaN),ge.fromAst(NaN)],numericEntries:!1};let c=[];if(a==="centripetal"){let m=i(s,l),f=i(l,u);m=Math.sqrt(m),f=Math.sqrt(f),f<t&&(f=1),m<t&&(m=f);for(let h=0;h<2;h++){let y=(l[h]-s[h])/m-(u[h]-s[h])/(f+m)+(u[h]-l[h])/f;y*=o*Math.sqrt(m*f),c.push(-y/3)}}else for(let m=0;m<2;m++)c.push(-o*(u[m]-s[m])/3);let d=c.map(m=>ge.fromAst(m)),p=Number.isFinite(c[0])&&Number.isFinite(c[1]);return{coordsNumeric:d,numericEntries:p}}function vh(o,t,e,n){return[o,e,-3*o+3*t-2*e-n,2*o-2*t+e+n]}function Ch({globalDependencyValues:o,arrayKeys:t}){if(o.nThroughPoints<1){let i={};for(let s of t)i[s]=()=>NaN;return i}let e=o.nThroughPoints-1,n={},r=o.extrapolateBackward,a=o.extrapolateForward;for(let i of t){let s=o.numericalThroughPoints[0][i],l=o.numericalThroughPoints[e][i],u=o.splineCoeffs.map(p=>p[i]),c;r&&(c=o.extrapolateBackwardCoeffs[i]);let d;a&&(d=o.extrapolateForwardCoeffs[i]),n[i]=function(p){if(isNaN(p))return NaN;if(p<0)return r?(c[2]*p+c[1])*p+c[0]:s;if(p>=e)return a?(p-=e,(d[2]*p+d[1])*p+d[0]):l;let m=Math.floor(p);p-=m;let f=u[m];return((f[3]*p+f[2])*p+f[1])*p+f[0]}}return n}import ee from"math-expressions";var Pi=class extends an{static componentType="circle";static rendererType="circle";actions={moveCircle:this.moveCircle.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["throughPoints","nThroughPoints","prescribedCenter","prescribedRadius","havePrescribedCenter","havePrescribedRadius"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.through={createComponentOfType:"_pointListComponent"},e.center={createComponentOfType:"point"},e.radius={createComponentOfType:"math"},delete e.parMin,delete e.parMax,delete e.variable,e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e}static returnStateVariableDefinitions(t){let e=se.returnStateVariableDefinitions(t),n=super.returnStateVariableDefinitions(t);return e.styleDescription=n.styleDescription,e.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{curveType:"circle"}})},e.parMax={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parMax:NaN}})},e.parMin={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parMin:NaN}})},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[0],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:()=>({newValues:{fs:{}}})},e.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:r}){return r.throughAttr!==null?{newValues:{nThroughPoints:r.throughAttr.stateValues.nPoints}}:{newValues:{nThroughPoints:0}}}},e.throughPoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(r){return r==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:r,varEnding:a,arraySize:i,desiredEntrySize:s}){if(r==="throughPointX"){let l=a.split("_").map(u=>Number(u)-1);return l.length===2&&l.every((u,c)=>Number.isInteger(u)&&u>=0)?s?l.every((u,c)=>s[c]>0)?[String(l)]:[]:i?l.every((u,c)=>u<i[c])?[String(l)]:[]:[String(l)]:[]}else{let l=Number(a)-1;return s?s[0]>0&&Number.isInteger(l)&&l>=0?Array.from(Array(i[1]),(u,c)=>l+","+c):[]:i?Number.isInteger(l)&&l>=0&&l<i[0]?Array.from(Array(i[1]),(u,c)=>l+","+c):[]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:r}){let a={};for(let i of r){let[s,l]=i.split(","),u=Number(s)+1+"_"+(Number(l)+1);a[i]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+u]}}}return{dependenciesByKey:a}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a){let[l,u]=s.split(","),c=Number(l)+1+"_"+(Number(u)+1),d=r[s].throughAttr;d!==null&&d.stateValues["pointX"+c]?i[s]=d.stateValues["pointX"+c]:i[s]=ee.fromAst("\uFF3F")}return{newValues:{throughPoints:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:a,dependencyNamesByKey:i,initialChange:s,stateValues:l}){if(s&&!l.draggable)return{success:!1};let u=[];for(let c in r.throughPoints){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);if(a[c].throughAttr!==null&&a[c].throughAttr.stateValues["pointX"+m])u.push({setDependency:i[c].throughAttr,desiredValue:r.throughPoints[c],variableIndex:0});else return{success:!1}}return{success:!0,instructions:u}}},e.radiusShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{radiusShadow:{variablesToCheck:["radius","radiusShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"radiusShadow",value:r.radiusShadow}]}}},e.centerShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{centerShadow:{variablesToCheck:["center","centerShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"centerShadow",value:r.centerShadow}]}}},e.havePrescribedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"},centerShadow:{dependencyType:"stateVariable",variableName:"centerShadow"}}),definition:({dependencyValues:r})=>({newValues:{havePrescribedCenter:r.centerAttr!==null||r.centerShadow!==null},checkForActualChange:{havePrescribedCenter:!0}})},e.prescribedCenter={isArray:!0,entryPrefixes:["prescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:r}){return[r.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:r}){let a={centerShadow:{dependencyType:"stateVariable",variableName:"centerShadow"}},i={};for(let s of r){let l=Number(s)+1;i[s]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+l]}}}return{globalDependencies:a,dependenciesByKey:i}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:a,arrayKeys:i}){let s={};for(let l of i){let u=Number(l)+1;a[l].centerAttr!==null?s[l]=a[l].centerAttr.stateValues["x"+u]:r.centerShadow!==null&&(s[l]=r.centerShadow.get_component(Number(l)))}return{newValues:{prescribedCenter:s}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:a,dependencyValuesByKey:i,dependencyNamesByKey:s,arraySize:l}){let u=[],c=!1;for(let d of Object.keys(r.prescribedCenter).reverse())i[d].centerAttr!==null?u.push({setDependency:s[d].centerAttr,desiredValue:r.prescribedCenter[d],variableIndex:0}):a.centerShadow!==null&&(c=!0);if(c)if(l[0]>1){let d=["vector"];for(let p in r.prescribedCenter)d[Number(p)+1]=r.prescribedCenter[p].tree;d.length=l[0]+1,u.push({setDependency:"centerShadow",desiredValue:ee.fromAst(d)})}else l[0]===1&&"0"in r.prescribedCenter&&u.push({setDependency:"centerShadow",desiredValue:r.prescribedCenter[0]});return{success:!0,instructions:u}}},e.prescribedRadius={defaultValue:null,returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius",variableNames:["value"]},radiusShadow:{dependencyType:"stateVariable",variableName:"radiusShadow"}}),definition:function({dependencyValues:r}){return r.radiusAttr!==null?{newValues:{prescribedRadius:r.radiusAttr.stateValues.value}}:{newValues:{prescribedRadius:r.radiusShadow}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a}){return a.radiusAttr!==null?{success:!0,instructions:[{setDependency:"radiusAttr",desiredValue:r.prescribedRadius,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"radiusShadow",desiredValue:r.prescribedRadius}]}}},e.havePrescribedRadius={returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius"},radiusShadow:{dependencyType:"stateVariable",variableName:"radiusShadow"}}),definition:({dependencyValues:r})=>({newValues:{havePrescribedRadius:r.radiusAttr!==null||r.radiusShadow!==null},checkForActualChange:{havePrescribedRadius:!0}})},e.numericalPrescribedRadius={returnDependencies:()=>({prescribedRadius:{dependencyType:"stateVariable",variableName:"prescribedRadius"}}),additionalStateVariablesDefined:["haveNonNumericalPrescribedRadius"],definition:function({dependencyValues:r}){let a=!1,i;return r.prescribedRadius===null?i=null:(i=r.prescribedRadius.evaluate_to_constant(),Number.isFinite(i)||(i=NaN,a=!0)),{newValues:{haveNonNumericalPrescribedRadius:a,numericalPrescribedRadius:i},checkForActualChange:{haveNonNumericalEntriesNumericalRadius:!0}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i}){return i.haveNonNumericalPrescribedRadius?{success:!1}:r.numericalPrescribedRadius!==void 0?a.prescribedRadius===null?{success:!1}:{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:ee.fromAst(r.numericalPrescribedRadius)}]}:{success:!1}}},e.numericalPrescribedCenter={isArray:!0,entryPrefixes:["numericalPrescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:r}){return[r.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:r}){let a={};for(let i of r){let s=Number(i)+1;a[i]={prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+s}}}return{dependenciesByKey:a}},arrayDefinitionByKey:function({dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a)i[s]=r[s].prescribedCenterX.evaluate_to_constant(),Number.isFinite(i[s])||(i[s]=NaN);return{newValues:{numericalPrescribedCenter:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyNamesByKey:a}){let i=[];for(let s in r.numericalPrescribedCenter)i.push({setDependency:a[s].prescribedCenterX,desiredValue:ee.fromAst(r.numericalPrescribedCenter[s])});return{success:!0,instructions:i}}},e.haveNonNumericalPrescribedCenter={returnDependencies:()=>({numericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"}}),definition({dependencyValues:r}){return{newValues:{haveNonNumericalPrescribedCenter:r.numericalPrescribedCenter.some(i=>!Number.isFinite(i))},checkForActualChange:{haveNonNumericalPrescribedCenter:!0}}}},e.numericalThroughPoints={returnDependencies:()=>({throughPoints:{dependencyType:"stateVariable",variableName:"throughPoints"}}),additionalStateVariablesDefined:["haveNonNumericalThroughPoints"],definition:function({dependencyValues:r}){let a=!1,i=[];for(let s of r.throughPoints){let l=[];for(let u=0;u<2;u++){let c;try{c=s[u].evaluate_to_constant()}catch(d){console.warn("Invalid point of circle"),a=!0,l=[];break}if(Number.isFinite(c))l.push(c);else{a=!0,l=[];break}}if(l.length>0)i.push(l);else{i=[];break}}return{newValues:{haveNonNumericalThroughPoints:a,numericalThroughPoints:i},checkForActualChange:{haveNonNumericalThroughPoints:!0}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i}){if(i.haveNonNumericalThroughPoints)return{success:!1};if(r.numericalThroughPoints!==void 0){let s={};for(let[l,u]of r.numericalThroughPoints.entries())s[l+",0"]=ee.fromAst(u[0]),s[l+",1"]=ee.fromAst(u[1]);return{success:!0,instructions:[{setDependency:"throughPoints",desiredValue:s}]}}return{success:!1}}},e.haveNumericalEntries={returnDependencies:()=>({haveNonNumericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},haveNonNumericalThroughPoints:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:({dependencyValues:r})=>({newValues:{haveNumericalEntries:!(r.haveNonNumericalPrescribedCenter||r.haveNonNumericalPrescribedRadius||r.haveNonNumericalThroughPoints)}})},e.numericalRadiusCalculatedWithCenter={additionalStateVariablesDefined:["numericalCenterCalculatedWithRadius"],returnDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:function({dependencyValues:r}){if(r.haveNonNumericalThroughPoints){let a="Haven't implemented circle through "+r.nThroughPoints+" points";return a+=" in case where don't have numerical values.",console.warn(a),{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}if(r.nThroughPoints===2){let{numericalCenter:a,numericalRadius:i}=Ri({point1:r.numericalThroughPoints[0],point2:r.numericalThroughPoints[1]});return{newValues:{numericalCenterCalculatedWithRadius:a,numericalRadiusCalculatedWithCenter:i}}}else if(r.nThroughPoints===3){let a=r.numericalThroughPoints[0][0],i=r.numericalThroughPoints[1][0],s=r.numericalThroughPoints[2][0],l=r.numericalThroughPoints[0][1],u=r.numericalThroughPoints[1][1],c=r.numericalThroughPoints[2][1],d,p;if(a===i&&l===u)if(a===s&&l===c)d=[a,l],p=0;else{let m=Ri({point1:[a,l],point2:[s,c]});d=m.numericalCenter,p=m.numericalRadius}else if(a===s&&l===c||i===s&&u===c){let m=Ri({point1:[a,l],point2:[i,u]});d=m.numericalCenter,p=m.numericalRadius}else{let m=a*a+l*l,f=i*i+u*u,h=s*s+c*c,y=a*(u-c)-l*(i-s)+i*c-s*u,b=m*(c-u)+f*(l-c)+h*(u-l),g=m*(i-s)+f*(s-a)+h*(a-i),C=m*(s*u-i*c)+f*(a*c-s*l)+h*(i*l-a*u);y!==0?(d=[-b/(2*y),-g/(2*y)],p=Math.sqrt((b*b+g*g-4*y*C)/(4*y*y))):(d=[NaN,NaN],p=NaN)}return{newValues:{numericalCenterCalculatedWithRadius:d,numericalRadiusCalculatedWithCenter:p}}}else return r.nThroughPoints>3?(console.warn("Can't calculate circle through more than 3 points"),{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}):{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}},e.numericalRadius={forRenderer:!0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],defaultValue:1,returnDependencies:function({stateValues:r}){let a={haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return r.havePrescribedRadius?(a.numericalPrescribedRadius={dependencyType:"stateVariable",variableName:"numericalPrescribedRadius"},r.havePrescribedCenter&&r.nThroughPoints>0&&(a.haveCenterRadiusPoints={dependencyType:"value",value:!0})):r.havePrescribedCenter?r.nThroughPoints===1&&(a.haveNonNumericalPrescribedCenter={dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},a.numericalPrescribedCenter={dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"},a.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},a.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}):r.nThroughPoints>1&&(a.numericalRadiusCalculatedWithCenter={dependencyType:"stateVariable",variableName:"numericalRadiusCalculatedWithCenter"},a.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}),a},definition:function({dependencyValues:r}){if(r.haveNonNumericalPrescribedRadius||r.haveNonNumericalPrescribedCenter||r.haveNonNumericalThroughPoints)return{newValues:{numericalRadius:NaN}};if(r.numericalPrescribedRadius!==void 0)return r.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{numericalRadius:NaN}}):{newValues:{numericalRadius:Math.max(0,r.numericalPrescribedRadius)}};if(r.numericalPrescribedCenter!==void 0){if(r.nThroughPoints===0)return{useEssentialOrDefaultValue:{numericalRadius:{variablesToCheck:"numericalRadius"}}};if(r.nThroughPoints===1){let a=r.numericalThroughPoints[0];return a===void 0?{newValues:{numericalRadius:NaN}}:{newValues:{numericalRadius:Math.sqrt(Math.pow(a[0]-r.numericalPrescribedCenter[0],2)+Math.pow(a[1]-r.numericalPrescribedCenter[1],2))}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{newValues:{numericalRadius:NaN}}}return r.nThroughPoints<2?{useEssentialOrDefaultValue:{numericalRadius:{variablesToCheck:"numericalRadius"}}}:{newValues:{numericalRadius:r.numericalRadiusCalculatedWithCenter}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i}){if(a.numericalPrescribedRadius!==void 0)return{success:!0,instructions:[{setDependency:"numericalPrescribedRadius",desiredValue:Math.max(0,r.numericalRadius)}]};if(a.numericalPrescribedCenter!==void 0){if(a.nThroughPoints===0)return{success:!0,instructions:[{setStateVariable:"numericalRadius",value:Math.max(0,r.numericalRadius)}]};if(a.nThroughPoints===1){let s=Math.max(0,r.numericalRadius),l=i.throughAngles[0];if(!Number.isFinite(l))return{success:!1};let u=[i.numericalCenter[0]+s*Math.cos(l),i.numericalCenter[1]+s*Math.sin(l)];return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:[u]}]}}else return{success:!1}}if(a.nThroughPoints<2)return{success:!0,instructions:[{setStateVariable:"numericalRadius",value:Math.max(0,r.numericalRadius)}]};{let s=[],l=Math.max(0,r.numericalRadius);for(let u=0;u<a.nThroughPoints;u++){let c=i.throughAngles[u];if(!Number.isFinite(c))return{success:!1};let d=[i.numericalCenter[0]+l*Math.cos(c),i.numericalCenter[1]+l*Math.sin(c)];s.push(d)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:s}]}}}},e.numericalCenter={forRenderer:!0,isArray:!0,entryPrefixes:["numericalCenterX"],defaultEntryValue:0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:r,stateValues:a}){let i={},s={};if(a.havePrescribedCenter){for(let l of r){let u=Number(l)+1;s[l]={numericalPrescribedCenterX:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenterX"+u}}}a.havePrescribedRadius&&a.nThroughPoints>0&&(i.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else i.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},i.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"},i.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},a.havePrescribedRadius?i.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:a.nThroughPoints==1?i.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:a.nThroughPoints>1&&(i.numericalCenterCalculatedWithRadius={dependencyType:"stateVariable",variableName:"numericalCenterCalculatedWithRadius"});return{globalDependencies:i,dependenciesByKey:s}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:a,arrayKeys:i}){let s={};for(let l of i)if(a[l].numericalPrescribedCenterX!==void 0){if(r.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{numericalCenter:[NaN,NaN]}};s[l]=a[l].numericalPrescribedCenterX}if(Object.keys(s).length>0)return{newValues:{numericalCenter:s}};if(r.haveNonNumericalPrescribedRadius||r.haveNonNumericalThroughPoints)return{newValues:{numericalCenter:[NaN,NaN]}};if(r.numericalRadius!==void 0)if(r.nThroughPoints===0){let l={};for(let u of i)l[u]={variablesToCheck:"numericalCenterX"+u};return{useEssentialOrDefaultValue:{numericalCenter:l}}}else{if(r.nThroughPoints===1)return r.numericalThroughPoints.length<1?{newValues:{numericalCenter:[NaN,NaN]}}:{newValues:{numericalCenter:[r.numericalThroughPoints[0][0],r.numericalThroughPoints[0][1]-r.numericalRadius]}};if(r.nThroughPoints===2){if(r.numericalThroughPoints.length<2)return{newValues:{numericalCenter:[NaN,NaN]}};let l=r.numericalRadius,u=r.numericalThroughPoints[0][0],c=r.numericalThroughPoints[1][0],d=r.numericalThroughPoints[0][1],p=r.numericalThroughPoints[1][1],m=Math.pow(u-c,2)+Math.pow(d-p,2),f=l*l;if(l<0||4*f<m)return console.warn("Can't find circle through given radius and two points"),{newValues:{numericalCenter:[NaN,NaN]}};if(m===0)return{newValues:{numericalCenter:[u,d-l]}};let h=.5*(m*(u+c)+(d-p)*Math.sqrt((4*f-m)*m))/m,y=.5*(m*(d+p)+(c-u)*Math.sqrt((4*f-m)*m))/m;return{newValues:{numericalCenter:[h,y]}}}else return console.warn("Can't create circle through more than two points with given radius"),{newValues:{numericalCenter:[NaN,NaN]}}}if(r.nThroughPoints===0){let l={};for(let u of i)l[u]={variablesToCheck:"numericalCenterX"+u};return{useEssentialOrDefaultValue:{numericalCenter:l}}}else return r.numericalCenterCalculatedWithRadius===void 0?{newValues:{numericalCenter:[NaN,NaN]}}:{newValues:{numericalCenter:r.numericalCenterCalculatedWithRadius}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:a,dependencyValuesByKey:i,dependencyNamesByKey:s,stateValues:l,workspace:u}){let c=[];for(let d in r.numericalCenter)i[d].numericalPrescribedCenterX!==void 0&&c.push({setDependency:s[d].numericalPrescribedCenterX,desiredValue:r.numericalCenter[d]});if(c.length>0)return{success:!0,instructions:c};if(a.nThroughPoints===0){for(let d in r.numericalCenter)c.push({setStateVariable:"numericalCenter",value:{[d]:r.numericalCenter[d]}});return{success:!0,instructions:c}}else{u.desiredCenter||(u.desiredCenter={});for(let p=0;p<2;p++)r.numericalCenter[p]!==void 0?u.desiredCenter[p]=r.numericalCenter[p]:u.desiredCenter[p]===void 0&&(u.desiredCenter[p]=l.numericalCenter[p]);let d=[];for(let p=0;p<a.nThroughPoints;p++){let m=l.throughAngles[p];if(!Number.isFinite(m))return{success:!1};let f=[u.desiredCenter[0]+l.numericalRadius*Math.cos(m),u.desiredCenter[1]+l.numericalRadius*Math.sin(m)];d.push(f)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:d}]}}}},e.throughAngles={defaultValue:[],returnDependencies:()=>({haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNumericalEntries"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"}}),definition:function({dependencyValues:r}){if(!(r.haveNumericalEntries&&r.nThroughPoints>0&&r.numericalRadius>0&&r.numericalCenter.every(i=>Number.isFinite(i))))return{useEssentialOrDefaultValue:{throughAngles:{variablesToCheck:["throughAngles"]}}};let a=[];for(let i of r.numericalThroughPoints)a.push(Math.atan2(i[1]-r.numericalCenter[1],i[0]-r.numericalCenter[0]));return{newValues:{throughAngles:a},makeEssential:["throughAngles"]}}},e.radius={public:!0,componentType:"math",stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],defaultValue:ee.fromAst(1),returnDependencies:function({stateValues:r}){let a={numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return r.havePrescribedRadius?(a.prescribedRadius={dependencyType:"stateVariable",variableName:"prescribedRadius"},r.havePrescribedCenter&&r.nThroughPoints>0&&(a.haveCenterRadiusPoints={dependencyType:"value",value:!0})):r.havePrescribedCenter&&r.nThroughPoints===1&&(a.prescribedCenter={dependencyType:"stateVariable",variableName:"prescribedCenter"},a.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"}),a},definition:function({dependencyValues:r}){if(Number.isFinite(r.numericalRadius))return{newValues:{radius:ee.fromAst(r.numericalRadius)},makeEssential:["radius"]};if(r.prescribedRadius!==void 0)return r.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{radius:ee.fromAst("\uFF3F")}}):{newValues:{radius:r.prescribedRadius}};if(r.prescribedCenter!==void 0){if(r.nThroughPoints===0)return{useEssentialOrDefaultValue:{radius:{variablesToCheck:"radius"}}};if(r.nThroughPoints===1)try{let a=r.throughPoints[0],i=a[0],s=a[1],l=r.prescribedCenter[0],u=r.prescribedCenter[1];return{newValues:{radius:i.subtract(l).pow(2).add(s.subtract(u).pow(2)).pow(.5).simplify()}}}catch(a){return console.warn("Invalid center or through points of circle"),{newValues:{radius:ee.fromAst("\uFF3F")}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{newValues:{radius:ee.fromAst("\uFF3F")}}}return r.nThroughPoints<2?{useEssentialOrDefaultValue:{radius:{variablesToCheck:"radius"}}}:(console.warn(`Have not implemented circle through ${r.nThroughPoints} points when non-numerical values`),{newValues:{radius:ee.fromAst("\uFF3F")}})},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i}){let s=r.radius.evaluate_to_constant();if(Number.isFinite(s)&&Number.isFinite(a.numericalRadius))return{success:!0,instructions:[{setDependency:"numericalRadius",desiredValue:s}]};if(a.prescribedRadius!==void 0)return{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:r.radius}]};if(a.nThroughPoints===0){let l=[{setStateVariable:"radius",value:r.radius}];return Number.isFinite(s)&&l.push({setDependency:"numericalRadius",desiredValue:s}),{success:!0,instructions:l}}else return console.warn("Can't change radius of circle with non-numerical values through points"),{success:!1}}},e.diameter={public:!0,componentType:"math",returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:r}){return{newValues:{diameter:r.radius.multiply(2).simplify()}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i}){return{success:!0,instructions:[{setDependency:"radius",desiredValue:r.diameter.divide(2).simplify()}]}}},e.center={forRenderer:!0,public:!0,componentType:"math",isArray:!0,entryPrefixes:["centerX"],defaultEntryValue:ee.fromAst(0),returnWrappingComponents(r){return r==="centerX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:r,stateValues:a}){console.log("array dependencies by key for circle center"),console.log(r),console.log(a);let i={},s={};if(a.havePrescribedCenter){i.havePrescribedCenter={dependencyType:"value",value:!0};for(let l of r){let u=Number(l)+1;s[l]={numericalCenterX:{dependencyType:"stateVariable",variableName:"numericalCenterX"+u},prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+u}}}a.havePrescribedRadius&&a.nThroughPoints>0&&(i.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else i.numericalCenter={dependencyType:"stateVariable",variableName:"numericalCenter"},i.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},i.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"},a.havePrescribedRadius?i.radius={dependencyType:"stateVariable",variableName:"prescribedRadius"}:a.nThroughPoints==1&&(i.radius={dependencyType:"stateVariable",variableName:"radius"});return console.log({dependenciesByKey:s,globalDependencies:i}),{dependenciesByKey:s,globalDependencies:i}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:a,arrayKeys:i}){if(r.havePrescribedCenter){if(r.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{center:[ee.fromAst("\uFF3F"),ee.fromAst("\uFF3F")]}};let s={};for(let l of i)Number.isFinite(a[l].numericalCenterX)?s[l]=ee.fromAst(a[l].numericalCenterX):s[l]=a[l].prescribedCenterX;return{newValues:{center:s}}}if(r.numericalCenter.every(s=>Number.isFinite(s)))return{newValues:{center:r.numericalCenter.map(s=>ee.fromAst(s))},makeEssential:["center"]};if(r.radius!==void 0)if(r.nThroughPoints===0){let s={};for(let l of i)s[l]={variablesToCheck:"centerX"+l};return{useEssentialOrDefaultValue:{center:s}}}else if(r.nThroughPoints===1){let s;try{s=[r.throughPoints[0][0],r.throughPoints[0][1].subtract(r.radius).simplify()]}catch(l){s=[ee.fromAst("\uFF3F"),ee.fromAst("\uFF3F")]}return{newValues:{center:s}}}else return console.warn("Can't create circle through more than one point with given radius when don't have numerical values"),{newValues:{center:[ee.fromAst("\uFF3F"),ee.fromAst("\uFF3F")]}};if(r.nThroughPoints===0){let s={};for(let l of i)s[l]={variablesToCheck:"centerX"+l};return{useEssentialOrDefaultValue:{center:s}}}else return console.warn("Can't create circle through more than one point when don't have numerical values"),{newValues:{center:[ee.fromAst("\uFF3F"),ee.fromAst("\uFF3F")]}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:a,stateValues:i,dependencyNamesByKey:s,workspace:l}){if(a.havePrescribedCenter){let d=[];for(let p in r.center)d.push({setDependency:s[p].prescribedCenterX,desiredValue:r.center[p],arrayKey:p});return{success:!0,instructions:d}}l.desiredCenter||(l.desiredCenter={});for(let d=0;d<2;d++)r.center[d]!==void 0?l.desiredCenter[d]=r.center[d]:l.desiredCenter[d]===void 0&&(l.desiredCenter[d]=i.center[d]);let u=[],c=!0;for(let d=0;d<2;d++){let p=l.desiredCenter[d].evaluate_to_constant();if(!Number.isFinite(p)){c=!1;break}u.push(p)}if(c&&a.numericalCenter.every(d=>Number.isFinite(d)))return{success:!0,instructions:[{setDependency:"numericalCenter",desiredValue:u}]};if(a.nThroughPoints===0){let d=[{setStateVariable:"center",value:l.desiredCenter}];return c&&d.push({setDependency:"numericalCenter",desiredValue:u}),{success:!0,instructions:d}}else return console.warn("Haven't implemented changing center of circle through points with non numerical values"),{success:!1}}},e.nearestPoint={returnDependencies:()=>({numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"}}),definition:({dependencyValues:r})=>({newValues:{nearestPoint:function(a){let i=a.x1.evaluate_to_constant(),s=a.x2.evaluate_to_constant();if(!(Number.isFinite(i)&&Number.isFinite(s)))return{};if(!(Number.isFinite(r.numericalCenter[0])&&Number.isFinite(r.numericalCenter[1])&&Number.isFinite(r.numericalRadius)))return{};let l=Math.atan2(s-r.numericalCenter[1],i-r.numericalCenter[0]),u={x1:r.numericalCenter[0]+r.numericalRadius*Math.cos(l),x2:r.numericalCenter[1]+r.numericalRadius*Math.sin(l)};return a.x3!==void 0&&(u.x3=0),u}}})},e}moveCircle({center:t,transient:e}){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalCenter",value:t}];if(this.stateValues.nThroughPoints===1&&this.stateValues.numericalPrescribedCenter!==null&&this.stateValues.numericalPrescribedRadius===null){let r=this.stateValues.throughAngles[0],a=[t[0]+this.stateValues.numericalRadius*Math.cos(r),t[1]+this.stateValues.numericalRadius*Math.sin(r)];n.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalThroughPoints",value:[a]})}e?this.coreFunctions.requestUpdate({updateInstructions:n,transient:e}):this.coreFunctions.requestUpdate({updateInstructions:n,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{center:t}}})}},yc=Pi;function Ri({point1:o,point2:t}){let e=(o[0]+t[0])/2,n=(o[1]+t[1])/2,r=[e,n],a=Math.sqrt(Math.pow(e-o[0],2)+Math.pow(n-o[1],2));return{numericalCenter:r,numericalRadius:a}}import Ze from"math-expressions";var Bi=class extends an{static componentType="parabola";static rendererType="curve";static get stateVariablesShadowedForReference(){return["nThroughPoints","throughPoints"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.through={createComponentOfType:"_pointListComponent"},delete e.parMin,delete e.parMax,delete e.variable,e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e}static returnStateVariableDefinitions(t){let e=se.returnStateVariableDefinitions(t),n=super.returnStateVariableDefinitions(t);return e.styleDescription=n.styleDescription,e.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{curveType:"function"}})},e.parMax={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parMax:NaN}})},e.parMin={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parMin:NaN}})},e.aShadow={defaultValue:1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{aShadow:{variablesToCheck:["aShadow","a"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"aShadow",value:r.aShadow}]}}},e.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:r}){return r.throughAttr===null?{newValues:{nThroughPoints:0}}:{newValues:{nThroughPoints:r.throughAttr.stateValues.nPoints}}}},e.throughPoints={public:!0,componentType:"point",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(r){return r==="throughPointX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},getArrayKeysFromVarName({arrayEntryPrefix:r,varEnding:a,arraySize:i,desiredEntrySize:s}){if(r==="throughPointX"){let l=a.split("_").map(u=>Number(u)-1);return l.length===2&&l.every((u,c)=>Number.isInteger(u)&&u>=0)?s?l.every((u,c)=>s[c]>0)?[String(l)]:[]:i?l.every((u,c)=>u<i[c])?[String(l)]:[]:[String(l)]:[]}else{let l=Number(a)-1;return s?s[0]>0&&Number.isInteger(l)&&l>=0?Array.from(Array(i[1]),(u,c)=>l+","+c):[]:i?Number.isInteger(l)&&l>=0&&l<i[0]?Array.from(Array(i[1]),(u,c)=>l+","+c):[]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:r}){let a={};for(let i of r){let[s,l]=i.split(","),u=Number(s)+1+"_"+(Number(l)+1);a[i]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+u]}}}return{dependenciesByKey:a}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a){let[l,u]=s.split(","),c=Number(l)+1+"_"+(Number(u)+1),d=r[s].throughAttr;if(d!==null&&d.stateValues["pointX"+c]){let p=d.stateValues["pointX"+c].evaluate_to_constant();Number.isFinite(p)?i[s]=Ze.fromAst(p):i[s]=Ze.fromAst("\uFF3F")}else i[s]=Ze.fromAst("\uFF3F")}return{newValues:{throughPoints:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:a,dependencyNamesByKey:i,initialChange:s,stateValues:l}){if(s&&!l.draggable)return{success:!1};let u=[];for(let c in r.throughPoints){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);if(a[c].throughAttr!==null&&a[c].throughAttr.stateValues["pointX"+m])u.push({setDependency:i[c].throughAttr,desiredValue:r.throughPoints[c],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:u}}},e.numericalThroughPoints={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:r}){let a={};for(let i of r)a[i]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(i)+1)}};return{dependenciesByKey:a}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:a}){let i={};for(let s of a){let l=r[s].throughPoint.map(u=>u.tree);l.every(u=>Number.isFinite(u))||(l=Array(l.length).fill(NaN)),i[s]=l}return{newValues:{numericalThroughPoints:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:a,dependencyNamesByKey:i}){let s=[];for(let l in r.numericalThroughPoints)if(a[l].throughPoint)s.push({setDependency:i[l].throughPoint,desiredValue:r.numericalThroughPoints[l].map(u=>Ze.fromAst(u))});else return{success:!1};return{success:!0,instructions:s}}},e.pointsAreNumerical={returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"}}),definition:({dependencyValues:r})=>({newValues:{pointsAreNumerical:r.numericalThroughPoints.every(a=>Number.isFinite(a[0]))},checkForActualChange:{pointsAreNumerical:!0}})},e.a={public:!0,componentType:"number",additionalStateVariablesDefined:[{variableName:"b",public:!0,componentType:"number"},{variableName:"c",public:!0,componentType:"number"},"realValued"],returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},pointsAreNumerical:{dependencyType:"stateVariable",variableName:"pointsAreNumerical"},aShadow:{dependencyType:"stateVariable",variableName:"aShadow"}}),definition:function({dependencyValues:r}){if(!r.pointsAreNumerical)return{newValues:{a:NaN,b:NaN,c:NaN,realValued:!1}};let a,i,s,l=!0;if(r.numericalThroughPoints.length===0)return{useEssentialOrDefaultValue:{b:{variablesToCheck:["b"],defaultValue:0},c:{variablesToCheck:["c"],defaultValue:0}},newValues:{a:r.aShadow,realValued:!0}};if(r.numericalThroughPoints.length===1){let u=r.numericalThroughPoints[0],c=u[0],d=u[1];return a=r.aShadow,i=-2*a*c,s=a*c*c+d,{newValues:{a,b:i,c:s,realValued:!0}}}else if(r.numericalThroughPoints.length===2){a=r.aShadow;let u=r.numericalThroughPoints[0],c=u[0],d=u[1],p=c*c,m=r.numericalThroughPoints[1],f=m[0],h=m[1],y=f*f;return c===f?d==h?(i=-2*a*c,s=a*p+d):(l=!1,a=NaN,i=NaN,s=NaN):(i=(d-h-a*(p-y))/(c-f),s=d-a*p-i*c),{newValues:{a,b:i,c:s,realValued:l}}}else if(r.numericalThroughPoints.length===3){let u=r.numericalThroughPoints[0],c=u[0],d=u[1],p=c*c,m=r.numericalThroughPoints[1],f=m[0],h=m[1],y=f*f,b=r.numericalThroughPoints[2],g=b[0],C=b[1],T=g*g,v=p-T,N=y-T,V=c-g,x=f-g,w=d-C,D=h-C,I=v*x-N*V;if(I===0){let A=!1,S,O,k;c===f?d===h?c===g?d==C?S=1:A=!0:(S=2,O=g,k=C):A=!0:c===g?d===C?(S=2,O=f,k=h):A=!0:f===g&&h===C?(S=2,O=f,k=h):A=!0,A?(l=!1,a=NaN,i=NaN,s=NaN):S===1?(a=r.aShadow,i=-2*a*c,s=a*c*c+d):(a=r.aShadow,i=(d-k-a*(p-O*O))/(c-O),s=d-a*p-i*c)}else a=(w*x-D*V)/I,i=(D*v-w*N)/I,s=d-i*c-a*p;return{newValues:{a,b:i,c:s,realValued:l}}}else return console.warn("Haven't implemented parabola through more than 3 points"),{newValues:{a:NaN,b:NaN,c:NaN,realValued:!1}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:a,stateValues:i,workspace:s}){if(!a.pointsAreNumerical)return{success:!1};let l={},u=function(d){if(Number.isFinite(d))return{success:!0,value:d};if(d instanceof Ze.class){let p=d.evaluate_to_constant();if(Number.isFinite(p))return{success:!0,value:p}}return{success:!1}};if(r.a!==void 0){let d=u(r.a);if(d.success)l.a=d.value;else return{success:!1}}if(r.b!==void 0){let d=u(r.b);if(d.success)l.b=d.value;else return{success:!1}}if(r.c!==void 0){let d=u(r.c);if(d.success)l.c=d.value;else return{success:!1}}Object.assign(s,l);let c=function(d){return s[d]!==void 0?s[d]:i[d]};if(a.numericalThroughPoints.length===0){let d=[];return l.a!==void 0&&d.push({setDependency:"aShadow",desiredValue:l.a}),l.b!==void 0&&d.push({setStateVariable:"b",value:l.b}),l.c!==void 0&&d.push({setStateVariable:"c",value:l.c}),{success:!0,instructions:d}}else if(a.numericalThroughPoints.length===1){let d=c("a"),p=c("b"),m=c("c"),f=-p/(2*d),h=m-p*p/(4*d),y=[{setDependency:"numericalThroughPoints",desiredValue:[[f,h]]}];return l.a!==void 0&&y.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:y}}else if(a.numericalThroughPoints.length===2){let d=c("a"),p=c("b"),m=c("c"),h=a.numericalThroughPoints[0][0],b=a.numericalThroughPoints[1][0];if(h===b){h=-p/(2*d);let g=m-p*p/(4*d),C=[{setDependency:"numericalThroughPoints",desiredValue:[[h,g],[h,g]]}];return l.a!==void 0&&C.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:C}}else{let g=d*h*h+p*h+m,C=d*b*b+p*b+m,T=[{setDependency:"numericalThroughPoints",desiredValue:[[h,g],[b,C]]}];return l.a!==void 0&&T.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:T}}}else if(a.numericalThroughPoints.length===3){let d=c("a"),p=c("b"),m=c("c"),h=a.numericalThroughPoints[0][0],b=a.numericalThroughPoints[1][0],C=a.numericalThroughPoints[2][0],T=3,v;if(h===b?h===C?T=1:(T=2,v=3):h===C?(T=2,v=2):b===C&&(T=2,v=1),T===3){let N=d*h*h+p*h+m,V=d*b*b+p*b+m,x=d*C*C+p*C+m,w=[{setDependency:"numericalThroughPoints",desiredValue:[[h,N],[b,V],[C,x]]}];return l.a!==void 0&&w.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:w}}else if(T===2)if(v===1){let N=h,V=b,x=d*N*N+p*N+m,w=d*V*V+p*V+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[N,x],[V,w],[V,w]]}];return l.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:D}}else if(v===2){let N=h,V=b,x=d*N*N+p*N+m,w=d*V*V+p*V+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[N,x],[V,w],[N,x]]}];return l.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:D}}else{let N=h,V=C,x=d*N*N+p*N+m,w=d*V*V+p*V+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[N,x],[N,x],[V,w]]}];return l.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:D}}else{h=-p/(2*d);let N=m-p*p/(4*d),V=[{setDependency:"numericalThroughPoints",desiredValue:[[h,N],[h,N],[h,N]]}];return l.a!==void 0&&V.push({setDependency:"aShadow",desiredValue:l.a}),{success:!0,instructions:V}}}else return{success:!1}}},e.vertex={public:!0,componentType:"math",isArray:!0,entryPrefixes:["vertexX"],returnWrappingComponents(r){return r==="vertexX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"},realValued:{dependencyType:"stateVariable",variableName:"realValued"}}}},arrayDefinitionByKey:function({globalDependencyValues:r}){let a={};return r.realValued&&r.a!==0?(a[0]=Ze.fromAst(-r.b/(2*r.a)),a[1]=Ze.fromAst(r.c-r.b**2/(4*r.a))):(a[0]=Ze.fromAst("\uFF3F"),a[1]=Ze.fromAst("\uFF3F")),{newValues:{vertex:a}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:r,globalDependencyValues:a,workspace:i,stateValues:s}){let l;if("0"in r.vertex?l=r.vertex[0].evaluate_to_constant():i.x!==void 0?l=i.x:l=s.vertex[0].tree,Number.isFinite(l))i.x=l;else return{success:!1};let u;if("1"in r.vertex?u=r.vertex[1].evaluate_to_constant():i.y!==void 0?u=i.y:u=s.vertex[1].tree,Number.isFinite(u))i.y=u;else return{success:!1};let c=a.a,d=-2*c*l,p=u+c*l*l;return{success:!0,instructions:[{setDependency:"b",desiredValue:d,additionalDependencyValues:{c:p}}]}}},e.equation={public:!0,componentType:"math",additionalProperties:{simplify:"numberspreserveorder",displaysmallaszero:!0},returnDependencies:()=>({a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition:function({dependencyValues:r}){let a=["=","y",["+",["*",r.a,["^","x",2]],["*",r.b,"x"],r.c]];return{newValues:{equation:Ze.fromAst(a).evaluate_numbers({skip_ordering:!0})}}}},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[1],returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}}},arrayDefinitionByKey({globalDependencyValues:r}){return{newValues:{fs:[function(i){return r.a*i*i+r.b*i+r.c}]}}}},e.nearestPoint={returnDependencies:()=>({f:{dependencyType:"stateVariable",variableName:"f"}}),definition:({dependencyValues:r})=>({newValues:{nearestPoint:function(a){let i=a.x1.evaluate_to_constant(),s=r.f(i),l={x1:i,x2:s};return a.x3!==void 0&&(l.x3=0),l}}})},e}},gc=Bi;import Je from"math-expressions";var Fi=class extends B{static componentType="bezierControls";static rendererType="container";static get stateVariablesShadowedForReference(){return["controls"]}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Ge({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(a){return a.length>1||a[0].componentType==="string"?{componentType:"controlVectors",children:[{componentType:"vector",children:a}]}:a[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastZeroControlvectors",componentType:"controlVectors",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nControls={returnDependencies:()=>({nParentPoints:{dependencyType:"parentStateVariable",variableName:"nThroughPoints"}}),definition({dependencyValues:e}){let n=e.nParentPoints;return Number.isInteger(n)&&n>=0||(n=0),{newValues:{nControls:n}}}},t.pointIndMap={returnDependencies:()=>({controlChildren:{dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["pointNumber"]}}),definition:function({dependencyValues:e}){let n=[],r=-1;for(let[a,i]of e.controlChildren.entries()){let s=i.stateValues.pointNumber;Number.isFinite(s)?r=Math.round(s)-1:r+=1,n[r]=a}return{newValues:{pointIndMap:n}}}},t.directions={isArray:!0,entryPrefixes:["direction"],defaultEntryValue:"none",stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize({dependencyValues:e}){return[e.nControls]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let a of e){let i=n.pointIndMap[a];i!==void 0&&(r[a]={controlChild:{dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["direction"],childIndices:[i]}})}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={},a={};for(let i of n){let s=e[i].controlChild;s&&s.length===1?r[i]=s[0].stateValues.direction:a[i]={variablesToCheck:[{variableName:"directions",arrayIndex:i}]}}return{newValues:{directions:r},useEssentialOrDefaultValue:{directions:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,dependencyValuesByKey:r}){let a=[],i={};for(let s in e.directions){let l=r[s].controlChild;l&&l.length===1?a.push({setDependency:n[s].controlChild,desiredValue:e.directions[s],childIndex:0,variableIndex:0}):i[s]=e.directions[s]}return Object.keys(i).length>0&&a.push({setStateVariable:"directions",value:i}),{success:!0,instructions:a}}},t.nDimensions={returnDependencies(){return{nParentDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensions"}}},definition:function({dependencyValues:e}){let n=e.nParentDimensions;return Number.isInteger(n)&&n>=0||(n=0),{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.essentialSymmetricControls={isArray:!0,entryPrefixes:["essentialSymmetricControl"],nDimensions:2,defaultEntryValue:Je.fromAst(1),returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nControls,e.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let n={};for(let r of e){let a=r.split(",").map(i=>Number(i));n[r]={variablesToCheck:[{variableName:"essentialSymmetricControls",arrayIndex:a}]}}return{useEssentialOrDefaultValue:{essentialSymmetricControls:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[],r={};for(let a in e.essentialSymmetricControls)r[a]=e.essentialSymmetricControls[a];return Object.keys(r).length>0&&n.push({setStateVariable:"essentialSymmetricControls",value:r}),{success:!0,instructions:n}}},t.controls={isArray:!0,entryPrefixes:["control"],nDimensions:3,defaultEntryValue:Je.fromAst(1),stateVariablesDeterminingDependencies:["pointIndMap","directions"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nControls,2,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let a of e){let i=a.split(",").map(u=>Number(u)),s=i.map(u=>u+1);r[a]={direction:{dependencyType:"stateVariable",variableName:"direction"+s[0]}};let l=n.directions[i[0]];if(console.log(`direction: ${l}`),l&&l!=="none"&&(i[1]===0||i[1]===1)){let u=n.pointIndMap[i[0]];u!==void 0&&(l==="symmetric"||l==="previous"&&i[1]===0||l==="next"&&i[1]===1?r[a].controlChild={dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["vectorX1_"+s[2]],childIndices:[u]}:l==="both"&&(r[a].controlChild={dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["vectorX"+s[1]+"_"+s[2]],childIndices:[u]})),l==="symmetric"&&(r[a].essentialSymmetricControl={dependencyType:"stateVariable",variableName:"essentialSymmetricControl"+s[0]+"_"+s[2]})}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,componentName:r}){console.log(`definition of controls for beziercontrols of ${r}`),console.log(JSON.parse(JSON.stringify(e))),console.log(JSON.parse(JSON.stringify(n)));let a={},i={};for(let s of n){let l=s.split(",").map(d=>Number(d)),u=l.map(d=>d+1),c=e[s].direction;if(!c)i[s]={variablesToCheck:[{variableName:"controls",arrayIndex:l}]};else if(l[1]===0)if(c==="none"||c==="next")i[s]={variablesToCheck:[{variableName:"controls",arrayIndex:l}]};else{let d=e[s].controlChild,p=!0;if(d&&d.length===1){let m=d[0].stateValues["vectorX1_"+u[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),a[s]=Je.fromAst(m))}p&&(c==="symmetric"?a[s]=e[s].essentialSymmetricControl:i[s]={variablesToCheck:[{variableName:"controls",arrayIndex:l}]})}else if(l[1]===1)if(c==="none"||c==="previous")i[s]={variablesToCheck:[{variableName:"controls",arrayIndex:l}]};else{let d=e[s].controlChild,p=!0;if(d&&d.length===1)if(c==="both"){let m=d[0].stateValues["vectorX2_"+u[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),a[s]=Je.fromAst(m))}else{let m=d[0].stateValues["vectorX1_"+u[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),c==="symmetric"?a[s]=Je.fromAst(-m):a[s]=Je.fromAst(m))}p&&(c==="symmetric"?e[s].essentialSymmetricControl&&(a[s]=Je.fromAst(-e[s].essentialSymmetricControl.tree)):i[s]={variablesToCheck:[{variableName:"controls",arrayIndex:l}]})}}return{newValues:{controls:a},useEssentialOrDefaultValue:{controls:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,dependencyValuesByKey:r}){let a=[],i={};for(let s in e.controls){let l=s.split(",").map(d=>Number(d)),u=l.map(d=>d+1),c=r[s].direction;if(c){if(l[1]===0){if(!(c==="none"||c==="next")){let d=r[s].controlChild,p=!0;if(d&&d.length===1&&d[0].stateValues["vectorX1_"+u[2]]&&(p=!1,a.push({setDependency:n[s].controlChild,desiredValue:e.controls[s],childIndex:0,variableIndex:0})),p){let m=e.controls[s].evaluate_to_constant();Number.isFinite(m)||(m=NaN),m=Je.fromAst(m),c==="symmetric"?a.push({setDependency:n[s].essentialSymmetricControl,desiredValue:m}):i[s]=m}}}else if(l[1]===1&&!(c==="none"||c==="previous")){let d=r[s].controlChild,p=!0;d&&d.length===1&&(c==="both"?d[0].stateValues["vectorX2_"+u[2]]&&(p=!1):d[0].stateValues["vectorX1_"+u[2]]&&(p=!1));let m;c==="symmetric"?m=Je.fromAst(["-",e.controls[s].tree]):m=e.controls[s],p?(m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),m=Je.fromAst(m),c==="symmetric"?a.push({setDependency:n[s].essentialSymmetricControl,desiredValue:m}):i[s]=m):a.push({setDependency:n[s].controlChild,desiredValue:m,childIndex:0,variableIndex:0})}}}return Object.keys(i).length>0&&a.push({setStateVariable:"controls",value:i}),{success:!0,instructions:a}}},t}},vc=Fi;var Li=class extends B{static componentType="_vectorListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Ge({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(a){return a.length>1||a[0].componentType==="string"?{componentType:"vector",children:a}:a[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroVectors",componentType:"vector",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVectors={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atLeastZeroVectors",skipComponentNames:!0}}),definition:({dependencyValues:e})=>({newValues:{nVectors:e.vectorChildren.length},checkForActualChange:{nVectors:!0}})},t.nDimensions={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atLeastZeroVectors",variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:e}){let n;if(e.vectorChildren.length===0)n=2;else{n=1;for(let r of e.vectorChildren)Number.isFinite(r.stateValues.nDimensions)&&(n=Math.max(n,r.stateValues.nDimensions))}return{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.vectors={isArray:!0,nDimensions:2,entryPrefixes:["vectorX","vector"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="vectorX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},returnArraySizeDependencies:()=>({nVectors:{dependencyType:"stateVariable",variableName:"nVectors"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nVectors,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[a,i]=r.split(",");n[r]={vectorChild:{dependencyType:"child",childLogicName:"atLeastZeroVectors",variableNames:["x"+(Number(i)+1)],childIndices:[a]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=a.split(",")[1],s=e[a].vectorChild[0];s&&(r[a]=s.stateValues["x"+(Number(i)+1)])}return{newValues:{vectors:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n}){let r=[];for(let a in e.vectors)r.push({setDependency:n[a].vectorChild,desiredValue:e.vectors[a],childIndex:0,variableIndex:0});return{success:!0,instructions:r}}},t}},pr=Li;var Ei=class extends pr{static componentType="controlVectors";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.direction={createComponentOfType:"text",createStateVariable:"direction",defaultValue:"symmetric",public:!0,toLowerCase:!0,validValues:["symmetric","previous","next","both","none"]},e.pointNumber={createComponentOfType:"number",createStateVariable:"pointNumber",defaultValue:null,public:!0},e}},Cc=Ei;var Mi=class extends B{static componentType="_pointListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Ge({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(a){return a.length>1||a[0].componentType==="string"?{componentType:"point",children:a}:a[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nPoints={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",skipComponentNames:!0}}),definition:function({dependencyValues:e}){return{newValues:{nPoints:e.pointChildren.length},checkForActualChange:{nPoints:!0}}}},t.nDimensions={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:e}){let n;if(e.pointChildren.length===0)n=2;else{n=1;for(let r of e.pointChildren)Number.isFinite(r.stateValues.nDimensions)&&(n=Math.max(n,r.stateValues.nDimensions))}return{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="pointX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return r?a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},returnArraySizeDependencies:()=>({nPoints:{dependencyType:"stateVariable",variableName:"nPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nPoints,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[a,i]=r.split(",");n[r]={pointChild:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["x"+(Number(i)+1)],childIndices:[a]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=a.split(",")[1],s=e[a].pointChild[0];s&&(r[a]=s.stateValues["x"+(Number(i)+1)])}return{newValues:{points:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n}){let r=[];for(let a in e.points)r.push({setDependency:n[a].pointChild,desiredValue:e.points[a],childIndex:0,variableIndex:0});return{success:!0,instructions:r}}},t}},Nc=Mi;var _i=class extends B{static componentType="_lineListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"line",children:[{componentType:"string",state:{value:s}}]}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLines",componentType:"line",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nLines={returnDependencies:()=>({lineChildren:{dependencyType:"child",childLogicName:"atLeastZeroLines",skipComponentNames:!0}}),definition:function({dependencyValues:e}){return{newValues:{nLines:e.lineChildren.length},checkForActualChange:{nLines:!0}}}},t.lineNames={isArray:!0,entryPrefixes:["lineName"],returnArraySizeDependencies:()=>({nLines:{dependencyType:"stateVariable",variableName:"nLines"}}),returnArraySize({dependencyValues:e}){return[e.nLines]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={lineChild:{dependencyType:"child",childLogicName:"atLeastZeroLines",childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].lineChild[0];i&&(r[a]=i.componentName)}return{newValues:{lineNames:r}}}},t}},Tc=_i;var $i=class extends B{static componentType="_angleListComponent";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.hide={default:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"AtLeastZeroAngles",componentType:"angle",comparison:"atLeast",number:0}),r=Yn(l=>({componentType:"angle",children:[{componentType:"math",children:l}]})),a=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:r});return e.newOperator({name:"AnglesXorSugar",operator:"xor",propositions:[n,s],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this._state.angles={trackChanges:!0}),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.nAngles=!0;return}if(this.currentTracker.trackChanges.childrenChanged(this.componentName)){delete this.unresolvedState.angles,delete this.unresolvedState.nAngles;let r=this.childLogic.returnMatches("AtLeastZeroAngles");this.state.nAngles=r.length,this.state.angles=r.map(a=>this.activeChildren[a])}}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.container({key:this.componentName}))}updateChildrenWhoRender(){this.childrenWhoRender=this.state.angles.map(t=>t.componentName)}},Vc=$i;import Oe from"math-expressions";var zi=class extends se{constructor(t){super(t);this.moveVector=this.moveVector.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={moveVector:this.moveVector}}static componentType="vector";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["head","tail","displacement","basedOnHead","basedOnTail","basedOnDisplacement","nDimensions","nDimDisplacement","nDimHead","nDimTail"]}static primaryStateVariableForDefinition="displacementShadow";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.headDraggable={createComponentOfType:"boolean",createStateVariable:"headDraggable",defaultValue:!0,public:!0,forRenderer:!0},e.tailDraggable={createComponentOfType:"boolean",createStateVariable:"tailDraggable",defaultValue:!0,public:!0,forRenderer:!0},e.x={createComponentOfType:"math"},e.y={createComponentOfType:"math"},e.z={createComponentOfType:"math"},e.xs={createComponentOfType:"mathList"},e.displacement={createComponentOfType:"vector"},e.head={createComponentOfType:"point"},e.tail={createComponentOfType:"point"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let i=ht({childrenToComponentFunction:s=>({componentType:"math",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return!i.success&&n.length===1?{success:!0,newAttributes:{x:{componentType:"math",children:n}}}:(i.success&&(i.newAttributes={xs:{componentType:"mathList",children:i.newChildren}},delete i.newChildren),i)};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOnePoint",componentType:"point",comparison:"atMost",number:1}),r=e.newLeaf({name:"atMostOneVector",componentType:"vector",comparison:"atMost",number:1});return e.newOperator({name:"vectorXorPoints",operator:"xor",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.displacementShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{displacementShadow:{variablesToCheck:["displacement","displacementShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"displacementShadow",value:e.displacementShadow}]}}},t.headShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{headShadow:{variablesToCheck:["head","headShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"headShadow",value:e.headShadow}]}}},t.tailShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{tailShadow:{variablesToCheck:["tail","tailShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"tailShadow",value:e.tailShadow}]}}},t.sourceOfDisplacement={returnDependencies:()=>({xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement"},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint"},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector"}}),definition({dependencyValues:e}){let n=null;return e.vectorChild.length===1?n="vectorChild":e.pointChild.length===1?n="pointChild":e.displacementAttr!==null?n="displacementAttr":e.xsAttr!==null?n="xsAttr":(e.xAttr!==null||e.yAttr!==null||e.zAttr!==null)&&(n="componentAttrs"),{newValues:{sourceOfDisplacement:n}}}},t.basedOnHead={returnDependencies:()=>({headAttr:{dependencyType:"attributeComponent",attributeName:"head"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}}),definition:function({dependencyValues:e}){return e.tailAttr!==null&&e.sourceOfDisplacement!==null?(e.headAttr!==null&&console.warn("Vector is prescribed by head, tail, and displacement.  Ignoring specified head."),{newValues:{basedOnHead:!1},checkForActualChange:{basedOnHead:!0}}):e.headAttr!==null?{newValues:{basedOnHead:!0},checkForActualChange:{basedOnHead:!0}}:{newValues:{basedOnHead:e.headShadow!==null},checkForActualChange:{basedOnHead:!0}}}},t.basedOnTail={returnDependencies:()=>({tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}}),definition:function({dependencyValues:e}){return e.tailAttr!==null?{newValues:{basedOnTail:!0},checkForActualChange:{basedOnTail:!0}}:{newValues:{basedOnTail:e.tailShadow!==null},checkForActualChange:{basedOnTail:!0}}}},t.basedOnDisplacement={returnDependencies:()=>({sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"}}),definition:function({dependencyValues:e}){return e.sourceOfDisplacement!==null?{newValues:{basedOnDisplacement:!0},checkForActualChange:{basedOnDisplacement:!0}}:{newValues:{basedOnDisplacement:e.displacementShadow!==null},checkForActualChange:{basedOnDisplacement:!0}}}},t.nDimDisplacement={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let n={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["nDimensions"]},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector",variableNames:["nDimensions"]},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["nDimensions"]},xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]}};return e.basedOnDisplacement||(e.basedOnHead&&(n.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),e.basedOnTail&&(n.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"})),n},definition:function({dependencyValues:e}){let n;if(e.basedOnDisplacement)switch(e.sourceOfDisplacement){case"vectorChild":n=e.vectorChild[0].stateValues.nDimensions;break;case"pointChild":n=e.pointChild[0].stateValues.nDimensions;break;case"displacementAttr":n=e.displacementAttr.stateValues.nDimensions;break;case"xsAttr":n=e.xsAttr.stateValues.nComponents;break;case"componentAttrs":e.zAttr!==null?n=3:e.yAttr!==null?n=2:n=1;break;default:let r=e.displacementShadow.tree;Array.isArray(r)&&["tuple","vector"].includes(r[0])?n=r.length-1:n=1}else e.basedOnHead?e.basedOnTail?e.nDimHead===e.nDimTail?n=e.nDimHead:n=NaN:n=e.nDimHead:e.basedOnTail?n=e.nDimTail:n=2;return{newValues:{nDimDisplacement:n},checkForActualChange:{nDimDisplacement:!0}}}},t.nDimHead={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let n={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["nDimensions"]}};return e.basedOnHead||(e.basedOnTail&&(n.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"}),e.basedOnDisplacement&&(n.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),n},definition:function({dependencyValues:e}){let n;if(e.basedOnHead){if(e.headAttr!==null)n=e.headAttr.stateValues.nDimensions;else if(e.headShadow){let r=e.headShadow.tree;Array.isArray(r)&&["tuple","vector"].includes(r[0])?n=r.length-1:n=2}}else e.basedOnDisplacement?e.basedOnTail?e.nDimDisplacement===e.nDimTail?n=e.nDimDisplacement:n=NaN:n=e.nDimDisplacement:e.basedOnTail?n=e.nDimTail:n=2;return{newValues:{nDimHead:n},checkForActualChange:{nDimHead:!0}}}},t.nDimTail={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let n={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["nDimensions"]}};return e.basedOnTail||(e.basedOnHead&&(n.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),e.basedOnDisplacement&&(n.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),n},definition:function({dependencyValues:e}){let n;if(e.basedOnTail){if(e.tailAttr!==null)n=e.tailAttr.stateValues.nDimensions;else if(e.tailShadow){let r=e.tailShadow.tree;Array.isArray(r)&&["tuple","vector"].includes(r[0])?n=r.length-1:n=2}}else e.basedOnDisplacement?e.basedOnHead?e.nDimDisplacement===e.nDimHead?n=e.nDimDisplacement:n=NaN:n=e.nDimDisplacement:e.basedOnHead?n=e.nDimHead:n=2;return{newValues:{nDimTail:n},checkForActualChange:{nDimTail:!0}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"},nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"},nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),definition:function({dependencyValues:e}){let n;if(e.basedOnDisplacement){if(e.basedOnTail){if(e.nDimDisplacement!==e.nDimTail)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}}}else if(e.basedOnHead&&e.nDimDisplacement!==e.nDimHead)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}};n=e.nDimDisplacement}else if(e.basedOnTail){if(e.basedOnHead&&e.nDimTail!==e.nDimHead)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}};n=e.nDimTail}else e.basedOnHead?n=e.nDimHead:n=2;return{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.displacement={public:!0,componentType:"math",isArray:!0,entryPrefixes:["x"],returnWrappingComponents(e){return e==="x"?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]},stateVariablesDeterminingDependencies:["basedOnDisplacement","sourceOfDisplacement"],returnArraySizeDependencies:()=>({nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"}}),returnArraySize({dependencyValues:e}){return[e.nDimDisplacement]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}},a={};for(let i of e){let s=Number(i)+1;a[i]={xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+s]},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["x"+s]},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["x"+s]},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector",variableNames:["x"+s]}},i==="0"?a[i].componentAttr={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:i==="1"?a[i].componentAttr={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:i==="2"&&(a[i].componentAttr={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]}),n.basedOnDisplacement||(a[i].tailX={dependencyType:"stateVariable",variableName:"tailX"+s},a[i].headX={dependencyType:"stateVariable",variableName:"headX"+s})}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={},i={};for(let l of r){let u=Number(l)+1;if(e.basedOnDisplacement)switch(e.sourceOfDisplacement){case"vectorChild":a[l]=n[l].vectorChild[0].stateValues["x"+u];break;case"pointChild":a[l]=n[l].pointChild[0].stateValues["x"+u];break;case"displacementAttr":a[l]=n[l].displacementAttr.stateValues["x"+u];break;case"xsAttr":a[l]=n[l].xsAttr.stateValues["math"+u].simplify();break;case"componentAttrs":let c=n[l].componentAttr;c===null?i[l]={defaultValue:Oe.fromAst(0)}:a[l]=c.stateValues.value.simplify();break;default:let d=e.displacementShadow.tree;Array.isArray(d)&&["tuple","vector"].includes(d[0])?a[l]=e.displacementShadow.get_component(Number(l)):a[l]=e.displacementShadow}else a[l]=n[l].headX.subtract(n[l].tailX).simplify()}let s={};return Object.keys(a).length>0&&(s.newValues={displacement:a}),Object.keys(i).length>0&&(s.useEssentialOrDefaultValue={displacement:i}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[],l=!1;for(let u in e.displacement)if(n.basedOnDisplacement)switch(n.sourceOfDisplacement){case"vectorChild":s.push({setDependency:a[u].vectorChild,desiredValue:e.displacement[u],childIndex:0,variableIndex:0});break;case"pointChild":s.push({setDependency:a[u].pointChild,desiredValue:e.displacement[u],childIndex:0,variableIndex:0});break;case"displacementAttr":s.push({setDependency:a[u].displacementAttr,desiredValue:e.displacement[u],variableIndex:0});break;case"xsAttr":s.push({setDependency:a[u].xsAttr,desiredValue:e.displacement[u],variableIndex:0});break;case"componentAttrs":r[u].componentAttr===null?s.push({setStateVariable:"displacement",value:{[u]:ne(e.displacement[u])}}):s.push({setDependency:a[u].componentAttr,desiredValue:e.displacement[u],variableIndex:0});break;default:l=!0}else s.push({setDependency:a[u].headX,desiredValue:r[u].tailX.add(e.displacement[u]).simplify()});if(l)if(i[0]>1){let u=["vector"];for(let c in e.displacement)u[Number(c)+1]=e.displacement[c].tree;u.length=i[0]+1,s.push({setDependency:"displacementShadow",desiredValue:Oe.fromAst(u)})}else i[0]===1&&"0"in e.displacement&&s.push({setDependency:"displacementShadow",desiredValue:e.displacement[0]});return{success:!0,instructions:s}}},t.x={isAlias:!0,targetVariableName:"x1"},t.y={isAlias:!0,targetVariableName:"x2"},t.z={isAlias:!0,targetVariableName:"x3"},t.head={public:!0,componentType:"math",isArray:!0,entryPrefixes:["headX"],returnWrappingComponents(e){return e==="headX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},stateVariablesDeterminingDependencies:["basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"}}),returnArraySize({dependencyValues:e}){return[e.nDimHead]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"}},a={};for(let i of e){let s=Number(i)+1;a[i]={headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["x"+s]}},n.basedOnHead||(a[i].tailX={dependencyType:"stateVariable",variableName:"tailX"+s},n.basedOnDisplacement&&(a[i].x={dependencyType:"stateVariable",variableName:"x"+s}))}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={},i={};for(let l of r){let u=Number(l)+1;e.basedOnHead?n[l].headAttr!==null?a[l]=n[l].headAttr.stateValues["x"+u]:e.headShadow!==null&&(a[l]=e.headShadow.get_component(Number(l))):e.basedOnDisplacement?a[l]=n[l].tailX.add(n[l].x).simplify():e.basedOnTail?i[l]={get defaultValue(){return l==="0"?n[l].tailX.add(Oe.fromAst(1)).simplify():n[l].tailX},variablesToCheck:["headX"+u]}:i[l]={get defaultValue(){return Oe.fromAst(l==="0"?1:0)},variablesToCheck:["headX"+u]}}let s={};return Object.keys(a).length>0&&(s.newValues={head:a}),Object.keys(i).length>0&&(s.useEssentialOrDefaultValue={head:i}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[],l=!1;for(let u in e.head)n.basedOnHead?r[u].headAttr&&r[u].headAttr!==null?s.push({setDependency:a[u].headAttr,desiredValue:e.head[u],variableIndex:0}):n.headShadow!==null&&(l=!0):n.basedOnDisplacement?s.push({setDependency:a[u].x,desiredValue:e.head[u].subtract(r[u].tailX).simplify()}):s.push({setStateVariable:"head",value:{[u]:e.head[u]}});if(l)if(i[0]>1){let u=["vector"];for(let c in e.head)u[Number(c)+1]=e.head[c].tree;u.length=i[0]+1,s.push({setDependency:"headShadow",desiredValue:Oe.fromAst(u)})}else i[0]===1&&"0"in e.head&&s.push({setDependency:"headShadow",desiredValue:e.head[0]});return{success:!0,instructions:s}}},t.tail={public:!0,componentType:"math",isArray:!0,entryPrefixes:["tailX"],returnWrappingComponents(e){return e==="tailX"?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},stateVariablesDeterminingDependencies:["basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),returnArraySize({dependencyValues:e}){return[e.nDimTail]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}},a={};for(let i of e){let s=Number(i)+1;a[i]={tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["x"+s]}},n.basedOnTail||(n.basedOnHead&&(a[i].headX={dependencyType:"stateVariable",variableName:"headX"+s}),n.basedOnDisplacement&&(a[i].x={dependencyType:"stateVariable",variableName:"x"+s}))}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={},i={};for(let l of r){let u=Number(l)+1;n[l].tailAttr!==null?a[l]=n[l].tailAttr.stateValues["x"+u]:e.tailShadow!==null?a[l]=e.tailShadow.get_component(Number(l)):e.basedOnHead&&e.basedOnDisplacement?a[l]=n[l].headX.subtract(n[l].x).simplify():i[l]={get defaultValue(){return Oe.fromAst(0)},variablesToCheck:["tailX"+u]}}let s={};return Object.keys(a).length>0&&(s.newValues={tail:a}),Object.keys(i).length>0&&(s.useEssentialOrDefaultValue={tail:i}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,arraySize:i}){let s=[],l=!1;for(let u in e.tail)r[u].tailAttr&&r[u].tailAttr!==null?s.push({setDependency:a[u].tailAttr,desiredValue:e.tail[u],variableIndex:0}):n.tailShadow!==null?l=!0:n.basedOnHead&&n.basedOnDisplacement?s.push({setDependency:a[u].x,desiredValue:r[u].headX.subtract(e.tail[u]).simplify()}):s.push({setStateVariable:"tail",value:{[u]:e.tail[u]}});if(l)if(i[0]>1){let u=["vector"];for(let c in e.tail)u[Number(c)+1]=e.tail[c].tree;u.length=i[0]+1,s.push({setDependency:"tailShadow",desiredValue:Oe.fromAst(u)})}else i[0]===1&&"0"in e.tail&&s.push({setDependency:"tailShadow",desiredValue:e.tail[0]});return{success:!0,instructions:s}}},t.numericalEndpoints={forRenderer:!0,returnDependencies:()=>({head:{dependencyType:"stateVariable",variableName:"head"},tail:{dependencyType:"stateVariable",variableName:"tail"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition:function({dependencyValues:e}){let n,r;if(e.nDimensions===1){let a=e.head.evaluate_to_constant();Number.isFinite(a)||(a=NaN),r=e.tail.evaluate_to_constant(),Number.isFinite(r)||(r=NaN)}else{n=[],r=[];for(let a=0;a<e.nDimensions;a++){let i=e.head[a].evaluate_to_constant();Number.isFinite(i)||(i=NaN),n.push(i);let s=e.tail[a].evaluate_to_constant();Number.isFinite(s)||(s=NaN),r.push(s)}}return{newValues:{numericalEndpoints:[r,n]}}}},t.displacementCoords={forRenderer:!0,returnDependencies:()=>({displacement:{dependencyType:"stateVariable",variableName:"displacement"}}),definition({dependencyValues:e}){let n=[];for(let r of e.displacement)r?n.push(r.tree):n.push("\uFF3F");return n.length>1?n=["vector",...n]:n.length===1?n=n[0]:n="\uFF3F",{newValues:{displacementCoords:Oe.fromAst(n)}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.numericalEndpoints[0][0],a=e.numericalEndpoints[0][1],i=e.numericalEndpoints[1][0],s=e.numericalEndpoints[1][1];if(!(Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(i)&&Number.isFinite(s)))return{};let l=i-r,u=s-a,c=l*l+u*u;if(c===0)return{};let d=n.x1.evaluate_to_constant(),p=n.x2.evaluate_to_constant();if(!(Number.isFinite(d)&&Number.isFinite(p)))return{};let m=((d-r)*l+(p-a)*u)/c,f={};return m<=0?f={x1:r,x2:a}:m>=1?f={x1:i,x2:s}:f={x1:r+m*l,x2:a+m*u},n.x3!==void 0&&(f.x3=0),f}}})},t}static adapters=[{stateVariable:"displacementCoords",componentType:"coords"}];moveVector({tailcoords:t,headcoords:e,transient:n,sourceInformation:r}){let a=[];if(t!==void 0){if(this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let i;e===void 0?i=t.map((s,l)=>this.stateValues.numericalEndpoints[1][l]-s):i=t.map((s,l)=>e[l]-s),a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:i.map(s=>Oe.fromAst(s)),sourceInformation:r})}else a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"tail",value:t.map(i=>Oe.fromAst(i)),sourceInformation:r});if(e===void 0&&!this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let i=t.map((s,l)=>this.stateValues.numericalEndpoints[1][l]-s);a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:i.map(s=>Oe.fromAst(s)),sourceInformation:r})}}if(e!==void 0){if(this.stateValues.basedOnHead||!this.stateValues.basedOnDisplacement)a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"head",value:e.map(i=>Oe.fromAst(i)),sourceInformation:r});else{t==null&&(t=this.stateValues.numericalEndpoints[0]);let i=t.map((s,l)=>e[l]-s);a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:i.map(s=>Oe.fromAst(s)),sourceInformation:r})}if(t===void 0&&this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let i=e.map((s,l)=>s-this.stateValues.numericalEndpoints[0][l]);a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:i.map(s=>Oe.fromAst(s)),sourceInformation:r})}}n?this.coreFunctions.requestUpdate({updateInstructions:a,transient:n}):this.coreFunctions.requestUpdate({updateInstructions:a,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{head:e,tail:t}}})}},xc=zi;import re from"math-expressions";var Hi=class extends se{static componentType="angle";static get stateVariablesShadowedForReference(){return["nPointsSpecified","points","radians","degrees","numericalPoints"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.radius={createComponentOfType:"math",createStateVariable:"radius",defaultValue:re.fromAst(1),public:!0},e.renderAsAcuteAngle={createComponentOfType:"boolean",createStateVariable:"renderAsAcuteAngle",defaultValue:!1,public:!0,forRenderer:!0},e.inDegrees={createComponentOfType:"boolean",createStateVariable:"inDegrees",defaultValue:!1,public:!0,forRenderer:!0},e.radians={createComponentOfType:"math"},e.degrees={createComponentOfType:"math"},e.through={createComponentOfType:"_pointListComponent"},e.betweenLines={createComponentOfType:"_lineListComponent"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:"s",replacementFunction:({matchedChildren:e})=>({success:!0,newAttributes:{radians:{componentType:"math",children:e}}})}),t}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.lineNames={returnDependencies:()=>({betweenLines:{dependencyType:"attributeComponent",attributeName:"betweenLines",variableNames:["lineNames"]}}),definition({dependencyValues:e}){let n=[];return e.betweenLines!==null&&(n=e.betweenLines.stateValues.lineNames),{newValues:{lineNames:n}}}},t.betweenLinesName={returnDependencies:()=>({betweenLines:{dependencyType:"attributeComponent",attributeName:"betweenLines"}}),definition({dependencyValues:e}){let n=null;return e.betweenLines!==null&&(n=e.betweenLines.componentName),{newValues:{betweenLinesName:n}}}},t.nPointsSpecified={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:e}){return e.through!==null?{newValues:{nPointsSpecified:e.through.stateValues.nPoints}}:{newValues:{nPointsSpecified:0}}}},t.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],stateVariablesDeterminingDependencies:["nPointsSpecified","betweenLinesName"],returnArraySizeDependencies:()=>({radians:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degrees:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]}}),returnArraySize({dependencyValues:e}){return e.radians!==null||e.degrees!==null?[0,0]:[3,2]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r,desiredEntrySize:a}){if(e==="pointX"){let i=n.split("_").map(s=>Number(s)-1);return i.length===2&&i.every((s,l)=>Number.isInteger(s)&&s>=0)?a?i.every((s,l)=>a[l]>0)?[String(i)]:[]:r?i.every((s,l)=>s<r[l])?[String(i)]:[]:[String(i)]:[]}else{let i=Number(n)-1;return a?a[0]>0&&Number.isInteger(i)&&i>=0?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:r?Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(s,l)=>i+","+l):[]:[]}},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={nPointsSpecified:{dependencyType:"value",value:n.nPointsSpecified}};n.betweenLinesName!==null&&(r.lineChildren={dependencyType:"child",parentName:n.betweenLinesName,childLogicName:"atLeastZeroLines",variableNames:["points","nDimensions","coeff0","coeffvar1","coeffvar2"]});let a={};for(let i of e){let[s,l]=i.split(",");if(s==="0"||n.nPointsSpecified>2){let u=Number(s)+1+"_"+(Number(l)+1);a[i]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+u]}}}else if(s==="2"&&n.nPointsSpecified===2){let u="2_"+(Number(l)+1);a[i]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+u]}}}}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey({dependencyValuesByKey:e,globalDependencyValues:n,arrayKeys:r}){if(n.lineChildren)if(n.lineChildren.length!==2)console.warn(`Cannot define an angle between ${n.lineChildren.length} line(s)`);else{let u=n.lineChildren[0],c=n.lineChildren[1],d=Nh(u,c);if(d===void 0){let C={};for(let T=0;T<3;T++)for(let v=0;v<2;v++)C[T+","+v]=re.fromAst("\uFF3F");return{newValues:{points:C}}}let p=d,m=u.stateValues.points[0][0].evaluate_to_constant(),f=u.stateValues.points[0][1].evaluate_to_constant(),h=u.stateValues.points[1][0].evaluate_to_constant(),y=u.stateValues.points[1][1].evaluate_to_constant(),b=[re.fromAst(p[0].tree+h-m),re.fromAst(p[1].tree+y-f)];m=c.stateValues.points[0][0].evaluate_to_constant(),f=c.stateValues.points[0][1].evaluate_to_constant(),h=c.stateValues.points[1][0].evaluate_to_constant(),y=c.stateValues.points[1][1].evaluate_to_constant();let g=[re.fromAst(p[0].tree+h-m),re.fromAst(p[1].tree+y-f)];return{newValues:{points:{"0,0":b[0],"0,1":b[1],"1,0":p[0],"1,1":p[1],"2,0":g[0],"2,1":g[1]}}}}let a=n.nPointsSpecified,i={},s={};for(let u of r){let[c,d]=u.split(",");if(c==="0"||a>2){let p=Number(c)+1+"_"+(Number(d)+1),m;e[u].through!==null&&(m=e[u].through.stateValues["pointX"+p]),m===void 0?c==="0"&&d==="1"||c==="2"&&d==="0"?s[u]={defaultValue:re.fromAst(1)}:s[u]={defaultValue:re.fromAst(0)}:i[u]=m}else if(c==="2"&&a===2){let p="2_"+(Number(d)+1),m;e[u].through!==null&&(m=e[u].through.stateValues["pointX"+p]),m===void 0?d==="0"?s[u]={defaultValue:re.fromAst(1)}:s[u]={defaultValue:re.fromAst(0)}:i[u]=m}else c==="2"&&d==="0"?s[u]={defaultValue:re.fromAst(1)}:s[u]={defaultValue:re.fromAst(0)}}let l={};return Object.keys(i).length>0&&(l.newValues={points:i}),Object.keys(s).length>0&&(l.useEssentialOrDefaultValue={points:s}),l}},t.radians={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({radians:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degrees:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]},points:{dependencyType:"stateVariable",variableName:"points"}}),definition({dependencyValues:e}){if(e.radians!==null)return{newValues:{radians:e.radians.stateValues.value.simplify()}};if(e.degrees!==null)return{newValues:{radians:e.degrees.stateValues.value.multiply(re.fromAst(["/","pi",180])).simplify()}};let n=[],r=!1;for(let i=0;i<3;i++)n.push([e.points[i][0].evaluate_to_constant(),e.points[i][1].evaluate_to_constant()]),(n[i][0]===null||n[i][1]===null)&&(r=!0);let a;return r?{newValues:{radians:re.fromAst("\uFF3F")}}:(a=Math.atan2(n[2][1]-n[1][1],n[2][0]-n[1][0])-Math.atan2(n[0][1]-n[1][1],n[0][0]-n[1][0]),a<0&&(a+=2*Math.PI),{newValues:{radians:re.fromAst(a)}})}},t.value={isAlias:!0,targetVariableName:"radians"},t.angle={isAlias:!0,targetVariableName:"radians"},t.degrees={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({radians:{dependencyType:"stateVariable",variableName:"radians"}}),definition({dependencyValues:e}){let n;return e.radians.tree==="\uFF3F"||Number.isNaN(e.radians.tree)?n=e.radians:n=e.radians.multiply(re.fromAst(["/",180,"pi"])).simplify(),{newValues:{degrees:n}}}},t.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({radians:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degrees:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]}}),returnArraySize({dependencyValues:e}){return e.radians!==null||e.degrees!==null?[0]:[3]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(r)+1)}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n){let i=e[a].point,s=[];for(let l=0;l<2;l++){let u=i[l].evaluate_to_constant();Number.isFinite(u)||(u=NaN),s.push(u)}r[a]=s}return{newValues:{numericalPoints:r}}}},t.numericalRadius={forRenderer:!0,returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:e}){let n=e.radius.evaluate_to_constant();return Number.isFinite(n)||(n=NaN),{newValues:{numericalRadius:n}}}},t}static adapters=["radians"]},wc=Hi;function Nh(o,t){if(o.stateValues.nDimensions!==2||t.stateValues.nDimensions!==2){console.log("Calculating angle between two lines implemented only in 2D");return}let e=o.stateValues.coeffvar1.evaluate_to_constant(),n=o.stateValues.coeffvar2.evaluate_to_constant(),r=o.stateValues.coeff0.evaluate_to_constant(),a=t.stateValues.coeffvar1.evaluate_to_constant(),i=t.stateValues.coeffvar2.evaluate_to_constant(),s=t.stateValues.coeff0.evaluate_to_constant();if(!(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(i)&&Number.isFinite(s))){console.log("Calculating angle between two lines implemented only for constant coefficients");return}let l=e*i-a*n;if(Math.abs(l)<1e-14)if(Math.abs(s*e-r*a)>1e-14){console.log("Cannot calculate angle between two parallel lines");return}else return e===0&&n===0&&r===0||a===0&&i===0&&s===0?void 0:n!==0?[re.fromAst(0),re.fromAst(-r/n)]:[re.fromAst(-r/e),re.fromAst(0)];let u=(s*n-r*i)/l,c=(r*a-s*e)/l;return[re.fromAst(u),re.fromAst(c)]}var ji=class extends E{constructor(t){super(t);Object.defineProperty(this.actions,"submitAllAnswers",{get:function(){return this.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>null}.bind(this)})}static componentType="answer";static renderChildren=!0;static variableForPlainMacro="submittedResponses";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},e.inline={createComponentOfType:"boolean",createStateVariable:"inline",defaultValue:!1,public:!0,propagateToDescendants:!0},e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0,propagateToDescendants:!0},e.fixedOrder={createComponentOfType:"boolean",createStateVariable:"fixedOrder",defaultValue:!1,public:!0,propagateToDescendants:!0},e.size={createComponentOfType:"number",createStateVariable:"size",defaultValue:10,public:!0,propagateToDescendants:!0},e.forceFullCheckworkButton={createComponentOfType:"boolean",createStateVariable:"forceFullCheckworkButton",defaultValue:!1,public:!0},e.forceFullCheckworkButton={createComponentOfType:"boolean",createStateVariable:"forceFullCheckworkButton",defaultValue:!1,public:!0,propagateToDescendants:!0},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0,propagateToDescendants:!0},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0,propagateToDescendants:!0},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0,propagateToDescendants:!0},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0,propagateToDescendants:!0},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0,propagateToDescendants:!0},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0,propagateToDescendants:!0},e.feedbackDefinitions={createComponentOfType:"feedbackDefinitions",createStateVariable:"feedbackDefinitions",public:!0,propagateToDescendants:!0,mergeArrays:!0},e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0,propagateToDescendants:!0},e.showCorrectness={createComponentOfType:"boolean",createStateVariable:"showCorrectness",defaultValue:t.flags?t.flags.showCorrectness!==!1:!0,forRenderer:!0},e.type={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:r,componentAttributes:a}){let i;return a.type?i=a.type:i="math",["math","text"].includes(i)||(console.warn(`Invalid type ${i}`),i="math"),{success:!0,newChildren:[{componentType:"award",children:[{componentType:i,children:r}]}]}};t.push({childrenRegex:"s",replacementFunction:e});function n({matchedChildren:r,componentAttributes:a,componentInfoObjects:i}){let s=!1;for(let c of r){if(i.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"_input"}))return{success:!1};if(i.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"considerAsResponses"}))return{success:!1};(i.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"_composite"})||i.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"award"})&&c.children&&!c.children.some(d=>i.isInheritedComponentType({inheritedComponentType:d.componentType,baseComponentType:"when"})))&&(s=!0)}if(!s)return{success:!1};let u=[{componentType:a.type==="text"?"textInput":"mathInput"},...r];return{success:!0,newChildren:u}}return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroAwards",componentType:"award",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroInputs",componentType:"_input",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroConsiderAsResponses",componentType:"considerAsResponses",comparison:"atLeast",number:0});return e.newOperator({name:"awardsInputResponses",operator:"and",propositions:[n,r,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.haveAwardThatRequiresInput={returnDependencies:()=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["requireInputInAnswer"]}}),definition({dependencyValues:e}){return{newValues:{haveAwardThatRequiresInput:e.awardChildren.some(n=>n.stateValues.requireInputInAnswer)}}}},t.allInputChildren={returnDependencies:()=>({allInputChildren:{dependencyType:"child",childLogicName:"atLeastZeroInputs"}}),definition({dependencyValues:e}){return{newValues:{allInputChildren:e.allInputChildren}}}},t.inputChild={stateVariablesDeterminingDependencies:["allInputChildren"],additionalStateVariablesDefined:["inputChildIndex"],forRenderer:!0,returnDependencies({stateValues:e}){let n={allInputChildren:{dependencyType:"stateVariable",variableName:"allInputChildren"},haveAwardThatRequiresInput:{dependencyType:"stateVariable",variableName:"haveAwardThatRequiresInput"}};for(let[r,a]of e.allInputChildren.entries())n[`child${r}FromSugar`]={dependencyType:"doenetAttribute",componentName:a.componentName,attributeName:"createdFromSugar"};return n},definition({dependencyValues:e}){let n=null,r=null;for(let[a,i]of e.allInputChildren.entries())if(e[`child${a}FromSugar`])e.haveAwardThatRequiresInput&&!n&&(n=i,r=a);else{n=i,r=a;break}return{newValues:{inputChild:n,inputChildIndex:r}}}},t.inputChildWithValues={stateVariablesDeterminingDependencies:["inputChildIndex"],forRenderer:!0,returnDependencies:({stateValues:e})=>({inputChild:{dependencyType:"child",childLogicName:"atLeastZeroInputs",variableNames:["valueToRecordOnSubmit","valueRecordedAtSubmit","value","immediateValue"],childIndices:[e.inputChildIndex],variablesOptional:!0}}),definition:function({dependencyValues:e}){return e.inputChild.length===1?{newValues:{inputChildWithValues:e.inputChild[0]}}:{newValues:{inputChildWithValues:null}}}},t.awardInputResponseChildren={returnDependencies:()=>({awardInputResponseChildren:{dependencyType:"child",childLogicName:"awardsInputResponses"}}),definition:({dependencyValues:e})=>({newValues:{awardInputResponseChildren:e.awardInputResponseChildren}})},t.nResponses={stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnDependencies({stateValues:e,componentInfoObjects:n}){let r={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map(a=>a.componentType)}};for(let[a,i]of e.awardInputResponseChildren.entries())n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"award"})?r["child"+a]={dependencyType:"descendant",ancestorName:i.componentName,componentTypes:["_base"],variableNames:["isResponse","nValues"],variablesOptional:!0,recurseToMatchedChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"_input"})?r["childNValues"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"nValues",variablesOptional:!0}:r["child"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"childrenWithNValues"};return r},definition({dependencyValues:e,componentInfoObjects:n}){let r=0;for(let[a,i]of e.childTypes.entries())if(n.isInheritedComponentType({inheritedComponentType:i,baseComponentType:"award"}))for(let s of e["child"+a])!s.stateValues.isResponse||n.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"_composite"})||(s.stateValues.nValues===void 0?r+=1:r+=s.stateValues.nValues);else if(n.isInheritedComponentType({inheritedComponentType:i,baseComponentType:"_input"})){let s=e["childNValues"+a];s===void 0?r+=1:r+=s}else for(let s of e["child"+a])s.stateValues.nValues===void 0?r+=1:r+=s.stateValues.nValues;return{newValues:{nResponses:r}}}},t.currentResponses={public:!0,isArray:!0,entryPrefixes:["currentResponse"],hasVariableComponentType:!0,defaultEntryValue:"\uFF3F",stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnArraySizeDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),returnArraySize({dependencyValues:e}){return[e.nResponses]},returnArrayDependenciesByKey({stateValues:e,componentInfoObjects:n}){let r={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map(a=>a.componentType)}};for(let[a,i]of e.awardInputResponseChildren.entries())n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"award"})?r["child"+a]={dependencyType:"descendant",ancestorName:i.componentName,componentTypes:["_base"],variableNames:["isResponse","value","values","componentType"],variablesOptional:!0,recurseToMatchedChildren:!0,includeAttributeChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"_input"})?(r["childValue"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"value",variablesOptional:!0},r["childValues"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"values",variablesOptional:!0},r["childComponentType"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"componentType",variablesOptional:!0}):r["child"+a]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"childrenAsResponses"};return{globalDependencies:r}},arrayDefinitionByKey({globalDependencyValues:e,componentInfoObjects:n}){let r=[],a=[],i=[];for(let[s,l]of e.childTypes.entries())if(n.isInheritedComponentType({inheritedComponentType:l,baseComponentType:"award"}))for(let u of e["child"+s])!u.stateValues.isResponse||n.isInheritedComponentType({inheritedComponentType:u.componentType,baseComponentType:"_composite"})||i.push(u);else if(n.isInheritedComponentType({inheritedComponentType:l,baseComponentType:"_input"})){let u={componentType:l,stateValues:{value:e["childValue"+s],values:e["childValues"+s],componentType:e["childComponentType"+s]}};i.push(u)}else i.push(...e["child"+s]);for(let s of i){let l=s.stateValues.componentType;l||(l=s.componentType),Array.isArray(s.stateValues.values)?(r.push(...s.stateValues.values),a.push(...Array(s.stateValues.values.length).fill(l))):(r.push(s.stateValues.value),a.push(l))}return{newValues:{currentResponses:r},setComponentType:{currentResponses:a}}}},t.currentResponse={isAlias:!0,targetVariableName:"currentResponse1"},t.nSubmittedResponses={public:!0,componentType:"number",returnDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),definition:({dependencyValues:e})=>({useEssentialOrDefaultValue:{nSubmittedResponses:{variablesToCheck:["nSubmittedResponses"],defaultValue:0}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"nSubmittedResponses",value:e.nSubmittedResponses}]}}},t.submittedResponsesComponentType={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedResponsesComponentType:{variablesToCheck:["submittedResponsesComponentType"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return e.submittedResponsesComponentType?{success:!0,instructions:[{setStateVariable:"submittedResponsesComponentType",value:[...e.submittedResponsesComponentType]}]}:{success:!0,instructions:[{setStateVariable:"submittedResponsesComponentType",value:[]}]}}},t.submittedResponses={public:!0,isArray:!0,entryPrefixes:["submittedResponse"],defaultEntryValue:"\uFF3F",essential:!0,componentType:"math",hasVariableComponentType:!0,returnArraySizeDependencies:()=>({nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}),returnArraySize({dependencyValues:e}){return[e.nSubmittedResponses]},returnArrayDependenciesByKey(){return{globalDependencies:{submittedResponsesComponentType:{dependencyType:"stateVariable",variableName:"submittedResponsesComponentType"},nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n=[];e.submittedResponsesComponentType&&n.push(...e.submittedResponsesComponentType.slice(0,e.nSubmittedResponses));let r={};for(let a=0;a<e.nSubmittedResponses;a++)r[a]={variablesToCheck:[{variableName:"submittedResponses",arrayIndex:a}]},n[a]||(n[a]="math");return{useEssentialOrDefaultValue:{submittedResponses:r},setComponentType:{submittedResponses:n}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"nSubmittedResponses",desiredValue:e.submittedResponses.length},{setStateVariable:"submittedResponses",value:[...e.submittedResponses]}]}}},t.submittedResponse={isAlias:!0,targetVariableName:"submittedResponse1"},t.delegateCheckWork={additionalStateVariablesDefined:["delegateCheckWorkToInput","delegateCheckWorkToAncestor",{variableName:"submitAllAnswersAtAncestor",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({inputChild:{dependencyType:"stateVariable",variableName:"inputChild"},forceFullCheckworkButton:{dependencyType:"stateVariable",variableName:"forceFullCheckworkButton"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons","componentNameForSubmitAll","answerDelegatedForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition:function({dependencyValues:e,componentName:n}){let r=!1,a=!1,i=!1,s=null;if(e.sectionAncestor){let l=e.sectionAncestor.stateValues;l.suppressAnswerSubmitButtons&&(l.answerDelegatedForSubmitAll===n?s=l.componentNameForSubmitAll:r=i=!0)}return!r&&e.inputChild&&!e.forceFullCheckworkButton&&(a=i=!0),{newValues:{delegateCheckWork:i,delegateCheckWorkToAncestor:r,delegateCheckWorkToInput:a,submitAllAnswersAtAncestor:s}}}},t.creditAchievedIfSubmit={additionalStateVariablesDefined:["awardUsedIfSubmit","awardChildren","inputUsedIfSubmit"],stateVariablesDeterminingDependencies:["inputChildIndex"],returnDependencies:({stateValues:e})=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["credit","creditAchieved","fractionSatisfied"]},inputChild:{dependencyType:"child",childLogicName:"atLeastZeroInputs",variableNames:["creditAchievedIfSubmit"],childIndices:[e.inputChildIndex],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=0,r=null,a=null;if(e.awardChildren.length===0){if(e.inputChild.length===1){let i=e.inputChild[0].stateValues.creditAchievedIfSubmit;i>=0&&(n=i,a=e.inputChild[0].componentName)}}else for(let i of e.awardChildren)if(Math.max(0,Math.min(1,i.stateValues.credit))>n||r===null){let l=i.stateValues.creditAchieved;i.stateValues.fractionSatisfied>0&&(l>n||r===null)&&(n=l,r=i.componentName)}return{newValues:{creditAchievedIfSubmit:n,awardUsedIfSubmit:r,awardChildren:e.awardChildren,inputUsedIfSubmit:a}}}},t.creditAchieved={defaultValue:0,public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:{variablesToCheck:["creditAchieved"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"creditAchieved",value:e.creditAchieved}]}}},t.responseHasBeenSubmitted={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{responseHasBeenSubmitted:{variablesToCheck:["responseHasBeenSubmitted"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"responseHasBeenSubmitted",value:e.responseHasBeenSubmitted}]}}},t.creditAchievedDependencies={returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"recursiveDependencyValues",variableName:"creditAchievedIfSubmit",changedValuesOnly:!0}}),definition({dependencyValues:e}){return{newValues:{creditAchievedDependencies:e.currentCreditAchievedDependencies}}}},t.creditAchievedDependenciesAtSubmit={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchievedDependenciesAtSubmit:{variablesToCheck:["creditAchievedDependenciesAtSubmit"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"creditAchievedDependenciesAtSubmit",value:e.creditAchievedDependenciesAtSubmit}]}}},t.justSubmitted={forRenderer:!0,returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"stateVariable",variableName:"creditAchievedDependencies"},creditAchievedDependenciesAtSubmit:{dependencyType:"stateVariable",variableName:"creditAchievedDependenciesAtSubmit"}}),definition:function({dependencyValues:e}){return{newValues:{justSubmitted:_t(e.currentCreditAchievedDependencies,e.creditAchievedDependenciesAtSubmit)}}}},t.creditAchievedForSubmitButton={additionalStateVariablesDefined:[{variableName:"justSubmittedForSubmitButton",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"},justSubmitted:{dependencyType:"stateVariable",variableName:"justSubmitted"},submitAllAnswersAtAncestor:{dependencyType:"stateVariable",variableName:"submitAllAnswersAtAncestor"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition({dependencyValues:e}){if(e.submitAllAnswersAtAncestor){let n=e.sectionAncestor.stateValues;return{newValues:{creditAchievedForSubmitButton:n.creditAchievedForSubmitAll,justSubmittedForSubmitButton:n.justSubmittedForSubmitAll}}}else return{newValues:{creditAchievedForSubmitButton:e.creditAchieved,justSubmittedForSubmitButton:e.justSubmitted}}}},t.allFeedbacks={returnDependencies:()=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["feedbacks"]},feedbackComponents:{dependencyType:"descendant",componentTypes:["_input"],variableNames:["feedbacks"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.awardChildren)n.push(...r.stateValues.feedbacks);for(let r of e.feedbackComponents)Array.isArray(r.stateValues.feedbacks)&&n.push(...r.stateValues.feedbacks);return{newValues:{allFeedbacks:n}}}},t.numberFeedbacks={public:!0,componentType:"number",returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:e}){return{newValues:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},t.feedbacks={public:!0,componentType:"feedback",isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:e}){return[e.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n={};for(let r=0;r<e.__array_size;r++)n[r]=e.allFeedbacks[r];return{newValues:{feedbacks:n}}}},t}actions={submitAnswer:this.submitAnswer.bind(new Proxy(this,this.readOnlyProxyHandler))};submitAnswer(){let t=this.stateValues.creditAchievedIfSubmit,e=this.stateValues.awardUsedIfSubmit,n=this.stateValues.inputUsedIfSubmit,r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchieved",value:t},{updateType:"updateValue",componentName:this.componentName,stateVariable:"responseHasBeenSubmitted",value:!0}];this.stateValues.inputChildWithValues&&n===this.stateValues.inputChildWithValues.componentName&&"valueToRecordOnSubmit"in this.stateValues.inputChildWithValues.stateValues&&"valueRecordedAtSubmit"in this.stateValues.inputChildWithValues.stateValues&&r.push({updateType:"updateValue",componentName:this.stateValues.inputChildWithValues.componentName,stateVariable:"valueRecordedAtSubmit",value:this.stateValues.inputChildWithValues.stateValues.valueToRecordOnSubmit}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponses",value:this.stateValues.currentResponses}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponsesComponentType",value:this.state.currentResponses.componentType}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchievedDependenciesAtSubmit",value:this.stateValues.creditAchievedDependencies});for(let i of this.stateValues.awardChildren){let s=i.componentName===e;r.push({updateType:"updateValue",componentName:i.componentName,stateVariable:"awarded",value:s})}let a=[];for(let i of this.stateValues.currentResponses)i.toString?a.push(i.toString()):a.push(i);this.coreFunctions.requestUpdate({updateInstructions:r,event:{verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.currentResponses,responseText:a,creditAchieved:t}}})}},Dc=ji;import Th from"math-expressions";var qi=class extends B{static componentType="award";static rendererType=void 0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:1,public:!0},e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,propagateToDescendants:!0},e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0,propagateToDescendants:!0},e.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0,propagateToDescendants:!0},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0,propagateToDescendants:!0},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0,propagateToDescendants:!0},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0,propagateToDescendants:!0},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0,propagateToDescendants:!0},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0,propagateToDescendants:!0},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0,propagateToDescendants:!0},e.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0,propagateToDescendants:!0},e.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0,propagateToDescendants:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneWhen",componentType:"when",number:1}),r=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),a=e.newLeaf({name:"exactlyOneText",componentType:"text",number:1});return e.newOperator({name:"whenXorStringXorMathXorText",operator:"xor",propositions:[n,r,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.parsedExpression={additionalStateVariablesDefined:["requireInputInAnswer"],returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath"},textChild:{dependencyType:"child",childLogicName:"exactlyOneText"}}),definition:function({dependencyValues:e}){let n=null,r=!1;return(e.mathChild.length===1||e.textChild.length===1)&&(r=!0,n=Th.fromAst(["=","comp1","comp2"])),{newValues:{parsedExpression:n,requireInputInAnswer:r}}}},t.creditAchieved={additionalStateVariablesDefined:["fractionSatisfied"],returnDependencies:()=>({credit:{dependencyType:"stateVariable",variableName:"credit"},whenChild:{dependencyType:"child",childLogicName:"exactlyOneWhen",variableNames:["fractionSatisfied"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value","unordered","expand","simplify"]},textChild:{dependencyType:"child",childLogicName:"exactlyOneText",variableNames:["value"]},answerInput:{dependencyType:"parentStateVariable",variableName:"inputChildWithValues"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"}}),definition:function({dependencyValues:e,usedDefault:n}){let r;if(e.whenChild.length===1)r=e.whenChild[0].stateValues.fractionSatisfied;else{if(!e.answerInput||!e.parsedExpression)return{newValues:{creditAchieved:0,fractionSatisfied:0}};r=Vh({dependencyValues:e,usedDefault:n})}let a=0;return Number.isFinite(e.credit)&&(a=Math.max(0,Math.min(1,e.credit))*Math.max(0,Math.min(1,r))),{newValues:{fractionSatisfied:r,creditAchieved:a}}}},t.awarded={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{awarded:{variablesToCheck:"awarded"}}}),inverseDefinition:function({desiredStateVariableValues:e,initialChange:n}){return n?{success:!0,instructions:[{setStateVariable:"awarded",value:e.awarded}]}:{success:!1}}},t.allFeedbacks={returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitions:{dependencyType:"parentStateVariable",variableName:"feedbackDefinitions"},awarded:{dependencyType:"stateVariable",variableName:"awarded"}}),definition:function({dependencyValues:e}){if(!e.awarded)return{newValues:{allFeedbacks:[]}};let n=[];for(let r of e.feedbackCodes){let a=r.toLowerCase();for(let i of e.feedbackDefinitions)if(a===i.feedbackCode){n.push(i.feedbackText);break}}return e.feedbackText!==null&&n.push(e.feedbackText),{newValues:{allFeedbacks:n}}}},t.numberFeedbacks={public:!0,componentType:"number",returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:e}){return{newValues:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},t.feedbacks={public:!0,componentType:"feedback",isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:e}){return[e.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n={};for(let r=0;r<e.__array_size;r++)n[r]=e.allFeedbacks[r];return{newValues:{feedbacks:n}}}},t.feedback={isAlias:!0,targetVariableName:"feedback1"},t}static adapters=["awarded"];static standardizedFeedback={numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."}},Ac=qi;function Vh({dependencyValues:o,usedDefault:t}){let e={mathChildrenByCode:{},mathListChildrenByCode:{},textChildrenByCode:{},textListChildrenByCode:{},booleanChildrenByCode:{},booleanListChildrenByCode:{}};Object.assign(e,o);let n=o.unorderedCompare,r=o.simplifyOnCompare,a=o.expandOnCompare,i=t.unorderedCompare,s=t.simplifyOnCompare,l=t.expandOnCompare;if(o.textChild.length===1)e.textChildrenByCode.comp2=o.textChild[0];else if(o.mathChild.length===1){let d=o.mathChild[0];e.mathChildrenByCode.comp2=d,i&&d.stateValues.unordered&&(n=!0),l&&d.stateValues.expand&&(a=!0),s&&(d.stateValues.simplify==="full"?r="full":d.stateValues.simplify==="numbers"?r!=="full"&&(r="numbers"):d.stateValues.simplify==="numberspreserveorder"&&r!=="full"&&r!=="numbers"&&(r="numberspreserveorder"))}let u=o.answerInput.stateValues.immediateValue;u===void 0&&(u=o.answerInput.stateValues.value);let c={stateValues:{value:u}};return o.answerInput.componentType==="textInput"?e.textChildrenByCode.comp1=c:e.mathChildrenByCode.comp1=c,St({logicTree:o.parsedExpression.tree,unorderedCompare:n,simplifyOnCompare:r,expandOnCompare:a,dependencyValues:e})}import"math-expressions";var Ki=class extends Ae{static componentType="when";static rendererType=void 0;static stateVariableForAttributeValue="conditionSatisfied";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0},e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0},e.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0,propagateToDescendants:!0},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0,propagateToDescendants:!0},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0,propagateToDescendants:!0},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={additionalStateVariablesDefined:["fractionSatisfied","conditionSatisfied"],returnDependencies:()=>({matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","unordered"],variablesOptional:!0},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","expand","simplify"]},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"}}),definition({dependencyValues:e,usedDefault:n}){if(e.parsedExpression===null)return{newValues:{conditionSatisfied:!1,value:!1,fractionSatisfied:0}};let r=e.unorderedCompare,a=e.simplifyOnCompare,i=e.expandOnCompare,s=n.unorderedCompare,l=n.simplifyOnCompare,u=n.expandOnCompare;for(let p of e.stringMathTextBooleanChildren)s&&p.stateValues.unordered&&(r=!0);for(let p of e.mathChildren)u&&p.stateValues.expand&&(i=!0),l&&(p.stateValues.simplify==="full"?a="full":p.stateValues.simplify==="numbers"?a!=="full"&&(a="numbers"):p.stateValues.simplify==="numberspreserveorder"&&a!=="full"&&a!=="numbers"&&(a="numberspreserveorder"));let c=St({logicTree:e.parsedExpression.tree,unorderedCompare:r,simplifyOnCompare:a,expandOnCompare:i,dependencyValues:e}),d=c===1;return{newValues:{fractionSatisfied:c,conditionSatisfied:d,value:d}}}},t}},Sc=Ki;var Wi=class extends E{static componentType="_input";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.collaborateGroups={createComponentOfType:"collaborateGroups",createStateVariable:"collaborateGroups",defaultValue:void 0,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nValues={returnDependencies:()=>({}),definition:()=>({newValues:{nValues:1}})},t.answerAncestor={returnDependencies:()=>({answerAncestor:{dependencyType:"ancestor",componentType:"answer",variableNames:["delegateCheckWorkToInput","justSubmittedForSubmitButton","creditAchievedForSubmitButton","submitAllAnswersAtAncestor","showCorrectness"]}}),definition:function({dependencyValues:e}){return{newValues:{answerAncestor:e.answerAncestor}}}},t.includeCheckWork={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=!1;return e.answerAncestor&&(n=e.answerAncestor.stateValues.delegateCheckWorkToInput),{newValues:{includeCheckWork:n}}}},t.creditAchievedForSubmitButton={defaultValue:0,public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=0;return e.answerAncestor&&(n=e.answerAncestor.stateValues.creditAchievedForSubmitButton),{newValues:{creditAchievedForSubmitButton:n}}}},t.valueHasBeenValidated={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=!1;return e.answerAncestor&&e.answerAncestor.stateValues.justSubmittedForSubmitButton&&(n=!0),{newValues:{valueHasBeenValidated:n}}}},t.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:e}){let n;return e.answerAncestor?n=e.answerAncestor.stateValues.showCorrectness:n=e.showCorrectnessFlag!==!1,{newValues:{showCorrectness:n}}}},t}},Ye=Wi;import On from"math-expressions";var Ui=class extends Ye{constructor(t){super(t);this.actions={updateImmediateValue:this.updateImmediateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),updateValue:this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="mathInput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},e.size={createComponentOfType:"number",createStateVariable:"size",defaultValue:10,forRenderer:!0,public:!0},e.bindValueTo={createComponentOfType:"math"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value","valueForDisplay"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{newValues:{value:e.bindValueTo.stateValues.valueForDisplay}}:{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",get defaultValue(){return xh({inputString:e.prefill,format:e.format})}}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.immediateValue={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:n}){return n.value?{newValues:{immediateValue:e.value},makeEssential:["immediateValue"]}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:n,shadowedVariable:r}){let a=[{setStateVariable:"immediateValue",value:e.immediateValue}];return n||r||a.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:a}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value.toString()}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"math"}})},t}updateImmediateValue({mathExpression:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:t}],transient:!0})}updateValue(){if(!this.stateValues.disabled){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],e={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue.toString()}};this.stateValues.answerAncestor&&(e.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:t,event:e})}}},Ic=Ui;function xh({inputString:o,format:t}){if(!o)return On.fromAst("\uFF3F");let e;if(t==="latex")try{e=On.fromAst(Ke.convert(o))}catch(n){console.warn(`Invalid latex for mathInput: ${o}`),e=On.fromAst("\uFF3F")}else if(t==="text")try{e=On.fromAst(Z.convert(o))}catch(n){console.warn(`Invalid text for mathInput: ${o}`),e=On.fromAst("\uFF3F")}return e}var Gi=class extends Ye{constructor(t){super(t);this.actions={updateImmediateValue:this.updateImmediateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),updateValue:this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="textInput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e.size={createComponentOfType:"number",createStateVariable:"size",defaultValue:10,forRenderer:!0,public:!0},e.bindValueTo={createComponentOfType:"text"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{newValues:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.immediateValue={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:n}){return n.value?{newValues:{immediateValue:e.value},makeEssential:["immediateValue"]}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:n,shadowedVariable:r}){let a=[{setStateVariable:"immediateValue",value:e.immediateValue}];return n||r||a.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:a}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"text"}})},t}updateImmediateValue({text:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:t}]})}updateValue(){if(!this.stateValues.disabled){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],e={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue}};this.stateValues.answerAncestor&&(e.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:t,event:e})}}},Oc=Gi;var Xi=class extends Ye{constructor(t){super(t);this.updateBoolean=this.updateBoolean.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={updateBoolean:this.updateBoolean},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="booleanInput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.prefill={createComponentOfType:"boolean",createStateVariable:"prefill",defaultValue:!1,public:!0},e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"",forRenderer:!0,public:!0},e.bindValueTo={createComponentOfType:"boolean"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"boolean",forRenderer:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{newValues:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value?"true":"false"}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"boolean"}})},t.submittedValue={defaultValue:null,public:!0,componentType:"boolean",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedValue:{variablesToCheck:["submittedValue"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"submittedValue",value:e.submittedValue}]}}},t}updateBoolean({boolean:t}){let e=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],n={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}};this.stateValues.answerAncestor&&(n.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:e,event:n})}},kc=Xi;var Zi=class extends Ye{constructor(t){super(t);this.actions={updateSelectedIndices:this.updateSelectedIndices.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="choiceInput";static renderChildren=!0;static variableForPlainMacro="values";static createsVariants=!0;static get stateVariablesShadowedForReference(){return["choiceOrder","allSelectedIndices","indexMatchedByBoundValue"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.selectMultiple={createComponentOfType:"boolean",createStateVariable:"selectMultiple",defaultValue:!1,public:!0},e.assignPartialCredit={createComponentOfType:"boolean",createStateVariable:"assignPartialCredit",defaultValue:!1,public:!0},e.inline={createComponentOfType:"boolean",createStateVariable:"inline",defaultValue:!1,public:!0,forRenderer:!0},e.fixedOrder={createComponentOfType:"boolean",createStateVariable:"fixedOrder",defaultValue:!1,public:!0},e.feedbackDefinitions={createComponentOfType:"feedbackDefinitions",createStateVariable:"feedbackDefinitions",public:!0,propagateToDescendants:!0,mergeArrays:!0},e.bindValueTo={createComponentOfType:"text"},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroChoices",componentType:"choice",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numberChoices={public:!0,componentType:"number",returnDependencies:()=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices"}}),definition({dependencyValues:e}){return{newValues:{numberChoices:e.choiceChildren.length}}}},t.choiceOrder={forRenderer:!0,returnDependencies:({sharedParameters:e})=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},fixedOrder:{dependencyType:"stateVariable",variableName:"fixedOrder"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0},variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){let n=e.choiceChildren.length,r;if(e.fixedOrder)r=[...Array(n).keys()];else{if(e.variants&&e.variants.desiredVariant!==void 0){let a=e.variants.desiredVariant.indices;if(a!==void 0)if(a.length!==n)console.warn("Ignoring indices specified for choiceInput as number of indices doesn't match number of choice children.");else{if(a=a.map(Number),!a.every(Number.isInteger))throw Error("All indices specified for choiceInput must be integers");if(!a.every(i=>i>=0&&i<n))console.warn("Ignoring indices specified for choiceInput as some indices out of range.");else return{newValues:{choiceOrder:a}}}}r=[...Array(n).keys()];for(let a=n-1;a>0;a--){let i=e.selectRng.random(),s=Math.floor(i*(a+1));[r[a],r[s]]=[r[s],r[a]]}}return{newValues:{choiceOrder:r}}}},t.selectedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:e})=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},fixedOrder:{dependencyType:"stateVariable",variableName:"fixedOrder"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){if(e.fixedOrder)return{newValues:{isVariantComponent:!1,selectedVariantInfo:null}};let n={indices:e.choiceOrder},r=n.subvariants=[];for(let a of e.variantDescendants)a.stateValues.isVariantComponent?r.push(a.stateValues.selectedVariantInfo):a.stateValues.selectedVariantInfo&&r.push(...a.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n,isVariantComponent:!0}}}},t.choiceChildrenOrdered={additionalStateVariablesDefined:[{variableName:"numberChoices",public:!0,componentType:"number"}],returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices"}}),definition:function({dependencyValues:e}){let n=e.choiceChildren.length;return{newValues:{choiceChildrenOrdered:e.choiceOrder.map(a=>e.choiceChildren[a]),numberChoices:n}}}},t.choiceTexts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["choiceText"],forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:e}){return[e.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]}}}},arrayDefinitionByKey({globalDependencyValues:e}){return{newValues:{choiceTexts:e.choiceOrder.map(r=>e.choiceChildren[r]).map(r=>r.stateValues.text)}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"text"}})},t.indexMatchedByBoundValue={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}),definition({dependencyValues:e}){let n=e.choiceOrder.map(r=>e.choiceChildren[r]);if(e.bindValueTo!==null){let r=n.map(a=>a.stateValues.text.toLowerCase().trim());if(e.bindValueTo.stateValues.value){let a=r.indexOf(e.bindValueTo.stateValues.value.toLowerCase().trim());if(a!==-1)return{newValues:{indexMatchedByBoundValue:a+1}}}}return{newValues:{indexMatchedByBoundValue:null}}}},t.allSelectedIndices={defaultValue:[],returnDependencies(){return{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},indexMatchedByBoundValue:{dependencyType:"stateVariable",variableName:"indexMatchedByBoundValue"},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}},definition({dependencyValues:e}){if(e.bindValueTo!==null){let n;return e.indexMatchedByBoundValue!==null?n=[e.indexMatchedByBoundValue]:n=[],{newValues:{allSelectedIndices:n}}}else return{useEssentialOrDefaultValue:{allSelectedIndices:{variablesToCheck:["allSelectedIndices"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){if(n.bindValueTo===null)return{success:!0,instructions:[{setStateVariable:"allSelectedIndices",value:e.allSelectedIndices}]};{let r="";if(e.allSelectedIndices.length>0){let a=e.allSelectedIndices[0]-1,s=n.choiceOrder.map(l=>n.choiceChildren[l])[a];s&&(r=s.stateValues.text)}return{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:r,variableIndex:0}]}}}},t.nSelectedIndices={returnDependencies:()=>({allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}),definition({dependencyValues:e}){return{newValues:{nSelectedIndices:e.allSelectedIndices.length}}}},t.selectedIndices={public:!0,componentType:"number",isArray:!0,entryPrefixes:["selectedIndex"],forRenderer:!0,defaultEntryValue:0,returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:e}){return[e.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n={};for(let r in e.allSelectedIndices)n[r]=e.allSelectedIndices[r];return{newValues:{selectedIndices:n}}}},t.selectedIndex={isAlias:!0,targetVariableName:"selectedIndex1"},t.selectedValues={public:!0,componentType:"text",isArray:!0,entryPrefixes:["selectedValue"],returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:e}){return[e.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceTexts:{dependencyType:"stateVariable",variableName:"choiceTexts"}}}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:n}){let r={};for(let a in n)r[a]=e.choiceTexts[e.selectedIndices[a]-1];return{newValues:{selectedValues:r}}}},t.selectedValue={isAlias:!0,targetVariableName:"selectedValue1"},t.values={isAlias:!0,targetVariableName:"selectedValues"},t.nValues={isAlias:!0,targetVariableName:"nSelectedIndices"},t.childIndicesSelected={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"}}),definition({dependencyValues:e}){return{newValues:{childIndicesSelected:e.selectedIndices.map(r=>e.choiceOrder[r-1])}}}},t.creditAchievedIfSubmit={returnDependencies:()=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["selected","credit"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"},assignPartialCredit:{dependencyType:"stateVariable",variableName:"assignPartialCredit"}}),definition:function({dependencyValues:e}){let n=0;if(e.selectMultiple){let r=0,a=0,i=0;for(let s of e.choiceChildren)s.stateValues.selected?s.stateValues.credit===1?r++:a++:s.stateValues.credit===1&&i++;if(e.assignPartialCredit){let s=r+a+i;s===0?n=1:n=r/s}else a+i===0&&(n=1)}else for(let r of e.choiceChildren)if(r.stateValues.selected){n=r.stateValues.credit;break}return{newValues:{creditAchievedIfSubmit:n}}}},t.valueToRecordOnSubmit={isAlias:!0,targetVariableName:"selectedIndices"},t.submittedIndices={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["submitted"]}}),definition({dependencyValues:e}){let n=[],r=e.choiceOrder.map(a=>e.choiceChildren[a]);for(let[a,i]of r.entries())i.stateValues.submitted&&n.push(a+1);return{newValues:{submittedIndices:n}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){let r=[];for(let[a,i]of n.choiceOrder.entries())r.push({setDependency:"choiceChildren",desiredValue:e.submittedIndices.includes(a+1),variableIndex:0,childIndex:i});return{success:!0,instructions:r}}},t.valueRecordedAtSubmit={isAlias:!0,targetVariableName:"submittedIndices"},t.allFeedbacks={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["feedbacks"]}}),definition({dependencyValues:e}){let n=e.choiceOrder.map(a=>e.choiceChildren[a]),r=[];for(let a of n)r.push(...a.stateValues.feedbacks);return{newValues:{allFeedbacks:r}}}},t.numberFeedbacks={public:!0,componentType:"number",returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition({dependencyValues:e}){return{newValues:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}}}},t.feedbacks={public:!0,componentType:"feedback",isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize({dependencyValues:e}){return[e.numberFeedbacks]},returnArrayDependenciesByKey(){return{globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n={};for(let r=0;r<e.__array_size;r++)n[r]=e.allFeedbacks[r];return{newValues:{feedbacks:n}}}},t}updateSelectedIndices({selectedIndices:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"allSelectedIndices",value:t}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.map(e=>this.stateValues.choiceTexts[e-1])}}})}},Pc=Zi;var Ji=class extends E{static componentType="choice";static rendererType="container";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:0,public:!0},e.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0},e.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroChildren",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.text={public:!0,componentType:this.componentType,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroChildren",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return{newValues:{text:n}}}},t.selected={defaultValue:!1,public:!0,componentType:"boolean",returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},childIndicesSelected:{dependencyType:"parentStateVariable",variableName:"childIndicesSelected"}}),definition({dependencyValues:e}){return{newValues:{selected:e.childIndicesSelected.includes(e.countAmongSiblings-1)}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"selected",value:e.selected}]}}},t.submitted={defaultValue:!1,public:!0,componentType:"boolean",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submitted:{variablesToCheck:["submitted"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"submitted",value:e.submitted}]}}},t.feedbacks={public:!0,componentType:"feedbacktext",returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitions:{dependencyType:"parentStateVariable",variableName:"feedbackDefinitions"},submitted:{dependencyType:"stateVariable",variableName:"submitted"}}),definition({dependencyValues:e}){if(!e.submitted)return{newValues:{feedbacks:[]}};let n=[];for(let r of e.feedbackCodes){let a=r.toLowerCase();for(let i of e.feedbackDefinitions)if(a===i.feedbackCode){n.push(i.feedbackText);break}}return e.feedbackText!==null&&n.push(e.feedbackText),{newValues:{feedbacks:n}}}},t}static includeBlankStringChildren=!0;static adapters=["submitted"]},Rc=Ji;import Bc from"math-expressions";var Yi=class extends tn{static componentType="integer";static rendererType="number";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value.definition=function({dependencyValues:e}){if(e.numberChild.length===0){if(e.stringChild.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value"]}}};let n=Number(e.stringChild[0].stateValues.value);if(Number.isNaN(n))try{n=Bc.fromAst(Z.convert(e.stringChild[0].stateValues.value)).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return{newValues:{value:Math.round(n)}}}else return{newValues:{value:Math.round(e.numberChild[0].stateValues.value)}}},t.value.inverseDefinition=function({desiredStateVariableValues:e,dependencyValues:n,stateValues:r}){if(!r.canBeModified)return{success:!1};let a=e.value;a instanceof Bc.class?a=a.evaluate_to_constant():a=Number(a),a=Math.round(a);let i;return n.numberChild.length===0?n.stringChild.length===0?i=[{setStateVariable:"value",value:a}]:i=[{setDependency:"stringChild",desiredValue:a.toString(),childIndex:0,variableIndex:0}]:i=[{setDependency:"numberChild",desiredValue:a,childIndex:0,variableIndex:0}],{success:!0,instructions:i}},t}},Fc=Yi;var Qi=class extends X{static componentType="graph";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.xmin={createComponentOfType:"number",createStateVariable:"xmin",defaultValue:-10,public:!0,forRenderer:!0},e.xmax={createComponentOfType:"number",createStateVariable:"xmax",defaultValue:10,public:!0,forRenderer:!0},e.ymin={createComponentOfType:"number",createStateVariable:"ymin",defaultValue:-10,public:!0,forRenderer:!0},e.ymax={createComponentOfType:"number",createStateVariable:"ymax",defaultValue:10,public:!0,forRenderer:!0},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:300,public:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:300,public:!0},e.displayXAxis={createComponentOfType:"boolean",createStateVariable:"displayXAxis",defaultValue:!0,public:!0,forRenderer:!0},e.displayYAxis={createComponentOfType:"boolean",createStateVariable:"displayYAxis",defaultValue:!0,public:!0,forRenderer:!0},e.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},e.ylabel={createComponentOfType:"text",createStateVariable:"ylabel",defaultValue:"",public:!0,forRenderer:!0},e.showNavigation={createComponentOfType:"boolean",createStateVariable:"showNavigation",defaultValue:!0,public:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){return n[0].state.value.includes(",")?{success:!1}:{success:!0,newChildren:[{componentType:"curve",children:n}]}};return t.push({childrenRegex:"s",replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroGraphical",componentType:"_graphical",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.graphicalDescendants={forRenderer:!0,returnDependencies:()=>({graphicalDescendants:{dependencyType:"descendant",componentTypes:["_graphical"]}}),definition:function({dependencyValues:e}){return{newValues:{graphicalDescendants:e.graphicalDescendants}}}},t.numericalWidth={forRenderer:!0,returnDependencies:()=>({width:{dependencyType:"stateVariable",variableName:"width"}}),definition:({dependencyValues:e})=>({newValues:{numericalWidth:parseInt(e.width)}})},t.numericalHeight={forRenderer:!0,returnDependencies:()=>({height:{dependencyType:"stateVariable",variableName:"height"}}),definition:({dependencyValues:e})=>({newValues:{numericalHeight:parseInt(e.height)}})},t}},Lc=Qi;import"math-expressions";var es=class extends ft{static componentType="variables";static additionalStateVariablesForProperties=["validVariables"];static stateVariableForAttributeValue="variables";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.variables={public:!0,componentType:"variable",isArray:!0,entryPrefixes:["var"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:n}){return[n.nComponents]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n)r[a]={math:{dependencyType:"stateVariable",variableName:"math"+(Number(a)+1)}};return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r)a[i]=n[i].math;return{newValues:{variables:a}}}};let e=this.componentType;return t.validVariables={returnDependencies:()=>({variables:{dependencyType:"stateVariable",variableName:"variables"}}),definition:function({dependencyValues:n}){let r=[];for(let a of n.variables){let i=a.tree,s=!0;typeof i=="string"?i==="\uFF3F"&&(s=!1):(!Array.isArray(i)||i[0]!=="_"||typeof i[1]!="string"||typeof i[2]!="string"&&typeof i[2]!="number")&&(s=!1),s||(console.warn("Invalid value for "+e),s=!1),r.push(s)}return{newValues:{validVariables:r}}}},t}},Ec=es;var ts=class extends pe{static componentType="variable";static rendererType="math";static additionalStateVariablesForProperties=["validVariable"];static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.validVariable={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let n=e.value.tree,r=!0;return typeof n=="string"?n==="\uFF3F"&&(r=!1):(!Array.isArray(n)||n[0]!=="_"||typeof n[1]!="string"||typeof n[2]!="string"&&typeof n[2]!="number")&&(r=!1),r||console.warn("Invalid value of a "+this.componentType),{newValues:{validVariable:r}}}},t}},Mc=ts;import fe from"math-expressions";var ns=class extends G{static componentType="sequence";static assignNamesToReplacements=!0;static get stateVariablesShadowedForReference(){return["specifiedFrom","specifiedTo","specifiedLength","specifiedStep","specifiedExclude"]}static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={createPrimitiveOfType:"text"},e.from={createComponentOfType:"_componentWithSelectableType"},e.to={createComponentOfType:"_componentWithSelectableType"},e.step={createComponentOfType:"math"},e.length={createComponentOfType:"number"},e.exclude={createComponentOfType:"_componentListWithSelectableType"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.type={returnDependencies:()=>({type:{dependencyType:"attribute",attributeName:"type"}}),definition:function({dependencyValues:n}){return n.type?{newValues:{type:n.type}}:{newValues:{type:"number"}}}},t.specifiedFrom={returnDependencies:()=>({fromAttr:{dependencyType:"attributeComponent",attributeName:"from",variableNames:["value"]}}),defaultValue:null,definition:function({dependencyValues:n}){return n.fromAttr===null?{useEssentialOrDefaultValue:{specifiedFrom:{variablesToCheck:["from","specifiedFrom"]}}}:n.fromAttr.stateValues.value===null?{newValues:{specifiedFrom:NaN}}:{newValues:{specifiedFrom:n.fromAttr.stateValues.value}}}},t.specifiedTo={returnDependencies:()=>({toAttr:{dependencyType:"attributeComponent",attributeName:"to",variableNames:["value"]}}),defaultValue:null,definition:function({dependencyValues:n}){return n.toAttr===null?{useEssentialOrDefaultValue:{specifiedTo:{variablesToCheck:["to","specifiedTo"]}}}:n.toAttr.stateValues.value===null?{newValues:{specifiedTo:NaN}}:{newValues:{specifiedTo:n.toAttr.stateValues.value}}}},t.specifiedLength={returnDependencies:()=>({lengthAttr:{dependencyType:"attributeComponent",attributeName:"length",variableNames:["value"]}}),defaultValue:null,definition:function({dependencyValues:n}){return n.lengthAttr===null?{useEssentialOrDefaultValue:{specifiedLength:{variablesToCheck:["length","specifiedLength"]}}}:n.lengthAttr.stateValues.value===null?{newValues:{specifiedLength:NaN}}:{newValues:{specifiedLength:n.lengthAttr.stateValues.value}}}},t.specifiedStep={returnDependencies:()=>({stepAttr:{dependencyType:"attributeComponent",attributeName:"step",variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"}}),defaultValue:null,definition:function({dependencyValues:n}){if(n.stepAttr===null)return{useEssentialOrDefaultValue:{specifiedStep:{variablesToCheck:["step","specifiedStep"]}}};let r=n.stepAttr.stateValues.value;return r===null?{newValues:{specifiedStep:NaN}}:{newValues:{specifiedStep:r}}}},t.specifiedExclude={returnDependencies:()=>({excludeAttr:{dependencyType:"attributeComponent",attributeName:"exclude",variableNames:["values"]}}),defaultValue:[],definition:function({dependencyValues:n}){return n.excludeAttr===null?{useEssentialOrDefaultValue:{specifiedExclude:{variablesToCheck:["exclude"]}}}:{newValues:{specifiedExclude:n.excludeAttr.stateValues.values}}}},t.lowercase={returnDependencies:()=>({specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"}}),definition:function({dependencyValues:n}){let r=/^[A-Z]*$/,a=!0;return n.specifiedFrom!==null?r.test(n.specifiedFrom)&&(a=!1):n.specifiedTo!==null&&r.test(n.specifiedTo)&&(a=!1),{newValues:{lowercase:a}}}},t.validSequence={returnDependencies:()=>({specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition:function({dependencyValues:n}){let r=!0;if(n.specifiedLength!==null&&(!Number.isInteger(n.specifiedLength)||n.specifiedLength<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),r=!1),n.specifiedStep!==null&&n.type!=="math"){let a=de(n.specifiedStep);Number.isFinite(a)||(console.warn("Invalid step of sequence.  Must be a number for sequence of type "+n.type+"."),r=!1)}if(n.specifiedFrom!==null)if(n.type==="number"){let a=de(n.specifiedFrom);Number.isFinite(a)||(console.warn("Invalid from of number sequence.  Must be a number"),r=!1)}else Number.isNaN(n.specifiedFrom)&&(console.warn("Invalid from of sequence"),r=!1);if(n.specifiedTo!==null)if(n.type==="number"){let a=de(n.specifiedTo);Number.isFinite(a)||(console.warn("Invalid from of number sequence.  Must be a number"),r=!1)}else Number.isNaN(n.specifiedTo)&&(console.warn("Invalid to of sequence"),r=!1);return{newValues:{validSequence:r}}}};let e=this;return t.from={additionalStateVariablesDefined:["step","length","exclude"],returnDependencies:()=>({specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},type:{dependencyType:"stateVariable",variableName:"type"},specifiedExclude:{dependencyType:"stateVariable",variableName:"specifiedExclude"},validSequence:{dependencyType:"stateVariable",variableName:"validSequence"}}),definition:function({dependencyValues:n}){let r=n.specifiedFrom,a=n.specifiedTo,i=n.specifiedStep,s=n.specifiedLength,l=[...n.specifiedExclude],u=n.type;if(n.type==="math")a!==null&&(a instanceof fe.class||(a=fe.fromAst(a))),r!==null&&(r instanceof fe.class||(r=fe.fromAst(r))),i!==null&&(i instanceof fe.class||(i=fe.fromAst(i)));else if(i!==null&&i instanceof fe.class&&(i=i.evaluate_to_constant()),n.type==="letters"){r!==null&&typeof r=="string"&&(r=Ct(r)),a!==null&&typeof a=="string"&&(a=Ct(a));for(let[c,d]of l.entries())typeof d=="string"&&(l[c]=Ct(d))}else if(n.type==="number"){a!==null&&(a instanceof fe.class?a=a.evaluate_to_constant():a=Number(a)),r!==null&&(r instanceof fe.class?r=r.evaluate_to_constant():r=Number(r));for(let[c,d]of l.entries())d instanceof fe.class?l[c]=d.evaluate_to_constant():l[c]=Number(d)}if(n.validSequence){let c=e.calculateSequenceParameters({from:r,to:a,step:i,length:s,type:u});return c.exclude=l,{newValues:c}}return(!Number.isInteger(s)||s<0)&&(s=0),{newValues:{from:r,step:i,length:s,exclude:l}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({from:{dependencyType:"stateVariable",variableName:"from"},length:{dependencyType:"stateVariable",variableName:"length"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"},exclude:{dependencyType:"stateVariable",variableName:"exclude"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpandWhenResolved:!0}}}},t}static calculateSequenceParameters({from:t,to:e,step:n,length:r,type:a}){if(t===null)e===null?(a==="math"?t=fe.fromAst(1):t=1,n===null&&(a==="math"?n=fe.fromAst(1):n=1),r===null&&(r=10)):(n===null&&(a==="math"?n=fe.fromAst(1):n=1),r===null&&(a==="math"?r=Math.floor(e.subtract(1).divide(n).evaluate_to_constant()+1):r=Math.floor((e-1)/n+1)),a==="math"?t=e.subtract(n.multiply(r-1)).simplify():(t=e-n*(r-1),a==="letters"&&t<1&&(r=Math.floor((e-1)/n+1),t=e-n*(r-1))));else if(e===null)n===null&&(a==="math"?n=fe.fromAst(1):n=1),r===null&&(r=10);else if(n===null)r===null?a==="math"?(n=fe.fromAst(1),r=Math.floor(e.subtract(t).add(1).evaluate_to_constant())):(n=1,r=Math.floor(e-t+1)):a==="math"?n=e.subtract(t).divide(r-1):(n=(e-t)/(r-1),a==="letters"&&(n=Math.floor(n)));else if(r===null)a==="math"?r=Math.floor(e.subtract(t).divide(n).add(1).evaluate_to_constant()):r=Math.floor((e-t)/n+1);else throw Error("Can't define from, to, step, and length for sequence");return(!Number.isInteger(r)||r<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),r=0),{from:t,step:n,length:r}}static createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}){if(!t.stateValues.validSequence)return e.lastReplacementParameters={from:null,length:null,step:null,type:null,exclude:null},{replacements:[]};e.lastReplacementParameters={from:t.stateValues.from,length:t.stateValues.length,step:t.stateValues.step,type:t.stateValues.type,exclude:t.stateValues.exclude};let r=[],a=t.stateValues.length;for(let s=0;s<a;s++){let l=t.stateValues.from;if(s>0&&(t.stateValues.type==="math"?l=l.add(t.stateValues.step.multiply(fe.fromAst(s))).expand().simplify():l+=t.stateValues.step*s),t.stateValues.type==="math"){if(t.stateValues.exclude.some(d=>d&&d.equals(l)))continue}else if(t.stateValues.exclude.includes(l))continue;let u=t.stateValues.type;t.stateValues.type==="letters"&&(l=kt(l,t.stateValues.lowercase),u="text");let c={componentType:u,state:{value:l,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}};r.push(c)}return{replacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n}).serializedComponents}}static calculateReplacementChanges({component:t,workspace:e,componentInfoObjects:n}){let r=e.lastReplacementParameters,a=[];if(!t.stateValues.validSequence){if(t.replacements.length>0){let i=t.replacements.length,s={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};a.push(s)}return r.length=0,a}if(r.type!==t.stateValues.type||r.exclude.length>0||t.stateValues.exclude.length>0){let i=this.createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}).replacements,s={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:i,replacementsToWithhold:0};a.push(s)}else{let i=!1;t.stateValues.type==="math"?t.stateValues.from.equals(r.from)&&t.stateValues.step.equals(r.step)||(i=!0):(t.stateValues.from!==r.from||t.stateValues.step!==r.step)&&(i=!0);let s=r.length,l=0,u=0,c=s,d;if(t.stateValues.length<s){d=t.replacements.length-t.stateValues.length;let p={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};a.push(p)}else if(t.stateValues.length>s&&(l=t.stateValues.length-s,t.replacementsToWithhold>0))if(t.replacementsToWithhold>=l){d=t.replacementsToWithhold-l,u+=l,s+=l,l=0;let p={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};a.push(p)}else l-=t.replacementsToWithhold,u+=t.replacementsToWithhold,s+=t.replacementsToWithhold,d=0;if(i===!0&&(u=s,c=0),u>0)for(let p=c;p<c+u;p++){let m=t.stateValues.from;p>0&&(t.stateValues.type==="math"?m=m.add(t.stateValues.step.multiply(fe.fromAst(p))).expand().simplify():m+=t.stateValues.step*p),t.stateValues.type==="letters"&&(m=kt(m,t.stateValues.lowercase));let f={changeType:"updateStateVariables",component:t.replacements[p],stateChanges:{value:m}};a.push(f)}if(l>0){let p=[];for(let h=s;h<t.stateValues.length;h++){let y=t.stateValues.from;h>0&&(t.stateValues.type==="math"?y=y.add(t.stateValues.step.multiply(fe.fromAst(h))).expand().simplify():y+=t.stateValues.step*h);let b=t.stateValues.type;t.stateValues.type==="letters"&&(y=kt(y,t.stateValues.lowercase),b="text");let g={componentType:b,state:{value:y,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}};p.push(g)}let m=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:p,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n,indOffset:s}),f={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,serializedReplacements:m.serializedComponents,replacementsToWithhold:0,assignNamesOffset:s};a.push(f)}}return r.type=t.stateValues.type,r.from=t.stateValues.from,r.length=t.stateValues.length,r.step=t.stateValues.step,r.exclude=t.stateValues.exclude,a}get allPotentialRendererTypes(){return[this.componentInfoObjects.allComponentClasses[this.stateValues.type==="letters"?"text":this.stateValues.type].rendererType]}},sn=ns;function Ct(o){o=o.toUpperCase();let t=0,e=o.length,n=e;for(;(n-=1)>-1;){let r=o.charCodeAt(n)-64;if(r<1||r>26){console.warn("Cannot convert "+o+" to a number");return}t+=r*Math.pow(26,e-1-n)}return t}function kt(o,t){o--;let e=65;t&&(e=97);let n="";for(;;){let r=o%26;if(n=String.fromCharCode(e+r)+n,o<26)break;o=Math.floor(o/26)-1}return n}var rs=class extends G{static componentType="map";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.behavior={createComponentOfType:"text",createStateVariable:"behavior",defaultValue:"combination",public:!0,trim:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneTemplate",componentType:"template",number:1}),r=e.newLeaf({name:"atLeastOneSources",componentType:"sources",comparison:"atLeast",number:1});return e.newOperator({name:"templateSources",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nSources={additionalStateVariablesDefined:["sourcesNames","sourceAliases","sourceIndexAliases"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childLogicName:"atLeastOneSources",variableNames:["alias","indexAlias"]}}),definition:function({dependencyValues:e}){return{newValues:{nSources:e.sourcesChildren.length,sourcesNames:e.sourcesChildren.map(n=>n.componentName),sourceAliases:e.sourcesChildren.map(n=>n.stateValues.alias),sourceIndexAliases:e.sourcesChildren.map(n=>n.stateValues.indexAlias)}}}},t.nIterates={additionalStateVariablesDefined:["minNIterates","sourcesChildNames"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childLogicName:"atLeastOneSources",variableNames:["numberOfChildren","childComponentNames"]}}),definition:function({dependencyValues:e}){let n=e.sourcesChildren.map(i=>i.stateValues.numberOfChildren),r=Math.min(...n),a=e.sourcesChildren.map(i=>[...i.stateValues.childComponentNames]);return{newValues:{nIterates:n,minNIterates:r,sourcesChildNames:a}}}},t.template={returnDependencies:()=>({templateChild:{dependencyType:"child",childLogicName:"exactlyOneTemplate",variableNames:["serializedChildren","newNamespace"]}}),definition:function({dependencyValues:e}){let n=e.templateChild[0];if(!n)return{newValues:{template:null}};let r=n.stateValues.serializedChildren,a={componentType:"template",state:{rendered:!0},children:r,originalName:n.componentName};return n.stateValues.newNamespace&&(a.attributes={newNamespace:!0}),{newValues:{template:a}}}},t.validBehavior={returnDependencies:()=>({behavior:{dependencyType:"stateVariable",variableName:"behavior"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition:function({dependencyValues:e}){let n=!0;return e.behavior==="parallel"?e.nIterates.slice(1).some(r=>r!=e.nIterates[0])&&console.warn("Warning: map with parallel behavior and different numbers of iterates in sources activeChildren. Extra iterates will be ignored."):e.behavior!=="combination"&&(console.warn("Invalid map behavior: "+e.behavior),n=!1),{newValues:{validBehavior:n}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({validBehavior:{dependencyType:"stateVariable",variableName:"validBehavior"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpandWhenResolved:!0}}}},t}static createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}){if(!t.stateValues.validBehavior)return e.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0},{replacements:[]};e.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:t.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]};let r=[];if(t.stateValues.behavior==="parallel")for(let a=0;a<t.stateValues.minNIterates;a++)r.push(...this.parallelReplacement({component:t,iter:a,componentInfoObjects:n}));else r=this.recurseThroughCombinations({component:t,sourcesNumber:0,iterateNumber:-1,componentInfoObjects:n}).replacements;return{replacements:r}}static parallelReplacement({component:t,iter:e,componentInfoObjects:n}){let r=[H(t.stateValues.template)];return r=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n,indOffset:e}).serializedComponents,_c(r[0],t,Array(t.stateValues.nSources).fill(e)),r}static recurseThroughCombinations({component:t,sourcesNumber:e,childnumberArray:n=[],iterateNumber:r,componentInfoObjects:a}){let i=[],s=[...n,0];for(let l=0;l<t.stateValues.nIterates[e];l++)if(s[e]=l,e>=t.stateValues.nSources-1){r++;let u=[H(t.stateValues.template)],d=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:u,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:a,indOffset:r}).serializedComponents[0];_c(d,t,s),i.push(d)}else{let u=this.recurseThroughCombinations({component:t,sourcesNumber:e+1,childnumberArray:s,iterateNumber:r,componentInfoObjects:a});i.push(...u.replacements),r=u.iterateNumber}return{replacements:i,iterateNumber:r}}static calculateReplacementChanges({component:t,components:e,workspace:n,componentInfoObjects:r}){let a=[];if(!t.stateValues.validBehavior){if(n.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},t.replacements.length>0){let h={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length,replacementsToWithhold:0};a.push(h)}return a}let i=n.lastReplacementParameters,s=!1,l=!0;if(t.stateValues.nSources!==i.sourcesNames.length)l=!1;else for(let h=0;h<t.stateValues.nSources;h++)if(t.stateValues.sourcesNames[h]!==i.sourcesNames[h]){l=!1;break}if(!l||i.behavior!==t.stateValues.behavior)s=!0;else{let h=!0;if(i.nIterates===void 0)s=!0;else for(let y=0;y<t.stateValues.nSources;y++){let b=t.stateValues.nIterates[y],g=i.nIterates[y];b!==g&&(h=!1);let C=Math.min(b,g);for(let T=0;T<C;T++)if(t.stateValues.sourcesChildNames[y][T]!=i.sourcesChildNames[y][T]){s=!0,h=!1;break}if(s)break}if(h)return[];t.stateValues.behavior==="combination"&&t.stateValues.nSources>1&&(s=!0)}if(s){let h=this.createSerializedReplacements({component:t,workspace:n,componentInfoObjects:r}).replacements,y={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:h,replacementsToWithhold:0};return a.push(y),n.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:t.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},a}let u=t.stateValues.minNIterates,c=i.minNIterates,d=0,p=t.replacementsToWithhold;p||(p=0);let m=i.withheldSubstitutionChildNames,f=!1;if(u<c){for(let h=0;h<t.stateValues.nSources;h++)for(let y=u;y<c;y++)e[i.sourcesChildNames[h][y]]===void 0&&(f=!0);if(!f)for(let h of i.withheldSubstitutionChildNames)for(let y of h)e[y]===void 0&&(f=!0)}if(f){let h=Math.min(u,c),y=t.replacements.length-h,b={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:h,numberReplacementsToDelete:y,replacementsToWithhold:0};a.push(b),m=[],p=0}if(u<c){if(!f){d=t.replacements.length-u;let h={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};a.push(h);for(let y=0;y<t.stateValues.nSources;y++){let b=i.withheldSubstitutionChildNames[y];b?b=[...b]:b=[],b=new Set([...i.sourcesChildNames[y].slice(u),...b]),m[y]=b}}}else if(u>c){let h=u-c;if(p>0)if(p>=h){d=p-h,h=0;let y={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};a.push(y)}else h-=p,c+=p,d=0;if(h>0){let y=[];for(let C=c;C<u;C++)y.push(...this.parallelReplacement({component:t,iter:C,componentInfoObjects:r}));let b=0;t.doenetAttributes.assignNames&&(b=t.doenetAttributes.assignNames.length);let g={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c,serializedReplacements:y,replacementsToWithhold:0,assignNamesOffset:c};a.push(g)}}return n.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:u,replacementsToWithhold:d,withheldSubstitutionChildNames:m},a}static determineNumberOfUniqueVariants({serializedComponent:t}){return{success:!1}}get allPotentialRendererTypes(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}},$c=rs;function _c(o,t,e){let n=o.doenetAttributes.addToSharedParameters=[];for(let[r,a]of t.stateValues.sourceAliases.entries())if(a){let i=t.stateValues.sourcesNames[r];n.push({parameterName:"sourceNameMappings",key:a,value:{name:i,childNumber:e[r]}})}for(let[r,a]of t.stateValues.sourceIndexAliases.entries())a&&n.push({parameterName:"sourceIndexMappings",key:a,value:e[r]+1})}var as=class extends B{static componentType="sources";static rendererType="container";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.alias={createPrimitiveOfType:"string",validationFunction:function(n){if(!/[a-zA-Z_]/.test(n.substring(0,1)))throw Error("All aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(n))throw Error("Aliases can contain only letters, numbers, hyphens, and underscores");return n}},e.indexAlias={createPrimitiveOfType:"string",validationFunction:function(n){if(!/[a-zA-Z_]/.test(n.substring(0,1)))throw Error("All index aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(n))throw Error("Index aliases can contain only letters, numbers, hyphens, and underscores");return n}},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroChildren",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.alias={returnDependencies:()=>({alias:{dependencyType:"attribute",attributeName:"alias"}}),definition({dependencyValues:e}){return{newValues:{alias:e.alias}}}},t.indexAlias={returnDependencies:()=>({indexAlias:{dependencyType:"attribute",attributeName:"indexAlias"}}),definition({dependencyValues:e}){return{newValues:{indexAlias:e.indexAlias}}}},t.numberOfChildren={additionalStateVariablesDefined:["childComponentNames","childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"atLeastZeroChildren"}}),definition:function({dependencyValues:e}){let n=e.children.length,r=e.children.map(a=>a.componentName);return{newValues:{numberOfChildren:n,childComponentNames:r,childIdentities:e.children}}}},t}},zc=as;var is=class extends B{constructor(t){super(t);this.changeValue=this.changeValue.bind(this),this.actions={changeValue:this.changeValue}}static componentType="slider";static variableForPlainMacro="value";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:300,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:300,public:!0,forRenderer:!0},e.initialNumber={createComponentOfType:"number",createStateVariable:"initialNumber",defaultValue:void 0,public:!0},e.initialText={createComponentOfType:"text",createStateVariable:"initialText",defaultValue:void 0,public:!0},e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:void 0,public:!0,forRenderer:!0},e.showControls={createComponentOfType:"boolean",createStateVariable:"showControls",defaultValue:!1,public:!0,forRenderer:!0},e.showTicks={createComponentOfType:"boolean",createStateVariable:"showTicks",defaultValue:!0,public:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastOneTexts",componentType:"text",comparison:"atLeast",number:1}),a=e.newOperator({name:"numbersXorTextsXorSequence",operator:"xor",propositions:[r,n]}),i=e.newLeaf({name:"atMostOneMarkers",componentType:"markers",comparison:"atMost",number:1});return e.newOperator({name:"SliderLogic",operator:"and",propositions:[a,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sliderType={forRenderer:!0,returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts"},numberChildren:{dependencyType:"child",childLogicName:"atLeastZeroNumbers"}}),definition:function({dependencyValues:e}){let n;return e.textChildren.length>0?n="text":n="number",{newValues:{sliderType:n}}}},t.items={forRenderer:!0,public:!0,hasVariableComponentType:!0,returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts",variableNames:["value"]},numberChildren:{dependencyType:"child",childLogicName:"atLeastZeroNumbers",variableNames:["value"]},sliderType:{dependencyType:"stateVariable",variableName:"sliderType"}}),definition:function({dependencyValues:e}){let n;return e.sliderType==="text"?n=e.textChildren.map(r=>r.stateValues.value):e.numberChildren.length>0?(n=e.numberChildren.map(r=>r.stateValues.value),n.sort((r,a)=>r-a)):n=[...Array(11).keys()],{newValues:{items:n},setComponentType:{items:e.sliderType}}}},t.valueToIndex={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let n={};for(let[r,a]of e.items.entries())n[a]=r;return{newValues:{valueToIndex:n}}}},t.preliminaryValue={returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},initialNumber:{dependencyType:"stateVariable",variableName:"initialNumber"},initialText:{dependencyType:"stateVariable",variableName:"initialText"}}),definition({dependencyValues:e}){return{useEssentialOrDefaultValue:{preliminaryValue:{variablesToCheck:"value",get defaultValue(){return e.sliderType==="text"?e.initialText:e.initialNumber}}}}}},t.index={forRenderer:!0,returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},valueToIndex:{dependencyType:"stateVariable",variableName:"valueToIndex"},items:{dependencyType:"stateVariable",variableName:"items"},preliminaryValue:{dependencyType:"stateVariable",variableName:"preliminaryValue"}}),definition:function({dependencyValues:e}){let n=Hc(e),r=0;return n!==void 0&&(r=e.valueToIndex[n]),{newValues:{index:r}}}},t.value={forRenderer:!0,public:!0,essential:!0,hasVariableComponentType:!0,returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},items:{dependencyType:"stateVariable",variableName:"items"},index:{dependencyType:"stateVariable",variableName:"index"}}),definition:function({dependencyValues:e}){return{newValues:{value:e.items[e.index]},setComponentType:{value:e.sliderType}}},inverseDefinition:wh},t.markers={forRenderer:!0,returnDependencies:()=>({markersChild:{dependencyType:"child",childLogicName:"atMostOneMarkers",variableNames:["markerType","markers"]},sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let n=[];if(e.markersChild.length===1){let r=e.markersChild[0].stateValues.markerType;r==="empty"?n=[...e.items]:r!==e.sliderType?(console.warn("Markers type doesn't match slider type."),n=[]):n=e.markersChild[0].stateValues.markers}return{newValues:{markers:n}}}},t}changeValue({value:t,transient:e}){this.stateValues.disabled||(e?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],transient:e}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}}}))}},jc=is;function Hc({preliminaryValue:o,valueToIndex:t,sliderType:e,items:n}){let r=o;if(t[r]!==void 0)return r;if(e==="text")return;let i=function(l=0,u=n.length-1){if(u<=l+1)return r>n[l]?u:l;let c=Math.round((u+l)/2);return r>n[c]?i(c,u):i(l,c)},s=i();if(s===0)r=n[0];else{let l=n[s-1],u=n[s],c=Math.abs(r-l),d=Math.abs(r-u);c<d?r=l:r=u}return r}function wh({desiredStateVariableValues:o,stateValues:t}){let e=Hc({preliminaryValue:o.value,valueToIndex:t.valueToIndex,sliderType:t.sliderType,items:t.items});return e===void 0?{success:!1}:{success:!0,instructions:[{setStateVariable:"value",value:e},{setStateVariable:"preliminaryValue",value:e}]}}var ss=class extends B{static componentType="markers";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastOneNumbers",componentType:"number",comparison:"atLeast",number:1}),r=e.newLeaf({name:"atLeastOneTexts",componentType:"text",comparison:"atLeast",number:1}),a=e.newLeaf({name:"noTexts",componentType:"text",comparison:"exactly",number:0,allowSpillover:!1}),i=e.newLeaf({name:"noNumbers",componentType:"number",comparison:"exactly",number:0,allowSpillover:!1}),s=e.newOperator({name:"noTextAndNoNumbers",operator:"and",propositions:[i,a]});return e.newOperator({name:"MarkerLogic",operator:"xor",propositions:[n,r,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.markerType={public:!0,componentType:"text",returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts"},numberChildren:{dependencyType:"child",childLogicName:"atLeastOneNumbers"}}),definition:function({dependencyValues:e}){let n;return e.textChildren.length>0?n="text":e.numberChildren.length>0?n="number":n="empty",{newValues:{markerType:n}}}},t.markers={public:!0,isArray:!0,entryPrefixes:["item"],hasVariableComponentType:!0,returnDependencies:()=>({markerType:{dependencyType:"stateVariable",variableName:"markerType"},textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts",variableNames:["value"]},numberChildren:{dependencyType:"child",childLogicName:"atLeastOneNumbers",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n=[],r=e.markerType;return e.markerType==="text"?n=e.textChildren.map(a=>a.stateValues.value):e.markerType==="number"?(n=e.numberChildren.map(a=>a.stateValues.value),n.sort((a,i)=>a-i)):r="text",{newValues:{markers:n},setComponentType:{markers:r}}}},t}},qc=ss;function Nt({variables:o,applyComponentConstraint:t}){let e={},n=!1;for(let r in o){let a=t({[r]:o[r]});a.constrained&&(n=!0,e[r]=a.variables[r])}return n?{constrained:n,variables:e}:{}}var os=class extends B{static componentType="constraints";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroConstraints",componentType:"_constraint",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childLogicName:"atLeastZeroConstraints",variableNames:["independentComponentConstraints"]}}),definition:({dependencyValues:e})=>({newValues:{independentComponentConstraints:e.constraintChildren.every(n=>n.stateValues.independentComponentConstraints)}})},t.arrayEntryPrefixForConstraints={returnDependencies:()=>({arrayEntryPrefixForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayEntryPrefixForConstraints"}}),definition:({dependencyValues:e})=>({newValues:{arrayEntryPrefixForConstraints:e.arrayEntryPrefixForConstraints}})},t.arrayVariableForConstraints={returnDependencies:()=>({arrayVariableForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayVariableForConstraints"}}),definition:({dependencyValues:e})=>({newValues:{arrayVariableForConstraints:e.arrayVariableForConstraints}})},t.nDimensions={returnDependencies:()=>({nDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensionsForConstraints"}}),definition({dependencyValues:e}){return{newValues:{nDimensions:e.nDimensions}}}},t.constraintResults={additionalStateVariablesDefined:[{variableName:"constraintUsedByComponent",isArray:!0,entryPrefixes:["constraintUsedByComponent"]}],isArray:!0,entryPrefixes:["constraintResult"],stateVariablesDeterminingDependencies:["independentComponentConstraints","arrayEntryPrefixForConstraints","arrayVariableForConstraints"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={constraintChildren:{dependencyType:"child",childLogicName:"atLeastZeroConstraints",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"}},a=n.arrayEntryPrefixForConstraints,i={};if(n.independentComponentConstraints)for(let s of e)i[s]={x:{dependencyType:"parentStateVariable",variableName:a+(Number(s)+1)}};else{let s=n.arrayVariableForConstraints?n.arrayVariableForConstraints:"__null";r.xs={dependencyType:"parentStateVariable",variableName:s}}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){if(e.independentComponentConstraints){let a={},i={};for(let s of r){let l=Number(s)+1,u={["x"+l]:n[s].x},c=!1;for(let d of e.constraintChildren){let p=d.stateValues.applyComponentConstraint(u);p.constrained&&(u["x"+l]=p.variables["x"+l],c=!0)}a[s]=u["x"+l],i[s]=c}return{newValues:{constraintResults:a,constraintUsedByComponent:i}}}else{let a={},i=!1;for(let u in e.xs)a[`x${Number(u)+1}`]=e.xs[u];for(let u of e.constraintChildren){let c;u.stateValues.applyConstraint?c=u.stateValues.applyConstraint(a):c=Nt({variables:a,applyComponentConstraint:u.stateValues.applyComponentConstraint}),c.constrained&&(Object.assign(a,c.variables),i=!0)}let s={},l={};for(let u in e.xs)s[u]=a[`x${Number(u)+1}`],l[u]=i;return{newValues:{constraintResults:s,constraintUsedByComponent:l}}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:a,stateValues:i,workspace:s}){if(n.independentComponentConstraints){let l=[];for(let u in e.constraintResults){let c=Number(u)+1,d={["x"+c]:ne(e.constraintResults[u])};for(let p of n.constraintChildren){let m=p.stateValues.applyComponentConstraint(d);m.constrained&&(d["x"+c]=m.variables["x"+c])}l.push({setDependency:a[u].x,desiredValue:d["x"+c]})}return{success:!0,instructions:l}}else{let l={};s.desiredConstraintResults||(s.desiredConstraintResults={}),Object.assign(s.desiredConstraintResults,e.constraintResults);for(let c in i.constraintResults){let d=Number(c)+1;c in s.desiredConstraintResults?l["x"+d]=ne(s.desiredConstraintResults[c]):l["x"+d]=ne(i.constraintResults[c])}for(let c of n.constraintChildren){let d;c.stateValues.applyConstraint?d=c.stateValues.applyConstraint(l):d=Nt({variables:l,applyComponentConstraint:c.stateValues.applyComponentConstraint}),d.constrained&&Object.assign(l,d.variables)}let u={};for(let c in s.desiredConstraintResults)u[c]=l[`x${Number(c)+1}`];return{success:!0,instructions:[{setDependency:"xs",desiredValue:u}]}}}},t.constraintUsed={public:!0,componentType:"boolean",returnDependencies:()=>({constraintUsedByComponent:{dependencyType:"stateVariable",variableName:"constraintUsedByComponent"}}),definition:function({dependencyValues:e}){return{newValues:{constraintUsed:Object.values(e.constraintUsedByComponent).some(r=>r)}}}},t}},Kc=os;var ls=class extends B{static componentType="_constraint";static rendererType=void 0;static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{independentComponentConstraints:!1}})},t}},he=ls;var us=class extends he{static componentType="constrainToGrid";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},e.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},e.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},e.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},e.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},e.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{independentComponentConstraints:!0}})},t.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"}}),definition:({dependencyValues:e})=>({newValues:{applyComponentConstraint:function(n){if("x1"in n){let r=de(n.x1);if(!Number.isFinite(r))return{};let a=e.dx,i=e.xoffset,s=Math.round((n.x1-i)/a)*a+i;return Number.isFinite(s)?{constrained:!0,variables:{x1:s}}:{}}if("x2"in n){let r=de(n.x2);if(!Number.isFinite(r))return{};let a=e.dy,i=e.yoffset,s=Math.round((n.x2-i)/a)*a+i;return Number.isFinite(s)?{constrained:!0,variables:{x2:s}}:{}}if("x3"in n){let r=de(n.x3);if(!Number.isFinite(r))return{};let a=e.dz,i=e.zoffset,s=Math.round((n.x3-i)/a)*a+i;return Number.isFinite(s)?{constrained:!0,variables:{x3:s}}:{}}return{}}}})},t}},Wc=us;var cs=class extends he{static componentType="attractToGrid";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},e.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},e.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},e.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},e.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},e.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},e.xthreshold={createComponentOfType:"number",createStateVariable:"xthreshold",defaultValue:.2,public:!0},e.ythreshold={createComponentOfType:"number",createStateVariable:"ythreshold",defaultValue:.2,public:!0},e.zthreshold={createComponentOfType:"number",createStateVariable:"zthreshold",defaultValue:.2,public:!0},e.includeGridlines={createComponentOfType:"boolean",createStateVariable:"includeGridlines",defaultValue:!1,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"}}),definition:({dependencyValues:e})=>({newValues:{independentComponentConstraints:e.includeGridlines}})},t.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"}}),definition:({dependencyValues:e})=>({newValues:{applyComponentConstraint:function(n){if("x1"in n){let r=de(n.x1);if(!Number.isFinite(r))return{};let a=e.dx,i=e.xoffset,s=Math.round((n.x1-i)/a)*a+i;return Number.isFinite(s)&&Math.abs(n.x1-s)<e.xthreshold?{constrained:!0,variables:{x1:s}}:{}}if("x2"in n){let r=de(n.x2);if(!Number.isFinite(r))return{};let a=e.dy,i=e.yoffset,s=Math.round((n.x2-i)/a)*a+i;return Number.isFinite(s)&&Math.abs(n.x2-s)<e.ythreshold?{constrained:!0,variables:{x2:s}}:{}}if("x3"in n){let r=de(n.x3);if(!Number.isFinite(r))return{};let a=e.dz,i=e.zoffset,s=Math.round((n.x3-i)/a)*a+i;return Number.isFinite(s)&&Math.abs(n.x3-s)<e.zthreshold?{constrained:!0,variables:{x3:s}}:{}}return{}}}})},t.applyConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"},includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"},applyComponentConstraint:{dependencyType:"stateVariable",variableName:"applyComponentConstraint"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r={},a=!1;for(let i in n){let s=e.applyComponentConstraint({[i]:n[i]});s.constrained&&(a=!0,r[i]=s.variables[i])}if(!a)return{};if(!e.includeGridlines){if(n.x1!==void 0&&r.x1===void 0)return{};if(n.x2!==void 0&&r.x2===void 0)return{};if(n.x3!==void 0&&r.x3===void 0)return{}}return{constrained:a,variables:r}}}})},t}},Uc=cs;var ds=class extends he{static componentType="constrainTo";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneGraphical",componentType:"_graphical",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childLogicName:"atLeastOneGraphical",variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.graphicalChildren){if(!r.stateValues.nearestPoint){console.warn(`cannot attract to ${r.componentName} as it doesn't have a nearestPoint state variable`);continue}n.push(r.stateValues.nearestPoint)}return{newValues:{nearestPointFunctions:n}}}},t.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r=Infinity,a={},i=!1;for(let s of e.nearestPointFunctions){let l=s(n);if(l===void 0)continue;let u={},c=0;if(n.x1!==void 0){if(l.x1===void 0)continue;u.x1=l.x1,c+=Math.pow(n.x1-l.x1,2)}if(n.x2!==void 0){if(l.x2===void 0)continue;u.x2=l.x2,c+=Math.pow(n.x2-l.x2,2)}if(n.x3!==void 0){if(l.x3===void 0)continue;u.x3=l.x3,c+=Math.pow(n.x3-l.x3,2)}c<r&&(a=u,r=c,i=!0)}return i?{constrained:i,variables:a}:{}}}})},t}},Gc=ds;var ps=class extends he{static componentType="attractTo";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.5,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneGraphical",componentType:"_graphical",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childLogicName:"atLeastOneGraphical",variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.graphicalChildren){if(!r.stateValues.nearestPoint){console.warn(`cannot attract to ${r.componentName} as it doesn't have a nearestPoint state variable`);continue}n.push(r.stateValues.nearestPoint)}return{newValues:{nearestPointFunctions:n}}}},t.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r=Infinity,a={};for(let i of e.nearestPointFunctions){let s=i(n);if(s===void 0)continue;let l={},u=0;if(n.x1!==void 0){if(s.x1===void 0)continue;l.x1=s.x1,u+=Math.pow(n.x1-s.x1,2)}if(n.x2!==void 0){if(s.x2===void 0)continue;l.x2=s.x2,u+=Math.pow(n.x2-s.x2,2)}if(n.x3!==void 0){if(s.x3===void 0)continue;l.x3=s.x3,u+=Math.pow(n.x3-s.x3,2)}u<r&&(a=l,r=u)}return r>e.threshold*e.threshold?{}:{constrained:!0,variables:a}}}})},t}},Xc=ps;var ms=class extends he{static componentType="constraintUnion";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneConstraint",componentType:"_constraint",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.applyConstraint={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childLogicName:"atLeastOneConstraint",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r;if(e.constraintChildren.length===1){let l=e.constraintChildren[0];return l.stateValues.applyConstraint?r=l.stateValues.applyConstraint(n):r=Nt({variables:n,applyComponentConstraint:l.stateValues.applyComponentConstraint}),r}let a=Infinity,i={},s;for(let[l,u]of e.constraintChildren.entries()){if(u.stateValues.applyConstraint?r=u.stateValues.applyConstraint(n):r=Nt({variables:n,applyComponentConstraint:u.stateValues.applyComponentConstraint}),!r.constrained)continue;let c=0;for(let d in r.variables){let p=de(n[d]),m=de(r.variables[d]);if(!Number.isFinite(p)||!Number.isFinite(m)){c=Infinity;break}c+=Math.pow(p-m,2)}c<a&&(i=r,s=l+1,a=c)}return s===void 0?{}:(i.constraintIndices===void 0?i.constraintIndices=[s]:i.constraintIndices=[s,...i.constraintIndices],i)}}})},t}},Zc=ms;var fs=class extends he{static componentType="transformConstraintIntoAttractor";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.5,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneConstraint",componentType:"_constraint",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.applyConstraint={returnDependencies:()=>({constraintChild:{dependencyType:"child",childLogicName:"exactlyOneConstraint",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r,a=e.constraintChild[0];a.stateValues.applyConstraint?r=a.stateValues.applyConstraint(n):r=Nt({variables:n,applyComponentConstraint:a.stateValues.applyComponentConstraint});let i=0;for(let s in r.variables){let l=de(n[s]),u=de(r.variables[s]);if(!Number.isFinite(l)||!Number.isFinite(u))return{};i+=Math.pow(l-u,2)}return i>e.threshold*e.threshold?{}:r}}})},t}},Jc=fs;import Dh from"math-expressions";var hs=class extends G{static componentType="intersection";static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLines",componentType:"line",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.lineChildren={returnDependencies:()=>({lineChildren:{dependencyType:"child",childLogicName:"atLeastZeroLines",variableNames:["numericalCoeff0","numericalCoeffvar1","numericalCoeffvar2","nDimensions"]}}),definition:({dependencyValues:e})=>({newValues:{lineChildren:e.lineChildren}})},t.readyToExpandWhenResolved={returnDependencies:()=>({lineChildren:{dependencyType:"stateVariable",variableName:"lineChildren"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpandWhenResolved:!0}}}},t}static createSerializedReplacements({component:t,components:e}){let n=t.stateValues.lineChildren.length;if(n===0)return{replacements:[]};if(n===1){let y=t.stateValues.lineChildren[0].componentName,b=e[y].serialize({forCopy:!0});return b.state||(b.state={}),b.state.draggable=!1,b.state.fixed=!0,{replacements:Te({serializedComponents:[b],componentName:t.componentName})}}if(n>2)return console.warn("Haven't implemented intersection for more than two objects"),{replacements:[]};let r=t.stateValues.lineChildren[0],a=t.stateValues.lineChildren[1];if(r.stateValues.nDimensions!==2||a.stateValues.nDimensions!==2)return console.log("Intersection of lines implemented only in 2D"),{replacements:[]};let i=r.stateValues.numericalCoeffvar1,s=r.stateValues.numericalCoeffvar2,l=r.stateValues.numericalCoeff0,u=a.stateValues.numericalCoeffvar1,c=a.stateValues.numericalCoeffvar2,d=a.stateValues.numericalCoeff0;if(!(Number.isFinite(i)&&Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(u)&&Number.isFinite(c)&&Number.isFinite(d)))return console.log("Intersection of lines implemented only for constant coefficients"),{replacements:[]};let p=i*c-u*s;if(Math.abs(p)<1e-14){if(Math.abs(d*i-l*u)>1e-14)return{replacements:[]};if(i===0&&s===0&&l===0||u===0&&c===0&&d===0)return{replacements:[]};{let y=t.stateValues.lineChildren[0].componentName,b=e[y].serialize({forCopy:!0});return b.state||(b.state={}),b.state.draggable=!1,b.state.fixed=!0,{replacements:Te({serializedComponents:[b],componentName:t.componentName})}}}let m=(d*s-l*c)/p,f=(l*u-d*i)/p,h=Dh.fromAst(["vector",m,f]);return{replacements:[{componentType:"point",state:{coords:h,draggable:!1,fixed:!0}}]}}static calculateReplacementChanges({component:t,components:e}){let n=[],r=this.createSerializedReplacements({component:t,components:e}).replacements,a=r.length,i=!0;if(a===t.replacements.length){i=!1;for(let l=0;l<a;l++){if(r[l].componentType!==t.replacements[l].componentType){i=!0;break}if(r[l].state===void 0){console.warn("No state by which to update intersection component, so recreating"),i=!0;break}let u={changeType:"updateStateVariables",component:t.replacements[l],stateChanges:r[l].state};n.push(u)}}return i===!1?n:[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:r}]}},Yc=hs;var bs=class extends E{constructor(t){super(t);this.updateValue=this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={updateValue:this.updateValue}}static componentType="updateValue";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"update value",public:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneMathTarget",componentType:"mathtarget",number:1}),r=e.newLeaf({name:"exactlyOneNewMathValue",componentType:"newmathvalue",number:1});return e.newOperator({name:"updateValueLogic",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetedMathName={returnDependencies:()=>({mathTarget:{dependencyType:"child",childLogicName:"exactlyOneMathTarget",variableNames:["mathChildName"]}}),definition:function({dependencyValues:e}){return{newValues:{targetedMathName:e.mathTarget[0].stateValues.mathChildName}}}},t.newMathValue={returnDependencies:()=>({newMathValueChild:{dependencyType:"child",childLogicName:"exactlyOneNewMathValue",variableNames:["value"]}}),definition:function({dependencyValues:e}){return{newValues:{newMathValue:e.newMathValueChild[0].stateValues.value}}}},t}updateValue({}){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.stateValues.targetedMathName,stateVariable:"value",value:this.stateValues.newMathValue}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.newMathValue,responseText:this.stateValues.newMathValue.toString()}}})}},Qc=bs;var ys=class extends B{static componentType="mathtarget";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathChildName={returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath"}}),definition:function({dependencyValues:e}){return{newValues:{mathChildName:e.mathChild[0].componentName}}}},t}},ed=ys;var gs=class extends pe{static componentType="newmathvalue";static rendererType="math"},td=gs;var vs=class extends E{static componentType="panel";static rendererType="container";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.columns={createComponentOfType:"text",createStateVariable:"columns",defaultValue:null,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.breakpoints={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["width"]},columns:{dependencyType:"stateVariable",variableName:"columns"}}),definition:function({dependencyValues:e}){let n=[],r=e.children.map(a=>a.stateValues.width);if(e.columns!==null){let a;if(e.columns.indexOf(",")!==-1)a=e.columns.split(",").map(Number);else if(e.columns.indexOf("-")!==-1){let[u,c]=e.columns.split("-");a=[];for(let d=Number(u);d<=c;d++)a.push(d)}else a=[Number(e.columns)];let i={},s={};for(let u of a){let c=[],d=0;for(let p=0;p<u;p++){let m=-1;for(let f=p;f<r.length;f=f+u)r[f]>m&&(m=r[f]);c.push(m),d=d+Number(m)}i[u]=c,s[u]=d}let l=-1;for(let u of a){let c=Number.POSITIVE_INFINITY,d=-1;for(let p of a)s[p]<=c&&p>l&&(c=s[p],d=p);c<Number.POSITIVE_INFINITY&&(n.push({breakpoint:c,possibleColumnNumbers:d,arrayOfWidths:i[d]}),l=d)}}return{newValues:{breakpoints:n}}}},t}},nd=vs;var Cs=class extends he{static componentType="constrainToAngles";static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:d}){let p=[];for(let m of d)p.push({createdComponent:!0,componentName:m.componentName});return{success:!0,newChildren:[{componentType:"angles",children:p}]}},r=e.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),l=e.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),u=e.newOperator({name:"Angles",operator:"xor",propositions:[r,s,l],setAsBase:!0}),c=e.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return e.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[u,c],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let r=this.childLogic.returnMatches("AtMostOneAngles");r.length===1?this.state.anglesChild=this.activeChildren[r[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let a=this.childLogic.returnMatches("AtMostOnePoint");a.length===1?this.state.pointChild=this.activeChildren[a[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(n||e.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(n||e.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let r=0;r<this.state.pointChild.state.ndimensions;r++){let a=this.state.pointChild.state.xs[r].evaluate_to_constant();if(!Number.isFinite(a)){this.state.offset=NaN;break}this.state.offset.push(a)}}}}applyTheConstraint({x1:t,x2:e,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(t===void 0||e===void 0||n!==void 0)return{};if(t=this.findFiniteNumericalValue(t),e=this.findFiniteNumericalValue(e),!Number.isFinite(t)||!Number.isFinite(e))return{};if(r===void 0&&(r=this.state.offset),Number.isNaN(r))return{};let a=t-r[0],i=e-r[1],s=Math.atan2(i,a),l=Infinity,u,c;for(let[h,y]of this.state.angles.entries()){let b=y.state.angle.evaluate_to_constant();if(!Number.isFinite(b))continue;let g=Math.abs((b-s+Math.PI)%(2*Math.PI)-Math.PI);g<l&&(u=b,c=h,l=g)}if(u===void 0)return{};let d=Math.sqrt(a*a+i*i),p=r[0]+d*Math.cos(u),m=r[1]+d*Math.sin(u);return{variables:{x1:p,x2:m},constraintIndices:[c+1],constrained:!0}}},rd=Cs;var Ns=class extends he{static componentType="attractToAngles";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.3,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:d}){let p=[];for(let m of d)p.push({createdComponent:!0,componentName:m.componentName});return{success:!0,newChildren:[{componentType:"angles",children:p}]}},r=e.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),l=e.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),u=e.newOperator({name:"Angles",operator:"xor",propositions:[r,s,l],setAsBase:!0}),c=e.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return e.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[u,c],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let r=this.childLogic.returnMatches("AtMostOneAngles");r.length===1?this.state.anglesChild=this.activeChildren[r[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let a=this.childLogic.returnMatches("AtMostOnePoint");a.length===1?this.state.pointChild=this.activeChildren[a[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(n||e.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(n||e.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let r=0;r<this.state.pointChild.state.ndimensions;r++){let a=this.state.pointChild.state.xs[r].evaluate_to_constant();if(!Number.isFinite(a)){this.state.offset=NaN;break}this.state.offset.push(a)}}}}applyTheConstraint({x1:t,x2:e,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(t===void 0||e===void 0||n!==void 0)return{};if(t=this.findFiniteNumericalValue(t),e=this.findFiniteNumericalValue(e),!Number.isFinite(t)||!Number.isFinite(e))return{};if(r===void 0&&(r=this.state.offset),Number.isNaN(r))return{};let a=t-r[0],i=e-r[1],s=Math.atan2(i,a),l=Infinity,u,c;for(let[y,b]of this.state.angles.entries()){let g=b.state.angle.evaluate_to_constant();if(!Number.isFinite(g))continue;let C=Math.abs((g-s+Math.PI)%(2*Math.PI)-Math.PI);C<l&&(u=g,c=y,l=C)}if(u===void 0)return{};let d=Math.sqrt(a*a+i*i),p=r[0]+d*Math.cos(u),m=r[1]+d*Math.sin(u);return Math.sqrt(Math.pow(p-t,2)+Math.pow(m-e,2))>=this.state.threshold?{}:{variables:{x1:p,x2:m},constraintIndices:[c+1],constrained:!0}}},ad=Ns;var Ts=class extends G{static componentType="conditionalContent";static get stateVariablesShadowedForReference(){return["hide"]}static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.hide,e.condition={createComponentOfType:"condition"},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={returnDependencies:()=>({conditionAttr:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.conditionAttr===null?n=!0:n=!e.conditionAttr.stateValues.value,{newValues:{hide:n}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},anyChildren:{dependencyType:"child",childLogicName:"atLeastZeroAnything"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t.conditionName={returnDependencies:()=>({conditionAttr:{dependencyType:"attributeComponent",attributeName:"condition"}}),definition:function({dependencyValues:e}){let n;return e.conditionAttr!==null&&(n=e.conditionAttr.componentName),{newValues:{conditionName:n}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,workspace:e}){if(e.previouslyHidden=t.stateValues.hide,t.stateValues.hide)return{replacements:[]};let n=t.activeChildren.filter(r=>r.componentName!==t.stateValues.conditionName).map(r=>r.serialize({forCopy:!0}));return e.uniqueIdentifiersUsed||(e.uniqueIdentifiersUsed=[]),{replacements:Te({serializedComponents:n,componentName:t.componentName,uniqueIdentifiersUsed:e.uniqueIdentifiersUsed})}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r}){if(t.stateValues.hide){if(r.previouslyHidden)return[];{r.previouslyHidden=!0;let u=t.replacements.length;return[{changeType:"changeReplacementsToWithhold",replacementsToWithhold:u}]}}if(!r.previouslyHidden)return[];r.previouslyHidden=!1;let a=t.activeChildren.filter(u=>u.componentName!==t.stateValues.conditionName);if(t.replacements.length===a.length)return[{changeType:"changeReplacementsToWithhold",replacementsToWithhold:0}];let i=a.map(u=>u.serialize({forCopy:!0}));r.uniqueIdentifiersUsed||(r.uniqueIdentifiersUsed=[]);let s=Te({serializedComponents:i,componentName:t.componentName,uniqueIdentifiersUsed:r.uniqueIdentifiersUsed});return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,replacementsToWithhold:0,serializedReplacements:s}]}get allPotentialRendererTypes(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}return t}},id=Ts;var Vs=class extends E{static componentType="asList";static renderChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.text={public:!0,componentType:"text",returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let a of e.inlineChildren)typeof a.stateValues.text=="string"?n.push(a.stateValues.text):n.push("");return{newValues:{text:n.join(", ")}}}},t}},sd=Vs;import Sh from"math-expressions";function ae(o){if(o!==null&&o!==""){if(Number.isFinite(Number(o)))return Number(o)-1;if(typeof o=="string")return Ah(o)}}function Ah(o){o=o.toUpperCase();let t=0,e=o.length,n=e;for(;(n-=1)>-1;){let r=o.charCodeAt(n)-64;if(r<1||r>26){console.warn("Cannot convert "+o+" to a number");return}t+=r*Math.pow(26,e-1-n)}return t--,t}var xs=class extends B{static componentType="table";static rendererType="table";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={default:"400px"},e.minNumRows={default:1},e.minNumColumns={default:1},e.height={forRenderer:!0,dependentStateVariables:[{dependencyName:"numRows",variableName:"numRows"}],definitionForPropertyValue({dependencyValues:n,propertyChild:r}){if(r.length===0){let a;return Number.isFinite(n.numRows)&&n.numRows>=0?a=50+n.numRows*20:a=130,{newValues:{height:a}}}return{newValues:{height:r[0].stateValues.value}}}},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"zeroOrMoreCells",componentType:"cell",comparison:"atLeast",number:0}),r=e.newLeaf({name:"zeroOrMoreRows",componentType:"row",comparison:"atLeast",number:0}),a=e.newLeaf({name:"zeroOrMoreColumns",componentType:"column",comparison:"atLeast",number:0}),i=e.newLeaf({name:"zeroOrMoreCellblocks",componentType:"cellBlock",comparison:"atLeast",number:0});return e.newOperator({name:"cellsRowsColumnsBlocks",operator:"and",propositions:[n,r,a,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.cellNameToRowCol={additionalStateVariablesDefined:["cellNamesByRowCol"],returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childLogicName:"cellsRowsColumnsBlocks",variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:e,componentInfoObjects:n}){let r=od({cellRelatedChildren:e.cellRelatedChildren,componentInfoObjects:n});return{newValues:{cellNameToRowCol:r.cellNameToRowCol,cellNamesByRowCol:r.cellNamesByRowCol}}}},t.numRows={public:!0,componentType:"number",returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}),definition({dependencyValues:e}){let n=e.minNumRows;return Number.isFinite(n)||(n=4),n=Math.max(n,e.cellNamesByRowCol.length),{newValues:{numRows:n}}}},t.numColumns={public:!0,componentType:"number",returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}),definition({dependencyValues:e}){let n=e.minNumColumns;Number.isFinite(n)||(n=4);for(let r of e.cellNamesByRowCol)r&&(n=Math.max(n,r.length));return{newValues:{numColumns:n}}}},t.cells={public:!0,componentType:"cell",isArray:!0,entryPrefixes:["cell","row","column","range"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:e}){return[e.numRows,e.numColumns]},returnEntryDimensions:e=>e==="range"?2:1,containsComponentNamesToCopy:!0,targetAttributesToIgnoreOnCopy:["rowNum","colNum"],returnWrappingComponents(e){return e==="cell"?[]:e==="row"?[["row"]]:e===" col"?[["column"]]:[["row"],["cellBlock"]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="cell"){let a,i,s=/^([a-zA-Z]+)([1-9]\d*)$/,l=n.match(s);if(l)i=l[1],a=l[2];else{let d=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(l=n.match(d),l)a=l[1],i=l[2];else return[]}let u=ae(a),c=ae(i);return u>=0&&u<r[0]&&c>=0&&c<r[1]?[String(u)+","+String(c)]:[]}else if(e==="row"){let a=ae(n);if(!(a>=0&&a<r[0]))return[];let i=[],s=String(a)+",";for(let l=0;l<r[1];l++)i.push(s+l);return i}else if(e==="column"){let a=ae(n);if(!(a>=0&&a<r[1]))return[];let i=[],s=","+String(a);for(let l=0;l<r[1];l++)i.push(l+s);return i}else{let a,i,s,l,u=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,c=n.match(u);if(c)i=ae(c[1]),a=ae(c[2]),l=ae(c[3]),s=ae(c[4]);else{let y=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(c=n.match(y),c)a=ae(c[1]),i=ae(c[2]),s=ae(c[3]),l=ae(c[4]);else return[]}if(!(a>=0&&s>=0&&i>=0&&l>=0))return[];let d=Math.min(Math.min(a,s),r[0]-1),p=Math.min(Math.max(a,s),r[0]-1),m=Math.min(Math.min(i,l),r[1]-1),f=Math.min(Math.max(i,l),r[1]-1),h=[];for(let y=d;y<=p;y++){let b=[],g=String(y)+",";for(let C=m;C<=f;C++)b.push(g+C);h.push(b)}return h}},arrayVarNameFromArrayKey(e){return"cell("+e.split(",").map(n=>Number(n)+1).join(",")+")"},returnArrayDependenciesByKey(){return{globalDependencies:{cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:n}){let r={},a=e.cellNamesByRowCol;for(let i of n){let[s,l]=i.split(",");a[s]&&a[s][l]?r[i]=a[s][l]:r[i]=null}return{newValues:{cells:r}}}},t.childrenToRender={additionalStateVariablesDefined:[{variableName:"renderedChildNumberByRowCol",forRenderer:!0}],returnDependencies:()=>({cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),definition:function({dependencyValues:e}){let n=[],r=[],a=0;for(let i=0;i<e.numRows;i++){let s=e.cellNamesByRowCol[i],l=[];if(s){for(let u of s)u?(n.push(u),l.push(a),a+=1):l.push(null);l.push(...Array(e.numColumns-s.length).fill(null))}else l=Array(e.numColumns).fill(null);r.push(l)}return{newValues:{childrenToRender:n,renderedChildNumberByRowCol:r}}}},t}addCell({cell:t,rowNum:e,colNum:n}){if(Array.isArray(this.state.cells[e])||(this.state.cells[e]=[]),Array.isArray(this.state.cellComponents[e])||(this.state.cellComponents[e]=[]),e<0)throw Error("RowNum position has to be 1 or greater");if(n<0)throw Error("ColNum position has to be 1 or greater");if(t.unresolvedState.text?this.unresolvedState.cells==null?this.unresolvedState.cells={isArray:!0,arrayComponents:{[[e,n]]:!0}}:this.unresolvedState.cells.arrayComponents[[e,n]]=!0:this.state.cells[e][n]=t.state.text,this.state.cellComponents[e][n]===void 0)this.state.cellComponents[e][n]=t;else throw Error(`Cell row ${e+1} column ${n+1} is already defined above.`);return this.state.cellNameToRowCol[t.componentName]={row:e,col:n},{rowNum:e,colNum:n}}getCellPoints(t,e){if(this.unresolvedState.points)return;if(this.state.pointsFoundInCells!==void 0)return this.state.pointsFoundInCells[e];this.currentTracker.trackChanges.logPotentialChange({component:this,variable:"points",oldValue:this.state.pointsFoundInCells}),this.state.pointsFoundInCells=[],this._state.pointsFoundInCells.indices=[];let n=this.state.numRows,r=this.state.numColumns;for(let a=0;a<r;a++)for(let i=0;i<n;i++){let s=this.state.cells[i][a];if(!s)continue;let l;try{l=Sh.fromAst(Z.convert(s))}catch(u){continue}Array.isArray(l.tree)&&l.tree[0]==="tuple"&&(this.state.pointsFoundInCells.push(l),this._state.pointsFoundInCells.indices.push([i,a]))}return console.log("logging points change"),this.state.pointsFoundInCells[e]}},mr=xs;function od({cellRelatedChildren:o,rowOffset:t=0,colOffset:e=0,cellNameToRowCol:n={},cellNamesByRowCol:r=[],componentInfoObjects:a}){var i=t,s=e,l=e,u=t,c=e,d=t,p=e;for(let m of o)if(a.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cell"})){let f=m,h=ae(f.stateValues.rowNum),y=ae(f.stateValues.colNum);h===void 0?(h=i,y===void 0?y=l:y=y+e):(h=h+t,y===void 0?y=s:y=y+e),ws({cell:f,rowIndex:h,colIndex:y,cellNameToRowCol:n,cellNamesByRowCol:r}),d=Math.max(h,d),p=Math.max(y,p),i=h,s=y,l=y+1}else if(a.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"row"})){let f=m,h=ae(f.stateValues.rowNum);h===void 0?h=u:h=h+t;let y=f.stateValues.prescribedCellsWithColNum,b=e;for(let g of y){let C=ae(g.stateValues.colNum);C===void 0?C=b:C=C+e,ws({cell:g,rowIndex:h,colIndex:C,cellNameToRowCol:n,cellNamesByRowCol:r}),b=C+1,d=Math.max(h,d),p=Math.max(C,p)}u=h+1,i=h+1,s=e,l=s}else if(a.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"column"})){let f=m,h=ae(f.stateValues.colNum);h===void 0?h=c:h=h+e;let y=f.stateValues.prescribedCellsWithRowNum,b=t;for(let g of y){let C=ae(g.stateValues.rowNum);C===void 0?C=b:C=C+t,ws({cell:g,rowIndex:C,colIndex:h,cellNameToRowCol:n,cellNamesByRowCol:r}),b=C+1,d=Math.max(C,d),p=Math.max(h,p)}c=h+1,i=t,s=h+1,l=s}else if(a.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cellBlock"})){let f=m,h=ae(f.stateValues.rowNum),y=ae(f.stateValues.colNum);h===void 0?(h=i,y===void 0?y=l:y=y+e):(h=h+t,y===void 0?y=s:y=y+e);let b=od({cellRelatedChildren:f.stateValues.prescribedCellsRowsColumnsBlocks,rowOffset:h,colOffset:y,cellNameToRowCol:n,cellNamesByRowCol:r,componentInfoObjects:a});d=Math.max(b.maxRowIndex,d),p=Math.max(b.maxColIndex,p),i=h,s=y,l=b.maxColIndex+1}return{maxRowIndex:d,maxColIndex:p,cellNameToRowCol:n,cellNamesByRowCol:r}}function ws({cell:o,rowIndex:t,colIndex:e,cellNameToRowCol:n,cellNamesByRowCol:r}){if(n[o.componentName]=[t,e],r[t]===void 0&&(r[t]=[]),r[t][e]!==void 0){console.warn(`Cell is overwriting previous cell at rowNum=${t+1}, colNum=${e+1}`);let a=r[t][e];n[a]=null}r[t][e]=o.componentName}var Ds=class extends mr{constructor(t){super(t);this.onChange=this.onChange.bind(this)}static componentType="spreadsheet";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["cells"]}onChange(t,e){if(e!=="loadData"){let n={};for(let r of t){let[a,i,s,l]=r;this.state.cells[a][i]=s,n[[a,i]]=l}this.coreFunctions.requestUpdate({updateType:"updateValue",updateInstructions:[{componentName:this.componentName,variableUpdates:{cells:{isArray:!0,changes:{arrayComponents:n}}}}]})}}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}let t={onChange:this.onChange};this.renderer=new this.availableRenderers.spreadsheet({key:this.componentName,actions:t,cells:this.state.cells,width:this.state.width,height:this.state.height})}updateRenderer(){this.renderer.updateSpreadsheet({cells:this.state.cells,width:this.state.width,height:this.state.height})}},ld=Ds;import As from"math-expressions";var Ss=class extends B{static componentType="cell";static rendererType="container";static primaryStateVariableForDefinition="placeholder";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.rowNum={default:null},e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),r=e.newLeaf({name:"nothingElse",componentType:"_base",number:0,allowSpillover:!1}),a=e.newOperator({name:"oneMathAndNothingElse",operator:"and",propositions:[n,r],requireConsecutive:!0}),i=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"mathXorAnything",operator:"xor",propositions:[a,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.onlyMathChild={returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"oneMathAndNothingElse"}}),definition:({dependencyValues:e})=>({newValues:{onlyMathChild:e.mathChild.length===1}})},t.text={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"mathXorAnything",variableNames:["text"],variablesOptional:!0}}),definition({dependencyValues:e}){if(e.children.length===0)return{useEssentialOrDefaultValue:{text:{variablesToCheck:["text"]}}};let n="";for(let r of e.children)r.stateValues.text&&(n+=r.stateValues.text);return{newValues:{text:n}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.children.length===0?{success:!0,instructions:[{setStateVariable:"text",value:e.text}]}:n.children.length===1?n.children[0].stateValues.text===void 0?{success:!1}:{success:!0,instructions:[{setDependency:"children",desiredValue:e.text,childIndex:0,variableIndex:0}]}:{success:!1}}},t.math={public:!0,componentType:"math",stateVariablesDeterminingDependencies:["onlyMathChild"],returnDependencies({stateValues:e}){return e.onlyMathChild?{mathChild:{dependencyType:"child",childLogicName:"oneMathAndNothingElse",variableNames:["value"]}}:{text:{dependencyType:"stateVariable",variableName:"text"}}},definition({dependencyValues:e}){if(e.mathChild)return{newValues:{math:e.mathChild[0].stateValues.value}};{let n;try{n=As.fromAst(Z.convert(e.text))}catch(r){n=As.fromAst("\uFF3F")}return{newValues:{math:n}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.mathChild?{success:!0,instructions:[{setDependency:"mathChild",desiredValue:e.math,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"text",desiredValue:e.math.toString()}]}}},t.number={public:!0,componentType:"number",returnDependencies:()=>({math:{dependencyType:"stateVariable",variableName:"math"}}),definition({dependencyValues:e}){let n=e.math.evaluate_to_constant();return Number.isFinite(n)||(n=NaN),{newValues:{number:n}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"math",desiredValue:As.fromAst(e.number)}]}}},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"mathXorAnything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t.placeholder={returnDependencies:()=>({}),definition:()=>({newValues:{placeholder:null}})},t}static adapters=["text","math","number"]},ud=Ss;var Is=class extends B{static componentType="row";static rendererType="container";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.rowNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroCells",componentType:"cell",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsWithColNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells",variableNames:["colNum"]}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsWithColNum:e.cellChildren}}}},t}},cd=Is;var Os=class extends B{static componentType="column";static rendererType="container";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroCells",componentType:"cell",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsWithRowNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells",variableNames:["rowNum"]}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsWithRowNum:e.cellChildren}}}},t}},dd=Os;var ks=class extends B{static componentType="cellBlock";static rendererType="container";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.rowNum={default:null},e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"zeroOrMoreCells",componentType:"cell",comparison:"atLeast",number:0}),r=e.newLeaf({name:"zeroOrMoreRows",componentType:"row",comparison:"atLeast",number:0}),a=e.newLeaf({name:"zeroOrMoreColumns",componentType:"column",comparison:"atLeast",number:0}),i=e.newLeaf({name:"zeroOrMoreCellblocks",componentType:"cellblock",comparison:"atLeast",number:0});return e.newOperator({name:"cellsRowsColumnsBlocks",operator:"and",propositions:[n,r,a,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsRowsColumnsBlocks={returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childLogicName:"cellsRowsColumnsBlocks",variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsRowsColumnsBlocks:e.cellRelatedChildren}}}},t}},pd=ks;var Ps=class extends B{static componentType="variants";static rendererType=void 0;static stateVariableForAttributeValue="variants";static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"variant",state:{value:s}}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroVariants",componentType:"variant",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVariants={public:!0,componentType:"number",returnDependencies:()=>({variantChildren:{dependencyType:"child",childLogicName:"atLeastZeroVariants"}}),definition:function({dependencyValues:e}){return{newValues:{nVariants:e.variantChildren.length}}}},t.variants={public:!0,componentType:"variant",isArray:!0,entryPrefixes:["variant"],returnArraySizeDependencies:()=>({nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),returnArraySize({dependencyValues:e}){return[e.nVariants]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={variantChild:{dependencyType:"child",childLogicName:"atLeastZeroVariants",variableNames:["value"],childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)e[a].variantChild.length===1&&(r[a]=e[a].variantChild[0].stateValues.value.toLowerCase());return{newValues:{variants:r}}}},t}},md=Ps;var Rs=class extends E{static componentType="seeds";static rendererType=void 0;static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(a,i){return i.componentType==="string"?[...a,...i.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"seed",state:{value:s}}))]:[...a,i]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroSeeds",componentType:"seed",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nSeeds={public:!0,componentType:"number",returnDependencies:()=>({seedChildren:{dependencyType:"child",childLogicName:"atLeastZeroSeeds"}}),definition:function({dependencyValues:e}){return{newValues:{nSeeds:e.seedChildren.length}}}},t.seeds={public:!0,componentType:"seed",isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize({dependencyValues:e}){return[e.nSeeds]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={seedChild:{dependencyType:"child",childLogicName:"atLeastZeroSeeds",variableNames:["value"],childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)e[a].seedChild.length===1&&(r[a]=e[a].seedChild[0].stateValues.value);return{newValues:{seeds:r}}}},t}},fd=Rs;var Bs=class extends B{static componentType="variantControl";static rendererType=void 0;static createsVariants=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.nVariants={createComponentOfType:"number",createStateVariable:"nVariants",defaultValue:100,public:!0},e.uniqueVariants={createComponentOfType:"boolean",createStateVariable:"uniqueVariants",defaultValue:!1,public:!0},e.variants={createComponentOfType:"variants"},e.seeds={createComponentOfType:"seeds"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVariantsSpecified={returnDependencies:({sharedParameters:e})=>({uniqueVariants:{dependencyType:"stateVariable",variableName:"uniqueVariants"},numberOfVariantsFromSharedParameters:{dependencyType:"value",value:e.numberOfVariantsFromSharedParameters},nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),definition:function({dependencyValues:e}){let n=e.nVariants;return n<1&&(n=1),e.uniqueVariants&&(e.numberOfVariantsFromSharedParameters!==void 0?n=e.numberOfVariantsFromSharedParameters:console.log("Restricting to unique variants was not successful")),{newValues:{nVariantsSpecified:n}}}},t.nSeeds={public:!0,componentType:"number",returnDependencies:()=>({seedsAttr:{dependencyType:"attributeComponent",attributeName:"seeds",variableNames:["nSeeds"]}}),definition:function({dependencyValues:e}){return e.seedsAttr!==null?{newValues:{nSeeds:e.seedsAttr.stateValues.nSeeds}}:{newValues:{nSeeds:0}}}},t.seeds={public:!0,componentType:"seed",isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize({dependencyValues:e}){return[e.nSeeds]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={seedsAttr:{dependencyType:"attributeComponent",attributeName:"seeds",variableNames:["seed"+(Number(r)+1)]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let a of n)e[a].seedsAttr!==null&&(r[a]=e[a].seedsAttr.stateValues["seed"+(Number(a)+1)]);return{newValues:{seeds:r}}}},t.originalVariants={returnDependencies:()=>({variantsAttr:{dependencyType:"attributeComponent",attributeName:"variants",variableNames:["variants"]}}),definition:function({dependencyValues:e}){let n=[];return e.variantsAttr!==null&&(n=e.variantsAttr.stateValues.variants),{newValues:{originalVariants:n}}}},t.variants={public:!0,componentType:"variant",isArray:!0,entryPrefixes:["variant"],returnArraySizeDependencies:()=>({nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}),returnArraySize({dependencyValues:e}){return[e.nVariantsSpecified]},returnArrayDependenciesByKey({arrayKeys:e}){return{globalDependencies:{originalVariants:{dependencyType:"stateVariable",variableName:"originalVariants"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}}},arrayDefinitionByKey:function({globalDependencyValues:e,arrayKeys:n}){let r=[...e.originalVariants],a=r.length,i=a-1,s;for(;a<e.nVariantsSpecified;){for(a++,i++,s=hd(i);e.originalVariants.includes(s);)i++,s=hd(i);r.push(s)}return{newValues:{variants:r}}}},t.selectedVariantNumber={public:!0,componentType:"number",immutable:!0,returnDependencies:({sharedParameters:e})=>({variantsObject:{dependencyType:"variants"},originalVariants:{dependencyType:"stateVariable",variableName:"originalVariants"},variants:{dependencyType:"stateVariable",variableName:"variants"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"},hashStringToInteger:{dependencyType:"value",value:e.hashStringToInteger},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(e.variantsObject!==void 0){if(e.variantsObject.desiredVariantNumber!==void 0){let a=Number(e.variantsObject.desiredVariantNumber);if(Number.isInteger(a)){let i=a%e.nVariantsSpecified;return i<0&&(i+=e.nVariantsSpecified),{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:i}}}else throw Error("Variant number "+e.variantsObject.desiredVariantNumber+" must be an integer")}if(e.variantsObject.desiredVariant!==void 0){if(typeof e.variantsObject.desiredVariant=="string"){let i=e.originalVariants.map(u=>u.toLowerCase()),l=[...i,...e.variants.slice(i.length)].indexOf(e.variantsObject.desiredVariant.toLowerCase());if(l!==-1)return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:l}}}console.log("Variant "+e.variantsObject.desiredVariant+" is not valid, convert to variant index");let a=Math.abs(e.hashStringToInteger(JSON.stringify(e.variantsObject.desiredVariant))%e.nVariantsSpecified);return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:a}}}}let n=e.selectRng.random(),r=Math.floor(n*e.nVariantsSpecified);return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:r}}}},t.selectedVariant={public:!0,componentType:"text",returnDependencies:()=>({variants:{dependencyType:"stateVariable",variableName:"variants"},selectedVariantNumber:{dependencyType:"stateVariable",variableName:"selectedVariantNumber"}}),definition:function({dependencyValues:e}){return{newValues:{selectedVariant:e.variants[e.selectedVariantNumber]}}}},t.selectedSeed={returnDependencies:()=>({selectedVariantNumber:{dependencyType:"stateVariable",variableName:"selectedVariantNumber"},seeds:{dependencyType:"stateVariable",variableName:"seeds"}}),definition:function({dependencyValues:e}){if(e.selectedVariantNumber<e.seeds.length)return{newValues:{selectedSeed:e.seeds[e.selectedVariantNumber]}};let n=e.seeds.length-1,r=n+1,a;for(;n<e.selectedVariantNumber;)for(n++,r++,a=r.toString();e.seeds.includes(a);)r++,a=r.toString();return{newValues:{selectedSeed:a}}}},t.convertedSeed={returnDependencies:({sharedParameters:e})=>({selectedSeed:{dependencyType:"stateVariable",variableName:"selectedSeed"},hashStringToInteger:{dependencyType:"value",value:e.hashStringToInteger}}),definition:({dependencyValues:e})=>({newValues:{convertedSeed:e.hashStringToInteger(e.selectedSeed)}})},t.selectRng={returnDependencies:({sharedParameters:e})=>({convertedSeed:{dependencyType:"stateVariable",variableName:"convertedSeed"},rngClass:{dependencyType:"value",value:e.rngClass,doNotProxy:!0}}),definition:({dependencyValues:e})=>({newValues:{selectRng:new e.rngClass(e.convertedSeed)}})},t}},bd=Bs;function hd(o){let t="";for(;;){let e=o%26;if(t=String.fromCharCode(97+e)+t,o<26)break;o=Math.floor(o/26)-1}return t}import kn from"math-expressions";var Fs=class extends sn{static componentType="selectFromSequence";static assignNamesToReplacements=!0;static createsVariants=!0;static get stateVariablesShadowedForReference(){return[...super.stateVariablesShadowedForReference,"excludedCombinations"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.numberToSelect={createComponentOfType:"number",createStateVariable:"numberToSelect",defaultValue:1,public:!0},e.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},e.sortResults={createComponentOfType:"boolean",createStateVariable:"sortResults",defaultValue:!1,public:!0},e.excludeCombinations={createComponentOfType:"_componentListOfListsWithSelectableType"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.excludedCombinations={returnDependencies:()=>({excludeCombinations:{dependencyType:"attributeComponent",attributeName:"excludeCombinations",variableNames:["lists"]}}),definition:function({dependencyValues:n}){return n.excludeCombinations!==null?{newValues:{excludedCombinations:n.excludeCombinations.stateValues.lists}}:{newValues:{excludedCombinations:[]}}}},t.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:n}){return{newValues:{variants:n.variants}}}},t.selectedValues={immutable:!0,additionalStateVariablesDefined:["selectedIndices"],returnDependencies:({sharedParameters:n})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},excludedCombinations:{dependencyType:"stateVariable",variableName:"excludedCombinations"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"},sortResults:{dependencyType:"stateVariable",variableName:"sortResults"},variants:{dependencyType:"stateVariable",variableName:"variants"},selectRng:{dependencyType:"value",value:n.selectRng,doNotProxy:!0}}),definition:Ih},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.selectedVariantInfo={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition({dependencyValues:n}){return{newValues:{selectedVariantInfo:{indices:n.selectedIndices}}}}};let e=t.readyToExpandWhenResolved.returnDependencies;return t.readyToExpandWhenResolved.returnDependencies=function(){let n=e();return n.selectedValues={dependencyType:"stateVariable",variableName:"selectedValues"},n},t}static createSerializedReplacements({component:t,componentInfoObjects:e}){let n=[];for(let a of t.stateValues.selectedValues)n.push({componentType:t.stateValues.type==="letters"?"text":t.stateValues.type,state:{value:a}});return{replacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:n,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:e}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:t}){let e=1,n=!1;if(t.state!==void 0&&(t.state.numberToSelect!==void 0&&(e=t.state.numberToSelect),t.state.withReplacement!==void 0&&(n=t.state.withReplacement),t.state.type!==void 0&&(sequenceType=t.state.type)),t.children===void 0)return{succes:!1};let r,a={},i=[];for(let d of t.children){let p=d.componentType;if(p==="numberToSelect"){let m=!1;if(d.state!==void 0&&d.state.value!==void 0&&(e=Math.round(Number(d.state.value)),m=!0),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){e=Math.round(Number(f.state.value)),m=!0;break}}if(!m)return{success:!1}}else if(p==="withReplacement"){let m=!1;if(d.state!==void 0&&(d.state.implicitValue!==void 0&&(n=d.state.implicitValue,m=!0),d.state.value!==void 0&&(n=d.state.value,m=!0)),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){m=!0,f.state.value.trim().toLowerCase()==="true"?n=!0:n=!1;break}}if(!m)return{success:!1}}else if(["type","to","from","step","length"].includes(p)){let m=!1;if(d.state!==void 0&&d.state.value!==void 0&&(a[p]=d.state.value,m=!0),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){a[p]=f.state.value,m=!0;break}}if(!m)return{success:!1}}else if(p==="exclude"){let m=!1;if(d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){m=!0;let h=f.state.value.split(",").map(y=>y.trim());i.push(...h);break}}if(!m)return{success:!1}}else p==="string"&&(r=d)}if(r!==void 0){if(a.to!==void 0||a.from!==void 0)return{success:!1};let d=r.state.value.split(",");if(d.length===1)a.to=d[0].trim();else if(d.length===2)a.from=d[0].trim(),a.to=d[1].trim();else return{success:!1}}for(let d of["to","from","step"])if(a[d]!==void 0){if(a.type==="math"){if(typeof a[d]=="string")a[d]=kn.fromAst(Z.convert(a[d]));else if(a[d].tree===void 0)return{success:!1}}else if(a.type==="letters"&&d!=="step"){if(a[d]=Ct(a[d]),a[d]===void 0)return{success:!1}}else if(a[d]=Number(a[d]),!Number.isFinite(a[d]))return{success:!1}}if(a.length!==void 0&&(typeof a.length=="string"&&(a.length=Number(a.length)),!Number.isInteger(a.length)||a.length<0))return{success:!1};for(let[d,p]of i.entries()){if(a.type==="math"){if(typeof p=="string")p=kn.fromAst(Z.convert(p));else if(p.tree===void 0)return{success:!1}}else if(a.type==="letters"&&par!=="step"){if(p=Ct(p),p===void 0)return{success:!1}}else if(p=Number(p),!Number.isFinite(p))return{success:!1};i[d]=p}this.calculateSequenceParameters(a);let s=a.length,l=[];if(i.length>0&&a.type!==math){i.sort(),i=i.filter((d,p,m)=>d!=m[p-1]);for(let d of i){if(d<a.from)continue;let p=(d-a.from)/a.step;if(p>a.length-1+1e-10)break;Math.abs(p-Math.round(p))<1e-10&&(s--,l.push(p))}}if(s<=0)return{success:!1};let u={excludeIndices:l,nOptions:s,numberToSelect:e,withReplacement:n};if(n||e===1){let d=Math.pow(s,e);return{success:!0,numberOfVariants:d,uniqueVariantData:u}}let c=s;for(let d=s-1;d>s-e;d--)c*=d;return{success:!0,numberOfVariants:c,uniqueVariantData:u}}static getUniqueVariant({serializedComponent:t,variantNumber:e}){if(t.variants===void 0)return{succes:!1};let n=t.variants.numberOfVariants;if(n===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=n)return{success:!1};let r=t.variants.uniqueVariantData,a=r.excludeIndices,i=r.nOptions,s=r.numberToSelect,l=r.withReplacement,u=function(p){let m=p;for(let f of a)m===f&&m++;return m};if(s===1)return{success:!0,desiredVariant:{indices:[u(e)]}};let d=An({numberOfIndices:s,numberOfOptions:i,maxNumber:e+1,withReplacement:l})[e].map(u);return{success:!0,desiredVariant:{indices:d}}}},Tt=Fs;function Ih({dependencyValues:o}){if(o.numberToSelect<1)return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:[],selectedIndices:[]}};let t=1;if(o.withReplacement||(t=o.numberToSelect),t>o.length)throw Error("Cannot select "+t+" values from a sequence of length "+o.length);if(o.variants&&o.variants.desiredVariant!==void 0){let a=o.variants.desiredVariant.indices;if(a!==void 0){if(a.length!==o.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(a=a.map(Number),!a.every(Number.isInteger))throw Error("All indices specified for select must be integers");let i=o.length;a=a.map(u=>(u%i+i)%i);let s=!0,l=[];for(let u of a){let c=o.from;if(u>0&&(o.type==="math"?c=c.add(o.step.multiply(kn.fromAst(u))).expand().simplify():c+=o.step*u),o.type==="letters"&&(c=kt(c,o.lowercase)),o.type==="math"){if(o.exclude.some(p=>p.equals(c)))throw Error("Specified index of selectfromsequence that was excluded")}else if(o.exclude.includes(c))throw Error("Specified index of selectfromsequence that was excluded");let d=!1;o.type==="math"?o.excludedCombinations.some(p=>[p,u].equals(c))&&(d=!0):o.excludedCombinations.some(p=>p[u]===c)&&(d=!0),d||(s=!1),l.push(c)}if(s)throw Error("Specified indices of selectfromsequence that was an excluded combination");return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:l,selectedIndices:a}}}}let e=o.excludedCombinations.length,n,r;if(e===0){let a=yd({stateValues:o,numberUniqueRequired:t,numberToSelect:o.numberToSelect,withReplacement:o.withReplacement,rng:o.selectRng});n=a.selectedValues,r=a.selectedIndices}else{let a=o.length-o.exclude.length;if(o.withReplacement)a=Math.pow(a,o.numberToSelect);else{let s=a;for(let l=1;l<o.numberToSelect;l++)a*=s-l}if(e>.7*a)throw Error("Excluded over 70% of combinations in selectFromSequence");let i=!1;for(let s=0;s<200;s++){let l=yd({stateValues:o,numberUniqueRequired:t,numberToSelect:o.numberToSelect,withReplacement:o.withReplacement,rng:o.selectRng});if(n=l.selectedValues,r=l.selectedIndices,o.type==="math"){if(o.excludedCombinations.some(u=>u.every((c,d)=>c.equals(n[d]))))continue}else if(o.excludedCombinations.some(u=>u.every((c,d)=>c===n[d])))continue;i=!0;break}if(!i)throw Error("By extremely unlikely fluke, couldn't select combination of random values")}if(o.sortResults){let a=[];for(let[i,s]of n.entries())a.push({value:s,index:r[i]});o.type==="number"?a.sort((i,s)=>i.value-s.value):o.type==="letters"&&a.sort((i,s)=>Ct(i.value)-Ct(s.value)),n=a.map(i=>i.value),r=a.map(i=>i.index)}return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:n,selectedIndices:r}}}function yd({stateValues:o,numberUniqueRequired:t=1,numberToSelect:e=1,withReplacement:n=!1,rng:r}){let a=[],i=[];if(o.exclude.length+t<.5*o.length){for(let c=0;c<e;c++){let d=!1,p,m;for(let f=0;f<100;f++){let h=r.random();if(m=Math.floor(h*o.length),!(!n&&i.includes(m))){if(p=o.from,m>0&&(o.type==="math"?p=p.add(o.step.multiply(kn.fromAst(m))).expand().simplify():p+=o.step*m),o.type==="math"){if(o.exclude.some(y=>y.equals(p)))continue}else if(o.exclude.includes(p))continue;d=!0;break}}if(!d)throw Error("By extremely unlikely fluke, couldn't select random value");o.type==="letters"&&(p=kt(p,o.lowercase)),a.push(p),i.push(m)}return{selectedValues:a,selectedIndices:i}}let s=[];for(let c=0;c<o.length;c++){let d=o.from;if(c>0&&(o.type==="math"?d=d.add(o.step.multiply(kn.fromAst(c))).expand().simplify():d+=o.step*c),o.type==="math"){if(o.exclude.some(p=>p.equals(d)))continue}else if(o.exclude.includes(d))continue;o.type==="letters"&&(d=kt(d,o.lowercase)),s.push(d)}let l=s.length;if(t>l)throw Error("Cannot select "+t+" unique values from sequence of length "+l);if(t===1){for(let c=0;c<e;c++){let d=r.random(),p=Math.floor(d*l);i.push(p),a.push(s[p])}return{selectedValues:a,selectedIndices:i}}let u=[...Array(s.length).keys()];for(let c=s.length-1;c>0;c--){let d=r.random(),p=Math.floor(d*(c+1));[s[c],s[p]]=[s[p],s[c]],[u[c],u[p]]=[u[p],u[c]]}return a=s.slice(0,e),i=u.slice(0,e),{selectedValues:a,selectedIndices:i}}import Oh from"math-expressions";var Ls=class extends G{static componentType="select";static assignNamesToReplacements=!0;static createsVariants=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["selectedIndices"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.numberToSelect={createComponentOfType:"number",createStateVariable:"numberToSelect",defaultValue:1,public:!0},e.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},e.type={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();function e({matchedChildren:n,componentAttributes:r}){let a;r.type?a=r.type:a="math",["math","text","number"].includes(a)||(console.warn(`Invalid type ${a}`),a="math");let i=n.reduce(function(s,l){return l.componentType==="string"?[...s,...l.state.value.split(/\s+/).filter(u=>u).map(u=>a==="math"?Oh.fromAst(Z.convert(u)):a==="number"?Number(u):u).map(u=>({componentType:"option",children:[{componentType:a,state:{value:u}}]}))]:[...s,l]},[]);return{success:!0,newChildren:i}}return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroOptions",componentType:"option",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){return{newValues:{variants:e.variants}}}},t.currentVariantName={returnDependencies:({sharedParameters:e})=>({variant:{dependencyType:"value",value:e.variant}}),definition:({dependencyValues:e})=>({newValues:{currentVariantName:e.variant}})},t.allPossibleVariants={returnDependencies:({sharedParameters:e})=>({allPossibleVariants:{dependencyType:"value",value:e.allPossibleVariants}}),definition:({dependencyValues:e})=>({newValues:{allPossibleVariants:e.allPossibleVariants}})},t.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childLogicName:"atLeastZeroOptions",variableNames:["selectForVariants","selectWeight"]}}),definition({dependencyValues:e}){return{newValues:{optionChildren:e.optionChildren,nOptions:e.optionChildren.length}}}},t.availableVariants={returnDependencies:()=>({optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},allPossibleVariants:{dependencyType:"stateVariable",variableName:"allPossibleVariants"}}),definition:function({dependencyValues:e}){console.log(e);let n={};for(let[r,a]of e.optionChildren.entries())for(let i of a.stateValues.selectForVariants){let s=i.toLowerCase();n[s]===void 0&&(n[s]=[]),n[s].push(r)}for(let r in n)if(n[r].length!==e.numberToSelect)throw Error("Invalid variant for select.  Variant "+r+" appears in "+n[r].length+" options but number to select is "+numberToSelect);if(Object.keys(n).length>0){for(let r of e.allPossibleVariants)if(!(r in n))throw Error("Some variants are specified for select but no options are specified for possible variant: "+r);for(let r in n)if(!e.allPossibleVariants.includes(r))throw Error("Variant "+r+" that is specified for select is not a possible variant.")}return{newValues:{availableVariants:n}}}},t.selectedIndices={returnDependencies:({sharedParameters:e})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},currentVariantName:{dependencyType:"stateVariable",variableName:"currentVariantName"},variants:{dependencyType:"stateVariable",variableName:"variants"},availableVariants:{dependencyType:"stateVariable",variableName:"availableVariants"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(!(e.numberToSelect>=1)||e.nOptions===0)return{makeEssential:["selectedIndices"],newValues:{selectedIndices:[]},makeImmutable:["selectedIndices"]};if(e.variants&&e.variants.desiredVariant!==void 0){let c=e.variants.desiredVariant.indices;if(c!==void 0){if(c.length!==e.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(c=c.map(Number),!c.every(Number.isInteger))throw Error("All indices specified for select must be integers");let d=e.nOptions;return c=c.map(p=>(p%d+d)%d),{makeEssential:["selectedIndices"],newValues:{selectedIndices:c},makeImmutable:["selectedIndices"]}}}let n=e.availableVariants[e.currentVariantName];if(n!==void 0){if(e.numberToSelect>1){n=[...n];for(let c=e.numberToSelect-1;c>0;c--){let d=e.selectRng.random(),p=Math.floor(d*(c+1));[n[c],n[p]]=[n[p],n[c]]}}return{makeEssential:["selectedIndices"],newValues:{selectedIndices:n},makeImmutable:["selectedIndices"]}}let r=[],a=1;if(e.withReplacement||(a=e.numberToSelect),a>e.nOptions)throw Error("Cannot select "+a+" components from only "+e.nOptions);let i=e.optionChildren.map(c=>c.stateValues.selectWeight),s=i.reduce((c,d)=>c+d);i=i.map(c=>c/s);let l=i.reduce((c,d,p)=>[...c,d+(c[p-1]||0)],[]),u=[...Array(l.length).keys()];for(let c=0;c<e.numberToSelect;c++){let d=e.selectRng.random(),p=-1,m=l.length-1;for(;p<m-1;){let h=Math.floor((p+m)/2);l[h]>d?m=h:p=h}let f=u[m];r.push(f),!e.withReplacement&&c<e.numberToSelect-1&&(i.splice(m,1),u.splice(m,1),s=i.reduce((h,y)=>h+y),i=i.map(h=>h/s),l=i.reduce((h,y,b)=>[...h,y+(h[b-1]||0)],[]))}return{makeEssential:["selectedIndices"],newValues:{selectedIndices:r},makeImmutable:["selectedIndices"]}}},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.selectedVariantInfo={returnDependencies:({componentInfoObjects:e})=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){let n={indices:e.selectedIndices},r=n.subvariants=[];for(let a of e.variantDescendants)a.stateValues.isVariantComponent?r.push(a.stateValues.selectedVariantInfo):a.stateValues.selectedVariantInfo&&r.push(...a.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t}static createSerializedReplacements({component:t,components:e,componentInfoObjects:n}){console.log(`create serialized replacements for ${t.componentName}`);let r=[];for(let i of t.stateValues.selectedIndices){let s=t.stateValues.optionChildren[i].componentName,l=e[s],u=H(l.state.serializedChildren.value),c={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},l.doenetAttributes),children:u,originalName:s};l.attributes.newNamespace&&(c.attributes={newNamespace:!0}),l.variants&&(c.variants=H(l.variants)),r.push(c)}if(t.variants&&t.variants.desiredVariant!==void 0){let i=t.variants.desiredVariant;if(i!==void 0&&i.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0){let s=[];for(let l of r)l.variants!==void 0&&(l.variants.isVariantComponent?s.push(l):l.variants.descendantVariantComponents&&s.push(...l.variants.descendantVariantComponents));for(let l in i.subvariants){let u=i.subvariants[l],c=s[l];if(c===void 0)break;c.variants.desiredVariant=u}}}return{replacements:j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:t}){let e=1,n=!1,r=[],a=[];if(t.state!==void 0&&(t.state.numberToSelect!==void 0&&(e=t.state.numberToSelect),t.state.withReplacement!==void 0&&(n=t.state.withReplacement)),t.children===void 0)return{succes:!1};let i;for(let p of t.children){let m=p.componentType;if(m==="numberToSelect"){let f=!1;if(p.state!==void 0&&p.state.value!==void 0&&(e=Math.round(Number(p.state.value)),f=!0),p.children!==void 0){for(let h of p.children)if(h.componentType==="string"){e=Math.round(Number(h.state.value)),f=!0;break}}if(!f)return{success:!1}}else if(m==="withReplacement"){let f=!1;if(p.state!==void 0&&(p.state.implicitValue!==void 0&&(n=p.state.implicitValue,f=!0),p.state.value!==void 0&&(n=p.state.value,f=!0)),p.children!==void 0){for(let h of p.children)if(h.componentType==="string"){f=!0,h.state.value.trim().toLowerCase()==="true"?n=!0:n=!1;break}}if(!f)return{success:!1}}else{if(m==="selectWeight")return{succes:!1};if(m!=="hide"&&m!=="modifyIndirectly"){m==="string"&&(i=p);let f=1;p.variants!==void 0&&p.variants.numberOfVariants!==void 0&&(f=p.variants.numberOfVariants),r.push(f),a.push(p)}}}if(r.length===0)return{success:!1};if(i!==void 0&&r.length===1){let p=i.state.value.split(/s+/).length;r=Array(p).fill(1)}let s={numberOfVariantsByChild:r,numberToSelect:e,withReplacement:n,childrenToSelect:a};if(n||e===1){let p=r.reduce((f,h)=>f+h),m=Math.pow(p,e);return{success:!0,numberOfVariants:m,uniqueVariantData:s}}let l=r.length;if(e>l)return{success:!1};let u=r[0];if(r.slice(1).every(p=>p===u)){let p=l;for(let f=l-1;f>l-e;f--)p*=f;let m=p*Math.pow(u,e);return{success:!0,numberOfVariants:m,uniqueVariantData:s}}let d=gd(r,e);return{success:!0,numberOfVariants:d,uniqueVariantData:s}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let a=t.variants.uniqueVariantData,i=a.numberOfVariantsByChild,s=a.numberToSelect,l=a.withReplacement,u=i.length,c=a.childrenToSelect,d=An({numberOfIndices:s,numberOfOptions:u,maxNumber:e+1,withReplacement:l}),p=d.length,m=d.map(w=>({combination:w,numberOfPossibilities:w.reduce((D,I)=>D*i[I],1)})),f=[...Array(p).keys()],h=0,y=f.length,b,g,C=e;for(;y>0;){let D=f.map(I=>m[I]).reduce((I,A)=>Math.min(I,A.numberOfPossibilities),Infinity)-h;if(C<D*y){b=f[C%y],g=h+Math.floor(C/y);break}else h+=D,C-=D*y,f=f.filter(I=>m[I].numberOfPossibilities>h),y=f.length}let T=d[b],v=Jt({numberOfOptionsByIndex:T.map(w=>i[w]),maxNumber:g+1})[g],N=[],V=!1;for(let[w,D]of T.entries())if(i[D]>1){let I=c[D];if(I.variants.isVariantComponent){let S=n[I.componentType].getUniqueVariant({serializedComponent:I,variantNumber:v[w],allComponentClasses:n});if(!S.success)return{success:!1};N.push(S.desiredVariant)}else{let A=Yt({variantNumber:v[w],serializedComponent:I,allComponentClasses:n});if(!A.success)return{success:!1};N.push(...A.desiredVariants)}V=!0}else N.push({});let x={indices:T};return V&&(x.subvariants=N),{success:!0,desiredVariant:x}}},vd=Ls,gd=function(o,t){if(t===0)return 0;if(t===1)return o.reduce((n,r)=>n+r);let e=0;for(let n in o){let r=o[n],a=[...o];a.splice(n,1),e+=r*gd(a,t-1)}return e};var Es=class extends yt{static componentType="group";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.rendered.defaultValue=!0,e}},Cd=Es;import Nd from"math-expressions";var Ms=class extends sn{static componentType="animateFromSequence";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.animationOn={default:!1},e.animationMode={default:"increase"},e.animationInterval={default:1e3},e.initialSelectedIndex={default:0},e}updateState(t={}){if(super.updateState(t),t.init&&(this.makePublicStateVariable({variableName:"selectedIndex",componentType:"number"}),this.makePublicStateVariable({variableName:"value",componentType:this.state.type}),this.makePublicStateVariable({variableName:"currentAnimationDirection",componentType:"text"}),this.advanceAnimation=this.advanceAnimation.bind(this)),!(!this.childLogicSatisfied||Object.keys(this.unresolvedState).length>0)){if(this.currentTracker.trackChanges.checkIfVariableChanged(this)){this.state.possibleValues=[];for(let e=0;e<this.state.count;e++){let n=this.state.from;if(e>0&&(this.state.type==="math"?n=n.add(this.state.step.multiply(Nd.fromAst(e))).expand().simplify():n+=this.state.step*e),this.state.type==="math"){if(this.state.exclude.some(r=>r.equals(n)))continue}else if(this.state.exclude.includes(n))continue;this.state.type==="letters"&&(n=this.constructor.numberToLetters(n,this.state.lowercase)),this.state.possibleValues.push(n)}this.state.numberValues=this.state.possibleValues.length}this.state.selectedIndex===void 0?(this.state.selectedIndex=Math.min(this.state.numberValues-1,Math.max(0,this.state.initialselectedindex)),this._state.selectedIndex.essential=!0):this.state.selectedIndex=Nd.math.mod(this.state.selectedIndex,this.state.numberValues),this.state.value=this.state.possibleValues[this.state.selectedIndex],this.state.animationMode=this.state.animationMode.toLowerCase(),this.state.animationMode==="oscillate"?this.state.currentAnimationDirection===void 0&&(this.state.currentAnimationDirection="increase"):this.state.animationMode.substring(0,8)=="decrease"?(this.state.currentAnimationDirection="decrease",this.state.animationMode!=="decrease once"&&(this.state.animationMode="decrease")):(this.state.currentAnimationDirection="increase",this.state.animationMode!=="increase once"&&(this.state.animationMode="increase")),this._state.currentAnimationDirection.essential=!0,this.state.animationOn?this.state.animationPreviouslyOn||(this.state.currentAnimationDirection==="increase"?this.state.selectedIndex===this.state.numberValues-1&&(this.state.animationMode==="increase once"?(this.state.selectedIndex=0,this.state.value=this.state.possibleValues[this.state.selectedIndex]):this.state.animationMode==="oscillate"&&(this.state.currentAnimationDirection="decrease")):this.state.currentAnimationDirection==="decrease"&&this.state.selectedIndex===0&&(this.state.animationMode==="decrease once"?(this.state.selectedIndex=this.state.numberValues-1,this.state.value=this.state.possibleValues[this.state.selectedIndex]):this.state.animationMode==="oscillate"&&(this.state.currentAnimationDirection="inccrease")),this.state.animationID=this.coreFunctions.requestAnimationFrame(this.advanceAnimation,this.state.animationInterval),this.state.animationPreviouslyOn=!0):(this.state.animationPreviouslyOn&&this.coreFunctions.cancelAnimationFrame(this.state.animationID),this.state.animationPreviouslyOn=!1)}}advanceAnimation(){let t,e=!0,n;this.state.currentAnimationDirection==="decrease"?(t=this.state.selectedIndex-1,t<=0&&(this.state.animationMode==="decrease once"?e=!1:this.state.animationMode==="oscillate"&&(n="increase"))):(t=this.state.selectedIndex+1,t>=this.state.numberValues-1&&(this.state.animationMode==="increase once"?e=!1:this.state.animationMode==="oscillate"&&(n="decrease")));let r={selectedIndex:{changes:t}};e||(r.animationOn={changes:!1}),n!==void 0&&(r.currentAnimationDirection={changes:n}),this.coreFunctions.requestUpdate({updateType:"updateValue",updateInstructions:[{componentName:this.componentName,variableUpdates:r}]}),e&&(this.state.animationID=this.coreFunctions.requestAnimationFrame(this.advanceAnimation,this.state.animationInterval))}static createSerializedReplacements(t){let e=[];return t.state.value!==void 0&&e.push({componentType:t.state.type,state:{value:t.state.value,hide:t.state.hide}}),e}static calculateReplacementChanges({component:t}){let e=[];if(t.state.value===void 0){if(t.replacements[0]!==void 0){let r={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length};e.push(r)}return e}if(t.replacements[0]===void 0||t.state.type!==t.replacements[0].componentType){let r={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:t.constructor.createSerializedReplacements(t)};return e.push(r),e}let n={changeType:"updateStateVariables",component:t.replacements[0],stateChanges:{value:t.state.value}};return e.push(n),e}allowDownstreamUpdates(t){return t.initialChange||this.state.modifyIndirectly}get variablesUpdatableDownstream(){return["value","selectedIndex","animationOn","currentAnimationDirection"]}calculateDownstreamChanges({stateVariablesToUpdate:t,stateVariableChangesToSave:e,dependenciesToUpdate:n}){let r={};if("selectedIndex"in t&&(r.selectedIndex=t.selectedIndex),"animationOn"in t&&(r.animationOn=t.animationOn),"currentAnimationDirection"in t&&(r.currentAnimationDirection=t.currentAnimationDirection),"value"in t)if(this.state.type==="number"){let l=t.value.changes;if(typeof l!="number"&&(l=l.evaluate_to_constant()),typeof l!="number")return!1;let u=this.state.step,c=-1,d=this.state.possibleValues.length-1;for(;c<d-1;){let m=Math.floor((c+d)/2);u*(this.state.possibleValues[m]-l)>0?d=m:c=m}let p=d;c!==-1&&Math.abs(l-this.state.possibleValues[c])<Math.abs(l-this.state.possibleValues[d])&&(p=c),r.selectedIndex={changes:p}}else{let l=t.value,u=this.state.possibleValues.indexOf(l);if(u===-1)return!1;r.selectedIndex={changes:u}}this.updatePropertySources({newStateVariables:r,dependenciesToUpdate:n});let a=this.updateShadowSources({newStateVariables:r,dependenciesToUpdate:n}),i=a.shadowedStateVariables,s=a.isReplacement;for(let l in r)this._state[l].essential===!0&&!i.has(l)&&!s&&(e[l]=r[l]);return!0}},Td=Ms;var NA=Mt(qd());import Ws from"math-expressions";var Us=class extends pe{static componentType="evaluate";static rendererType="math";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},e.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atLeastZeroFunctions",componentType:"function",comparison:"atLeast",number:0,requireConsecutive:!0}),r=e.newLeaf({name:"atMostOneInput",componentType:"input",comparison:"atMost",number:1});return e.newOperator({name:"FunctionsAndMaths",operator:"or",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.codePre,delete t.expressionWithCodes,delete t.codesAdjacentToStrings,delete t.mathChildrenByArrayComponent,t.canBeModified={returnDependencies:()=>({}),definition:()=>({newValues:{canBeModified:!1}})},t.nResults={returnDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},inputChild:{dependencyType:"child",childLogicName:"atMostOneInput",variableNames:["nComponents"]}}),definition:function({dependencyValues:e}){let n;return e.functionChildren.length>0&&e.inputChild.length===1&&e.inputChild[0].stateValues.nComponents>0?n=e.functionChildren.length:n=0,{newValues:{nResults:n}}}},t.evaluatedResults={isArray:!0,entryPrefixes:["evaluatedResult"],public:!0,componentType:"math",returnArraySizeDependencies:()=>({nResults:{dependencyType:"stateVariable",variableName:"nResults"}}),returnArraySize({dependencyValues:e}){return[e.nResults]},returnArrayDependenciesByKey({arrayKeys:e}){let n={inputChild:{dependencyType:"child",childLogicName:"atMostOneInput",variableNames:["nComponents","maths"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}},r={};for(let a of e)r[a]={functionChild:{dependencyType:"child",childLogicName:"atLeastZeroFunctions",variableNames:["symbolicf","numericalf","symbolic"],childIndices:[a]}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let a={};if(e.inputChild.length===1&&e.inputChild[0].stateValues.nComponents>0){let i=e.inputChild[0].stateValues.maths[0],s=!1,l;for(let u of r){let c=n[u].functionChild[0];c&&(!e.forceNumeric&&(c.stateValues.symbolic||e.forceSymbolic)?a[u]=c.stateValues.symbolicf(i):(s||(s=!0,l=i.evaluate_to_constant(),l===null&&(l=NaN)),a[u]=Ws.fromAst(c.stateValues.numericalf(l))))}}return{newValues:{evaluatedResults:a}}}},t.evaluatedResult={isAlias:!0,targetVariableName:"evaluatedResult1"},t.unnormalizedValue={public:!0,componentType:this.componentType,returnDependencies:()=>({evaluatedResults:{dependencyType:"stateVariable",variableName:"evaluatedResults"}}),definition:function({dependencyValues:e}){return e.evaluatedResults.length===1?{newValues:{unnormalizedValue:e.evaluatedResults[0]}}:e.evaluatedResults.length>1?{newValues:{unnormalizedValue:Ws.fromAst(["tuple",...e.evaluatedResults.map(n=>n.tree)])}}:{newValues:{unnormalizedValue:Ws.fromAst("\uFF3F")}}}},t}},Kd=Us;import Wd from"math-expressions";var Gs=class extends tn{static componentType="randomNumber";static previewSerializedComponent({sharedParameters:t}){t.typeForSelectableType="number",t.defaultToPrescribedParameters=!0}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={default:"discrete"},e.mean={default:null},e.standarddeviation={default:null},e.variance={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();function n({activeChildrenMatched:p,sharedParameters:m}){let f=p[0],h=f.state.value.split(",");if(h.length===1){let y={componentType:"to",children:[{componentType:"number",children:[{createdComponent:!0,componentName:f.componentName}]}]};return{success:!0,newChildren:[y]}}else if(h.length===2){let y={componentType:"from",children:[{componentType:"number",children:[{componentType:"string",state:{value:h[0].trim()}}]}]},b={componentType:"to",children:[{componentType:"number",children:[{componentType:"string",state:{value:h[1].trim()}}]}]};return{success:!0,newChildren:[y,b],toDelete:[f.componentName]}}else return{success:!1}}let r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"atMostOneFrom",componentType:"from",comparison:"atMost",number:1}),i=e.newLeaf({name:"atMostOneTo",componentType:"to",comparison:"atMost",number:1}),s=e.newOperator({name:"toFrom",operator:"and",propositions:[a,i]}),l=e.newOperator({name:"sugarXorToFrom",operator:"xor",propositions:[r,s]}),u=e.newLeaf({name:"atMostOneStep",componentType:"step",comparison:"atMost",number:1}),c=e.newLeaf({name:"atMostOneCount",componentType:"count",comparison:"atMost",number:1}),d=e.newLeaf({name:"atLeastZeroExcludes",componentType:"exclude",comparison:"atLeast",number:0});return e.newOperator({name:"sequenceLogic",operator:"and",propositions:[l,u,c,d],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this.state.rng=new this.sharedParameters.rngClass,this._state.from===void 0&&(this._state.from={trackChanges:!0}),this._state.to===void 0&&(this._state.to={trackChanges:!0}),this._state.step===void 0&&(this._state.step={trackChanges:!0}),this._state.count===void 0&&(this._state.count={trackChanges:!0}),this._state.exclude===void 0&&(this._state.exclude={trackChanges:!0,value:[]})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.number=!0,this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0;return}if(delete this.unresolvedState.number,delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,this.constructor.getRandomNumberParametersFromChildren(this),Object.keys(this.unresolvedState).length>0){this.unresolvedState.number=!0,this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0;return}if(this._state.value.essential)this._state.number.essential||(this.state.number=this.state.value.evaluate_to_constant());else if(!this._state.number.essential)if(this.state.type==="gaussian")if(this.state.mean===null&&(this.state.mean=0),this.state.variance===null?(this.state.standarddeviation===null&&(this.state.standarddeviation=1),this.state.variance=this.state.standarddeviation**2):this.state.standarddeviation===null?this.state.standarddeviation=Math.sqrt(this.state.variance):this.state.variance=this.state.standarddeviation**2,!(this.state.standarddeviation>0)||!Number.isFinite(this.state.mean)){let n="Invalid mean ("+this.state.mean+") or standard deviation ("+this.state.standarddeviation+") for a gaussian random variable.";console.warn(n),this.state.number=NaN}else{let n=0,r=0;for(;n===0;)n=this.state.rng.random();for(;r===0;)r=this.state.rng.random();let a=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r);this.state.number=this.state.mean+this.state.standarddeviation*a}else this.state.type==="uniform"?(this.state.from===void 0&&(this.state.from=0),this.state.to===void 0&&(this.state.to=1),this.state.number=this.state.from+this.state.rng.random()*(this.state.to-this.state.from)):this.state.validParameters?(this.state.basedOnFrom||(this.state.from=void 0),this.state.basedOnTo||(this.state.to=void 0),this.state.basedOnStep||(this.state.step=void 0),this.state.basedOnCount||(this.state.count=void 0),!this.state.excludeChildren&&!this._state.exclude.essential&&(this.state.exclude=[]),Tt.calculateSequenceParameters(this.state),this.state.number=Tt.selectValues({stateObj:this.state,rng:this.state.rng})[0]):this.state.number=NaN;Number.isFinite(this.state.number)?this.state.value=Wd.fromAst(this.state.number):this.state.value=Wd.fromAst("\uFF3F");let e=this.state.value.round_numbers_to_precision(this.state.displaydigits);this.state.latex=e.toLatex(),this.state.text=e.toString()}static getRandomNumberParametersFromChildren(t){if(t.state.validParameters=!0,t.state.parameterChanged=!1,t.state.type==="gaussian")return;let e=t.currentTracker.trackChanges;e.getVariableChanges({component:t,variable:"type"})&&(["uniform","discrete"].includes(t.state.type)||(console.warn("Unrecognized type ("+t.state.type+") for random number, setting to discrete."),t.state.type="discrete"));let n=e.childrenChanged(t.componentName);if(n){let r=t.childLogic.returnMatches("atMostOneFrom");r.length===1?(t.state.fromChild=t.activeChildren[r[0]],t.state.basedOnFrom=!0):(delete t.state.fromChild,t._state.from.essential&&(t.state.basedOnFrom=!0));let a=t.childLogic.returnMatches("atMostOneTo");a.length===1?(t.state.toChild=t.activeChildren[a[0]],t.state.basedOnTo=!0):(delete t.state.toChild,t._state.to.essential&&(t.state.basedOnTo=!0))}if(t.state.fromChild?t.state.fromChild.unresolvedState.value?t.unresolvedState.from=!0:(n||e.getVariableChanges({component:t.state.fromChild,variable:"value"}))&&(t.state.from=t.state.fromChild.state.value,t.state.parameterChanged=!0):t._state.from.essential&&e.getVariableChanges({component:t,variable:"from"})&&(t.state.parameterChanged=!0),t.state.toChild?t.state.toChild.unresolvedState.value?t.unresolvedState.to=!0:(n||e.getVariableChanges({component:t.state.toChild,variable:"value"}))&&(t.state.to=t.state.toChild.state.value,t.state.parameterChanged=!0):t._state.to.essential&&e.getVariableChanges({component:t,variable:"to"})&&(t.state.parameterChanged=!0),t.state.type!=="uniform"){if(n){let r=t.childLogic.returnMatches("atMostOneStep");r.length===1?(t.state.stepChild=t.activeChildren[r[0]],t.state.basedOnStep=!0):(delete t.state.stepChild,t._state.step.essential&&(t.basedOnStep=!0));let a=t.childLogic.returnMatches("atMostOneCount");a.length===1?(t.state.countChild=t.activeChildren[a[0]],t.state.basedOnCount=!0):(delete t.state.countChild,t._state.count.essential&&(t.state.basedOnCount=!0));let i=t.childLogic.returnMatches("atLeastZeroExcludes");i.length>0?t.state.excludeChildren=i.map(s=>t.activeChildren[s]):delete t.state.excludeChildren}t.state.stepChild?t.state.stepChild.unresolvedState.value?(t.unresolvedState.step=!0,t.state.step=void 0):(n||e.getVariableChanges({component:t.state.stepChild,variable:"value"}))&&(t.state.step=t.state.stepChild.state.value,t.state.parameterChanged=!0):t._state.step.essential&&e.getVariableChanges({component:t,variable:"step"})&&(t.state.parameterChanged=!0),t.state.countChild?t.state.countChild.unresolvedState.value?(t.unresolvedState.count=!0,t.state.count=void 0):(n||e.getVariableChanges({component:t.state.countChild,variable:"number"}))&&(t.state.count=t.state.countChild.state.number,t.state.parameterChanged=!0):t._state.count.essential&&e.getVariableChanges({component:t,variable:"count"})&&(t.state.parameterChanged=!0),t.state.excludeChildren?t.state.excludeChildren.some(r=>r.unresolvedState.value)?t.unresolvedState.exclude=!0:(n||t.state.excludeChildren.some(r=>e.getVariableChanges({component:r,variable:"values"})))&&(t.state.exclude=t.state.excludeChildren.reduce((r,a)=>[...r,...a.state.values],[]),t.state.parameterChanged=!0):t._state.exclude.essential&&e.getVariableChanges({component:t,variable:"exclude"})&&(t.state.parameterChanged=!0),t.state.count!==void 0&&(!Number.isInteger(t.state.count)||t.state.count<0)&&(console.log("Invalid count for discrete uniform random number.  Must be a non-negative integer."),t.state.validParameters=!1),t.state.step!==void 0&&(Number.isFinite(t.state.step)||(t.state.step.evaluate_to_constant&&(t.state.step=t.state.step.evaluate_to_constant()),Number.isFinite(t.state.step)||(console.log("Invalid step for discrete uniform random number.  Must be a number."),t.state.validParameters=!1)))}}},un=Gs;var Xs=class extends G{static componentType="generateRandomNumbers";static assignNamesToReplacements=!0;static previewSerializedComponent=un.previewSerializedComponent;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.numberOfSamples={default:1},e.withreplacement={default:!1},e}static returnChildLogic=un.returnChildLogic;updateState(t={}){if(t.init&&(this.state.seed!==void 0?this.state.rng=new this.sharedParameters.rngClass(this.state.seed):this.state.rng=new this.sharedParameters.rngClass,this._state.from===void 0&&(this._state.from={trackChanges:!0}),this._state.to===void 0&&(this._state.to={trackChanges:!0}),this._state.step===void 0&&(this._state.step={trackChanges:!0}),this._state.count===void 0&&(this._state.count={trackChanges:!0}),this._state.exclude===void 0&&(this._state.exclude={trackChanges:!0,value:[]}),this.replacementsToWithhold=0),super.updateState(t),!this.childLogicSatisfied){this.state.randomResults=[];return}if(un.getRandomNumberParametersFromChildren(this),Object.keys(this.unresolvedState).length>0){this.state.randomResults=[];return}if(this.state.randomResults=[],this.state.type==="gaussian")if(this.state.mean===null&&(this.state.mean=0),this.state.variance===null?(this.state.standarddeviation===null&&(this.state.standarddeviation=1),this.state.variance=this.state.standarddeviation**2):this.state.standarddeviation===null&&(this.state.standarddeviation=Math.sqrt(this.state.variance)),!(this.state.standarddeviation>0)||!Number.isFinite(this.state.mean)){let n="Invalid mean ("+this.state.mean+") or standard deviation ("+this.state.standarddeviation+") for a gaussian random variable.";console.warn(n)}else for(let n=0;n<this.state.numberOfSamples;n++){let r=0,a=0;for(;r===0;)r=this.state.rng.random();for(;a===0;)a=this.state.rng.random();let i=Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*a);this.state.randomResults.push(this.state.mean+this.state.standarddeviation*i)}else if(this.state.type==="uniform"){this.state.from===void 0&&(this.state.from=0),this.state.to===void 0&&(this.state.to=1);let n=this.state.to-this.state.from;for(let r=0;r<this.state.numberOfSamples;r++)this.state.randomResults.push(this.state.from+this.state.rng.random()*n)}else if(this.state.validParameters){this.state.basedOnFrom||(this.state.from=void 0),this.state.basedOnTo||(this.state.to=void 0),this.state.basedOnStep||(this.state.step=void 0),this.state.basedOnCount||(this.state.count=void 0),!this.state.excludeChildren&&!this._state.exclude.essential&&(this.state.exclude=[]),Tt.calculateSequenceParameters(this.state);let n=1;this.state.withreplacement||(n=this.state.numberOfSamples),n>this.state.count?console.warn("Cannot randomly sample "+n+" values from a sequence of length "+this.state.count):this.state.randomResults=Tt.selectValues({stateObj:this.state,numberUniqueRequired:n,numberToSelect:this.state.numberOfSamples,withReplacement:this.state.withreplacement,rng:this.state.rng})}let e=this.doenetAttributes.componentName;e!==void 0&&(this.attributes.newNamespace===!0?this.state.randomNumberNamespace=e+"/":this.state.randomNumberNamespace=e.substring(0,e.lastIndexOf("/")+1))}static createSerializedReplacements({component:t}){let e=[],n=t.doenetAttributes.assignNames;for(let[r,a]of t.state.randomResults.entries()){let i;n!==void 0&&r<n.length?i=n[r]:i="_"+t.componentName+"_"+r,t.state.randomNumberNamespace!==void 0&&(i=t.state.randomNumberNamespace+i),e.push({componentType:"number",doenetAttributes:{componentName:i},state:{value:a}})}return{replacements:e}}static calculateReplacementChanges({component:t}){let e=[],n=0;t.doenetAttributes.assignNames!==void 0&&(n=t.doenetAttributes.assignNames.length);let r=t.replacements.length-t.replacementsToWithhold;if(r>t.state.randomResults.length){let i=t.replacementsToWithhold;if(t.replacementsToWithhold===0){let s=Math.max(t.state.randomResults.length,n),l=Math.max(0,t.replacements.length-s);if(i=Math.max(0,n-t.state.randomResults.length),l>0){let u={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToDelete:l};e.push(u)}}else i=t.replacements.length-t.state.randomResults.length;if(i!==t.replacementsToWithhold){let s={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};e.push(s)}}else if(r<t.state.randomResults.length){let i=[],s=t.doenetAttributes.assignNames,l=Math.max(0,t.replacements.length-t.state.randomResults.length);if(l!==t.replacementsToWithhold){let c={changeType:"changeReplacementsToWithhold",replacementsToWithhold:l};e.push(c)}for(let c=t.replacements.length;c<t.state.randomResults.length;c++){let d;s!==void 0&&c<s.length?d=s[c]:d="_"+t.componentName+"_"+c,t.state.randomNumberNamespace!==void 0&&(d=t.state.randomNumberNamespace+d),i.push({componentType:"number",doenetAttributes:{componentName:d},state:{value:t.state.randomResults[c]}})}let u={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:t.replacements.length,numberReplacementsToReplace:0,serializedReplacements:i};e.push(u)}let a=Math.min(t.replacements.length,t.state.randomResults.length);for(let i=0;i<a;i++){let s={changeType:"updateStateVariables",component:t.replacements[i],stateChanges:{value:t.state.randomResults[i]}};e.push(s)}return e}},Ud=Xs;import Ar from"math-expressions";var Zs=class extends G{static componentType="substitute";static defaultType="number";static previewSerializedComponent({serializedComponent:t,sharedParameters:e,components:n}){if(t.children===void 0)return;let r;for(let[s,l]of t.children.entries())if(l.componentType==="type"||l.createdComponent&&n[l.componentName].componentType==="type"){r=s;break}let a;for(let[s,l]of t.children.entries())if(l.componentType==="simplify"||l.createdComponent&&n[l.componentName].componentType==="simplify"){a=s;break}let i=[];return r!==void 0&&i.push({createChildren:[r]}),a!==void 0&&i.push({createChildren:[a]}),i.push({callMethod:"setUpTypeSimplify"}),i}static setUpTypeSimplify({sharedParameters:t,definingChildrenSoFar:e,serializedComponent:n}){let r;for(let i of e)if(i!==void 0&&i.componentType==="type"){r=i;break}if(r!==void 0){if(!["math","text"].includes(r.state.value))throw Error("Substitute type must be text or math");t.defaultType=r.state.value}let a;for(let i of e)if(i!==void 0&&i.componentType==="simplify"){a=i;break}a!==void 0&&(t.simplify=a.state.value)}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.type={default:void 0},e.format={default:"text"},e.simplify={default:"full"},e.displaydigits={default:10},e.rendermode={default:"inline"},e.matchwholeword={default:!1},e.casesensitive={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:l,sharedParameters:u}){let c=jt({childrenList:l});if(!c.success)return{success:!1};let d=c.toDelete,p="math";u.defaultType==="text"&&(p="text");let m={componentType:p};p==="math"&&u.simplify!==void 0&&(m.state={simplify:u.simplify});let f=Object.assign({},m);f.children=c.pieces[0];let h=[{componentType:"pattern",children:[f]}],y=c.pieces.slice(1);for(let b of y){let g=Qn(b);if(!g.foundVector)return{sucess:!1};d.push(...g.toDelete);let C=[],T=Object.assign({},m);T.children=g.vectorComponents[0],C.push(T),T=Object.assign({},m),T.children=g.vectorComponents[1],C.push(T),h.push({componentType:"replace",children:C})}return{success:!0,newChildren:h,toDelete:d}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"exactlyOnePattern",componentType:"pattern",number:1}),i=e.newLeaf({name:"atLeastZeroReplaces",componentType:"replace",comparison:"atLeast",number:0}),s=e.newOperator({name:"substitutionChildren",operator:"and",propositions:[a,i]});return e.newOperator({name:"sugarXorSubstitutionChildren",operator:"xor",propositions:[r,s],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let i=this.childLogic.returnMatches("exactlyOnePattern");this.state.patternParent=this.activeChildren[i[0]]}if(!this.state.patternParent.childLogicSatisfied){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}let r=!1,a=e.getVariableChanges({component:this,variable:"type"});if(n||a||e.childrenChanged(this.state.patternParent))if(r=!0,this.state.patternChild=this.state.patternParent.activeChildren[0],this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.math)this.state.type="math",this.state.patternClass="math";else if(this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.text)this.state.type="text",this.state.patternClass="text";else if(this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.string)this.state.patternClass="string";else{console.warn("Substitute must have a math, text or string pattern."),this.unresolvedState.value=!0,this.state.patternClass="invalid";return}if(this.state.patternClass==="invalid"){console.warn("Substitute must have a math, text or string pattern.");return}if(this.state.patternChild.unresolvedState.value){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}if(this.state.patternClass==="string"?(n||e.getVariableChanges({component:this.state.patternChild,variable:"value"})||e.getVariableChanges({component:this,variable:"type"}))&&(r=!0,this.state.type==="text"?this.state.originalValue=this.state.patternChild.state.value:(this.state.type="math",this.state.originalValue=this.parseMathString(this.state.patternChild.state.value)),delete this.unresolvedState.originalValue):(n||e.getVariableChanges({component:this.state.patternChild,variable:"value"}))&&(r=!0,this.state.originalValue=this.state.patternChild.state.value,delete this.unresolvedState.originalValue),n){let i=this.childLogic.returnMatches("atLeastZeroReplaces");this.state.replaceChildren=i.map(s=>this.activeChildren[s])}if(this.state.replaceChildren.some(i=>!i.childLogicSatisfied||i.activeChildren.some(s=>s.unresolvedState.value))){this.unresolvedState.value=!0;return}if(n||a||this.state.replaceChildren.some(i=>e.childrenChanged(i)||i.activeChildren.some(s=>e.getVariableChanges({component:s,variable:"value"})))){r=!0,this.state.replaces=[];for(let i of this.state.replaceChildren){let s=[];for(let l of i.activeChildren)if(this.state.type==="math")if(l instanceof this.componentInfoObjects.allComponentClasses.math)s.push(l.state.value);else if(l instanceof this.componentInfoObjects.allComponentClasses.string)s.push(this.parseMathString(l.state.value));else{console.warn("Substitute of math type must have math or string replaces"),this.unresolvedState.value=!0;return}else if(this.state.type==="text")if(l instanceof this.componentInfoObjects.allComponentClasses.text||l instanceof this.componentInfoObjects.allComponentClasses.string)s.push(l.state.value);else{console.warn("Substitute of text type must have text or string replaces"),this.unresolvedState.value=!0;return}this.state.replaces.push(s)}}if(e.getVariableChanges({component:this,variable:"simplify"})&&(r=!0),!!r)if(delete this.unresolvedState.value,this.state.numSubstitutions=this.state.replaces.length,this.state.type==="text"){let i=function(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};this.state.value=this.state.originalValue;for(let s=0;s<this.state.numSubstitutions;s++){let l,u="g";this.state.casesensitive||(u="gi"),this.state.matchwholeword?l=new RegExp("\\b"+i(this.state.replaces[s][0])+"\\b",u):l=new RegExp(i(this.state.replaces[s][0]),u);let c=this.state.replaces[s][1];this.state.value=this.state.value.replace(l,c)}}else{this.state.value=this.state.originalValue.subscripts_to_strings();for(let i=0;i<this.state.numSubstitutions;i++)this.state.value=this.state.value.substitute({[this.state.replaces[i][0].subscripts_to_strings().tree]:this.state.replaces[i][1].subscripts_to_strings()});this.state.value=this.state.value.strings_to_subscripts(),this.state.value=We({value:this.state.value,simplify:this.state.simplify})}}parseMathString(t){if(this.state.format==="text")try{return Ar.fromAst(Z.convert(t))}catch(e){return console.log("Invalid value for a math of text format: "+t),Ar.fromAst("\uFF3F")}else if(this.state.format==="latex")try{return Ar.fromAst(Ke.convert(t))}catch(e){return console.log("Invalid value for a math of latex format: "+t),Ar.fromAst("\uFF3F")}else throw Error("Unrecongized math format")}static createSerializedReplacements({component:t}){if(Object.keys(t.unresolvedState).length>0)return{replacements:[]};let e={componentType:t.state.type,state:{value:t.state.value}};if(t.state.type==="math")for(let n of["simplify","displaydigits","rendermode"])t._state[n].usedDefault||(e.state[n]=t.state.item);return{replacements:[e]}}static calculateReplacementChanges({component:t}){let e=[];if(t.state.type!==t.replacements[0].componentType){let n=this.createSerializedReplacements({component:t}).replacements,r={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:1,serializedReplacements:n};e.push(r)}else{let n={value:t.state.value};if(t.state.type==="math")for(let a of["simplify","displaydigits","rendermode"])t._state[a].usedDefault||(n[a]=t.state.item);let r={changeType:"updateStateVariables",component:t.replacements[0],stateChanges:n};e.push(r)}return e}},Gd=Zs;var Js=class extends ft{static componentType="offsets";updateState(t={}){if(t.init===!0&&(this.makePublicStateVariableArray({variableName:"offsets",componentType:"offset"}),this.makePublicStateVariableArrayEntry({entryName:"offset",arrayVariableName:"offsets"})),super.updateState(t),this.unresolvedState.maths){this.unresolvedState.offsets=!0;return}if(this.currentTracker.trackChanges.getVariableChanges({component:this,variable:"maths"})){this.state.offsets=[];for(let e=1;e<=this.state.ncomponents;e++){let n=this.state.maths[e-1];this.state.offsets.push(n)}}}},Xd=Js;import ue from"math-expressions";var Ys=class extends pe{static componentType="discreteInfiniteSet";static previewSerializedComponent({serializedComponent:t,sharedParameters:e,components:n}){if(t.children===void 0)return;let r;for(let[i,s]of t.children.entries())if(s.componentType==="simplify"||s.createdComponent&&n[s.componentName].componentType==="simplify"){r=i;break}let a=[];return r!==void 0&&a.push({createChildren:[r]}),a.push({callMethod:"setUpSimplify"}),a}static setUpSimplify({sharedParameters:t,definingChildrenSoFar:e,serializedComponent:n}){let r;for(let a of e)if(a!==void 0&&a.componentType==="simplify"){r=a;break}r!==void 0&&(t.simplifyChild=r)}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.minindex={default:ue.fromAst(["-",Infinity])},e.maxindex={default:ue.fromAst(Infinity)},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=function({activeChildrenMatched:l,sharedParameters:u}){let c=jt({childrenList:l});if(!c.success||c.pieces.length!==2)return{success:!1};let d=c.toDelete,p=[],m=[],f=Qn(c.pieces[0]);if(f.foundVector)for(let y of f.vectorComponents){let b={componentType:"offset",children:y};u.simplifyChild!==void 0&&b.children.push({componentType:"ref",children:[{componentType:"reftarget",state:{targetName:u.simplifyChild.componentName}}]}),m.push(b)}else m=c.pieces[0];p.push({componentType:"offsets",children:m});let h=result.pieces[1];return u.simplifyChild!==void 0&&(h.push({componentType:"ref",children:[{componentType:"reftarget",state:{targetName:u.simplifyChild.componentName}}]}),p.push({componentType:"period",children:h})),{success:!0,newChildren:p,toDelete:d}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),a=e.newLeaf({name:"atMostOneOffsets",componentType:"offsets",comparison:"atMost",number:1}),i=e.newLeaf({name:"atMostOnePeriod",componentType:"period",comparison:"atMost",number:1}),s=e.newOperator({name:"offsetsAndPeriod",operator:"and",propositions:[a,i]});return e.newOperator({name:"SugarXorOffsetsPeriod",operator:"xor",propositions:[r,s],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this.makePublicStateVariable({variableName:"offsets",componentType:"offsets"}),this.makePublicStateVariable({variableName:"period",componentType:"period"}),this.makePublicStateVariable({variableName:"redundantoffsets",componentType:"boolean"})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}let e=!1,n=!1,r=this.currentTracker.trackChanges,a=r.childrenChanged(this.componentName);if(a){e=!0;let s=this.childLogic.returnMatches("atMostOneOffsets");s.length===1?this.state.offsetsChild=this.activeChildren[s[0]]:(delete this.state.offsetsChild,this._state.value.essential?r.getVariableChanges({component:this,variable:"value"})&&(e=!0):(n=!0,this.state.offsets=[],this.state.nOffsets=0,this.state.value=ue.fromAst("\uFF3F")));let l=this.childLogic.returnMatches("atMostOnePeriod");l.length===1?this.state.periodChild=this.activeChildren[l[0]]:(delete this.state.periodChild,this._state.value.essential?r.getVariableChanges({component:this,variable:"value"})&&(e=!0):(n=!0,this.state.period=ue.fromAst("\uFF3F"),this.state.value=ue.fromAst("\uFF3F")))}if(n){delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,delete this.unresolvedState.offsets,delete this.unresolvedState.period,delete this.unresolvedState.redundantoffsets;return}if(this.state.offsetsChild){if(this.state.offsetsChild.unresolvedState.maths){this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0,this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}(a||r.getVariableChanges({component:this.state.offsetsChild,variable:"maths"}))&&(e=!0,this.state.offsets=this.state.offsetsChild.state.maths,this.state.nOffsets=this.state.offsetsChild.state.ncomponents)}if(this.state.periodChild){if(this.state.periodChild.unresolvedState.value){this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0,this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}(a||r.getVariableChanges({component:this.state.periodChild,variable:"value"}))&&(e=!0,this.state.period=this.state.periodChild.state.value)}if(!e&&(!this._state.value.essential||!r.getVariableChanges({component:this,variable:"value"})))return;if(delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,delete this.unresolvedState.offsets,delete this.unresolvedState.period,delete this.unresolvedState.redundantoffsets,this._state.value.essential)if(Array.isArray(this.state.value.tree)&&this.state.value.tree[0]==="discrete_infinite_set"){let s=this.state.value.tree[1];this.state.offsets=[ue.fromAst(s[1])],this.state.period=ue.fromAst(s[2]),this.state.minindex=ue.fromAst(s[3]),this.state.maxindex=ue.fromAst(s[4]);for(let l=2;l<this.state.value.tree.length;l++)s=this.state.value.tree[l],this.state.offsets.push(ue.fromAst(s[1])),this.state.period.equals(ue.fromAst(s[2]))||console.warn("Have not implemented discrete infinite set with different periods."),this.state.minindex.equals(ue.fromAst(s[3]))||console.warn("Have not implemented discrete infinite set with different minindices."),this.state.maxindex.equals(ue.fromAst(s[4]))||console.warn("Have not implemented discrete infinite set with different maxindices.");this.state.nOffsets=this.state.value.tree.length-1}else this.state.value=ue.fromAst("\uFF3F"),this.state.period=ue.fromAst("uFF3F"),this.state.offsets=[];else if(this.state.nOffsets===0||this.state.period.tree==="\uFF3F")this.state.value=ue.fromAst("\uFF3F");else if(this.state.nOffsets===1)this.state.value=ue.create_discrete_infinite_set({offsets:this.state.offsets[0],periods:this.state.period,min_index:this.state.minindex,max_index:this.state.maxindex});else{let s=ue.fromAst(["list",...this.state.offsets.map(l=>l.tree)]);this.state.value=ue.create_discrete_infinite_set({offsets:s,periods:this.state.period,min_index:this.state.minindex,max_index:this.state.maxindex})}this.state.redundantoffsets=!1;let i=this.state.period.evaluate_to_constant();if(i!==null)for(let s=0;s<this.state.nOffsets;s++){for(let l=0;l<s;l++){let u=this.state.offsets[s].subtract(this.state.offsets[l]).evaluate_to_constant();if(u!==null&&Math.abs(u%i)<1e-10*i){this.state.redundantoffsets=!0;break}}if(this.state.redundantoffsets)break}this.state.latex=""}},Zd=Ys;var Qs=class extends X{static componentType="image";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:null,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:null,public:!0,forRenderer:!0},e.description={createComponentOfType:"text",createStateVariable:"description",defaultValue:null,public:!0,forRenderer:!0},e.source={createComponentOfType:"text",createStateVariable:"source",required:!0,public:!0,forRenderer:!0},e}},Jd=Qs;var eo=class extends X{static componentType="video";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:500,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:500,public:!0,forRenderer:!0},e.youtube={createComponentOfType:"text",createStateVariable:"youtube",defaultValue:null,public:!0,forRenderer:!0},e.source={createComponentOfType:"text",createStateVariable:"source",defaultValue:null,public:!0,forRenderer:!0},e}actions={recordVideoStarted:this.recordVideoStarted.bind(this),recordVideoWatched:this.recordVideoWatched.bind(this),recordVideoPaused:this.recordVideoPaused.bind(this),recordVideoSkipped:this.recordVideoSkipped.bind(this),recordVideoCompleted:this.recordVideoCompleted.bind(this)};recordVideoStarted({beginTime:t,duration:e,rate:n}){this.coreFunctions.requestRecordEvent({verb:"played",object:{componentName:this.componentName,componentType:this.componentType,duration:e},context:{startingPoint:t,rate:n}})}recordVideoWatched({beginTime:t,endTime:e,duration:n,rates:r}){this.coreFunctions.requestRecordEvent({verb:"watched",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:t,endingPoint:e,rates:r}})}recordVideoPaused({endTime:t,duration:e}){this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType,duration:e},context:{endingPoint:t}})}recordVideoSkipped({beginTime:t,endTime:e,duration:n}){this.coreFunctions.requestRecordEvent({verb:"skipped",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:t,endingPoint:e}})}recordVideoCompleted({duration:t}){this.coreFunctions.requestRecordEvent({verb:"completed",object:{componentName:this.componentName,componentType:this.componentType,duration:t}})}},Yd=eo;var to=class extends X{static componentType="embed";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:500,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:500,public:!0,forRenderer:!0},e.geogebra={createComponentOfType:"text",createStateVariable:"geogebra",defaultValue:null,public:!0,forRenderer:!0},e.encodedGeogebraContent={createComponentOfType:"text",createStateVariable:"encodedGeogebraContent",defaultValue:null,public:!0,forRenderer:!0},e.fromMathInsight={createComponentOfType:"text",createStateVariable:"fromMathInsight",defaultValue:null,public:!0,forRenderer:!0},e}},Qd=to;var no=class extends B{static componentType="meta";static createAttributesObject(t){return super.createAttributesObject(t)}},ep=no;var ro=class extends X{static componentType="hint";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),r=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0}),i=e.newOperator({name:"inlineOrBlock",operator:"or",propositions:[r,a]});return e.newOperator({name:"titleAndContent",operator:"and",propositions:[n,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.showHints={forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},showHintsFlag:{dependencyType:"flag",flagName:"showHints"}}),definition({dependencyValues:e}){return{newValues:{showHints:e.showHintsFlag&&!e.hide}}}},t.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"open",value:e.open}]}}},t.titleDefinedByChildren={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:e}){return{newValues:{titleDefinedByChildren:e.titleChild.length===1}}}},t.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]}}),definition({dependencyValues:e}){return e.titleChild.length===0?{newValues:{title:"Hint"}}:{newValues:{title:e.titleChild[0].stateValues.text}}}},t}revealHint(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}closeHint(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealHint:this.revealHint.bind(this),closeHint:this.closeHint.bind(this)}},tp=ro;var ao=class extends X{constructor(t){super(t);this.revealSolution=this.revealSolution.bind(this),this.revealSolutionCallBack=this.revealSolutionCallBack.bind(this)}static componentType="solution";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.hide={createComponentOfType:"boolean"},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0});return e.newOperator({name:"inlineAndBlock",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({hideAttr:{dependencyType:"attributeComponent",attributeName:"hide",variableNames:["value"]},displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="none"?{newValues:{hide:!0}}:e.hideAttr!==null?{newValues:{hide:e.hideAttr.stateValues.value}}:{useEssentialOrDefaultValue:{hide:{variablesToCheck:["hide"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.displayMode==="none"?{success:!1}:n.hideAttr!==null?{success:!0,instructions:[{setDependency:"hideAttr",desiredValue:e.hide,variableIndex:0}]}:{success:!0,instructions:[{setSetVariable:"hide",value:e.hide}]}}},t.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="displayed"?{newValues:{open:!0}}:e.displayMode==="none"?{newValues:{open:!1}}:{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.displayMode==="displayed"||n.displayMode==="none"?{success:!1}:{success:!0,instructions:[{setStateVariable:"open",value:e.open}]}}},t.canBeClosed={forRenderer:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="button"?{newValues:{canBeClosed:!0}}:{newValues:{canBeClosed:!1}}}},t.message={public:!0,componentType:"text",forRenderer:!0,defaultValue:"",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{message:{variablesToCheck:["message"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"message",value:e.message}]}}},t}revealSolutionCallBack({allowView:t,message:e,scoredComponent:n}){let r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:t},{updateType:"updateValue",componentName:this.componentName,stateVariable:"message",value:e}],a;t&&(r.push({updateType:"updateValue",componentName:n,stateVariable:"viewedSolution",value:!0}),a={verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}),this.coreFunctions.requestUpdate({updateInstructions:r,event:a})}revealSolution(){let{scoredItemNumber:t,scoredComponent:e}=this.coreFunctions.calculateScoredItemNumberOfContainer(this.componentName);this.coreFunctions.recordSolutionView({itemNumber:t,scoredComponent:e,callBack:this.revealSolutionCallBack})}closeSolution(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealSolution:this.revealSolution.bind(this),closeSolution:this.closeSolution.bind(this)};static includeBlankStringChildren=!0},np=ao;var io=class extends Be{static componentType="intcomma";static rendererType="text";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.originalValue=t.value,nt({stateVariableDefinitions:t,oldName:"value",newName:"originalValue"}),t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({originalValue:{dependencyType:"stateVariable",variableName:"originalValue"}}),definition:function({dependencyValues:e}){let n=e.originalValue,r=/^(-?\d+)(\d{3})/,a=n.match(r);for(;a!==null;)n=n.replace(r,"$1,$2"),a=n.match(r);return{newValues:{value:n}}}},t}},rp=io;var ap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),ip=function(o){let t=(o=o||"_")+"-";for(let e=0;e<7;e++)t+=ap[Math.floor(Math.random()*ap.length)];return t},sp={"!":"\xA1","?":"\xBF\u0241",'"':'\u201C\u201D"\u275D\u275E',"'":"\u2018\u201B\u275B\u275C","-":"\u2014\u2013",a:"\xAA\xC0\xC1\xC2\xC3\xC4\xC5\xE0\xE1\xE2\xE3\xE4\xE5\u0100\u0101\u0102\u0103\u0104\u0105\u01CD\u01CE\u01DE\u01DF\u01E0\u01E1\u01FA\u01FB\u0200\u0201\u0202\u0203\u0226\u0227\u023A\u0386\u0391\u0394\u039B\u03AC\u03B1\u03BB\u0410\u0430\u0434\u0466\u0467\u04D0\u04D1\u04D2\u04D3\u019B\u0245\xE6",b:"\xDF\xFE\u0180\u0181\u0182\u0183\u0184\u0185\u0243\u0392\u03B2\u03D0\u03E6\u0411\u0412\u042A\u042C\u0432\u044A\u044C\u0462\u0463\u048C\u048D",c:"\xA2\xA9\xC7\xE7\u0106\u0107\u0108\u0109\u010A\u010B\u010C\u010D\u0186\u0187\u0188\u023B\u023C\u037B\u037C\u037D\u03F2\u03F9\u03FD\u03FE\u0421\u0441\u0454\u0480\u0481\u04AA\u04AB",d:"\xD0\u010E\u010F\u0110\u0111\u0189\u018A\u0221\u018B\u018C\u01F7",e:"\xC8\xC9\xCA\xCB\xE8\xE9\xEA\xEB\u0112\u0113\u0114\u0115\u0116\u0117\u0118\u0119\u011A\u011B\u018E\u018F\u0190\u01DD\u0204\u0205\u0206\u0207\u0228\u0229\u0246\u0247\u0388\u0395\u039E\u03A3\u03AD\u03B5\u03BE\u03F1\u03F5\u03F6\u0400\u0401\u0415\u042D\u0435\u0450\u0451\u04BC\u04BD\u04BE\u04BF\u04D6\u04D7\u04D8\u04D9\u04DA\u04DB\u04EC\u04ED",f:"\u0191\u0192\u03DC\u03DD\u04FA\u04FB\u0492\u0493\u017F",g:"\u011C\u011D\u011E\u011F\u0120\u0121\u0122\u0123\u0193\u01E4\u01E5\u01E6\u01E7\u01F4\u01F5",h:"\u0124\u0125\u0126\u0127\u0195\u01F6\u021E\u021F\u0389\u0397\u0402\u040A\u040B\u041D\u043D\u0452\u045B\u04A2\u04A3\u04A4\u04A5\u04BA\u04BB\u04C9\u04CA",I:"\xCC\xCD\xCE\xCF",i:"\xEC\xED\xEE\xEF\u0128\u0129\u012A\u012B\u012C\u012D\u012E\u012F\u0130\u0131\u0196\u0197\u0208\u0209\u020A\u020B\u038A\u0390\u03AA\u03AF\u03B9\u03CA\u0406\u0407\u0456\u0457",j:"\u0134\u0135\u01F0\u0237\u0248\u0249\u03F3\u0408\u0458",k:"\u0136\u0137\u0138\u0198\u0199\u01E8\u01E9\u039A\u03BA\u040C\u0416\u041A\u0436\u043A\u045C\u049A\u049B\u049C\u049D\u049E\u049F\u04A0\u04A1",l:"\u0139\u013A\u013B\u013C\u013D\u013E\u013F\u0140\u0141\u0142\u019A\u01AA\u01C0\u01CF\u01D0\u0234\u023D\u0399\u04C0\u04CF",m:"\u039C\u03FA\u03FB\u041C\u043C\u04CD\u04CE",n:"\xD1\xF1\u0143\u0144\u0145\u0146\u0147\u0148\u0149\u014A\u014B\u019D\u019E\u01F8\u01F9\u0220\u0235\u039D\u03A0\u03AE\u03B7\u03DE\u040D\u0418\u0419\u041B\u041F\u0438\u0439\u043B\u043F\u045D\u048A\u048B\u04C5\u04C6\u04E2\u04E3\u04E4\u04E5\u03C0",o:"\xD2\xD3\xD4\xD5\xD6\xD8\xF0\xF2\xF3\xF4\xF5\xF6\xF8\u014C\u014D\u014E\u014F\u0150\u0151\u019F\u01A0\u01A1\u01D1\u01D2\u01EA\u01EB\u01EC\u01ED\u01FE\u01FF\u020C\u020D\u020E\u020F\u022A\u022B\u022C\u022D\u022E\u022F\u0230\u0231\u038C\u0398\u039F\u03B8\u03BF\u03C3\u03CC\u03D5\u03D8\u03D9\u03EC\u03ED\u03F4\u041E\u0424\u043E\u0472\u0473\u04E6\u04E7\u04E8\u04E9\u04EA\u04EB",p:"\u01A4\u01BF\u03A1\u03C1\u03F7\u03F8\u03FC\u0420\u0440\u048E\u048F\xDE",q:"\u024A\u024B",r:"\u0154\u0155\u0156\u0157\u0158\u0159\u01A6\u0210\u0211\u0212\u0213\u024C\u024D\u0403\u0413\u042F\u0433\u044F\u0453\u0490\u0491",s:"\u015A\u015B\u015C\u015D\u015E\u015F\u0160\u0161\u01A7\u01A8\u0218\u0219\u023F\u0405\u0455",t:"\u0162\u0163\u0164\u0165\u0166\u0167\u01AB\u01AC\u01AD\u01AE\u021A\u021B\u0236\u023E\u0393\u03A4\u03C4\u03EE\u0422\u0442",u:"\xB5\xD9\xDA\xDB\xDC\xF9\xFA\xFB\xFC\u0168\u0169\u016A\u016B\u016C\u016D\u016E\u016F\u0170\u0171\u0172\u0173\u01AF\u01B0\u01B1\u01B2\u01D3\u01D4\u01D5\u01D6\u01D7\u01D8\u01D9\u01DA\u01DB\u01DC\u0214\u0215\u0216\u0217\u0244\u03B0\u03BC\u03C5\u03CB\u03CD",v:"\u03BD\u0474\u0475\u0476\u0477",w:"\u0174\u0175\u019C\u03C9\u03CE\u03D6\u03E2\u03E3\u0428\u0429\u0448\u0449\u0461\u047F",x:"\xD7\u03A7\u03C7\u03D7\u03F0\u0425\u0445\u04B2\u04B3\u04FC\u04FD\u04FE\u04FF",y:"\xDD\xFD\xFF\u0176\u0177\u0178\u01B3\u01B4\u0232\u0233\u024E\u024F\u038E\u03A5\u03AB\u03B3\u03C8\u03D2\u03D3\u03D4\u040E\u0423\u0443\u0447\u045E\u0470\u0471\u04AE\u04AF\u04B0\u04B1\u04EE\u04EF\u04F0\u04F1\u04F2\u04F3",z:"\u0179\u017A\u017B\u017C\u017D\u017E\u01A9\u01B5\u01B6\u0224\u0225\u0240\u0396\u03B6"},so={};Object.keys(sp).forEach(function(o){sp[o].split("").forEach(function(t){so[t]=o})});var oo=o=>{let t=o.split("");return t.forEach((e,n)=>{so[e]&&(t[n]=so[e])}),t.join("")},Kh=/([A-Z]\.)+[A-Z]?,?$/,Wh=/^[A-Z]\.,?$/,Uh=/[A-Z]{2,}('s|,)?$/,Gh=/([a-z]\.)+[a-z]\.?$/,op=function(o){return Kh.test(o)===!0||Gh.test(o)===!0||Wh.test(o)===!0||Uh.test(o)===!0},Xh=/[a-z\u00C0-\u00FF] ?\/ ?[a-z\u00C0-\u00FF]/,Zh=function(o){let t=o=(o=(o=o||"").toLowerCase()).trim();return o=oo(o),Xh.test(o)===!0&&(o=o.replace(/\/.*/,"")),o=(o=(o=(o=(o=(o=(o=o.replace(/^[#@]/,"")).replace(/[,;.!?]+$/,"")).replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'")).replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"')).replace(/\u2026/g,"...")).replace(/\u2013/g,"-")).replace(/([aeiou][ktrp])in$/,"$1ing"),/^(re|un)-?[^aeiou]./.test(o)===!0&&(o=o.replace("-","")),op(o)&&(o=o.replace(/\./g,"")),/^[:;]/.test(o)===!1&&(o=(o=(o=o.replace(/\.{3,}$/g,"")).replace(/[",\.!:;\?\)]+$/g,"")).replace(/^['"\(]+/g,"")),(o=(o=o.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())===""&&(o=t),o=o.replace(/([0-9]),([0-9])/g,"$1$2")},Jh=function(o){return o=(o=o.replace(/[']s$/,"")).replace(/s[']$/,"s")},Yh=/^[ \n\t\.\[\](){}:,!\-?;\/&*^%+=~\|\u0022\uFF02\u0027\u201C\u201F\u201B\u201E\u2E42\u201A\u2035\u2036\u2037\u301D\u0060\u301F]+/,Qh=/[ \n\t\.'\[\](){}:,!\-?;\/&*@^#+=~\|\u0022\uFF02\u201D\u00B4\u301E]+$/,lp=/\//,lo=/[']/,eb=/^[a-z]\.([a-z]\.)+/i,tb=/^[-+\.][0-9]/,nb=/^'[0-9]{2}/,up=o=>{let t=o,e="",n="";(o=(o=o.replace(Yh,i=>(e=i,e!=="-"&&e!=="+"&&e!=="."||!tb.test(o)?e==="'"&&nb.test(o)?(e="",i):"":(e="",i)))).replace(Qh,i=>(n=i,lo.test(i)&&/[sn][']$/.test(t)&&lo.test(e)===!1?(n=n.replace(lo,""),"'"):eb.test(o)===!0?(n=n.replace(/\./,""),"."):"")))===""&&(t=t.replace(/ *$/,i=>(n=i||"","")),o=t,e="",n=n);let r=Zh(o),a={text:o,clean:r,reduced:Jh(r),pre:e,post:n};return lp.test(o)&&o.split(lp).forEach(i=>{a.alias=a.alias||{},a.alias[i.trim()]=!0}),a};function Ee(o){var t={exports:{}};return o(t,t.exports),t.exports}var rb=Ee(function(o,t){let e=/^[A-Z][a-z'\u00C0-\u00FF]/,n=/^[A-Z]+s?$/;t.toUpperCase=function(){return this.text=this.text.toUpperCase(),this},t.toLowerCase=function(){return this.text=this.text.toLowerCase(),this},t.toTitleCase=function(){return this.text=this.text.replace(/^ *[a-z\u00C0-\u00FF]/,r=>r.toUpperCase()),this},t.isUpperCase=function(){return n.test(this.text)},t.isTitleCase=function(){return e.test(this.text)},t.titleCase=t.isTitleCase}),ab=Ee(function(o,t){let e=/(\u0022|\uFF02|\u0027|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\u00AB|\u2039|\u2035|\u2036|\u2037|\u301D|\u0060|\u301F)/,n=/(\u0022|\uFF02|\u0027|\u201D|\u2019|\u201D|\u2019|\u201D|\u201D|\u2019|\u00BB|\u203A|\u2032|\u2033|\u2034|\u301E|\u00B4|\u301E)/;t.hasPost=function(r){return this.post.indexOf(r)!==-1},t.hasPre=function(r){return this.pre.indexOf(r)!==-1},t.hasQuote=function(){return e.test(this.pre)||n.test(this.post)},t.hasQuotation=t.hasQuote,t.hasComma=function(){return this.hasPost(",")},t.hasPeriod=function(){return this.hasPost(".")===!0&&this.hasPost("...")===!1},t.hasExclamation=function(){return this.hasPost("!")},t.hasQuestionMark=function(){return this.hasPost("?")||this.hasPost("\xBF")},t.hasEllipses=function(){return this.hasPost("..")||this.hasPost("\u2026")||this.hasPre("..")||this.hasPre("\u2026")},t.hasSemicolon=function(){return this.hasPost(";")},t.hasSlash=function(){return/\//.test(this.text)},t.hasHyphen=function(){let r=/^(-||)$/;return r.test(this.post)||r.test(this.pre)},t.hasDash=function(){let r=/ (-||) /;return r.test(this.post)||r.test(this.pre)},t.hasContraction=function(){return Boolean(this.implicit)},t.addPunctuation=function(r){return r!==","&&r!==";"||(this.post=this.post.replace(r,"")),this.post=r+this.post,this}}),cp=function(o,t,e=3){if(o===t)return 1;if(o.length<e||t.length<e)return 0;let n=function(a,i){let s=a.length,l=i.length;if(s===0)return l;if(l===0)return s;let u=(l>s?l:s)+1;if(Math.abs(s-l)>(u||100))return u||100;let c,d,p,m,f,h,y=[];for(let b=0;b<u;b++)y[b]=[b],y[b].length=u;for(let b=0;b<u;b++)y[0][b]=b;for(let b=1;b<=s;++b)for(d=a[b-1],c=1;c<=l;++c){if(b===c&&y[b][c]>4)return s;p=i[c-1],m=d===p?0:1,f=y[b-1][c]+1,(h=y[b][c-1]+1)<f&&(f=h),(h=y[b-1][c-1]+m)<f&&(f=h);let g=b>1&&c>1&&d===i[c-2]&&a[b-2]===p&&(h=y[b-2][c-2]+m)<f;y[b][c]=g?h:f}return y[s][l]}(o,t),r=Math.max(o.length,t.length);return 1-(r===0?0:n/r)},Sr=function(){};Sr=function(o,t,e,n){let r=function(a,i,s,l){if(i.id===a.id||i.anything===!0)return!0;if(i.start===!0&&s!==0||i.end===!0&&s!==l-1)return!1;if(i.word!==void 0){if(a.implicit!==null&&a.implicit===i.word||a.alias!==void 0&&a.alias.hasOwnProperty(i.word)||i.soft===!0&&i.word===a.root)return!0;if(i.fuzzy!==void 0){let u=cp(i.word,a.reduced);if(u>i.fuzzy||i.soft===!0&&(u=cp(i.word,a.root),u>i.fuzzy))return!0}return i.word===a.clean||i.word===a.text||i.word===a.reduced}return i.tag!==void 0?a.tags[i.tag]===!0:i.method!==void 0?typeof a[i.method]=="function"&&a[i.method]()===!0:i.regex!==void 0?i.regex.test(a.clean):i.fastOr!==void 0?!(!a.implicit||i.fastOr.hasOwnProperty(a.implicit)!==!0)||i.fastOr.hasOwnProperty(a.reduced)||i.fastOr.hasOwnProperty(a.text):i.choices!==void 0&&(i.operator==="and"?i.choices.every(u=>Sr(a,u,s,l)):i.choices.some(u=>Sr(a,u,s,l)))}(o,t,e,n);return t.negative===!0?!r:r};var ib=Sr,sb={},ob={doesMatch:function(o,t,e){return ib(this,o,t,e)},isAcronym:function(){return op(this.text)},isImplicit:function(){return this.text===""&&Boolean(this.implicit)},isKnown:function(){return Object.keys(this.tags).some(o=>sb[o]!==!0)},setRoot:function(o){let t=o.transforms,e=this.implicit||this.clean;if(this.tags.Plural&&(e=t.toSingular(e,o)),this.tags.Verb&&!this.tags.Negative&&!this.tags.Infinitive){let n=null;this.tags.PastTense?n="PastTense":this.tags.Gerund?n="Gerund":this.tags.PresentTense?n="PresentTense":this.tags.Participle?n="Participle":this.tags.Actor&&(n="Actor"),e=t.toInfinitive(e,o,n)}this.root=e}},lb=/[\s-]/,ub=/^[A-Z-]+$/,cb={textOut:function(o,t,e){o=o||{};let n=this.text,r=this.pre,a=this.post;return o.reduced===!0&&(n=this.reduced||""),o.root===!0&&(n=this.root||""),o.implicit===!0&&this.implicit&&(n=this.implicit||""),o.normal===!0&&(n=this.clean||this.text||""),o.root===!0&&(n=this.root||this.reduced||""),o.unicode===!0&&(n=oo(n)),o.titlecase===!0&&(this.tags.ProperNoun&&!this.titleCase()||(this.tags.Acronym?n=n.toUpperCase():ub.test(n)&&!this.tags.Acronym&&(n=n.toLowerCase()))),o.lowercase===!0&&(n=n.toLowerCase()),o.acronyms===!0&&this.tags.Acronym&&(n=n.replace(/\./g,"")),o.whitespace!==!0&&o.root!==!0||(r="",a=" ",lb.test(this.post)!==!1&&!o.last||this.implicit||(a="")),o.punctuation!==!0||o.root||(this.hasPost(".")===!0?a="."+a:this.hasPost("?")===!0?a="?"+a:this.hasPost("!")===!0?a="!"+a:this.hasPost(",")===!0?a=","+a:this.hasEllipses()===!0&&(a="..."+a)),t!==!0&&(r=""),e!==!0&&(a=""),o.abbreviations===!0&&this.tags.Abbreviation&&(a=a.replace(/^\./,"")),r+n+a}},db={Auxiliary:1,Possessive:1},pb=function(o,t){let e=Object.keys(o.tags),n=t.tags;return e=e.sort((r,a)=>db[a]||!n[a]?-1:n[a]?n[r]?n[r].lineage.length>n[a].lineage.length?1:n[r].isA.length>n[a].isA.length?-1:0:0:1),e},mb={text:!0,tags:!0,implicit:!0,whitespace:!0,clean:!1,id:!1,index:!1,offset:!1,bestTag:!1},fb={json:function(o,t){o=o||{};let e={};return(o=Object.assign({},mb,o)).text&&(e.text=this.text),o.normal&&(e.normal=this.clean),o.tags&&(e.tags=Object.keys(this.tags)),o.clean&&(e.clean=this.clean),(o.id||o.offset)&&(e.id=this.id),o.implicit&&this.implicit!==null&&(e.implicit=this.implicit),o.whitespace&&(e.pre=this.pre,e.post=this.post),o.bestTag&&(e.bestTag=pb(this,t)[0]),e}},hb=Object.assign({},rb,ab,ob,cb,fb);function dp(){return typeof window!="undefined"&&window.document}var cn=function(o,t){for(o=o.toString();o.length<t;)o+=" ";return o},pp=function(o,t,e){if(dp())return void console.log("%c"+cn(o.clean,3)+"  + "+t+" ","color: #6accb2;");let n="[33m"+cn(o.clean,15)+"[0m + [32m"+t+"[0m ";e&&(n=cn(n,35)+" "+e),console.log(n)},mp=function(o,t,e){if(dp())return void console.log("%c"+cn(o.clean,3)+"  - "+t+" ","color: #AB5850;");let n="[33m"+cn(o.clean,3)+" [31m - #"+t+"[0m ";e&&(n=cn(n,35)+" "+e),console.log(n)},bb=o=>o.charAt(0).toUpperCase()+o.substr(1),fp=function(o,t,e,n){let r=n.tags;if(t===""||t==="."||t==="-"||(t[0]==="#"&&(t=t.replace(/^#/,"")),t=bb(t),o.tags[t]===!0))return;let a=n.isVerbose();a===!0&&pp(o,t,e),o.tags[t]=!0,r.hasOwnProperty(t)===!0&&(r[t].isA.forEach(i=>{o.tags[i]=!0,a===!0&&pp(o,"\u2192 "+i)}),o.unTag(r[t].notA,"\u2190",n))},hp=function(o,t,e,n){if(typeof t!="string")for(let r=0;r<t.length;r++)fp(o,t[r],e,n);else fp(o,t,e,n)},yb=/^[a-z]/,bp=function(o,t,e,n){let r=n.isVerbose();if(t==="*")return o.tags={},o;var a;t=t.replace(/^#/,""),yb.test(t)===!0&&(t=(a=t).charAt(0).toUpperCase()+a.substr(1)),o.tags[t]===!0&&(delete o.tags[t],r===!0&&mp(o,t,e));let i=n.tags;if(i[t]){let s=i[t].lineage;for(let l=0;l<s.length;l++)o.tags[s[l]]===!0&&(delete o.tags[s[l]],r===!0&&mp(o," - "+s[l]))}return o},gb=function(o,t,e,n){if(typeof t!="string"&&t)for(let r=0;r<t.length;r++)bp(o,t[r],e,n);else bp(o,t,e,n)},yp=function(o,t,e){let n=e.tags;if(t[0]==="#"&&(t=t.replace(/^#/,"")),n[t]===void 0)return!0;let r=n[t].notA||[];for(let a=0;a<r.length;a++)if(o.tags[r[a]]===!0)return!1;return n[t].isA===void 0||yp(o,n[t].isA,e)},gp=yp,vb={tag:function(o,t,e){return hp(this,o,t,e),this},tagSafe:function(o,t,e){return gp(this,o,e)&&hp(this,o,t,e),this},unTag:function(o,t,e){return gb(this,o,t,e),this},canBe:function(o,t){return gp(this,o,t)}},dn=class{constructor(t=""){t=String(t);let e=up(t);this.text=e.text||"",this.clean=e.clean,this.reduced=e.reduced,this.root=null,this.implicit=null,this.pre=e.pre||"",this.post=e.post||"",this.tags={},this.prev=null,this.next=null,this.id=ip(e.clean),this.isA="Term",e.alias&&(this.alias=e.alias)}set(t){let e=up(t);return this.text=e.text,this.clean=e.clean,this.reduced=e.reduced,this.root=null,this.implicit=null,this}};dn.prototype.clone=function(){let o=new dn(this.text);return o.pre=this.pre,o.post=this.post,o.clean=this.clean,o.reduced=this.reduced,o.root=this.root,o.implicit=this.implicit,o.tags=Object.assign({},this.tags),o},Object.assign(dn.prototype,hb),Object.assign(dn.prototype,vb);var uo=dn,Cb={terms:function(o){if(this.length===0)return[];if(this.cache.terms)return o!==void 0?this.cache.terms[o]:this.cache.terms;let t=[this.pool.get(this.start)];for(let e=0;e<this.length-1;e+=1){let n=t[t.length-1].next;if(n===null){console.error("Compromise error: Linked list broken in phrase '"+this.start+"'");break}let r=this.pool.get(n);if(t.push(r),o!==void 0&&o===e)return t[o]}return o===void 0&&(this.cache.terms=t),o!==void 0?t[o]:t},clone:function(o){if(o){let e=this.buildFrom(this.start,this.length);return e.cache=this.cache,e}let t=this.terms().map(e=>e.clone());return t.forEach((e,n)=>{this.pool.add(e),t[n+1]&&(e.next=t[n+1].id),t[n-1]&&(e.prev=t[n-1].id)}),this.buildFrom(t[0].id,t.length)},lastTerm:function(){let o=this.terms();return o[o.length-1]},hasId:function(o){if(this.length===0||!o)return!1;if(this.start===o)return!0;if(this.cache.terms){let e=this.cache.terms;for(let n=0;n<e.length;n++)if(e[n].id===o)return!0;return!1}let t=this.start;for(let e=0;e<this.length-1;e+=1){let n=this.pool.get(t);if(n===void 0)return console.error(`Compromise error: Linked list broken. Missing term '${t}' in phrase '${this.start}'
`),!1;if(n.next===o)return!0;t=n.next}return!1},wordCount:function(){return this.terms().filter(o=>o.text!=="").length},fullSentence:function(){let o=this.terms(0);for(;o.prev;)o=this.pool.get(o.prev);let t=o.id,e=1;for(;o.next;)o=this.pool.get(o.next),e+=1;return this.buildFrom(t,e)}},Nb={text:function(o={},t,e){typeof o=="string"&&(o=o==="normal"?{whitespace:!0,unicode:!0,lowercase:!0,punctuation:!0,acronyms:!0,abbreviations:!0,implicit:!0,normal:!0}:o==="clean"?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,normal:!0}:o==="reduced"?{punctuation:!1,titlecase:!1,lowercase:!0,whitespace:!0,unicode:!0,implicit:!0,reduced:!0}:o==="implicit"?{punctuation:!0,implicit:!0,whitespace:!0,trim:!0}:o==="root"?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,root:!0}:{});let n=this.terms(),r=!1;n[0]&&n[0].prev===null&&n[n.length-1].next===null&&(r=!0);let a=n.reduce((i,s,l)=>{if(l===0&&s.text===""&&s.implicit!==null&&!o.implicit)return i;o.last=e&&l===n.length-1;let u=!0,c=!0;return r===!1&&(l===0&&t&&(u=!1),l===n.length-1&&e&&(c=!1)),i+s.textOut(o,u,c)},"");return r===!0&&e&&(a=a.replace(/ +$/,"")),o.trim===!0&&(a=a.trim()),a}},Tb={trim:function(){let o=this.terms();if(o.length>0){o[0].pre=o[0].pre.replace(/^\s+/,"");let t=o[o.length-1];t.post=t.post.replace(/\s+$/,"")}return this}},Vb=/[.?!]\s*$/,xb=function(o,t){t[0].pre=o[0].pre;let e=o[o.length-1],n=t[t.length-1];n.post=function(r,a){return Vb.test(a)?a+r.match(/\s*$/):r}(e.post,n.post),e.post="",e.post===""&&(e.post+=" ")},vp=function(o,t,e){let n=o.terms(),r=t.terms();xb(n,r),function(l,u,c){let d=l[l.length-1],p=u[u.length-1],m=d.next;d.next=u[0].id,p.next=m,m&&(c.get(m).prev=p.id);let f=l[0].id;f&&(u[0].prev=f)}(n,r,o.pool);let a=[o],i=o.start,s=[e];return s=s.concat(e.parents()),s.forEach(l=>{let u=l.list.filter(c=>c.hasId(i));a=a.concat(u)}),a=function(l){return l.filter((u,c)=>l.indexOf(u)===c)}(a),a.forEach(l=>{l.length+=t.length}),o.cache={},o},wb=/ /,Db=function(o,t,e){let n=o.start,r=t.terms();(function(s){let l=s[s.length-1];wb.test(l.post)===!1&&(l.post+=" ")})(r),function(s,l,u){let c=u[u.length-1];c.next=s.start;let d=s.pool,p=d.get(s.start);p.prev&&(d.get(p.prev).next=l.start),u[0].prev=s.terms(0).prev,s.terms(0).prev=c.id}(o,t,r);let a=[o],i=[e];return i=i.concat(e.parents()),i.forEach(s=>{let l=s.list.filter(u=>u.hasId(n)||u.hasId(t.start));a=a.concat(l)}),a=function(s){return s.filter((l,u)=>s.indexOf(l)===u)}(a),a.forEach(s=>{s.length+=t.length,s.start===n&&(s.start=t.start),s.cache={}}),o},Cp=function(o,t){let e=t.pool(),n=o.terms(),r=e.get(n[0].prev)||{},a=e.get(n[n.length-1].next)||{};n[0].implicit&&r.implicit&&(r.set(r.implicit),r.post+=" "),function(i,s,l,u){let c=i.parents();c.push(i),c.forEach(d=>{let p=d.list.find(m=>m.hasId(s));p&&(p.length-=l,p.start===s&&(p.start=u.id),p.cache={})}),i.list=i.list.filter(d=>!(!d.start||!d.length))}(t,o.start,o.length,a),r&&(r.next=a.id),a&&(a.prev=r.id)},Ab={append:function(o,t){return vp(this,o,t),this},prepend:function(o,t){return Db(this,o,t),this},delete:function(o){return Cp(this,o),this},replace:function(o,t){let e=this.length;vp(this,o,t);let n=this.buildFrom(this.start,this.length);n.length=e,Cp(n,t)},splitOn:function(o){let t=this.terms(),e={before:null,match:null,after:null},n=t.findIndex(s=>s.id===o.start);if(n===-1)return e;let r=t.slice(0,n);r.length>0&&(e.before=this.buildFrom(r[0].id,r.length));let a=t.slice(n,n+o.length);a.length>0&&(e.match=this.buildFrom(a[0].id,a.length));let i=t.slice(n+o.length,t.length);return i.length>0&&(e.after=this.buildFrom(i[0].id,i.length,this.pool)),e}},Sb={json:function(o={},t){let e={};return o.text&&(e.text=this.text()),o.normal&&(e.normal=this.text("normal")),o.clean&&(e.clean=this.text("clean")),o.reduced&&(e.reduced=this.text("reduced")),o.implicit&&(e.implicit=this.text("implicit")),o.root&&(e.root=this.text("root")),o.trim&&(e.text&&(e.text=e.text.trim()),e.normal&&(e.normal=e.normal.trim()),e.reduced&&(e.reduced=e.reduced.trim())),o.terms&&(o.terms===!0&&(o.terms={}),e.terms=this.terms().map(n=>n.json(o.terms,t))),e}},Ib={lookAhead:function(o){o||(o=".*");let t=this.pool,e=[],n=function(i){let s=t.get(i);s&&(e.push(s),s.prev&&n(s.next))},r=this.terms(),a=r[r.length-1];return n(a.next),e.length===0?[]:this.buildFrom(e[0].id,e.length).match(o)},lookBehind:function(o){o||(o=".*");let t=this.pool,e=[],n=function(a){let i=t.get(a);i&&(e.push(i),i.prev&&n(i.prev))},r=t.get(this.start);return n(r.prev),e.length===0?[]:this.buildFrom(e[e.length-1].id,e.length).match(o)}},Ob=Object.assign({},Cb,Nb,Tb,Ab,Sb,Ib),kb=function(o,t){if(t.length===0)return!0;for(let e=0;e<t.length;e+=1){let n=t[e];if(n.optional!==!0&&n.negative!==!0&&n.start===!0&&e>0||n.anything===!0&&n.negative===!0)return!0}return!1},it=Ee(function(o,t){t.getGreedy=function(e,n){let r=Object.assign({},e.regs[e.r],{start:!1,end:!1}),a=e.t;for(;e.t<e.terms.length;e.t+=1){if(n&&e.terms[e.t].doesMatch(n,e.start_i+e.t,e.phrase_length))return e.t;let i=e.t-a+1;if(r.max!==void 0&&i===r.max)return e.t;if(e.terms[e.t].doesMatch(r,e.start_i+e.t,e.phrase_length)===!1)return r.min!==void 0&&i<r.min?null:e.t}return e.t},t.greedyTo=function(e,n){let r=e.t;if(!n)return e.terms.length;for(;r<e.terms.length;r+=1)if(e.terms[r].doesMatch(n,e.start_i+r,e.phrase_length)===!0)return r;return null},t.isEndGreedy=function(e,n){if(e.end===!0&&e.greedy===!0&&n.start_i+n.t<n.phrase_length-1){let r=Object.assign({},e,{end:!1});if(n.terms[n.t].doesMatch(r,n.start_i+n.t,n.phrase_length)===!0)return!0}return!1},t.doOrBlock=function(e,n=0){let r=e.regs[e.r],a=!1;for(let i=0;i<r.choices.length;i+=1){let s=r.choices[i];if(a=s.every((l,u)=>{let c=0,d=e.t+u+n+c;if(e.terms[d]===void 0)return!1;let p=e.terms[d].doesMatch(l,d+e.start_i,e.phrase_length);if(p===!0&&l.greedy===!0)for(let m=1;m<e.terms.length;m+=1){let f=e.terms[d+m];if(f){if(f.doesMatch(l,e.start_i+m,e.phrase_length)!==!0)break;c+=1}}return n+=c,p}),a){n+=s.length;break}}return a&&r.greedy===!0?t.doOrBlock(e,n):n},t.doAndBlock=function(e){let n=0;return e.regs[e.r].choices.every(r=>{let a=r.every((i,s)=>{let l=e.t+s;return e.terms[l]!==void 0&&e.terms[l].doesMatch(i,l,e.phrase_length)});return a===!0&&r.length>n&&(n=r.length),a})===!0&&n},t.getGroup=function(e,n,r){if(e.groups[e.groupId])return e.groups[e.groupId];let a=e.terms[n].id;return e.groups[e.groupId]={group:String(r),start:a,length:0},e.groups[e.groupId]}}),Np=function(o,t,e,n){let r={t:0,terms:o,r:0,regs:t,groups:{},start_i:e,phrase_length:n,hasGroup:!1,groupId:null,previousGroup:null};for(;r.r<t.length;r.r+=1){let a=t[r.r];if(r.hasGroup=typeof a.named=="string"||typeof a.named=="number",r.hasGroup===!0){let l=t[r.r-1];l&&l.named===a.named&&r.previousGroup?r.groupId=r.previousGroup:(r.groupId=ip(a.named),r.previousGroup=r.groupId)}if(!r.terms[r.t]){if(t.slice(r.r).some(l=>!l.optional)===!1)break;return null}if(a.anything===!0&&a.greedy===!0){let l=it.greedyTo(r,t[r.r+1]);if(l===null||l===0||a.min!==void 0&&l-r.t<a.min)return null;if(a.max!==void 0&&l-r.t>a.max){r.t=r.t+a.max;continue}r.hasGroup===!0&&(it.getGroup(r,r.t,a.named).length=l-r.t),r.t=l;continue}if(a.choices!==void 0&&a.operator==="or"){let l=it.doOrBlock(r);if(l){if(a.negative===!0)return null;r.hasGroup===!0&&(it.getGroup(r,r.t,a.named).length+=l),r.t+=l;continue}if(!a.optional)return null}if(a.choices!==void 0&&a.operator==="and"){let l=it.doAndBlock(r);if(l){if(a.negative===!0)return null;r.hasGroup===!0&&(it.getGroup(r,r.t,a.named).length+=l),r.t+=l;continue}if(!a.optional)return null}let i=r.terms[r.t],s=i.doesMatch(a,r.start_i+r.t,r.phrase_length);if(a.anything===!0||s===!0||it.isEndGreedy(a,r)){let l=r.t;if(a.optional&&t[r.r+1]&&a.negative)continue;if(a.optional&&t[r.r+1]){let u=i.doesMatch(t[r.r+1],r.start_i+r.t,r.phrase_length);if(a.negative||u){let c=r.terms[r.t+1];c&&c.doesMatch(t[r.r+1],r.start_i+r.t,r.phrase_length)||(r.r+=1)}}if(r.t+=1,a.end===!0&&r.t!==r.terms.length&&a.greedy!==!0||a.greedy===!0&&(r.t=it.getGreedy(r,t[r.r+1]),r.t===null||a.min&&a.min>r.t||a.end===!0&&r.start_i+r.t!==n))return null;if(r.hasGroup===!0){let u=it.getGroup(r,l,a.named);r.t>1&&a.greedy?u.length+=r.t-l:u.length++}}else{if(a.negative){let l=Object.assign({},a);if(l.negative=!1,r.terms[r.t].doesMatch(l,r.start_i+r.t,r.phrase_length)===!0)return null}if(a.optional!==!0){if(r.terms[r.t].isImplicit()&&t[r.r-1]&&r.terms[r.t+1]){if(r.terms[r.t-1]&&r.terms[r.t-1].implicit===t[r.r-1].word)return null;if(r.terms[r.t+1].doesMatch(a,r.start_i+r.t,r.phrase_length)){r.t+=2;continue}}return null}}}return{match:r.terms.slice(0,r.t),groups:r.groups}},Ir=function(o,t,e){if(!e||e.length===0)return e;if(t.some(n=>n.end)){let n=o[o.length-1];e=e.filter(({match:r})=>r.indexOf(n)!==-1)}return e},Pb=/(?:^|\s)([\!\[\^]*(?:<[^<]*>)?\/.*?[^\\\/]\/[\?\]\+\*\$~]*)(?:\s|$)/,Rb=/([\!\[\^]*(?:<[^<]*>)?\([^\)]+[^\\\)]\)[\?\]\+\*\$~]*)(?:\s|$)/,Bb=/ /g,Tp=o=>/^[\!\[\^]*(<[^<]*>)?\//.test(o)&&/\/[\?\]\+\*\$~]*$/.test(o),Vp=function(o){return o=(o=o.map(t=>t.trim())).filter(t=>t)},Fb=function(o){let t=o.split(Pb),e=[];t.forEach(r=>{Tp(r)?e.push(r):e=e.concat(r.split(Rb))}),e=Vp(e);let n=[];return e.forEach(r=>{(a=>/^[\!\[\^]*(<[^<]*>)?\(/.test(a)&&/\)[\?\]\+\*\$~]*$/.test(a))(r)||Tp(r)?n.push(r):n=n.concat(r.split(Bb))}),n=Vp(n),n},xp=/\{([0-9]+,?[0-9]*)\}/,wp=/&&/,Lb=new RegExp(/^<\s*?(\S+)\s*?>/),st=function(o){return o[o.length-1]},Qe=function(o){return o[0]},pn=function(o){return o.substr(1)},mn=function(o){return o.substr(0,o.length-1)},Dp=function(o){return o=pn(o),o=mn(o)},Ap=function(o){let t={};for(let n=0;n<2;n+=1){if(st(o)==="$"&&(t.end=!0,o=mn(o)),Qe(o)==="^"&&(t.start=!0,o=pn(o)),(Qe(o)==="["||st(o)==="]")&&(t.named=!0,Qe(o)==="["?t.groupType=st(o)==="]"?"single":"start":t.groupType="end",o=(o=o.replace(/^\[/,"")).replace(/\]$/,""),Qe(o)==="<")){let r=Lb.exec(o);r.length>=2&&(t.named=r[1],o=o.replace(r[0],""))}if(st(o)==="+"&&(t.greedy=!0,o=mn(o)),o!=="*"&&st(o)==="*"&&o!=="\\*"&&(t.greedy=!0,o=mn(o)),st(o)==="?"&&(t.optional=!0,o=mn(o)),Qe(o)==="!"&&(t.negative=!0,o=pn(o)),Qe(o)==="("&&st(o)===")"){wp.test(o)?(t.choices=o.split(wp),t.operator="and"):(t.choices=o.split("|"),t.operator="or"),t.choices[0]=pn(t.choices[0]);let r=t.choices.length-1;t.choices[r]=mn(t.choices[r]),t.choices=t.choices.map(a=>a.trim()),t.choices=t.choices.filter(a=>a),t.choices=t.choices.map(a=>a.split(/ /g).map(Ap)),o=""}if(Qe(o)==="/"&&st(o)==="/")return o=Dp(o),t.regex=new RegExp(o),t;if(Qe(o)==="~"&&st(o)==="~")return o=Dp(o),t.soft=!0,t.word=o,t}return xp.test(o)===!0&&(o=o.replace(xp,(n,r)=>{let a=r.split(/,/g);return a.length===1?(t.min=Number(a[0]),t.max=Number(a[0])):(t.min=Number(a[0]),t.max=Number(a[1]||999)),t.greedy=!0,t.optional=!0,""})),Qe(o)==="#"?(t.tag=pn(o),t.tag=(e=t.tag).charAt(0).toUpperCase()+e.substr(1),t):Qe(o)==="@"?(t.method=pn(o),t):o==="."?(t.anything=!0,t):o==="*"?(t.anything=!0,t.greedy=!0,t.optional=!0,t):(o&&(o=(o=o.replace("\\*","*")).replace("\\.","."),t.word=o.toLowerCase()),t);var e},Eb=Ap,Mb=function(o,t={}){return o.filter(e=>e.groupType).length>0&&(o=function(e){let n,r=!1,a=-1;for(let i=0;i<e.length;i++){let s=e[i];s.groupType!=="single"||s.named!==!0?(s.groupType==="start"&&(r=!0,typeof s.named=="string"||typeof s.named=="number"?n=s.named:(a+=1,n=a)),r&&(s.named=n),s.groupType==="end"&&(r=!1)):(a+=1,s.named=a)}return e}(o)),t.fuzzy||(o=function(e){return e.map(n=>{if(n.choices!==void 0&&n.choices.every(r=>{if(r.length!==1)return!1;let a=r[0];return a.word!==void 0&&a.negative!==!0&&a.optional!==!0&&a.method!==!0})===!0){let r={};n.choices.forEach(a=>{r[a[0].word]=!0}),n.fastOr=r,delete n.choices}return n})}(o)),o},Ve=function(o,t={}){if(o==null||o==="")return[];if(typeof o=="object"){if(function(n){return Object.prototype.toString.call(n)==="[object Array]"}(o)){if(o.length===0||!o[0])return[];if(typeof o[0]=="object")return o;if(typeof o[0]=="string")return function(n){return[{choices:n.map(r=>[{word:r}]),operator:"or"}]}(o)}return o&&o.isA==="Doc"?function(n){if(!n||!n.list||!n.list[0])return[];let r=[];return n.list.forEach(a=>{let i=[];a.terms().forEach(s=>{i.push(s.id)}),r.push(i)}),[{idBlocks:r}]}(o):[]}typeof o=="number"&&(o=String(o));let e=Fb(o);return e=e.map(n=>Eb(n)),e=Mb(e,t),e=function(n,r){return r.fuzzy===!0&&(r.fuzzy=.85),typeof r.fuzzy=="number"&&(n=n.map(a=>(r.fuzzy>0&&a.word&&(a.fuzzy=r.fuzzy),a.choices&&a.choices.forEach(i=>{i.forEach(s=>{s.fuzzy=r.fuzzy})}),a))),n}(e,t),e},_b=function(o,t){let e=[],n=t[0].idBlocks;for(let r=0;r<o.length;r+=1)n.forEach(a=>{a.length!==0&&a.every((i,s)=>o[r+s].id===i)&&(e.push({match:o.slice(r,r+a.length)}),r+=a.length-1)});return e},co=function(o,t,e=!1){if(typeof t=="string"&&(t=Ve(t)),kb(o,t)===!0)return[];let n=t.filter(i=>i.optional!==!0&&i.negative!==!0).length,r=o.terms(),a=[];if(t[0].idBlocks){let i=_b(r,t);if(i&&i.length>0)return Ir(r,t,i)}if(t[0].start===!0){let i=Np(r,t,0,r.length);return i&&i.match&&i.match.length>0&&(i.match=i.match.filter(s=>s),a.push(i)),Ir(r,t,a)}for(let i=0;i<r.length&&!(i+n>r.length);i+=1){let s=Np(r.slice(i),t,i,r.length);if(s&&s.match&&s.match.length>0&&(i+=s.match.length-1,s.match=s.match.filter(l=>l),a.push(s),e===!0))return Ir(r,t,a)}return Ir(r,t,a)},$b=function(o,t){let e={};co(o,t).forEach(({match:i})=>{i.forEach(s=>{e[s.id]=!0})});let n=o.terms(),r=[],a=[];return n.forEach(i=>{e[i.id]!==!0?a.push(i):a.length>0&&(r.push(a),a=[])}),a.length>0&&r.push(a),r},zb={match:function(o,t=!1){let e=co(this,o,t);return e=e.map(({match:n,groups:r})=>{let a=this.buildFrom(n[0].id,n.length,r);return a.cache.terms=n,a}),e},has:function(o){return co(this,o,!0).length>0},not:function(o){let t=$b(this,o);return t=t.map(e=>this.buildFrom(e[0].id,e.length)),t},canBe:function(o,t){let e=[],n=this.terms(),r=!1;for(let a=0;a<n.length;a+=1){let i=n[a].canBe(o,t);i===!0&&(r===!0?e[e.length-1].push(n[a]):e.push([n[a]]),r=i)}return e=e.filter(a=>a.length>0).map(a=>this.buildFrom(a[0].id,a.length)),e}},Vt=class{constructor(t,e,n){this.start=t,this.length=e,this.isA="Phrase",Object.defineProperty(this,"pool",{enumerable:!1,writable:!0,value:n}),Object.defineProperty(this,"cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"groups",{enumerable:!1,writable:!0,value:{}})}};Vt.prototype.buildFrom=function(o,t,e){let n=new Vt(o,t,this.pool);return e&&Object.keys(e).length>0?n.groups=e:n.groups=this.groups,n},Object.assign(Vt.prototype,zb),Object.assign(Vt.prototype,Ob);var Sp={term:"terms"};Object.keys(Sp).forEach(o=>Vt.prototype[o]=Vt.prototype[Sp[o]]);var po=Vt,Or=class{constructor(t={}){Object.defineProperty(this,"words",{enumerable:!1,value:t})}add(t){return this.words[t.id]=t,this}get(t){return this.words[t]}remove(t){delete this.words[t]}merge(t){return Object.assign(this.words,t.words),this}stats(){return{words:Object.keys(this.words).length}}};Or.prototype.clone=function(){let o=Object.keys(this.words).reduce((t,e)=>{let n=this.words[e].clone();return t[n.id]=n,t},{});return new Or(o)};var mo=Or,Ip=o=>{o.forEach((t,e)=>{e>0&&(t.prev=o[e-1].id),o[e+1]&&(t.next=o[e+1].id)})},Hb=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,Op=/\S/,jb=/[ .][A-Z]\.? *$/i,qb=/(?:\u2026|\.{2,}) *$/,Kb=/((?:\r?\n|\r)+)/,Wb=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,kp=/^\s+/,Ub=function(o,t){if(jb.test(o)===!0||qb.test(o)===!0||Wb.test(o)===!1)return!1;let e=o.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),n=e[e.length-1].toLowerCase();return!t.hasOwnProperty(n)},Gb=function(o,t){let e=t.cache.abbreviations;o=o||"";let n=[],r=[];if(!(o=String(o))||typeof o!="string"||Op.test(o)===!1)return n;let a=function(i){let s=[],l=i.split(Kb);for(let u=0;u<l.length;u++){let c=l[u].split(Hb);for(let d=0;d<c.length;d++)s.push(c[d])}return s}(o=o.replace("\xA0"," "));for(let i=0;i<a.length;i++){let s=a[i];if(s!==void 0&&s!==""){if(Op.test(s)===!1){if(r[r.length-1]){r[r.length-1]+=s;continue}if(a[i+1]){a[i+1]=s+a[i+1];continue}}r.push(s)}}for(let i=0;i<r.length;i++){let s=r[i];r[i+1]&&Ub(s,e)===!1?r[i+1]=s+(r[i+1]||""):s&&s.length>0&&(n.push(s),r[i]="")}if(n.length===0)return[o];for(let i=1;i<n.length;i+=1){let s=n[i].match(kp);s!==null&&(n[i-1]+=s[0],n[i]=n[i].replace(kp,""))}return n},Xb=/\S/,Zb=/^[!?.]+$/,Jb=/(\S+)/,Yb=/[a-z] ?\/ ?[a-z]*$/,fo=[".","?","!",":",";","-","\u2013","\u2014","--","...","(",")","[","]",'"',"'","`"];fo=fo.reduce((o,t)=>(o[t]=!0,o),{});var Qb=function(o){return/^(re|un|micro|macro|trans|bi|mono|over)-?[^aeiou]./.test(o)===!0||/^([a-z\u00C0-\u00FF/]+)(-||)(like|ish|less|able)/i.test(o)===!0?!1:/^([a-z\u00C0-\u00FF`"'/]+)(-||)([a-z0-9\u00C0-\u00FF].*)/i.test(o)===!0?!0:/^([0-9]{1,4})(-||)([a-z\u00C0-\u00FF`"'/-]+$)/i.test(o)===!0},ey=function(o){let t=[],e=o.split(/[-]/),n="-",r=o.match(/[-]/);r&&r[0]&&(n=r);for(let a=0;a<e.length;a++)a===e.length-1?t.push(e[a]):t.push(e[a]+n);return t},ty=function(o){let t=[],e=[];if(typeof(o=o||"")=="number"&&(o=String(o)),function(a){return Object.prototype.toString.call(a)==="[object Array]"}(o))return o;let n=o.split(Jb);for(let a=0;a<n.length;a++)Qb(n[a])!==!0?e.push(n[a]):e=e.concat(ey(n[a]));let r="";for(let a=0;a<e.length;a++){let i=e[a];Xb.test(i)===!0&&fo.hasOwnProperty(i)===!1&&Zb.test(i)===!1?(t.length>0?(t[t.length-1]+=r,t.push(i)):t.push(r+i),r=""):r+=i}return r&&(t.length===0&&(t[0]=""),t[t.length-1]+=r),t=function(a){for(let i=1;i<a.length-1;i++)Yb.test(a[i])&&(a[i-1]+=a[i]+a[i+1],a[i]=null,a[i+1]=null);return a}(t),t=function(a){let i=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?(-||) ?$/,s=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let l=0;l<a.length-1;l+=1)a[l+1]&&i.test(a[l])&&s.test(a[l+1])&&(a[l]=a[l]+a[l+1],a[l+1]=null);return a}(t),t=t.filter(a=>a),t},ot=function(o="",t,e){let n=null;return typeof o!="string"&&(typeof o=="number"?o=String(o):function(r){return Object.prototype.toString.call(r)==="[object Array]"}(o)&&(n=o)),n=n||Gb(o,t),n=n.map(r=>ty(r)),e=e||new mo,n.map(r=>{r=r.map(i=>{let s=new uo(i);return e.add(s),s}),Ip(r);let a=new po(r[0].id,r.length,e);return a.cache.terms=r,a})},ny=function(o,t){let e=new mo;return o.map((n,r)=>{let a=n.terms.map((i,s)=>{let l=new uo(i.text);return l.pre=i.pre!==void 0?i.pre:"",i.post===void 0&&(i.post=" ",s>=n.terms.length-1&&(i.post=". ",r>=n.terms.length-1&&(i.post="."))),l.post=i.post!==void 0?i.post:" ",i.tags&&i.tags.forEach(u=>l.tag(u,"",t)),e.add(l),l});return Ip(a),new po(a[0].id,a.length,e)})},kr=["Person","Place","Organization"],ry={Noun:{notA:["Verb","Adjective","Adverb"]},Singular:{isA:"Noun",notA:"Plural"},ProperNoun:{isA:"Noun"},Person:{isA:["ProperNoun","Singular"],notA:["Place","Organization","Date"]},FirstName:{isA:"Person"},MaleName:{isA:"FirstName",notA:["FemaleName","LastName"]},FemaleName:{isA:"FirstName",notA:["MaleName","LastName"]},LastName:{isA:"Person",notA:["FirstName"]},NickName:{isA:"Person",notA:["FirstName","LastName"]},Honorific:{isA:"Noun",notA:["FirstName","LastName","Value"]},Place:{isA:"Singular",notA:["Person","Organization"]},Country:{isA:["Place","ProperNoun"],notA:["City"]},City:{isA:["Place","ProperNoun"],notA:["Country"]},Region:{isA:["Place","ProperNoun"]},Address:{isA:"Place"},Organization:{isA:["Singular","ProperNoun"],notA:["Person","Place"]},SportsTeam:{isA:"Organization"},School:{isA:"Organization"},Company:{isA:"Organization"},Plural:{isA:"Noun",notA:["Singular"]},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun",notA:kr},Actor:{isA:"Noun",notA:kr},Activity:{isA:"Noun",notA:["Person","Place"]},Unit:{isA:"Noun",notA:kr},Demonym:{isA:["Noun","ProperNoun"],notA:kr},Possessive:{isA:"Noun"}},ay={Verb:{notA:["Noun","Adjective","Adverb","Value"]},PresentTense:{isA:"Verb",notA:["PastTense","FutureTense"]},Infinitive:{isA:"PresentTense",notA:["PastTense","Gerund"]},Imperative:{isA:"Infinitive"},Gerund:{isA:"PresentTense",notA:["PastTense","Copula","FutureTense"]},PastTense:{isA:"Verb",notA:["FutureTense"]},FutureTense:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb",notA:["Infinitive"]},PerfectTense:{isA:"Verb",notA:"Gerund"},Pluperfect:{isA:"Verb"},Participle:{isA:"PastTense"},PhrasalVerb:{isA:"Verb"},Particle:{isA:"PhrasalVerb"},Auxiliary:{notA:["Noun","Adjective","Value"]}},iy={Value:{notA:["Verb","Adjective","Adverb"]},Ordinal:{isA:"Value",notA:["Cardinal"]},Cardinal:{isA:"Value",notA:["Ordinal"]},Fraction:{isA:"Value",notA:["Noun"]},RomanNumeral:{isA:"Cardinal",notA:["Ordinal","TextValue"]},TextValue:{isA:"Value",notA:["NumericValue"]},NumericValue:{isA:"Value",notA:["TextValue"]},Money:{isA:"Cardinal"},Percent:{isA:"Value"}},ho=["Noun","Verb","Adjective","Adverb","Value","QuestionWord"],sy={Adjective:{notA:["Noun","Verb","Adverb","Value"]},Comparable:{isA:["Adjective"]},Comparative:{isA:["Adjective"]},Superlative:{isA:["Adjective"],notA:["Comparative"]},NumberRange:{},Adverb:{notA:["Noun","Verb","Adjective","Value"]},Date:{notA:["Verb","Adverb","Preposition","Adjective"]},Month:{isA:["Date","Singular"],notA:["Year","WeekDay","Time"]},WeekDay:{isA:["Date","Noun"]},Timezone:{isA:["Date","Noun"],notA:["Adjective","ProperNoun"]},Time:{isA:["Date"],notA:["AtMention"]},Determiner:{notA:ho},Conjunction:{notA:ho},Preposition:{notA:ho},QuestionWord:{notA:["Determiner"]},Currency:{isA:["Noun"]},Expression:{notA:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{notA:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email"]},PhoneNumber:{notA:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{isA:["Noun"],notA:["HashTag","Verb","Adjective","Value","Email"]},Emoji:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Email:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{notA:["Plural","RomanNumeral"]},Negative:{notA:["Noun","Adjective","Value"]},Condition:{notA:["Verb","Adjective","Noun","Value"]}},Pr={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adverb:"cyan"},oy=function(o){return Object.keys(o).forEach(t=>{o[t].color?o[t].color=o[t].color:Pr[t]?o[t].color=Pr[t]:o[t].isA.some(e=>!!Pr[e]&&(o[t].color=Pr[e],!0))}),o},ly=function(o){return Object.keys(o).forEach(t=>{let e=o[t],n=e.isA.length;for(let r=0;r<n;r++){let a=e.isA[r];o[a]&&(e.isA=e.isA.concat(o[a].isA))}e.isA=function(r){return r.filter((a,i,s)=>s.indexOf(a)===i)}(e.isA)}),o},uy=function(o){let t=Object.keys(o);return t.forEach(e=>{let n=o[e];n.notA=n.notA||[],n.isA.forEach(r=>{if(o[r]&&o[r].notA){let a=typeof o[r].notA=="string"?[o[r].isA]:o[r].notA||[];n.notA=n.notA.concat(a)}});for(let r=0;r<t.length;r++){let a=t[r];o[a].notA.indexOf(e)!==-1&&n.notA.push(a)}n.notA=function(r){return r.filter((a,i,s)=>s.indexOf(a)===i)}(n.notA)}),o},cy=function(o){let t=Object.keys(o);return t.forEach(e=>{let n=o[e];n.lineage=[];for(let r=0;r<t.length;r++)o[t[r]].isA.indexOf(e)!==-1&&n.lineage.push(t[r])}),o},Pp=function(o){return o=function(t){return Object.keys(t).forEach(e=>{let n=t[e];n.isA=n.isA||[],typeof n.isA=="string"&&(n.isA=[n.isA]),n.notA=n.notA||[],typeof n.notA=="string"&&(n.notA=[n.notA])}),t}(o),o=ly(o),o=uy(o),o=oy(o),o=cy(o)},Rr=function(o,t){Object.keys(o).forEach(e=>{t[e]=o[e]})},dy=(()=>{let o={};return Rr(ry,o),Rr(ay,o),Rr(iy,o),Rr(sy,o),o=Pp(o),o})(),Rp={Comparative:"true\xA6better",Superlative:"true\xA6earlier",PresentTense:"true\xA6is,sounds",Value:"true\xA6a few",Noun:"true\xA6a5b4c2f1here,ie,lit,m0no doubt,pd,tce;a,d;t,y;a,ca,o0;l,rp;a,l;d,l,rc",Copula:"true\xA6a1is,w0;as,ere;m,re",PastTense:"true\xA6be3came,d2had,lied,meant,sa2taken,w0;as,e0;nt,re;id;en,gan",Condition:"true\xA6if,lest,unless",Preposition:"true\xA6'o,-,aLbIcHdGexcept,fFiDmidQnotwithstandiRoBpSqua,sAt6u3vi2w0;/o,hereNith0;!in,oR;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oJ;ans,ince,o that;',f0n2ut;!f;f,n0;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;sides,tween;ri6;',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut",Gerund:"true\xA6accord0be0develop0go0result0stain0;ing",Negative:"true\xA6n0;ever,o0;!n,t",QuestionWord:"true\xA6how3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Plural:"true\xA6records",Conjunction:"true\xA6&,aFbBcuz,how9in caEno8o7p5supposing,t2v1wh0yet;eth9ile;ers4s;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh",Abbreviation:"true\xA6a0Jb0Gc0Ad08e05f02g01h00iYjWkanVlTmNnKoJpFque,rDs8t6u5v2w0;is0r,y0B;!c;a,b,e1i0ol,s,t;tro,vo;r,t;niv,safa,t;ce,e0;l,mp,nn,x;ask,e2fc,gt,i1q,r,s,t,u0;pt,rg;r,tu;c,nJp0;!t;b,d,e0;pGs,v;a,d,ennNhd,l,p,r1s0vt;!eud;ef,o0;b,f,n;ct,kla,nt;e0ov;b0e;!r;a4d,essrs,i1lle,me,r7s0t;!tr;n1s0;c,ter;!n;!j,r,sc;at,it,lb,ng,t0;!d;!s;an,d,r,u0;l,n;a,da,e,n0;c,f;on,wy;a,en,ov;e1ig,l0m,r,t,y;!a;b,m;a,g,ng,s1tc,x0;!p;p,q,t;ak,e0ist,r;c,f,pt,t;a3ca,l,m2o0pl,res,yn;!l0m1nn,rp;!o;dr;!l0pt;!if;a,c,l1r0;ig,os;!dg,vd;d4l3p2r1ss0tty,ug,ve;n,t;c,iz;prox,r,t;!ta;!j,m,v",Pronoun:"true\xA6'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!'s",Singular:"true\xA60:15;1:12;2:18;a15b0Sc0Jd0Ce09f04gZhViUjel0kitty,lSmOnNoMpHquestionGrEs9t6u4w3;ay,om02;nc0Zs 3;doll0Kst0M; rex,a4h3ic,ragedy,v show;ere,i2;l0x return;i6ky,omeoMt3uper bowl,yst14;ep4ri2u3;de0Xff;faSmoS;st1ze;al0i2o3;om,se;! mark;a6i1la5r4u3;dPrpoH;eroga00ie0Gobl0U;te,y1;rt,te0N;bjWceJthers,verview;othi2umb1;a5ee08o3;del,m3nopo0rni2th1;!my;n,yf0;i3unch;ne;ci2nsect;ead start,o3uman right;l0me4u3;se;! run;adf0entlem6irl02laci1od,rand4u3;l0y; slam,fa3mo3;th1;an;a6ella,ly,ol0r4un3;di2;ee market,iWo3;nti1sP;mi0th1;conomy,gg,ner7ven4x3;ampTecu9;i2t;ad8e5inn1o3ragonf0ude;cumentGg3i0l0or;gy;ath,t3;ec3;tive;!dy;a9eili2h7i5o3redit card;ttage,u3;ri1sin;ty,vil w3;ar;andeli1ocol3;ate;n3rF;ary;aCel0lesJo8r5u3;n3tterf0;ti2;eakfa4o3;!th1;st;dy,tt5y3;!fri3;end;le;nki2r3;ri1;er;d5l0noma0u3;nt;ly; homin5verti3;si2;ng;em",FemaleName:"true\xA60:J3;1:J7;2:IG;3:IF;4:IX;5:IK;6:JO;7:H0;8:JG;9:JK;A:HN;B:HY;C:IT;D:IP;E:JD;F:HC;G:I0;aGRbFLcDPdCYeBOfB4gADh9Ti9Gj8Gk7Gl60m49n3No3Jp37qu36r2Ds16t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof2;e3Uf2la,ra;h3iKlIna,ynH;ab,ep;da,ma;da,h3iHra;nab;aKeJi0Fol5BuIvH;etAonDO;i0na;le0sen2;el,gm3Jn,rGJs8W;aoHme0nyi;m62yAE;aMendDYhiDFiH;dele8lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;cIktoriBMlAole7viH;anC3enJ0;kF9tor2;da,lA9nus,rHs0;a,nHoniH4;a,iFQ;leHnesH4;nIHrH;i1y;g8rHxH5;su5te;aYeUhRiNoLrIuHy3;i,la;acIZiHu0L;c2na,sH;hBPta;nHr0H;iBNya;aJffaEOnHs6;a,gtiH;ng;!nFQra;aIeHomasi0;a,l9Po8Ares1;l2ndolwethu;g9Go88rIssH;!a,ie;eHi,ri9;sa,za;bPlNmLnJrIs6tHwa0;ia0um;a63yn;iHya;a,ka,s6;arB6e3iHmEDra;!ka;a,iH;a,t6;at6it6;a0Fcarlet3We0BhXiTkye,neza0oRtNuIyH;bIBlvi1;e,ha,mayIEni7sIzH;an3MetAie,y;anHi9;!a,e,nH;aDe;aJeH;fHl5GphH;an4;cHZr5;b2fiA8m0OnHphi1;d3ia,ja,ya;er3lJmon1nIobh8PtH;a,i;dy;lEPv2;aMeIirHo0risF7y5;a,lDK;ba,e0i5lJrH;iHrDOyl;!d8Hfa;ia,lDX;hd,iMki3nJrIu0w0yH;la,ma,na;i,le8on,ron;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye81vH;da,inj;e0ife;en1i0ma;anA5bNd3Nh1RiBkMlLmJndIrHs6vannaD;aDi0;ra,y;aHi3;nt6ra;lDKma,ome;ee0in8Ru3;in1ri0;a05e00hYiVoIuH;by,thDH;bScRghQl2KnPsJwIxH;anAXie,y;an,e0;aIeHie,lE; merBLann9ll1marDBt7;!lHnn1;iHyn;e,nH;a,d9K;da,i,na;ayy8D;hel62io;bDKer7yn;a,cIkHmas,n9Fta,ya;ki,o;helGki;ea,iannGDoH;da,n1K;an0bJem9Agi0iInHta,y0;a88ee;han83na;a,eH;cEAkaD;bi0chIe,i0mo0nHquEKvCy0;di,ia;aEIelHiB;!e,le;een4ia0;aNeMhKipaluk,oJrHute66;iHudenCQ;scil3LyamvaB;lly,rt2;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r5t3;ige,m0TnKo5rvaDGtIulH;a,etAin1;ricHsy,tBY;a,e,ia;do3i06;ctav2dIfCZis6lHphCZumC3yunbileg;a,ga,iv2;eHvAC;l2tA;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aDeCma;ll1mi;aNcLhariBOkKlaJna,sHta,vi;anHha;ur;!y;a,iDTki;hoGk9VolH;a,eDJ;!mh;hir,lHna,risFsreC;!a,lBT;asuLdKh2i6CnJomi9rgEPtHzanin zah3;aHhal4;li1s6;cy,etA;a,e8iEV;nngu30;a09ckenz4e01iMoJrignayani,uriDDyH;a,rH;a,lNna,tG;bi0i3llBInH;a,iH;ca,ka,qD3;a,cTkaSlNmi,nLrItzi,yH;ar;aIiam,lH;anEO;!l,nB;dy,eHh,n4;nhGrva;aKdJiCPlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5EgNi,lKrH;edi79iIjem,on,yH;em,l;em,sF;an4iHliF;nHsCE;a,da;!an,han;b0DcASd0Be,g09ha,i08ja,l06n04rLsoum60tKuIv82x9IyHz4;a,bell,ra,soB9;de,rH;a,eC;h8Fild1t4;a,cYgUiKjor4l7Sn4s6tJwa,yH;!aHbe6Wja8lAE;m,nBH;a,ha,in1;!aJbCBeIja,lEna,sHt64;!a,ol,sa;!l1H;! Jh,mInH;!a,e,n1;!awit,i;aliAHcJeduarBfernIjHlui5Y;o6Ful2;anB;ecil2la3;arJeIie,oHr44ueriA;!t;!ry;et42i37;el4Ui76y;dHon,ue5;akran7y;ak,en,iHk,lo3O;a,ka,nB;a,re,s4te;daHg4;!l3A;alEd4elHge,isDBon0;ei8in1yn;el,le;a0Ne0CiYoQuLyH;d2la,nH;!a,dIeBGnHsCL;!a,eBF;a,sCJ;aCWcJel0PiFlIna,pHz;e,i7;a,u,wa;iHy;a0Se,ja,l2JnB;is,l1SrJttIuHvel4;el5is1;e,ie;aKeIi9na,rH;a86i9;lHn1t7;ei;!in1;aSbb9CdRepa,lMnJsIv2zH;!a,be5LetAz4;a,etA;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lHy;iHy;aA0e;!aH;!n5F;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx4y5;iHt4;c2t2;e2LlCG;la,nHra;a,ie,o3;a,or1;a,gh,laH;!ni;!h,nH;a,d3e,n5P;cOdon97iNkes6mi9Ana,rMtJurIvHxmi,y5;ern1in2;a,e54ie,yn;as6iIoH;nya,ya;fa,s6;a,isF;a,la;ey,ie,y;a04eZhXiOlAKoNrJyH;lHra;a,ee,ie;istHy6D;a,en,iIyH;!na;!e,n59;nul,ri,urtnB0;aOerNlAZmJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stC;!na,ra;aHei3ongordzol;dij1w5;el7QiKjsi,lJnIrH;a,i,ri;d3na,za;ey,i,lBDs4y;ra,s6;bi7cAJdiat7IeB2iRlQmPnyakuma19rNss6KtKvi7yH;!e,lH;a,eH;e,i8L;a6DeIhHi4NlEri0y;ar6Ber6Bie,leCrB2y;!lyn8Gri0;a,en,iHl5Soli0yn;!ma,n3VsF;a5il1;ei8Ei,l4;a,tl6L;a07eYiVoNuH;anLdKliHst63;a8HeHsF;!n8tH;!a,te;e5Ji3Jy;a,i7;!anNcelEd6RelGhan7RlLni,sIva0yH;a,ce;eHie;fHlEph5U;a,in1;eHie;en,n1;!a,e,n41;lHng;!i1ClH;!i1B;anMle0nJrIsH;i8Csi8C;i,ri;!a,elGif2CnH;a,etAiHy;!e,f2A;a,e8EiInH;a,e8DiH;e,n1;cMd1mi,nIque4Xsmin3Ovie3y8zH;min9;a9eIiH;ce,e,n1s;!lHsFt0F;e,le;inIk4lEquelH;in1yn;da,ta;lRmPnOo0rNsIvaHzaro;!a0lu,na;aJiIlaHob84;!n9N;do3;!belHdo3;!a,e,l39;a77en1i0ma;a,di3es,gr6Yji;a8elBogH;en1;a,e8iHo0se;a0na;aSeOiJoHusFyacin2B;da,ll4rten23snH;a,i9Q;lImaH;ri;aIdHlaI;a,egard;ry;ath1CiJlInriet7rmi8sH;sa,t1B;en2Sga,mi;di;bi2Dil8IlNnMrJsItHwa,yl8Iz7H;i5St4;n5Yti;iHmo51ri52;etH;!te;aDnaD;a,ey,l4;a03eXiSlQoOrKunJwH;enHyne1Q;!dolE;ay,el;acIetHiselB;a,chC;e,ieH;!la;ld1AogooH;sh;adys,enHor2yn2H;a,da,na;aKgi,lIna,ov89selHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald3Pi,m3Ctru8B;etAi4W;a,eHna;s26vieve;ma;bIil,le,mHrnet,yG;al5Ni5;i5FrielH;a,l1;aVeSiRloOoz2rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0O;n1s61;!ca;!rH;a,encH;e,ia;en,o0;lIn0rnH;!anB;ec2ic2;jr,n7rKtHy9;emIiHma,ouma7;ha,ma,n;eh;ah,iBrah,za0;cr4Nd0Ne0Mi0Lk7l04mWn4YrTsNtMuLvH;aJelIiH;!e,ta;in0Gyn;!ngel2S;geni1la,ni45;h5Sta;mLperanKtH;eIhHrel5;er;l30r9;za;a,eralB;iHma,nest2Jyn;cHka,n;a,ka;a,eMiJmH;aHie,y;!li8;lHn1;ee,iHy;a,e,ja;lHrald;da,y;aWeUiNlMma,no3oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c2da,f,nMsJzaH;!betHve7;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a;!in1na;leCs6;vi;eIiHna,wi0;e,th;l,n;aYeMh2iLjeneKoHul30;lor5Tminiq4In3FrHtt4;a,eCis,la,othHthy;ea,y;ba;an0AnaDon8x4ya;anQbPde,eOiMja,lJmetr2nHsir5K;a,iH;ce,se;a,iIla,orHphi8;es,is;a,l6D;dHrdH;re;!d5Cna;!b2HoraDra;a,d3nH;!a,e;hl2i0l0HmNnLphn1rIvi1XyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,etAiH;!ca,el1Cka,z;arHia;is;a0Se0Oh05i03lVoKrIynH;di,th2;istHy05;al,i0;lPnMrIurH;tn1E;aJd2NiHn2Nri8;!nH;a,e,n1;!l1X;cepci59n4sH;tanHuelo;ce,za;eHleC;en,tA;aJeoIotH;il51;!pat3;ir9rJudH;etAiH;a,ne;a,e,iH;ce,sZ;a3er3ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Ren,iHy;!an1e,n1;deJlseIrH;!i9yl;a,y;li8;nMrH;isKlImH;ai8;a,eHotA;n1tA;!sa;d3elGtH;al,elG;cIlH;esAi44;el2ilH;e,ia,y;itlZlYmilXndWrOsMtHy5;aKeJhHri0;erHleCrEy;in1;ri0;li0ri0;a33sH;a32ie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,o7y;ne,y;na,sF;a0Hi0H;a,e,l1;is7l4;in,yn;a0Ie02iZlXoUrH;andSeQiJoIyH;an0nn;nwEok9;an3DdgLg0XtH;n2XtH;!aInH;ey,i,y;ny;etH;!t9;an0e,nH;da,na;i9y;bbi9glarIlo05nH;i7n4;ka;ancHossom,ythe;a,he;an17lja0nHsm3I;i7tH;ou;aUcky,linTni7rPssOtJulaDvH;!erlH;ey,y;hJsy,tH;e,iHy9;e,na;!anH;ie,y;!ie;nHt6yl;adIiH;ce;etAi8;ay,da;!triH;ce,z;rbJyaH;rmH;aa;a3ie,o3ra;a2Sb2Md23g1Zi1Qj5l16m0Xn09oi,r04sUtTuPvOwa,yIzH;ra,u0;aKes6gJlIseH;!l;in;un;!nH;a,na;a,i2Ir2J;drJgus1RrIsteH;ja;el2;a,ey,i,y;aahua,he0;hIi2Gja,mi7s2DtrH;id;aMlIraqHt21;at;eIi9yH;!n;e,iHy;gh;!nH;ti;iJleIo6pi7;ta;en,n1tA;aHelG;!n1J;a00dje5eYgUiSjQnJohito,toHya;inetAnH;el5ia;!aKeIiHmJ;e,ka;!mHtA;ar4;!belIliFmU;sa;!le;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tA;te;! JbImHstasiNya;ar2;el;cla3jul2pau5;aLberKeliJiHy;e,l2naH;!ta;a,ja;!ly;hGiIl2nB;da;a,ra;le;aWba,ePiMlKma,thJyH;a,c2sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c2is6jaKksaKna,sJxH;aHia;!nd3;ia,saH;nd3;ra;ia;i0nIyH;ah,na;a,is,naDoud;la;c6da,leCmNnLsH;haDlH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lEsH;on;yn;!lH;i8yn;ne;aKbIiHrL;!gaK;ey,i9y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Actor:"true\xA6aJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJecretary,oldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt",Honorific:"true\xA6a01bYcQdPeOfiJgIhon,jr,king,lHmCoffic00p7queen,r3s0taoiseach,vice6;e1fc,gt,ir,r,u0;ltRpt,rg;cond liInBrgeaJ;abbi,e0;ar1p9s,v0;!erend; admirX;astOhd,r0vt;esideDi1of0;!essM;me mini4nce0;!ss;a3essrs,i2lle,me,r1s0;!tr;!s;stK;gistrate,j,r6yF;i3lb,t;en,ov;eld mar3rst l0;ady,i0;eutena0;nt;shG;sq,xcellency;et,oct6r,utchess;apt6hance4mdr,o0pl;lonel,m2ngress0unci3;m0wom0;an;dr,mand5;ll0;or;!ain;ldg,rig0;!adi0;er;d0sst,tty,yatullah;j,m0v;!ir0;al",SportsTeam:"true\xA60:1A;1:1H;2:1G;a1Eb16c0Td0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Bm01newToQpJqueens parkIreal salt lake,sAt5utah jazz,vancouver whitecaps,w3yW;ashington 3est ham0Rh10;natio1Oredski2wizar0W;ampa bay 6e5o3;ronto 3ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasC;buccanee0ra0K;a7eattle 5heffield0Kporting kansas0Wt3;. louis 3oke0V;c1Frams;marine0s3;eah15ounG;cramento Rn 3;antonio spu0diego 3francisco gJjose earthquak1;char08paA; ran07;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat1steele0;il3oenix su2;adelphia 3li1;eagl1philNunE;dr1;akland 3klahoma city thunder,rlando magic;athle0Mrai3;de0; 3castle01;england 7orleans 6york 3;city fc,g4je0FknXme0Fred bul0Yy3;anke1;ian0D;pelica2sain0C;patrio0Brevolut3;ion;anchester Be9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Fvi3;kings;imberwolv1wi2;rewe0uc0K;dolphi2heat,marli2;mphis grizz3ts;li1;cXu08;a4eicesterVos angeles 3;clippe0dodDla9; galaxy,ke0;ansas city 3nE;chiefs,roya0E; pace0polis colU;astr06dynamo,rockeTtexa2;olden state warrio0reen bay pac3;ke0;.c.Aallas 7e3i05od5;nver 5troit 3;lio2pisto2ti3;ge0;broncZnuggeM;cowbo4maver3;ic00;ys; uQ;arCelKh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki1;brow2cavalie0india2;bengaWre3;ds;arlotte horAicago 3;b4cubs,fire,wh3;iteB;ea0ulR;diff3olina panthe0; c3;ity;altimore 9lackburn rove0oston 5rooklyn 3uffalo bilN;ne3;ts;cel4red3; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 3;brav1falco2h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls",Uncountable:"true\xA60:1I;1:16;2:1X;a1Rb1Jc1Ad17e10f0Ug0Nh0Ii0Ej0Dknowled1Ql08mYnews,oXpTrOsDt8vi7w3;a5ea0Bi4oo3;d,l;ldlife,ne;rmth,t0;neg17ol0Ctae;e6h5oothpaste,r3una;affTou3;ble,sers,t;ermod1Mund0;a,nnis;aBcene0Aeri1hAil9kittl1now,o8p6t4u3;g10nshi0Q;ati1Le3;am,el;ace1Ee3;ci1ed;ap,cc0;k,v0;eep,ingl1;d0Dfe18l3nd,tish;m11t;a6e4ic3;e,ke0M;c3laxa0Isearch;ogni0Hrea0H;bi1in;aPe5hys2last9o3ress04;l3rk,w0;it2yA;a12trZ;bstetr2il,xygen;aAe8ilk,o5u3;mps,s3;ic;n3o0I;ey,o3;gamy;a3chan2;sl1t;chine3il,themat2; learn0Bry;aught0e5i4ogi0Su3;ck,g0I;ce,ghtn08ngui0QteratN;a3isM;th0;ewelAusti0L;ce,mp3nformaUtself;a3ortan0J;ti3;en0H;a6isto5o3;ck3mework,n3spitali0B;ey;ry;ir,libut,ppiD;ene6o4r3um,ymna0D;aCound;l3ssip;d,f; 3t2;editQpo3;ol;i7lour,o4urnit3;ure;od,rgive3uri0wl;ne3;ss;c9sh;conom2duca8lectr7n5quip6th2very3;body,o3thH;ne;joy3tertain3;ment;iciPon2;tiI;ar4iabet1raugh4;es;ts;aAelcius,h6iv2l5o3urrency;al,ld w3nfusiDttD;ar;ass2oth5;aos,e3;e4w3;ing;se;r7sh;a7eef,i4lood,owls,read,utt0;er;lliar4s3;on;ds;g3ss;ga3;ge;c8dvi7ero5ir4mnes3rt,thlet2;ty;craft;b2d3naut2;ynam2;ce;id,ou3;st2;ics",Infinitive:"true\xA60:6S;1:76;2:5C;3:74;4:73;5:67;6:6F;7:6Y;8:6Q;9:72;A:70;B:5X;C:6X;D:6L;E:77;F:5B;a6Kb66c57d4De3Xf3Jg3Dh37i2Uj2Sk2Ql2Hm26n23o1Yp1Jr0Rs06tYuTvOwHyG;awn,ield;aJe1Zhist6iIoGre6D;nd0rG;k,ry;pe,sh,th0;lk,nHrGsh,tDve;n,raE;d0t;aJiHoG;te,w;eGsC;!w;l6Jry;nHpGr4se;gra4Pli41;dGi9lo5Zpub3Q;erGo;mi5Cw1I;aMeLhKig5SoJrHuGwi7;ne,rn;aGe0Mi5Uu7y;de,in,nsf0p,v5J;r2ZuD;ank,reatB;nd,st;lk,rg1Qs9;aZcWeVhTi4Dkip,lSmRnee3Lo52pQtJuGwitD;bmCck,ff0gge7ppHrGspe5;ge,pri1rou4Zvi3;ly,o36;aLeKoJrHuG;dy,mb6;aFeGi3;ngthBss,tD;p,re;m,p;in,ke,r0Qy;la58oil,rink6;e1Zi6o3J;am,ip;a2iv0oG;ck,rtBut;arDem,le5n1r3tt6;aHo2rG;atDew;le,re;il,ve;a05eIisk,oHuG;in,le,sh;am,ll;a01cZdu8fYgXje5lUmTnt,pQquPsKtJvGwa5V;eGiew,o36;al,l,rG;se,t;aFi2u44;eJi7oItG;!o2rG;i5uc20;l3rt;mb6nt,r3;e7i2;air,eHlGo43r0K;a8y;at;aFemb0i3Zo3;aHeGi3y;a1nt;te,x;a5Dr0J;act1Yer,le5u1;a13ei3k5PoGyc6;gni2Cnci6rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlOoMrIuG;b21ll,mp,rGsh;cha1s4Q;ai1eIiEoG;cGdu8greAhibCmi1te7vi2W;eAlaim;di5pa2ss,veE;iEp,rtr46sGur;e,t;aHead,uG;g,n4;n,y;ck,le;fo34mCsi7;ck,iErt4Mss,u1;bJccur,ff0pera9utweIverGwe;co47lap,ta22u1wG;helm;igh;ser3taF;eHotG;e,i8;ed,gle5;aMeLiIoHuG;ltip3Grd0;nit13ve;nHrr12sreprG;eseE;d,g6us;asu2lt,n0Nr4;intaFna4rHtG;ch,t0;ch,kGry;et;aMeLiJoGu1C;aHck,oGve;k,sB;d,n;ft,g35ke,mCnk,st2YveG;!n;a2Fc0Et;b0Nck,uG;gh,nD;iGno34;ck,ll,ss;am,oFuG;d4mp;gno2mQnGss3H;cOdica9flu0MhNsKtIvG;eGol3;nt,st;erGrodu8;a5fe2;i7tG;aGru5;ll;abCibC;lu1Fr1D;agi24pG;lemeEo22ro3;aKeIi2oHuG;nt,rry;n02pe,st;aGlp;d,t;nd6ppBrm,te;aKloAove1PrIuG;arGeAi15;ant39d;aGip,ow,umb6;b,sp;in,th0ze;aReaQiOlMoJrHuncG;ti3J;acGeshB;tu2;cus,lHrG;ce,eca7m,s30;d,l24;a1ZoG;at,od,w;gu2lGni1Xt,x;e,l;r,tu2;il,stBvG;or;a15cho,le5mSnPstNvalua9xG;a0AcLerKi7pGte19;a18eHi2laFoGreA;rt,se;ct,riG;en8;ci1t;el,han4;abGima9;li1J;ab6couXdHfor8ga4han8j03riDsu2t0vG;isi2Vy;!u2;body,er4pG;hasiGow0;ze;a07eUiLoKrHuG;mp;aHeAiG;ft;g,in;d4ubt;ff0p,re5sHvG;iZor8;aKcHliGmiApl1Btingui14;ke;oGuA;uGv0;ra4;gr1YppG;ear,ro3;cOeNfLliv0ma0Fny,pKsHterG;mi0G;cribe,er3iHtrG;oy;gn,re;a0Be0Ai5osC;eGi0By;at,ct;m,pB;iIlHrG;ea1;a2i06;de;ma4n8rGte;e,kB;a0Ae09h06i9l04oJrG;aHeGoAu0Hy;a9dC;ck,ve;llZmSnHok,py,uGv0;gh,nt;cePdu5fMsKtIvG;eGin8;rt,y;aFin0VrG;a7ibu9ol;iGtitu9;d0st;iHoGroE;rm;gu2rm;rn;biLfoKmaJpG;a2laF;in;re;nd;rt;ne;ap1e5;aGip,o1;im,w;aHeG;at,ck,w;llen4n4r4se;a1nt0;ll,ncIrGt0u1;eGry;!en;el;aSePloOoMrIuG;lGry;ly;igHuG;sh;htB;en;a7mb,o7rrGth0un8;ow;ck;ar,lHnefCtrG;ay;ie3ong;ng,se;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waC;acIeHra5;ct;m0Fnd;h,k;k,sG;eIiHocia9uG;me;gn,st;mb6rt;le;chHgGri3;ue;!i3;eaJlIroG;aDve;ch;aud,y;l,r;noun8sw0tG;icipa9;ce;lHt0;er;e4ow;ee;rd;aRdIju7mCoR;it;st;!reA;ss;cJhie3knowled4tiva9;te;ge;ve;eIouEu1;se;nt;pt;on",Unit:"true\xA60:19;a14b12c0Od0Ne0Lf0Gg0Ch09in0Hjoule0k02l00mNnMoLpIqHsqCt7volts,w6y4z3\xB02\xB51;g,s;c,f,n;b,e2;a0Nb,d0Dears old,o1;tt0H;att0b;able4b3d,e2on1sp;!ne0;a2r0D;!l,sp;spo04; ft,uare 1;c0Id0Hf3i0Fkilo0Jm1ya0E;e0Mil1;e0li0H;eet0o0D;t,uart0;ascals,e2i1ou0Pt;c0Mnt0;rcent,t02;hms,uYz;an0JewtT;/s,b,e9g,i3l,m2p1\xB2,\xB3;h,s;!\xB2;!/h,cro5l1;e1li08;! pFs1\xB2;! 1;anEpD;g06s0B;gQter1;! 2s1;! 1;per second;b,i00m,u1x;men0x0;b,elvin0g,ilo2m1nR;!/h,ph,\xB2;byZgXmeter1;! p2s1;! p1;er1; hour;e1g,r0z;ct1rtz0;aXogQ;al2b,igAra1;in0m0;!l1;on0;a4emtPl2t1;\xB2,\xB3; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!\xB2,\xB3;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s",Organization:"true\xA60:46;a3Ab2Qc2Ad21e1Xf1Tg1Lh1Gi1Dj19k17l13m0Sn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0Xou1w0X;gov,tu2S;a3e1orld trade organizati41;lls fargo,st1;fie22inghou16;l1rner br3D;-m11gree31l street journ25m11;an halNeriz3Wisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Rps;es35i1;lev2Xted natio2Uv; mobi2Kaco bePd bMeAgi frida9h3im horto2Tmz,o1witt2W;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen33daily ma2Xguess w2holli0rolling st1Ms1w2;mashing pumpki2Ouprem0;ho;ea1lack eyed pe3Fyrds;ch bo1tl0;ys;l2s1;co,la m12;efoni07us;a6e4ieme2Gnp,o2pice gir5ta1ubaru;rbucks,to2N;ny,undgard1;en;a2Rx pisto1;ls;few25insbu26msu1X;.e.m.,adiohead,b6e3oyal 1yan2X;b1dutch she4;ank;/max,aders dige1Ed 1vl32;bu1c1Uhot chili peppe2Klobst28;ll;c,s;ant2Vizno2F;an5bs,e3fiz24hilip morrBi2r1;emier27octer & gamb1Rudenti14;nk floyd,zza hut;psi28tro1uge08;br2Qchina,n2Q; 2ason1Xda2G;ld navy,pec,range juli2xf1;am;us;a9b8e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0K;l,s;c,st1Etflix,w1; 1sweek;kids on the block,york08;a,c;nd1Us2t1;ional aca2Fo,we0Q;a,cYd0O;aAcdonald9e5i3lb,o1tv,yspace;b1Nnsanto,ody blu0t1;ley crue,or0O;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;'s,s;c's milk,tt13z1Y;'ore09a3e1g,ittle caesa1Ktd;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1K;art;iffy lu0Lo3pmorgan1sa;! cha1;se;hnson & johns1Sy d1R;bm,hop,n1tv;c,g,te1;l,rpol; & m,asbro,ewlett-packaTi3o1sbc,yundai;me dep1n1J;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Iu1;cci,ns n ros0;ldman sachs,o1;dye1g0B;ar;axo smith kliZencore;electr0Im1;oto0V;a3bi,da,edex,i1leetwood mac,oGrito-l0A;at,nancial1restoV; tim0;cebook,nnie mae;b06sa,u3xxon1; m1m1;ob0H;!rosceptics;aiml0Ae5isney,o3u1;nkin donuts,po0Wran dur1;an;j,w j1;on0;a,f leppa3ll,p2r spiegZstiny's chi1;ld;eche mode,t;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra05;al;!ca c5l4m1o0Ast05;ca2p1;aq;st;dplMgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Hy;dbury,pital o1rl's jr;ne;aGbc,eCfAl6mw,ni,o2p,r1;exiteeWos;ei3mbardiJston 1;glo1pizza;be;ng;ack & deckFo2ue c1;roX;ckbuster video,omingda1;le; g1g1;oodriN;cht3e ge0n & jer2rkshire hathaw1;ay;ryH;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bXcSdidRerosmith,ig,lLmFnheuser-busEol,ppleAr7s3t&t,v2y1;er;is,on;hland2s1;n,ociated F; o1;il;by4g2m1;co;os; compu2bee1;'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c",Demonym:"true\xA60:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an",Possessive:"true\xA6anyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne",Currency:"true\xA6$,aud,bScQdLeurKfJgbp,hkd,iIjpy,kGlEp8r7s3usd,x2y1z0\xA2,\xA3,\xA5,\u0434\u0435\u043D,\u043B\u0432,\u0440\u0443\u0431,\u0E3F,\u20A1,\u20A8,\u20AC,\u20AD,\uFDFC;lotyS\u0142;en,uanR;af,of;h0t5;e0il5;k0q0;elM;iel,oubleLp,upeeL;e2ound st0;er0;lingI;n0soH;ceGn0;ies,y;e0i8;i,mpi7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s",City:"true\xA60:73;1:61;2:6G;3:5U;4:5R;a68b54c4Id4Ae46f3Yg3Jh38i2Zj2Uk2Dl22m1Kn19o16p0Uq0Sr0Ls01tPuOvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3J;greb,nzib5G;ang2e5okoha3Uunfu;katerin3Jrev0;a5n0O;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1K;hi5Zkl3C;l63xford;aw;a6ern2i5ladivost5Molgogr6K;en3lni6R;lenc6Dncouv2Yr3ughn;lan bat1Drumqi,trecht;aDbilisi,eCheBi9o8r7u5;l21n63r5;in,ku;ipoli,ondh62;kyo,m34ron1QulouS;an5jua3l2Zmisoa6Era3;j4Xshui; hag65ssaloni2L;gucigal28hr0l av1W;briz,i6llinn,mpe5Ang5rtu,shk2X;i2Msh0;an,chu1n0p2Iyu0;aEeDh8kopje,owe1It7u5ydney;ra5zh51;ba0Jt;aten is59ockholm,rasbou6Auttga31;an8e6i5;jiazhua1llo1m60y0;f54n5;ya1zh4L;gh3Ot4U;att4Ao1Yv49;cramen18int DlBn5o paulo,ppo3Wrajevo; 7aa,t5;a 5ia3Io domin3I;a3fe,m1O;antonCdie3Gfrancisco,j5ped3Ssalv8;o5u0;se;em,v5z2B;ad0I;lou59peters29;aAe9i7o5;me,sar5t5A;io;ga,o5yadh;! de janei3I;cife,ykjavik;b4Uip4lei2Mnc2Swalpindi;ingdao,u5;ez2i0Q;aEeDhCiBo8r7u6yong5;ya1;eb5Aya1;ag54etor53;rt5zn0; 5la4Fo;au prin0Nelizabe29sa05;ls3Srae5Ctts2B;iladelph4Ynom pe1Doenix;r26tah tik3I;ler00naji,r4Pt5;na,r36;ak47des0Lm1Rr6s5ttawa;a3Ylo;an,d07;a8ew6i5ovosibir1Oyc;ng2Hs; 5cast39;del27orlea46taip16york;g8iro4Xn5pl2Zshv36v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0Y;aFeCi9o6u5;mb2Cni28sc40;gadishu,nt6s5;c17ul;evideo,re31;ami,l6n18s5;kolc,sissauga;an,waukee;cca,d5lbour2Pmph41;an,ell5i3;in,\xEDn;cau,drAkass2Tl9n8r5shh4A;aca6ib5rakesh,se2N;or;i1Ty;a4EchEdal12i47;mo;id;aCeiAi8o6u5vRy2;anLckn0Rdhia3;n5s angel28;d2g bea1O;brev2De3Kma5nz,sb2verpo2A;!ss29;c5pzig;est0C; p6g5ho2Yn0Gusan27;os;az,la35;aHharFiClaipeBo9rak0Hu7y5;iv,o5;to;ala lump4n5;mi1sh0;be,hi0Llka2Zpavog4si5wlo2;ce;da;ev,n5rkuk;gSsha5;sa;k5toum;iv;bIdu3llakuric0Tmpa3Gn6ohsiu1ra5un1Lwaguc0T;c0Sj;d5o,p4;ah1Vy;a7e6i5ohannesZ;l1Xn0;dd37rusalem;ip4k5;ar2J;bad0mph1QnBrkutYs8ta01z5\u0307zm7;m6tapala5;pa;ir;fah0l6tanb5;ul;am2Zi2I;che2d5;ianap2Lo21;aBe8o5yder2W; chi mi6ms,nolulu,u5;st2;nh;f6lsin5rakli2;ki;ei;ifa,lifax,m7n5rb1Dva3;gAnov5oi;er;bu2Wilt2;aFdanEenDhCiPlasgBo9raz,u5;a5jr21;dal6ng5yaquil;zh1H;aja2Lupe;ld coa18then5;bu2P;ow;ent;e0Toa;sk;lw7n5za;dhi5gt1C;nag0S;ay;aisal26es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Nl paso;in5mont2;bur5;gh;aAe8ha0Visp4o7resd0Ju5;b5esseldorf,rb0shanbe;ai,l0G;ha,nggu0rtmu11;hradRl5troit;hi;donghHe5k08li0masc1Xr es sala1HugavpiY;gu,je2;aKebu,hAo5raio03uriti1P;lo7n6penhag0Ar5;do1Nk;akLst0V;gVm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;n5ttogr12;digarh,g5;ch8sha,zh06;i9lga8mayenJn6pe town,r5;acCdiff;ber18c5;un;ry;ro;aUeMhJirmingh0ToIr9u5;chareRdapeRenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil0Mtisla7zzav5;il5;le;va;goZst2;op6ubaneshw5;ar;al;iBl9ng8r5;g6l5n;in;en;aluru,hazi;fa5grade,o horizonte;st;ji1rut;ghd0BkGnAot9r7s6yan n4;ur;el,r07;celo3ranquil09;na;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a04b01cc00ddis abaZgartaYhmedWizawl,lQmNnHqaZrEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a6chora5kaNtwerp;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 8buquerq7e5giers,maty;ppo,xandr5;ia;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Country:"true\xA60:39;1:2M;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om3DpZqat1KrXsKtCu6v4wal3yemTz2;a25imbabwe;es,lis and futu2Y;a2enezue32ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2Y;k.,s.2; 28a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Ys and caic1U; and 2-2;toba1K;go,kel0Znga;iw2Wji2nz2S;ki2U;aCcotl1eBi8lov7o5pa2Cri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Rriname;lomon1Wmal0uth 2;afr2JkLsud2P;ak0en0;erra leoEn2;gapo1Xt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele25luc0mart20;epublic of ir0Dom2Duss0w2;an26;a3eHhilippinTitcairn1Lo2uerto riM;l1rtugE;ki2Cl3nama,pua new0Ura2;gu6;au,esti2;ne;aAe8i6or2;folk1Hth3w2;ay; k2ern mariana1C;or0N;caragua,ger2ue;!ia;p2ther19w zeal1;al;mib0u2;ru;a6exi5icro0Ao2yanm05;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagasc00l6r4urit3yot2;te;an0i15;shall0Wtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed01;a5e4i2uxembourg;b2echtenste11thu1F;er0ya;ban0Hsotho;os,tv0;azakh1Ee3iriba03o2uwait,yrgyz1E;rWsovo;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an",Region:"true\xA60:2M;1:2S;2:2J;a2Pb2Cc1Yd1Tes1Sf1Qg1Kh1Gi1Bj17k12l0Zm0On07o05pZqWrTsKtFuCv9w5y3zacatec2T;akut0o0Du3;cat2k07;a4est 3isconsin,yomi1L;bengal,vi6;rwick2Ashington3;! dc;er4i3;rgin0;acruz,mont;dmurt0t3;ah,tar3; 2Ka0W;a5e4laxca1Qripu1Wu3;scaDva;langa1nnessee,x2E;bas0Um3smNtar24;aulip2Cil nadu;a8i6o4taf10u3ylh1E;ffYrr03s19;me1Bno1Puth 3;cVdU;ber0c3kkim,naloa;hu2ily;n4skatchew2xo3;ny; luis potosi,ta catari1;a3hode9;j3ngp06;asth2shahi;ingh24u3;e3intana roo;bec,en5reta0Q;ara7e5rince edward3unjab; i3;sl0A;i,nnsylv3rnambu0A;an0;!na;axa0Xdisha,h3klaho1Zntar3reg6ss0Ax0F;io;aIeDo5u3;evo le3nav0V;on;r3tt16va scot0;f8mandy,th3; 3ampton15;c5d4yo3;rk13;ako1M;aroli1;olk;bras1Lva0Bw3; 4foundland3;! and labrador;brunswick,hamp0Wjers3mexiRyork state;ey;galOyarit;a9eghala0Mi5o3;nta1r3;dov0elos;ch5dlanCn4ss3zor11;issippi,ouri;as geraOneso18;ig2oac2;dhy12harasht0Gine,ni4r3ssachusetts;anhao,i el,ylF;p3toba;ur;anca0Ie3incoln0IouisH;e3iR;ds;a5e4h3omi;aka06ul1;ntucky,ra01;bardino,lmyk0ns0Qr3;achay,el0nata0X;alis5har3iangxi;kh3;and;co;daho,llino6n3owa;d4gush3;et0;ia1;is;a5ert4i3un2;dalFm0D;fordZ;mpYrya1waii;ansu,eorg0lou7oa,u3;an4erre3izhou,jarat;ro;ajuato,gdo3;ng;cesterS;lori3uji2;da;sex;ageTe6o4uran3;go;rs3;et;lawaLrbyK;aEeaDh8o3rimea ,umbr0;ahui6l5nnectic4rsi3ventry;ca;ut;i02orado;la;e4hattisgarh,i3uvash0;apQhuahua;chn4rke3;ss0;ya;ra;lFm3;bridge6peche;a8ihar,r7u3;ck3ryat0;ingham3;shi3;re;emen,itish columb0;h0ja cal7lk6s3v6;hkorto3que;st2;an;ar0;iforn0;ia;dygea,guascalientes,lAndhr8r4ss3;am;izo1kans4un3;achal 6;as;na;a 3;pradesh;a5ber4t3;ai;ta;ba4s3;ka;ma",Place:"true\xA6a0Eb0Bc04d03e02f00gVhUiRjfk,kOlMmJneGoFpBque,rd,s9t6u5v4w1y0;akutOyz;ake isFis1y0;!o;!c;a,ostok,t;laanbaatar,p02safa,t;ahiti,e1he 0;bronx,hamptons;nn,x;a0fo,oho,t,under7yd;khalNsk;a2e1h0itcairn;l,x;k,nnN;!cif04;kla,nt,rd;b1w eng0;land;!r;a1co,i0t,uc;dNnn;gadZlibu,nhattZ;a0gw,hr;s,x;an1osrae,rasnoyar0ul;sk;!s;a1cn,da,nd0st;ianRochina;!x;arlem,kg,nd,oHwy;a3re0;at 0enwich;brita0lakH;in;!y village;co,l0ra;!a;urope,vergladC;ak,en,fw,ist,own4xb;al5dg,gk,h2l1o0rA;lo,nn;!t;a1ina0uuk;town;morro,tham;!if;cn,e1kk,l0rooklyn;vd;l air,verly hills;frica,lta,m7n3r2sia,tl1ve,zor0;es;!ant2;ct1iz;adyr,tarct0;ic0; oce0;an;ericas,s",MaleName:"true\xA60:E5;1:D6;2:DO;3:AY;4:D2;5:CG;6:B6;7:CW;8:C8;9:DK;A:DL;B:A6;C:C2;aCObBLcAJd9He8Nf85g7Ih6Ui6Ej5Ek52l4Dm35n2To2Np2Fqu2Dr1Ls11t0Eu0Dv07wTxSyIzD;aDor0;cDh9Tkaria,n5W;hEkD;!aCM;ar5WeCL;aLoFuD;sDu2KvBY;if,uf;nFsEusD;ouf,sD;ef;aDg;s,tD;an,h0;hli,nBMssX;avi3ho4;aMeKiFoDyaC2;jcie8Clfgang,odrow,utD;!er;lDnst1;bFey,frD1lD;aBDiD;am,e,s;e9Fur;i,nde6sD;!l8t1;de,lErrAyD;l1ne;lDt3;aAAy;aGiDladimir,ojte7Z;cEha0kt69nceDrgAJva0;!nt;e3Vt67;lentDnA5;in4Y;ghBVlyss5Cnax,sm0;aXeShOiMoHrFuEyD;!l3ro7s1;n9r5C;avAWeDist0oy,um0;ntAOv5Zy;bGdFmDny;!as,mDoharu;aCTie,y;!d;iBy;mDt5;!my,othy;adFeoEia8GomD;!as;!do8P;!de5;dGrD;en9LrD;an9KeDy;ll,n9J;!dy;dgh,ha,iDnn3req,tsu4T;cB5ka;aTcotRePhLiJoHpenc3tDur1Vylve9Kzym1;anFeDua8D;f0phBTvDwa8C;e62ie;!islaw,l8;lom1nBFuD;leyma7ta;dDlBm1yabonga;!dhart7Bn8;aFeD;lDrm0;d1t1;h7Une,qu10un,wn,y7;aDbasti0k2Al4Rrg4Oth,ymoAU;m5n;!tD;!ie,y;lEmDnti2Eq5Bul;!ke5MmCu4;ik,vato7X;aYeUheAAiQoHuEyD;an,ou;b7NdEf5pe7SssD;!elBZ;ol3Fy;an,bKcJdIel,geHh0landBQmGnFry,sEyD;!ce;coe,s;!aAHnC;an,eo;l47r;e5Og3n8olfo,ri7A;co,ky;bCeB7;cDl8;ar6Pc6OhEkDo;!ey,ie,y;a99ie;gEid,ubAx,yDza;an1InY;gA8iD;naA4s;ch70fa4lHmGndFpha4sEul,wi2HyD;an,mo82;h7Vm5;alBDol2Uy;iATon;f,ph;ent2inD;cy,t1;aIeGhilFier72ol,rD;aka16eD;m,st1;!ip,lip;dALrcy,tD;ar,e3Gr1X;b4Kdra7Ft4ZulD;!o17;ctav3Fi3liv3mAFndrej,rHsEtDum9wA;is,to;aEc9k9m0vD;al5Z;ma;i,l53vL;aLeJiFoDu3A;aDel,j5l0ma0r3K;h,m;cEg4i49kD;!au,h7Uola;holBkDolB;!olB;al,d,il,ls1vD;il8Y;hom,thD;anDy;!a4i4;aZeWiMoHuEyD;l2Jr1;hamEr6XstaD;fa,p5C;ed,mH;di0We,hamFis2FntEsDussa;es,he;e,y;ad,ed,mD;ad,ed;cIgu4hai,kGlFnEtchD;!e6;a8Aik;house,o0Bt1;ae5YeA4olD;aj;ah,hDk8;aEeD;al,l;el,l;hElv2rD;le,ri6v2;di,met;ay0ck,hTjd,ks2DlRmadWnQrKs1tFuricExD;!imilian9Nwe6;e,io;eGhEiBtDus,yB;!eo,hew,ia;eDis;us,w;j,o;cHio,kGlFqu7Dsha6tDv2;iDy;!m,n;in,on;!el,oPus;!el9IoOus;iGu4;achDcolm,ik;ai,y;amEdi,eDmoud;sh;adDm5T;ou;aXeQiOlo3EoKuEyD;le,nd1;cGiFkDth3uk;aDe;!s;gi,s,z;as,iaD;no;g0nn7SrenFuDv8Jwe6;!iD;e,s;!zo;am,oD;n4r;a8Cevi,la5JnIoGst3thaFvD;eDi;nte;bo;!nD;!a6Sel;!ny;mFnErDur5Hwr5H;ry,s;ce,d1;ar,o5A;aLeGhaled,iDrist5Iu4Vy6X;er0p,rD;by,k,ollD;os;en0iGnDrmit,v44;!dEnDt5Z;e1Ay;a6ri59;r,th;cp3j5m66na73rEsp9them,uD;ri;im,l;a02eUiSoGuD;an,lDst2;en,iD;an,en,o,us;aNeLhnKkubBnIrGsD;eEhDi8Bue;!ua;!ph;dDge;an,i,on;!aDny;h,s,th5I;!ath5Hie,nC;!l,sDy;ph;o,qu2;an,mD;!mC;d,ffIrFsD;sDus;!e;a6BemEmai7oDry;me,ni0Y;i7Ty;!e60rD;ey,y;cKdAkImHrFsEvi3yD;!dAs1;on,p3;ed,od,rDv56;e5Nod;al,es4Xis1;a,e,oDub;b,v;k,ob,quD;es;aWbQchiPgNkeMlija,nuLonut,rJsFtDv0;ai,suD;ki;aEha0i7DmaDsac;el,il;ac,iaD;h,s;a,vinDw2;!g;k,nngu5S;!r;nacDor;io;ka;ai,rahD;im;aPeJoIuDyd9;be2KgGmber4WsD;eyEsD;a2e2;in,n;h,o;m3ra3Gsse2wa4B;aHctGitGnrErD;be2Dm0;iDy;!q11;or;th;bMlLmza,nKo,rFsEyD;a4JdA;an,s0;lGo50rFuDv8;hi4Gki,tD;a,o;is1y;an,ey;k,s;!im;ib;aVeRiPlenOoLrHuD;ilEsD;!tavo;herme,lerD;mo;aFegDov3;!g,orD;io,y;dy,h5Wnt;nzaErD;an,d1;lo;!n;lbe5Ano,oD;rg3Hvan5A;ne,oFrD;aDry;ld,rd5H;ffr8rge;brElArDv2;la28r3Sth,y;e3EielD;!i5;aTePiNlLorr0NrD;anFedDitz;!dCeDri2B;ri2A;cFkD;!ie,lD;in,yn;esLisD;!co,z36;etch3oD;yd;d4lDnn,onn;ip;deriFliEng,rnD;an06;pe,x;co;bi0di,hd;ar04dZfrYit0lSmKnHo2rFsteb0th0uge7vDymAzra;an,eD;ns,re36;gi,i0DnDrol,v2w2;est4Pie;oEriqDzo;ue;ch;aJerIiEmD;aIe2Z;lErD;!h0;!iD;o,s;s1y;nu4;be0Cd1iGliFmEt1viDwood;n,s;er,o;ot1Ys;!as,j4NsD;ha;a2en;!dCg9mGoEuEwD;a2Din;arD;do;o0Wu0W;l,nD;est;a01eRiOoHrGuFwEylD;an,l0;ay7ight;a7dl8nc0st2;ag0ew;minGnEri0ugDvydBy2D;!lB;!a2MnDov0;e6ie,y;go,iDykB;cDk;!k;armuEeDll1on,rk;go;id;anKj0lbeJmetri5nHon,rGsFvEwDxt3;ay7ey;en,in;hawn,mo0B;ek,ri0I;is,nDv3;is,y;rt;!dD;re;an,lNmLnKrGvD;e,iD;! lucDd;as,ca;en,iFne6rDyl;eDin,yl;l3Bn;n,o,us;!e,i4ny;iDon;an,en,on;e,lB;as;a09e07hYiar0lNoIrGuEyrD;il,us;rtD;!is;aDistob0U;ig;dy,lGnErD;ey,neli5y;or,rD;ad;by,e,in,l2t1;aIeFiDyK;fDnt;fo0Ft1;meEt5velaD;nd;nt;rFuEyD;!t1;de;enD;ce;aIeGrisEuD;ck;!tD;i0oph3;st3;er;d,rDs;b4leD;s,y;cDdric,s9;il;lGmer1rD;ey,lEro6y;ll;!os,t1;eb,v2;a07eZiVlaUoRrEuDyr1;ddy,rtK;aLeGiFuEyD;an,ce,on;ce,no;an,ce;nEtD;!t;dEtD;!on;an,on;dEndD;en,on;!foDl8y;rd;bErDyd;is;!by;i7ke;bFlEshD;al;al,lC;ek;nHrDshoi;at,nEtD;!r1C;aDie;rd14;!edict,iEjam2nC;ie,y;to;kaMlazs,nHrD;n8rDt;eDy;tt;ey;dDeE;ar,iD;le;ar17b0Vd0Rf0Pgust2hm0Mi0Jja0Il04m00nSputsiRrIsaHuFveEyDziz;a0kh0;ry;gust5st2;us;hi;aKchJiIjun,maHnFon,tDy0;hDu09;ur;av,oD;ld;an,nd0H;!el,ki;ie;ta;aq;as,dIgel0CtD;hoGoD;i7nD;!i09y;ne;ny;er,reDy;!as,i,s,w;iFmaDos;nu4r;el;ne,r,t;an,bePdAeJfHi,lGonFphXt1vD;aNin;on;so,zo;an,en;onTrD;edU;c,jaGksandFssaGxD;!andD;er,ru;ar,er;ndD;ro;rtN;ni;dAm9;ar;en;ad,eD;d,t;in;onD;so;aEi,olfDri0vik;!o;mDn;!a;dHeGraEuD;!bakr,lfazl;hDm;am;!l;allIelFoulaye,ulD;!lDrF;ah,o;! rD;ahm0;an;ah;av,on",LastName:"true\xA60:9F;1:9V;2:9H;3:9X;4:9N;5:8J;6:9K;7:A0;8:9E;9:88;A:6E;B:77;C:6J;a9Ub8Lc7Kd6Xe6Rf6Dg5Vh58i54j4Pk45l3Nm2Rn2Eo26p1Nquispe,r17s0Ft05vVwOxNyGzD;aytsADhD;aDou,u;ng,o;aGeun7ZiDoshiA9un;!lD;diDmaz;rim,z;maDng;da,guc97mo6UsDzaB;aBhiA7;iao,u;aHeGiEoDright,u;jc8Sng;lDmm0nkl0sniewsB;liA1s3;b0iss,lt0;a5Rgn0lDng,tanabe;k0sh;aHeGiEoDukA;lk5roby5;dAllalDnogr2Zr0Zss0val37;ba,obos;lasEsel7N;lGn dFrg8EsEzD;qu7;ily9Oqu7silj9O;en b35ijk,yk;enzue95verde;aLeix1JhHi4j6ka3IoGrFsui,uD;om4ZrD;c4n0un1;an,embl8TynisB;dor95lst31m2rr9th;at5Mi7LoD;mErD;are6Ylaci64;ps3s0Y;hirAkah8Dnaka;a00chWeThPiNmKoItFuEvDzabo;en8Aobod34;ar7bot2lliv4zuB;aEein0oD;i67j3Lyan8V;l6rm0;kol5lovy5re6Psa,to,uD;ng,sa;iDy5Z;rn5tD;!h;l5YmDngh,rbu;mo6Do6J;aFeDimizu;hu,vchD;en7Cuk;la,r17;gu8mDoh,pulve8Trra4R;jDyD;on5;evi6Filtz,miDneid0roed0ulz,warz;dEtD;!z;!t;ar42h6ito,lFnDr2saBto,v2;ch7d0AtDz;a4Pe,os;as,ihAm3Zo0Q;aOeNiKoGuEyD;a66oo,u;bio,iz,sD;so,u;bEc7Bdrigue57g03j73mDosevelt,ssi,ta7Nux,w3Z;a4Be0O;ertsDins3;!on;bei0LcEes,vDzzo;as,e8;ci,hards3;ag4es,it0ut0y9;dFmEnDsmu7Zv5F;tan1;ir7os;ic,u;aSeLhJiGoErDut6;asad,if5Zochazk1W;lishc24pDrti62u55we66;e2Tov48;cEe09nD;as,to;as60hl0;aDillips;k,m,n5K;de3AetIna,rGtD;ersErovDtersC;!a,ic;en,on;eDic,ry,ss3;i8ra,tz,z;ers;h71k,rk0tEvD;ic,l3T;el,t2O;bJconnor,g2ClGnei5PrEzD;demir,turk;ella3MtDwe5N;ega,iz;iDof6GsC;vDyn1F;ei8;aPri1;aLeJguy1iFoDune44ym4;rodahl,vDwak;ak3Uik5otn56;eEkolDlsCx3;ic,ov6X;ls1miD;!n1;ils3mD;co42ec;gy,kaEray4varD;ro;jiDmu8shiD;ma;aXcVeQiPoIuD;lGnFrDssoli5T;atDpUr68;i,ov2;oz,te4B;d0l0;h4lIo0HrEsDza0Z;er,s;aFeEiDoz5r3Ete4B;!n6F;au,i8no,t4M;!l9;i2Rl0;crac5Ohhail5kke3Qll0;hmeGij0j2ElFndErci0ssiDyer19;!er;e3Bo2Z;n0Io;dAti;cartDlaughl6;hy;dMe6Dgnu5Ei0jer34kLmJnci59rFtEyD;er,r;ei,ic,su1N;iEkAqu9roqu6tinD;ez,s;a54c,nD;!o;a52mD;ad5;e5Oin1;rig4Ns1;aSeMiIoGuEyD;!nch;k2nDo;d,gu;mbarDpe2Rvr2;di;!nDu,yana1R;coln,dD;bDholm;erg;bed5TfeGhtFitn0kaEn6rDw2G;oy;!j;in1on1;bvDvD;re;iDmmy,rsCu,voie;ne,t11;aTennedy,h4iSlQnez46oJrGuEvar4woD;k,n;cerDmar58znets5;a,o2G;aDem0i2Zyeziu;sni3PvD;ch3U;bay4Frh0Jsk0TvaFwalDzl5;czDsB;yk;cFlD;!cDen3Q;huk;!ev2ic,s;e6uiveD;rt;eff0l2mu8nnun1;hn,lloe,minsBrEstra31to,ur,yDzl5;a,s0;j0GlsC;aMenLha2Pim0QoEuD;ng,r2;e2JhFnErge2Ju2NvD;anA;es,ss3;anEnsD;en,on,t3;nesDsC;en,s1;ki26s1;cGkob3RnsDrv06;en,sD;enDon;!s;ks3obs1;brahimAglesi3Ake4Ll0CnoZoneFshikEto,vanoD;u,v4A;awa;scu;aPeIitchcock,jaltal6oFrist46uD;!aDb0gh9ynh;m4ng;a23dz2fEjga2Sk,rDx3B;ak0Yvat;er,fm3B;iGmingw3NnErD;nand7re8;dDriks1;ers3;kkiEnD;on1;la,n1;dz2g1lvoLmJnsCqIrr0SsFuEyD;as36es;g1ng;anEhiD;mo0Q;i,ov08;ue;alaD;in1;rs1;aMeorgLheorghe,iJjonIoGrEuDw3;o,staf2Utierr7zm4;ayDg2iffitUub0;li1G;lub3Rme0JnD;calv9zale0I;aj,i;l,mDordaL;en7;iev3B;gnJlGmaFnd2No,rDs2Nuthi0;cDza;ia;ge;eaElD;agh0i,o;no;e,on;ab0erMiIjeldsted,lor9oGrFuD;cDent9ji3F;hs;an1Wiedm4;ntaDrt6st0urni0;na;lipEsD;ch0;ovD;!ic;hatAnandeVrD;arDei8;a,i;ov2;dHinste6riksCsDva0D;cob2ZpDtra2X;inoDosiM;za;en,s3;er,is3wards;aUeMiKjurhuJoHrisco0YuEvorakD;!oQ;arte,boEmitru,rDt2U;and,ic;is;g4he0Hmingu7n2Ord19tD;to;us;aDmitr29ssanayake;s,z; GbnaFlEmirDrvis1Lvi,w4;!ov2;gado,ic;th;bo0groot,jo03lEsilDvri9;va;a cruz,e3uD;ca;hl,mcevsBnErw6t2EviD;d5es,s;ieDku1S;ls1;ki;a05e00hNiobMlarkLoFrD;ivDuz;elli;h1lGntFop0rDs26x;byn,reD;a,ia;i,rer0O;em4liD;ns;!e;anu;aLeIiu,oGriDuJwe;stD;eDiaD;ns1;i,ng,uFwDy;!dhury;!n,onEuD;ng;!g;kEnDtterjee,v7;!d,g;ma,raboD;rty;bGl09ng2rD;eghetEnD;a,y;ti;an,ota0M;cer9lder3mpbeIrFstDvadi08;iDro;llo;doEt0uDvalho;so;so,zo;ll;es;a09eXhUiSlNoGrFyD;rne,tyD;qi;ank5iem,ooks,yant;gdan5nFruya,su,uchEyHziD;c,n5;ard;darDik;enD;ko;ov;aEondD;al;nEzD;ev2;co;ancRshwD;as;a01oDuiy4;umDwmD;ik;ckNethov1gu,ktLnJrD;gGisFnD;ascoDds1;ni;ha;er,mD;ann;gtDit7nett;ss3;asD;hi;er,ham;b2ch,ez,hMiley,kk0nHrDu0;bEnDua;es,i0;ieDosa;ri;dDik;a8yopadhyD;ay;ra;er;k,ng;ic;cosZdYguilXkhtXlSnJrGsl4yD;aEd6;in;la;aEsl4;an;ujo,ya;dFgelD;ovD;!a;ersGov,reD;aDjL;ss1;en;en,on,s3;on;eksejGiyGmeiFvD;ar7es;ez;da;ev;ar;ams;ta",WeekDay:"true\xA6fri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"true\xA6aBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il",Date:"true\xA6ago,t2week0yesterd4; e0e0;nd;mr2o0;d0morrow;ay;!w",FirstName:"true\xA6aKblair,cGdevFgabrieEhinaDjBk8l7m3nelly,quinn,re2sh0;ay,e0iloh;a,lby;g6ne;a1el0ina,org5;!okuh9;naia,r0;ion,lo;ashawn,uca;asCe1ir0rE;an;lsAnyat2rry;am0ess6ie,ude;ie,m5;ta;le;an,on;as2h0;arl0eyenne;ie;ey,sidy;lex2ndr1ubr0;ey;a,ea;is",Person:"true\xA6ashton kutchTbScNdLeJgastOhHinez,jFkEleDmCnettKoBp9r4s3t2v0;a0irgin maH;lentino rossi,n go3;aylor,heresa may,iger woods,yra banks;addam hussain,carlett johanssKlobodan milosevic,uC;ay romano,e3o1ush limbau0;gh;d stewart,nald0;inho,o;ese witherspoFilly;a0ipJ;lmIris hiltD;prah winfrFra;essiaen,itt romnEubarek;bron james,e;anye west,iefer sutherland,obe bryant;aime,effers8k rowli0;ng;alle ber0itlBulk hogan;ry;ff0meril lagasse,zekiel;ie;a0enzel washingt2ick wolf;lt1nte;ar1lint0;on;dinal wols1son0;! palm2;ey;arack obama,rock;er",Verb:"true\xA6awak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en",PhrasalVerb:"true\xA60:7L;1:79;2:7X;3:7N;4:72;5:80;6:7P;7:6V;8:78;9:7J;A:6W;B:5Z;C:7S;D:7K;a81b6Lc5Rd5Me5Lf4Kg41h3Kiron0j3Gk3Bl2Vm2Jn2Ho2Fp1Wquiet7Ar1Js0CtSuQvacuum 1wHyammer9zE;eroBip FonE;e0k0;by,up;aLeHhGiForErit5G;d 1k33;mp0n2Vpe0r7s7;eel Dip 85;aFiEn2J;gh 09rd0;n Dr E;d2in,o5J;it 61k7lk6rm 6Csh 7Nt6Qv51;rge9sE;e AherB;aTeRhPiLoJrGuEype 69;ckBrn E;d2in,o3Sup;aFiEot0y 2I;ckle6Rp 7T;ck6Qde Y;ne6Pp Es4O;d2o73up;ck GdFe Egh6Bme0p o0Gre0;aw3ba4d2in,up;e 61y 1;by,o7D;ink Erow 6D;ba4ov8up;aEe 5Zll53;m 1r X;ck9ke Flk E;ov8u54;aEba4d2in,o3Cup;ba4ft8p59w3;a0Jc0Ie0Ch08i05l01m00nZoYpTquare StKuIwE;earGiE;ngFtch E;aw3ba4o77; by;ck Eit 1m 1ss0;in,up;aJe0WiIoGrEuc3G;aigh1WiE;ke 6Gn3A;p Erm1Z;by,in,o6T;n3Br 1tc3T;c3Amp0nd Er6Zve6y 1;ba4d2up;d2o6Pup;ar37eHiGlFrEur9;ing9uc7;a3Fit 5B;l13n 1;e5Sll0;be2Wrt0;ap 4Sow D;ash 5Foke0;eep FiEow A;c3Wp 1;in,oE;ff,v8;gn 4XngFt Ez7;d2o5up; al54le0;aGoEu4T;ot Eut0w 6D;aw3ba4f3Go67;c2PdeBk58ve6;e Ill1And HtE; Etl4H;d2in,o5upE;!on;aw3ba4d2in,o27up;o5Mto;al51out0rap51;il6v7;aPeMiLoHuE;b 4Ule0n Estl7;aEba4d2in5Jo3Ut39u3S;c26w3;ll Got FuE;g2Tnd6;a27f30o5;arCin,o5;ng 53p6;aEel6inBnt0;c5Dd E;o31u0I;c24t0;aSeRiPlNoLrIsyc2HuE;ll Gt E;aEba4d2in,o1Ot3Gup;p3Lw3;ap3Kd2in,o5t3Eup;attle9ess FiHoE;p 1;ah1Oon;iEp 5Hr3Yur4Jwer 5H;nt0;ay4DuE;gBmp A;ck Eg0le9n Ap4A;o2Yup;el 4KncilB;c42ir 3Un0ss GtFy E;ba4o54; d2c24;aw3ba4o18;pEw3X;e3Wt D;arrow46erd0oE;d6te45;aMeJiIoGuE;ddl7lE;l 3I;c1Dp 1uth6ve E;al3Nd2in,o5up;ss0x 1;asur7lFss E;a1Gup;t A;ke Fn ArEs1Px0;k Ary6;do,o48up;aRePiKoEuck0;aIc3Hg HoEse0;k Ese3F;aft8ba4d2forw2Jin46ov8uE;nd8p;in,o0M;d A;e HghtGnFsEv1V;ten 4M;e 1k 1; 1e37;arCd2;av1Jt 37velE; o3U;c7p 1sh Etch9ugh6y20;in3Uo5;eFick6nock E;d2o3Q;eEyB;l 2Pp E;aw3ba4d2fTin,o07to,up;aGoFuE;ic7mpB;ke31t35;c3Azz 1;aQeLiIoFuE;nker32rry 1s0W;lEneBrse2X;d Ee 1;ba4d2fast,o01up;de Ft E;ba4on,up;aw3o5;aElp0;d Gl 2Ar Et 1;fEof;rom;in,oTu1H;c02m 1nFve Ez25;it,to;d Eg 2FkerG;d2in,o5;aTeMive Kloss 22oGrFunE; f0N;in3How 2B; Eof 21;aFb1Dit,oErCt0Pu18;ff,n,v8;bo5ft8hKw3;aw3ba4d2in,oEup,w3;ff,n,ut;aJek0t E;aFb17d2oErCup;ff,n,ut,v8;cFhEl1XrCt,w3;ead;ross;r 1;d aFnE;g 1;bo5;a08e01iSlOoKrGuE;cEel 1;k 1;eFighten Eown9y 1;aw3o2S;eEshe1N; 1z7;lGol E;aEwi1G;bo5rC;d Alow 1;aFeEip0;sh0;g Ake0mErE;e 2R;gLlJnHrFsEzzle0;h 2P;e Em 1;aw3ba4up;d0isE;h 1;e El 19;aw3fJ;ht ba4ure0;eJnFsE;s 1;cGd E;fEo25;or;e D;dVl 1;cIll Erm0t0W;ap04bGd2in,oFtE;hrough;ff,ut,v8;a4ehi20;e 0L;at0dge0nd 0Ky7;oHrE;aFess Aop E;aw3bUin,o1E;g9w9; 0Dubl7;aXhUlean AoHrEut 10;ack9eep Eoss D;by,d2oEup;n,ut;me HoFuntE; o1Q;k 1l E;d2o1I;aKbJforHin,oGtFuE;nd8;ogeth8;ut,v8;th,wE;ard;a4y;pErCw3;art;eEipB;ck Der E;on,up;lKncel0rHsGtch FveB; in;o19up;h Dt6;ry FvE;e Y;aw3o15;l Em05;aEba4d2o13up;rCw3;a0Ke0Bl04oVrJuE;bblGcklWil02lk AndlWrn 08st FtEy 13zz6;t D;in,o5up;e E;ov8;anOeaMiFush E;o0Oup;ghIng E;aFba4d2forEin,o5up;th;bo5lErCw3;ong;teE;n 1;k E;d2in,o5up;ch0;arLgKil An7oHssGttlFunce Ex D;aw3ba4;e A; arC;k Dt 1;e 1;d2up; d2;d 1;aJeed0oEurt0;cGw E;aw3ba4d2o5up;ck;k E;in,oL;ck0nk0st6; oKaHef 1nd E;d2ov8up;er;up;r0t E;d2in,oEup;ff,ut;ff,nE;to;ck Kil0nGrgFsE;h D;ain9e D;g Dk9; on;in,o5; o5;aw3d2o5up;ay;cNdJsk Guction6; oE;ff;arCo5;ouE;nd;d E;d2oEup;ff,n;own;t E;o5up;ut",Modal:"true\xA6c5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ay,ight,ust;an,o0;uld",Adjective:"true\xA60:7P;1:84;2:83;3:8A;4:7W;5:5S;6:4N;7:4O;8:58;9:6I;A:81;a6Wb6Gc63d5Je54f4Hg49h3Wi39j37k36l2Vm2Ln2Bo1Wp1Dquack,r12s0Ft07uMvJwByear5;arp0eFholeEiDoB;man5oBu6P;d6Rzy;despr7Ls5S;!sa7;eClBste2A;co1Nl o4W;!k5;aCiBola4M;b89ce versa,ol5H;ca3gabo6Gnilla;ltUnHpCrb5Msu4tterB;!mo7G; Eb1SpDsBti1M;ca7etBide dKtairs;!ti2;er,i3U;f36to da1;aLbeco75convin29deIeHfair,ivers4knGprecedVrEsCwB;iel3Nritt6A;i1XuB;pervis0spec3Y;eBu5;cognHgul6Tl6T;own;ndi2v64xpect0;cid0rB;!grou5ZsB;iz0tood;b7pp0Dssu6UuthorB;iz0;i26ra;aGeEhDi6AoCrB;i1oubl0us3M;geth8p,rp6Vuc67;ough4Wril33;en60l32mpBrr2X;o6Ati2;boo,lBn;ent0;aWcVeThSiQmug,nobbi3LoOpNqueami3LtFuBymb6H;bDi gener5DpBrpri6D;erBre0N;! dup8b,i2C;du0seq52;anda77eGiFrBunni2y3F;aightCiB;ki2p0; fBfB;or5K;ll,r5S;aBreotyp0;dfa6Cmi2;a55ec2Gir1Hlend6Cot on; call0le,mb8phist1XrBu0Vvi48;d6Ary;gnifica3nB;ce51g7;am2Re8ocki2ut;cBda1em5lfi32ni1Wpa6Jre6;o1Er42;at5Gient28reec5G;cr0me;aJeEiCoB;bu60tt51uQy4;ghtBv4;!-2Bf9;ar,bel,condi1du6Dfres5AlEpublic42sCtard0vB;ea26;is4CoB;lu1na3;aQe1Cuc4A;b5TciBllyi2;al,st;aOeLicayu6lac5Ropuli5QrCuB;bl5Jmp0n51;eGiDoB;!b07fu5RmiBp8;ne3si2;mCor,sBva1;ti6;a53e;ci5MmB;a0EiB;er,um;ac20rBti1;feAma2XpleBv38;xi2;rBst;allelDtB;-tiBi4;me;!ed;bLffJkIld fashion0nHpGrg1Eth8utFvB;al,erB;!all,niCt,wB;eiBrouB;ght;do0Ter,g2Qsi4B;en,posi1; boa5Og2Oli6;!ay; gua5MbBli6;eat;eDsB;cBer0Eole1;e6u3O;d2Xse;aJeIiHoBua4X;nFrCtB;ab7;thB;!eB;rn;chala3descri58stop;ght5;arby,cessa44ighbor5xt;k0usia1A;aIeGiDoBultip7;bi7derBl0Vnth5ot,st;a1n;nBx0;dblo0RiaBor;tu37;ande3Qdi4NnaBre;ci2;cBgenta,in,j01keshift,le,mmoth,ny,sculi6;ab33ho;aKeFiCoBu15;uti14vi2;mCteraB;l,te;it0;ftEgBth4;al,eCitiB;ma1;nda3K;!-0C;ngu3Zst,tt8;ap1Xind5no0A;agg0uB;niMstifi0veni7;de4gno4Klleg4mQnEpso 20rB;a1rB;eleBita0J;va3; KaJbr0corIdGfluenQiQnFsEtCviB;go0Fti2;aAen3SoxB;ic3B;a6i2Vul0D;a1er,oce3;iCoB;or;reA;deq3Qppr33;fBsitu,vitro;ro3;mFpB;arDerfeAoBrop8;li1rtB;a3ed;ti4;eBi0S;d2Vn3C;aIeFiDoBumdr3I;ne36ok0rrBs08ur5;if2Z;ghfalut1QspB;an2X;aClB;liYpf9;li2;lEnDrB;d04roB;wi2;dy;f,low0;ainf9ener2Oiga24lHoGraDuB;ilBng ho;ty;cCtB;ef9is;ef9;ne,od;ea2Iob4;aTeNinMlKoFrB;a1VeDoz1MustB;raB;ti2;e2Gq10tf9;oDrB; keeps,eBm8tuna1;g03ign;liB;sh;aBue3;g31tte1P;al,i1;dFmCrB;ti7;a7ini6;ne;le; up;bl0i3l27r Cux,voB;ri1uri1;oBreac1E;ff;aLfficie3lKmHnFreAthere4veExB;aAcess,pe1QtraCuB;be2Nl0E;!va1E;n,ryday; BcouraEti0O;rou1sui1;erCiB;ne3;gi2;abo23dMe17i1;g8sB;t,ygB;oi2;er;aReJiDoBrea14ue;mina3ne,ubB;le,tf9;dact1Bfficu1OsCvB;er1K;creDeas0gruntl0hone1FordCtB;a3ressM;er5;et; HadpGfFgene1PliDrang0spe1PtCvoB;ut;ail0ermin0;be1Mca1ghB;tf9;ia3;an;facto;i5magBngeroUs0G;ed,i2;ly;ertaMhief,ivil,oDrB;aBowd0u0G;mp0vZz0;loImGnCrrBve0P;eAu1I;cre1fu0LgrDsCtB;empo0Dra0E;ta3;ue3;mer08pleB;te,x;ni4ss4;in;aNeIizarHlFoCrB;and new,isk,okN;gCna fiUttom,urgeoB;is;us;ank,indB;!i2;re;autif9hiDloCnBst,yoD;eUt;v0w;nd;ul;ckCnkru0WrrB;en;!wards; priori,b0Mc0Jd09fra08g04h03lYmWntiquVppSrMsIttracti06utheHvEwB;aCkB;wa0T;ke,re;ant garCerB;age;de;ntU;leep,piDsuDtonB;isB;hi2;ri2;ab,bitEroDtiB;fiB;ci4;ga3;raB;ry;are3etiNrB;oprB;ia1;at0;aJuB;si2;arEcohCeBiIl,oof;rt;olB;ic;mi2;ead;ainDgressiConiB;zi2;ve;st;id; IeGuFvB;aCerB;se;nc0;ed;lt;pt,qB;ua1;hoc,infinitB;um;cuCtu4u1;al;ra1;erLlKoIruHsCuB;nda3;e3oCtraA;ct;lu1rbi2;ng;te;pt;aBve;rd;aze,e;ra3;nt",Comparable:"true\xA60:41;1:4I;2:45;3:2Y;4:4B;5:3X;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Jm1Dn17o15p0Vqu0Tr0KsTtMuIvFw7y6za13;ell27ou4;aBe9hi1Yi7r6;o4y;ck0Ode,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sK;m,y;a7e6ulgar;nge5rda2xi4;g9in,st;g0n6pco3Mse5;like0t6;i1r6;ue;aAen9hi8i7ough,r6;anqu2Oen1ue;dy,g3Sme0ny,r09;ck,n,rs2P;d40se;ll,me,rt,s6wd45;te5;aVcarUeThRiQkin0FlMmKoHpGqua1FtAu7w6;eet,ift;b7dd13per0Gr6;e,re2H;sta2Ft3;aAe9iff,r7u6;pXr1;a6ict,o4;ig3Fn0U;a1ep,rn;le,rk;e22i3Fright0;ci28ft,l7o6re,ur;n,thi4;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g35m6;!y;ek,nd3D;ck,l0mp3;a6iTort,rill,y;dy,ll0Xrp;cu0Rve0Rxy;ce,ed,y;d,fe,int0l1Vv14;aBe9i8o6ude;mantic,o1Isy,u6;gh,nd;ch,pe,tzy;a6d,mo0H;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aEhoDi1QlCoBr8u6;ny,r6;e,p3;egna2ic7o6;fouYud;ey,k0;li04or,te1B;ain,easa2;ny;in5le;dd,f6i0ld,ranQ;fi10;aAe8i7o6;b3isy,rm15sy;ce,mb3;a6w;r,t;ive,rr01;aAe8ild,o7u6;nda19te;ist,o1;a6ek,llX;n,s0ty;d,tuQ;aBeAi9o6ucky;f0Un7o1Du6ve0w17y0T;d,sy;e0g;g1Tke0tt3ve0;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti4;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b3id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te5;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t3uiY;u1y;aIeeb3iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get5mG;my;erce8n6rm;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi4;gey,lm8r6;e5i4;ful;!i4;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i4;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd",TextOrdinal:"true\xA6bGeDf9hundredHmGnin7qu6s4t0zeroH;enGh1rFwe0;lfFn9;ir0ousandE;d,t4;e0ixt9;cond,ptAvent8xtA;adr9int9;et0th;e6ie8;i2o0;r0urt3;tie5;ft1rst;ight0lev1;e0h,ie2;en1;illion0;th",Cardinal:"true\xA6bHeEf8hundred,mHnineAone,qu6s4t0zero;en,h2rGw0;e0o;lve,n8;irt9ousandEree;e0ix5;pt1ven4xt1;adr0int0;illion;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illion0;!s",Expression:"true\xA6a02b01dXeVfuck,gShLlImHnGoDpBshAtsk,u7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la",Adverb:"true\xA6a08by 06d02eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,well,ye0;p,s; to,wards5;h1iny bit,o0wiO;o,t6ward;en,us;everal,o0uch;!me1rt0; of;hYtimes,w09;a1e0;alT;ndomSthN;ar excellDer0oint blank; Nhaps;f3n0;ce0ly;! 0;ag02moW; courIten;ewKo0; longEt 0;onIwithstanding;aybe,eanwhiAore0;!ovB;! aboU;deed,steV;en0;ce;or2u0;lArther0;!moJ; 0ev3;examp0good,suH;le;n1v0;er; mas0ough;se;e0irect1; 1finite0;ly;ju8trop;far,n0;ow; DbroCd nauseam,gBl6ny3part,s2t 0w4;be6l0mo6wor6;arge,ea5; soon,ide;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori",Determiner:"true\xA6aAboth,d8e5few,l3mu7neiCown,plenty,some,th2various,wh0;at0ich0;evB;at,e3is,ose;a,e0;!ast,s;a1i6l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er"},py="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",Bp=py.split("").reduce(function(o,t,e){return o[t]=e,o},{}),bo=function(o){if(Bp[o]!==void 0)return Bp[o];let t=0,e=1,n=36,r=1;for(;e<o.length;t+=n,e++,n*=36);for(let a=o.length-1;a>=0;a--,r*=36){let i=o.charCodeAt(a)-48;i>10&&(i-=7),t+=i*r}return t},my=function(o,t,e){let n=bo(t);return n<o.symCount?o.syms[n]:e+n+1-o.symCount},fy=function(o){let t={nodes:o.split(";"),syms:[],symCount:0};return o.match(":")&&function(e){let n=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let r=0;r<e.nodes.length;r++){let a=n.exec(e.nodes[r]);if(!a){e.symCount=r;break}e.syms[bo(a[1])]=bo(a[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)}(t),function(e){let n=[],r=(a,i)=>{let s=e.nodes[a];s[0]==="!"&&(n.push(i),s=s.slice(1));let l=s.split(/([A-Z0-9,]+)/g);for(let u=0;u<l.length;u+=2){let c=l[u],d=l[u+1];if(!c)continue;let p=i+c;if(d===","||d===void 0){n.push(p);continue}let m=my(e,d,a);r(m,p)}};return r(0,""),n}(t)},hy=function(o){let t=o.split("|").reduce((n,r)=>{let a=r.split("\xA6");return n[a[0]]=a[1],n},{}),e={};return Object.keys(t).forEach(function(n){let r=fy(t[n]);n==="true"&&(n=!0);for(let a=0;a<r.length;a++){let i=r[a];e.hasOwnProperty(i)===!0?Array.isArray(e[i])===!1?e[i]=[e[i],n]:e[i].push(n):e[i]=n}}),e},by={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",her:["Possessive","Pronoun"],his:["Possessive","Pronoun"],their:["Possessive","Pronoun"],themselves:["Possessive","Pronoun"],your:["Possessive","Pronoun"],our:["Possessive","Pronoun"],my:["Possessive","Pronoun"],its:["Possessive","Pronoun"]},Fp={Unit:(o,t)=>{o[t]=["Abbreviation","Unit"]},Cardinal:(o,t)=>{o[t]=["TextValue","Cardinal"]},TextOrdinal:(o,t)=>{o[t]=["Ordinal","TextValue"],o[t+"s"]=["TextValue","Fraction"]},Singular:(o,t,e)=>{o[t]="Singular";let n=e.transforms.toPlural(t,e);o[n]=o[n]||"Plural"},Infinitive:(o,t,e)=>{o[t]="Infinitive";let n=e.transforms.conjugate(t,e),r=Object.keys(n);for(let a=0;a<r.length;a++){let i=n[r[a]];o[i]=o[i]||r[a]}},Comparable:(o,t,e)=>{o[t]="Comparable";let n=e.transforms.adjectives(t),r=Object.keys(n);for(let a=0;a<r.length;a++){let i=n[r[a]];o[i]=o[i]||r[a]}},PhrasalVerb:(o,t,e)=>{o[t]=["PhrasalVerb","Infinitive"];let n=t.split(" "),r=e.transforms.conjugate(n[0],e),a=Object.keys(r);for(let i=0;i<a.length;i++){let s=r[a[i]]+" "+n[1];o[s]=o[s]||["PhrasalVerb",a[i]],e.hasCompound[r[a[i]]]=!0}},Demonym:(o,t,e)=>{o[t]="Demonym";let n=e.transforms.toPlural(t,e);o[n]=o[n]||["Demonym","Plural"]}},Lp=function(o,t,e){Object.keys(o).forEach(n=>{let r=o[n];r!=="Abbreviation"&&r!=="Unit"||(e.cache.abbreviations[n]=!0);let a=n.split(" ");a.length>1&&(e.hasCompound[a[0]]=!0),Fp[r]===void 0?t[n]!==void 0?(typeof t[n]=="string"&&(t[n]=[t[n]]),typeof r=="string"?t[n].push(r):t[n]=t[n].concat(r)):t[n]=r:Fp[r](t,n,e)})},yy=function(o){let t=Object.assign({},by);return Object.keys(Rp).forEach(e=>{let n=hy(Rp[e]);Object.keys(n).forEach(r=>{n[r]=e}),Lp(n,t,o)}),t},gy=Lp,vy=function(o){let t=o.irregulars.nouns,e=Object.keys(t);for(let a=0;a<e.length;a++){let i=e[a];o.words[i]="Singular",o.words[t[i]]="Plural"}let n=o.irregulars.verbs,r=Object.keys(n);for(let a=0;a<r.length;a++){let i=r[a];o.words[i]=o.words[i]||"Infinitive";let s=o.transforms.conjugate(i,o);s=Object.assign(s,n[i]),Object.keys(s).forEach(l=>{o.words[s[l]]=o.words[s[l]]||l,o.words[s[l]]==="Participle"&&(o.words[s[l]]=l)})}},Cy={g:"Gerund",prt:"Participle",perf:"PerfectTense",pst:"PastTense",fut:"FuturePerfect",pres:"PresentTense",pluperf:"Pluperfect",a:"Actor"},Pn={act:{a:"_or"},ache:{pst:"ached",g:"aching"},age:{g:"ageing",pst:"aged",pres:"ages"},aim:{a:"_er",g:"_ing",pst:"_ed"},arise:{prt:"_n",pst:"arose"},babysit:{a:"_ter",pst:"babysat"},ban:{a:"",g:"_ning",pst:"_ned"},be:{a:"",g:"am",prt:"been",pst:"was",pres:"is"},beat:{a:"_er",g:"_ing",prt:"_en"},become:{prt:"_"},begin:{g:"_ning",prt:"begun",pst:"began"},being:{g:"are",pst:"were",pres:"are"},bend:{prt:"bent"},bet:{a:"_ter",prt:"_"},bind:{pst:"bound"},bite:{g:"biting",prt:"bitten",pst:"bit"},bleed:{pst:"bled",prt:"bled"},blow:{prt:"_n",pst:"blew"},boil:{a:"_er"},brake:{prt:"broken"},break:{pst:"broke"},breed:{pst:"bred"},bring:{pst:"brought",prt:"brought"},broadcast:{pst:"_"},budget:{pst:"_ed"},build:{pst:"built",prt:"built"},burn:{prt:"_ed"},burst:{prt:"_"},buy:{pst:"bought",prt:"bought"},can:{a:"",fut:"_",g:"",pst:"could",perf:"could",pluperf:"could",pres:"_"},catch:{pst:"caught"},choose:{g:"choosing",prt:"chosen",pst:"chose"},cling:{prt:"clung"},come:{prt:"_",pst:"came",g:"coming"},compete:{a:"competitor",g:"competing",pst:"_d"},cost:{pst:"_"},creep:{prt:"crept"},cut:{prt:"_"},deal:{pst:"_t",prt:"_t"},develop:{a:"_er",g:"_ing",pst:"_ed"},die:{g:"dying",pst:"_d"},dig:{g:"_ging",pst:"dug",prt:"dug"},dive:{prt:"_d"},do:{pst:"did",pres:"_es"},draw:{prt:"_n",pst:"drew"},dream:{prt:"_t"},drink:{prt:"drunk",pst:"drank"},drive:{g:"driving",prt:"_n",pst:"drove"},drop:{g:"_ping",pst:"_ped"},eat:{a:"_er",g:"_ing",prt:"_en",pst:"ate"},edit:{pst:"_ed",g:"_ing"},egg:{pst:"_ed"},fall:{prt:"_en",pst:"fell"},feed:{prt:"fed",pst:"fed"},feel:{a:"_er",pst:"felt"},fight:{pst:"fought",prt:"fought"},find:{pst:"found"},flee:{g:"_ing",prt:"fled"},fling:{prt:"flung"},fly:{prt:"flown",pst:"flew"},forbid:{pst:"forbade"},forget:{g:"_ing",prt:"forgotten",pst:"forgot"},forgive:{g:"forgiving",prt:"_n",pst:"forgave"},free:{a:"",g:"_ing"},freeze:{g:"freezing",prt:"frozen",pst:"froze"},get:{pst:"got",prt:"gotten"},give:{g:"giving",prt:"_n",pst:"gave"},go:{prt:"_ne",pst:"went",pres:"goes"},grow:{prt:"_n"},guide:{pst:"_d"},hang:{pst:"hung",prt:"hung"},have:{g:"having",pst:"had",prt:"had",pres:"has"},hear:{pst:"_d",prt:"_d"},hide:{prt:"hidden",pst:"hid"},hit:{prt:"_"},hold:{pst:"held",prt:"held"},hurt:{pst:"_",prt:"_"},ice:{g:"icing",pst:"_d"},imply:{pst:"implied",pres:"implies"},is:{a:"",g:"being",pst:"was",pres:"_"},keep:{prt:"kept"},kneel:{prt:"knelt"},know:{prt:"_n"},lay:{pst:"laid",prt:"laid"},lead:{pst:"led",prt:"led"},leap:{prt:"_t"},leave:{pst:"left",prt:"left"},lend:{prt:"lent"},lie:{g:"lying",pst:"lay"},light:{pst:"lit",prt:"lit"},log:{g:"_ging",pst:"_ged"},loose:{prt:"lost"},lose:{g:"losing",pst:"lost"},make:{pst:"made",prt:"made"},mean:{pst:"_t",prt:"_t"},meet:{a:"_er",g:"_ing",pst:"met",prt:"met"},miss:{pres:"_"},name:{g:"naming"},patrol:{g:"_ling",pst:"_led"},pay:{pst:"paid",prt:"paid"},prove:{prt:"_n"},puke:{g:"puking"},put:{prt:"_"},quit:{prt:"_"},read:{pst:"_",prt:"_"},ride:{prt:"ridden"},reside:{pst:"_d"},ring:{pst:"rang",prt:"rung"},rise:{fut:"will have _n",g:"rising",prt:"_n",pst:"rose",pluperf:"had _n"},rub:{g:"_bing",pst:"_bed"},run:{g:"_ning",prt:"_",pst:"ran"},say:{pst:"said",prt:"said",pres:"_s"},seat:{pst:"sat",prt:"sat"},see:{g:"_ing",prt:"_n",pst:"saw"},seek:{prt:"sought"},sell:{pst:"sold",prt:"sold"},send:{prt:"sent"},set:{prt:"_"},sew:{prt:"_n"},shake:{prt:"_n"},shave:{prt:"_d"},shed:{g:"_ding",pst:"_",pres:"_s"},shine:{pst:"shone",prt:"shone"},shoot:{pst:"shot",prt:"shot"},show:{pst:"_ed"},shut:{prt:"_"},sing:{prt:"sung",pst:"sang"},sink:{pst:"sank",pluperf:"had sunk"},sit:{pst:"sat"},ski:{pst:"_ied"},slay:{prt:"slain"},sleep:{prt:"slept"},slide:{pst:"slid",prt:"slid"},smash:{pres:"_es"},sneak:{prt:"snuck"},speak:{fut:"will have spoken",prt:"spoken",pst:"spoke",perf:"have spoken",pluperf:"had spoken"},speed:{prt:"sped"},spend:{prt:"spent"},spill:{prt:"_ed",pst:"spilt"},spin:{g:"_ning",pst:"spun",prt:"spun"},spit:{prt:"spat"},split:{prt:"_"},spread:{pst:"_"},spring:{prt:"sprung"},stand:{pst:"stood"},steal:{a:"_er",pst:"stole"},stick:{pst:"stuck"},sting:{pst:"stung"},stink:{pst:"stunk",prt:"stunk"},stream:{a:"_er"},strew:{prt:"_n"},strike:{g:"striking",pst:"struck"},suit:{a:"_er",g:"_ing",pst:"_ed"},sware:{prt:"sworn"},swear:{pst:"swore"},sweep:{prt:"swept"},swim:{g:"_ming",pst:"swam"},swing:{pst:"swung"},take:{fut:"will have _n",pst:"took",perf:"have _n",pluperf:"had _n"},teach:{pst:"taught",pres:"_es"},tear:{pst:"tore"},tell:{pst:"told"},think:{pst:"thought"},thrive:{prt:"_d"},tie:{g:"tying",pst:"_d"},undergo:{prt:"_ne"},understand:{pst:"understood"},upset:{prt:"_"},wait:{a:"_er",g:"_ing",pst:"_ed"},wake:{pst:"woke"},wear:{pst:"wore"},weave:{prt:"woven"},wed:{pst:"wed"},weep:{prt:"wept"},win:{g:"_ning",pst:"won"},wind:{prt:"wound"},withdraw:{pst:"withdrew"},wring:{prt:"wrung"},write:{g:"writing",prt:"written",pst:"wrote"}},Ep=Object.keys(Pn);for(let o=0;o<Ep.length;o++){let t=Ep[o],e={};Object.keys(Pn[t]).forEach(n=>{let r=Pn[t][n];r=r.replace("_",t),e[Cy[n]]=r}),Pn[t]=e}var Ny=Pn,Br={b:[{reg:/([^aeiou][aeiou])b$/i,repl:{pr:"$1bs",pa:"$1bbed",gr:"$1bbing"}}],d:[{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/([^aeiou][ou])d$/i,repl:{pr:"$1ds",pa:"$1dded",gr:"$1dding"}}],e:[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(t|sh?)(ake)$/i,repl:{pr:"$1$2s",pa:"$1ook",gr:"$1aking",ar:"$1$2r"}},{reg:/w(ake)$/i,repl:{pr:"w$1s",pa:"woke",gr:"waking",ar:"w$1r"}},{reg:/m(ake)$/i,repl:{pr:"m$1s",pa:"made",gr:"making",ar:"m$1r"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}}],g:[{reg:/([^aeiou][aou])g$/i,repl:{pr:"$1gs",pa:"$1gged",gr:"$1gging"}}],h:[{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}}],k:[{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}}],m:[{reg:/([^aeiou][aeiou])m$/i,repl:{pr:"$1ms",pa:"$1mmed",gr:"$1mming"}}],n:[{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],p:[{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/([^aeiou][aeiou])p$/i,repl:{pr:"$1ps",pa:"$1pped",gr:"$1pping"}},{reg:/([aeiu])p$/i,repl:{pr:"$1ps",pa:"$1p",gr:"$1pping"}}],r:[{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],s:[{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}],t:[{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])t$/i,repl:{pr:"$1ts",pa:"$1t",gr:"$1tting"}},{reg:/([^aeiou][aeiou])t$/i,repl:{pr:"$1ts",pa:"$1tted",gr:"$1tting"}}],w:[{reg:/(.llow)$/i,repl:{pr:"$1s",pa:"$1ed"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}}],y:[{reg:/(i|f|rr)y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}}],z:[{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},Ty={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},Vy=function(o,t){let e={},n=Object.keys(t.repl);for(let r=0;r<n.length;r+=1){let a=n[r];e[Ty[a]]=o.replace(t.reg,t.repl[a])}return e},xy=function(o=""){let t=o[o.length-1];if(Br.hasOwnProperty(t)===!0){for(let e=0;e<Br[t].length;e+=1)if(Br[t][e].reg.test(o)===!0)return Vy(o,Br[t][e])}return{}},Mp=/[bcdfghjklmnpqrstvwxz]y$/,yo={Gerund:o=>o.charAt(o.length-1)==="e"?o.replace(/e$/,"ing"):o+"ing",PresentTense:o=>o.charAt(o.length-1)==="s"?o+"es":Mp.test(o)===!0?o.slice(0,-1)+"ies":o+"s",PastTense:o=>o.charAt(o.length-1)==="e"?o+"d":o.substr(-2)==="ed"?o:Mp.test(o)===!0?o.slice(0,-1)+"ied":o+"ed"},wy=function(o="",t){let e={};return t&&t.irregulars&&t.irregulars.verbs.hasOwnProperty(o)===!0&&(e=Object.assign({},t.irregulars.verbs[o])),e=Object.assign({},xy(o),e),e.Gerund===void 0&&(e.Gerund=yo.Gerund(o)),e.PastTense===void 0&&(e.PastTense=yo.PastTense(o)),e.PresentTense===void 0&&(e.PresentTense=yo.PresentTense(o)),e},_p=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],$p=[/ary$/],zp={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},Fr=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}],Hp=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],jp=[/ary$/,/ous$/],qp={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},Lr=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}],Kp={toSuperlative:function(o){if(zp.hasOwnProperty(o))return zp[o];for(let t=0;t<Fr.length;t++)if(Fr[t].reg.test(o))return o.replace(Fr[t].reg,Fr[t].repl);for(let t=0;t<$p.length;t++)if($p[t].test(o)===!0)return null;for(let t=0;t<_p.length;t++)if(_p[t].test(o)===!0)return o.charAt(o.length-1)==="e"?o+"st":o+"est";return o+"est"},toComparative:function(o){if(qp.hasOwnProperty(o))return qp[o];for(let t=0;t<Lr.length;t++)if(Lr[t].reg.test(o)===!0)return o.replace(Lr[t].reg,Lr[t].repl);for(let t=0;t<jp.length;t++)if(jp[t].test(o)===!0)return null;for(let t=0;t<Hp.length;t++)if(Hp[t].test(o)===!0)return o+"er";return/e$/.test(o)===!0?o+"r":o+"er"}},Dy=function(o){let t={},e=Kp.toSuperlative(o);e&&(t.Superlative=e);let n=Kp.toComparative(o);return n&&(t.Comparative=n),t},Er={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/([ti])a$/i,"$1a"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},Ay=/(x|ch|sh|s|z)$/,Sy=function(o="",t){let e=t.irregulars.nouns;if(e.hasOwnProperty(o))return e[o];let n=function(r){let a=r[r.length-1];if(Er.hasOwnProperty(a)===!0)for(let i=0;i<Er[a].length;i+=1){let s=Er[a][i][0];if(s.test(r)===!0)return r.replace(s,Er[a][i][1])}return null}(o);return n!==null?n:Ay.test(o)?o+"es":o+"s"},Mr=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(eas)es$/i,"$1e"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]],Iy=function(o,t){let e=t.irregulars.nouns,n=(r=e,Object.keys(r).reduce((a,i)=>(a[r[i]]=i,a),{}));var r;if(n.hasOwnProperty(o))return n[o];for(let a=0;a<Mr.length;a++)if(Mr[a][0].test(o)===!0)return o=o.replace(Mr[a][0],Mr[a][1]);return o},go={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/(..)(p|d|t|g){2}ing$/i,to:"$1$2"},{reg:/(ll|ss|zz)ing$/i,to:"$1"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea[dklnrtv])ing$/i,to:"$1"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(z)ing$/i,to:"$1e"},{reg:/(a[gdkvtc])ing$/i,to:"$1e"},{reg:/(u[rtcbn])ing$/i,to:"$1e"},{reg:/([^o]o[bdknprv])ing$/i,to:"$1e"},{reg:/([tbckg]l)ing$/i,to:"$1e"},{reg:/(c|s)ing$/i,to:"$1e"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(dd)ed$/i,to:"$1"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([aeiou][^aeiou])ed$/i,to:"$1e"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]},_r={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"]};_r=Object.keys(_r).reduce((o,t)=>(_r[t].forEach(e=>o[e]=t),o),{});var $r=_r,Oy={nouns:{addendum:"addenda",alga:"algae",alumna:"alumnae",alumnus:"alumni",analysis:"analyses",antenna:"antennae",appendix:"appendices",avocado:"avocados",axis:"axes",bacillus:"bacilli",barracks:"barracks",beau:"beaux",bus:"buses",cactus:"cacti",chateau:"chateaux",child:"children",circus:"circuses",clothes:"clothes",corpus:"corpora",criterion:"criteria",curriculum:"curricula",database:"databases",deer:"deer",diagnosis:"diagnoses",echo:"echoes",embargo:"embargoes",epoch:"epochs",foot:"feet",formula:"formulae",fungus:"fungi",genus:"genera",goose:"geese",halo:"halos",hippopotamus:"hippopotami",index:"indices",larva:"larvae",leaf:"leaves",libretto:"libretti",loaf:"loaves",man:"men",matrix:"matrices",memorandum:"memoranda",modulus:"moduli",mosquito:"mosquitoes",mouse:"mice",nebula:"nebulae",nucleus:"nuclei",octopus:"octopi",opus:"opera",ovum:"ova",ox:"oxen",parenthesis:"parentheses",person:"people",phenomenon:"phenomena",prognosis:"prognoses",quiz:"quizzes",radius:"radii",referendum:"referenda",rodeo:"rodeos",sex:"sexes",shoe:"shoes",sombrero:"sombreros",stimulus:"stimuli",stomach:"stomachs",syllabus:"syllabi",synopsis:"synopses",tableau:"tableaux",thesis:"theses",thief:"thieves",tooth:"teeth",tornado:"tornados",tuxedo:"tuxedos",vertebra:"vertebrae"},verbs:Ny},ky={conjugate:wy,adjectives:Dy,toPlural:Sy,toSingular:Iy,toInfinitive:function(o,t,e){if(!o)return"";if(t.words.hasOwnProperty(o)===!0){let n=t.irregulars.verbs,r=Object.keys(n);for(let a=0;a<r.length;a++){let i=Object.keys(n[r[a]]);for(let s=0;s<i.length;s++)if(o===n[r[a]][i[s]])return r[a]}}if((e=e||function(n){let r=n.substr(n.length-3);if($r.hasOwnProperty(r)===!0)return $r[r];let a=n.substr(n.length-2);return $r.hasOwnProperty(a)===!0?$r[a]:n.substr(n.length-1)==="s"?"PresentTense":null}(o))&&go[e])for(let n=0;n<go[e].length;n++){let r=go[e][n];if(r.reg.test(o)===!0)return o.replace(r.reg,r.to)}return o}},Wp=!1,zr=class{constructor(){Object.defineProperty(this,"words",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"hasCompound",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"irregulars",{enumerable:!1,value:Oy,writable:!0}),Object.defineProperty(this,"tags",{enumerable:!1,value:Object.assign({},dy),writable:!0}),Object.defineProperty(this,"transforms",{enumerable:!1,value:ky,writable:!0}),Object.defineProperty(this,"taggers",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"cache",{enumerable:!1,value:{abbreviations:{}}}),this.words=yy(this),vy(this)}verbose(t){return Wp=t,this}isVerbose(){return Wp}addWords(t){let e={};Object.keys(t).forEach(n=>{let r=t[n];n=n.toLowerCase().trim(),e[n]=r}),gy(e,this.words,this)}addConjugations(t){return Object.assign(this.irregulars.verbs,t),this}addPlurals(t){return Object.assign(this.irregulars.nouns,t),this}addTags(t){return t=Object.assign({},t),this.tags=Object.assign(this.tags,t),this.tags=Pp(this.tags),this}postProcess(t){return this.taggers.push(t),this}stats(){return{words:Object.keys(this.words).length,plurals:Object.keys(this.irregulars.nouns).length,conjugations:Object.keys(this.irregulars.verbs).length,compounds:Object.keys(this.hasCompound).length,postProcessors:this.taggers.length}}},Up=function(o){return JSON.parse(JSON.stringify(o))};zr.prototype.clone=function(){let o=new zr;return o.words=Object.assign({},this.words),o.hasCompound=Object.assign({},this.hasCompound),o.irregulars=Up(this.irregulars),o.tags=Up(this.tags),o.transforms=this.transforms,o.taggers=this.taggers,o};var Py=zr,Ry=Ee(function(o,t){t.all=function(){return this.parents()[0]||this},t.parent=function(){return this.from?this.from:this},t.parents=function(e){let n=[],r=function(a){a.from&&(n.push(a.from),r(a.from))};return r(this),n=n.reverse(),typeof e=="number"?n[e]:n},t.clone=function(e){let n=this.list.map(r=>r.clone(e));return this.buildFrom(n)},t.wordCount=function(){return this.list.reduce((e,n)=>e+=n.wordCount(),0)},t.wordcount=t.wordCount}),By=Ee(function(o,t){t.first=function(e){return e===void 0?this.get(0):this.slice(0,e)},t.last=function(e){if(e===void 0)return this.get(this.list.length-1);let n=this.list.length;return this.slice(n-e,n)},t.slice=function(e,n){let r=this.list.slice(e,n);return this.buildFrom(r)},t.eq=function(e){let n=this.list[e];return n===void 0?this.buildFrom([]):this.buildFrom([n])},t.get=t.eq,t.firstTerms=function(){return this.match("^.")},t.firstTerm=t.firstTerms,t.lastTerms=function(){return this.match(".$")},t.lastTerm=t.lastTerms,t.termList=function(e){let n=[];for(let r=0;r<this.list.length;r++){let a=this.list[r].terms();for(let i=0;i<a.length;i++)if(n.push(a[i]),e!==void 0&&n[e]!==void 0)return n[e]}return n},t.groups=function(e){return e===void 0?function(n){let r={},a={};for(let s=0;s<n.list.length;s++){let l=n.list[s],u=Object.keys(l.groups).map(c=>l.groups[c]);for(let c=0;c<u.length;c++){let{group:d,start:p,length:m}=u[c];a[d]||(a[d]=[]),a[d].push(l.buildFrom(p,m))}}let i=Object.keys(a);for(let s=0;s<i.length;s++){let l=i[s];r[l]=n.buildFrom(a[l])}return r}(this):(typeof e=="number"&&(e=String(e)),function(n,r){let a=[];for(let i=0;i<n.list.length;i++){let s=n.list[i],l=Object.keys(s.groups);l=l.filter(u=>s.groups[u].group===r),l.forEach(u=>{a.push(s.buildFrom(s.groups[u].start,s.groups[u].length))})}return n.buildFrom(a)}(this,e)||this.buildFrom([]))},t.group=t.groups,t.sentences=function(e){let n=[];return this.list.forEach(r=>{n.push(r.fullSentence())}),typeof e=="number"?this.buildFrom([n[e]]):this.buildFrom(n)},t.sentence=t.sentences}),Rn=function(o,t){if(o._cache&&o._cache.set===!0){let{words:e,tags:n}=function(r){let a=[],i=[];return r.forEach(s=>{s.optional!==!0&&s.negative!==!0&&(s.tag!==void 0&&a.push(s.tag),s.word!==void 0&&i.push(s.word))}),{tags:a,words:i}}(t);for(let r=0;r<e.length;r++)if(o._cache.words[e[r]]===void 0)return!1;for(let r=0;r<n.length;r++)if(o._cache.tags[n[r]]===void 0)return!1}return!0},Fy=Ee(function(o,t){t.match=function(e,n={}){typeof n!="string"&&typeof n!="number"&&n!==null||(n={group:n});let r=Ve(e,n);if(r.length===0)return this.buildFrom([]);if(Rn(this,r)===!1)return this.buildFrom([]);let a=this.list.reduce((i,s)=>i.concat(s.match(r)),[]);return n.group!==void 0&&n.group!==null&&n.group!==""?this.buildFrom(a).groups(n.group):this.buildFrom(a)},t.not=function(e,n={}){let r=Ve(e,n);if(r.length===0||Rn(this,r)===!1)return this;let a=this.list.reduce((i,s)=>i.concat(s.not(r)),[]);return this.buildFrom(a)},t.matchOne=function(e,n={}){let r=Ve(e,n);if(Rn(this,r)===!1)return this.buildFrom([]);for(let a=0;a<this.list.length;a++){let i=this.list[a].match(r,!0);return this.buildFrom(i)}return this.buildFrom([])},t.if=function(e,n={}){let r=Ve(e,n);if(Rn(this,r)===!1)return this.buildFrom([]);let a=this.list.filter(i=>i.has(r)===!0);return this.buildFrom(a)},t.ifNo=function(e,n={}){let r=Ve(e,n),a=this.list.filter(i=>i.has(r)===!1);return this.buildFrom(a)},t.has=function(e,n={}){let r=Ve(e,n);return Rn(this,r)!==!1&&this.list.some(a=>a.has(r)===!0)},t.lookAhead=function(e,n={}){e||(e=".*");let r=Ve(e,n),a=[];return this.list.forEach(i=>{a=a.concat(i.lookAhead(r))}),a=a.filter(i=>i),this.buildFrom(a)},t.lookAfter=t.lookAhead,t.lookBehind=function(e,n={}){e||(e=".*");let r=Ve(e,n),a=[];return this.list.forEach(i=>{a=a.concat(i.lookBehind(r))}),a=a.filter(i=>i),this.buildFrom(a)},t.lookBefore=t.lookBehind,t.before=function(e,n={}){let r=Ve(e,n),a=this.if(r).list.map(i=>{let s=i.terms().map(c=>c.id),l=i.match(r)[0],u=s.indexOf(l.start);return u===0||u===-1?null:i.buildFrom(i.start,u)});return a=a.filter(i=>i!==null),this.buildFrom(a)},t.after=function(e,n={}){let r=Ve(e,n),a=this.if(r).list.map(i=>{let s=i.terms(),l=s.map(m=>m.id),u=i.match(r)[0],c=l.indexOf(u.start);if(c===-1||!s[c+u.length])return null;let d=s[c+u.length].id,p=i.length-c-u.length;return i.buildFrom(d,p)});return a=a.filter(i=>i!==null),this.buildFrom(a)},t.hasAfter=function(e,n={}){return this.filter(r=>r.lookAfter(e,n).found)},t.hasBefore=function(e,n={}){return this.filter(r=>r.lookBefore(e,n).found)}}),Gp=function(o,t,e,n){let r=[];typeof o=="string"&&(r=o.split(" ")),t.list.forEach(a=>{let i=a.terms();e===!0&&(i=i.filter(s=>s.canBe(o,t.world))),i.forEach((s,l)=>{r.length>1?r[l]&&r[l]!=="."&&s.tag(r[l],n,t.world):s.tag(o,n,t.world)})})},Ly={tag:function(o,t){return o?(Gp(o,this,!1,t),this):this},tagSafe:function(o,t){return o?(Gp(o,this,!0,t),this):this},unTag:function(o,t){return this.list.forEach(e=>{e.terms().forEach(n=>n.unTag(o,t,this.world))}),this},canBe:function(o){if(!o)return this;let t=this.world,e=this.list.reduce((n,r)=>n.concat(r.canBe(o,t)),[]);return this.buildFrom(e)}},Ey={map:function(o){if(!o)return this;let t=this.list.map((e,n)=>{let r=this.buildFrom([e]);r.from=null;let a=o(r,n);return a&&a.list&&a.list[0]?a.list[0]:a});return t=t.filter(e=>e),t.length===0?this.buildFrom(t):typeof t[0]!="object"||t[0].isA!=="Phrase"?t:this.buildFrom(t)},forEach:function(o,t){return o?(this.list.forEach((e,n)=>{let r=this.buildFrom([e]);t===!0&&(r.from=null),o(r,n)}),this):this},filter:function(o){if(!o)return this;let t=this.list.filter((e,n)=>{let r=this.buildFrom([e]);return r.from=null,o(r,n)});return this.buildFrom(t)},find:function(o){if(!o)return this;let t=this.list.find((e,n)=>{let r=this.buildFrom([e]);return r.from=null,o(r,n)});return t?this.buildFrom([t]):void 0},some:function(o){return o?this.list.some((t,e)=>{let n=this.buildFrom([t]);return n.from=null,o(n,e)}):this},random:function(o){if(!this.found)return this;let t=Math.floor(Math.random()*this.list.length);if(o===void 0){let e=[this.list[t]];return this.buildFrom(e)}return t+o>this.length&&(t=this.length-o,t=t<0?0:t),this.slice(t,t+o)}},My=function(o,t,e){let n=function(a,i=[]){let s={};return a.forEach((l,u)=>{let c=!0;i[u]!==void 0&&(c=i[u]);let d=function(p){return p.split(/[ -]/g)}(l=(l=(l||"").toLowerCase()).replace(/[,;.!?]+$/,"")).map(p=>p.trim());s[d[0]]=s[d[0]]||{},d.length===1?s[d[0]].value=c:(s[d[0]].more=s[d[0]].more||[],s[d[0]].more.push({rest:d.slice(1),value:c}))}),s}(o,t),r=[];for(let a=0;a<e.list.length;a++){let i=e.list[a],s=i.terms().map(l=>l.reduced);for(let l=0;l<s.length;l++)n[s[l]]!==void 0&&(n[s[l]].more!==void 0&&n[s[l]].more.forEach(u=>{s[l+u.rest.length]!==void 0&&u.rest.every((c,d)=>c===s[l+d+1])===!0&&r.push({id:i.terms()[l].id,value:u.value,length:u.rest.length+1})}),n[s[l]].value!==void 0&&r.push({id:i.terms()[l].id,value:n[s[l]].value,length:1}))}return r},_y=Ee(function(o,t){t.lookup=function(e){let n=[],r=(a=e)&&Object.prototype.toString.call(a)==="[object Object]";var a;r===!0&&(e=Object.keys(e).map(l=>(n.push(e[l]),l))),typeof e=="string"&&(e=[e]),this._cache.set!==!0&&this.cache();let i=My(e,n,this),s=this.list[0];if(r===!0){let l={};return i.forEach(u=>{l[u.value]=l[u.value]||[],l[u.value].push(s.buildFrom(u.id,u.length))}),Object.keys(l).forEach(u=>{l[u]=this.buildFrom(l[u])}),l}return i=i.map(l=>s.buildFrom(l.id,l.length)),this.buildFrom(i)},t.lookUp=t.lookup}),$y={cache:function(o){o=o||{};let t={},e={};return this._cache.words=t,this._cache.tags=e,this._cache.set=!0,this.list.forEach((n,r)=>{n.cache=n.cache||{},n.terms().forEach(a=>{t[a.reduced]&&!t.hasOwnProperty(a.reduced)||(t[a.reduced]=t[a.reduced]||[],t[a.reduced].push(r),Object.keys(a.tags).forEach(i=>{e[i]=e[i]||[],e[i].push(r)}),o.root&&(a.setRoot(this.world),t[a.root]=[r]))})}),this},uncache:function(){return this._cache={},this.list.forEach(o=>{o.cache={}}),this.parents().forEach(o=>{o._cache={},o.list.forEach(t=>{t.cache={}})}),this}},zy={replaceWith:function(o,t={}){return o?(t===!0&&(t={keepTags:!0}),t===!1&&(t={keepTags:!1}),t=t||{},this.uncache(),this.list.forEach(e=>{let n,r=o;if(typeof o=="function"&&(r=o(e)),r&&typeof r=="object"&&r.isA==="Doc")n=r.list,this.pool().merge(r.pool());else{if(typeof r!="string")return;{t.keepCase!==!1&&e.terms(0).isTitleCase()&&(r=(a=r).charAt(0).toUpperCase()+a.substr(1)),n=ot(r,this.world,this.pool());let i=this.buildFrom(n);i.tagger(),n=i.list}}var a;if(t.keepTags===!0){let i=e.json({terms:{tags:!0}}).terms;n[0].terms().forEach((s,l)=>{i[l]&&s.tagSafe(i[l].tags,"keptTag",this.world)})}e.replace(n[0],this)}),this):this.delete()},replace:function(o,t,e){return t===void 0?this.replaceWith(o,e):(this.match(o).replaceWith(t,e),this)}},Hy=Ee(function(o,t){let e=function(r){return r&&Object.prototype.toString.call(r)==="[object Object]"},n=function(r,a){let i=ot(r,a.world)[0],s=a.buildFrom([i]);return s.tagger(),a.list=s.list,a};t.append=function(r=""){return r?this.found?(this.uncache(),this.list.forEach(a=>{let i;e(r)&&r.isA==="Doc"?i=r.list[0].clone():typeof r=="string"&&(i=ot(r,this.world,this.pool())[0]),this.buildFrom([i]).tagger(),a.append(i,this)}),this):n(r,this):this},t.insertAfter=t.append,t.insertAt=t.append,t.prepend=function(r){return r?this.found?(this.uncache(),this.list.forEach(a=>{let i;e(r)&&r.isA==="Doc"?i=r.list[0].clone():typeof r=="string"&&(i=ot(r,this.world,this.pool())[0]),this.buildFrom([i]).tagger(),a.prepend(i,this)}),this):n(r,this):this},t.insertBefore=t.prepend,t.concat=function(){this.uncache();let r=this.list.slice(0);for(let a=0;a<arguments.length;a++){let i=arguments[a];if(typeof i=="string"){let s=ot(i,this.world);r=r.concat(s)}else i.isA==="Doc"?r=r.concat(i.list):i.isA==="Phrase"&&r.push(i)}return this.buildFrom(r)},t.delete=function(r){this.uncache();let a=this;return r&&(a=this.match(r)),a.list.forEach(i=>i.delete(this)),this},t.remove=t.delete}),jy={clean:!0,reduced:!0,root:!0},qy={text:function(o){o=o||{};let t=!1;this.parents().length===0&&(t=!0),(o==="root"||typeof o=="object"&&o.root)&&this.list.forEach(n=>{n.terms().forEach(r=>{r.root===null&&r.setRoot(this.world)})});let e=this.list.reduce((n,r,a)=>{let i=!t&&a===0,s=!t&&a===this.list.length-1;return n+r.text(o,i,s)},"");return jy[o]!==!0&&o.reduced!==!0&&o.clean!==!0&&o.root!==!0||(e=e.trim()),e}},Ky=function(o,t,e){let n=function(r){let a=0,i=0,s={};return r.termList().forEach(l=>{s[l.id]={index:i,start:a+l.pre.length,length:l.text.length},a+=l.pre.length+l.text.length+l.post.length,i+=1}),s}(o.all());(e.terms.index||e.index)&&t.forEach(r=>{r.terms.forEach(a=>{a.index=n[a.id].index}),r.index=r.terms[0].index}),(e.terms.offset||e.offset)&&t.forEach(r=>{r.terms.forEach(a=>{a.offset=n[a.id]||{}}),r.offset={index:r.terms[0].offset.index,start:r.terms[0].offset.start-r.text.indexOf(r.terms[0].text),length:r.text.length}})},Wy=Ee(function(o,t){let e={text:!0,terms:!0,trim:!0};t.json=function(n={}){if(typeof n=="number"&&this.list[n])return this.list[n].json(e);(n=function(a){return(a=Object.assign({},e,a)).unique&&(a.reduced=!0),a.offset&&(a.text=!0,a.terms&&a.terms!==!0||(a.terms={}),a.terms.offset=!0),(a.index||a.terms.index)&&(a.terms=a.terms===!0?{}:a.terms,a.terms.id=!0),a}(n)).root===!0&&this.list.forEach(a=>{a.terms().forEach(i=>{i.root===null&&i.setRoot(this.world)})});let r=this.list.map(a=>a.json(n,this.world));if((n.terms.offset||n.offset||n.terms.index||n.index)&&Ky(this,r,n),n.frequency||n.freq||n.count){let a={};this.list.forEach(i=>{let s=i.text("reduced");a[s]=a[s]||0,a[s]+=1}),this.list.forEach((i,s)=>{r[s].count=a[i.text("reduced")]})}if(n.unique){let a={};r=r.filter(i=>a[i.reduced]!==!0&&(a[i.reduced]=!0,!0))}return r},t.data=t.json}),Xp=Ee(function(o){let t="[0m",e=function(a,i){for(a=a.toString();a.length<i;)a+=" ";return a},n={green:"#7f9c6c",red:"#914045",blue:"#6699cc",magenta:"#6D5685",cyan:"#2D85A8",yellow:"#e6d7b3",black:"#303b50"},r={green:function(a){return"[32m"+a+t},red:function(a){return"[31m"+a+t},blue:function(a){return"[34m"+a+t},magenta:function(a){return"[35m"+a+t},cyan:function(a){return"[36m"+a+t},yellow:function(a){return"[33m"+a+t},black:function(a){return"[30m"+a+t}};o.exports=function(a){return typeof window!="undefined"&&window.document?(function(i){let s=i.world.tags;i.list.forEach(l=>{console.log(`
%c"`+l.text()+'"',"color: #e6d7b3;"),l.terms().forEach(u=>{let c=Object.keys(u.tags),d=u.text||"-";u.implicit&&(d="["+u.implicit+"]");let p="'"+d+"'";p=e(p,8);let m=c.find(h=>s[h]&&s[h].color),f="steelblue";s[m]&&(f=s[m].color,f=n[f]),console.log(`   ${p}  -  %c${c.join(", ")}`,`color: ${f||"steelblue"};`)})})}(a),a):(console.log(r.blue("=====")),a.list.forEach(i=>{console.log(r.blue("  -----")),i.terms().forEach(s=>{let l=Object.keys(s.tags),u=s.text||"-";s.implicit&&(u="["+s.implicit+"]"),u=r.yellow(u);let c="'"+u+"'";c=e(c,18);let d=r.blue("  \uFF5C ")+c+"  - "+function(p,m){return(p=p.map(f=>{if(!m.tags.hasOwnProperty(f))return f;let h=m.tags[f].color||"blue";return r[h](f)})).join(", ")}(l,a.world);console.log(d)})}),console.log(""),a)}}),Uy=function(o){let t=o.json({text:!1,terms:!1,reduced:!0}),e={};t.forEach(r=>{e[r.reduced]||(r.count=0,e[r.reduced]=r),e[r.reduced].count+=1});let n=Object.keys(e).map(r=>e[r]);return n.sort((r,a)=>r.count>a.count?-1:r.count<a.count?1:0),n},Gy={debug:function(){return Xp(this),this},out:function(o){if(o==="text")return this.text();if(o==="normal")return this.text("normal");if(o==="json")return this.json();if(o==="offset"||o==="offsets")return this.json({offset:!0});if(o==="array")return this.json({terms:!1}).map(t=>t.text).filter(t=>t);if(o==="freq"||o==="frequency")return Uy(this);if(o==="terms"){let t=[];return this.json({text:!1,terms:{text:!0}}).forEach(e=>{let n=e.terms.map(r=>r.text);n=n.filter(r=>r),t=t.concat(n)}),t}return o==="tags"?this.list.map(t=>t.terms().reduce((e,n)=>(e[n.clean||n.implicit]=Object.keys(n.tags),e),{})):o==="debug"?(Xp(this),this):this.text()}},Bn={alpha:(o,t)=>{let e=o.text("clean"),n=t.text("clean");return e<n?-1:e>n?1:0},length:(o,t)=>{let e=o.text().trim().length,n=t.text().trim().length;return e<n?1:e>n?-1:0},wordCount:(o,t)=>{let e=o.wordCount(),n=t.wordCount();return e<n?1:e>n?-1:0}};Bn.alphabetical=Bn.alpha,Bn.wordcount=Bn.wordCount;var Xy={index:!0,sequence:!0,seq:!0,sequential:!0,chron:!0,chronological:!0},Zy={sort:function(o){return(o=o||"alpha")==="freq"||o==="frequency"||o==="topk"?function(t){let e={},n={case:!0,punctuation:!1,whitespace:!0,unicode:!0};return t.list.forEach(r=>{let a=r.text(n);e[a]=e[a]||0,e[a]+=1}),t.list.sort((r,a)=>{let i=e[r.text(n)],s=e[a.text(n)];return i<s?1:i>s?-1:0}),t}(this):Xy.hasOwnProperty(o)?function(t){let e={};return t.json({terms:{offset:!0}}).forEach(n=>{e[n.terms[0].id]=n.terms[0].offset.start}),t.list=t.list.sort((n,r)=>e[n.start]>e[r.start]?1:e[n.start]<e[r.start]?-1:0),t}(this):typeof(o=Bn[o]||o)=="function"?(this.list=this.list.sort(o),this):this},reverse:function(){let o=[].concat(this.list);return o=o.reverse(),this.buildFrom(o)},unique:function(){let o=[].concat(this.list),t={};return o=o.filter(e=>{let n=e.text("reduced").trim()||e.text("implicit").trim();return t.hasOwnProperty(n)!==!0&&(t[n]=!0,!0)}),this.buildFrom(o)}},Zp=/[\[\]{}:,\-;\/*\^%=~|]/g,Jp=/['"]+/g,fn={whitespace:function(o){let t=o.list.map(e=>e.terms());t.forEach((e,n)=>{e.forEach((r,a)=>{r.hasDash()!==!0?(r.pre=r.pre.replace(/\s/g,""),r.post=r.post.replace(/\s/g,""),(e.length-1!==a||t[n+1])&&(r.implicit&&Boolean(r.text)===!0||r.hasHyphen()!==!0&&(r.post+=" "))):r.post=" - "})})},punctuation:function(o){o.forEach(t=>{t.hasHyphen()===!0&&(t.post=" "),t.pre=t.pre.replace(Zp,""),t.post=t.post.replace(Zp,""),t.post=t.post.replace(/\.\.\./,""),/!/.test(t.post)===!0&&(t.post=t.post.replace(/!/g,""),t.post="!"+t.post),/\?/.test(t.post)===!0&&(t.post=t.post.replace(/[\?!]*/,""),t.post="?"+t.post)})},unicode:function(o){o.forEach(t=>{t.isImplicit()!==!0&&(t.text=oo(t.text))})},quotations:function(o){o.forEach(t=>{t.post=t.post.replace(Jp,""),t.pre=t.pre.replace(Jp,"")})},adverbs:function(o){o.match("#Adverb").not("(not|nary|seldom|never|barely|almost|basically|so)").remove()},abbreviations:function(o){o.list.forEach(t=>{let e=t.terms();e.forEach((n,r)=>{n.tags.Abbreviation===!0&&e[r+1]&&(n.post=n.post.replace(/^\./,""))})})}},Jy={whitespace:!0,unicode:!0,punctuation:!0,emoji:!0,acronyms:!0,abbreviations:!0,case:!1,contractions:!1,parentheses:!1,quotations:!1,adverbs:!1,possessives:!1,verbs:!1,nouns:!1,honorifics:!1},vo={light:{},medium:{case:!0,contractions:!0,parentheses:!0,quotations:!0,adverbs:!0}};vo.heavy=Object.assign({},vo.medium,{possessives:!0,verbs:!0,nouns:!0,honorifics:!0});var Yy={normalize:function(o){typeof(o=o||{})=="string"&&(o=vo[o]||{}),o=Object.assign({},Jy,o),this.uncache();let t=this.termList();return o.case&&this.toLowerCase(),o.whitespace&&fn.whitespace(this),o.unicode&&fn.unicode(t),o.punctuation&&fn.punctuation(t),o.emoji&&this.remove("(#Emoji|#Emoticon)"),o.acronyms&&this.acronyms().strip(),o.abbreviations&&fn.abbreviations(this),(o.contraction||o.contractions)&&this.contractions().expand(),o.parentheses&&this.parentheses().unwrap(),(o.quotations||o.quotes)&&fn.quotations(t),o.adverbs&&fn.adverbs(this),(o.possessive||o.possessives)&&this.possessives().strip(),o.verbs&&this.verbs().toInfinitive(),(o.nouns||o.plurals)&&this.nouns().toSingular(),o.honorifics&&this.remove("#Honorific"),this}},Qy=Ee(function(o,t){t.splitOn=function(e){if(!e)return this.parent().splitOn(this);let n=Ve(e),r=[];return this.list.forEach(a=>{let i=a.match(n);if(i.length===0)return void r.push(a);let s=a;i.forEach(l=>{let u=s.splitOn(l);u.before&&r.push(u.before),u.match&&r.push(u.match),s=u.after}),s&&r.push(s)}),this.buildFrom(r)},t.splitAfter=function(e){if(!e)return this.parent().splitAfter(this);let n=Ve(e),r=[];return this.list.forEach(a=>{let i=a.match(n);if(i.length===0)return void r.push(a);let s=a;i.forEach(l=>{let u=s.splitOn(l);u.before&&u.match?(u.before.length+=u.match.length,r.push(u.before)):u.match&&r.push(u.match),s=u.after}),s&&r.push(s)}),this.buildFrom(r)},t.split=t.splitAfter,t.splitBefore=function(e){if(!e)return this.parent().splitBefore(this);let n=Ve(e),r=[];return this.list.forEach(a=>{let i=a.match(n);if(i.length===0)return void r.push(a);let s=a;i.forEach(l=>{let u=s.splitOn(l);u.before&&r.push(u.before),u.match&&u.after&&(u.match.length+=u.after.length),s=u.match}),s&&r.push(s)}),this.buildFrom(r)},t.segment=function(e,n){e=e||{},n=n||{text:!0};let r=this,a=Object.keys(e);return a.forEach(i=>{r=r.splitOn(i)}),r.list.forEach(i=>{for(let s=0;s<a.length;s+=1)if(i.has(a[s]))return void(i.segment=e[a[s]])}),r.list.map(i=>{let s=i.json(n);return s.segment=i.segment||null,s})}}),Co=function(o,t){let e=o.world;return o.list.forEach(n=>{n.terms().forEach(r=>r[t](e))}),o},eg={toLowerCase:function(){return Co(this,"toLowerCase")},toUpperCase:function(){return Co(this,"toUpperCase")},toTitleCase:function(){return Co(this,"toTitleCase")},toCamelCase:function(){return this.list.forEach(o=>{let t=o.terms();t.forEach((e,n)=>{n!==0&&e.toTitleCase(),n!==t.length-1&&(e.post="")})}),this}},tg=Ee(function(o,t){t.pre=function(e,n){return e===void 0?this.list[0].terms(0).pre:(this.list.forEach(r=>{let a=r.terms(0);n===!0?a.pre+=e:a.pre=e}),this)},t.post=function(e,n){return e===void 0?this.list.map(r=>{let a=r.terms();return a[a.length-1].post}):(this.list.forEach(r=>{let a=r.terms(),i=a[a.length-1];n===!0?i.post+=e:i.post=e}),this)},t.trim=function(){return this.list=this.list.map(e=>e.trim()),this},t.hyphenate=function(){return this.list.forEach(e=>{let n=e.terms();n.forEach((r,a)=>{a!==0&&(r.pre=""),n[a+1]&&(r.post="-")})}),this},t.dehyphenate=function(){let e=/(-||)/;return this.list.forEach(n=>{n.terms().forEach(r=>{e.test(r.post)&&(r.post=" ")})}),this},t.deHyphenate=t.dehyphenate,t.toQuotations=function(e,n){return e=e||'"',n=n||'"',this.list.forEach(r=>{let a=r.terms();a[0].pre=e+a[0].pre;let i=a[a.length-1];i.post=n+i.post}),this},t.toQuotation=t.toQuotations,t.toParentheses=function(e,n){return e=e||"(",n=n||")",this.list.forEach(r=>{let a=r.terms();a[0].pre=e+a[0].pre;let i=a[a.length-1];i.post=n+i.post}),this}}),ng={join:function(o){this.uncache();let t=this.list[0],e=t.length,n={};for(let a=1;a<this.list.length;a++){let i=this.list[a];n[i.start]=!0;let s=t.lastTerm();o&&(s.post+=o),s.next=i.start,i.terms(0).prev=s.id,t.length+=i.length,t.cache={}}let r=t.length-e;return this.parents().forEach(a=>{a.list.forEach(i=>{let s=i.terms();for(let l=0;l<s.length;l++)if(s[l].id===t.start){i.length+=r;break}i.cache={}}),a.list=a.list.filter(i=>n[i.start]!==!0)}),this.buildFrom([t])}},rg=/[,\)"';:\-\.]/,lt=function(o,t){if(!o.found)return;let e=o.termList();for(let n=0;n<e.length-1;n++){let r=e[n];if(rg.test(r.post))return}e.forEach(n=>{n.implicit=n.clean}),e[0].text+=t,e.slice(1).forEach(n=>{n.text=""});for(let n=0;n<e.length-1;n++){let r=e[n];r.post=r.post.replace(/ /,"")}},ag={contract:function(){let o=this.not("@hasContraction"),t=o.match("(we|they|you) are");return lt(t,"'re"),t=o.match("(he|she|they|it|we|you) will"),lt(t,"'ll"),t=o.match("(he|she|they|it|we) is"),lt(t,"'s"),t=o.match("#Person is"),lt(t,"'s"),t=o.match("#Person would"),lt(t,"'d"),t=o.match("(is|was|had|would|should|could|do|does|have|has|can) not"),lt(t,"n't"),t=o.match("(i|we|they) have"),lt(t,"'ve"),t=o.match("(would|should|could) have"),lt(t,"'ve"),t=o.match("i am"),lt(t,"'m"),t=o.match("going to"),this}},ig=Object.assign({},Ry,By,Fy,Ly,Ey,_y,$y,zy,Hy,qy,Wy,Gy,Zy,Yy,Qy,eg,tg,ng,ag),ve={};[["terms","."],["hyphenated","@hasHyphen ."],["adjectives","#Adjective"],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["adverbs","#Adverb"],["pronouns","#Pronoun"],["conjunctions","#Conjunction"],["prepositions","#Preposition"]].forEach(o=>{ve[o[0]]=function(t){let e=this.match(o[1]);return typeof t=="number"&&(e=e.get(t)),e}}),ve.emojis=ve.emoji,ve.atmentions=ve.atMentions,ve.words=ve.terms,ve.phoneNumbers=function(o){let t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),typeof o=="number"&&(t=t.get(o)),t},ve.money=function(o){let t=this.match("#Money #Currency?");return typeof o=="number"&&(t=t.get(o)),t},ve.places=function(o){let t=this.match("(#City && @hasComma) (#Region|#Country)"),e=this.not(t).splitAfter("@hasComma");return e=e.concat(t),e.sort("index"),e=e.match("#Place+"),typeof o=="number"&&(e=e.get(o)),e},ve.organizations=function(o){let t=this.clauses();return t=t.match("#Organization+"),typeof o=="number"&&(t=t.get(o)),t},ve.entities=function(o){let t=this.clauses(),e=t.people();return e=e.concat(t.places()),e=e.concat(t.organizations()),e=e.not(["someone","man","woman","mother","brother","sister","father"]),e.sort("sequence"),typeof o=="number"&&(e=e.get(o)),e},ve.things=ve.entities,ve.topics=ve.entities;var No=ve,Yp=/^(under|over)-?/,sg=function(o,t,e){let n=e.words,r=o[t].reduced+" "+o[t+1].reduced;return n[r]!==void 0&&n.hasOwnProperty(r)===!0?(o[t].tag(n[r],"lexicon-two",e),o[t+1].tag(n[r],"lexicon-two",e),1):t+2<o.length&&(r+=" "+o[t+2].reduced,n[r]!==void 0&&n.hasOwnProperty(r)===!0)?(o[t].tag(n[r],"lexicon-three",e),o[t+1].tag(n[r],"lexicon-three",e),o[t+2].tag(n[r],"lexicon-three",e),2):t+3<o.length&&(r+=" "+o[t+3].reduced,n[r]!==void 0&&n.hasOwnProperty(r)===!0)?(o[t].tag(n[r],"lexicon-four",e),o[t+1].tag(n[r],"lexicon-four",e),o[t+2].tag(n[r],"lexicon-four",e),o[t+3].tag(n[r],"lexicon-four",e),3):0},To=function(o,t){let e=t.words,n=t.hasCompound;for(let r=0;r<o.length;r+=1){let a=o[r].clean;if(n[a]===!0&&r+1<o.length){let i=sg(o,r,t);if(i>0){r+=i;continue}}if(e[a]===void 0||e.hasOwnProperty(a)!==!0)if(a===o[r].reduced||e.hasOwnProperty(o[r].reduced)!==!0){if(Yp.test(a)===!0){let i=a.replace(Yp,"");e.hasOwnProperty(i)===!0&&o[r].tag(e[i],"noprefix-lexicon",t)}}else o[r].tag(e[o[r].reduced],"lexicon",t);else o[r].tag(e[a],"lexicon",t)}return o},Vo=/[\'`]$/,og=/^(m|k|cm|km|m)\/(s|h|hr)$/,xo=[[/^[\w\.]+@[\w\.]+\.[a-z]{2,3}$/,"Email"],[/^#[a-z0-9_\u00C0-\u00FF]{2,}$/,"HashTag"],[/^@1?[0-9](am|pm)$/i,"Time"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time"],[/^@\w{2,}$/,"AtMention"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url"],[/^[a-z0-9./]+\.(com|net|gov|org|ly|edu|info|biz|ru|jp|de|in|uk|br)/,"Url"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time"],[/^[PMCE]ST$/,"Time"],[/^utc ?[+-]?[0-9]+?$/,"Time"],[/^[a-z0-9]*? o\'?clock$/,"Time"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}\/[0-9]{1,2}\/[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date"],[/^gmt[+-][0-9][0-9]?$/i,"Timezone"],[/^utc[+-][0-9][0-9]?$/i,"Timezone"],[/^ma?c\'.*/,"LastName"],[/^o\'[drlkn].*/,"LastName"],[/^ma?cd[aeiou]/,"LastName"],[/^(lol)+[sz]$/,"Expression"],[/^woo+a*?h?$/,"Expression"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^[-+]?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6][-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(k|m|b|bn)?\+?$/,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]\+?$/,["Money","Value"]],[/^[-+]?[\$]?[0-9]([0-9,.])+?(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"]],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"]],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"]],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"]],[/^[0-9.]{1,3}[a-z]{0,2}[-][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"]],[/^[0-9][0-9]?(:[0-9][0-9])?(am|pm)? ?[-] ?[0-9][0-9]?(:[0-9][0-9])?(am|pm)?$/,["Time","NumberRange"]],[/^[0-9.]+([a-z]{1,4})$/,"Value"]],lg=/^[IVXLCDM]{2,}$/,ug=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,Y="Adjective",Hr="Infinitive",jr="PresentTense",ut="Singular",Se="PastTense",ct="Expression",Qp={a:[[/.[aeiou]na$/,"Noun"],[/.[oau][wvl]ska$/,"LastName"],[/.[^aeiou]ica$/,ut],[/^([hyj]a)+$/,ct]],c:[[/.[^aeiou]ic$/,Y]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,Se],[/.[aeo]{2}[bdgmnprvz]ed$/,Se],[/.[aeiou][sg]hed$/,Se],[/.[aeiou]red$/,Se],[/.[aeiou]r?ried$/,Se],[/.[bcdgtr]led$/,Se],[/.[aoui]f?led$/,Se],[/.[iao]sed$/,Se],[/[aeiou]n?[cs]ed$/,Se],[/[aeiou][rl]?[mnf]ed$/,Se],[/[aeiou][ns]?c?ked$/,Se],[/[aeiou][nl]?ged$/,Se],[/.[tdbwxz]ed$/,Se],[/[^aeiou][aeiou][tvx]ed$/,Se],[/.[cdlmnprstv]ied$/,Se],[/[^aeiou]ard$/,ut],[/[aeiou][^aeiou]id$/,Y],[/.[vrl]id$/,Y]],e:[[/.[lnr]ize$/,Hr],[/.[^aeiou]ise$/,Hr],[/.[aeiou]te$/,Hr],[/.[^aeiou][ai]ble$/,Y],[/.[^aeiou]eable$/,Y],[/.[ts]ive$/,Y],[/[a-z]-like$/,Y]],h:[[/.[^aeiouf]ish$/,Y],[/.v[iy]ch$/,"LastName"],[/^ug?h+$/,ct],[/^uh[ -]?oh$/,ct],[/[a-z]-ish$/,Y]],i:[[/.[oau][wvl]ski$/,"LastName"]],k:[[/^(k){2}$/,ct]],l:[[/.[gl]ial$/,Y],[/.[^aeiou]ful$/,Y],[/.[nrtumcd]al$/,Y],[/.[^aeiou][ei]al$/,Y]],m:[[/.[^aeiou]ium$/,ut],[/[^aeiou]ism$/,ut],[/^h*u*m+$/,ct],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,Y],[/[^aeiou]ician$/,"Actor"],[/[aeiou][ktrp]in$/,"Gerund"]],o:[[/^no+$/,ct],[/^(yo)+$/,ct],[/^woo+[pt]?$/,ct]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,ut],[/[^i]fer$/,Hr],[/.[^aeiou][ao]pher$/,"Actor"],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,Y],[/[aeiou].*ist$/,Y],[/^[a-z]et$/,"Verb"]],s:[[/.[^aeiou]ises$/,jr],[/.[rln]ates$/,jr],[/.[^z]ens$/,"Verb"],[/.[lstrn]us$/,ut],[/.[aeiou]sks$/,jr],[/.[aeiou]kes$/,jr],[/[aeiou][^aeiou]is$/,ut],[/[a-z]\'s$/,"Noun"],[/^yes+$/,ct]],v:[[/.[^aeiou][ai][kln]ov$/,"LastName"]],y:[[/.[cts]hy$/,Y],[/.[st]ty$/,Y],[/.[gk]y$/,Y],[/.[tnl]ary$/,Y],[/.[oe]ry$/,ut],[/[rdntkbhs]ly$/,"Adverb"],[/...lly$/,"Adverb"],[/[bszmp]{2}y$/,Y],[/.(gg|bb|zz)ly$/,Y],[/.[ai]my$/,Y],[/[ea]{2}zy$/,Y],[/.[^aeiou]ity$/,ut]]},xe="Adjective",Fn="Infinitive",Pt="PresentTense",hn="Singular",ke="PastTense",Rt="Adverb",dt="Plural",qr="Verb",He="LastName",em=[null,null,{ea:hn,ia:"Noun",ic:xe,ly:Rt,"'n":qr,"'t":qr},{oed:ke,ued:ke,xed:ke," so":Rt,"'ll":"Modal","'re":"Copula",azy:xe,eer:"Noun",end:qr,ped:ke,ffy:xe,ify:Fn,ing:"Gerund",ize:Fn,lar:xe,mum:xe,nes:Pt,nny:xe,oid:xe,ous:xe,que:xe,rol:hn,sis:hn,zes:Pt},{amed:ke,aped:ke,ched:ke,lked:ke,nded:ke,cted:ke,dged:ke,akis:He,cede:Fn,chuk:He,czyk:He,ects:Pt,ends:qr,enko:He,ette:hn,fies:Pt,fore:Rt,gate:Fn,gone:xe,ices:dt,ints:dt,ines:dt,ions:dt,less:Rt,llen:xe,made:xe,nsen:He,oses:Pt,ould:"Modal",some:xe,sson:He,tage:Fn,teen:"Value",tion:hn,tive:xe,tors:"Noun",vice:hn},{tized:ke,urned:ke,eased:ke,ances:dt,bound:xe,ettes:dt,fully:Rt,ishes:Pt,ities:dt,marek:He,nssen:He,ology:"Noun",ports:dt,rough:xe,tches:Pt,tieth:"Ordinal",tures:dt,wards:Rt,where:Rt},{auskas:He,keeper:"Actor",logist:"Actor",teenth:"Value"},{opoulos:He,borough:"Place",sdottir:He}],cg={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"<3":!0,"</3":!0,"<\\3":!0},dg=/^(\u00a9|\u00ae|[\u2319-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/,Ln={lexicon:To,punctuation:function(o,t,e){let n=o[t];if(Vo.test(n.text)&&!Vo.test(n.pre)&&!Vo.test(n.post)&&n.clean.length>2){let r=n.clean[n.clean.length-2];if(r==="s")return void n.tag(["Possessive","Noun"],"end-tick",e);r==="n"&&n.tag(["Gerund"],"chillin",e)}og.test(n.text)&&n.tag("Unit","per-sec",e)},regex:function(o,t){let e=o.text;for(let n=0;n<xo.length;n+=1)if(xo[n][0].test(e)===!0){o.tagSafe(xo[n][1],"prefix #"+n,t);break}o.text.length>=2&&lg.test(e)&&ug.test(e)&&o.tag("RomanNumeral","xvii",t)},suffix:function(o,t){(function(e,n){let r=e.clean.length,a=7;r<=a&&(a=r-1);for(let i=a;i>1;i-=1){let s=e.clean.substr(r-i,r);if(em[s.length].hasOwnProperty(s)===!0){let l=em[s.length][s];e.tagSafe(l,"suffix -"+s,n);break}}})(o,t),function(e,n){let r=e.clean,a=r[r.length-1];if(Qp.hasOwnProperty(a)===!0){let i=Qp[a];for(let s=0;s<i.length;s+=1)if(i[s][0].test(r)===!0){e.tagSafe(i[s][1],`endReg ${a} #${s}`,n);break}}}(o,t)},emoji:(o,t)=>{let e=o.pre+o.text+o.post;var n;e=e.trim(),e=e.replace(/[.!?,]$/,""),(r=>!(r.charAt(0)!==":"||r.match(/:.?$/)===null||r.match(" ")||r.length>35))(e)===!0&&(o.tag("Emoji","comma-emoji",t),o.text=e,o.pre=o.pre.replace(":",""),o.post=o.post.replace(":","")),o.text.match(dg)&&(o.tag("Emoji","unicode-emoji",t),o.text=e),n=(n=e).replace(/^[:;]/,":"),cg.hasOwnProperty(n)===!0&&(o.tag("Emoticon","emoticon-emoji",t),o.text=e)}},pg=function(o,t){let e=o.world;Ln.lexicon(t,e);for(let n=0;n<t.length;n+=1){let r=t[n];Ln.punctuation(t,n,e),Ln.regex(r,e),Ln.suffix(r,e),Ln.emoji(r,e)}return o},xt={beforeThisWord:{there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},afterThisWord:{i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},beforeThisPos:{Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",Pluperfect:"Noun",PerfectTense:"Verb"},afterThisPos:{Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"}},mg=Object.keys(xt.afterThisPos),fg=Object.keys(xt.beforeThisPos),hg=function(o,t){for(let e=0;e<o.length;e+=1){let n=o[e];if(n.isKnown()===!0)continue;let r=o[e-1];if(r){if(xt.afterThisWord.hasOwnProperty(r.clean)===!0){let s=xt.afterThisWord[r.clean];n.tag(s,"after-"+r.clean,t);continue}let i=mg.find(s=>r.tags[s]);if(i!==void 0){let s=xt.afterThisPos[i];n.tag(s,"after-"+i,t);continue}}let a=o[e+1];if(a){if(xt.beforeThisWord.hasOwnProperty(a.clean)===!0){let s=xt.beforeThisWord[a.clean];n.tag(s,"before-"+a.clean,t);continue}let i=fg.find(s=>a.tags[s]);if(i!==void 0){let s=xt.beforeThisPos[i];n.tag(s,"before-"+i,t);continue}}}},bg=/^[A-Z][a-z'\u00C0-\u00FF]/,yg=/[0-9]/,gg=function(o){let t=o.world;o.list.forEach(e=>{let n=e.terms();for(let r=1;r<n.length;r++){let a=n[r];bg.test(a.text)===!0&&yg.test(a.text)===!1&&a.tags.Date===void 0&&a.tag("ProperNoun","titlecase-noun",t)}})},vg=/^(re|un)-?[a-z\u00C0-\u00FF]/,Cg=/^(re|un)-?/,Ng=function(o,t){let e=t.words;o.forEach(n=>{if(n.isKnown()!==!0&&vg.test(n.clean)===!0){let r=n.clean.replace(Cg,"");r&&r.length>3&&e[r]!==void 0&&e.hasOwnProperty(r)===!0&&n.tag(e[r],"stem-"+r,t)}})},tm={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/s[aeiou]+ns$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/is$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i]},Tg=["Uncountable","Pronoun","Place","Value","Person","Month","WeekDay","Holiday"],Vg=[/ss$/,/sis$/,/[^aeiou][uo]s$/,/'s$/],xg=[/i$/,/ae$/],wg=function(o,t){if(o.tags.Noun&&!o.tags.Acronym){let e=o.clean;if(o.tags.Singular||o.tags.Plural)return;if(e.length<=3)return void o.tag("Singular","short-singular",t);if(Tg.find(n=>o.tags[n]))return;if(tm.isPlural.find(n=>n.test(e)))return void o.tag("Plural","plural-rules",t);if(tm.isSingular.find(n=>n.test(e)))return void o.tag("Singular","singular-rules",t);if(/s$/.test(e)===!0)return Vg.find(n=>n.test(e))?void 0:void o.tag("Plural","plural-fallback",t);if(xg.find(n=>n.test(e)))return;o.tag("Singular","singular-fallback",t)}},nm=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(function(o,t){return o[t]="Noun",o},{}),rm=function(o){return!!o.tags.Noun&&!(o.tags.Pronoun||o.tags.Comma||o.tags.Possessive)&&!!(o.tags.Organization||o.tags.Acronym||o.tags.Place||o.titleCase())},Dg=/^[A-Z]('s|,)?$/,Ag=/([A-Z]\.){2}[A-Z]?/i,Sg={I:!0,A:!0},bn={neighbours:hg,case:gg,stem:Ng,plural:wg,organizations:function(o,t){for(let e=0;e<o.length;e+=1){let n=o[e];if(nm[n.clean]!==void 0&&nm.hasOwnProperty(n.clean)===!0){let r=o[e-1];if(r!==void 0&&rm(r)===!0){r.tagSafe("Organization","org-word-1",t),n.tagSafe("Organization","org-word-2",t);continue}let a=o[e+1];if(a!==void 0&&a.clean==="of"&&o[e+2]&&rm(o[e+2])){n.tagSafe("Organization","org-of-word-1",t),a.tagSafe("Organization","org-of-word-2",t),o[e+2].tagSafe("Organization","org-of-word-3",t);continue}}}},acronyms:function(o,t){o.forEach(e=>{e.tags.RomanNumeral!==!0&&(Ag.test(e.text)===!0&&e.tag("Acronym","period-acronym",t),e.isUpperCase()&&function(n,r){let a=n.reduced;return!!n.tags.Acronym||!r.words[a]&&!(a.length>5)&&n.isAcronym()}(e,t)?(e.tag("Acronym","acronym-step",t),e.tag("Noun","acronym-infer",t)):!Sg.hasOwnProperty(e.text)&&Dg.test(e.text)&&(e.tag("Acronym","one-letter-acronym",t),e.tag("Noun","one-letter-infer",t)),e.tags.Organization&&e.text.length<=3&&e.tag("Acronym","acronym-org",t),e.tags.Organization&&e.isUpperCase()&&e.text.length<=6&&e.tag("Acronym","acronym-org-case",t))})}},Ig=function(o,t){let e=o.world;return bn.neighbours(t,e),bn.case(o),bn.stem(t,e),t.forEach(n=>{n.isKnown()===!1&&n.tag("Noun","noun-fallback",o.world)}),bn.organizations(t,e),bn.acronyms(t,e),t.forEach(n=>{bn.plural(n,o.world)}),o},am=/n't$/,im={"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],dont:["do","not"],dun:["do","not"]},Og=function(o,t){return im.hasOwnProperty(o.clean)===!0?im[o.clean]:o.clean==="ain't"||o.clean==="aint"?function(e,n){let r=n.terms(),a=r.indexOf(e),i=r.slice(0,a).find(s=>s.tags.Noun);return i&&i.tags.Plural?["are","not"]:["is","not"]}(o,t):am.test(o.clean)===!0?[o.clean.replace(am,""),"not"]:null},kg=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z]{1,2})$/i,sm={ll:"will",ve:"have",re:"are",m:"am","n't":"not"},Pg=function(o){let t=o.text.match(kg);return t===null?null:sm.hasOwnProperty(t[2])?[t[1],sm[t[2]]]:null},om={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],ive:["i","have"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],howd:["how","did"],whatd:["what","did"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]},Rg=function(o){return om.hasOwnProperty(o.clean)?om[o.clean]:null},Bg=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]s$/i,Fg={that:!0,there:!0},Lg={here:!0,there:!0,everywhere:!0},Eg=function(o,t,e){let n=o.text.match(Bg);if(n!==null){if(((r,a)=>{if(r.tags.Possessive)return!0;if(r.tags.Pronoun||r.tags.QuestionWord||Fg.hasOwnProperty(r.reduced))return!1;let i=a.get(r.next);if(!i)return!0;if(i.tags.Verb)return!!i.tags.Infinitive||!!i.tags.PresentTense;if(i.tags.Noun)return Lg.hasOwnProperty(i.reduced)!==!0;let s=a.get(i.next);return!(!s||!s.tags.Noun||s.tags.Pronoun)||(i.tags.Adjective||i.tags.Adverb||i.tags.Verb,!1)})(o,t.pool)===!0)return o.tag("#Possessive","isPossessive",e),null;if(n!==null)return((r,a)=>{let i=a.terms(),s=i.indexOf(r);return i.slice(s+1,s+3).find(l=>l.tags.PastTense)})(o,t)?[n[1],"has"]:[n[1],"is"]}return null},Mg=/[a-z\u00C0-\u00FF]'d$/,_g={how:!0,what:!0},$g=function(o,t){if(Mg.test(o.clean)){let e=o.clean.replace(/'d$/,""),n=t.terms(),r=n.indexOf(o),a=n.slice(r+1,r+4);for(let i=0;i<a.length;i++){let s=a[i];if(s.tags.Verb)return s.tags.PastTense?[e,"had"]:_g[e]===!0?[e,"did"]:[e,"would"]}return[e,"would"]}return null},zg=/^([0-9.]{1,3}[a-z]{0,2}) ?[-] ?([0-9]{1,3}[a-z]{0,2})$/i,Hg=/^([0-9][0-9]?(:[0-9][0-9])?(am|pm)?) ?[-] ?([0-9][0-9]?(:[0-9][0-9])?(am|pm)?)$/i,jg=function(o){if(o.tags.PhoneNumber===!0)return null;let t=o.text.match(zg);return t!==null?[t[1],"to",t[2]]:(t=o.text.match(Hg),t!==null?[t[1],"to",t[4]]:null)},qg=/^(l|c|d|j|m|n|qu|s|t)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z\u00C0-\u00FF]+)$/i,lm={l:"le",c:"ce",d:"de",j:"je",m:"me",n:"ne",qu:"que",s:"se",t:"tu"},Kg=function(o){let t=o.text.match(qg);if(t===null||lm.hasOwnProperty(t[1])===!1)return null;let e=[lm[t[1]],t[2]];return e[0]&&e[1]?e:null},Wg=/^[0-9]+$/,Ug=/^[0-9]+(st|nd|rd|th)$/,Gg=/^[0-9:]+(am|pm)?$/,Xg=function(o,t){let e=ot(o.join(" "),t.world,t.pool())[0],n=e.terms();To(n,t.world);let r=n[0];return Ug.test(r.text)?(n[0].tag("Ordinal","ord-range",t.world),n[2].tag("Ordinal","ord-range",t.world)):Wg.test(r.text)?(n[0].tag("Cardinal","num-range",t.world),n[2].tag("Cardinal","num-range",t.world)):Gg.test(r.text)&&(n[0].tag("Time","time-range",t.world),n[1].tag("Date","time-range",t.world),n[2].tag("Time","time-range",t.world)),n.forEach(a=>{a.implicit=a.text,a.text="",a.clean="",a.pre="",a.post="",Object.keys(a.tags).length===0&&(a.tags.Noun=!0)}),e},Zg=function(o){let t=o.world;return o.list.forEach(e=>{let n=e.terms();for(let r=0;r<n.length;r+=1){let a=n[r],i=Og(a,e);if(i=i||Pg(a),i=i||Rg(a),i=i||Eg(a,e,t),i=i||$g(a,e),i=i||jg(a),i=i||Kg(a),i!==null){let s=Xg(i,o);e.has("#NumberRange")===!0&&o.buildFrom([s]).tag("NumberRange"),s.terms(0).text=a.text,e.buildFrom(a.id,1,o.pool()).replace(s,o,!0)}}}),o},yn=function(o,t){let e=o._cache.tags[t]||[];return e=e.map(n=>o.list[n]),o.buildFrom(e)},Jg=function(o){let t=yn(o,"Infinitive");return t.found&&(t=t.ifNo("@hasQuestionMark"),t=t.ifNo("(i|we|they)"),t.not("will be").match("[#Infinitive] (#Determiner|#Possessive) #Noun").notIf("(our|their)").match("#Infinitive").tag("Imperative","shut-the"),t.match("^[#Infinitive] #Adverb?$",0).tag("Imperative","go-fast"),t.match("[(do && #Infinitive)] not? #Verb",0).tag("Imperative","do-not"),t.match("[#Infinitive] (it|some)",0).tag("Imperative","do-it")),t=function(e,n){let r=e._cache.words[n]||[];return r=r.map(a=>e.list[a]),e.buildFrom(r)}(o,"like"),t.match("#Adverb like").notIf("(really|generally|typically|usually|sometimes|often|just) [like]").tag("Adverb","adverb-like"),t=yn(o,"Adjective"),t.match("#Determiner #Adjective$").notIf("(#Comparative|#Superlative)").terms(1).tag("Noun","the-adj-1"),t=yn(o,"FirstName"),t.match("#FirstName (#Noun|@titleCase)").ifNo("^#Possessive").ifNo("(#Pronoun|#Plural)").ifNo("@hasComma .").lastTerm().tag("#LastName","firstname-noun"),t=yn(o,"Value"),t=t.match("#Value #PresentTense").ifNo("#Copula"),t.found&&(t.has("(one|1)")===!0?t.terms(1).tag("Singular","one-presentTense"):t.terms(1).tag("Plural","value-presentTense")),o.match("^(well|so|okay)").tag("Expression","well-"),o.match("#Value [of a second]",0).unTag("Value","of-a-second"),o.match("#Value [seconds]",0).unTag("Value","30-seconds").tag(["Unit","Plural"]),t=yn(o,"Gerund"),t.match("(be|been) (#Adverb|not)+? #Gerund").not("#Verb$").tag("Auxiliary","be-walking"),o.match("(try|use|attempt|build|make) #Verb").ifNo("(@hasComma|#Negative|#PhrasalVerb|#Copula|will|be)").lastTerm().tag("#Noun","do-verb"),t=yn(o,"Possessive"),t=t.match("#Possessive [#Infinitive]",0),t.lookBehind("(let|made|make|force|ask)").found||t.tag("Noun","her-match"),o},wo=function(o){let t={};for(let e=0;e<o.length;e++)t[o[e]]=!0;return Object.keys(t)},Yg=[{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"u r",tag:"Pronoun Copula",reason:"u r"},{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"#Noun #Actor",tag:"Actor",reason:"thing-doer"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Copula just [like]",group:0,tag:"Preposition",reason:"like-preposition"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"^how",tag:"QuestionWord",reason:"how-question"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"^which",tag:"QuestionWord",reason:"which-question"},{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"}],Bt={adverbAdjective:["dark","bright","flat","light","soft","pale","dead","dim","faux","little","wee","sheer","most","near","good","extra","all"],personDate:["april","june","may","jan","august","eve"],personMonth:["january","april","may","june","jan","sep"],personAdjective:["misty","rusty","dusty","rich","randy","young"],personVerb:["pat","wade","ollie","will","rob","buck","bob","mark","jack"],personPlace:["darwin","hamilton","paris","alexandria","houston","kobe","santiago","salvador","sydney","victoria"],personNoun:["art","baker","berg","bill","brown","charity","chin","christian","cliff","daisy","dawn","dick","dolly","faith","franco","gene","green","hall","hill","holly","hope","jean","jewel","joy","kelvin","king","kitty","lane","lily","melody","mercedes","miles","olive","penny","ray","reed","robin","rod","rose","sky","summer","trinity","van","viola","violet","wang","white"]},et=`(${Bt.personDate.join("|")})`,Qg=[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"this [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"next [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"last [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"[(march|may)] the? #Value",group:0,tag:"Month",reason:"march-5th"},{match:"#Value of? [(march|may)]",group:0,tag:"Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:`in [${et}]`,group:0,tag:"Date",reason:"in-june"},{match:`during [${et}]`,group:0,tag:"Date",reason:"in-june"},{match:`on [${et}]`,group:0,tag:"Date",reason:"in-june"},{match:`by [${et}]`,group:0,tag:"Date",reason:"by-june"},{match:`after [${et}]`,group:0,tag:"Date",reason:"after-june"},{match:`#Date [${et}]`,group:0,tag:"Date",reason:"in-june"},{match:et+" #Value",tag:"Date",reason:"june-5th"},{match:et+" #Date",tag:"Date",reason:"june-5th"},{match:et+" #ProperNoun",tag:"Person",reason:"june-smith",safe:!0},{match:et+" #Acronym? (#ProperNoun && !#Month)",tag:"Person",reason:"june-smith-jr"},{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}],Do=`(${Bt.personAdjective.join("|")})`,ev=[{match:"[all] #Determiner? #Noun",group:0,tag:"Adjective",reason:"all-noun"},{match:`#Adverb [${Do}]`,group:0,tag:"Adjective",reason:"really-rich"},{match:Do+" #Person",tag:"Person",reason:"randy-smith"},{match:Do+" #Acronym? #ProperNoun",tag:"Person",reason:"rusty-smith"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"(a|an) [#Gerund]",group:0,tag:"Adjective",reason:"a|an"},{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(it|he|she|everything|something) #Adverb? was #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"it-was-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,tag:"Infinitive",reason:"shut-the"}],tv=[{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"(#Verb && !#Modal) (all|every|each|most|some|no) [#PresentTense]",group:0,tag:"Noun",reason:"all-presentTense"},{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adj-presentTense"},{match:"^#Adjective [#PresentTense]",group:0,tag:"Noun",reason:"start adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",reason:"many-poses"},{match:"#Adverb #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"very-big-dream"},{match:"#Adjective [#Infinitive] #Noun",group:0,tag:"Noun",reason:"good-wait-staff"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adorable-little-store"},{match:"#Preposition #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"of-basic-training"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",reason:"early-warning"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"higher-costs"},{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"(his|her|its) [#Adjective]",group:0,tag:"Noun",reason:"his-fine"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"more #Noun",tag:"Noun",reason:"more-noun"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",reason:"noun-list"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Noun",reason:"bit-2"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner #Adverb [#Infinitive]",group:0,tag:"Noun",reason:"the-reason"},{match:"(the|this|those|these) #Adjective [#Verb]",group:0,tag:"Noun",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)",group:0,tag:"Noun",reason:"the-adj-2"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner [#Infinitive] #Noun",group:0,tag:"Noun",reason:"determiner7"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"#Determiner [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",reason:"noun-of-noun"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"#Possessive [#Gerund]",group:0,tag:"Noun",reason:"her-polling"},{match:"(his|her|its) [#PresentTense]",group:0,tag:"Noun",reason:"its-polling"},{match:"(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun",group:0,tag:"Noun",reason:"technical-noun"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(the|those|these|a|an) #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"det-inf"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense]",group:0,tag:"Noun",reason:"det-pres"},{match:"(the|those|these|a|an) #Adjective? [#PastTense]",group:0,tag:"Noun",reason:"det-past"},{match:"(this|that) [#Gerund]",group:0,tag:"Noun",reason:"this-gerund"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(#Noun && @hasHyphen) #Verb",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"[#Verb] than",group:0,tag:"Noun",reason:"correction"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Noun [#Infinitive] (#Preposition|#Noun)",group:0,tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Copula [#Infinitive] #Noun",group:0,tag:"Noun",reason:"is-pres-noun"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"#Gerund #Adjective to [#Infinitive]",group:0,tag:"Noun",reason:"running-to"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"co #Noun",tag:"Actor",reason:"co-noun"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"}],nv=[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"(#Verb && !#Modal) [like]",group:0,tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"(#PresentTense && !#Copula) [(hard|quick|long|bright|slow|fast|backwards|forwards)]",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:`[${`(${Bt.adverbAdjective.join("|")})`}] #Adjective`,group:0,tag:"Adverb",reason:"dark-green"},{match:"#Adverb [#Adverb]$",group:0,tag:"Adjective",reason:"kinda-sparkly"},{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"}],rv=[{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"(#Value|a) [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"a #Value",tag:"Value",reason:"a-value"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"(hundred|thousand|million|billion|trillion|quadrillion)+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"!once [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"}],Kr=`(${Bt.personVerb.join("|")})`,av=[{match:"[#Adjective] #Possessive #Noun",group:0,tag:"Verb",reason:"gerund-his-noun"},{match:"[#Adjective] (us|you)",group:0,tag:"Gerund",reason:"loving-you"},{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Gerund",reason:"slowly-adj"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"do (simply|just|really|not)+ [(#Adjective|like)]",group:0,tag:"Verb",reason:"do-simply-like"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"(this|that) [#Plural]",group:0,tag:"PresentTense",reason:"this-verbs"},{match:"[#Copula (#Adverb|not)+?] (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[#Adverb+? (#Modal|did)+ (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|will|have|had)] (not|#Adverb)? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? be (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"(#Modal|had|has) (#Adverb|not)+? been (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-foo"},{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"#PhrasalVerb [#PhrasalVerb]",group:0,tag:"Particle",reason:"phrasal-particle"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"},{match:"[will #Adverb? not? #Adverb? be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|to|toward)",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"will [#Adjective]",group:0,tag:"Verb",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [#Adjective to] #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"[#PresentTense] (are|were|was) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:`#Modal [${Kr}]`,group:0,tag:"Verb",reason:"would-mark"},{match:`#Adverb [${Kr}]`,group:0,tag:"Verb",reason:"really-mark"},{match:"(to|#Modal) [mark]",group:0,tag:"PresentTense",reason:"to-mark"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:Kr+" #Person",tag:"Person",reason:"rob-smith"},{match:Kr+" #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"}],iv=[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)",tag:"Region",reason:"foo-district"},{match:"(district|region|province|municipality|territory|burough|state) of #ProperNoun",tag:"Region",reason:"district-of-Foo"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"}],um=`(${Bt.personNoun.join("|")})`,Ie=`(${Bt.personMonth.join("|")})`,sv=[{match:"[(1st|2nd|first|second)] #Honorific",group:0,tag:"Honorific",reason:"ordinal-honorific"},{match:"[(private|general|major|corporal|lord|lady|secretary|premier)] #Honorific? #Person",group:0,tag:"Honorific",reason:"ambg-honorifics"},{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(lady|queen|sister) #ProperNoun",tag:"FemaleName",reason:"lady-titlecase",safe:!0},{match:"(king|pope|father) #ProperNoun",tag:"MaleName",reason:"pope-titlecase",safe:!0},{match:"[(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill)] #LastName",group:0,tag:"FirstName",reason:"maybe-lastname"},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"NickName",reason:"first-noun-last"},{match:"#Possessive [#FirstName]",group:0,tag:"Person",reason:"possessive-name"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-latname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Honorific #Person",tag:"Person",reason:"honorific-person"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",reason:"saint-foo"},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)",tag:"Person",reason:"bill-green"},{match:um+" #Person",tag:"Person",reason:"ray-smith",safe:!0},{match:um+" #Acronym? #ProperNoun",tag:"Person",reason:"ray-a-smith",safe:!0},{match:`#Infinitive #Determiner? #Adjective? #Noun? (to|for) [${Ie}]`,group:0,tag:"Person",reason:"ambig-person"},{match:`#Infinitive [${Ie}]`,group:0,tag:"Person",reason:"infinitive-person"},{match:`[${Ie}] #Modal`,group:0,tag:"Person",reason:"ambig-modal"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:`#Modal [${Ie}]`,group:0,tag:"Person",reason:"modal-ambig"},{match:`#Copula [${Ie}]`,group:0,tag:"Person",reason:"is-may"},{match:`[${Ie}] #Copula`,group:0,tag:"Person",reason:"may-is"},{match:`that [${Ie}]`,group:0,tag:"Person",reason:"that-month"},{match:`with [${Ie}]`,group:0,tag:"Person",reason:"with-month"},{match:`for [${Ie}]`,group:0,tag:"Person",reason:"for-month"},{match:`this [${Ie}]`,group:0,tag:"Month",reason:"this-may"},{match:`next [${Ie}]`,group:0,tag:"Month",reason:"next-may"},{match:`last [${Ie}]`,group:0,tag:"Month",reason:"last-may"},{match:`#Date [${Ie}]`,group:0,tag:"Month",reason:"date-may"},{match:`[${Ie}] the? #Value`,group:0,tag:"Month",reason:"may-5th"},{match:`#Value of [${Ie}]`,group:0,tag:"Month",reason:"5th-of-may"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",reason:"title-de-title",safe:!0},{match:"#Singular #Acronym #LastName",tag:"#Person",reason:"title-acro-noun",safe:!0},{match:"#FirstName (#Noun && #ProperNoun) #ProperNoun?",tag:"Person",reason:"firstname-titlecase"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von) #Person]",group:0,tag:"LastName",reason:"de-firstname"},{match:`[${`(${Bt.personPlace.join("|")})`}] (#ProperNoun && !#Place)`,group:0,tag:"FirstName",reason:"place-firstname"}],ie=[];ie=ie.concat(Yg),ie=ie.concat(Qg),ie=ie.concat(ev),ie=ie.concat(tv),ie=ie.concat(nv),ie=ie.concat(rv),ie=ie.concat(av),ie=ie.concat(iv),ie=ie.concat([{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"}]),ie=ie.concat(sv);var En=[];ie.forEach(o=>{o.reg=Ve(o.match);let t=function(e){let n=[];if(e.reg.filter(r=>r.fastOr!==void 0).length===1){let r=e.reg.findIndex(a=>a.fastOr!==void 0);Object.keys(e.reg[r].fastOr).forEach(a=>{let i=Object.assign({},e);i.reg=i.reg.slice(0),i.reg[r]=Object.assign({},i.reg[r]),i.reg[r].word=a,delete i.reg[r].operator,delete i.reg[r].fastOr,n.push(i)})}return n}(o);t.length>0?En=En.concat(t):En.push(o)}),En.forEach(o=>(o.required=function(t){let e=[],n=[];return t.forEach(r=>{r.optional!==!0&&r.negative!==!0&&(r.tag!==void 0&&e.push(r.tag),r.word!==void 0&&n.push(r.word))}),{tags:wo(e),words:wo(n)}}(o.reg),o));var ov=En,lv=function(o){ov.forEach(t=>{let e=[];t.required.words.forEach(i=>{e.push(o._cache.words[i]||[])}),t.required.tags.forEach(i=>{e.push(o._cache.tags[i]||[])});let n=function(i){if(i.length===0)return[];let s={};i.forEach(u=>{u=wo(u);for(let c=0;c<u.length;c++)s[u[c]]=s[u[c]]||0,s[u[c]]+=1});let l=Object.keys(s);return l=l.filter(u=>s[u]===i.length),l=l.map(u=>Number(u)),l}(e);if(n.length===0)return;let r=n.map(i=>o.list[i]),a=o.buildFrom(r).match(t.reg,t.group);a.found&&(t.safe===!0?a.tagSafe(t.tag,t.reason):a.tag(t.tag,t.reason))})},uv=function(o){return lv(o),Jg(o),o},cv=function(o){let t=o.termList();return o=pg(o,t),o=Ig(o,t),(o=Zg(o)).cache(),(o=uv(o)).uncache(),o.world.taggers.forEach(e=>{e(o)}),o},dv=function(o){class t extends o{stripPeriods(){return this.termList().forEach(n=>{n.tags.Abbreviation===!0&&n.next&&(n.post=n.post.replace(/^\./,""));let r=n.text.replace(/\./,"");n.set(r)}),this}addPeriods(){return this.termList().forEach(n=>{n.post=n.post.replace(/^\./,""),n.post="."+n.post}),this}}return t.prototype.unwrap=t.prototype.stripPeriods,o.prototype.abbreviations=function(e){let n=this.match("#Abbreviation");return typeof e=="number"&&(n=n.get(e)),new t(n.list,this,this.world)},o},pv=/\./,mv=function(o){class t extends o{stripPeriods(){return this.termList().forEach(n=>{let r=n.text.replace(/\./g,"");n.set(r)}),this}addPeriods(){return this.termList().forEach(n=>{let r=n.text.replace(/\./g,"");r=r.split("").join("."),pv.test(n.post)===!1&&(r+="."),n.set(r)}),this}}return t.prototype.unwrap=t.prototype.stripPeriods,t.prototype.strip=t.prototype.stripPeriods,o.prototype.acronyms=function(e){let n=this.match("#Acronym");return typeof e=="number"&&(n=n.get(e)),new t(n.list,this,this.world)},o},fv=function(o){return o.prototype.clauses=function(t){let e=this.if("@hasComma").notIf("@hasComma @hasComma").notIf("@hasComma . .? (and|or) .").notIf("(#City && @hasComma) #Country").notIf("(#WeekDay && @hasComma) #Date").notIf("(#Date && @hasComma) #Year").notIf("@hasComma (too|also)$").match("@hasComma"),n=this.splitAfter(e),r=n.quotations();n=n.splitOn(r);let a=n.parentheses();n=n.splitOn(a);let i=n.if("#Copula #Adjective #Conjunction (#Pronoun|#Determiner) #Verb").match("#Conjunction");n=n.splitBefore(i);let s=n.if("if .{2,9} then .").match("then");n=n.splitBefore(s),n=n.splitBefore("as well as ."),n=n.splitBefore("such as ."),n=n.splitBefore("in addition to ."),n=n.splitAfter("@hasSemicolon"),n=n.splitAfter("@hasDash");let l=n.filter(u=>u.wordCount()>5&&u.match("#Verb+").length>=2);if(l.found){let u=l.splitAfter("#Noun .* #Verb .* #Noun+");n=n.splitOn(u.eq(0))}return typeof t=="number"&&(n=n.get(t)),new o(n.list,this,this.world)},o},hv=function(o){class t extends o{constructor(n,r,a){super(n,r,a),this.contracted=null}expand(){return this.list.forEach(n=>{let r=n.terms(),a=r[0].isTitleCase();r.forEach((i,s)=>{i.set(i.implicit||i.text),i.implicit=void 0,s<r.length-1&&i.post===""&&(i.post+=" ")}),a&&r[0].toTitleCase()}),this}}return o.prototype.contractions=function(e){let n=this.match("@hasContraction+");return typeof e=="number"&&(n=n.get(e)),new t(n.list,this,this.world)},o.prototype.expanded=o.prototype.isExpanded,o.prototype.contracted=o.prototype.isContracted,o},bv=function(o){let t=function(n){let r=n.splitAfter("@hasComma").splitOn("(and|or) not?").not("(and|or) not?"),a=n.match("[.] (and|or)",0);return{things:r,conjunction:n.match("(and|or) not?"),beforeLast:a,hasOxford:a.has("@hasComma")}};class e extends o{conjunctions(){return this.match("(and|or)")}parts(){return this.splitAfter("@hasComma").splitOn("(and|or) not?")}items(){return t(this).things}add(r){return this.forEach(a=>{let i=t(a).beforeLast;i.append(r),i.termList(0).addPunctuation(",")}),this}remove(r){return this.items().if(r).remove()}hasOxfordComma(){return this.filter(r=>t(r).hasOxford)}addOxfordComma(){let r=this.items(),a=r.eq(r.length-2);return a.found&&a.has("@hasComma")===!1&&a.post(", "),this}removeOxfordComma(){let r=this.items(),a=r.eq(r.length-2);return a.found&&a.has("@hasComma")===!0&&a.post(" "),this}}return e.prototype.things=e.prototype.items,o.prototype.lists=function(n){let r=this.if("@hasComma+ .? (and|or) not? ."),a=r.match("(#Noun|#Adjective|#Determiner|#Article)+ #Conjunction not? (#Article|#Determiner)? #Adjective? #Noun+").if("#Noun"),i=r.match("(#Adjective|#Adverb)+ #Conjunction not? #Adverb? #Adjective+"),s=r.match("(#Verb|#Adverb)+ #Conjunction not? #Adverb? #Verb+"),l=a.concat(i);return l=l.concat(s),l=l.if("@hasComma"),typeof n=="number"&&(l=r.get(n)),new e(l.list,this,this.world)},o},Ao=function(o){return o.has("#Plural")===!0||o.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)")!==!0},cm={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},yv={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},dm=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i],pm=function(o){if(o.has("#Person")||o.has("#Place"))return"";if(o.has("#Plural"))return"the";let t=o.text("normal").trim();if(cm.hasOwnProperty(t))return cm[t];let e=t.substr(0,1);if(o.has("^@isAcronym")&&yv.hasOwnProperty(e))return"an";for(let n=0;n<dm.length;n++)if(dm[n].test(t))return"a";return/^[aeiou]/i.test(t)?"an":"a"},mm={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/men$/i,/.tia$/i,/(m|l)ice$/i]},gv=/s$/,fm=function(o){return!mm.isSingular.find(t=>t.test(o))&&(gv.test(o)===!0||!!mm.isPlural.find(t=>t.test(o))||null)},hm={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"},vv=function(o){let t=o.text("text").trim();return hm.hasOwnProperty(t)?(o.replaceWith(hm[t],!0),void o.tag("Possessive","toPossessive")):/s$/.test(t)?(t+="'",o.replaceWith(t,!0),void o.tag("Possessive","toPossessive")):(t+="'s",o.replaceWith(t,!0),void o.tag("Possessive","toPossessive"))},bm=function(o){let t={main:o};if(o.has("#Noun (of|by|for) .")){let e=o.splitAfter("[#Noun+]",0);t.main=e.eq(0),t.post=e.eq(1)}return t},Cv={json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0];r.article=pm(n),e.push(r)}),t!==null?e[t]:e},adjectives:function(){let o=this.lookAhead("^(that|who|which)? (was|is|will)? be? #Adverb? #Adjective+");return o=o.concat(this.lookBehind("#Adjective+ #Adverb?$")),o=o.match("#Adjective"),o.sort("index")},isPlural:function(){return this.if("#Plural")},hasPlural:function(){return this.filter(o=>Ao(o))},toPlural:function(o){let t=this.world.transforms.toPlural;return this.forEach(e=>{if(e.has("#Plural")||Ao(e)===!1)return;let n=bm(e).main,r=n.text("reduced");if((n.has("#Singular")||fm(r)!==!0)&&(r=t(r,this.world),n.replace(r).tag("#Plural"),o)){let a=n.lookBefore("(an|a) #Adjective?$").not("#Adjective");a.found===!0&&a.remove()}}),this},toSingular:function(o){let t=this.world.transforms.toSingular;return this.forEach(e=>{if(e.has("^#Singular+$")||Ao(e)===!1)return;let n=bm(e).main,r=n.text("reduced");if((n.has("#Plural")||fm(r)===!0)&&(r=t(r,this.world),n.replace(r).tag("#Singular"),o)){let a=e,i=e.lookBefore("#Adjective");i.found&&(a=i);let s=pm(a);a.insertBefore(s)}}),this},toPossessive:function(){return this.forEach(o=>{vv(o)}),this}},Nv=function(o){class t extends o{}return Object.assign(t.prototype,Cv),o.prototype.nouns=function(e,n={}){let r=this.match("(#City && @hasComma) (#Region|#Country)"),a=this.not(r).splitAfter("@hasComma");a=a.concat(r);let i=a.quotations();return i.found&&(a=a.splitOn(i.eq(0))),a=a.match("#Noun+ (of|by)? the? #Noun+?"),n.keep_anaphora!==!0&&(a=a.not("#Pronoun"),a=a.not("(there|these)"),a=a.not("(#Month|#WeekDay)"),a=a.not("(my|our|your|their|her|his)")),a=a.not("(of|for|by|the)$"),typeof e=="number"&&(a=a.get(e)),new t(a.list,this,this.world)},o},ym=/\(/,gm=/\)/,Tv=function(o){class t extends o{unwrap(){return this.list.forEach(n=>{let r=n.terms(0);r.pre=r.pre.replace(ym,"");let a=n.lastTerm();a.post=a.post.replace(gm,"")}),this}}return o.prototype.parentheses=function(e){let n=[];return this.list.forEach(r=>{let a=r.terms();for(let i=0;i<a.length;i+=1){let s=a[i];if(ym.test(s.pre)){for(let l=i;l<a.length;l+=1)if(gm.test(a[l].post)){let u=l-i+1;n.push(r.buildFrom(s.id,u)),i=l;break}}}}),typeof e=="number"?(n=n[e]?[n[e]]:[],new t(n,this,this.world)):new t(n,this,this.world)},o},Vv=function(o){class t extends o{constructor(n,r,a){super(n,r,a),this.contracted=null}strip(){return this.list.forEach(n=>{n.terms().forEach(r=>{let a=r.text.replace(/'s$/,"");r.set(a||r.text)})}),this}}return o.prototype.possessives=function(e){let n=this.match("#Noun+? #Possessive");return typeof e=="number"&&(n=n.get(e)),new t(n.list,this,this.world)},o},vm={'"':'"',"\uFF02":"\uFF02","'":"'","\u201C":"\u201D","\u2018":"\u2019","\u201F":"\u201D","\u201B":"\u2019","\u201E":"\u201D","\u2E42":"\u201D","\u201A":"\u2019","\xAB":"\xBB","\u2039":"\u203A","\u2035":"\u2032","\u2036":"\u2033","\u2037":"\u2034","\u301D":"\u301E","`":"\xB4","\u301F":"\u301E"},Cm=RegExp("("+Object.keys(vm).join("|")+")"),xv=function(o){class t extends o{unwrap(){return this}}return o.prototype.quotations=function(e){let n=[];return this.list.forEach(r=>{let a=r.terms();for(let i=0;i<a.length;i+=1){let s=a[i];if(Cm.test(s.pre)){let l=(s.pre.match(Cm)||[])[0],u=vm[l];for(let c=i;c<a.length;c+=1)if(a[c].post.indexOf(u)!==-1){let d=c-i+1;n.push(r.buildFrom(s.id,d)),i=c;break}}}}),typeof e=="number"?(n=n[e]?[n[e]]:[],new t(n,this,this.world)):new t(n,this,this.world)},o.prototype.quotes=o.prototype.quotations,o},Mn=function(o,t){let e=o.verb,n=e.text("reduced");if(e.has("#Infinitive"))return n;let r=null;return e.has("#PastTense")?r="PastTense":e.has("#Gerund")?r="Gerund":e.has("#PresentTense")?r="PresentTense":e.has("#Participle")?r="Participle":e.has("#Actor")&&(r="Actor"),t.transforms.toInfinitive(n,t,r)},_n=function(o){let t=o.verb;if(t.has("(are|were|does)")||o.auxiliary.has("(are|were|does)"))return!0;if(t.has("(is|am|do|was)")||o.auxiliary.has("(is|am|do|was)"))return!1;let e=function(n){return n.lookBehind("#Noun+").last()}(t);return!!e.has("(we|they|you)")||!!e.has("#Plural")||!e.has("#Singular")&&null},wv=function(o,t){let e=o.verb;if(!o.negative.found){if(o.auxiliary.found)return o.auxiliary.eq(0).append("not"),void(o.auxiliary.has("#Modal have not")&&o.auxiliary.replace("have not","not have"));if(e.has("(#Copula|will|has|had|do)"))e.append("not");else{if(e.has("#PastTense")){let n=Mn(o,t);return e.replaceWith(n,!0),void e.prepend("did not")}if(e.has("#PresentTense")){let n=Mn(o,t);return e.replaceWith(n,!0),void(_n(o)?e.prepend("do not"):e.prepend("does not"))}if(e.has("#Gerund")){let n=Mn(o,t);return e.replaceWith(n,!0),void e.prepend("not")}_n(o)?e.prepend("does not"):e.prepend("do not")}}},Nm=function(o){let t=o.lookBehind(),e=t.nouns(null,{keep_anaphora:!0}).last();return e.found||(e=t.match("(that|this|each)").last(),e=e.tag("#Noun").nouns()),e},Me=function(o){let t={adverb:o.match("#Adverb+"),negative:o.match("#Negative"),auxiliary:o.match("#Auxiliary+").not("(#Negative|#Adverb)"),particle:o.match("#Particle"),verb:o.match("#Verb+").not("(#Adverb|#Negative|#Auxiliary|#Particle)"),original:o,subject:Nm(o)};if(!t.verb.found)return Object.keys(t).forEach(e=>{t[e]=t[e].not(".")}),t.verb=o,t;if(t.adverb&&t.adverb.found){let e=t.adverb.text("reduced")+"$";o.has(e)&&(t.adverbAfter=!0)}return t},Dv=o=>{let t=!1,e=_n(o),n=o.negative.found;o.verb.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(t=!0);let r={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return t===!0&&(r.PresentTense="am",r.Infinitive="am"),e&&(r.PastTense="were",r.PresentTense="are",r.Infinitive="are"),n&&(r.PastTense+=" not",r.PresentTense+=" not",r.FutureTense="will not be",r.Infinitive+=" not",r.PerfectTense="not "+r.PerfectTense,r.Pluperfect="not "+r.Pluperfect,r.Gerund="not "+r.Gerund),r},Av=function(o){let t=o.verb.text();return{PastTense:t+" have",PresentTense:t,FutureTense:t,Infinitive:t}},wt=function(o,t){let e=o.verb;if(e.has("#Copula")||e.out("normal")==="be"&&o.auxiliary.has("will"))return Dv(o);if(o.auxiliary.has("are")&&e.has("#Gerund")){let s=o.original.clone(),l=s.clone().replace("are","were"),u=s.clone().replace("are","will be"),c=Mn(o,t);return{PastTense:l.text(),PresentTense:s.text(),FutureTense:u.text(),Infinitive:c}}if(e.has("#Modal"))return Av(o);let n=o.verb.termList(0).hasHyphen(),r=Mn(o,t);if(!r)return{};let a=t.transforms.conjugate(r,t);if(a.Infinitive=r,o.particle.found){let s=o.particle.text(),l=n===!0?"-":" ";Object.keys(a).forEach(u=>a[u]+=l+s)}let i=o.negative.found;return i&&(a.PastTense="did not "+a.Infinitive,a.PresentTense="does not "+a.Infinitive,a.Gerund="not "+a.Gerund),a.FutureTense||(a.FutureTense=i?"will not "+a.Infinitive:"will "+a.Infinitive),i&&(a.Infinitive="not "+a.Infinitive),a},Sv={useParticiple:function(o){return!!o.auxiliary.has("(could|should|would|may|can|must)")||!!o.auxiliary.has("am .+? being")||!!o.auxiliary.has("had .+? been")},toParticiple:function(o,t){if(o.auxiliary.has("(have|had)")&&o.verb.has("#Participle"))return;let e=wt(o,t),n=e.Participle||e.PastTense;n&&o.verb.replaceWith(n,!1),o.auxiliary.has("am .+? being")&&(o.auxiliary.remove("am"),o.auxiliary.replace("being","have been")),o.auxiliary.has("have")||o.auxiliary.append("have"),o.verb.tag("Participle","toParticiple"),o.auxiliary.replace("can","could"),o.auxiliary.replace("be have","have been"),o.auxiliary.replace("not have","have not"),o.auxiliary.tag("Auxiliary")}},{toParticiple:Tm,useParticiple:Vm}=Sv,So=function(o){return o.auxiliary.remove("(will|are|am|being)"),o.auxiliary.remove("(did|does)"),o.auxiliary.remove("(had|has|have)"),o.particle.remove(),o.negative.remove(),o},Iv={json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0],a=Me(n);r.parts={},Object.keys(a).forEach(i=>{a[i]&&a[i].isA==="Doc"?r.parts[i]=a[i].text("normal"):r.parts[i]=a[i]}),r.isNegative=n.has("#Negative"),r.conjugations=wt(a,this.world),e.push(r)}),t!==null?e[t]:e},adverbs:function(){let o=[];this.forEach(e=>{let n=Me(e).adverb;n.found&&(o=o.concat(n.list))});let t=this.lookBehind("#Adverb+$");return t.found&&(o=t.list.concat(o)),t=this.lookAhead("^#Adverb+"),t.found&&(o=o.concat(t.list)),this.buildFrom(o)},isPlural:function(){let o=[];return this.forEach(t=>{let e=Me(t);_n(e,this.world)===!0&&o.push(t.list[0])}),this.buildFrom(o)},isSingular:function(){let o=[];return this.forEach(t=>{let e=Me(t);_n(e,this.world)===!1&&o.push(t.list[0])}),this.buildFrom(o)},conjugate:function(){let o=[];return this.forEach(t=>{let e=Me(t),n=wt(e,this.world);o.push(n)}),o},toPastTense:function(){return this.forEach(o=>{let t=Me(o);if(Vm(t))return void Tm(t,this.world);if(o.has("#Imperative")||o.has("be")&&o.lookBehind("to$").found)return;if(t.verb.has("#Gerund")&&t.auxiliary.has("(is|will|was)"))return void o.replace("is","was");let e=wt(t,this.world).PastTense;e&&(t=So(t),t.verb.replaceWith(e,!1))}),this},toPresentTense:function(){return this.forEach(o=>{let t=Me(o),e=wt(t,this.world),n=e.PresentTense;if(o.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(n=e.Infinitive),n){if(t.auxiliary.has("(have|had) been"))return t.auxiliary.replace("(have|had) been","am being"),void(e.Particle&&(n=e.Particle||e.PastTense));t.verb.replaceWith(n,!1),t.verb.tag("PresentTense"),t=So(t),t.auxiliary.remove("#Modal")}}),this},toFutureTense:function(){return this.forEach(o=>{let t=Me(o);if(Vm(t))return;let e=wt(t,this.world).FutureTense;e&&(t=So(t),t.auxiliary.remove("#Modal"),t.verb.replaceWith(e,!1),t.verb.tag("FutureTense"))}),this},toInfinitive:function(){return this.forEach(o=>{let t=Me(o),e=wt(t,this.world).Infinitive;e&&(o.replaceWith(e,!1),o.tag("Infinitive"))}),this},toGerund:function(){return this.forEach(o=>{let t=Me(o),e=wt(t,this.world).Gerund;e&&(o.replaceWith(e,!1),o.tag("Gerund"))}),this},toParticiple:function(){return this.forEach(o=>{let t=Me(o),e=!t.auxiliary.found;Tm(t,this.world),e&&(t.verb.prepend(t.auxiliary.text()),t.auxiliary.remove())}),this},isNegative:function(){return this.if("#Negative")},isPositive:function(){return this.ifNo("#Negative")},isImperative:function(){return this.if("#Imperative")},toNegative:function(){return this.list.forEach(o=>{let t=this.buildFrom([o]),e=Me(t);wv(e,t.world)}),this},toPositive:function(){let o=this.match("do not #Verb");return o.found&&o.remove("do not"),this.remove("#Negative")},subject:function(){let o=[];return this.forEach(t=>{let e=Nm(t);e.list[0]&&o.push(e.list[0])}),this.buildFrom(o)}},Ov=[dv,mv,fv,hv,bv,Nv,Tv,Vv,xv,function(o){class t extends o{}return Object.assign(t.prototype,Iv),t.prototype.negate=t.prototype.toNegative,o.prototype.verbs=function(e){let n=this.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+");n=n.not("^#Adverb+"),n=n.not("#Adverb+$");let r=n.match("(#Adverb && @hasComma) #Adverb"),a=n.not(r).splitAfter("@hasComma"),i=a.match("#PastTense #Gerund");return i.has("(been|am|#Auxiliary) #Gerund")||(a=a.splitBefore(i.match("#Gerund"))),a=a.concat(r),a.sort("index"),a=a.if("#Verb"),a.has("(is|was)$")&&(a=a.splitBefore("(is|was)$")),a.has("#PresentTense #Adverb #PresentTense")&&(a=a.splitBefore("#Adverb #PresentTense")),typeof e=="number"&&(a=a.get(e)),new t(a.list,this,this.world)},o},function(o){class t extends o{}return o.prototype.people=function(e){let n=this.splitAfter("@hasComma");return n=n.match("#Person+"),typeof e=="number"&&(n=n.get(e)),new t(n.list,this,this.world)},o}],kv=function(o){return Object.keys(No).forEach(t=>o.prototype[t]=No[t]),Ov.forEach(t=>t(o)),o},xm={misc:ig,selections:No},tt=class{constructor(t,e,n){this.list=t,Object.defineProperty(this,"from",{enumerable:!1,value:e,writable:!0}),n===void 0&&e!==void 0&&(n=e.world),Object.defineProperty(this,"world",{enumerable:!1,value:n,writable:!0}),Object.defineProperty(this,"_cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"found",{get:()=>this.list.length>0}),Object.defineProperty(this,"length",{get:()=>this.list.length}),Object.defineProperty(this,"isA",{get:()=>"Doc"})}tagger(){return cv(this)}pool(){return this.list.length>0?this.list[0].pool:this.all().list[0].pool}};tt.prototype.buildFrom=function(o){return o=o.map(t=>t.clone(!0)),new tt(o,this,this.world)},tt.prototype.fromText=function(o){let t=ot(o,this.world,this.pool());return this.buildFrom(t)},Object.assign(tt.prototype,xm.misc),Object.assign(tt.prototype,xm.selections),kv(tt);var wm={untag:"unTag",and:"match",notIf:"ifNo",only:"if",onlyIf:"if"};Object.keys(wm).forEach(o=>tt.prototype[o]=tt.prototype[wm[o]]);var Wr=tt,Pv=function(o){let t=o.termList();return To(t,o.world),o.world.taggers.forEach(e=>{e(o)}),o},Rv=function o(t){let e=t,n=function(r="",a){a&&e.addWords(a);let i=ot(r,e),s=new Wr(i,null,e);return s.tagger(),s};return n.tokenize=function(r="",a){let i=e;a&&(i=i.clone(),i.words={},i.addWords(a));let s=ot(r,i),l=new Wr(s,null,i);return(a||l.world.taggers.length>0)&&Pv(l),l},n.extend=function(r){return r(Wr,e,this,po,uo,mo),this},n.fromJSON=function(r){let a=ny(r,e);return new Wr(a,null,e)},n.clone=function(){return o(e.clone())},n.verbose=function(r=!0){return e.verbose(r),this},n.world=function(){return e},n.parseMatch=function(r,a){return Ve(r,a)},n.version="13.11.1",n.import=n.load,n.plugin=n.extend,n}(new Py),Ur=Rv;var Bv=function(o,t){let e=o.match("#Value+? #Money+ #Currency+ (and #Money+ #Currency+)+?");return o.match("#Money").forEach(n=>{n.lookAfter("#Currency").found||(e=e.concat(n))}),typeof t=="number"&&(e=e.get(t)),e},Dt="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty",Fv=function(o,t){let e=o.match("#Value+");if(e.has("#NumericValue #NumericValue")&&(e.has("#Value @hasComma #Value")?e.splitAfter("@hasComma"):e.has("#NumericValue #Fraction")?e.splitAfter("#NumericValue #Fraction"):e=e.splitAfter("#NumericValue")),e.has("#Value #Value #Value")&&!e.has("#Multiple")&&e.has("("+Dt+") #Cardinal #Cardinal")&&(e=e.splitAfter("("+Dt+") #Cardinal")),e.has("#Value #Value")){e.has("#NumericValue #NumericValue")&&(e=e.splitOn("#Year")),e.has("("+Dt+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(e=e.splitAfter("("+Dt+")"));let n=e.match("#Cardinal #Cardinal");if(n.found&&!e.has("(point|decimal|#Fraction)")&&!n.has("#Cardinal (#Multiple|point|decimal)")){let r=e.has(`(one|two|three|four|five|six|seven|eight|nine) (${Dt})`),a=n.has("("+Dt+") #Cardinal"),i=n.has("#Multiple #Value");r||a||i||n.terms().forEach(s=>{e=e.splitOn(s)})}e.match("#Ordinal #Ordinal").match("#TextValue").found&&!e.has("#Multiple")&&(e.has("("+Dt+") #Ordinal")||(e=e.splitAfter("#Ordinal"))),e.has("#Ordinal #Cardinal")&&(e=e.splitBefore("#Cardinal+")),e.has("#TextValue #NumericValue")&&!e.has("("+Dt+"|#Multiple)")&&(e=e.splitBefore("#NumericValue+"))}return e.has("#NumberRange")&&(e=e.splitAfter("#NumberRange")),typeof t=="number"&&(e=e.get(t)),e},Lv=function(o,t){let e=o.match("#Fraction+");return e=e.filter(n=>!n.lookBehind("#Value and$").found),typeof t=="number"&&(e=e.eq(t)),e},Ev=function(o,t){let e=o.match("#Percent+");return e=e.concat(o.match("[#Cardinal] percent",0)),typeof t=="number"&&(e=e.eq(t)),e},Mv=o=>{let t=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}];for(let e=0;e<t.length;e++)if(t[e].reg.test(o)===!0)return{amount:t[e].mult,str:o.replace(t[e].reg,"")};return{amount:1,str:o}},oe={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}},_v=(o,t)=>{if(oe.ones.hasOwnProperty(o)){if(t.ones||t.teens)return!1}else if(oe.teens.hasOwnProperty(o)){if(t.ones||t.teens||t.tens)return!1}else if(oe.tens.hasOwnProperty(o)&&(t.ones||t.teens||t.tens))return!1;return!0},$v=function(o){let t="0.";for(let e=0;e<o.length;e++){let n=o[e];if(oe.ones.hasOwnProperty(n)===!0)t+=oe.ones[n];else if(oe.teens.hasOwnProperty(n)===!0)t+=oe.teens[n];else if(oe.tens.hasOwnProperty(n)===!0)t+=oe.tens[n];else{if(/^[0-9]$/.test(n)!==!0)return 0;t+=n}}return parseFloat(t)},zv=o=>o=(o=(o=(o=(o=(o=(o=(o=o.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$]/,"")).replace(/[%$]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),Hv=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,Dm={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},Gr=o=>Object.keys(o).reduce((t,e)=>t+=o[e],0),Xr=function(o){if(Dm.hasOwnProperty(o)===!0)return Dm[o];if(o==="a"||o==="an")return 1;let t=Mv(o),e=null,n={},r=0,a=!1,i=(o=t.str).split(/[ -]/);for(let s=0;s<i.length;s++){let l=i[s];if(l=zv(l),!l||l==="and")continue;if(l==="-"||l==="negative"){a=!0;continue}if(l.charAt(0)==="-"&&(a=!0,l=l.substr(1)),l==="point")return r+=Gr(n),r+=$v(i.slice(s+1,i.length)),r*=t.amount,r;let u=l.match(Hv);if(u){let c=parseFloat(u[1].replace(/[, ]/g,"")),d=parseFloat(u[2].replace(/[, ]/g,""));d&&(r+=c/d||0)}else{if(oe.tens.hasOwnProperty(l)&&n.ones&&Object.keys(n).length===1&&(r=100*n.ones,n={}),_v(l,n)===!1)return null;if(/^[0-9\.]+$/.test(l))n.ones=parseFloat(l);else if(oe.ones.hasOwnProperty(l)===!0)n.ones=oe.ones[l];else if(oe.teens.hasOwnProperty(l)===!0)n.teens=oe.teens[l];else if(oe.tens.hasOwnProperty(l)===!0)n.tens=oe.tens[l];else if(oe.multiples.hasOwnProperty(l)===!0){let c=oe.multiples[l];if(c===e)return null;if(c===100&&i[s+1]!==void 0){let d=i[s+1];oe.multiples[d]&&(c*=oe.multiples[d],s+=1)}e===null||c<e?(r+=(Gr(n)||1)*c,e=c,n={}):(r+=Gr(n),e=c,r=(r||1)*c,n={})}}}return r+=Gr(n),r*=t.amount,r*=a?-1:1,r===0&&Object.keys(n).length===0?null:r},Am=/s$/,$n=function(o){let t=o.text("reduced");return Xr(t)},Zr={half:2,halve:2,quarter:4},Ft=function(o){let t=function(e){let n=e.text("reduced");return Zr.hasOwnProperty(n)?{numerator:1,denominator:Zr[n]}:null}(o=o.clone())||function(e){let n=e.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return n&&n[1]&&n[0]?{numerator:Number(n[1]),denominator:Number(n[2])}:null}(o)||function(e){let n=e.match("[<num>#Value+] out of every? [<den>#Value+]");if(n.found!==!0)return null;let{num:r,den:a}=n.groups();return r=$n(r),a=$n(a),typeof r=="number"&&typeof a=="number"?{numerator:r,denominator:a}:null}(o)||function(e){let n=e.match("[<num>(#Cardinal|a)+] [<dem>#Fraction+]");if(n.found!==!0)return null;let{num:r,dem:a}=n.groups();r=r.has("a")?1:$n(r);let i=a.text("reduced");return Am.test(i)&&(i=i.replace(Am,""),a.replaceWith(i)),a=Zr.hasOwnProperty(i)?Zr[i]:$n(a),typeof r=="number"&&typeof a=="number"?{numerator:r,denominator:a}:null}(o)||function(e){let n=e.match("^#Ordinal$");return n.found!==!0?null:e.lookAhead("^of .")?{numerator:1,denominator:$n(n)}:null}(o)||null;return t!==null&&t.numerator&&t.denominator&&(t.decimal=t.numerator/t.denominator,t.decimal=(e=>{let n=Math.round(1e3*e)/1e3;return n===0&&e!==0?e:n})(t.decimal)),t},Ce=function(o){let t=o.text("reduced"),e=/[0-9],[0-9]/.test(o.text("text")),n=function(s,l,u){let c=(s=s.replace(/,/g,"")).split(/^([^0-9]*)([0-9.,]*)([^0-9]*)$/);if(c&&c[2]&&l.terms().length<2){let d=parseFloat(c[2]||s);typeof d!="number"&&(d=null);let p=c[3]||"";return p!=="st"&&p!=="nd"&&p!=="rd"&&p!=="th"||(p=""),p!=="m"&&p!=="M"||(d*=1e6,p=""),p!=="k"&&p!=="k"||(d*=1e3,p=""),d=u?1/d:d,{prefix:c[1]||"",num:d,suffix:p}}return null}(t,o);if(n!==null)return n.hasComma=e,n;let r=o.match("#Fraction #Fraction+$");r=r.found===!1?o.match("^#Fraction$"):r;let a=null;r.found&&(a=Ft(r),t=(o=(o=o.not(r)).not("and$")).text("reduced"));let i=0;return t&&(i=Xr(t)||0),a&&a.decimal&&(i+=a.decimal),{hasComma:e,prefix:"",num:i,suffix:""}},Io=function(o,t,e){if(o===!1)return;let n=t.lookAhead("^(#Unit|#Noun)");n.has("(#Address|#Money|#Percent)")||t.has("#Ordinal")||(e.num===1?n.nouns().toSingular():n.has("#Singular")&&n.nouns().toPlural())},Jr=function(o){if(o<1e6)return String(o);let t;return t=typeof o=="number"?o.toFixed(0):o,t.indexOf("e+")===-1?t:t.replace(".","").split("e+").reduce(function(e,n){return e+Array(n-e.length+2).join(0)})},Yr=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],Sm=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],jv=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],qv=function(o){let t=[];if(o>100)return t;for(let e=0;e<Yr.length;e++)o>=Yr[e][1]&&(o-=Yr[e][1],t.push(Yr[e][0]));return Sm[o]&&t.push(Sm[o]),t},zn=function(o){if(o===0||o==="0")return"zero";o>1e21&&(o=Jr(o));let t=[];o<0&&(t.push("minus"),o=Math.abs(o));let e=function(n){let r=n,a=[];return jv.forEach(i=>{if(n>=i[0]){let s=Math.floor(r/i[0]);r-=s*i[0],s&&a.push({unit:i[1],count:s})}}),a}(o);for(let n=0;n<e.length;n++){let r=e[n].unit;r==="one"&&(r="",t.length>1&&t.push("and")),t=t.concat(qv(e[n].count)),t.push(r)}return t=t.concat((n=>{let r=["zero","one","two","three","four","five","six","seven","eight","nine"],a=[],i=Jr(n).match(/\.([0-9]+)/);if(!i||!i[0])return a;a.push("point");let s=i[0].split("");for(let l=0;l<s.length;l++)a.push(r[s[l]]);return a})(o)),t=t.filter(n=>n),t.length===0&&(t[0]=""),t.join(" ")},Kv=function(o){if(!o&&o!==0)return null;let t=o%100;if(t>10&&t<20)return String(o)+"th";let e={0:"th",1:"st",2:"nd",3:"rd"},n=Jr(o),r=n.slice(n.length-1,n.length);return n+=e[r]?e[r]:"th",n},Im={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"},Om=o=>{let t=zn(o).split(" "),e=t[t.length-1];return Im.hasOwnProperty(e)?t[t.length-1]=Im[e]:t[t.length-1]=e.replace(/y$/,"i")+"th",t.join(" ")},km={"\xA2":"cents",$:"dollars","\xA3":"pounds","\xA5":"yen","\u20AC":"euros","\u20A1":"col\xF3n","\u0E3F":"baht","\u20AD":"kip","\u20A9":"won","\u20B9":"rupees","\u20BD":"ruble","\u20BA":"liras"},Pm={"%":"percent",s:"seconds",cm:"centimetres",km:"kilometres"},Wv={usd:!0,eur:!0,jpy:!0,gbp:!0,cad:!0,aud:!0,chf:!0,cny:!0,hkd:!0,nzd:!0,kr:!0,rub:!0},Rm=function(o){return km.hasOwnProperty(o.prefix)&&(o.suffix+=km[o.prefix],o.prefix=""),Pm.hasOwnProperty(o.suffix)&&(o.suffix=Pm[o.suffix]),Wv.hasOwnProperty(o.suffix)&&(o.suffix=o.suffix.toUpperCase()),o.suffix&&(o.suffix=" "+o.suffix),o},_e=function(o,t,e){let n=String(o.num);return t?(o=Rm(o),e?(n=Om(n),`${o.prefix||""}${n}${o.suffix||""}`):(n=zn(n),`${o.prefix||""}${n}${o.suffix||""}`)):e?(n=Kv(n),`${(o=Rm(o)).prefix||""}${n}${o.suffix||""}`):(o.hasComma===!0&&(n=o.num.toLocaleString()),n=Jr(n),`${o.prefix||""}${n}${o.suffix||""}`)},je={json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0],a=Ce(n);r.prefix=a.prefix,r.number=a.num,r.suffix=a.suffix,r.cardinal=_e(a,!1,!1),r.ordinal=_e(a,!1,!0),r.textCardinal=_e(a,!0,!1),r.textOrdinal=_e(a,!0,!0),e.push(r)}),t!==null?e[t]:e},units:function(){let o=this.lookAhead("(#Unit|#Noun)+");return o=o.splitAfter("@hasComma").first(),o=o.not("#Pronoun"),o.first()},isOrdinal:function(){return this.if("#Ordinal")},isCardinal:function(){return this.if("#Cardinal")},toNumber:function(){return this.forEach(o=>{let t=Ce(o);if(t.num===null)return;let e=_e(t,!1,o.has("#Ordinal"));o.replaceWith(e,!0),o.tag("NumericValue")}),this},toLocaleString:function(){return this.forEach(o=>{let t=Ce(o);if(t.num===null)return;t.num=t.num.toLocaleString();let e=_e(t,!1,o.has("#Ordinal"));o.replaceWith(e,!0)}),this},toText:function(){return this.forEach(o=>{let t=Ce(o);if(t.num===null)return;let e=_e(t,!0,o.has("#Ordinal"));o.replaceWith(e,!0),o.tag("TextValue")}),this},toCardinal:function(o){return this.if("#Ordinal").forEach(t=>{let e=Ce(t);if(e.num===null)return;let n=_e(e,t.has("#TextValue"),!1);if(t.has("#NumberRange")){let r=t.termList()[0];r.text&&r.post===""&&(r.post=" ")}t.replaceWith(n,!0),t.tag("Cardinal"),Io(o,t,e)}),this},toOrdinal:function(){return this.if("#Cardinal").forEach(o=>{let t=Ce(o);if(t.num===null)return;let e=_e(t,o.has("#TextValue"),!0);if(o.has("#NumberRange")){let r=o.termList()[0];r.text&&r.post===""&&(r.post=" ")}o.replaceWith(e,!0),o.tag("Ordinal");let n=this.lookAhead("^#Plural");n.found&&n.nouns().toSingular()}),this},isEqual:function(o){return this.filter(t=>Ce(t).num===o)},greaterThan:function(o){return this.filter(t=>Ce(t).num>o)},lessThan:function(o){return this.filter(t=>Ce(t).num<o)},between:function(o,t){return this.filter(e=>{let n=Ce(e).num;return n>o&&n<t})},set:function(o,t){return o===void 0||(typeof o=="string"&&(o=Xr(o)),this.forEach(e=>{let n=Ce(e);if(n.num=o,n.num===null)return;let r=_e(n,e.has("#TextValue"),e.has("#Ordinal"));(e=e.not("#Currency")).replaceWith(r,!0),Io(t,e,n)})),this},add:function(o,t){return o?(typeof o=="string"&&(o=Xr(o)),this.forEach(e=>{let n=Ce(e);if(n.num===null)return;n.num+=o;let r=_e(n,e.has("#TextValue"),e.has("#Ordinal"));(e=e.not("#Currency")).replaceWith(r,!0),Io(t,e,n)}),this):this},subtract:function(o,t){return this.add(-1*o,t)},increment:function(o){return this.add(1,o),this},decrement:function(o){return this.add(-1,o),this},romanNumerals:function(o){let t=this.match("#RomanNumeral").numbers();return typeof o=="number"&&(t=t.get(o)),t},normalize:function(){let o={"%":!0};return this.forEach(t=>{let e=Ce(t);if(e.num!==null&&e.suffix&&o[e.suffix]!==!0){let n=e.prefix||"";t=t.replaceWith(n+e.num+" "+e.suffix)}}),this},get:function(o){let t=[];return this.forEach(e=>{t.push(Ce(e).num)}),o!==void 0?t[o]||null:t||null}};je.toNice=je.toLocaleString,je.isBetween=je.between,je.minus=je.subtract,je.plus=je.add,je.equals=je.isEqual;var Uv=je,Oo=function(o){let t=Ce(o).num;return typeof t=="number"?t/100:null},Gv={get:function(o){let t=[];return this.forEach(e=>{let n=Oo(e);n!==null&&t.push(n)}),o!==void 0?t[o]||null:t||null},json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0],a=Oo(n);if(r.number=a,a!==null){let i=100*a;r.textNumber=`${i} percent`,r.cardinal=`${i}%`}e.push(r)}),t!==null?e[t]||{}:e},toFraction:function(){return this.forEach(o=>{let t=Oo(o);if(t!==null){t*=100,t=Math.round(100*t)/100;let e=`${t}/100`;this.replace(o,e)}}),this}},Hn=[{dem:"american",name:"dollar",iso:"usd",sub:"cent",sym:["$","US$","U$"]},{name:"euro",iso:"eur",sub:"cent",sym:["\u20AC"]},{dem:"british",name:"pound",iso:"gbp",sub:"penny",alias:{sterling:!0},sym:["\xA3"]},{name:"renminbi",iso:"cny",plural:"yu\xE1n",alias:{yuan:!0},sym:["\u5143"]},{dem:"japanese",name:"yen",iso:"jpy",sub:"sen",sym:["\xA5","\u5186","\u5713"]},{dem:"swedish",name:"krona",iso:"sek",sub:"\xF6re",alias:{ore:!0,kronor:!0},sym:["kr"]},{dem:"estonian",name:"kroon",iso:"eek",sub:"sent",sym:["kr"]},{dem:"norwegian",name:"krone",iso:"nok",sub:"\xF8re",sym:["kr"]},{dem:"icelandic",name:"kr\xF3na",iso:"isk",sym:["kr"]},{dem:"danish",name:"krone",iso:"dkk",sub:"\xF8re",sym:["kr."]},{dem:"zambian",name:"kwacha",iso:"zmw",sub:"ngwee",sym:["K"]},{dem:"malawian",name:"kwacha",iso:"mwk",sub:"tambala",sym:["K"]},{dem:"greek",name:"drachma",iso:"grd",sub:"lept\u03BFn",sym:["\u0394\u03C1\u03C7.","\u0394\u03C1.","\u20AF"]},{dem:"eastern caribbean",name:"dollar",iso:"xcd",sub:"cent",sym:["$"]},{dem:"finnish",name:"markka",iso:"fim",sub:"penni",sym:["mk"]},{dem:"polish",name:"z\u0142oty",iso:"pln",sub:"grosz",sym:["z\u0142"]},{dem:"slovenian",name:"tolar",iso:"sit",sub:"stotin",sym:[]},{dem:"australian",name:"dollar",iso:"aud",sub:"cent",sym:["$","A$","AU$"]},{dem:"deutsche",name:"mark",iso:"dem",sub:"pfennig",sym:["DM"]},{dem:"thai",name:"baht",iso:"thb",sub:"satang",sym:["\u0E3F"]},{dem:"canadian",name:"dollar",iso:"cad",sub:"cent",sym:["$","Can$","C$","CA$","CAD"]},{dem:"mexican",name:"peso",iso:"mxn",sub:"centavo",sym:["$","Mex$"]},{dem:"spanish",name:"peseta",iso:"esp",sub:"c\xE9ntimo",sym:["Pta"]},{dem:"new zealand",name:"dollar",iso:"nzd",sub:"cent",sym:["$","NZ$"]},{dem:"chilean",name:"peso",iso:"clp",sub:"centavo",sym:["Cifr\xE3o","$"]},{dem:"nigerian",name:"naira",iso:"ngn",sub:"kobo",sym:["\u20A6"]},{dem:"austrian",name:"schilling",iso:"ats",sub:"groschen",sym:["S","\xF6S"]},{dem:"guatemalan",name:"quetzal",iso:"gtq",sub:"centavo",sym:["Q"]},{dem:"philippine",name:"peso",iso:"php",sub:"sentimo",sym:["\u20B1"]},{dem:"hungarian",name:"forint",iso:"huf",sym:["Ft"]},{dem:"russian",name:"ruble",iso:"rub",sub:"kopeyka",sym:["\u20BD","\u0440\u0443\u0431","\u0440."]},{dem:"kuwaiti",name:"dinar",iso:"kwd",sub:"fils",sym:["\u062F.\u0643","KD"]},{dem:"israeli",name:"new shekel",iso:"ils",sub:"agora",sym:["\u20AA"]},{dem:"latvian",name:"lats",iso:"lvl",sub:"sant\u012Bms",sym:["Ls"]},{dem:"kazakhstani",name:"tenge",iso:"kzt",sub:"t\u0131yn",sym:["\u20B8"]},{dem:"iraqi",name:"dinar",iso:"iqd",sub:"fils",sym:["\u062F.\u0639"]},{dem:"bahamian",name:"dollar",iso:"bsd",sub:"cent",sym:["$","B$"]},{dem:"seychellois",name:"rupee",iso:"scr",sub:"cent",sym:["SCR","SR"]},{dem:"albanian",name:"lek",iso:"all",sub:"qindark\xEB",sym:["L"]},{dem:"bulgarian",name:"lev",iso:"bgn",sub:"stotinka",sym:["\u043B\u0432."]},{dem:"irish",name:"pound",iso:"iep",sym:["\xA3","IR\xA3"]},{name:"cfp franc",iso:"xpf",sym:["f"]},{dem:"south african",name:"rand",iso:"zar",sub:"cent",sym:["R"]},{dem:"south korean",name:"won",iso:"krw",sub:"jeon",plural:"won",sym:["\u20A9"]},{dem:"north korean",name:"won",iso:"kpw",sub:"chon",plural:"won",sym:["\u20A9"]},{dem:"portuguese",name:"escudo",iso:"pte",sub:"centavo",sym:[]},{dem:"ghanaian",name:"cedi",iso:"ghs",sub:"pesewa",sym:["GH\u20B5"]},{dem:"hong kong",name:"dollar",iso:"hkd",sub:"\u6BEB",sym:["$"]},{dem:"new taiwan",name:"dollar",iso:"twd",sub:"dime",sym:["NT$"]},{dem:"east german",name:"mark",iso:"ddm",sub:"pfennig",sym:["M"]},{dem:"namibian",name:"dollar",iso:"nad",sub:"cent",sym:["$"]},{dem:"malaysian",name:"ringgit",iso:"myr",sub:"sen",sym:["RM"]},{dem:"swiss",name:"franc",iso:"chf",sym:["Rp."]},{dem:"panamanian",name:"balboa",iso:"pab",sub:"cent\xE9simo",sym:["B/."]},{dem:"indonesian",name:"rupiah",iso:"idr",sub:"sen",sym:["Rp"]},{dem:"brunei",name:"dollar",iso:"bnd",sub:"sen",sym:["$","B$"]},{dem:"venezuelan",name:"bol\xEDvar",iso:"vef",sub:"c\xE9ntimo",sym:["Bs.F","Bs."]},{dem:"macedonian",name:"denar",iso:"mkd",sub:"deni",sym:["den"]},{dem:"mauritanian",name:"ouguiya",iso:"mru",sub:"khoums",sym:["UM"]},{dem:"argentine",name:"peso",iso:"ars",sub:"centavo",sym:["$"]},{dem:"libyan",name:"dinar",iso:"lyd",sub:"dirham",sym:["LD","\u0644.\u062F"]},{dem:"jordanian",name:"dinar",iso:"jod",sub:"dirham",sym:["\u062F.\u0623"]},{dem:"french",name:"franc",iso:"frf",sub:"centime",sym:["F","Fr","FF","\u20A3"]},{dem:"syrian",name:"pound",iso:"syp",sub:"piastre",sym:["LS","\xA3S"]},{dem:"belize",name:"dollar",iso:"bzd",sub:"cent",sym:["$"]},{dem:"saudi",name:"riyal",iso:"sar",sub:"halalah",sym:["SAR","\u0631.\u0633"," \uFDFC"]},{dem:"surinamese",name:"dollar",iso:"srd",sub:"cent",sym:["$"]},{dem:"singapore",name:"dollar",iso:"sgd",sub:"cent",sym:["S$","$"]},{dem:"nepalese",name:"rupee",iso:"npr",sub:"paisa",sym:["\u0930\u0941 \u20A8","Re"]},{dem:"nicaraguan",name:"c\xF3rdoba",iso:"nio",sub:"centavo",sym:["C$"]},{dem:"bangladeshi",name:"taka",iso:"bdt",sub:"poysha",sym:["\u09F3"]},{dem:"indian",name:"rupee",iso:"inr",sub:"paisa",sym:["\u20B9"]},{dem:"maldivian",name:"rufiyaa",iso:"mvr",sub:"laari",sym:["Rf","MRf","MVR",".\u0783 "]},{dem:"sri lankan",name:"rupee",iso:"lkr",sub:"cents",sym:["Rs","\u0DBB\u0DD4","\u0BB0\u0BC2"]},{dem:"bhutanese",name:"ngultrum",iso:"btn",sub:"chhertum",sym:["Nu."]},{dem:"turkish",name:"lira",iso:"try",sub:"kuru\u015F",sym:["YTL"]},{dem:"serbian",name:"dinar",iso:"rsd",sub:"para",sym:["din","\u0434\u0438\u043D"]},{dem:"bosnia and herzegovina",name:"convertible mark",iso:"bam",sub:"fening",sym:["KM"]},{dem:"botswana",name:"pula",iso:"bwp",sub:"thebe",sym:["p"]},{dem:"swazi",name:"lilangeni",iso:"szl",sub:"cent",sym:["L","E"]},{dem:"lithuanian",name:"litas",iso:"ltl",sub:"centas",sym:["Lt","ct"]},{dem:"mauritian",name:"rupee",iso:"mur",sub:"cent",sym:["\u20A8"]},{dem:"pakistani",name:"rupee",iso:"pkr",sub:"paisa",sym:["\u20A8"]},{dem:"maltese",name:"lira",iso:"mtl",sub:"cent",sym:["\u20A4","Lm"]},{dem:"cypriot",name:"pound",iso:"cyp",sub:"cent",sym:["\xA3"]},{dem:"moldovan",name:"leu",iso:"mdl",sym:["l"]},{dem:"croatian",name:"kuna",iso:"hrk",sub:"lipa",sym:["kn"]},{dem:"afghan",name:"afghani",iso:"afn",sub:"pul",sym:["\u060B","Af","Afs"]},{dem:"ecuadorian",name:"sucre",iso:"ecs",sub:"centavo",sym:["S/."]},{dem:"sierra leonean",name:"leone",iso:"sll",sub:"cent",sym:["Le"]}],At={},Bm={};Hn.forEach(o=>{o.sym.forEach(t=>{At[t]=At[t]||o.iso}),At[o.iso]=At[o.iso]||o.iso,o.sub&&(Bm[o.sub]=!0)});var Fm=`(${Object.keys(Bm).join("|")})`,ko=function(o){let t=0,e=o.match(`and #Money+ ${Fm}`);if(e.found){o=o.not(e);let l=Ce(e.match("#Value+"));l&&l.num&&(t=l.num/100)}let n=Ce(o),r=n.num||0;r+=t;let a=((i=n).suffix&&At.hasOwnProperty(i.suffix)?Hn.find(l=>l.iso===At[i.suffix]):i.prefix&&At.hasOwnProperty(i.prefix)?Hn.find(l=>l.iso===At[i.prefix]):null)||function(l){let u=l.match("#Currency+");u.nouns().toSingular();let c=u.text("reduced");return Hn.find(d=>(c===`${d.dem} ${d.name}`||c===d.iso||c===d.sub||c===d.name||!(!d.alias||d.alias[c]!==!0))&&d)}(o)||{};var i;let s="";return a&&a.sym&&(s=a.sym[0],r&&o.has(`${Fm}`)&&(r/=100)),{num:r,iso:a.iso,demonym:a.dem,currency:a.name,plural:a.plural,symbol:s}},Lm=function(o=""){return o.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},Xv={get:function(o){let t=[];return this.forEach(e=>{t.push(ko(e))}),o!==void 0?t[o]||null:t||null},currency:function(o){let t=[];return this.forEach(e=>{let n=ko(e);n&&t.push(n)}),typeof o=="number"?t[o]||null:t||null},json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0],a=ko(n);if(r.number=a.num,a.iso&&(r.iso=a.iso.toUpperCase(),r.symbol=a.symbol,r.currency=Lm(a.demonym)+" "+Lm(a.currency)),r.textFmt=_e(a,!0,!1),a.currency){let i=a.currency;a.num!==1&&(i=a.plural||i+"s"),r.textFmt+=" "+i}e.push(r)}),t!==null?e[t]||{}:e}},Em=function(o){if(!o.numerator||!o.denominator)return"";let t=zn(o.numerator),e=Om(o.denominator);return o.denominator===2&&(e="half"),t&&e?(o.numerator!==1&&(e+="s"),`${t} ${e}`):""},Zv=function(o){return!o.numerator||!o.denominator?"":`${zn(o.numerator)} out of ${zn(o.denominator)}`},Mm=function(o){return o.decimal},Po={get:function(o){let t=[];return this.forEach(e=>{t.push(Ft(e))}),o!==void 0?t[o]||null:t||null},toDecimal(){return this.forEach(o=>{let t=Ft(o);if(t){let e=Mm(t);o.replaceWith(String(e),!0),o.tag("NumericValue"),o.unTag("Fraction")}}),this},json:function(o){let t=null;typeof o=="number"&&(t=o,o=null),o=o||{text:!0,normal:!0,trim:!0,terms:!0};let e=[];return this.forEach(n=>{let r=n.json(o)[0],a=Ft(n)||{},i=Mm(a);r.numerator=a.numerator,r.denominator=a.denominator,r.number=i,r.textOrdinal=Em(a),r.textCardinal=Zv(a),e.push(r)}),t!==null?e[t]||{}:e},normalize:function(){return this.forEach(o=>{let t=Ft(o);if(t&&typeof t.numerator=="number"&&typeof t.denominator=="number"){let e=`${t.numerator}/${t.denominator}`;this.replace(o,e)}}),this},toText:function(o){let t=[];return this.forEach(e=>{let n=Ft(e)||{},r=Em(n);e.replaceWith(r,!0),e.tag("Fraction")}),o!==void 0?t[o]:t},toPercentage:function(){return this.forEach(o=>{let t=Ft(o);if(t.decimal||t.decimal===0){let e=100*t.decimal;e=Math.round(100*e)/100,this.replace(o,`${e}%`)}}),this}};Po.toNumber=Po.toDecimal;var Jv=Po,Yv=function(o){return o.match("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("#Multiple","fraction-tagger"),o.match("[(half|quarter)] of? (a|an)",0).tag("Fraction","millionth"),o.match("#Adverb [half]",0).tag("Fraction","nearly-half"),o.match("[half] the",0).tag("Fraction","half-the"),o.match("#Value (halves|halfs|quarters)").tag("Fraction","two-halves"),o.match("a #Ordinal").tag("Fraction","a-quarter"),o.match("(#Fraction && /s$/)").lookBefore("#Cardinal+$").tag("Fraction"),o.match("[#Cardinal+ #Ordinal] of .",0).tag("Fraction","ordinal-of"),o.match("[(#NumericValue && #Ordinal)] of .",0).tag("Fraction","num-ordinal-of"),o.match("(a|one) #Cardinal?+ #Ordinal").tag("Fraction","a-ordinal"),o.match("#Cardinal+ out? of every? #Cardinal").tag("Fraction","fraction-tagger"),o},Qv=function(o){let t="money-tagger";o.match("#Money and #Money #Currency?").tag("Money","money-and-money"),o.match("#Money").not("#TextValue").match("/\\.[0-9]{3}$/").unTag("#Money","three-decimal money"),o.ifNo("#Value").match("#Currency #Verb").unTag("Currency","no-currency"),o.match("#Value #Currency [and] #Value (cents|ore|centavos|sens)",0).tag("Money",t);let e=o.match("[<num>#Value] [<currency>(mark|rand|won|rub|ore)]");return e.group("num").tag("Money",t),e.group("currency").tag("Currency",t),o},eC=function(o){(o=Qv(o)).match("the [/[0-9]+s$/]").tag("#Plural","number-tag"),o.match("half a? #Value").tag("Value","half-a-value"),o.match("#Value [and a (half|quarter)]",0).tag(["TextValue","#Fraction"],"value-and-a-half"),(o=Yv(o)).match("#Cardinal and #Fraction #Fraction").tag("Value","number-tag")},tC={Fraction:{isA:["Value"]},Multiple:{isA:"Value"}},_m={mark:!0,sucre:!0,leone:!0,afghani:!0,rand:!0,try:!0,mop:!0,won:!0,all:!0,rub:!0,eek:!0,sit:!0,bam:!0,npr:!0,leu:!0},Lt={kronor:"Currency"};Hn.forEach(o=>{o.iso&&!_m[o.iso]&&(Lt[o.iso]=["Acronym","Currency"]);let t=o.name;if(t&&!_m[t]&&(Lt[t]="Currency",Lt[t+"s"]="Currency"),o.dem){let e=o.dem;Lt[`${e} ${t}`]="Currency",Lt[`${e} ${t}s`]="Currency"}o.sub&&(Lt[o.sub]="Currency")});var nC=Lt,rC=function(o,t){t.addWords(nC),t.addTags(tC),t.postProcess(eC);class e extends o{}Object.assign(e.prototype,Uv);class n extends e{}Object.assign(n.prototype,Xv);class r extends e{}Object.assign(r.prototype,Jv);class a extends e{}Object.assign(a.prototype,Gv);let i={numbers:function(s){let l=Fv(this,s);return new e(l.list,this,this.world)},percentages:function(s){let l=Ev(this,s);return new a(l.list,this,this.world)},fractions:function(s){let l=Lv(this,s);return new r(l.list,this,this.world)},money:function(s){let l=Bv(this,s);return new n(l.list,this,this.world)}};return i.values=i.numbers,i.percents=i.percentages,Object.assign(o.prototype,i),o},$m=rC;Ur.extend($m);var Ro=class extends Be{static componentType="pluralize";static rendererType="text";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.pluralForm={createComponentOfType:"text",createStateVariable:"pluralForm",defaultValue:null,public:!0},e.basedOnNumber={createComponentOfType:"number",createStateVariable:"basedOnNumber",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return nt({stateVariableDefinitions:t,oldName:"value",newName:"valuePrePluralize"}),t.value={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({valuePrePluralize:{dependencyType:"stateVariable",variableName:"valuePrePluralize"},pluralForm:{dependencyType:"stateVariable",variableName:"pluralForm"},basedOnNumber:{dependencyType:"stateVariable",variableName:"basedOnNumber"}}),definition:function({dependencyValues:e}){let n=Ur(e.valuePrePluralize),r=n.values().toNumber().all().terms().json();if(r.length===0)return{newValues:{value:e.valuePrePluralize}};let a;if(e.basedOnNumber!==null&&(a=zm(e.basedOnNumber)),r.length===1)return a===void 0&&(a=!0),a?e.pluralForm!==null?{newValues:{value:e.pluralForm}}:{newValues:{value:n.nouns().toPlural().all().out("text")}}:{newValues:{value:e.valuePrePluralize}};if(a===void 0){let s=[],l=[],u=n.nouns().json();for(let[p,m]of r.entries()){let f=u[s.length];m.terms[0].tags.includes("Value")&&l.push(p),f!==void 0&&f.text===m.text&&s.push(p)}a=[];let c=n.values().numbers().json(),d=-1;for(let p of s){for(;Number(l[d+1])<Number(p);)d++;c[d]&&zm(Number(c[d].normal))?a.push(!0):a.push(!1)}}if(a===!1)return{newValues:{value:e.valuePrePluralize}};let i=Ur(e.valuePrePluralize);if(e.pluralForm!==null)for(let[s,l]of n.nouns().data().entries())(a===!0||a[s]===!0)&&i.replace(l.text,e.pluralForm);else{let s=n.nouns().json().length;for(let l=0;l<s;l++)(a===!0||a[l]===!0)&&i.nouns(l).toPlural().all()}return{newValues:{value:i.out("text")}}}},t}},Hm=Ro;function zm(o){return o!==1}var Bo=class extends X{static componentType="feedback";static renderChildren=!0;static primaryStateVariableForDefinition="feedbackText";static get stateVariablesShadowedForReference(){return["hide"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return delete e.hide,e.condition={createComponentOfType:"condition"},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={forRenderer:!0,returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.condition===null?n=!1:n=!e.condition.stateValues.value,{newValues:{hide:n}}}},t.feedbackText={forRenderer:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{feedbackText:{variablesToCheck:["feedbackText"]}}})},t}},jm=Bo;var Fo=class extends X{static componentType="container";static renderChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}},qm=Fo;var Lo=class extends B{static componentType="collaborateGroups";static rendererType=void 0;static stateVariableForAttributeValue="collaborateGroups";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0}),r=Yn(i=>({componentType:"point",children:[{componentType:"coords",children:i}]})),a=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,logicToWaitOnSugar:["atLeastZeroPoints"],replacementFunction:r});return e.newOperator({name:"pointsXorSugar",operator:"xor",propositions:[a,n],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.collaborateGroups={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["xs","coords","nDimensions"]}}),definition:function({dependencyValues:e}){let n={};for(let a of e.pointChildren)if(a.stateValues.nDimensions!==2)console.warn(`invalid collaborate group: ${a.stateValues.coords.toString()}`);else{let i=a.stateValues.xs[0].evaluate_to_constant(),s=a.stateValues.xs[1].evaluate_to_constant();Number.isInteger(i)&&i>0&&Number.isInteger(s)&&s>0?(n[i]===void 0&&(n[i]=[]),n[i].push(s)):console.warn(`invalid collaborate group: ${a.stateValues.coords.toString()}`)}return{newValues:{collaborateGroups:{groups:n,matchGroup:function({groupNumber:a,numberOfGroups:i}={}){if(i>1){let s=n[i];return s===void 0?!1:s.includes(a)}else return!0}}}}}},t}},Km=Lo;var Eo=class extends B{static componentType="collaborateGroupSetup";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOnePossibleNumberOfGroups",componentType:"possibleNumberOfGroups",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.possibleNumberOfGroups={returnDependencies:()=>({pngChild:{dependencyType:"child",childLogicName:"atMostOnePossibleNumberOfGroups",variableNames:["numbers"]}}),definition:function({dependencyValues:e}){return e.pngChild.length===0?{newValues:{possibleNumberOfGroups:[1]}}:{newValues:{possibleNumberOfGroups:e.pngChild[0].stateValues.numbers}}}},t}},Wm=Eo;var Mo=class extends X{static componentType="div";static renderChildren=!0;static createAttributesObject(t){let e=super.createAttributesObject(t);return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:300,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}},Um=Mo;var _o=class extends X{static componentType="considerAsResponses";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenWithNValues={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["nValues"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{childrenWithNValues:e.children}})},t.childrenAsResponses={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["value","values","componentType"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{childrenAsResponses:e.children}})},t}},Gm=_o;var $o=class extends G{static componentType="selectByIndex";static assignNamesToReplacements=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["selectedIndices"]}static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.selectIndices={createComponentOfType:"numberList",createStateVariable:"selectIndices",defaultValue:[],public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneOption",componentType:"option",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childLogicName:"atLeastOneOption"}}),definition({dependencyValues:e}){return{newValues:{optionChildren:e.optionChildren,nOptions:e.optionChildren.length}}}},t.selectedIndices={returnDependencies:()=>({nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},selectIndices:{dependencyType:"stateVariable",variableName:"selectIndices"}}),definition:function({dependencyValues:e}){return e.nOptions===0?{newValues:{selectedIndices:[]}}:{newValues:{selectedIndices:e.selectIndices.filter(a=>Number.isInteger(a)&&a>=1&&a<=e.nOptions).map(a=>a-1)}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){let a=this.getReplacements(t,e,r);return n.previousSelectedIndices=[...t.stateValues.selectedIndices],{replacements:a}}static getReplacements(t,e,n){let r=[];for(let i of t.stateValues.selectedIndices){let s=t.stateValues.optionChildren[i].componentName,l=H(e[s].state.serializedChildren.value),u={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},e[s].doenetAttributes),children:l,originalName:s};t.stateValues.hide&&(u.state||(u.state={}),u.state.hide=!0),r.push(u)}return j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n}).serializedComponents}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:a}){if(r.previousSelectedIndices.length===t.stateValues.selectedIndices.length&&t.stateValues.selectedIndices.every((u,c)=>u===r.previousSelectedIndices[c]))return[];let i=[],s=this.getReplacements(t,n,a),l={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:s,replacementsToWithhold:0};return i.push(l),r.previousSelectedIndices=[...t.stateValues.selectedIndices],i}},Xm=$o;var zo=class extends yt{static componentType="case";static get stateVariablesShadowedForReference(){return["conditionSatisfied"]}static createAttributesObject(t){let e=super.createAttributesObject(t);return e.condition={createComponentOfType:"condition"},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.conditionSatisfied={public:!0,componentType:"boolean",returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.condition===null?n=!0:n=e.condition.stateValues.value,{newValues:{conditionSatisfied:n}}}},t}static createSerializedReplacements({component:t,componentInfoObjects:e}){return t.stateValues.conditionSatisfied?super.createSerializedReplacements({component:t,componentInfoObjects:e}):{replacements:[]}}},Zm=zo;var Ho=class extends G{static componentType="selectByCondition";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(t){let e=super.createAttributesObject(t);return e.maximumNumberToSelect={createComponentOfType:"number",createStateVariable:"maximumNumberToSelect",defaultValue:null,public:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastOneCase",componentType:"case",comparison:"atLeast",number:1}),r=e.newLeaf({name:"atMostOneElse",componentType:"else",comparison:"atMost",number:1});return e.newOperator({name:"casesAndElse",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nCases={additionalStateVariablesDefined:["caseChildren"],returnDependencies:()=>({caseChildren:{dependencyType:"child",childLogicName:"atLeastOneCase"}}),definition({dependencyValues:e}){return{newValues:{caseChildren:e.caseChildren,nCases:e.caseChildren.length}}}},t.elseChild={returnDependencies:()=>({elseChild:{dependencyType:"child",childLogicName:"atMostOneElse"}}),definition({dependencyValues:e}){let n=null;return e.elseChild.length===1&&(n=e.elseChild[0]),{newValues:{elseChild:n}}}},t.selectedIndices={returnDependencies:()=>({caseChildren:{dependencyType:"child",childLogicName:"atLeastOneCase",variableNames:["conditionSatisfied"]},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"},maximumNumberToSelect:{dependencyType:"stateVariable",variableName:"maximumNumberToSelect"}}),definition({dependencyValues:e}){let n=[];for(let[r,a]of e.caseChildren.entries())a.stateValues.conditionSatisfied&&n.push(r);if(n.length===0&&e.elseChild&&n.push(e.caseChildren.length),e.maximumNumberToSelect!==null&&n.length>e.maximumNumberToSelect){let r=Math.max(0,Math.floor(e.maximumNumberToSelect));n=n.slice(0,r)}return{newValues:{selectedIndices:n}}}},t.readyToExpandWhenResolved={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{newValues:{readyToExpandWhenResolved:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){let a=this.getReplacements(t,e,r);return n.previousSelectedIndices=[...t.stateValues.selectedIndices],{replacements:a}}static getReplacements(t,e,n){let r=[];for(let i of t.stateValues.selectedIndices){let s,l;i<t.stateValues.nCases?(s=t.stateValues.caseChildren[i].componentName,l="case"):(s=t.stateValues.elseChild.componentName,l="else");let u=H(e[s].state.serializedChildren.value),c={componentType:l,state:{rendered:!0},doenetAttributes:Object.assign({},e[s].doenetAttributes),children:u,originalName:s};e[s].attributes.newNamespace&&(c.attributes={newNamespace:!0}),r.push(c)}return j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:n}).serializedComponents}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:a}){if(r.previousSelectedIndices.length===t.stateValues.selectedIndices.length&&r.previousSelectedIndices.every((u,c)=>u===t.stateValues.selectedIndices[c]))return[];let i=[],s=this.getReplacements(t,n,a),l={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:s,replacementsToWithhold:0};return i.push(l),r.previousSelectedIndices=[...t.stateValues.selectedIndices],i}},Jm=Ho;var jo=class extends B{static componentType="_componentSize";static rendererType="number";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value","isAbsolute"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1}),r=e.newLeaf({name:"atMostOneNumber",componentType:"number",comparison:"atMost",number:1}),a=e.newOperator({name:"numberAndString",operator:"and",propositions:[r,n],requireConsecutive:!0,sequenceMatters:!0}),i=e.newLeaf({name:"atMostOneComponentSize",componentType:"_componentsize",comparison:"atMost",number:1});return e.newOperator({name:"numberAndStringXorComponentSize",operator:"xor",propositions:[a,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this.componentType;return t.value={public:!0,componentType:"number",additionalStateVariablesDefined:["isAbsolute"],returnDependencies:()=>({componentSizeChild:{dependencyType:"child",childLogicName:"atMostOneComponentSize",variableNames:["value","isAbsolute"]},numberChild:{dependencyType:"child",childLogicName:"atMostOneNumber",variableNames:["value"]},stringChild:{dependencyType:"child",childLogicName:"atMostOneString",variableNames:["value"]}}),definition({dependencyValues:n}){if(n.stringChild.length===0)return n.numberChild.length===0?n.componentSizeChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:100},isAbsolute:{variablesToCheck:"isAbsolute",defaultValue:!1}}}:{newValues:n.componentSizeChild[0].stateValues}:{newValues:{value:n.numberChild[0].stateValues.value,isAbsolute:!0}};{let r,a;if(n.numberChild.length===1)r=n.numberChild[0].stateValues.value,a=n.stringChild[0].stateValues.value.trim();else{let u=n.stringChild[0].stateValues.value.trim().match(/^(-?[\d.]+)\s*(.*)$/);if(u===null)return console.warn(e+" must begin with a number."),{newValues:{value:null,isAbsolute:!0}};r=u[1],a=u[2].trim()}if(r=Number(r),!Number.isFinite(r))return console.warn(e+" must have a number"),{newValues:{value:null,isAbsolute:!0}};if(a==="")return{newValues:{value:r,isAbsolute:!0}};let i=!(a==="%"||a==="em"),s={px:1,pixel:1,pixels:1,"%":1,em:100,in:96,inch:96,inches:96,pt:1.333333333333,mm:3.7795296,millimeter:3.7795296,millimeters:3.7795296,cm:37.795296,centimeter:37.795296,centimeters:37.795296};return s[a]===void 0?(console.warn(a+" is not a defined unit of measure."),{newValues:{value:r,isAbsolute:!0}}):{newValues:{value:s[a]*r,isAbsolute:i}}}},inverseDefinition({desiredStateVariableValues:n,dependencyValues:r}){return r.stringChild.length===0?r.numberChild.length===0?r.componentSizeChild.length===0?{success:!0,instructions:[{setStateVariable:"value",value:n.value}]}:{success:!0,instructions:[{setDependency:"componentSizeChild",desiredValue:n.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"numberChild",desiredValue:n.value,childIndex:0,variableIndex:0}]}:r.numberChild.length===1?{success:!0,instructions:[{setDependency:"numberChild",desiredValue:n.value,childIndex:0,variableIndex:0},{setDependency:"stringChild",desiredValue:"px",childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"stringChild",desiredValue:n.value+"px",childIndex:0,variableIndex:0}]}}},t.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:n})=>({newValues:{valueForDisplay:n.value}})},t}},Ym=jo;var Qr=[...Object.values(Sa),...Object.values(Ia),...Object.values(Oa),...Object.values(Ba),...Object.values(La),...Object.values(_a),...Object.values(ja),...Object.values(qa),...Object.values(Ka),...Object.values(Ua),...Object.values(Ga),...Object.values(Ya),...Object.values(ei),...Object.values(ui),...Object.values(ci),...Object.values(di),ec,tc,Be,nc,rc,ic,Ae,sc,pe,ft,ac,oc,lc,uc,cc,ur,dc,pc,mc,Qt,rn,fc,hc,yc,gc,an,vc,Cc,xc,wc,Dc,Ac,Sc,Ic,Oc,kc,Pc,Rc,tn,Fc,Lc,Ec,Mc,or,Kt,yt,sn,jc,ld,ud,cd,dd,pd,mr,qc,nd,$c,zc,Kc,Wc,Uc,Gc,Xc,Zc,Jc,Yc,Qc,ed,td,rd,ad,id,sd,fd,md,bd,Tt,vd,Cd,Td,Kd,un,Ud,Gd,Xd,Zd,Jd,Yd,Qd,ep,tp,np,rp,Hm,jm,qm,Km,Wm,Um,Gm,Xm,Zm,Jm,...Object.values(pi),B,E,X,se,he,Ye,G,Nc,Tc,pr,Vc,Ut,xn,ze,Xe,Zt,Ym,Fe,Nn,zt,rt,Tn];function Qm(){let o={},t=new Set;for(let e of Qr){let n=e.componentType;if(n.substring(0,1)!=="_"){if(n===void 0)throw Error("Cannot create component as componentType is undefined for class "+e);let r=n.toLowerCase();if(t.has(r))throw Error("component type "+n+" defined in two classes");if(!/[a-zA-Z]/.test(n.substring(0,1)))throw Error("Invalid component type "+n+". Component types must begin with a letter.");o[n]=e,t.add(r)}}return o}function ef(){let o={},t=new Set;for(let e of Qr){let n=e.componentType;if(n===void 0)throw Error("Cannot create component as componentType is undefined for class "+e);let r=n.toLowerCase();if(t.has(r))throw Error("component type "+n+" defined in two classes");o[n]=e,t.add(r)}return o}function tf(){let o={},t=new Set;for(let e of Qr)if(e.createsVariants){let n=e.componentType;if(n===void 0)throw Error("Cannot create component as componentType is undefined for class "+e);let r=n.toLowerCase();if(t.has(r))throw Error("component type "+n+" defined in two classes");o[n]=e,t.add(r)}return o}function nf(){let o={},t=new Set;for(let e of Qr)if(e.createsVariants||e.setUpVariantIfVariantControlChild||e.alwaysSetUpVariant){let n=e.componentType;if(n===void 0)throw Error("Cannot create component as componentType is undefined for class "+e);let r=n.toLowerCase();if(t.has(r))throw Error("component type "+n+" defined in two classes");o[n]=e,t.add(r)}return o}var qo=class{constructor(t){this.stack=[{}],t!==void 0&&Object.assign(this.parameters,t)}get parameters(){return this.stack[this.stack.length-1]}push(t,e=!0){let n={};e?(Object.assign(n,this.parameters),t!==void 0&&Object.assign(n,t)):n=t,this.stack.push(n)}pop(){let t=this.stack.pop();return this.stack.length===0&&(this.stack=[{}]),t}},rf=qo;var Ko=class{constructor({maxIterationsRoot:t=80,maxIterationsMinimize:e=500,eps:n=1e-6}={}){this.maxIterationsRoot=t,this.maxIterationsMinimize=e,this.eps=n}fzero(t,e,n){var r,a,i,s,l,u,c,d,p,m,f,h,y,b,g,C,T,v,N,V,x=this.eps,w=this.maxIterationsRoot,D=0,I=0;if(Array.isArray(e)){if(e.length<2)throw new Error("fzero: length of array x0 has to be at least two.");r=e[0],s=t.call(n,r),I+=1,a=e[1],l=t.call(n,a),I+=1}else{for(r=e,s=t.call(n,r),I+=1,r===0?c=1:c=r,d=[.9*c,1.1*c,c-1,c+1,.5*c,1.5*c,-c,2*c,-10*c,10*c],m=d.length,p=0;p<m&&(a=d[p],l=t.call(n,a),I+=1,!(s*l<=0));p++);a<r&&(f=r,r=a,a=f,h=s,s=l,l=h)}if(s*l>0)return Array.isArray(e)?this.fminbr(t,[r,a],n).x:this.Newton(t,r,n);for(i=r,u=s;D<w;){if(y=a-r,Math.abs(u)<Math.abs(l)&&(r=a,a=i,i=r,s=l,l=u,u=s),T=2*x*Math.abs(a)+x*.5,V=(i-a)*.5,Math.abs(V)<=T&&Math.abs(l)<=x)return a;Math.abs(y)>=T&&Math.abs(s)>Math.abs(l)&&(g=i-a,r===i?(b=l/s,v=g*b,N=1-b):(N=s/u,b=l/u,C=l/s,v=C*(g*N*(N-b)-(a-r)*(b-1)),N=(N-1)*(b-1)*(C-1)),v>0?N=-N:v=-v,v<.75*g*N-Math.abs(T*N)*.5&&v<Math.abs(y*N*.5)&&(V=v/N)),Math.abs(V)<T&&(V>0?V=T:V=-T),r=a,s=l,a+=V,l=t.call(n,a),I+=1,(l>0&&u>0||l<0&&u<0)&&(i=r,u=s),D++}return a}fminbr(t,e,n){var r,a,i,s,l,u,c,d,p,m,f,h,y,b,g,C,T=(3-Math.sqrt(5))*.5,v=this.eps,N=this.eps,V=this.maxIterationsMinimize,x=0,w=0;if(!Array.isArray(e)||e.length<2)throw new Error("Numerics.fminbr: length of array x0 has to be at least two.");if(r=e[0],a=e[1],s=r+T*(a-r),c=t.call(n,s),Number.isNaN(c))return{success:!1};for(w+=1,i=s,l=s,u=c,d=c;x<V;){if(p=a-r,m=(r+a)*.5,f=N*Math.abs(i)+v/3,Math.abs(i-m)+p*.5<=2*f)return{success:!0,x:i,fx:u,tol:f};if(h=T*(i<m?a-i:r-i),Math.abs(i-l)>=f&&(g=(i-l)*(u-c),b=(i-s)*(u-d),y=(i-s)*b-(i-l)*g,b=2*(b-g),b>0?y=-y:b=-b,Math.abs(y)<Math.abs(h*b)&&y>b*(r-i+2*f)&&y<b*(a-i-2*f)&&(h=y/b)),Math.abs(h)<f&&(h>0?h=f:h=-f),g=i+h,C=t.call(n,g),Number.isNaN(C))return{success:!1};w+=1,C<=u?(g<i?a=i:r=i,s=l,l=i,i=g,c=d,d=u,u=C):(g<i?r=g:a=g,C<=d||l===i?(s=l,l=g,c=d,d=C):(C<=c||s===i||s===l)&&(s=g,c=C)),x+=1}return{success:!1,x:i,fx:u}}Newton(t,e,n){var r,a=0,i=this.eps,s=t.apply(n,[e]),l=1;for(Array.isArray(e)&&(e=e[0]);a<50&&Math.abs(s)>i;)r=this.D(t,n)(e),l+=2,Math.abs(r)>i?e-=s/r:e+=Math.random()*.2-1,s=t.apply(n,[e]),l+=1,a+=1;return e}D(t,e){return e!=null?function(n){var r=1e-5,a=r*2;return(t(n+r)-t(n-r))/a}:function(n){var r=1e-5,a=r*2;return(t.apply(e,[n+r])-t.apply(e,[n-r]))/a}}},af=Ko;var Zo=Mt(of());import aC from"math-expressions";function Wo({ancestor:o,descendantTypes:t,recurseToMatchedChildren:e=!0,useReplacementsForComposites:n=!1,includeNonActiveChildren:r=!1,skipOverAdapters:a=!1,ignoreReplacementsOfMatchedComposites:i=!1,definingChildrenFirst:s=!1,namesToIgnore:l=[],init:u=!0,componentInfoObjects:c}){let d=h=>t.some(y=>c.isInheritedComponentType({inheritedComponentType:h.componentType,baseComponentType:y})),p=[];if(n&&c.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"_composite"}))u&&p.push(...Uo({composite:o,componentInfoObjects:c,includeComposites:r}));else{if(r&&s)for(let h of o.definingChildren)p.push(h);if(o.activeChildren)for(let[h,y]of o.activeChildren.entries())y.componentName||(y.componentName=`__placeholder_${h}`),p.map(b=>b.componentName).includes(y.componentName)||p.push(y);if(r){if(!s)for(let h of o.definingChildren)p.map(y=>y.componentName).includes(h.componentName)||p.push(h);if(o.allChildren){for(let h in o.allChildren){let y=o.allChildren[h];y.definingChildrenIndex===void 0&&y.activeChildrenIndex===void 0&&p.push(y.component)}for(let[h,y]of o.activeChildren.entries()){let b=y.adaptedFrom;b&&!b.componentName&&(b.componentName=`__placeholder_adapted_${h}`,p.map(g=>g.componentName).includes(b.componentName)||p.push(b))}}}}if(i)for(let h of p)d(h)&&c.isInheritedComponentType({inheritedComponentType:h.componentType,baseComponentType:"_composite"})&&(l=[...l,...Uo({composite:h,componentInfoObjects:c,includeComposites:!0}).map(b=>b.componentName)]);if(a){for(let[h,y]of p.entries())if(y.adaptedFrom&&!l.includes(y.componentName)){l=[...l,y.componentName];let b=p.map(g=>g.componentName).indexOf(y.adaptedFrom.componentName);b===-1?p.splice(h,1,y.adaptedFrom):s&&o.definingChildren.map(g=>g.componentName).includes(y.adaptedFrom.componentName)||(p.splice(h,1,y.adaptedFrom),p.splice(b,1,y))}}l.length>0&&(p=p.filter(h=>!l.includes(h.componentName)));let m=[],f=[];for(let h of p){let y=d(h);if(y&&m.push({componentName:h.componentName,componentType:h.componentType}),!y||e){let b=Wo({ancestor:h,descendantTypes:t,recurseToMatchedChildren:e,useReplacementsForComposites:n,includeNonActiveChildren:r,skipOverAdapters:a,ignoreReplacementsOfMatchedComposites:i,definingChildrenFirst:s,init:!1,componentInfoObjects:c});m.push(...b)}}return i&&(m=m.filter(h=>!f.includes(h))),m}function Uo({composite:o,includeComposites:t=!1,componentInfoObjects:e}){let n=[];if(o.replacements){let r;if(o.replacementsToWithhold){let a=o.replacements.length-o.replacementsToWithhold;r=o.replacements.slice(0,a)}else r=o.replacements;for(let a of r)e.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_composite"})?(t&&n.push(a),n.push(...Uo({composite:a,componentInfoObjects:e,includeComposites:t}))):n.push(a)}return n}function gn(o,t){if(o.ancestors===void 0||o.ancestors.length===0)return[];let e=[o.ancestors[0].componentName],n=t[o.ancestors[0].componentName];if(n&&e.push(...gn(n,t)),o.replacementOf){e.push(o.replacementOf.componentName);let r=gn(o.replacementOf,t);for(let a of r)e.includes(a)||e.push(a)}return e}var Q=[],Go=class{constructor({_components:t,componentInfoObjects:e,core:n}){this.upstreamDependencies={},this.downstreamDependencies={},this.switchDependencies={},this.circularCheckPassed={},this.circularResolveBlockedCheckPassed={},this.dependencyTypes={},Q.forEach(r=>this.dependencyTypes[r.dependencyType]=r),this.core=n,this._components=t,this.componentInfoObjects=e,this.updateTriggers={descendantDependenciesByAncestor:{},ancestorDependenciesByPotentialAncestor:{},replacementDependenciesByComposite:{},childDependenciesByParent:{},parentDependenciesByParent:{},dependenciesMissingComponentBySpecifiedName:{}},this.resolveBlockers={neededToResolve:{},resolveBlockedBy:{}}}setUpComponentDependencies(t){this.downstreamDependencies[t.componentName]&&this.deleteAllDownstreamDependencies({component:t}),this.downstreamDependencies[t.componentName]={},this.upstreamDependencies[t.componentName]||(this.upstreamDependencies[t.componentName]={});let e=[],n=[];for(let r in t.state)t.state[r].isArrayEntry||t.state[r].isAlias||n.includes(r)||(e.push(r),t.state[r].additionalStateVariablesDefined&&n.push(...t.state[r].additionalStateVariablesDefined));for(let r of e){let a=[r];t.state[r].additionalStateVariablesDefined&&a.push(...t.state[r].additionalStateVariablesDefined),this.setUpStateVariableDependencies({component:t,stateVariable:r,allStateVariablesAffected:a})}}setUpStateVariableDependencies({component:t,stateVariable:e,allStateVariablesAffected:n}){let r=t.state[e],a;r.stateVariablesDeterminingDependencies||r.determineIfShadowData?(a={},r.stateVariablesDeterminingDependencies&&(a.__determine_dependencies={dependencyType:"determineDependencies",variableNames:r.stateVariablesDeterminingDependencies}),r.determineIfShadowData&&(a.__determine_dependencies_shadow_data={dependencyType:"determineDependencies",componentName:r.determineIfShadowData.targetComponent.componentName,variableNames:n},r.determineIfShadowData.arraySizeStateVariableToResolve&&(a.__determine_dependencies_shadow_data_array_size={dependencyType:"determineDependencies",variableNames:[r.determineIfShadowData.arraySizeStateVariableToResolve]}))):a=r.returnDependencies({componentInfoObjects:this.componentInfoObjects,sharedParameters:t.sharedParameters});for(let i in a){let s=a[i];if(!(s.dependencyType in this.dependencyTypes))throw Error(`Unrecognized dependency type ${s.dependencyType} for ${i} of ${e} of ${t.componentName}`);new this.dependencyTypes[s.dependencyType]({component:t,stateVariable:e,allStateVariablesAffected:n,dependencyName:i,dependencyDefinition:s,dependencyHandler:this,expandComposites:!1,forceExpandComposites:!1}).checkForCircular()}}deleteAllDownstreamDependencies({component:t,stateVariables:e="__all__"}){let n=t.componentName,r;e==="__all__"?r=Object.keys(this.downstreamDependencies[n]):r=e;for(let a of r){let i=this.downstreamDependencies[n][a];for(let s in i)i[s].deleteDependency();delete this.downstreamDependencies[n][a]}Object.keys(this.downstreamDependencies[n]).length===0&&!this.components[n]&&delete this.downstreamDependencies[n]}deleteAllUpstreamDependencies({component:t,stateVariables:e="__all__",completelyDelete:n=!1}){let r=t.componentName,a;e==="__all__"?a=Object.keys(this.upstreamDependencies[r]):a=e;for(let i of a){if(this.upstreamDependencies[r][i])for(let s of[...this.upstreamDependencies[r][i]])if(n){for(let l of s.upstreamVariableNames)this._components[s.upstreamComponentName].state[l].initiallyResolved&&this.core.recordActualChangeInStateVariable({componentName:s.upstreamComponentName,varName:l});s.deleteDependency()}else s.removeDownstreamComponent({indexToRemove:s.downstreamComponentNames.indexOf(r)});delete this.upstreamDependencies[r][i]}Object.keys(this.upstreamDependencies[r]).length===0&&!this._components[r]&&delete this.upstreamDependencies[r]}addBlockersFromChangedActiveChildren(t){if(this.collateCountersAndPropagateToAncestors(t),this.updateTriggers.childDependenciesByParent[t.componentName])for(let e of this.updateTriggers.childDependenciesByParent[t.componentName])for(let n of e.upstreamVariableNames)this.addBlocker({blockerComponentName:e.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:e.dependencyName,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});if(t.ancestors){if(this.updateTriggers.parentDependenciesByParent[t.componentName])for(let e of this.updateTriggers.parentDependenciesByParent[t.componentName])for(let n of e.upstreamVariableNames)this.addBlocker({blockerComponentName:e.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:e.dependencyName,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});for(let e of[t.componentName,...gn(t,this.components)])this.addDescendantBlockersToAncestor(e);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])for(let e of this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])for(let n of e.upstreamVariableNames)this.addBlocker({blockerComponentName:e.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:e.dependencyName,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n})}}resolveBlockersFromChangedActiveChildren(t,e=!1){if(this.collateCountersAndPropagateToAncestors(t),this.updateTriggers.childDependenciesByParent[t.componentName])for(let n of this.updateTriggers.childDependenciesByParent[t.componentName])this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:e,recurseUpstream:!0});if(t.ancestors){if(this.updateTriggers.parentDependenciesByParent[t.componentName])for(let n of this.updateTriggers.parentDependenciesByParent[t.componentName])this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:e,recurseUpstream:!0});for(let n of[t.componentName,...gn(t,this.components)])this.resolveDescendantBlockersToAncestor(n,e);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])for(let n of this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:e,recurseUpstream:!0})}}addDescendantBlockersToAncestor(t){if(this.updateTriggers.descendantDependenciesByAncestor[t])for(let e of this.updateTriggers.descendantDependenciesByAncestor[t])for(let n of e.upstreamVariableNames)this.addBlocker({blockerComponentName:e.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:e.dependencyName,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n})}resolveDescendantBlockersToAncestor(t,e=!1){if(this.updateTriggers.descendantDependenciesByAncestor[t])for(let n of this.updateTriggers.descendantDependenciesByAncestor[t])this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:e,recurseUpstream:!0})}addBlockersFromChangedReplacements(t){if(this.updateTriggers.replacementDependenciesByComposite[t.componentName])for(let e of this.updateTriggers.replacementDependenciesByComposite[t.componentName])for(let n of e.upstreamVariableNames)this.addBlocker({blockerComponentName:e.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:e.dependencyName,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});for(let e of[t.componentName,...gn(t,this.components)])this.addDescendantBlockersToAncestor(e)}checkForCircularDependency({componentName:t,varName:e,previouslyVisited:n=[]}){let r=t+":"+e;if(n.includes(r)){console.log("found circular",r,n);let a=/^(.*):/,i=n.map(u=>u.match(a)[1]),s=i.filter(u=>u.slice(0,2)!=="__").reduce((u,c)=>u.includes(c)?u:[...u,c],[]);s.length===0&&(s=[i[0]]);let l;throw s.length===1?l=s[0]:s.length===2?l=s.join(" and "):(s[s.length-2]=s.slice(s.length-2).join(", and "),s.pop(),l=s.join(", ")),Error(`Circular dependency involving ${l}`)}else n=[...n,r];if(!this.circularCheckPassed[r]&&(this.circularCheckPassed[r]=!0,t in this.downstreamDependencies)){let a=this.downstreamDependencies[t][e];for(let i in a){let s=a[i],l=s.downstreamComponentNames;if(!l)continue;let u=s.mappedDownstreamVariableNamesByComponent;if(!!u)for(let[c,d]of l.entries()){let p=u[c];for(let m of p)this.checkForCircularDependency({componentName:d,varName:m,previouslyVisited:n})}}}}resetCircularCheckPassed(t,e){let n=t+":"+e;if(this.circularCheckPassed[n]){delete this.circularCheckPassed[n];let r=this.upstreamDependencies[t][e];if(r)for(let a of r)for(let i of a.upstreamVariableNames)i!=="__childLogic"&&i!=="__identity"&&this.resetCircularCheckPassed(a.upstreamComponentName,i)}}updateDependencies({componentName:t,stateVariable:e,dependency:n}){let r=this._components[t],a=r.state[e],i=[e];if(a.additionalStateVariablesDefined&&i.push(...a.additionalStateVariablesDefined),a.determineIfShadowData){let p=a.determineIfShadowData;delete a.determineIfShadowData;let m=[],f=[],h=!0;for(let b of i)if(this.resolveItem({componentName:p.targetComponent.componentName,type:"stateVariable",stateVariable:b}).success){let C=p.targetComponent.state[b];C.value,C.essential||C.alwaysShadow||C.isShadow||C.isArray&&C.getAllArrayKeys(C.arraySize).length>0&&C.getAllArrayKeys(C.arraySize).some(T=>C.essentialByArrayKey[T])?m.push(b):f.push(b)}else{h=!1;for(let C of i)this.addBlocker({blockerComponentName:p.targetComponent.componentName,blockerType:"stateVariable",blockerStateVariable:b,componentNameBlocked:t,typeBlocked:"determineDependencies",stateVariableBlocked:C,dependencyBlocked:n})}if(!h)return{success:!1};let y=!0;if(m.length>0){this.core.modifyStateDefsToBeShadows({stateVariablesToShadow:m,stateVariableDefinitions:r.state,foundReadyToExpandWhenResolved:p.foundReadyToExpandWhenResolved,targetComponent:p.targetComponent});for(let b of m)this.updateDependencies({componentName:t,stateVariable:b,dependency:n}).success||(y=!1)}return f.length>0&&(this.updateDependencies({componentName:t,stateVariable:f[0],dependency:n}).success||(y=!1)),{success:y}}let s=this.downstreamDependencies[t][e].__determine_dependencies,l;if(s){let p=!0;if(s.originalDownstreamVariableNames.length>0){for(let[m,f]of s.downstreamComponentNames.entries())for(let h of s.mappedDownstreamVariableNamesByComponent[m])if(!this.resolveItem({componentName:f,type:"stateVariable",stateVariable:h}).success){p=!1;for(let b of i)this.addBlocker({blockerComponentName:f,blockerType:"stateVariable",blockerStateVariable:h,componentNameBlocked:t,typeBlocked:"determineDependencies",stateVariableBlocked:b,dependencyBlocked:n})}}if(p)l=s.getValue();else return{success:!1}}else l={changes:{},value:{stateValues:{}}};if(Object.keys(l.changes).length===0&&a._previousValue!==void 0)return{success:!0};let u={stateValues:Object.assign({},l.value.stateValues),componentInfoObjects:this.componentInfoObjects,sharedParameters:r.sharedParameters},c=a.returnDependencies(u);a.stateVariablesDeterminingDependencies&&(c.__determine_dependencies={dependencyType:"determineDependencies",variableNames:a.stateVariablesDeterminingDependencies});let d=this.replaceDependenciesIfChanged({component:r,stateVariable:e,newDependencies:c,allStateVariablesAffected:i});if(!(d.changedDependency||u.changedDependency))return{success:!0};for(let p of d.newlyCreatedDependencies)p.checkForCircular();for(let p of i)this.checkForCircularDependency({componentName:r.componentName,varName:p}),r.state[p].forceRecalculation=!0;a.initiallyResolved&&this.core.markStateVariableAndUpstreamDependentsStale({component:r,varName:e});for(let p of i)r.state[p].initiallyResolved&&this.recordActualChangeInUpstreamDependencies({component:r,varName:p});return{success:!0}}replaceDependenciesIfChanged({component:t,stateVariable:e,newDependencies:n,allStateVariablesAffected:r}){let a=this.downstreamDependencies[t.componentName][e],i=!1,s=[];for(let l in a)l in n||(i=!0,a[l].deleteDependency());for(let l in n)if(l in a){let u=n[l],c=a[l];if(!_t(u,c.definition)){i=!0,a[l].deleteDependency();let d=n[l],p=new this.dependencyTypes[d.dependencyType]({component:t,stateVariable:e,allStateVariablesAffected:r,dependencyName:l,dependencyDefinition:d,dependencyHandler:this});s.push(p)}}else{i=!0;let u=n[l],c=new this.dependencyTypes[u.dependencyType]({component:t,stateVariable:e,allStateVariablesAffected:r,dependencyName:l,dependencyDefinition:u,dependencyHandler:this});s.push(c)}return{changedDependency:i,newlyCreatedDependencies:s}}checkForDependenciesOnNewComponent(t){let e=[],n={};if(this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]){for(let r of this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]){let a=this._components[r.upstreamComponentName];if(!a)continue;let i=!0;for(let l of r.upstreamVariableNames)if(!(l in a.state)){i=!1;break}if(!i)continue;for(let l of r.upstreamVariableNames)a.state[l].initiallyResolved&&(n[r.upstreamComponentName]&&n[r.upstreamComponentName][l]||e.push({componentName:r.upstreamComponentName,varName:l}));for(let l of r.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:r.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:l,dependencyBlocked:r.dependencyName,blockerComponentName:t,blockerType:"componentIdentity"});if(this.resolveIfReady({componentName:r.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:r.representativeStateVariable,dependency:r.dependencyName,expandComposites:!1,recurseUpstream:!0}).success)for(let l of r.upstreamVariableNames)a.state[l].initiallyResolved||(n[r.upstreamComponentName]||(n[r.upstreamComponentName]={}),n[r.upstreamComponentName][l]=!0)}delete this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]}return e}getStateVariableDependencyValues({component:t,stateVariable:e}){let n={},r={},a={},i=this.downstreamDependencies[t.componentName][e];for(let s in i){let{value:l,changes:u,usedDefault:c}=i[s].getValue();n[s]=l,Object.keys(u).length>0&&(r[s]=u),c&&(a[s]=!0)}return{dependencyValues:n,changes:r,usedDefault:a}}recordActualChangeInUpstreamDependencies({component:t,varName:e,changes:n}){let r=t.componentName,a=this.upstreamDependencies[r][e];if(a){for(let i of a)if(i.valuesChanged){let s=i.downstreamComponentNames.indexOf(r),l=i.valuesChanged[s][e];if(!l&&t.stateVarAliases)for(let u in t.stateVarAliases)t.stateVarAliases[u]===e&&u in upValuesChangedSub&&(l=upValuesChangedSub[u]);if(!l){if(!t.state[e].isArrayEntry)throw Error(`Something is wrong, as a variable ${e} of ${t.componentName} actually changed, but wasn't marked with a potential change`);l=upValuesChangedSub[e]={changed:{}}}t.state[e]&&t.state[e].isArray?(l.changed===void 0?l.changed={arrayKeysChanged:{}}:l.changed===!0&&(l.changed={allArrayKeysChanged:!0,arraySizeChanged:!0,arrayKeysChanged:{}}),n&&(n.allArrayKeysChanged&&(l.changed.allArrayKeysChanged=!0),n.arraySizeChanged&&(l.changed.arraySizeChanged=!0),Object.assign(l.changed.arrayKeysChanged,n.arrayKeysChanged))):l.changed=!0}}}collateCountersAndPropagateToAncestors(t){let e=Object.keys(t.counters);for(let i of t.allChildrenOrdered){let s=this._components[i];for(let l in s.counters)e.includes(l)||e.push(l)}let n=!1;for(let i of e){let s=t.counters[i];s||(s=t.counters[i]={dependencies:[],componentList:[]});let l=[];s.dependencies.length>0&&l.push(t.componentName);for(let u of t.allChildrenOrdered){let d=this._components[u].counters[i];d&&l.push(...d.componentList)}(l.length!==s.componentList.length||s.componentList.some((u,c)=>u!=l[c]))&&(n=!0,s.componentList=l)}if(!n)return{foundChange:!1};if(!t.ancestors[0]){for(let i of e){let s=t.counters[i];for(let[l,u]of s.componentList.entries()){let c=this._components[u],d=c.counters[i];d.value=l+1;for(let p of d.dependencies)if(c.state[p.representativeStateVariable].initiallyResolved){this.core.markStateVariableAndUpstreamDependentsStale({component:c,varName:p.representativeStateVariable});for(let m of p.upstreamVariableNames)c.state[m].forceRecalculation=!0,this.recordActualChangeInUpstreamDependencies({component:c,varName:m})}}}return{foundChange:!0,finishedPropagation:!0}}let r=this._components[t.ancestors[0].componentName];if(!(r&&r.allChildrenOrdered.includes(t.componentName)))return{foundChange:!0,finishedPropagation:!1};let a=this.collateCountersAndPropagateToAncestors(r);return a.foundChange||console.error(`we found a change in propagating counters for ${t.componentName}, but no change for ancestors!`),{foundChange:!0,finishedPropagation:a.finishedPropagation}}getNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r}){let a=this.resolveBlockers.neededToResolve[t];a||(a=this.resolveBlockers.neededToResolve[t]={});let i=a[e];if(i||(i=a[e]={}),n){let s=i;if(i=s[n],i||(i=s[n]={}),r){let l=i;i=l[r],i||(i=l[r]={})}}return i}deleteFromNeededToResolve({componentNameBlocked:t,typeBlocked:e,stateVariableBlocked:n,dependencyBlocked:r,blockerType:a,blockerCode:i,deleteFromReciprocal:s=!0}){let l=t;n&&(l+="|"+n,r&&(l+="|"+r));let u=function(d){if(a){if(d[a])if(i){let p=d[a].indexOf(i);if(p!==-1&&d[a].splice(p,1),d[a].length===0&&delete d[a],s){let[m,f,h]=i.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:m,blockerType:a,blockerStateVariable:f,blockerDependency:h,typeBlocked:e,codeBlocked:l,deleteFromReciprocal:!1})}}else{if(s)for(let p of d[a]){let[m,f,h]=p.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:m,blockerType:a,blockerStateVariable:f,blockerDependency:h,typeBlocked:e,codeBlocked:l,deleteFromReciprocal:!1})}delete d[a]}}else if(s)for(let p in d)for(let m of d[p]){let[f,h,y]=m.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:f,blockerType:p,blockerStateVariable:h,blockerDependency:y,typeBlocked:e,codeBlocked:l,deleteFromReciprocal:!1})}}.bind(this),c=this.resolveBlockers.neededToResolve[t];if(c){let d=c[e];if(d)if(n){let p=d[n];if(p)if(r){let m=p[r];m&&(u(m),(!a||Object.keys(m).length===0)&&delete p[r]),Object.keys(p).length===0&&delete d[n]}else u(p),(!a||Object.keys(p).length===0)&&delete d[n];Object.keys(d).length===0&&delete c[e]}else u(d),(!a||Object.keys(d).length===0)&&delete c[e];Object.keys(c).length===0&&delete this.resolveBlockers.neededToResolve[t]}}checkIfHaveNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r}){let a=this.resolveBlockers.neededToResolve[t];if(!a)return!1;let i=a[e];return!i||n&&(i=i[n],!i||r&&(i=i[r],!i))?!1:Object.keys(i).length>0}getResolveBlockedBy({componentName:t,type:e,stateVariable:n,dependency:r}){let a=this.resolveBlockers.resolveBlockedBy[t];a||(a=this.resolveBlockers.resolveBlockedBy[t]={});let i=a[e];if(i||(i=a[e]={}),n){let s=i;if(i=s[n],i||(i=s[n]={}),r){let l=i;i=l[r],i||(i=l[r]={})}}return i}deleteFromResolveBlockedBy({blockerComponentName:t,blockerType:e,blockerStateVariable:n,blockerDependency:r,typeBlocked:a,codeBlocked:i,deleteFromReciprocal:s=!0}){let l=t;n&&(l+="|"+n,r&&(l+="|"+r));let u=function(d){if(a){if(d[a])if(i){let p=d[a].indexOf(i);if(p!==-1&&d[a].splice(p,1),d[a].length===0&&delete d[a],s){let[m,f,h]=i.split("|");this.deleteFromNeededToResolve({componentNameBlocked:m,typeBlocked:a,stateVariableBlocked:f,dependencyBlocked:h,blockerType:e,blockerCode:l,deleteFromReciprocal:!1})}}else{if(s)for(let p of d[a]){let[m,f,h]=p.split("|");this.deleteFromNeededToResolve({componentNameBlocked:m,typeBlocked:a,stateVariableBlocked:f,dependencyBlocked:h,blockerType:e,blockerCode:l,deleteFromReciprocal:!1})}delete d[a]}}else if(s)for(let p in d)for(let m of d[p]){let[f,h,y]=m.split("|");this.deleteFromNeededToResolve({componentNameBlocked:f,typeBlocked:p,stateVariableBlocked:h,dependencyBlocked:y,blockerType:e,blockerCode:l,deleteFromReciprocal:!1})}}.bind(this),c=this.resolveBlockers.resolveBlockedBy[t];if(c){let d=c[e];if(d)if(n){let p=d[n];if(p)if(r){let m=p[r];m&&(u(m),(!a||Object.keys(m).length===0)&&delete p[r]),Object.keys(p).length===0&&delete d[n]}else u(p),(!a||Object.keys(p).length===0)&&delete d[n];Object.keys(d).length===0&&delete c[e]}else u(d),(!a||Object.keys(d).length===0)&&delete c[e];Object.keys(c).length===0&&delete this.resolveBlockers.resolveBlockedBy[t]}}addBlocker({blockerComponentName:t,blockerType:e,blockerStateVariable:n,blockerDependency:r,componentNameBlocked:a,typeBlocked:i,stateVariableBlocked:s,dependencyBlocked:l}){let u=t;n&&(u+="|"+n,r&&(u+="|"+r));let c=a;s&&(c+="|"+s,l&&(c+="|"+l));let d=this.getNeededToResolve({componentName:a,type:i,stateVariable:s,dependency:l}),p=d[e];if(p||(p=d[e]=[]),p.includes(u))return;if(p.push(u),i==="stateVariable"){let h=this._components[a],y=h.state[s];y.isResolved=!1,y.initiallyResolved&&this.core.markStateVariableAndUpstreamDependentsStale({component:h,varName:s})}let m=this.getResolveBlockedBy({componentName:t,type:e,stateVariable:n,dependency:r}),f=m[i];f||(f=m[i]=[]),f.includes(c)||f.push(c),this.resetCircularResolveBlockerCheckPassed({componentName:a,type:i,stateVariable:s,dependency:l}),this.checkForCircularResolveBlocker({componentName:a,type:i,stateVariable:s,dependency:l})}processNewlyResolved({componentNameNewlyResolved:t,typeNewlyResolved:e,stateVariableNewlyResolved:n,dependencyNewlyResolved:r,expandComposites:a=!0,force:i=!1,recurseUpstream:s=!1}){if(e==="stateVariable"){let u=this._components[t];u&&(u.state[n].isResolved=!0,u.state[n].initiallyResolved=!0)}else if(e==="componentIdentity"){if(!(t in this._components||i))return{success:!1}}else if(e==="recalculateDownstreamComponents"){let u;try{u=this.downstreamDependencies[t][n][r]}catch(c){}if(u){let c=u.recalculateDownstreamComponents();if(!(c.success||i))return c;for(let d of u.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:u.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:d,blockerType:"recalculateDownstreamComponents",blockerCode:u.upstreamComponentName+"|"+d+"|"+r});for(let d of u.upstreamVariableNames)this.resolveIfReady({componentName:u.upstreamComponentName,type:"stateVariable",stateVariable:d,expandComposites:a,force:i,recurseUpstream:s});return{success:!0}}}else if(e==="determineDependencies"){let u;try{u=this.downstreamDependencies[t][n][r]}catch(c){}if(u){let c=this.getNeededToResolve({componentName:t,type:"stateVariable",stateVariable:n}),d=!1,p=[];if(c.determineDependencies)for(let f of c.determineDependencies){let[h,y,b]=f.split("|");if(this.checkIfHaveNeededToResolve({componentName:t,type:"determineDependency",stateVariable:n,dependency:b})){d=!0;break}p.push(b)}if(d)return{success:!0};if(!this.updateDependencies({componentName:t,stateVariable:n,dependency:r}).success)return{success:!1};for(let f of u.upstreamVariableNames){for(let h of p)this.deleteFromNeededToResolve({componentNameBlocked:u.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:f,blockerType:"determineDependencies",blockerCode:u.upstreamComponentName+"|"+f+"|"+h});this.resolveIfReady({componentName:t,type:"stateVariable",stateVariable:f,expandComposites:a,force:i,recurseUpstream:s})}return{success:!0}}}else if(e==="childLogic"){let u=this._components[t];if(u&&!u.childLogicSatisfied&&!this.core.deriveChildResultsFromDefiningChildren({parent:u,expandComposites:a,forceExpandComposites:i}).skipping&&!(u.childLogicSatisfiedWithPlaceholders||i))return{success:!1}}else if(e==="expandComposite"){if(!this._components[t].isExpanded){if(this.core.updateInfo.compositesBeingExpanded.includes(t))return{success:!1};this.core.expandCompositeComponent(this._components[t])}}else throw Error(`Unrecognized type newly resolved: ${e}`);let l=this.getResolveBlockedBy({componentName:t,type:e,stateVariable:n,dependency:r});l=Object.assign({},l);for(let u in l)for(let c of[...l[u]])if(this.deleteFromResolveBlockedBy({blockerComponentName:t,blockerType:e,blockerStateVariable:n,blockerDependency:r,typeBlocked:u,codeBlocked:c}),s){let[d,p,m]=c.split("|");this.resolveIfReady({componentName:d,type:u,stateVariable:p,dependency:m,expandComposites:a,force:i,recurseUpstream:s})}return{success:!0}}resolveStateVariablesIfReady({component:t,stateVariables:e}){let n=t.componentName;e||(this.resolveIfReady({componentName:n,type:"componentIdentity",expandComposites:!1,recurseUpstream:!0}),e=Object.keys(t.state));for(let r of e){let a=t.state[r];if(a&&a.determineDependenciesImmediately){let s=this.getNeededToResolve({componentName:n,type:"stateVariable",stateVariable:r}).determineDependencies;if(s)for(let l of s){let[u,c,d]=l.split("|");this.resolveIfReady({componentName:u,type:"determineDependencies",stateVariable:c,dependency:d,expandComposites:!0,recurseUpstream:!0})}}this.resolveIfReady({componentName:n,type:"stateVariable",stateVariable:r,expandComposites:!1,recurseUpstream:!0})}}resolveIfReady({componentName:t,type:e,stateVariable:n,dependency:r,expandComposites:a=!0,force:i=!1,recurseUpstream:s=!1}){return this.checkIfHaveNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r})?{success:!1}:(this.deleteFromNeededToResolve({componentNameBlocked:t,typeBlocked:e,stateVariableBlocked:n,dependencyBlocked:r}),this.processNewlyResolved({componentNameNewlyResolved:t,typeNewlyResolved:e,stateVariableNewlyResolved:n,dependencyNewlyResolved:r,expandComposites:a,force:i,recurseUpstream:s}))}resolveItem({componentName:t,type:e,stateVariable:n,dependency:r,force:a=!1,recurseUpstream:i=!1,expandComposites:s=!0,numPreviouslyNeeded:l}){let u=this.getNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r}),c=u.determineDependencies;if(c&&c.length>0)for(let p of[...c]){let[m,f,h]=p.split("|"),y=this.resolveItem({componentName:m,type:"determineDependencies",stateVariable:f,dependency:h,force:a,expandComposites:s});if(!y.success)return y}for(;Object.keys(u).length>0;)for(let p in u){if(p==="determineDependencies")throw Error("Shouldn't have determine dependencies blocker after determining dependencies");for(let m of[...u[p]]){let[f,h,y]=m.split("|"),b=this.resolveItem({componentName:f,type:p,stateVariable:h,dependency:y,force:a,expandComposites:s});if(!b.success)return b}}let d=this.resolveIfReady({componentName:t,type:e,stateVariable:n,dependency:r,force:a,recurseUpstream:i,expandComposites:s});if(!d.success){let p=this.getNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r}),m=Object.keys(p).length;m>0&&(l===void 0||m<l)&&(d=this.resolveItem({componentName:t,type:e,stateVariable:n,dependency:r,force:a,recurseUpstream:i,expandComposites:s,numPreviouslyNeeded:m}))}return d}checkForCircularResolveBlocker({componentName:t,type:e,stateVariable:n,dependency:r,previouslyVisited:a=[]}){let i=t;n&&(i+="|"+n,r&&(i+="|"+r));let s=i+"|"+e;if(a.includes(s)){console.log("found circular",s,a);let l=/^([^\|]*)\|/,u=a.map(y=>y.match(l)[1]),c=u.filter(y=>y.slice(0,2)!=="__").reduce((y,b)=>y.includes(b)?y:[...y,b],[]);c.length===0&&(c=[u[0]]);let d;c.length===1?d=c[0]:c.length===2?d=c.join(" and "):(c[c.length-2]=c.slice(c.length-2).join(", and "),c.pop(),d=c.join(", "));let p=[],m=[];for(let y of a){let[b,g]=y.split("|"),C=this._components[b];C&&this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:C.componentType,baseComponentType:"_composite"})&&!C.attributes.componentType&&(g==="readyToExpandWhenResolved"?p.push(b):g===C.constructor.stateVariableToEvaluateAfterReplacements&&m.push(b))}let f=!1;for(let y of p)if(m.includes(y)){f=!0;break}let h=`Circular dependency involving ${d}.`;throw f&&(h+="  Specifying the type of a composite component may address this circular dependency."),Error(h)}else a=[...a,s];if(!this.circularResolveBlockedCheckPassed[s]){this.circularResolveBlockedCheckPassed[s]=!0;let l=this.getNeededToResolve({componentName:t,type:e,stateVariable:n,dependency:r});for(let u in l)for(let c of l[u]){let[d,p,m]=c.split("|");this.checkForCircularResolveBlocker({componentName:d,type:u,stateVariable:p,dependency:m,previouslyVisited:a})}}}resetCircularResolveBlockerCheckPassed({componentName:t,type:e,stateVariable:n,dependency:r}){let a=t;n&&(a+="|"+n,r&&(a+="|"+r));let i=a+"|"+e;if(this.circularResolveBlockedCheckPassed[i]){delete this.circularResolveBlockedCheckPassed[i];let s=this.getResolveBlockedBy({componentName:t,type:e,stateVariable:n,dependency:r});for(let l in s)for(let u of s[l]){let[c,d,p]=u.split("|");this.resetCircularResolveBlockerCheckPassed({componentName:c,type:l,stateVariable:d,dependency:p})}}}get components(){return new Proxy(this._components,q)}set components(t){return null}},ce=class{constructor({component:t,stateVariable:e,allStateVariablesAffected:n,dependencyName:r,dependencyDefinition:a,dependencyHandler:i}){this.dependencyName=r,this.dependencyHandler=i,this.upstreamComponentName=t.componentName,this.upstreamVariableNames=n,this.definition=Object.assign({},a),this.representativeStateVariable=e,a.doNotProxy&&(this.doNotProxy=!0),a.variablesOptional&&(this.variablesOptional=!0),a.publicStateVariablesOnly&&(this.publicStateVariablesOnly=!0),a.caseInsensitiveVariableMatch&&(this.caseInsensitiveVariableMatch=!0),a.useMappedVariableNames&&(this.useMappedVariableNames=!0),Number.isInteger(a.propIndex)&&(this.propIndex=a.propIndex),this.returnSingleVariableValue=!1,this.returnSingleComponent=!1,this.originalDownstreamVariableNames=[],this.setUpParameters();let s=this.determineDownstreamComponents();this.initialize({downstreamComponentNames:s.downstreamComponentNames,downstreamComponentTypes:s.downstreamComponentTypes})}static dependencyType="_base";downstreamVariableNameIfNoVariables="__identity";static get rendererType(){return this.componentType}get dependencyType(){return this.constructor.dependencyType}setUpParameters(){}determineDownstreamComponents(){return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}initialize({downstreamComponentNames:t,downstreamComponentTypes:e}){this.componentIdentitiesChanged=!0;let n=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];n||(n=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName]={});for(let r of this.upstreamVariableNames)n[r]||(n[r]={}),n[r][this.dependencyName]=this;this.originalDownstreamVariableNames.length===0?(delete this.mappedDownstreamVariableNamesByComponent,delete this.upValuesChanged):(this.mappedDownstreamVariableNamesByComponent=[],this.valuesChanged=[]),this.downstreamComponentNames=[],this.downstreamComponentTypes=[];for(let[r,a]of t.entries())this.addDownstreamComponent({downstreamComponentName:a,downstreamComponentType:e[r],index:r})}addDownstreamComponent({downstreamComponentName:t,downstreamComponentType:e,index:n}){this.componentIdentitiesChanged=!0,this.downstreamComponentNames.splice(n,0,t),this.downstreamComponentTypes.splice(n,0,e);let r=this.dependencyHandler._components[t];if(r||!this.skipComponentNames){let a=this.originalDownstreamVariableNames;this.caseInsensitiveVariableMatch&&(a=this.dependencyHandler.core.findCaseInsensitiveMatches({stateVariables:a,componentClass:r.constructor})),this.publicStateVariablesOnly&&(a=this.dependencyHandler.core.matchPublicStateVariables({stateVariables:a,componentClass:r.constructor}));let i=this.dependencyHandler.core.substituteAliases({stateVariables:a,componentClass:r.constructor});this.constructor.convertToArraySize&&(i=i.map(function(u){let c=r.state[u];if(c)return c.arraySizeStateVariable?c.arraySizeStateVariable:`__${u}_is_not_an_array`;let d=Object.keys(r.arrayEntryPrefixes).sort((p,m)=>m.length-p.length);for(let p of d)if(u.substring(0,p.length)===p){let m=r.arrayEntryPrefixes[p];return r.state[m].arraySizeStateVariable}return`__${u}_is_not_an_array`})),this.propIndex!==void 0&&console.warn("Need to implement propIndex!");let s=i;if(this.originalDownstreamVariableNames.length>0){this.mappedDownstreamVariableNamesByComponent.splice(n,0,i);let u={};for(let c of i)u[c]={changed:!0};this.valuesChanged.splice(n,0,u),this.variablesOptional&&(s=s.filter(c=>c in r.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:c,component:r})));for(let c of s)if(r.state[c]||this.dependencyHandler.core.createFromArrayEntry({component:r,stateVariable:c}),!r.state[c].isResolved)for(let d of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:t,blockerType:"stateVariable",blockerStateVariable:c,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:d}),this.dependencyType==="determineDependencies"&&this.dependencyHandler.addBlocker({blockerComponentName:t,blockerType:"stateVariable",blockerStateVariable:c,componentNameBlocked:this.upstreamComponentName,typeBlocked:"determineDependencies",stateVariableBlocked:d,dependencyBlocked:this.dependencyName})}s.length===0&&(s=[this.downstreamVariableNameIfNoVariables]);let l=this.dependencyHandler.upstreamDependencies[t];l||(l=this.dependencyHandler.upstreamDependencies[t]={});for(let u of s)if(l[u]===void 0&&(l[u]=[]),l[u].push(this),u!==this.downstreamVariableNameIfNoVariables)for(let c of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,c)}for(let a of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[a].initiallyResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:a})}removeDownstreamComponent({indexToRemove:t,recordChange:e=!0}){e&&(this.componentIdentitiesChanged=!0);let n=this.downstreamComponentNames[t];if(this.downstreamComponentNames.splice(t,1),this.downstreamComponentTypes.splice(t,1),n in this.dependencyHandler._components){let r;this.mappedDownstreamVariableNamesByComponent?(r=this.mappedDownstreamVariableNamesByComponent[t],this.mappedDownstreamVariableNamesByComponent.splice(t,1),this.valuesChanged.splice(t,1),this.variablesOptional&&r.push(this.downstreamVariableNameIfNoVariables)):r=[this.downstreamVariableNameIfNoVariables];for(let a of r){let i=this.dependencyHandler.upstreamDependencies[n][a];if(i){let s=i.indexOf(this);s!==-1&&(i.length===1?delete this.dependencyHandler.upstreamDependencies[n][a]:i.splice(s,1))}if(a!==this.downstreamVariableNameIfNoVariables)for(let s of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,s)}}if(e)for(let r of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[r].initiallyResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:r})}swapDownstreamComponents(t,e){this.componentIdentitiesChanged=!0,[this.downstreamComponentNames[t],this.downstreamComponentNames[e]]=[this.downstreamComponentNames[e],this.downstreamComponentNames[t]],[this.downstreamComponentTypes[t],this.downstreamComponentTypes[e]]=[this.downstreamComponentTypes[e],this.downstreamComponentTypes[t]],this.originalDownstreamVariableNames&&([this.mappedDownstreamVariableNamesByComponent[t],this.mappedDownstreamVariableNamesByComponent[e]]=[this.mappedDownstreamVariableNamesByComponent[e],this.mappedDownstreamVariableNamesByComponent[t]]);for(let n of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[n].initiallyResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:n})}deleteDependency(){let t=[];if(!this.mappedDownstreamVariableNamesByComponent)t=Array(this.downstreamComponentNames.length).fill([this.downstreamVariableNameIfNoVariables]);else if(t=this.mappedDownstreamVariableNamesByComponent,this.variablesOptional){let n=[];for(let[r,a]of this.downstreamComponentNames.entries()){let i=[];for(let s of t[r])this.dependencyHandler.components[a].state[s]&&i.push(s);i.length>0?n.push(i):n.push([this.downstreamVariableNameIfNoVariables])}t=n}for(let[n,r]of this.downstreamComponentNames.entries())for(let a of t[n]){let i=this.dependencyHandler.upstreamDependencies[r][a];if(i){let s=i.indexOf(this);s!==-1&&(i.length===1?delete this.dependencyHandler.upstreamDependencies[r][a]:i.splice(s,1))}if(a!==this.downstreamVariableNameIfNoVariables)for(let s of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,s)}this.deleteFromUpdateTriggers();let e=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];for(let n of this.upstreamVariableNames)delete e[n][this.dependencyName]}deleteFromUpdateTriggers(){}getValue({verbose:t=!1,skipProxy:e=!1}={}){let n=[],r={},a=!1;this.componentIdentitiesChanged&&(r.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1);for(let[i,s]of this.downstreamComponentNames.entries()){let l=this.dependencyHandler.components[s];if(l){let u={componentType:l.componentType};if(this.skipComponentNames||(u.componentName=s),this.originalDownstreamVariableNames.length>0){u.stateValues={};for(let[c,d]of this.originalDownstreamVariableNames.entries()){let p=this.mappedDownstreamVariableNamesByComponent[i][c],m=this.useMappedVariableNames?p:d;(!this.variablesOptional||p in l.state)&&(l.state[p].deferred||(u.stateValues[m]=l.stateValues[p],this.valuesChanged[i][p].changed&&(r.valuesChanged||(r.valuesChanged={}),r.valuesChanged[i]||(r.valuesChanged[i]={}),r.valuesChanged[i][m]=this.valuesChanged[i][p]),this.valuesChanged[i][p]={}))}}n.push(u)}else n.push({componentType:this.downstreamComponentTypes[i]})}if(!t)if(this.returnSingleVariableValue)if(n.length===1){n=n[0],r.valuesChanged&&r.valuesChanged[0]?r.valuesChanged=r.valuesChanged[0]:delete r.valuesChanged;let i=Object.keys(n.stateValues);if(i.length===1){n=n.stateValues[i[0]];let s;this.useMappedVariableNames?s=this.mappedDownstreamVariableNamesByComponent[0][0]:s=this.originalDownstreamVariableNames[0],r.valuesChanged&&r.valuesChanged[s]&&(r.valuesChanged=r.valuesChanged[s]),a=this.dependencyHandler.components[this.downstreamComponentNames[0]].state[this.mappedDownstreamVariableNamesByComponent[0][0]].usedDefault}else n=null,r.valuesChanged={}}else n=null,r.valuesChanged={};else this.returnSingleComponent&&(n.length===1?(n=n[0],r.valuesChanged&&r.valuesChanged[0]?r.valuesChanged=r.valuesChanged[0]:delete r.valuesChanged):n=null);return!this.doNotProxy&&!e&&n!==null&&typeof n=="object"&&(n=new Proxy(n,q)),{value:n,changes:r,usedDefault:a}}checkForCircular(){for(let t of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,t);for(let t of this.upstreamVariableNames)this.dependencyHandler.checkForCircularDependency({componentName:this.upstreamComponentName,varName:t})}recalculateDownstreamComponents(){let t=this.determineDownstreamComponents(),e=t.downstreamComponentNames;if(e.length!==this.downstreamComponentNames.length||this.downstreamComponentNames.some((r,a)=>r!=e[a])){this.componentIdentitiesChanged=!0;let r=0;for(let[a,i]of[...this.downstreamComponentNames].entries())e.includes(i)||(this.removeDownstreamComponent({indexToRemove:a-r}),r++);for(let[a,i]of e.entries()){let s=this.downstreamComponentNames.indexOf(i);s!==-1?s!==a&&this.swapDownstreamComponents(s,a):this.addDownstreamComponent({downstreamComponentName:i,downstreamComponentType:t.downstreamComponentTypes[a],index:a,createVariables:!0})}}return{success:t.success}}},vn=class extends ce{static dependencyType="stateVariable";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.returnAsComponentObject?this.returnSingleComponent=!0:this.returnSingleVariableValue=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(vn);var lf=class extends vn{static dependencyType="stateVariableComponentType";getValue({verbose:t=!1}={}){let e=[],n={};if(this.staticValue)e=[this.staticValue];else if(this.componentIdentitiesChanged&&(n.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1){let r=this.downstreamComponentNames[0],a=this.dependencyHandler.components[r],i={componentName:a.componentName,componentType:a.componentType};i.stateValues={};let s=this.originalDownstreamVariableNames[0],l=this.mappedDownstreamVariableNamesByComponent[0][0],u=this.useMappedVariableNames?l:s;if((!this.variablesOptional||l in a.state)&&!a.state[l].deferred){let c=a.state[l];if(c.value,i.stateValues[u]=c.componentType,c.isArray&&c.wrappingComponents&&c.wrappingComponents.length>0){let p=c.wrappingComponents[c.wrappingComponents.length-1][0];typeof p=="object"&&(p=p.componentType),i.stateValues[u]=p}this.valuesChanged[0][l].changed&&(n.valuesChanged||(n.valuesChanged={}),n.valuesChanged[0]||(n.valuesChanged[0]={}),n.valuesChanged[0][u]=this.valuesChanged[0][l]),this.valuesChanged[0][l]={};let d=c.hasVariableComponentType;!d&&c.isArrayEntry&&(d=a.state[c.arrayStateVariable].hasVariableComponentType),d||(this.staticValue=i,this.removeDownstreamComponent({indexToRemove:0,recordChange:!1}))}e=[i]}if(!t)if(this.returnSingleVariableValue)if(e.length===1){e=e[0];let r=Object.keys(e.stateValues);n.valuesChanged&&n.valuesChanged[0]&&n.valuesChanged[0][0]&&(n.valuesChanged=n.valuesChanged[0][0]),r.length===1?e=e.stateValues[r[0]]:e=null}else e=null;else this.returnSingleComponent&&(e.length===1?(e=e[0],n.valuesChanged&&n.valuesChanged[0]&&(n.valuesChanged=n.valuesChanged[0])):e=null);return!this.doNotProxy&&e!==null&&typeof e=="object"&&(e=new Proxy(e,q)),{value:e,changes:n,usedDefault:!1}}};Q.push(lf);var uf=class extends vn{static dependencyType="stateVariableArraySize";static convertToArraySize=!0};Q.push(uf);var cf=class extends ce{static dependencyType="recursiveDependencyValues";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.changedValuesOnly=this.definition.changedValuesOnly,this.returnSingleVariableValue=!1}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}getValue(){let t=this.mappedDownstreamVariableNamesByComponent[0][0];this.dependencyHandler._components[this.componentName].stateValues[t];let e=this.getStateVariableRecursiveDependencyValues({componentName:this.componentName,stateVariable:t,changedValuesOnly:this.changedValuesOnly}),n={};return this.valuesChanged[0][t]&&(n={valuesChanged:this.valuesChanged[0][t]}),this.valuesChanged[0][t]={},{value:e,changes:n}}getStateVariableRecursiveDependencyValues({componentName:t,stateVariable:e,changedValuesOnly:n}){let r=this.dependencyHandler._components[t],a=this.dependencyHandler.downstreamDependencies[r.componentName][e],i=r.state[e].recursiveDependencyValues={};for(let s in a){let l=a[s],u=l.getValue({verbose:!0}).value;for(let[c,d]of l.downstreamComponentNames.entries()){let p=i[d];p===void 0&&(p=i[d]={});let m=this.dependencyHandler.core.changedStateVariables[d],f=[];if(l.originalDownstreamVariableNames.length>0&&(f=l.mappedDownstreamVariableNamesByComponent[c],l.variablesOptional)){let h=f;f=[];for(let y of h)(y in this.dependencyHandler._components[d].state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:y,component:this.dependencyHandler._components[d]}))&&f.push(y)}for(let h of f)if(!(h in p)){if(!n||m){let b=u[c].stateValues[h];if(!n)p[h]=b;else{let g=this.dependencyHandler._components[d].state[h];if(g)if(g.isArray||g.isArrayEntry){let C,T;g.isArray?(T=h,C=g.getAllArrayKeys(g.arraySize)):(T=g.arrayStateVariable,C=g.arrayKeys),m[T]&&C.some(v=>m[T].has(v))&&(p[h]=b)}else m[h]&&(p[h]=b)}}let y=this.getStateVariableRecursiveDependencyValues({componentName:d,stateVariable:h,changedValuesOnly:n});for(let b in y){let g=i[b];g===void 0&&(g=i[b]={}),Object.assign(g,y[b])}}Object.keys(p).length===0&&delete i[d]}}return i}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(cf);var df=class extends ce{static dependencyType="componentIdentity";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.returnSingleComponent=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(df);var pf=class extends ce{static dependencyType="attributeComponent";setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.attributeName=this.definition.attributeName,this.returnSingleComponent=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.parentName];if(!t){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let e=t.attributes[this.attributeName];return e&&e.componentType?{success:!0,downstreamComponentNames:[e.componentName],downstreamComponentTypes:[e.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(pf);var mf=class extends ce{static dependencyType="child";setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.childLogicName=this.definition.childLogicName,this.definition.childIndices!==void 0&&(this.childIndices=this.definition.childIndices.map(t=>Number(t))),this.skipComponentNames=this.definition.skipComponentNames,this.skipPlaceholders=this.definition.skipPlaceholders}determineDownstreamComponents(){this.compositeIndices=[];let t=this.dependencyHandler._components[this.parentName];if(!t){let i=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];i||(i=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),i.includes(this)||i.push(this);for(let s of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:s,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:s,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:s});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];e||(e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),e.includes(this)||e.push(this);let n=t.childLogic.returnMatches(this.definition.childLogicName);if(n===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childLogicName ${this.definition.childLogicName} does not exist.`);if(this.childIndices&&(n=n.filter((i,s)=>this.childIndices.includes(s))),!t.childLogicSatisfied){let i=!1;if(t.childLogicSatisfiedWithPlaceholders&&(this.skipPlaceholders&&(n=n.filter(s=>!t.placeholderActiveChildrenIndices.includes(s))),this.skipComponentNames&&this.originalDownstreamVariableNames.length===0?i=!0:i=n.every(s=>!t.placeholderActiveChildrenIndices.includes(s))),!i){let s=t.unexpandedCompositesNotReady.length>0;if(!s&&t.unexpandedCompositesReady.length>0){for(let l of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childLogic",blockerStateVariable:l,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:l,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:l,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:l});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(s){for(let l of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childLogic",blockerStateVariable:l,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:l,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:l,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:l});for(let l of t.unexpandedCompositesNotReady)if(!(t.childLogicSatisfiedWithPlaceholders&&t.placeholderActiveChildrenIndicesByComposite[l].every(c=>!n.includes(c))))for(let u of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:l,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childLogic",stateVariableBlocked:u});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}}let r=n.map(i=>t.activeChildren[i]),a=r.map((i,s)=>i.componentName?i.componentName:`__placeholder_${s}`);for(let[i,s]of t.definingChildren.entries())if(this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"_composite"})&&s.isExpanded){let l=s.stateValues.fullRecursiveReplacements.map(u=>this.dependencyHandler.components[u.componentName]).map(u=>u.adapterUsed?u.adapterUsed:u).map(u=>u.componentName);for(let[u,c]of a.entries())l.includes(c)&&(this.compositeIndices[u]=i)}return{success:!0,downstreamComponentNames:a,downstreamComponentTypes:r.map(i=>i.componentType)}}getValue({verbose:t}={}){let e=super.getValue({verbose:t,skipProxy:!0});for(let[n,r]of this.compositeIndices.entries())r!==void 0&&(e.value[n].compositeInd=r);return this.doNotProxy||(e.value=new Proxy(e.value,q)),e}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}}};Q.push(mf);var ff=class extends ce{static dependencyType="descendant";setUpParameters(){if(this.definition.ancestorName?(this.ancestorName=this.definition.ancestorName,this.specifiedComponentName=this.ancestorName):this.ancestorName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.componentTypes=this.definition.componentTypes,this.recurseToMatchedChildren=this.definition.recurseToMatchedChildren,this.useReplacementsForComposites=this.definition.useReplacementsForComposites,this.includeNonActiveChildren=this.definition.includeNonActiveChildren,this.includeAttributeChildren=this.definition.includeAttributeChildren,this.skipOverAdapters=this.definition.skipOverAdapters,this.ignoreReplacementsOfMatchedComposites=this.definition.ignoreReplacementsOfMatchedComposites,this.definingChildrenFirst=this.definition.definingChildrenFirst}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.ancestorName];if(!t){let a=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName];a||(a=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName]=[]),a.includes(this)||a.push(this);for(let i of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.ancestorName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:i,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:i,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:i});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let e=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];e||(e=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName]=[]),e.includes(this)||e.push(this);let n=this.gatherUnexpandedComposites(t);if(n.haveCompositesNotReady||n.haveUnexpandedCompositeReady){for(let a of this.upstreamVariableNames){this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:a,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:a});for(let i in n.unexpandedCompositesReadyByParentName)this.dependencyHandler.addBlocker({blockerComponentName:i,blockerType:"childLogic",blockerStateVariable:a,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName});for(let i in n.unexpandedCompositesNotReadyByParentName){this.dependencyHandler.addBlocker({blockerComponentName:i,blockerType:"childLogic",blockerStateVariable:a,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName});for(let s of n.unexpandedCompositesNotReadyByParentName[i])this.dependencyHandler.addBlocker({blockerComponentName:s,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childLogic",stateVariableBlocked:a})}}return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let r=Wo({ancestor:t,descendantTypes:this.componentTypes,recurseToMatchedChildren:this.recurseToMatchedChildren,useReplacementsForComposites:this.useReplacementsForComposites,includeNonActiveChildren:this.includeNonActiveChildren,skipOverAdapters:this.skipOverAdapters,ignoreReplacementsOfMatchedComposites:this.ignoreReplacementsOfMatchedComposites,definingChildrenFirst:this.definingChildrenFirst,componentInfoObjects:this.dependencyHandler.componentInfoObjects});return{success:!0,downstreamComponentNames:r.map(a=>a.componentName),downstreamComponentTypes:r.map(a=>a.componentType)}}gatherUnexpandedComposites(t){let e={},n={},r=!1,a=!1,i=this.skipComponentNames&&this.originalDownstreamVariableNames.length===0;if(!t.childLogicSatisfied)if(t.childLogicSatisfiedWithPlaceholders){if(t.unexpandedCompositesReady.length>0){let s=this.unexpandedCompositesAdjustedForPlacedholders(t.unexpandedCompositesReady,i);s.length>0&&(e[t.componentName]=s,r=!0)}if(t.unexpandedCompositesNotReady.length>0){let s=this.unexpandedCompositesAdjustedForPlacedholders(t.unexpandedCompositesNotReady,i);s.length>0&&(n[t.componentName]=s,a=!0)}}else t.unexpandedCompositesReady.length>0&&(e[t.componentName]=t.unexpandedCompositesReady,r=!0),t.unexpandedCompositesNotReady.length>0&&(n[t.componentName]=t.unexpandedCompositesNotReady,a=!0);for(let s in t.allChildren){let l=t.allChildren[s].component,u=this.gatherUnexpandedComposites(l);u.haveUnexpandedCompositeReady&&(Object.assign(e,u.unexpandedCompositesReadyByParentName),r=!0),u.haveCompositesNotReady&&(Object.assign(n,u.unexpandedCompositesNotReadyByParentName),a=!0)}return{unexpandedCompositesReadyByParentName:e,haveUnexpandedCompositeReady:r,unexpandedCompositesNotReadyByParentName:n,haveCompositesNotReady:a}}unexpandedCompositesAdjustedForPlacedholders(t,e){let n=[];for(let r of t){let i=this.dependencyHandler._components[r].attributes.componentType;this.componentTypes.some(l=>this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:i,baseComponentType:l}))&&e||n.push(r)}return n}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}}};Q.push(ff);var hf=class extends ce{static dependencyType="parentStateVariable";setUpParameters(){if(this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.childName];if(!t){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName]=[]),r.includes(this)||r.push(this);for(let a of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.childName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:a,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:a});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!t.parentName)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=t.parentName;let e=this.dependencyHandler._components[this.parentName];if(!e){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),r.includes(this)||r.push(this);for(let a of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:a,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:a});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return n||(n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(t){let n=t.indexOf(this);n!==-1&&t.splice(n,1)}if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(n){let r=n.indexOf(this);r!==-1&&n.splice(r,1)}}let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}};Q.push(hf);var bf=class extends ce{static dependencyType="ancestor";setUpParameters(){if(this.definition.descendantName?(this.descendantName=this.definition.descendantName,this.specifiedComponentName=this.descendantName):this.descendantName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.definition.componentType&&(this.componentType=this.definition.componentType)}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.descendantName];if(!t){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.descendantName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!(this.dependencyHandler.core.documentName in this.dependencyHandler._components)){for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n}),this.dependencyHandler.addBlocker({blockerComponentName:this.dependencyHandler.core.documentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let e=this.findMatchingAncestor(t);if(e.missingComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.missingComponentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.missingComponentName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:e.missingComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let n of e.ancestorsExamined){let r=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[n];r||(r=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[n]=[]),r.includes(this)||r.push(this)}return this.ancestorResults=e,e.ancestorFound?{success:!0,downstreamComponentNames:[e.ancestorFound.componentName],downstreamComponentTypes:[e.ancestorFound.componentClass.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}findMatchingAncestor(t){let e=[];if(this.componentType){for(let r of t.ancestors){let a=this.dependencyHandler._components[r.componentName];if(!a)return{missingComponentName:r.componentName};if(e.push(r.componentName),this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:this.componentType}))return{ancestorsExamined:e,ancestorFound:r}}return{ancestorsExamined:e}}if(this.originalDownstreamVariableNames.length===0)return console.warn(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must specify componentType or variableNames to find ancestor`),{ancestorsExamined:e};let n=this.originalDownstreamVariableNames;for(let r of t.ancestors){let a=this.dependencyHandler._components[r.componentName];if(!a)return{missingComponentName:r.componentName};e.push(r.componentName);let i=!0;for(let s of n)if(!(s in a.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:s,component:a}))){i=!1;break}if(i)return{ancestorsExamined:e,ancestorFound:r}}return{ancestorsExamined:e}}deleteFromUpdateTriggers(){for(let t of this.ancestorResults.ancestorsExamined){let e=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[t];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}if(this.ancestorResults&&this.ancestorResults.missingComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorResults.missingComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(bf);var yf=class extends ce{static dependencyType="replacement";setUpParameters(){if(this.definition.compositeName?(this.compositeName=this.definition.compositeName,this.specifiedComponentName=this.compositeName):this.compositeName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.recursive=this.definition.recursive,this.recurseNonStandardComposites=this.definition.recurseNonStandardComposites,Number.isInteger(this.definition.componentIndex)&&(this.componentIndex=this.definition.componentIndex),this.expandReplacements=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.compositeName];if(!t){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!t.isExpanded){for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n}),this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName});return t.state.readyToExpandWhenResolved.isResolved||this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.compositeName,typeBlocked:"expandComposite"}),{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}this.compositesFound=[this.compositeName];let e=t.replacements;if(this.recursive){let n=this.dependencyHandler.core.recursivelyReplaceCompositesWithReplacements({replacements:e,recurseNonStandardComposites:this.recurseNonStandardComposites,expandComposites:!1});if(n.unexpandedCompositesNotReady.length>0||n.unexpandedCompositesReady.length>0){for(let r of this.upstreamVariableNames){this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});for(let a of[...n.unexpandedCompositesReady,...n.unexpandedCompositesNotReady])this.dependencyHandler.addBlocker({blockerComponentName:a,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName})}for(let r of n.unexpandedCompositesNotReady)this.dependencyHandler.addBlocker({blockerComponentName:r,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:r,typeBlocked:"expandComposite"});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}e=n.newReplacements,this.compositesFound.push(...n.compositesFound)}for(let n of this.compositesFound){let r=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[n];r||(r=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[n]=[]),r.includes(this)||r.push(this)}if(this.componentIndex!==void 0){let n=e[this.componentIndex-1];n?e=[n]:e=[]}return{success:!0,downstreamComponentNames:e.map(n=>n.componentName),downstreamComponentTypes:e.map(n=>n.componentType)}}deleteFromUpdateTriggers(){if(this.compositesFound)for(let t of this.compositesFound){let e=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[t];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(yf);var gf=class extends ce{static dependencyType="sourceCompositeStateVariable";setUpParameters(){if(this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.replacementName];if(!t){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.replacementName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!t.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let e=t.replacementOf;return{success:!0,downstreamComponentNames:[e.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(gf);var vf=class extends ce{static dependencyType="adapterSourceDependency";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),n.includes(this)||n.push(this);for(let r of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:r,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:r,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:r});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!t.adaptedFrom)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let e=t.adaptedFrom;return{success:!0,downstreamComponentNames:[e.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(vf);var Cf=class extends ce{static dependencyType="countAmongSiblingsOfSameType";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),r.includes(this)||r.push(this);for(let a of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:a,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:a});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!t.parentName)return console.warn(`component ${this.componentName} does not have a parent for state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}.`),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=t.parentName;let e=this.dependencyHandler._components[this.parentName];if(!e){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),r.includes(this)||r.push(this);for(let a of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:a,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:a,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:a});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(n||(n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),!e.childLogicSatisfied&&!e.childLogicSatisfiedWithPlaceholders){let a=e.unexpandedCompositesNotReady.length>0;if(!a&&e.unexpandedCompositesReady.length>0){for(let i of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childLogic",blockerStateVariable:i,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:i,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:i,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:i});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(a){for(let i of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childLogic",blockerStateVariable:i,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:i,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:i,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:i});for(let i of e.unexpandedCompositesNotReady)for(let s of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:i,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childLogic",stateVariableBlocked:s});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}return{success:!0,downstreamComponentNames:e.activeChildren.map(r=>r.componentName),downstreamComponentTypes:e.activeChildren.map(r=>r.componentType)}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(t){let n=t.indexOf(this);n!==-1&&t.splice(n,1)}if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(n){let r=n.indexOf(this);r!==-1&&n.splice(r,1)}}let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}getValue(){let t=this.dependencyHandler.components[this.upstreamComponentName].componentType;return{value:this.dependencyHandler.components[this.parentName].activeChildren.filter(r=>r.componentType===t).map(r=>r.componentName).indexOf(this.upstreamComponentName)+1,changes:{}}}};Q.push(Cf);var Nf=class extends ce{static dependencyType="targetComponent";setUpParameters(){let t=this.dependencyHandler._components[this.upstreamComponentName];this.tName=t.doenetAttributes.tName,this.tName&&(this.targetComponentName=this.specifiedComponentName=t.doenetAttributes.fullTName),this.returnSingleComponent=!0}determineDownstreamComponents(){if(!this.tName)return{downstreamComponentNames:[],downstreamComponentTypes:[]};let t=this.dependencyHandler._components[this.targetComponentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.targetComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.targetComponentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}};Q.push(Nf);var Xo=class extends ce{static dependencyType="value";setUpParameters(){this.value=this.definition.value}getValue(){return{value:this.value,changes:{}}}};Q.push(Xo);var Tf=class extends Xo{static dependencyType="flag";setUpParameters(){this.flagName=this.definition.flagName,this.value=this.dependencyHandler.core.flags[this.flagName]}};Q.push(Tf);var Vf=class extends vn{static dependencyType="doenetAttribute";setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}getValue(){let t=null,e={};return this.componentIdentitiesChanged&&(e.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1&&(t=this.dependencyHandler.components[this.downstreamComponentNames[0]].doenetAttributes[this.attributeName]),!this.doNotProxy&&t!==null&&typeof t=="object"&&(t=new Proxy(t,q)),{value:t,changes:e}}};Q.push(Vf);var xf=class extends vn{static dependencyType="attribute";setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}getValue(){let t=null,e={};return this.componentIdentitiesChanged&&(e.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1&&(t=this.dependencyHandler.components[this.downstreamComponentNames[0]].attributes[this.attributeName]),!this.doNotProxy&&t!==null&&typeof t=="object"&&(t=new Proxy(t,q)),{value:t,changes:e}}};Q.push(xf);var wf=class extends ce{static dependencyType="serializedChildren";setUpParameters(){this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.parentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[t.componentType]}}getValue(){return{value:this.dependencyHandler._components[this.parentName].serializedChildren,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(wf);var Df=class extends ce{static dependencyType="variants";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}getValue(){return{value:this.dependencyHandler._components[this.componentName].variants,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};Q.push(Df);var Af=class extends ce{static dependencyType="counter";setUpParameters(){this.counterName=this.definition.counterName,this.componentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName],e=t.counters[this.counterName];return e||(e=t.counters[this.counterName]={dependencies:[],componentList:[],value:null}),e.dependencies.includes(this)||e.dependencies.push(this),this.dependencyHandler.collateCountersAndPropagateToAncestors(t),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}getValue(){return{value:this.dependencyHandler._components[this.componentName].counters[this.counterName].value,changes:{}}}};Q.push(Af);var Sf=class extends ce{static dependencyType="determineDependencies";setUpParameters(){if(this.recalculateDependencies=!0,this.definition.componentName?this.componentName=this.definition.componentName:this.componentName=this.upstreamComponentName,this.definition.variableNames===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.originalDownstreamVariableNames=this.definition.variableNames,this.returnSingleComponent=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let n of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:n,dependencyBlocked:this.dependencyName}),this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:n,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let e of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}markStale(){for(let t of this.upstreamVariableNames)this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t})}};Q.push(Sf);var Jo=Mt(Of()),Yo=Mt(Pf());var Qo=class{constructor({doenetML:t,parameters:e,requestedVariant:n,externalFunctions:r,flags:a={},coreReadyCallback:i,coreUpdatedCallback:s}){this.numerics=new af,this.flags=new Proxy(a,q),this.externalFunctions=r,r===void 0&&(this.externalFunctions={}),this.requestUpdate=this.requestUpdate.bind(this),this.requestAction=this.requestAction.bind(this),this.requestRecordEvent=this.requestRecordEvent.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this._requestAnimationFrame=this._requestAnimationFrame.bind(this),this.cancelAnimationFrame=this.cancelAnimationFrame.bind(this),this.calculateScoredItemNumberOfContainer=this.calculateScoredItemNumberOfContainer.bind(this),this.expandDoenetMLsToFullSerializedComponents=this.expandDoenetMLsToFullSerializedComponents.bind(this),this.finishCoreConstruction=this.finishCoreConstruction.bind(this),this.getStateVariableValue=this.getStateVariableValue.bind(this),this.submitResponseCallBack=this.submitResponseCallBack.bind(this),this.coreUpdatedCallback=s,this.coreReadyCallback=function(){i(),this.requestRecordEvent({verb:"experienced",object:{componentName:this.document.componentName,componentType:"document"}})}.bind(this),this._standardComponentClasses=Qm(),this._allComponentClasses=ef(),this._componentTypesCreatingVariants=tf(),this._componentTypeWithPotentialVariants=nf(),this.componentTypeLowerCaseMapping={};for(let u in this._allComponentClasses)this.componentTypeLowerCaseMapping[u.toLowerCase()]=u;this.stateVariableInfo={};for(let u in this.allComponentClasses)Object.defineProperty(this.stateVariableInfo,u,{get:function(){let c=this.allComponentClasses[u].returnStateVariableInfo({flags:this.flags});return delete this.stateVariableInfo[u],this.stateVariableInfo[u]=c}.bind(this),configurable:!0});this.publicStateVariableInfo={};for(let u in this.allComponentClasses)Object.defineProperty(this.publicStateVariableInfo,u,{get:function(){let c=this.allComponentClasses[u].returnStateVariableInfo({onlyPublic:!0,flags:this.flags});return delete this.publicStateVariableInfo[u],this.publicStateVariableInfo[u]=c}.bind(this),configurable:!0});this.componentInfoObjects={standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses,componentTypesCreatingVariants:this.componentTypesCreatingVariants,componentTypeWithPotentialVariants:this.componentTypeWithPotentialVariants,componentTypeLowerCaseMapping:this.componentTypeLowerCaseMapping,isInheritedComponentType:this.isInheritedComponentType,isCompositeComponent:this.isCompositeComponent,stateVariableInfo:this.stateVariableInfo,publicStateVariableInfo:this.publicStateVariableInfo},this.coreFunctions={requestUpdate:this.requestUpdate,requestAction:this.requestAction,requestRecordEvent:this.requestRecordEvent,requestAnimationFrame:this.requestAnimationFrame,cancelAnimationFrame:this.cancelAnimationFrame,calculateScoredItemNumberOfContainer:this.calculateScoredItemNumberOfContainer,recordSolutionView:this.externalFunctions.recordSolutionView},this.animationIDs={},this.lastAnimationID=0,this.requestedVariant=n,this.parameterStack=new rf(e),this.setUpRng();let l=Yo.default.stringify((0,Jo.default)(t));this.expandDoenetMLsToFullSerializedComponents({contentIds:[l],doenetMLs:[t],callBack:this.finishCoreConstruction})}finishCoreConstruction({contentIds:t,fullSerializedComponents:e,finishSerializedStateProcessing:n=!0,calledAsynchronously:r=!1}){this.contentId=t[0];let a=e[0];gl(a),n?qt({serializedComponents:a,componentInfoObjects:this.componentInfoObjects}):a[0].doenetAttributes===void 0&&(a[0].doenetAttributes={}),console.log("serialized components at the beginning"),console.log(H(a)),this.documentName=a[0].componentName,a[0].doenetAttributes.contentId=this.contentId,this._components={},this.renderedComponentInstructions={},this.componentsWithChangedChildrenToRender=new Set([]),this._renderComponents=[],this._renderComponentsByName={},this._graphRenderComponents=[],this.processQueue=[],this.dependencies=new Go({_components:this._components,componentInfoObjects:this.componentInfoObjects,core:this}),this.unsatisfiedChildLogic={},this.updateInfo={componentsTouched:[],compositesToExpand:new Set([]),compositesToUpdateReplacements:[],unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},recreatedComponents:{},itemScoreChanges:new Set,compositesBeingExpanded:[]},this.setUpVariants(a),window.state={components:this._components,renderedComponentInstructions:this.renderedComponentInstructions,renderedComponentTypes:this.renderedComponentTypes,dependencies:this.dependencies,core:this,componentInfoObjects:this.componentInfoObjects},this.changedStateVariables={},this.addComponents({serializedComponents:a,initialAdd:!0}),this.rendererTypesInDocument=this.document.allPotentialRendererTypes,this.document.stateValues.itemCreditAchieved,console.log("** components at the end of the core constructor **"),console.log(this._components),r?this.coreReadyCallback():setTimeout(()=>this.coreReadyCallback(),0)}setUpVariants(t){let e=Ta({serializedComponents:t,componentTypesCreatingVariants:this.componentTypesCreatingVariants,allComponentClasses:this.allComponentClasses});this.requestedVariant!==void 0&&(this.parameterStack.parameters.variant=this.requestedVariant),e[0].variants.desiredVariant=this.parameterStack.parameters.variant}setUpRng(){this.parameterStack.parameters.hashStringToInteger=function(t){var e=0,n,r;if(t.length===0)return e;for(n=0;n<t.length;n++)r=t.charCodeAt(n),e=(e<<5)-e+r,e|=0;return e},this.parameterStack.parameters.seed===void 0&&(this.parameterStack.parameters.seed=this.parameterStack.parameters.hashStringToInteger(Date.now().toString())),this.parameterStack.parameters.selectRng=new Zo.default(this.parameterStack.parameters.seed),this.parameterStack.parameters.rngClass=Zo.default}expandDoenetMLsToFullSerializedComponents({contentIds:t,doenetMLs:e,callBack:n}){let r=[],a={},i={};for(let u of e){let c=er(u);va(c,this.componentTypeLowerCaseMapping),ya(c,this.standardComponentClasses),tr(c,this.componentInfoObjects,this.flags),c=bt(c,this.componentInfoObjects),Na(c),rr({serializedComponents:c,componentInfoObjects:this.componentInfoObjects}),r.push(c);let d=ga({serializedComponents:c});for(let p in d.contentIdComponents)a[p]===void 0&&(a[p]=[]),a[p].push(...d.contentIdComponents[p]);for(let p in d.contentNameComponents)i[p]===void 0&&(i[p]=[]),i[p].push(...d.contentNameComponents[p])}let s=Object.keys(a),l=Object.keys(i);if(s.length+l.length>0){let u=function({fullSerializedComponents:d}){for(let[p,m]of s.entries()){let f=d[p];for(let h of a[m])h.children===void 0&&(h.children=[]),h.children.push({componentType:"externalcontent",children:f,attributes:{newNamespace:!0}})}for(let[p,m]of l.entries()){let f=d[p+s.length];for(let h of i[m])h.children===void 0&&(h.children=[]),h.children.push({componentType:"externalcontent",children:f,attributes:{newNamespace:!0}})}n({contentIds:t,fullSerializedComponents:r,calledAsynchronously:!0})}.bind(this),c=function({newDoenetMLs:d,newContentIds:p,success:m,message:f}){m||console.warn(f);for(let[y,b]of s.entries())if(p[y]&&p[y].substring(0,b.length)!==b)throw Error(`Requested contentId ${b} but got back ${p[y]}!`);let h=s.length+l.length;for(let y=0;y<h;y++){let b=p[y];if(b){let g=d[y],C=Yo.default.stringify((0,Jo.default)(g));if(b!==C)throw Error(`Incorrect DoenetML returned for contentId: ${b}`)}else y<s.length?console.warn(`Unable to retrieve content with contentId = ${s[y]}`):console.warn(`Unable to retrieve content with contentName = ${l[y-s.length]}`),d[y]=""}this.expandDoenetMLsToFullSerializedComponents({doenetMLs:d,contentIds:p,callBack:u})}.bind(this);this.externalFunctions.contentIdsToDoenetMLs({contentIds:s,contentNames:l,callBack:c})}else n({contentIds:t,fullSerializedComponents:r,calledAsynchronously:!1})}addComponents({serializedComponents:t,parent:e,indexOfDefiningChildren:n,initialAdd:r=!1}){Array.isArray(t)||(t=[t]);let a,i=[];e&&(a=e.componentName,i=[{componentName:a,componentClass:e.constructor},...e.ancestors]);let s=this.createIsolatedComponents({serializedComponents:t,ancestors:i});if(s.success!==!0)throw Error(s.message);let l=s.components,u={},c={};if(l.forEach(d=>c[d.componentName]=d),r===!0){if(l.length!==1)throw Error("Initial components need to be an array of just one component.");this.document=l[0],this.expandAllComposites(this.document),this.expandAllComposites(this.document,!0),this.initializeRenderedComponentInstruction(this.document)}else{if(e===void 0)throw Error("Must specify parent when adding components.");if(n===void 0&&(n=e.definingChildren.length),e.isShadow===!0)throw Error("Cannot add components to a shadow component "+e.componentName);let d=this.addChildren({parent:e,indexOfDefiningChildren:n,newChildren:l});if(!d.success)throw Error("Couldn't satisfy child logic result.  Need informative error message");Object.assign(c,d.addedComponents),Object.assign(u,d.deletedComponents),this.updateRendererInstructions({componentNames:this.componentAndRenderedDescendants(e)})}return this.finishUpdate({addedComponents:c,deletedComponents:u,init:r}),l}updateRendererInstructions({componentNames:t,sourceOfUpdate:e,recreatedComponents:n={}}){let r=[],a=[],i=[];for(let s of t)s in this.renderedComponentInstructions&&r.push(s);for(let s of this.componentsWithChangedChildrenToRender)if(s in this.renderedComponentInstructions){let l=[],u=this._components[s];u&&u.constructor.renderChildren&&(u.childLogicSatisfied||this.deriveChildResultsFromDefiningChildren({parent:u,expandComposites:!0}),l=u.activeChildren.map(h=>h.componentName));let c=this.renderedComponentInstructions[s].children,d=c.map(h=>h.componentName),p=[],m=[];for(let[h,y]of d.entries())l.includes(y)&&!n[y]?p.push(y):m.push({childName:y,ind:h});for(let{childName:h,ind:y}of m.reverse()){let b=this.deleteFromRenderedComponentInstructions({componentName:h,recurseToChildren:!0});c.splice(y,1),i.push({instructionType:"deleteRenderers",parentName:s,firstIndexInParent:y,numberChildrenDeleted:1,deletedComponentNames:b}),a.push(...b)}let f=l.filter(h=>p.includes(h));for(let h=0;h<f.length;h++)if(p[h]!==f[h]){let y=p.indexOf(f[h]);[c[h],c[y]]=[c[y],c[h]],[p[h],p[y]]=[p[y],p[h]],i.push({instructionType:"swapChildRenderers",parentName:s,index1:h,index2:y})}for(let[h,y]of l.entries())if(!d.includes(y)||n[y]){let b=this._components[y];if(b&&b.rendererType){let g=this.initializeRenderedComponentInstruction(b);c.splice(h,0,g),i.push({instructionType:"addRenderer",componentName:b.componentName,parentName:s,indexForParent:h})}}}if(this.componentsWithChangedChildrenToRender=new Set([]),r=r.filter(s=>!a.includes(s)),r.length>0){let s={instructionType:"updateStateVariable",renderersToUpdate:r,sourceOfUpdate:e};i.push(s)}for(let s of r){let l=this._components[s],u={};for(let c in l.state)if(l.state[c].forRenderer){let d=l.state[c].value;d!==null&&typeof d=="object"&&(d=new Proxy(d,q)),u[c]=d}Object.assign(this.renderedComponentInstructions[s].stateValues,u)}this.coreUpdatedCallback(i)}initializeRenderedComponentInstruction(t){if(t.rendererType===void 0)return;t.childLogicSatisfied||this.deriveChildResultsFromDefiningChildren({parent:t,expandComposites:!0});let e={};for(let a in t.state)if(t.state[a].forRenderer){let i=t.state[a].value;i!==null&&typeof i=="object"&&(i=new Proxy(i,q)),e[a]=i}let n=t.componentName,r=[];if(t.constructor.renderChildren)for(let a of t.activeChildren)a.rendererType&&r.push(this.initializeRenderedComponentInstruction(a));return this.componentsWithChangedChildrenToRender.delete(n),this.renderedComponentInstructions[n]={componentName:n,componentType:t.componentType,rendererType:t.rendererType,stateValues:e,children:r,actions:t.actions},this.renderedComponentInstructions[n]}deleteFromRenderedComponentInstructions({componentName:t,recurseToChildren:e=!0}){let n=[t];if(e){let r=this.renderedComponentInstructions[t];if(r)for(let a of r.children){let i=this.deleteFromRenderedComponentInstructions({componentName:a.componentName,recurseToChildren:e});n.push(...i)}}return delete this.renderedComponentInstructions[t],n}expandAllComposites(t,e=!1){let n=this.expandCompositesOfDescendants(t,e),r=!0;for(;r;){r=!1;for(let a of n){let i=this._components[a],s=!1;for(let l of i.unexpandedCompositesNotReady){let u=this._components[l];if(u.state.readyToExpandWhenResolved.isResolved){s=!0;break}else if(this.dependencies.resolveItem({componentName:u.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",force:e,recurseUpstream:!0}).success){s=!0;break}}if(s){let l=this._components[a];this.deriveChildResultsFromDefiningChildren({parent:l,expandComposites:!0,forceExpandComposites:e}),r=!0}}}}expandCompositesOfDescendants(t,e=!1){let n=[];t.childLogicSatisfied||(this.deriveChildResultsFromDefiningChildren({parent:t,expandComposites:!0,forceExpandComposites:e}),t.unexpandedCompositesNotReady.length>0?n.push(t.componentName):this.dependencies.resolveBlockersFromChangedActiveChildren(t,e));for(let r in t.attributes){let a=t.attributes[r];if(a.componentType){let i=this.expandCompositesOfDescendants(a,e);n.push(...i)}}for(let r of t.activeChildren)if(r.componentName){let a=this.expandCompositesOfDescendants(r,e);n.push(...a)}return n}componentAndRenderedDescendants(t){if(t===void 0)return[];let e=[t.componentName];if(t.constructor.renderChildren){t.childLogicSatisfied||this.deriveChildResultsFromDefiningChildren({parent:t,expandComposites:!0});for(let n of t.activeChildren)e.push(...this.componentAndRenderedDescendants(n))}return e}createIsolatedComponents({serializedComponents:t,ancestors:e,applyAdapters:n=!0,shadow:r=!1}){let a="/";if(e.length>0){let l=e[0].componentName,u=this.components[l];u.attributes.newNamespace?a=u.componentName+"/":a=Ht(u.componentName)}let i=this.createIsolatedComponentsSub({serializedComponents:t,ancestors:e,applyAdapters:n,shadow:r,namespaceForUnamed:a}),s=[...new Set(this.updateInfo.componentsTouched)];return{success:!0,components:i.components,componentsTouched:s}}createIsolatedComponentsSub({serializedComponents:t,ancestors:e,applyAdapters:n=!0,shadow:r=!1,createNameContext:a="",namespaceForUnamed:i="/",componentsReplacementOf:s}){let l=[],u="";for(let[d,p]of t.entries()){if(p.createdComponent===!0){let b=this._components[p.componentName];l.push(b),this.setAncestors(b,e);continue}let m=this.allComponentClasses[p.componentType];if(m===void 0)throw Error("Cannot create component of type "+p.componentType);p.doenetAttributes||(p.doenetAttributes={});let f=p.componentName;if(f===void 0){let g=e[0].componentName+"|"+a+"|";p.uniqueIdentifier?g+=p.uniqueIdentifier:g+=d,f=It(p.componentType,g),f=i+f}let y=this.createChildrenThenComponent({serializedComponent:p,componentName:f,ancestors:e,componentClass:m,applyAdapters:n,shadow:r,namespaceForUnamed:i,componentsReplacementOf:s}).newComponent;l.push(y)}return{components:l}}createChildrenThenComponent({serializedComponent:t,componentName:e,ancestors:n,componentClass:r,applyAdapters:a=!0,shadow:i=!1,namespaceForUnamed:s="/",componentsReplacementOf:l}){let u=t.children,c=[],d=[],p=[{componentName:e,componentClass:r},...n],m=this.parameterStack.parameters;this.parameterStack.push();let f=this.parameterStack.parameters,h=this.propagateAncestorProps({componentClass:r,componentName:e,sharedParameters:f});if(r.modifySharedParameters&&r.modifySharedParameters({sharedParameters:f,serializedComponent:t}),t.doenetAttributes.pushSharedParameters)for(let V of t.doenetAttributes.pushSharedParameters){let x=V.parameterName;x in f?f[x]=[...f[x]]:f[x]=[],f[x].push(V.value)}if(t.doenetAttributes.addToSharedParameters)for(let V of t.doenetAttributes.addToSharedParameters){let x=V.parameterName;x in f?f[x]=Object.assign({},f[x]):f[x]={},f[x][V.key]=V.value}if(u!==void 0){let V=!1,x,w;if(r.alwaysSetUpVariant||r.setUpVariantIfVariantControlChild){for(let[D,I]of u.entries())if(I.componentType==="variantControl"||I.createdComponent&&components[I.componentName].componentType==="variantControl"){x=D,w=I;break}(x!==void 0||r.alwaysSetUpVariant)&&(V=!0)}if(V){if(x!==void 0){let S=t.variants.desiredVariant;S!==void 0&&(S.index!==void 0?w.variants.desiredVariantNumber=S.index:S.value!==void 0&&(w.variants.desiredVariant=S.value)),t.variants.uniqueVariants&&(f.numberOfVariants=t.variants.numberOfVariants);let O=this.createIsolatedComponentsSub({serializedComponents:[w],ancestors:p,applyAdapters:a,shadow:i,createNameContext:"variantControl",namespaceForUnamed:s});c[x]=O.components[0]}r.setUpVariant({serializedComponent:t,sharedParameters:f,definingChildrenSoFar:c,allComponentClasses:this.allComponentClasses});let D=[...u.keys()].filter(S=>S!==x),I=u.filter((S,O)=>O!==x),A=this.createIsolatedComponentsSub({serializedComponents:I,ancestors:p,applyAdapters:a,shadow:i,namespaceForUnamed:s});for(let[S,O]of D.entries())c[O]=A.components[S]}else if(r.keepChildrenSerialized){let D=new Set([]),I=r.keepChildrenSerialized({serializedComponent:t,componentInfoObjects:this.componentInfoObjects});for(let O of I){if(D.has(Number(O)))throw Error("Invalid instructions to keep children serialized from "+r.componentType+": child repeated");D.add(Number(O)),d.push(u[O])}let A=[],S=[];for(let[O,k]of u.entries())D.has(O)||(A.push(k),S.push(O));if(A.length>0){let O=this.createIsolatedComponentsSub({serializedComponents:A,ancestors:p,applyAdapters:a,shadow:i,namespaceForUnamed:s});for(let[k,R]of S.entries())c[R]=O.components[k]}}else c=this.createIsolatedComponentsSub({serializedComponents:u,ancestors:p,applyAdapters:a,shadow:i,namespaceForUnamed:s}).components}let y=r.returnChildLogic({componentInfoObjects:this.componentInfoObjects,components:this.components});if(y===void 0||typeof y.applyLogic!="function")throw Error("Invalid component class "+r.componentType+": returnChildLogic must return a childLogic object");let b={};if(t.attributes){let V=r.createAttributesObject({flags:this.flags});for(let x in t.attributes){let w=V[x];if(w&&w.createComponentOfType){let D=this.createIsolatedComponentsSub({serializedComponents:[t.attributes[x]],ancestors:p,applyAdapters:a,shadow:i,namespaceForUnamed:s,createNameContext:`attribute|${x}`});b[x]=D.components[0]}else b[x]=t.attributes[x]}}let g={};t.downstreamDependencies&&Object.assign(g,t.downstreamDependencies);for(let V in h){let x=h[V],w=x.componentName;g[w]===void 0&&(g[w]=[]),g[w].push({dependencyType:"ancestorProp",attribute:V,ancestorIdentity:x})}let C=this.createStateVariableDefinitions({childLogic:y,componentClass:r,prescribedDependencies:g,componentName:e});this.updateInfo.deletedComponents[e]&&(this.updateInfo.recreatedComponents[e]=!0),delete this.updateInfo.deletedComponents[e],delete this.updateInfo.deletedStateVariables[e];let T=new r({componentName:e,ancestors:n,definingChildren:c,childLogic:y,stateVariableDefinitions:C,serializedChildren:d,serializedComponent:t,attributes:b,componentInfoObjects:this.componentInfoObjects,coreFunctions:this.coreFunctions,flags:this.flags,shadow:i,numerics:this.numerics,sharedParameters:f,parentSharedParameters:m});this.registerComponent(T),l&&(T.replacementOf=l),t.adaptedFrom&&(T.adaptedFrom=this._components[t.adaptedFrom],T.adaptedFrom.adapterUsed=T);for(let V in g){let x=g[V];for(let w of x)if(w.dependencyType==="referenceShadow"){let D={componentName:V};Object.assign(D,w),delete D.dependencyType,T.shadows=new Proxy(D,q);let I=this._components[V];I.shadowedBy||(I.shadowedBy=[]),I.shadowedBy.push(T);break}}this.deriveChildResultsFromDefiningChildren({parent:T,expandComposites:!1}),this.initializeComponentStateVariables(T),this.dependencies.setUpComponentDependencies(T);let v=this.dependencies.checkForDependenciesOnNewComponent(e);for(let V of v)this.recordActualChangeInStateVariable({componentName:V.componentName,varName:V.varName});return this.dependencies.resolveStateVariablesIfReady({component:T}),this.parameterStack.pop(),{newComponent:T}}propagateAncestorProps({componentClass:t,componentName:e,sharedParameters:n}){let r=t.createAttributesObject({flags:this.flags}),a={};for(let l in r)r[l].propagateToDescendants&&(a[l]={componentName:e,componentType:t.componentType});let i={},s={};for(let l in n.attributesToPropagate)l in r&&(s[l]=!0,r[l].ignorePropagationFromAncestors||(i[l]=n.attributesToPropagate[l]));if(Object.keys(a).length>0||Object.keys(s).length>0){if(n.attributesToPropagate){n.attributesToPropagate=Object.assign({},n.attributesToPropagate);for(let l in s)delete n.attributesToPropagate[l]}else n.attributesToPropagate={};Object.assign(n.attributesToPropagate,a)}return i}deriveChildResultsFromDefiningChildren({parent:t,expandComposites:e=!0,forceExpandComposites:n=!1}){if(this.derivingChildResults||(this.derivingChildResults=[]),this.derivingChildResults.includes(t.componentName))return{success:!1,skipping:!0};this.derivingChildResults.push(t.componentName),t.activeChildren&&this.evaluatedDeferredChildStateVariables(t);let r=this.expandCompositeOfDefiningChildren(t,t.definingChildren,e,n);t.unexpandedCompositesReady=r.unexpandedCompositesReady,t.unexpandedCompositesNotReady=r.unexpandedCompositesNotReady,t.activeChildren=t.definingChildren.slice(),t.allChildren={};for(let s=0;s<t.activeChildren.length;s++){let l=t.activeChildren[s];t.allChildren[l.componentName]={activeChildrenIndex:s,definingChildrenIndex:s,component:l}}if(t.allChildrenOrdered=t.activeChildren.filter(s=>s.componentName).map(s=>s.componentName),this.replaceCompositeChildren(t),!t.constructor.includeBlankStringChildren){let s=[],l=!1,u=0;for(let c of t.activeChildren)c.componentType==="string"&&!/\S/.test(c.stateValues.value)?l=!0:(s.push(c),l&&c.componentName&&(t.allChildren[c.componentName].activeChildrenIndex=u),u++);t.activeChildren=s}let a=this.matchChildrenToChildLogic({parent:t,applyAdapters:!0});a.success?delete this.unsatisfiedChildLogic[t.componentName]:this.unsatisfiedChildLogic[t.componentName]={message:t.childLogic.logicResult.message},this.dependencies.addBlockersFromChangedActiveChildren(t);let i=this.derivingChildResults.indexOf(t.componentName);return this.derivingChildResults.splice(i,1),t.constructor.renderChildren&&this.componentsWithChangedChildrenToRender.add(t.componentName),a}expandCompositeOfDefiningChildren(t,e,n,r){let a=[],i=[];for(let s=0;s<e.length;s++){let l=e[s];if(l instanceof this._allComponentClasses._composite){if(t.childLogic.checkIfChildInLogic(l))continue;if(!l.isExpanded){if(l.state.readyToExpandWhenResolved.isResolved){if(!n){a.push(l.componentName),this.updateInfo.compositesToExpand.add(l.componentName);continue}}else if(n){if(!this.dependencies.resolveItem({componentName:l.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",expandComposites:n,force:r}).success){i.push(l.componentName),this.updateInfo.compositesToExpand.add(l.componentName);continue}}else{i.push(l.componentName),this.updateInfo.compositesToExpand.add(l.componentName);continue}this.expandCompositeComponent(l)}let u=this.expandCompositeOfDefiningChildren(t,l.replacements,n,r);a.push(...u.unexpandedCompositesReady),i.push(...u.unexpandedCompositesNotReady)}}return{unexpandedCompositesReady:a,unexpandedCompositesNotReady:i}}matchChildrenToChildLogic({parent:t,applyAdapters:e=!0}){let n=0;if(e===!0)for(let i of t.activeChildren){let s;i.componentName?s=i.constructor.nAdapters:s=this.allComponentClasses[i.componentType].nAdapters,s>n&&(n=s)}let r=0,a=!1;for(;r<=n;r++)if(t.childLogic.applyLogic({activeChildren:t.activeChildren,maxAdapterNumber:r}).success){a=!0,this.substituteAdapters(t);break}return{success:a}}expandCompositeComponent(t){if(!("readyToExpandWhenResolved"in t.state))throw Error(`Could not find state variable readyToExpandWhenResolved of composite ${t.componentName}`);if(!t.state.readyToExpandWhenResolved.isResolved)return this.updateInfo.compositesToExpand.add(t.componentName),{success:!1};if(this.updateInfo.compositesToExpand.delete(t.componentName),this.updateInfo.compositesBeingExpanded.push(t.componentName),t.parent){if(t.parent.unexpandedCompositesReady){let r=t.parent.unexpandedCompositesReady.indexOf(t.componentName);r!==-1&&t.parent.unexpandedCompositesReady.splice(r,1)}if(t.parent.unexpandedCompositesNotReady){let r=t.parent.unexpandedCompositesNotReady.indexOf(t.componentName);r!==-1&&t.parent.unexpandedCompositesNotReady.splice(r,1)}}if(t.shadows)return this.expandShadowingComposite(t);let e=t.constructor.createSerializedReplacements({component:this.components[t.componentName],components:this.components,workspace:t.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});if(t.constructor.stateVariableToEvaluateAfterReplacements&&t.stateValues[t.constructor.stateVariableToEvaluateAfterReplacements],e.replacements){let r=e.replacements;this.createAndSetReplacements({component:t,serializedReplacements:r})}else throw Error(`Invalid createSerializedReplacements of ${t.componentName}`);let n=this.updateInfo.compositesBeingExpanded.indexOf(t.componentName);if(n===-1)throw Error(`Something is wrong as we lost track that we were expanding ${t.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(n,1),{success:!0,compositesExpanded:[t.componentName]}}expandShadowingComposite(t){if(this.updateInfo.compositesBeingExpanded.includes(t.shadows.componentName)){let l=this._components[t.shadows.componentName];for(;l.shadows;)l=this._components[l.shadows.componentName];throw Error(`Circular reference involving ${l.componentName}`)}let e=this._components[t.shadows.componentName],n=[];if(!e.isExpanded){let l=this.expandCompositeComponent(e);if(!l.success)throw Error(`expand result of ${t.componentName} was not a success even though ready to expand.`);n.push(...l.compositesExpanded)}let r=e.replacements.map(l=>l.serialize({forCopy:!0})),a=t.replacementsWorkspace.uniqueIdentifiersUsed=[],i=t.shadows.compositeName;if(r=Te({serializedComponents:r,componentName:i,uniqueIdentifiersUsed:a}),t.constructor.assignNamesToReplacements){let l=t.constructor.originalNamesAreConsistent&&t.attributes.newNamespace;r=j({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:l}).serializedComponents}else{let l=t.attributes.newNamespace;r=j({serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.attributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:l}).serializedComponents}this.createAndSetReplacements({component:t,serializedReplacements:r});let s=this.updateInfo.compositesBeingExpanded.indexOf(t.componentName);if(s===-1)throw Error(`Something is wrong as we lost track that we were expanding ${t.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(s,1),n.push(t.componentName),{success:!0,compositesExpanded:n}}createAndSetReplacements({component:t,serializedReplacements:e}){this.parameterStack.push(t.sharedParameters,!1);let n;t.attributes.newNamespace?n=t.componentName+"/":n=Ht(t.componentName);let r=this.createIsolatedComponentsSub({serializedComponents:e,ancestors:t.ancestors,shadow:!0,createNameContext:t.componentName+"|replacements",namespaceForUnamed:n,componentsReplacementOf:t});this.parameterStack.pop(),t.replacements=r.components,this.dependencies.addBlockersFromChangedReplacements(t),t.isExpanded=!0}replaceCompositeChildren(t){delete t.placeholderActiveChildrenIndices,delete t.placeholderActiveChildrenIndicesByComposite;for(let e=0;e<t.activeChildren.length;e++){let n=t.activeChildren[e];if(n instanceof this._allComponentClasses._composite){if(t.childLogic.checkIfChildInLogic(n))continue;let r=!1;if(!n.isExpanded)if(n.attributes.componentType)r=!0;else continue;let a;if(r){let l=n.attributes.nComponents;l===void 0&&(l=1);let u=this.componentInfoObjects.componentTypeLowerCaseMapping[n.attributes.componentType];a=[];for(let d=0;d<l;d++)a.push({componentType:u,fromComposite:n.componentName});t.hasPlaceholderActiveChildren=!0;let c=[...Array(l).keys()].map(d=>d+e);t.placeholderActiveChildrenIndices||(t.placeholderActiveChildrenIndices=[]),t.placeholderActiveChildrenIndices.push(...c),t.placeholderActiveChildrenIndicesByComposite||(t.placeholderActiveChildrenIndicesByComposite={}),t.placeholderActiveChildrenIndicesByComposite[n.componentName]=c}else this.markWithheldReplacementInactive(n),a=n.replacements,n.replacementsToWithhold>0&&(a=a.slice(0,-n.replacementsToWithhold));t.activeChildren.splice(e,1,...a);let i=t.allChildren[n.componentName];delete i.activeChildrenIndex;for(let l=0;l<a.length;l++){let u=a[l];u.componentName&&(t.allChildren[u.componentName]={activeChildrenIndex:e+l,component:u})}let s=t.allChildrenOrdered.indexOf(n.componentName);if(t.allChildrenOrdered.splice(s+1,0,...a.filter(l=>l.componentName).map(l=>l.componentName)),a.length!==1){let l=a.length-1;for(let u=e+a.length;u<t.activeChildren.length;u++){let c=t.activeChildren[u];t.allChildren[c.componentName].activeChildrenIndex+=l}}e--}}}markWithheldReplacementInactive(t){let e=t.replacements.length;t.stateValues.isInactiveCompositeReplacement?e=0:t.replacementsToWithhold>0&&(e-=t.replacementsToWithhold);for(let n of t.replacements.slice(0,e))this.changeInactiveComponentAndDescendants(n,!1);for(let n of t.replacements.slice(e))this.changeInactiveComponentAndDescendants(n,!0)}changeInactiveComponentAndDescendants(t,e){if(t.stateValues.isInactiveCompositeReplacement!==e){t.state.isInactiveCompositeReplacement.value=e,this.markUpstreamDependentsStale({component:t,varName:"isInactiveCompositeReplacement"}),this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:"isInactiveCompositeReplacement"});for(let n in t.allChildren)this.changeInactiveComponentAndDescendants(this._components[n],e);t.replacements&&this.markWithheldReplacementInactive(t)}}substituteAdapters(t){let e=t.childLogic.logicResult.adapterResults;for(let n in e){let r=t.activeChildren[n],a=e[n],i=r.adapterUsed;if(i===void 0||i.componentType!==a.componentType)if(r.componentName){let s;t.attributes.newNamespace?s=t.componentName+"/":s=Ht(t.componentName),a.adaptedFrom=r.componentName,i=this.createIsolatedComponentsSub({serializedComponents:[a],shadow:!0,ancestors:r.ancestors,createNameContext:r.componentName+"|adapter",namespaceForUnamed:s}).components[0]}else a.adaptedFrom=r,i=a;if(t.activeChildren.splice(n,1,i),r.componentName&&(delete t.allChildren[r.componentName].activeChildrenIndex,t.allChildren[i.componentName]={activeChildrenIndex:Number(n),component:i}),r.componentName){let s=t.allChildrenOrdered.indexOf(r.componentName);t.allChildrenOrdered.splice(s+1,0,i.componentName)}}}findShadowedChildInSerializedComponents({serializedComponents:t,shadowedComponentName:e}){for(let n of t){if(n.originalName===e)return n;if(n.children){let r=this.findShadowedChildInSerializedComponents({serializedComponents:n.children,shadowedComponentName:e});if(r)return r}}}createStateVariableDefinitions({childLogic:t,componentClass:e,prescribedDependencies:n,componentName:r}){let a,i={};if(n)for(let u in n){let c=n[u];for(let d of c)d.dependencyType==="referenceShadow"?a={linkSource:"referenceShadow",targetName:u,compositeName:d.compositeName,propVariable:d.propVariable,arrayStateVariable:d.arrayStateVariable,arrayKey:d.arrayKey,ignorePrimaryStateVariable:d.ignorePrimaryStateVariable}:d.dependencyType==="adapter"?a={linkSource:"adapter",adapterTargetIdentity:d.adapterTargetIdentity,adapterVariable:d.adapterVariable}:d.dependencyType==="ancestorProp"?i[d.attribute]=d.ancestorIdentity:d.dependencyType==="nonShadowingReplacement"&&(a={linkSource:"nonShadowingReplacement",compositeName:u})}let s={};a||this.createAttributeStateVariableDefinitions({ancestorProps:i,stateVariableDefinitions:s,componentClass:e});let l=e.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(s),numerics:this.numerics});return Object.assign(s,l),a&&(a.linkSource==="adapter"?this.createAdapterStateVariableDefinitions({redefineDependencies:a,childLogic:t,stateVariableDefinitions:s,componentClass:e}):this.createReferenceShadowStateVariableDefinitions({redefineDependencies:a,stateVariableDefinitions:s,componentClass:e,ancestorProps:i})),s}createAttributeStateVariableDefinitions({componentClass:t,ancestorProps:e,stateVariableDefinitions:n}){let r=t.createAttributesObject({flags:this.flags});for(let a in r){let i=r[a];if(!i.createStateVariable)continue;let s=i.createStateVariable,l=n[s]={isAttribute:!0};i.public&&(l.public=!0,l.componentType=i.createComponentOfType);let u=this.allComponentClasses[i.createComponentOfType];if(!u)throw Error(`Component type ${i.createComponentOfType} does not exist so cannot create state variable for attribute ${a} of componentType ${t.componentType}.`);let c=u.stateVariableForAttributeValue;c===void 0&&(c="value"),a in e?(l.returnDependencies=()=>({attributeComponent:{dependencyType:"attributeComponent",attributeName:a,variableNames:[c]},ancestorProp:{dependencyType:"stateVariable",componentName:e[a].componentName,variableName:a}}),l.definition=function({dependencyValues:p,usedDefault:m}){let f=p.attributeComponent;if(!f)return m.ancestorProp?{useEssentialOrDefaultValue:{[s]:{variablesToCheck:s,defaultValue:p.ancestorProp}}}:{newValues:{[s]:p.ancestorProp}};let h=jn({value:f.stateValues[c],attributeSpecification:i,attribute:a});if(i.mergeArrays&&Array.isArray(p.ancestorProp)&&Array.isArray(h)){let y=[...h,...p.ancestorProp];return{newValues:{[s]:y}}}else return{newValues:{[s]:h}}},l.inverseDefinition=function({desiredStateVariableValues:p,dependencyValues:m,usedDefault:f}){return m.attributeComponent?i.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:p[s],variableIndex:0}]}:f.ancestorProp?{success:!0,instructions:[{setStateVariable:s,value:p[s]}]}:{success:!0,instructions:[{setDependency:"ancestorProp",desiredValue:p[s]}]}}):(l.returnDependencies=()=>({attributeComponent:{dependencyType:"attributeComponent",attributeName:a,variableNames:[c]}}),l.definition=function({dependencyValues:p}){let m=p.attributeComponent;if(!m)return{useEssentialOrDefaultValue:{[s]:{variablesToCheck:s}}};let f=jn({value:m.stateValues[c],attributeSpecification:i,attribute:a});if(i.mergeArrayWithDefault&&Array.isArray(f)){let h=i.defaultValue;if(Array.isArray(h)){let y=[...f,...h];return{newValues:{[s]:y}}}}return{newValues:{[s]:f}}},l.inverseDefinition=function({desiredStateVariableValues:p,dependencyValues:m}){return m.attributeComponent?i.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:p[s],variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:s,value:p[s]}]}});let d=["forRenderer","defaultValue","propagateToProps"];for(let p of d)p in i&&(l[p]=i[p])}}createAdapterStateVariableDefinitions({redefineDependencies:t,childLogic:e,stateVariableDefinitions:n,componentClass:r}){let a=this._components[t.adapterTargetIdentity.componentName],i=r.createAttributesObject({flags:this.flags});for(let u in i){let c=i[u];if(!c.createStateVariable)continue;let d=c.createStateVariable,p=n[d]={isAttribute:!0};if(c.public&&(p.public=!0,p.componentType=c.createComponentOfType),!this.allComponentClasses[c.createComponentOfType])throw Error(`Component type ${c.createComponentOfType} does not exist so cannot create state variable for attribute ${u} of componentType ${r.componentType}.`);p.returnDependencies=()=>({attributeComponent:{dependencyType:"attributeComponent",attributeName:u,variableNames:[stateVariableForAttributeValue]}}),d in a.state?p.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:t.adapterTargetIdentity.componentName,variableName:d}}):p.returnDependencies=()=>({}),p.definition=function({dependencyValues:h}){return h.adapterTargetVariable===void 0?{useEssentialOrDefaultValue:{[d]:{variablesToCheck:d}}}:{newValues:{[d]:h.adapterTargetVariable}}},p.inverseDefinition=function({desiredStateVariableValues:h,dependencyValues:y}){return y.adapterTargetVariable===void 0?{success:!0,instructions:[{setStateVariable:d,value:h[d]}]}:{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:h[d]}]}};let f=["forRenderer","defaultValue","propagateToProps"];for(let h of f)h in c&&(p[h]=c[h])}let s="value";r.primaryStateVariableForDefinition&&(s=r.primaryStateVariableForDefinition);let l=n[s];l.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:t.adapterTargetIdentity.componentName,variableName:t.adapterVariable}}),l.set?l.definition=function({dependencyValues:u}){return{newValues:{[s]:l.set(u.adapterTargetVariable)}}}:l.definition=function({dependencyValues:u}){return{newValues:{[s]:u.adapterTargetVariable}}},l.inverseDefinition=function({desiredStateVariableValues:u}){return{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:u[s]}]}}}createReferenceShadowStateVariableDefinitions({redefineDependencies:t,stateVariableDefinitions:e,componentClass:n,ancestorProps:r}){let a=this._components[t.compositeName],i=this._components[t.targetName],s=t.linkSource==="nonShadowingReplacement",l={};if(t.propVariable){let m=i.state[t.propVariable];m&&m.stateVariablesPrescribingAdditionalAttributes&&(l=m.stateVariablesPrescribingAdditionalAttributes)}let u=n.createAttributesObject({flags:this.flags});for(let m in u){let f=u[m];if(!f.createStateVariable)continue;let h=f.createStateVariable,y=e[h]={isAttribute:!0};f.public&&(y.public=!0,y.componentType=f.createComponentOfType);let b=this.allComponentClasses[f.createComponentOfType];if(!b)throw Error(`Component type ${f.createComponentOfType} does not exist so cannot create state variable for attribute ${m} of componentType ${n.componentType}.`);let g=b.stateVariableForAttributeValue;g===void 0&&(g="value");let C={attributeComponent:{dependencyType:"attributeComponent",attributeName:m,variableNames:[g]}};!s&&(!t.propVariable||f.propagateToProps)&&m in i.state&&(C.targetVariable={dependencyType:"stateVariable",componentName:i.componentName,variableName:m},"targetAttributesToIgnore"in a.state&&(C.targetAttributesToIgnore={dependencyType:"stateVariable",componentName:a.componentName,variableName:"targetAttributesToIgnore"})),l[m]&&(C.targetVariable={dependencyType:"stateVariable",componentName:i.componentName,variableName:l[m]}),m in r&&(C.ancestorProp={dependencyType:"stateVariable",componentName:r[m].componentName,variableName:m}),y.returnDependencies=()=>C,m in r?(y.definition=function({dependencyValues:v,usedDefault:N}){let V=v.attributeComponent;if(!V){if(v.targetVariable!==void 0&&!(v.targetAttributesToIgnore&&v.targetAttributesToIgnore.includes(m))&&!N.targetVariable)return{newValues:{[m]:v.targetVariable}};if(N.ancestorProp)return{useEssentialOrDefaultValue:{[h]:{variablesToCheck:h,defaultValue:v.ancestorProp}}};{let w=jn({value:v.ancestorProp,attributeSpecification:f,attribute:m});return{newValues:{[h]:w}}}}let x=jn({value:V.stateValues[g],attributeSpecification:f,attribute:m});if(f.mergeArrays&&Array.isArray(v.ancestorProp)&&Array.isArray(x)){let w=[...x,...v.ancestorProp];return{newValues:{[h]:w}}}else return{newValues:{[h]:x}}},y.inverseDefinition=function({desiredStateVariableValues:v,dependencyValues:N,usedDefault:V}){return N.attributeComponent?f.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:v[h],variableIndex:0}]}:N.targetVariable!==void 0&&!(N.targetAttributesToIgnore&&N.targetAttributesToIgnore.includes(m))&&!V.targetVariable?{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:v[m]}]}:V.ancestorProp?{success:!0,instructions:[{setStateVariable:h,value:v[h]}]}:{success:!0,instructions:[{setDependency:"ancestorProp",desiredValue:v[h]}]}}):(y.definition=function({dependencyValues:v,usedDefault:N}){let V=v.attributeComponent;if(!V)return v.targetVariable!==void 0&&!(v.targetAttributesToIgnore&&v.targetAttributesToIgnore.includes(m))&&!N.targetVariable?{newValues:{[m]:v.targetVariable}}:{useEssentialOrDefaultValue:{[h]:{variablesToCheck:h}}};let x=jn({value:V.stateValues[g],attributeSpecification:f,attribute:m});if(f.mergeArrayWithDefault&&Array.isArray(x)){let w=f.defaultValue;if(Array.isArray(w)){let D=[...x,...w];return{newValues:{[h]:D}}}}return{newValues:{[h]:x}}},y.inverseDefinition=function({desiredStateVariableValues:v,dependencyValues:N,usedDefault:V}){return N.attributeComponent?f.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:v[h],variableIndex:0}]}:N.targetVariable!==void 0&&!(N.targetAttributesToIgnore&&N.targetAttributesToIgnore.includes(m))&&!V.targetVariable?{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:v[m]}]}:{success:!0,instructions:[{setStateVariable:h,value:v[h]}]}});let T=["forRenderer","defaultValue","propagateToProps"];for(let v of T)v in f&&(y[v]=f[v])}if(s)return;if(t.propVariable){if(!t.ignorePrimaryStateVariable){let m="value";n.primaryStateVariableForDefinition&&(m=n.primaryStateVariableForDefinition);let f=e[m];if(!f)throw Error(`Cannot have a public state variable with componentType ${n.componentType} as the class doesn't have a primary state variable for definition`);f.returnDependencies=()=>({targetVariable:{dependencyType:"stateVariable",componentName:i.componentName,variableName:t.propVariable}}),f.set?f.definition=function({dependencyValues:h}){return{newValues:{[m]:f.set(h.targetVariable)},alwaysShadow:[m]}}:f.definition=function({dependencyValues:h}){return{newValues:{[m]:h.targetVariable},alwaysShadow:[m]}},f.inverseDefinition=function({desiredStateVariableValues:h}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:h[m]}]}}}return}let c=!1;if("readyToExpandWhenResolved"in e){c=!0;let m=e.readyToExpandWhenResolved,f=m.returnDependencies.bind(m),h=m.definition;m.returnDependencies=function(y){let b=f(y);return b.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:i.componentName,variableName:"readyToExpandWhenResolved"},b},m.definition=function(y){let b=h(y);return b.newValues&&b.newValues.readyToExpandWhenResolved&&(y.dependencyValues.targetReadyToExpandWhenResolved||(b.newValues.readyToExpandWhenResolved=!1)),b}}let d=[...i.constructor.stateVariablesShadowedForReference];d||(d=[]);let p=[];for(let m in i.state){let f=i.state[m];if(!(f.isAttribute||m in d)&&(f.isResolved&&!f.willNeverBeEssential&&f.value,!f.neverShadow)){if(f.essential||f.alwaysShadow||f.isShadow||f.isArray&&f.isResolved&&i.state[f.arraySizeStateVariable].isResolved&&f.getAllArrayKeys(f.arraySize).length>0&&f.getAllArrayKeys(f.arraySize).some(h=>f.essentialByArrayKey[h]))d.includes(m)||d.push(m);else if((!f.isResolved||f.isArray&&!i.state[f.arraySizeStateVariable].isResolved)&&!p.includes(m)){let h=e[m];if(!h)continue;let y=[m];h.additionalStateVariablesDefined&&y.push(...h.additionalStateVariablesDefined);let b={targetComponent:i,foundReadyToExpandWhenResolved:c};f.isArray&&!i.state[f.arraySizeStateVariable].isResolved&&(b.arraySizeStateVariableToResolve=f.arraySizeStateVariable);for(let g of y)e[g].determineIfShadowData=b;p.push(...y)}}}this.modifyStateDefsToBeShadows({stateVariablesToShadow:d,stateVariableDefinitions:e,foundReadyToExpandWhenResolved:c,targetComponent:i})}modifyStateDefsToBeShadows({stateVariablesToShadow:t,stateVariableDefinitions:e,foundReadyToExpandWhenResolved:n,targetComponent:r}){let a={};for(let i of t){let s=e[i];if(s===void 0)if(i.slice(0,8)==="__array_")s=e[i]={};else continue;if(s.isShadow=!0,s.additionalStateVariablesDefined)for(let u of s.additionalStateVariablesDefined)t.includes(u)||(a[u]||(a[u]=[]),a[u].push(i));delete s.additionalStateVariablesDefined,n||delete s.stateVariablesDeterminingDependencies;let l=s.public&&s.hasVariableComponentType;if(s.isArray)s.returnArrayDependenciesByKey=function({arrayKeys:u}){let c={};for(let p of u)c[p]={targetVariable:{dependencyType:"stateVariable",componentName:r.componentName,variableName:this.arrayVarNameFromArrayKey(p)}};let d={};return l&&(d.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:i}),{globalDependencies:d,dependenciesByKey:c}},s.arrayDefinitionByKey=function({globalDependencyValues:u,dependencyValuesByKey:c,arrayKeys:d}){let p={};for(let f of d)"targetVariable"in c[f]?p[f]=c[f].targetVariable:p[f]=s.defaultEntryValue;let m={newValues:{[i]:p},alwaysShadow:[i]};return"targetVariableComponentType"in u&&(m.setComponentType={[i]:u.targetVariableComponentType}),m},s.inverseArrayDefinitionByKey=function({desiredStateVariableValues:u,dependencyValuesByKey:c,dependencyNamesByKey:d,arraySize:p}){let m=[];for(let f in u[i])!c[f]||m.push({setDependency:d[f].targetVariable,desiredValue:u[i][f],shadowedVariable:!0});return{success:!0,instructions:m}};else{let u={};n&&(u=s.returnDependencies.bind(s)),s.returnDependencies=function(c){let d=Object.assign({},u);return d.targetVariable={dependencyType:"stateVariable",componentName:r.componentName,variableName:i},l&&(d.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:i}),d},s.definition=function({dependencyValues:c}){let d={alwaysShadow:[i]};return"targetVariableComponentType"in c&&(d.setComponentType={[i]:c.targetVariableComponentType}),d.newValues={[i]:c.targetVariable},d},s.inverseDefinition=function({desiredStateVariableValues:c,dependencyValues:d}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:c[i],shadowedVariable:!0}]}}}}for(let i in a)this.modifyStateDefToDeleteVariableReferences({varNamesToDelete:a[i],stateDef:e[i]})}modifyStateDefToDeleteVariableReferences({varNamesToDelete:t,stateDef:e}){for(let r of t){let a=e.additionalStateVariablesDefined.indexOf(r);e.additionalStateVariablesDefined.splice(a,1)}let n=e.definition;e.definition=function(r){let a=n(r);for(let i in a)if(Array.isArray(a[i]))for(let s of t){let l=a[i].indexOf(s);l!==-1&&a[i].splice(l,1)}else for(let s of t)delete a[i][s];return a}}initializeComponentStateVariables(t){for(let e in t.state)t.state[e].isAlias?(t.stateVarAliases||(t.stateVarAliases={}),t.stateVarAliases[e]=t.state[e].targetVariableName,delete t.state[e]):this.initializeStateVariable({component:t,stateVariable:e})}initializeStateVariable({component:t,stateVariable:e,arrayStateVariable:n,arrayEntryPrefix:r}){let a=this.getStateVariableValue;t.state[e]||(t.state[e]={});let i=t.state[e];i.isResolved=!1,Object.defineProperty(i,"value",{get:()=>a({component:t,stateVariable:e}),configurable:!0}),r!==void 0?this.initializeArrayEntryStateVariable({stateVarObj:i,arrayStateVariable:n,arrayEntryPrefix:r,component:t,stateVariable:e}):i.isArray&&this.initializeArrayStateVariable({stateVarObj:i,component:t,stateVariable:e})}initializeArrayEntryStateVariable({stateVarObj:t,arrayStateVariable:e,arrayEntryPrefix:n,component:r,stateVariable:a}){t.isArrayEntry=!0,t.neverShadow=!0,t.arrayStateVariable=e;let i=r.state[e];if(t.definition=i.definition,t.inverseDefinition=i.inverseDefinition,t.markStale=i.markStale,t.freshnessInfo=i.freshnessInfo,t.getPreviousDependencyValuesForMarkStale=i.getPreviousDependencyValuesForMarkStale,t.nDimensions=i.returnEntryDimensions(n),t.wrappingComponents=i.returnWrappingComponents(n),t.entryPrefix=n,t.varEnding=a.slice(n.length),i.additionalStateVariablesDefined){t.additionalStateVariablesDefined=[];let l=i.entryPrefixes.indexOf(n);for(let u of i.additionalStateVariablesDefined){let c=r.state[u];if(c.isArray){let p=c.entryPrefixes[l]+t.varEnding;t.additionalStateVariablesDefined.push(p)}else t.additionalStateVariablesDefined.push(u)}}if(i.getEntryValues?t.getValueFromArrayValues=function(){return i.getEntryValues({varName:a})}:t.getValueFromArrayValues=function(){if(t.arrayKeys.length===0)return;let l=[];for(let u of t.arrayKeys)l.push(i.getArrayValue({arrayKey:u}));return l.length===1?l[0]:l},t.arraySizeStateVariable=i.arraySizeStateVariable,t._arrayKeys=[],t._unflattenedArrayKeys=[],Object.defineProperty(t,"arrayKeys",{get:function(){return i.arraySize,t._arrayKeys}}),Object.defineProperty(t,"unflattenedArrayKeys",{get:function(){return i.arraySize,t._unflattenedArrayKeys}}),r.state[t.arraySizeStateVariable].initiallyResolved){let l=i.arraySize,u=i.getArrayKeysFromVarName({arrayEntryPrefix:t.entryPrefix,varEnding:t.varEnding,arraySize:l,nDimensions:i.nDimensions});t._unflattenedArrayKeys=u,t._arrayKeys=te(u);let c=i.varNamesIncludingArrayKeys;for(let d of t._arrayKeys)c[d]||(c[d]=[]),c[d].push(a)}if(i.arrayEntryNames.push(a),Object.defineProperty(t,"arraySize",{get:()=>i.arraySize}),Object.defineProperty(t,"arrayEntrySize",{get:function(){let l=t.unflattenedArrayKeys,u=[],c=[l];for(let d=0;d<t.nDimensions;d++)c=c[0],u.push(c.length);return u.reverse(),u}}),i.stateVariablesDeterminingDependencies){t.stateVariablesDeterminingDependencies||(t.stateVariablesDeterminingDependencies=[]);for(let l of i.stateVariablesDeterminingDependencies)t.stateVariablesDeterminingDependencies.includes(l)||t.stateVariablesDeterminingDependencies.push(l)}let s=i.returnDependencies.bind(i);t.returnDependencies=function(l){l.arraySize=t.arraySize,l.arrayKeys=t.arrayKeys;let u=s(l),c=Object.keys(i.dependencyNames.namesByKey).length;return t.numberNamesInPreviousReturnDep!==c&&(l.changedDependency=!0),t.numberNamesInPreviousReturnDep=c,u}}initializeArrayStateVariable({stateVarObj:t,component:e,stateVariable:n}){t.arrayValues=[],t.nDimensions===void 0&&(t.nDimensions=1),t.nDimensions>1?(t.keyToIndex=i=>i.split(",").map(s=>Number(s)),t.setArrayValue=function({value:i,arrayKey:s,arraySize:l}){let u=t.keyToIndex(s),c=u.length;if(!c>t.nDimensions)return console.warn("Cannot set array value.  Number of dimensions is too large."),{nFailures:1};let d=t.arrayValues,p=l;for(let f of u.slice(0,u.length-1))if(f>=0&&f<p[0])d[f]||(d[f]=[]),d=d[f],p=p.slice(1);else return console.warn("ignore setting array value out of bounds"),{nFailures:1};let m=0;if(c<t.nDimensions){let f=function(y,b,g){if(!Array.isArray(y))return console.warn("ignoring array values with insufficient dimensions"),{nFailures:1};let C=0,T=g[0];if(y.length>T&&(console.warn("ignoring array values of out bounds"),C+=y.length-T,y=y.slice(0,T)),g.length===1)for(let[v,N]of y.entries())b[v]=N;else for(let[v,N]of y.entries())b[v]||(b=[]),C+=f(N,b[v],g[v]).nFailures;return{nFailures:C}};m+=f(i,d,p).nFailures}else d[u[u.length-1]]=i;return{nFailures:m}},t.getArrayValue=function({arrayKey:i,arrayValues:s=t.arrayValues}){let l=t.keyToIndex(i),u=s;for(let c of l.slice(0,l.length-1))if(u=u[c],!u)return;return u[l[l.length-1]]},t.getArrayKeysFromVarName||(t.getArrayKeysFromVarName=function({arrayEntryPrefix:i,varEnding:s,arraySize:l,nDimensions:u,desiredEntrySize:c}){let d=s.split("_").map(p=>Number(p)-1);return d.length===u&&d.every((p,m)=>Number.isInteger(p)&&p>=0)?c?d.every((p,m)=>c[m]>0)?[String(d)]:[]:l?d.every((p,m)=>p<l[m])?[String(d)]:[]:[String(d)]:[]}),t.getAllArrayKeys||(t.getAllArrayKeys=function(i,s=!0,l){function u(c){if(c.length===1)return Array.from(Array(c[0]),(d,p)=>String(p));{let d=c[0],p=u(c.slice(1)),m=[];for(let f=0;f<d;f++)s?m.push(...p.map(h=>f+","+h)):m.push(p.map(h=>f+","+h));return m}}return l?l.length===0?[]:u(l):!i||i.length===0?[]:u(i)}),t.arrayVarNameFromArrayKey||(t.arrayVarNameFromArrayKey=function(i){return r[0]+i.split(",").map(s=>Number(s)+1).join("_")}),t.adjustArrayToNewArraySize=function(){function i(s,l){if(s.length=l[0],l.length>1){let u=l.slice(1);for(let[c,d]of s.entries())d||(d=s[c]=[]),i(d,u)}}i(t.arrayValues,t.arraySize);for(let s of Object.keys(t.essentialByArrayKey))t.keyToIndex(s).some((u,c)=>u>=t.arraySize[c])&&delete t.essentialByArrayKey[s]}):(t.keyToIndex=i=>Number(i),t.setArrayValue=function({value:i,arrayKey:s,arraySize:l}){let u=t.keyToIndex(s);return u>=0&&u<l[0]?(t.arrayValues[u]=i,{nFailures:0}):(console.warn(`Ignoring setting array values out of bounds: ${s} of ${n}`),{nFailures:1})},t.getArrayValue=function({arrayKey:i,arrayValues:s=t.arrayValues}){return s[i]},t.getArrayKeysFromVarName||(t.getArrayKeysFromVarName=function({arrayEntryPrefix:i,varEnding:s,arraySize:l,desiredEntrySize:u}){let c=Number(s)-1;return Number.isInteger(c)&&c>=0?u?u[0]>0?[String(c)]:[]:l?c<l[0]?[String(c)]:[]:[String(c)]:[]}),t.getAllArrayKeys||(t.getAllArrayKeys=function(i,s,l){return l?l.length===0?[]:Array.from(Array(l[0]),(u,c)=>String(c)):!i||i.length===0?[]:Array.from(Array(i[0]),(u,c)=>String(c))}),t.arrayVarNameFromArrayKey||(t.arrayVarNameFromArrayKey=function(i){return r[0]+String(Number(i)+1)}),t.adjustArrayToNewArraySize=function(){t.arrayValues.length=t.arraySize[0];for(let i of Object.keys(t.essentialByArrayKey))t.keyToIndex(i)>=t.arraySize[0]&&delete t.essentialByArrayKey[i]}),t.indexToKey=i=>String(i);let r=t.entryPrefixes;r||(r=[n]),e.arrayEntryPrefixes||(e.arrayEntryPrefixes={});for(let i of r)e.arrayEntryPrefixes[i]=n;t.returnEntryDimensions||(t.returnEntryDimensions=()=>1),t.returnWrappingComponents||(t.returnWrappingComponents=i=>[]),t.wrappingComponents=t.returnWrappingComponents(),t.essentialByArrayKey={},t.arrayEntryNames=[],t.varNamesIncludingArrayKeys={},t.returnDependencies=function(i){i.arraySize=t.arraySize;for(let l in i.stateValues)l.slice(0,8)==="__array_"&&delete i.stateValues[l];i.arrayKeys===void 0&&(i.arrayKeys=t.getAllArrayKeys(i.arraySize));let s={};if(t.basedOnArrayKeyStateVariables&&i.arrayKeys.length>1)for(let l of i.arrayKeys)s[l]={dependencyType:"stateVariable",variableName:t.arrayVarNameFromArrayKey(l)};else{let l=t.returnArrayDependenciesByKey(i);if(!t.dependencyNames&&(t.dependencyNames={namesByKey:{},keysByName:{},global:[]},t.additionalStateVariablesDefined))for(let u of t.additionalStateVariablesDefined)e.state[u].dependencyNames=t.dependencyNames;l.globalDependencies&&(t.dependencyNames.global=Object.keys(l.globalDependencies),Object.assign(s,l.globalDependencies)),l.dependenciesByKey||(l.dependenciesByKey={});for(let u of i.arrayKeys){u in t.dependencyNames.namesByKey||(i.changedDependency=!0),t.dependencyNames.namesByKey[u]={};for(let c in l.dependenciesByKey[u]){let d="__"+u+"_"+c;s[d]=l.dependenciesByKey[u][c],t.dependencyNames.namesByKey[u][c]=d,t.dependencyNames.keysByName[d]||(t.dependencyNames.keysByName[d]=[]),t.dependencyNames.keysByName[d].push(u)}}t.dependencyNames.global.push("__array_size")}return s.__array_size={dependencyType:"stateVariable",variableName:t.arraySizeStateVariable},s},t.getCurrentFreshness=function({freshnessInfo:i,arrayKeys:s,arraySize:l}){s===void 0&&(s=t.getAllArrayKeys(l));let u=i.freshByKey,c=i.freshArraySize?1:0;for(let d of s)u[d]&&(c+=1);return c>0?c===s.length+1?{fresh:{[n]:!0}}:{partiallyFresh:{[n]:c}}:{fresh:{[n]:!1}}},t.markStale=function({freshnessInfo:i,changes:s,arrayKeys:l,arraySize:u}){let c={};l===void 0&&(l=t.getAllArrayKeys(u)),t.markStaleByKey&&(c=t.markStaleByKey({arrayKeys:l,changes:s}));let d=i.freshByKey;if(s.__array_size)return i.freshArraySize=!1,i.freshByKey={},c.fresh={[n]:!1},c;if(Object.keys(d).length===0)return i.freshByKey={},i.freshArraySize?(c.partiallyFresh={[n]:1},c):(c.fresh={[n]:!1},c);for(let m in s){if(t.dependencyNames.global.includes(m))return i.freshByKey={},i.freshArraySize?(c.partiallyFresh={[n]:1},c):(c.fresh={[n]:!1},c);if(t.basedOnArrayKeyStateVariables&&l.length>1)delete d[m];else for(let f of t.dependencyNames.keysByName[m])delete d[f]}let p=i.freshArraySize?1:0;for(let m of l)d[m]&&(p+=1);return p>0?p===l.length+1?(c.fresh={[n]:!0},c):(c.partiallyFresh={[n]:p},c):(c.fresh={[n]:!1},c)},t.freshenOnNoChanges=function({arrayKeys:i,freshnessInfo:s,arraySize:l}){let u=s.freshByKey;i===void 0&&(i=t.getAllArrayKeys(l));for(let c of i)u[c]=!0};function a(i,s){let l={};for(let d of t.dependencyNames.global)l[d]=i[d];let u={},c={};for(let d of s)if(u[d]={},d in t.dependencyNames.namesByKey){c[d]=!0;for(let p in t.dependencyNames.namesByKey[d]){let m=t.dependencyNames.namesByKey[d][p];m in i?u[d][p]=i[m]:c[d]=!1}}return{globalDependencyValues:l,dependencyValuesByKey:u,foundAllDependencyValuesForKey:c}}if(t.definition=function(i){if(i.arrayKeys===void 0&&(i.arrayKeys=t.getAllArrayKeys(i.arraySize)),t.basedOnArrayKeyStateVariables&&i.arrayKeys.length>1)return{};{let s=a(i.dependencyValues,i.arrayKeys),l=s.globalDependencyValues,u=s.dependencyValuesByKey,c=s.foundAllDependencyValuesForKey;delete i.dependencyValues,i.globalDependencyValues=l,i.dependencyValuesByKey=u;let d=[],p=i.freshnessInfo.freshByKey;for(let f of i.arrayKeys)!p[f]&&c[f]&&(p[f]=!0,d.push(f));let m;if(d.length===0)m={};else{if(i.arrayKeys=d,!t.arrayDefinitionByKey)throw Error(`For ${n} of ${e.componentType}, arrayDefinitionByKey must be a function`);if(m=t.arrayDefinitionByKey(i),m.newValues&&m.newValues[n])for(let f in m.newValues[n])p[f]=!0;if(m.useEssentialOrDefaultValue&&m.useEssentialOrDefaultValue[n])for(let f in m.useEssentialOrDefaultValue[n])p[f]=!0}if(!i.freshnessInfo.freshArraySize){if(i.changes.__array_size&&(m.arraySizeChanged=[n],t.additionalStateVariablesDefined))for(let f of t.additionalStateVariablesDefined)e.state[f].isArray&&m.arraySizeChanged.push(f);i.freshnessInfo.freshArraySize=!0}return m}},t.inverseDefinition=function(i){if(!t.inverseArrayDefinitionByKey)return{success:!1};if(i.arrayKeys===void 0&&(i.arrayKeys=t.getAllArrayKeys(i.arraySize)),t.basedOnArrayKeyStateVariables&&i.arrayKeys.length>1){let s=[];for(let l in i.desiredStateVariableValues[n])l in i.dependencyValues&&s.push({setDependency:l,desiredValue:i.desiredStateVariableValues[n][l],treatAsInitialChange:i.initialChange});return{success:!0,instructions:s}}else{let s=a(i.dependencyValues,i.arrayKeys),l=s.globalDependencyValues,u=s.dependencyValuesByKey;return delete i.dependencyValues,i.globalDependencyValues=l,i.dependencyValuesByKey=u,i.dependencyNamesByKey=t.dependencyNames.namesByKey,t.inverseArrayDefinitionByKey(i)}},this.createArraySizeStateVariable({stateVarObj:t,component:e,stateVariable:n}),t.arraySizeStale=!0,t.previousArraySize=[],Object.defineProperty(t,"arraySize",{get:function(){return e.state[t.arraySizeStateVariable].initiallyResolved?(t.arraySizeStale&&t.recalculateArraySizeDependentQuantities(),e.stateValues[t.arraySizeStateVariable]):[]}}),t.recalculateArraySizeDependentQuantities=function(){let i=e.stateValues[t.arraySizeStateVariable];if(t.previousArraySize.length!==i.length||t.previousArraySize.some((s,l)=>s!=i[l])){t.previousArraySize=[...i];let s=t.varNamesIncludingArrayKeys={};for(let l of t.arrayEntryNames){let u=e.state[l],c=t.getArrayKeysFromVarName({arrayEntryPrefix:u.entryPrefix,varEnding:u.varEnding,arraySize:i,nDimensions:t.nDimensions});u._unflattenedArrayKeys=c,u._arrayKeys=te(c);for(let d of u._arrayKeys)s[d]||(s[d]=[]),s[d].push(l)}}t.arraySizeStale=!1},!t.freshnessInfo&&(t.freshnessInfo={freshByKey:{}},t.additionalStateVariablesDefined))for(let i of t.additionalStateVariablesDefined)e.state[i]||(e.state[i]={}),e.state[i].freshnessInfo=t.freshnessInfo}createArraySizeStateVariable({stateVarObj:t,component:e,stateVariable:n}){let r=`__array_size_${n}`;t.arraySizeStateVariable=r;let a,i;if(t.stateVariablesDeterminingDependencies?(a=[...t.stateVariablesDeterminingDependencies],t.stateVariablesDeterminingDependencies.push(r)):t.stateVariablesDeterminingDependencies=[r],t.isShadow){let s=e.state[r];s.markStale=function(){return t.arraySizeStale=!0,{}};return}e.state[r]={alwaysShadow:!0,returnDependencies:t.returnArraySizeDependencies,definition({dependencyValues:s}){let l=t.returnArraySize({dependencyValues:s});for(let[u,c]of l.entries())Number.isInteger(c)&&c>=0||(l[u]=0);return{newValues:{[r]:l}}},markStale(){return t.arraySizeStale=!0,{}}},a&&(e.state[r].stateVariablesDeterminingDependencies=a),this.initializeStateVariable({component:e,stateVariable:r})}recursivelyReplaceCompositesWithReplacements({replacements:t,recurseNonStandardComposites:e=!1,expandComposites:n=!0,forceExpandComposites:r=!1}){let a=[],i=[],s=[],l=[];for(let u of t)if(this.isCompositeComponent({componentType:u.componentType,includeNonStandard:e}))if(a.push(u.componentName),u.isExpanded||(n&&!u.state.readyToExpandWhenResolved.isResolved&&this.dependencies.resolveItem({componentName:u.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",force:r}),u.state.readyToExpandWhenResolved.isResolved?n?this.expandCompositeComponent(u):s.push(u.componentName):l.push(u.componentName)),u.isExpanded){let c=this.recursivelyReplaceCompositesWithReplacements({replacements:u.replacements,recurseNonStandardComposites:e,expandComposites:n,forceExpandComposites:r});a.push(...c.compositesFound),i.push(...c.newReplacements),s.push(...c.unexpandedCompositesReady),l.push(...c.unexpandedCompositesNotReady)}else i.push(u);else i.push(u);return{compositesFound:a,newReplacements:i,unexpandedCompositesReady:s,unexpandedCompositesNotReady:l}}getStateVariableValue({component:t,stateVariable:e}){let n=t.state[e];if(!n)throw Error(`Can't get value of ${e} of ${t.componentName} as it doesn't exist.`);let r=n.additionalStateVariablesDefined,a=[e];r&&a.push(...r);for(let c of a)if(!t.state[c].isResolved&&!this.dependencies.resolveItem({componentName:t.componentName,type:"stateVariable",stateVariable:c,force:!0}).success)throw Error(`Can't get value of ${e} of ${t.componentName} as ${c} couldn't be resolved.`);let i=this.getStateVariableDefinitionArguments({component:t,stateVariable:e});i.componentInfoObjects=this.componentInfoObjects,i.freshnessInfo=n.freshnessInfo,t instanceof this.allComponentClasses._composite&&(i.replacementsWorkspace=new Proxy(t.replacementsWorkspace,q));let s;if(Object.keys(i.changes).length===0&&n._previousValue!==void 0&&!n.forceRecalculation){let c=[e];r&&c.push(...r),s={noChanges:c},n.freshenOnNoChanges&&n.freshenOnNoChanges(i)}else delete n.forceRecalculation,s=n.definition(i);let l={[e]:!1},u={};if(r)for(let c of r)l[c]=!1;for(let c in s.newValues){if(!(c in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} returned value of ${c}, which isn't a state variable.`);let d;if(c in l)l[c]=!0,u[c]=!0;else{if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let p of t.state[c].arrayEntryNames)if(p in l){d=p,l[p]=!0,u[p]=!0;break}}if(!d)throw Error(`Attempting to set value of stateVariable ${c} in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}if(!t.state[c].isResolved&&(!d||!t.state[d].isResolved))throw Error(`Attempting to set value of stateVariable ${c} of ${t.componentName} while it is still unresolved!`);if(t.state[c].isArray){u[c]={arrayKeysChanged:{}};let p={};s.checkForActualChange&&s.checkForActualChange[c]&&(p=s.checkForActualChange[c]);let m=t.state[c].arraySize;for(let f in s.newValues[c])if(p[f]){let h=t.state[c].getArrayValue({arrayKey:f}),y=s.newValues[c][f];h!==y&&(t.state[c].setArrayValue({value:s.newValues[c][f],arrayKey:f,arraySize:m}),u[c].arrayKeysChanged[f]=!0)}else t.state[c].setArrayValue({value:s.newValues[c][f],arrayKey:f,arraySize:m}),u[c].arrayKeysChanged[f]=!0}else if(delete t.state[c].value,t.state[c].value=s.newValues[c],delete t.state[c].usedDefault,s.checkForActualChange&&s.checkForActualChange[c]){let p=t.state[c].value,m=t.state[c]._previousValue;(p===m||Array.isArray(p)&&Array.isArray(m)&&p.length===m.length&&p.every((f,h)=>f===m[h]))&&delete u[c]}}for(let c in s.useEssentialOrDefaultValue){if(!(c in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} requested essential or default value of ${c}, which isn't a state variable.`);let d;if(c in l)l[c]=!0;else{if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let h of t.state[c].arrayEntryNames)if(h in l){d=h,l[h]=!0;break}}if(!d)throw Error(`Attempting to set value of stateVariable ${c} in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}if(!t.state[c].isResolved&&(!d||!t.state[d].isResolved))throw Error(`Attempting to set value of stateVariable ${c} of ${t.componentName} while it is still unresolved!`);let{haveEssentialValue:p,valueUnchanged:m,byArrayEntries:f}=this.setValueToEssential({component:t,varName:c,useEssentialInfo:s.useEssentialOrDefaultValue[c]});if(f){let h=t.state[c].arraySize;for(let y in s.useEssentialOrDefaultValue[c])p[y]||("defaultValue"in s.useEssentialOrDefaultValue[c][y]?(t.state[c].setArrayValue({value:s.useEssentialOrDefaultValue[c][y].defaultValue,arrayKey:y,arraySize:h}),t.state[c].essentialByArrayKey[y]=!0):"defaultEntryValue"in t.state[c]&&(t.state[c].setArrayValue({value:t.state[c].defaultEntryValue,arrayKey:y,arraySize:h}),t.state[c].essentialByArrayKey[y]=!0)),m[y]||(u[c]===void 0&&(u[c]={arrayKeysChanged:{}}),u[c].arrayKeysChanged[y]=!0)}else if(m||(u[c]=!0),!p)if("defaultValue"in s.useEssentialOrDefaultValue[c])delete t.state[c].value,t.state[c].value=s.useEssentialOrDefaultValue[c].defaultValue,t.state[c].usedDefault=!0,t.state[c].essential=!0;else if("defaultValue"in t.state[c])delete t.state[c].value,t.state[c].value=t.state[c].defaultValue,t.state[c].usedDefault=!0,t.state[c].essential=!0;else throw Error(`Neither value nor default value specified; state variable: ${c}, component: ${t.componentName}.`)}if(s.noChanges)for(let c of s.noChanges){if(!t.state[c].isResolved)throw Error(`Claiming state variable is unchanged when it isn't yet resolved: ${c} of ${t.componentName}`);if(!(c in l)){let d;if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let p of t.state[c].arrayEntryNames)if(p in l){d=p;break}}if(!d)throw Error(`Claiming stateVariable ${c} is unchanged in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}l[c]=!0,(Object.getOwnPropertyDescriptor(t.state[c],"value").get||t.state[c].immutable)&&(delete t.state[c].value,t.state[c].value=t.state[c]._previousValue)}if(s.makeEssential)for(let c of s.makeEssential){if(!(c in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} tried to make ${c} essential, which isn't a state variable.`);if(!t.state[c].isResolved)throw Error(`Attempting to make stateVariable ${c} of ${t.componentName} essential while it is still unresolved!`);if(!(c in l)){let d;if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let p of t.state[c].arrayEntryNames)if(p in l){d=p;break}}if(!d)throw Error(`Attempting to make stateVariable ${c} in definition of ${e} of ${t.componentName} essential, but it's not listed as an additional state variable defined.`)}t.state[c].essential=!0}if(s.makeImmutable)for(let c of s.makeImmutable){if(!(c in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} tried to make ${c} immutable, which isn't a state variable.`);if(!t.state[c].isResolved)throw Error(`Attempting to make stateVariable ${c} of ${t.componentName} immutable while it is still unresolved!`);if(!(c in l)){let d;if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let p of t.state[c].arrayEntryNames)if(p in l){d=p;break}}if(!d)throw Error(`Attempting to make stateVariable ${c} in definition of ${e} of ${t.componentName} immutable, but it's not listed as an additional state variable defined.`)}t.state[c].immutable=!0}if(s.alwaysShadow)for(let c of s.alwaysShadow){if(!(c in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} set alwaysShadow for ${c}, which isn't a state variable.`);if(!(c in l)){let d=!1;if(t.state[c].isArray&&t.state[c].arrayEntryNames){for(let p of t.state[c].arrayEntryNames)if(p in l){d=!0;break}}if(!d)throw Error(`Definition of state variable ${e} of ${t.componentName} set alwaysShadow for ${c}, but didn't set its value.`)}t.state[c].alwaysShadow=!0}if(s.setComponentType)for(let c in s.setComponentType){if(!t.state[c].hasVariableComponentType)throw Error(`Cannot set type of ${c} of ${t.componentName} as it it does not have the hasVariableComponentType attribute.`);let d=!1,p=t.state[c].componentType,m=s.setComponentType[c];if(Array.isArray(p)?Array.isArray(m)?(p.length!==m.length||p.some((f,h)=>f!=m[h]))&&(d=!0):d=!0:Array.isArray(m)?d=!0:d=p!==m,d&&(u[c]=!0),t.state[c].componentType=s.setComponentType[c],t.state[c].isArray&&t.state[c].arrayEntryNames){let f=s.setComponentType[c],h=Array.isArray(f);for(let y of t.state[c].arrayEntryNames)if(h){let b=t.state[y].arrayKeys,g=[];for(let C of b){let T=t.state[c].keyToIndex(C);g.push(f[T])}t.state[y].componentType=g}else t.state[y].componentType=f}}if(s.arraySizeChanged)for(let c of s.arraySizeChanged)t.state[c].adjustArrayToNewArraySize(),u[c]===void 0?u[c]={arrayKeysChanged:{}}:u[c]===!0&&(u[c]={allArrayKeysChanged:!0,arrayKeysChanged:{}}),u[c].arraySizeChanged=!0;for(let c in l){if(!(l[c]||t.state[c].isArrayEntry||t.state[c].isArray))throw Error(`definition of ${e} of ${t.componentName} didn't return value of ${c}`);t.state[c].isArray?(delete t.state[c].value,t.state[c].value=t.state[c].arrayValues):t.state[c].isArrayEntry&&(delete t.state[c].value,t.state[c].value=t.state[c].getValueFromArrayValues())}for(let c in u)if(this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:c,changes:u[c]}),t.state[c].isArray){let d=[];if(u[c]===!0||u[c].allArrayKeysChanged||u.arraySizeChanged)t.state[c].arrayEntryNames&&(d=t.state[c].arrayEntryNames);else{let p=t.state[c].varNamesIncludingArrayKeys;for(let m in u[c].arrayKeysChanged){let f=p[m];f&&d.push(...f)}}for(let p of d)this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:p})}return n.value}setValueToEssential({component:t,varName:e,useEssentialInfo:n}){let r=!1,a=!1,i=!1;if(t.state[e].isArray)if("__entire_array"in n)n=n.__entire_array;else{i=!0,a={},r={};for(let s in n)r[s]=!1}if(t.state[e].essential&&!i)return t.state[e].isArray||(delete t.state[e].value,t.state[e].value=t.state[e]._previousValue),{haveEssentialValue:!0,valueUnchanged:!0,byArrayEntries:i};if(t.potentialEssentialState)if(i){let s=t.state[e].arraySize;for(let l in n)if(t.state[e].essentialByArrayKey[l]||t.state[e].essential)r[l]=!0,a[l]=!0;else{let u=n[l].variablesToCheck;Array.isArray(u)||(u=[u]);let{foundEssential:c,value:d}=this.findPotentialEssentialValue({variablesToCheck:u,potentialEssentialState:t.potentialEssentialState});c&&(t.state[e].setArrayValue({value:d,arrayKey:l,arraySize:s}),t.state[e].essentialByArrayKey[l]=!0,r[l]=!0)}}else{let s=n.variablesToCheck;Array.isArray(s)||(s=[s]);let{foundEssential:l,value:u}=this.findPotentialEssentialValue({variablesToCheck:s,potentialEssentialState:t.potentialEssentialState});l&&(t.state[e].isArray?t.state[e].arrayValues=u:(delete t.state[e].value,t.state[e].value=u),t.state[e].essential=!0,r=!0)}else if(i)for(let s in n)(t.state[e].essentialByArrayKey[s]||t.state[e].essential)&&(r[s]=!0,a[s]=!0);return{haveEssentialValue:r,valueUnchanged:a,byArrayEntries:i}}findPotentialEssentialValue({variablesToCheck:t,potentialEssentialState:e}){for(let n of t){let r,a,i;if(typeof n=="string"?r=n:(r=n.variableName,a=n.mathComponentIndex,i=n.arrayIndex),e[r]!==void 0){let s=e[r];if(i!==void 0)if(Array.isArray(i))for(let l of i)s=s[l];else s=s[i];else a!==void 0&&s instanceof aC.class&&(s=s.get_component(a));return{foundEssential:!0,value:s}}}return{foundEssential:!1}}getStateVariableDefinitionArguments({component:t,stateVariable:e}){let n=this.dependencies.getStateVariableDependencyValues({component:t,stateVariable:e});n.componentName=t.componentName;let r=t.state[e];if(r.isArrayEntry?(n.arrayKeys=r.arrayKeys,n.arraySize=r.arraySize):r.isArray&&(n.arraySize=r.arraySize),r.providePreviousValuesInDefinition){let a=[e];r.additionalStateVariablesDefined&&a.push(...r.additionalStateVariablesDefined);let i={};for(let s of a)i[s]=t.state[s]._previousValue;n.previousValues=i}return n}recordActualChangeInStateVariable({componentName:t,varName:e,includeAdditionalStateVariables:n=!0}){let r=this._components[t];this.markStateVariableAndUpstreamDependentsStale({component:r,varName:e});let a=[e];n&&r.state[e].additionalStateVariablesDefined&&a.push(...r.state[e].additionalStateVariablesDefined);for(let i of a)r.state[i].forceRecalculation=!0,this.dependencies.recordActualChangeInUpstreamDependencies({component:r,varName:i})}findCaseInsensitiveMatches({stateVariables:t,componentClass:e}){let n=this.componentInfoObjects.stateVariableInfo[e.componentType],r=[];for(let a of t){let i=!1,s=a.toLowerCase();for(let d in n.stateVariableDescriptions)if(s===d.toLowerCase()){i=!0,r.push(d);break}if(i)continue;let l=!1,u=s;s.substring(0,13)==="__array_size_"&&(l=!0,u=s.substring(13));for(let d in n.aliases)if(u===d.toLowerCase()){l&&(d="__array_size_"+d),r.push(d),i=!0;break}if(i)continue;let c=Object.keys(n.arrayEntryPrefixes).sort((d,p)=>p.length-d.length);for(let d of c)if(s.substring(0,d.length)===d.toLowerCase()){let p=d+s.substring(d.length);i=!0,r.push(p);break}i||r.push(a)}return r}matchPublicStateVariables({stateVariables:t,componentClass:e}){let n=this.componentInfoObjects.publicStateVariableInfo[e.componentType],r=[];for(let a of t){if(a in n.stateVariableDescriptions){r.push(a);continue}let i=a;if(i in n.aliases&&(i=n.aliases[i],i in n.stateVariableDescriptions)){r.push(i);continue}let s=!1,l=Object.keys(n.arrayEntryPrefixes).sort((u,c)=>c.length-u.length);for(let u of l)if(i.substring(0,u.length)===u){s=!0;break}s?r.push(a):r.push("__not_public_"+a)}return r}substituteAliases({stateVariables:t,componentClass:e}){let n=[],r=this.componentInfoObjects.stateVariableInfo[e.componentType];for(let a of t){let i=!1;a.substring(0,13)==="__array_size_"&&(i=!0,a=a.substring(13)),a=a in r.aliases?r.aliases[a]:a,i&&(a="__array_size_"+a),n.push(a)}return n}publicCaseInsensitiveAliasSubstitutions({stateVariables:t,componentClass:e}){let n=this.findCaseInsensitiveMatches({stateVariables:t,componentClass:e});return n=this.matchPublicStateVariables({stateVariables:n,componentClass:e}),n=this.substituteAliases({stateVariables:n,componentClass:e}),n}checkIfArrayEntry({stateVariable:t,component:e}){for(let n in e.arrayEntryPrefixes)if(t.substring(0,n.length)===n)return!0;return!1}createFromArrayEntry({stateVariable:t,component:e,initializeOnly:n=!1}){if(!e.arrayEntryPrefixes)throw Error(`Unknown state variable ${t} of ${e.componentName}`);let r=Object.keys(e.arrayEntryPrefixes).sort((a,i)=>i.length-a.length);for(let a of r)if(t.substring(0,a.length)===a){let i=e.arrayEntryPrefixes[a];if(this.initializeStateVariable({component:e,stateVariable:t,arrayStateVariable:i,arrayEntryPrefix:a}),n)return;let s=[t];if(e.state[t].additionalStateVariablesDefined){s.push(...e.state[t].additionalStateVariablesDefined);for(let u of e.state[t].additionalStateVariablesDefined)e.state[u]||this.createFromArrayEntry({stateVariable:u,component:e,initializeOnly:!0})}this.dependencies.setUpStateVariableDependencies({component:e,stateVariable:t,allStateVariablesAffected:s,core:this});let l=[];for(let u of s)this.dependencies.checkForCircularDependency({componentName:e.componentName,varName:u}),l.push(u),e.state[u].determineDependenciesStateVariable&&l.push(e.state[u].determineDependenciesStateVariable);this.dependencies.resolveStateVariablesIfReady({component:e,stateVariables:l});return}throw Error(`Unknown state variable ${t} of ${e.componentName}`)}markStateVariableAndUpstreamDependentsStale({component:t,varName:e}){this.updateInfo.componentsTouched.push(t.componentName);let n={[e]:t.state[e]};t.state[e].additionalStateVariablesDefined&&t.state[e].additionalStateVariablesDefined.forEach(d=>n[d]=t.state[d]);let r=this.lookUpCurrentFreshness({component:t,varName:e,allStateVariablesAffectedObj:n}),a=[],i=[],s=0;for(let d in n){let p=n[d];Object.getOwnPropertyDescriptor(p,"value").get||p.immutable?r&&(r.fresh&&r.fresh[d]?i.push(d):r.partiallyFresh&&r.partiallyFresh[d]&&(s+=r.partiallyFresh[d])):a.push(d)}i.push(...a);let l=i.length>0||s>0,u={};for(let d in n)u[d]=!0;let c=!1;if(l){let d=this.processMarkStale({component:t,varName:e,allStateVariablesAffectedObj:n});if(d.fresh)for(let m in d.fresh)d.fresh[m]&&delete u[m];let p=0;for(let m in n){if(i.includes(m)&&!(d.fresh&&d.fresh[m])){c=!0;break}d.partiallyFresh&&d.partiallyFresh[m]&&(p+=d.partiallyFresh[m])}if(p<s&&(c=!0),d.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.push(t.componentName),d.updateDependencies)for(let m of d.updateDependencies)t.state[m].needDependenciesUpdated=!0;if(d.itemScoreChanged)for(let m of d.itemScoreChanged.itemNumbers)this.updateInfo.itemScoreChanges.add(m)}for(let d in u){let p=n[d];if(delete p.recursiveDependencyValues,a.includes(d)){p._previousValue=p.value,delete p.value;let m=this.getStateVariableValue;Object.defineProperty(p,"value",{get:()=>m({component:t,stateVariable:d}),configurable:!0})}}if(c)for(let d in u)this.markUpstreamDependentsStale({component:t,varName:d})}lookUpCurrentFreshness({component:t,varName:e,allStateVariablesAffectedObj:n}){let r=t.state[e];if(!r.getCurrentFreshness)return;let a=r.freshnessInfo,i,s;if(r.isArrayEntry&&(i=new Proxy(r._arrayKeys,q)),r.isArrayEntry||r.isArray){let u=t.state[r.arraySizeStateVariable];s=u._previousValue,!(Object.getOwnPropertyDescriptor(u,"value").get||u.immutable)&&(s=u.value),Array.isArray(s)?s=new Proxy(s,q):s=[]}let l=r.getCurrentFreshness({freshnessInfo:a,arrayKeys:i,arraySize:s});if(l.partiallyFresh){for(let u in n)if(n[u].isArrayEntry){let c=n[u].arrayStateVariable;l.partiallyFresh[u]=l.partiallyFresh[c],delete l.partiallyFresh[c]}}if(l.fresh){for(let u in n)if(n[u].isArrayEntry){let c=n[u].arrayStateVariable;c in l.fresh&&(l.fresh[u]=l.fresh[c],delete l.fresh[c])}}return l}processMarkStale({component:t,varName:e,allStateVariablesAffectedObj:n}){let r=t.state[e];if(!r.markStale||!r.initiallyResolved){let d={};return Object.keys(n).forEach(p=>d[p]=!1),{fresh:d}}let a={},i=this.dependencies.downstreamDependencies[t.componentName][e];for(let d in i){let p=i[d],m={},f=!1;p.componentIdentityChanged&&(m.componentIdentityChanged=!0,f=!0),p.componentIdentitiesChanged&&(m.componentIdentitiesChanged=!0,f=!0),p.valuesChanged&&(m.valuesChanged=p.valuesChanged,f=!0),f&&(a[d]=m)}let s=r.freshnessInfo,l,u;if(r.isArrayEntry&&(l=new Proxy(r._arrayKeys,q)),r.isArrayEntry||r.isArray){let d=t.state[r.arraySizeStateVariable];u=d._previousValue,!(Object.getOwnPropertyDescriptor(d,"value").get||d.immutable)&&(u=d.value),Array.isArray(u)?u=new Proxy(u,q):u=[]}let c=r.markStale({freshnessInfo:s,changes:a,arrayKeys:l,arraySize:u});if(c.partiallyFresh){for(let d in n)if(n[d].isArrayEntry){let p=n[d].arrayStateVariable;c.partiallyFresh[d]=c.partiallyFresh[p],delete c.partiallyFresh[p]}}if(c.fresh){for(let d in n)if(n[d].isArrayEntry){let p=n[d].arrayStateVariable;p in c.fresh&&(c.fresh[d]=c.fresh[p],delete c.fresh[p])}}return c}markUpstreamDependentsStale({component:t,varName:e}){let n=t.componentName,r=this.getStateVariableValue,a=this.dependencies.upstreamDependencies[n][e],i;if(t.state[e]&&(i=t.state[e].freshnessInfo),a)for(let s of a){let l=!1;if(s.markStale&&s.markStale(),s.downstreamComponentNames){let u=s.downstreamComponentNames.indexOf(n);if(u===-1)continue;if(s.originalDownstreamVariableNames.length>0){if(s.mappedDownstreamVariableNamesByComponent[u].indexOf(e)===-1)throw Error(`something went wrong as ${e} not a downstreamVariable of ${s.dependencyName}`);s.dependencyType==="determineDependencies"&&(s.recalculateDependencies=!0),s.valuesChanged||(s.valuesChanged=[]),s.valuesChanged[u]||(s.valuesChanged[u]={}),s.valuesChanged[u][e]||(s.valuesChanged[u][e]={}),s.valuesChanged[u][e].potentialChange=!0,i&&(s.valuesChanged[u][e].freshnessInfo=new Proxy(i,q)),l=!0}else e===s.downstreamVariableNameIfNoVariables&&(s.valuesChanged||(s.valuesChanged={[s.downstreamVariableNameIfNoVariables]:{}}),s.componentIdentityChanged=!0,s.valuesChanged[s.downstreamVariableNameIfNoVariables].potentialChange=!0,l=!0)}if(l){this.updateInfo.componentsTouched.push(s.upstreamComponentName);let u=s.upstreamVariableNames[0],c=this._components[s.upstreamComponentName],d={};s.upstreamVariableNames.forEach(C=>d[C]=c.state[C]);let p=this.lookUpCurrentFreshness({component:c,varName:u,allStateVariablesAffectedObj:d}),m=[],f=[],h=0;for(let C in d){let T=d[C];Object.getOwnPropertyDescriptor(T,"value").get||T.immutable?p&&(p.fresh&&p.fresh[C]?f.push(C):p.partiallyFresh&&p.partiallyFresh[C]&&(h+=p.partiallyFresh[C])):m.push(C)}f.push(...m);let y=f.length>0||h>0,b={};for(let C in d)b[C]=!0;let g=!1;if(y){let C=this.processMarkStale({component:c,varName:u,allStateVariablesAffectedObj:d});if(C.fresh)for(let v in C.fresh)C.fresh[v]&&delete b[v];let T=0;for(let v in d){if(f.includes(v)&&!(C.fresh&&C.fresh[v])){g=!0;break}C.partiallyFresh&&C.partiallyFresh[v]&&(T+=C.partiallyFresh[v])}if(T<h&&(g=!0),C.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.push(s.upstreamComponentName),C.updateDependencies)for(let v of C.updateDependencies)t.state[v].needDependenciesUpdated=!0;if(C.itemScoreChanged)for(let v of C.itemScoreChanged.itemNumbers)this.updateInfo.itemScoreChanges.add(v)}for(let C in b){let T=d[C];delete T.recursiveDependencyValues,m.includes(C)&&(T._previousValue=T.value,delete T.value,Object.defineProperty(T,"value",{get:()=>r({component:c,stateVariable:C}),configurable:!0}))}if(g)for(let C in b)this.markUpstreamDependentsStale({component:c,varName:C})}}}evaluatedDeferredChildStateVariables(t){for(let e of t.activeChildren)if(e.componentType==="string"){for(let n in e.state)if(e.state[n].deferred){let r=e.state[n].value}}}registerComponent(t){if(t.componentName in this._components)throw Error(`Duplicate componentName: ${t.componentName}`);this._components[t.componentName]=t}deregisterComponent(t,e=!0){if(e===!0)for(let n in t.allChildren)this.deregisterComponent(t.allChildren[n].component);delete this._components[t.componentName]}setAncestors(t,e=[]){t.ancestors=e;let n=[{componentName:t.componentName,componentClass:t.constructor},...t.ancestors];for(let r in t.allChildren){let a=this._components[r];this.setAncestors(a,n)}for(let r in t.attributes){let a=t.attributes[r];a.componentType&&this.setAncestors(a,n)}}addChildren({parent:t,indexOfDefiningChildren:e,newChildren:n}){this.spliceChildren(t,e,n);let r=this.processNewDefiningChildren({parent:t}),a={},i={};return n.forEach(s=>a[s.componentName]=s),r.success?{success:!0,deletedComponents:i,addedComponents:a}:r}processNewDefiningChildren({parent:t,expandComposites:e=!0}){this.parameterStack.push(t.sharedParameters,!1);let n=this.deriveChildResultsFromDefiningChildren({parent:t,expandComposites:e});this.parameterStack.pop();let r=[{componentName:t.componentName,componentClass:t.constructor},...t.ancestors];for(let a in t.allChildren){let i=this._components[a];this.setAncestors(i,r)}return n}spliceChildren(t,e,n){let r=t.definingChildren.length;if(!Number.isInteger(e)||e>r||e<0)throw Error("Can't add children at index "+e+". Invalid index.");t.definingChildren.splice(e,0,...n)}finishUpdate({deletedComponents:t,addedComponents:e,init:n=!1}={}){}deleteComponents({components:t,deleteUpstreamDependencies:e=!0,skipProcessingChildrenOfParents:n=[]}){Array.isArray(t)||(t=[t]);let r={};this.determineComponentsToDelete({components:t,deleteUpstreamDependencies:e,componentsToDelete:r});let a={};for(let l in r){let u=r[l],c=this.components[u.parentName];if(c===void 0||c.componentName in r)continue;let d=a[u.parentName];d===void 0&&(d={parent:this._components[u.parentName],childNamesToBeDeleted:new Set},a[u.parentName]=d),d.childNamesToBeDeleted.add(l)}let i=[];for(let l in r){let u=this._components[l];if(u.replacementOf){let c=u.replacementOf,p=c.replacements.map(m=>m.componentName).indexOf(l);p!==-1&&(c.replacements.splice(p,1),i.includes(c.componentName)||i.push(c.componentName))}}for(let l of i)l in r||this.dependencies.addBlockersFromChangedReplacements(this._components[l]);let s=[];for(let l in a){let u=a[l],c=u.parent;s.push(c),c.activeChildren&&this.evaluatedDeferredChildStateVariables(c);for(let d=c.definingChildren.length-1;d>=0;d--){let p=c.definingChildren[d];u.childNamesToBeDeleted.has(p.componentName)&&c.definingChildren.splice(d,1)}n.includes(c.componentName)||this.processNewDefiningChildren({parent:c,expandComposites:!1})}for(let l in r){let u=this._components[l];if(u.shadows){let c=this._components[u.shadows.componentName];c.shadowedBy.length===1?delete c.shadowedBy:c.shadowedBy.splice(c.shadowedBy.indexOf(u),1)}this.dependencies.deleteAllDownstreamDependencies({component:u});for(let c in this.dependencies.upstreamDependencies[u.componentName]){let d=this.dependencies.upstreamDependencies[u.componentName][c];for(let p of d)if(p.specifiedComponentName&&p.specifiedComponentName in r){let m=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[p.specifiedComponentName];m||(m=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[p.specifiedComponentName]=[]),m.includes(p)||m.push(p)}}this.dependencies.deleteAllUpstreamDependencies({component:u}),this.updateInfo.deletedStateVariables[u.componentName]||(this.updateInfo.deletedStateVariables[u.componentName]=[]),this.updateInfo.deletedStateVariables[u.componentName].push(...Object.keys(u.state)),this.updateInfo.deletedComponents[u.componentName]=!0,delete this.unsatisfiedChildLogic[u.componentName]}for(let l in r){let u=this._components[l];this.deregisterComponent(u,!1)}return this.updateInfo.componentsTouched=[...new Set(this.updateInfo.componentsTouched)].filter(l=>!(l in r)),this.updateInfo.compositesToUpdateReplacements=[...new Set(this.updateInfo.compositesToUpdateReplacements)].filter(l=>!(l in r)),{success:!0,deletedComponents:r,parentsOfDeleted:s}}determineComponentsToDelete({components:t,deleteUpstreamDependencies:e,componentsToDelete:n}){for(let r of t){if(r.componentName in n)continue;n[r.componentName]=this._components[r.componentName];let a=Object.values(r.allChildren).map(i=>i.component);for(let i in r.attributes){let s=r.attributes[i];s.componentType&&a.push(s)}r.adaptedFrom!==void 0&&a.push(r.adaptedFrom),e===!0&&(r.shadowedBy&&a.push(...r.shadowedBy),r.adapterUsed&&a.push(r.adapterUsed),r.replacements&&a.push(...r.replacements)),this.determineComponentsToDelete({components:a,deleteUpstreamDependencies:e,componentsToDelete:n})}}updateCompositeReplacements({component:t,componentChanges:e,sourceOfUpdate:n}){let r={},a={},i=new Set;if(t.shadows)return{success:!0,deletedComponents:r,addedComponents:a,parentsOfDeleted:i};let s=this.components[t.componentName];t.replacements||(t.replacements=[]);let l=t.constructor.calculateReplacementChanges({component:s,componentChanges:e,components:this.components,workspace:t.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});t.constructor.stateVariableToEvaluateAfterReplacements&&t.stateValues[t.constructor.stateVariableToEvaluateAfterReplacements];for(let c of l)if(c.changeType==="add"){c.replacementsToWithhold!==void 0&&this.adjustReplacementsToWithhold({component:t,change:c,componentChanges:e});let d=this._components[t.componentName];this.parameterStack.push(d.sharedParameters,!1);let p,m={[t.componentName]:qn(t)},f=c.numberReplacementsToReplace,h=c.firstReplacementInd;if(f>0&&c.changeTopLevelReplacements&&this.deleteReplacementsFromShadowsThenComposite({change:c,composite:t,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a,processNewChildren:!1}),c.serializedReplacements){let b=c.serializedReplacements,g;t.attributes.newNamespace?g=t.componentName+"/":g=Ht(t.componentName),p=this.createIsolatedComponentsSub({serializedComponents:b,ancestors:t.ancestors,createNameContext:t.componentName+"|replacements",namespaceForUnamed:g,componentsReplacementOf:t}).components}else throw Error("Invalid replacement change.");this.parameterStack.pop();let y={[t.componentName]:{newComponents:p,parent:c.parent}};if(d.shadowedBy){let b=this.createShadowedReplacements({replacementsToShadow:p,componentToShadow:d,parentToShadow:c.parent,currentShadowedBy:m,assignNamesOffset:c.assignNamesOffset,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a});Object.assign(y,b)}for(let b in y){let g=this._components[b];if(!g)continue;let C=y[b].newComponents;if(!g.isExpanded){this.expandCompositeComponent(g);let T={changeType:"addedReplacements",composite:g,newReplacements:g.replacements,topLevel:!0,firstIndex:0,numberDeleted:0};e.push(T);continue}for(let T of C)a[T.componentName]=T;if(c.changeTopLevelReplacements===!0){let T=this._components[g.parentName];g.replacements.splice(h,0,...C),this.dependencies.addBlockersFromChangedReplacements(g);let v={changeType:"addedReplacements",composite:g,newReplacements:C,topLevel:!0,firstIndex:h,numberDeleted:f};e.push(v),this.processNewDefiningChildren({parent:T,expandComposites:!1}),this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(T))}else{let T=this._components[y[b].parent.componentName];this.spliceChildren(T,c.indexOfDefiningChildren,C),this.processNewDefiningChildren({parent:T}),C.forEach(N=>a[N.componentName]=N),this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(T));let v={changeType:"addedReplacements",composite:g,newReplacements:C};e.push(v)}}}else if(c.changeType==="delete")c.replacementsToWithhold!==void 0&&this.adjustReplacementsToWithhold({component:t,change:c,componentChanges:e}),this.deleteReplacementsFromShadowsThenComposite({change:c,composite:t,componentsToDelete:c.components,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a});else{if(c.changeType==="moveDependency")throw Error("moveDependency not implemented");if(c.changeType==="addDependency")throw Error("addDependency not implemented");if(c.changeType==="updateStateVariables"){this.updateInfo.componentsTouched.push(c.component.componentName);let d={},p={};for(let m in c.stateChanges){let f={componentName:c.component.componentName,stateVariable:m,value:c.stateChanges[m],overrideFixed:!0};this.requestComponentChanges({instruction:f,initialChange:!1,workspace:d,newStateVariableValues:p})}this.processNewStateVariableValues(p)}else if(c.changeType==="changeReplacementsToWithhold"){if(c.replacementsToWithhold!==void 0){let d=this.adjustReplacementsToWithhold({component:t,change:c,componentChanges:e})}this.processChildChangesAndRecurseToShadows(t)}}return{success:!0,deletedComponents:r,addedComponents:a,parentsOfDeleted:i}}deleteReplacementsFromShadowsThenComposite({change:t,composite:e,componentsToDelete:n,componentChanges:r,sourceOfUpdate:a,parentsOfDeleted:i,deletedComponents:s,addedComponents:l,processNewChildren:u=!0}){let c=[];if(!e.isExpanded)return c;if(e.shadowedBy)for(let d of e.shadowedBy){let p;if(n){p=[];for(let f of n){let h;if(f.shadowedBy){for(let y of f.shadowedBy)if(y.shadows.compositeName===d.shadows.compositeName){h=y;break}}h?p.push(h):console.error(`could not find shadowing component of ${f.componentName}`)}}let m=this.deleteReplacementsFromShadowsThenComposite({change:t,composite:d,componentsToDelete:p,componentChanges:r,sourceOfUpdate:a,parentsOfDeleted:i,deletedComponents:s,addedComponents:l,processNewChildren:u});c.push(...m)}if(t.changeTopLevelReplacements){let d=t.firstReplacementInd,p=t.numberReplacementsToDelete;t.changeType==="add"&&(p=t.numberReplacementsToReplace);let m=e.replacements.splice(d,p);this.dependencies.addBlockersFromChangedReplacements(e);let f=this.deleteComponents({components:m,componentChanges:r,sourceOfUpdate:a,skipProcessingChildrenOfParents:[e.parentName]});if(u&&this.processNewDefiningChildren({parent:this._components[e.parentName],expandComposites:!1}),f.success===!1)throw Error("Couldn't delete components on composite update");for(let g of f.parentsOfDeleted)i.add(g.componentName),this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(g));let h={};for(let g in f.deletedComponents){let T=f.deletedComponents[g].parentName;h[T]===void 0&&(h[T]=[]),h[T].push(g)}let y={changeType:"deletedReplacements",composite:e,topLevel:!0,firstIndex:d,numberDeleted:p,deletedNamesByParent:h,deletedComponents:f.deletedComponents};r.push(y),Object.assign(s,f.deletedComponents);let b=this._components[e.parentName];this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(b))}else{let d=n.length,p=this.deleteComponents({components:n,deleteUpstreamDependencies:!1,componentChanges:r,sourceOfUpdate:a});if(p.success===!1)throw Error("Couldn't delete components prescribed by composite");for(let h of p.parentsOfDeleted)i.add(h.componentName),this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(h));let m={};for(let h in p.deletedComponents){let b=p.deletedComponents[h].parentName;m[b]===void 0&&(m[b]=[]),m[b].push(h)}let f={changeType:"deletedReplacements",composite:e,numberDeleted:d,deletedNamesByParent:m,deletedComponents:p.deletedComponents};r.push(f),Object.assign(s,p.deletedComponents),Object.assign(l,p.addedComponents)}return c}processChildChangesAndRecurseToShadows(t){let e=this._components[t.parentName];if(this.processNewDefiningChildren({parent:e,expandComposites:!1}),this.updateInfo.componentsTouched.push(...this.componentAndRenderedDescendants(e)),t.shadowedBy)for(let n of t.shadowedBy)this.processChildChangesAndRecurseToShadows(n)}createShadowedReplacements({replacementsToShadow:t,componentToShadow:e,parentToShadow:n,currentShadowedBy:r,assignNamesOffset:a,componentChanges:i,sourceOfUpdate:s,parentsOfDeleted:l,deletedComponents:u,addedComponents:c}){let d=qn(e);if(!r[e.componentName]||!d.every(f=>r[e.componentName].includes(f)))throw Error(`circular reference involving ${e.componentName}`);this.updateInfo.compositesBeingExpanded.push(e.componentName);let p={};for(let f of e.shadowedBy){if(this.updateInfo.compositesBeingExpanded.includes(f.componentName))throw Error(`circular dependence involving ${f.componentName}`);if(f.shadowedBy&&(r[f.componentName]=qn(f)),f.isExpanded){let h=t.map(v=>v.serialize({forCopy:!0}));if(h=Te({serializedComponents:h,componentName:f.shadows.compositeName}),f.constructor.assignNamesToReplacements){let v=f.constructor.originalNamesAreConsistent&&f.attributes.newNamespace;h=j({assignNames:f.doenetAttributes.assignNames,indOffset:a,serializedComponents:h,parentName:f.componentName,parentCreatesNewNamespace:f.attributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:v}).serializedComponents}else{let v=f.attributes.newNamespace;h=j({indOffset:a,serializedComponents:h,parentName:f.componentName,parentCreatesNewNamespace:f.attributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:v}).serializedComponents}let y,b=this._components[f.componentName];this.parameterStack.push(b.sharedParameters,!1);let g;f.attributes.newNamespace?g=f.componentName+"/":g=Ht(f.componentName);let C=this.createIsolatedComponentsSub({serializedComponents:h,ancestors:f.ancestors,createNameContext:f.componentName+"|replacements",namespaceForUnamed:g,componentsReplacementOf:f});this.parameterStack.pop(),y=C.components;let T;if(n){if(n.shadowedBy){for(let v of n.shadowedBy)if(v.shadows.compositeName===f.shadows.compositeName){T=v;break}}T||console.error(`could not find shadowing parent of ${n.componentName}`)}if(p[f.componentName]={newComponents:y,parent:T},f.shadowedBy){let v=this.createShadowedReplacements({replacementsToShadow:y,componentToShadow:f,parentToShadow:T,currentShadowedBy:r,assignNamesOffset:a,componentChanges:i,sourceOfUpdate:s,parentsOfDeleted:l,deletedComponents:u,addedComponents:c});Object.assign(p,v)}}}let m=this.updateInfo.compositesBeingExpanded.indexOf(e.componentName);if(m===-1)throw Error(`Something is wrong as we lost track that we were expanding ${component.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(m,1),p}adjustReplacementsToWithhold({component:t,change:e,componentChanges:n}){let r=[],a=e.replacementsToWithhold,i;if(t.replacementsToWithhold!==void 0?i=a-t.replacementsToWithhold:i=a,i<0){r.push(t.componentName);let s=t.replacements.length-a,l=t.replacements.length-a+i,u=t.replacements.slice(l,s),c={changeType:"addedReplacements",composite:t,topLevel:!0,newReplacements:u,firstIndex:l,numberDeleted:0};n.push(c)}else if(i>0){r.push(t.componentName);let s=t.replacements.length-a,l=s+i,u=t.replacements.slice(s,l),c={};for(let p of u){let m=p.parentName;c[m]===void 0&&(c[m]=[]),c[m].push(p.componentName)}let d={changeType:"deletedReplacements",composite:t,topLevel:!0,firstIndex:s,numberDeleted:i,deletedNamesByParent:c,deletedComponents:u};n.push(d)}if(t.replacementsToWithhold=a,this.dependencies.addBlockersFromChangedReplacements(t),t.shadowedBy)for(let s of t.shadowedBy){let l=this.adjustReplacementsToWithhold({component:s,change:e,componentChanges:n});r.push(...l)}return r}get standardComponentClasses(){return new Proxy(this._standardComponentClasses,q)}set standardComponentClasses(t){return null}get allComponentClasses(){return new Proxy(this._allComponentClasses,q)}set allComponentClasses(t){return null}isInheritedComponentType({inheritedComponentType:t,baseComponentType:e}){return t===e?!0:this.allComponentClasses[e].isPrototypeOf(this.allComponentClasses[t])}isCompositeComponent({componentType:t,includeNonStandard:e=!0}){let n=this.allComponentClasses[t];return n?this.isInheritedComponentType({inheritedComponentType:t,baseComponentType:"_composite"})&&(e||!n.treatAsComponentForRecursiveReplacements):!1}get componentTypesCreatingVariants(){return new Proxy(this._componentTypesCreatingVariants,q)}set componentTypesCreatingVariants(t){return null}get componentTypeWithPotentialVariants(){return new Proxy(this._componentTypeWithPotentialVariants,q)}set componentTypeWithPotentialVariants(t){return null}get components(){return new Proxy(this._components,q)}set components(t){return null}executeProcesses(){for(;this.processQueue.length>0;){let t=this.processQueue.splice(0,1)[0];if(t.type==="update")this.performUpdate(t);else if(t.type==="getStateVariableValues")this.performGetStateVariableValues(t);else throw Error(`Unrecognized process type: ${t.type}`)}this.processing=!1}requestStateVariableValues({requestedValues:t,callBack:e}){this.processQueue.push({type:"getStateVariableValues",requestedValues:t,callBack:e}),this.processing||(this.processing=!0,setTimeout(()=>this.executeProcesses(),0))}performGetStateVariableValues({requestedValues:t,callBack:e}){let n={},r=!0;for(let a in t){let i=this._components[a];if(!i)console.error(`Component ${a} does not exist.  Cannot get value of its state variables.`),r=!1;else{let s=n[a]={};for(let l of t[a]){let u=i.state[l];u?s[l]=u.value:(console.error(`State variable ${l} of component ${a} does not exist.  Cannot get its value.`),r=!1)}}}e&&setTimeout(()=>e({success:r,retrievedValues:n}))}requestAction({componentName:t,actionName:e,args:n}){let r=this.components[t];if(r&&r.actions){let a=r.actions[e];if(a)return a(n)}console.warn(`Cannot run action ${e} on component ${t}`)}requestUpdate({updateInstructions:t,transient:e=!1,event:n,callBack:r}){if(this.flags.readOnly){let a={};for(let i of t){let s=a[i.componentName];s||(s=a[i.componentName]={}),i.sourceInformation&&Object.assign(s,i.sourceInformation)}this.updateRendererInstructions({componentNames:t.map(i=>i.componentName),sourceOfUpdate:{sourceInformation:a}}),this.finishUpdate(),r&&setTimeout(()=>r({success:!1}),0);return}this.processQueue.push({type:"update",updateInstructions:t,transient:e,event:n,callBack:r}),this.processing||(this.processing=!0,this.executeProcesses())}performUpdate({updateInstructions:t,transient:e=!1,event:n,callBack:r}){let a={},i={},s={};for(let u of t){if(u.componentName){let c=i[u.componentName];c||(c=i[u.componentName]={}),u.sourceInformation&&Object.assign(c,u.sourceInformation)}u.updateType==="updateValue"?this.requestComponentChanges({instruction:u,workspace:s,newStateVariableValues:a}):u.updateType==="addComponents"?console.log("add component"):u.updateType==="deleteComponents"?console.log("delete component"):u.updateType==="executeUpdate"&&this.executeUpdateStateVariables({newStateVariableValues:a,preliminary:!0})}this.externalFunctions.localStateChanged&&setTimeout(()=>this.externalFunctions.localStateChanged({newStateVariableValues:a,contentId:this.contentId,sourceOfUpdate:{sourceInformation:i},transient:e}),0);let l=Infinity;for(;l>0;){let u=this.executeUpdateStateVariables({newStateVariableValues:a,sourceOfUpdate:{sourceInformation:i,local:!0}});if(!(u.nFailures&&u.nFailures<l))break;l=u.nFailures}if(this.updateInfo.itemScoreChanges.size>0){n&&(n.context||(n.context={}),n.context.itemCreditAchieved||(n.context.itemCreditAchieved={}),n.context.documentCreditAchieved=this.document.stateValues.creditAchieved);for(let u of this.updateInfo.itemScoreChanges)this.externalFunctions.submitResponse&&this.externalFunctions.submitResponse({itemNumber:u,itemCreditAchieved:this.document.stateValues.itemCreditAchieved[u],callBack:this.submitResponseCallBack}),n&&(n.context.itemCreditAchieved[Number(u)+1]=this.document.stateValues.itemCreditAchieved[u])}this.document.stateValues.itemCreditAchieved,n&&this.requestRecordEvent(n),r&&setTimeout(()=>r({success:!0}),0)}requestRecordEvent(t){this.externalFunctions.recordEvent&&(t.timestamp=new Date().toISOString().slice(0,19).replace("T"," "),t.result||(t.result={}),t.context||(t.context={}),this.externalFunctions.recordEvent(t))}executeUpdateStateVariables({newStateVariableValues:t,sourceOfUpdate:e,preliminary:n=!1}){let r={};for(let i in t){let s=this._components[i];if(s){let l=this.changedStateVariables[i];l||(l=this.changedStateVariables[i]={});for(let u in t[i]){let c=s.state[u];if(c)if(c.isArray){l[u]||(l[u]=new Set);for(let d in t[i][u])d!=="mergeObject"&&l[u].add(d)}else l[u]=!0}}}let a=this.processNewStateVariableValues(t);if(Object.assign(r,a),this.replacementChangesFromCompositesToUpdate(),n)return r;if(this.updateInfo.componentsTouched=[...new Set(this.updateInfo.componentsTouched)],this.updateRendererInstructions({componentNames:this.updateInfo.componentsTouched,sourceOfUpdate:e,recreatedComponents:this.updateInfo.recreatedComponents}),this.finishUpdate(),Object.keys(this.unsatisfiedChildLogic).length>0){let i="";for(let s in this.unsatisfiedChildLogic)i+=`Invalid children for ${s}: ${this.unsatisfiedChildLogic[s].message} `;console.warn(i)}return console.log("**** Components after updateValue"),console.log(this._components),r}replacementChangesFromCompositesToUpdate(){let t=[...new Set(this.updateInfo.compositesToUpdateReplacements)];this.updateInfo.compositesToUpdateReplacements=[];let e=[],n=0,r=[];for(;t.length>0;){for(let a of t){let i=this._components[a];if(i instanceof this.allComponentClasses._composite&&i.isExpanded)if(i.state.readyToExpandWhenResolved.initiallyResolved){let s=this.updateCompositeReplacements({component:i,componentChanges:r});for(let l in s.addedComponents){this.changedStateVariables[l]={};for(let u in this._components[l].state){let c=this._components[l].state[u];c.isArray?this.changedStateVariables[l][u]=new Set(c.getAllArrayKeys(c.arraySize)):c.isArrayEntry||(this.changedStateVariables[l][u]=!0)}}}else e.push(a)}if(t=[...new Set(this.updateInfo.compositesToUpdateReplacements)],this.updateInfo.compositesToUpdateReplacements=[],n++,n>100)throw Error("Seem to have an infinite loop while calculating replacement changes")}return this.updateInfo.compositesToUpdateReplacements=e,{componentChanges:r}}processNewStateVariableValues(t){let e=0,n=this.getStateVariableValue;for(let r in t){let a=this._components[r];if(a===void 0){console.warn(`can't update state variables of component ${r}, as it doesn't exist.`),e+=1;continue}let i=t[r];for(let s in i){let l=a.state[s];if(l===void 0){console.warn(`can't update state variable ${s} of component ${r}, as it doesn't exist.`),e+=1;continue}if(l.value,l._previousValue=l.value,l.isArray){let u=[];if(Array.isArray(i[s]))throw Error(`do we still want to support setting entire array in inverse direction? ${s}, ${r}`);for(let c in i[s]){if(c==="mergeObject")continue;if(!(l.essential||l.essentialByArrayKey[c])){console.warn(`can't update arrayKey ${c}  of state variable ${s} of component ${r}, as it is not an essential state variable.`),e+=1;continue}e+=l.setArrayValue({value:i[s][c],arrayKey:c,arraySize:l.arraySize}).nFailures;let p=l.varNamesIncludingArrayKeys[c];p&&u.push(...p)}for(let c of u){let d=a.state[c];Object.getOwnPropertyDescriptor(d,"value").get||d.immutable||(d._previousValue=d.value,delete d.value,Object.defineProperty(d,"value",{get:()=>n({component:a,stateVariable:c}),configurable:!0})),this.markUpstreamDependentsStale({component:a,varName:c}),this.dependencies.recordActualChangeInUpstreamDependencies({component:a,varName:c})}}else{if(!l.essential){console.warn(`can't update state variable ${s} of component ${r}, as it is not an essential state variable.`),e+=1;continue}l.set?l.value=l.set(i[s]):l.value=i[s],delete l.usedDefault}this.markUpstreamDependentsStale({component:a,varName:s}),this.dependencies.recordActualChangeInUpstreamDependencies({component:a,varName:s})}}return{nFailures:e}}requestComponentChanges({instruction:t,initialChange:e=!0,workspace:n,newStateVariableValues:r}){let a=this._components[t.componentName],i=this.substituteAliases({stateVariables:[t.stateVariable],componentClass:a.constructor})[0];n[t.componentName]===void 0&&(n[t.componentName]={});let s=n[t.componentName],l=a.state[i],u=l.additionalStateVariablesDefined,c=[i];u&&c.push(...u);for(let b of c)if(!a.state[b].isResolved&&!this.dependencies.resolveItem({componentName:a.componentName,type:"stateVariable",stateVariable:b}).success)throw Error(`Can't get value of ${i} of ${a.componentName} as ${b} couldn't be resolved.`);let d=this.getStateVariableDefinitionArguments({component:a,stateVariable:i});d.componentInfoObjects=this.componentInfoObjects,d.initialChange=e,d.stateValues=a.stateValues,d.overrideFixed=t.overrideFixed,d.shadowedVariable=t.shadowedVariable;let p=i;if(l.isArrayEntry){let b=l.arrayStateVariable;p=b;let g={};if(d.arrayKeys.length===1){if("value"in t)g[d.arrayKeys[0]]=t.value;else if("valueOfStateVariable"in t){let C=this.substituteAliases({stateVariables:[t.valueOfStateVariable],componentClass:a.constructor})[0],T=a.state[C];if(T)g[d.arrayKeys[0]]=T.value;else throw Error(`Invalid instruction to change ${t.stateVariable} of ${t.componentName}, value of state variable ${t.valueOfStateVariable} not found.`)}}else for(let[C,T]of d.arrayKeys.entries())g[T]=t.value[C];d.desiredStateVariableValues={[b]:g}}else if("value"in t)d.desiredStateVariableValues={[i]:t.value};else if("valueOfStateVariable"in t){let b=this.substituteAliases({stateVariables:[t.valueOfStateVariable],componentClass:a.constructor})[0],g=a.state[b];if(g)d.desiredStateVariableValues={[i]:g.value};else throw Error(`Invalid instruction to change ${t.stateVariable} of ${t.componentName}, value of state variable ${t.valueOfStateVariable} not found.`)}let m=s[p];if(m===void 0&&(m=s[p]={}),l.additionalStateVariablesDefined)for(let b of l.additionalStateVariablesDefined){let g=b;a.state[b].isArray&&(g=l.arrayStateVariable);let T=s[g];T&&(Object.assign(m,T),s[g]=m)}if(d.workspace=m,t.additionalStateVariableValues)for(let b in t.additionalStateVariableValues){if(!l.additionalStateVariablesDefined.includes(b)){console.warn(`Can't invert ${b} at the same time as ${i}, as not an additional state variable defined`);continue}d.desiredStateVariableValues[b]=t.additionalStateVariableValues[b]}if(this.updateInfo.componentsTouched.push(a.componentName),!l.inverseDefinition){console.warn(`Cannot change state variable ${i} of ${a.componentName} as it doesn't have an inverse definition`);return}if(a.stateValues.fixed&&!t.overrideFixed){console.log(`Changing ${i} of ${a.componentName} did not succeed because fixed is true.`);return}if(!(e||a.stateValues.modifyIndirectly!==!1)){console.log(`Changing ${i} of ${a.componentName} did not succeed because modifyIndirectly is false.`);return}let f=l.inverseDefinition(d);if(!f.success){console.log(`Changing ${i} of ${a.componentName} did not succeed.`);return}let h=[],y;for(let b of f.instructions){let g=!1;if(b.setDependency){let C=b.setDependency,T=this.dependencies.downstreamDependencies[a.componentName][i][C];if(["stateVariable","parentStateVariable"].includes(T.dependencyType)&&T.downstreamComponentNames.length===1){let v=T.downstreamComponentNames[0],N=T.mappedDownstreamVariableNamesByComponent[0][0],V=this._components[v].state[N];if(V.isArrayEntry||V.isArray){let x=V.isArrayEntry?V.arrayStateVariable:N;if(y&&!(y.componentName===v&&y.stateVariable===x&&y.shadowedVariable===b.shadowedVariable&&y.treatAsInitialChange===b.treatAsInitialChange)&&(h.push(y),y=void 0),!b.additionalDependencyValues)if(g=!0,y||(y={combinedArray:!0,componentName:v,stateVariable:x,shadowedVariable:b.shadowedVariable,treatAsInitialChange:b.treatAsInitialChange,desiredValue:{}}),V.isArrayEntry){let w=V.arrayKeys;if(w.length===1)y.desiredValue[w[0]]=b.desiredValue;else for(let[D,I]of w.entries())y.desiredValue[I]=b.desiredValue[D]}else Object.assign(y.desiredValue,b.desiredValue)}}}g||(y&&(h.push(y),y=void 0),h.push(b))}y&&(h.push(y),y=void 0);for(let b of h)if(b.setStateVariable){if(!("value"in b))throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: setStateVariable must specify a value`);r[a.componentName]||(r[a.componentName]={}),a.state[b.setStateVariable].isArray?(r[a.componentName][b.setStateVariable]||(r[a.componentName][b.setStateVariable]={mergeObject:!0}),Object.assign(r[a.componentName][b.setStateVariable],b.value)):r[a.componentName][b.setStateVariable]=b.value}else if(b.setDependency){let g=b.setDependency,C=this.dependencies.downstreamDependencies[a.componentName][i][g];if(C.dependencyType==="child"){let T=C.downstreamComponentNames[b.childIndex];if(!T)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${g} child of index ${b.childIndex} does not exist.`);let v=C.mappedDownstreamVariableNamesByComponent[b.childIndex][b.variableIndex];if(!v)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${g} variable of index ${b.variableIndex} does not exist.`);let N={componentName:T,stateVariable:v,value:b.desiredValue,overrideFixed:t.overrideFixed,arrayKey:b.arrayKey};this.requestComponentChanges({instruction:N,initialChange:b.treatAsInitialChange===!0,workspace:n,newStateVariableValues:r})}else if(C.dependencyType==="attributeComponent"){let T=C.downstreamComponentNames[0],v=C.mappedDownstreamVariableNamesByComponent[0][b.variableIndex];if(!v)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${g} variable of index ${b.variableIndex} does not exist.`);let N={componentName:T,stateVariable:v,value:b.desiredValue,overrideFixed:t.overrideFixed,arrayKey:b.arrayKey};this.requestComponentChanges({instruction:N,initialChange:b.treatAsInitialChange===!0,workspace:n,newStateVariableValues:r})}else if(["stateVariable","parentStateVariable"].includes(C.dependencyType)&&C.downstreamComponentNames.length===1){let T=C.downstreamComponentNames[0],v=C.mappedDownstreamVariableNamesByComponent[0][0],N={componentName:T,stateVariable:v,value:b.desiredValue,overrideFixed:t.overrideFixed,shadowedVariable:b.shadowedVariable};if(b.additionalDependencyValues){let V=this.components[T].state[v];for(let x in b.additionalDependencyValues){let w=this.dependencies.downstreamDependencies[a.componentName][i][x];if(!(["stateVariable","parentStateVariable"].includes(w.dependencyType)&&w.downstreamComponentNames.length===1)){console.warn(`Can't simultaneously set additional dependency value ${x} if it isn't a state variable`);continue}let D=w.mappedDownstreamVariableNamesByComponent[0][0];if(w.downstreamComponentNames[0]!==T||!V.additionalStateVariablesDefined.includes(D)){console.warn(`Can't simultaneously set additional dependency value ${x} if it doesn't correspond to additional state variable defined of ${g}'s state variable`);continue}N.additionalStateVariableValues||(N.additionalStateVariableValues={}),N.additionalStateVariableValues[D]=b.additionalDependencyValues[x]}}this.requestComponentChanges({instruction:N,initialChange:b.treatAsInitialChange===!0,workspace:n,newStateVariableValues:r})}else throw Error(`unimplemented dependency type ${C.dependencyType} in requestComponentChanges`)}else if(b.combinedArray){let g={componentName:b.componentName,stateVariable:b.stateVariable,value:b.desiredValue,overrideFixed:t.overrideFixed,shadowedVariable:b.shadowedVariable};this.requestComponentChanges({instruction:g,initialChange:b.treatAsInitialChange===!0,workspace:n,newStateVariableValues:r})}else if(b.deferSettingDependency){let g=b.deferSettingDependency,C=this.dependencies.downstreamDependencies[a.componentName][i][g];if(C.dependencyType==="child"){let T=C.downstreamComponentNames[b.childIndex];if(!T)throw Error(`Invalid for deferSettingDependency in inverse definition of ${i} of ${a.componentName}: ${g} child of index ${b.childIndex} does not exist.`);let v=C.mappedDownstreamVariableNamesByComponent[b.childIndex][b.variableIndex];if(!v)throw Error(`Invalid for deferSettingDependency in inverse definition of ${i} of ${a.componentName}: ${g} variable of index ${b.variableIndex} does not exist..`);let N=this._components[T];if(N.componentType!=="string")throw Error("deferStateVariableDependency is implemented just when dependency is a string.");Object.getOwnPropertyDescriptor(N.state[v],"value").get||(N.state[v]._previousValue=N.state[v].value),delete N.state[v].value;let V=()=>this.getDeferredStateVariable({component:N,stateVariable:v,upstreamComponent:a,upstreamStateVariable:i,dependencyValues:b.dependencyValues,inverseDefinition:b.inverseDefinition});Object.defineProperty(N.state[v],"value",{get:V,configurable:!0}),N.state[v].deferred=!0}else throw Error(`unimplemented dependency type ${C.dependencyType} in requestComponentChanges`)}else throw console.log(b),Error(`Unrecognized instruction in inverse definition of ${i} of ${a.componentName}`)}submitResponseCallBack(t){console.log("submit response callback"),console.log(t)}getDeferredStateVariable({component:t,stateVariable:e,upstreamComponent:n,upstreamStateVariable:r,dependencyValues:a,inverseDefinition:i}){let s=i({dependencyValues:a,stateValues:n.stateValues});if(!s.success){console.warn(`Inverse definition for deferring state variable failed. component: ${t.componentName}, stateVariable: ${e}, upstreamComponent: ${n.componentName}, upstreamStateVariable: ${r}`);return}for(let l of s.instructions)if(l.setDependency){let u=l.setDependency,c=this.dependencies.downstreamDependencies[n.componentName][r][u];if(c.dependencyType==="child"){let d=c.downstreamComponentNames[l.childIndex];if(!d)throw Error(`Invalid inverse definition of ${e} of ${t.componentName}: ${u} child of index ${l.childIndex} does not exist.`);let p=c.mappedDownstreamVariableNamesByComponent[l.childIndex][l.variableIndex];if(!p)throw Error(`Invalid inverse definition of ${e} of ${t.componentName}: ${u} variable of index ${l.variableIndex} does not exist..`);let m=this._components[d];delete m.state[p].value,delete m.state[p].deferred,m.state[p].value=l.desiredValue}else throw Error(`unimplemented dependency type ${c.dependencyType} in deferred inverse definition`)}else throw Error(`Unrecognized instruction deferred inverse definition of ${e} of ${t.componentName}`);if(Object.getOwnPropertyDescriptor(t.state[e],"value").get)throw Error(`deferred inverse definition of ${e} of ${t.componentName} didn't return value of variable`);return t.state[e].value}calculateScoredItemNumberOfContainer(t){let n=[...this._components[t].ancestors.slice(0,-1).reverse().map(i=>i.componentName),t],r,a;for(let[i,s]of this.document.stateValues.scoredDescendants.entries()){for(let l of n)if(s.componentName===l){r=l,a=i+1;break}if(r!==void 0)break}return r===void 0&&(r=this.document.componentName,a=this.document.stateValues.scoredDescendants.length),{scoredItemNumber:a,scoredComponent:r}}get doenetState(){return this._renderComponents}set doenetState(t){return null}get scoredItemWeights(){return this.document.stateValues.scoredDescendants.map(t=>t.stateValues.weight)}requestAnimationFrame(t,e){if(!this.preventMoreAnimations){let n=++this.lastAnimationID;if(e){let r=window.setTimeout(a=>this._requestAnimationFrame(t,n),e);return this.animationIDs[n]={timeoutID:r},n}else return this.animationIDs[n]={},this._requestAnimationFrame(t,n)}}_requestAnimationFrame(t,e){let n=window.requestAnimationFrame(t),r=this.animationIDs[e];return delete r.timeoutID,r.animationFrameID=n,e}cancelAnimationFrame(t){let e=this.animationIDs[t],n=e.timeoutID;n!==void 0&&window.clearTimeout(n);let r=e.animationFrameID;r!==void 0&&window.cancelAnimationFrame(r),delete this.animationIDs[t]}componentWillUnmount(){this.preventMoreAnimations=!0;for(let t in this.animationIDs)this.coreFunctions.cancelAnimationFrame(t);this.animationIDs={}}},iC=Qo;function jn({value:o,attributeSpecification:t,attribute:e}){if(t.valueTransformations&&o in t.valueTransformations&&(o=t.valueTransformations[o]),t.toLowerCase&&(o=o.toLowerCase()),t.trim&&(o=o.trim()),t.validValues){if(!t.validValues.includes(o)){let n=t.validValues[0];console.warn(`Invalid value ${o} for attribute ${e}, using value ${n}`),o=n}}else t.clamp&&(o<t.clamp[0]?o=t.clamp[0]:o>t.clamp[1]?o=t.clamp[1]:Number.isFinite(o)||(o=e.defaultValue));return o}function qn(o){let t=[];if(o.shadowedBy)for(let e of o.shadowedBy){t.push(e.componentName);let n=qn(e);t.push(...n)}if(o.replacementOf){let e=qn(o.replacementOf);t.push(...e)}return t}export{iC as default};
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
