var Core=function(){"use strict";class ParameterStack{constructor(e){this.stack=[{}],void 0!==e&&Object.assign(this.parameters,e)}get parameters(){return this.stack[this.stack.length-1]}push(e,t=!0){let n={};t?(Object.assign(n,this.parameters),void 0!==e&&Object.assign(n,e)):n=e,this.stack.push(n)}pop(){let e=this.stack.pop();return 0===this.stack.length&&(this.stack=[{}]),e}}class Numerics{constructor({maxIterationsRoot:e=80,maxIterationsMinimize:t=500,eps:n=1e-6}={}){this.maxIterationsRoot=e,this.maxIterationsMinimize=t,this.eps=n}fzero(e,t,n){var r,a,i,o,s,l,u,c,p,d,m,f,h,y,b,g,v,T,C,N,A=this.eps,S=this.maxIterationsRoot,w=0;if(Array.isArray(t)){if(t.length<2)throw new Error("fzero: length of array x0 has to be at least two.");r=t[0],o=e.call(n,r),a=t[1],s=e.call(n,a)}else{for(r=t,o=e.call(n,r),d=(c=[.9*(u=0===r?1:r),1.1*u,u-1,u+1,.5*u,1.5*u,-u,2*u,-10*u,10*u]).length,p=0;p<d&&(a=c[p],!(o*(s=e.call(n,a))<=0));p++);a<r&&(m=r,r=a,a=m,f=o,o=s,s=f)}if(o*s>0)return Array.isArray(t)?this.fminbr(e,[r,a],n).x:this.Newton(e,r,n);for(i=r,l=o;w<S;){if(h=a-r,Math.abs(l)<Math.abs(s)&&(r=a,a=i,i=r,o=s,s=l,l=o),v=.5*A*(Math.abs(a)+1),N=.5*(i-a),Math.abs(N)<=v&&Math.abs(s)<=A)return a;Math.abs(h)>=v&&Math.abs(o)>Math.abs(s)&&(b=i-a,r===i?(T=b*(y=s/o),C=1-y):(T=(g=s/o)*(b*(C=o/l)*(C-(y=s/l))-(a-r)*(y-1)),C=(C-1)*(y-1)*(g-1)),T>0?C=-C:T=-T,T<.75*b*C-.5*Math.abs(v*C)&&T<Math.abs(h*C*.5)&&(N=T/C)),Math.abs(N)<v&&(N=N>0?v:-v),r=a,o=s,a+=N,((s=e.call(n,a))>0&&l>0||s<0&&l<0)&&(i=r,l=o),w++}return a}fminbr(e,t,n,r){let a=void 0!==r?r:this.eps;var i,o,s,l,u,c,p,d,m,f,h,y,b,g,v,T,C=.5*(3-Math.sqrt(5)),N=a,A=a,S=this.maxIterationsMinimize,w=0;if(!Array.isArray(t)||t.length<2)throw new Error("Numerics.fminbr: length of array x0 has to be at least two.");if(l=(i=t[0])+C*((o=t[1])-i),p=e.call(n,l),Number.isNaN(p))return{success:!1};for(s=l,u=l,c=p,d=p;w<S;){if(m=o-i,f=.5*(i+o),h=A*Math.abs(s)+N/3,Math.abs(s-f)+.5*m<=2*h)return{success:!0,x:s,fx:c,tol:h};if(y=C*(s<f?o-s:i-s),Math.abs(s-u)>=h&&(b=(s-l)*(g=(s-l)*(c-d))-(s-u)*(v=(s-u)*(c-p)),(g=2*(g-v))>0?b=-b:g=-g,Math.abs(b)<Math.abs(y*g)&&b>g*(i-s+2*h)&&b<g*(o-s-2*h)&&(y=b/g)),Math.abs(y)<h&&(y=y>0?h:-h),v=s+y,T=e.call(n,v),Number.isNaN(T))return{success:!1};T<=c?(v<s?o=s:i=s,l=u,u=s,s=v,p=d,d=c,c=T):(v<s?i=v:o=v,T<=d||u===s?(l=u,u=v,p=d,d=T):(T<=p||l===s||l===u)&&(l=v,p=T)),w+=1}return{success:!1,x:s,fx:c}}Newton(e,t,n){var r,a=0,i=this.eps,o=e.apply(n,[t]);for(Array.isArray(t)&&(t=t[0]);a<50&&Math.abs(o)>i;)r=this.D(e,n)(t),Math.abs(r)>i?t-=o/r:t+=.2*Math.random()-1,o=e.apply(n,[t]),a+=1;return t}D(e,t){return null!=t?function(t){var n=1e-5;return(e(t+n)-e(t-n))/2e-5}:function(n){var r=1e-5;return(e.apply(t,[n+r])-e.apply(t,[n-r]))/2e-5}}}function _prng_restore(e,t,n){let r=n&&n.state;r&&("object"==typeof r&&t.copy(r,t),e.state=()=>t.copy(t,{}))}function prng_alea(e,t){let n=new AleaGen(e),r=()=>n.next();return r.double=()=>r()+11102230246251565e-32*(2097152*r()|0),r.int32=()=>4294967296*n.next()|0,r.quick=r,_prng_restore(r,n,t),r}class AleaGen{constructor(e){null==e&&(e=+new Date);let t=4022871197;function n(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)}this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){let{c:e,s0:t,s1:n,s2:r}=this,a=2091639*t+2.3283064365386963e-10*e;return this.s0=n,this.s1=r,this.s2=a-(this.c=0|a)}copy(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}}var global$V="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$V.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$V.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version$1="",versions$1={},release={},config={};function noop$1(){}var on$1=noop$1,addListener=noop$1,once=noop$1,off=noop$1,removeListener=noop$1,removeAllListeners=noop$1,emit=noop$1;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$V.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var browser$1={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version$1,versions:versions$1,on:on$1,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)lookup[t]=e[t],revLookup[e.charCodeAt(t)]=t;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var t,n,r,a,i,o;inited||init();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===e[s-2]?2:"="===e[s-1]?1:0,o=new Arr(3*s/4-i),r=i>0?s-4:s;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)a=revLookup[e.charCodeAt(t)]<<18|revLookup[e.charCodeAt(t+1)]<<12|revLookup[e.charCodeAt(t+2)]<<6|revLookup[e.charCodeAt(t+3)],o[l++]=a>>16&255,o[l++]=a>>8&255,o[l++]=255&a;return 2===i?(a=revLookup[e.charCodeAt(t)]<<2|revLookup[e.charCodeAt(t+1)]>>4,o[l++]=255&a):1===i&&(a=revLookup[e.charCodeAt(t)]<<10|revLookup[e.charCodeAt(t+1)]<<4|revLookup[e.charCodeAt(t+2)]>>2,o[l++]=a>>8&255,o[l++]=255&a),o}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,n){for(var r,a=[],i=t;i<n;i+=3)r=(e[i]<<16)+(e[i+1]<<8)+e[i+2],a.push(tripletToBase64(r));return a.join("")}function fromByteArray(e){var t;inited||init();for(var n=e.length,r=n%3,a="",i=[],o=16383,s=0,l=n-r;s<l;s+=o)i.push(encodeChunk(e,s,s+o>l?l:s+o));return 1===r?(t=e[n-1],a+=lookup[t>>2],a+=lookup[t<<4&63],a+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],a+=lookup[t>>10],a+=lookup[t>>4&63],a+=lookup[t<<2&63],a+="="),i.push(a),i.join("")}function read(e,t,n,r,a){var i,o,s=8*a-r-1,l=(1<<s)-1,u=l>>1,c=-7,p=n?a-1:0,d=n?-1:1,m=e[t+p];for(p+=d,i=m&(1<<-c)-1,m>>=-c,c+=s;c>0;i=256*i+e[t+p],p+=d,c-=8);for(o=i&(1<<-c)-1,i>>=-c,c+=r;c>0;o=256*o+e[t+p],p+=d,c-=8);if(0===i)i=1-u;else{if(i===l)return o?NaN:1/0*(m?-1:1);o+=Math.pow(2,r),i-=u}return(m?-1:1)*o*Math.pow(2,i-r)}function write(e,t,n,r,a,i){var o,s,l,u=8*i-a-1,c=(1<<u)-1,p=c>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:i-1,f=r?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+p>=1?d/l:d*Math.pow(2,1-p))*l>=2&&(o++,l/=2),o+p>=c?(s=0,o=c):o+p>=1?(s=(t*l-1)*Math.pow(2,a),o+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,a),o=0));a>=8;e[n+m]=255&s,m+=f,s/=256,a-=8);for(o=o<<a|s,u+=a;u>0;e[n+m]=255&o,m+=f,o/=256,u-=8);e[n+m-f]|=128*h}var toString$j={}.toString,isArray$9=Array.isArray||function(e){return"[object Array]"==toString$j.call(e)},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,t){if(kMaxLength()<t)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer.prototype:(null===e&&(e=new Buffer(t)),e.length=t),e}function Buffer(e,t,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}return from$1(this,e,t,n)}function from$1(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer(e,t,n,r):"string"==typeof t?fromString(e,t,n):fromObject(e,t)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,t,n,r){return assertSize(t),t<=0?createBuffer(e,t):void 0!==n?"string"==typeof r?createBuffer(e,t).fill(n,r):createBuffer(e,t).fill(n):createBuffer(e,t)}function allocUnsafe(e,t){if(assertSize(t),e=createBuffer(e,t<0?0:0|checked(t)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function fromString(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|byteLength(t,n),a=(e=createBuffer(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}function fromArrayLike(e,t){var n=t.length<0?0:0|checked(t.length);e=createBuffer(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function fromArrayBuffer(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),Buffer.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer.prototype:e=fromArrayLike(e,t),e}function fromObject(e,t){if(internalIsBuffer(t)){var n=0|checked(t.length);return 0===(e=createBuffer(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan(t.length)?createBuffer(e,0):fromArrayLike(e,t);if("Buffer"===t.type&&isArray$9(t.data))return fromArrayLike(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function internalIsBuffer(e){return!(null==e||!e._isBuffer)}function byteLength(e,t){if(internalIsBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(e).length;default:if(r)return utf8ToBytes(e).length;t=(""+t).toLowerCase(),r=!0}}function slowToString(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,n);case"utf8":case"utf-8":return utf8Slice(this,t,n);case"ascii":return asciiSlice(this,t,n);case"latin1":case"binary":return latin1Slice(this,t,n);case"base64":return base64Slice(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function swap(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function bidirectionalIndexOf(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Buffer.from(t,r)),internalIsBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,n,r,a);if("number"==typeof t)return t&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):arrayIndexOf(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,n,r,a){var i,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var c=-1;for(i=n;i<s;i++)if(u(e,i)===u(t,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*o}else-1!==c&&(i-=i-c),c=-1}else for(n+l>s&&(n=s-l),i=n;i>=0;i--){for(var p=!0,d=0;d<l;d++)if(u(e,i+d)!==u(t,d)){p=!1;break}if(p)return i}return-1}function hexWrite(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function utf8Write(e,t,n,r){return blitBuffer(utf8ToBytes(t,e.length-n),e,n,r)}function asciiWrite(e,t,n,r){return blitBuffer(asciiToBytes(t),e,n,r)}function latin1Write(e,t,n,r){return asciiWrite(e,t,n,r)}function base64Write(e,t,n,r){return blitBuffer(base64ToBytes(t),e,n,r)}function ucs2Write(e,t,n,r){return blitBuffer(utf16leToBytes(t,e.length-n),e,n,r)}function base64Slice(e,t,n){return 0===t&&n===e.length?fromByteArray(e):fromByteArray(e.slice(t,n))}function utf8Slice(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,l,u=e[a],c=null,p=u>239?4:u>223?3:u>191?2:1;if(a+p<=n)switch(p){case 1:u<128&&(c=u);break;case 2:128==(192&(i=e[a+1]))&&(l=(31&u)<<6|63&i)>127&&(c=l);break;case 3:i=e[a+1],o=e[a+2],128==(192&i)&&128==(192&o)&&(l=(15&u)<<12|(63&i)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128==(192&i)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,p=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),a+=p}return decodeCodePointsArray(r)}Buffer.TYPED_ARRAY_SUPPORT=void 0===global$V.TYPED_ARRAY_SUPPORT||global$V.TYPED_ARRAY_SUPPORT,Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,t,n){return from$1(null,e,t,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(e,t,n){return alloc(null,e,t,n)},Buffer.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer.isBuffer=isBuffer$1,Buffer.compare=function(e,t){if(!internalIsBuffer(e)||!internalIsBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!isArray$9(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Buffer.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var i=e[n];if(!internalIsBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,a),a+=i.length}return r},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,n,r,a){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),l=this.slice(r,a),u=e.slice(t,n),c=0;c<s;++c)if(l[c]!==u[c]){i=l[c],o=u[c];break}return i<o?-1:o<i?1:0},Buffer.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Buffer.prototype.indexOf=function(e,t,n){return bidirectionalIndexOf(this,e,t,n,!0)},Buffer.prototype.lastIndexOf=function(e,t,n){return bidirectionalIndexOf(this,e,t,n,!1)},Buffer.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return hexWrite(this,e,t,n);case"utf8":case"utf-8":return utf8Write(this,e,t,n);case"ascii":return asciiWrite(this,e,t,n);case"latin1":case"binary":return latin1Write(this,e,t,n);case"base64":return base64Write(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=MAX_ARGUMENTS_LENGTH));return n}function asciiSlice(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function latin1Slice(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function hexSlice(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=toHex(e[i]);return a}function utf16leSlice(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function checkOffset(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,n,r,a,i){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function objectWriteUInt32(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function checkIEEE754(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(e,t,n,r,a){return a||checkIEEE754(e,t,n,4),write(e,t,n,r,23,4),n+4}function writeDouble(e,t,n,r,a){return a||checkIEEE754(e,t,n,8),write(e,t,n,r,52,8),n+8}Buffer.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Buffer.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Buffer.prototype;else{var a=t-e;n=new Buffer(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},Buffer.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||checkOffset(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},Buffer.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||checkOffset(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},Buffer.prototype.readUInt8=function(e,t){return t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||checkOffset(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},Buffer.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||checkOffset(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readInt8=function(e,t){return t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){t||checkOffset(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function(e,t){t||checkOffset(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function(e,t){return t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||checkInt(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},Buffer.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||checkInt(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},Buffer.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);checkInt(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},Buffer.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);checkInt(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},Buffer.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeFloatLE=function(e,t,n){return writeFloat(this,e,t,!0,n)},Buffer.prototype.writeFloatBE=function(e,t,n){return writeFloat(this,e,t,!1,n)},Buffer.prototype.writeDoubleLE=function(e,t,n){return writeDouble(this,e,t,!0,n)},Buffer.prototype.writeDoubleBE=function(e,t,n){return writeDouble(this,e,t,!1,n)},Buffer.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},Buffer.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Buffer.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,r).toString()),s=o.length;for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function asciiToBytes(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function utf16leToBytes(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a=n%256,i.push(a),i.push(r);return i}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function isnan(e){return e!=e}function isBuffer$1(e){return null!=e&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer(e.slice(0,0))}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mathExpressions_umd={exports:{}};(function(module,exports){!function(e,t){module.exports=t()}(0,(function(){const get_tree=function(e){if(null!=e)return void 0!==e.tree?e.tree:e};function*subsets(e,t){var n=e.length;if(void 0===t&&(t=n),0!==t){for(let t=0;t<n;t++)yield[e[t]];if(1!==t)for(let r=0;r<n;r++){let n=subsets(e.slice(r+1),t-1);for(let t of n)yield[e[r]].concat(t)}}}var is_associative$1={"+":!0,"*":!0,and:!0,or:!0,union:!0,intersect:!0};function flatten$k(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if(r=r.map((function(e,t){return flatten$k(e)})),is_associative$1[n]){for(var a=[],i=0;i<r.length;i++)Array.isArray(r[i])&&r[i][0]===n?a=a.concat(r[i].slice(1)):a.push(r[i]);r=a}return[n].concat(r)}const unflattenRight=function(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if((r=r.map((function(e,t){return unflattenRight(e)}))).length>2&&is_associative$1[n]){for(var a=[n,r[0],void 0],i=a,o=1;o<r.length-1;o++)i[2]=[n,r[o],void 0],i=i[2];return i[2]=r[r.length-1],a}return[n].concat(r)},unflattenLeft=function(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if((r=r.map((function(e,t){return unflattenLeft(e)}))).length>2&&is_associative$1[n]){for(var a=[n,void 0,r[r.length-1]],i=a,o=r.length-2;o>0;o--)i[1]=[n,void 0,r[o]],i=i[1];return i[1]=r[0],a}return[n].concat(r)},allChildren=function(e){if(!Array.isArray(e))return[];var t=e[0],n=e.slice(1);return is_associative$1[t]?n.reduce((function(e,n){return Array.isArray(n)&&n[0]===t?e.concat(allChildren(n)):e.concat([n])}),[]):n};function remove_duplicate_negatives(e){if(!Array.isArray(e))return e;var t=e[0],n=e.slice(1);return"-"===t&&"-"===n[0][0]?remove_duplicate_negatives(n[0][1]):(n=n.map(remove_duplicate_negatives),[t].concat(n))}function normalize_negatives_in_factors(e){if(!Array.isArray(e))return e;var t=e[0],n=e.slice(1);if(n=n.map(normalize_negatives_in_factors),"*"!==t&&"/"!==t)return[t].concat(n);for(var r=1,a=[],i=0;i<n.length;i++)"-"===n[i][0]?(r*=-1,a.push(n[i][1])):a.push(n[i]);var o=[t].concat(a);return-1===r&&(o=["-",o]),o}function normalize_negatives(e){var t=get_tree(e);return t=remove_duplicate_negatives(t),remove_duplicate_negatives(t=normalize_negatives_in_factors(t))}function sort_key(e,t={}){if("number"==typeof e)return t.ignore_negatives?[0,"number",Math.abs(e)]:[0,"number",e];if("string"==typeof e)return[1,"symbol",e];if("boolean"==typeof e)return[1,"boolean",e];if(!Array.isArray(e))return[-1,"unknown",e];var n=e[0],r=e.slice(1);if("apply"===n){var a=[2,"function",r[0]],i=r[1],o=1,s=[];return Array.isArray(i)?(o=(i=i.slice(1)).length,s=i.map((e=>sort_key(e,t)))):s=[sort_key(i,t)],a.push([o,s]),a}var l=r.length,u=r.map(sort_key,t);return"*"===n?[4,"product",l,u]:"/"===n?[4,"quotient",l,u]:"+"===n?[5,"sum",l,u]:"-"===n?t.ignore_negatives?u[0]:[6,"minus",l,u]:[7,n,l,u]}function arrayCompare(e,t){if(Array.isArray(e)){if(Array.isArray(t)){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=arrayCompare(e[r],t[r]);if(0!==n)return n}return e.length<t.length?-1:e.length>t.length?1:0}return 1}return Array.isArray(t)||e<t?-1:e>t?1:0}function compare_function(e,t,n={}){return arrayCompare(sort_key(e,n),sort_key(t,n))}function coeff_factors_from_term(e,t){if("string"==typeof e){let n=t.indexOf(e);-1===n&&(t.push(e),n=t.length-1);let r=[];return r[n]=1,{factor_contains:r,coeff:1}}if(Array.isArray(e)){let n=e[0],r=e.slice(1);if("*"===n){let e=[],n=[];for(let a of r)if("string"!=typeof a)if(Array.isArray(a)&&"^"===a[0]||"-"===a[0]){let r=coeff_factors_from_term(a,t);for(let e in r.factor_contains)void 0===n[e]&&(n[e]=0),n[e]+=r.factor_contains[e];1!==r.coeff&&e.push(r.coeff)}else e.push(a);else{let e=t.indexOf(a);-1===e&&(t.push(a),e=t.length-1),void 0===n[e]&&(n[e]=0),n[e]++}return e=0===e.length?1:1===e.length?e[0]:["*",...e],{factor_contains:n,coeff:e}}if("^"===n){let e=r[0],n=r[1],a=[];if("string"==typeof e&&Number.isFinite(n)){let r=t.indexOf(e);return-1===r&&(t.push(e),r=t.length-1),a[r]=n,{factor_contains:a,coeff:1}}}else{if("-"===n){let e=coeff_factors_from_term(r[0],t),n=-1;return"number"==typeof e.coeff?n*=e.coeff:n=["-",e.coeff],{factor_contains:e.factor_contains,coeff:n}}if("/"===n){let e=coeff_factors_from_term(r[0],t),n=["/",e.coeff,r[1]];return{factor_contains:e.factor_contains,coeff:n}}}}return{factor_contains:[],coeff:e}}function default_order(e,t){void 0===t&&(t={});var n=get_tree(e);return n=normalize_negatives(n=flatten$k(n)),normalize_negatives(function e(n){if(!Array.isArray(n))return n;var r=n[0],a=n.slice(1);if(a=a.map(e),"+"===r){let e=[],n=[],r=[];for(let t of a){let a=coeff_factors_from_term(t,e);n.push(a.factor_contains),r.push(a.coeff)}let i=[];for(let[t,r]of e.entries()){let e={varname:r,exponents_in_term:[]};for(let r=0;r<n.length;r++)e.exponents_in_term.push(n[r][t]||0);i.push(e)}i.sort(((e,t)=>e.varname<t.varname?-1:1));let o=[];for(let e=0;e<r.length;e++){let n=i.reduce(((t,n)=>[...t,-n.exponents_in_term[e]]),[]);n.push(sort_key(r[e],t)),o.push(n)}let s=[];for(let[e,t]of a.entries())s.push({term:t,sort_key:o[e]});s.sort(((e,t)=>arrayCompare(e.sort_key,t.sort_key))),a=s.map((e=>e.term))}else if("*"===r||"="===r||"and"===r||"or"===r||"ne"===r||"union"===r||"intersect"===r)a.sort(((e,n)=>compare_function(e,n,t)));else if(">"===r||"ge"===r)a=a.reverse(),r=">"===r?"<":"le";else if("gts"===r){var i=a[0],o=a[1];if("tuple"!==i[0]||"tuple"!==o[0])throw new Error("Badly formed ast");r="lts",a=[i=["tuple"].concat(i.slice(1).reverse()),o=["tuple"].concat(o.slice(1).reverse())]}else if("ni"===r||"notni"===r||"superset"===r||"notsuperset"===r)a=a.reverse(),r="ni"===r?"in":"notni"===r?"notin":"superset"===r?"subset":"notsubset";else if("-"===r&&"*"===a[0][0])return a[0][1]=["-",a[0][1]],a[0];return[r].concat(a)}(n))}var commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var isBigNumber=function(e){return e&&e.constructor.prototype.isBigNumber||!1},object$6=createCommonjsModule((function(e,t){t.clone=function e(n){var r=typeof n;if("number"===r||"string"===r||"boolean"===r||null==n)return n;if("function"==typeof n.clone)return n.clone();if(Array.isArray(n))return n.map((function(t){return e(t)}));if(n instanceof Number)return new Number(n.valueOf());if(n instanceof String)return new String(n.valueOf());if(n instanceof Boolean)return new Boolean(n.valueOf());if(n instanceof Date)return new Date(n.valueOf());if(isBigNumber(n))return n;if(n instanceof RegExp)throw new TypeError("Cannot clone "+n);return t.map(n,e)},t.map=function(e,n){var r={};for(var a in e)t.hasOwnProperty(e,a)&&(r[a]=n(e[a]));return r},t.extend=function(e,n){for(var r in n)t.hasOwnProperty(n,r)&&(e[r]=n[r]);return e},t.deepExtend=function e(n,r){if(Array.isArray(r))throw new TypeError("Arrays are not supported by deepExtend");for(var a in r)if(t.hasOwnProperty(r,a))if(r[a]&&r[a].constructor===Object)void 0===n[a]&&(n[a]={}),n[a].constructor===Object?e(n[a],r[a]):n[a]=r[a];else{if(Array.isArray(r[a]))throw new TypeError("Arrays are not supported by deepExtend");n[a]=r[a]}return n},t.deepEqual=function(e,n){var r,a,i;if(Array.isArray(e)){if(!Array.isArray(n))return!1;if(e.length!=n.length)return!1;for(a=0,i=e.length;a<i;a++)if(!t.deepEqual(e[a],n[a]))return!1;return!0}if(e instanceof Object){if(Array.isArray(n)||!(n instanceof Object))return!1;for(r in e)if(!t.deepEqual(e[r],n[r]))return!1;for(r in n)if(!t.deepEqual(e[r],n[r]))return!1;return!0}return typeof e==typeof n&&e==n},t.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch(e){}return!1},t.lazy=function(e,n,r){if(t.canDefineProperty()){var a,i=!0;Object.defineProperty(e,n,{get:function(){return i&&(a=r(),i=!1),a},set:function(e){a=e,i=!1},configurable:!0,enumerable:!0})}else e[n]=r()},t.traverse=function(e,t){var n=e;if(t)for(var r=t.split("."),a=0;a<r.length;a++){var i=r[a];i in n||(n[i]={}),n=n[i]}return n},t.hasOwnProperty=function(e,t){return e&&Object.hasOwnProperty.call(e,t)},t.isFactory=function(e){return e&&"function"==typeof e.factory}}));object$6.clone,object$6.map,object$6.extend,object$6.deepExtend,object$6.deepEqual,object$6.canDefineProperty,object$6.lazy,object$6.traverse,object$6.isFactory;var typedFunction=createCommonjsModule((function(e,t){e.exports=function(){function e(){return!0}function t(){return!1}function n(){}return function r(){var a=[{name:"number",test:function(e){return"number"==typeof e}},{name:"string",test:function(e){return"string"==typeof e}},{name:"boolean",test:function(e){return"boolean"==typeof e}},{name:"Function",test:function(e){return"function"==typeof e}},{name:"Array",test:Array.isArray},{name:"Date",test:function(e){return e instanceof Date}},{name:"RegExp",test:function(e){return e instanceof RegExp}},{name:"Object",test:function(e){return"object"==typeof e&&e.constructor===Object}},{name:"null",test:function(e){return null===e}},{name:"undefined",test:function(e){return void 0===e}}],i={name:"any",test:e},o=[],s=[],l={types:a,conversions:s,ignore:o};function u(e){var t=H(l.types,(function(t){return t.name===e}));if(t)return t;if("any"===e)return i;var n=H(l.types,(function(t){return t.name.toLowerCase()===e.toLowerCase()}));throw new TypeError('Unknown type "'+e+'"'+(n?'. Did you mean "'+n.name+'"?':""))}function c(e){return e===i?999:l.types.indexOf(e)}function p(e){var t=H(l.types,(function(t){return t.test(e)}));if(t)return t.name;throw new TypeError("Value has unknown type. Value: "+e)}function d(e){return e.map((function(e){var t=e.types.map(C);return(e.restParam?"...":"")+t.join("|")})).join(",")}function m(e,t){var n=0===e.indexOf("..."),r=(n?e.length>3?e.slice(3):"any":e).split("|").map(k).filter(M).filter(P),a=function(e,t){var n={};return e.forEach((function(e){-1!==t.indexOf(e.from)||-1===t.indexOf(e.to)||n[e.from]||(n[e.from]=e)})),Object.keys(n).map((function(e){return n[e]}))}(t,r),i=r.map((function(e){var t=u(e);return{name:e,typeIndex:c(t),test:t.test,conversion:null,conversionIndex:-1}})),o=a.map((function(e){var n=u(e.from);return{name:e.from,typeIndex:c(n),test:n.test,conversion:e,conversionIndex:t.indexOf(e)}}));return{types:i.concat(o),restParam:n}}function f(e,t,n){var r=[];return""!==e.trim()&&(r=e.split(",").map(k).map((function(e,t,r){var a=m(e,n);if(a.restParam&&t!==r.length-1)throw new SyntaxError('Unexpected rest parameter "'+e+'": only allowed for the last parameter');return a}))),r.some(B)?null:{params:r,fn:t}}function h(e){var t=L(e);return!!t&&t.restParam}function y(e){return e.types.some((function(e){return null!=e.conversion}))}function b(t){if(t&&0!==t.types.length){if(1===t.types.length)return u(t.types[0].name).test;if(2===t.types.length){var n=u(t.types[0].name).test,r=u(t.types[1].name).test;return function(e){return n(e)||r(e)}}var a=t.types.map((function(e){return u(e.name).test}));return function(e){for(var t=0;t<a.length;t++)if(a[t](e))return!0;return!1}}return e}function g(e){var t,n,r;if(h(e)){var a=(t=function(e){return e.slice(0,e.length-1)}(e).map(b)).length,i=b(L(e));return function(e){for(var n=0;n<t.length;n++)if(!t[n](e[n]))return!1;return function(e){for(var t=a;t<e.length;t++)if(!i(e[t]))return!1;return!0}(e)&&e.length>=a+1}}return 0===e.length?function(e){return 0===e.length}:1===e.length?(n=b(e[0]),function(e){return n(e[0])&&1===e.length}):2===e.length?(n=b(e[0]),r=b(e[1]),function(e){return n(e[0])&&r(e[1])&&2===e.length}):(t=e.map(b),function(e){for(var n=0;n<t.length;n++)if(!t[n](e[n]))return!1;return e.length===t.length})}function v(e,t){return t<e.params.length?e.params[t]:h(e.params)?L(e.params):null}function T(e,t,n){var r=v(e,t);return(r?n?r.types.filter(N):r.types:[]).map(C)}function C(e){return e.name}function N(e){return null===e.conversion||void 0===e.conversion}function A(e,t){var n=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;return Object.keys(t)}(G(e,(function(e){return T(e,t,!1)})));return-1!==n.indexOf("any")?["any"]:n}function S(e,t,n){var r,a,i,o=e||"unnamed",s=n;for(i=0;i<t.length;i++){var l=s.filter((function(e){var n=b(v(e,i));return(i<e.params.length||h(e.params))&&n(t[i])}));if(0===l.length){if((a=A(s,i)).length>0){var u=p(t[i]);return(r=new TypeError("Unexpected type of argument in function "+o+" (expected: "+a.join(" or ")+", actual: "+u+", index: "+i+")")).data={category:"wrongType",fn:o,index:i,actual:u,expected:a},r}}else s=l}var c=s.map((function(e){return h(e.params)?1/0:e.params.length}));if(t.length<Math.min.apply(null,c))return a=A(s,i),(r=new TypeError("Too few arguments in function "+o+" (expected: "+a.join(" or ")+", index: "+t.length+")")).data={category:"tooFewArgs",fn:o,index:t.length,expected:a},r;var d=Math.max.apply(null,c);return t.length>d?((r=new TypeError("Too many arguments in function "+o+" (expected: "+d+", actual: "+t.length+")")).data={category:"tooManyArgs",fn:o,index:t.length,expectedLength:d},r):((r=new TypeError('Arguments of type "'+t.join(", ")+'" do not match any of the defined signatures of function '+o+".")).data={category:"mismatch",actual:t.map(p)},r)}function w(e){for(var t=999,n=0;n<e.types.length;n++)N(e.types[n])&&(t=Math.min(t,e.types[n].typeIndex));return t}function x(e){for(var t=999,n=0;n<e.types.length;n++)N(e.types[n])||(t=Math.min(t,e.types[n].conversionIndex));return t}function V(e,t){var n;return 0!=(n=e.restParam-t.restParam)||0!=(n=y(e)-y(t))||0!=(n=w(e)-w(t))?n:x(e)-x(t)}function E(e,t){var n,r,a=Math.min(e.params.length,t.params.length);if(0!=(r=e.params.some(y)-t.params.some(y)))return r;for(n=0;n<a;n++)if(0!=(r=y(e.params[n])-y(t.params[n])))return r;for(n=0;n<a;n++)if(0!==(r=V(e.params[n],t.params[n])))return r;return e.params.length-t.params.length}function $(e,t){var n=t;if(e.some(y)){var r=h(e),a=e.map(_);n=function(){for(var e=[],n=r?arguments.length-1:arguments.length,i=0;i<n;i++)e[i]=a[i](arguments[i]);return r&&(e[n]=arguments[n].map(a[n])),t.apply(null,e)}}var i=n;if(h(e)){var o=e.length-1;i=function(){return n.apply(null,j(arguments,0,o).concat([j(arguments,o)]))}}return i}function _(e){var t,n,r,a,i=[],o=[];switch(e.types.forEach((function(e){e.conversion&&(i.push(u(e.conversion.from).test),o.push(e.conversion.convert))})),o.length){case 0:return function(e){return e};case 1:return t=i[0],r=o[0],function(e){return t(e)?r(e):e};case 2:return t=i[0],n=i[1],r=o[0],a=o[1],function(e){return t(e)?r(e):n(e)?a(e):e};default:return function(e){for(var t=0;t<o.length;t++)if(i[t](e))return o[t](e);return e}}}function O(e){var t={};return e.forEach((function(e){e.params.some(y)||I(e.params,!0).forEach((function(n){t[d(n)]=e.fn}))})),t}function I(e,t){return function e(n,r,a){if(r<n.length){var i,o=n[r],s=t?o.types.filter(N):o.types;if(o.restParam){var l=s.filter(N);i=l.length<s.length?[l,s]:[s]}else i=s.map((function(e){return[e]}));return G(i,(function(t){return e(n,r+1,a.concat([t]))}))}var u=a.map((function(e,t){return{types:e,restParam:t===n.length-1&&h(n)}}));return[u]}(e,0,[])}function D(e,t){for(var n=Math.max(e.params.length,t.params.length),r=0;r<n;r++)if(!z(T(e,r,!0),T(t,r,!0)))return!1;var a=e.params.length,i=t.params.length,o=h(e.params),s=h(t.params);return o?s?a===i:i>=a:s?a>=i:a===i}function R(e,r){if(0===Object.keys(r).length)throw new SyntaxError("No signatures provided");var a=[];Object.keys(r).map((function(e){return f(e,r[e],l.conversions)})).filter(F).forEach((function(e){var t=H(a,(function(t){return D(t,e)}));if(t)throw new TypeError('Conflicting signatures "'+d(t.params)+'" and "'+d(e.params)+'".');a.push(e)}));var i=G(a,(function(e){return(e?I(e.params,!1):[]).map((function(t){return{params:t,fn:e.fn}}))})).filter(F);i.sort(E);var o=i[0]&&i[0].params.length<=2&&!h(i[0].params),s=i[1]&&i[1].params.length<=2&&!h(i[1].params),u=i[2]&&i[2].params.length<=2&&!h(i[2].params),c=i[3]&&i[3].params.length<=2&&!h(i[3].params),p=i[4]&&i[4].params.length<=2&&!h(i[4].params),m=i[5]&&i[5].params.length<=2&&!h(i[5].params),y=o&&s&&u&&c&&p&&m,v=i.map((function(e){return g(e.params)})),T=o?b(i[0].params[0]):t,C=s?b(i[1].params[0]):t,N=u?b(i[2].params[0]):t,A=c?b(i[3].params[0]):t,w=p?b(i[4].params[0]):t,x=m?b(i[5].params[0]):t,V=o?b(i[0].params[1]):t,_=s?b(i[1].params[1]):t,R=u?b(i[2].params[1]):t,P=c?b(i[3].params[1]):t,k=p?b(i[4].params[1]):t,M=m?b(i[5].params[1]):t,B=i.map((function(e){return $(e.params,e.fn)})),L=o?B[0]:n,j=s?B[1]:n,U=u?B[2]:n,z=c?B[3]:n,W=p?B[4]:n,q=m?B[5]:n,K=o?i[0].params.length:-1,X=s?i[1].params.length:-1,Y=u?i[2].params.length:-1,Z=c?i[3].params.length:-1,J=p?i[4].params.length:-1,Q=m?i[5].params.length:-1,ee=y?6:0,te=i.length,ne=function(){for(var t=ee;t<te;t++)if(v[t](arguments))return B[t].apply(null,arguments);throw S(e,arguments,i)},re=function(e,t){return arguments.length===K&&T(e)&&V(t)?L.apply(null,arguments):arguments.length===X&&C(e)&&_(t)?j.apply(null,arguments):arguments.length===Y&&N(e)&&R(t)?U.apply(null,arguments):arguments.length===Z&&A(e)&&P(t)?z.apply(null,arguments):arguments.length===J&&w(e)&&k(t)?W.apply(null,arguments):arguments.length===Q&&x(e)&&M(t)?q.apply(null,arguments):ne.apply(null,arguments)};try{Object.defineProperty(re,"name",{value:e})}catch(e){}return re.signatures=O(i),re}function P(e){return-1===l.ignore.indexOf(e)}function k(e){return e.trim()}function M(e){return!!e}function F(e){return null!==e}function B(e){return 0===e.types.length}function L(e){return e[e.length-1]}function j(e,t,n){return Array.prototype.slice.call(e,t,n)}function U(e,t){return-1!==e.indexOf(t)}function z(e,t){for(var n=0;n<e.length;n++)if(U(t,e[n]))return!0;return!1}function H(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}function G(e,t){return Array.prototype.concat.apply([],e.map(t))}function W(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if(r.signatures&&""!==r.name)if(""===t)t=r.name;else if(t!==r.name){var a=new Error("Function names do not match (expected: "+t+", actual: "+r.name+")");throw a.data={actual:r.name,expected:t},a}}return t}return l=R("typed",{"string, Object":R,Object:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return R(W(t),e)},"...Function":function(e){for(var t,n=W(e),r={},a=0;a<e.length;a++){var i=e[a];if("object"!=typeof i.signatures)throw(t=new TypeError("Function is no typed-function (index: "+a+")")).data={index:a},t;for(var o in i.signatures)if(i.signatures.hasOwnProperty(o))if(r.hasOwnProperty(o)){if(i.signatures[o]!==r[o])throw(t=new Error('Signature "'+o+'" is defined twice')).data={signature:o},t}else r[o]=i.signatures[o]}return R(n,r)}}),l.create=r,l.types=a,l.conversions=s,l.ignore=o,l.convert=function(e,t){var n=p(e);if(t===n)return e;for(var r=0;r<l.conversions.length;r++){var a=l.conversions[r];if(a.from===n&&a.to===t)return a.convert(e)}throw new Error("Cannot convert from "+n+" to "+t)},l.find=function(e,t){if(!e.signatures)throw new TypeError("Function is no typed-function");var n;if("string"==typeof t){n=t.split(",");for(var r=0;r<n.length;r++)n[r]=n[r].trim()}else{if(!Array.isArray(t))throw new TypeError("String array or a comma separated string expected");n=t}var a=n.join(","),i=e.signatures[a];if(i)return i;throw new TypeError("Signature not found (signature: "+(e.name||"unnamed")+"("+n.join(", ")+"))")},l.addType=function(e){if(!e||"string"!=typeof e.name||"function"!=typeof e.test)throw new TypeError("Object with properties {name: string, test: function} expected");l.types.push(e)},l.addConversion=function(e){if(!e||"string"!=typeof e.from||"string"!=typeof e.to||"function"!=typeof e.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");l.conversions.push(e)},l}()}()})),number$5=createCommonjsModule((function(e,t){function n(e){for(var t=[],n=0;n<e;n++)t.push(0);return t}t.isNumber=function(e){return"number"==typeof e},t.isInteger=function(e){return!!isFinite(e)&&e==Math.round(e)},t.sign=Math.sign||function(e){return e>0?1:e<0?-1:0},t.format=function(e,n){if("function"==typeof n)return n(e);if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN";var r="auto",a=void 0;switch(n&&(n.notation&&(r=n.notation),t.isNumber(n)?a=n:n.precision&&(a=n.precision)),r){case"fixed":return t.toFixed(e,a);case"exponential":return t.toExponential(e,a);case"engineering":return t.toEngineering(e,a);case"auto":if(n&&n.exponential&&(void 0!==n.exponential.lower||void 0!==n.exponential.upper)){var i=object$6.map(n,(function(e){return e}));return i.exponential=void 0,void 0!==n.exponential.lower&&(i.lowerExp=Math.round(Math.log(n.exponential.lower)/Math.LN10)),void 0!==n.exponential.upper&&(i.upperExp=Math.round(Math.log(n.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(n)+" with "+JSON.stringify(i)),t.toPrecision(e,a,i)}return t.toPrecision(e,a,n&&n).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", or "fixed".')}},t.splitNumber=function(e){var t=String(e).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!t)throw new SyntaxError("Invalid number "+e);var n=t[1],r=t[2],a=parseFloat(t[4]||"0"),i=r.indexOf(".");a+=-1!==i?i-1:r.length-1;var o=r.replace(".","").replace(/^0*/,(function(e){return a-=e.length,""})).replace(/0*$/,"").split("").map((function(e){return parseInt(e)}));return 0===o.length&&(o.push(0),a++),{sign:n,coefficients:o,exponent:a}},t.toEngineering=function(e,r){if(isNaN(e)||!isFinite(e))return String(e);var a=t.roundDigits(t.splitNumber(e),r),i=a.exponent,o=a.coefficients,s=i%3==0?i:i<0?i-3-i%3:i-i%3,l=i>=0?i:Math.abs(s);o.length-1<l&&(o=o.concat(n(l-(o.length-1))));for(var u=Math.abs(i-s),c=1;--u>=0;)c++;var p=o.slice(c).join(""),d=p.match(/[1-9]/)?"."+p:"",m=o.slice(0,c).join("")+d+"e"+(i>=0?"+":"")+s.toString();return a.sign+m},t.toFixed=function(e,r){if(isNaN(e)||!isFinite(e))return String(e);var a=t.splitNumber(e),i="number"==typeof r?t.roundDigits(a,a.exponent+1+r):a,o=i.coefficients,s=i.exponent+1,l=s+(r||0);return o.length<l&&(o=o.concat(n(l-o.length))),s<0&&(o=n(1-s).concat(o),s=1),s<o.length&&o.splice(s,0,0===s?"0.":"."),i.sign+o.join("")},t.toExponential=function(e,r){if(isNaN(e)||!isFinite(e))return String(e);var a=t.splitNumber(e),i=r?t.roundDigits(a,r):a,o=i.coefficients,s=i.exponent;o.length<r&&(o=o.concat(n(r-o.length)));var l=o.shift();return i.sign+l+(o.length>0?"."+o.join(""):"")+"e"+(s>=0?"+":"")+s},t.toPrecision=function(e,r,a){if(isNaN(e)||!isFinite(e))return String(e);var i=a&&void 0!==a.lowerExp?a.lowerExp:-3,o=a&&void 0!==a.upperExp?a.upperExp:5,s=t.splitNumber(e);if(s.exponent<i||s.exponent>=o)return t.toExponential(e,r);var l=r?t.roundDigits(s,r):s,u=l.coefficients,c=l.exponent;u.length<r&&(u=u.concat(n(r-u.length))),u=u.concat(n(c-u.length+1+(u.length<r?r-u.length:0)));var p=c>0?c:0;return p<(u=n(-c).concat(u)).length-1&&u.splice(p+1,0,"."),l.sign+u.join("")},t.roundDigits=function(e,t){for(var n={sign:e.sign,coefficients:e.coefficients,exponent:e.exponent},r=n.coefficients;t<=0;)r.unshift(0),n.exponent++,t++;if(r.length>t&&r.splice(t,r.length-t)[0]>=5){var a=t-1;for(r[a]++;10===r[a];)r.pop(),0===a&&(r.unshift(0),n.exponent++,a++),r[--a]++}return n},t.digits=function(e){return e.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length},t.DBL_EPSILON=Number.EPSILON||2220446049250313e-31,t.nearlyEqual=function(e,n,r){if(null==r)return e==n;if(e==n)return!0;if(isNaN(e)||isNaN(n))return!1;if(isFinite(e)&&isFinite(n)){var a=Math.abs(e-n);return a<t.DBL_EPSILON||a<=Math.max(Math.abs(e),Math.abs(n))*r}return!1}}));number$5.isNumber,number$5.isInteger,number$5.sign,number$5.format,number$5.splitNumber,number$5.toEngineering;var number_7=number$5.toFixed,number_8=number$5.toExponential;number$5.toPrecision,number$5.roundDigits,number$5.digits,number$5.DBL_EPSILON,number$5.nearlyEqual;var isMatrix=function(e){return e&&e.constructor.prototype.isMatrix||!1},digits=number$5.digits,createTyped=function(){return createTyped=typedFunction.create,typedFunction},create$4=function(e){e.isNumber=function(e){return"number"==typeof e},e.isComplex=function(t){return e.Complex&&t instanceof e.Complex||!1},e.isBigNumber=isBigNumber,e.isFraction=function(t){return e.Fraction&&t instanceof e.Fraction||!1},e.isUnit=function(e){return e&&e.constructor.prototype.isUnit||!1},e.isString=function(e){return"string"==typeof e},e.isArray=Array.isArray,e.isMatrix=isMatrix,e.isDenseMatrix=function(e){return e&&e.isDenseMatrix&&e.constructor.prototype.isMatrix||!1},e.isSparseMatrix=function(e){return e&&e.isSparseMatrix&&e.constructor.prototype.isMatrix||!1},e.isRange=function(e){return e&&e.constructor.prototype.isRange||!1},e.isIndex=function(e){return e&&e.constructor.prototype.isIndex||!1},e.isBoolean=function(e){return"boolean"==typeof e},e.isResultSet=function(e){return e&&e.constructor.prototype.isResultSet||!1},e.isHelp=function(e){return e&&e.constructor.prototype.isHelp||!1},e.isFunction=function(e){return"function"==typeof e},e.isDate=function(e){return e instanceof Date},e.isRegExp=function(e){return e instanceof RegExp},e.isObject=function(t){return"object"==typeof t&&t.constructor===Object&&!e.isComplex(t)&&!e.isFraction(t)},e.isNull=function(e){return null===e},e.isUndefined=function(e){return void 0===e},e.isAccessorNode=function(e){return e&&e.isAccessorNode&&e.constructor.prototype.isNode||!1},e.isArrayNode=function(e){return e&&e.isArrayNode&&e.constructor.prototype.isNode||!1},e.isAssignmentNode=function(e){return e&&e.isAssignmentNode&&e.constructor.prototype.isNode||!1},e.isBlockNode=function(e){return e&&e.isBlockNode&&e.constructor.prototype.isNode||!1},e.isConditionalNode=function(e){return e&&e.isConditionalNode&&e.constructor.prototype.isNode||!1},e.isConstantNode=function(e){return e&&e.isConstantNode&&e.constructor.prototype.isNode||!1},e.isFunctionAssignmentNode=function(e){return e&&e.isFunctionAssignmentNode&&e.constructor.prototype.isNode||!1},e.isFunctionNode=function(e){return e&&e.isFunctionNode&&e.constructor.prototype.isNode||!1},e.isIndexNode=function(e){return e&&e.isIndexNode&&e.constructor.prototype.isNode||!1},e.isNode=function(e){return e&&e.isNode&&e.constructor.prototype.isNode||!1},e.isObjectNode=function(e){return e&&e.isObjectNode&&e.constructor.prototype.isNode||!1},e.isOperatorNode=function(e){return e&&e.isOperatorNode&&e.constructor.prototype.isNode||!1},e.isParenthesisNode=function(e){return e&&e.isParenthesisNode&&e.constructor.prototype.isNode||!1},e.isRangeNode=function(e){return e&&e.isRangeNode&&e.constructor.prototype.isNode||!1},e.isSymbolNode=function(e){return e&&e.isSymbolNode&&e.constructor.prototype.isNode||!1},e.isChain=function(e){return e&&e.constructor.prototype.isChain||!1};var t=createTyped();return t.types=[{name:"number",test:e.isNumber},{name:"Complex",test:e.isComplex},{name:"BigNumber",test:e.isBigNumber},{name:"Fraction",test:e.isFraction},{name:"Unit",test:e.isUnit},{name:"string",test:e.isString},{name:"Array",test:e.isArray},{name:"Matrix",test:e.isMatrix},{name:"DenseMatrix",test:e.isDenseMatrix},{name:"SparseMatrix",test:e.isSparseMatrix},{name:"Range",test:e.isRange},{name:"Index",test:e.isIndex},{name:"boolean",test:e.isBoolean},{name:"ResultSet",test:e.isResultSet},{name:"Help",test:e.isHelp},{name:"function",test:e.isFunction},{name:"Date",test:e.isDate},{name:"RegExp",test:e.isRegExp},{name:"null",test:e.isNull},{name:"undefined",test:e.isUndefined},{name:"OperatorNode",test:e.isOperatorNode},{name:"ConstantNode",test:e.isConstantNode},{name:"SymbolNode",test:e.isSymbolNode},{name:"ParenthesisNode",test:e.isParenthesisNode},{name:"FunctionNode",test:e.isFunctionNode},{name:"FunctionAssignmentNode",test:e.isFunctionAssignmentNode},{name:"ArrayNode",test:e.isArrayNode},{name:"AssignmentNode",test:e.isAssignmentNode},{name:"BlockNode",test:e.isBlockNode},{name:"ConditionalNode",test:e.isConditionalNode},{name:"IndexNode",test:e.isIndexNode},{name:"RangeNode",test:e.isRangeNode},{name:"Node",test:e.isNode},{name:"Object",test:e.isObject}],t.conversions=[{from:"number",to:"BigNumber",convert:function(t){if(digits(t)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+t+"). Use function bignumber(x) to convert to BigNumber.");return new e.BigNumber(t)}},{from:"number",to:"Complex",convert:function(t){return new e.Complex(t,0)}},{from:"number",to:"string",convert:function(e){return e+""}},{from:"BigNumber",to:"Complex",convert:function(t){return new e.Complex(t.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(e){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(t){return new e.Complex(t.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(t){if(new e.Fraction(t).valueOf()!==t)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+t+"). Use function fraction(x) to convert to Fraction.");return new e.Fraction(t)}},{from:"string",to:"number",convert:function(e){var t=Number(e);if(isNaN(t))throw new Error('Cannot convert "'+e+'" to a number');return t}},{from:"string",to:"BigNumber",convert:function(t){try{return new e.BigNumber(t)}catch(e){throw new Error('Cannot convert "'+t+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(t){try{return new e.Fraction(t)}catch(e){throw new Error('Cannot convert "'+t+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(t){try{return new e.Complex(t)}catch(e){throw new Error('Cannot convert "'+t+'" to Complex')}}},{from:"boolean",to:"number",convert:function(e){return+e}},{from:"boolean",to:"BigNumber",convert:function(t){return new e.BigNumber(+t)}},{from:"boolean",to:"Fraction",convert:function(t){return new e.Fraction(+t)}},{from:"boolean",to:"string",convert:function(e){return+e}},{from:"Array",to:"Matrix",convert:function(t){return new e.DenseMatrix(t)}},{from:"Matrix",to:"Array",convert:function(e){return e.valueOf()}}],t},typed$1={create:create$4};function E(){}E.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function a(){r.off(e,a),t.apply(n,arguments)}return a._=t,this.on(e,a,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,a=n.length;r<a;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],a=[];if(r&&t)for(var i=0,o=r.length;i<o;i++)r[i].fn!==t&&r[i].fn._!==t&&a.push(r[i]);return a.length?n[e]=a:delete n[e],this}};var tinyEmitter=E,mixin$1=function(e){var t=new tinyEmitter;return e.on=t.on.bind(t),e.off=t.off.bind(t),e.once=t.once.bind(t),e.emit=t.emit.bind(t),e},emitter={mixin:mixin$1};function ArgumentsError(e,t,n,r){if(!(this instanceof ArgumentsError))throw new SyntaxError("Constructor must be called with the new operator");this.fn=e,this.count=t,this.min=n,this.max=r,this.message="Wrong number of arguments in function "+e+" ("+t+" provided, "+n+(null!=r?"-"+r:"")+" expected)",this.stack=(new Error).stack}ArgumentsError.prototype=new Error,ArgumentsError.prototype.constructor=Error,ArgumentsError.prototype.name="ArgumentsError",ArgumentsError.prototype.isArgumentsError=!0;var ArgumentsError_1=ArgumentsError,lazy$6=object$6.lazy,isFactory$1=object$6.isFactory,traverse=object$6.traverse;function factory$4r(e,t,n,r,a){function i(e,t,n){if(n.wrap&&"function"==typeof t&&(t=function(e){var t=function(){for(var t=[],n=0,r=arguments.length;n<r;n++){var i=arguments[n];t[n]=i&&i.valueOf()}return e.apply(a,t)};return e.transform&&(t.transform=e.transform),t}(t)),u(a[e])&&u(t))return t=n.override?r(e,t.signatures):r(a[e],t),a[e]=t,o(e,t),void a.emit("import",e,(function(){return t}));if(void 0===a[e]||n.override)return a[e]=t,o(e,t),void a.emit("import",e,(function(){return t}));if(!n.silent)throw new Error('Cannot import "'+e+'": already exists')}function o(e,t){t&&"function"==typeof t.transform?(a.expression.transform[e]=t.transform,c(e)&&(a.expression.mathWithTransform[e]=t.transform)):(delete a.expression.transform[e],c(e)&&(a.expression.mathWithTransform[e]=t))}function s(e,t){if("string"==typeof e.name){var i=e.name,o=i in a.expression.transform,s=e.path?traverse(a,e.path):a,l=s.hasOwnProperty(i)?s[i]:void 0,c=function(){var a=n(e);if(a&&"function"==typeof a.transform)throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(u(l)&&u(a))return t.override||(a=r(l,a)),a;if(void 0===l||t.override)return a;if(!t.silent)throw new Error('Cannot import "'+i+'": already exists')};!1!==e.lazy?(lazy$6(s,i,c),o||("expression.transform"===e.path||p(e))&&lazy$6(a.expression.mathWithTransform,i,c)):(s[i]=c(),o||("expression.transform"===e.path||p(e))&&(a.expression.mathWithTransform[i]=c())),a.emit("import",i,c,e.path)}else n(e)}function l(t){return"function"==typeof t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t||null===t||t&&e.isUnit(t)||t&&e.isComplex(t)||t&&e.isBigNumber(t)||t&&e.isFraction(t)||t&&e.isMatrix(t)||t&&Array.isArray(t)}function u(e){return"function"==typeof e&&"object"==typeof e.signatures}function c(e){return!d.hasOwnProperty(e)}function p(e){return void 0===e.path&&!d.hasOwnProperty(e.name)}var d={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return function e(t,n){var r=arguments.length;if(1!==r&&2!==r)throw new ArgumentsError_1("import",r,1,2);if(n||(n={}),isFactory$1(t))s(t,n);else if(Array.isArray(t))t.forEach((function(t){e(t,n)}));else if("object"==typeof t){for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];l(o)?i(a,o,n):isFactory$1(t)?s(t,n):e(o,n)}}else if(!n.silent)throw new TypeError("Factory, Object, or Array expected")}}var math$m=!0,name$4c="import",factory_1$4q=factory$4r,lazy_1$2=!0,_import$1={math:math$m,name:name$4c,factory:factory_1$4q,lazy:lazy_1$2};function factory$4q(e,t,n,r,a){var i=["Matrix","Array"],o=["number","BigNumber","Fraction"];function s(e){if(e){var n=object$6.map(t,object$6.clone);validateOption(e,"matrix",i),validateOption(e,"number",o),object$6.deepExtend(t,e);var r=object$6.map(t,object$6.clone),s=object$6.map(e,object$6.clone);return a.emit("config",r,n,s),r}return object$6.map(t,object$6.clone)}return s.MATRIX=i,s.NUMBER=o,s}function contains$1(e,t){return-1!==e.indexOf(t)}function findIndex$1(e,t){return e.map((function(e){return e.toLowerCase()})).indexOf(t.toLowerCase())}function validateOption(e,t,n){if(void 0!==e[t]&&!contains$1(n,e[t])){var r=findIndex$1(n,e[t]);-1!==r?(console.warn('Warning: Wrong casing for configuration option "'+t+'", should be "'+n[r]+'" instead of "'+e[t]+'".'),e[t]=n[r]):console.warn('Warning: Unknown value "'+e[t]+'" for configuration option "'+t+'". Available options: '+n.map(JSON.stringify).join(", ")+".")}}var name$4b="config",math$l=!0,factory_1$4p=factory$4q,config$2={name:name$4b,math:math$l,factory:factory_1$4p},isFactory=object$6.isFactory,create$3=function(e){if("function"!=typeof Object.create)throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var t=[],n=[],r=emitter.mixin({});r.type={},r.expression={transform:{},mathWithTransform:{}},r.typed=typed$1.create(r.type);var a={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function i(e){if(!isFactory(e))throw new Error("Factory object with properties `type`, `name`, and `factory` expected");var o,s=t.indexOf(e);return-1===s?(o=!0===e.math?e.factory(r.type,a,i,r.typed,r):e.factory(r.type,a,i,r.typed),t.push(e),n.push(o)):o=n[s],o}return r.import=i(_import$1),r.config=i(config$2),r.expression.mathWithTransform.config=r.config,e&&r.config(e),r},core$1={create:create$3},core=core$1,decimal=createCommonjsModule((function(e){!function(t){var n,r,a,i,o=9e15,s=1e9,l="0123456789abcdef",u="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",c="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",p={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-o,maxE:o,crypto:!1},d=!0,m="[DecimalError] ",f=m+"Invalid argument: ",h=m+"Precision limit exceeded",y=m+"crypto unavailable",b=Math.floor,g=Math.pow,v=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,T=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,C=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,N=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,A=1e7,S=u.length-1,w=c.length-1,x={name:"[object Decimal]"};function V(e){var t,n,r,a=e.length-1,i="",o=e[0];if(a>0){for(i+=o,t=1;t<a;t++)(n=7-(r=e[t]+"").length)&&(i+=F(n)),i+=r;(n=7-(r=(o=e[t])+"").length)&&(i+=F(n))}else if(0===o)return"0";for(;o%10==0;)o/=10;return i+o}function E(e,t,n){if(e!==~~e||e<t||e>n)throw Error(f+e)}function $(e,t,n,r){var a,i,o,s;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=7,a=0):(a=Math.ceil((t+1)/7),t%=7),i=g(10,7-t),s=e[a]%i|0,null==r?t<3?(0==t?s=s/100|0:1==t&&(s=s/10|0),o=n<4&&99999==s||n>3&&49999==s||5e4==s||0==s):o=(n<4&&s+1==i||n>3&&s+1==i/2)&&(e[a+1]/i/100|0)==g(10,t-2)-1||(s==i/2||0==s)&&0==(e[a+1]/i/100|0):t<4?(0==t?s=s/1e3|0:1==t?s=s/100|0:2==t&&(s=s/10|0),o=(r||n<4)&&9999==s||!r&&n>3&&4999==s):o=((r||n<4)&&s+1==i||!r&&n>3&&s+1==i/2)&&(e[a+1]/i/1e3|0)==g(10,t-3)-1,o}function _(e,t,n){for(var r,a,i=[0],o=0,s=e.length;o<s;){for(a=i.length;a--;)i[a]*=t;for(i[0]+=l.indexOf(e.charAt(o++)),r=0;r<i.length;r++)i[r]>n-1&&(void 0===i[r+1]&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}x.absoluteValue=x.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),I(e)},x.ceil=function(){return I(new this.constructor(this),this.e+1,2)},x.comparedTo=x.cmp=function(e){var t,n,r,a,i=this,o=i.d,s=(e=new i.constructor(e)).d,l=i.s,u=e.s;if(!o||!s)return l&&u?l!==u?l:o===s?0:!o^l<0?1:-1:NaN;if(!o[0]||!s[0])return o[0]?l:s[0]?-u:0;if(l!==u)return l;if(i.e!==e.e)return i.e>e.e^l<0?1:-1;for(t=0,n=(r=o.length)<(a=s.length)?r:a;t<n;++t)if(o[t]!==s[t])return o[t]>s[t]^l<0?1:-1;return r===a?0:r>a^l<0?1:-1},x.cosine=x.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r,a=t.d.length;a<32?(n=Math.ceil(a/3),r=Math.pow(4,-n).toString()):(n=16,r="2.3283064365386962890625e-10"),e.precision+=n,t=q(e,1,t.times(r),new e(1));for(var i=n;i--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return e.precision-=n,t}(r,K(r,n)),r.precision=e,r.rounding=t,I(2==i||3==i?n.neg():n,e,t,!0)):new r(1):new r(NaN)},x.cubeRoot=x.cbrt=function(){var e,t,n,r,a,i,o,s,l,u,c=this,p=c.constructor;if(!c.isFinite()||c.isZero())return new p(c);for(d=!1,(i=c.s*Math.pow(c.s*c,1/3))&&Math.abs(i)!=1/0?r=new p(i.toString()):(n=V(c.d),(i=((e=c.e)-n.length+1)%3)&&(n+=1==i||-2==i?"0":"00"),i=Math.pow(n,1/3),e=b((e+1)/3)-(e%3==(e<0?-1:2)),(r=new p(n=i==1/0?"5e"+e:(n=i.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=c.s),o=(e=p.precision)+3;;)if(u=(l=(s=r).times(s).times(s)).plus(c),r=O(u.plus(c).times(s),u.plus(l),o+2,1),V(s.d).slice(0,o)===(n=V(r.d)).slice(0,o)){if("9999"!=(n=n.slice(o-3,o+1))&&(a||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(I(r,e+1,1),t=!r.times(r).times(r).eq(c));break}if(!a&&(I(s,e+1,0),s.times(s).times(s).eq(c))){r=s;break}o+=4,a=1}return d=!0,I(r,e,p.rounding,t)},x.decimalPlaces=x.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=7*((e=t.length-1)-b(this.e/7)),e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},x.dividedBy=x.div=function(e){return O(this,new this.constructor(e))},x.dividedToIntegerBy=x.divToInt=function(e){var t=this.constructor;return I(O(this,new t(e),0,1,1),t.precision,t.rounding)},x.equals=x.eq=function(e){return 0===this.cmp(e)},x.floor=function(){return I(new this.constructor(this),this.e+1,3)},x.greaterThan=x.gt=function(e){return this.cmp(e)>0},x.greaterThanOrEqualTo=x.gte=function(e){var t=this.cmp(e);return 1==t||0===t},x.hyperbolicCosine=x.cosh=function(){var e,t,n,r,a,i=this,o=i.constructor,s=new o(1);if(!i.isFinite())return new o(i.s?1/0:NaN);if(i.isZero())return s;n=o.precision,r=o.rounding,o.precision=n+Math.max(i.e,i.sd())+4,o.rounding=1,(a=i.d.length)<32?(e=Math.ceil(a/3),t=Math.pow(4,-e).toString()):(e=16,t="2.3283064365386962890625e-10"),i=q(o,1,i.times(t),new o(1),!0);for(var l,u=e,c=new o(8);u--;)l=i.times(i),i=s.minus(l.times(c.minus(l.times(c))));return I(i,o.precision=n,o.rounding=r,!0)},x.hyperbolicSine=x.sinh=function(){var e,t,n,r,a=this,i=a.constructor;if(!a.isFinite()||a.isZero())return new i(a);if(t=i.precision,n=i.rounding,i.precision=t+Math.max(a.e,a.sd())+4,i.rounding=1,(r=a.d.length)<3)a=q(i,2,a,a,!0);else{e=(e=1.4*Math.sqrt(r))>16?16:0|e,a=q(i,2,a=a.times(Math.pow(5,-e)),a,!0);for(var o,s=new i(5),l=new i(16),u=new i(20);e--;)o=a.times(a),a=a.times(s.plus(o.times(l.times(o).plus(u))))}return i.precision=t,i.rounding=n,I(a,t,n,!0)},x.hyperbolicTangent=x.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,O(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)},x.inverseCosine=x.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),a=n.precision,i=n.rounding;return-1!==r?0===r?t.isNeg()?k(n,a,i):new n(0):new n(NaN):t.isZero()?k(n,a+4,i).times(.5):(n.precision=a+6,n.rounding=1,t=t.asin(),e=k(n,a+4,i).times(.5),n.precision=a,n.rounding=i,e.minus(t))},x.inverseHyperbolicCosine=x.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,d=!1,n=n.times(n).minus(1).sqrt().plus(n),d=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)},x.inverseHyperbolicSine=x.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,d=!1,n=n.times(n).plus(1).sqrt().plus(n),d=!0,r.precision=e,r.rounding=t,n.ln())},x.inverseHyperbolicTangent=x.atanh=function(){var e,t,n,r,a=this,i=a.constructor;return a.isFinite()?a.e>=0?new i(a.abs().eq(1)?a.s/0:a.isZero()?a:NaN):(e=i.precision,t=i.rounding,r=a.sd(),Math.max(r,e)<2*-a.e-1?I(new i(a),e,t,!0):(i.precision=n=r-a.e,a=O(a.plus(1),new i(1).minus(a),n+e,1),i.precision=e+4,i.rounding=1,a=a.ln(),i.precision=e,i.rounding=t,a.times(.5))):new i(NaN)},x.inverseSine=x.asin=function(){var e,t,n,r,a=this,i=a.constructor;return a.isZero()?new i(a):(t=a.abs().cmp(1),n=i.precision,r=i.rounding,-1!==t?0===t?((e=k(i,n+4,r).times(.5)).s=a.s,e):new i(NaN):(i.precision=n+6,i.rounding=1,a=a.div(new i(1).minus(a.times(a)).sqrt().plus(1)).atan(),i.precision=n,i.rounding=r,a.times(2)))},x.inverseTangent=x.atan=function(){var e,t,n,r,a,i,o,s,l,u=this,c=u.constructor,p=c.precision,m=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&p+4<=w)return(o=k(c,p+4,m).times(.25)).s=u.s,o}else{if(!u.s)return new c(NaN);if(p+4<=w)return(o=k(c,p+4,m).times(.5)).s=u.s,o}for(c.precision=s=p+10,c.rounding=1,e=n=Math.min(28,s/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(d=!1,t=Math.ceil(s/7),r=1,l=u.times(u),o=new c(u),a=u;-1!==e;)if(a=a.times(l),i=o.minus(a.div(r+=2)),a=a.times(l),void 0!==(o=i.plus(a.div(r+=2))).d[t])for(e=t;o.d[e]===i.d[e]&&e--;);return n&&(o=o.times(2<<n-1)),d=!0,I(o,c.precision=p,c.rounding=m,!0)},x.isFinite=function(){return!!this.d},x.isInteger=x.isInt=function(){return!!this.d&&b(this.e/7)>this.d.length-2},x.isNaN=function(){return!this.s},x.isNegative=x.isNeg=function(){return this.s<0},x.isPositive=x.isPos=function(){return this.s>0},x.isZero=function(){return!!this.d&&0===this.d[0]},x.lessThan=x.lt=function(e){return this.cmp(e)<0},x.lessThanOrEqualTo=x.lte=function(e){return this.cmp(e)<1},x.logarithm=x.log=function(e){var t,n,r,a,i,o,s,l,u=this,c=u.constructor,p=c.precision,m=c.rounding;if(null==e)e=new c(10),t=!0;else{if(n=(e=new c(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new c(n&&!n[0]?-1/0:1!=u.s?NaN:n?0:1/0);if(t)if(n.length>1)i=!0;else{for(a=n[0];a%10==0;)a/=10;i=1!==a}if(d=!1,o=z(u,s=p+5),r=t?P(c,s+10):z(e,s),$((l=O(o,r,s,1)).d,a=p,m))do{if(o=z(u,s+=10),r=t?P(c,s+10):z(e,s),l=O(o,r,s,1),!i){+V(l.d).slice(a+1,a+15)+1==1e14&&(l=I(l,p+1,0));break}}while($(l.d,a+=10,m));return d=!0,I(l,p,m)},x.minus=x.sub=function(e){var t,n,r,a,i,o,s,l,u,c,p,m,f=this,h=f.constructor;if(e=new h(e),!f.d||!e.d)return f.s&&e.s?f.d?e.s=-e.s:e=new h(e.d||f.s!==e.s?f:NaN):e=new h(NaN),e;if(f.s!=e.s)return e.s=-e.s,f.plus(e);if(u=f.d,m=e.d,s=h.precision,l=h.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!u[0])return new h(3===l?-0:0);e=new h(f)}return d?I(e,s,l):e}if(n=b(e.e/7),c=b(f.e/7),u=u.slice(),i=c-n){for((p=i<0)?(t=u,i=-i,o=m.length):(t=m,n=c,o=u.length),i>(r=Math.max(Math.ceil(s/7),o)+2)&&(i=r,t.length=1),t.reverse(),r=i;r--;)t.push(0);t.reverse()}else{for((p=(r=u.length)<(o=m.length))&&(o=r),r=0;r<o;r++)if(u[r]!=m[r]){p=u[r]<m[r];break}i=0}for(p&&(t=u,u=m,m=t,e.s=-e.s),o=u.length,r=m.length-o;r>0;--r)u[o++]=0;for(r=m.length;r>i;){if(u[--r]<m[r]){for(a=r;a&&0===u[--a];)u[a]=A-1;--u[a],u[r]+=A}u[r]-=m[r]}for(;0===u[--o];)u.pop();for(;0===u[0];u.shift())--n;return u[0]?(e.d=u,e.e=R(u,n),d?I(e,s,l):e):new h(3===l?-0:0)},x.modulo=x.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?I(new r(n),r.precision,r.rounding):(d=!1,9==r.modulo?(t=O(n,e.abs(),0,3,1)).s*=e.s:t=O(n,e,0,r.modulo,1),t=t.times(e),d=!0,n.minus(t))},x.naturalExponential=x.exp=function(){return U(this)},x.naturalLogarithm=x.ln=function(){return z(this)},x.negated=x.neg=function(){var e=new this.constructor(this);return e.s=-e.s,I(e)},x.plus=x.add=function(e){var t,n,r,a,i,o,s,l,u,c,p=this,m=p.constructor;if(e=new m(e),!p.d||!e.d)return p.s&&e.s?p.d||(e=new m(e.d||p.s===e.s?p:NaN)):e=new m(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.minus(e);if(u=p.d,c=e.d,s=m.precision,l=m.rounding,!u[0]||!c[0])return c[0]||(e=new m(p)),d?I(e,s,l):e;if(i=b(p.e/7),r=b(e.e/7),u=u.slice(),a=i-r){for(a<0?(n=u,a=-a,o=c.length):(n=c,r=i,o=u.length),a>(o=(i=Math.ceil(s/7))>o?i+1:o+1)&&(a=o,n.length=1),n.reverse();a--;)n.push(0);n.reverse()}for((o=u.length)-(a=c.length)<0&&(a=o,n=c,c=u,u=n),t=0;a;)t=(u[--a]=u[a]+c[a]+t)/A|0,u[a]%=A;for(t&&(u.unshift(t),++r),o=u.length;0==u[--o];)u.pop();return e.d=u,e.e=R(u,r),d?I(e,s,l):e},x.precision=x.sd=function(e){var t,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(f+e);return n.d?(t=M(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},x.round=function(){var e=this,t=e.constructor;return I(new t(e),e.e+1,t.rounding)},x.sine=x.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r=t.d.length;if(r<3)return q(e,2,t,t);n=(n=1.4*Math.sqrt(r))>16?16:0|n,t=q(e,2,t=t.times(Math.pow(5,-n)),t);for(var a,i=new e(5),o=new e(16),s=new e(20);n--;)a=t.times(t),t=t.times(i.plus(a.times(o.times(a).minus(s))));return t}(r,K(r,n)),r.precision=e,r.rounding=t,I(i>2?n.neg():n,e,t,!0)):new r(NaN)},x.squareRoot=x.sqrt=function(){var e,t,n,r,a,i,o=this,s=o.d,l=o.e,u=o.s,c=o.constructor;if(1!==u||!s||!s[0])return new c(!u||u<0&&(!s||s[0])?NaN:s?o:1/0);for(d=!1,0==(u=Math.sqrt(+o))||u==1/0?(((t=V(s)).length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=b((l+1)/2)-(l<0||l%2),r=new c(t=u==1/0?"1e"+l:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new c(u.toString()),n=(l=c.precision)+3;;)if(r=(i=r).plus(O(o,i,n+2,1)).times(.5),V(i.d).slice(0,n)===(t=V(r.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(I(r,l+1,1),e=!r.times(r).eq(o));break}if(!a&&(I(i,l+1,0),i.times(i).eq(o))){r=i;break}n+=4,a=1}return d=!0,I(r,l,c.rounding,e)},x.tangent=x.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,(n=n.sin()).s=1,n=O(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,I(2==i||4==i?n.neg():n,e,t,!0)):new r(NaN)},x.times=x.mul=function(e){var t,n,r,a,i,o,s,l,u,c=this,p=c.constructor,m=c.d,f=(e=new p(e)).d;if(e.s*=c.s,!(m&&m[0]&&f&&f[0]))return new p(!e.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:m&&f?0*e.s:e.s/0);for(n=b(c.e/7)+b(e.e/7),(l=m.length)<(u=f.length)&&(i=m,m=f,f=i,o=l,l=u,u=o),i=[],r=o=l+u;r--;)i.push(0);for(r=u;--r>=0;){for(t=0,a=l+r;a>r;)s=i[a]+f[r]*m[a-r-1]+t,i[a--]=s%A|0,t=s/A|0;i[a]=(i[a]+t)%A|0}for(;!i[--o];)i.pop();return t?++n:i.shift(),e.d=i,e.e=R(i,n),d?I(e,p.precision,p.rounding):e},x.toBinary=function(e,t){return X(this,2,e,t)},x.toDecimalPlaces=x.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(E(e,0,s),void 0===t?t=r.rounding:E(t,0,8),I(n,e+n.e+1,t))},x.toExponential=function(e,t){var n,r=this,a=r.constructor;return void 0===e?n=D(r,!0):(E(e,0,s),void 0===t?t=a.rounding:E(t,0,8),n=D(r=I(new a(r),e+1,t),!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},x.toFixed=function(e,t){var n,r,a=this,i=a.constructor;return void 0===e?n=D(a):(E(e,0,s),void 0===t?t=i.rounding:E(t,0,8),n=D(r=I(new i(a),e+a.e+1,t),!1,e+r.e+1)),a.isNeg()&&!a.isZero()?"-"+n:n},x.toFraction=function(e){var t,n,r,a,i,o,s,l,u,c,p,m,h=this,y=h.d,b=h.constructor;if(!y)return new b(h);if(u=n=new b(1),r=l=new b(0),o=(i=(t=new b(r)).e=M(y)-h.e-1)%7,t.d[0]=g(10,o<0?7+o:o),null==e)e=i>0?t:u;else{if(!(s=new b(e)).isInt()||s.lt(u))throw Error(f+s);e=s.gt(t)?i>0?t:u:s}for(d=!1,s=new b(V(y)),c=b.precision,b.precision=i=7*y.length*2;p=O(s,t,0,1,1),1!=(a=n.plus(p.times(r))).cmp(e);)n=r,r=a,a=u,u=l.plus(p.times(a)),l=a,a=t,t=s.minus(p.times(a)),s=a;return a=O(e.minus(n),r,0,1,1),l=l.plus(a.times(u)),n=n.plus(a.times(r)),l.s=u.s=h.s,m=O(u,r,i,1).minus(h).abs().cmp(O(l,n,i,1).minus(h).abs())<1?[u,r]:[l,n],b.precision=c,d=!0,m},x.toHexadecimal=x.toHex=function(e,t){return X(this,16,e,t)},x.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),null==e){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),void 0!==t&&E(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(d=!1,t<4&&(t=[4,5,7,8][t]),n=O(n,e,0,t,1).times(e),d=!0,I(n)):(e.s=n.s,n=e),n},x.toNumber=function(){return+this},x.toOctal=function(e,t){return X(this,8,e,t)},x.toPower=x.pow=function(e){var t,n,r,a,i,o,s=this,l=s.constructor,u=+(e=new l(e));if(!(s.d&&e.d&&s.d[0]&&e.d[0]))return new l(g(+s,u));if((s=new l(s)).eq(1))return s;if(r=l.precision,i=l.rounding,e.eq(1))return I(s,r,i);if((t=b(e.e/7))>=e.d.length-1&&(n=u<0?-u:u)<=9007199254740991)return a=B(l,s,n,r),e.s<0?new l(1).div(a):I(a,r,i);if((o=s.s)<0){if(t<e.d.length-1)return new l(NaN);if(0==(1&e.d[t])&&(o=1),0==s.e&&1==s.d[0]&&1==s.d.length)return s.s=o,s}return(t=0!=(n=g(+s,u))&&isFinite(n)?new l(n+"").e:b(u*(Math.log("0."+V(s.d))/Math.LN10+s.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?o/0:0):(d=!1,l.rounding=s.s=1,n=Math.min(12,(t+"").length),(a=U(e.times(z(s,r+n)),r)).d&&$((a=I(a,r+5,1)).d,r,i)&&(t=r+10,+V((a=I(U(e.times(z(s,t+n)),t),t+5,1)).d).slice(r+1,r+15)+1==1e14&&(a=I(a,r+1,0))),a.s=o,d=!0,l.rounding=i,I(a,r,i))},x.toPrecision=function(e,t){var n,r=this,a=r.constructor;return void 0===e?n=D(r,r.e<=a.toExpNeg||r.e>=a.toExpPos):(E(e,1,s),void 0===t?t=a.rounding:E(t,0,8),n=D(r=I(new a(r),e,t),e<=r.e||r.e<=a.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n},x.toSignificantDigits=x.toSD=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(E(e,1,s),void 0===t?t=n.rounding:E(t,0,8)),I(new n(this),e,t)},x.toString=function(){var e=this,t=e.constructor,n=D(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},x.truncated=x.trunc=function(){return I(new this.constructor(this),this.e+1,1)},x.valueOf=x.toJSON=function(){var e=this,t=e.constructor,n=D(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var O=function(){function e(e,t,n){var r,a=0,i=e.length;for(e=e.slice();i--;)r=e[i]*t+a,e[i]=r%n|0,a=r/n|0;return a&&e.unshift(a),e}function t(e,t,n,r){var a,i;if(n!=r)i=n>r?1:-1;else for(a=i=0;a<n;a++)if(e[a]!=t[a]){i=e[a]>t[a]?1:-1;break}return i}function n(e,t,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*r+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(a,i,o,s,l,u){var c,p,d,m,f,h,y,g,v,T,C,N,S,w,x,V,E,$,_,O,D=a.constructor,R=a.s==i.s?1:-1,P=a.d,k=i.d;if(!(P&&P[0]&&k&&k[0]))return new D(a.s&&i.s&&(P?!k||P[0]!=k[0]:k)?P&&0==P[0]||!k?0*R:R/0:NaN);for(u?(f=1,p=a.e-i.e):(u=A,f=7,p=b(a.e/f)-b(i.e/f)),_=k.length,E=P.length,T=(v=new D(R)).d=[],d=0;k[d]==(P[d]||0);d++);if(k[d]>(P[d]||0)&&p--,null==o?(w=o=D.precision,s=D.rounding):w=l?o+(a.e-i.e)+1:o,w<0)T.push(1),h=!0;else{if(w=w/f+2|0,d=0,1==_){for(m=0,k=k[0],w++;(d<E||m)&&w--;d++)x=m*u+(P[d]||0),T[d]=x/k|0,m=x%k|0;h=m||d<E}else{for((m=u/(k[0]+1)|0)>1&&(k=e(k,m,u),P=e(P,m,u),_=k.length,E=P.length),V=_,N=(C=P.slice(0,_)).length;N<_;)C[N++]=0;(O=k.slice()).unshift(0),$=k[0],k[1]>=u/2&&++$;do{m=0,(c=t(k,C,_,N))<0?(S=C[0],_!=N&&(S=S*u+(C[1]||0)),(m=S/$|0)>1?(m>=u&&(m=u-1),1==(c=t(y=e(k,m,u),C,g=y.length,N=C.length))&&(m--,n(y,_<g?O:k,g,u))):(0==m&&(c=m=1),y=k.slice()),(g=y.length)<N&&y.unshift(0),n(C,y,N,u),-1==c&&(c=t(k,C,_,N=C.length))<1&&(m++,n(C,_<N?O:k,N,u)),N=C.length):0===c&&(m++,C=[0]),T[d++]=m,c&&C[0]?C[N++]=P[V]||0:(C=[P[V]],N=1)}while((V++<E||void 0!==C[0])&&w--);h=void 0!==C[0]}T[0]||T.shift()}if(1==f)v.e=p,r=h;else{for(d=1,m=T[0];m>=10;m/=10)d++;v.e=d+p*f-1,I(v,l?o+v.e+1:o,s,h)}return v}}();function I(e,t,n,r){var a,i,o,s,l,u,c,p,m,f=e.constructor;e:if(null!=t){if(!(p=e.d))return e;for(a=1,s=p[0];s>=10;s/=10)a++;if((i=t-a)<0)i+=7,o=t,l=(c=p[m=0])/g(10,a-o-1)%10|0;else if((m=Math.ceil((i+1)/7))>=(s=p.length)){if(!r)break e;for(;s++<=m;)p.push(0);c=l=0,a=1,o=(i%=7)-7+1}else{for(c=s=p[m],a=1;s>=10;s/=10)a++;l=(o=(i%=7)-7+a)<0?0:c/g(10,a-o-1)%10|0}if(r=r||t<0||void 0!==p[m+1]||(o<0?c:c%g(10,a-o-1)),u=n<4?(l||r)&&(0==n||n==(e.s<0?3:2)):l>5||5==l&&(4==n||r||6==n&&(i>0?o>0?c/g(10,a-o):0:p[m-1])%10&1||n==(e.s<0?8:7)),t<1||!p[0])return p.length=0,u?(t-=e.e+1,p[0]=g(10,(7-t%7)%7),e.e=-t||0):p[0]=e.e=0,e;if(0==i?(p.length=m,s=1,m--):(p.length=m+1,s=g(10,7-i),p[m]=o>0?(c/g(10,a-o)%g(10,o)|0)*s:0),u)for(;;){if(0==m){for(i=1,o=p[0];o>=10;o/=10)i++;for(o=p[0]+=s,s=1;o>=10;o/=10)s++;i!=s&&(e.e++,p[0]==A&&(p[0]=1));break}if(p[m]+=s,p[m]!=A)break;p[m--]=0,s=1}for(i=p.length;0===p[--i];)p.pop()}return d&&(e.e>f.maxE?(e.d=null,e.e=NaN):e.e<f.minE&&(e.e=0,e.d=[0])),e}function D(e,t,n){if(!e.isFinite())return H(e);var r,a=e.e,i=V(e.d),o=i.length;return t?(n&&(r=n-o)>0?i=i.charAt(0)+"."+i.slice(1)+F(r):o>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):a<0?(i="0."+F(-a-1)+i,n&&(r=n-o)>0&&(i+=F(r))):a>=o?(i+=F(a+1-o),n&&(r=n-a-1)>0&&(i=i+"."+F(r))):((r=a+1)<o&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-o)>0&&(a+1===o&&(i+="."),i+=F(r))),i}function R(e,t){var n=e[0];for(t*=7;n>=10;n/=10)t++;return t}function P(e,t,n){if(t>S)throw d=!0,n&&(e.precision=n),Error(h);return I(new e(u),t,1,!0)}function k(e,t,n){if(t>w)throw Error(h);return I(new e(c),t,n,!0)}function M(e){var t=e.length-1,n=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function F(e){for(var t="";e--;)t+="0";return t}function B(e,t,n,r){var a,i=new e(1),o=Math.ceil(r/7+4);for(d=!1;;){if(n%2&&Y((i=i.times(t)).d,o)&&(a=!0),0===(n=b(n/2))){n=i.d.length-1,a&&0===i.d[n]&&++i.d[n];break}Y((t=t.times(t)).d,o)}return d=!0,i}function L(e){return 1&e.d[e.d.length-1]}function j(e,t,n){for(var r,a=new e(t[0]),i=0;++i<t.length;){if(!(r=new e(t[i])).s){a=r;break}a[n](r)&&(a=r)}return a}function U(e,t){var n,r,a,i,o,s,l,u=0,c=0,p=0,m=e.constructor,f=m.rounding,h=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(d=!1,l=h):l=t,s=new m(.03125);e.e>-2;)e=e.times(s),p+=5;for(l+=r=Math.log(g(2,p))/Math.LN10*2+5|0,n=i=o=new m(1),m.precision=l;;){if(i=I(i.times(e),l,1),n=n.times(++c),V((s=o.plus(O(i,n,l,1))).d).slice(0,l)===V(o.d).slice(0,l)){for(a=p;a--;)o=I(o.times(o),l,1);if(null!=t)return m.precision=h,o;if(!(u<3&&$(o.d,l-r,f,u)))return I(o,m.precision=h,f,d=!0);m.precision=l+=10,n=i=s=new m(1),c=0,u++}o=s}}function z(e,t){var n,r,a,i,o,s,l,u,c,p,m,f=1,h=e,y=h.d,b=h.constructor,g=b.rounding,v=b.precision;if(h.s<0||!y||!y[0]||!h.e&&1==y[0]&&1==y.length)return new b(y&&!y[0]?-1/0:1!=h.s?NaN:y?0:h);if(null==t?(d=!1,c=v):c=t,b.precision=c+=10,r=(n=V(y)).charAt(0),!(Math.abs(i=h.e)<15e14))return u=P(b,c+2,v).times(i+""),h=z(new b(r+"."+n.slice(1)),c-10).plus(u),b.precision=v,null==t?I(h,v,g,d=!0):h;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=V((h=h.times(e)).d)).charAt(0),f++;for(i=h.e,r>1?(h=new b("0."+n),i++):h=new b(r+"."+n.slice(1)),p=h,l=o=h=O(h.minus(1),h.plus(1),c,1),m=I(h.times(h),c,1),a=3;;){if(o=I(o.times(m),c,1),V((u=l.plus(O(o,new b(a),c,1))).d).slice(0,c)===V(l.d).slice(0,c)){if(l=l.times(2),0!==i&&(l=l.plus(P(b,c+2,v).times(i+""))),l=O(l,new b(f),c,1),null!=t)return b.precision=v,l;if(!$(l.d,c-10,g,s))return I(l,b.precision=v,g,d=!0);b.precision=c+=10,u=o=h=O(p.minus(1),p.plus(1),c,1),m=I(h.times(h),c,1),a=s=1}l=u,a+=2}}function H(e){return String(e.s*e.s/0)}function G(e,t){var n,r,a;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);r++);for(a=t.length;48===t.charCodeAt(a-1);--a);if(t=t.slice(r,a)){if(a-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%7,n<0&&(r+=7),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=7;r<a;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=a;for(;r--;)t+="0";e.d.push(+t),d&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function W(e,t){var r,a,i,o,s,l,u,c,p;if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(T.test(t))r=16,t=t.toLowerCase();else if(v.test(t))r=2;else{if(!C.test(t))throw Error(f+t);r=8}for((o=t.search(/p/i))>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),s=(o=t.indexOf("."))>=0,a=e.constructor,s&&(o=(l=(t=t.replace(".","")).length)-o,i=B(a,new a(r),o,2*o)),o=p=(c=_(t,r,A)).length-1;0===c[o];--o)c.pop();return o<0?new a(0*e.s):(e.e=R(c,p),e.d=c,d=!1,s&&(e=O(e,i,4*l)),u&&(e=e.times(Math.abs(u)<54?Math.pow(2,u):n.pow(2,u))),d=!0,e)}function q(e,t,n,r,a){var i,o,s,l,u=e.precision,c=Math.ceil(u/7);for(d=!1,l=n.times(n),s=new e(r);;){if(o=O(s.times(l),new e(t++*t++),u,1),s=a?r.plus(o):r.minus(o),r=O(o.times(l),new e(t++*t++),u,1),void 0!==(o=s.plus(r)).d[c]){for(i=c;o.d[i]===s.d[i]&&i--;);if(-1==i)break}i=s,s=r,r=o,o=i}return d=!0,o.d.length=c+1,o}function K(e,t){var n,r=t.s<0,a=k(e,e.precision,1),o=a.times(.5);if((t=t.abs()).lte(o))return i=r?4:1,t;if((n=t.divToInt(a)).isZero())i=r?3:2;else{if((t=t.minus(n.times(a))).lte(o))return i=L(n)?r?2:3:r?4:1,t;i=L(n)?r?1:4:r?3:2}return t.minus(a).abs()}function X(e,t,n,a){var i,o,u,c,p,d,m,f,h,y=e.constructor,b=void 0!==n;if(b?(E(n,1,s),void 0===a?a=y.rounding:E(a,0,8)):(n=y.precision,a=y.rounding),e.isFinite()){for(b?(i=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):i=t,(u=(m=D(e)).indexOf("."))>=0&&(m=m.replace(".",""),(h=new y(1)).e=m.length-u,h.d=_(D(h),10,i),h.e=h.d.length),o=p=(f=_(m,10,i)).length;0==f[--p];)f.pop();if(f[0]){if(u<0?o--:((e=new y(e)).d=f,e.e=o,f=(e=O(e,h,n,a,0,i)).d,o=e.e,d=r),u=f[n],c=i/2,d=d||void 0!==f[n+1],d=a<4?(void 0!==u||d)&&(0===a||a===(e.s<0?3:2)):u>c||u===c&&(4===a||d||6===a&&1&f[n-1]||a===(e.s<0?8:7)),f.length=n,d)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(p=f.length;!f[p-1];--p);for(u=0,m="";u<p;u++)m+=l.charAt(f[u]);if(b){if(p>1)if(16==t||8==t){for(u=16==t?4:3,--p;p%u;p++)m+="0";for(p=(f=_(m,i,t)).length;!f[p-1];--p);for(u=1,m="1.";u<p;u++)m+=l.charAt(f[u])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>p)for(o-=p;o--;)m+="0";else o<p&&(m=m.slice(0,o)+"."+m.slice(o))}else m=b?"0p+0":"0";m=(16==t?"0x":2==t?"0b":8==t?"0o":"")+m}else m=H(e);return e.s<0?"-"+m:m}function Y(e,t){if(e.length>t)return e.length=t,!0}function Z(e){return new this(e).abs()}function J(e){return new this(e).acos()}function Q(e){return new this(e).acosh()}function ee(e,t){return new this(e).plus(t)}function te(e){return new this(e).asin()}function ne(e){return new this(e).asinh()}function re(e){return new this(e).atan()}function ae(e){return new this(e).atanh()}function ie(e,t){e=new this(e),t=new this(t);var n,r=this.precision,a=this.rounding,i=r+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?k(this,r,a):new this(0)).s=e.s:!e.d||t.isZero()?(n=k(this,i,1).times(.5)).s=e.s:t.s<0?(this.precision=i,this.rounding=1,n=this.atan(O(e,t,i,1)),t=k(this,i,1),this.precision=r,this.rounding=a,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(O(e,t,i,1)):(n=k(this,i,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function oe(e){return new this(e).cbrt()}function se(e){return I(e=new this(e),e.e+1,2)}function le(e){if(!e||"object"!=typeof e)throw Error(m+"Object expected");var t,n,r,a=!0===e.defaults,i=["precision",1,s,"rounding",0,8,"toExpNeg",-o,0,"toExpPos",0,o,"maxE",0,o,"minE",-o,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(n=i[t],a&&(this[n]=p[n]),void 0!==(r=e[n])){if(!(b(r)===r&&r>=i[t+1]&&r<=i[t+2]))throw Error(f+n+": "+r);this[n]=r}if(n="crypto",a&&(this[n]=p[n]),void 0!==(r=e[n])){if(!0!==r&&!1!==r&&0!==r&&1!==r)throw Error(f+n+": "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(y);this[n]=!0}else this[n]=!1}return this}function ue(e){return new this(e).cos()}function ce(e){return new this(e).cosh()}function pe(e,t){return new this(e).div(t)}function de(e){return new this(e).exp()}function me(e){return I(e=new this(e),e.e+1,3)}function fe(){var e,t,n=new this(0);for(d=!1,e=0;e<arguments.length;)if((t=new this(arguments[e++])).d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return d=!0,new this(1/0);n=t}return d=!0,n.sqrt()}function he(e){return e instanceof n||e&&"[object Decimal]"===e.name||!1}function ye(e){return new this(e).ln()}function be(e,t){return new this(e).log(t)}function ge(e){return new this(e).log(2)}function ve(e){return new this(e).log(10)}function Te(){return j(this,arguments,"lt")}function Ce(){return j(this,arguments,"gt")}function Ne(e,t){return new this(e).mod(t)}function Ae(e,t){return new this(e).mul(t)}function Se(e,t){return new this(e).pow(t)}function we(e){var t,n,r,a,i=0,o=new this(1),l=[];if(void 0===e?e=this.precision:E(e,1,s),r=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));i<r;)(a=t[i])>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:l[i++]=a%1e7;else{if(!crypto.randomBytes)throw Error(y);for(t=crypto.randomBytes(r*=4);i<r;)(a=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((127&t[i+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,i):(l.push(a%1e7),i+=4);i=r/4}else for(;i<r;)l[i++]=1e7*Math.random()|0;for(e%=7,(r=l[--i])&&e&&(a=g(10,7-e),l[i]=(r/a|0)*a);0===l[i];i--)l.pop();if(i<0)n=0,l=[0];else{for(n=-1;0===l[0];n-=7)l.shift();for(r=1,a=l[0];a>=10;a/=10)r++;r<7&&(n-=7-r)}return o.e=n,o.d=l,o}function xe(e){return I(e=new this(e),e.e+1,this.rounding)}function Ve(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function Ee(e){return new this(e).sin()}function $e(e){return new this(e).sinh()}function _e(e){return new this(e).sqrt()}function Oe(e,t){return new this(e).sub(t)}function Ie(e){return new this(e).tan()}function De(e){return new this(e).tanh()}function Re(e){return I(e=new this(e),e.e+1,1)}n=function e(t){var n,r,a;function i(e){var t,n,r,a=this;if(!(a instanceof i))return new i(e);if(a.constructor=i,e instanceof i)return a.s=e.s,a.e=e.e,void(a.d=(e=e.d)?e.slice():e);if("number"==(r=typeof e)){if(0===e)return a.s=1/e<0?-1:1,a.e=0,void(a.d=[0]);if(e<0?(e=-e,a.s=-1):a.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;return a.e=t,void(a.d=[e])}return 0*e!=0?(e||(a.s=NaN),a.e=NaN,void(a.d=null)):G(a,e.toString())}if("string"!==r)throw Error(f+e);return 45===e.charCodeAt(0)?(e=e.slice(1),a.s=-1):a.s=1,N.test(e)?G(a,e):W(a,e)}if(i.prototype=x,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=le,i.clone=e,i.isDecimal=he,i.abs=Z,i.acos=J,i.acosh=Q,i.add=ee,i.asin=te,i.asinh=ne,i.atan=re,i.atanh=ae,i.atan2=ie,i.cbrt=oe,i.ceil=se,i.cos=ue,i.cosh=ce,i.div=pe,i.exp=de,i.floor=me,i.hypot=fe,i.ln=ye,i.log=be,i.log10=ve,i.log2=ge,i.max=Te,i.min=Ce,i.mod=Ne,i.mul=Ae,i.pow=Se,i.random=we,i.round=xe,i.sign=Ve,i.sin=Ee,i.sinh=$e,i.sqrt=_e,i.sub=Oe,i.tan=Ie,i.tanh=De,i.trunc=Re,void 0===t&&(t={}),t&&!0!==t.defaults)for(a=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<a.length;)t.hasOwnProperty(r=a[n++])||(t[r]=this[r]);return i.config(t),i}(p),n.default=n.Decimal=n,u=new n(u),c=new n(c),e.exports?e.exports=n:(t||(t="undefined"!=typeof self&&self&&self.self==self?self:Function("return this")()),a=t.Decimal,n.noConflict=function(){return t.Decimal=a,n},t.Decimal=n)}(commonjsGlobal$1)}));function factory$4p(e,t,n,r,a){var i=decimal.clone({precision:t.precision});return i.prototype.type="BigNumber",i.prototype.isBigNumber=!0,i.prototype.toJSON=function(){return{mathjs:"BigNumber",value:this.toString()}},i.fromJSON=function(e){return new i(e.value)},a.on("config",(function(e,t){e.precision!==t.precision&&i.config({precision:e.precision})})),i}var name$4a="BigNumber",path$11="type",factory_1$4o=factory$4p,math$k=!0,BigNumber={name:name$4a,path:path$11,factory:factory_1$4o,math:math$k},deepMap=function e(t,n,r){return t&&"function"==typeof t.map?t.map((function(t){return e(t,n)})):n(t)};function factory$4o(e,t,n,r){var a=r("bignumber",{"":function(){return new e.BigNumber(0)},number:function(t){return new e.BigNumber(t+"")},string:function(t){return new e.BigNumber(t)},BigNumber:function(e){return e},Fraction:function(t){return new e.BigNumber(t.n).div(t.d)},null:function(t){return new e.BigNumber(0)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)"},a}var name$49="bignumber",factory_1$4n=factory$4o,bignumber$2={name:name$49,factory:factory_1$4n},bignumber$1=[BigNumber,bignumber$2];function factory$4n(e,t,n,r){var a=r("bool",{"":function(){return!1},boolean:function(e){return e},number:function(e){return!!e},null:function(e){return!1},BigNumber:function(e){return!e.isZero()},string:function(e){var t=e.toLowerCase();if("true"===t)return!0;if("false"===t)return!1;var n=Number(e);if(""!=e&&!isNaN(n))return!!n;throw new Error('Cannot convert "'+e+'" to a boolean')},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$48="boolean",factory_1$4m=factory$4n,boolean_1$2={name:name$48,factory:factory_1$4m},formatter=createCommonjsModule((function(e,t){t.format=function(e,n){if("function"==typeof n)return n(e);if(!e.isFinite())return e.isNaN()?"NaN":e.gt(0)?"Infinity":"-Infinity";var r="auto",a=void 0;switch(void 0!==n&&(n.notation&&(r=n.notation),"number"==typeof n?a=n:n.precision&&(a=n.precision)),r){case"fixed":return t.toFixed(e,a);case"exponential":return t.toExponential(e,a);case"auto":if(n&&n.exponential&&(void 0!==n.exponential.lower||void 0!==n.exponential.upper)){var i=object$6.map(n,(function(e){return e}));return i.exponential=void 0,void 0!==n.exponential.lower&&(i.lowerExp=Math.round(Math.log(n.exponential.lower)/Math.LN10)),void 0!==n.exponential.upper&&(i.upperExp=Math.round(Math.log(n.exponential.upper)/Math.LN10)),console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper (minimum and maximum value) are replaced with exponential.lowerExp and exponential.upperExp (minimum and maximum exponent) since version 4.0.0. Replace "+JSON.stringify(n)+" with "+JSON.stringify(i)),t.format(e,i)}var o=n&&void 0!==n.lowerExp?n.lowerExp:-3,s=n&&void 0!==n.upperExp?n.upperExp:5;if(e.isZero())return"0";var l=e.logarithm();return(l.gte(o)&&l.lt(s)?e.toSignificantDigits(a).toFixed():t.toExponential(e,a)).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+r+'". Choose "auto", "exponential", or "fixed".')}},t.toExponential=function(e,t){return void 0!==t?e.toExponential(t-1):e.toExponential()},t.toFixed=function(e,t){return e.toFixed(t)}}));formatter.format,formatter.toExponential,formatter.toFixed;var string$a=createCommonjsModule((function(e,t){var n=number$5.format,r=formatter.format;function a(e,n){if(Array.isArray(e)){for(var r="[",i=e.length,o=0;o<i;o++)0!=o&&(r+=", "),r+=a(e[o],n);return r+"]"}return t.format(e,n)}t.isString=function(e){return"string"==typeof e},t.endsWith=function(e,t){var n=e.length-t.length,r=e.length;return e.substring(n,r)===t},t.format=function(e,i){if("number"==typeof e)return n(e,i);if(isBigNumber(e))return r(e,i);if(function(e){return e&&"object"==typeof e&&"number"==typeof e.s&&"number"==typeof e.n&&"number"==typeof e.d||!1}(e))return i&&"decimal"===i.fraction?e.toString():e.s*e.n+"/"+e.d;if(Array.isArray(e))return a(e,i);if(t.isString(e))return'"'+e+'"';if("function"==typeof e)return e.syntax?String(e.syntax):"function";if(e&&"object"==typeof e){if("function"==typeof e.format)return e.format(i);if(e&&e.toString()!=={}.toString())return e.toString();var o=[];for(var s in e)e.hasOwnProperty(s)&&o.push('"'+s+'": '+t.format(e[s],i));return"{"+o.join(", ")+"}"}return String(e)},t.stringify=function(e){for(var t=String(e),n="",r=0;r<t.length;){var a=t.charAt(r);"\\"===a?(n+=a,r++,""!==(a=t.charAt(r))&&-1!=='"\\/bfnrtu'.indexOf(a)||(n+="\\"),n+=a):n+='"'===a?'\\"':a,r++}return'"'+n+'"'},t.escape=function(e){var t=String(e);return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}));string$a.isString,string$a.endsWith,string$a.format,string$a.stringify,string$a.escape;var format$a=string$a.format,lazy$5=object$6.lazy;function factory$4m(e,t,n,r,a){function i(t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");e.isChain(t)?this.value=t.value:this.value=t}function o(e,t){"function"==typeof t&&(i.prototype[e]=s(t))}function s(e){return function(){for(var t=[this.value],n=0;n<arguments.length;n++)t[n+1]=arguments[n];return new i(e.apply(e,t))}}return i.prototype.type="Chain",i.prototype.isChain=!0,i.prototype.done=function(){return this.value},i.prototype.valueOf=function(){return this.value},i.prototype.toString=function(){return format$a(this.value)},i.prototype.toJSON=function(){return{mathjs:"Chain",value:this.value}},i.fromJSON=function(e){return new i(e.value)},i.createProxy=function(e,t){if("string"==typeof e)o(e,t);else for(var n in e)e.hasOwnProperty(n)&&o(n,e[n])},i.createProxy(a),a.on("import",(function(e,t,n){void 0===n&&function(e,t){lazy$5(i.prototype,e,(function(){var e=t();if("function"==typeof e)return s(e)}))}(e,t)})),i}var name$47="Chain",path$10="type",factory_1$4l=factory$4m,math$j=!0,lazy_1$1=!1,Chain={name:name$47,path:path$10,factory:factory_1$4l,math:math$j,lazy:lazy_1$1};function factory$4l(e,t,n,r){return r("chain",{"":function(){return new e.Chain},any:function(t){return new e.Chain(t)}})}var name$46="chain",factory_1$4k=factory$4l,chain$2={name:name$46,factory:factory_1$4k},chain$1=[Chain,chain$2],complex$4=createCommonjsModule((function(e,t){
/**
  	   * @license Complex.js v2.0.10 11/02/2016
  	   *
  	   * Copyright (c) 2016, Robert Eisele (robert@xarg.org)
  	   * Dual licensed under the MIT or GPL Version 2 licenses.
  	   **/
!function(n){var r=function(e){return.5*(Math.exp(e)+Math.exp(-e))},a=function(e){return.5*(Math.exp(e)-Math.exp(-e))},i=function(){throw SyntaxError("Invalid Param")};function o(e,t){var n=Math.abs(e),r=Math.abs(t);return 0===e?Math.log(r):0===t?Math.log(n):n<3e3&&r<3e3?.5*Math.log(e*e+t*t):Math.log(e/Math.cos(Math.atan2(t,e)))}function s(e,t){if(!(this instanceof s))return new s(e,t);var n=function(e,t){var n={re:0,im:0};if(null==e)n.re=n.im=0;else if(void 0!==t)n.re=e,n.im=t;else switch(typeof e){case"object":if("im"in e&&"re"in e)n.re=e.re,n.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return s.INFINITY;n.re=e.abs*Math.cos(e.arg),n.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return s.INFINITY;n.re=e.r*Math.cos(e.phi),n.im=e.r*Math.sin(e.phi)}else 2===e.length?(n.re=e[0],n.im=e[1]):i();break;case"string":n.im=n.re=0;var r=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),a=1,o=0;null===r&&i();for(var l=0;l<r.length;l++){var u=r[l];" "===u||"\t"===u||"\n"===u||("+"===u?a++:"-"===u?o++:"i"===u||"I"===u?(a+o===0&&i()," "===r[l+1]||isNaN(r[l+1])?n.im+=parseFloat((o%2?"-":"")+"1"):(n.im+=parseFloat((o%2?"-":"")+r[l+1]),l++),a=o=0):((a+o===0||isNaN(u))&&i(),"i"===r[l+1]||"I"===r[l+1]?(n.im+=parseFloat((o%2?"-":"")+u),l++):n.re+=parseFloat((o%2?"-":"")+u),a=o=0))}a+o>0&&i();break;case"number":n.im=0,n.re=e;break;default:i()}return isNaN(n.re)||isNaN(n.im),n}(e,t);this.re=n.re,this.im=n.im}s.prototype={re:0,im:0,sign:function(){var e=this.abs();return new s(this.re/e,this.im/e)},add:function(e,t){var n=new s(e,t);return this.isInfinite()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:new s(this.re+n.re,this.im+n.im)},sub:function(e,t){var n=new s(e,t);return this.isInfinite()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:new s(this.re-n.re,this.im-n.im)},mul:function(e,t){var n=new s(e,t);return this.isInfinite()&&n.isZero()||this.isZero()&&n.isInfinite()?s.NAN:this.isInfinite()||n.isInfinite()?s.INFINITY:0===n.im&&0===this.im?new s(this.re*n.re,0):new s(this.re*n.re-this.im*n.im,this.re*n.im+this.im*n.re)},div:function(e,t){var n=new s(e,t);if(this.isZero()&&n.isZero()||this.isInfinite()&&n.isInfinite())return s.NAN;if(this.isInfinite()||n.isZero())return s.INFINITY;if(this.isZero()||n.isInfinite())return s.ZERO;e=this.re,t=this.im;var r,a,i=n.re,o=n.im;return 0===o?new s(e/i,t/i):Math.abs(i)<Math.abs(o)?new s((e*(a=i/o)+t)/(r=i*a+o),(t*a-e)/r):new s((e+t*(a=o/i))/(r=o*a+i),(t-e*a)/r)},pow:function(e,t){var n=new s(e,t);if(e=this.re,t=this.im,n.isZero())return s.ONE;if(0===n.im){if(0===t&&e>=0)return new s(Math.pow(e,n.re),0);if(0===e)switch((n.re%4+4)%4){case 0:return new s(Math.pow(t,n.re),0);case 1:return new s(0,Math.pow(t,n.re));case 2:return new s(-Math.pow(t,n.re),0);case 3:return new s(0,-Math.pow(t,n.re))}}if(0===e&&0===t&&n.re>0&&n.im>=0)return s.ZERO;var r=Math.atan2(t,e),a=o(e,t);return e=Math.exp(n.re*a-n.im*r),t=n.im*a+n.re*r,new s(e*Math.cos(t),e*Math.sin(t))},sqrt:function(){var e,t,n=this.re,r=this.im,a=this.abs();if(n>=0){if(0===r)return new s(Math.sqrt(n),0);e=.5*Math.sqrt(2*(a+n))}else e=Math.abs(r)/Math.sqrt(2*(a-n));return t=n<=0?.5*Math.sqrt(2*(a-n)):Math.abs(r)/Math.sqrt(2*(a+n)),new s(e,r<0?-t:t)},exp:function(){var e=Math.exp(this.re);return this.im,new s(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,t=this.im;return new s(Math.expm1(e)*Math.cos(t)+function(e){var t=Math.PI/4;if(e<-t||e>t)return Math.cos(e)-1;var n=e*e;return n*(n*(1/24+n*(-1/720+n*(1/40320+n*(-1/3628800+n*(1/4790014600+n*(-1/87178291200+n*(1/20922789888e3)))))))-.5)}(t),Math.exp(e)*Math.sin(t))},log:function(){var e=this.re,t=this.im;return new s(o(e,t),Math.atan2(t,e))},abs:function(){return function(e,t){var n=Math.abs(e),r=Math.abs(t);return n<3e3&&r<3e3?Math.sqrt(n*n+r*r):(n<r?(n=r,r=e/t):r=t/e,n*Math.sqrt(1+r*r))}(this.re,this.im)},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,t=this.im;return new s(Math.sin(e)*r(t),Math.cos(e)*a(t))},cos:function(){var e=this.re,t=this.im;return new s(Math.cos(e)*r(t),-Math.sin(e)*a(t))},tan:function(){var e=2*this.re,t=2*this.im,n=Math.cos(e)+r(t);return new s(Math.sin(e)/n,a(t)/n)},cot:function(){var e=2*this.re,t=2*this.im,n=Math.cos(e)-r(t);return new s(-Math.sin(e)/n,a(t)/n)},sec:function(){var e=this.re,t=this.im,n=.5*r(2*t)+.5*Math.cos(2*e);return new s(Math.cos(e)*r(t)/n,Math.sin(e)*a(t)/n)},csc:function(){var e=this.re,t=this.im,n=.5*r(2*t)-.5*Math.cos(2*e);return new s(Math.sin(e)*r(t)/n,-Math.cos(e)*a(t)/n)},asin:function(){var e=this.re,t=this.im,n=new s(t*t-e*e+1,-2*e*t).sqrt(),r=new s(n.re-t,n.im+e).log();return new s(r.im,-r.re)},acos:function(){var e=this.re,t=this.im,n=new s(t*t-e*e+1,-2*e*t).sqrt(),r=new s(n.re-t,n.im+e).log();return new s(Math.PI/2-r.im,r.re)},atan:function(){var e=this.re,t=this.im;if(0===e){if(1===t)return new s(0,1/0);if(-1===t)return new s(0,-1/0)}var n=e*e+(1-t)*(1-t),r=new s((1-t*t-e*e)/n,-2*e/n).log();return new s(-.5*r.im,.5*r.re)},acot:function(){var e=this.re,t=this.im;if(0===t)return new s(Math.atan2(1,e),0);var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).atan():new s(0!==e?e/0:0,0!==t?-t/0:0).atan()},asec:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new s(0,1/0);var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).acos():new s(0!==e?e/0:0,0!==t?-t/0:0).acos()},acsc:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new s(Math.PI/2,1/0);var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).asin():new s(0!==e?e/0:0,0!==t?-t/0:0).asin()},sinh:function(){var e=this.re,t=this.im;return new s(a(e)*Math.cos(t),r(e)*Math.sin(t))},cosh:function(){var e=this.re,t=this.im;return new s(r(e)*Math.cos(t),a(e)*Math.sin(t))},tanh:function(){var e=2*this.re,t=2*this.im,n=r(e)+Math.cos(t);return new s(a(e)/n,Math.sin(t)/n)},coth:function(){var e=2*this.re,t=2*this.im,n=r(e)-Math.cos(t);return new s(a(e)/n,-Math.sin(t)/n)},csch:function(){var e=this.re,t=this.im,n=Math.cos(2*t)-r(2*e);return new s(-2*a(e)*Math.cos(t)/n,2*r(e)*Math.sin(t)/n)},sech:function(){var e=this.re,t=this.im,n=Math.cos(2*t)+r(2*e);return new s(2*r(e)*Math.cos(t)/n,-2*a(e)*Math.sin(t)/n)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var t=this.asin();return this.re=-this.im,this.im=e,e=t.re,t.re=-t.im,t.im=e,t},acosh:function(){var e=this.acos();if(e.im<=0){var t=e.re;e.re=-e.im,e.im=t}else t=e.im,e.im=-e.re,e.re=t;return e},atanh:function(){var e=this.re,t=this.im,n=e>1&&0===t,r=1-e,a=1+e,i=r*r+t*t,l=0!==i?new s((a*r-t*t)/i,(t*r+a*t)/i):new s(-1!==e?e/0:0,0!==t?t/0:0),u=l.re;return l.re=o(l.re,l.im)/2,l.im=Math.atan2(l.im,u)/2,n&&(l.im=-l.im),l},acoth:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new s(0,Math.PI/2);var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).atanh():new s(0!==e?e/0:0,0!==t?-t/0:0).atanh()},acsch:function(){var e=this.re,t=this.im;if(0===t)return new s(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).asinh():new s(0!==e?e/0:0,0!==t?-t/0:0).asinh()},asech:function(){var e=this.re,t=this.im;if(this.isZero())return s.INFINITY;var n=e*e+t*t;return 0!==n?new s(e/n,-t/n).acosh():new s(0!==e?e/0:0,0!==t?-t/0:0).acosh()},inverse:function(){if(this.isZero())return s.INFINITY;if(this.isInfinite())return s.ZERO;var e=this.re,t=this.im,n=e*e+t*t;return new s(e/n,-t/n)},conjugate:function(){return new s(this.re,-this.im)},neg:function(){return new s(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new s(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new s(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new s(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,t){var n=new s(e,t);return Math.abs(n.re-this.re)<=s.EPSILON&&Math.abs(n.im-this.im)<=s.EPSILON},clone:function(){return new s(this.re,this.im)},toString:function(){var e=this.re,t=this.im,n="";return this.isNaN()?"NaN":this.isZero()?"0":this.isInfinite()?"Infinity":(0!==e&&(n+=e),0!==t&&(0!==e?n+=t<0?" - ":" + ":t<0&&(n+="-"),1!==(t=Math.abs(t))&&(n+=t),n+="i"),n||"0")},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return!(0!==this.re&&-0!==this.re||0!==this.im&&-0!==this.im)},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},s.ZERO=new s(0,0),s.ONE=new s(1,0),s.I=new s(0,1),s.PI=new s(Math.PI,0),s.E=new s(Math.E,0),s.INFINITY=new s(1/0,1/0),s.NAN=new s(NaN,NaN),s.EPSILON=1e-16,Object.defineProperty(t,"__esModule",{value:!0}),s.default=s,s.Complex=s,e.exports=s}()}));unwrapExports(complex$4);var format$9=number$5.format,isNumber$6=number$5.isNumber;function factory$4k(e,t,n,r,a){return complex$4.prototype.type="Complex",complex$4.prototype.isComplex=!0,complex$4.prototype.toJSON=function(){return{mathjs:"Complex",re:this.re,im:this.im}},complex$4.prototype.toPolar=function(){return{r:this.abs(),phi:this.arg()}},complex$4.prototype.format=function(e){var t=this.im,n=this.re,r=format$9(this.re,e),a=format$9(this.im,e),i=isNumber$6(e)?e:e?e.precision:null;if(null!==i){var o=Math.pow(10,-i);Math.abs(n/t)<o&&(n=0),Math.abs(t/n)<o&&(t=0)}return 0==t?r:0==n?1==t?"i":-1==t?"-i":a+"i":t<0?-1==t?r+" - i":r+" - "+a.substring(1)+"i":1==t?r+" + i":r+" + "+a+"i"},complex$4.fromPolar=function(t){switch(arguments.length){case 1:var n=arguments[0];if("object"==typeof n)return complex$4(n);throw new TypeError("Input has to be an object with r and phi keys.");case 2:var r=arguments[0],a=arguments[1];if(isNumber$6(r)){if(e.isUnit(a)&&a.hasBase("ANGLE")&&(a=a.toNumber("rad")),isNumber$6(a))return new complex$4({r:r,phi:a});throw new TypeError("Phi is not a number nor an angle unit.")}throw new TypeError("Radius r is not a number.");default:throw new SyntaxError("Wrong number of arguments in function fromPolar")}},complex$4.prototype.valueOf=complex$4.prototype.toString,complex$4.fromJSON=function(e){return new complex$4(e)},complex$4.EPSILON=t.epsilon,a.on("config",(function(e,t){e.epsilon!==t.epsilon&&(complex$4.EPSILON=e.epsilon)})),complex$4.compare=function(e,t){return e.re>t.re?1:e.re<t.re?-1:e.im>t.im?1:e.im<t.im?-1:0},complex$4}var name$45="Complex",path$$="type",factory_1$4j=factory$4k,math$i=!0,Complex_1={name:name$45,path:path$$,factory:factory_1$4j,math:math$i},defaultEscapes={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},formatEscapes={"":"\\--","":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\\\newline{}","\n":"\\\\newline{}"},defaultEscapeMapFn=function(e,t){return Object.assign({},e,t)},dist=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.preserveFormatting,r=void 0!==n&&n,a=t.escapeMapFn,i=void 0===a?defaultEscapeMapFn:a,o=String(e),s="",l=i(Object.assign({},defaultEscapes),r?Object.assign({},formatEscapes):{}),u=Object.keys(l),c=function(){var e=!1;u.forEach((function(t,n){e||o.startsWith(t)&&(s+=l[u[n]],o=o.slice(t.length,o.length),e=!0)})),e||(s+=o.slice(0,1),o=o.slice(1,o.length))};o;)c();return s},latex$1=createCommonjsModule((function(e,t){t.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},t.operators={transpose:"^\\top",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},t.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var n={deg:"^\\circ"};t.escape=function(e){return dist(e,{preserveFormatting:!0})},t.toSymbol=function(e,r){return(r=void 0!==r&&r)?n.hasOwnProperty(e)?n[e]:"\\mathrm{"+t.escape(e)+"}":t.symbols.hasOwnProperty(e)?t.symbols[e]:t.escape(e)}}));function factory$4j(e,t,n,r){var a=latex$1,i=r("complex",{"":function(){return e.Complex.ZERO},number:function(t){return new e.Complex(t,0)},"number, number":function(t,n){return new e.Complex(t,n)},"BigNumber, BigNumber":function(t,n){return new e.Complex(t.toNumber(),n.toNumber())},Complex:function(e){return e.clone()},string:function(t){return e.Complex(t)},null:function(t){return e.Complex(0)},Object:function(t){if("re"in t&&"im"in t)return new e.Complex(t.re,t.im);if("r"in t&&"phi"in t)return new e.Complex(t);throw new Error("Expected object with either properties re and im, or properties r and phi.")},"Array | Matrix":function(e){return deepMap(e,i)}});return i.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)+"+a.symbols.i+"\\cdot\\left(${args[1]}\\right)\\right)"},i}latex$1.symbols,latex$1.operators,latex$1.defaultTemplate,latex$1.escape,latex$1.toSymbol;var name$44="complex",factory_1$4i=factory$4j,complex$3={name:name$44,factory:factory_1$4i},complex$2=[Complex_1,complex$3],fraction$3=createCommonjsModule((function(e,t){
/**
  	   * @license Fraction.js v4.0.8 09/09/2015
  	   * http://www.xarg.org/2014/03/rational-numbers-in-javascript/
  	   *
  	   * Copyright (c) 2015, Robert Eisele (robert@xarg.org)
  	   * Dual licensed under the MIT or GPL Version 2 licenses.
  	   **/
!function(n){var r={s:1,n:0,d:1};function a(e){function t(){var t=Error.apply(this,arguments);t.name=this.name=e,this.stack=t.stack,this.message=t.message}function n(){}return n.prototype=Error.prototype,t.prototype=new n,t}var i=p.DivisionByZero=a("DivisionByZero"),o=p.InvalidParameter=a("InvalidParameter");function s(e,t){return isNaN(e=parseInt(e,10))&&l(),e*t}function l(){throw new o}var u=function(e,t){var n,a=0,o=1,u=1,c=0,p=0,d=0,m=1,f=1,h=0,y=1,b=1,g=1,v=1e7;if(null==e);else if(void 0!==t)u=(a=e)*(o=t);else switch(typeof e){case"object":"d"in e&&"n"in e?(a=e.n,o=e.d,"s"in e&&(a*=e.s)):0 in e?(a=e[0],1 in e&&(o=e[1])):l(),u=a*o;break;case"number":if(e<0&&(u=e,e=-e),e%1==0)a=e;else if(e>0){for(e>=1&&(e/=f=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)));y<=v&&g<=v;){if(e===(n=(h+b)/(y+g))){y+g<=v?(a=h+b,o=y+g):g>y?(a=b,o=g):(a=h,o=y);break}e>n?(h+=b,y+=g):(b+=h,g+=y),y>v?(a=b,o=g):(a=h,o=y)}a*=f}else(isNaN(e)||isNaN(t))&&(o=a=NaN);break;case"string":if(null===(y=e.match(/\d+|./g))&&l(),"-"===y[h]?(u=-1,h++):"+"===y[h]&&h++,y.length===h+1?p=s(y[h++],u):"."===y[h+1]||"."===y[h]?("."!==y[h]&&(c=s(y[h++],u)),(1+ ++h===y.length||"("===y[h+1]&&")"===y[h+3]||"'"===y[h+1]&&"'"===y[h+3])&&(p=s(y[h],u),m=Math.pow(10,y[h].length),h++),("("===y[h]&&")"===y[h+2]||"'"===y[h]&&"'"===y[h+2])&&(d=s(y[h+1],u),f=Math.pow(10,y[h+1].length)-1,h+=3)):"/"===y[h+1]||":"===y[h+1]?(p=s(y[h],u),m=s(y[h+2],1),h+=3):"/"===y[h+3]&&" "===y[h+1]&&(c=s(y[h],u),p=s(y[h+2],u),m=s(y[h+4],1),h+=5),y.length<=h){u=a=d+(o=m*f)*c+f*p;break}default:l()}if(0===o)throw new i;r.s=u<0?-1:1,r.n=Math.abs(a),r.d=Math.abs(o)};function c(e,t){if(!e)return t;if(!t)return e;for(;;){if(!(e%=t))return t;if(!(t%=e))return e}}function p(e,t){if(!(this instanceof p))return new p(e,t);u(e,t),e=p.REDUCE?c(r.d,r.n):1,this.s=r.s,this.n=r.n/e,this.d=r.d/e}p.REDUCE=1,p.prototype={s:1,n:0,d:1,abs:function(){return new p(this.n,this.d)},neg:function(){return new p(-this.s*this.n,this.d)},add:function(e,t){return u(e,t),new p(this.s*this.n*r.d+r.s*this.d*r.n,this.d*r.d)},sub:function(e,t){return u(e,t),new p(this.s*this.n*r.d-r.s*this.d*r.n,this.d*r.d)},mul:function(e,t){return u(e,t),new p(this.s*r.s*this.n*r.n,this.d*r.d)},div:function(e,t){return u(e,t),new p(this.s*r.s*this.n*r.d,this.d*r.n)},clone:function(){return new p(this)},mod:function(e,t){return isNaN(this.n)||isNaN(this.d)?new p(NaN):void 0===e?new p(this.s*this.n%this.d,1):(u(e,t),0===r.n&&0===this.d&&p(0,0),new p(this.s*(r.d*this.n)%(r.n*this.d),r.d*this.d))},gcd:function(e,t){return u(e,t),new p(c(r.n,this.n)*c(r.d,this.d),r.d*this.d)},lcm:function(e,t){return u(e,t),0===r.n&&0===this.n?new p:new p(r.n*this.n,c(r.n,this.n)*c(r.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new p(NaN):new p(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new p(NaN):new p(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new p(NaN):new p(Math.round(e*this.s*this.n/this.d),e)},inverse:function(){return new p(this.s*this.d,this.n)},pow:function(e){return e<0?new p(Math.pow(this.s*this.d,-e),Math.pow(this.n,-e)):new p(Math.pow(this.s*this.n,e),Math.pow(this.d,e))},equals:function(e,t){return u(e,t),this.s*this.n*r.d==r.s*r.n*this.d},compare:function(e,t){u(e,t);var n=this.s*this.n*r.d-r.s*r.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;var t=this.abs().toContinued();function n(e){return 1===e.length?new p(e[0]):n(e.slice(1)).inverse().add(e[0])}e=e||.001;for(var r=0;r<t.length;r++){var a=n(t.slice(0,r+1));if(a.sub(this.abs()).abs().valueOf()<e)return a.mul(this.s)}return this},divisible:function(e,t){return u(e,t),!(!(r.n*this.d)||this.n*r.d%(r.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",r=this.n,a=this.d;return this.s<0&&(n+="-"),1===a?n+=r:(e&&(t=Math.floor(r/a))>0&&(n+=t,n+=" ",r%=a),n+=r,n+="/",n+=a),n},toLatex:function(e){var t,n="",r=this.n,a=this.d;return this.s<0&&(n+="-"),1===a?n+=r:(e&&(t=Math.floor(r/a))>0&&(n+=t,r%=a),n+="\\frac{",n+=r,n+="}{",n+=a,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,r=[];if(isNaN(this.n)||isNaN(this.d))return r;do{r.push(Math.floor(t/n)),e=t%n,t=n,n=e}while(1!==t);return r},toString:function(){var e,t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";p.REDUCE||(t/=e=c(t,n),n/=e);var r=function(e,t){for(;t%2==0;t/=2);for(;t%5==0;t/=5);if(1===t)return 0;for(var n=10%t,r=1;1!==n;r++)if(n=10*n%t,r>2e3)return 0;return r}(0,n),a=function(e,t,n){for(var r=1,a=function(e,t,n){for(var r=1;t>0;e=e*e%n,t>>=1)1&t&&(r=r*e%n);return r}(10,n,t),i=0;i<300;i++){if(r===a)return i;r=10*r%t,a=10*a%t}return 0}(0,n,r),i=-1===this.s?"-":"";if(i+=t/n|0,t%=n,(t*=10)&&(i+="."),r){for(var o=a;o--;)i+=t/n|0,t%=n,t*=10;for(i+="(",o=r;o--;)i+=t/n|0,t%=n,t*=10;i+=")"}else for(o=15;t&&o--;)i+=t/n|0,t%=n,t*=10;return i}},Object.defineProperty(t,"__esModule",{value:!0}),p.default=p,p.Fraction=p,e.exports=p}()}));function factory$4i(e,t,n,r){return fraction$3}unwrapExports(fraction$3),fraction$3.prototype.type="Fraction",fraction$3.prototype.isFraction=!0,fraction$3.prototype.toJSON=function(){return{mathjs:"Fraction",n:this.s*this.n,d:this.d}},fraction$3.fromJSON=function(e){return new fraction$3(e)};var name$43="Fraction",path$_="type",factory_1$4h=factory$4i,Fraction_1={name:name$43,path:path$_,factory:factory_1$4h};function factory$4h(e,t,n,r){var a=r("fraction",{number:function(t){if(!isFinite(t)||isNaN(t))throw new Error(t+" cannot be represented as a fraction");return new e.Fraction(t)},string:function(t){return new e.Fraction(t)},"number, number":function(t,n){return new e.Fraction(t,n)},null:function(t){return new e.Fraction(0)},BigNumber:function(t){return new e.Fraction(t.toString())},Fraction:function(e){return e},Object:function(t){return new e.Fraction(t)},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$42="fraction",factory_1$4g=factory$4h,fraction$2={name:name$42,factory:factory_1$4g},fraction$1=[Fraction_1,fraction$2];function DimensionError(e,t,n){if(!(this instanceof DimensionError))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=t,this.relation=n,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(t)?"["+t.join(", ")+"]":t)+")",this.stack=(new Error).stack}DimensionError.prototype=new RangeError,DimensionError.prototype.constructor=RangeError,DimensionError.prototype.name="DimensionError",DimensionError.prototype.isDimensionError=!0;var DimensionError_1=DimensionError;function IndexError(e,t,n){if(!(this instanceof IndexError))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=t):(this.min=t,this.max=n),void 0!==this.min&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=(new Error).stack}IndexError.prototype=new RangeError,IndexError.prototype.constructor=RangeError,IndexError.prototype.name="IndexError",IndexError.prototype.isIndexError=!0;var IndexError_1=IndexError,array$3=createCommonjsModule((function(e,t){function n(e,t,r){var a,i=e.length;if(i!=t[r])throw new DimensionError_1(i,t[r]);if(r<t.length-1){var o=r+1;for(a=0;a<i;a++){var s=e[a];if(!Array.isArray(s))throw new DimensionError_1(t.length-1,t.length,"<");n(e[a],t,o)}}else for(a=0;a<i;a++)if(Array.isArray(e[a]))throw new DimensionError_1(t.length+1,t.length,">")}function r(e,t,n,a){var i,o,s=e.length,l=t[n],u=Math.min(s,l);if(e.length=l,n<t.length-1){var c=n+1;for(i=0;i<u;i++)o=e[i],Array.isArray(o)||(o=[o],e[i]=o),r(o,t,c,a);for(i=u;i<l;i++)o=[],e[i]=o,r(o,t,c,a)}else{for(i=0;i<u;i++)for(;Array.isArray(e[i]);)e[i]=e[i][0];for(i=u;i<l;i++)e[i]=a}}function a(e,t){var n,r=[];if(0===t.length){if(0===e.length)throw new DimensionError_1(null,null,"!=");return e.shift()}for(n=0;n<t[0];n+=1)r.push(a(e,t.slice(1)));return r}function i(e,t,n){var r,a;if(n<t){var o=n+1;for(r=0,a=e.length;r<a;r++)e[r]=i(e[r],t,o)}else for(;Array.isArray(e);)e=e[0];return e}function o(e,t,n){var r,a;if(Array.isArray(e)){var i=n+1;for(r=0,a=e.length;r<a;r++)e[r]=o(e[r],t,i)}else for(var s=n;s<t;s++)e=[e];return e}t.size=function(e){for(var t=[];Array.isArray(e);)t.push(e.length),e=e[0];return t},t.validate=function(e,t){if(0==t.length){if(Array.isArray(e))throw new DimensionError_1(e.length,0)}else n(e,t,0)},t.validateIndex=function(e,t){if(!number$5.isNumber(e)||!number$5.isInteger(e))throw new TypeError("Index must be an integer (value: "+e+")");if(e<0||"number"==typeof t&&e>=t)throw new IndexError_1(e,t)},t.resize=function(e,t,n){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Array expected");if(0===t.length)throw new Error("Resizing to scalar is not supported");return t.forEach((function(e){if(!number$5.isNumber(e)||!number$5.isInteger(e)||e<0)throw new TypeError("Invalid size, must contain positive integers (size: "+string$a.format(t)+")")})),r(e,t,0,void 0!==n?n:0),e},t.reshape=function(e,n){var r,i=t.flatten(e),o=function(e){return e.reduce((function(e,t){return e*t}))};if(!Array.isArray(e)||!Array.isArray(n))throw new TypeError("Array expected");if(0===n.length)throw new DimensionError_1(0,o(t.size(e)),"!=");try{r=a(i,n)}catch(r){if(r instanceof DimensionError_1)throw new DimensionError_1(o(n),o(t.size(e)),"!=");throw r}if(i.length>0)throw new DimensionError_1(o(n),o(t.size(e)),"!=");return r},t.squeeze=function(e,n){for(var r=n||t.size(e);Array.isArray(e)&&1===e.length;)e=e[0],r.shift();for(var a=r.length;1===r[a-1];)a--;return a<r.length&&(e=i(e,a,0),r.length=a),e},t.unsqueeze=function(e,n,r,a){var i=a||t.size(e);if(r)for(var s=0;s<r;s++)e=[e],i.unshift(1);for(e=o(e,n,0);i.length<n;)i.push(1);return e},t.flatten=function(e){if(!Array.isArray(e))return e;var t=[];return e.forEach((function e(n){Array.isArray(n)?n.forEach(e):t.push(n)})),t},t.map=function(e,t){return Array.prototype.map.call(e,t)},t.forEach=function(e,t){Array.prototype.forEach.call(e,t)},t.filter=function(e,n){if(1!==t.size(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,n)},t.filterRegExp=function(e,n){if(1!==t.size(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,(function(e){return n.test(e)}))},t.join=function(e,t){return Array.prototype.join.call(e,t)},t.identify=function(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;var t=[],n=0;t[0]={value:e[0],identifier:0};for(var r=1;r<e.length;r++)e[r]===e[r-1]?n++:n=0,t.push({value:e[r],identifier:n});return t},t.generalize=function(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);return t},t.isArray=Array.isArray}));array$3.size,array$3.validate,array$3.validateIndex,array$3.resize,array$3.reshape,array$3.squeeze,array$3.unsqueeze,array$3.flatten,array$3.map,array$3.forEach,array$3.filter,array$3.filterRegExp,array$3.join,array$3.identify,array$3.generalize,array$3.isArray;var isBoolean$2=function(e){return"boolean"==typeof e},boolean_1$1={isBoolean:isBoolean$2},memoize$1=function(e,t){return function n(){"object"!=typeof n.cache&&(n.cache={});for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var i=t?t(r):JSON.stringify(r);return i in n.cache?n.cache[i]:n.cache[i]=e.apply(e,r)}},maxArgumentCount$6=function(e){return Object.keys(e.signatures||{}).reduce((function(e,t){var n=(t.match(/,/g)||[]).length+1;return Math.max(e,n)}),-1)},callWithRightArgumentCount=function(e,t,n){return Object.keys(e.signatures||{}).reduce((function(e,t){var n=(t.match(/,/g)||[]).length+1;return Math.max(e,n)}),-1)},_function$3={memoize:memoize$1,maxArgumentCount:maxArgumentCount$6,callWithRightArgumentCount:callWithRightArgumentCount},utils$2=createCommonjsModule((function(e,t){t.array=array$3,t.boolean=boolean_1$1,t.function=_function$3,t.number=number$5,t.object=object$6,t.string=string$a,t.emitter=emitter}));utils$2.array,utils$2.number,utils$2.object,utils$2.string,utils$2.emitter;var string$9=utils$2.string,isString$6=string$9.isString;function factory$4g(e,t,n,r){function a(){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator")}return a.prototype.type="Matrix",a.prototype.isMatrix=!0,a.storage=function(e){if(!isString$6(e))throw new TypeError("format must be a string value");var t=a._storage[e];if(!t)throw new SyntaxError("Unsupported matrix storage format: "+e);return t},a._storage={},a.prototype.storage=function(){throw new Error("Cannot invoke storage on a Matrix interface")},a.prototype.datatype=function(){throw new Error("Cannot invoke datatype on a Matrix interface")},a.prototype.create=function(e,t){throw new Error("Cannot invoke create on a Matrix interface")},a.prototype.subset=function(e,t,n){throw new Error("Cannot invoke subset on a Matrix interface")},a.prototype.get=function(e){throw new Error("Cannot invoke get on a Matrix interface")},a.prototype.set=function(e,t,n){throw new Error("Cannot invoke set on a Matrix interface")},a.prototype.resize=function(e,t){throw new Error("Cannot invoke resize on a Matrix interface")},a.prototype.reshape=function(e,t){throw new Error("Cannot invoke reshape on a Matrix interface")},a.prototype.clone=function(){throw new Error("Cannot invoke clone on a Matrix interface")},a.prototype.size=function(){throw new Error("Cannot invoke size on a Matrix interface")},a.prototype.map=function(e,t){throw new Error("Cannot invoke map on a Matrix interface")},a.prototype.forEach=function(e){throw new Error("Cannot invoke forEach on a Matrix interface")},a.prototype.toArray=function(){throw new Error("Cannot invoke toArray on a Matrix interface")},a.prototype.valueOf=function(){throw new Error("Cannot invoke valueOf on a Matrix interface")},a.prototype.format=function(e){throw new Error("Cannot invoke format on a Matrix interface")},a.prototype.toString=function(){throw new Error("Cannot invoke toString on a Matrix interface")},a}var name$41="Matrix",path$Z="type",factory_1$4f=factory$4g,Matrix={name:name$41,path:path$Z,factory:factory_1$4f},string$8=utils$2.string,array$2=utils$2.array,object$5=utils$2.object,number$4=utils$2.number,isArray$6=Array.isArray,isNumber$5=number$4.isNumber,isInteger$t=number$4.isInteger,isString$5=string$8.isString,validateIndex$2=array$2.validateIndex;function factory$4f(e,t,n,r){var a=n(Matrix);function i(t,n){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(n&&!isString$5(n))throw new Error("Invalid datatype: "+n);if(e.isMatrix(t))"DenseMatrix"===t.type?(this._data=object$5.clone(t._data),this._size=object$5.clone(t._size),this._datatype=n||t._datatype):(this._data=t.toArray(),this._size=t.size(),this._datatype=n||t._datatype);else if(t&&isArray$6(t.data)&&isArray$6(t.size))this._data=t.data,this._size=t.size,this._datatype=n||t.datatype;else if(isArray$6(t))this._data=d(t),this._size=array$2.size(this._data),array$2.validate(this._data,this._size),this._datatype=n;else{if(t)throw new TypeError("Unsupported type of data ("+utils$2.types.type(t)+")");this._data=[],this._size=[0],this._datatype=n}}function o(t,n){if(!e.isIndex(n))throw new TypeError("Invalid index");if(n.isScalar())return t.get(n.min());var r=n.size();if(r.length!=t._size.length)throw new DimensionError_1(r.length,t._size.length);for(var a=n.min(),o=n.max(),l=0,u=t._size.length;l<u;l++)validateIndex$2(a[l],t._size[l]),validateIndex$2(o[l],t._size[l]);return new i(s(t._data,n,r.length,0),t._datatype)}function s(e,t,n,r){var a=r===n-1,i=t.dimension(r);return a?i.map((function(t){return validateIndex$2(t,e.length),e[t]})).valueOf():i.map((function(a){return validateIndex$2(a,e.length),s(e[a],t,n,r+1)})).valueOf()}function l(t,n,r,a){if(!n||!0!==n.isIndex)throw new TypeError("Invalid index");var i,o=n.size(),s=n.isScalar();if(e.isMatrix(r)?(i=r.size(),r=r.valueOf()):i=array$2.size(r),s){if(0!==i.length)throw new TypeError("Scalar expected");t.set(n.min(),r,a)}else{if(o.length<t._size.length)throw new DimensionError_1(o.length,t._size.length,"<");if(i.length<o.length){for(var l=0,c=0;1===o[l]&&1===i[l];)l++;for(;1===o[l];)c++,l++;r=array$2.unsqueeze(r,o.length,c,i)}if(!object$5.deepEqual(o,i))throw new DimensionError_1(o,i,">");var d=n.max().map((function(e){return e+1}));p(t,d,a);var m=o.length;u(t._data,n,r,m,0)}return t}function u(e,t,n,r,a){var i=a===r-1,o=t.dimension(a);i?o.forEach((function(t,r){validateIndex$2(t),e[t]=n[r[0]]})):o.forEach((function(i,o){validateIndex$2(i),u(e[i],t,n[o[0]],r,a+1)}))}i.prototype=new a,i.prototype.type="DenseMatrix",i.prototype.isDenseMatrix=!0,i.prototype.storage=function(){return"dense"},i.prototype.datatype=function(){return this._datatype},i.prototype.create=function(e,t){return new i(e,t)},i.prototype.subset=function(e,t,n){switch(arguments.length){case 1:return o(this,e);case 2:case 3:return l(this,e,t,n);default:throw new SyntaxError("Wrong number of arguments")}},i.prototype.get=function(e){if(!isArray$6(e))throw new TypeError("Array expected");if(e.length!=this._size.length)throw new DimensionError_1(e.length,this._size.length);for(var t=0;t<e.length;t++)validateIndex$2(e[t],this._size[t]);for(var n=this._data,r=0,a=e.length;r<a;r++){var i=e[r];validateIndex$2(i,n.length),n=n[i]}return n},i.prototype.set=function(e,t,n){if(!isArray$6(e))throw new TypeError("Array expected");if(e.length<this._size.length)throw new DimensionError_1(e.length,this._size.length,"<");var r,a,i;p(this,e.map((function(e){return e+1})),n);var o=this._data;for(r=0,a=e.length-1;r<a;r++)i=e[r],validateIndex$2(i,o.length),o=o[i];return i=e[e.length-1],validateIndex$2(i,o.length),o[i]=t,this},i.prototype.resize=function(e,t,n){if(!isArray$6(e))throw new TypeError("Array expected");var r=n?this.clone():this;return c(r,e,t)};var c=function(e,t,n){if(0===t.length){for(var r=e._data;isArray$6(r);)r=r[0];return r}return e._size=t.slice(0),e._data=array$2.resize(e._data,e._size,n),e};function p(e,t,n){for(var r=e._size.slice(0),a=!1;r.length<t.length;)r.push(0),a=!0;for(var i=0,o=t.length;i<o;i++)t[i]>r[i]&&(r[i]=t[i],a=!0);a&&c(e,r,n)}function d(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];isArray$6(r)?e[t]=d(r):r&&!0===r.isMatrix&&(e[t]=d(r.valueOf()))}return e}return i.prototype.reshape=function(e,t){var n=t?this.clone():this;return n._data=array$2.reshape(n._data,e),n._size=e.slice(0),n},i.prototype.clone=function(){return new i({data:object$5.clone(this._data),size:object$5.clone(this._size),datatype:this._datatype})},i.prototype.size=function(){return this._size.slice(0)},i.prototype.map=function(e){var t=this,n=function(r,a){return isArray$6(r)?r.map((function(e,t){return n(e,a.concat(t))})):e(r,a,t)};return new i({data:n(this._data,[]),size:object$5.clone(this._size),datatype:this._datatype})},i.prototype.forEach=function(e){var t=this,n=function(r,a){isArray$6(r)?r.forEach((function(e,t){n(e,a.concat(t))})):e(r,a,t)};n(this._data,[])},i.prototype.toArray=function(){return object$5.clone(this._data)},i.prototype.valueOf=function(){return this._data},i.prototype.format=function(e){return string$8.format(this._data,e)},i.prototype.toString=function(){return string$8.format(this._data)},i.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},i.prototype.diagonal=function(t){if(t){if(e.isBigNumber(t)&&(t=t.toNumber()),!isNumber$5(t)||!isInteger$t(t))throw new TypeError("The parameter k must be an integer number")}else t=0;for(var n=t>0?t:0,r=t<0?-t:0,a=this._size[0],o=this._size[1],s=Math.min(a-r,o-n),l=[],u=0;u<s;u++)l[u]=this._data[u+r][u+n];return new i({data:l,size:[s],datatype:this._datatype})},i.diagonal=function(t,n,a,o,s){if(!isArray$6(t))throw new TypeError("Array expected, size parameter");if(2!==t.length)throw new Error("Only two dimensions matrix are supported");if(t=t.map((function(t){if(e.isBigNumber(t)&&(t=t.toNumber()),!isNumber$5(t)||!isInteger$t(t)||t<1)throw new Error("Size values must be positive integers");return t})),a){if(e.isBigNumber(a)&&(a=a.toNumber()),!isNumber$5(a)||!isInteger$t(a))throw new TypeError("The parameter k must be an integer number")}else a=0;o&&isString$5(s)&&(o=r.convert(o,s));var l,u=a>0?a:0,c=a<0?-a:0,p=t[0],d=t[1],m=Math.min(p-c,d-u);if(isArray$6(n)){if(n.length!==m)throw new Error("Invalid value array length");l=function(e){return n[e]}}else if(e.isMatrix(n)){var f=n.size();if(1!==f.length||f[0]!==m)throw new Error("Invalid matrix length");l=function(e){return n.get([e])}}else l=function(){return n};o||(o=e.isBigNumber(l(0))?new e.BigNumber(0):0);var h=[];if(t.length>0){h=array$2.resize(h,t,o);for(var y=0;y<m;y++)h[y+c][y+u]=l(y)}return new i({data:h,size:[p,d]})},i.fromJSON=function(e){return new i(e)},i.prototype.swapRows=function(e,t){if(!(isNumber$5(e)&&isInteger$t(e)&&isNumber$5(t)&&isInteger$t(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return validateIndex$2(e,this._size[0]),validateIndex$2(t,this._size[0]),i._swapRows(e,t,this._data),this},i._swapRows=function(e,t,n){var r=n[e];n[e]=n[t],n[t]=r},e.Matrix._storage.dense=i,e.Matrix._storage.default=i,i}var name$40="DenseMatrix",path$Y="type",factory_1$4e=factory$4f,lazy$4=!1,DenseMatrix={name:name$40,path:path$Y,factory:factory_1$4e,lazy:lazy$4},nearlyEqual$7=function(e,t,n){if(null==n)return e.eq(t);if(e.eq(t))return!0;if(e.isNaN()||t.isNaN())return!1;if(e.isFinite()&&t.isFinite()){var r=e.minus(t).abs();if(r.isZero())return!0;var a=e.constructor.max(e.abs(),t.abs());return r.lte(a.times(n))}return!1},nearlyEqual$6=number$5.nearlyEqual;function factory$4e(e,t,n,r){var a=r("equalScalar",{"boolean, boolean":function(e,t){return e===t},"number, number":function(e,n){return e===n||nearlyEqual$6(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return e.eq(n)||nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return e.equals(t)},"Complex, Complex":function(e,t){return e.equals(t)},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return a(e.value,t.value)}});return a}var factory_1$4d=factory$4e,equalScalar={factory:factory_1$4d},array$1=utils$2.array,object$4=utils$2.object,string$7=utils$2.string,number$3=utils$2.number,isArray$5=Array.isArray,isNumber$4=number$3.isNumber,isInteger$s=number$3.isInteger,isString$4=string$7.isString,validateIndex$1=array$1.validateIndex;function factory$4d(e,t,n,r){var a=n(Matrix),i=n(equalScalar);function o(t,n){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(n&&!isString$4(n))throw new Error("Invalid datatype: "+n);if(e.isMatrix(t))s(this,t,n);else if(t&&isArray$5(t.index)&&isArray$5(t.ptr)&&isArray$5(t.size))this._values=t.values,this._index=t.index,this._ptr=t.ptr,this._size=t.size,this._datatype=n||t.datatype;else if(isArray$5(t))l(this,t,n);else{if(t)throw new TypeError("Unsupported type of data ("+utils$2.types.type(t)+")");this._values=[],this._index=[],this._ptr=[0],this._size=[0,0],this._datatype=n}}var s=function(e,t,n){"SparseMatrix"===t.type?(e._values=t._values?object$4.clone(t._values):void 0,e._index=object$4.clone(t._index),e._ptr=object$4.clone(t._ptr),e._size=object$4.clone(t._size),e._datatype=n||t._datatype):l(e,t.valueOf(),n||t._datatype)},l=function(e,t,n){e._values=[],e._index=[],e._ptr=[],e._datatype=n;var a=t.length,o=0,s=i,l=0;if(isString$4(n)&&(s=r.find(i,[n,n])||i,l=r.convert(0,n)),a>0){var u=0;do{e._ptr.push(e._index.length);for(var c=0;c<a;c++){var p=t[c];if(isArray$5(p)){if(0===u&&o<p.length&&(o=p.length),u<p.length){var d=p[u];s(d,l)||(e._values.push(d),e._index.push(c))}}else 0===u&&o<1&&(o=1),s(p,l)||(e._values.push(p),e._index.push(c))}u++}while(u<o)}e._ptr.push(e._index.length),e._size=[a,o]};o.prototype=new a,o.prototype.type="SparseMatrix",o.prototype.isSparseMatrix=!0,o.prototype.storage=function(){return"sparse"},o.prototype.datatype=function(){return this._datatype},o.prototype.create=function(e,t){return new o(e,t)},o.prototype.density=function(){var e=this._size[0],t=this._size[1];return 0!==e&&0!==t?this._index.length/(e*t):0},o.prototype.subset=function(e,t,n){if(!this._values)throw new Error("Cannot invoke subset on a Pattern only matrix");switch(arguments.length){case 1:return u(this,e);case 2:case 3:return c(this,e,t,n);default:throw new SyntaxError("Wrong number of arguments")}};var u=function(t,n){if(!e.isIndex(n))throw new TypeError("Invalid index");if(n.isScalar())return t.get(n.min());var r,a,i,s,l=n.size();if(l.length!=t._size.length)throw new DimensionError_1(l.length,t._size.length);var u=n.min(),c=n.max();for(r=0,a=t._size.length;r<a;r++)validateIndex$1(u[r],t._size[r]),validateIndex$1(c[r],t._size[r]);var p=t._values,d=t._index,m=t._ptr,f=n.dimension(0),h=n.dimension(1),y=[],b=[];f.forEach((function(e,t){b[e]=t[0],y[e]=!0}));var g=p?[]:void 0,v=[],T=[];return h.forEach((function(e){for(T.push(v.length),i=m[e],s=m[e+1];i<s;i++)r=d[i],!0===y[r]&&(v.push(b[r]),g&&g.push(p[i]))})),T.push(v.length),new o({values:g,index:v,ptr:T,size:l,datatype:t._datatype})},c=function(t,n,r,a){if(!n||!0!==n.isIndex)throw new TypeError("Invalid index");var i,o=n.size(),s=n.isScalar();if(e.isMatrix(r)?(i=r.size(),r=r.toArray()):i=array$1.size(r),s){if(0!==i.length)throw new TypeError("Scalar expected");t.set(n.min(),r,a)}else{if(1!==o.length&&2!==o.length)throw new DimensionError_1(o.length,t._size.length,"<");if(i.length<o.length){for(var l=0,u=0;1===o[l]&&1===i[l];)l++;for(;1===o[l];)u++,l++;r=array$1.unsqueeze(r,o.length,u,i)}if(!object$4.deepEqual(o,i))throw new DimensionError_1(o,i,">");for(var c=n.min()[0],p=n.min()[1],d=i[0],m=i[1],f=0;f<d;f++)for(var h=0;h<m;h++){var y=r[f][h];t.set([f+c,h+p],y,a)}}return t};o.prototype.get=function(e){if(!isArray$5(e))throw new TypeError("Array expected");if(e.length!=this._size.length)throw new DimensionError_1(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke get on a Pattern only matrix");var t=e[0],n=e[1];validateIndex$1(t,this._size[0]),validateIndex$1(n,this._size[1]);var r=p(t,this._ptr[n],this._ptr[n+1],this._index);return r<this._ptr[n+1]&&this._index[r]===t?this._values[r]:0},o.prototype.set=function(e,t,n){if(!isArray$5(e))throw new TypeError("Array expected");if(e.length!=this._size.length)throw new DimensionError_1(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke set on a Pattern only matrix");var a=e[0],o=e[1],s=this._size[0],l=this._size[1],u=i,c=0;isString$4(this._datatype)&&(u=r.find(i,[this._datatype,this._datatype])||i,c=r.convert(0,this._datatype)),(a>s-1||o>l-1)&&(f(this,Math.max(a+1,s),Math.max(o+1,l),n),s=this._size[0],l=this._size[1]),validateIndex$1(a,s),validateIndex$1(o,l);var h=p(a,this._ptr[o],this._ptr[o+1],this._index);return h<this._ptr[o+1]&&this._index[h]===a?u(t,c)?d(h,o,this._values,this._index,this._ptr):this._values[h]=t:m(h,a,o,t,this._values,this._index,this._ptr),this};var p=function(e,t,n,r){if(n-t==0)return n;for(var a=t;a<n;a++)if(r[a]===e)return a;return t},d=function(e,t,n,r,a){n.splice(e,1),r.splice(e,1);for(var i=t+1;i<a.length;i++)a[i]--},m=function(e,t,n,r,a,i,o){a.splice(e,0,r),i.splice(e,0,t);for(var s=n+1;s<o.length;s++)o[s]++};o.prototype.resize=function(e,t,n){if(!isArray$5(e))throw new TypeError("Array expected");if(2!==e.length)throw new Error("Only two dimensions matrix are supported");e.forEach((function(t){if(!number$3.isNumber(t)||!number$3.isInteger(t)||t<0)throw new TypeError("Invalid size, must contain positive integers (size: "+string$7.format(e)+")")}));var r=n?this.clone():this;return f(r,e[0],e[1],t)};var f=function(e,t,n,a){var o=a||0,s=i,l=0;isString$4(e._datatype)&&(s=r.find(i,[e._datatype,e._datatype])||i,l=r.convert(0,e._datatype),o=r.convert(o,e._datatype));var u,c,p,d=!s(o,l),m=e._size[0],f=e._size[1];if(n>f){for(c=f;c<n;c++)if(e._ptr[c]=e._values.length,d)for(u=0;u<m;u++)e._values.push(o),e._index.push(u);e._ptr[n]=e._values.length}else n<f&&(e._ptr.splice(n+1,f-n),e._values.splice(e._ptr[n],e._values.length),e._index.splice(e._ptr[n],e._index.length));if(f=n,t>m){if(d){var h=0;for(c=0;c<f;c++){e._ptr[c]=e._ptr[c]+h,p=e._ptr[c+1]+h;var y=0;for(u=m;u<t;u++,y++)e._values.splice(p+y,0,o),e._index.splice(p+y,0,u),h++}e._ptr[f]=e._values.length}}else if(t<m){var b=0;for(c=0;c<f;c++){e._ptr[c]=e._ptr[c]-b;var g=e._ptr[c],v=e._ptr[c+1]-b;for(p=g;p<v;p++)(u=e._index[p])>t-1&&(e._values.splice(p,1),e._index.splice(p,1),b++)}e._ptr[c]=e._values.length}return e._size[0]=t,e._size[1]=n,e};o.prototype.reshape=function(e,t){if(!isArray$5(e))throw new TypeError("Array expected");if(2!==e.length)throw new Error("Sparse matrices can only be reshaped in two dimensions");if(e.forEach((function(t){if(!number$3.isNumber(t)||!number$3.isInteger(t)||t<0)throw new TypeError("Invalid size, must contain positive integers (size: "+string$7.format(e)+")")})),this._size[0]*this._size[1]!=e[0]*e[1])throw new Error("Reshaping sparse matrix will result in the wrong number of elements");var n=t?this.clone():this;if(this._size[0]===e[0]&&this._size[1]===e[1])return n;for(var r=[],a=0;a<n._ptr.length;a++)for(var i=0;i<n._ptr[a+1]-n._ptr[a];i++)r.push(a);var o=n._values.slice(),s=n._index.slice();for(a=0;a<n._index.length;a++){var l=s[a],u=r[a],c=l*n._size[1]+u;r[a]=c%e[1],s[a]=Math.floor(c/e[1])}for(n._values.length=0,n._index.length=0,n._ptr.length=e[1]+1,n._size=e.slice(),a=0;a<n._ptr.length;a++)n._ptr[a]=0;for(var d=0;d<o.length;d++){a=s[d],i=r[d];var f=o[d],h=p(a,n._ptr[i],n._ptr[i+1],n._index);m(h,a,i,f,n._values,n._index,n._ptr)}return n},o.prototype.clone=function(){return new o({values:this._values?object$4.clone(this._values):void 0,index:object$4.clone(this._index),ptr:object$4.clone(this._ptr),size:object$4.clone(this._size),datatype:this._datatype})},o.prototype.size=function(){return this._size.slice(0)},o.prototype.map=function(e,t){if(!this._values)throw new Error("Cannot invoke map on a Pattern only matrix");var n=this,r=this._size[0],a=this._size[1];return h(this,0,r-1,0,a-1,(function(t,r,a){return e(t,[r,a],n)}),t)};var h=function(e,t,n,a,s,l,u){var c=[],p=[],d=[],m=i,f=0;isString$4(e._datatype)&&(m=r.find(i,[e._datatype,e._datatype])||i,f=r.convert(0,e._datatype));for(var h=function(e,t,n){e=l(e,t,n),m(e,f)||(c.push(e),p.push(t))},y=a;y<=s;y++){d.push(c.length);for(var b=e._ptr[y],g=e._ptr[y+1],v=t,T=b;T<g;T++){var C=e._index[T];if(C>=t&&C<=n){if(!u)for(var N=v;N<C;N++)h(0,N-t,y-a);h(e._values[T],C-t,y-a)}v=C+1}if(!u)for(var A=v;A<=n;A++)h(0,A-t,y-a)}return d.push(c.length),new o({values:c,index:p,ptr:d,size:[n-t+1,s-a+1]})};o.prototype.forEach=function(e,t){if(!this._values)throw new Error("Cannot invoke forEach on a Pattern only matrix");for(var n=this,r=this._size[0],a=this._size[1],i=0;i<a;i++){for(var o=this._ptr[i],s=this._ptr[i+1],l=0,u=o;u<s;u++){var c=this._index[u];if(!t)for(var p=l;p<c;p++)e(0,[p,i],n);e(this._values[u],[c,i],n),l=c+1}if(!t)for(var d=l;d<r;d++)e(0,[d,i],n)}},o.prototype.toArray=function(){return y(this._values,this._index,this._ptr,this._size,!0)},o.prototype.valueOf=function(){return y(this._values,this._index,this._ptr,this._size,!1)};var y=function(e,t,n,r,a){var i,o,s=r[0],l=r[1],u=[];for(i=0;i<s;i++)for(u[i]=[],o=0;o<l;o++)u[i][o]=0;for(o=0;o<l;o++)for(var c=n[o],p=n[o+1],d=c;d<p;d++)u[i=t[d]][o]=e?a?object$4.clone(e[d]):e[d]:1;return u};return o.prototype.format=function(e){for(var t=this._size[0],n=this._size[1],r=this.density(),a="Sparse Matrix ["+string$7.format(t,e)+" x "+string$7.format(n,e)+"] density: "+string$7.format(r,e)+"\n",i=0;i<n;i++)for(var o=this._ptr[i],s=this._ptr[i+1],l=o;l<s;l++){var u=this._index[l];a+="\n    ("+string$7.format(u,e)+", "+string$7.format(i,e)+") ==> "+(this._values?string$7.format(this._values[l],e):"X")}return a},o.prototype.toString=function(){return string$7.format(this.toArray())},o.prototype.toJSON=function(){return{mathjs:"SparseMatrix",values:this._values,index:this._index,ptr:this._ptr,size:this._size,datatype:this._datatype}},o.prototype.diagonal=function(t){if(t){if(e.isBigNumber(t)&&(t=t.toNumber()),!isNumber$4(t)||!isInteger$s(t))throw new TypeError("The parameter k must be an integer number")}else t=0;var n=t>0?t:0,r=t<0?-t:0,a=this._size[0],i=this._size[1],s=Math.min(a-r,i-n),l=[],u=[],c=[];c[0]=0;for(var p=n;p<i&&l.length<s;p++)for(var d=this._ptr[p],m=this._ptr[p+1],f=d;f<m;f++){var h=this._index[f];if(h===p-n+r){l.push(this._values[f]),u[l.length-1]=h-r;break}}return c.push(l.length),new o({values:l,index:u,ptr:c,size:[s,1]})},o.fromJSON=function(e){return new o(e)},o.diagonal=function(t,n,a,s,l){if(!isArray$5(t))throw new TypeError("Array expected, size parameter");if(2!==t.length)throw new Error("Only two dimensions matrix are supported");if(t=t.map((function(t){if(e.isBigNumber(t)&&(t=t.toNumber()),!isNumber$4(t)||!isInteger$s(t)||t<1)throw new Error("Size values must be positive integers");return t})),a){if(e.isBigNumber(a)&&(a=a.toNumber()),!isNumber$4(a)||!isInteger$s(a))throw new TypeError("The parameter k must be an integer number")}else a=0;var u=i,c=0;isString$4(l)&&(u=r.find(i,[l,l])||i,c=r.convert(0,l));var p,d=a>0?a:0,m=a<0?-a:0,f=t[0],h=t[1],y=Math.min(f-m,h-d);if(isArray$5(n)){if(n.length!==y)throw new Error("Invalid value array length");p=function(e){return n[e]}}else if(e.isMatrix(n)){var b=n.size();if(1!==b.length||b[0]!==y)throw new Error("Invalid matrix length");p=function(e){return n.get([e])}}else p=function(){return n};for(var g=[],v=[],T=[],C=0;C<h;C++){T.push(g.length);var N=C-d;if(N>=0&&N<y){var A=p(N);u(A,c)||(v.push(N+m),g.push(A))}}return T.push(g.length),new o({values:g,index:v,ptr:T,size:[f,h]})},o.prototype.swapRows=function(e,t){if(!(isNumber$4(e)&&isInteger$s(e)&&isNumber$4(t)&&isInteger$s(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return validateIndex$1(e,this._size[0]),validateIndex$1(t,this._size[0]),o._swapRows(e,t,this._size[1],this._values,this._index,this._ptr),this},o._forEachRow=function(e,t,n,r,a){for(var i=r[e],o=r[e+1],s=i;s<o;s++)a(n[s],t[s])},o._swapRows=function(e,t,n,r,a,i){for(var o=0;o<n;o++){var s=i[o],l=i[o+1],u=p(e,s,l,a),c=p(t,s,l,a);if(u<l&&c<l&&a[u]===e&&a[c]===t){if(r){var d=r[u];r[u]=r[c],r[c]=d}}else if(u<l&&a[u]===e&&(c>=l||a[c]!==t)){var m=r?r[u]:void 0;a.splice(c,0,t),r&&r.splice(c,0,m),a.splice(c<=u?u+1:u,1),r&&r.splice(c<=u?u+1:u,1)}else if(c<l&&a[c]===t&&(u>=l||a[u]!==e)){var f=r?r[c]:void 0;a.splice(u,0,e),r&&r.splice(u,0,f),a.splice(u<=c?c+1:c,1),r&&r.splice(u<=c?c+1:c,1)}}},e.Matrix._storage.sparse=o,o}var name$3$="SparseMatrix",path$X="type",factory_1$4c=factory$4d,lazy$3=!1,SparseMatrix={name:name$3$,path:path$X,factory:factory_1$4c,lazy:lazy$3};function factory$4c(e,t,n,r){var a=r("matrix",{"":function(){return i([])},string:function(e){return i([],e)},"string, string":function(e,t){return i([],e,t)},Array:function(e){return i(e)},Matrix:function(e){return i(e,e.storage())},"Array | Matrix, string":i,"Array | Matrix, string, string":i});return a.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},a;function i(t,n,r){return new(e.Matrix.storage(n||"default"))(t,r)}}var name$3_="matrix",factory_1$4b=factory$4c,matrix$5={name:name$3_,factory:factory_1$4b};function factory$4b(e,t,n,r){var a=r("add",{"number, number":function(e,t){return e+t},"Complex, Complex":function(e,t){return e.add(t)},"BigNumber, BigNumber":function(e,t){return e.plus(t)},"Fraction, Fraction":function(e,t){return e.add(t)},"Unit, Unit":function(e,t){if(null==e.value)throw new Error("Parameter x contains a unit with undefined value");if(null==t.value)throw new Error("Parameter y contains a unit with undefined value");if(!e.equalBase(t))throw new Error("Units do not match");var n=e.clone();return n.value=a(n.value,t.value),n.fixPrefix=!1,n}});return a}var factory_1$4a=factory$4b,addScalar={factory:factory_1$4a};function factory$4a(e,t,n,r){var a=e.DenseMatrix;return function(e,t,n,i){var o=e._data,s=e._size,l=e._datatype,u=t._values,c=t._index,p=t._ptr,d=t._size,m=t._datatype;if(s.length!==d.length)throw new DimensionError_1(s.length,d.length);if(s[0]!==d[0]||s[1]!==d[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+d+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var f,h,y=s[0],b=s[1],g="string"==typeof l&&l===m?l:void 0,v=g?r.find(n,[g,g]):n,T=[];for(f=0;f<y;f++)T[f]=[];var C=[],N=[];for(h=0;h<b;h++){for(var A=h+1,S=p[h],w=p[h+1],x=S;x<w;x++)C[f=c[x]]=i?v(u[x],o[f][h]):v(o[f][h],u[x]),N[f]=A;for(f=0;f<y;f++)N[f]===A?T[f][h]=C[f]:T[f][h]=o[f][h]}return new a({data:T,size:[y,b],datatype:g})}}var name$3Z="algorithm01",factory_1$49=factory$4a,algorithm01={name:name$3Z,factory:factory_1$49};function factory$49(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype,p=t._values,d=t._index,m=t._ptr,f=t._size,h=t._datatype;if(u.length!==f.length)throw new DimensionError_1(u.length,f.length);if(u[0]!==f[0]||u[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+f+")");var y,b=u[0],g=u[1],v=a,T=0,C=n;"string"==typeof c&&c===h&&(y=c,v=r.find(a,[y,y]),T=r.convert(0,y),C=r.find(n,[y,y]));var N,A,S,w,x,V=o&&p?[]:void 0,E=[],$=[],_=new i({values:V,index:E,ptr:$,size:[b,g],datatype:y}),O=o&&p?[]:void 0,I=o&&p?[]:void 0,D=[],R=[];for(A=0;A<g;A++){$[A]=E.length;var P=A+1;for(w=l[A],x=l[A+1],S=w;S<x;S++)N=s[S],E.push(N),D[N]=P,O&&(O[N]=o[S]);for(w=m[A],x=m[A+1],S=w;S<x;S++)if(D[N=d[S]]===P){if(O){var k=C(O[N],p[S]);v(k,T)?D[N]=null:O[N]=k}}else E.push(N),R[N]=P,I&&(I[N]=p[S]);if(O&&I)for(S=$[A];S<E.length;)D[N=E[S]]===P?(V[S]=O[N],S++):R[N]===P?(V[S]=I[N],S++):E.splice(S,1)}return $[g]=E.length,_}}var name$3Y="algorithm04",factory_1$48=factory$49,algorithm04={name:name$3Y,factory:factory_1$48};function factory$48(e,t,n,r){var a=e.DenseMatrix;return function(e,t,n,i){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype;if(!o)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var p,d=u[0],m=u[1],f=n;"string"==typeof c&&(p=c,t=r.convert(t,p),f=r.find(n,[p,p]));for(var h=[],y=new a({data:h,size:[d,m],datatype:p}),b=[],g=[],v=0;v<m;v++){for(var T=v+1,C=l[v],N=l[v+1],A=C;A<N;A++){var S=s[A];b[S]=o[A],g[S]=T}for(var w=0;w<d;w++)0===v&&(h[w]=[]),g[w]===T?h[w][v]=i?f(t,b[w]):f(b[w],t):h[w][v]=t}return y}}var name$3X="algorithm10",factory_1$47=factory$48,algorithm10={name:name$3X,factory:factory_1$47},string$6=utils$2.string;function factory$47(e,t,n,r){var a=e.DenseMatrix,i=function(e,t,n,r,a,o){var s=[];if(t===n.length-1)for(var l=0;l<r;l++)s[l]=e(a[l],o[l]);else for(var u=0;u<r;u++)s[u]=i(e,t+1,n,n[t+1],a[u],o[u]);return s};return function(e,t,n){var o,s=e._data,l=e._size,u=e._datatype,c=t._data,p=t._size,d=t._datatype,m=[];if(l.length!==p.length)throw new DimensionError_1(l.length,p.length);for(var f=0;f<l.length;f++){if(l[f]!==p[f])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+p+")");m[f]=l[f]}var h=n;"string"==typeof u&&u===d&&(o=u,t=r.convert(t,o),h=r.find(n,[o,o]));var y=m.length>0?i(h,0,m,m[0],s,c):[];return new a({data:y,size:m,datatype:o})}}string$6.isString;var name$3W="algorithm13",factory_1$46=factory$47,algorithm13={name:name$3W,factory:factory_1$46},clone$b=object$6.clone;function factory$46(e,t,n,r){var a=e.DenseMatrix,i=function(e,t,n,r,a,o,s){var l=[];if(t===n.length-1)for(var u=0;u<r;u++)l[u]=s?e(o,a[u]):e(a[u],o);else for(var c=0;c<r;c++)l[c]=i(e,t+1,n,n[t+1],a[c],o,s);return l};return function(e,t,n,o){var s,l=e._data,u=e._size,c=e._datatype,p=n;"string"==typeof c&&(s=c,t=r.convert(t,s),p=r.find(n,[s,s]));var d=u.length>0?i(p,0,u,u[0],l,t,o):[];return new a({data:d,size:clone$b(u),datatype:s})}}var name$3V="algorithm14",factory_1$45=factory$46,algorithm14={name:name$3V,factory:factory_1$45},extend$5=object$6.extend;function factory$45(e,t,n,r){var a=n(matrix$5),i=n(addScalar),o=latex$1,s=n(algorithm01),l=n(algorithm04),u=n(algorithm10),c=n(algorithm13),p=n(algorithm14),d=r("add",extend$5({"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,i)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,i,!0)},"SparseMatrix, SparseMatrix":function(e,t){return l(e,t,i)},"Array, Array":function(e,t){return d(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return d(a(e),t)},"Matrix, Array":function(e,t){return d(e,a(t))},"DenseMatrix, any":function(e,t){return p(e,t,i,!1)},"SparseMatrix, any":function(e,t){return u(e,t,i,!1)},"any, DenseMatrix":function(e,t){return p(t,e,i,!0)},"any, SparseMatrix":function(e,t){return u(t,e,i,!0)},"Array, any":function(e,t){return p(a(e),t,i,!1).valueOf()},"any, Array":function(e,t){return p(a(t),e,i,!0).valueOf()},"any, any":i,"any, any, ...any":function(e,t,n){for(var r=d(e,t),a=0;a<n.length;a++)r=d(r,n[a]);return r}},i.signatures));return d.toTex={2:"\\left(${args[0]}"+o.operators.add+"${args[1]}\\right)"},d}var name$3U="add",factory_1$44=factory$45,add$2={name:name$3U,factory:factory_1$44};function factory$44(e,t,n){var r=n(add$2),a=n(equalScalar);function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._values=[],this._heap=new e.FibonacciHeap}return i.prototype.type="Spa",i.prototype.isSpa=!0,i.prototype.set=function(e,t){if(this._values[e])this._values[e].value=t;else{var n=this._heap.insert(e,t);this._values[e]=n}},i.prototype.get=function(e){var t=this._values[e];return t?t.value:0},i.prototype.accumulate=function(e,t){var n=this._values[e];n?n.value=r(n.value,t):(n=this._heap.insert(e,t),this._values[e]=n)},i.prototype.forEach=function(e,t,n){var r=this._heap,i=this._values,o=[],s=r.extractMinimum();for(s&&o.push(s);s&&s.key<=t;)s.key>=e&&(a(s.value,0)||n(s.key,s.value,this)),(s=r.extractMinimum())&&o.push(s);for(var l=0;l<o.length;l++){var u=o[l];i[(s=r.insert(u.key,u.value)).key]=s}},i.prototype.swap=function(e,t){var n=this._values[e],r=this._values[t];if(!n&&r)n=this._heap.insert(e,r.value),this._heap.remove(r),this._values[e]=n,this._values[t]=void 0;else if(n&&!r)r=this._heap.insert(t,n.value),this._heap.remove(n),this._values[t]=r,this._values[e]=void 0;else if(n&&r){var a=n.value;n.value=r.value,r.value=a}},i}var name$3T="Spa",path$W="type",factory_1$43=factory$44,Spa={name:name$3T,path:path$W,factory:factory_1$43};function factory$43(e,t,n,r){var a=e.DenseMatrix;return function(e,t,n,i){var o=e._data,s=e._size,l=e._datatype,u=t._values,c=t._index,p=t._ptr,d=t._size,m=t._datatype;if(s.length!==d.length)throw new DimensionError_1(s.length,d.length);if(s[0]!==d[0]||s[1]!==d[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+d+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var f,h=s[0],y=s[1],b=0,g=n;"string"==typeof l&&l===m&&(f=l,b=r.convert(0,f),g=r.find(n,[f,f]));for(var v=[],T=0;T<h;T++)v[T]=[];for(var C=[],N=[],A=0;A<y;A++){for(var S=A+1,w=p[A],x=p[A+1],V=w;V<x;V++){var E=c[V];C[E]=i?g(u[V],o[E][A]):g(o[E][A],u[V]),N[E]=S}for(var $=0;$<h;$++)N[$]===S?v[$][A]=C[$]:v[$][A]=i?g(b,o[$][A]):g(o[$][A],b)}return new a({data:v,size:[h,y],datatype:f})}}var name$3S="algorithm03",factory_1$42=factory$43,algorithm03={name:name$3S,factory:factory_1$42};function factory$42(e,t,n,r){var a=e.DenseMatrix,i=function(e,t,n,r,a){for(var i=e._values,o=e._index,s=e._ptr,l=s[t],u=s[t+1];l<u;l++){var c=o[l];n[c]=a,r[c]=i[l]}};return function(e,t,n){var o=e._size,s=e._datatype,l=t._size,u=t._datatype;if(o.length!==l.length)throw new DimensionError_1(o.length,l.length);if(o[0]!==l[0]||o[1]!==l[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+l+")");var c,p,d,m=o[0],f=o[1],h=0,y=n;"string"==typeof s&&s===u&&(c=s,h=r.convert(0,c),y=r.find(n,[c,c]));var b=[];for(p=0;p<m;p++)b[p]=[];var g=new a({data:b,size:[m,f],datatype:c}),v=[],T=[],C=[],N=[];for(d=0;d<f;d++){var A=d+1;for(i(e,d,C,v,A),i(t,d,N,T,A),p=0;p<m;p++){var S=C[p]===A?v[p]:h,w=N[p]===A?T[p]:h;b[p][d]=y(S,w)}}return g}}var name$3R="algorithm07",factory_1$41=factory$42,algorithm07={name:name$3R,factory:factory_1$41};function factory$41(e,t,n,r){var a=e.DenseMatrix;return function(e,t,n,i){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype;if(!o)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var p,d=u[0],m=u[1],f=n;"string"==typeof c&&(p=c,t=r.convert(t,p),f=r.find(n,[p,p]));for(var h=[],y=new a({data:h,size:[d,m],datatype:p}),b=[],g=[],v=0;v<m;v++){for(var T=v+1,C=l[v],N=l[v+1],A=C;A<N;A++){var S=s[A];b[S]=o[A],g[S]=T}for(var w=0;w<d;w++)0===v&&(h[w]=[]),g[w]===T?h[w][v]=i?f(t,b[w]):f(b[w],t):h[w][v]=i?f(t,0):f(0,t)}return y}}var name$3Q="algorithm12",factory_1$40=factory$41,algorithm12={name:name$3Q,factory:factory_1$40},nearlyEqual$5=number$5.nearlyEqual;function factory$40(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm07),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=latex$1,p=r("smaller",{"boolean, boolean":function(e,t){return e<t},"number, number":function(e,n){return e<n&&!nearlyEqual$5(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return e.lt(n)&&!nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return-1===e.compare(t)},"Complex, Complex":function(e,t){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return p(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,p)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,p,!1)},"DenseMatrix, any":function(e,t){return u(e,t,p,!1)},"any, SparseMatrix":function(e,t){return s(t,e,p,!0)},"any, DenseMatrix":function(e,t){return u(t,e,p,!0)},"Array, any":function(e,t){return u(a(e),t,p,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+c.operators.smaller+"${args[1]}\\right)"},p}var name$3P="smaller",factory_1$3$=factory$40,smaller$1={name:name$3P,factory:factory_1$3$},nearlyEqual$4=number$5.nearlyEqual;function factory$3$(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm07),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=latex$1,p=r("larger",{"boolean, boolean":function(e,t){return e>t},"number, number":function(e,n){return e>n&&!nearlyEqual$4(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return e.gt(n)&&!nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return 1===e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return p(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,p)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,p,!1)},"DenseMatrix, any":function(e,t){return u(e,t,p,!1)},"any, SparseMatrix":function(e,t){return s(t,e,p,!0)},"any, DenseMatrix":function(e,t){return u(t,e,p,!0)},"Array, any":function(e,t){return u(a(e),t,p,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+c.operators.larger+"${args[1]}\\right)"},p}var name$3O="larger",factory_1$3_=factory$3$,larger$1={name:name$3O,factory:factory_1$3_};function factory$3_(e,t,n,r){var a=n(smaller$1),i=n(larger$1),o=1/Math.log((1+Math.sqrt(5))/2);function s(){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");this._minimum=null,this._size=0}s.prototype.type="FibonacciHeap",s.prototype.isFibonacciHeap=!0,s.prototype.insert=function(e,t){var n={key:e,value:t,degree:0};if(this._minimum){var r=this._minimum;n.left=r,n.right=r.right,r.right=n,n.right.left=n,a(e,r.key)&&(this._minimum=n)}else n.left=n,n.right=n,this._minimum=n;return this._size++,n},s.prototype.size=function(){return this._size},s.prototype.clear=function(){this._minimum=null,this._size=0},s.prototype.isEmpty=function(){return 0===this._size},s.prototype.extractMinimum=function(){var e=this._minimum;if(null===e)return e;for(var t=this._minimum,n=e.degree,r=e.child;n>0;){var a=r.right;r.left.right=r.right,r.right.left=r.left,r.left=t,r.right=t.right,t.right=r,r.right.left=r,r.parent=null,r=a,n--}return e.left.right=e.right,e.right.left=e.left,e==e.right?t=null:(t=e.right,t=d(t,this._size)),this._size--,this._minimum=t,e},s.prototype.remove=function(e){this._minimum=l(this._minimum,e,-1),this.extractMinimum()};var l=function(e,t,n){t.key=n;var r=t.parent;return r&&a(t.key,r.key)&&(u(e,t,r),c(e,r)),a(t.key,e.key)&&(e=t),e},u=function(e,t,n){t.left.right=t.right,t.right.left=t.left,n.degree--,n.child==t&&(n.child=t.right),0===n.degree&&(n.child=null),t.left=e,t.right=e.right,e.right=t,t.right.left=t,t.parent=null,t.mark=!1},c=function(e,t){var n=t.parent;n&&(t.mark?(u(e,t,n),c(n)):t.mark=!0)},p=function(e,t){e.left.right=e.right,e.right.left=e.left,e.parent=t,t.child?(e.left=t.child,e.right=t.child.right,t.child.right=e,e.right.left=e):(t.child=e,e.right=e,e.left=e),t.degree++,e.mark=!1},d=function(e,t){var n,r=Math.floor(Math.log(t)*o)+1,s=new Array(r),l=0,u=e;if(u)for(l++,u=u.right;u!==e;)l++,u=u.right;for(;l>0;){for(var c=u.degree,d=u.right;n=s[c];){if(i(u.key,n.key)){var m=n;n=u,u=m}p(n,u),s[c]=null,c++}s[c]=u,u=d,l--}e=null;for(var f=0;f<r;f++)(n=s[f])&&(e?(n.left.right=n.right,n.right.left=n.left,n.left=e,n.right=e.right,e.right=n,n.right.left=n,a(n.key,e.key)&&(e=n)):e=n);return e};return s}var name$3N="FibonacciHeap",path$V="type",factory_1$3Z=factory$3_,FibonacciHeap={name:name$3N,path:path$V,factory:factory_1$3Z},string$5=utils$2.string,object$3=utils$2.object,isArray$4=Array.isArray,isString$3=string$5.isString;function factory$3Z(e,t,n){var r=n(DenseMatrix),a=n(smaller$1);function i(t,n){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(n&&!isString$3(n))throw new Error("Invalid datatype: "+n);if(e.isMatrix(t)||isArray$4(t)){var a=new r(t,n);this._data=a._data,this._size=a._size,this._datatype=a._datatype,this._min=null,this._max=null}else if(t&&isArray$4(t.data)&&isArray$4(t.size))this._data=t.data,this._size=t.size,this._datatype=t.datatype,this._min=void 0!==t.min?t.min:null,this._max=void 0!==t.max?t.max:null;else{if(t)throw new TypeError("Unsupported type of data ("+utils$2.types.type(t)+")");this._data=[],this._size=[0],this._datatype=n,this._min=null,this._max=null}}return i.prototype=new r,i.prototype.type="ImmutableDenseMatrix",i.prototype.isImmutableDenseMatrix=!0,i.prototype.subset=function(t){switch(arguments.length){case 1:var n=r.prototype.subset.call(this,t);return e.isMatrix(n)?new i({data:n._data,size:n._size,datatype:n._datatype}):n;case 2:case 3:throw new Error("Cannot invoke set subset on an Immutable Matrix instance");default:throw new SyntaxError("Wrong number of arguments")}},i.prototype.set=function(){throw new Error("Cannot invoke set on an Immutable Matrix instance")},i.prototype.resize=function(){throw new Error("Cannot invoke resize on an Immutable Matrix instance")},i.prototype.reshape=function(){throw new Error("Cannot invoke reshape on an Immutable Matrix instance")},i.prototype.clone=function(){return new i({data:object$3.clone(this._data),size:object$3.clone(this._size),datatype:this._datatype})},i.prototype.toJSON=function(){return{mathjs:"ImmutableDenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},i.fromJSON=function(e){return new i(e)},i.prototype.swapRows=function(){throw new Error("Cannot invoke swapRows on an Immutable Matrix instance")},i.prototype.min=function(){if(null===this._min){var e=null;this.forEach((function(t){(null===e||a(t,e))&&(e=t)})),this._min=null!==e?e:void 0}return this._min},i.prototype.max=function(){if(null===this._max){var e=null;this.forEach((function(t){(null===e||a(e,t))&&(e=t)})),this._max=null!==e?e:void 0}return this._max},i}var name$3M="ImmutableDenseMatrix",path$U="type",factory_1$3Y=factory$3Z,ImmutableDenseMatrix={name:name$3M,path:path$U,factory:factory_1$3Y},clone$a=object$6.clone,isInteger$r=number$5.isInteger;function factory$3Y(e){function t(r){if(!(this instanceof t))throw new SyntaxError("Constructor must be called with the new operator");this._dimensions=[],this._isScalar=!0;for(var a=0,i=arguments.length;a<i;a++){var o=arguments[a];if(e.isRange(o))this._dimensions.push(o),this._isScalar=!1;else if(Array.isArray(o)||e.isMatrix(o)){var s=n(o.valueOf());this._dimensions.push(s);var l=s.size();1===l.length&&1===l[0]||(this._isScalar=!1)}else if("number"==typeof o)this._dimensions.push(n([o]));else{if("string"!=typeof o)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");this._dimensions.push(o)}}}function n(t){for(var n=0,r=t.length;n<r;n++)if("number"!=typeof t[n]||!isInteger$r(t[n]))throw new TypeError("Index parameters must be positive integer numbers");return new e.ImmutableDenseMatrix(t)}return t.prototype.type="Index",t.prototype.isIndex=!0,t.prototype.clone=function(){var e=new t;return e._dimensions=clone$a(this._dimensions),e._isScalar=this._isScalar,e},t.create=function(e){var n=new t;return t.apply(n,e),n},t.prototype.size=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?1:r.size()[0]}return e},t.prototype.max=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?r:r.max()}return e},t.prototype.min=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e[t]="string"==typeof r?r:r.min()}return e},t.prototype.forEach=function(e){for(var t=0,n=this._dimensions.length;t<n;t++)e(this._dimensions[t],t,this)},t.prototype.dimension=function(e){return this._dimensions[e]||null},t.prototype.isObjectProperty=function(){return 1===this._dimensions.length&&"string"==typeof this._dimensions[0]},t.prototype.getObjectProperty=function(){return this.isObjectProperty()?this._dimensions[0]:null},t.prototype.isScalar=function(){return this._isScalar},t.prototype.toArray=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];e.push("string"==typeof r?r:r.toArray())}return e},t.prototype.valueOf=t.prototype.toArray,t.prototype.toString=function(){for(var e=[],t=0,n=this._dimensions.length;t<n;t++){var r=this._dimensions[t];"string"==typeof r?e.push(JSON.stringify(r)):e.push(r.toString())}return"["+e.join(", ")+"]"},t.prototype.toJSON=function(){return{mathjs:"Index",dimensions:this._dimensions}},t.fromJSON=function(e){return t.create(e.dimensions)},t}var name$3L="Index",path$T="type",factory_1$3X=factory$3Y,MatrixIndex={name:name$3L,path:path$T,factory:factory_1$3X};function factory$3X(e,t,n,r){function a(t,n,r){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(null!=t)if(e.isBigNumber(t))t=t.toNumber();else if("number"!=typeof t)throw new TypeError("Parameter start must be a number");if(null!=n)if(e.isBigNumber(n))n=n.toNumber();else if("number"!=typeof n)throw new TypeError("Parameter end must be a number");if(null!=r)if(e.isBigNumber(r))r=r.toNumber();else if("number"!=typeof r)throw new TypeError("Parameter step must be a number");this.start=null!=t?parseFloat(t):0,this.end=null!=n?parseFloat(n):0,this.step=null!=r?parseFloat(r):1}return a.prototype.type="Range",a.prototype.isRange=!0,a.parse=function(e){if("string"!=typeof e)return null;var t=e.split(":").map((function(e){return parseFloat(e)}));if(t.some((function(e){return isNaN(e)})))return null;switch(t.length){case 2:return new a(t[0],t[1]);case 3:return new a(t[0],t[2],t[1]);default:return null}},a.prototype.clone=function(){return new a(this.start,this.end,this.step)},a.prototype.size=function(){var e=0,t=this.start,n=this.step,r=this.end-t;return number$5.sign(n)==number$5.sign(r)?e=Math.ceil(r/n):0==r&&(e=0),isNaN(e)&&(e=0),[e]},a.prototype.min=function(){var e=this.size()[0];return e>0?this.step>0?this.start:this.start+(e-1)*this.step:void 0},a.prototype.max=function(){var e=this.size()[0];return e>0?this.step>0?this.start+(e-1)*this.step:this.start:void 0},a.prototype.forEach=function(e){var t=this.start,n=this.step,r=this.end,a=0;if(n>0)for(;t<r;)e(t,[a],this),t+=n,a++;else if(n<0)for(;t>r;)e(t,[a],this),t+=n,a++},a.prototype.map=function(e){var t=[];return this.forEach((function(n,r,a){t[r[0]]=e(n,r,a)})),t},a.prototype.toArray=function(){var e=[];return this.forEach((function(t,n){e[n[0]]=t})),e},a.prototype.valueOf=function(){return this.toArray()},a.prototype.format=function(e){var t=number$5.format(this.start,e);return 1!=this.step&&(t+=":"+number$5.format(this.step,e)),t+":"+number$5.format(this.end,e)},a.prototype.toString=function(){return this.format()},a.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},a.fromJSON=function(e){return new a(e.start,e.end,e.step)},a}var name$3K="Range",path$S="type",factory_1$3W=factory$3X,Range={name:name$3K,path:path$S,factory:factory_1$3W};function factory$3W(e,t,n,r){return r("index",{"...number | string | BigNumber | Range | Array | Matrix":function(t){var n=t.map((function(t){return e.isBigNumber(t)?t.toNumber():Array.isArray(t)||e.isMatrix(t)?t.map((function(t){return e.isBigNumber(t)?t.toNumber():t})):t})),r=new e.Index;return e.Index.apply(r,n),r}})}var name$3J="index",factory_1$3V=factory$3W,_function$2={name:name$3J,factory:factory_1$3V};function factory$3V(e,t,n,r){var a=e.SparseMatrix,i=r("sparse",{"":function(){return new a([])},string:function(e){return new a([],e)},"Array | Matrix":function(e){return new a(e)},"Array | Matrix, string":function(e,t){return new a(e,t)}});return i.toTex={0:"\\begin{bsparse}\\end{bsparse}",1:"\\left(${args[0]}\\right)"},i}var name$3I="sparse",factory_1$3U=factory$3V,sparse$1={name:name$3I,factory:factory_1$3U},matrix$4=[Matrix,DenseMatrix,SparseMatrix,Spa,FibonacciHeap,ImmutableDenseMatrix,MatrixIndex,Range,_function$2,matrix$5,sparse$1];function factory$3U(e,t,n,r){var a=r("number",{"":function(){return 0},number:function(e){return e},string:function(e){var t=Number(e);if(isNaN(t))throw new SyntaxError('String "'+e+'" is no valid number');return t},BigNumber:function(e){return e.toNumber()},Fraction:function(e){return e.valueOf()},Unit:function(e){throw new Error("Second argument with valueless unit expected")},null:function(e){return 0},"Unit, string | Unit":function(e,t){return e.toNumber(t)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},a}var name$3H="number",factory_1$3T=factory$3U,number$2={name:name$3H,factory:factory_1$3T};function factory$3T(e,t,n,r){function a(e){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");this.entries=e||[]}return a.prototype.type="ResultSet",a.prototype.isResultSet=!0,a.prototype.valueOf=function(){return this.entries},a.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},a.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},a.fromJSON=function(e){return new a(e.entries)},a}var name$3G="ResultSet",path$R="type",factory_1$3S=factory$3T,ResultSet={name:name$3G,path:path$R,factory:factory_1$3S},resultset=[ResultSet];function factory$3S(e,t,n,r){var a=r("string",{"":function(){return""},number:number$5.format,null:function(e){return"null"},boolean:function(e){return e+""},string:function(e){return e},"Array | Matrix":function(e){return deepMap(e,a)},any:function(e){return String(e)}});return a.toTex={0:'\\mathtt{""}',1:"\\mathrm{string}\\left(${args[0]}\\right)"},a}var name$3F="string",factory_1$3R=factory$3S,string$4={name:name$3F,factory:factory_1$3R},type$1=[bignumber$1,boolean_1$2,chain$1,complex$2,fraction$1,matrix$4,number$2,resultset,string$4],constants$2=createCommonjsModule((function(e,t){var n=_function$3.memoize;function r(e){return e[0].precision}t.e=n((function(e){return new e(1).exp()}),r),t.phi=n((function(e){return new e(1).plus(new e(5).sqrt()).div(2)}),r),t.pi=n((function(e){return e.acos(-1)}),r),t.tau=n((function(e){return t.pi(e).times(2)}),r)}));function factory$3R(e,t,n,r,a){a.on("config",(function(i,o){i.number===o.number&&i.define_pi===o.define_pi&&i.define_e===o.define_e&&i.define_i===o.define_i||factory$3R(e,t,n,r,a)})),setConstant$1(a,"true",!0),setConstant$1(a,"false",!1),setConstant$1(a,"null",null),setConstant$1(a,"uninitialized","Error: Constant uninitialized is removed since v4.0.0. Use null instead"),"BigNumber"===t.number?(setConstant$1(a,"Infinity",new e.BigNumber(1/0)),setConstant$1(a,"NaN",new e.BigNumber(NaN)),!1===t.define_pi?deleteConstant(a,"pi"):setLazyConstant$2(a,"pi",(function(){return constants$2.pi(e.BigNumber)})),!1===t.define_e?deleteConstant(a,"e"):setLazyConstant$2(a,"e",(function(){return constants$2.e(e.BigNumber)}))):(setConstant$1(a,"Infinity",1/0),setConstant$1(a,"NaN",NaN),!1===t.define_pi?deleteConstant(a,"pi"):setConstant$1(a,"pi",Math.PI),!1===t.define_e?deleteConstant(a,"e"):setConstant$1(a,"e",Math.E)),!1===t.define_i?deleteConstant(a,"i"):setConstant$1(a,"i",e.Complex.I)}function deleteConstant(e,t){delete e[t],delete e.expression.mathWithTransform[t]}function setConstant$1(e,t,n){e[t]=n,e.expression.mathWithTransform[t]=n}function setLazyConstant$2(e,t,n){object$6.lazy(e,t,n),object$6.lazy(e.expression.mathWithTransform,t,n)}constants$2.e,constants$2.phi,constants$2.pi,constants$2.tau;const lazy$2=!1,math$h=!0;var constants$1={factory:factory$3R,lazy:lazy$2,math:math$h},bignumber={name:"bignumber",category:"Construction",syntax:["bignumber(x)"],description:"Create a big number from a number or string.",examples:["0.1 + 0.2","bignumber(0.1) + bignumber(0.2)",'bignumber("7.2")','bignumber("7.2e500")',"bignumber([0.1, 0.2, 0.3])"],seealso:["boolean","complex","fraction","index","matrix","string","unit"]},boolean_1={name:"boolean",category:"Construction",syntax:["x","boolean(x)"],description:"Convert a string or number into a boolean.",examples:["boolean(0)","boolean(1)","boolean(3)",'boolean("true")','boolean("false")',"boolean([1, 0, 1, 1])"],seealso:["bignumber","complex","index","matrix","number","string","unit"]},complex$1={name:"complex",category:"Construction",syntax:["complex()","complex(re, im)","complex(string)"],description:"Create a complex number.",examples:["complex()","complex(2, 3)",'complex("7 - 2i")'],seealso:["bignumber","boolean","index","matrix","number","string","unit"]},createUnit$1={name:"createUnit",category:"Construction",syntax:["createUnit(definitions)","createUnit(name, definition)"],description:"Create a user-defined unit and register it with the Unit type.",examples:['createUnit("foo")','createUnit("knot", {definition: "0.514444444 m/s", aliases: ["knots", "kt", "kts"]})','createUnit("mph", "1 mile/hour")'],seealso:["unit","splitUnit"]},fraction={name:"fraction",category:"Construction",syntax:["fraction(num)","fraction(num,den)"],description:"Create a fraction from a number or from a numerator and denominator.",examples:["fraction(0.125)","fraction(1, 3) + fraction(2, 5)"],seealso:["bignumber","boolean","complex","index","matrix","string","unit"]},construction={name:"index",category:"Construction",syntax:["[start]","[start:end]","[start:step:end]","[start1, start 2, ...]","[start1:end1, start2:end2, ...]","[start1:step1:end1, start2:step2:end2, ...]"],description:"Create an index to get or replace a subset of a matrix",examples:["[]","[1, 2, 3]","A = [1, 2, 3; 4, 5, 6]","A[1, :]","A[1, 2] = 50","A[0:2, 0:2] = ones(2, 2)"],seealso:["bignumber","boolean","complex","matrix,","number","range","string","unit"]},matrix$3={name:"matrix",category:"Construction",syntax:["[]","[a1, b1, ...; a2, b2, ...]","matrix()",'matrix("dense")',"matrix([...])"],description:"Create a matrix.",examples:["[]","[1, 2, 3]","[1, 2, 3; 4, 5, 6]","matrix()","matrix([3, 4])",'matrix([3, 4; 5, 6], "sparse")','matrix([3, 4; 5, 6], "sparse", "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","sparse"]},number$1={name:"number",category:"Construction",syntax:["x","number(x)","number(unit, valuelessUnit)"],description:"Create a number or convert a string or boolean into a number.",examples:["2","2e3","4.05","number(2)",'number("7.2")',"number(true)","number([true, false, true, true])",'number(unit("52cm"), "m")'],seealso:["bignumber","boolean","complex","fraction","index","matrix","string","unit"]},sparse={name:"sparse",category:"Construction",syntax:["sparse()","sparse([a1, b1, ...; a1, b2, ...])",'sparse([a1, b1, ...; a1, b2, ...], "number")'],description:"Create a sparse matrix.",examples:["sparse()","sparse([3, 4; 5, 6])",'sparse([3, 0; 5, 0], "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","matrix"]},splitUnit$1={name:"splitUnit",category:"Construction",syntax:["splitUnit(unit: Unit, parts: Unit[])"],description:"Split a unit in an array of units whose sum is equal to the original unit.",examples:['splitUnit(1 m, ["feet", "inch"])'],seealso:["unit","createUnit"]},string$3={name:"string",category:"Construction",syntax:['"text"',"string(x)"],description:"Create a string or convert a value to a string",examples:['"Hello World!"',"string(4.2)","string(3 + 2i)"],seealso:["bignumber","boolean","complex","index","matrix","number","unit"]},unit$3={name:"unit",category:"Construction",syntax:["value unit","unit(value, unit)","unit(string)"],description:"Create a unit.",examples:["5.5 mm","3 inch",'unit(7.1, "kilogram")','unit("23 deg")'],seealso:["bignumber","boolean","complex","index","matrix","number","string"]},e={name:"e",category:"Constants",syntax:["e"],description:"Euler's number, the base of the natural logarithm. Approximately equal to 2.71828",examples:["e","e ^ 2","exp(2)","log(e)"],seealso:["exp"]},_false={name:"false",category:"Constants",syntax:["false"],description:"Boolean value false",examples:["false"],seealso:["true"]},i={name:"i",category:"Constants",syntax:["i"],description:"Imaginary unit, defined as i*i=-1. A complex number is described as a + b*i, where a is the real part, and b is the imaginary part.",examples:["i","i * i","sqrt(-1)"],seealso:[]},_Infinity={name:"Infinity",category:"Constants",syntax:["Infinity"],description:"Infinity, a number which is larger than the maximum number that can be handled by a floating point number.",examples:["Infinity","1 / 0"],seealso:[]},LN2={name:"LN2",category:"Constants",syntax:["LN2"],description:"Returns the natural logarithm of 2, approximately equal to 0.693",examples:["LN2","log(2)"],seealso:[]},LN10={name:"LN10",category:"Constants",syntax:["LN10"],description:"Returns the natural logarithm of 10, approximately equal to 2.302",examples:["LN10","log(10)"],seealso:[]},LOG2E={name:"LOG2E",category:"Constants",syntax:["LOG2E"],description:"Returns the base-2 logarithm of E, approximately equal to 1.442",examples:["LOG2E","log(e, 2)"],seealso:[]},LOG10E={name:"LOG10E",category:"Constants",syntax:["LOG10E"],description:"Returns the base-10 logarithm of E, approximately equal to 0.434",examples:["LOG10E","log(e, 10)"],seealso:[]},_NaN={name:"NaN",category:"Constants",syntax:["NaN"],description:"Not a number",examples:["NaN","0 / 0"],seealso:[]},_null={name:"null",category:"Constants",syntax:["null"],description:"Value null",examples:["null"],seealso:["true","false"]},pi={name:"pi",category:"Constants",syntax:["pi"],description:"The number pi is a mathematical constant that is the ratio of a circle's circumference to its diameter, and is approximately equal to 3.14159",examples:["pi","sin(pi/2)"],seealso:["tau"]},phi={name:"phi",category:"Constants",syntax:["phi"],description:"Phi is the golden ratio. Two quantities are in the golden ratio if their ratio is the same as the ratio of their sum to the larger of the two quantities. Phi is defined as `(1 + sqrt(5)) / 2` and is approximately 1.618034...",examples:["phi"],seealso:[]},SQRT1_2={name:"SQRT1_2",category:"Constants",syntax:["SQRT1_2"],description:"Returns the square root of 1/2, approximately equal to 0.707",examples:["SQRT1_2","sqrt(1/2)"],seealso:[]},SQRT2={name:"SQRT2",category:"Constants",syntax:["SQRT2"],description:"Returns the square root of 2, approximately equal to 1.414",examples:["SQRT2","sqrt(2)"],seealso:[]},tau={name:"tau",category:"Constants",syntax:["tau"],description:"Tau is the ratio constant of a circle's circumference to radius, equal to 2 * pi, approximately 6.2832.",examples:["tau","2 * pi"],seealso:["pi"]},_true={name:"true",category:"Constants",syntax:["true"],description:"Boolean value true",examples:["true"],seealso:["false"]},version$2={name:"version",category:"Constants",syntax:["version"],description:"A string with the version number of math.js",examples:["version"],seealso:[]},derivative$2={name:"derivative",category:"Algebra",syntax:["derivative(expr, variable)","derivative(expr, variable, {simplify: boolean})"],description:"Takes the derivative of an expression expressed in parser Nodes. The derivative will be taken over the supplied variable in the second parameter. If there are multiple variables in the expression, it will return a partial derivative.",examples:['derivative("2x^3", "x")','derivative("2x^3", "x", {simplify: false})','derivative("2x^2 + 3x + 4", "x")','derivative("sin(2x)", "x")','f = parse("x^2 + x")','x = parse("x")',"df = derivative(f, x)","df.eval({x: 3})"],seealso:["simplify","parse","eval"]},lsolve$1={name:"lsolve",category:"Algebra",syntax:["x=lsolve(L, b)"],description:"Solves the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lup","lusolve","usolve","matrix","sparse"]},lup$1={name:"lup",category:"Algebra",syntax:["lup(m)"],description:"Calculate the Matrix LU decomposition with partial pivoting. Matrix A is decomposed in three matrices (L, U, P) where P * A = L * U",examples:["lup([[2, 1], [1, 4]])","lup(matrix([[2, 1], [1, 4]]))","lup(sparse([[2, 1], [1, 4]]))"],seealso:["lusolve","lsolve","usolve","matrix","sparse","slu","qr"]},lusolve$1={name:"lusolve",category:"Algebra",syntax:["x=lusolve(A, b)","x=lusolve(lu, b)"],description:"Solves the linear system A * x = b where A is an [n x n] matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lusolve(a, b)"],seealso:["lup","slu","lsolve","usolve","matrix","sparse"]},simplify$3={name:"simplify",category:"Algebra",syntax:["simplify(expr)","simplify(expr, rules)"],description:"Simplify an expression tree.",examples:['simplify("3 + 2 / 4")','simplify("2x + x")','f = parse("x * (x + 2 + x)")',"simplified = simplify(f)","simplified.eval({x: 2})"],seealso:["derivative","parse","eval"]},rationalize$1={name:"rationalize",category:"Algebra",syntax:["rationalize(expr)","rationalize(expr, scope)","rationalize(expr, scope, detailed)"],description:"Transform a rationalizable expression in a rational fraction. If rational fraction is one variable polynomial then converts the numerator and denominator in canonical form, with decreasing exponents, returning the coefficients of numerator.",examples:['rationalize("2x/y - y/(x+1)")','rationalize("2x/y - y/(x+1)", true)'],seealso:["simplify"]},slu$1={name:"slu",category:"Algebra",syntax:["slu(A, order, threshold)"],description:"Calculate the Matrix LU decomposition with full pivoting. Matrix A is decomposed in two matrices (L, U) and two permutation vectors (pinv, q) where P * A * Q = L * U",examples:["slu(sparse([4.5, 0, 3.2, 0; 3.1, 2.9, 0, 0.9; 0, 1.7, 3, 0; 3.5, 0.4, 0, 1]), 1, 0.001)"],seealso:["lusolve","lsolve","usolve","matrix","sparse","lup","qr"]},usolve$1={name:"usolve",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Solves the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["lup","lusolve","lsolve","matrix","sparse"]},qr$1={name:"qr",category:"Algebra",syntax:["qr(A)"],description:"Calculates the Matrix QR decomposition. Matrix `A` is decomposed in two matrices (`Q`, `R`) where `Q` is an orthogonal matrix and `R` is an upper triangular matrix.",examples:["qr([[1, -1,  4], [1,  4, -2], [1,  4,  2], [1,  -1, 0]])"],seealso:["lup","slu","matrix"]},abs$2={name:"abs",category:"Arithmetic",syntax:["abs(x)"],description:"Compute the absolute value.",examples:["abs(3.5)","abs(-4.2)"],seealso:["sign"]},add$1={name:"add",category:"Operators",syntax:["x + y","add(x, y)"],description:"Add two values.",examples:["a = 2.1 + 3.6","a - 3.6","3 + 2i","3 cm + 2 inch",'"2.3" + "4"'],seealso:["subtract"]},cbrt$1={name:"cbrt",category:"Arithmetic",syntax:["cbrt(x)","cbrt(x, allRoots)"],description:"Compute the cubic root value. If x = y * y * y, then y is the cubic root of x. When `x` is a number or complex number, an optional second argument `allRoots` can be provided to return all three cubic roots. If not provided, the principal root is returned",examples:["cbrt(64)","cube(4)","cbrt(-8)","cbrt(2 + 3i)","cbrt(8i)","cbrt(8i, true)","cbrt(27 m^3)"],seealso:["square","sqrt","cube","multiply"]},ceil$1={name:"ceil",category:"Arithmetic",syntax:["ceil(x)"],description:"Round a value towards plus infinity. If x is complex, both real and imaginary part are rounded towards plus infinity.",examples:["ceil(3.2)","ceil(3.8)","ceil(-4.2)"],seealso:["floor","fix","round"]},cube$1={name:"cube",category:"Arithmetic",syntax:["cube(x)"],description:"Compute the cube of a value. The cube of x is x * x * x.",examples:["cube(2)","2^3","2 * 2 * 2"],seealso:["multiply","square","pow"]},divide$2={name:"divide",category:"Operators",syntax:["x / y","divide(x, y)"],description:"Divide two values.",examples:["a = 2 / 3","a * 3","4.5 / 2","3 + 4 / 2","(3 + 4) / 2","18 km / 4.5"],seealso:["multiply"]},dotDivide$1={name:"dotDivide",category:"Operators",syntax:["x ./ y","dotDivide(x, y)"],description:"Divide two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a ./ b"],seealso:["multiply","dotMultiply","divide"]},dotMultiply$1={name:"dotMultiply",category:"Operators",syntax:["x .* y","dotMultiply(x, y)"],description:"Multiply two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a .* b"],seealso:["multiply","divide","dotDivide"]},dotPow$1={name:"dotpow",category:"Operators",syntax:["x .^ y","dotpow(x, y)"],description:"Calculates the power of x to y element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","a .^ 2"],seealso:["pow"]},exp$2={name:"exp",category:"Arithmetic",syntax:["exp(x)"],description:"Calculate the exponent of a value.",examples:["exp(1.3)","e ^ 1.3","log(exp(1.3))","x = 2.4","(exp(i*x) == cos(x) + i*sin(x))   # Euler's formula"],seealso:["expm","expm1","pow","log"]},expm$1={name:"expm",category:"Arithmetic",syntax:["exp(x)"],description:"Compute the matrix exponential, expm(A) = e^A. The matrix must be square. Not to be confused with exp(a), which performs element-wise exponentiation.",examples:["expm([[0,2],[0,0]])"],seealso:["exp"]},expm1$1={name:"expm1",category:"Arithmetic",syntax:["expm1(x)"],description:"Calculate the value of subtracting 1 from the exponential value.",examples:["expm1(2)","pow(e, 2) - 1","log(expm1(2) + 1)"],seealso:["exp","pow","log"]},fix$1={name:"fix",category:"Arithmetic",syntax:["fix(x)"],description:"Round a value towards zero. If x is complex, both real and imaginary part are rounded towards zero.",examples:["fix(3.2)","fix(3.8)","fix(-4.2)","fix(-4.8)"],seealso:["ceil","floor","round"]},floor$1={name:"floor",category:"Arithmetic",syntax:["floor(x)"],description:"Round a value towards minus infinity.If x is complex, both real and imaginary part are rounded towards minus infinity.",examples:["floor(3.2)","floor(3.8)","floor(-4.2)"],seealso:["ceil","fix","round"]},gcd$1={name:"gcd",category:"Arithmetic",syntax:["gcd(a, b)","gcd(a, b, c, ...)"],description:"Compute the greatest common divisor.",examples:["gcd(8, 12)","gcd(-4, 6)","gcd(25, 15, -10)"],seealso:["lcm","xgcd"]},hypot$1={name:"hypot",category:"Arithmetic",syntax:["hypot(a, b, c, ...)","hypot([a, b, c, ...])"],description:"Calculate the hypotenusa of a list with values. ",examples:["hypot(3, 4)","sqrt(3^2 + 4^2)","hypot(-2)","hypot([3, 4, 5])"],seealso:["abs","norm"]},lcm$1={name:"lcm",category:"Arithmetic",syntax:["lcm(x, y)"],description:"Compute the least common multiple.",examples:["lcm(4, 6)","lcm(6, 21)","lcm(6, 21, 5)"],seealso:["gcd"]},log$3={name:"log",category:"Arithmetic",syntax:["log(x)","log(x, base)"],description:"Compute the logarithm of a value. If no base is provided, the natural logarithm of x is calculated. If base if provided, the logarithm is calculated for the specified base. log(x, base) is defined as log(x) / log(base).",examples:["log(3.5)","a = log(2.4)","exp(a)","10 ^ 4","log(10000, 10)","log(10000) / log(10)","b = log(1024, 2)","2 ^ b"],seealso:["exp","log1p","log2","log10"]},log2$1={name:"log2",category:"Arithmetic",syntax:["log2(x)"],description:"Calculate the 2-base of a value. This is the same as calculating `log(x, 2)`.",examples:["log2(0.03125)","log2(16)","log2(16) / log2(2)","pow(2, 4)"],seealso:["exp","log1p","log","log10"]},log1p$1={name:"log1p",category:"Arithmetic",syntax:["log1p(x)","log1p(x, base)"],description:"Calculate the logarithm of a `value+1`",examples:["log1p(2.5)","exp(log1p(1.4))","pow(10, 4)","log1p(9999, 10)","log1p(9999) / log(10)"],seealso:["exp","log","log2","log10"]},log10$2={name:"log10",category:"Arithmetic",syntax:["log10(x)"],description:"Compute the 10-base logarithm of a value.",examples:["log10(0.00001)","log10(10000)","10 ^ 4","log(10000) / log(10)","log(10000, 10)"],seealso:["exp","log"]},mod$2={name:"mod",category:"Operators",syntax:["x % y","x mod y","mod(x, y)"],description:"Calculates the modulus, the remainder of an integer division.",examples:["7 % 3","11 % 2","10 mod 4","isOdd(x) = x % 2","isOdd(2)","isOdd(3)"],seealso:["divide"]},multiply$2={name:"multiply",category:"Operators",syntax:["x * y","multiply(x, y)"],description:"multiply two values.",examples:["a = 2.1 * 3.4","a / 3.4","2 * 3 + 4","2 * (3 + 4)","3 * 2.1 km"],seealso:["divide"]},norm$1={name:"norm",category:"Arithmetic",syntax:["norm(x)","norm(x, p)"],description:"Calculate the norm of a number, vector or matrix.",examples:["abs(-3.5)","norm(-3.5)","norm(3 - 4i)","norm([1, 2, -3], Infinity)","norm([1, 2, -3], -Infinity)","norm([3, 4], 2)","norm([[1, 2], [3, 4]], 1)",'norm([[1, 2], [3, 4]], "inf")','norm([[1, 2], [3, 4]], "fro")']},nthRoot$1={name:"nthRoot",category:"Arithmetic",syntax:["nthRoot(a)","nthRoot(a, root)"],description:'Calculate the nth root of a value. The principal nth root of a positive real number A, is the positive real solution of the equation "x^root = A".',examples:["4 ^ 3","nthRoot(64, 3)","nthRoot(9, 2)","sqrt(9)"],seealso:["sqrt","pow"]},pow$2={name:"pow",category:"Operators",syntax:["x ^ y","pow(x, y)"],description:"Calculates the power of x to y, x^y.",examples:["2^3","2*2*2","1 + e ^ (pi * i)"],seealso:["multiply"]},round$2={name:"round",category:"Arithmetic",syntax:["round(x)","round(x, n)"],description:"round a value towards the nearest integer.If x is complex, both real and imaginary part are rounded towards the nearest integer. When n is specified, the value is rounded to n decimals.",examples:["round(3.2)","round(3.8)","round(-4.2)","round(-4.8)","round(pi, 3)","round(123.45678, 2)"],seealso:["ceil","floor","fix"]},sign$4={name:"sign",category:"Arithmetic",syntax:["sign(x)"],description:"Compute the sign of a value. The sign of a value x is 1 when x>1, -1 when x<0, and 0 when x=0.",examples:["sign(3.5)","sign(-4.2)","sign(0)"],seealso:["abs"]},sqrt$2={name:"sqrt",category:"Arithmetic",syntax:["sqrt(x)"],description:"Compute the square root value. If x = y * y, then y is the square root of x.",examples:["sqrt(25)","5 * 5","sqrt(-1)"],seealso:["square","sqrtm","multiply"]},sqrtm$1={name:"sqrtm",category:"Arithmetic",syntax:["sqrtm(x)"],description:"Calculate the principal square root of a square matrix. The principal square root matrix `X` of another matrix `A` is such that `X * X = A`.",examples:["sqrtm([[1, 2], [3, 4]])"],seealso:["sqrt","abs","square","multiply"]},square$1={name:"square",category:"Arithmetic",syntax:["square(x)"],description:"Compute the square of a value. The square of x is x * x.",examples:["square(3)","sqrt(9)","3^2","3 * 3"],seealso:["multiply","pow","sqrt","cube"]},subtract$2={name:"subtract",category:"Operators",syntax:["x - y","subtract(x, y)"],description:"subtract two values.",examples:["a = 5.3 - 2","a + 2","2/3 - 1/6","2 * 3 - 3","2.1 km - 500m"],seealso:["add"]},unaryMinus$1={name:"unaryMinus",category:"Operators",syntax:["-x","unaryMinus(x)"],description:"Inverse the sign of a value. Converts booleans and strings to numbers.",examples:["-4.5","-(-5.6)",'-"22"'],seealso:["add","subtract","unaryPlus"]},unaryPlus$1={name:"unaryPlus",category:"Operators",syntax:["+x","unaryPlus(x)"],description:"Converts booleans and strings to numbers.",examples:["+true",'+"2"'],seealso:["add","subtract","unaryMinus"]},xgcd$1={name:"xgcd",category:"Arithmetic",syntax:["xgcd(a, b)"],description:"Calculate the extended greatest common divisor for two values. The result is an array [d, x, y] with 3 entries, where d is the greatest common divisor, and d = x * a + y * b.",examples:["xgcd(8, 12)","gcd(8, 12)","xgcd(36163, 21199)"],seealso:["gcd","lcm"]},bitAnd$2={name:"bitAnd",category:"Bitwise",syntax:["x & y","bitAnd(x, y)"],description:"Bitwise AND operation. Performs the logical AND operation on each pair of the corresponding bits of the two given values by multiplying them. If both bits in the compared position are 1, the bit in the resulting binary representation is 1, otherwise, the result is 0",examples:["5 & 3","bitAnd(53, 131)","[1, 12, 31] & 42"],seealso:["bitNot","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitNot$2={name:"bitNot",category:"Bitwise",syntax:["~x","bitNot(x)"],description:"Bitwise NOT operation. Performs a logical negation on each bit of the given value. Bits that are 0 become 1, and those that are 1 become 0.",examples:["~1","~2","bitNot([2, -3, 4])"],seealso:["bitAnd","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitOr$2={name:"bitOr",category:"Bitwise",syntax:["x | y","bitOr(x, y)"],description:"Bitwise OR operation. Performs the logical inclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if the first bit is 1 or the second bit is 1 or both bits are 1, otherwise, the result is 0.",examples:["5 | 3","bitOr([1, 2, 3], 4)"],seealso:["bitAnd","bitNot","bitXor","leftShift","rightArithShift","rightLogShift"]},bitXor$2={name:"bitXor",category:"Bitwise",syntax:["bitXor(x, y)"],description:"Bitwise XOR operation, exclusive OR. Performs the logical exclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if only the first bit is 1 or only the second bit is 1, but will be 0 if both are 0 or both are 1.",examples:["bitOr(1, 2)","bitXor([2, 3, 4], 4)"],seealso:["bitAnd","bitNot","bitOr","leftShift","rightArithShift","rightLogShift"]},leftShift$2={name:"leftShift",category:"Bitwise",syntax:["x << y","leftShift(x, y)"],description:"Bitwise left logical shift of a value x by y number of bits.",examples:["4 << 1","8 >> 1"],seealso:["bitAnd","bitNot","bitOr","bitXor","rightArithShift","rightLogShift"]},rightArithShift$2={name:"rightArithShift",category:"Bitwise",syntax:["x >> y","rightArithShift(x, y)"],description:"Bitwise right arithmetic shift of a value x by y number of bits.",examples:["8 >> 1","4 << 1","-12 >> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightLogShift"]},rightLogShift$1={name:"rightLogShift",category:"Bitwise",syntax:["x >>> y","rightLogShift(x, y)"],description:"Bitwise right logical shift of a value x by y number of bits.",examples:["8 >>> 1","4 << 1","-12 >>> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightArithShift"]},bellNumbers$1={name:"bellNumbers",category:"Combinatorics",syntax:["bellNumbers(n)"],description:"The Bell Numbers count the number of partitions of a set. A partition is a pairwise disjoint subset of S whose union is S. `bellNumbers` only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["bellNumbers(3)","bellNumbers(8)"],seealso:["stirlingS2"]},catalan$1={name:"catalan",category:"Combinatorics",syntax:["catalan(n)"],description:"The Catalan Numbers enumerate combinatorial structures of many different types. catalan only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["catalan(3)","catalan(8)"],seealso:["bellNumbers"]},composition$1={name:"composition",category:"Combinatorics",syntax:["composition(n, k)"],description:"The composition counts of n into k parts. composition only takes integer arguments. The following condition must be enforced: k <= n.",examples:["composition(5, 3)"],seealso:["combinations"]},stirlingS2$1={name:"stirlingS2",category:"Combinatorics",syntax:["stirlingS2(n, k)"],description:"he Stirling numbers of the second kind, counts the number of ways to partition a set of n labelled objects into k nonempty unlabelled subsets. `stirlingS2` only takes integer arguments. The following condition must be enforced: k <= n. If n = k or k = 1, then s(n,k) = 1.",examples:["stirlingS2(5, 3)"],seealso:["bellNumbers"]},config$1={name:"config",category:"Core",syntax:["config()","config(options)"],description:"Get configuration or change configuration.",examples:["config()","1/3 + 1/4",'config({number: "Fraction"})',"1/3 + 1/4"],seealso:[]},_import={name:"import",category:"Core",syntax:["import(functions)","import(functions, options)"],description:"Import functions or constants from an object.",examples:["import({myFn: f(x)=x^2, myConstant: 32 })","myFn(2)","myConstant"],seealso:[]},typed={name:"typed",category:"Core",syntax:["typed(signatures)","typed(name, signatures)"],description:"Create a typed function.",examples:['double = typed({ "number, number": f(x)=x+x })',"double(2)",'double("hello")'],seealso:[]},arg$1={name:"arg",category:"Complex",syntax:["arg(x)"],description:"Compute the argument of a complex value. If x = a+bi, the argument is computed as atan2(b, a).",examples:["arg(2 + 2i)","atan2(3, 2)","arg(2 + 3i)"],seealso:["re","im","conj","abs"]},conj$2={name:"conj",category:"Complex",syntax:["conj(x)"],description:"Compute the complex conjugate of a complex value. If x = a+bi, the complex conjugate is a-bi.",examples:["conj(2 + 3i)","conj(2 - 3i)","conj(-5.2i)"],seealso:["re","im","abs","arg"]},re$2={name:"re",category:"Complex",syntax:["re(x)"],description:"Get the real part of a complex number.",examples:["re(2 + 3i)","im(2 + 3i)","re(-5.2i)","re(2.4)"],seealso:["im","conj","abs","arg"]},im$2={name:"im",category:"Complex",syntax:["im(x)"],description:"Get the imaginary part of a complex number.",examples:["im(2 + 3i)","re(2 + 3i)","im(-5.2i)","im(2.4)"],seealso:["re","conj","abs","arg"]},_eval$1={name:"eval",category:"Expression",syntax:["eval(expression)","eval([expr1, expr2, expr3, ...])"],description:"Evaluate an expression or an array with expressions.",examples:['eval("2 + 3")','eval("sqrt(" + 4 + ")")'],seealso:[]},help$1={name:"help",category:"Expression",syntax:["help(object)","help(string)"],description:"Display documentation on a function or data type.",examples:["help(sqrt)",'help("complex")'],seealso:[]},distance$1={name:"distance",category:"Geometry",syntax:["distance([x1, y1], [x2, y2])","distance([[x1, y1], [x2, y2])"],description:"Calculates the Euclidean distance between two points.",examples:["distance([0,0], [4,4])","distance([[0,0], [4,4]])"],seealso:[]},intersect$1={name:"intersect",category:"Geometry",syntax:["intersect(expr1, expr2, expr3, expr4)","intersect(expr1, expr2, expr3)"],description:"Computes the intersection point of lines and/or planes.",examples:["intersect([0, 0], [10, 10], [10, 0], [0, 10])","intersect([1, 0, 1],  [4, -2, 2], [1, 1, 1, 6])"],seealso:[]},and$1={name:"and",category:"Logical",syntax:["x and y","and(x, y)"],description:"Logical and. Test whether two values are both defined with a nonzero/nonempty value.",examples:["true and false","true and true","2 and 4"],seealso:["not","or","xor"]},not$1={name:"not",category:"Logical",syntax:["not x","not(x)"],description:"Logical not. Flips the boolean value of given argument.",examples:["not true","not false","not 2","not 0"],seealso:["and","or","xor"]},or$1={name:"or",category:"Logical",syntax:["x or y","or(x, y)"],description:"Logical or. Test if at least one value is defined with a nonzero/nonempty value.",examples:["true or false","false or false","0 or 4"],seealso:["not","and","xor"]},xor$1={name:"xor",category:"Logical",syntax:["x xor y","xor(x, y)"],description:"Logical exclusive or, xor. Test whether one and only one value is defined with a nonzero/nonempty value.",examples:["true xor false","false xor false","true xor true","0 xor 4"],seealso:["not","and","or"]},concat$1={name:"concat",category:"Matrix",syntax:["concat(A, B, C, ...)","concat(A, B, C, ..., dim)"],description:"Concatenate matrices. By default, the matrices are concatenated by the last dimension. The dimension on which to concatenate can be provided as last argument.",examples:["A = [1, 2; 5, 6]","B = [3, 4; 7, 8]","concat(A, B)","concat(A, B, 1)","concat(A, B, 2)"],seealso:["det","diag","eye","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},cross$1={name:"cross",category:"Matrix",syntax:["cross(A, B)"],description:"Calculate the cross product for two vectors in three dimensional space.",examples:["cross([1, 1, 0],  [0, 1, 1])","cross([3, -3, 1], [4, 9, 2])","cross([2, 3, 4],  [5, 6, 7])"],seealso:["multiply","dot"]},det$1={name:"det",category:"Matrix",syntax:["det(x)"],description:"Calculate the determinant of a matrix",examples:["det([1, 2; 3, 4])","det([-2, 2, 3; -1, 1, 3; 2, 0, -1])"],seealso:["concat","diag","eye","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diag$1={name:"diag",category:"Matrix",syntax:["diag(x)","diag(x, k)"],description:"Create a diagonal matrix or retrieve the diagonal of a matrix. When x is a vector, a matrix with the vector values on the diagonal will be returned. When x is a matrix, a vector with the diagonal values of the matrix is returned. When k is provided, the k-th diagonal will be filled in or retrieved, if k is positive, the values are placed on the super diagonal. When k is negative, the values are placed on the sub diagonal.",examples:["diag(1:3)","diag(1:3, 1)","a = [1, 2, 3; 4, 5, 6; 7, 8, 9]","diag(a)"],seealso:["concat","det","eye","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},dot$1={name:"dot",category:"Matrix",syntax:["dot(A, B)","A * B"],description:"Calculate the dot product of two vectors. The dot product of A = [a1, a2, a3, ..., an] and B = [b1, b2, b3, ..., bn] is defined as dot(A, B) = a1 * b1 + a2 * b2 + a3 * b3 + ... + an * bn",examples:["dot([2, 4, 1], [2, 2, 3])","[2, 4, 1] * [2, 2, 3]"],seealso:["multiply","cross"]},eye$1={name:"eye",category:"Matrix",syntax:["eye(n)","eye(m, n)","eye([m, n])"],description:"Returns the identity matrix with size m-by-n. The matrix has ones on the diagonal and zeros elsewhere.",examples:["eye(3)","eye(3, 5)","a = [1, 2, 3; 4, 5, 6]","eye(size(a))"],seealso:["concat","det","diag","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},filter$3={name:"filter",category:"Matrix",syntax:["filter(x, test)"],description:"Filter items in a matrix.",examples:["isPositive(x) = x > 0","filter([6, -2, -1, 4, 3], isPositive)","filter([6, -2, 0, 1, 0], x != 0)"],seealso:["sort","map","forEach"]},flatten$j={name:"flatten",category:"Matrix",syntax:["flatten(x)"],description:"Flatten a multi dimensional matrix into a single dimensional matrix.",examples:["a = [1, 2, 3; 4, 5, 6]","size(a)","b = flatten(a)","size(b)"],seealso:["concat","resize","size","squeeze"]},forEach$4={name:"forEach",category:"Matrix",syntax:["forEach(x, callback)"],description:"Iterates over all elements of a matrix/array, and executes the given callback function.",examples:["forEach([1, 2, 3], function(val) { console.log(val) })"],seealso:["map","sort","filter"]},inv$1={name:"inv",category:"Matrix",syntax:["inv(x)"],description:"Calculate the inverse of a matrix",examples:["inv([1, 2; 3, 4])","inv(4)","1 / 4"],seealso:["concat","det","diag","eye","ones","range","size","squeeze","subset","trace","transpose","zeros"]},kron$1={name:"kron",category:"Matrix",syntax:["kron(x, y)"],description:"Calculates the kronecker product of 2 matrices or vectors.",examples:["kron([[1, 0], [0, 1]], [[1, 2], [3, 4]])","kron([1,1], [2,3,4])"],seealso:["multiply","dot","cross"]},map$8={name:"map",category:"Matrix",syntax:["map(x, callback)"],description:"Create a new matrix or array with the results of the callback function executed on each entry of the matrix/array.",examples:["map([1, 2, 3], square)"],seealso:["filter","forEach"]},ones$1={name:"ones",category:"Matrix",syntax:["ones(m)","ones(m, n)","ones(m, n, p, ...)","ones([m])","ones([m, n])","ones([m, n, p, ...])"],description:"Create a matrix containing ones.",examples:["ones(3)","ones(3, 5)","ones([2,3]) * 4.5","a = [1, 2, 3; 4, 5, 6]","ones(size(a))"],seealso:["concat","det","diag","eye","inv","range","size","squeeze","subset","trace","transpose","zeros"]},partitionSelect$1={name:"partitionSelect",category:"Matrix",syntax:["partitionSelect(x, k)","partitionSelect(x, k, compare)"],description:"Partition-based selection of an array or 1D matrix. Will find the kth smallest value, and mutates the input array. Uses Quickselect.",examples:["partitionSelect([5, 10, 1], 2)",'partitionSelect(["C", "B", "A", "D"], 1)'],seealso:["sort"]},range$2={name:"range",category:"Type",syntax:["start:end","start:step:end","range(start, end)","range(start, end, step)","range(string)"],description:"Create a range. Lower bound of the range is included, upper bound is excluded.",examples:["1:5","3:-1:-3","range(3, 7)","range(0, 12, 2)",'range("4:10")',"a = [1, 2, 3, 4; 5, 6, 7, 8]","a[1:2, 1:2]"],seealso:["concat","det","diag","eye","inv","ones","size","squeeze","subset","trace","transpose","zeros"]},resize$3={name:"resize",category:"Matrix",syntax:["resize(x, size)","resize(x, size, defaultValue)"],description:"Resize a matrix.",examples:["resize([1,2,3,4,5], [3])","resize([1,2,3], [5])","resize([1,2,3], [5], -1)","resize(2, [2, 3])",'resize("hello", [8], "!")'],seealso:["size","subset","squeeze","reshape"]},reshape$1={name:"reshape",category:"Matrix",syntax:["reshape(x, sizes)"],description:"Reshape a multi dimensional array to fit the specified dimensions.",examples:["reshape([1, 2, 3, 4, 5, 6], [2, 3])","reshape([[1, 2], [3, 4]], [1, 4])","reshape([[1, 2], [3, 4]], [4])"],seealso:["size","squeeze","resize"]},size$7={name:"size",category:"Matrix",syntax:["size(x)"],description:"Calculate the size of a matrix.",examples:["size(2.3)",'size("hello world")',"a = [1, 2; 3, 4; 5, 6]","size(a)","size(1:6)"],seealso:["concat","det","diag","eye","inv","ones","range","squeeze","subset","trace","transpose","zeros"]},sort$1={name:"sort",category:"Matrix",syntax:["sort(x)","sort(x, compare)"],description:'Sort the items in a matrix. Compare can be a string "asc", "desc", "natural", or a custom sort function.',examples:["sort([5, 10, 1])",'sort(["C", "B", "A", "D"])',"sortByLength(a, b) = size(a)[1] - size(b)[1]",'sort(["Langdon", "Tom", "Sara"], sortByLength)','sort(["10", "1", "2"], "natural")'],seealso:["map","filter","forEach"]},squeeze$1={name:"squeeze",category:"Matrix",syntax:["squeeze(x)"],description:"Remove inner and outer singleton dimensions from a matrix.",examples:["a = zeros(3,2,1)","size(squeeze(a))","b = zeros(1,1,3)","size(squeeze(b))"],seealso:["concat","det","diag","eye","inv","ones","range","size","subset","trace","transpose","zeros"]},subset$1={name:"subset",category:"Matrix",syntax:["value(index)","value(index) = replacement","subset(value, [index])","subset(value, [index], replacement)"],description:"Get or set a subset of a matrix or string. Indexes are one-based. Both the ranges lower-bound and upper-bound are included.",examples:["d = [1, 2; 3, 4]","e = []","e[1, 1:2] = [5, 6]","e[2, :] = [7, 8]","f = d * e","f[2, 1]","f[:, 1]"],seealso:["concat","det","diag","eye","inv","ones","range","size","squeeze","trace","transpose","zeros"]},trace$1={name:"trace",category:"Matrix",syntax:["trace(A)"],description:"Calculate the trace of a matrix: the sum of the elements on the main diagonal of a square matrix.",examples:["A = [1, 2, 3; -1, 2, 3; 2, 0, 3]","trace(A)"],seealso:["concat","det","diag","eye","inv","ones","range","size","squeeze","subset","transpose","zeros"]},transpose$1={name:"transpose",category:"Matrix",syntax:["x'","transpose(x)"],description:"Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","transpose(a)"],seealso:["concat","det","diag","eye","inv","ones","range","size","squeeze","subset","trace","zeros"]},zeros$1={name:"zeros",category:"Matrix",syntax:["zeros(m)","zeros(m, n)","zeros(m, n, p, ...)","zeros([m])","zeros([m, n])","zeros([m, n, p, ...])"],description:"Create a matrix containing zeros.",examples:["zeros(3)","zeros(3, 5)","a = [1, 2, 3; 4, 5, 6]","zeros(size(a))"],seealso:["concat","det","diag","eye","inv","ones","range","size","squeeze","subset","trace","transpose"]},combinations$1={name:"combinations",category:"Probability",syntax:["combinations(n, k)"],description:"Compute the number of combinations of n items taken k at a time",examples:["combinations(7, 5)"],seealso:["permutations","factorial"]},factorial$2={name:"factorial",category:"Probability",syntax:["n!","factorial(n)"],description:"Compute the factorial of a value",examples:["5!","5 * 4 * 3 * 2 * 1","3!"],seealso:["combinations","permutations","gamma"]},gamma$2={name:"gamma",category:"Probability",syntax:["gamma(n)"],description:"Compute the gamma function. For small values, the Lanczos approximation is used, and for large values the extended Stirling approximation.",examples:["gamma(4)","3!","gamma(1/2)","sqrt(pi)"],seealso:["factorial"]},kldivergence$1={name:"kldivergence",category:"Probability",syntax:["kldivergence(x, y)"],description:"Calculate the Kullback-Leibler (KL) divergence  between two distributions.",examples:["kldivergence([0.7,0.5,0.4], [0.2,0.9,0.5])"],seealso:[]},multinomial$1={name:"multinomial",category:"Probability",syntax:["multinomial(A)"],description:"Multinomial Coefficients compute the number of ways of picking a1, a2, ..., ai unordered outcomes from `n` possibilities. multinomial takes one array of integers as an argument. The following condition must be enforced: every ai > 0.",examples:["multinomial([1, 2, 1])"],seealso:["combinations","factorial"]},permutations$1={name:"permutations",category:"Probability",syntax:["permutations(n)","permutations(n, k)"],description:"Compute the number of permutations of n items taken k at a time",examples:["permutations(5)","permutations(5, 3)"],seealso:["combinations","factorial"]},pickRandom$1={name:"pickRandom",category:"Probability",syntax:["pickRandom(array)","pickRandom(array, number)","pickRandom(array, weights)","pickRandom(array, number, weights)","pickRandom(array, weights, number)"],description:"Pick a random entry from a given array.",examples:["pickRandom(0:10)","pickRandom([1, 3, 1, 6])","pickRandom([1, 3, 1, 6], 2)","pickRandom([1, 3, 1, 6], [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], 2, [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], [2, 3, 2, 1], 2)"],seealso:["random","randomInt"]},random$2={name:"random",category:"Probability",syntax:["random()","random(max)","random(min, max)","random(size)","random(size, max)","random(size, min, max)"],description:"Return a random number.",examples:["random()","random(10, 20)","random([2, 3])"],seealso:["pickRandom","randomInt"]},randomInt$1={name:"randomInt",category:"Probability",syntax:["randomInt(max)","randomInt(min, max)","randomInt(size)","randomInt(size, max)","randomInt(size, min, max)"],description:"Return a random integer number",examples:["randomInt(10, 20)","randomInt([2, 3], 10)"],seealso:["pickRandom","random"]},compare$1={name:"compare",category:"Relational",syntax:["compare(x, y)"],description:"Compare two values. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compare(2, 3)","compare(3, 2)","compare(2, 2)","compare(5cm, 40mm)","compare(2, [1, 2, 3])"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compareNatural","compareText"]},compareNatural$1={name:"compareNatural",category:"Relational",syntax:["compareNatural(x, y)"],description:"Compare two values of any type in a deterministic, natural way. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compareNatural(2, 3)","compareNatural(3, 2)","compareNatural(2, 2)","compareNatural(5cm, 40mm)",'compareNatural("2", "10")',"compareNatural(2 + 3i, 2 + 4i)","compareNatural([1, 2, 4], [1, 2, 3])","compareNatural([1, 5], [1, 2, 3])","compareNatural([1, 2], [1, 2])","compareNatural({a: 2}, {a: 4})"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare","compareText"]},compareText$1={name:"compareText",category:"Relational",syntax:["compareText(x, y)"],description:"Compare two strings lexically. Comparison is case sensitive. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:['compareText("B", "A")','compareText("A", "B")','compareText("A", "A")','compareText("2", "10")','compare("2", "10")',"compare(2, 10)",'compareNatural("2", "10")','compareText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural"]},deepEqual$2={name:"deepEqual",category:"Relational",syntax:["deepEqual(x, y)"],description:"Check equality of two matrices element wise. Returns true if the size of both matrices is equal and when and each of the elements are equal.",examples:["deepEqual([1,3,4], [1,3,4])","deepEqual([1,3,4], [1,3])"],seealso:["equal","unequal","smaller","larger","smallerEq","largerEq","compare"]},equal$2={name:"equal",category:"Relational",syntax:["x == y","equal(x, y)"],description:"Check equality of two values. Returns true if the values are equal, and false if not.",examples:["2+2 == 3","2+2 == 4","a = 3.2","b = 6-2.8","a == b","50cm == 0.5m"],seealso:["unequal","smaller","larger","smallerEq","largerEq","compare","deepEqual","equalText"]},equalText$1={name:"equalText",category:"Relational",syntax:["equalText(x, y)"],description:"Check equality of two strings. Comparison is case sensitive. Returns true if the values are equal, and false if not.",examples:['equalText("Hello", "Hello")','equalText("a", "A")','equal("2e3", "2000")','equalText("2e3", "2000")','equalText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural","compareText","equal"]},larger={name:"larger",category:"Relational",syntax:["x > y","larger(x, y)"],description:"Check if value x is larger than y. Returns true if x is larger than y, and false if not.",examples:["2 > 3","5 > 2*2","a = 3.3","b = 6-2.8","(a > b)","(b < a)","5 cm > 2 inch"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare"]},largerEq$1={name:"largerEq",category:"Relational",syntax:["x >= y","largerEq(x, y)"],description:"Check if value x is larger or equal to y. Returns true if x is larger or equal to y, and false if not.",examples:["2 >= 1+1","2 > 1+1","a = 3.2","b = 6-2.8","(a >= b)"],seealso:["equal","unequal","smallerEq","smaller","compare"]},smaller={name:"smaller",category:"Relational",syntax:["x < y","smaller(x, y)"],description:"Check if value x is smaller than value y. Returns true if x is smaller than y, and false if not.",examples:["2 < 3","5 < 2*2","a = 3.3","b = 6-2.8","(a < b)","5 cm < 2 inch"],seealso:["equal","unequal","larger","smallerEq","largerEq","compare"]},smallerEq$1={name:"smallerEq",category:"Relational",syntax:["x <= y","smallerEq(x, y)"],description:"Check if value x is smaller or equal to value y. Returns true if x is smaller than y, and false if not.",examples:["2 <= 1+1","2 < 1+1","a = 3.2","b = 6-2.8","(a <= b)"],seealso:["equal","unequal","larger","smaller","largerEq","compare"]},unequal$1={name:"unequal",category:"Relational",syntax:["x != y","unequal(x, y)"],description:"Check unequality of two values. Returns true if the values are unequal, and false if they are equal.",examples:["2+2 != 3","2+2 != 4","a = 3.2","b = 6-2.8","a != b","50cm != 0.5m","5 cm != 2 inch"],seealso:["equal","smaller","larger","smallerEq","largerEq","compare","deepEqual"]},setCartesian$1={name:"setCartesian",category:"Set",syntax:["setCartesian(set1, set2)"],description:"Create the cartesian product of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setCartesian([1, 2], [3, 4])"],seealso:["setUnion","setIntersect","setDifference","setPowerset"]},setDifference$1={name:"setDifference",category:"Set",syntax:["setDifference(set1, set2)"],description:"Create the difference of two (multi)sets: every element of set1, that is not the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setDifference([1, 2, 3, 4], [3, 4, 5, 6])","setDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setSymDifference"]},setDistinct$1={name:"setDistinct",category:"Set",syntax:["setDistinct(set)"],description:"Collect the distinct elements of a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setDistinct([1, 1, 1, 2, 2, 3])"],seealso:["setMultiplicity"]},setIntersect$1={name:"setIntersect",category:"Set",syntax:["setIntersect(set1, set2)"],description:"Create the intersection of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIntersect([1, 2, 3, 4], [3, 4, 5, 6])","setIntersect([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setDifference"]},setIsSubset$1={name:"setIsSubset",category:"Set",syntax:["setIsSubset(set1, set2)"],description:"Check whether a (multi)set is a subset of another (multi)set: every element of set1 is the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIsSubset([1, 2], [3, 4, 5, 6])","setIsSubset([3, 4], [3, 4, 5, 6])"],seealso:["setUnion","setIntersect","setDifference"]},setMultiplicity$1={name:"setMultiplicity",category:"Set",syntax:["setMultiplicity(element, set)"],description:"Count the multiplicity of an element in a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setMultiplicity(1, [1, 2, 2, 4])","setMultiplicity(2, [1, 2, 2, 4])"],seealso:["setDistinct","setSize"]},setPowerset$1={name:"setPowerset",category:"Set",syntax:["setPowerset(set)"],description:"Create the powerset of a (multi)set: the powerset contains very possible subsets of a (multi)set. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setPowerset([1, 2, 3])"],seealso:["setCartesian"]},setSize$1={name:"setSize",category:"Set",syntax:["setSize(set)","setSize(set, unique)"],description:'Count the number of elements of a (multi)set. When the second parameter "unique" is true, count only the unique values. A multi-dimension array will be converted to a single-dimension array before the operation.',examples:["setSize([1, 2, 2, 4])","setSize([1, 2, 2, 4], true)"],seealso:["setUnion","setIntersect","setDifference"]},setSymDifference$1={name:"setSymDifference",category:"Set",syntax:["setSymDifference(set1, set2)"],description:"Create the symmetric difference of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setSymDifference([1, 2, 3, 4], [3, 4, 5, 6])","setSymDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setDifference"]},setUnion$1={name:"setUnion",category:"Set",syntax:["setUnion(set1, set2)"],description:"Create the union of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setUnion([1, 2, 3, 4], [3, 4, 5, 6])","setUnion([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setIntersect","setDifference"]},erf$2={name:"erf",category:"Special",syntax:["erf(x)"],description:"Compute the erf function of a value using a rational Chebyshev approximations for different intervals of x",examples:["erf(0.2)","erf(-0.5)","erf(4)"],seealso:[]},mad$1={name:"mad",category:"Statistics",syntax:["mad(a, b, c, ...)","mad(A)"],description:"Compute the median absolute deviation of a matrix or a list with values. The median absolute deviation is defined as the median of the absolute deviations from the median.",examples:["mad(10, 20, 30)","mad([1, 2, 3])"],seealso:["mean","median","std","abs"]},max$2={name:"max",category:"Statistics",syntax:["max(a, b, c, ...)","max(A)","max(A, dim)"],description:"Compute the maximum value of a list of values.",examples:["max(2, 3, 4, 1)","max([2, 3, 4, 1])","max([2, 5; 4, 3])","max([2, 5; 4, 3], 1)","max([2, 5; 4, 3], 2)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["mean","median","min","prod","std","sum","var"]},mean$1={name:"mean",category:"Statistics",syntax:["mean(a, b, c, ...)","mean(A)","mean(A, dim)"],description:"Compute the arithmetic mean of a list of values.",examples:["mean(2, 3, 4, 1)","mean([2, 3, 4, 1])","mean([2, 5; 4, 3])","mean([2, 5; 4, 3], 1)","mean([2, 5; 4, 3], 2)","mean([1.0, 2.7, 3.2, 4.0])"],seealso:["max","median","min","prod","std","sum","var"]},median$1={name:"median",category:"Statistics",syntax:["median(a, b, c, ...)","median(A)"],description:"Compute the median of all values. The values are sorted and the middle value is returned. In case of an even number of values, the average of the two middle values is returned.",examples:["median(5, 2, 7)","median([3, -1, 5, 7])"],seealso:["max","mean","min","prod","std","sum","var","quantileSeq"]},min$2={name:"min",category:"Statistics",syntax:["min(a, b, c, ...)","min(A)","min(A, dim)"],description:"Compute the minimum value of a list of values.",examples:["min(2, 3, 4, 1)","min([2, 3, 4, 1])","min([2, 5; 4, 3])","min([2, 5; 4, 3], 1)","min([2, 5; 4, 3], 2)","min(2.7, 7.1, -4.5, 2.0, 4.1)","max(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["max","mean","median","prod","std","sum","var"]},mode$1={name:"mode",category:"Statistics",syntax:["mode(a, b, c, ...)","mode(A)","mode(A, a, b, B, c, ...)"],description:"Computes the mode of all values as an array. In case mode being more than one, multiple values are returned in an array.",examples:["mode(2, 1, 4, 3, 1)","mode([1, 2.7, 3.2, 4, 2.7])","mode(1, 4, 6, 1, 6)"],seealso:["max","mean","min","median","prod","std","sum","var"]},prod$1={name:"prod",category:"Statistics",syntax:["prod(a, b, c, ...)","prod(A)"],description:"Compute the product of all values.",examples:["prod(2, 3, 4)","prod([2, 3, 4])","prod([2, 5; 4, 3])"],seealso:["max","mean","min","median","min","std","sum","var"]},quantileSeq$1={name:"quantileSeq",category:"Statistics",syntax:["quantileSeq(A, prob[, sorted])","quantileSeq(A, [prob1, prob2, ...][, sorted])","quantileSeq(A, N[, sorted])"],description:"Compute the prob order quantile of a matrix or a list with values. The sequence is sorted and the middle value is returned. Supported types of sequence values are: Number, BigNumber, Unit Supported types of probablity are: Number, BigNumber. \n\nIn case of a (multi dimensional) array or matrix, the prob order quantile of all elements will be calculated.",examples:["quantileSeq([3, -1, 5, 7], 0.5)","quantileSeq([3, -1, 5, 7], [1/3, 2/3])","quantileSeq([3, -1, 5, 7], 2)","quantileSeq([-1, 3, 5, 7], 0.5, true)"],seealso:["mean","median","min","max","prod","std","sum","var"]},std$1={name:"std",category:"Statistics",syntax:["std(a, b, c, ...)","std(A)","std(A, normalization)"],description:'Compute the standard deviation of all values, defined as std(A) = sqrt(var(A)). Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["std(2, 4, 6)","std([2, 4, 6, 8])",'std([2, 4, 6, 8], "uncorrected")','std([2, 4, 6, 8], "biased")',"std([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","min","prod","sum","var"]},sum$1={name:"sum",category:"Statistics",syntax:["sum(a, b, c, ...)","sum(A)"],description:"Compute the sum of all values.",examples:["sum(2, 3, 4, 1)","sum([2, 3, 4, 1])","sum([2, 5; 4, 3])"],seealso:["max","mean","median","min","prod","std","sum","var"]},_var$1={name:"var",category:"Statistics",syntax:["var(a, b, c, ...)","var(A)","var(A, normalization)"],description:'Compute the variance of all values. Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["var(2, 4, 6)","var([2, 4, 6, 8])",'var([2, 4, 6, 8], "uncorrected")','var([2, 4, 6, 8], "biased")',"var([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","min","prod","std","sum"]},acos$2={name:"acos",category:"Trigonometry",syntax:["acos(x)"],description:"Compute the inverse cosine of a value in radians.",examples:["acos(0.5)","acos(cos(2.3))"],seealso:["cos","atan","asin"]},acosh$2={name:"acosh",category:"Trigonometry",syntax:["acosh(x)"],description:"Calculate the hyperbolic arccos of a value, defined as `acosh(x) = ln(sqrt(x^2 - 1) + x)`.",examples:["acosh(1.5)"],seealso:["cosh","asinh","atanh"]},acot$2={name:"acot",category:"Trigonometry",syntax:["acot(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acot(0.5)","acot(cot(0.5))","acot(2)"],seealso:["cot","atan"]},acoth$2={name:"acoth",category:"Trigonometry",syntax:["acoth(x)"],description:"Calculate the hyperbolic arccotangent of a value, defined as `acoth(x) = (ln((x+1)/x) + ln(x/(x-1))) / 2`.",examples:["acoth(2)","acoth(0.5)"],seealso:["acsch","asech"]},acsc$2={name:"acsc",category:"Trigonometry",syntax:["acsc(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acsc(2)","acsc(csc(0.5))","acsc(0.5)"],seealso:["csc","asin","asec"]},acsch$2={name:"acsch",category:"Trigonometry",syntax:["acsch(x)"],description:"Calculate the hyperbolic arccosecant of a value, defined as `acsch(x) = ln(1/x + sqrt(1/x^2 + 1))`.",examples:["acsch(0.5)"],seealso:["asech","acoth"]},asec$2={name:"asec",category:"Trigonometry",syntax:["asec(x)"],description:"Calculate the inverse secant of a value.",examples:["asec(0.5)","asec(sec(0.5))","asec(2)"],seealso:["acos","acot","acsc"]},asech$2={name:"asech",category:"Trigonometry",syntax:["asech(x)"],description:"Calculate the inverse secant of a value.",examples:["asech(0.5)"],seealso:["acsch","acoth"]},asin$2={name:"asin",category:"Trigonometry",syntax:["asin(x)"],description:"Compute the inverse sine of a value in radians.",examples:["asin(0.5)","asin(sin(0.5))"],seealso:["sin","acos","atan"]},asinh$2={name:"asinh",category:"Trigonometry",syntax:["asinh(x)"],description:"Calculate the hyperbolic arcsine of a value, defined as `asinh(x) = ln(x + sqrt(x^2 + 1))`.",examples:["asinh(0.5)"],seealso:["acosh","atanh"]},atan$2={name:"atan",category:"Trigonometry",syntax:["atan(x)"],description:"Compute the inverse tangent of a value in radians.",examples:["atan(0.5)","atan(tan(0.5))"],seealso:["tan","acos","asin"]},atanh$2={name:"atanh",category:"Trigonometry",syntax:["atanh(x)"],description:"Calculate the hyperbolic arctangent of a value, defined as `atanh(x) = ln((1 + x)/(1 - x)) / 2`.",examples:["atanh(0.5)"],seealso:["acosh","asinh"]},atan2$2={name:"atan2",category:"Trigonometry",syntax:["atan2(y, x)"],description:"Computes the principal value of the arc tangent of y/x in radians.",examples:["atan2(2, 2) / pi","angle = 60 deg in rad","x = cos(angle)","y = sin(angle)","atan2(y, x)"],seealso:["sin","cos","tan"]},cos$2={name:"cos",category:"Trigonometry",syntax:["cos(x)"],description:"Compute the cosine of x in radians.",examples:["cos(2)","cos(pi / 4) ^ 2","cos(180 deg)","cos(60 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["acos","sin","tan"]},cosh$2={name:"cosh",category:"Trigonometry",syntax:["cosh(x)"],description:"Compute the hyperbolic cosine of x in radians.",examples:["cosh(0.5)"],seealso:["sinh","tanh","coth"]},cot$2={name:"cot",category:"Trigonometry",syntax:["cot(x)"],description:"Compute the cotangent of x in radians. Defined as 1/tan(x)",examples:["cot(2)","1 / tan(2)"],seealso:["sec","csc","tan"]},coth$2={name:"coth",category:"Trigonometry",syntax:["coth(x)"],description:"Compute the hyperbolic cotangent of x in radians.",examples:["coth(2)","1 / tanh(2)"],seealso:["sech","csch","tanh"]},csc$2={name:"csc",category:"Trigonometry",syntax:["csc(x)"],description:"Compute the cosecant of x in radians. Defined as 1/sin(x)",examples:["csc(2)","1 / sin(2)"],seealso:["sec","cot","sin"]},csch$2={name:"csch",category:"Trigonometry",syntax:["csch(x)"],description:"Compute the hyperbolic cosecant of x in radians. Defined as 1/sinh(x)",examples:["csch(2)","1 / sinh(2)"],seealso:["sech","coth","sinh"]},sec$2={name:"sec",category:"Trigonometry",syntax:["sec(x)"],description:"Compute the secant of x in radians. Defined as 1/cos(x)",examples:["sec(2)","1 / cos(2)"],seealso:["cot","csc","cos"]},sech$2={name:"sech",category:"Trigonometry",syntax:["sech(x)"],description:"Compute the hyperbolic secant of x in radians. Defined as 1/cosh(x)",examples:["sech(2)","1 / cosh(2)"],seealso:["coth","csch","cosh"]},sin$2={name:"sin",category:"Trigonometry",syntax:["sin(x)"],description:"Compute the sine of x in radians.",examples:["sin(2)","sin(pi / 4) ^ 2","sin(90 deg)","sin(30 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["asin","cos","tan"]},sinh$2={name:"sinh",category:"Trigonometry",syntax:["sinh(x)"],description:"Compute the hyperbolic sine of x in radians.",examples:["sinh(0.5)"],seealso:["cosh","tanh"]},tan$2={name:"tan",category:"Trigonometry",syntax:["tan(x)"],description:"Compute the tangent of x in radians.",examples:["tan(0.5)","sin(0.5) / cos(0.5)","tan(pi / 4)","tan(45 deg)"],seealso:["atan","sin","cos"]},tanh$2={name:"tanh",category:"Trigonometry",syntax:["tanh(x)"],description:"Compute the hyperbolic tangent of x in radians.",examples:["tanh(0.5)","sinh(0.5) / cosh(0.5)"],seealso:["sinh","cosh"]},to$1={name:"to",category:"Units",syntax:["x to unit","to(x, unit)"],description:"Change the unit of a value.",examples:["5 inch to cm","3.2kg to g","16 bytes in bits"],seealso:[]},clone$9={name:"clone",category:"Utils",syntax:["clone(x)"],description:"Clone a variable. Creates a copy of primitive variables,and a deep copy of matrices",examples:["clone(3.5)","clone(2 - 4i)","clone(45 deg)","clone([1, 2; 3, 4])",'clone("hello world")'],seealso:[]},format$8={name:"format",category:"Utils",syntax:["format(value)","format(value, precision)"],description:"Format a value of any type as string.",examples:["format(2.3)","format(3 - 4i)","format([])","format(pi, 3)"],seealso:["print"]},_isNaN$2={name:"isNaN",category:"Utils",syntax:["isNaN(x)"],description:"Test whether a value is NaN (not a number)",examples:["isNaN(2)","isNaN(0 / 0)","isNaN(NaN)","isNaN(Infinity)"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isInteger$q={name:"isInteger",category:"Utils",syntax:["isInteger(x)"],description:"Test whether a value is an integer number.",examples:["isInteger(2)","isInteger(3.5)","isInteger([3, 0.5, -2])"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isNegative$1={name:"isNegative",category:"Utils",syntax:["isNegative(x)"],description:"Test whether a value is negative: smaller than zero.",examples:["isNegative(2)","isNegative(0)","isNegative(-4)","isNegative([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isPositive","isZero"]},isNumeric$1={name:"isNumeric",category:"Utils",syntax:["isNumeric(x)"],description:"Test whether a value is a numeric value. Returns true when the input is a number, BigNumber, Fraction, or boolean.",examples:["isNumeric(2)","isNumeric(0)","isNumeric(bignumber(500))","isNumeric(fraction(0.125))",'isNumeric("3")',"isNumeric(2 + 3i)",'isNumeric([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN"]},isPositive$1={name:"isPositive",category:"Utils",syntax:["isPositive(x)"],description:"Test whether a value is positive: larger than zero.",examples:["isPositive(2)","isPositive(0)","isPositive(-4)","isPositive([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isPrime$1={name:"isPrime",category:"Utils",syntax:["isPrime(x)"],description:"Test whether a value is prime: has no divisors other than itself and one.",examples:["isPrime(3)","isPrime(-2)","isPrime([2, 17, 100])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isZero$1={name:"isZero",category:"Utils",syntax:["isZero(x)"],description:"Test whether a value is zero.",examples:["isZero(2)","isZero(0)","isZero(-4)","isZero([3, 0, -2, 0])"],seealso:["isInteger","isNumeric","isNegative","isPositive"]},_typeof$1={name:"typeof",category:"Utils",syntax:["typeof(x)"],description:"Get the type of a variable.",examples:["typeof(3.5)","typeof(2 - 4i)","typeof(45 deg)",'typeof("hello world")'],seealso:[]};function factory$3Q(t,n,r,a){var o={};return o.bignumber=bignumber,o.boolean=boolean_1,o.complex=complex$1,o.createUnit=createUnit$1,o.fraction=fraction,o.index=construction,o.matrix=matrix$3,o.number=number$1,o.sparse=sparse,o.splitUnit=splitUnit$1,o.string=string$3,o.unit=unit$3,o.e=e,o.E=e,o.false=_false,o.i=i,o[1/0]=_Infinity,o.LN2=LN2,o.LN10=LN10,o.LOG2E=LOG2E,o.LOG10E=LOG10E,o.NaN=_NaN,o.null=_null,o.pi=pi,o.PI=pi,o.phi=phi,o.SQRT1_2=SQRT1_2,o.SQRT2=SQRT2,o.tau=tau,o.true=_true,o.version=version$2,o.speedOfLight={description:"Speed of light in vacuum",examples:["speedOfLight"]},o.gravitationConstant={description:"Newtonian constant of gravitation",examples:["gravitationConstant"]},o.planckConstant={description:"Planck constant",examples:["planckConstant"]},o.reducedPlanckConstant={description:"Reduced Planck constant",examples:["reducedPlanckConstant"]},o.magneticConstant={description:"Magnetic constant (vacuum permeability)",examples:["magneticConstant"]},o.electricConstant={description:"Electric constant (vacuum permeability)",examples:["electricConstant"]},o.vacuumImpedance={description:"Characteristic impedance of vacuum",examples:["vacuumImpedance"]},o.coulomb={description:"Coulomb's constant",examples:["coulomb"]},o.elementaryCharge={description:"Elementary charge",examples:["elementaryCharge"]},o.bohrMagneton={description:"Borh magneton",examples:["bohrMagneton"]},o.conductanceQuantum={description:"Conductance quantum",examples:["conductanceQuantum"]},o.inverseConductanceQuantum={description:"Inverse conductance quantum",examples:["inverseConductanceQuantum"]},o.magneticFluxQuantum={description:"Magnetic flux quantum",examples:["magneticFluxQuantum"]},o.nuclearMagneton={description:"Nuclear magneton",examples:["nuclearMagneton"]},o.klitzing={description:"Von Klitzing constant",examples:["klitzing"]},o.bohrRadius={description:"Borh radius",examples:["bohrRadius"]},o.classicalElectronRadius={description:"Classical electron radius",examples:["classicalElectronRadius"]},o.electronMass={description:"Electron mass",examples:["electronMass"]},o.fermiCoupling={description:"Fermi coupling constant",examples:["fermiCoupling"]},o.fineStructure={description:"Fine-structure constant",examples:["fineStructure"]},o.hartreeEnergy={description:"Hartree energy",examples:["hartreeEnergy"]},o.protonMass={description:"Proton mass",examples:["protonMass"]},o.deuteronMass={description:"Deuteron Mass",examples:["deuteronMass"]},o.neutronMass={description:"Neutron mass",examples:["neutronMass"]},o.quantumOfCirculation={description:"Quantum of circulation",examples:["quantumOfCirculation"]},o.rydberg={description:"Rydberg constant",examples:["rydberg"]},o.thomsonCrossSection={description:"Thomson cross section",examples:["thomsonCrossSection"]},o.weakMixingAngle={description:"Weak mixing angle",examples:["weakMixingAngle"]},o.efimovFactor={description:"Efimov factor",examples:["efimovFactor"]},o.atomicMass={description:"Atomic mass constant",examples:["atomicMass"]},o.avogadro={description:"Avogadro's number",examples:["avogadro"]},o.boltzmann={description:"Boltzmann constant",examples:["boltzmann"]},o.faraday={description:"Faraday constant",examples:["faraday"]},o.firstRadiation={description:"First radiation constant",examples:["firstRadiation"]},o.loschmidt={description:"Loschmidt constant at T=273.15 K and p=101.325 kPa",examples:["loschmidt"]},o.gasConstant={description:"Gas constant",examples:["gasConstant"]},o.molarPlanckConstant={description:"Molar Planck constant",examples:["molarPlanckConstant"]},o.molarVolume={description:"Molar volume of an ideal gas at T=273.15 K and p=101.325 kPa",examples:["molarVolume"]},o.sackurTetrode={description:"Sackur-Tetrode constant at T=1 K and p=101.325 kPa",examples:["sackurTetrode"]},o.secondRadiation={description:"Second radiation constant",examples:["secondRadiation"]},o.stefanBoltzmann={description:"Stefan-Boltzmann constant",examples:["stefanBoltzmann"]},o.wienDisplacement={description:"Wien displacement law constant",examples:["wienDisplacement"]},o.molarMass={description:"Molar mass constant",examples:["molarMass"]},o.molarMassC12={description:"Molar mass constant of carbon-12",examples:["molarMassC12"]},o.gravity={description:"Standard acceleration of gravity (standard acceleration of free-fall on Earth)",examples:["gravity"]},o.planckLength={description:"Planck length",examples:["planckLength"]},o.planckMass={description:"Planck mass",examples:["planckMass"]},o.planckTime={description:"Planck time",examples:["planckTime"]},o.planckCharge={description:"Planck charge",examples:["planckCharge"]},o.planckTemperature={description:"Planck temperature",examples:["planckTemperature"]},o.derivative=derivative$2,o.lsolve=lsolve$1,o.lup=lup$1,o.lusolve=lusolve$1,o.simplify=simplify$3,o.rationalize=rationalize$1,o.slu=slu$1,o.usolve=usolve$1,o.qr=qr$1,o.abs=abs$2,o.add=add$1,o.cbrt=cbrt$1,o.ceil=ceil$1,o.cube=cube$1,o.divide=divide$2,o.dotDivide=dotDivide$1,o.dotMultiply=dotMultiply$1,o.dotPow=dotPow$1,o.exp=exp$2,o.expm=expm$1,o.expm1=expm1$1,o.fix=fix$1,o.floor=floor$1,o.gcd=gcd$1,o.hypot=hypot$1,o.lcm=lcm$1,o.log=log$3,o.log2=log2$1,o.log1p=log1p$1,o.log10=log10$2,o.mod=mod$2,o.multiply=multiply$2,o.norm=norm$1,o.nthRoot=nthRoot$1,o.pow=pow$2,o.round=round$2,o.sign=sign$4,o.sqrt=sqrt$2,o.sqrtm=sqrtm$1,o.square=square$1,o.subtract=subtract$2,o.unaryMinus=unaryMinus$1,o.unaryPlus=unaryPlus$1,o.xgcd=xgcd$1,o.bitAnd=bitAnd$2,o.bitNot=bitNot$2,o.bitOr=bitOr$2,o.bitXor=bitXor$2,o.leftShift=leftShift$2,o.rightArithShift=rightArithShift$2,o.rightLogShift=rightLogShift$1,o.bellNumbers=bellNumbers$1,o.catalan=catalan$1,o.composition=composition$1,o.stirlingS2=stirlingS2$1,o.config=config$1,o.import=_import,o.typed=typed,o.arg=arg$1,o.conj=conj$2,o.re=re$2,o.im=im$2,o.eval=_eval$1,o.help=help$1,o.distance=distance$1,o.intersect=intersect$1,o.and=and$1,o.not=not$1,o.or=or$1,o.xor=xor$1,o.concat=concat$1,o.cross=cross$1,o.det=det$1,o.diag=diag$1,o.dot=dot$1,o.eye=eye$1,o.filter=filter$3,o.flatten=flatten$j,o.forEach=forEach$4,o.inv=inv$1,o.kron=kron$1,o.map=map$8,o.ones=ones$1,o.partitionSelect=partitionSelect$1,o.range=range$2,o.resize=resize$3,o.reshape=reshape$1,o.size=size$7,o.sort=sort$1,o.squeeze=squeeze$1,o.subset=subset$1,o.trace=trace$1,o.transpose=transpose$1,o.zeros=zeros$1,o.combinations=combinations$1,o.factorial=factorial$2,o.gamma=gamma$2,o.kldivergence=kldivergence$1,o.multinomial=multinomial$1,o.permutations=permutations$1,o.pickRandom=pickRandom$1,o.random=random$2,o.randomInt=randomInt$1,o.compare=compare$1,o.compareNatural=compareNatural$1,o.compareText=compareText$1,o.deepEqual=deepEqual$2,o.equal=equal$2,o.equalText=equalText$1,o.larger=larger,o.largerEq=largerEq$1,o.smaller=smaller,o.smallerEq=smallerEq$1,o.unequal=unequal$1,o.setCartesian=setCartesian$1,o.setDifference=setDifference$1,o.setDistinct=setDistinct$1,o.setIntersect=setIntersect$1,o.setIsSubset=setIsSubset$1,o.setMultiplicity=setMultiplicity$1,o.setPowerset=setPowerset$1,o.setSize=setSize$1,o.setSymDifference=setSymDifference$1,o.setUnion=setUnion$1,o.erf=erf$2,o.mad=mad$1,o.max=max$2,o.mean=mean$1,o.median=median$1,o.min=min$2,o.mode=mode$1,o.prod=prod$1,o.quantileSeq=quantileSeq$1,o.std=std$1,o.sum=sum$1,o.var=_var$1,o.acos=acos$2,o.acosh=acosh$2,o.acot=acot$2,o.acoth=acoth$2,o.acsc=acsc$2,o.acsch=acsch$2,o.asec=asec$2,o.asech=asech$2,o.asin=asin$2,o.asinh=asinh$2,o.atan=atan$2,o.atanh=atanh$2,o.atan2=atan2$2,o.cos=cos$2,o.cosh=cosh$2,o.cot=cot$2,o.coth=coth$2,o.csc=csc$2,o.csch=csch$2,o.sec=sec$2,o.sech=sech$2,o.sin=sin$2,o.sinh=sinh$2,o.tan=tan$2,o.tanh=tanh$2,o.to=to$1,o.clone=clone$9,o.format=format$8,o.isNaN=_isNaN$2,o.isInteger=isInteger$q,o.isNegative=isNegative$1,o.isNumeric=isNumeric$1,o.isPositive=isPositive$1,o.isPrime=isPrime$1,o.isZero=isZero$1,o.typeof=_typeof$1,o}var name$3E="docs",path$Q="expression",factory_1$3Q=factory$3Q,embeddedDocs={name:name$3E,path:path$Q,factory:factory_1$3Q};function factory$3P(e,t,n,r){return function(t,n){if("BigNumber"===n)return new e.BigNumber(t);if("Fraction"===n)return new e.Fraction(t);if("number"==typeof t)return t;if("Infinity"===t)return 1/0;if("NaN"===t)return NaN;if(!/^[\-+]?((\d+\.?\d*)|(\d*\.?\d+))([eE][+\-]?\d+)?$/.test(t))throw new Error('Invalid numeric value "'+t+'"');return parseFloat(t.replace(/^(0*)[0-9]/,(function(e,t){return e.substring(t.length)})))}}var factory_1$3P=factory$3P,numeric={factory:factory_1$3P},hasOwnProperty$6=object$6.hasOwnProperty;function getSafeProperty$8(e,t){if(isPlainObject(e)&&isSafeProperty$1(e,t))return e[t];if("function"==typeof e[t]&&isSafeMethod$1(e,t))throw new Error('Cannot access method "'+t+'" as a property');throw new Error('No access to property "'+t+'"')}function setSafeProperty$4(e,t,n){if(isPlainObject(e)&&isSafeProperty$1(e,t))return e[t]=n;throw new Error('No access to property "'+t+'"')}function isSafeProperty$1(e,t){return!(!e||"object"!=typeof e||!hasOwnProperty$6(safeNativeProperties,t)&&(t in Object.prototype||t in Function.prototype))}function validateSafeMethod$1(e,t){if(!isSafeMethod$1(e,t))throw new Error('No access to method "'+t+'"')}function isSafeMethod$1(e,t){return!(!e||"function"!=typeof e[t]||hasOwnProperty$6(e,t)&&e.__proto__&&t in e.__proto__||!hasOwnProperty$6(safeNativeMethods,t)&&(t in Object.prototype||t in Function.prototype))}function isPlainObject(e){return"object"==typeof e&&e&&e.constructor===Object}var safeNativeProperties={length:!0,name:!0},safeNativeMethods={toString:!0,valueOf:!0,toLocaleString:!0},getSafeProperty_1=getSafeProperty$8,setSafeProperty_1=setSafeProperty$4,isSafeProperty_1=isSafeProperty$1,validateSafeMethod_1=validateSafeMethod$1,isSafeMethod_1=isSafeMethod$1,isPlainObject_1=isPlainObject,customs={getSafeProperty:getSafeProperty_1,setSafeProperty:setSafeProperty_1,isSafeProperty:isSafeProperty_1,validateSafeMethod:validateSafeMethod_1,isSafeMethod:isSafeMethod_1,isPlainObject:isPlainObject_1},keywords={end:!0},deepEqual$1=object$6.deepEqual,hasOwnProperty$5=object$6.hasOwnProperty;function factory$3O(e,t,n,r,a){function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator")}return i.prototype.eval=function(e){return this.compile().eval(e)},i.prototype.type="Node",i.prototype.isNode=!0,i.prototype.comment="",i.prototype.compile=function(){var e=this._compile(a.expression.mathWithTransform,{}),t={};return{eval:function(n){var r=n||{};return function(e){for(var t in e)if(hasOwnProperty$5(e,t)&&t in keywords)throw new Error('Scope contains an illegal symbol, "'+t+'" is a reserved keyword')}(r),e(r,t,null)}}},i.prototype._compile=function(e,t){throw new Error("Method _compile should be implemented by type "+this.type)},i.prototype.forEach=function(e){throw new Error("Cannot run forEach on a Node interface")},i.prototype.map=function(e){throw new Error("Cannot run map on a Node interface")},i.prototype._ifNode=function(t){if(!e.isNode(t))throw new TypeError("Callback function must return a Node");return t},i.prototype.traverse=function(e){e(this,null,null),function e(t,n){t.forEach((function(t,r,a){n(t,r,a),e(t,n)}))}(this,e)},i.prototype.transform=function(e){return function e(t,n){return t.map((function(t,r,a){return e(n(t,r,a),n)}))}(e(this,null,null),e)},i.prototype.filter=function(e){var t=[];return this.traverse((function(n,r,a){e(n,r,a)&&t.push(n)})),t},i.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")},i.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")},i.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},i.prototype.cloneDeep=function(){return this.map((function(e){return e.cloneDeep()}))},i.prototype.equals=function(e){return!!e&&deepEqual$1(this,e)},i.prototype.toString=function(e){var t;if(e&&"object"==typeof e)switch(typeof e.handler){case"object":case"undefined":break;case"function":t=e.handler(this,e);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==t?t:this._toString(e)},i.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},i.prototype.toHTML=function(e){var t;if(e&&"object"==typeof e)switch(typeof e.handler){case"object":case"undefined":break;case"function":t=e.handler(this,e);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==t?t:this.toHTML(e)},i.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},i.prototype.toTex=function(e){var t;if(e&&"object"==typeof e)switch(typeof e.handler){case"object":case"undefined":break;case"function":t=e.handler(this,e);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==t?t:this._toTex(e)},i.prototype._toTex=function(e){throw new Error("_toTex not implemented for "+this.type)},i.prototype.getIdentifier=function(){return this.type},i.prototype.getContent=function(){return this},i}var name$3D="Node",path$P="expression.node",math$g=!0,factory_1$3O=factory$3O,Node={name:name$3D,path:path$P,math:math$g,factory:factory_1$3O},map$7=array$3.map,escape$6=string$a.escape;function factory$3N(e,t,n,r){var a=n(Node),i=n(Range),o=Array.isArray;function s(t,n){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=t,this.dotNotation=n||!1,!o(t)||!t.every(e.isNode))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties");var r=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:r,set:r})}function l(t,n,r){return new i(e.isBigNumber(t)?t.toNumber():t,e.isBigNumber(n)?n.toNumber():n,e.isBigNumber(r)?r.toNumber():r)}return s.prototype=new a,s.prototype.type="IndexNode",s.prototype.isIndexNode=!0,s.prototype._compile=function(t,n){var r=map$7(this.dimensions,(function(r,a){if(e.isRangeNode(r)){if(r.needsEnd()){(u=Object.create(n)).end=!0;var i=r.start._compile(t,u),o=r.end._compile(t,u),s=r.step?r.step._compile(t,u):function(){return 1};return function(e,n,r){var u=t.size(r).valueOf(),c=Object.create(n);return c.end=u[a],l(i(e,c,r),o(e,c,r),s(e,c,r))}}return i=r.start._compile(t,n),o=r.end._compile(t,n),s=r.step?r.step._compile(t,n):function(){return 1},function(e,t,n){return l(i(e,t,n),o(e,t,n),s(e,t,n))}}if(e.isSymbolNode(r)&&"end"===r.name){var u;(u=Object.create(n)).end=!0;var c=r._compile(t,u);return function(e,n,r){var i=t.size(r).valueOf(),o=Object.create(n);return o.end=i[a],c(e,o,r)}}return c=r._compile(t,n),function(e,t,n){return c(e,t,n)}}));return function(e,n,a){var i=map$7(r,(function(t){return t(e,n,a)}));return t.index.apply(t,i)}},s.prototype.forEach=function(e){for(var t=0;t<this.dimensions.length;t++)e(this.dimensions[t],"dimensions["+t+"]",this)},s.prototype.map=function(e){for(var t=[],n=0;n<this.dimensions.length;n++)t[n]=this._ifNode(e(this.dimensions[n],"dimensions["+n+"]",this));return new s(t)},s.prototype.clone=function(){return new s(this.dimensions.slice(0))},s.prototype.isObjectProperty=function(){return 1===this.dimensions.length&&e.isConstantNode(this.dimensions[0])&&"string"==typeof this.dimensions[0].value},s.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},s.prototype._toString=function(e){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},s.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},s.fromJSON=function(e){return new s(e.dimensions,e.dotNotation)},s.prototype.toHTML=function(e){for(var t=[],n=0;n<this.dimensions.length;n++)t[n]=this.dimensions[n].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+escape$6(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},s.prototype._toTex=function(e){var t=this.dimensions.map((function(t){return t.toTex(e)}));return this.dotNotation?"."+this.getObjectProperty():"_{"+t.join(",")+"}"},s}var name$3C="IndexNode",path$O="expression.node",factory_1$3N=factory$3N,IndexNode={name:name$3C,path:path$O,factory:factory_1$3N},transform$2=function(e){return e&&e.isIndexError?new IndexError_1(e.index+1,e.min+1,void 0!==e.max?e.max+1:void 0):e},error_transform={transform:transform$2},clone$8=object$6.clone,validateIndex=array$3.validateIndex,getSafeProperty$7=customs.getSafeProperty,setSafeProperty$3=customs.setSafeProperty;function factory$3M(e,t,n,r){var a=n(matrix$5),i=r("subset",{"Array, Index":function(e,t){var n=a(e).subset(t);return t.isScalar()?n:n.valueOf()},"Matrix, Index":function(e,t){return e.subset(t)},"Object, Index":_getObjectProperty,"string, Index":function(t,n){if(!e.isIndex(n))throw new TypeError("Index expected");if(1!=n.size().length)throw new DimensionError_1(n.size().length,1);var r=t.length;validateIndex(n.min()[0],r),validateIndex(n.max()[0],r);var a=n.dimension(0),i="";return a.forEach((function(e){i+=t.charAt(e)})),i},"Array, Index, any":function(e,t,n){return a(clone$8(e)).subset(t,n,void 0).valueOf()},"Array, Index, any, any":function(e,t,n,r){return a(clone$8(e)).subset(t,n,r).valueOf()},"Matrix, Index, any":function(e,t,n){return e.clone().subset(t,n)},"Matrix, Index, any, any":function(e,t,n,r){return e.clone().subset(t,n,r)},"string, Index, string":o,"string, Index, string, string":o,"Object, Index, any":_setObjectProperty});return i.toTex=void 0,i;function o(e,t,n,r){if(!t||!0!==t.isIndex)throw new TypeError("Index expected");if(1!=t.size().length)throw new DimensionError_1(t.size().length,1);if(void 0!==r){if("string"!=typeof r||1!==r.length)throw new TypeError("Single character expected as defaultValue")}else r=" ";var a=t.dimension(0),i=a.size()[0];if(i!=n.length)throw new DimensionError_1(a.size()[0],n.length);var o=e.length;validateIndex(t.min()[0]),validateIndex(t.max()[0]);for(var s=[],l=0;l<o;l++)s[l]=e.charAt(l);if(a.forEach((function(e,t){s[e]=n.charAt(t[0])})),s.length>o)for(l=o-1,i=s.length;l<i;l++)s[l]||(s[l]=r);return s.join("")}}function _getObjectProperty(e,t){if(1!==t.size().length)throw new DimensionError_1(t.size(),1);var n=t.dimension(0);if("string"!=typeof n)throw new TypeError("String expected as index to retrieve an object property");return getSafeProperty$7(e,n)}function _setObjectProperty(e,t,n){if(1!==t.size().length)throw new DimensionError_1(t.size(),1);var r=t.dimension(0);if("string"!=typeof r)throw new TypeError("String expected as index to retrieve an object property");var a=clone$8(e);return setSafeProperty$3(a,r,n),a}var name$3B="subset",factory_1$3M=factory$3M,subset={name:name$3B,factory:factory_1$3M},errorTransform$6=error_transform.transform,getSafeProperty$6=customs.getSafeProperty;function factory$3L(e,t,n,r){var a=n(subset);return function(e,t){try{if(Array.isArray(e))return a(e,t);if(e&&"function"==typeof e.subset)return e.subset(t);if("string"==typeof e)return a(e,t);if("object"==typeof e){if(!t.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return getSafeProperty$6(e,t.getObjectProperty())}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw errorTransform$6(e)}}}var factory_1$3L=factory$3L,access={factory:factory_1$3L},getSafeProperty$5=customs.getSafeProperty;function factory$3K(e,t,n,r){var a=n(Node);n(IndexNode);var i=n(access);function o(t,n){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(t))throw new TypeError('Node expected for parameter "object"');if(!e.isIndexNode(n))throw new TypeError('IndexNode expected for parameter "index"');this.object=t||null,this.index=n,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function s(t){return!(e.isAccessorNode(t)||e.isArrayNode(t)||e.isConstantNode(t)||e.isFunctionNode(t)||e.isObjectNode(t)||e.isParenthesisNode(t)||e.isSymbolNode(t))}return o.prototype=new a,o.prototype.type="AccessorNode",o.prototype.isAccessorNode=!0,o.prototype._compile=function(e,t){var n=this.object._compile(e,t),r=this.index._compile(e,t);if(this.index.isObjectProperty()){var a=this.index.getObjectProperty();return function(e,t,r){return getSafeProperty$5(n(e,t,r),a)}}return function(e,t,a){var o=n(e,t,a),s=r(e,t,o);return i(o,s)}},o.prototype.forEach=function(e){e(this.object,"object",this),e(this.index,"index",this)},o.prototype.map=function(e){return new o(this._ifNode(e(this.object,"object",this)),this._ifNode(e(this.index,"index",this)))},o.prototype.clone=function(){return new o(this.object,this.index)},o.prototype._toString=function(e){var t=this.object.toString(e);return s(this.object)&&(t="("+t+")"),t+this.index.toString(e)},o.prototype.toHTML=function(e){var t=this.object.toHTML(e);return s(this.object)&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+this.index.toHTML(e)},o.prototype._toTex=function(e){var t=this.object.toTex(e);return s(this.object)&&(t="\\left("+t+"\\right)"),t+this.index.toTex(e)},o.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},o.fromJSON=function(e){return new o(e.object,e.index)},o}var name$3A="AccessorNode",path$N="expression.node",factory_1$3K=factory$3K,AccessorNode={name:name$3A,path:path$N,factory:factory_1$3K},map$6=array$3.map;function factory$3J(e,t,n,r){var a=n(Node);function i(t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=t||[],!Array.isArray(this.items)||!this.items.every(e.isNode))throw new TypeError("Array containing Nodes expected");var n=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:n,set:n})}return i.prototype=new a,i.prototype.type="ArrayNode",i.prototype.isArrayNode=!0,i.prototype._compile=function(e,t){var n=map$6(this.items,(function(n){return n._compile(e,t)}));if("Array"!==e.config().matrix){var r=e.matrix;return function(e,t,a){return r(map$6(n,(function(n){return n(e,t,a)})))}}return function(e,t,r){return map$6(n,(function(n){return n(e,t,r)}))}},i.prototype.forEach=function(e){for(var t=0;t<this.items.length;t++)e(this.items[t],"items["+t+"]",this)},i.prototype.map=function(e){for(var t=[],n=0;n<this.items.length;n++)t[n]=this._ifNode(e(this.items[n],"items["+n+"]",this));return new i(t)},i.prototype.clone=function(){return new i(this.items.slice(0))},i.prototype._toString=function(e){return"["+this.items.map((function(t){return t.toString(e)})).join(", ")+"]"},i.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},i.fromJSON=function(e){return new i(e.items)},i.prototype.toHTML=function(e){return'<span class="math-parenthesis math-square-parenthesis">[</span>'+this.items.map((function(t){return t.toHTML(e)})).join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},i.prototype._toTex=function(e){var t="\\begin{bmatrix}";return this.items.forEach((function(n){n.items?t+=n.items.map((function(t){return t.toTex(e)})).join("&"):t+=n.toTex(e),t+="\\\\"})),t+="\\end{bmatrix}"},i}var name$3z="ArrayNode",path$M="expression.node",factory_1$3J=factory$3J,ArrayNode={name:name$3z,path:path$M,factory:factory_1$3J},errorTransform$5=error_transform.transform,setSafeProperty$2=customs.setSafeProperty;function factory$3I(e,t,n,r){var a=n(subset),i=n(matrix$5);return function(e,t,n){try{if(Array.isArray(e))return i(e).subset(t,n).valueOf();if(e&&"function"==typeof e.subset)return e.subset(t,n);if("string"==typeof e)return a(e,t,n);if("object"==typeof e){if(!t.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return setSafeProperty$2(e,t.getObjectProperty(),n),e}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw errorTransform$5(e)}}}var factory_1$3I=factory$3I,assign={factory:factory_1$3I},properties=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function getPrecedence(e,t){var n=e;"keep"!==t&&(n=e.getContent());for(var r=n.getIdentifier(),a=0;a<properties.length;a++)if(r in properties[a])return a;return null}function getAssociativity(e,t){var n=e;"keep"!==t&&(n=e.getContent());var r=n.getIdentifier(),a=getPrecedence(n,t);if(null===a)return null;var i=properties[a][r];if(i.hasOwnProperty("associativity")){if("left"===i.associativity)return"left";if("right"===i.associativity)return"right";throw Error("'"+r+"' has the invalid associativity '"+i.associativity+"'.")}return null}function isAssociativeWith(e,t,n){var r=e,a=t;"keep"!==n&&(r=e.getContent(),a=t.getContent());var i=r.getIdentifier(),o=a.getIdentifier(),s=getPrecedence(r,n);if(null===s)return null;var l=properties[s][i];if(l.hasOwnProperty("associativeWith")&&l.associativeWith instanceof Array){for(var u=0;u<l.associativeWith.length;u++)if(l.associativeWith[u]===o)return!0;return!1}return null}var properties_1=properties,getPrecedence_1=getPrecedence,getAssociativity_1=getAssociativity,isAssociativeWith_1=isAssociativeWith,operators$4={properties:properties_1,getPrecedence:getPrecedence_1,getAssociativity:getAssociativity_1,isAssociativeWith:isAssociativeWith_1},getSafeProperty$4=customs.getSafeProperty,setSafeProperty$1=customs.setSafeProperty;function factory$3H(e,t,n,r){var a=n(Node),i=n(assign),o=n(access),s=operators$4;function l(t,n,r){if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=t,this.index=r?n:null,this.value=r||n,!e.isSymbolNode(t)&&!e.isAccessorNode(t))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(e.isSymbolNode(t)&&"end"===t.name)throw new Error('Cannot assign to symbol "end"');if(this.index&&!e.isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!e.isNode(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function u(e,t){t||(t="keep");var n=s.getPrecedence(e,t),r=s.getPrecedence(e.value,t);return"all"===t||null!==r&&r<=n}return l.prototype=new a,l.prototype.type="AssignmentNode",l.prototype.isAssignmentNode=!0,l.prototype._compile=function(t,n){var r=this.object._compile(t,n),a=this.index?this.index._compile(t,n):null,s=this.value._compile(t,n),l=this.object.name;if(this.index){if(this.index.isObjectProperty()){var u=this.index.getObjectProperty();return function(e,t,n){var a=r(e,t,n),i=s(e,t,n);return setSafeProperty$1(a,u,i)}}if(e.isSymbolNode(this.object))return function(e,t,n){var o=r(e,t,n),u=s(e,t,n),c=a(e,t,o);return setSafeProperty$1(e,l,i(o,c,u)),u};var c=this.object.object._compile(t,n);if(this.object.index.isObjectProperty()){var p=this.object.index.getObjectProperty();return function(e,t,n){var r=c(e,t,n),o=getSafeProperty$4(r,p),l=a(e,t,o),u=s(e,t,n);return setSafeProperty$1(r,p,i(o,l,u)),u}}var d=this.object.index._compile(t,n);return function(e,t,n){var r=c(e,t,n),l=d(e,t,r),u=o(r,l),p=a(e,t,u),m=s(e,t,n);return i(r,l,i(u,p,m)),m}}if(!e.isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(e,t,n){return setSafeProperty$1(e,l,s(e,t,n))}},l.prototype.forEach=function(e){e(this.object,"object",this),this.index&&e(this.index,"index",this),e(this.value,"value",this)},l.prototype.map=function(e){return new l(this._ifNode(e(this.object,"object",this)),this.index?this._ifNode(e(this.index,"index",this)):null,this._ifNode(e(this.value,"value",this)))},l.prototype.clone=function(){return new l(this.object,this.index,this.value)},l.prototype._toString=function(e){var t=this.object.toString(e),n=this.index?this.index.toString(e):"",r=this.value.toString(e);return u(this,e&&e.parenthesis)&&(r="("+r+")"),t+n+" = "+r},l.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},l.fromJSON=function(e){return new l(e.object,e.index,e.value)},l.prototype.toHTML=function(e){var t=this.object.toHTML(e),n=this.index?this.index.toHTML(e):"",r=this.value.toHTML(e);return u(this,e&&e.parenthesis)&&(r='<span class="math-paranthesis math-round-parenthesis">(</span>'+r+'<span class="math-paranthesis math-round-parenthesis">)</span>'),t+n+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+r},l.prototype._toTex=function(e){var t=this.object.toTex(e),n=this.index?this.index.toTex(e):"",r=this.value.toTex(e);return u(this,e&&e.parenthesis)&&(r="\\left("+r+"\\right)"),t+n+":="+r},l}var name$3y="AssignmentNode",path$L="expression.node",factory_1$3H=factory$3H,AssignmentNode={name:name$3y,path:path$L,factory:factory_1$3H},forEach$3=array$3.forEach,map$5=array$3.map;function factory$3G(e,t,n,r){var a=n(Node),i=n(ResultSet);function o(t){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(t))throw new Error("Array expected");this.blocks=t.map((function(t){var n=t&&t.node,r=!t||void 0===t.visible||t.visible;if(!e.isNode(n))throw new TypeError('Property "node" must be a Node');if("boolean"!=typeof r)throw new TypeError('Property "visible" must be a boolean');return{node:n,visible:r}}))}return o.prototype=new a,o.prototype.type="BlockNode",o.prototype.isBlockNode=!0,o.prototype._compile=function(e,t){var n=map$5(this.blocks,(function(n){return{eval:n.node._compile(e,t),visible:n.visible}}));return function(e,t,r){var a=[];return forEach$3(n,(function(n){var i=n.eval(e,t,r);n.visible&&a.push(i)})),new i(a)}},o.prototype.forEach=function(e){for(var t=0;t<this.blocks.length;t++)e(this.blocks[t].node,"blocks["+t+"].node",this)},o.prototype.map=function(e){for(var t=[],n=0;n<this.blocks.length;n++){var r=this.blocks[n],a=this._ifNode(e(r.node,"blocks["+n+"].node",this));t[n]={node:a,visible:r.visible}}return new o(t)},o.prototype.clone=function(){return new o(this.blocks.map((function(e){return{node:e.node,visible:e.visible}})))},o.prototype._toString=function(e){return this.blocks.map((function(t){return t.node.toString(e)+(t.visible?"":";")})).join("\n")},o.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},o.fromJSON=function(e){return new o(e.blocks)},o.prototype.toHTML=function(e){return this.blocks.map((function(t){return t.node.toHTML(e)+(t.visible?"":'<span class="math-separator">;</span>')})).join('<span class="math-separator"><br /></span>')},o.prototype._toTex=function(e){return this.blocks.map((function(t){return t.node.toTex(e)+(t.visible?"":";")})).join("\\;\\;\n")},o}var name$3x="BlockNode",path$K="expression.node",factory_1$3G=factory$3G,BlockNode={name:name$3x,path:path$K,factory:factory_1$3G};function factory$3F(e,t,n,r){var a=r("_typeof",{any:function(t){var n=typeof t;return"object"===n?null===t?"null":Array.isArray(t)?"Array":t instanceof Date?"Date":t instanceof RegExp?"RegExp":t instanceof Boolean?"boolean":t instanceof Number?"number":t instanceof String?"string":e.isBigNumber(t)?"BigNumber":e.isComplex(t)?"Complex":e.isFraction(t)?"Fraction":e.isMatrix(t)?"Matrix":e.isUnit(t)?"Unit":e.isIndex(t)?"Index":e.isRange(t)?"Range":e.isResultSet(t)?"ResultSet":e.isNode(t)?t.type:e.isChain(t)?"Chain":e.isHelp(t)?"Help":"Object":"function"===n?"Function":n}});return a.toTex=void 0,a}var name$3w="typeof",factory_1$3F=factory$3F,_typeof={name:name$3w,factory:factory_1$3F};function factory$3E(e,t,n,r){var a=n(Node),i=n(_typeof);function o(t,n,r){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(t))throw new TypeError("Parameter condition must be a Node");if(!e.isNode(n))throw new TypeError("Parameter trueExpr must be a Node");if(!e.isNode(r))throw new TypeError("Parameter falseExpr must be a Node");this.condition=t,this.trueExpr=n,this.falseExpr=r}return o.prototype=new a,o.prototype.type="ConditionalNode",o.prototype.isConditionalNode=!0,o.prototype._compile=function(t,n){var r=this.condition._compile(t,n),a=this.trueExpr._compile(t,n),o=this.falseExpr._compile(t,n);return function(t,n,s){return function(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t)return!!t;if(t){if(e.isBigNumber(t))return!t.isZero();if(e.isComplex(t))return!(!t.re&&!t.im);if(e.isUnit(t))return!!t.value}if(null==t)return!1;throw new TypeError('Unsupported type of condition "'+i(t)+'"')}(r(t,n,s))?a(t,n,s):o(t,n,s)}},o.prototype.forEach=function(e){e(this.condition,"condition",this),e(this.trueExpr,"trueExpr",this),e(this.falseExpr,"falseExpr",this)},o.prototype.map=function(e){return new o(this._ifNode(e(this.condition,"condition",this)),this._ifNode(e(this.trueExpr,"trueExpr",this)),this._ifNode(e(this.falseExpr,"falseExpr",this)))},o.prototype.clone=function(){return new o(this.condition,this.trueExpr,this.falseExpr)},o.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=operators$4.getPrecedence(this,t),r=this.condition.toString(e),a=operators$4.getPrecedence(this.condition,t);("all"===t||"OperatorNode"===this.condition.type||null!==a&&a<=n)&&(r="("+r+")");var i=this.trueExpr.toString(e),o=operators$4.getPrecedence(this.trueExpr,t);("all"===t||"OperatorNode"===this.trueExpr.type||null!==o&&o<=n)&&(i="("+i+")");var s=this.falseExpr.toString(e),l=operators$4.getPrecedence(this.falseExpr,t);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==l&&l<=n)&&(s="("+s+")"),r+" ? "+i+" : "+s},o.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},o.fromJSON=function(e){return new o(e.condition,e.trueExpr,e.falseExpr)},o.prototype.toHTML=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=operators$4.getPrecedence(this,t),r=this.condition.toHTML(e),a=operators$4.getPrecedence(this.condition,t);("all"===t||"OperatorNode"===this.condition.type||null!==a&&a<=n)&&(r='<span class="math-parenthesis math-round-parenthesis">(</span>'+r+'<span class="math-parenthesis math-round-parenthesis">)</span>');var i=this.trueExpr.toHTML(e),o=operators$4.getPrecedence(this.trueExpr,t);("all"===t||"OperatorNode"===this.trueExpr.type||null!==o&&o<=n)&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>');var s=this.falseExpr.toHTML(e),l=operators$4.getPrecedence(this.falseExpr,t);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==l&&l<=n)&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),r+'<span class="math-operator math-conditional-operator">?</span>'+i+'<span class="math-operator math-conditional-operator">:</span>'+s},o.prototype._toTex=function(e){return"\\begin{cases} {"+this.trueExpr.toTex(e)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(e)+"}\\\\{"+this.falseExpr.toTex(e)+"}, &\\quad{\\text{otherwise}}\\end{cases}"},o}var name$3v="ConditionalNode",path$J="expression.node",factory_1$3E=factory$3E,ConditionalNode={name:name$3v,path:path$J,factory:factory_1$3E},format$7=string$a.format,escapeLatex=latex$1.escape;function factory$3D(e,t,n,r){var a=n(Node),i=n(_typeof);function o(e){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");if(2===arguments.length)throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.");this.value=e}return o.prototype=new a,o.prototype.type="ConstantNode",o.prototype.isConstantNode=!0,o.prototype._compile=function(e,t){var n=this.value;return function(){return n}},o.prototype.forEach=function(e){},o.prototype.map=function(e){return this.clone()},o.prototype.clone=function(){return new o(this.value)},o.prototype._toString=function(e){return format$7(this.value,e)},o.prototype.toHTML=function(e){var t=this._toString(e);switch(i(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+t+"</span>";case"string":return'<span class="math-string">'+t+"</span>";case"boolean":return'<span class="math-boolean">'+t+"</span>";case"null":return'<span class="math-null-symbol">'+t+"</span>";case"undefined":return'<span class="math-undefined">'+t+"</span>";default:return'<span class="math-symbol">'+t+"</span>"}},o.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},o.fromJSON=function(e){return new o(e.value)},o.prototype._toTex=function(e){var t=this._toString(e);switch(i(this.value)){case"string":return"\\mathtt{"+escapeLatex(t)+"}";case"number":case"BigNumber":var n=t.toLowerCase().indexOf("e");return-1!==n?t.substring(0,n)+"\\cdot10^{"+t.substring(n+1)+"}":t;case"Fraction":return this.value.toLatex();default:return t}},o}var name$3u="ConstantNode",path$I="expression.node",factory_1$3D=factory$3D,ConstantNode={name:name$3u,path:path$I,factory:factory_1$3D},escape$5=string$a.escape,forEach$2=array$3.forEach,join=array$3.join,setSafeProperty=customs.setSafeProperty;function factory$3C(e,t,n,r){var a=n(Node);function i(t,n,r){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof t)throw new TypeError('String expected for parameter "name"');if(!Array.isArray(n))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!e.isNode(r))throw new TypeError('Node expected for parameter "expr"');if(t in keywords)throw new Error('Illegal function name, "'+t+'" is a reserved keyword');this.name=t,this.params=n.map((function(e){return e&&e.name||e})),this.types=n.map((function(e){return e&&e.type||"any"})),this.expr=r}function o(e,t){var n=operators$4.getPrecedence(e,t),r=operators$4.getPrecedence(e.expr,t);return"all"===t||null!==r&&r<=n}return i.prototype=new a,i.prototype.type="FunctionAssignmentNode",i.prototype.isFunctionAssignmentNode=!0,i.prototype._compile=function(e,t){var n=Object.create(t);forEach$2(this.params,(function(e){n[e]=!0}));var a=this.expr._compile(e,n),i=this.name,o=this.params,s=join(this.types,","),l=i+"("+join(this.params,", ")+")";return function(e,t,n){var u={};u[s]=function(){for(var r=Object.create(t),i=0;i<o.length;i++)r[o[i]]=arguments[i];return a(e,r,n)};var c=r(i,u);return c.syntax=l,setSafeProperty(e,i,c),c}},i.prototype.forEach=function(e){e(this.expr,"expr",this)},i.prototype.map=function(e){var t=this._ifNode(e(this.expr,"expr",this));return new i(this.name,this.params.slice(0),t)},i.prototype.clone=function(){return new i(this.name,this.params.slice(0),this.expr)},i.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=this.expr.toString(e);return o(this,t)&&(n="("+n+")"),this.name+"("+this.params.join(", ")+") = "+n},i.prototype.toJSON=function(){var e=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map((function(t,n){return{name:t,type:e[n]}})),expr:this.expr}},i.fromJSON=function(e){return new i(e.name,e.params,e.expr)},i.prototype.toHTML=function(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=[],r=0;r<this.params.length;r++)n.push('<span class="math-symbol math-parameter">'+escape$5(this.params[r])+"</span>");var a=this.expr.toHTML(e);return o(this,t)&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+escape$5(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+n.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+a},i.prototype._toTex=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=this.expr.toTex(e);return o(this,t)&&(n="\\left("+n+"\\right)"),"\\mathrm{"+this.name+"}\\left("+this.params.map(latex$1.toSymbol).join(",")+"\\right):="+n},i}var name$3t="FunctionAssignmentNode",path$H="expression.node",factory_1$3C=factory$3C,FunctionAssignmentNode={name:name$3t,path:path$H,factory:factory_1$3C},stringify=string$a.stringify,escape$4=string$a.escape,isSafeProperty=customs.isSafeProperty,hasOwnProperty$4=object$6.hasOwnProperty;function factory$3B(e,t,n,r){var a=n(Node);function i(t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=t||{},t&&("object"!=typeof t||!Object.keys(t).every((function(n){return e.isNode(t[n])}))))throw new TypeError("Object containing Nodes expected")}return i.prototype=new a,i.prototype.type="ObjectNode",i.prototype.isObjectNode=!0,i.prototype._compile=function(e,t){var n={};for(var r in this.properties)if(hasOwnProperty$4(this.properties,r)){var a=stringify(r),i=JSON.parse(a);if(!isSafeProperty(this.properties,i))throw new Error('No access to property "'+i+'"');n[i]=this.properties[r]._compile(e,t)}return function(e,t,r){var a={};for(var i in n)hasOwnProperty$4(n,i)&&(a[i]=n[i](e,t,r));return a}},i.prototype.forEach=function(e){for(var t in this.properties)this.properties.hasOwnProperty(t)&&e(this.properties[t],"properties["+stringify(t)+"]",this)},i.prototype.map=function(e){var t={};for(var n in this.properties)this.properties.hasOwnProperty(n)&&(t[n]=this._ifNode(e(this.properties[n],"properties["+stringify(n)+"]",this)));return new i(t)},i.prototype.clone=function(){var e={};for(var t in this.properties)this.properties.hasOwnProperty(t)&&(e[t]=this.properties[t]);return new i(e)},i.prototype._toString=function(e){var t=[];for(var n in this.properties)this.properties.hasOwnProperty(n)&&t.push(stringify(n)+": "+this.properties[n].toString(e));return"{"+t.join(", ")+"}"},i.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},i.fromJSON=function(e){return new i(e.properties)},i.prototype.toHTML=function(e){var t=[];for(var n in this.properties)this.properties.hasOwnProperty(n)&&t.push('<span class="math-symbol math-property">'+escape$4(n)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[n].toHTML(e));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},i.prototype._toTex=function(e){var t=[];for(var n in this.properties)this.properties.hasOwnProperty(n)&&t.push("\\mathbf{"+n+":} & "+this.properties[n].toTex(e)+"\\\\");return"\\left\\{\\begin{array}{ll}"+t.join("\n")+"\\end{array}\\right\\}"},i}var name$3s="ObjectNode",path$G="expression.node",factory_1$3B=factory$3B,ObjectNode={name:name$3s,path:path$G,factory:factory_1$3B},map$4=array$3.map,escape$3=string$a.escape,isSafeMethod=customs.isSafeMethod,getSafeProperty$3=customs.getSafeProperty;function factory$3A(e,t,n,r){var a=n(Node);function i(t,n,r,a){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof t)throw new TypeError('string expected for parameter "op"');if("string"!=typeof n)throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(r)||!r.every(e.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=!0===a,this.op=t,this.fn=n,this.args=r||[]}function o(e,t,n,r,a){var i=operators$4.getPrecedence(e,t),o=operators$4.getAssociativity(e,t);if("all"===t||r.length>2&&"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier()){var s=r.map((function(e){switch(e.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}}));return s}var l=void 0;switch(r.length){case 0:l=[];break;case 1:var u=operators$4.getPrecedence(r[0],t);if(a&&null!==u){var c;if("keep"===t?(c=r[0].getIdentifier(),h=e.getIdentifier()):(c=r[0].getContent().getIdentifier(),h=e.getContent().getIdentifier()),!1===operators$4.properties[i][h].latexLeftParens){l=[!1];break}if(!1===operators$4.properties[u][c].latexParens){l=[!1];break}}if(null===u){l=[!1];break}if(u<=i){l=[!0];break}l=[!1];break;case 2:var p,d,m=operators$4.getPrecedence(r[0],t),f=operators$4.isAssociativeWith(e,r[0],t);p=null!==m&&(m===i&&"right"===o&&!f||m<i);var h,y,b,g=operators$4.getPrecedence(r[1],t),v=operators$4.isAssociativeWith(e,r[1],t);d=null!==g&&(g===i&&"left"===o&&!v||g<i),a&&("keep"===t?(h=e.getIdentifier(),y=e.args[0].getIdentifier(),b=e.args[1].getIdentifier()):(h=e.getContent().getIdentifier(),y=e.args[0].getContent().getIdentifier(),b=e.args[1].getContent().getIdentifier()),null!==m&&(!1===operators$4.properties[i][h].latexLeftParens&&(p=!1),!1===operators$4.properties[m][y].latexParens&&(p=!1)),null!==g&&(!1===operators$4.properties[i][h].latexRightParens&&(d=!1),!1===operators$4.properties[g][b].latexParens&&(d=!1))),l=[p,d];break;default:"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier()||(l=r.map((function(n){var r=operators$4.getPrecedence(n,t),a=operators$4.isAssociativeWith(e,n,t),s=operators$4.getAssociativity(n,t);return null!==r&&(i===r&&o===s&&!a||r<i)})))}return r.length>=2&&"OperatorNode:multiply"===e.getIdentifier()&&e.implicit&&"auto"===t&&"hide"===n&&(l=r.map((function(e,t){var n="ParenthesisNode"===e.getIdentifier();return!(!l[t]&&!n)}))),l}return i.prototype=new a,i.prototype.type="OperatorNode",i.prototype.isOperatorNode=!0,i.prototype._compile=function(e,t){if("string"!=typeof this.fn||!isSafeMethod(e,this.fn))throw e[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var n=getSafeProperty$3(e,this.fn),r=map$4(this.args,(function(n){return n._compile(e,t)}));if(1===r.length){var a=r[0];return function(e,t,r){return n(a(e,t,r))}}if(2===r.length){a=r[0];var i=r[1];return function(e,t,r){return n(a(e,t,r),i(e,t,r))}}return function(e,t,a){return n.apply(null,map$4(r,(function(n){return n(e,t,a)})))}},i.prototype.forEach=function(e){for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)},i.prototype.map=function(e){for(var t=[],n=0;n<this.args.length;n++)t[n]=this._ifNode(e(this.args[n],"args["+n+"]",this));return new i(this.op,this.fn,t,this.implicit)},i.prototype.clone=function(){return new i(this.op,this.fn,this.args.slice(0),this.implicit)},i.prototype.isUnary=function(){return 1===this.args.length},i.prototype.isBinary=function(){return 2===this.args.length},i.prototype._toString=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",r=this.args,a=o(this,t,n,r,!1);if(1===r.length){var i=operators$4.getAssociativity(this,t),s=r[0].toString(e);return a[0]&&(s="("+s+")"),"right"===i?this.op+s:s+this.op}if(2==r.length){var l=r[0].toString(e),u=r[1].toString(e);return a[0]&&(l="("+l+")"),a[1]&&(u="("+u+")"),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"==n?l+" "+u:l+" "+this.op+" "+u}if(r.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var c=r.map((function(t,n){return t=t.toString(e),a[n]&&(t="("+t+")"),t}));return this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?c.join(" "):c.join(" "+this.op+" ")}return this.fn+"("+this.args.join(", ")+")"},i.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}},i.fromJSON=function(e){return new i(e.op,e.fn,e.args,e.implicit)},i.prototype.toHTML=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",r=this.args,a=o(this,t,n,r,!1);if(1===r.length){var i=operators$4.getAssociativity(this,t),s=r[0].toHTML(e);return a[0]&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),"right"===i?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+escape$3(this.op)+"</span>"+s:'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+escape$3(this.op)+"</span>"+s}if(2==r.length){var l=r[0].toHTML(e),u=r[1].toHTML(e);return a[0]&&(l='<span class="math-parenthesis math-round-parenthesis">(</span>'+l+'<span class="math-parenthesis math-round-parenthesis">)</span>'),a[1]&&(u='<span class="math-parenthesis math-round-parenthesis">(</span>'+u+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"==n?l+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+u:l+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape$3(this.op)+"</span>"+u}if(r.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var c=r.map((function(t,n){return t=t.toHTML(e),a[n]&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t}));return this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===n?c.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):c.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape$3(this.op)+"</span>")}return'<span class="math-function">'+escape$3(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+c.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'},i.prototype._toTex=function(e){var t=e&&e.parenthesis?e.parenthesis:"keep",n=e&&e.implicit?e.implicit:"hide",r=this.args,a=o(this,t,n,r,!0),i=latex$1.operators[this.fn];if(i=void 0===i?this.op:i,1===r.length){var s=operators$4.getAssociativity(this,t),l=r[0].toTex(e);return a[0]&&(l="\\left("+l+"\\right)"),"right"===s?i+l:l+i}if(2===r.length){var u=r[0],c=u.toTex(e);a[0]&&(c="\\left("+c+"\\right)");var p,d=r[1].toTex(e);switch(a[1]&&(d="\\left("+d+"\\right)"),p="keep"===t?u.getIdentifier():u.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return i+"{"+c+"}{"+d+"}";case"OperatorNode:pow":switch(c="{"+c+"}",d="{"+d+"}",p){case"ConditionalNode":case"OperatorNode:divide":c="\\left("+c+"\\right)"}case"OperatorNode:multiply":if(this.implicit&&"hide"===n)return c+"~"+d}return c+i+d}if(r.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var m=r.map((function(t,n){return t=t.toTex(e),a[n]&&(t="\\left("+t+"\\right)"),t}));return"OperatorNode:multiply"===this.getIdentifier()&&this.implicit?m.join("~"):m.join(i)}return"\\mathrm{"+this.fn+"}\\left("+r.map((function(t){return t.toTex(e)})).join(",")+"\\right)"},i.prototype.getIdentifier=function(){return this.type+":"+this.fn},i}var name$3r="OperatorNode",path$F="expression.node",factory_1$3A=factory$3A,OperatorNode={name:name$3r,path:path$F,factory:factory_1$3A};function factory$3z(e,t,n,r){var a=n(Node);function i(t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(t))throw new TypeError('Node expected for parameter "content"');this.content=t}return i.prototype=new a,i.prototype.type="ParenthesisNode",i.prototype.isParenthesisNode=!0,i.prototype._compile=function(e,t){return this.content._compile(e,t)},i.prototype.getContent=function(){return this.content.getContent()},i.prototype.forEach=function(e){e(this.content,"content",this)},i.prototype.map=function(e){return new i(e(this.content,"content",this))},i.prototype.clone=function(){return new i(this.content)},i.prototype._toString=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"("+this.content.toString(e)+")":this.content.toString(e)},i.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},i.fromJSON=function(e){return new i(e.content)},i.prototype.toHTML=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(e)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(e)},i.prototype._toTex=function(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"\\left("+this.content.toTex(e)+"\\right)":this.content.toTex(e)},i}var name$3q="ParenthesisNode",path$E="expression.node",factory_1$3z=factory$3z,ParenthesisNode={name:name$3q,path:path$E,factory:factory_1$3z},escape$2=string$a.escape,hasOwnProperty$3=object$6.hasOwnProperty,getSafeProperty$2=customs.getSafeProperty;function factory$3y(e,t,n,r,a){var i=n(Node);function o(t){return!!e.Unit&&e.Unit.isValuelessUnit(t)}function s(e){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('String expected for parameter "name"');this.name=e}return s.prototype=new i,s.prototype.type="SymbolNode",s.prototype.isSymbolNode=!0,s.prototype._compile=function(t,n){var r=this.name;if(hasOwnProperty$3(n,r))return function(e,t,n){return t[r]};if(r in t)return function(e,n,a){return getSafeProperty$2(r in e?e:t,r)};var a=o(r);return function(t,n,i){return r in t?getSafeProperty$2(t,r):a?new e.Unit(null,r):function(e){throw new Error("Undefined symbol "+e)}(r)}},s.prototype.forEach=function(e){},s.prototype.map=function(e){return this.clone()},s.prototype.clone=function(){return new s(this.name)},s.prototype._toString=function(e){return this.name},s.prototype.toHTML=function(e){var t=escape$2(this.name);return"true"==t||"false"==t?'<span class="math-symbol math-boolean">'+t+"</span>":"i"==t?'<span class="math-symbol math-imaginary-symbol">'+t+"</span>":"Infinity"==t?'<span class="math-symbol math-infinity-symbol">'+t+"</span>":"NaN"==t?'<span class="math-symbol math-nan-symbol">'+t+"</span>":"null"==t?'<span class="math-symbol math-null-symbol">'+t+"</span>":"undefined"==t?'<span class="math-symbol math-undefined-symbol">'+t+"</span>":'<span class="math-symbol">'+t+"</span>"},s.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},s.fromJSON=function(e){return new s(e.name)},s.prototype._toTex=function(e){var t=!1;void 0===a[this.name]&&o(this.name)&&(t=!0);var n=latex$1.toSymbol(this.name,t);return"\\"===n[0]?n:" "+n},s}var name$3p="SymbolNode",path$D="expression.node",math$f=!0,factory_1$3y=factory$3y,SymbolNode={name:name$3p,path:path$D,math:math$f,factory:factory_1$3y},latex=latex$1,escape$1=string$a.escape,hasOwnProperty$2=object$6.hasOwnProperty,map$3=array$3.map,validateSafeMethod=customs.validateSafeMethod,getSafeProperty$1=customs.getSafeProperty;function factory$3x(e,t,n,r,a){var i=n(Node),o=n(SymbolNode);function s(t,n){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if("string"==typeof t&&(t=new o(t)),!e.isNode(t))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(n)||!n.every(e.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=t,this.args=n||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var r=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:r,set:r})}s.prototype=new i,s.prototype.type="FunctionNode",s.prototype.isFunctionNode=!0,s.prototype._compile=function(t,n){if(!(this instanceof s))throw new TypeError("No valid FunctionNode");var r=map$3(this.args,(function(e){return e._compile(t,n)}));if(e.isSymbolNode(this.fn)){var a=this.fn.name,i=a in t?getSafeProperty$1(t,a):void 0;if("function"==typeof i&&1==i.rawArgs){var o=this.args;return function(e,n,r){return(a in e?getSafeProperty$1(e,a):i)(o,t,e)}}if(1===r.length){var l=r[0];return function(e,t,n){return(a in e?getSafeProperty$1(e,a):i)(l(e,t,n))}}if(2===r.length){l=r[0];var u=r[1];return function(e,t,n){return(a in e?getSafeProperty$1(e,a):i)(l(e,t,n),u(e,t,n))}}return function(e,t,n){return(a in e?getSafeProperty$1(e,a):i).apply(null,map$3(r,(function(r){return r(e,t,n)})))}}if(e.isAccessorNode(this.fn)&&e.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var c=this.fn.object._compile(t,n),p=this.fn.index.getObjectProperty();return o=this.args,function(e,n,a){var i=c(e,n,a);return validateSafeMethod(i,p),i[p]&&i[p].rawArgs?i[p](o,t,e):i[p].apply(i,map$3(r,(function(t){return t(e,n,a)})))}}var d=this.fn._compile(t,n);return function(e,n,a){var i=d(e,n,a);return i&&i.rawArgs?i(o,t,e):i.apply(i,map$3(r,(function(t){return t(e,n,a)})))}},s.prototype.forEach=function(e){for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)},s.prototype.map=function(e){for(var t=this.fn.map(e),n=[],r=0;r<this.args.length;r++)n[r]=this._ifNode(e(this.args[r],"args["+r+"]",this));return new s(t,n)},s.prototype.clone=function(){return new s(this.fn,this.args.slice(0))};var l=s.prototype.toString;function u(t,n,r){for(var a,i="",o=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig"),s=0;null!==(a=o.exec(t));)if(i+=t.substring(s,a.index),s=a.index,"$$"===a[0])i+="$",s++;else{s+=a[0].length;var l=n[a[1]];if(!l)throw new ReferenceError("Template: Property "+a[1]+" does not exist.");if(void 0===a[2])switch(typeof l){case"string":i+=l;break;case"object":if(e.isNode(l))i+=l.toTex(r);else{if(!Array.isArray(l))throw new TypeError("Template: "+a[1]+" has to be a Node, String or array of Nodes");i+=l.map((function(t,n){if(e.isNode(t))return t.toTex(r);throw new TypeError("Template: "+a[1]+"["+n+"] is not a Node.")})).join(",")}break;default:throw new TypeError("Template: "+a[1]+" has to be a Node, String or array of Nodes")}else{if(!e.isNode(l[a[2]]&&l[a[2]]))throw new TypeError("Template: "+a[1]+"["+a[2]+"] is not a Node.");i+=l[a[2]].toTex(r)}}return i+t.slice(s)}s.prototype.toString=function(e){var t,n=this.fn.toString(e);return e&&"object"==typeof e.handler&&hasOwnProperty$2(e.handler,n)&&(t=e.handler[n](this,e)),void 0!==t?t:l.call(this,e)},s.prototype._toString=function(t){var n=this.args.map((function(e){return e.toString(t)}));return(e.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(t)+")":this.fn.toString(t))+"("+n.join(", ")+")"},s.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},s.fromJSON=function(e){return new s(e.fn,e.args)},s.prototype.toHTML=function(e){var t=this.args.map((function(t){return t.toHTML(e)}));return'<span class="math-function">'+escape$1(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};var c=s.prototype.toTex;return s.prototype.toTex=function(e){var t;return e&&"object"==typeof e.handler&&hasOwnProperty$2(e.handler,this.name)&&(t=e.handler[this.name](this,e)),void 0!==t?t:c.call(this,e)},s.prototype._toTex=function(e){var t,n,r=this.args.map((function(t){return t.toTex(e)}));switch(!a[this.name]||"function"!=typeof a[this.name].toTex&&"object"!=typeof a[this.name].toTex&&"string"!=typeof a[this.name].toTex||(t=a[this.name].toTex),typeof t){case"function":n=t(this,e);break;case"string":n=u(t,this,e);break;case"object":switch(typeof t[r.length]){case"function":n=t[r.length](this,e);break;case"string":n=u(t[r.length],this,e)}}return void 0!==n?n:u(latex.defaultTemplate,this,e)},s.prototype.getIdentifier=function(){return this.type+":"+this.name},s}var name$3o="FunctionNode",path$C="expression.node",math$e=!0,factory_1$3x=factory$3x,FunctionNode={name:name$3o,path:path$C,math:math$e,factory:factory_1$3x};function factory$3w(e,t,n,r){var a=n(Node);function i(t,n,r){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!e.isNode(t))throw new TypeError("Node expected");if(!e.isNode(n))throw new TypeError("Node expected");if(r&&!e.isNode(r))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=t,this.end=n,this.step=r||null}function o(e,t){var n=operators$4.getPrecedence(e,t),r={},a=operators$4.getPrecedence(e.start,t);if(r.start=null!==a&&a<=n||"all"===t,e.step){var i=operators$4.getPrecedence(e.step,t);r.step=null!==i&&i<=n||"all"===t}var o=operators$4.getPrecedence(e.end,t);return r.end=null!==o&&o<=n||"all"===t,r}return i.prototype=new a,i.prototype.type="RangeNode",i.prototype.isRangeNode=!0,i.prototype.needsEnd=function(){return this.filter((function(t){return e.isSymbolNode(t)&&"end"===t.name})).length>0},i.prototype._compile=function(e,t){var n=e.range,r=this.start._compile(e,t),a=this.end._compile(e,t);if(this.step){var i=this.step._compile(e,t);return function(e,t,o){return n(r(e,t,o),a(e,t,o),i(e,t,o))}}return function(e,t,i){return n(r(e,t,i),a(e,t,i))}},i.prototype.forEach=function(e){e(this.start,"start",this),e(this.end,"end",this),this.step&&e(this.step,"step",this)},i.prototype.map=function(e){return new i(this._ifNode(e(this.start,"start",this)),this._ifNode(e(this.end,"end",this)),this.step&&this._ifNode(e(this.step,"step",this)))},i.prototype.clone=function(){return new i(this.start,this.end,this.step&&this.step)},i.prototype._toString=function(e){var t,n=o(this,e&&e.parenthesis?e.parenthesis:"keep"),r=this.start.toString(e);if(n.start&&(r="("+r+")"),t=r,this.step){var a=this.step.toString(e);n.step&&(a="("+a+")"),t+=":"+a}var i=this.end.toString(e);return n.end&&(i="("+i+")"),t+":"+i},i.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},i.fromJSON=function(e){return new i(e.start,e.end,e.step)},i.prototype.toHTML=function(e){var t,n=o(this,e&&e.parenthesis?e.parenthesis:"keep"),r=this.start.toHTML(e);if(n.start&&(r='<span class="math-parenthesis math-round-parenthesis">(</span>'+r+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t=r,this.step){var a=this.step.toHTML(e);n.step&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+='<span class="math-operator math-range-operator">:</span>'+a}var i=this.end.toHTML(e);return n.end&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+'<span class="math-operator math-range-operator">:</span>'+i},i.prototype._toTex=function(e){var t=o(this,e&&e.parenthesis?e.parenthesis:"keep"),n=this.start.toTex(e);if(t.start&&(n="\\left("+n+"\\right)"),this.step){var r=this.step.toTex(e);t.step&&(r="\\left("+r+"\\right)"),n+=":"+r}var a=this.end.toTex(e);return t.end&&(a="\\left("+a+"\\right)"),n+":"+a},i}var name$3n="RangeNode",path$B="expression.node",factory_1$3w=factory$3w,RangeNode={name:name$3n,path:path$B,factory:factory_1$3w};function factory$3v(e,t,n,r){var a=n(numeric),i=n(AccessorNode),o=n(ArrayNode),s=n(AssignmentNode),l=n(BlockNode),u=n(ConditionalNode),c=n(ConstantNode),p=n(FunctionAssignmentNode),d=n(IndexNode),m=n(ObjectNode),f=n(OperatorNode),h=n(ParenthesisNode),y=n(FunctionNode),b=n(RangeNode),g=n(SymbolNode);function v(t,n){if(1!==arguments.length&&2!==arguments.length)throw new ArgumentsError_1("parse",arguments.length,1,2);if(S=n&&n.nodes?n.nodes:{},"string"==typeof t)return w=t,z();if(Array.isArray(t)||t instanceof e.Matrix)return deepMap(t,(function(e){if("string"!=typeof e)throw new TypeError("String expected");return w=e,z()}));throw new TypeError("String or matrix expected")}var T={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"'":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},C={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},N={true:!0,false:!1,null:null,undefined:void 0},A=["NaN","Infinity"],S={},w="",x="",V=0,E="",$="",_=0,O=0,I=null,D=[];function R(){V++,E=w.charAt(V)}function P(){return w.charAt(V-1)}function k(){return w.charAt(V+1)}function M(){D.push({token_type:_,token:$,comment:x,index:V,c:E})}function F(){var e=D.pop();_=e.token_type,$=e.token,x=e.comment,V=e.index,E=e.c}function B(){for(_=0,$="",x="";v.isWhitespace(E,O);)R();if("#"===E)for(;"\n"!==E&&""!==E;)x+=E,R();if(""!==E){if("\n"===E&&!O)return _=1,$=E,void R();var e=E+k(),t=e+w.charAt(V+2);if(3===t.length&&T[t])return _=1,$=t,R(),R(),void R();if(2===e.length&&T[e])return _=1,$=e,R(),void R();if(T[E])return _=1,$=E,void R();if(v.isDigitDot(E)){if(_=2,"."===E)$+=E,R(),v.isDigit(E)||(_=1);else{for(;v.isDigit(E);)$+=E,R();v.isDecimalMark(E,k())&&($+=E,R())}for(;v.isDigit(E);)$+=E,R();if(e=k(),"E"===E||"e"===E)if(v.isDigit(e)||"-"===e||"+"===e){if($+=E,R(),"+"!==E&&"-"!==E||($+=E,R()),!v.isDigit(E))throw ue('Digit expected, got "'+E+'"');for(;v.isDigit(E);)$+=E,R();if(v.isDecimalMark(E,k()))throw ue('Digit expected, got "'+E+'"')}else if("."===e)throw R(),ue('Digit expected, got "'+E+'"')}else{if(!v.isAlpha(E,P(),k())){for(_=4;""!==E;)$+=E,R();throw ue('Syntax error in part "'+$+'"')}for(;v.isAlpha(E,P(),k())||v.isDigit(E);)$+=E,R();_=C.hasOwnProperty($)?1:3}}else _=1}function L(){do{B()}while("\n"===$)}function j(){O++}function U(){O--}function z(){V=0,E=w.charAt(0),O=0,I=null,B();var e=function(){var e,t,n=[];for(""!==$&&"\n"!==$&&";"!==$&&((e=H()).comment=x);"\n"===$||";"===$;)0===n.length&&e&&(t=";"!==$,n.push({node:e,visible:t})),B(),"\n"!==$&&";"!==$&&""!==$&&((e=H()).comment=x,t=";"!==$,n.push({node:e,visible:t}));return n.length>0?new l(n):(e||((e=new c(void 0)).comment=x),e)}();if(""!==$)throw 1===_?ce("Unexpected operator "+$):ue('Unexpected part "'+$+'"');return e}function H(){var t,n,r,a,i=function(){for(var e=function(){for(var e=G();"or"===$;)L(),e=new f("or","or",[e,G()]);return e}();"?"===$;){var t=I;I=O,L();var n=e,r=H();if(":"!==$)throw ue("False part of conditional expression expected");I=null,L();var a=H();e=new u(n,r,a),I=t}return e}();if("="===$){if(e.isSymbolNode(i))return t=i.name,L(),r=H(),new s(new g(t),r);if(e.isAccessorNode(i))return L(),r=H(),new s(i.object,i.index,r);if(e.isFunctionNode(i)&&e.isSymbolNode(i.fn)&&(a=!0,n=[],t=i.name,i.args.forEach((function(t,r){e.isSymbolNode(t)?n[r]=t.name:a=!1})),a))return L(),r=H(),new p(t,n,r);throw ue("Invalid left hand side of assignment operator =")}return i}function G(){for(var e=W();"xor"===$;)L(),e=new f("xor","xor",[e,W()]);return e}function W(){for(var e=q();"and"===$;)L(),e=new f("and","and",[e,q()]);return e}function q(){for(var e=K();"|"===$;)L(),e=new f("|","bitOr",[e,K()]);return e}function K(){for(var e=X();"^|"===$;)L(),e=new f("^|","bitXor",[e,X()]);return e}function X(){for(var e=Y();"&"===$;)L(),e=new f("&","bitAnd",[e,Y()]);return e}function Y(){var e,t,n,r,a;for(e=Z(),t={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};t.hasOwnProperty($);)r=t[n=$],L(),a=[e,Z()],e=new f(n,r,a);return e}function Z(){var e,t,n,r,a;for(e=J(),t={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};t.hasOwnProperty($);)r=t[n=$],L(),a=[e,J()],e=new f(n,r,a);return e}function J(){var e,t,n,r,a;for(e=Q(),t={to:"to",in:"to"};t.hasOwnProperty($);)r=t[n=$],L(),"in"===n&&""===$?e=new f("*","multiply",[e,new g("in")],!0):(a=[e,Q()],e=new f(n,r,a));return e}function Q(){var e,t=[];if(e=":"===$?new c(1):ee(),":"===$&&I!==O){for(t.push(e);":"===$&&t.length<3;)L(),")"===$||"]"===$||","===$||""===$?t.push(new g("end")):t.push(ee());e=3===t.length?new b(t[0],t[2],t[1]):new b(t[0],t[1])}return e}function ee(){var e,t,n,r,a;for(e=te(),t={"+":"add","-":"subtract"};t.hasOwnProperty($);)r=t[n=$],L(),a=[e,te()],e=new f(n,r,a);return e}function te(){var e,t,n,r,a;for(t=e=ne(),n={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};n.hasOwnProperty($);)a=n[r=$],L(),t=ne(),e=new f(r,a,[e,t]);return e}function ne(){var t,n;for(n=t=re();3===_||"in"===$&&e.isConstantNode(t)||!(2!==_||e.isConstantNode(n)||e.isOperatorNode(n)&&"!"!==n.op)||"("===$;)n=re(),t=new f("*","multiply",[t,n],!0);return t}function re(){var t,n;for(n=t=ae();"/"===$&&e.isConstantNode(n);){if(M(),L(),2!==_){F();break}if(M(),L(),3!==_&&"("!==$){F(),F();break}F(),D.pop(),n=ae(),t=new f("/","divide",[t,n])}return t}function ae(){var e,n,r,i={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return i.hasOwnProperty($)?(r=i[$],e=$,L(),n=[ae()],new f(e,r,n)):function(){var e,n,r,i;return e=function(){var e,n,r,i;for(e=function(){var e=[];if(3===_&&S.hasOwnProperty($)){var n=S[$];if(B(),"("===$){if(e=[],j(),B(),")"!==$)for(e.push(H());","===$;)B(),e.push(H());if(")"!==$)throw ue("Parenthesis ) expected");U(),B()}return new n(e)}return function(){var e;return 3===_||1===_&&$ in C?(e=$,B(),ie(N.hasOwnProperty(e)?new c(N[e]):-1!==A.indexOf(e)?new c(a(e)):new g(e))):function(){var e;return'"'===$?(e=oe(),ie(new c(e))):function(){var e,n,r,i;if("["===$){if(j(),B(),"]"!==$){var s=se();if(";"===$){for(r=1,n=[s];";"===$;)B(),n[r]=se(),r++;if("]"!==$)throw ue("End of matrix ] expected");U(),B(),i=n[0].items.length;for(var l=1;l<r;l++)if(n[l].items.length!==i)throw ce("Column dimensions mismatch ("+n[l].items.length+" !== "+i+")");e=new o(n)}else{if("]"!==$)throw ue("End of matrix ] expected");U(),B(),e=s}}else U(),B(),e=new o([]);return ie(e)}return function(){if("{"===$){var e,n={};do{if(B(),"}"!==$){if('"'===$)e=oe();else{if(3!==_)throw ue("Symbol or string expected as object key");e=$,B()}if(":"!==$)throw ue("Colon : expected after object key");B(),n[e]=H()}}while(","===$);if("}"!==$)throw ue("Comma , or bracket } expected after object value");B();var r=new m(n);return ie(r)}return function(){var e;return 2===_?(e=$,B(),new c(a(e,t.number))):function(){var e;if("("===$){if(j(),B(),e=H(),")"!==$)throw ue("Parenthesis ) expected");return U(),B(),ie(e=new h(e))}return function(){throw ue(""===$?"Unexpected end of expression":"'"===$?"Value expected. Note: strings must be enclosed by double quotes":"Value expected")}()}()}()}()}()}()}()}(),n={"!":"factorial","'":"transpose"};n.hasOwnProperty($);)i=n[r=$],B(),e=ie(e=new f(r,i,[e]));return e}(),("^"===$||".^"===$)&&(r="^"===(n=$)?"pow":"dotPow",L(),i=[e,ae()],e=new f(n,r,i)),e}()}function ie(t,n){for(var r;!("("!==$&&"["!==$&&"."!==$||n&&-1===n.indexOf($));)if(r=[],"("===$){if(!e.isSymbolNode(t)&&!e.isAccessorNode(t))return t;if(j(),B(),")"!==$)for(r.push(H());","===$;)B(),r.push(H());if(")"!==$)throw ue("Parenthesis ) expected");U(),B(),t=new y(t,r)}else if("["===$){if(j(),B(),"]"!==$)for(r.push(H());","===$;)B(),r.push(H());if("]"!==$)throw ue("Parenthesis ] expected");U(),B(),t=new i(t,new d(r))}else{if(B(),3!==_)throw ue("Property name expected after dot");r.push(new c($)),B(),t=new i(t,new d(r,!0))}return t}function oe(){for(var e="";""!==E&&'"'!==E;)"\\"===E&&(e+=E,R()),e+=E,R();if(B(),'"'!==$)throw ue('End of string " expected');return B(),JSON.parse('"'+e+'"')}function se(){for(var e=[H()],t=1;","===$;)B(),e[t]=H(),t++;return new o(e)}function le(){return V-$.length+1}function ue(e){var t=le(),n=new SyntaxError(e+" (char "+t+")");return n.char=t,n}function ce(e){var t=le(),n=new SyntaxError(e+" (char "+t+")");return n.char=t,n}return v.isAlpha=function(e,t,n){return v.isValidLatinOrGreek(e)||v.isValidMathSymbol(e,n)||v.isValidMathSymbol(t,e)},v.isValidLatinOrGreek=function(e){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(e)},v.isValidMathSymbol=function(e,t){return/^[\uD835]$/.test(e)&&/^[\uDC00-\uDFFF]$/.test(t)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(t)},v.isWhitespace=function(e,t){return" "===e||"\t"===e||"\n"===e&&t>0},v.isDecimalMark=function(e,t){return"."===e&&"/"!==t&&"*"!==t&&"^"!==t},v.isDigitDot=function(e){return e>="0"&&e<="9"||"."===e},v.isDigit=function(e){return e>="0"&&e<="9"},v}var name$3m="parse",path$A="expression",factory_1$3v=factory$3v,parse$3={name:name$3m,path:path$A,factory:factory_1$3v};function factory$3u(e,t,n,r){var a=n(parse$3);return r("compile",{string:function(e){return a(e).compile()},"Array | Matrix":function(e){return deepMap(e,(function(e){return a(e).compile()}))}})}var name$3l="compile",factory_1$3u=factory$3u,compile={name:name$3l,factory:factory_1$3u};function factory$3t(e,t,n,r){var a=n(parse$3);return r("compile",{string:function(e){return a(e).compile().eval({})},"string, Object":function(e,t){return a(e).compile().eval(t)},"Array | Matrix":function(e){var t={};return deepMap(e,(function(e){return a(e).compile().eval(t)}))},"Array | Matrix, Object":function(e,t){return deepMap(e,(function(e){return a(e).compile().eval(t)}))}})}var name$3k="eval",factory_1$3t=factory$3t,_eval={name:name$3k,factory:factory_1$3t},getSafeProperty=customs.getSafeProperty;function factory$3s(e,t,n,r,a){var i=n(embeddedDocs);return r("help",{any:function(t){var n,r=t;if("string"!=typeof t)for(n in a)if(a.hasOwnProperty(n)&&t===a[n]){r=n;break}var o=getSafeProperty(i,r);if(!o)throw new Error('No documentation found on "'+r+'"');return new e.Help(o)}})}var math$d=!0,name$3j="help",factory_1$3s=factory$3s,help={math:math$d,name:name$3j,factory:factory_1$3s};function factory$3r(e,t,n,r){var a=n(parse$3);return r("parse",{"string | Array | Matrix":a,"string | Array | Matrix, Object":a})}var name$3i="parse",factory_1$3r=factory$3r,parse$2={name:name$3i,factory:factory_1$3r},extend$4=object$6.extend;function factory$3q(e,t,n,r,a){var i=n(parse$3);function o(){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");this.scope={}}return o.prototype.type="Parser",o.prototype.isParser=!0,o.prototype.parse=function(e){throw new Error("Parser.parse is deprecated. Use math.parse instead.")},o.prototype.compile=function(e){throw new Error("Parser.compile is deprecated. Use math.compile instead.")},o.prototype.eval=function(e){return i(e).compile().eval(this.scope)},o.prototype.get=function(e){return e in this.scope?customs.getSafeProperty(this.scope,e):void 0},o.prototype.getAll=function(){return extend$4({},this.scope)},o.prototype.set=function(e,t){return customs.setSafeProperty(this.scope,e,t)},o.prototype.remove=function(e){delete this.scope[e]},o.prototype.clear=function(){for(var e in this.scope)this.scope.hasOwnProperty(e)&&delete this.scope[e]},o}var name$3h="Parser",path$z="expression",factory_1$3q=factory$3q,math$c=!0,Parser={name:name$3h,path:path$z,factory:factory_1$3q,math:math$c};function factory$3p(e,t,n,r,a){var i=n(Parser);return r("parser",{"":function(){return new i(a)}})}var name$3g="parser",factory_1$3p=factory$3p,math$b=!0,parser={name:name$3g,factory:factory_1$3p,math:math$b},_function$1=[compile,_eval,help,parse$2,parser];function factory$3o(e,t,n,r){return function(){throw new Error("UpdateNode is deprecated. Use AssignmentNode instead.")}}var name$3f="UpdateNode",path$y="expression.node",factory_1$3o=factory$3o,UpdateNode={name:name$3f,path:path$y,factory:factory_1$3o},node$2=[AccessorNode,ArrayNode,AssignmentNode,BlockNode,ConditionalNode,ConstantNode,IndexNode,FunctionAssignmentNode,FunctionNode,Node,ObjectNode,OperatorNode,ParenthesisNode,RangeNode,SymbolNode,UpdateNode],clone$7=object$6.clone,isInteger$p=number$5.isInteger;function factory$3n(e,t,n,r){var a=n(matrix$5),i=r("concat",{"...Array | Matrix | number | BigNumber":function(t){var n,r,i=t.length,o=-1,s=!1,l=[];for(n=0;n<i;n++){var u=t[n];if(e.isMatrix(u)&&(s=!0),e.isNumber(u)||e.isBigNumber(u)){if(n!==i-1)throw new Error("Dimension must be specified as last argument");if(r=o,o=u.valueOf(),!isInteger$p(o))throw new TypeError("Integer number expected for dimension");if(o<0||n>0&&o>r)throw new IndexError_1(o,r+1)}else{var c=clone$7(u).valueOf(),p=array$3.size(c);if(l[n]=c,r=o,o=p.length-1,n>0&&o!=r)throw new DimensionError_1(r+1,o+1)}}if(0==l.length)throw new SyntaxError("At least one matrix expected");for(var d=l.shift();l.length;)d=_concat(d,l.shift(),o,0);return s?a(d):d},"...string":function(e){return e.join("")}});return i.toTex=void 0,i}function _concat(e,t,n,r){if(r<n){if(e.length!=t.length)throw new DimensionError_1(e.length,t.length);for(var a=[],i=0;i<e.length;i++)a[i]=_concat(e[i],t[i],n,r+1);return a}return e.concat(t)}var name$3e="concat",factory_1$3n=factory$3n,concat={name:name$3e,factory:factory_1$3n},errorTransform$4=error_transform.transform;function factory$3m(e,t,n,r){var a=n(concat);return r("concat",{"...any":function(t){var n=t.length-1,r=t[n];e.isNumber(r)?t[n]=r-1:e.isBigNumber(r)&&(t[n]=r.minus(1));try{return a.apply(null,t)}catch(e){throw errorTransform$4(e)}}})}var name$3d="concat",path$x="expression.transform",factory_1$3m=factory$3m,concat_transform={name:name$3d,path:path$x,factory:factory_1$3m};function factory$3l(e,t,n,r){return function(t,n,r){var a=t.filter((function(t){return e.isSymbolNode(t)&&!(t.name in n)&&!(t.name in r)}))[0];if(!a)throw new Error('No undefined variable found in inline expression "'+t+'"');var i=a.name,o=Object.create(r),s=t.compile();return function(e){return o[i]=e,s.eval(o)}}}var factory_1$3l=factory$3l,compileInlineExpression={factory:factory_1$3l},filter$2=array$3.filter,filterRegExp$1=array$3.filterRegExp,maxArgumentCount$5=_function$3.maxArgumentCount;function factory$3k(e,t,n,r){var a=n(compileInlineExpression),i=n(matrix$5);function o(t,n,r){var i,o;return t[0]&&(i=t[0].compile().eval(r)),t[1]&&(o=e.isSymbolNode(t[1])||e.isFunctionAssignmentNode(t[1])?t[1].compile().eval(r):a(t[1],n,r)),s(i,o)}o.rawArgs=!0;var s=r("filter",{"Array, function":_filter,"Matrix, function":function(e,t){return i(_filter(e.toArray(),t))},"Array, RegExp":filterRegExp$1,"Matrix, RegExp":function(e,t){return i(filterRegExp$1(e.toArray(),t))}});return s.toTex=void 0,o}function _filter(e,t){var n=maxArgumentCount$5(t);return filter$2(e,(function(e,r,a){return 1===n?t(e):2===n?t(e,[r+1]):t(e,[r+1],a)}))}var name$3c="filter",path$w="expression.transform",factory_1$3k=factory$3k,filter_transform={name:name$3c,path:path$w,factory:factory_1$3k},maxArgumentCount$4=_function$3.maxArgumentCount,forEach$1=array$3.forEach;function factory$3j(e,t,n,r){var a=n(compileInlineExpression);function i(t,n,r){var i,s;return t[0]&&(i=t[0].compile().eval(r)),t[1]&&(s=e.isSymbolNode(t[1])||e.isFunctionAssignmentNode(t[1])?t[1].compile().eval(r):a(t[1],n,r)),o(i,s)}i.rawArgs=!0;var o=r("forEach",{"Array | Matrix, function":function(e,t){var n=maxArgumentCount$4(t),r=function(a,i){Array.isArray(a)?forEach$1(a,(function(e,t){r(e,i.concat(t+1))})):1===n?t(a):2===n?t(a,i):t(a,i,e)};r(e.valueOf(),[])}});return i}var name$3b="forEach",path$v="expression.transform",factory_1$3j=factory$3j,forEach_transform={name:name$3b,path:path$v,factory:factory_1$3j};function factory$3i(e,t,n){return function(){for(var t=[],n=0,r=arguments.length;n<r;n++){var a=arguments[n];if(e.isRange(a))a.start--,a.end-=a.step>0?0:2;else if(a&&!0===a.isSet)a=a.map((function(e){return e-1}));else if(e.isArray(a)||e.isMatrix(a))a=a.map((function(e){return e-1}));else if(e.isNumber(a))a--;else if(e.isBigNumber(a))a=a.toNumber()-1;else if("string"!=typeof a)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");t[n]=a}var i=new e.Index;return e.Index.apply(i,t),i}}var name$3a="index",path$u="expression.transform",factory_1$3i=factory$3i,index_transform={name:name$3a,path:path$u,factory:factory_1$3i},maxArgumentCount$3=_function$3.maxArgumentCount,map$2=array$3.map;function factory$3h(e,t,n,r){var a=n(compileInlineExpression),i=n(matrix$5);function o(t,n,r){var i,o;return t[0]&&(i=t[0].compile().eval(r)),t[1]&&(o=e.isSymbolNode(t[1])||e.isFunctionAssignmentNode(t[1])?t[1].compile().eval(r):a(t[1],n,r)),s(i,o)}o.rawArgs=!0;var s=r("map",{"Array, function":function(e,t){return _map$1(e,t,e)},"Matrix, function":function(e,t){return i(_map$1(e.valueOf(),t,e))}});return o}function _map$1(e,t,n){var r=maxArgumentCount$3(t);return function e(a,i){return Array.isArray(a)?map$2(a,(function(t,n){return e(t,i.concat(n+1))})):1===r?t(a):2===r?t(a,i):t(a,i,n)}(e,[])}var name$39="map",path$t="expression.transform",factory_1$3h=factory$3h,map_transform={name:name$39,path:path$t,factory:factory_1$3h},isCollection=function(e){return Array.isArray(e)||isMatrix(e)},deepForEach=function e(t,n){isMatrix(t)&&(t=t.valueOf());for(var r=0,a=t.length;r<a;r++){var i=t[r];Array.isArray(i)?e(i,n):n(i)}},arraySize=array$3.size,reduce$2=function(e,t,n){var r=Array.isArray(e)?arraySize(e):e.size();if(t<0||t>=r.length)throw new IndexError_1(t,r.length);return isMatrix(e)?e.create(_reduce(e.valueOf(),t,n)):_reduce(e,t,n)};function _reduce(e,t,n){var r,a,i,o;if(t<=0){if(Array.isArray(e[0])){for(o=_switch(e),a=[],r=0;r<o.length;r++)a[r]=_reduce(o[r],t-1,n);return a}for(i=e[0],r=1;r<e.length;r++)i=n(i,e[r]);return i}for(a=[],r=0;r<e.length;r++)a[r]=_reduce(e[r],t-1,n);return a}function _switch(e){var t,n,r=e.length,a=e[0].length,i=[];for(n=0;n<a;n++){var o=[];for(t=0;t<r;t++)o.push(e[t][n]);i.push(o)}return i}var containsCollections=function(e){for(var t=0;t<e.length;t++)if(isCollection(e[t]))return!0;return!1};function factory$3g(e,t,n,r){var a=n(_typeof);return function(e,t,n){var r;return-1!==String(e).indexOf("Unexpected type")?(r=arguments.length>2?" (type: "+a(n)+", value: "+JSON.stringify(n)+")":" (type: "+e.data.actual+")",new TypeError("Cannot calculate "+t+", unexpected type of argument"+r)):-1!==String(e).indexOf("complex numbers")?(r=arguments.length>2?" (type: "+a(n)+", value: "+JSON.stringify(n)+")":"",new TypeError("Cannot calculate "+t+", no ordering relation is defined for complex numbers"+r)):e}}var factory_1$3g=factory$3g,improveErrorMessage={factory:factory_1$3g};function factory$3f(e,t,n,r){var a=n(larger$1),i=n(improveErrorMessage),o=r("max",{"Array | Matrix":l,"Array | Matrix, number | BigNumber":function(e,t){return reduce$2(e,t.valueOf(),s)},"...":function(e){if(containsCollections(e))throw new TypeError("Scalar values expected in function max");return l(e)}});return o.toTex="\\max\\left(${args}\\right)",o;function s(e,t){try{return a(e,t)?e:t}catch(e){throw i(e,"max",t)}}function l(e){var t=void 0;if(deepForEach(e,(function(e){try{(void 0===t||a(e,t))&&(t=e)}catch(t){throw i(t,"max",e)}})),void 0===t)throw new Error("Cannot calculate max of an empty array");return t}}var name$38="max",factory_1$3f=factory$3f,max$1={name:name$38,factory:factory_1$3f},errorTransform$3=error_transform.transform;function factory$3e(e,t,n,r){var a=n(max$1);return r("max",{"...any":function(t){if(2==t.length&&isCollection(t[0])){var n=t[1];e.isNumber(n)?t[1]=n-1:e.isBigNumber(n)&&(t[1]=n.minus(1))}try{return a.apply(null,t)}catch(e){throw errorTransform$3(e)}}})}var name$37="max",path$s="expression.transform",factory_1$3e=factory$3e,max_transform={name:name$37,path:path$s,factory:factory_1$3e};function factory$3d(e,t,n,r){var a=r("multiplyScalar",{"number, number":function(e,t){return e*t},"Complex, Complex":function(e,t){return e.mul(t)},"BigNumber, BigNumber":function(e,t){return e.times(t)},"Fraction, Fraction":function(e,t){return e.mul(t)},"number | Fraction | BigNumber | Complex, Unit":function(e,t){var n=t.clone();return n.value=null===n.value?n._normalize(e):a(n.value,e),n},"Unit, number | Fraction | BigNumber | Complex":function(e,t){var n=e.clone();return n.value=null===n.value?n._normalize(t):a(n.value,t),n},"Unit, Unit":function(e,t){return e.multiply(t)}});return a}var factory_1$3d=factory$3d,multiplyScalar={factory:factory_1$3d};function factory$3c(e,t,n,r){var a=n(multiplyScalar),i=r("divide",{"number, number":function(e,t){return e/t},"Complex, Complex":function(e,t){return e.div(t)},"BigNumber, BigNumber":function(e,t){return e.div(t)},"Fraction, Fraction":function(e,t){return e.div(t)},"Unit, number | Fraction | BigNumber":function(e,t){var n=e.clone();return n.value=i(null===n.value?n._normalize(1):n.value,t),n},"number | Fraction | BigNumber, Unit":function(e,t){var n=t.pow(-1);return n.value=a(null===n.value?n._normalize(1):n.value,e),n},"Unit, Unit":function(e,t){return e.divide(t)}});return i}var factory_1$3c=factory$3c,divideScalar={factory:factory_1$3c};function factory$3b(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n,o){var s=e._values,l=e._index,u=e._ptr,c=e._size,p=e._datatype;if(!s)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var d,m=c[0],f=c[1],h=a,y=0,b=n;"string"==typeof p&&(d=p,h=r.find(a,[d,d]),y=r.convert(0,d),t=r.convert(t,d),b=r.find(n,[d,d]));for(var g=[],v=[],T=[],C=new i({values:g,index:v,ptr:T,size:[m,f],datatype:d}),N=0;N<f;N++){T[N]=v.length;for(var A=u[N],S=u[N+1],w=A;w<S;w++){var x=l[w],V=o?b(t,s[w]):b(s[w],t);h(V,y)||(v.push(x),g.push(V))}}return T[f]=v.length,C}}var name$36="algorithm11",factory_1$3b=factory$3b,algorithm11={name:name$36,factory:factory_1$3b},extend$3=object$6.extend;function factory$3a(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(addScalar),s=n(multiplyScalar),l=n(equalScalar),u=n(algorithm11),c=n(algorithm14),p=e.DenseMatrix,d=e.SparseMatrix,m=r("multiply",extend$3({"Array, Array":function(t,n){f(array$3.size(t),array$3.size(n));var r=m(i(t),i(n));return e.isMatrix(r)?r.valueOf():r},"Matrix, Matrix":function(e,t){var n=e.size(),r=t.size();return f(n,r),1===n.length?1===r.length?h(e,t,n[0]):y(e,t):1===r.length?g(e,t):v(e,t)},"Matrix, Array":function(e,t){return m(e,i(t))},"Array, Matrix":function(e,t){return m(i(e,t.storage()),t)},"SparseMatrix, any":function(e,t){return u(e,t,s,!1)},"DenseMatrix, any":function(e,t){return c(e,t,s,!1)},"any, SparseMatrix":function(e,t){return u(t,e,s,!0)},"any, DenseMatrix":function(e,t){return c(t,e,s,!0)},"Array, any":function(e,t){return c(i(e),t,s,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,s,!0).valueOf()},"any, any":s,"any, any, ...any":function(e,t,n){for(var r=m(e,t),a=0;a<n.length;a++)r=m(r,n[a]);return r}},s.signatures)),f=function(e,t){switch(e.length){case 1:switch(t.length){case 1:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+e[0]+") must match Matrix rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;case 2:switch(t.length){case 1:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+e[1]+") must match Vector length ("+t[0]+")");break;case 2:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+e[1]+") must match Matrix B rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+e.length+" dimensions)")}},h=function(e,t,n){if(0===n)throw new Error("Cannot multiply two empty vectors");var a,i=e._data,l=e._datatype,u=t._data,c=t._datatype,p=o,d=s;l&&c&&l===c&&"string"==typeof l&&(a=l,p=r.find(o,[a,a]),d=r.find(s,[a,a]));for(var m=d(i[0],u[0]),f=1;f<n;f++)m=p(m,d(i[f],u[f]));return m},y=function(e,t){if("dense"!==t.storage())throw new Error("Support for SparseMatrix not implemented");return b(e,t)},b=function(e,t){var n,a=e._data,i=e._size,l=e._datatype,u=t._data,c=t._size,d=t._datatype,m=i[0],f=c[1],h=o,y=s;l&&d&&l===d&&"string"==typeof l&&(n=l,h=r.find(o,[n,n]),y=r.find(s,[n,n]));for(var b=[],g=0;g<f;g++){for(var v=y(a[0],u[0][g]),T=1;T<m;T++)v=h(v,y(a[T],u[T][g]));b[g]=v}return new p({data:b,size:[f],datatype:n})},g=r("_multiplyMatrixVector",{"DenseMatrix, any":function(e,t){var n,a=e._data,i=e._size,l=e._datatype,u=t._data,c=t._datatype,d=i[0],m=i[1],f=o,h=s;l&&c&&l===c&&"string"==typeof l&&(n=l,f=r.find(o,[n,n]),h=r.find(s,[n,n]));for(var y=[],b=0;b<d;b++){for(var g=a[b],v=h(g[0],u[0]),T=1;T<m;T++)v=f(v,h(g[T],u[T]));y[b]=v}return new p({data:y,size:[d],datatype:n})},"SparseMatrix, any":function(e,t){var n=e._values,a=e._index,i=e._ptr,u=e._datatype;if(!n)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,p=t._data,m=t._datatype,f=e._size[0],h=t._size[0],y=[],b=[],g=[],v=o,T=s,C=l,N=0;u&&m&&u===m&&"string"==typeof u&&(c=u,v=r.find(o,[c,c]),T=r.find(s,[c,c]),C=r.find(l,[c,c]),N=r.convert(0,c));var A=[],S=[];g[0]=0;for(var w=0;w<h;w++){var x=p[w];if(!C(x,N))for(var V=i[w],E=i[w+1],$=V;$<E;$++){var _=a[$];S[_]?A[_]=v(A[_],T(x,n[$])):(S[_]=!0,b.push(_),A[_]=T(x,n[$]))}}for(var O=b.length,I=0;I<O;I++){var D=b[I];y[I]=A[D]}return g[1]=b.length,new d({values:y,index:b,ptr:g,size:[f,1],datatype:c})}}),v=r("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(e,t){var n,a=e._data,i=e._size,l=e._datatype,u=t._data,c=t._size,d=t._datatype,m=i[0],f=i[1],h=c[1],y=o,b=s;l&&d&&l===d&&"string"==typeof l&&(n=l,y=r.find(o,[n,n]),b=r.find(s,[n,n]));for(var g=[],v=0;v<m;v++){var T=a[v];g[v]=[];for(var C=0;C<h;C++){for(var N=b(T[0],u[0][C]),A=1;A<f;A++)N=y(N,b(T[A],u[A][C]));g[v][C]=N}}return new p({data:g,size:[m,h],datatype:n})},"DenseMatrix, SparseMatrix":function(e,t){var n=e._data,a=e._size,i=e._datatype,u=t._values,c=t._index,p=t._ptr,m=t._size,f=t._datatype;if(!u)throw new Error("Cannot multiply Dense Matrix times Pattern only Matrix");var h,y=a[0],b=m[1],g=o,v=s,T=l,C=0;i&&f&&i===f&&"string"==typeof i&&(h=i,g=r.find(o,[h,h]),v=r.find(s,[h,h]),T=r.find(l,[h,h]),C=r.convert(0,h));for(var N=[],A=[],S=[],w=new d({values:N,index:A,ptr:S,size:[y,b],datatype:h}),x=0;x<b;x++){S[x]=A.length;var V=p[x],E=p[x+1];if(E>V)for(var $=0,_=0;_<y;_++){for(var O,I=_+1,D=V;D<E;D++){var R=c[D];$!==I?(O=v(n[_][R],u[D]),$=I):O=g(O,v(n[_][R],u[D]))}$!==I||T(O,C)||(A.push(_),N.push(O))}}return S[b]=A.length,w},"SparseMatrix, DenseMatrix":function(e,t){var n=e._values,a=e._index,i=e._ptr,u=e._datatype;if(!n)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,p=t._data,m=t._datatype,f=e._size[0],h=t._size[0],y=t._size[1],b=o,g=s,v=l,T=0;u&&m&&u===m&&"string"==typeof u&&(c=u,b=r.find(o,[c,c]),g=r.find(s,[c,c]),v=r.find(l,[c,c]),T=r.convert(0,c));for(var C=[],N=[],A=[],S=new d({values:C,index:N,ptr:A,size:[f,y],datatype:c}),w=[],x=[],V=0;V<y;V++){A[V]=N.length;for(var E=V+1,$=0;$<h;$++){var _=p[$][V];if(!v(_,T))for(var O=i[$],I=i[$+1],D=O;D<I;D++){var R=a[D];x[R]!==E?(x[R]=E,N.push(R),w[R]=g(_,n[D])):w[R]=b(w[R],g(_,n[D]))}}for(var P=A[V],k=N.length,M=P;M<k;M++){var F=N[M];C[M]=w[F]}}return A[y]=N.length,S},"SparseMatrix, SparseMatrix":function(e,t){var n,a=e._values,i=e._index,l=e._ptr,u=e._datatype,c=t._values,p=t._index,m=t._ptr,f=t._datatype,h=e._size[0],y=t._size[1],b=a&&c,g=o,v=s;u&&f&&u===f&&"string"==typeof u&&(n=u,g=r.find(o,[n,n]),v=r.find(s,[n,n]));for(var T,C,N,A,S,w,x,V,E=b?[]:void 0,$=[],_=[],O=new d({values:E,index:$,ptr:_,size:[h,y],datatype:n}),I=b?[]:void 0,D=[],R=0;R<y;R++){_[R]=$.length;var P=R+1;for(S=m[R],w=m[R+1],A=S;A<w;A++)if(V=p[A],b)for(C=l[V],N=l[V+1],T=C;T<N;T++)D[x=i[T]]!==P?(D[x]=P,$.push(x),I[x]=v(c[A],a[T])):I[x]=g(I[x],v(c[A],a[T]));else for(C=l[V],N=l[V+1],T=C;T<N;T++)D[x=i[T]]!==P&&(D[x]=P,$.push(x));if(b)for(var k=_[R],M=$.length,F=k;F<M;F++){var B=$[F];E[F]=I[B]}}return _[y]=$.length,O}});return m.toTex={2:"\\left(${args[0]}"+a.operators.multiply+"${args[1]}\\right)"},m}var name$35="multiply",factory_1$3a=factory$3a,multiply$1={name:name$35,factory:factory_1$3a};function factory$39(e,t,n,r){var a=latex$1,i=r("unaryMinus",{number:function(e){return-e},Complex:function(e){return e.neg()},BigNumber:function(e){return e.neg()},Fraction:function(e){return e.neg()},Unit:function(e){var t=e.clone();return t.value=i(e.value),t},"Array | Matrix":function(e){return deepMap(e,i)}});return i.toTex={1:a.operators.unaryMinus+"\\left(${args[0]}\\right)"},i}var name$34="unaryMinus",factory_1$39=factory$39,unaryMinus={name:name$34,factory:factory_1$39};function factory$38(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype,p=t._values,d=t._index,m=t._ptr,f=t._size,h=t._datatype;if(u.length!==f.length)throw new DimensionError_1(u.length,f.length);if(u[0]!==f[0]||u[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+f+")");var y,b=u[0],g=u[1],v=a,T=0,C=n;"string"==typeof c&&c===h&&(y=c,v=r.find(a,[y,y]),T=r.convert(0,y),C=r.find(n,[y,y]));var N,A,S,w,x=o&&p?[]:void 0,V=[],E=[],$=new i({values:x,index:V,ptr:E,size:[b,g],datatype:y}),_=x?[]:void 0,O=x?[]:void 0,I=[],D=[];for(A=0;A<g;A++){E[A]=V.length;var R=A+1;for(S=l[A],w=l[A+1];S<w;S++)N=s[S],V.push(N),I[N]=R,_&&(_[N]=o[S]);for(S=m[A],w=m[A+1];S<w;S++)I[N=d[S]]!==R&&V.push(N),D[N]=R,O&&(O[N]=p[S]);if(x)for(S=E[A];S<V.length;){var P=I[N=V[S]],k=D[N];if(P===R||k===R){var M=C(P===R?_[N]:T,k===R?O[N]:T);v(M,T)?V.splice(S,1):(x.push(M),S++)}}}return E[g]=V.length,$}}var name$33="algorithm05",factory_1$38=factory$38,algorithm05={name:name$33,factory:factory_1$38};function factory$37(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(addScalar),s=n(unaryMinus),l=n(algorithm01),u=n(algorithm03),c=n(algorithm05),p=n(algorithm10),d=n(algorithm13),m=n(algorithm14),f=r("subtract",{"number, number":function(e,t){return e-t},"Complex, Complex":function(e,t){return e.sub(t)},"BigNumber, BigNumber":function(e,t){return e.minus(t)},"Fraction, Fraction":function(e,t){return e.sub(t)},"Unit, Unit":function(e,t){if(null==e.value)throw new Error("Parameter x contains a unit with undefined value");if(null==t.value)throw new Error("Parameter y contains a unit with undefined value");if(!e.equalBase(t))throw new Error("Units do not match");var n=e.clone();return n.value=f(n.value,t.value),n.fixPrefix=!1,n},"SparseMatrix, SparseMatrix":function(e,t){return checkEqualDimensions(e,t),c(e,t,f)},"SparseMatrix, DenseMatrix":function(e,t){return checkEqualDimensions(e,t),u(t,e,f,!0)},"DenseMatrix, SparseMatrix":function(e,t){return checkEqualDimensions(e,t),l(e,t,f,!1)},"DenseMatrix, DenseMatrix":function(e,t){return checkEqualDimensions(e,t),d(e,t,f)},"Array, Array":function(e,t){return f(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return f(i(e),t)},"Matrix, Array":function(e,t){return f(e,i(t))},"SparseMatrix, any":function(e,t){return p(e,s(t),o)},"DenseMatrix, any":function(e,t){return m(e,t,f)},"any, SparseMatrix":function(e,t){return p(t,e,f,!0)},"any, DenseMatrix":function(e,t){return m(t,e,f,!0)},"Array, any":function(e,t){return m(i(e),t,f,!1).valueOf()},"any, Array":function(e,t){return m(i(t),e,f,!0).valueOf()}});return f.toTex={2:"\\left(${args[0]}"+a.operators.subtract+"${args[1]}\\right)"},f}function checkEqualDimensions(e,t){var n=e.size(),r=t.size();if(n.length!==r.length)throw new DimensionError_1(n.length,r.length)}var name$32="subtract",factory_1$37=factory$37,subtract$1={name:name$32,factory:factory_1$37};function factory$36(e,t,n,r){var a=r("abs",{number:Math.abs,Complex:function(e){return e.abs()},BigNumber:function(e){return e.abs()},Fraction:function(e){return e.abs()},"Array | Matrix":function(e){return deepMap(e,a)},Unit:function(e){return e.abs()}});return a.toTex={1:"\\left|${args[0]}\\right|"},a}var name$31="abs",factory_1$36=factory$36,abs$1={name:name$31,factory:factory_1$36},object$2=utils$2.object;function factory$35(e,t,n,r){var a=n(matrix$5),i=n(abs$1),o=n(addScalar),s=n(divideScalar),l=n(multiplyScalar),u=n(subtract$1),c=n(larger$1),p=n(equalScalar),d=n(unaryMinus),m=e.SparseMatrix,f=e.DenseMatrix,h=e.Spa,y=r("lup",{DenseMatrix:function(e){return b(e)},SparseMatrix:function(e){return g(e)},Array:function(e){var t=a(e),n=b(t);return{L:n.L.valueOf(),U:n.U.valueOf(),p:n.p}}}),b=function(e){var t,n,r,a=e._size[0],d=e._size[1],m=Math.min(a,d),h=object$2.clone(e._data),y=[],b=[a,m],g=[],v=[m,d],T=[];for(t=0;t<a;t++)T[t]=t;for(n=0;n<d;n++){if(n>0)for(t=0;t<a;t++){var C=Math.min(t,n),N=0;for(r=0;r<C;r++)N=o(N,l(h[t][r],h[r][n]));h[t][n]=u(h[t][n],N)}var A=n,S=0,w=0;for(t=n;t<a;t++){var x=h[t][n],V=i(x);c(V,S)&&(A=t,S=V,w=x)}if(n!==A&&(T[n]=[T[A],T[A]=T[n]][0],f._swapRows(n,A,h)),n<a)for(t=n+1;t<a;t++){var E=h[t][n];p(E,0)||(h[t][n]=s(h[t][n],w))}}for(n=0;n<d;n++)for(t=0;t<a;t++)0===n&&(t<d&&(g[t]=[]),y[t]=[]),t<n?(t<d&&(g[t][n]=h[t][n]),n<a&&(y[t][n]=0)):t!==n?(t<d&&(g[t][n]=0),n<a&&(y[t][n]=h[t][n])):(t<d&&(g[t][n]=h[t][n]),n<a&&(y[t][n]=1));var $=new f({data:y,size:b}),_=new f({data:g,size:v}),O=[];for(t=0,m=T.length;t<m;t++)O[T[t]]=t;return{L:$,U:_,p:O,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}},g=function(e){var t,n,r,a=e._size[0],o=e._size[1],u=Math.min(a,o),f=e._values,y=e._index,b=e._ptr,g=[],v=[],T=[],C=[a,u],N=[],A=[],S=[],w=[u,o],x=[],V=[];for(t=0;t<a;t++)x[t]=t,V[t]=t;var E=function(e,t){var n=V[e],r=V[t];x[n]=t,x[r]=e,V[e]=r,V[t]=n};for(n=0;n<o;n++){var $=new h;n<a&&(T.push(g.length),g.push(1),v.push(n)),S.push(N.length);var _=b[n],O=b[n+1];for(r=_;r<O;r++)t=y[r],$.set(x[t],f[r]);n>0&&$.forEach(0,n-1,(function(e,t){m._forEachRow(e,g,v,T,(function(n,r){n>e&&$.accumulate(n,d(l(r,t)))}))}));var I=n,D=$.get(n),R=i(D);$.forEach(n+1,a-1,(function(e,t){var n=i(t);c(n,R)&&(I=e,R=n,D=t)})),n!==I&&(m._swapRows(n,I,C[1],g,v,T),m._swapRows(n,I,w[1],N,A,S),$.swap(n,I),E(n,I)),$.forEach(0,a-1,(function(e,t){e<=n?(N.push(t),A.push(e)):(t=s(t,D),p(t,0)||(g.push(t),v.push(e)))}))}return S.push(N.length),T.push(g.length),{L:new m({values:g,index:v,ptr:T,size:C}),U:new m({values:N,index:A,ptr:S,size:w}),p:x,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}};return y}var name$30="lup",factory_1$35=factory$35,lup={name:name$30,factory:factory_1$35},object$1=utils$2.object,string$2=utils$2.string;function factory$34(e,t,n,r){var a=n(matrix$5);n(add$2);var i=n(subtract$1),o=n(multiply$1),s=n(unaryMinus),l=n(lup),u=r("det",{any:function(e){return object$1.clone(e)},"Array | Matrix":function(t){var n;switch((n=e.isMatrix(t)?t.size():Array.isArray(t)?(t=a(t)).size():[]).length){case 0:return object$1.clone(t);case 1:if(1==n[0])return object$1.clone(t.valueOf()[0]);throw new RangeError("Matrix must be square (size: "+string$2.format(n)+")");case 2:var r=n[0];if(r==n[1])return function(e,t,n){if(1==t)return object$1.clone(e[0][0]);if(2==t)return i(o(e[0][0],e[1][1]),o(e[1][0],e[0][1]));for(var r=l(e),a=r.U[0][0],u=1;u<t;u++)a=o(a,r.U[u][u]);for(var c=0,p=(u=0,[]);;){for(;p[u];)u++;if(u>=t)break;for(var d=u,m=0;!p[r.p[d]];)p[r.p[d]]=!0,d=r.p[d],m++;m%2==0&&c++}return c%2==0?a:s(a)}(t.clone().valueOf(),r);throw new RangeError("Matrix must be square (size: "+string$2.format(n)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+string$2.format(n)+")")}}});return u.toTex={1:"\\det\\left(${args[0]}\\right)"},u}var name$2$="det",factory_1$34=factory$34,det={name:name$2$,factory:factory_1$34},isInteger$o=number$5.isInteger;function factory$33(e,t,n,r){var a=n(matrix$5),i=r("eye",{"":function(){return"Matrix"===t.matrix?a([]):[]},string:function(e){return a(e)},"number | BigNumber":function(e){return s(e,e,"Matrix"===t.matrix?"default":void 0)},"number | BigNumber, string":function(e,t){return s(e,e,t)},"number | BigNumber, number | BigNumber":function(e,n){return s(e,n,"Matrix"===t.matrix?"default":void 0)},"number | BigNumber, number | BigNumber, string":function(e,t,n){return s(e,t,n)},Array:function(e){return o(e)},"Array, string":function(e,t){return o(e,t)},Matrix:function(e){return o(e.valueOf(),e.storage())},"Matrix, string":function(e,t){return o(e.valueOf(),t)}});return i.toTex=void 0,i;function o(e,t){switch(e.length){case 0:return t?a(t):[];case 1:return s(e[0],e[0],t);case 2:return s(e[0],e[1],t);default:throw new Error("Vector containing two values expected")}}function s(t,n,r){var a=e.isBigNumber(t)||e.isBigNumber(n)?e.BigNumber:null;if(e.isBigNumber(t)&&(t=t.toNumber()),e.isBigNumber(n)&&(n=n.toNumber()),!isInteger$o(t)||t<1)throw new Error("Parameters in function eye must be positive integers");if(!isInteger$o(n)||n<1)throw new Error("Parameters in function eye must be positive integers");var i=a?new e.BigNumber(1):1,o=a?new a(0):0,s=[t,n];if(r)return e.Matrix.storage(r).diagonal(s,i,0,o);for(var l=array$3.resize([],s,o),u=t<n?t:n,c=0;c<u;c++)l[c][c]=i;return l}}var name$2_="eye",factory_1$33=factory$33,eye={name:name$2_,factory:factory_1$33};function factory$32(e,t,n,r){var a=n(matrix$5),i=n(divideScalar),o=n(addScalar),s=n(multiply$1),l=n(unaryMinus),u=n(det),c=n(eye),p=n(abs$1),d=r("inv",{"Array | Matrix":function(t){var n=e.isMatrix(t)?t.size():utils$2.array.size(t);switch(n.length){case 1:if(1==n[0])return e.isMatrix(t)?a([i(1,t.valueOf()[0])]):[i(1,t[0])];throw new RangeError("Matrix must be square (size: "+utils$2.string.format(n)+")");case 2:var r=n[0],o=n[1];if(r==o)return e.isMatrix(t)?a(m(t.valueOf(),r,o),t.storage()):m(t,r,o);throw new RangeError("Matrix must be square (size: "+utils$2.string.format(n)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+utils$2.string.format(n)+")")}},any:function(e){return i(1,e)}});function m(e,t,n){var r,a,d,m,f;if(1==t){if(0==(m=e[0][0]))throw Error("Cannot calculate inverse, determinant is zero");return[[i(1,m)]]}if(2==t){var h=u(e);if(0==h)throw Error("Cannot calculate inverse, determinant is zero");return[[i(e[1][1],h),i(l(e[0][1]),h)],[i(l(e[1][0]),h),i(e[0][0],h)]]}var y=e.concat();for(r=0;r<t;r++)y[r]=y[r].concat();for(var b=c(t).valueOf(),g=0;g<n;g++){var v=p(y[g][g]),T=g;for(r=g+1;r<t;)p(y[r][g])>v&&(v=p(y[r][g]),T=r),r++;if(0==v)throw Error("Cannot calculate inverse, determinant is zero");(r=T)!=g&&(f=y[g],y[g]=y[r],y[r]=f,f=b[g],b[g]=b[r],b[r]=f);var C=y[g],N=b[g];for(r=0;r<t;r++){var A=y[r],S=b[r];if(r!=g){if(0!=A[g]){for(d=i(l(A[g]),C[g]),a=g;a<n;a++)A[a]=o(A[a],s(d,C[a]));for(a=0;a<n;a++)S[a]=o(S[a],s(d,N[a]))}}else{for(d=C[g],a=g;a<n;a++)A[a]=i(A[a],d);for(a=0;a<n;a++)S[a]=i(S[a],d)}}}return b}return d.toTex={1:"\\left(${args[0]}\\right)^{-1}"},d}var name$2Z="inv",factory_1$32=factory$32,inv={name:name$2Z,factory:factory_1$32},extend$2=object$6.extend;function factory$31(e,t,n,r){var a=n(divideScalar),i=n(multiply$1),o=n(inv),s=n(matrix$5),l=n(algorithm11),u=n(algorithm14),c=r("divide",extend$2({"Array | Matrix, Array | Matrix":function(e,t){return i(e,o(t))},"DenseMatrix, any":function(e,t){return u(e,t,a,!1)},"SparseMatrix, any":function(e,t){return l(e,t,a,!1)},"Array, any":function(e,t){return u(s(e),t,a,!1).valueOf()},"any, Array | Matrix":function(e,t){return i(e,o(t))}},a.signatures));return c.toTex={2:"\\frac{${args[0]}}{${args[1]}}"},c}var name$2Y="divide",factory_1$31=factory$31,divide$1={name:name$2Y,factory:factory_1$31},size$6=array$3.size;function factory$30(e,t,n,r){var a=n(add$2),i=n(divide$1),o=n(improveErrorMessage),s=r("mean",{"Array | Matrix":l,"Array | Matrix, number | BigNumber":function(e,t){try{var n=reduce$2(e,t,a),r=Array.isArray(e)?size$6(e):e.size();return i(n,r[t])}catch(e){throw o(e,"mean")}},"...":function(e){if(containsCollections(e))throw new TypeError("Scalar values expected in function mean");return l(e)}});return s.toTex=void 0,s;function l(e){var t=0,n=0;if(deepForEach(e,(function(e){try{t=a(t,e),n++}catch(t){throw o(t,"mean",e)}})),0===n)throw new Error("Cannot calculate mean of an empty array");return i(t,n)}}var name$2X="mean",factory_1$30=factory$30,mean={name:name$2X,factory:factory_1$30},errorTransform$2=error_transform.transform;function factory$2$(e,t,n,r){var a=n(mean);return r("mean",{"...any":function(t){if(2==t.length&&isCollection(t[0])){var n=t[1];e.isNumber(n)?t[1]=n-1:e.isBigNumber(n)&&(t[1]=n.minus(1))}try{return a.apply(null,t)}catch(e){throw errorTransform$2(e)}}})}var name$2W="mean",path$r="expression.transform",factory_1$2$=factory$2$,mean_transform={name:name$2W,path:path$r,factory:factory_1$2$};function factory$2_(e,t,n,r){var a=n(smaller$1),i=n(improveErrorMessage),o=r("min",{"Array | Matrix":l,"Array | Matrix, number | BigNumber":function(e,t){return reduce$2(e,t.valueOf(),s)},"...":function(e){if(containsCollections(e))throw new TypeError("Scalar values expected in function min");return l(e)}});return o.toTex="\\min\\left(${args}\\right)",o;function s(e,t){try{return a(e,t)?e:t}catch(e){throw i(e,"min",t)}}function l(e){var t=void 0;if(deepForEach(e,(function(e){try{(void 0===t||a(e,t))&&(t=e)}catch(t){throw i(t,"min",e)}})),void 0===t)throw new Error("Cannot calculate min of an empty array");return t}}var name$2V="min",factory_1$2_=factory$2_,min$1={name:name$2V,factory:factory_1$2_},errorTransform$1=error_transform.transform;function factory$2Z(e,t,n,r){var a=n(min$1);return r("min",{"...any":function(t){if(2==t.length&&isCollection(t[0])){var n=t[1];e.isNumber(n)?t[1]=n-1:e.isBigNumber(n)&&(t[1]=n.minus(1))}try{return a.apply(null,t)}catch(e){throw errorTransform$1(e)}}})}var name$2U="min",path$q="expression.transform",factory_1$2Z=factory$2Z,min_transform={name:name$2U,path:path$q,factory:factory_1$2Z};function factory$2Y(e,t,n,r){var a=n(matrix$5),i=new e.BigNumber(0),o=new e.BigNumber(1),s=r("range",{string:u,"string, boolean":u,"number, number":function(e,t){return l(c(e,t,1))},"number, number, number":function(e,t,n){return l(c(e,t,n))},"number, number, boolean":function(e,t,n){return l(n?p(e,t,1):c(e,t,1))},"number, number, number, boolean":function(e,t,n,r){return l(r?p(e,t,n):c(e,t,n))},"BigNumber, BigNumber":function(e,t){return l(d(e,t,o))},"BigNumber, BigNumber, BigNumber":function(e,t,n){return l(d(e,t,n))},"BigNumber, BigNumber, boolean":function(e,t,n){return l(n?m(e,t,o):d(e,t,o))},"BigNumber, BigNumber, BigNumber, boolean":function(e,t,n,r){return l(r?m(e,t,n):d(e,t,n))}});return s.toTex=void 0,s;function l(e){return"Array"===t.matrix?e:a(e)}function u(n,r){var a=function(e){var t=e.split(":").map((function(e){return Number(e)}));if(t.some((function(e){return isNaN(e)})))return null;switch(t.length){case 2:return{start:t[0],end:t[1],step:1};case 3:return{start:t[0],end:t[2],step:t[1]};default:return null}}(n);if(!a)throw new SyntaxError('String "'+n+'" is no valid range');return"BigNumber"===t.number?l((r?m:d)(new e.BigNumber(a.start),new e.BigNumber(a.end),new e.BigNumber(a.step))):l((r?p:c)(a.start,a.end,a.step))}function c(e,t,n){var r=[],a=e;if(n>0)for(;a<t;)r.push(a),a+=n;else if(n<0)for(;a>t;)r.push(a),a+=n;return r}function p(e,t,n){var r=[],a=e;if(n>0)for(;a<=t;)r.push(a),a+=n;else if(n<0)for(;a>=t;)r.push(a),a+=n;return r}function d(e,t,n){var r=[],a=e;if(n.gt(i))for(;a.lt(t);)r.push(a),a=a.plus(n);else if(n.lt(i))for(;a.gt(t);)r.push(a),a=a.plus(n);return r}function m(e,t,n){var r=[],a=e;if(n.gt(i))for(;a.lte(t);)r.push(a),a=a.plus(n);else if(n.lt(i))for(;a.gte(t);)r.push(a),a=a.plus(n);return r}}var name$2T="range",factory_1$2Y=factory$2Y,range$1={name:name$2T,factory:factory_1$2Y};function factory$2X(e,t,n,r){var a=n(range$1);return r("range",{"...any":function(e){return"boolean"!=typeof e[e.length-1]&&e.push(!0),a.apply(null,e)}})}var name$2S="range",path$p="expression.transform",factory_1$2X=factory$2X,range_transform={name:name$2S,path:path$p,factory:factory_1$2X},errorTransform=error_transform.transform;function factory$2W(e,t,n,r){var a=n(subset);return r("subset",{"...any":function(e){try{return a.apply(null,e)}catch(e){throw errorTransform(e)}}})}var name$2R="subset",path$o="expression.transform",factory_1$2W=factory$2W,subset_transform={name:name$2R,path:path$o,factory:factory_1$2W},transform$1=[concat_transform,filter_transform,forEach_transform,index_transform,map_transform,max_transform,mean_transform,min_transform,range_transform,subset_transform];function factory$2V(e,t,n,r){var a=n(parser)();function i(e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!e)throw new Error('Argument "doc" missing');this.doc=e}return i.prototype.type="Help",i.prototype.isHelp=!0,i.prototype.toString=function(){var t=this.doc||{},n="\n";if(t.name&&(n+="Name: "+t.name+"\n\n"),t.category&&(n+="Category: "+t.category+"\n\n"),t.description&&(n+="Description:\n    "+t.description+"\n\n"),t.syntax&&(n+="Syntax:\n    "+t.syntax.join("\n    ")+"\n\n"),t.examples){n+="Examples:\n";for(var r=0;r<t.examples.length;r++){var i,o=t.examples[r];n+="    "+o+"\n";try{i=a.eval(o)}catch(e){i=e}void 0===i||e.isHelp(i)||(n+="        "+string$a.format(i,{precision:14})+"\n")}n+="\n"}return t.seealso&&t.seealso.length&&(n+="See also: "+t.seealso.join(", ")+"\n"),n},i.prototype.toJSON=function(){var e=object$6.clone(this.doc);return e.mathjs="Help",e},i.fromJSON=function(e){var t={};for(var n in e)"mathjs"!==n&&(t[n]=e[n]);return new i(t)},i.prototype.valueOf=i.prototype.toString,i}var name$2Q="Help",path$n="type",factory_1$2V=factory$2V,Help={name:name$2Q,path:path$n,factory:factory_1$2V},expression=[embeddedDocs,_function$1,node$2,transform$1,Help,parse$3,Parser];function factory$2U(e,t,n,r){var a=n(matrix$5),i=n(equalScalar),o=n(algorithm03),s=n(algorithm07),l=n(algorithm12),u=n(algorithm13),c=n(algorithm14),p=latex$1,d=r("equal",{"any, any":function(e,t){return null===e?null===t:null===t?null===e:void 0===e?void 0===t:void 0===t?void 0===e:i(e,t)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,i)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,i)},"Array, Array":function(e,t){return d(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return d(a(e),t)},"Matrix, Array":function(e,t){return d(e,a(t))},"SparseMatrix, any":function(e,t){return l(e,t,i,!1)},"DenseMatrix, any":function(e,t){return c(e,t,i,!1)},"any, SparseMatrix":function(e,t){return l(t,e,i,!0)},"any, DenseMatrix":function(e,t){return c(t,e,i,!0)},"Array, any":function(e,t){return c(a(e),t,i,!1).valueOf()},"any, Array":function(e,t){return c(a(t),e,i,!0).valueOf()}});return d.toTex={2:"\\left(${args[0]}"+p.operators.equal+"${args[1]}\\right)"},d}var name$2P="equal",factory_1$2U=factory$2U,equal$1={name:name$2P,factory:factory_1$2U};function factory$2T(e,t,n,r,a){var i=a.expression.node.FunctionNode,o=a.expression.node.OperatorNode,s=a.expression.node.SymbolNode,l={add:!0,multiply:!0},u={add:!0,multiply:!0};function c(t,n){if(!e.isOperatorNode(t))return!1;var r=t.fn.toString();return n&&n.hasOwnProperty(r)&&n[r].hasOwnProperty("associative")?n[r].associative:u[r]||!1}function p(t){var n,r=[],a=function(t){for(var i=0;i<t.args.length;i++){var o=t.args[i];e.isOperatorNode(o)&&n===o.op?a(o):r.push(o)}};return c(t)?(n=t.op,a(t),r):t.args}function d(t){return e.isOperatorNode(t)?function(e){try{return new o(t.op,t.fn,e)}catch(e){return console.error(e),[]}}:function(e){return new i(new s(t.name),e)}}return{createMakeNodeFunction:d,isCommutative:function(t,n){if(!e.isOperatorNode(t))return!0;var r=t.fn.toString();return n&&n.hasOwnProperty(r)&&n[r].hasOwnProperty("commutative")?n[r].commutative:l[r]||!1},isAssociative:c,flatten:function e(t){if(!t.args||0===t.args.length)return t;t.args=p(t);for(var n=0;n<t.args.length;n++)e(t.args[n])},allChildren:p,unflattenr:function e(t){if(t.args&&0!==t.args.length){for(var n=d(t),r=t.args.length,a=0;a<r;a++)e(t.args[a]);if(r>2&&c(t)){for(var i=t.args.pop();t.args.length>0;)i=n([t.args.pop(),i]);t.args=i.args}}},unflattenl:function e(t){if(t.args&&0!==t.args.length){for(var n=d(t),r=t.args.length,a=0;a<r;a++)e(t.args[a]);if(r>2&&c(t)){for(var i=t.args.shift();t.args.length>0;)i=n([i,t.args.shift()]);t.args=i.args}}}}}var factory_1$2T=factory$2T,math$a=!0,util$1={factory:factory_1$2T,math:math$a};function factory$2S(e,t,n,r){var a=r("isNumeric",{"number | BigNumber | Fraction | boolean":function(){return!0},"Complex | Unit | string":function(){return!1},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$2O="isNumeric",factory_1$2S=factory$2S,isNumeric={name:name$2O,factory:factory_1$2S};function factory$2R(e,t,n,r,a){var i=n(util$1);n(isNumeric);var o=i.isCommutative,s=i.isAssociative,l=i.allChildren,u=i.createMakeNodeFunction,c=a.expression.node.ConstantNode,p=a.expression.node.OperatorNode,d=a.expression.node.FunctionNode;function m(t,n){try{return y(a[t].apply(null,n))}catch(r){return n=n.map((function(t){return e.isFraction(t)?t.valueOf():t})),y(a[t].apply(null,n))}}var f=r({Fraction:function(e){var t,n=e.s*e.n;return t=n<0?new p("-","unaryMinus",[new c(-n)]):new c(n),1===e.d?t:new p("/","divide",[t,new c(e.d)])},number:function(e){return e<0?b(new c(-e)):new c(e)},BigNumber:function(e){return e<0?b(new c(e.negated().toString(),"number")):new c(e.toString(),"number")},Complex:function(e){throw"Cannot convert Complex number to Node"}});function h(e){if(isFinite(e)){var t=a.fraction(e);if(t.valueOf()===e)return t}return e}var y=r({string:function(e){return"BigNumber"===t.number?a.bignumber(e):"Fraction"===t.number?a.fraction(e):h(parseFloat(e))},Fraction:function(e){return e},BigNumber:function(e){return e},number:function(e){return h(e)},Complex:function(e){return 0!==e.im?e:h(e.re)}});function b(e){return new p("-","unaryMinus",[e])}function g(t,n,r){return n.reduce((function(n,a){if(e.isNode(n)||e.isNode(a))e.isNode(n)?e.isNode(a)||(a=f(a)):n=f(n);else{try{return m(t,[n,a])}catch(e){}n=f(n),a=f(a)}return r([n,a])}))}function v(t){switch(t.type){case"SymbolNode":return t;case"ConstantNode":return"number"==typeof t.value?y(t.value):t;case"FunctionNode":if(a[t.name]&&a[t.name].rawArgs)return t;if(-1===["add","multiply"].indexOf(t.name)){if(!(n=t.args.map(v)).some(e.isNode))try{return m(t.name,n)}catch(e){}return n=n.map((function(t){return e.isNode(t)?t:f(t)})),new d(t.name,n)}case"OperatorNode":var n,r,i=t.fn.toString(),c=u(t);if(t.isUnary())n=[v(t.args[0])],r=e.isNode(n[0])?c(n):m(i,n);else if(s(t))if(n=(n=l(t)).map(v),o(i)){for(var p=[],h=[],b=0;b<n.length;b++)e.isNode(n[b])?h.push(n[b]):p.push(n[b]);p.length>1?(r=g(i,p,c),h.unshift(r),r=g(i,h,c)):r=g(i,n,c)}else r=g(i,n,c);else r=g(i,n=t.args.map(v),c);return r;case"ParenthesisNode":return v(t.content);default:throw"Unimplemented node type in simplifyConstant: "+t.type}}return function(t){var n=v(t);return e.isNode(n)?n:f(n)}}number$5.digits;var math$9=!0,name$2N="simplifyConstant",path$m="algebra.simplify",factory_1$2R=factory$2R,simplifyConstant={math:math$9,name:name$2N,path:path$m,factory:factory_1$2R};function factory$2Q(e,t,n,r){var a=r("isZero",{number:function(e){return 0===e},BigNumber:function(e){return e.isZero()},Complex:function(e){return 0===e.re&&0===e.im},Fraction:function(e){return 1===e.d&&0===e.n},Unit:function(e){return a(e.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$2M="isZero",factory_1$2Q=factory$2Q,isZero={name:name$2M,factory:factory_1$2Q},isInteger$n=number$5.isInteger,size$5=array$3.size;function factory$2P(e,t,n,r){var a=latex$1,i=n(eye),o=n(multiply$1),s=n(matrix$5),l=n(fraction$2),u=n(number$2),c=r("pow",{"number, number":p,"Complex, Complex":function(e,t){return e.pow(t)},"BigNumber, BigNumber":function(n,r){return r.isInteger()||n>=0||t.predictable?n.pow(r):new e.Complex(n.toNumber(),0).pow(r.toNumber(),0)},"Fraction, Fraction":function(e,n){if(1!==n.d){if(t.predictable)throw new Error("Function pow does not support non-integer exponents for fractions.");return p(e.valueOf(),n.valueOf())}return e.pow(n)},"Array, number":d,"Array, BigNumber":function(e,t){return d(e,t.toNumber())},"Matrix, number":m,"Matrix, BigNumber":function(e,t){return m(e,t.toNumber())},"Unit, number":function(e,t){return e.pow(t)}});function p(n,r){if(t.predictable&&!isInteger$n(r)&&n<0)try{var a=l(r),i=u(a);if((r===i||Math.abs((r-i)/r)<1e-14)&&a.d%2==1)return(a.n%2==0?1:-1)*Math.pow(-n,r)}catch(e){}return n*n<1&&r===1/0||n*n>1&&r===-1/0?0:t.predictable&&(n<-1&&r===1/0||n>-1&&n<0&&r===-1/0)?NaN:isInteger$n(r)||n>=0||t.predictable?Math.pow(n,r):new e.Complex(n,0).pow(r,0)}function d(e,t){if(!isInteger$n(t)||t<0)throw new TypeError("For A^b, b must be a positive integer (value is "+t+")");var n=size$5(e);if(2!=n.length)throw new Error("For A^b, A must be 2 dimensional (A has "+n.length+" dimensions)");if(n[0]!=n[1])throw new Error("For A^b, A must be square (size is "+n[0]+"x"+n[1]+")");for(var r=i(n[0]).valueOf(),a=e;t>=1;)1==(1&t)&&(r=o(a,r)),t>>=1,a=o(a,a);return r}function m(e,t){return s(d(e.valueOf(),t))}return c.toTex={2:"\\left(${args[0]}\\right)"+a.operators.pow+"{${args[1]}}"},c}var name$2L="pow",factory_1$2P=factory$2P,pow$1={name:name$2L,factory:factory_1$2P};function factory$2O(e,t,n,r,a){var i=n(equal$1),o=n(isZero);n(isNumeric);var s=n(add$2),l=n(subtract$1),u=n(multiply$1),c=n(divide$1),p=n(pow$1),d=a.expression.node.ConstantNode,m=a.expression.node.OperatorNode,f=a.expression.node.FunctionNode,h=a.expression.node.ParenthesisNode,y=new d(0),b=new d(1);return function t(n){if(e.isOperatorNode(n)&&n.isUnary()){var r=t(n.args[0]);if("+"===n.op)return r;if("-"===n.op){if(e.isOperatorNode(r)){if(r.isUnary()&&"-"===r.op)return r.args[0];if(r.isBinary()&&"subtract"===r.fn)return new m("-","subtract",[r.args[1],r.args[0]])}return new m(n.op,n.fn,[r])}}else if(e.isOperatorNode(n)&&n.isBinary()){r=t(n.args[0]);var a=t(n.args[1]);if("+"===n.op){if(e.isConstantNode(r)){if(o(r.value))return a;if(e.isConstantNode(a))return new d(s(r.value,a.value))}return e.isConstantNode(a)&&o(a.value)?r:e.isOperatorNode(a)&&a.isUnary()&&"-"===a.op?new m("-","subtract",[r,a.args[0]]):new m(n.op,n.fn,a?[r,a]:[r])}if("-"===n.op){if(e.isConstantNode(r)&&a){if(e.isConstantNode(a))return new d(l(r.value,a.value));if(o(r.value))return new m("-","unaryMinus",[a])}if("subtract"===n.fn)return e.isConstantNode(a)&&o(a.value)?r:e.isOperatorNode(a)&&a.isUnary()&&"-"===a.op?t(new m("+","add",[r,a.args[0]])):new m(n.op,n.fn,[r,a])}else{if("*"===n.op){if(e.isConstantNode(r)){if(o(r.value))return y;if(i(r.value,1))return a;if(e.isConstantNode(a))return new d(u(r.value,a.value))}if(e.isConstantNode(a)){if(o(a.value))return y;if(i(a.value,1))return r;if(e.isOperatorNode(r)&&r.isBinary()&&r.op===n.op){var g=r.args[0];if(e.isConstantNode(g)){var v=new d(u(g.value,a.value));return new m(n.op,n.fn,[v,r.args[1]])}}return new m(n.op,n.fn,[a,r])}return new m(n.op,n.fn,[r,a])}if("/"===n.op){if(e.isConstantNode(r)){if(o(r.value))return y;if(e.isConstantNode(a)&&(i(a.value,1)||i(a.value,2)||i(a.value,4)))return new d(c(r.value,a.value))}return new m(n.op,n.fn,[r,a])}if("^"===n.op){if(e.isConstantNode(a)){if(o(a.value))return b;if(i(a.value,1))return r;if(e.isConstantNode(r))return new d(p(r.value,a.value));if(e.isOperatorNode(r)&&r.isBinary()&&"^"===r.op){var T=r.args[1];if(e.isConstantNode(T))return new m(n.op,n.fn,[r.args[0],new d(u(T.value,a.value))])}}return new m(n.op,n.fn,[r,a])}}}else{if(e.isParenthesisNode(n)){var C=t(n.content);return e.isParenthesisNode(C)||e.isSymbolNode(C)||e.isConstantNode(C)?C:new h(C)}if(e.isFunctionNode(n)){var N=n.args.map(t).map((function(t){return e.isParenthesisNode(t)?t.content:t}));return new f(t(n.fn),N)}}return n}}var math$8=!0,name$2K="simplifyCore",path$l="algebra.simplify",factory_1$2O=factory$2O,simplifyCore={math:math$8,name:name$2K,path:path$l,factory:factory_1$2O};function factory$2N(e,t,n,r,a){var i=a.expression.node.Node,o=a.expression.node.OperatorNode,s=a.expression.node.FunctionNode,l=a.expression.node.ParenthesisNode;return function t(n,r){if(!r)return n;if(e.isSymbolNode(n)){var u=r[n.name];if(u instanceof i)return t(u,r);if("number"==typeof u)return a.parse(String(u))}else{if(e.isOperatorNode(n)){var c=n.args.map((function(e){return t(e,r)}));return new o(n.op,n.fn,c)}if(e.isParenthesisNode(n))return new l(t(n.content,r));if(e.isFunctionNode(n))return c=n.args.map((function(e){return t(e,r)})),new s(n.name,c)}return n}}var math$7=!0,name$2J="resolve",path$k="algebra.simplify",factory_1$2N=factory$2N,resolve={math:math$7,name:name$2J,path:path$k,factory:factory_1$2N};function factory$2M(e,t,n,r,a){var i=n(parse$3),o=n(equal$1),s=n(ConstantNode),l=n(FunctionNode),u=n(OperatorNode),c=n(ParenthesisNode),p=n(SymbolNode);n(Node);var d=n(simplifyConstant),m=n(simplifyCore),f=n(resolve),h=n(util$1),y=h.isCommutative,b=h.isAssociative,g=h.flatten,v=h.unflattenr,T=h.unflattenl,C=h.createMakeNodeFunction,N=r("simplify",{string:function(e){return N(i(e),N.rules,{})},"string, Object":function(e,t){return N(i(e),N.rules,t)},"string, Array":function(e,t){return N(i(e),t,{})},"string, Array, Object":function(e,t,n){return N(i(e),t,n)},"Node, Object":function(e,t){return N(e,N.rules,t)},Node:function(e){return N(e,N.rules,{})},"Node, Array":function(e,t){return N(e,t,{})},"Node, Array, Object":function(e,t,n){t=function(e){for(var t=[],n=0;n<e.length;n++){var r,a=e[n],o=typeof a;switch(o){case"string":var s=a.split("->");if(2!==s.length)throw SyntaxError("Could not parse rule: "+a);a={l:s[0],r:s[1]};case"object":if(r={l:A(i(a.l)),r:A(i(a.r))},a.context&&(r.evaluate=a.context),a.evaluate&&(r.evaluate=i(a.evaluate)),b(r.l)){var l=C(r.l),u=new p("_p"+w++);r.expanded={},r.expanded.l=l([r.l.clone(),u]),g(r.expanded.l),v(r.expanded.l),r.expanded.r=l([r.r,u])}break;case"function":r=a;break;default:throw TypeError("Unsupported type of rule: "+o)}t.push(r)}return t}(t);for(var r,a={},o=(r=A(r=f(e,n))).toString({parenthesis:"all"});!a[o];){a[o]=!0,w=0;for(var s=0;s<t.length;s++)"function"==typeof t[s]?r=t[s](r):(g(r),r=x(r,t[s])),T(r);o=r.toString({parenthesis:"all"})}return r}});function A(t){return t.transform((function(t,n,r){return e.isParenthesisNode(t)?t.content:t}))}N.simplifyCore=m,N.resolve=f;var S={true:!0,false:!0,e:!0,i:!0,Infinity:!0,LN2:!0,LN10:!0,LOG2E:!0,LOG10E:!0,NaN:!0,phi:!0,pi:!0,SQRT1_2:!0,SQRT2:!0,tau:!0};N.rules=[m,{l:"log(e)",r:"1"},{l:"n-n1",r:"n+-n1"},{l:"-(c*v)",r:"(-c) * v"},{l:"-v",r:"(-1) * v"},{l:"n/n1^n2",r:"n*n1^-n2"},{l:"n/n1",r:"n*n1^-1"},{l:"(n ^ n1) ^ n2",r:"n ^ (n1 * n2)"},{l:"n*n",r:"n^2"},{l:"n * n^n1",r:"n^(n1+1)"},{l:"n^n1 * n^n2",r:"n^(n1+n2)"},{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},{l:"n1*n2 + n2",r:"(n1+1)*n2"},{l:"n1*n3 + n2*n3",r:"(n1+n2)*n3"},{l:"n1 + -1 * (n2 + n3)",r:"n1 + -1 * n2 + -1 * n3"},d,{l:"(-n)*n1",r:"-(n*n1)"},{l:"c+v",r:"v+c",context:{add:{commutative:!1}}},{l:"v*c",r:"c*v",context:{multiply:{commutative:!1}}},{l:"n+-n1",r:"n-n1"},{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"n-(n1+n2)",r:"n-n1-n2"},{l:"1*n",r:"n"}];var w=0;var x=r("applyRule",{"Node, Object":function(e,t){var n=e;if(n instanceof u||n instanceof l){if(n.args)for(var r=0;r<n.args.length;r++)n.args[r]=x(n.args[r],t)}else n instanceof c&&n.content&&(n.content=x(n.content,t));var a=t.r,i=$(t.l,n)[0];if(!i&&t.expanded&&(a=t.expanded.r,i=$(t.expanded.l,n)[0]),i){n=a.clone();var o=function(e){return e.isSymbolNode&&i.placeholders.hasOwnProperty(e.name)?i.placeholders[e.name].clone():e.map(o)};n=o(n)}return n}});function V(e,t){var n={placeholders:{}};if(!e.placeholders&&!t.placeholders)return n;if(!e.placeholders)return t;if(!t.placeholders)return e;for(var r in e.placeholders)if(n.placeholders[r]=e.placeholders[r],t.placeholders.hasOwnProperty(r)&&!_(e.placeholders[r],t.placeholders[r]))return null;for(var r in t.placeholders)n.placeholders[r]=t.placeholders[r];return n}function E(e,t){var n,r=[];if(0===e.length||0===t.length)return r;for(var a=0;a<e.length;a++)for(var i=0;i<t.length;i++)(n=V(e[a],t[i]))&&r.push(n);return r}function $(t,n,r){var i=[{placeholders:{}}];if(t instanceof u&&n instanceof u||t instanceof l&&n instanceof l){if(t instanceof u){if(t.op!==n.op||t.fn!==n.fn)return[]}else if(t instanceof l&&t.name!==n.name)return[];if((1!==n.args.length||1!==t.args.length)&&b(n)&&!r){if(n.args.length>=2&&2===t.args.length){var c=function(e,t){var n,r,a=[],i=C(e);if(y(e,t))for(var o=0;o<e.args.length;o++)(r=e.args.slice(0)).splice(o,1),n=1===r.length?r[0]:i(r),a.push(i([e.args[o],n]));else n=1===(r=e.args.slice(1)).length?r[0]:i(r),a.push(i([e.args[0],n]));return a}(n,t.context),d=[];for(h=0;h<c.length;h++){var m=$(t,c[h],!0);d=d.concat(m)}return d}if(t.args.length>2)throw Error("Unexpected non-binary associative function: "+t.toString());return[]}for(var f=[],h=0;h<t.args.length;h++){var g=$(t.args[h],n.args[h]);if(0===g.length)return[];f.push(g)}i=function(e){if(0===e.length)return e;for(var t=e.reduce(E),n=[],r={},a=0;a<t.length;a++){var i=JSON.stringify(t[a]);r[i]||(r[i]=!0,n.push(t[a]))}return n}(f)}else if(t instanceof p){if(0===t.name.length)throw new Error("Symbol in rule has 0 length...!?");if(a.hasOwnProperty(t.name)){if(!S[t.name])throw new Error("Built in constant: "+t.name+" is not supported by simplify.");if(t.name!==n.name)return[]}else if("n"===t.name[0]||"_p"===t.name.substring(0,2))i[0].placeholders[t.name]=n;else if("v"===t.name[0]){if(e.isConstantNode(n))return[];i[0].placeholders[t.name]=n}else{if("c"!==t.name[0])throw new Error("Invalid symbol in rule: "+t.name);if(!(n instanceof s))return[];i[0].placeholders[t.name]=n}}else{if(!(t instanceof s))return[];if(!o(t.value,n.value))return[]}return i}function _(e,t){if(e instanceof s&&t instanceof s){if(!o(e.value,t.value))return!1}else if(e instanceof p&&t instanceof p){if(e.name!==t.name)return!1}else{if(!(e instanceof u&&t instanceof u||e instanceof l&&t instanceof l))return!1;if(e instanceof u){if(e.op!==t.op||e.fn!==t.fn)return!1}else if(e instanceof l&&e.name!==t.name)return!1;if(e.args.length!==t.args.length)return!1;for(var n=0;n<e.args.length;n++)if(!_(e.args[n],t.args[n]))return!1}return!0}return N}var math$6=!0,name$2I="simplify",factory_1$2M=factory$2M,simplify$2={math:math$6,name:name$2I,factory:factory_1$2M};function factory$2L(e,t,n,r){var a=n(parse$3),i=n(simplify$2),o=n(equal$1),s=n(isZero),l=n(numeric),u=n(ConstantNode),c=n(FunctionNode),p=n(OperatorNode),d=n(ParenthesisNode),m=n(SymbolNode),f=r("derivative",{"Node, SymbolNode, Object":function(e,t,n){var r={};y(r,e,t.name);var a=b(e,r);return n.simplify?i(a):a},"Node, SymbolNode":function(e,t){return f(e,t,{simplify:!0})},"string, SymbolNode":function(e,t){return f(a(e),t)},"string, SymbolNode, Object":function(e,t,n){return f(a(e),t,n)},"string, string":function(e,t){return f(a(e),a(t))},"string, string, Object":function(e,t,n){return f(a(e),a(t),n)},"Node, string":function(e,t){return f(e,a(t))},"Node, string, Object":function(e,t,n){return f(e,a(t),n)}});f._simplify=!0,f.toTex=function(e){return h.apply(null,e.args)};var h=r("_derivTex",{"Node, SymbolNode":function(e,t){return h(e.toString(),t.toString(),1)},"Node, SymbolNode, ConstantNode":function(e,t,n){return h(e.toString(),t.name,n.value)},"string, string, number":function(e,t,n){return(1===n?"{d\\over d"+t+"}":"{d^{"+n+"}\\over d"+t+"^{"+n+"}}")+"\\left["+e+"\\right]"}}),y=r("constTag",{"Object, ConstantNode, string":function(e,t){return e[t]=!0},"Object, SymbolNode, string":function(e,t,n){return t.name!==n&&(e[t]=!0)},"Object, ParenthesisNode, string":function(e,t,n){return y(e,t.content,n)},"Object, FunctionAssignmentNode, string":function(e,t,n){return-1===t.params.indexOf(n)?e[t]=!0:y(e,t.expr,n)},"Object, FunctionNode | OperatorNode, string":function(e,t,n){if(t.args.length>0){for(var r=y(e,t.args[0],n),a=1;a<t.args.length;++a)r=y(e,t.args[a],n)&&r;if(r)return e[t]=!0}return!1}}),b=r("_derivative",{"ConstantNode, Object":function(e){return g(0)},"SymbolNode, Object":function(e,t){return void 0!==t[e]?g(0):g(1)},"ParenthesisNode, Object":function(e,t){return new d(b(e.content,t))},"FunctionAssignmentNode, Object":function(e,t){return void 0!==t[e]?g(0):b(e.expr,t)},"FunctionNode, Object":function(e,t){if(1!==e.args.length&&function(e){if("log"!==e.name&&"nthRoot"!==e.name||2!==e.args.length){for(var t=0;t<e.args.length;++t)e.args[t]=g(0);throw e.compile().eval(),new Error("Expected TypeError, but none found")}}(e),void 0!==t[e])return g(0);var n,r,a,i,o=e.args[0],s=!1,l=!1;switch(e.name){case"cbrt":s=!0,r=new p("*","multiply",[g(3),new p("^","pow",[o,new p("/","divide",[g(2),g(3)])])]);break;case"sqrt":case"nthRoot":if(1===e.args.length)s=!0,r=new p("*","multiply",[g(2),new c("sqrt",[o])]);else if(2===e.args.length)return t[n=new p("/","divide",[g(1),e.args[1]])]=t[e.args[1]],b(new p("^","pow",[o,n]),t);break;case"log10":n=g(10);case"log":if(n||1!==e.args.length){if(1===e.args.length&&n||2===e.args.length&&void 0!==t[e.args[1]])r=new p("*","multiply",[o.clone(),new c("log",[n||e.args[1]])]),s=!0;else if(2===e.args.length)return b(new p("/","divide",[new c("log",[o]),new c("log",[e.args[1]])]),t)}else r=o.clone(),s=!0;break;case"exp":r=new c("exp",[o.clone()]);break;case"sin":r=new c("cos",[o.clone()]);break;case"cos":r=new p("-","unaryMinus",[new c("sin",[o.clone()])]);break;case"tan":r=new p("^","pow",[new c("sec",[o.clone()]),g(2)]);break;case"sec":r=new p("*","multiply",[e,new c("tan",[o.clone()])]);break;case"csc":l=!0,r=new p("*","multiply",[e,new c("cot",[o.clone()])]);break;case"cot":l=!0,r=new p("^","pow",[new c("csc",[o.clone()]),g(2)]);break;case"asin":s=!0,r=new c("sqrt",[new p("-","subtract",[g(1),new p("^","pow",[o.clone(),g(2)])])]);break;case"acos":s=!0,l=!0,r=new c("sqrt",[new p("-","subtract",[g(1),new p("^","pow",[o.clone(),g(2)])])]);break;case"atan":s=!0,r=new p("+","add",[new p("^","pow",[o.clone(),g(2)]),g(1)]);break;case"asec":s=!0,r=new p("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new p("-","subtract",[new p("^","pow",[o.clone(),g(2)]),g(1)])])]);break;case"acsc":s=!0,l=!0,r=new p("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new p("-","subtract",[new p("^","pow",[o.clone(),g(2)]),g(1)])])]);break;case"acot":s=!0,l=!0,r=new p("+","add",[new p("^","pow",[o.clone(),g(2)]),g(1)]);break;case"sinh":r=new c("cosh",[o.clone()]);break;case"cosh":r=new c("sinh",[o.clone()]);break;case"tanh":r=new p("^","pow",[new c("sech",[o.clone()]),g(2)]);break;case"sech":l=!0,r=new p("*","multiply",[e,new c("tanh",[o.clone()])]);break;case"csch":l=!0,r=new p("*","multiply",[e,new c("coth",[o.clone()])]);break;case"coth":l=!0,r=new p("^","pow",[new c("csch",[o.clone()]),g(2)]);break;case"asinh":s=!0,r=new c("sqrt",[new p("+","add",[new p("^","pow",[o.clone(),g(2)]),g(1)])]);break;case"acosh":s=!0,r=new c("sqrt",[new p("-","subtract",[new p("^","pow",[o.clone(),g(2)]),g(1)])]);break;case"atanh":s=!0,r=new p("-","subtract",[g(1),new p("^","pow",[o.clone(),g(2)])]);break;case"asech":s=!0,l=!0,r=new p("*","multiply",[o.clone(),new c("sqrt",[new p("-","subtract",[g(1),new p("^","pow",[o.clone(),g(2)])])])]);break;case"acsch":s=!0,l=!0,r=new p("*","multiply",[new c("abs",[o.clone()]),new c("sqrt",[new p("+","add",[new p("^","pow",[o.clone(),g(2)]),g(1)])])]);break;case"acoth":s=!0,l=!0,r=new p("-","subtract",[g(1),new p("^","pow",[o.clone(),g(2)])]);break;case"abs":r=new p("/","divide",[new c(new m("abs"),[o.clone()]),o.clone()]);break;default:throw new Error('Function "'+e.name+'" is not supported by derivative, or a wrong number of arguments is passed')}s?(a="/",i="divide"):(a="*",i="multiply");var u=b(o,t);return l&&(u=new p("-","unaryMinus",[u])),new p(a,i,[u,r])},"OperatorNode, Object":function(t,n){if(void 0!==n[t])return g(0);if("+"===t.op)return new p(t.op,t.fn,t.args.map((function(e){return b(e,n)})));if("-"===t.op){if(t.isUnary())return new p(t.op,t.fn,[b(t.args[0],n)]);if(t.isBinary())return new p(t.op,t.fn,[b(t.args[0],n),b(t.args[1],n)])}if("*"===t.op){var r=t.args.filter((function(e){return void 0!==n[e]}));if(r.length>0){var a=t.args.filter((function(e){return void 0===n[e]})),i=1===a.length?a[0]:new p("*","multiply",a),l=r.concat(b(i,n));return new p("*","multiply",l)}return new p("+","add",t.args.map((function(e){return new p("*","multiply",t.args.map((function(t){return t===e?b(t,n):t.clone()})))})))}if("/"===t.op&&t.isBinary()){var u=t.args[0],d=t.args[1];return void 0!==n[d]?new p("/","divide",[b(u,n),d]):void 0!==n[u]?new p("*","multiply",[new p("-","unaryMinus",[u]),new p("/","divide",[b(d,n),new p("^","pow",[d.clone(),g(2)])])]):new p("/","divide",[new p("-","subtract",[new p("*","multiply",[b(u,n),d.clone()]),new p("*","multiply",[u.clone(),b(d,n)])]),new p("^","pow",[d.clone(),g(2)])])}if("^"===t.op&&t.isBinary()){if(u=t.args[0],d=t.args[1],void 0!==n[u])return e.isConstantNode(u)&&(s(u.value)||o(u.value,1))?g(0):new p("*","multiply",[t,new p("*","multiply",[new c("log",[u.clone()]),b(d.clone(),n)])]);if(void 0!==n[d]){if(e.isConstantNode(d)){if(s(d.value))return g(0);if(o(d.value,1))return b(u,n)}var m=new p("^","pow",[u.clone(),new p("-","subtract",[d,g(1)])]);return new p("*","multiply",[d.clone(),new p("*","multiply",[b(u,n),m])])}return new p("*","multiply",[new p("^","pow",[u.clone(),d.clone()]),new p("+","add",[new p("*","multiply",[b(u,n),new p("/","divide",[d.clone(),u.clone()])]),new p("*","multiply",[b(d,n),new c("log",[u.clone()])])])])}throw new Error('Operator "'+t.op+'" is not supported by derivative, or a wrong number of arguments is passed')}});function g(e,n){return new u(l(e,n||t.number))}return f}var name$2H="derivative",factory_1$2L=factory$2L,derivative$1={name:name$2H,factory:factory_1$2L};function factory$2K(e,t,n,r){var a=n(simplify$2),i=n(simplifyCore),o=n(simplifyConstant),s=ArgumentsError_1,l=n(parse$2),u=number$5,c=n(ConstantNode),p=n(OperatorNode),d=n(SymbolNode),m=r("rationalize",{string:function(e){return m(l(e),{},!1)},"string, boolean":function(e,t){return m(l(e),{},t)},"string, Object":function(e,t){return m(l(e),t,!1)},"string, Object, boolean":function(e,t,n){return m(l(e),t,n)},Node:function(e){return m(e,{},!1)},"Node, boolean":function(e,t){return m(e,{},t)},"Node, Object":function(e,t){return m(e,t,!1)},"Node, Object, boolean":function(e,t,n){var r=function(e,t,n){var r=[],i=a(e,t),o="+-*"+((n=!!n)?"/":"");!function e(t){var n=t.type;if("FunctionNode"===n)throw new s("There is an unsolved function call");if("OperatorNode"===n)if("^"===t.op&&t.isBinary()){if("ConstantNode"!==t.args[1].type||!u.isInteger(parseFloat(t.args[1].value)))throw new s("There is a non-integer exponent");e(t.args[0])}else{if(-1===o.indexOf(t.op))throw new s("Operator "+t.op+" invalid in polynomial expression");for(var a=0;a<t.args.length;a++)e(t.args[a])}else if("SymbolNode"===n){var i=t.name;-1===r.indexOf(i)&&r.push(i)}else if("ParenthesisNode"===n)e(t.content);else if("ConstantNode"!==n)throw new s("type "+n+" is not allowed in polynomial expression")}(i);var l={};return l.expression=i,l.variables=r,l}(e,t,!0),l=r.variables.length;if(e=r.expression,l>=1){var c=function(){var e=[i,{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},o,{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"1*n",r:"n"}],t=[{l:"(-n1)/(-n2)",r:"n1/n2"},{l:"(-n1)*(-n2)",r:"n1*n2"},{l:"n1--n2",r:"n1+n2"},{l:"n1-n2",r:"n1+(-n2)"},{l:"(n1+n2)*n3",r:"(n1*n3 + n2*n3)"},{l:"n1*(n2+n3)",r:"(n1*n2+n1*n3)"},{l:"c1*n + c2*n",r:"(c1+c2)*n"},{l:"-v*-c",r:"c*v"},{l:"-v*c",r:"-c*v"},{l:"v*-c",r:"-c*v"},{l:"v*c",r:"c*v"},{l:"-(-n1*n2)",r:"(n1*n2)"},{l:"-(n1*n2)",r:"(-n1*n2)"},{l:"-(-n1+n2)",r:"(n1-n2)"},{l:"-(n1+n2)",r:"(-n1-n2)"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"},{l:"-(-n1/n2)",r:"(n1/n2)"},{l:"-(n1/n2)",r:"(-n1/n2)"}],n=[{l:"(n1/(n2/n3))",r:"((n1*n3)/n2)"},{l:"(n1/n2/n3)",r:"(n1/(n2*n3))"}],r={};return r.firstRules=e.concat(t,n),r.distrDivRules=[{l:"(n1/n2 + n3/n4)",r:"((n1*n4 + n3*n2)/(n2*n4))"},{l:"(n1/n2 + n3)",r:"((n1 + n3*n2)/n2)"},{l:"(n1 + n2/n3)",r:"((n1*n3 + n2)/n3)"}],r.sucDivRules=n,r.firstRulesAgain=e.concat(t),r.finalRules=[i,{l:"n*-n",r:"-n^2"},{l:"n*n",r:"n^2"},o,{l:"n*-n^n1",r:"-n^(n1+1)"},{l:"n*n^n1",r:"n^(n1+1)"},{l:"n^n1*-n^n2",r:"-n^(n1+n2)"},{l:"n^n1*n^n2",r:"n^(n1+n2)"},{l:"n^n1*-n",r:"-n^(n1+1)"},{l:"n^n1*n",r:"n^(n1+1)"},{l:"n^n1/-n",r:"-n^(n1-1)"},{l:"n^n1/n",r:"n^(n1-1)"},{l:"n/-n^n1",r:"-n^(1-n1)"},{l:"n/n^n1",r:"n^(1-n1)"},{l:"n^n1/-n^n2",r:"n^(n1-n2)"},{l:"n^n1/n^n2",r:"n^(n1-n2)"},{l:"n1+(-n2*n3)",r:"n1-n2*n3"},{l:"v*(-c)",r:"-c*v"},{l:"n1+-n2",r:"n1-n2"},{l:"v*c",r:"c*v"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"}],r}();e=f(e);var p,d,m=!0,y="",b=!0;for(y=(e=a(e,c.firstRules)).toString();d=b?c.distrDivRules:c.sucDivRules,b=!b,(y=(e=a(e,d)).toString())!==p;)m=!0,p=y;m&&(e=a(e,c.firstRulesAgain)),e=a(e,c.finalRules)}var g=[],v={};return"OperatorNode"===e.type&&e.isBinary()&&"/"===e.op?(1==l&&(e.args[0]=h(e.args[0],g),e.args[1]=h(e.args[1])),n&&(v.numerator=e.args[0],v.denominator=e.args[1])):(1==l&&(e=h(e,g)),n&&(v.numerator=e,v.denominator=null)),n?(v.coefficients=g,v.variables=r.variables,v.expression=e,v):e}});function f(e,t,n){var r=e.type,a=arguments.length>1;if("OperatorNode"===r&&e.isBinary()){var i=!1;if("^"===e.op&&("ParenthesisNode"===e.args[0].type||"OperatorNode"===e.args[0].type)&&"ConstantNode"===e.args[1].type){var o=parseFloat(e.args[1].value);i=o>=2&&u.isInteger(o)}if(i){if(o>2){var s=e.args[0],l=new p("^","pow",[e.args[0].cloneDeep(),new c(o-1)]);e=new p("*","multiply",[s,l])}else e=new p("*","multiply",[e.args[0],e.args[0].cloneDeep()]);a&&("content"===n?t.content=e:t.args[n]=e)}}if("ParenthesisNode"===r)f(e.content,e,"content");else if("ConstantNode"!==r&&"SymbolNode"!==r)for(var d=0;d<e.args.length;d++)f(e.args[d],e,d);if(!a)return e}function h(e,t){var n;void 0===t&&(t=[]),t[0]=0;var r=0,a="";!function e(n,i,o){var l=n.type;if("FunctionNode"===l)throw new s("There is an unsolved function call");if("OperatorNode"===l){if(-1==="+-*^".indexOf(n.op))throw new s("Operator "+n.op+" invalid");if(null!==i){if(("unaryMinus"===n.fn||"pow"===n.fn)&&"add"!==i.fn&&"subtract"!==i.fn&&"multiply"!==i.fn)throw new s("Invalid "+n.op+" placing");if(("subtract"===n.fn||"add"===n.fn||"multiply"===n.fn)&&"add"!==i.fn&&"subtract"!==i.fn)throw new s("Invalid "+n.op+" placing");if(("subtract"===n.fn||"add"===n.fn||"unaryMinus"===n.fn)&&0!==o.noFil)throw new s("Invalid "+n.op+" placing")}"^"!==n.op&&"*"!==n.op||(o.fire=n.op);for(var c=0;c<n.args.length;c++)"unaryMinus"===n.fn&&(o.oper="-"),"+"!==n.op&&"subtract"!==n.fn||(o.fire="",o.cte=1,o.oper=0===c?"+":n.op),o.noFil=c,e(n.args[c],n,o)}else if("SymbolNode"===l){if(n.name!==a&&""!==a)throw new s("There is more than one variable");if(a=n.name,null===i)return void(t[1]=1);if("^"===i.op&&0!==o.noFil)throw new s("In power the variable should be the first parameter");if("*"===i.op&&1!==o.noFil)throw new s("In multiply the variable should be the second parameter");""!==o.fire&&"*"!==o.fire||(r<1&&(t[1]=0),t[1]+=o.cte*("+"===o.oper?1:-1),r=Math.max(1,r))}else{if("ConstantNode"!==l)throw new s("Type "+l+" is not allowed");var p=parseFloat(n.value);if(null===i)return void(t[0]=p);if("^"===i.op){if(1!==o.noFil)throw new s("Constant cannot be powered");if(!u.isInteger(p)||p<=0)throw new s("Non-integer exponent is not allowed");for(c=r+1;c<p;c++)t[c]=0;return p>r&&(t[p]=0),t[p]+=o.cte*("+"===o.oper?1:-1),void(r=Math.max(p,r))}o.cte=p,""===o.fire&&(t[0]+=o.cte*("+"===o.oper?1:-1))}}(e,null,{cte:1,oper:"+",fire:""});var i=!0;for(n=r=t.length-1;n>=0;n--)if(0!==t[n]){var o,l=new c(i?t[n]:Math.abs(t[n])),m=t[n]<0?"-":"+";if(n>0){var f=new d(a);if(n>1){var h=new c(n);f=new p("^","pow",[f,h])}l=-1===t[n]&&i?new p("-","unaryMinus",[f]):1===Math.abs(t[n])?f:new p("*","multiply",[l,f])}o=i?l:"+"===m?new p("+","add",[o,l]):new p("-","subtract",[o,l]),i=!1}return i?new c(0):o}return m}var name$2G="rationalize",factory_1$2K=factory$2K,rationalize={name:name$2G,factory:factory_1$2K},isInteger$m=number$5.isInteger,resize$2=array$3.resize;function factory$2J(e,t,n,r){var a=n(matrix$5),i=r("zeros",{"":function(){return"Array"===t.matrix?o([]):o([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var n=e.pop();return o(e,n)}return"Array"===t.matrix?o(e):o(e,"default")},Array:o,Matrix:function(e){var t=e.storage();return o(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return o(e.valueOf(),t)}});return i.toTex=void 0,i;function o(t,n){var r=function(t){var n=!1;return t.forEach((function(t,r,a){e.isBigNumber(t)&&(n=!0,a[r]=t.toNumber())})),n}(t),i=r?new e.BigNumber(0):0;if(function(e){e.forEach((function(e){if("number"!=typeof e||!isInteger$m(e)||e<0)throw new Error("Parameters in function zeros must be positive integers")}))}(t),n){var o=a(n);return t.length>0?o.resize(t,i):o}var s=[];return t.length>0?resize$2(s,t,i):s}}var name$2F="zeros",factory_1$2J=factory$2J,zeros={name:name$2F,factory:factory_1$2J};function factory$2I(e,t,n,r){var a=r("clone",{any:object$6.clone});return a.toTex=void 0,a}var name$2E="clone",factory_1$2I=factory$2I,clone$6={name:name$2E,factory:factory_1$2I};function factory$2H(e,t,n,r){var a=r("isPositive",{number:function(e){return e>0},BigNumber:function(e){return!e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s>0&&e.n>0},Unit:function(e){return a(e.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$2D="isPositive",factory_1$2H=factory$2H,isPositive={name:name$2D,factory:factory_1$2H},nearlyEqual$3=number$5.nearlyEqual;function factory$2G(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm07),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=latex$1,p=r("unequal",{"any, any":function(e,t){return null===e?null!==t:null===t?null!==e:void 0===e?void 0!==t:void 0===t?void 0!==e:d(e,t)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,d)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,d,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,d,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,d)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,d,!1)},"DenseMatrix, any":function(e,t){return u(e,t,d,!1)},"any, SparseMatrix":function(e,t){return s(t,e,d,!0)},"any, DenseMatrix":function(e,t){return u(t,e,d,!0)},"Array, any":function(e,t){return u(a(e),t,d,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,d,!0).valueOf()}}),d=r("_unequal",{"boolean, boolean":function(e,t){return e!==t},"number, number":function(e,n){return!nearlyEqual$3(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return!nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return!e.equals(t)},"Complex, Complex":function(e,t){return!e.equals(t)},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return p(e.value,t.value)}});return p.toTex={2:"\\left(${args[0]}"+c.operators.unequal+"${args[1]}\\right)"},p}var name$2C="unequal",factory_1$2G=factory$2G,unequal={name:name$2C,factory:factory_1$2G};function factory$2F(e,t,n,r){var a=r("sign",{number:number$5.sign,Complex:function(e){return e.sign()},BigNumber:function(t){return new e.BigNumber(t.cmp(0))},Fraction:function(t){return new e.Fraction(t.s,1)},"Array | Matrix":function(e){return deepMap(e,a)},Unit:function(e){return a(e.value)}});return a.toTex={1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},a}var name$2B="sign",factory_1$2F=factory$2F,sign$3={name:name$2B,factory:factory_1$2F};function factory$2E(e,t,n,r){var a=r("sqrt",{number:i,Complex:function(e){return e.sqrt()},BigNumber:function(e){return!e.isNegative()||t.predictable?e.sqrt():i(e.toNumber())},"Array | Matrix":function(e){return deepMap(e,a)},Unit:function(e){return e.pow(.5)}});function i(n){return n>=0||t.predictable?Math.sqrt(n):new e.Complex(n,0).sqrt()}return a.toTex={1:"\\sqrt{${args[0]}}"},a}var name$2A="sqrt",factory_1$2E=factory$2E,sqrt$1={name:name$2A,factory:factory_1$2E};function factory$2D(e,t,n,r){var a=r("conj",{number:function(e){return e},BigNumber:function(e){return e},Complex:function(e){return e.conjugate()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\left(${args[0]}\\right)^*"},a}var name$2z="conj",factory_1$2D=factory$2D,conj$1={name:name$2z,factory:factory_1$2D};function factory$2C(e,t,n,r){var a=n(matrix$5),i=n(zeros),o=n(eye);n(clone$6);var s=n(isZero);n(isPositive);var l=n(unequal);n(abs$1);var u=n(sign$3),c=n(sqrt$1),p=n(conj$1),d=n(unaryMinus),m=n(addScalar),f=n(divideScalar),h=n(multiplyScalar),y=n(subtract$1),b=r("qr",{DenseMatrix:function(e){return g(e)},SparseMatrix:function(e){return v(e)},Array:function(e){var t=a(e),n=g(t);return{Q:n.Q.valueOf(),R:n.R.valueOf()}}}),g=function(e){var t,n,r,a=e._size[0],b=e._size[1],g=o([a],"dense"),v=g._data,T=e.clone(),C=T._data,N=i([a],"");for(r=0;r<Math.min(b,a);++r){var A=C[r][r],S=d(u(A)),w=p(S),x=0;for(t=r;t<a;t++)x=m(x,h(C[t][r],p(C[t][r])));var V=h(S,c(x));if(!s(V)){var E=y(A,V);for(N[r]=1,t=r+1;t<a;t++)N[t]=f(C[t][r],E);var $,_=d(p(f(E,V)));for(n=r;n<b;n++){for($=0,t=r;t<a;t++)$=m($,h(p(N[t]),C[t][n]));for($=h($,_),t=r;t<a;t++)C[t][n]=h(y(C[t][n],h(N[t],$)),w)}for(t=0;t<a;t++){for($=0,n=r;n<a;n++)$=m($,h(v[t][n],N[n]));for($=h($,_),n=r;n<a;++n)v[t][n]=f(y(v[t][n],h($,p(N[n]))),w)}}}for(t=0;t<a;++t)for(n=0;n<t&&n<b;++n){if(l(0,f(C[t][n],1e5)))throw new Error("math.qr(): unknown error - R is not lower triangular (element ("+t+", "+n+")  = "+C[t][n]+")");C[t][n]=h(C[t][n],0)}return{Q:g,R:T,toString:function(){return"Q: "+this.Q.toString()+"\nR: "+this.R.toString()}}},v=function(e){throw new Error("qr not implemented for sparse matrices yet")};return b}var name$2y="qr",factory_1$2C=factory$2C,qr={name:name$2y,factory:factory_1$2C};function factory$2B(){return function(e){return-e-2}}var name$2x="cs_flip",path$j="sparse",factory_1$2B=factory$2B,cs_flip={name:name$2x,path:path$j,factory:factory_1$2B};function factory$2A(){return function(e,t,n){for(var r=e._values,a=e._index,i=e._ptr,o=e._size[1],s=0,l=0;l<o;l++){var u=i[l];for(i[l]=s;u<i[l+1];u++)t(a[u],l,r?r[u]:1,n)&&(a[s]=a[u],r&&(r[s]=r[u]),s++)}return i[o]=s,a.splice(s,a.length-s),r&&r.splice(s,r.length-s),s}}var name$2w="cs_fkeep",path$i="sparse",factory_1$2A=factory$2A,cs_fkeep={name:name$2w,path:path$i,factory:factory_1$2A};function factory$2z(){return function(e,t,n,r,a,i,o){var s=0;for(n[o]=e;s>=0;){var l=n[o+s],u=n[r+l];-1==u?(s--,i[t++]=l):(n[r+l]=n[a+u],n[o+ ++s]=u)}return t}}var name$2v="cs_tdfs",path$h="sparse",factory_1$2z=factory$2z,cs_tdfs={name:name$2v,path:path$h,factory:factory_1$2z},clone$5=object$6.clone,format$6=string$a.format;function factory$2y(e,t,n,r){var a=latex$1,i=n(matrix$5),o=e.DenseMatrix,s=e.SparseMatrix,l=r("transpose",{Array:function(e){return l(i(e)).valueOf()},Matrix:function(e){var t,n=e.size();switch(n.length){case 1:t=e.clone();break;case 2:var r=n[0],a=n[1];if(0===a)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+format$6(n)+")");switch(e.storage()){case"dense":t=u(e,r,a);break;case"sparse":t=c(e,r,a)}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+format$6(this._size)+")")}return t},any:function(e){return clone$5(e)}}),u=function(e,t,n){for(var r,a=e._data,i=[],s=0;s<n;s++){r=i[s]=[];for(var l=0;l<t;l++)r[l]=clone$5(a[l][s])}return new o({data:i,size:[n,t],datatype:e._datatype})},c=function(e,t,n){for(var r,a,i,o=e._values,l=e._index,u=e._ptr,c=o?[]:void 0,p=[],d=[],m=[],f=0;f<t;f++)m[f]=0;for(r=0,a=l.length;r<a;r++)m[l[r]]++;for(var h=0,y=0;y<t;y++)d.push(h),h+=m[y],m[y]=d[y];for(d.push(h),i=0;i<n;i++)for(var b=u[i],g=u[i+1],v=b;v<g;v++){var T=m[l[v]]++;p[T]=i,o&&(c[T]=clone$5(o[v]))}return new s({values:c,index:p,ptr:d,size:[n,t],datatype:e._datatype})};return l.toTex={1:"\\left(${args[0]}\\right)"+a.operators.transpose},l}var name$2u="transpose",factory_1$2y=factory$2y,transpose={name:name$2u,factory:factory_1$2y};function factory$2x(e,t,n){var r=n(cs_flip),a=n(cs_fkeep),i=n(cs_tdfs),o=n(add$2),s=n(multiply$1),l=n(transpose),u=function(e,t,n,r,a){var i=l(t);if(1===e&&r===n)return o(t,i);if(2==e){for(var u=i._index,c=i._ptr,p=0,d=0;d<n;d++){var m=c[d];if(c[d]=p,!(c[d+1]-m>a))for(var f=c[d+1];m<f;m++)u[p++]=u[m]}return c[n]=p,t=l(i),s(i,t)}return s(i,t)},c=function(e,t,n,r,a){if(e<2||e+t<0){for(var i=0;i<a;i++)0!==n[r+i]&&(n[r+i]=1);e=2}return e},p=function(e,t){return e!=t};return function(e,t){if(!t||e<=0||e>3)return null;var n=t._size,o=n[0],s=n[1],l=0,d=Math.max(16,10*Math.sqrt(s));d=Math.min(s-2,d);var m=u(e,t,o,s,d);a(m,p,null);for(var f,h,y,b,g,v,T,C,N,A,S,w,x,V,E,$,_=m._index,O=m._ptr,I=O[s],D=[],R=[],P=s+1,k=2*(s+1),M=3*(s+1),F=4*(s+1),B=5*(s+1),L=6*(s+1),j=7*(s+1),U=D,z=function(e,t,n,r,a,i,o,s,l,u,p,d){for(var m=0;m<e;m++)n[r+m]=t[m+1]-t[m];n[r+e]=0;for(var f=0;f<=e;f++)n[a+f]=-1,i[f]=-1,n[o+f]=-1,n[s+f]=-1,n[l+f]=1,n[u+f]=1,n[p+f]=0,n[d+f]=n[r+f];var h=c(0,0,n,u,e);return n[p+e]=-2,t[e]=-1,n[u+e]=0,h}(s,O,R,0,M,U,k,j,P,L,F,B),H=function(e,t,n,a,i,o,s,l,u,c,p){for(var d=0,m=0;m<e;m++){var f=n[a+m];if(0===f)n[i+m]=-2,d++,t[m]=-1,n[o+m]=0;else if(f>s)n[l+m]=0,n[i+m]=-1,d++,t[m]=r(e),n[l+e]++;else{var h=n[u+f];-1!=h&&(c[h]=m),n[p+m]=n[u+f],n[u+f]=m}}return d}(s,O,R,B,F,L,d,P,M,U,k),G=0;H<s;){for(y=-1;G<s&&-1==(y=R[M+G]);G++);-1!=R[k+y]&&(U[R[k+y]]=-1),R[M+G]=R[k+y];var W=R[F+y],q=R[P+y];H+=q;var K=0;R[P+y]=-q;var X=O[y],Y=0===W?X:I,Z=Y;for(b=1;b<=W+1;b++){for(b>W?(v=y,T=X,C=R[0+y]-W):(T=O[v=_[X++]],C=R[0+v]),g=1;g<=C;g++)(N=R[P+(f=_[T++])])<=0||(K+=N,R[P+f]=-N,_[Z++]=f,-1!=R[k+f]&&(U[R[k+f]]=U[f]),-1!=U[f]?R[k+U[f]]=R[k+f]:R[M+R[B+f]]=R[k+f]);v!=y&&(O[v]=r(y),R[L+v]=0)}for(0!==W&&(I=Z),R[B+y]=K,O[y]=Y,R[0+y]=Z-Y,R[F+y]=-2,z=c(z,l,R,L,s),A=Y;A<Z;A++)if(!((S=R[F+(f=_[A])])<=0)){var J=z-(N=-R[P+f]);for(X=O[f],w=O[f]+S-1;X<=w;X++)R[L+(v=_[X])]>=z?R[L+v]-=N:0!==R[L+v]&&(R[L+v]=R[B+v]+J)}for(A=Y;A<Z;A++){for(x=(w=O[f=_[A]])+R[F+f]-1,V=w,E=0,$=0,X=w;X<=x;X++)if(0!==R[L+(v=_[X])]){var Q=R[L+v]-z;Q>0?($+=Q,_[V++]=v,E+=v):(O[v]=r(y),R[L+v]=0)}R[F+f]=V-w+1;var ee=V,te=w+R[0+f];for(X=x+1;X<te;X++){var ne=R[P+(h=_[X])];ne<=0||($+=ne,_[V++]=h,E+=h)}0===$?(O[f]=r(y),K-=N=-R[P+f],q+=N,H+=N,R[P+f]=0,R[F+f]=-1):(R[B+f]=Math.min(R[B+f],$),_[V]=_[ee],_[ee]=_[w],_[w]=y,R[0+f]=V-w+1,E=(E<0?-E:E)%s,R[k+f]=R[j+E],R[j+E]=f,U[f]=E)}for(R[B+y]=K,l=Math.max(l,K),z=c(z+l,l,R,L,s),A=Y;A<Z;A++)if(!(R[P+(f=_[A])]>=0))for(f=R[j+(E=U[f])],R[j+E]=-1;-1!=f&&-1!=R[k+f];f=R[k+f],z++){for(C=R[0+f],S=R[F+f],X=O[f]+1;X<=O[f]+C-1;X++)R[L+_[X]]=z;var re=f;for(h=R[k+f];-1!=h;){var ae=R[0+h]===C&&R[F+h]===S;for(X=O[h]+1;ae&&X<=O[h]+C-1;X++)R[L+_[X]]!=z&&(ae=0);ae?(O[h]=r(f),R[P+f]+=R[P+h],R[P+h]=0,R[F+h]=-1,h=R[k+h],R[k+re]=h):(re=h,h=R[k+h])}}for(X=Y,A=Y;A<Z;A++)(N=-R[P+(f=_[A])])<=0||(R[P+f]=N,$=R[B+f]+K-N,-1!=R[M+($=Math.min($,s-H-N))]&&(U[R[M+$]]=f),R[k+f]=R[M+$],U[f]=-1,R[M+$]=f,G=Math.min(G,$),R[B+f]=$,_[X++]=f);R[P+y]=q,0==(R[0+y]=X-Y)&&(O[y]=-1,R[L+y]=0),0!==W&&(I=X)}for(f=0;f<s;f++)O[f]=r(O[f]);for(h=0;h<=s;h++)R[M+h]=-1;for(h=s;h>=0;h--)R[P+h]>0||(R[k+h]=R[M+O[h]],R[M+O[h]]=h);for(v=s;v>=0;v--)R[P+v]<=0||-1!=O[v]&&(R[k+v]=R[M+O[v]],R[M+O[v]]=v);for(y=0,f=0;f<=s;f++)-1==O[f]&&(y=i(f,y,R,M,k,D,L));return D.splice(D.length-1,1),D}}var name$2t="cs_amd",path$g="sparse",factory_1$2x=factory$2x,cs_amd={name:name$2t,path:path$g,factory:factory_1$2x};function factory$2w(e){var t=e.SparseMatrix;return function(e,n,r,a){for(var i=e._values,o=e._index,s=e._ptr,l=e._size,u=e._datatype,c=l[0],p=l[1],d=a&&e._values?[]:null,m=[],f=[],h=0,y=0;y<p;y++){f[y]=h;for(var b=r?r[y]:y,g=s[b],v=s[b+1],T=g;T<v;T++){var C=n?n[o[T]]:o[T];m[h]=C,d&&(d[h]=i[T]),h++}}return f[p]=h,new t({values:d,index:m,ptr:f,size:[c,p],datatype:u})}}var name$2s="cs_permute",path$f="sparse",factory_1$2w=factory$2w,cs_permute={name:name$2s,path:path$f,factory:factory_1$2w};function factory$2v(){return function(e,t){if(!e)return null;var n,r,a=e._index,i=e._ptr,o=e._size,s=o[0],l=o[1],u=[],c=[],p=l;if(t)for(n=0;n<s;n++)c[p+n]=-1;for(var d=0;d<l;d++){u[d]=-1,c[0+d]=-1;for(var m=i[d],f=i[d+1],h=m;h<f;h++){var y=a[h];for(n=t?c[p+y]:y;-1!=n&&n<d;n=r)r=c[0+n],c[0+n]=d,-1==r&&(u[n]=d);t&&(c[p+y]=d)}}return u}}var name$2r="cs_etree",path$e="sparse",factory_1$2v=factory$2v,cs_etree={name:name$2r,path:path$e,factory:factory_1$2v};function factory$2u(e,t,n){var r=n(cs_tdfs);return function(e,t){if(!e)return null;var n,a=0,i=[],o=[],s=t,l=2*t;for(n=0;n<t;n++)o[0+n]=-1;for(n=t-1;n>=0;n--)-1!=e[n]&&(o[s+n]=o[0+e[n]],o[0+e[n]]=n);for(n=0;n<t;n++)-1==e[n]&&(a=r(n,a,o,0,s,i,l));return i}}var name$2q="cs_post",path$d="sparse",factory_1$2u=factory$2u,cs_post={name:name$2q,path:path$d,factory:factory_1$2u};function factory$2t(){return function(e,t,n,r,a,i,o){var s,l,u,c,p=0;if(e<=t||n[r+t]<=n[a+e])return-1;if(n[a+e]=n[r+t],u=n[i+e],n[i+e]=t,-1===u)p=1,c=e;else{for(p=2,c=u;c!=n[o+c];c=n[o+c]);for(s=u;s!=c;s=l)l=n[o+s],n[o+s]=c}return{jleaf:p,q:c}}}var name$2p="cs_leaf",path$c="sparse",factory_1$2t=factory$2t,cs_leaf={name:name$2p,path:path$c,factory:factory_1$2t};function factory$2s(e,t,n){var r=n(transpose),a=n(cs_leaf);return function(e,t,n,i){if(!e||!t||!n)return null;var o,s,l,u,c,p,d,m=e._size,f=m[0],h=m[1],y=4*h+(i?h+f+1:0),b=[],g=h,v=2*h,T=3*h,C=4*h,N=5*h+1;for(l=0;l<y;l++)b[l]=-1;var A=[],S=r(e),w=S._index,x=S._ptr;for(l=0;l<h;l++)for(A[s=n[l]]=-1==b[T+s]?1:0;-1!=s&&-1==b[T+s];s=t[s])b[T+s]=l;if(i){for(l=0;l<h;l++)b[n[l]]=l;for(o=0;o<f;o++){for(l=h,p=x[o],d=x[o+1],c=p;c<d;c++)l=Math.min(l,b[w[c]]);b[N+o]=b[C+l],b[C+l]=o}}for(o=0;o<h;o++)b[0+o]=o;for(l=0;l<h;l++){for(-1!=t[s=n[l]]&&A[t[s]]--,u=i?b[C+l]:s;-1!=u;u=i?b[N+u]:-1)for(c=x[u];c<x[u+1];c++){o=w[c];var V=a(o,s,b,T,g,v,0);V.jleaf>=1&&A[s]++,2==V.jleaf&&A[V.q]--}-1!=t[s]&&(b[0+s]=t[s])}for(s=0;s<h;s++)-1!=t[s]&&(A[t[s]]+=A[s]);return A}}var name$2o="cs_counts",path$b="sparse",factory_1$2s=factory$2s,cs_counts={name:name$2o,path:path$b,factory:factory_1$2s};function factory$2r(e,t,n){var r=n(cs_amd),a=n(cs_permute),i=n(cs_etree),o=n(cs_post),s=n(cs_counts);return function(e,t,n){var l,u=t._ptr,c=t._size[1],p={};if(p.q=r(e,t),e&&!p.q)return null;if(n){var d=e?a(t,null,p.q,0):t;p.parent=i(d,1);var m=o(p.parent,c);if(p.cp=s(d,p.parent,m,1),d&&p.parent&&p.cp&&function(e,t){var n=e._ptr,r=e._index,a=e._size,i=a[0],o=a[1];t.pinv=[],t.leftmost=[];var s,l,u,c,p,d=t.parent,m=t.pinv,f=t.leftmost,h=[],y=i,b=i+o,g=i+2*o;for(l=0;l<o;l++)h[y+l]=-1,h[b+l]=-1,h[g+l]=0;for(s=0;s<i;s++)f[s]=-1;for(l=o-1;l>=0;l--)for(c=n[l],p=n[l+1],u=c;u<p;u++)f[r[u]]=l;for(s=i-1;s>=0;s--)m[s]=-1,-1!=(l=f[s])&&(0==h[g+l]++&&(h[b+l]=s),h[0+s]=h[y+l],h[y+l]=s);for(t.lnz=0,t.m2=i,l=0;l<o;l++)if(s=h[y+l],t.lnz++,s<0&&(s=t.m2++),m[s]=l,!(--g[l]<=0)){t.lnz+=h[g+l];var v=d[l];-1!=v&&(0===h[g+v]&&(h[b+v]=h[b+l]),h[0+h[b+l]]=h[y+v],h[y+v]=h[0+s],h[g+v]+=h[g+l])}for(s=0;s<i;s++)m[s]<0&&(m[s]=l++);return!0}(d,p))for(p.unz=0,l=0;l<c;l++)p.unz+=p.cp[l]}else p.unz=4*u[c]+c,p.lnz=p.unz;return p}}var name$2n="cs_sqr",path$a="sparse",factory_1$2r=factory$2r,cs_sqr={name:name$2n,path:path$a,factory:factory_1$2r},nearlyEqual$2=number$5.nearlyEqual;function factory$2q(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm07),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=latex$1,p=r("largerEq",{"boolean, boolean":function(e,t){return e>=t},"number, number":function(e,n){return e>=n||nearlyEqual$2(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return e.gte(n)||nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return-1!==e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return p(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,p)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,p,!1)},"DenseMatrix, any":function(e,t){return u(e,t,p,!1)},"any, SparseMatrix":function(e,t){return s(t,e,p,!0)},"any, DenseMatrix":function(e,t){return u(t,e,p,!0)},"Array, any":function(e,t){return u(a(e),t,p,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+c.operators.largerEq+"${args[1]}\\right)"},p}var name$2m="largerEq",factory_1$2q=factory$2q,largerEq={name:name$2m,factory:factory_1$2q};function factory$2p(){return function(e,t){return e[t]<0}}var name$2l="cs_marked",path$9="sparse",factory_1$2p=factory$2p,cs_marked={name:name$2l,path:path$9,factory:factory_1$2p};function factory$2o(e,t,n){var r=n(cs_flip);return function(e,t){e[t]=r(e[t])}}var name$2k="cs_mark",path$8="sparse",factory_1$2o=factory$2o,cs_mark={name:name$2k,path:path$8,factory:factory_1$2o};function factory$2n(e,t,n){var r=n(cs_flip);return function(e){return e<0?r(e):e}}var name$2j="cs_unflip",path$7="sparse",factory_1$2n=factory$2n,cs_unflip={name:name$2j,path:path$7,factory:factory_1$2n};function factory$2m(e,t,n){var r=n(cs_marked),a=n(cs_mark),i=n(cs_unflip);return function(e,t,n,o,s){var l,u,c,p=t._index,d=t._ptr,m=t._size[1],f=0;for(o[0]=e;f>=0;){e=o[f];var h=s?s[e]:e;r(d,e)||(a(d,e),o[m+f]=h<0?0:i(d[h]));var y=1;for(u=o[m+f],c=h<0?0:i(d[h+1]);u<c;u++)if(l=p[u],!r(d,l)){o[m+f]=u,o[++f]=l,y=0;break}y&&(f--,o[--n]=e)}return n}}var name$2i="cs_dfs",path$6="sparse",factory_1$2m=factory$2m,cs_dfs={name:name$2i,path:path$6,factory:factory_1$2m};function factory$2l(e,t,n){var r=n(cs_dfs),a=n(cs_marked),i=n(cs_mark);return function(e,t,n,o,s){var l,u,c,p=e._ptr,d=e._size,m=t._index,f=t._ptr,h=d[1],y=h;for(u=f[n],c=f[n+1],l=u;l<c;l++){var b=m[l];a(p,b)||(y=r(b,e,y,o,s))}for(l=y;l<h;l++)i(p,o[l]);return y}}var name$2h="cs_reach",path$5="sparse",factory_1$2l=factory$2l,cs_reach={name:name$2h,path:path$5,factory:factory_1$2l};function factory$2k(e,t,n){var r=n(divideScalar),a=n(multiply$1),i=n(subtract$1),o=n(cs_reach);return function(e,t,n,s,l,u,c){var p,d,m,f,h=e._values,y=e._index,b=e._ptr,g=e._size[1],v=t._values,T=t._index,C=t._ptr,N=o(e,t,n,s,u);for(p=N;p<g;p++)l[s[p]]=0;for(d=C[n],m=C[n+1],p=d;p<m;p++)l[T[p]]=v[p];for(var A=N;A<g;A++){var S=s[A],w=u?u[S]:S;if(!(w<0))for(d=b[w],m=b[w+1],l[S]=r(l[S],h[c?d:m-1]),p=c?d+1:d,f=c?m:m-1;p<f;p++){var x=y[p];l[x]=i(l[x],a(h[p],l[S]))}}return N}}var name$2g="cs_spsolve",path$4="sparse",factory_1$2k=factory$2k,cs_spsolve={name:name$2g,path:path$4,factory:factory_1$2k};function factory$2j(e,t,n){var r=n(abs$1),a=n(divideScalar),i=n(multiply$1),o=n(larger$1),s=n(largerEq),l=n(cs_spsolve),u=e.SparseMatrix;return function(e,t,n){if(!e)return null;var c,p=e._size[1],d=100,m=100;t&&(c=t.q,d=t.lnz||d,m=t.unz||m);var f,h,y=[],b=[],g=[],v=new u({values:y,index:b,ptr:g,size:[p,p]}),T=[],C=[],N=[],A=new u({values:T,index:C,ptr:N,size:[p,p]}),S=[],w=[],x=[];for(f=0;f<p;f++)w[f]=0,S[f]=-1,g[f+1]=0;d=0,m=0;for(var V=0;V<p;V++){g[V]=d,N[V]=m;var E=c?c[V]:V,$=l(v,e,E,x,w,S,1),_=-1,O=-1;for(h=$;h<p;h++)if(S[f=x[h]]<0){var I=r(w[f]);o(I,O)&&(O=I,_=f)}else C[m]=S[f],T[m++]=w[f];if(-1==_||O<=0)return null;S[E]<0&&s(r(w[E]),i(O,n))&&(_=E);var D=w[_];for(C[m]=V,T[m++]=D,S[_]=V,b[d]=_,y[d++]=1,h=$;h<p;h++)S[f=x[h]]<0&&(b[d]=f,y[d++]=a(w[f],D)),w[f]=0}for(g[p]=d,N[p]=m,h=0;h<d;h++)b[h]=S[b[h]];return y.splice(d,y.length-d),b.splice(d,b.length-d),T.splice(m,T.length-m),C.splice(m,C.length-m),{L:v,U:A,pinv:S}}}var name$2f="cs_lu",path$3="sparse",factory_1$2j=factory$2j,cs_lu={name:name$2f,path:path$3,factory:factory_1$2j},number=utils$2.number,isInteger$l=number.isInteger;function factory$2i(e,t,n,r){var a=n(cs_sqr),i=n(cs_lu),o=r("slu",{"SparseMatrix, number, number":function(e,t,n){if(!isInteger$l(t)||t<0||t>3)throw new Error("Symbolic Ordering and Analysis order must be an integer number in the interval [0, 3]");if(n<0||n>1)throw new Error("Partial pivoting threshold must be a number from 0 to 1");var r=a(t,e,!1),o=i(e,r,n);return{L:o.L,U:o.U,p:o.pinv,q:r.q,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\np: "+this.p.toString()+(this.q?"\nq: "+this.q.toString():"")+"\n"}}}});return o}var name$2e="slu",factory_1$2i=factory$2i,slu={name:name$2e,factory:factory_1$2i},string$1=utils$2.string,array=utils$2.array,isArray$3=Array.isArray;function factory$2h(e){var t=e.DenseMatrix;return function(n,r,a){var i=n.size();if(2!==i.length)throw new RangeError("Matrix must be two dimensional (size: "+string$1.format(i)+")");var o,s,l,u=i[0];if(u!==i[1])throw new RangeError("Matrix must be square (size: "+string$1.format(i)+")");if(e.isMatrix(r)){var c=r.size();if(1===c.length){if(c[0]!==u)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(o=[],l=r._data,s=0;s<u;s++)o[s]=[l[s]];return new t({data:o,size:[u,1],datatype:r._datatype})}if(2===c.length){if(c[0]!==u||1!==c[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");if(e.isDenseMatrix(r)){if(a){for(o=[],l=r._data,s=0;s<u;s++)o[s]=[l[s][0]];return new t({data:o,size:[u,1],datatype:r._datatype})}return r}for(o=[],s=0;s<u;s++)o[s]=[0];for(var p=r._values,d=r._index,m=r._ptr,f=m[1],h=m[0];h<f;h++)o[s=d[h]][0]=p[h];return new t({data:o,size:[u,1],datatype:r._datatype})}throw new RangeError("Dimension mismatch. Matrix columns must match vector length.")}if(isArray$3(r)){var y=array.size(r);if(1===y.length){if(y[0]!==u)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(o=[],s=0;s<u;s++)o[s]=[r[s]];return new t({data:o,size:[u,1]})}if(2===y.length){if(y[0]!==u||1!==y[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(o=[],s=0;s<u;s++)o[s]=[r[s][0]];return new t({data:o,size:[u,1]})}throw new RangeError("Dimension mismatch. Matrix columns must match vector length.")}}}var factory_1$2h=factory$2h,solveValidation={factory:factory_1$2h};function factory$2g(e,t,n,r){var a=n(matrix$5),i=n(divideScalar),o=n(multiplyScalar),s=n(subtract$1),l=n(equalScalar),u=n(solveValidation),c=e.DenseMatrix,p=r("lsolve",{"SparseMatrix, Array | Matrix":function(e,t){return m(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return d(e,t)},"Array, Array | Matrix":function(e,t){var n=a(e);return d(n,t).valueOf()}}),d=function(e,t){for(var n=(t=u(e,t,!0))._data,r=e._size[0],a=e._size[1],p=[],d=e._data,m=0;m<a;m++){var f,h=n[m][0]||0;if(l(h,0))f=0;else{var y=d[m][m];if(l(y,0))throw new Error("Linear system cannot be solved since matrix is singular");f=i(h,y);for(var b=m+1;b<r;b++)n[b]=[s(n[b][0]||0,o(f,d[b][m]))]}p[m]=[f]}return new c({data:p,size:[r,1]})},m=function(e,t){for(var n,r,a=(t=u(e,t,!0))._data,p=e._size[0],d=e._size[1],m=e._values,f=e._index,h=e._ptr,y=[],b=0;b<d;b++){var g=a[b][0]||0;if(l(g,0))y[b]=[0];else{var v=0,T=[],C=[],N=h[b+1];for(r=h[b];r<N;r++)(n=f[r])===b?v=m[r]:n>b&&(T.push(m[r]),C.push(n));if(l(v,0))throw new Error("Linear system cannot be solved since matrix is singular");var A=i(g,v);for(r=0,N=C.length;r<N;r++)a[n=C[r]]=[s(a[n][0]||0,o(A,T[r]))];y[b]=[A]}}return new c({data:y,size:[p,1]})};return p}var name$2d="lsolve",factory_1$2g=factory$2g,lsolve={name:name$2d,factory:factory_1$2g};function factory$2f(){return function(e,t,n){n=t.length;var r,a=[];if(e)for(r=0;r<n;r++)a[e[r]]=t[r];else for(r=0;r<n;r++)a[r]=t[r];return a}}var name$2c="cs_ipvec",path$2="sparse",factory_1$2f=factory$2f,cs_ipvec={name:name$2c,path:path$2,factory:factory_1$2f};function factory$2e(e,t,n,r){var a=n(matrix$5),i=n(divideScalar),o=n(multiplyScalar),s=n(subtract$1),l=n(equalScalar),u=n(solveValidation),c=e.DenseMatrix,p=r("usolve",{"SparseMatrix, Array | Matrix":function(e,t){return m(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return d(e,t)},"Array, Array | Matrix":function(e,t){var n=a(e);return d(n,t).valueOf()}}),d=function(e,t){for(var n=(t=u(e,t,!0))._data,r=e._size[0],a=e._size[1],p=[],d=e._data,m=a-1;m>=0;m--){var f,h=n[m][0]||0;if(l(h,0))f=0;else{var y=d[m][m];if(l(y,0))throw new Error("Linear system cannot be solved since matrix is singular");f=i(h,y);for(var b=m-1;b>=0;b--)n[b]=[s(n[b][0]||0,o(f,d[b][m]))]}p[m]=[f]}return new c({data:p,size:[r,1]})},m=function(e,t){for(var n,r,a=(t=u(e,t,!0))._data,p=e._size[0],d=e._size[1],m=e._values,f=e._index,h=e._ptr,y=[],b=d-1;b>=0;b--){var g=a[b][0]||0;if(l(g,0))y[b]=[0];else{var v=0,T=[],C=[],N=h[b],A=h[b+1];for(r=A-1;r>=N;r--)(n=f[r])===b?v=m[r]:n<b&&(T.push(m[r]),C.push(n));if(l(v,0))throw new Error("Linear system cannot be solved since matrix is singular");var S=i(g,v);for(r=0,A=C.length;r<A;r++)a[n=C[r]]=[s(a[n][0],o(S,T[r]))];y[b]=[S]}}return new c({data:y,size:[p,1]})};return p}var name$2b="usolve",factory_1$2e=factory$2e,usolve={name:name$2b,factory:factory_1$2e},isArray$2=Array.isArray;function factory$2d(e,t,n,r){var a=n(matrix$5),i=n(lup),o=n(slu),s=n(cs_ipvec),l=n(solveValidation),u=n(usolve),c=n(lsolve),p=r("lusolve",{"Array, Array | Matrix":function(e,t){e=a(e);var n=i(e);return m(n.L,n.U,n.p,null,t).valueOf()},"DenseMatrix, Array | Matrix":function(e,t){var n=i(e);return m(n.L,n.U,n.p,null,t)},"SparseMatrix, Array | Matrix":function(e,t){var n=i(e);return m(n.L,n.U,n.p,null,t)},"SparseMatrix, Array | Matrix, number, number":function(e,t,n,r){var a=o(e,n,r);return m(a.L,a.U,a.p,a.q,t)},"Object, Array | Matrix":function(e,t){return m(e.L,e.U,e.p,e.q,t)}}),d=function(t){if(e.isMatrix(t))return t;if(isArray$2(t))return a(t);throw new TypeError("Invalid Matrix LU decomposition")},m=function(e,t,n,r,a){e=d(e),t=d(t),a=l(e,a,!1),n&&(a._data=s(n,a._data));var i=c(e,a),o=u(t,i);return r&&(o._data=s(r,o._data)),o};return p}var name$2a="lusolve",factory_1$2d=factory$2d,lusolve={name:name$2a,factory:factory_1$2d},algebra=[derivative$1,simplify$2,rationalize,qr,lup,slu,lsolve,lusolve,usolve];function factory$2c(e,t,n,r){var a=r("isNegative",{number:function(e){return e<0},BigNumber:function(e){return e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s<0},Unit:function(e){return a(e.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$29="isNegative",factory_1$2c=factory$2c,isNegative={name:name$29,factory:factory_1$2c};function factory$2b(e,t,n,r){var a=n(unaryMinus),i=n(isNegative),o=n(matrix$5),s=r("cbrt",{number:_cbrtNumber,Complex:l,"Complex, boolean":l,BigNumber:function(e){return e.cbrt()},Unit:function(t){if(t.value&&e.isComplex(t.value))return(o=t.clone()).value=1,(o=o.pow(1/3)).value=l(t.value),o;var n,r=i(t.value);r&&(t.value=a(t.value)),n=e.isBigNumber(t.value)?new e.BigNumber(1).div(3):e.isFraction(t.value)?new e.Fraction(1,3):1/3;var o=t.pow(n);return r&&(o.value=a(o.value)),o},"Array | Matrix":function(e){return deepMap(e,s)}});function l(n,r){var a=n.arg()/3,i=n.abs(),s=new e.Complex(_cbrtNumber(i),0).mul(new e.Complex(0,a).exp());if(r){var l=[s,new e.Complex(_cbrtNumber(i),0).mul(new e.Complex(0,a+2*Math.PI/3).exp()),new e.Complex(_cbrtNumber(i),0).mul(new e.Complex(0,a-2*Math.PI/3).exp())];return"Array"===t.matrix?l:o(l)}return s}return s.toTex={1:"\\sqrt[3]{${args[0]}}"},s}var _cbrtNumber=Math.cbrt||function(e){if(0===e)return e;var t,n=e<0;return n&&(e=-e),t=isFinite(e)?(e/((t=Math.exp(Math.log(e)/3))*t)+2*t)/3:e,n?-t:t},name$28="cbrt",factory_1$2b=factory$2b,cbrt={name:name$28,factory:factory_1$2b};function factory$2a(e,t,n,r){var a=r("ceil",{number:Math.ceil,Complex:function(e){return e.ceil()},BigNumber:function(e){return e.ceil()},Fraction:function(e){return e.ceil()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\left\\lceil${args[0]}\\right\\rceil"},a}var name$27="ceil",factory_1$2a=factory$2a,ceil={name:name$27,factory:factory_1$2a};function factory$29(e,t,n,r){var a=r("cube",{number:function(e){return e*e*e},Complex:function(e){return e.mul(e).mul(e)},BigNumber:function(e){return e.times(e).times(e)},Fraction:function(e){return e.pow(3)},"Array | Matrix":function(e){return deepMap(e,a)},Unit:function(e){return e.pow(3)}});return a.toTex={1:"\\left(${args[0]}\\right)^3"},a}var name$26="cube",factory_1$29=factory$29,cube={name:name$26,factory:factory_1$29};function factory$28(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n,o){var s=e._data,l=e._size,u=e._datatype,c=t._values,p=t._index,d=t._ptr,m=t._size,f=t._datatype;if(l.length!==m.length)throw new DimensionError_1(l.length,m.length);if(l[0]!==m[0]||l[1]!==m[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+m+")");if(!c)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var h,y=l[0],b=l[1],g=a,v=0,T=n;"string"==typeof u&&u===f&&(h=u,g=r.find(a,[h,h]),v=r.convert(0,h),T=r.find(n,[h,h]));for(var C=[],N=[],A=[],S=0;S<b;S++){A[S]=N.length;for(var w=d[S],x=d[S+1],V=w;V<x;V++){var E=p[V],$=o?T(c[V],s[E][S]):T(s[E][S],c[V]);g($,v)||(N.push(E),C.push($))}}return A[b]=N.length,new i({values:C,index:N,ptr:A,size:[y,b],datatype:h})}}var name$25="algorithm02",factory_1$28=factory$28,algorithm02={name:name$25,factory:factory_1$28};function factory$27(e,t,n,r){var a=n(matrix$5),i=n(divideScalar),o=latex$1,s=n(algorithm02),l=n(algorithm03),u=n(algorithm07),c=n(algorithm11),p=n(algorithm12),d=n(algorithm13),m=n(algorithm14),f=r("dotDivide",{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return l(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return d(e,t,i)},"Array, Array":function(e,t){return f(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return f(a(e),t)},"Matrix, Array":function(e,t){return f(e,a(t))},"SparseMatrix, any":function(e,t){return c(e,t,i,!1)},"DenseMatrix, any":function(e,t){return m(e,t,i,!1)},"any, SparseMatrix":function(e,t){return p(t,e,i,!0)},"any, DenseMatrix":function(e,t){return m(t,e,i,!0)},"Array, any":function(e,t){return m(a(e),t,i,!1).valueOf()},"any, Array":function(e,t){return m(a(t),e,i,!0).valueOf()}});return f.toTex={2:"\\left(${args[0]}"+o.operators.dotDivide+"${args[1]}\\right)"},f}var name$24="dotDivide",factory_1$27=factory$27,dotDivide={name:name$24,factory:factory_1$27};function factory$26(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype,p=t._values,d=t._index,m=t._ptr,f=t._size,h=t._datatype;if(u.length!==f.length)throw new DimensionError_1(u.length,f.length);if(u[0]!==f[0]||u[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+f+")");var y,b=u[0],g=u[1],v=a,T=0,C=n;"string"==typeof c&&c===h&&(y=c,v=r.find(a,[y,y]),T=r.convert(0,y),C=r.find(n,[y,y]));var N,A,S,w,x,V=o&&p?[]:void 0,E=[],$=[],_=new i({values:V,index:E,ptr:$,size:[b,g],datatype:y}),O=V?[]:void 0,I=[];for(A=0;A<g;A++){$[A]=E.length;var D=A+1;if(O)for(w=m[A],x=m[A+1],S=w;S<x;S++)I[N=d[S]]=D,O[N]=p[S];for(w=l[A],x=l[A+1],S=w;S<x;S++)if(N=s[S],O){var R=I[N]===D?O[N]:T,P=C(o[S],R);v(P,T)||(E.push(N),V.push(P))}else E.push(N)}return $[g]=E.length,_}}var name$23="algorithm09",factory_1$26=factory$26,algorithm09={name:name$23,factory:factory_1$26};function factory$25(e,t,n,r){var a=n(matrix$5),i=n(multiplyScalar),o=latex$1,s=n(algorithm02),l=n(algorithm09),u=n(algorithm11),c=n(algorithm13),p=n(algorithm14),d=r("dotMultiply",{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return l(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,i)},"Array, Array":function(e,t){return d(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return d(a(e),t)},"Matrix, Array":function(e,t){return d(e,a(t))},"SparseMatrix, any":function(e,t){return u(e,t,i,!1)},"DenseMatrix, any":function(e,t){return p(e,t,i,!1)},"any, SparseMatrix":function(e,t){return u(t,e,i,!0)},"any, DenseMatrix":function(e,t){return p(t,e,i,!0)},"Array, any":function(e,t){return p(a(e),t,i,!1).valueOf()},"any, Array":function(e,t){return p(a(t),e,i,!0).valueOf()}});return d.toTex={2:"\\left(${args[0]}"+o.operators.dotMultiply+"${args[1]}\\right)"},d}var name$22="dotMultiply",factory_1$25=factory$25,dotMultiply={name:name$22,factory:factory_1$25};function factory$24(e,t,n,r){var a=n(matrix$5),i=n(pow$1),o=latex$1,s=n(algorithm03),l=n(algorithm07),u=n(algorithm11),c=n(algorithm12),p=n(algorithm13),d=n(algorithm14),m=r("dotPow",{"any, any":i,"SparseMatrix, SparseMatrix":function(e,t){return l(e,t,i,!1)},"SparseMatrix, DenseMatrix":function(e,t){return s(t,e,i,!0)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,i,!1)},"DenseMatrix, DenseMatrix":function(e,t){return p(e,t,i)},"Array, Array":function(e,t){return m(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return m(a(e),t)},"Matrix, Array":function(e,t){return m(e,a(t))},"SparseMatrix, any":function(e,t){return u(e,t,m,!1)},"DenseMatrix, any":function(e,t){return d(e,t,m,!1)},"any, SparseMatrix":function(e,t){return c(t,e,m,!0)},"any, DenseMatrix":function(e,t){return d(t,e,m,!0)},"Array, any":function(e,t){return d(a(e),t,m,!1).valueOf()},"any, Array":function(e,t){return d(a(t),e,m,!0).valueOf()}});return m.toTex={2:"\\left(${args[0]}"+o.operators.dotPow+"${args[1]}\\right)"},m}var name$21="dotPow",factory_1$24=factory$24,dotPow={name:name$21,factory:factory_1$24};function factory$23(e,t,n,r){var a=r("exp",{number:Math.exp,Complex:function(e){return e.exp()},BigNumber:function(e){return e.exp()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\exp\\left(${args[0]}\\right)"},a}var name$20="exp",factory_1$23=factory$23,exp$1={name:name$20,factory:factory_1$23};function factory$22(e,t,n,r){var a=latex$1,i=r("expm1",{number:Math.expm1||function(e){return e>=2e-4||e<=-2e-4?Math.exp(e)-1:e+e*e/2+e*e*e/6},Complex:function(t){var n=Math.exp(t.re);return new e.Complex(n*Math.cos(t.im)-1,n*Math.sin(t.im))},BigNumber:function(e){return e.exp().minus(1)},"Array | Matrix":function(e){return deepMap(e,i)}});return i.toTex="\\left(e"+a.operators.pow+"{${args[0]}}-1\\right)",i}var name$1$="expm1",factory_1$22=factory$22,expm1={name:name$1$,factory:factory_1$22};function factory$21(e,t,n,r){var a=r("fix",{number:function(e){return e>0?Math.floor(e):Math.ceil(e)},Complex:function(t){return new e.Complex(t.re>0?Math.floor(t.re):Math.ceil(t.re),t.im>0?Math.floor(t.im):Math.ceil(t.im))},BigNumber:function(e){return e.isNegative()?e.ceil():e.floor()},Fraction:function(e){return e.s<0?e.ceil():e.floor()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},a}var name$1_="fix",factory_1$21=factory$21,fix={name:name$1_,factory:factory_1$21};function factory$20(e,t,n,r){var a=r("floor",{number:Math.floor,Complex:function(e){return e.floor()},BigNumber:function(e){return e.floor()},Fraction:function(e){return e.floor()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\left\\lfloor${args[0]}\\right\\rfloor"},a}var name$1Z="floor",factory_1$20=factory$20,floor={name:name$1Z,factory:factory_1$20},isInteger$k=number$5.isInteger;function factory$1$(e,t,n,r){var a=n(matrix$5),i=n(algorithm01),o=n(algorithm04),s=n(algorithm10),l=n(algorithm13),u=n(algorithm14),c=r("gcd",{"number, number":_gcd,"BigNumber, BigNumber":function(t,n){if(!t.isInt()||!n.isInt())throw new Error("Parameters in function gcd must be integer numbers");for(var r=new e.BigNumber(0);!n.isZero();){var a=t.mod(n);t=n,n=a}return t.lt(r)?t.neg():t},"Fraction, Fraction":function(e,t){return e.gcd(t)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,c)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,c,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,c,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,c)},"Array, Array":function(e,t){return c(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return c(a(e),t)},"Matrix, Array":function(e,t){return c(e,a(t))},"SparseMatrix, number | BigNumber":function(e,t){return s(e,t,c,!1)},"DenseMatrix, number | BigNumber":function(e,t){return u(e,t,c,!1)},"number | BigNumber, SparseMatrix":function(e,t){return s(t,e,c,!0)},"number | BigNumber, DenseMatrix":function(e,t){return u(t,e,c,!0)},"Array, number | BigNumber":function(e,t){return u(a(e),t,c,!1).valueOf()},"number | BigNumber, Array":function(e,t){return u(a(t),e,c,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(e,t,n){for(var r=c(e,t),a=0;a<n.length;a++)r=c(r,n[a]);return r}});return c.toTex="\\gcd\\left(${args}\\right)",c}function _gcd(e,t){if(!isInteger$k(e)||!isInteger$k(t))throw new Error("Parameters in function gcd must be integer numbers");for(var n;0!=t;)n=e%t,e=t,t=n;return e<0?-e:e}var name$1Y="gcd",factory_1$1$=factory$1$,gcd={name:name$1Y,factory:factory_1$1$},flatten$i=array$3.flatten;function factory$1_(e,t,n,r){var a=n(abs$1),i=n(addScalar),o=n(divideScalar),s=n(multiplyScalar),l=n(sqrt$1),u=n(smaller$1),c=n(isPositive),p=r("hypot",{"... number | BigNumber":function(e){for(var t=0,n=0,r=0;r<e.length;r++){var p=a(e[r]);u(n,p)?(t=s(t,s(o(n,p),o(n,p))),t=i(t,1),n=p):t=i(t,c(p)?s(o(p,n),o(p,n)):p)}return s(n,l(t))},Array:function(e){return p.apply(p,flatten$i(e))},Matrix:function(e){return p.apply(p,flatten$i(e.toArray()))}});return p.toTex="\\hypot\\left(${args}\\right)",p}var name$1X="hypot",factory_1$1_=factory$1_,hypot={name:name$1X,factory:factory_1$1_},scatter=function(e,t,n,r,a,i,o,s,l,u,c){var p,d,m,f,h=e._values,y=e._index,b=e._ptr,g=o._index;if(r)for(d=b[t],m=b[t+1],p=d;p<m;p++)n[f=y[p]]!==i?(n[f]=i,g.push(f),u?(r[f]=l?s(h[p],c):s(c,h[p]),a[f]=i):r[f]=h[p]):(r[f]=l?s(h[p],r[f]):s(r[f],h[p]),a[f]=i);else for(d=b[t],m=b[t+1],p=d;p<m;p++)n[f=y[p]]!==i?(n[f]=i,g.push(f)):a[f]=i};function factory$1Z(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n){var o=e._values,s=e._size,l=e._datatype,u=t._values,c=t._size,p=t._datatype;if(s.length!==c.length)throw new DimensionError_1(s.length,c.length);if(s[0]!==c[0]||s[1]!==c[1])throw new RangeError("Dimension mismatch. Matrix A ("+s+") must match Matrix B ("+c+")");var d,m=s[0],f=s[1],h=a,y=0,b=n;"string"==typeof l&&l===p&&(d=l,h=r.find(a,[d,d]),y=r.convert(0,d),b=r.find(n,[d,d]));for(var g=o&&u?[]:void 0,v=[],T=[],C=new i({values:g,index:v,ptr:T,size:[m,f],datatype:d}),N=g?[]:void 0,A=[],S=[],w=0;w<f;w++){T[w]=v.length;var x=w+1;if(scatter(e,w,A,N,S,x,C,b),scatter(t,w,A,N,S,x,C,b),N)for(var V=T[w];V<v.length;){var E=v[V];if(S[E]===x){var $=N[E];h($,y)?v.splice(V,1):(g.push($),V++)}else v.splice(V,1)}else for(var _=T[w];_<v.length;)S[v[_]]!==x?v.splice(_,1):_++}return T[f]=v.length,C}}var name$1W="algorithm06",factory_1$1Z=factory$1Z,algorithm06={name:name$1W,factory:factory_1$1Z},isInteger$j=number$5.isInteger;function factory$1Y(e,t,n,r){var a=n(matrix$5),i=n(algorithm02),o=n(algorithm06),s=n(algorithm11),l=n(algorithm13),u=n(algorithm14),c=r("lcm",{"number, number":_lcm,"BigNumber, BigNumber":function(t,n){if(!t.isInt()||!n.isInt())throw new Error("Parameters in function lcm must be integer numbers");if(t.isZero()||n.isZero())return new e.BigNumber(0);for(var r=t.times(n);!n.isZero();){var a=n;n=t.mod(a),t=a}return r.div(t).abs()},"Fraction, Fraction":function(e,t){return e.lcm(t)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,c)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,c,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,c,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,c)},"Array, Array":function(e,t){return c(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return c(a(e),t)},"Matrix, Array":function(e,t){return c(e,a(t))},"SparseMatrix, number | BigNumber":function(e,t){return s(e,t,c,!1)},"DenseMatrix, number | BigNumber":function(e,t){return u(e,t,c,!1)},"number | BigNumber, SparseMatrix":function(e,t){return s(t,e,c,!0)},"number | BigNumber, DenseMatrix":function(e,t){return u(t,e,c,!0)},"Array, number | BigNumber":function(e,t){return u(a(e),t,c,!1).valueOf()},"number | BigNumber, Array":function(e,t){return u(a(t),e,c,!0).valueOf()},"Array | Matrix | number | BigNumber, Array | Matrix | number | BigNumber, ...Array | Matrix | number | BigNumber":function(e,t,n){for(var r=c(e,t),a=0;a<n.length;a++)r=c(r,n[a]);return r}});return c.toTex=void 0,c}function _lcm(e,t){if(!isInteger$j(e)||!isInteger$j(t))throw new Error("Parameters in function lcm must be integer numbers");if(0==e||0==t)return 0;for(var n,r=e*t;0!=t;)t=e%(n=t),e=n;return Math.abs(r/e)}var name$1V="lcm",factory_1$1Y=factory$1Y,lcm={name:name$1V,factory:factory_1$1Y};function factory$1X(e,t,n,r){var a=n(divideScalar),i=r("log",{number:function(n){return n>=0||t.predictable?Math.log(n):new e.Complex(n,0).log()},Complex:function(e){return e.log()},BigNumber:function(n){return!n.isNegative()||t.predictable?n.ln():new e.Complex(n.toNumber(),0).log()},"Array | Matrix":function(e){return deepMap(e,i)},"any, any":function(e,t){return a(i(e),i(t))}});return i.toTex={1:"\\ln\\left(${args[0]}\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}\\right)"},i}var name$1U="log",factory_1$1X=factory$1X,log$2={name:name$1U,factory:factory_1$1X};function factory$1W(e,t,n,r){var a=r("log10",{number:function(n){return n>=0||t.predictable?_log10(n):new e.Complex(n,0).log().div(Math.LN10)},Complex:function(t){return new e.Complex(t).log().div(Math.LN10)},BigNumber:function(n){return!n.isNegative()||t.predictable?n.log():new e.Complex(n.toNumber(),0).log().div(Math.LN10)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\log_{10}\\left(${args[0]}\\right)"},a}var _log10=Math.log10||function(e){return Math.log(e)/Math.LN10},name$1T="log10",factory_1$1W=factory$1W,log10$1={name:name$1T,factory:factory_1$1W};function factory$1V(e,t,n,r){var a=n(divideScalar),i=n(log$2),o=r("log1p",{number:function(n){return n>=-1||t.predictable?Math.log1p?Math.log1p(n):Math.log(n+1):s(new e.Complex(n,0))},Complex:s,BigNumber:function(n){var r=n.plus(1);return!r.isNegative()||t.predictable?r.ln():s(new e.Complex(n.toNumber(),0))},"Array | Matrix":function(e){return deepMap(e,o)},"any, any":function(e,t){return a(o(e),i(t))}});function s(t){var n=t.re+1;return new e.Complex(Math.log(Math.sqrt(n*n+t.im*t.im)),Math.atan2(t.im,n))}return o.toTex={1:"\\ln\\left(${args[0]}+1\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}+1\\right)"},o}var name$1S="log1p",factory_1$1V=factory$1V,log1p={name:name$1S,factory:factory_1$1V};function factory$1U(e,t,n,r){var a=r("log2",{number:function(n){return n>=0||t.predictable?Math.log2?Math.log2(n):Math.log(n)/Math.LN2:i(new e.Complex(n,0))},Complex:i,BigNumber:function(n){return!n.isNegative()||t.predictable?n.log(2):i(new e.Complex(n.toNumber(),0))},"Array | Matrix":function(e){return deepMap(e,a)}});function i(t){var n=Math.sqrt(t.re*t.re+t.im*t.im);return new e.Complex(Math.log2?Math.log2(n):Math.log(n)/Math.LN2,Math.atan2(t.im,t.re)/Math.LN2)}return a.toTex="\\log_{2}\\left(${args[0]}\\right)",a}var name$1R="log2",factory_1$1U=factory$1U,log2={name:name$1R,factory:factory_1$1U};function factory$1T(e,t,n,r){var a=n(matrix$5),i=latex$1,o=n(algorithm02),s=n(algorithm03),l=n(algorithm05),u=n(algorithm11),c=n(algorithm12),p=n(algorithm13),d=n(algorithm14),m=r("mod",{"number, number":function(e,t){if(t>0)return e-t*Math.floor(e/t);if(0===t)return e;throw new Error("Cannot calculate mod for a negative divisor")},"BigNumber, BigNumber":function(e,t){return t.isZero()?e:e.mod(t)},"Fraction, Fraction":function(e,t){return e.mod(t)},"SparseMatrix, SparseMatrix":function(e,t){return l(e,t,m,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,m,!0)},"DenseMatrix, SparseMatrix":function(e,t){return s(e,t,m,!1)},"DenseMatrix, DenseMatrix":function(e,t){return p(e,t,m)},"Array, Array":function(e,t){return m(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return m(a(e),t)},"Matrix, Array":function(e,t){return m(e,a(t))},"SparseMatrix, any":function(e,t){return u(e,t,m,!1)},"DenseMatrix, any":function(e,t){return d(e,t,m,!1)},"any, SparseMatrix":function(e,t){return c(t,e,m,!0)},"any, DenseMatrix":function(e,t){return d(t,e,m,!0)},"Array, any":function(e,t){return d(a(e),t,m,!1).valueOf()},"any, Array":function(e,t){return d(a(t),e,m,!0).valueOf()}});return m.toTex={2:"\\left(${args[0]}"+i.operators.mod+"${args[1]}\\right)"},m}var name$1Q="mod",factory_1$1T=factory$1T,mod$1={name:name$1Q,factory:factory_1$1T},clone$4=object$6.clone,format$5=string$a.format;function factory$1S(e,t,n,r){var a=n(matrix$5),i=n(add$2),o=r("trace",{Array:function(e){return s(a(e))},SparseMatrix:function(e){var t=e._values,n=e._index,r=e._ptr,a=e._size,o=a[0],s=a[1];if(o===s){var l=0;if(t.length>0)for(var u=0;u<s;u++)for(var c=r[u],p=r[u+1],d=c;d<p;d++){var m=n[d];if(m===u){l=i(l,t[d]);break}if(m>u)break}return l}throw new RangeError("Matrix must be square (size: "+format$5(a)+")")},DenseMatrix:s,any:clone$4});function s(e){var t=e._size,n=e._data;switch(t.length){case 1:if(1===t[0])return clone$4(n[0]);throw new RangeError("Matrix must be square (size: "+format$5(t)+")");case 2:var r=t[0];if(r===t[1]){for(var a=0,o=0;o<r;o++)a=i(a,n[o][o]);return a}throw new RangeError("Matrix must be square (size: "+format$5(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+format$5(t)+")")}}return o.toTex={1:"\\mathrm{tr}\\left(${args[0]}\\right)"},o}var name$1P="trace",factory_1$1S=factory$1S,trace={name:name$1P,factory:factory_1$1S};function factory$1R(e,t,n,r){var a=n(abs$1),i=n(add$2),o=n(pow$1),s=n(conj$1),l=n(sqrt$1),u=n(multiply$1),c=n(equalScalar),p=n(larger$1),d=n(smaller$1),m=n(matrix$5);n(trace),n(transpose);var f=r("norm",{number:Math.abs,Complex:function(e){return e.abs()},BigNumber:function(e){return e.abs()},boolean:function(e){return Math.abs(e)},Array:function(e){return h(m(e),2)},Matrix:function(e){return h(e,2)},"number | Complex | BigNumber | boolean, number | BigNumber | string":function(e){return f(e)},"Array, number | BigNumber | string":function(e,t){return h(m(e),t)},"Matrix, number | BigNumber | string":function(e,t){return h(e,t)}});function h(e,t){var n=e.size();if(1==n.length){if(t===Number.POSITIVE_INFINITY||"inf"===t){var r=0;return e.forEach((function(e){var t=a(e);p(t,r)&&(r=t)}),!0),r}var m;if(t===Number.NEGATIVE_INFINITY||"-inf"===t)return e.forEach((function(e){var t=a(e);m&&!d(t,m)||(m=t)}),!0),m||0;if("fro"===t)return h(e,2);if("number"==typeof t&&!isNaN(t)){if(!c(t,0)){var f=0;return e.forEach((function(e){f=i(o(a(e),t),f)}),!0),o(f,1/t)}return Number.POSITIVE_INFINITY}throw new Error("Unsupported parameter value")}if(2==n.length){if(1===t){var y=[],b=0;return e.forEach((function(e,t){var n=t[1],r=i(y[n]||0,a(e));p(r,b)&&(b=r),y[n]=r}),!0),b}if(t===Number.POSITIVE_INFINITY||"inf"===t){var g=[],v=0;return e.forEach((function(e,t){var n=t[0],r=i(g[n]||0,a(e));p(r,v)&&(v=r),g[n]=r}),!0),v}if("fro"===t){var T=0;return e.forEach((function(e,t){T=i(T,u(e,s(e)))})),l(T)}if(2===t)throw new Error("Unsupported parameter value, missing implementation of matrix singular value decomposition");throw new Error("Unsupported parameter value")}}return f.toTex={1:"\\left\\|${args[0]}\\right\\|",2:void 0},f}var name$1O="norm",factory_1$1R=factory$1R,norm={name:name$1O,factory:factory_1$1R};function factory$1Q(e,t,n,r){var a=n(matrix$5),i=n(algorithm01),o=n(algorithm02),s=n(algorithm06),l=n(algorithm11),u=n(algorithm13),c=n(algorithm14),p=r("nthRoot",{number:function(e){return _nthRoot(e,2)},"number, number":_nthRoot,BigNumber:function(t){return d(t,new e.BigNumber(2))},Complex:function(e){return _nthComplexRoot(e,2)},"Complex, number":_nthComplexRoot,"BigNumber, BigNumber":d,"Array | Matrix":function(e){return p(e,2)},"SparseMatrix, SparseMatrix":function(e,t){if(1===t.density())return s(e,t,p);throw new Error("Root must be non-zero")},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){if(1===t.density())return i(e,t,p,!1);throw new Error("Root must be non-zero")},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, number | BigNumber":function(e,t){return l(e,t,p,!1)},"DenseMatrix, number | BigNumber":function(e,t){return c(e,t,p,!1)},"number | BigNumber, SparseMatrix":function(e,t){if(1===t.density())return l(t,e,p,!0);throw new Error("Root must be non-zero")},"number | BigNumber, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, number | BigNumber":function(e,t){return p(a(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return p(e,a(t)).valueOf()}});return p.toTex={2:"\\sqrt[${args[1]}]{${args[0]}}"},p;function d(t,n){var r=e.BigNumber.precision,a=e.BigNumber.clone({precision:r+2}),i=new e.BigNumber(0),o=new a(1),s=n.isNegative();if(s&&(n=n.neg()),n.isZero())throw new Error("Root must be non-zero");if(t.isNegative()&&!n.abs().mod(2).equals(1))throw new Error("Root must be odd when a is negative.");if(t.isZero())return s?new a(1/0):0;if(!t.isFinite())return s?i:t;var l=t.abs().pow(o.div(n));return l=t.isNeg()?l.neg():l,new e.BigNumber((s?o.div(l):l).toPrecision(r))}}function _nthRoot(e,t){var n=t<0;if(n&&(t=-t),0===t)throw new Error("Root must be non-zero");if(e<0&&Math.abs(t)%2!=1)throw new Error("Root must be odd when a is negative.");if(0==e)return n?1/0:0;if(!isFinite(e))return n?0:e;var r=Math.pow(Math.abs(e),1/t);return r=e<0?-r:r,n?1/r:r}function _nthComplexRoot(e,t){if(t<0)throw new Error("Root must be greater than zero");if(0===t)throw new Error("Root must be non-zero");if(t%1!=0)throw new Error("Root must be an integer");for(var n=e.arg(),r=e.abs(),a=[],i=Math.pow(r,1/t),o=0;o<t;o++)a.push({r:i,phi:(n+2*Math.PI*o)/t});return a}var name$1N="nthRoot",factory_1$1Q=factory$1Q,nthRoot={name:name$1N,factory:factory_1$1Q},isInteger$i=number$5.isInteger,toFixed=number$5.toFixed,NO_INT="Number of decimals in function round must be an integer";function factory$1P(e,t,n,r){var a=n(matrix$5),i=n(equalScalar),o=n(zeros),s=n(algorithm11),l=n(algorithm12),u=n(algorithm14),c=r("round",{number:Math.round,"number, number":function(e,t){if(!isInteger$i(t))throw new TypeError(NO_INT);if(t<0||t>15)throw new Error("Number of decimals in function round must be in te range of 0-15");return _round(e,t)},Complex:function(e){return e.round()},"Complex, number":function(e,t){if(t%1)throw new TypeError(NO_INT);return e.round(t)},"Complex, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(NO_INT);var n=t.toNumber();return e.round(n)},"number, BigNumber":function(t,n){if(!n.isInteger())throw new TypeError(NO_INT);return new e.BigNumber(t).toDecimalPlaces(n.toNumber())},BigNumber:function(e){return e.toDecimalPlaces(0)},"BigNumber, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(NO_INT);return e.toDecimalPlaces(t.toNumber())},Fraction:function(e){return e.round()},"Fraction, number":function(e,t){if(t%1)throw new TypeError(NO_INT);return e.round(t)},"Array | Matrix":function(e){return deepMap(e,c)},"SparseMatrix, number | BigNumber":function(e,t){return s(e,t,c,!1)},"DenseMatrix, number | BigNumber":function(e,t){return u(e,t,c,!1)},"number | Complex | BigNumber, SparseMatrix":function(e,t){return i(e,0)?o(t.size(),t.storage()):l(t,e,c,!0)},"number | Complex | BigNumber, DenseMatrix":function(e,t){return i(e,0)?o(t.size(),t.storage()):u(t,e,c,!0)},"Array, number | BigNumber":function(e,t){return u(a(e),t,c,!1).valueOf()},"number | Complex | BigNumber, Array":function(e,t){return u(a(t),e,c,!0).valueOf()}});return c.toTex={1:"\\left\\lfloor${args[0]}\\right\\rceil",2:void 0},c}function _round(e,t){return parseFloat(toFixed(e,t))}var name$1M="round",factory_1$1P=factory$1P,round$1={name:name$1M,factory:factory_1$1P};function factory$1O(e,t,n,r){var a=r("square",{number:function(e){return e*e},Complex:function(e){return e.mul(e)},BigNumber:function(e){return e.times(e)},Fraction:function(e){return e.mul(e)},"Array | Matrix":function(e){return deepMap(e,a)},Unit:function(e){return e.pow(2)}});return a.toTex={1:"\\left(${args[0]}\\right)^2"},a}var name$1L="square",factory_1$1O=factory$1O,square={name:name$1L,factory:factory_1$1O};function factory$1N(e,t,n,r){var a=latex$1,i=r("unaryPlus",{number:function(e){return e},Complex:function(e){return e},BigNumber:function(e){return e},Fraction:function(e){return e},Unit:function(e){return e.clone()},"Array | Matrix":function(e){return deepMap(e,i)},"boolean | string":function(n){return"BigNumber"==t.number?new e.BigNumber(+n):+n}});return i.toTex={1:a.operators.unaryPlus+"\\left(${args[0]}\\right)"},i}var name$1K="unaryPlus",factory_1$1N=factory$1N,unaryPlus={name:name$1K,factory:factory_1$1N},isInteger$h=number$5.isInteger;function factory$1M(e,t,n,r){var a=n(matrix$5),i=r("xgcd",{"number, number":function(e,n){var r,i,o,s,l=0,u=1,c=1,p=0;if(!isInteger$h(e)||!isInteger$h(n))throw new Error("Parameters in function xgcd must be integer numbers");for(;n;)o=e-(i=Math.floor(e/n))*n,r=l,l=u-i*l,u=r,r=c,c=p-i*c,p=r,e=n,n=o;return s=e<0?[-e,-u,-p]:[e,e?u:0,p],"Array"===t.matrix?s:a(s)},"BigNumber, BigNumber":function(n,r){var i,o,s,l,u=new e.BigNumber(0),c=new e.BigNumber(1),p=u,d=c,m=c,f=u;if(!n.isInt()||!r.isInt())throw new Error("Parameters in function xgcd must be integer numbers");for(;!r.isZero();)o=n.div(r).floor(),s=n.mod(r),i=p,p=d.minus(o.times(p)),d=i,i=m,m=f.minus(o.times(m)),f=i,n=r,r=s;return l=n.lt(u)?[n.neg(),d.neg(),f.neg()]:[n,n.isZero()?0:d,f],"Array"===t.matrix?l:a(l)}});return i.toTex=void 0,i}var name$1J="xgcd",factory_1$1M=factory$1M,xgcd={name:name$1J,factory:factory_1$1M},arithmetic$1=[abs$1,add$2,addScalar,cbrt,ceil,cube,divide$1,dotDivide,dotMultiply,dotPow,exp$1,expm1,fix,floor,gcd,hypot,lcm,log$2,log10$1,log1p,log2,mod$1,multiply$1,norm,nthRoot,pow$1,round$1,sign$3,sqrt$1,square,subtract$1,unaryMinus,unaryPlus,xgcd],bitNot$1=function(e){if(e.isFinite()&&!e.isInteger())throw new Error("Integer expected in function bitNot");var t=e.constructor,n=t.precision;return t.config({precision:1e9}),(e=e.plus(new t(1))).s=-e.s||null,t.config({precision:n}),e},bitwise$1=function(e,t,n){var r,a,i,o,s,l=e.constructor,u=+(e.s<0),c=+(t.s<0);if(u){r=decCoefficientToBinaryString(bitNot$1(e));for(var p=0;p<r.length;++p)r[p]^=1}else r=decCoefficientToBinaryString(e);if(c)for(a=decCoefficientToBinaryString(bitNot$1(t)),p=0;p<a.length;++p)a[p]^=1;else a=decCoefficientToBinaryString(t);r.length<=a.length?(i=r,o=a,s=u):(i=a,o=r,s=c);var d=i.length,m=o.length,f=1^n(u,c),h=new l(1^f),y=new l(1),b=new l(2),g=l.precision;for(l.config({precision:1e9});d>0;)n(i[--d],o[--m])==f&&(h=h.plus(y)),y=y.times(b);for(;m>0;)n(s,o[--m])==f&&(h=h.plus(y)),y=y.times(b);return l.config({precision:g}),0==f&&(h.s=-h.s),h};function decCoefficientToBinaryString(e){for(var t=e.d,n=t[0]+"",r=1;r<t.length;++r){for(var a=t[r]+"",i=7-a.length;i--;)a="0"+a;n+=a}for(p=n.length-1;"0"==n.charAt(p);--p);var o=e.e,s=n.slice(0,p+1||1),l=s.length;if(o>0)if(++o>l)for(o-=l;o--;s+="0");else o<l&&(s=s.slice(0,o)+"."+s.slice(o));var u=[0];for(r=0;r<s.length;){for(var c=u.length;c--;u[c]*=10);u[0]+=s.charAt(r++)<<0;for(var p=0;p<u.length;++p)u[p]>1&&(null==u[p+1]&&(u[p+1]=0),u[p+1]+=u[p]>>1,u[p]&=1)}return u.reverse()}var bitAnd$1=function(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitAnd");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);if(e.isZero()||t.eq(-1)||e.eq(t))return e;if(t.isZero()||e.eq(-1))return t;if(!e.isFinite()||!t.isFinite()){if(!e.isFinite()&&!t.isFinite())return e.isNegative()==t.isNegative()?e:new n(0);if(!e.isFinite())return t.isNegative()?e:e.isNegative()?new n(0):t;if(!t.isFinite())return e.isNegative()?t:t.isNegative()?new n(0):e}return bitwise$1(e,t,(function(e,t){return e&t}))},isInteger$g=number$5.isInteger;function factory$1L(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm02),s=n(algorithm06),l=n(algorithm11),u=n(algorithm13),c=n(algorithm14),p=r("bitAnd",{"number, number":function(e,t){if(!isInteger$g(e)||!isInteger$g(t))throw new Error("Integers expected in function bitAnd");return e&t},"BigNumber, BigNumber":bitAnd$1,"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,p,!1)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return p(i(e),t)},"Matrix, Array":function(e,t){return p(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,p,!1)},"DenseMatrix, any":function(e,t){return c(e,t,p,!1)},"any, SparseMatrix":function(e,t){return l(t,e,p,!0)},"any, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, any":function(e,t){return c(i(e),t,p,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+a.operators.bitAnd+"${args[1]}\\right)"},p}var name$1I="bitAnd",factory_1$1L=factory$1L,bitAnd={name:name$1I,factory:factory_1$1L},isInteger$f=number$5.isInteger;function factory$1K(e,t,n,r){var a=latex$1,i=r("bitNot",{number:function(e){if(!isInteger$f(e))throw new Error("Integer expected in function bitNot");return~e},BigNumber:bitNot$1,"Array | Matrix":function(e){return deepMap(e,i)}});return i.toTex={1:a.operators.bitNot+"\\left(${args[0]}\\right)"},i}var name$1H="bitNot",factory_1$1K=factory$1K,bitNot={name:name$1H,factory:factory_1$1K},bitOr$1=function(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitOr");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);var r=new n(-1);return e.isZero()||t.eq(r)||e.eq(t)?t:t.isZero()||e.eq(r)?e:e.isFinite()&&t.isFinite()?bitwise$1(e,t,(function(e,t){return e|t})):!e.isFinite()&&!e.isNegative()&&t.isNegative()||e.isNegative()&&!t.isNegative()&&!t.isFinite()?r:e.isNegative()&&t.isNegative()?e.isFinite()?e:t:e.isFinite()?t:e},isInteger$e=number$5.isInteger;function factory$1J(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm01),s=n(algorithm04),l=n(algorithm10),u=n(algorithm13),c=n(algorithm14),p=r("bitOr",{"number, number":function(e,t){if(!isInteger$e(e)||!isInteger$e(t))throw new Error("Integers expected in function bitOr");return e|t},"BigNumber, BigNumber":bitOr$1,"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return p(i(e),t)},"Matrix, Array":function(e,t){return p(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,p,!1)},"DenseMatrix, any":function(e,t){return c(e,t,p,!1)},"any, SparseMatrix":function(e,t){return l(t,e,p,!0)},"any, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, any":function(e,t){return c(i(e),t,p,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+a.operators.bitOr+"${args[1]}\\right)"},p}var name$1G="bitOr",factory_1$1J=factory$1J,bitOr={name:name$1G,factory:factory_1$1J},bitXor$1=function(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitXor");var n=e.constructor;if(e.isNaN()||t.isNaN())return new n(NaN);if(e.isZero())return t;if(t.isZero())return e;if(e.eq(t))return new n(0);var r=new n(-1);return e.eq(r)?bitNot$1(t):t.eq(r)?bitNot$1(e):e.isFinite()&&t.isFinite()?bitwise$1(e,t,(function(e,t){return e^t})):e.isFinite()||t.isFinite()?new n(e.isNegative()==t.isNegative()?1/0:-1/0):r},isInteger$d=number$5.isInteger;function factory$1I(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm03),s=n(algorithm07),l=n(algorithm12),u=n(algorithm13),c=n(algorithm14),p=r("bitXor",{"number, number":function(e,t){if(!isInteger$d(e)||!isInteger$d(t))throw new Error("Integers expected in function bitXor");return e^t},"BigNumber, BigNumber":bitXor$1,"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return p(i(e),t)},"Matrix, Array":function(e,t){return p(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,p,!1)},"DenseMatrix, any":function(e,t){return c(e,t,p,!1)},"any, SparseMatrix":function(e,t){return l(t,e,p,!0)},"any, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, any":function(e,t){return c(i(e),t,p,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+a.operators.bitXor+"${args[1]}\\right)"},p}var name$1F="bitXor",factory_1$1I=factory$1I,bitXor={name:name$1F,factory:factory_1$1I},leftShift$1=function(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function leftShift");var n=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new n(NaN):e.isZero()||t.isZero()?e:e.isFinite()||t.isFinite()?t.lt(55)?e.times(Math.pow(2,t.toNumber())+""):e.times(new n(2).pow(t)):new n(NaN)};function factory$1H(e,t,n,r){var a=n(equalScalar),i=e.SparseMatrix;return function(e,t,n){var o=e._values,s=e._index,l=e._ptr,u=e._size,c=e._datatype,p=t._values,d=t._index,m=t._ptr,f=t._size,h=t._datatype;if(u.length!==f.length)throw new DimensionError_1(u.length,f.length);if(u[0]!==f[0]||u[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+u+") must match Matrix B ("+f+")");if(!o||!p)throw new Error("Cannot perform operation on Pattern Sparse Matrices");var y,b=u[0],g=u[1],v=a,T=0,C=n;"string"==typeof c&&c===h&&(y=c,v=r.find(a,[y,y]),T=r.convert(0,y),C=r.find(n,[y,y]));for(var N,A,S,w,x=[],V=[],E=[],$=new i({values:x,index:V,ptr:E,size:[b,g],datatype:y}),_=[],O=[],I=0;I<g;I++){E[I]=V.length;var D=I+1;for(A=l[I],S=l[I+1],N=A;N<S;N++)O[w=s[N]]=D,_[w]=o[N],V.push(w);for(A=m[I],S=m[I+1],N=A;N<S;N++)O[w=d[N]]===D&&(_[w]=C(_[w],p[N]));for(N=E[I];N<V.length;){var R=_[w=V[N]];v(R,T)?V.splice(N,1):(x.push(R),N++)}}return E[g]=V.length,$}}var name$1E="algorithm08",factory_1$1H=factory$1H,algorithm08={name:name$1E,factory:factory_1$1H},isInteger$c=number$5.isInteger;function factory$1G(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(equalScalar),s=n(zeros),l=n(algorithm01),u=n(algorithm02),c=n(algorithm08),p=n(algorithm10),d=n(algorithm11),m=n(algorithm13),f=n(algorithm14),h=r("leftShift",{"number, number":function(e,t){if(!isInteger$c(e)||!isInteger$c(t))throw new Error("Integers expected in function leftShift");return e<<t},"BigNumber, BigNumber":leftShift$1,"SparseMatrix, SparseMatrix":function(e,t){return c(e,t,h,!1)},"SparseMatrix, DenseMatrix":function(e,t){return u(t,e,h,!0)},"DenseMatrix, SparseMatrix":function(e,t){return l(e,t,h,!1)},"DenseMatrix, DenseMatrix":function(e,t){return m(e,t,h)},"Array, Array":function(e,t){return h(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return h(i(e),t)},"Matrix, Array":function(e,t){return h(e,i(t))},"SparseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():d(e,t,h,!1)},"DenseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():f(e,t,h,!1)},"number | BigNumber, SparseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):p(t,e,h,!0)},"number | BigNumber, DenseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):f(t,e,h,!0)},"Array, number | BigNumber":function(e,t){return h(i(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return h(e,i(t)).valueOf()}});return h.toTex={2:"\\left(${args[0]}"+a.operators.leftShift+"${args[1]}\\right)"},h}var name$1D="leftShift",factory_1$1G=factory$1G,leftShift={name:name$1D,factory:factory_1$1G},rightArithShift$1=function(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function rightArithShift");var n=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new n(NaN):e.isZero()||t.isZero()?e:t.isFinite()?t.lt(55)?e.div(Math.pow(2,t.toNumber())+"").floor():e.div(new n(2).pow(t)).floor():e.isNegative()?new n(-1):e.isFinite()?new n(0):new n(NaN)},isInteger$b=number$5.isInteger;function factory$1F(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(equalScalar),s=n(zeros),l=n(algorithm01),u=n(algorithm02),c=n(algorithm08),p=n(algorithm10),d=n(algorithm11),m=n(algorithm13),f=n(algorithm14),h=r("rightArithShift",{"number, number":function(e,t){if(!isInteger$b(e)||!isInteger$b(t))throw new Error("Integers expected in function rightArithShift");return e>>t},"BigNumber, BigNumber":rightArithShift$1,"SparseMatrix, SparseMatrix":function(e,t){return c(e,t,h,!1)},"SparseMatrix, DenseMatrix":function(e,t){return u(t,e,h,!0)},"DenseMatrix, SparseMatrix":function(e,t){return l(e,t,h,!1)},"DenseMatrix, DenseMatrix":function(e,t){return m(e,t,h)},"Array, Array":function(e,t){return h(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return h(i(e),t)},"Matrix, Array":function(e,t){return h(e,i(t))},"SparseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():d(e,t,h,!1)},"DenseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():f(e,t,h,!1)},"number | BigNumber, SparseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):p(t,e,h,!0)},"number | BigNumber, DenseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):f(t,e,h,!0)},"Array, number | BigNumber":function(e,t){return h(i(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return h(e,i(t)).valueOf()}});return h.toTex={2:"\\left(${args[0]}"+a.operators.rightArithShift+"${args[1]}\\right)"},h}var name$1C="rightArithShift",factory_1$1F=factory$1F,rightArithShift={name:name$1C,factory:factory_1$1F},isInteger$a=number$5.isInteger;function factory$1E(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(equalScalar),s=n(zeros),l=n(algorithm01),u=n(algorithm02),c=n(algorithm08),p=n(algorithm10),d=n(algorithm11),m=n(algorithm13),f=n(algorithm14),h=r("rightLogShift",{"number, number":function(e,t){if(!isInteger$a(e)||!isInteger$a(t))throw new Error("Integers expected in function rightLogShift");return e>>>t},"SparseMatrix, SparseMatrix":function(e,t){return c(e,t,h,!1)},"SparseMatrix, DenseMatrix":function(e,t){return u(t,e,h,!0)},"DenseMatrix, SparseMatrix":function(e,t){return l(e,t,h,!1)},"DenseMatrix, DenseMatrix":function(e,t){return m(e,t,h)},"Array, Array":function(e,t){return h(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return h(i(e),t)},"Matrix, Array":function(e,t){return h(e,i(t))},"SparseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():d(e,t,h,!1)},"DenseMatrix, number | BigNumber":function(e,t){return o(t,0)?e.clone():f(e,t,h,!1)},"number | BigNumber, SparseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):p(t,e,h,!0)},"number | BigNumber, DenseMatrix":function(e,t){return o(e,0)?s(t.size(),t.storage()):f(t,e,h,!0)},"Array, number | BigNumber":function(e,t){return h(i(e),t).valueOf()},"number | BigNumber, Array":function(e,t){return h(e,i(t)).valueOf()}});return h.toTex={2:"\\left(${args[0]}"+a.operators.rightLogShift+"${args[1]}\\right)"},h}var name$1B="rightLogShift",factory_1$1E=factory$1E,rightLogShift={name:name$1B,factory:factory_1$1E},bitwise=[bitAnd,bitNot,bitOr,bitXor,leftShift,rightArithShift,rightLogShift],isInteger$9=number$5.isInteger;function factory$1D(e,t,n,r){var a=n(multiply$1),i=n(pow$1),o=r("gamma",{number:function(e){var t,n;if(isInteger$9(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var r=e-2,a=e-1;r>1;)a*=r,r--;return 0==a&&(a=1),a}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*o(1-e));if(e>=171.35)return 1/0;if(e>85){var i=e*e,s=i*e,l=s*e,u=l*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*i)-139/(51840*s)-571/(2488320*l)+163879/(209018880*u)+5246819/(75246796800*u*e))}--e,n=p[0];for(var c=1;c<p.length;++c)n+=p[c]/(e+c);return t=e+g+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*n},Complex:function(t){var n,r;if(0==t.im)return o(t.re);t=new e.Complex(t.re-1,t.im),r=new e.Complex(p[0],0);for(var s=1;s<p.length;++s){var l=t.re+s,u=l*l+t.im*t.im;0!=u?(r.re+=p[s]*l/u,r.im+=-p[s]*t.im/u):r.re=p[s]<0?-1/0:1/0}n=new e.Complex(t.re+g+.5,t.im);var c=Math.sqrt(2*Math.PI);t.re+=.5;var d=i(n,t);0==d.im?d.re*=c:(0==d.re||(d.re*=c),d.im*=c);var m=Math.exp(-n.re);return n.re=m*Math.cos(-n.im),n.im=m*Math.sin(-n.im),a(a(d,n),r)},BigNumber:function(n){if(n.isInteger())return n.isNegative()||n.isZero()?new e.BigNumber(1/0):function(n){if(n.isZero())return new e.BigNumber(1);for(var r=t.precision+(0|Math.log(n.toNumber())),a=new(e.BigNumber.clone({precision:r}))(n),i=n.toNumber()-1;i>1;)a=a.times(i),i--;return new e.BigNumber(a.toPrecision(e.BigNumber.precision))}(n.minus(1));if(!n.isFinite())return new e.BigNumber(n.isNegative()?NaN:1/0);throw new Error("Integer BigNumber expected")},"Array | Matrix":function(e){return deepMap(e,o)}});return o.toTex={1:"\\Gamma\\left(${args[0]}\\right)"},o}var g=4.7421875,p=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],name$1A="gamma",factory_1$1D=factory$1D,gamma$1={name:name$1A,factory:factory_1$1D};function factory$1C(e,t,n,r){var a=n(gamma$1),i=latex$1,o=r("factorial",{number:function(e){if(e<0)throw new Error("Value must be non-negative");return a(e+1)},BigNumber:function(e){if(e.isNegative())throw new Error("Value must be non-negative");return a(e.plus(1))},"Array | Matrix":function(e){return deepMap(e,o)}});return o.toTex={1:"\\left(${args[0]}\\right)"+i.operators.factorial},o}var name$1z="factorial",factory_1$1C=factory$1C,factorial$1={name:name$1z,factory:factory_1$1C},isInteger$8=number$5.isInteger;function factory$1B(e,t,n,r){var a=r("combinations",{"number, number":function(e,t){var n,r,a;if(!isInteger$8(e)||e<0)throw new TypeError("Positive integer value expected in function combinations");if(!isInteger$8(t)||t<0)throw new TypeError("Positive integer value expected in function combinations");if(t>e)throw new TypeError("k must be less than or equal to n");for(n=Math.max(t,e-t),r=1,a=1;a<=e-n;a++)r=r*(n+a)/a;return r},"BigNumber, BigNumber":function(t,n){var r,a,i,o,s=new e.BigNumber(1);if(!isPositiveInteger$1(t)||!isPositiveInteger$1(n))throw new TypeError("Positive integer value expected in function combinations");if(n.gt(t))throw new TypeError("k must be less than n in function combinations");for(r=t.minus(n),n.lt(r)&&(r=n),a=s,i=s,o=t.minus(r);i.lte(o);i=i.plus(1))a=a.times(r.plus(i)).dividedBy(i);return a}});return a.toTex={2:"\\binom{${args[0]}}{${args[1]}}"},a}function isPositiveInteger$1(e){return e.isInteger()&&e.gte(0)}var name$1y="combinations",factory_1$1B=factory$1B,combinations={name:name$1y,factory:factory_1$1B};function factory$1A(e,t,n,r){var a=r("isInteger",{number:number$5.isInteger,BigNumber:function(e){return e.isInt()},Fraction:function(e){return 1===e.d&&isFinite(e.n)},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$1x="isInteger",factory_1$1A=factory$1A,isInteger$7={name:name$1x,factory:factory_1$1A};function factory$1z(e,t,n,r){var a=n(add$2),i=n(subtract$1),o=n(multiply$1),s=n(divide$1),l=n(pow$1),u=n(factorial$1),c=n(combinations),p=n(isNegative),d=n(isInteger$7),m=n(larger$1),f=r("stirlingS2",{"number | BigNumber, number | BigNumber":function(e,t){if(!d(e)||p(e)||!d(t)||p(t))throw new TypeError("Non-negative integer value expected in function stirlingS2");if(m(t,e))throw new TypeError("k must be less than or equal to n in function stirlingS2");for(var n=u(t),r=0,f=0;f<=t;f++){var h=l(-1,i(t,f)),y=c(t,f),b=l(f,e);r=a(r,o(o(y,b),h))}return s(r,n)}});return f.toTex={2:"\\mathrm{S}\\left(${args}\\right)"},f}var name$1w="stirlingS2",factory_1$1z=factory$1z,stirlingS2={name:name$1w,factory:factory_1$1z};function factory$1y(e,t,n,r){var a=n(add$2),i=n(stirlingS2),o=n(isNegative),s=n(isInteger$7),l=r("bellNumbers",{"number | BigNumber":function(e){if(!s(e)||o(e))throw new TypeError("Non-negative integer value expected in function bellNumbers");for(var t=0,n=0;n<=e;n++)t=a(t,i(e,n));return t}});return l.toTex={1:"\\mathrm{B}_{${args[0]}}"},l}var name$1v="bellNumbers",factory_1$1y=factory$1y,bellNumbers={name:name$1v,factory:factory_1$1y};function factory$1x(e,t,n,r){var a=n(combinations),i=n(addScalar),o=n(isPositive),s=n(isInteger$7),l=n(larger$1),u=r("composition",{"number | BigNumber, number | BigNumber":function(e,t){if(!(s(e)&&o(e)&&s(t)&&o(t)))throw new TypeError("Positive integer value expected in function composition");if(l(t,e))throw new TypeError("k must be less than or equal to n in function composition");return a(i(e,-1),i(t,-1))}});return u.toTex=void 0,u}var name$1u="composition",factory_1$1x=factory$1x,composition={name:name$1u,factory:factory_1$1x};function factory$1w(e,t,n,r){var a=n(add$2),i=n(divide$1),o=n(multiply$1),s=n(combinations),l=n(isNegative),u=n(isInteger$7),c=r("catalan",{"number | BigNumber":function(e){if(!u(e)||l(e))throw new TypeError("Non-negative integer value expected in function catalan");return i(s(o(e,2),e),a(e,1))}});return c.toTex={1:"\\mathrm{C}_{${args[0]}}"},c}var name$1t="catalan",factory_1$1w=factory$1w,catalan={name:name$1t,factory:factory_1$1w},combinatorics=[bellNumbers,composition,stirlingS2,catalan];function factory$1v(e,t,n,r){var a=r("arg",{number:function(e){return Math.atan2(0,e)},BigNumber:function(t){return e.BigNumber.atan2(0,t)},Complex:function(e){return e.arg()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\arg\\left(${args[0]}\\right)"},a}var name$1s="arg",factory_1$1v=factory$1v,arg={name:name$1s,factory:factory_1$1v};function factory$1u(e,t,n,r){var a=r("im",{number:function(e){return 0},BigNumber:function(t){return new e.BigNumber(0)},Complex:function(e){return e.im},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\Im\\left\\lbrace${args[0]}\\right\\rbrace"},a}var name$1r="im",factory_1$1u=factory$1u,im$1={name:name$1r,factory:factory_1$1u};function factory$1t(e,t,n,r){var a=r("re",{number:function(e){return e},BigNumber:function(e){return e},Complex:function(e){return e.re},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\Re\\left\\lbrace${args[0]}\\right\\rbrace"},a}var name$1q="re",factory_1$1t=factory$1t,re$1={name:name$1q,factory:factory_1$1t},complex=[arg,conj$1,im$1,re$1];function factory$1s(e,t,n,r){var a=n(abs$1),i=n(add$2),o=n(addScalar),s=n(matrix$5),l=n(multiply$1),u=n(multiplyScalar),c=n(divideScalar),p=n(subtract$1),d=n(smaller$1),m=n(equalScalar),f=r("intersect",{"Array, Array, Array":function(e,t,n){if(!b(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!b(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!function(e){return 4===e.length&&h(e[0])&&h(e[1])&&h(e[2])&&h(e[3])}(n))throw new TypeError("Array with 4 numbers expected as third argument");return function(e,t,n,r,a,i,s,l,d,m){var f=u(e,s),h=u(r,s),y=u(t,l),b=u(a,l),g=u(n,d),v=u(i,d),T=c(p(p(p(m,f),y),g),p(p(p(o(o(h,b),v),f),y),g));return[o(e,u(T,p(r,e))),o(t,u(T,p(a,t))),o(n,u(T,p(i,n)))]}(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2],n[3])},"Array, Array, Array, Array":function(e,n,r,s){if(2===e.length){if(!y(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!y(n))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!y(r))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");if(!y(s))throw new TypeError("Array with 2 numbers or BigNumbers expected for fourth argument");return function(e,n,r,s){var m=e,f=r,h=p(m,n),y=p(f,s),b=p(u(h[0],y[1]),u(y[0],h[1]));if(d(a(b),t.epsilon))return null;var g=u(y[0],m[1]),v=u(y[1],m[0]),T=u(y[0],f[1]),C=u(y[1],f[0]),N=c(o(p(p(g,v),T),C),b);return i(l(h,N),m)}(e,n,r,s)}if(3===e.length){if(!b(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!b(n))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!b(r))throw new TypeError("Array with 3 numbers or BigNumbers expected for third argument");if(!b(s))throw new TypeError("Array with 3 numbers or BigNumbers expected for fourth argument");return f=e[0],h=e[1],v=e[2],T=n[0],C=n[1],N=n[2],A=r[0],S=r[1],w=r[2],$=g(f,A,x=s[0],A,h,S,V=s[1],S,v,w,E=s[2],w),_=g(x,A,T,f,V,S,C,h,E,w,N,v),O=g(f,A,T,f,h,S,C,h,v,w,N,v),I=g(x,A,x,A,V,S,V,S,E,w,E,w),D=g(T,f,T,f,C,h,C,h,N,v,N,v),R=c(p(u($,_),u(O,I)),p(u(D,I),u(_,_))),P=c(o($,u(R,_)),I),k=o(f,u(R,p(T,f))),M=o(h,u(R,p(C,h))),F=o(v,u(R,p(N,v))),B=o(A,u(P,p(x,A))),L=o(S,u(P,p(V,S))),j=o(w,u(P,p(E,w))),m(k,B)&&m(M,L)&&m(F,j)?[k,M,F]:null}throw new TypeError("Arrays with two or thee dimensional points expected");var f,h,v,T,C,N,A,S,w,x,V,E,$,_,O,I,D,R,P,k,M,F,B,L,j},"Matrix, Matrix, Matrix":function(e,t,n){return s(f(e.valueOf(),t.valueOf(),n.valueOf()))},"Matrix, Matrix, Matrix, Matrix":function(e,t,n,r){return s(f(e.valueOf(),t.valueOf(),n.valueOf(),r.valueOf()))}});function h(t){return"number"==typeof t||e.isBigNumber(t)}function y(e){return 2===e.length&&h(e[0])&&h(e[1])}function b(e){return 3===e.length&&h(e[0])&&h(e[1])&&h(e[2])}function g(e,t,n,r,a,i,s,l,c,d,m,f){var h=u(p(e,t),p(n,r)),y=u(p(a,i),p(s,l)),b=u(p(c,d),p(m,f));return o(o(h,y),b)}return f}var name$1p="intersect",factory_1$1s=factory$1s,intersect={name:name$1p,factory:factory_1$1s};function factory$1r(e,t,n,r){n(matrix$5);var a=n(addScalar),i=n(subtract$1),o=n(multiplyScalar),s=n(divideScalar),l=n(unaryMinus),u=n(sqrt$1),c=n(abs$1),p=r("distance",{"Array, Array, Array":function(e,t,n){if(2==e.length&&2==t.length&&2==n.length){if(!m(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!m(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!m(n))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");var r=s(i(n[1],n[0]),i(t[1],t[0])),a=o(o(r,r),t[0]),u=l(o(r,t[0])),c=e[1];return b(e[0],e[1],a,u,c)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object, Object":function(e,t,n){if(2==Object.keys(e).length&&2==Object.keys(t).length&&2==Object.keys(n).length){if(!m(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!m(t))throw new TypeError("Values of lineOnePtX and lineOnePtY should be numbers or BigNumbers");if(!m(n))throw new TypeError("Values of lineTwoPtX and lineTwoPtY should be numbers or BigNumbers");if(e.hasOwnProperty("pointX")&&e.hasOwnProperty("pointY")&&t.hasOwnProperty("lineOnePtX")&&t.hasOwnProperty("lineOnePtY")&&n.hasOwnProperty("lineTwoPtX")&&n.hasOwnProperty("lineTwoPtY")){var r=s(i(n.lineTwoPtY,n.lineTwoPtX),i(t.lineOnePtY,t.lineOnePtX)),a=o(o(r,r),t.lineOnePtX),u=l(o(r,t.lineOnePtX)),c=e.pointX;return b(e.pointX,e.pointY,a,u,c)}throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},"Array, Array":function(e,t){if(2==e.length&&3==t.length){if(!m(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!f(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");return b(e[0],e[1],t[0],t[1],t[2])}if(3==e.length&&6==t.length){if(!f(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!h(t))throw new TypeError("Array with 6 numbers or BigNumbers expected for second argument");return g(e[0],e[1],e[2],t[0],t[1],t[2],t[3],t[4],t[5])}if(2==e.length&&2==t.length){if(!m(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!m(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");return v(e[0],e[1],t[0],t[1])}if(3==e.length&&3==t.length){if(!f(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!f(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");return T(e[0],e[1],e[2],t[0],t[1],t[2])}throw new TypeError("Invalid Arguments: Try again")},"Object, Object":function(e,t){if(2==Object.keys(e).length&&3==Object.keys(t).length){if(!m(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!f(t))throw new TypeError("Values of xCoeffLine, yCoeffLine and constant should be numbers or BigNumbers");if(e.hasOwnProperty("pointX")&&e.hasOwnProperty("pointY")&&t.hasOwnProperty("xCoeffLine")&&t.hasOwnProperty("yCoeffLine")&&t.hasOwnProperty("constant"))return b(e.pointX,e.pointY,t.xCoeffLine,t.yCoeffLine,t.constant);throw new TypeError("Key names do not match")}if(3==Object.keys(e).length&&6==Object.keys(t).length){if(!f(e))throw new TypeError("Values of pointX, pointY and pointZ should be numbers or BigNumbers");if(!h(t))throw new TypeError("Values of x0, y0, z0, a, b and c should be numbers or BigNumbers");if(e.hasOwnProperty("pointX")&&e.hasOwnProperty("pointY")&&t.hasOwnProperty("x0")&&t.hasOwnProperty("y0")&&t.hasOwnProperty("z0")&&t.hasOwnProperty("a")&&t.hasOwnProperty("b")&&t.hasOwnProperty("c"))return g(e.pointX,e.pointY,e.pointZ,t.x0,t.y0,t.z0,t.a,t.b,t.c);throw new TypeError("Key names do not match")}if(2==Object.keys(e).length&&2==Object.keys(t).length){if(!m(e))throw new TypeError("Values of pointOneX and pointOneY should be numbers or BigNumbers");if(!m(t))throw new TypeError("Values of pointTwoX and pointTwoY should be numbers or BigNumbers");if(e.hasOwnProperty("pointOneX")&&e.hasOwnProperty("pointOneY")&&t.hasOwnProperty("pointTwoX")&&t.hasOwnProperty("pointTwoY"))return v(e.pointOneX,e.pointOneY,t.pointTwoX,t.pointTwoY);throw new TypeError("Key names do not match")}if(3==Object.keys(e).length&&3==Object.keys(t).length){if(!f(e))throw new TypeError("Values of pointOneX, pointOneY and pointOneZ should be numbers or BigNumbers");if(!f(t))throw new TypeError("Values of pointTwoX, pointTwoY and pointTwoZ should be numbers or BigNumbers");if(e.hasOwnProperty("pointOneX")&&e.hasOwnProperty("pointOneY")&&e.hasOwnProperty("pointOneZ")&&t.hasOwnProperty("pointTwoX")&&t.hasOwnProperty("pointTwoY")&&t.hasOwnProperty("pointTwoZ"))return T(e.pointOneX,e.pointOneY,e.pointOneZ,t.pointTwoX,t.pointTwoY,t.pointTwoZ);throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},Array:function(e){if(!function(e){if(2==e[0].length&&d(e[0][0])&&d(e[0][1])){for(var t in e)if(2!=e[t].length||!d(e[t][0])||!d(e[t][1]))return!1}else{if(!(3==e[0].length&&d(e[0][0])&&d(e[0][1])&&d(e[0][2])))return!1;for(var t in e)if(3!=e[t].length||!d(e[t][0])||!d(e[t][1])||!d(e[t][2]))return!1}return!0}(e))throw new TypeError("Incorrect array format entered for pairwise distance calculation");return function(e){for(var t=[],n=0;n<e.length-1;n++)for(var r=n+1;r<e.length;r++)2==e[0].length?t.push(v(e[n][0],e[n][1],e[r][0],e[r][1])):3==e[0].length&&t.push(T(e[n][0],e[n][1],e[n][2],e[r][0],e[r][1],e[r][2]));return t}(e)}});function d(t){return"number"==typeof t||e.isBigNumber(t)}function m(e){return e.constructor!==Array&&(e=y(e)),d(e[0])&&d(e[1])}function f(e){return e.constructor!==Array&&(e=y(e)),d(e[0])&&d(e[1])&&d(e[2])}function h(e){return e.constructor!==Array&&(e=y(e)),d(e[0])&&d(e[1])&&d(e[2])&&d(e[3])&&d(e[4])&&d(e[5])}function y(e){for(var t=Object.keys(e),n=[],r=0;r<t.length;r++)n.push(e[t[r]]);return n}function b(e,t,n,r,i){var l=c(a(a(o(n,e),o(r,t)),i)),p=u(a(o(n,n),o(r,r)));return s(l,p)}function g(e,t,n,r,l,c,p,d,m){var f=[i(o(i(l,t),m),o(i(c,n),d)),i(o(i(c,n),p),o(i(r,e),m)),i(o(i(r,e),d),o(i(l,t),p))];f=u(a(a(o(f[0],f[0]),o(f[1],f[1])),o(f[2],f[2])));var h=u(a(a(o(p,p),o(d,d)),o(m,m)));return s(f,h)}function v(e,t,n,r){var s=i(r,t),l=i(n,e),c=a(o(s,s),o(l,l));return u(c)}function T(e,t,n,r,s,l){var c=i(l,n),p=i(s,t),d=i(r,e),m=a(a(o(c,c),o(p,p)),o(d,d));return u(m)}return p}var name$1o="distance",factory_1$1r=factory$1r,distance={name:name$1o,factory:factory_1$1r},geometry=[intersect,distance];function factory$1q(e,t,n,r){var a=latex$1,i=r("not",{number:function(e){return!e},Complex:function(e){return 0===e.re&&0===e.im},BigNumber:function(e){return e.isZero()||e.isNaN()},Unit:function(e){return null===e.value||i(e.value)},"Array | Matrix":function(e){return deepMap(e,i)}});return i.toTex={1:a.operators.not+"\\left(${args[0]}\\right)"},i}var name$1n="not",factory_1$1q=factory$1q,not={name:name$1n,factory:factory_1$1q};function factory$1p(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(zeros),s=n(not);n(isZero);var l=n(algorithm02),u=n(algorithm06),c=n(algorithm11),p=n(algorithm13),d=n(algorithm14),m=r("and",{"number, number":function(e,t){return!(!e||!t)},"Complex, Complex":function(e,t){return!(0===e.re&&0===e.im||0===t.re&&0===t.im)},"BigNumber, BigNumber":function(e,t){return!(e.isZero()||t.isZero()||e.isNaN()||t.isNaN())},"Unit, Unit":function(e,t){return m(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return u(e,t,m,!1)},"SparseMatrix, DenseMatrix":function(e,t){return l(t,e,m,!0)},"DenseMatrix, SparseMatrix":function(e,t){return l(e,t,m,!1)},"DenseMatrix, DenseMatrix":function(e,t){return p(e,t,m)},"Array, Array":function(e,t){return m(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return m(i(e),t)},"Matrix, Array":function(e,t){return m(e,i(t))},"SparseMatrix, any":function(e,t){return s(t)?o(e.size(),e.storage()):c(e,t,m,!1)},"DenseMatrix, any":function(e,t){return s(t)?o(e.size(),e.storage()):d(e,t,m,!1)},"any, SparseMatrix":function(e,t){return s(e)?o(e.size(),e.storage()):c(t,e,m,!0)},"any, DenseMatrix":function(e,t){return s(e)?o(e.size(),e.storage()):d(t,e,m,!0)},"Array, any":function(e,t){return m(i(e),t).valueOf()},"any, Array":function(e,t){return m(e,i(t)).valueOf()}});return m.toTex={2:"\\left(${args[0]}"+a.operators.and+"${args[1]}\\right)"},m}var name$1m="and",factory_1$1p=factory$1p,and={name:name$1m,factory:factory_1$1p};function factory$1o(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm03),s=n(algorithm05),l=n(algorithm12),u=n(algorithm13),c=n(algorithm14),p=r("or",{"number, number":function(e,t){return!(!e&&!t)},"Complex, Complex":function(e,t){return 0!==e.re||0!==e.im||0!==t.re||0!==t.im},"BigNumber, BigNumber":function(e,t){return!e.isZero()&&!e.isNaN()||!t.isZero()&&!t.isNaN()},"Unit, Unit":function(e,t){return p(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return p(i(e),t)},"Matrix, Array":function(e,t){return p(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,p,!1)},"DenseMatrix, any":function(e,t){return c(e,t,p,!1)},"any, SparseMatrix":function(e,t){return l(t,e,p,!0)},"any, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, any":function(e,t){return c(i(e),t,p,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+a.operators.or+"${args[1]}\\right)"},p}var name$1l="or",factory_1$1o=factory$1o,or={name:name$1l,factory:factory_1$1o};function factory$1n(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm03),s=n(algorithm07),l=n(algorithm12),u=n(algorithm13),c=n(algorithm14),p=r("xor",{"number, number":function(e,t){return!!e!=!!t},"Complex, Complex":function(e,t){return(0!==e.re||0!==e.im)!=(0!==t.re||0!==t.im)},"BigNumber, BigNumber":function(e,t){return(!e.isZero()&&!e.isNaN())!=(!t.isZero()&&!t.isNaN())},"Unit, Unit":function(e,t){return p(e.value||0,t.value||0)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return o(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return u(e,t,p)},"Array, Array":function(e,t){return p(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return p(i(e),t)},"Matrix, Array":function(e,t){return p(e,i(t))},"SparseMatrix, any":function(e,t){return l(e,t,p,!1)},"DenseMatrix, any":function(e,t){return c(e,t,p,!1)},"any, SparseMatrix":function(e,t){return l(t,e,p,!0)},"any, DenseMatrix":function(e,t){return c(t,e,p,!0)},"Array, any":function(e,t){return c(i(e),t,p,!1).valueOf()},"any, Array":function(e,t){return c(i(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+a.operators.xor+"${args[1]}\\right)"},p}var name$1k="xor",factory_1$1n=factory$1n,xor={name:name$1k,factory:factory_1$1n},logical=[and,not,or,xor];function factory$1m(e,t,n,r){var a=n(matrix$5),i=n(subtract$1),o=n(multiply$1),s=r("cross",{"Matrix, Matrix":function(e,t){return a(l(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return a(l(e.toArray(),t))},"Array, Matrix":function(e,t){return a(l(e,t.toArray()))},"Array, Array":l});return s.toTex={2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"},s;function l(e,t){var n=Math.max(array$3.size(e).length,array$3.size(t).length);e=array$3.squeeze(e),t=array$3.squeeze(t);var r=array$3.size(e),a=array$3.size(t);if(1!=r.length||1!=a.length||3!=r[0]||3!=a[0])throw new RangeError("Vectors with length 3 expected (Size A = ["+r.join(", ")+"], B = ["+a.join(", ")+"])");var s=[i(o(e[1],t[2]),o(e[2],t[1])),i(o(e[2],t[0]),o(e[0],t[2])),i(o(e[0],t[1]),o(e[1],t[0]))];return n>1?[s]:s}}var name$1j="cross",factory_1$1m=factory$1m,cross={name:name$1j,factory:factory_1$1m};object$6.clone;var isInteger$6=number$5.isInteger;function factory$1l(e,t,n,r){var a=n(matrix$5),i=r("diag",{Array:function(e){return o(e,0,array$3.size(e),null)},"Array, number":function(e,t){return o(e,t,array$3.size(e),null)},"Array, BigNumber":function(e,t){return o(e,t.toNumber(),array$3.size(e),null)},"Array, string":function(e,t){return o(e,0,array$3.size(e),t)},"Array, number, string":function(e,t,n){return o(e,t,array$3.size(e),n)},"Array, BigNumber, string":function(e,t,n){return o(e,t.toNumber(),array$3.size(e),n)},Matrix:function(e){return o(e,0,e.size(),e.storage())},"Matrix, number":function(e,t){return o(e,t,e.size(),e.storage())},"Matrix, BigNumber":function(e,t){return o(e,t.toNumber(),e.size(),e.storage())},"Matrix, string":function(e,t){return o(e,0,e.size(),t)},"Matrix, number, string":function(e,t,n){return o(e,t,e.size(),n)},"Matrix, BigNumber, string":function(e,t,n){return o(e,t.toNumber(),e.size(),n)}});return i.toTex=void 0,i;function o(t,n,r,i){if(!isInteger$6(n))throw new TypeError("Second parameter in function diag must be an integer");var o=n>0?n:0,s=n<0?-n:0;switch(r.length){case 1:return function(t,n,r,a,i,o){var s=[a+i,a+o],l=e.Matrix.storage(r||"dense").diagonal(s,t,n);return null!==r?l:l.valueOf()}(t,n,i,r[0],s,o);case 2:return function(t,n,r,i,o,s){if(e.isMatrix(t)){var l=t.diagonal(n);return null!==r?r!==l.storage()?a(l,r):l:l.valueOf()}for(var u=Math.min(i[0]-o,i[1]-s),c=[],p=0;p<u;p++)c[p]=t[p+o][p+s];return null!==r?a(c):c}(t,n,i,r,s,o)}throw new RangeError("Matrix for function diag must be 2 dimensional")}}var name$1i="diag",factory_1$1l=factory$1l,diag={name:name$1i,factory:factory_1$1l},size$4=array$3.size;function factory$1k(e,t,n,r){var a=n(add$2),i=n(multiply$1),o=r("dot",{"Matrix, Matrix":function(e,t){return s(e.toArray(),t.toArray())},"Matrix, Array":function(e,t){return s(e.toArray(),t)},"Array, Matrix":function(e,t){return s(e,t.toArray())},"Array, Array":s});return o.toTex={2:"\\left(${args[0]}\\cdot${args[1]}\\right)"},o;function s(e,t){var n=size$4(e),r=size$4(t),o=n[0];if(1!==n.length||1!==r.length)throw new RangeError("Vector expected");if(n[0]!=r[0])throw new RangeError("Vectors must have equal length ("+n[0]+" != "+r[0]+")");if(0==o)throw new RangeError("Cannot calculate the dot product of empty vectors");for(var s=0,l=0;l<o;l++)s=a(s,i(e[l],t[l]));return s}}var name$1h="dot",factory_1$1k=factory$1k,dot={name:name$1h,factory:factory_1$1k},format$4=string$a.format;function factory$1j(e,t,n,r){var a=n(abs$1),i=n(add$2),o=n(eye),s=n(inv),l=n(multiply$1),u=e.SparseMatrix,c=r("expm",{Matrix:function(t){var n=t.size();if(2!==n.length||n[0]!==n[1])throw new RangeError("Matrix must be square (size: "+format$4(n)+")");for(var r=n[0],c=function(e){for(var t=e.size()[0],n=0,r=0;r<t;r++){for(var i=0,o=0;o<t;o++)i+=a(e.get([r,o]));n=Math.max(i,n)}return n}(t),d=function(e,t){for(var n=0;n<30;n++)for(var r=0;r<=n;r++){var a=n-r;if(p(e,r,a)<1e-15)return{q:r,j:a}}throw new Error("Could not find acceptable parameters to compute the matrix exponential (try increasing maxSearchSize in expm.js)")}(c),m=d.q,f=d.j,h=l(t,Math.pow(2,-f)),y=o(r),b=o(r),g=1,v=h,T=-1,C=1;C<=m;C++)C>1&&(v=l(v,h),T=-T),y=i(y,l(g=g*(m-C+1)/((2*m-C+1)*C),v)),b=i(b,l(g*T,v));var N=l(s(b),y);for(C=0;C<f;C++)N=l(N,N);return e.isSparseMatrix(t)?new u(N):N}});function p(e,t,n){for(var r=1,a=2;a<=t;a++)r*=a;var i=r;for(a=t+1;a<=2*t;a++)i*=a;var o=i*(2*t+1);return 8*Math.pow(e/Math.pow(2,n),2*t)*r*r/(i*o)}return c.toTex={1:"\\exp\\left(${args[0]}\\right)"},c}var name$1g="expm",factory_1$1j=factory$1j,expm={name:name$1g,factory:factory_1$1j},filter$1=array$3.filter,filterRegExp=array$3.filterRegExp,maxArgumentCount$2=_function$3.maxArgumentCount;function factory$1i(e,t,n,r){var a=n(matrix$5),i=r("filter",{"Array, function":_filterCallback,"Matrix, function":function(e,t){return a(_filterCallback(e.toArray(),t))},"Array, RegExp":filterRegExp,"Matrix, RegExp":function(e,t){return a(filterRegExp(e.toArray(),t))}});return i.toTex=void 0,i}function _filterCallback(e,t){var n=maxArgumentCount$2(t);return filter$1(e,(function(e,r,a){return 1===n?t(e):2===n?t(e,[r]):t(e,[r],a)}))}var name$1f="filter",factory_1$1i=factory$1i,filter_1={name:name$1f,factory:factory_1$1i},clone$3=object$6.clone,_flatten=array$3.flatten;function factory$1h(e,t,n,r){var a=n(matrix$5),i=r("flatten",{Array:function(e){return _flatten(clone$3(e))},Matrix:function(e){var t=_flatten(clone$3(e.toArray()));return a(t)}});return i.toTex=void 0,i}var name$1e="flatten",factory_1$1h=factory$1h,flatten$h={name:name$1e,factory:factory_1$1h},maxArgumentCount$1=_function$3.maxArgumentCount,forEach=array$3.forEach;function factory$1g(e,t,n,r){var a=r("forEach",{"Array, function":_forEach,"Matrix, function":function(e,t){return e.forEach(t)}});return a.toTex=void 0,a}function _forEach(e,t){var n=maxArgumentCount$1(t),r=function(a,i){Array.isArray(a)?forEach(a,(function(e,t){r(e,i.concat(t))})):1===n?t(a):2===n?t(a,i):t(a,i,e)};r(e,[])}var name$1d="forEach",factory_1$1g=factory$1g,forEach_1={name:name$1d,factory:factory_1$1g},size$3=array$3.size;function factory$1f(e,t,n,r){var a=n(matrix$5),i=n(multiplyScalar),o=r("kron",{"Matrix, Matrix":function(e,t){return a(s(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return a(s(e.toArray(),t))},"Array, Matrix":function(e,t){return a(s(e,t.toArray()))},"Array, Array":s});return o;function s(e,t){if(1===size$3(e).length&&(e=[e]),1===size$3(t).length&&(t=[t]),size$3(e).length>2||size$3(t).length>2)throw new RangeError("Vectors with dimensions greater then 2 are not supported expected (Size x = "+JSON.stringify(e.length)+", y = "+JSON.stringify(t.length)+")");var n=[],r=[];return e.map((function(e){return t.map((function(t){return e.map((function(e){return t.map((function(t){return r.push(i(e,t))}))}),n.push(r=[]))}))}),n=[])&&n}}var name$1c="kron",factory_1$1f=factory$1f,kron={name:name$1c,factory:factory_1$1f},maxArgumentCount=_function$3.maxArgumentCount;function factory$1e(e,t,n,r){var a=r("map",{"Array, function":_map,"Matrix, function":function(e,t){return e.map(t)}});return a.toTex=void 0,a}function _map(e,t){var n=maxArgumentCount(t),r=function(a,i){return Array.isArray(a)?a.map((function(e,t){return r(e,i.concat(t))})):1===n?t(a):2===n?t(a,i):t(a,i,e)};return r(e,[])}var name$1b="map",factory_1$1e=factory$1e,map$1={name:name$1b,factory:factory_1$1e},isInteger$5=number$5.isInteger,resize$1=array$3.resize;function factory$1d(e,t,n,r){var a=n(matrix$5),i=r("ones",{"":function(){return"Array"===t.matrix?o([]):o([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var n=e.pop();return o(e,n)}return"Array"===t.matrix?o(e):o(e,"default")},Array:o,Matrix:function(e){var t=e.storage();return o(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return o(e.valueOf(),t)}});return i.toTex=void 0,i;function o(t,n){var r=function(t){var n=!1;return t.forEach((function(t,r,a){e.isBigNumber(t)&&(n=!0,a[r]=t.toNumber())})),n}(t),i=r?new e.BigNumber(1):1;if(function(e){e.forEach((function(e){if("number"!=typeof e||!isInteger$5(e)||e<0)throw new Error("Parameters in function ones must be positive integers")}))}(t),n){var o=a(n);return t.length>0?o.resize(t,i):o}var s=[];return t.length>0?resize$1(s,t,i):s}}var name$1a="ones",factory_1$1d=factory$1d,ones={name:name$1a,factory:factory_1$1d},nearlyEqual$1=number$5.nearlyEqual;function factory$1c(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm05),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=r("compare",{"boolean, boolean":function(e,t){return e===t?0:e>t?1:-1},"number, number":function(e,n){return e===n||nearlyEqual$1(e,n,t.epsilon)?0:e>n?1:-1},"BigNumber, BigNumber":function(n,r){return n.eq(r)||nearlyEqual$7(n,r,t.epsilon)?new e.BigNumber(0):new e.BigNumber(n.cmp(r))},"Fraction, Fraction":function(t,n){return new e.Fraction(t.compare(n))},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return c(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,c)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,c,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,c,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,c)},"Array, Array":function(e,t){return c(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return c(a(e),t)},"Matrix, Array":function(e,t){return c(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,c,!1)},"DenseMatrix, any":function(e,t){return u(e,t,c,!1)},"any, SparseMatrix":function(e,t){return s(t,e,c,!0)},"any, DenseMatrix":function(e,t){return u(t,e,c,!0)},"Array, any":function(e,t){return u(a(e),t,c,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,c,!0).valueOf()}});return c.toTex=void 0,c}var name$19="compare",factory_1$1c=factory$1c,compare={name:name$19,factory:factory_1$1c},isInteger$4=number$5.isInteger;function factory$1b(e,t,n,r){var a=n(compare);function i(e,t){return-a(e,t)}return r("partitionSelect",{"Array | Matrix, number":function(e,t){return o(e,t,a)},"Array | Matrix, number, string":function(e,t,n){if("asc"===n)return o(e,t,a);if("desc"===n)return o(e,t,i);throw new Error('Compare string must be "asc" or "desc"')},"Array | Matrix, number, function":o});function o(t,n,r){if(!isInteger$4(n)||n<0)throw new Error("k must be a non-negative integer");if(e.isMatrix(t)){if(t.size().length>1)throw new Error("Only one dimensional matrices supported");return s(t.valueOf(),n,r)}if(Array.isArray(t))return s(t,n,r)}function s(e,t,n){if(t>=e.length)throw new Error("k out of bounds");for(var r=0,a=e.length-1;r<a;){for(var i=r,o=a,s=e[Math.floor(Math.random()*(a-r+1))+r];i<o;)if(n(e[i],s)>=0){var l=e[o];e[o]=e[i],e[i]=l,--o}else++i;n(e[i],s)>0&&--i,t<=i?a=i:r=i+1}return e[t]}}var name$18="partitionSelect",factory_1$1b=factory$1b,partitionSelect={name:name$18,factory:factory_1$1b},isInteger$3=number$5.isInteger;function factory$1a(e,t,n,r){var a=n(matrix$5),i=r("reshape",{"Matrix, Array":function(e,t){return e.reshape?e.reshape(t):a(array$3.reshape(e.valueOf(),t))},"Array, Array":function(e,t){return t.forEach((function(e){if(!isInteger$3(e))throw new TypeError("Invalid size for dimension: "+e)})),array$3.reshape(e,t)}});return i.toTex=void 0,i}var name$17="reshape",factory_1$1a=factory$1a,reshape={name:name$17,factory:factory_1$1a},isInteger$2=number$5.isInteger,format$3=string$a.format,clone$2=object$6.clone;function factory$19(e,t,n,r){var a=n(matrix$5),i=function(n,r,i){if(2!=arguments.length&&3!=arguments.length)throw new ArgumentsError_1("resize",arguments.length,2,3);if(e.isMatrix(r)&&(r=r.valueOf()),e.isBigNumber(r[0])&&(r=r.map((function(t){return e.isBigNumber(t)?t.toNumber():t}))),e.isMatrix(n))return n.resize(r,i,!0);if("string"==typeof n)return o(n,r,i);var s=!Array.isArray(n)&&"Array"!==t.matrix;if(0==r.length){for(;Array.isArray(n);)n=n[0];return clone$2(n)}Array.isArray(n)||(n=[n]),n=clone$2(n);var l=array$3.resize(n,r,i);return s?a(l):l};return i.toTex=void 0,i;function o(e,t,n){if(void 0!==n){if("string"!=typeof n||1!==n.length)throw new TypeError("Single character expected as defaultValue")}else n=" ";if(1!==t.length)throw new DimensionError_1(t.length,1);var r=t[0];if("number"!=typeof r||!isInteger$2(r))throw new TypeError("Invalid size, must contain positive integers (size: "+format$3(t)+")");if(e.length>r)return e.substring(0,r);if(e.length<r){for(var a=e,i=0,o=r-e.length;i<o;i++)a+=n;return a}return e}}var name$16="resize",factory_1$19=factory$19,resize={name:name$16,factory:factory_1$19};function factory$18(e,t,n,r){var a=n(matrix$5),i=r("size",{Matrix:function(e){return a(e.size())},Array:array$3.size,string:function(e){return"Array"===t.matrix?[e.length]:a([e.length])},"number | Complex | BigNumber | Unit | boolean | null":function(e){return"Array"===t.matrix?[]:a([])}});return i.toTex=void 0,i}var name$15="size",factory_1$18=factory$18,size$2={name:name$15,factory:factory_1$18},naturalSort=function e(t,n){var r,a,i=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,o=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,u=/^0/,c=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},p=c(t).replace(o,"")||"",d=c(n).replace(o,"")||"",m=p.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=d.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(p.match(l),16)||1!==m.length&&p.match(s)&&Date.parse(p),y=parseInt(d.match(l),16)||h&&d.match(s)&&Date.parse(d)||null;if(y){if(h<y)return-1;if(h>y)return 1}for(var b=0,g=Math.max(m.length,f.length);b<g;b++){if(r=!(m[b]||"").match(u)&&parseFloat(m[b])||m[b]||0,a=!(f[b]||"").match(u)&&parseFloat(f[b])||f[b]||0,isNaN(r)!==isNaN(a))return isNaN(r)?1:-1;if(typeof r!=typeof a&&(r+="",a+=""),r<a)return-1;if(r>a)return 1}return 0};function factory$17(e,t,n,r){var a=n(_typeof),i=n(compare),o=i.signatures["boolean,boolean"],s=r("compareNatural",{"any, any":function(e,t){var n,r=a(e),c=a(t);if(!("number"!==r&&"BigNumber"!==r&&"Fraction"!==r||"number"!==c&&"BigNumber"!==c&&"Fraction"!==c))return"0"!==(n=i(e,t)).toString()?n>0?1:-1:naturalSort(r,c);if("Array"===r||"Matrix"===r||"Array"===c||"Matrix"===c)return 0!==(n=l(e,t))?n:naturalSort(r,c);if(r!==c)return naturalSort(r,c);if("Complex"===r)return compareComplexNumbers(e,t);if("Unit"===r)return e.equalBase(t)?s(e.value,t.value):u(e.formatUnits(),t.formatUnits());if("boolean"===r)return o(e,t);if("string"===r)return naturalSort(e,t);if("Object"===r)return function(e,t){var n=Object.keys(e),r=Object.keys(t);n.sort(naturalSort),r.sort(naturalSort);var a=u(n,r);if(0!==a)return a;for(var i=0;i<n.length;i++){var o=s(e[n[i]],t[r[i]]);if(0!==o)return o}return 0}(e,t);if("null"===r)return 0;if("undefined"===r)return 0;throw new TypeError('Unsupported type of value "'+r+'"')}});function l(t,n){return e.isSparseMatrix(t)&&e.isSparseMatrix(n)?u(t.toJSON().values,n.toJSON().values):e.isSparseMatrix(t)?l(t.toArray(),n):e.isSparseMatrix(n)?l(t,n.toArray()):e.isDenseMatrix(t)?l(t.toJSON().data,n):e.isDenseMatrix(n)?l(t,n.toJSON().data):Array.isArray(t)?Array.isArray(n)?u(t,n):l(t,[n]):l([t],n)}function u(e,t){for(var n=0,r=Math.min(e.length,t.length);n<r;n++){var a=s(e[n],t[n]);if(0!==a)return a}return e.length>t.length?1:e.length<t.length?-1:0}return s.toTex=void 0,s}function compareComplexNumbers(e,t){return e.re>t.re?1:e.re<t.re?-1:e.im>t.im?1:e.im<t.im?-1:0}var name$14="compareNatural",factory_1$17=factory$17,compareNatural={name:name$14,factory:factory_1$17},size$1=array$3.size;function factory$16(e,t,n,r){var a=n(matrix$5),i=n(compare),o=function(e,t){return-i(e,t)},s=n(compareNatural),l=r("sort",{Array:function(e){return c(e),e.sort(i)},Matrix:function(e){return p(e),a(e.toArray().sort(i),e.storage())},"Array, function":function(e,t){return c(e),e.sort(t)},"Matrix, function":function(e,t){return p(e),a(e.toArray().sort(t),e.storage())},"Array, string":function(e,t){return c(e),e.sort(u(t))},"Matrix, string":function(e,t){return p(e),a(e.toArray().sort(u(t)),e.storage())}});function u(e){if("asc"===e)return i;if("desc"===e)return o;if("natural"===e)return s;throw new Error('String "asc", "desc", or "natural" expected')}function c(e){if(1!==size$1(e).length)throw new Error("One dimensional array expected")}function p(e){if(1!==e.size().length)throw new Error("One dimensional matrix expected")}return l.toTex=void 0,l}var name$13="sort",factory_1$16=factory$16,sort={name:name$13,factory:factory_1$16};function factory$15(e,t,n,r){n(matrix$5);var a=n(abs$1),i=n(add$2);n(divide$1);var o=n(multiply$1),s=n(sqrt$1),l=n(subtract$1),u=n(inv),c=n(size$2),p=n(max$1),d=n(eye),m=r("sqrtm",{"Array | Matrix":function(t){var n=e.isMatrix(t)?t.size():array$3.size(t);switch(n.length){case 1:if(1==n[0])return s(t);throw new RangeError("Matrix must be square (size: "+string$a.format(n)+")");case 2:if(n[0]==n[1])return function(e){var t,n=0,r=e,s=d(c(e));do{var m=r;if(r=o(.5,i(m,u(s))),s=o(.5,i(s,u(m))),(t=p(a(l(r,m))))>f&&++n>1e3)throw new Error("computing square root of matrix: iterative method could not converge")}while(t>f);return r}(t);throw new RangeError("Matrix must be square (size: "+string$a.format(n)+")")}}}),f=1e-6;return m.toTex={1:"{${args[0]}}"+latex$1.operators.pow+"{\\frac{1}{2}}"},m}var name$12="sqrtm",factory_1$15=factory$15,sqrtm={name:name$12,factory:factory_1$15};function factory$14(e,t,n,r){var a=n(matrix$5),i=r("squeeze",{Array:function(e){return array$3.squeeze(object$6.clone(e))},Matrix:function(e){var t=array$3.squeeze(e.toArray());return Array.isArray(t)?a(t):t},any:function(e){return object$6.clone(e)}});return i.toTex=void 0,i}var name$11="squeeze",factory_1$14=factory$14,squeeze={name:name$11,factory:factory_1$14},matrix$2=[concat,cross,det,diag,dot,eye,expm,filter_1,flatten$h,forEach_1,inv,kron,map$1,ones,partitionSelect,range$1,reshape,resize,size$2,sort,sqrtm,squeeze,subset,trace,transpose,zeros];function factory$13(e,t,n,r){var a=n(addScalar),i=n(improveErrorMessage),o=r("sum",{"Array | Matrix":function(e){return s(e)},"Array | Matrix, number | BigNumber":function(){throw new Error("sum(A, dim) is not yet supported")},"...":function(e){return s(e)}});return o.toTex=void 0,o;function s(n){var r=void 0;if(deepForEach(n,(function(e){try{r=void 0===r?e:a(r,e)}catch(t){throw i(t,"sum",e)}})),void 0===r)switch(t.number){case"number":default:return 0;case"BigNumber":return new e.BigNumber(0);case"Fraction":return new e.Fraction(0)}return r}}var name$10="sum",factory_1$13=factory$13,sum={name:name$10,factory:factory_1$13};function factory$12(e,t,n,r){var a=n(matrix$5),i=n(divide$1),o=n(sum),s=n(multiply$1),l=n(dotDivide),u=n(log$2),c=n(isNumeric),p=r("kldivergence",{"Array, Array":function(e,t){return d(a(e),a(t))},"Matrix, Array":function(e,t){return d(e,a(t))},"Array, Matrix":function(e,t){return d(a(e),t)},"Matrix, Matrix":function(e,t){return d(e,t)}});function d(e,t){var n=t.size().length,r=e.size().length;if(n>1)throw new Error("first object must be one dimensional");if(r>1)throw new Error("second object must be one dimensional");if(n!==r)throw new Error("Length of two vectors must be equal");if(0===o(e))throw new Error("Sum of elements in first object must be non zero");if(0===o(t))throw new Error("Sum of elements in second object must be non zero");var a=i(e,o(e)),p=i(t,o(t)),d=o(s(a,u(l(a,p))));return c(d)?d:Number.NaN}return p}var name$$="kldivergence",factory_1$12=factory$12,kldivergence={name:name$$,factory:factory_1$12};function factory$11(e,t,n,r){var a=n(add$2),i=n(multiply$1),o=n(divide$1),s=n(factorial$1),l=n(isInteger$7),u=n(isPositive);return r("multinomial",{"Array | Matrix":function(e){var t=0,n=1;return deepForEach(e,(function(e){if(!l(e)||!u(e))throw new TypeError("Positive integer value expected in function multinomial");t=a(t,e),n=i(n,s(e))})),o(s(t),n)}})}var name$_="multinomial",factory_1$11=factory$11,multinomial={name:name$_,factory:factory_1$11},isInteger$1=number$5.isInteger;function factory$10(e,t,n,r){var a=r("permutations",{"number | BigNumber":n(factorial$1),"number, number":function(e,t){var n,r;if(!isInteger$1(e)||e<0)throw new TypeError("Positive integer value expected in function permutations");if(!isInteger$1(t)||t<0)throw new TypeError("Positive integer value expected in function permutations");if(t>e)throw new TypeError("second argument k must be less than or equal to first argument n");for(n=1,r=e-t+1;r<=e;r++)n*=r;return n},"BigNumber, BigNumber":function(t,n){var r,a;if(!isPositiveInteger(t)||!isPositiveInteger(n))throw new TypeError("Positive integer value expected in function permutations");if(n.gt(t))throw new TypeError("second argument k must be less than or equal to first argument n");for(r=new e.BigNumber(1),a=t.minus(n).plus(1);a.lte(t);a=a.plus(1))r=r.times(a);return r}});return a.toTex=void 0,a}function isPositiveInteger(e){return e.isInteger()&&e.gte(0)}var name$Z="permutations",factory_1$10=factory$10,permutations={name:name$Z,factory:factory_1$10},seedRandom=createCommonjsModule((function(e){var t=256,n=[],r=void 0===commonjsGlobal$1?window:commonjsGlobal$1,a=Math.pow(t,6),i=Math.pow(2,52),o=2*i,s=255,l=Math.random;function u(e){var n,r=e.length,a=this,i=0,o=a.i=a.j=0,l=a.S=[];for(r||(e=[r++]);i<t;)l[i]=i++;for(i=0;i<t;i++)l[i]=l[o=s&o+e[i%r]+(n=l[i])],l[o]=n;(a.g=function(e){for(var n,r=0,i=a.i,o=a.j,l=a.S;e--;)n=l[i=s&i+1],r=r*t+l[s&(l[i]=l[o=s&o+n])+(l[o]=n)];return a.i=i,a.j=o,r})(t)}function c(e,t){var n,r=[],a=(typeof e)[0];if(t&&"o"==a)for(n in e)try{r.push(c(e[n],t-1))}catch(e){}return r.length?r:"s"==a?e:e+"\0"}function p(e,t){for(var n,r=e+"",a=0;a<r.length;)t[s&a]=s&(n^=19*t[s&a])+r.charCodeAt(a++);return m(t)}function d(e){try{return r.crypto.getRandomValues(e=new Uint8Array(t)),m(e)}catch(e){return[+new Date,r,r.navigator&&r.navigator.plugins,r.screen,m(n)]}}function m(e){return String.fromCharCode.apply(0,e)}e.exports=function(r,s){if(s&&!0===s.global)return s.global=!1,Math.random=e.exports(r,s),s.global=!0,Math.random;var l=s&&s.entropy||!1,f=[];p(c(l?[r,m(n)]:0 in arguments?r:d(),3),f);var h=new u(f);return p(m(h.S),n),function(){for(var e=h.g(6),n=a,r=0;e<i;)e=(e+r)*t,n*=t,r=h.g(1);for(;e>=o;)e/=2,n/=2,r>>>=1;return(e+r)/n}},e.exports.resetGlobal=function(){Math.random=l},p(Math.random(),n)}));seedRandom.resetGlobal;var singletonRandom=seedRandom();function factory$$(e,t,n,r,a){var i;function o(e){i=null===e?singletonRandom:seedRandom(String(e))}return o(t.randomSeed),a.on("config",(function(e,t,n){void 0!==n.randomSeed&&o(e.randomSeed)})),function(){return i()}}var factory_1$$=factory$$,math$5=!0,seededRNG={factory:factory_1$$,math:math$5},isNumber$3=number$5.isNumber;function factory$_(e,t,n,r,a){var i=n(matrix$5),o=array$3,s=n(seededRNG);function l(t){if(!u.hasOwnProperty(t))throw new Error("Unknown distribution "+t);var n=Array.prototype.slice.call(arguments,1),a=u[t].apply(this,n);return function(t){var n={random:function(t,n,r){var a,o,s;if(arguments.length>3)throw new ArgumentsError_1("random",arguments.length,0,3);if(1===arguments.length?isCollection(t)?a=t:s=t:2===arguments.length?isCollection(t)?(a=t,s=n):(o=t,s=n):(a=t,o=n,s=r),void 0!==o&&!isNumber$3(o)||void 0!==s&&!isNumber$3(s))throw new TypeError("Invalid argument in function random");if(void 0===s&&(s=1),void 0===o&&(o=0),void 0!==a){var u=c(a.valueOf(),o,s,l);return e.isMatrix(a)?i(u):u}return l(o,s)},randomInt:r({"number | Array":function(t){if(isCollection(t)){var n=t,r=1,a=c(n.valueOf(),0,r,u);return e.isMatrix(n)?i(a):a}return u(0,r=t)},"number | Array, number":function(t,n){if(isCollection(t)){var r=t,a=n,o=0,s=c(r.valueOf(),o,a,u);return e.isMatrix(r)?i(s):s}return u(o=t,a=n)},"Array, number, number":function(e,t,n){var r=c(e.valueOf(),t,n,u);return e&&!0===e.isMatrix?i(r):r}}),pickRandom:r({Array:function(e){return a(e)},"Array, number | Array":function(e,t){var n,r;if(Array.isArray(t))r=t;else{if(!isNumber$3(t))throw new TypeError("Invalid argument in function pickRandom");n=t}return a(e,n,r)},"Array, number | Array, Array | number":function(e,t,n){var r,i;if(Array.isArray(t)?(i=t,r=n):(i=n,r=t),!Array.isArray(i)||!isNumber$3(r))throw new TypeError("Invalid argument in function pickRandom");return a(e,r,i)}})},a=function(t,n,r){var a=void 0===n;if(a&&(n=1),e.isMatrix(t))t=t.valueOf();else if(!Array.isArray(t))throw new TypeError("Unsupported type of value in function pickRandom");if(o.size(t).length>1)throw new Error("Only one dimensional vectors supported");if(void 0!==r){if(r.length!=t.length)throw new Error("Weights must have the same length as possibles");for(var i=0,l=0,u=r.length;l<u;l++){if(!isNumber$3(r[l])||r[l]<0)throw new Error("Weights must be an array of positive numbers");i+=r[l]}}var c=t.length;if(0==c)return[];if(n>=c)return n>1?t:t[0];for(var p,d=[];d.length<n;){if(void 0===r)p=t[Math.floor(s()*c)];else{var m=s()*i;for(l=0,u=t.length;l<u;l++)if((m-=r[l])<0){p=t[l];break}}-1==d.indexOf(p)&&d.push(p)}return a?d[0]:d},l=function(e,n){return e+t()*(n-e)},u=function(e,n){return Math.floor(e+t()*(n-e))},c=function(e,t,n,r){var a=[];if((e=e.slice(0)).length>1)for(var i=0,o=e.shift();i<o;i++)a.push(c(e,t,n,r));else for(i=0,o=e.shift();i<o;i++)a.push(r(t,n));return a};return n}(a)}var u={uniform:function(){return s},normal:function(){return function(){for(var e,t,n=-1;n<0||n>1;)e=s(),t=s(),n=1/6*Math.pow(-2*Math.log(e),.5)*Math.cos(2*Math.PI*t)+.5;return n}}};return l.toTex=void 0,l}var name$Y="distribution",factory_1$_=factory$_,distribution={name:name$Y,factory:factory_1$_};function factory$Z(e,t,n,r){var a=n(distribution)("uniform").pickRandom;return a.toTex=void 0,a}var name$X="pickRandom",factory_1$Z=factory$Z,pickRandom={name:name$X,factory:factory_1$Z};function factory$Y(e,t,n,r){var a=n(distribution)("uniform").random;return a.toTex=void 0,a}var name$W="random",factory_1$Y=factory$Y,random$1={name:name$W,factory:factory_1$Y};function factory$X(e,t,n,r){var a=n(distribution)("uniform").randomInt;return a.toTex=void 0,a}var name$V="randomInt",factory_1$X=factory$X,randomInt={name:name$V,factory:factory_1$X},probability=[combinations,factorial$1,gamma$1,kldivergence,multinomial,permutations,pickRandom,random$1,randomInt];function factory$W(e,t,n,r){var a=n(matrix$5),i=n(_typeof),o=n(algorithm13),s=n(algorithm14),l=r("compareText",{"any, any":u,"DenseMatrix, DenseMatrix":function(e,t){return o(e,t,u)},"Array, Array":function(e,t){return l(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return l(a(e),t)},"Matrix, Array":function(e,t){return l(e,a(t))},"DenseMatrix, any":function(e,t){return s(e,t,u,!1)},"any, DenseMatrix":function(e,t){return s(t,e,u,!0)},"Array, any":function(e,t){return s(a(e),t,u,!1).valueOf()},"any, Array":function(e,t){return s(a(t),e,u,!0).valueOf()}});function u(t,n){if(!e.isString(t))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+i(t)+", index: 0)");if(!e.isString(n))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+i(n)+", index: 1)");return t===n?0:t>n?1:-1}return l.toTex=void 0,l}var name$U="compareText",factory_1$W=factory$W,compareText={name:name$U,factory:factory_1$W};function factory$V(e,t,n,r){var a=n(equal$1),i=r("deepEqual",{"any, any":function(e,t){return o(e.valueOf(),t.valueOf())}});return i.toTex=void 0,i;function o(e,t){if(Array.isArray(e)){if(Array.isArray(t)){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(!o(e[r],t[r]))return!1;return!0}return!1}return!Array.isArray(t)&&a(e,t)}}var name$T="deepEqual",factory_1$V=factory$V,deepEqual={name:name$T,factory:factory_1$V};function factory$U(e,t,n,r){var a=n(compareText),i=n(isZero),o=r("equalText",{"any, any":function(e,t){return i(a(e,t))}});return o.toTex=void 0,o}var name$S="equalText",factory_1$U=factory$U,equalText={name:name$S,factory:factory_1$U},nearlyEqual=number$5.nearlyEqual;function factory$T(e,t,n,r){var a=n(matrix$5),i=n(algorithm03),o=n(algorithm07),s=n(algorithm12),l=n(algorithm13),u=n(algorithm14),c=latex$1,p=r("smallerEq",{"boolean, boolean":function(e,t){return e<=t},"number, number":function(e,n){return e<=n||nearlyEqual(e,n,t.epsilon)},"BigNumber, BigNumber":function(e,n){return e.lte(n)||nearlyEqual$7(e,n,t.epsilon)},"Fraction, Fraction":function(e,t){return 1!==e.compare(t)},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")},"Unit, Unit":function(e,t){if(!e.equalBase(t))throw new Error("Cannot compare units with different base");return p(e.value,t.value)},"SparseMatrix, SparseMatrix":function(e,t){return o(e,t,p)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,p,!0)},"DenseMatrix, SparseMatrix":function(e,t){return i(e,t,p,!1)},"DenseMatrix, DenseMatrix":function(e,t){return l(e,t,p)},"Array, Array":function(e,t){return p(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return p(a(e),t)},"Matrix, Array":function(e,t){return p(e,a(t))},"SparseMatrix, any":function(e,t){return s(e,t,p,!1)},"DenseMatrix, any":function(e,t){return u(e,t,p,!1)},"any, SparseMatrix":function(e,t){return s(t,e,p,!0)},"any, DenseMatrix":function(e,t){return u(t,e,p,!0)},"Array, any":function(e,t){return u(a(e),t,p,!1).valueOf()},"any, Array":function(e,t){return u(a(t),e,p,!0).valueOf()}});return p.toTex={2:"\\left(${args[0]}"+c.operators.smallerEq+"${args[1]}\\right)"},p}var name$R="smallerEq",factory_1$T=factory$T,smallerEq={name:name$R,factory:factory_1$T},relational=[compare,compareNatural,compareText,deepEqual,equal$1,equalText,larger$1,largerEq,smaller$1,smallerEq,unequal],flatten$g=array$3.flatten;function factory$S(e,t,n,r){var a=n(MatrixIndex),i=n(DenseMatrix),o=n(size$2),s=n(subset),l=n(compareNatural),u=r("setCartesian",{"Array | Matrix, Array | Matrix":function(e,t){if(0===s(o(e),new a(0))||0===s(o(t),new a(0)))var n=[];else for(var r=flatten$g(Array.isArray(e)?e:e.toArray()).sort(l),u=flatten$g(Array.isArray(t)?t:t.toArray()).sort(l),c=(n=[],0);c<r.length;c++)for(var p=0;p<u.length;p++)n.push([r[c],u[p]]);return Array.isArray(e)&&Array.isArray(t)?n:new i(n)}});return u}var name$Q="setCartesian",factory_1$S=factory$S,setCartesian={name:name$Q,factory:factory_1$S},flatten$f=array$3.flatten,identify$2=array$3.identify,generalize$1=array$3.generalize;function factory$R(e,t,n,r){var a=n(MatrixIndex),i=n(DenseMatrix),o=n(size$2),s=n(subset),l=n(compareNatural),u=r("setDifference",{"Array | Matrix, Array | Matrix":function(e,t){if(0===s(o(e),new a(0)))var n=[];else{if(0===s(o(t),new a(0)))return flatten$f(e.toArray());for(var r,u=identify$2(flatten$f(Array.isArray(e)?e:e.toArray()).sort(l)),c=identify$2(flatten$f(Array.isArray(t)?t:t.toArray()).sort(l)),p=(n=[],0);p<u.length;p++){r=!1;for(var d=0;d<c.length;d++)if(0===l(u[p].value,c[d].value)&&u[p].identifier===c[d].identifier){r=!0;break}r||n.push(u[p])}}return Array.isArray(e)&&Array.isArray(t)?generalize$1(n):new i(generalize$1(n))}});return u}var name$P="setDifference",factory_1$R=factory$R,setDifference={name:name$P,factory:factory_1$R},flatten$e=array$3.flatten;function factory$Q(e,t,n,r){var a=n(MatrixIndex),i=n(DenseMatrix),o=n(size$2),s=n(subset),l=n(compareNatural),u=r("setDistinct",{"Array | Matrix":function(e){if(0===s(o(e),new a(0)))var t=[];else{var n=flatten$e(Array.isArray(e)?e:e.toArray()).sort(l);(t=[]).push(n[0]);for(var r=1;r<n.length;r++)0!==l(n[r],n[r-1])&&t.push(n[r])}return Array.isArray(e)?t:new i(t)}});return u}var name$O="setDistinct",factory_1$Q=factory$Q,setDistinct={name:name$O,factory:factory_1$Q},flatten$d=array$3.flatten,identify$1=array$3.identify,generalize=array$3.generalize;function factory$P(e,t,n,r){var a=n(MatrixIndex),i=n(DenseMatrix),o=n(size$2),s=n(subset),l=n(compareNatural),u=r("setIntersect",{"Array | Matrix, Array | Matrix":function(e,t){if(0===s(o(e),new a(0))||0===s(o(t),new a(0)))var n=[];else for(var r=identify$1(flatten$d(Array.isArray(e)?e:e.toArray()).sort(l)),u=identify$1(flatten$d(Array.isArray(t)?t:t.toArray()).sort(l)),c=(n=[],0);c<r.length;c++)for(var p=0;p<u.length;p++)if(0===l(r[c].value,u[p].value)&&r[c].identifier===u[p].identifier){n.push(r[c]);break}return Array.isArray(e)&&Array.isArray(t)?generalize(n):new i(generalize(n))}});return u}var name$N="setIntersect",factory_1$P=factory$P,setIntersect={name:name$N,factory:factory_1$P},flatten$c=array$3.flatten,identify=array$3.identify;function factory$O(e,t,n,r){var a=n(MatrixIndex),i=n(size$2),o=n(subset),s=n(compareNatural),l=r("setIsSubset",{"Array | Matrix, Array | Matrix":function(e,t){if(0===o(i(e),new a(0)))return!0;if(0===o(i(t),new a(0)))return!1;for(var n,r=identify(flatten$c(Array.isArray(e)?e:e.toArray()).sort(s)),l=identify(flatten$c(Array.isArray(t)?t:t.toArray()).sort(s)),u=0;u<r.length;u++){n=!1;for(var c=0;c<l.length;c++)if(0===s(r[u].value,l[c].value)&&r[u].identifier===l[c].identifier){n=!0;break}if(!1===n)return!1}return!0}});return l}var name$M="setIsSubset",factory_1$O=factory$O,setIsSubset={name:name$M,factory:factory_1$O},flatten$b=array$3.flatten;function factory$N(e,t,n,r){var a=n(compareNatural),i=n(MatrixIndex),o=n(size$2),s=n(subset),l=r("setMultiplicity",{"number | BigNumber | Fraction | Complex, Array | Matrix":function(e,t){if(0===s(o(t),new i(0)))return 0;for(var n=flatten$b(Array.isArray(t)?t:t.toArray()),r=0,l=0;l<n.length;l++)0===a(n[l],e)&&r++;return r}});return l}var name$L="setMultiplicity",factory_1$N=factory$N,setMultiplicity={name:name$L,factory:factory_1$N},flatten$a=array$3.flatten;function factory$M(e,t,n,r){var a=n(MatrixIndex),i=n(size$2),o=n(subset),s=n(compareNatural),l=r("setPowerset",{"Array | Matrix":function(e){if(0===o(i(e),new a(0)))return[];for(var t=flatten$a(Array.isArray(e)?e:e.toArray()).sort(s),n=[],r=0;r.toString(2).length<=t.length;)n.push(u(t,r.toString(2).split("").reverse())),r++;return function(e){for(var t=[],n=e.length-1;n>0;n--)for(var r=0;r<n;r++)e[r].length>e[r+1].length&&(t=e[r],e[r]=e[r+1],e[r+1]=t);return e}(n)}});return l;function u(e,t){for(var n=[],r=0;r<t.length;r++)"1"===t[r]&&n.push(e[r]);return n}}var name$K="setPowerset",factory_1$M=factory$M,setPowerset={name:name$K,factory:factory_1$M},flatten$9=array$3.flatten;function factory$L(e,t,n,r){var a=n(compareNatural),i=r("setSize",{"Array | Matrix":function(e){return Array.isArray(e)?flatten$9(e).length:flatten$9(e.toArray()).length},"Array | Matrix, boolean":function(e,t){if(!1===t||0===e.length)return Array.isArray(e)?flatten$9(e).length:flatten$9(e.toArray()).length;for(var n=flatten$9(Array.isArray(e)?e:e.toArray()).sort(a),r=1,i=1;i<n.length;i++)0!==a(n[i],n[i-1])&&r++;return r}});return i}var name$J="setSize",factory_1$L=factory$L,setSize={name:name$J,factory:factory_1$L},flatten$8=array$3.flatten;function factory$K(e,t,n,r){var a=n(MatrixIndex),i=n(concat),o=n(size$2),s=n(subset),l=n(setDifference);return r("setSymDifference",{"Array | Matrix, Array | Matrix":function(e,t){if(0===s(o(e),new a(0)))return flatten$8(t);if(0===s(o(t),new a(0)))return flatten$8(e);var n=flatten$8(e),r=flatten$8(t);return i(l(n,r),l(r,n))}})}var name$I="setSymDifference",factory_1$K=factory$K,setSymDifference={name:name$I,factory:factory_1$K},flatten$7=array$3.flatten;function factory$J(e,t,n,r){var a=n(MatrixIndex),i=n(concat),o=n(size$2),s=n(subset),l=n(setIntersect),u=n(setSymDifference);return r("setUnion",{"Array | Matrix, Array | Matrix":function(e,t){if(0===s(o(e),new a(0)))return flatten$7(t);if(0===s(o(t),new a(0)))return flatten$7(e);var n=flatten$7(e),r=flatten$7(t);return i(u(n,r),l(n,r))}})}var name$H="setUnion",factory_1$J=factory$J,setUnion={name:name$H,factory:factory_1$J},set=[setCartesian,setDifference,setDistinct,setIntersect,setIsSubset,setMultiplicity,setPowerset,setSize,setSymDifference,setUnion],sign$2=number$5.sign;function factory$I(e,t,n,r){var a=r("erf",{number:function(e){var t=Math.abs(e);return t>=MAX_NUM?sign$2(e):t<=THRESH?sign$2(e)*function(e){var t,n=e*e,r=P[0][4]*n,a=n;for(t=0;t<3;t+=1)r=(r+P[0][t])*n,a=(a+Q[0][t])*n;return e*(r+P[0][3])/(a+Q[0][3])}(t):t<=4?sign$2(e)*(1-function(e){var t,n=P[1][8]*e,r=e;for(t=0;t<7;t+=1)n=(n+P[1][t])*e,r=(r+Q[1][t])*e;var a=(n+P[1][7])/(r+Q[1][7]),i=parseInt(16*e)/16,o=(e-i)*(e+i);return Math.exp(-i*i)*Math.exp(-o)*a}(t)):sign$2(e)*(1-function(e){var t,n=1/(e*e),r=P[2][5]*n,a=n;for(t=0;t<4;t+=1)r=(r+P[2][t])*n,a=(a+Q[2][t])*n;var i=n*(r+P[2][4])/(a+Q[2][4]);i=(SQRPI-i)/e;var o=(e-(n=parseInt(16*e)/16))*(e+n);return Math.exp(-n*n)*Math.exp(-o)*i}(t))},BigNumber:function(t){return new e.BigNumber(a(t.toNumber()))},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"erf\\left(${args[0]}\\right)"},a}var THRESH=.46875,SQRPI=.5641895835477563,P=[[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097]],Q=[[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918]],MAX_NUM=Math.pow(2,53),name$G="erf",factory_1$I=factory$I,erf$1={name:name$G,factory:factory_1$I},special=[erf$1],flatten$6=array$3.flatten;function factory$H(e,t,n,r){var a=n(addScalar),i=n(divideScalar),o=n(compare),s=n(partitionSelect),l=n(improveErrorMessage),u=r("median",{"Array | Matrix":c,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("median(A, dim) is not yet supported")},"...":function(e){if(containsCollections(e))throw new TypeError("Scalar values expected in function median");return c(e)}});function c(e){try{var t=(e=flatten$6(e.valueOf())).length;if(0==t)throw new Error("Cannot calculate median of an empty array");if(t%2==0){for(var n=t/2-1,r=s(e,n+1),a=e[n],i=0;i<n;++i)o(e[i],a)>0&&(a=e[i]);return d(a,r)}var u=s(e,(t-1)/2);return p(u)}catch(e){throw l(e,"median")}}var p=r({"number | BigNumber | Complex | Unit":function(e){return e}}),d=r({"number | BigNumber | Complex | Unit, number | BigNumber | Complex | Unit":function(e,t){return i(a(e,t),2)}});return u.toTex=void 0,u}var name$F="median",factory_1$H=factory$H,median={name:name$F,factory:factory_1$H},flatten$5=array$3.flatten;function factory$G(e,t,n,r){var a=n(abs$1),i=n(map$1),o=n(median),s=n(subtract$1),l=n(improveErrorMessage),u=r("mad",{"Array | Matrix":c,"...":function(e){return c(e)}});return u.toTex=void 0,u;function c(e){if(0===(e=flatten$5(e.valueOf())).length)throw new Error("Cannot calculate median absolute deviation (mad) of an empty array");try{var t=o(e);return o(i(e,(function(e){return a(s(e,t))})))}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf("median")?new TypeError(e.message.replace("median","mad")):l(e,"mad")}}}var name$E="mad",factory_1$G=factory$G,mad={name:name$E,factory:factory_1$G},flatten$4=array$3.flatten;function factory$F(e,t,n,r){return r("mode",{"Array | Matrix":a,"...":function(e){return a(e)}});function a(e){if(0==(e=flatten$4(e.valueOf())).length)throw new Error("Cannot calculate mode of an empty array");var t={},n=[],r=0;for(var a in e)e[a]in t||(t[e[a]]=0),t[e[a]]++,t[e[a]]==r?n.push(e[a]):t[e[a]]>r&&(r=t[e[a]],n=[e[a]]);return n}}var name$D="mode",factory_1$F=factory$F,mode={name:name$D,factory:factory_1$F};function factory$E(e,t,n,r){var a=n(multiplyScalar),i=n(improveErrorMessage),o=r("prod",{"Array | Matrix":s,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("prod(A, dim) is not yet supported")},"...":function(e){return s(e)}});return o.toTex=void 0,o;function s(e){var t=void 0;if(deepForEach(e,(function(e){try{t=void 0===t?e:a(t,e)}catch(t){throw i(t,"prod",e)}})),void 0===t)throw new Error("Cannot calculate prod of an empty array");return t}}var name$C="prod",factory_1$E=factory$E,prod={name:name$C,factory:factory_1$E},isInteger=number$5.isInteger,isNumber$2=number$5.isNumber,flatten$3=array$3.flatten;function factory$D(e,t,n,r){var a=n(add$2),i=n(multiply$1),o=n(partitionSelect),s=n(compare);function l(e,t,n){var r=flatten$3(e),l=r.length;if(0===l)throw new Error("Cannot calculate quantile of an empty sequence");if(isNumber$2(t)){var c;if(0==(y=(c=t*(l-1))%1)){var p=n?r[c]:o(r,c);return u(p),p}var d=Math.floor(c);if(n)f=r[d],h=r[d+1];else{h=o(r,d+1),f=r[d];for(var m=0;m<d;++m)s(r[m],f)>0&&(f=r[m])}return u(f),u(h),a(i(f,1-y),i(h,y))}if((c=t.times(l-1)).isInteger())return c=c.toNumber(),p=n?r[c]:o(r,c),u(p),p;d=c.floor();var f,h,y=c.minus(d),b=d.toNumber();if(n)f=r[b],h=r[b+1];else for(h=o(r,b+1),f=r[b],m=0;m<b;++m)s(r[m],f)>0&&(f=r[m]);u(f),u(h);var g=new y.constructor(1);return a(i(f,g.minus(y)),i(h,y))}var u=r({"number | BigNumber | Unit":function(e){return e}});return function(t,n,r){var a,i,o;if(arguments.length<2||arguments.length>3)throw new SyntaxError("Function quantileSeq requires two or three parameters");if(isCollection(t)){if("boolean"==typeof(r=r||!1)){if(i=t.valueOf(),isNumber$2(n)){if(n<0)throw new Error("N/prob must be non-negative");if(n<=1)return l(i,n,r);if(n>1){if(!isInteger(n))throw new Error("N must be a positive integer");var s=n+1;a=new Array(n);for(var u=0;u<n;)a[u]=l(i,++u/s,r);return a}}if(e.isBigNumber(n)){if(n.isNegative())throw new Error("N/prob must be non-negative");if(o=new n.constructor(1),n.lte(o))return l(i,n,r);if(n.gt(o)){if(!n.isInteger())throw new Error("N must be a positive integer");var c=n.toNumber();if(c>4294967295)throw new Error("N must be less than or equal to 2^32-1, as that is the maximum length of an Array");for(s=new e.BigNumber(c+1),a=new Array(c),u=0;u<c;)a[u]=l(i,new e.BigNumber(++u).div(s),r);return a}}if(Array.isArray(n)){for(a=new Array(n.length),u=0;u<a.length;++u){var p=n[u];if(isNumber$2(p)){if(p<0||p>1)throw new Error("Probability must be between 0 and 1, inclusive")}else{if(!e.isBigNumber(p))throw new TypeError("Unexpected type of argument in function quantileSeq");if(o=new p.constructor(1),p.isNegative()||p.gt(o))throw new Error("Probability must be between 0 and 1, inclusive")}a[u]=l(i,p,r)}return a}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}}var name$B="quantileSeq",factory_1$D=factory$D,quantileSeq={name:name$B,factory:factory_1$D},DEFAULT_NORMALIZATION="unbiased";function factory$C(e,t,n,r){var a=n(addScalar),i=n(subtract$1),o=n(multiplyScalar),s=n(divideScalar),l=n(improveErrorMessage),u=r("variance",{"Array | Matrix":function(e){return c(e,DEFAULT_NORMALIZATION)},"Array | Matrix, string":c,"...":function(e){return c(e,DEFAULT_NORMALIZATION)}});return u.toTex="\\mathrm{Var}\\left(${args}\\right)",u;function c(t,n){var r=0,u=0;if(0==t.length)throw new SyntaxError("Function var requires one or more parameters (0 provided)");if(deepForEach(t,(function(e){try{r=a(r,e),u++}catch(t){throw l(t,"var",e)}})),0===u)throw new Error("Cannot calculate var of an empty array");var c=s(r,u);switch(r=0,deepForEach(t,(function(e){var t=i(e,c);r=a(r,o(t,t))})),n){case"uncorrected":return s(r,u);case"biased":return s(r,u+1);case"unbiased":var p=e.isBigNumber(r)?new e.BigNumber(0):0;return 1==u?p:s(r,u-1);default:throw new Error('Unknown normalization "'+n+'". Choose "unbiased" (default), "uncorrected", or "biased".')}}}var name$A="var",factory_1$C=factory$C,_var={name:name$A,factory:factory_1$C};function factory$B(e,t,n,r){var a=n(sqrt$1),i=n(_var),o=r("std",{"Array | Matrix":s,"Array | Matrix, string":s,"...":function(e){return s(e)}});return o.toTex=void 0,o;function s(e,t){if(0==e.length)throw new SyntaxError("Function std requires one or more parameters (0 provided)");try{return a(i.apply(null,arguments))}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf(" var")?new TypeError(e.message.replace(" var"," std")):e}}}var name$z="std",factory_1$B=factory$B,std={name:name$z,factory:factory_1$B},statistics=[mad,max$1,mean,median,min$1,mode,prod,quantileSeq,std,sum,_var];function factory$A(e,t,n,r){var a=r("format",{any:string$a.format,"any, Object | function | number":string$a.format});return a.toTex=void 0,a}var name$y="format",factory_1$A=factory$A,format$2={name:name$y,factory:factory_1$A},isString$2=string$a.isString,format$1=string$a.format;function factory$z(e,t,n,r){var a=r("print",{"string, Object | Array":_print,"string, Object |Array, number | Object":_print});return a.toTex=void 0,a}function _print(e,t,n){return e.replace(/\$([\w\.]+)/g,(function(e,r){for(var a=r.split("."),i=t[a.shift()];a.length&&void 0!==i;){var o=a.shift();i=o?i[o]:i+"."}return void 0!==i?isString$2(i)?i:format$1(i,n):e}))}var name$x="print",factory_1$z=factory$z,print={name:name$x,factory:factory_1$z},string=[format$2,print];function factory$y(e,t,n,r){var a=r("acos",{number:function(n){return n>=-1&&n<=1||t.predictable?Math.acos(n):new e.Complex(n,0).acos()},Complex:function(e){return e.acos()},BigNumber:function(e){return e.acos()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cos^{-1}\\left(${args[0]}\\right)"},a}var name$w="acos",factory_1$y=factory$y,acos$1={name:name$w,factory:factory_1$y};function factory$x(e,t,n,r){var a=r("acosh",{number:function(n){return n>=1||t.predictable?_acosh(n):n<=-1?new e.Complex(Math.log(Math.sqrt(n*n-1)-n),Math.PI):new e.Complex(n,0).acosh()},Complex:function(e){return e.acosh()},BigNumber:function(e){return e.acosh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cosh^{-1}\\left(${args[0]}\\right)"},a}var _acosh=Math.acosh||function(e){return Math.log(Math.sqrt(e*e-1)+e)},name$v="acosh",factory_1$x=factory$x,acosh$1={name:name$v,factory:factory_1$x};function factory$w(e,t,n,r){var a=r("acot",{number:function(e){return Math.atan(1/e)},Complex:function(e){return e.acot()},BigNumber:function(t){return new e.BigNumber(1).div(t).atan()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cot^{-1}\\left(${args[0]}\\right)"},a}var name$u="acot",factory_1$w=factory$w,acot$1={name:name$u,factory:factory_1$w};function factory$v(e,t,n,r){var a=r("acoth",{number:function(n){return n>=1||n<=-1||t.predictable?isFinite(n)?(Math.log((n+1)/n)+Math.log(n/(n-1)))/2:0:new e.Complex(n,0).acoth()},Complex:function(e){return e.acoth()},BigNumber:function(t){return new e.BigNumber(1).div(t).atanh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\coth^{-1}\\left(${args[0]}\\right)"},a}var name$t="acoth",factory_1$v=factory$v,acoth$1={name:name$t,factory:factory_1$v};function factory$u(e,t,n,r){var a=r("acsc",{number:function(n){return n<=-1||n>=1||t.predictable?Math.asin(1/n):new e.Complex(n,0).acsc()},Complex:function(e){return e.acsc()},BigNumber:function(t){return new e.BigNumber(1).div(t).asin()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\csc^{-1}\\left(${args[0]}\\right)"},a}var name$s="acsc",factory_1$u=factory$u,acsc$1={name:name$s,factory:factory_1$u};function factory$t(e,t,n,r){var a=r("acsch",{number:function(e){return e=1/e,Math.log(e+Math.sqrt(e*e+1))},Complex:function(e){return e.acsch()},BigNumber:function(t){return new e.BigNumber(1).div(t).asinh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\mathrm{csch}^{-1}\\left(${args[0]}\\right)"},a}var name$r="acsch",factory_1$t=factory$t,acsch$1={name:name$r,factory:factory_1$t};function factory$s(e,t,n,r){var a=r("asec",{number:function(n){return n<=-1||n>=1||t.predictable?Math.acos(1/n):new e.Complex(n,0).asec()},Complex:function(e){return e.asec()},BigNumber:function(t){return new e.BigNumber(1).div(t).acos()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sec^{-1}\\left(${args[0]}\\right)"},a}var name$q="asec",factory_1$s=factory$s,asec$1={name:name$q,factory:factory_1$s};function factory$r(e,t,n,r){r.find(n(acosh$1),["Complex"]);var a=r("asech",{number:function(n){if(n<=1&&n>=-1||t.predictable){n=1/n;var r=Math.sqrt(n*n-1);return n>0||t.predictable?Math.log(r+n):new e.Complex(Math.log(r-n),Math.PI)}return new e.Complex(n,0).asech()},Complex:function(e){return e.asech()},BigNumber:function(t){return new e.BigNumber(1).div(t).acosh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\mathrm{sech}^{-1}\\left(${args[0]}\\right)"},a}var name$p="asech",factory_1$r=factory$r,asech$1={name:name$p,factory:factory_1$r};function factory$q(e,t,n,r){var a=r("asin",{number:function(n){return n>=-1&&n<=1||t.predictable?Math.asin(n):new e.Complex(n,0).asin()},Complex:function(e){return e.asin()},BigNumber:function(e){return e.asin()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sin^{-1}\\left(${args[0]}\\right)"},a}var name$o="asin",factory_1$q=factory$q,asin$1={name:name$o,factory:factory_1$q};function factory$p(e,t,n,r){var a=r("asinh",{number:Math.asinh||function(e){return Math.log(Math.sqrt(e*e+1)+e)},Complex:function(e){return e.asinh()},BigNumber:function(e){return e.asinh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sinh^{-1}\\left(${args[0]}\\right)"},a}var name$n="asinh",factory_1$p=factory$p,asinh$1={name:name$n,factory:factory_1$p};function factory$o(e,t,n,r){var a=r("atan",{number:function(e){return Math.atan(e)},Complex:function(e){return e.atan()},BigNumber:function(e){return e.atan()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\tan^{-1}\\left(${args[0]}\\right)"},a}var name$m="atan",factory_1$o=factory$o,atan$1={name:name$m,factory:factory_1$o};function factory$n(e,t,n,r){var a=n(matrix$5),i=n(algorithm02),o=n(algorithm03),s=n(algorithm09),l=n(algorithm11),u=n(algorithm12),c=n(algorithm13),p=n(algorithm14),d=r("atan2",{"number, number":Math.atan2,"BigNumber, BigNumber":function(t,n){return e.BigNumber.atan2(t,n)},"SparseMatrix, SparseMatrix":function(e,t){return s(e,t,d,!1)},"SparseMatrix, DenseMatrix":function(e,t){return i(t,e,d,!0)},"DenseMatrix, SparseMatrix":function(e,t){return o(e,t,d,!1)},"DenseMatrix, DenseMatrix":function(e,t){return c(e,t,d)},"Array, Array":function(e,t){return d(a(e),a(t)).valueOf()},"Array, Matrix":function(e,t){return d(a(e),t)},"Matrix, Array":function(e,t){return d(e,a(t))},"SparseMatrix, number | BigNumber":function(e,t){return l(e,t,d,!1)},"DenseMatrix, number | BigNumber":function(e,t){return p(e,t,d,!1)},"number | BigNumber, SparseMatrix":function(e,t){return u(t,e,d,!0)},"number | BigNumber, DenseMatrix":function(e,t){return p(t,e,d,!0)},"Array, number | BigNumber":function(e,t){return p(a(e),t,d,!1).valueOf()},"number | BigNumber, Array":function(e,t){return p(a(t),e,d,!0).valueOf()}});return d.toTex={2:"\\mathrm{atan2}\\left(${args}\\right)"},d}var name$l="atan2",factory_1$n=factory$n,atan2$1={name:name$l,factory:factory_1$n};function factory$m(e,t,n,r){var a=r("atanh",{number:function(n){return n<=1&&n>=-1||t.predictable?_atanh(n):new e.Complex(n,0).atanh()},Complex:function(e){return e.atanh()},BigNumber:function(e){return e.atanh()},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\tanh^{-1}\\left(${args[0]}\\right)"},a}var _atanh=Math.atanh||function(e){return Math.log((1+e)/(1-e))/2},name$k="atanh",factory_1$m=factory$m,atanh$1={name:name$k,factory:factory_1$m};function factory$l(e,t,n,r){var a=r("cos",{number:Math.cos,Complex:function(e){return e.cos()},BigNumber:function(e){return e.cos()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cos is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cos\\left(${args[0]}\\right)"},a}var name$j="cos",factory_1$l=factory$l,cos$1={name:name$j,factory:factory_1$l};function factory$k(e,t,n,r){var a=r("cosh",{number:_cosh,Complex:function(e){return e.cosh()},BigNumber:function(e){return e.cosh()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cosh is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cosh\\left(${args[0]}\\right)"},a}var _cosh=Math.cosh||function(e){return(Math.exp(e)+Math.exp(-e))/2},name$i="cosh",factory_1$k=factory$k,cosh$1={name:name$i,factory:factory_1$k};function factory$j(e,t,n,r){var a=r("cot",{number:function(e){return 1/Math.tan(e)},Complex:function(e){return e.cot()},BigNumber:function(t){return new e.BigNumber(1).div(t.tan())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cot is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\cot\\left(${args[0]}\\right)"},a}var name$h="cot",factory_1$j=factory$j,cot$1={name:name$h,factory:factory_1$j};function factory$i(e,t,n,r){var a=r("coth",{number:_coth,Complex:function(e){return e.coth()},BigNumber:function(t){return new e.BigNumber(1).div(t.tanh())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function coth is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\coth\\left(${args[0]}\\right)"},a}function _coth(e){var t=Math.exp(2*e);return(t+1)/(t-1)}var name$g="coth",factory_1$i=factory$i,coth$1={name:name$g,factory:factory_1$i};function factory$h(e,t,n,r){var a=r("csc",{number:function(e){return 1/Math.sin(e)},Complex:function(e){return e.csc()},BigNumber:function(t){return new e.BigNumber(1).div(t.sin())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csc is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\csc\\left(${args[0]}\\right)"},a}var name$f="csc",factory_1$h=factory$h,csc$1={name:name$f,factory:factory_1$h},sign$1=number$5.sign;function factory$g(e,t,n,r){var a=r("csch",{number:_csch,Complex:function(e){return e.csch()},BigNumber:function(t){return new e.BigNumber(1).div(t.sinh())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function csch is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\mathrm{csch}\\left(${args[0]}\\right)"},a}function _csch(e){return 0==e?Number.POSITIVE_INFINITY:Math.abs(2/(Math.exp(e)-Math.exp(-e)))*sign$1(e)}var name$e="csch",factory_1$g=factory$g,csch$1={name:name$e,factory:factory_1$g};function factory$f(e,t,n,r){var a=r("sec",{number:function(e){return 1/Math.cos(e)},Complex:function(e){return e.sec()},BigNumber:function(t){return new e.BigNumber(1).div(t.cos())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sec is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sec\\left(${args[0]}\\right)"},a}var name$d="sec",factory_1$f=factory$f,sec$1={name:name$d,factory:factory_1$f};function factory$e(e,t,n,r){var a=r("sech",{number:_sech,Complex:function(e){return e.sech()},BigNumber:function(t){return new e.BigNumber(1).div(t.cosh())},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sech is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\mathrm{sech}\\left(${args[0]}\\right)"},a}function _sech(e){return 2/(Math.exp(e)+Math.exp(-e))}var name$c="sech",factory_1$e=factory$e,sech$1={name:name$c,factory:factory_1$e};function factory$d(e,t,n,r){var a=r("sin",{number:Math.sin,Complex:function(e){return e.sin()},BigNumber:function(e){return e.sin()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sin is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sin\\left(${args[0]}\\right)"},a}var name$b="sin",factory_1$d=factory$d,sin$1={name:name$b,factory:factory_1$d};function factory$c(e,t,n,r){var a=r("sinh",{number:_sinh,Complex:function(e){return e.sinh()},BigNumber:function(e){return e.sinh()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function sinh is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\sinh\\left(${args[0]}\\right)"},a}var _sinh=Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},name$a="sinh",factory_1$c=factory$c,sinh$1={name:name$a,factory:factory_1$c};function factory$b(e,t,n,r){var a=r("tan",{number:Math.tan,Complex:function(e){return e.tan()},BigNumber:function(e){return e.tan()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tan is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\tan\\left(${args[0]}\\right)"},a}var name$9="tan",factory_1$b=factory$b,tan$1={name:name$9,factory:factory_1$b};function factory$a(e,t,n,r){var a=r("tanh",{number:_tanh,Complex:function(e){return e.tanh()},BigNumber:function(e){return e.tanh()},Unit:function(t){if(!t.hasBase(e.Unit.BASE_UNITS.ANGLE))throw new TypeError("Unit in function tanh is no angle");return a(t.value)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\tanh\\left(${args[0]}\\right)"},a}var _tanh=Math.tanh||function(e){var t=Math.exp(2*e);return(t-1)/(t+1)},name$8="tanh",factory_1$a=factory$a,tanh$1={name:name$8,factory:factory_1$a},trigonometry=[acos$1,acosh$1,acot$1,acoth$1,acsc$1,acsch$1,asec$1,asech$1,asin$1,asinh$1,atan$1,atan2$1,atanh$1,cos$1,cosh$1,cot$1,coth$1,csc$1,csch$1,sec$1,sech$1,sin$1,sinh$1,tan$1,tanh$1];function factory$9(e,t,n,r){var a=latex$1,i=n(matrix$5),o=n(algorithm13),s=n(algorithm14),l=r("to",{"Unit, Unit | string":function(e,t){return e.to(t)},"Matrix, Matrix":function(e,t){return o(e,t,l)},"Array, Array":function(e,t){return l(i(e),i(t)).valueOf()},"Array, Matrix":function(e,t){return l(i(e),t)},"Matrix, Array":function(e,t){return l(e,i(t))},"Matrix, any":function(e,t){return s(e,t,l,!1)},"any, Matrix":function(e,t){return s(t,e,l,!0)},"Array, any":function(e,t){return s(i(e),t,l,!1).valueOf()},"any, Array":function(e,t){return s(i(t),e,l,!0).valueOf()}});return l.toTex={2:"\\left(${args[0]}"+a.operators.to+"${args[1]}\\right)"},l}var name$7="to",factory_1$9=factory$9,to={name:name$7,factory:factory_1$9},unit$2=[to];function factory$8(e,t,n,r){var a=r("isPrime",{number:function(e){if(e<2)return!1;if(2==e)return!0;if(e%2==0)return!1;for(var t=3;t*t<=e;t+=2)if(e%t==0)return!1;return!0},BigNumber:function(t){if(t.lt(2))return!1;if(t.equals(2))return!0;if(t.mod(2).isZero())return!1;for(var n=e.BigNumber(3);n.times(n).lte(t);n=n.plus(1))if(t.mod(n).isZero())return!1;return!0},"Array | Matrix":function(e){return deepMap(e,a)}});return a}var name$6="isPrime",factory_1$8=factory$8,isPrime={name:name$6,factory:factory_1$8};function factory$7(e,t,n,r){return r("isNaN",{number:function(e){return Number.isNaN(e)},BigNumber:function(e){return e.isNaN()},Fraction:function(e){return!1},Complex:function(e){return e.isNaN()},Unit:function(e){return Number.isNaN(e.value)},"Array | Matrix":function(e){return deepMap(e,Number.isNaN)}})}var name$5="isNaN",factory_1$7=factory$7,_isNaN$1={name:name$5,factory:factory_1$7},utils$1=[clone$6,isInteger$7,isNegative,isNumeric,isPositive,isPrime,isZero,_isNaN$1,_typeof],_function=[algebra,arithmetic$1,bitwise,combinatorics,complex,geometry,logical,matrix$2,probability,relational,set,special,statistics,string,trigonometry,unit$2,utils$1];function factory$6(e,t,n,r,a){return function(t,n){var r=e[n&&n.mathjs]||a.expression&&a.expression.node[n&&n.mathjs];return r&&"function"==typeof r.fromJSON?r.fromJSON(n):n}}var name$4="reviver",path$1="json",factory_1$6=factory$6,math$4=!0,reviver={name:name$4,path:path$1,factory:factory_1$6,math:math$4},json=[reviver],error=[{name:"ArgumentsError",path:"error",factory:function(){return ArgumentsError_1}},{name:"DimensionError",path:"error",factory:function(){return DimensionError_1}},{name:"IndexError",path:"error",factory:function(){return IndexError_1}}],lib$1=[type$1,constants$1,expression,_function,json,error],numeric1_2_6=createCommonjsModule((function(module,exports){var numeric=exports;void 0!==commonjsGlobal$1&&(commonjsGlobal$1.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var n,r,a;for(void 0===t&&(t=15),r=.5,n=new Date;;){for(a=r*=2;a>3;a-=4)e(),e(),e(),e();for(;a>0;)e(),a--;if(new Date-n>t)break}for(a=r;a>3;a-=4)e(),e(),e(),e();for(;a>0;)e(),a--;return 1e3*(3*r-1)/(new Date-n)},numeric._myIndexOf=function(e){var t,n=this.length;for(t=0;t<n;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,n),a=r.toPrecision(numeric.precision);return 10===parseFloat(a)&&(n++,a=(r=1).toPrecision(numeric.precision)),parseFloat(a).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function e(r){var a;if(void 0===r)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof r)return n.push('"'+r+'"'),!1;if("boolean"==typeof r)return n.push(r.toString()),!1;if("number"==typeof r){var i=t(r),o=r.toPrecision(numeric.precision),s=parseFloat(r.toString()).toString(),l=[i,o,s,parseFloat(o).toString(),parseFloat(s).toString()];for(a=1;a<l.length;a++)l[a].length<i.length&&(i=l[a]);return n.push(Array(numeric.precision+8-i.length).join(" ")+i),!1}if(null===r)return n.push("null"),!1;if("function"==typeof r){n.push(r.toString());var u=!1;for(a in r)r.hasOwnProperty(a)&&(u?n.push(",\n"):n.push("\n{"),u=!0,n.push(a),n.push(": \n"),e(r[a]));return u&&n.push("}\n"),!0}if(r instanceof Array){if(r.length>numeric.largeArray)return n.push("...Large Array..."),!0;for(u=!1,n.push("["),a=0;a<r.length;a++)a>0&&(n.push(","),u&&n.push("\n ")),u=e(r[a]);return n.push("]"),!0}for(a in n.push("{"),u=!1,r)r.hasOwnProperty(a)&&(u&&n.push(",\n"),u=!0,n.push(a),n.push(": \n"),e(r[a]));return n.push("}"),!0}(e),n.join("")},numeric.parseDate=function(e){return function e(t){if("string"==typeof t)return Date.parse(t.replace(/-/g,"/"));if(!(t instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseFloat=function(e){return function e(t){if("string"==typeof t)return parseFloat(t);if(!(t instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,r=[];for(n=0;n<t.length;n++)r[n]=e(t[n]);return r}(e)},numeric.parseCSV=function(e){var t,n,r,a=e.split("\n"),i=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,s=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,l=0;for(n=0;n<a.length;n++){var u,c=(a[n]+",").match(o);if(c.length>0){for(i[l]=[],t=0;t<c.length;t++)u=(r=c[t]).substr(0,r.length-1),s.test(u)?i[l][t]=parseFloat(u):i[l][t]=u;l++}}return i},numeric.toCSV=function(e){var t,n,r,a,i;for(r=numeric.dim(e)[0],i=[],t=0;t<r;t++){for(a=[],n=0;n<r;n++)a[n]=e[t][n].toString();i[t]=a.join(", ")}return i.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);var r,a=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=-1;for(e.length,r=t;r<n;r++)i=i>>>8^a[255&(i^e[r])];return-1^i}var n,r,a,i,o,s,l,u,c,p,d=e[0].length,m=e[0][0].length,f=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,m>>24&255,m>>16&255,m>>8&255,255&m,d>>24&255,d>>16&255,d>>8&255,255&d,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(p=t(f,12,29),f[29]=p>>24&255,f[30]=p>>16&255,f[31]=p>>8&255,f[32]=255&p,n=1,r=0,l=0;l<d;l++){for(l<d-1?f.push(0):f.push(1),o=3*m+1+(0===l)&255,s=3*m+1+(0===l)>>8&255,f.push(o),f.push(s),f.push(255&~o),f.push(255&~s),0===l&&f.push(0),u=0;u<m;u++)for(a=0;a<3;a++)r=(r+(n=(n+(o=(o=e[a][l][u])>255?255:o<0?0:Math.round(o)))%65521))%65521,f.push(o);f.push(0)}return c=(r<<16)+n,f.push(c>>24&255),f.push(c>>16&255),f.push(c>>8&255),f.push(255&c),i=f.length-41,f[33]=i>>24&255,f[34]=i>>16&255,f[35]=i>>8&255,f[36]=255&i,p=t(f,37),f.push(p>>24&255),f.push(p>>16&255),f.push(p>>8&255),f.push(255&p),f.push(0),f.push(0),f.push(0),f.push(0),f.push(73),f.push(69),f.push(78),f.push(68),f.push(174),f.push(66),f.push(96),f.push(130),"data:image/png;base64,"+function(e){var t,n,r,a,i,o,s,l=e.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="";for(t=0;t<l;t+=3)i=((3&(n=e[t]))<<4)+((r=e[t+1])>>4),o=((15&r)<<2)+((a=e[t+2])>>6),s=63&a,t+1>=l?o=s=64:t+2>=l&&(s=64),c+=u.charAt(n>>2)+u.charAt(i)+u.charAt(o)+u.charAt(s);return c}(f)},numeric._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t;return"object"==typeof e?"object"==typeof(t=e[0])?"object"==typeof t[0]?numeric._dim(e):[e.length,t.length]:[e.length]:[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,n){var r,a;if(!(t instanceof Array&&n instanceof Array))return!1;if((a=t.length)!==n.length)return!1;for(r=0;r<a;r++)if(t[r]!==n[r]){if("object"!=typeof t[r])return!1;if(!e(t[r],n[r]))return!1}return!0},numeric.rep=function(e,t,n){void 0===n&&(n=0);var r,a=e[n],i=Array(a);if(n===e.length-1){for(r=a-2;r>=0;r-=2)i[r+1]=t,i[r]=t;return-1===r&&(i[0]=t),i}for(r=a-1;r>=0;r--)i[r]=numeric.rep(e,t,n+1);return i},numeric.dotMMsmall=function(e,t){var n,r,a,i,o,s,l,u,c,p,d;for(i=e.length,o=t.length,s=t[0].length,l=Array(i),n=i-1;n>=0;n--){for(u=Array(s),c=e[n],a=s-1;a>=0;a--){for(p=c[o-1]*t[o-1][a],r=o-2;r>=1;r-=2)d=r-1,p+=c[r]*t[r][a]+c[d]*t[d][a];0===r&&(p+=c[0]*t[0][a]),u[a]=p}l[n]=u}return l},numeric._getCol=function(e,t,n){var r;for(r=e.length-1;r>0;--r)n[r]=e[r][t],n[--r]=e[r][t];0===r&&(n[0]=e[0][t])},numeric.dotMMbig=function(e,t){var n,r,a,i=numeric._getCol,o=t.length,s=Array(o),l=e.length,u=t[0].length,c=new Array(l),p=numeric.dotVV;for(--o,r=--l;-1!==r;--r)c[r]=Array(u);for(r=--u;-1!==r;--r)for(i(t,r,s),a=l;-1!==a;--a)n=e[a],c[a][r]=p(n,s);return c},numeric.dotMV=function(e,t){var n,r=e.length;t.length;var a=Array(r),i=numeric.dotVV;for(n=r-1;n>=0;n--)a[n]=i(e[n],t);return a},numeric.dotVM=function(e,t){var n,r,a,i,o,s,l;for(a=e.length,i=t[0].length,o=Array(i),r=i-1;r>=0;r--){for(s=e[a-1]*t[a-1][r],n=a-2;n>=1;n-=2)l=n-1,s+=e[n]*t[n][r]+e[l]*t[l][r];0===n&&(s+=e[0]*t[0][r]),o[r]=s}return o},numeric.dotVV=function(e,t){var n,r,a=e.length,i=e[a-1]*t[a-1];for(n=a-2;n>=1;n-=2)r=n-1,i+=e[n]*t[n]+e[r]*t[r];return 0===n&&(i+=e[0]*t[0]),i},numeric.dot=function(e,t){var n=numeric.dim;switch(1e3*n(e).length+n(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,n,r,a,i=e.length,o=Array(i);for(t=i-1;t>=0;t--){for(a=Array(i),n=t+2,r=i-1;r>=n;r-=2)a[r]=0,a[r-1]=0;for(r>t&&(a[r]=0),a[t]=e[t],r=t-1;r>=1;r-=2)a[r]=0,a[r-1]=0;0===r&&(a[0]=0),o[t]=a}return o},numeric.getDiag=function(e){var t,n=Math.min(e.length,e[0].length),r=Array(n);for(t=n-1;t>=1;--t)r[t]=e[t][t],r[--t]=e[t][t];return 0===t&&(r[0]=e[0][0]),r},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,n){void 0===n&&(n="");var r,a,i=[],o=/\[i\]$/,s="",l=!1;for(r=0;r<e.length;r++)o.test(e[r])?s=a=e[r].substring(0,e[r].length-3):a=e[r],"ret"===a&&(l=!0),i.push(a);return i[e.length]="_s",i[e.length+1]="_k",i[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+s+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(l?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,i)},numeric.pointwise2=function(e,t,n){void 0===n&&(n="");var r,a,i=[],o=/\[i\]$/,s="",l=!1;for(r=0;r<e.length;r++)o.test(e[r])?s=a=e[r].substring(0,e[r].length-3):a=e[r],"ret"===a&&(l=!0),i.push(a);return i[e.length]="var _n = "+s+".length;\nvar i"+(l?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,i)},numeric._biforeach=function e(t,n,r,a,i){var o;if(a!==r.length-1)for(o=r[a]-1;o>=0;o--)e("object"==typeof t?t[o]:t,"object"==typeof n?n[o]:n,r,a+1,i);else i(t,n)},numeric._biforeach2=function e(t,n,r,a,i){if(a===r.length-1)return i(t,n);var o,s=r[a],l=Array(s);for(o=s-1;o>=0;--o)l[o]=e("object"==typeof t?t[o]:t,"object"==typeof n?n[o]:n,r,a+1,i);return l},numeric._foreach=function e(t,n,r,a){var i;if(r!==n.length-1)for(i=n[r]-1;i>=0;i--)e(t[i],n,r+1,a);else a(t)},numeric._foreach2=function e(t,n,r,a){if(r===n.length-1)return a(t);var i,o=n[r],s=Array(o);for(i=o-1;i>=0;i--)s[i]=e(t[i],n,r+1,a);return s},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,a="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(a="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},r=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+t+"= "+n}:function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),a),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),a),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),a),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+r("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),a),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),a),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(a="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(a="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",a),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",a),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"==typeof e?"object"==typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"==typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,n,r,a,i,o,s,l=numeric.dim(e),u=Math.abs,c=l[0],p=l[1],d=numeric.clone(e),m=numeric.identity(c);for(o=0;o<p;++o){var f=-1,h=-1;for(i=o;i!==c;++i)(s=u(d[i][o]))>h&&(f=i,h=s);for(n=d[f],d[f]=d[o],d[o]=n,a=m[f],m[f]=m[o],m[o]=a,e=n[o],s=o;s!==p;++s)n[s]/=e;for(s=p-1;-1!==s;--s)a[s]/=e;for(i=c-1;-1!==i;--i)if(i!==o){for(t=d[i],r=m[i],e=t[o],s=o+1;s!==p;++s)t[s]-=n[s]*e;for(s=p-1;s>0;--s)r[s]-=a[s]*e,r[--s]-=a[s]*e;0===s&&(r[0]-=a[0]*e)}}return m},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var n,r,a,i,o,s,l,u,c=t[0],p=1,d=numeric.clone(e);for(r=0;r<c-1;r++){for(a=r,n=r+1;n<c;n++)Math.abs(d[n][r])>Math.abs(d[a][r])&&(a=n);for(a!==r&&(l=d[a],d[a]=d[r],d[r]=l,p*=-1),i=d[r],n=r+1;n<c;n++){for(s=(o=d[n])[r]/i[r],a=r+1;a<c-1;a+=2)u=a+1,o[a]-=i[a]*s,o[u]-=i[u]*s;a!==c&&(o[a]-=i[a]*s)}if(0===i[r])return 0;p*=i[r]}return p*d[r][r]},numeric.transpose=function(e){var t,n,r,a,i,o=e.length,s=e[0].length,l=Array(s);for(n=0;n<s;n++)l[n]=Array(o);for(t=o-1;t>=1;t-=2){for(a=e[t],r=e[t-1],n=s-1;n>=1;--n)(i=l[n])[t]=a[n],i[t-1]=r[n],(i=l[--n])[t]=a[n],i[t-1]=r[n];0===n&&((i=l[0])[t]=a[0],i[t-1]=r[0])}if(0===t){for(r=e[0],n=s-1;n>=1;--n)l[n][0]=r[n],l[--n][0]=r[n];0===n&&(l[0][0]=r[0])}return l},numeric.negtranspose=function(e){var t,n,r,a,i,o=e.length,s=e[0].length,l=Array(s);for(n=0;n<s;n++)l[n]=Array(o);for(t=o-1;t>=1;t-=2){for(a=e[t],r=e[t-1],n=s-1;n>=1;--n)(i=l[n])[t]=-a[n],i[t-1]=-r[n],(i=l[--n])[t]=-a[n],i[t-1]=-r[n];0===n&&((i=l[0])[t]=-a[0],i[t-1]=-r[0])}if(0===t){for(r=e[0],n=s-1;n>=1;--n)l[n][0]=-r[n],l[--n][0]=-r[n];0===n&&(l[0][0]=-r[0])}return l},numeric._random=function e(t,n){var r,a,i=t[n],o=Array(i);if(n===t.length-1){for(a=Math.random,r=i-1;r>=1;r-=2)o[r]=a(),o[r-1]=a();return 0===r&&(o[0]=a()),o}for(r=i-1;r>=0;r--)o[r]=e(t,n+1);return o},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,n){if(void 0===n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var r,a=Array(n);for(r=--n;r>=0;r--)a[r]=(r*t+(n-r)*e)/n;return a},numeric.getBlock=function(e,t,n){var r=numeric.dim(e);return function e(a,i){var o,s=t[i],l=n[i]-s,u=Array(l);if(i===r.length-1){for(o=l;o>=0;o--)u[o]=a[o+s];return u}for(o=l;o>=0;o--)u[o]=e(a[o+s],i+1);return u}(e,0)},numeric.setBlock=function(e,t,n,r){var a=numeric.dim(e);return function e(r,i,o){var s,l=t[o],u=n[o]-l;if(o===a.length-1)for(s=u;s>=0;s--)r[s+l]=i[s];for(s=u;s>=0;s--)e(r[s+l],i[s],o+1)}(e,r,0),e},numeric.getRange=function(e,t,n){var r,a,i,o,s=t.length,l=n.length,u=Array(s);for(r=s-1;-1!==r;--r)for(u[r]=Array(l),i=u[r],o=e[t[r]],a=l-1;-1!==a;--a)i[a]=o[n[a]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var n,r,a,i,o,s=t[0],l=t[1];for(n=0,r=0,a=0;a<s;++a)n+=e[a][0].length;for(i=0;i<l;++i)r+=e[0][i][0].length;var u=Array(n);for(a=0;a<n;++a)u[a]=Array(r);var c,p,d,m,f,h=0;for(a=0;a<s;++a){for(c=r,i=l-1;-1!==i;--i)for(c-=(o=e[a][i])[0].length,d=o.length-1;-1!==d;--d)for(f=o[d],p=u[h+d],m=f.length-1;-1!==m;--m)p[c+m]=f[m];h+=e[a][0].length}return u},numeric.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return numeric.mul(e,t);var n=numeric.dim(e),r=numeric.dim(t);if(1!==n.length||1!==r.length)throw new Error("numeric: tensor product is only defined for vectors");var a,i,o,s,l=n[0],u=r[0],c=Array(l);for(i=l-1;i>=0;i--){for(a=Array(u),s=e[i],o=u-1;o>=3;--o)a[o]=s*t[o],a[--o]=s*t[o],a[--o]=s*t[o],a[--o]=s*t[o];for(;o>=0;)a[o]=s*t[o],--o;c[i]=a}return c},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,n,r,a){var i;if(numeric.indexOf,"string"!=typeof a)for(i in a="",numeric)numeric.hasOwnProperty(i)&&(e.indexOf(i)>=0||t.indexOf(i)>=0||n.indexOf(i)>=0||r.indexOf(i)>=0)&&i.length>1&&(a+="var "+i+" = numeric."+i+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+a+"\nif(x.y) {  if(y.y) {    return new numeric.T("+r+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,n),t(numeric.neg(this.y),n))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),e(n)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),numeric.negtranspose(n)):new numeric.T(e(t))},numeric.Tunop=function(e,t,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var t,n,r,a,i,o,s,l,u,c,p,d,m,f,h,y,b,g,v=e.x.length,T=numeric.identity(v),C=numeric.rep([v,v],0),N=numeric.clone(e.x),A=numeric.clone(e.y);for(u=0;u<v;u++){for(d=(f=N[u][u])*f+(h=A[u][u])*h,p=u,c=u+1;c<v;c++)(m=(f=N[c][u])*f+(h=A[c][u])*h)>d&&(p=c,d=m);for(p!==u&&(g=N[u],N[u]=N[p],N[p]=g,g=A[u],A[u]=A[p],A[p]=g,g=T[u],T[u]=T[p],T[p]=g,g=C[u],C[u]=C[p],C[p]=g),t=N[u],n=A[u],i=T[u],o=C[u],f=t[u],h=n[u],c=u+1;c<v;c++)y=t[c],b=n[c],t[c]=(y*f+b*h)/d,n[c]=(b*f-y*h)/d;for(c=0;c<v;c++)y=i[c],b=o[c],i[c]=(y*f+b*h)/d,o[c]=(b*f-y*h)/d;for(c=u+1;c<v;c++){for(r=N[c],a=A[c],s=T[c],l=C[c],f=r[u],h=a[u],p=u+1;p<v;p++)y=t[p],b=n[p],r[p]-=y*f-b*h,a[p]-=b*f+y*h;for(p=0;p<v;p++)y=i[p],b=o[p],s[p]-=y*f-b*h,l[p]-=b*f+y*h}}for(u=v-1;u>0;u--)for(i=T[u],o=C[u],c=u-1;c>=0;c--)for(s=T[c],l=C[c],f=N[c][u],h=A[c][u],p=v-1;p>=0;p--)y=i[p],b=o[p],s[p]-=f*y-h*b,l[p]-=f*b+h*y;return new numeric.T(T,C)},numeric.T.prototype.get=function(e){var t,n=this.x,r=this.y,a=0,i=e.length;if(r){for(;a<i;)n=n[t=e[a]],r=r[t],a++;return new numeric.T(n,r)}for(;a<i;)n=n[t=e[a]],a++;return new numeric.T(n)},numeric.T.prototype.set=function(e,t){var n,r=this.x,a=this.y,i=0,o=e.length,s=t.x,l=t.y;if(0===o)return l?this.y=l:a&&(this.y=void 0),this.x=r,this;if(l){for(a||(a=numeric.rep(numeric.dim(r),0),this.y=a);i<o-1;)r=r[n=e[i]],a=a[n],i++;return r[n=e[i]]=s,a[n]=l,this}if(a){for(;i<o-1;)r=r[n=e[i]],a=a[n],i++;return r[n=e[i]]=s,a[n]=s instanceof Array?numeric.rep(numeric.dim(s),0):0,this}for(;i<o-1;)r=r[n=e[i]],i++;return r[n=e[i]]=s,this},numeric.T.prototype.getRows=function(e,t){var n,r,a=t-e+1,i=Array(a),o=this.x,s=this.y;for(n=e;n<=t;n++)i[n-e]=o[n];if(s){for(r=Array(a),n=e;n<=t;n++)r[n-e]=s[n];return new numeric.T(i,r)}return new numeric.T(i)},numeric.T.prototype.setRows=function(e,t,n){var r,a=this.x,i=this.y,o=n.x,s=n.y;for(r=e;r<=t;r++)a[r]=o[r-e];if(s)for(i||(i=numeric.rep(numeric.dim(a),0),this.y=i),r=e;r<=t;r++)i[r]=s[r-e];else if(i)for(r=e;r<=t;r++)i[r]=numeric.rep([o[r-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,n=this.y;return n?new numeric.T(t[e],n[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var n=this.x,r=this.y,a=t.x,i=t.y;return n[e]=a,i?(r||(r=numeric.rep(numeric.dim(n),0),this.y=r),r[e]=i):r&&(r=numeric.rep([a.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var n=this.x,r=this.y,a=numeric.getBlock;return r?new numeric.T(a(n,e,t),a(r,e,t)):new numeric.T(a(n,e,t))},numeric.T.prototype.setBlock=function(e,t,n){n instanceof numeric.T||(n=new numeric.T(n));var r=this.x,a=this.y,i=numeric.setBlock,o=n.x,s=n.y;if(s)return a||(this.y=numeric.rep(numeric.dim(this),0),a=this.y),i(r,e,t,o),i(a,e,t,s),this;i(r,e,t,o),a&&i(a,e,t,numeric.rep(numeric.dim(o),0))},numeric.T.rep=function(e,t){var n=numeric.T;t instanceof n||(t=new n(t));var r=t.x,a=t.y,i=numeric.rep;return a?new n(i(e,r),i(e,a)):new n(i(e,r))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,r=numeric.diag;return n?new numeric.T(r(t),r(n)):new numeric.T(r(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,n=this.y;return n?new e.T(e.getDiag(t),e.getDiag(n)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),n=(e[0]>=0?1:-1)*numeric.norm2(e);t[0]+=n;var r=numeric.norm2(t);if(0===r)throw new Error("eig: internal error");return numeric.div(t,r)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,r,a,i,o,s,l,u,c,p,d=t[0],m=numeric.clone(e),f=numeric.identity(d);for(r=0;r<d-2;r++){for(i=Array(d-r-1),n=r+1;n<d;n++)i[n-r-1]=m[n][r];if(numeric.norm2(i)>0){for(o=numeric.house(i),s=numeric.getBlock(m,[r+1,r],[d-1,d-1]),l=numeric.tensor(o,numeric.dot(o,s)),n=r+1;n<d;n++)for(u=m[n],c=l[n-r-1],a=r;a<d;a++)u[a]-=2*c[a-r];for(s=numeric.getBlock(m,[0,r+1],[d-1,d-1]),l=numeric.tensor(numeric.dot(s,o),o),n=0;n<d;n++)for(u=m[n],c=l[n],a=r+1;a<d;a++)u[a]-=2*c[a-r-1];for(s=Array(d-r-1),n=r+1;n<d;n++)s[n-r-1]=f[n];for(l=numeric.tensor(o,numeric.dot(o,s)),n=r+1;n<d;n++)for(p=f[n],c=l[n-r-1],a=0;a<d;a++)p[a]-=2*c[a]}}return{H:m,Q:f}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){void 0===t&&(t=1e4),e=numeric.clone(e),numeric.clone(e);var n,r,a,i,o,s,l,u,c,p,d,m,f,h,y,b,g,v,T=numeric.dim(e)[0],C=numeric.identity(T);if(T<3)return{Q:C,B:[[0,T-1]]};var N=numeric.epsilon;for(v=0;v<t;v++){for(b=0;b<T-1;b++)if(Math.abs(e[b+1][b])<N*(Math.abs(e[b][b])+Math.abs(e[b+1][b+1]))){var A=numeric.QRFrancis(numeric.getBlock(e,[0,0],[b,b]),t),S=numeric.QRFrancis(numeric.getBlock(e,[b+1,b+1],[T-1,T-1]),t);for(m=Array(b+1),y=0;y<=b;y++)m[y]=C[y];for(f=numeric.dot(A.Q,m),y=0;y<=b;y++)C[y]=f[y];for(m=Array(T-b-1),y=b+1;y<T;y++)m[y-b-1]=C[y];for(f=numeric.dot(S.Q,m),y=b+1;y<T;y++)C[y]=f[y-b-1];return{Q:C,B:A.B.concat(numeric.add(S.B,b+1))}}var w,x,V;for(a=e[T-2][T-2],i=e[T-2][T-1],o=e[T-1][T-2],u=a+(s=e[T-1][T-1]),l=a*s-i*o,c=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*l?(w=.5*(u+Math.sqrt(u*u-4*l)),x=.5*(u-Math.sqrt(u*u-4*l)),c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,w+x)),numeric.diag(numeric.rep([3],w*x)))):c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,u)),numeric.diag(numeric.rep([3],l))),n=[c[0][0],c[1][0],c[2][0]],r=numeric.house(n),m=[e[0],e[1],e[2]],f=numeric.tensor(r,numeric.dot(r,m)),y=0;y<3;y++)for(d=e[y],h=f[y],g=0;g<T;g++)d[g]-=2*h[g];for(m=numeric.getBlock(e,[0,0],[T-1,2]),f=numeric.tensor(numeric.dot(m,r),r),y=0;y<T;y++)for(d=e[y],h=f[y],g=0;g<3;g++)d[g]-=2*h[g];for(m=[C[0],C[1],C[2]],f=numeric.tensor(r,numeric.dot(r,m)),y=0;y<3;y++)for(p=C[y],h=f[y],g=0;g<T;g++)p[g]-=2*h[g];for(b=0;b<T-2;b++){for(g=b;g<=b+1;g++)if(Math.abs(e[g+1][g])<N*(Math.abs(e[g][g])+Math.abs(e[g+1][g+1]))){for(A=numeric.QRFrancis(numeric.getBlock(e,[0,0],[g,g]),t),S=numeric.QRFrancis(numeric.getBlock(e,[g+1,g+1],[T-1,T-1]),t),m=Array(g+1),y=0;y<=g;y++)m[y]=C[y];for(f=numeric.dot(A.Q,m),y=0;y<=g;y++)C[y]=f[y];for(m=Array(T-g-1),y=g+1;y<T;y++)m[y-g-1]=C[y];for(f=numeric.dot(S.Q,m),y=g+1;y<T;y++)C[y]=f[y-g-1];return{Q:C,B:A.B.concat(numeric.add(S.B,g+1))}}for(V=Math.min(T-1,b+3),n=Array(V-b),y=b+1;y<=V;y++)n[y-b-1]=e[y][b];for(r=numeric.house(n),m=numeric.getBlock(e,[b+1,b],[V,T-1]),f=numeric.tensor(r,numeric.dot(r,m)),y=b+1;y<=V;y++)for(d=e[y],h=f[y-b-1],g=b;g<T;g++)d[g]-=2*h[g-b];for(m=numeric.getBlock(e,[0,b+1],[T-1,V]),f=numeric.tensor(numeric.dot(m,r),r),y=0;y<T;y++)for(d=e[y],h=f[y],g=b+1;g<=V;g++)d[g]-=2*h[g-b-1];for(m=Array(V-b),y=b+1;y<=V;y++)m[y-b-1]=C[y];for(f=numeric.tensor(r,numeric.dot(r,m)),y=b+1;y<=V;y++)for(p=C[y],h=f[y-b-1],g=0;g<T;g++)p[g]-=2*h[g]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var n,r,a,i,o,s,l,u,c,p,d,m,f,h,y,b,g=numeric.toUpperHessenberg(e),v=numeric.QRFrancis(g.H,t),T=numeric.T,C=e.length,N=v.B,A=numeric.dot(v.Q,numeric.dot(g.H,numeric.transpose(v.Q))),S=new T(numeric.dot(v.Q,g.Q)),w=N.length,x=Math.sqrt;for(r=0;r<w;r++)if((n=N[r][0])===N[r][1]);else{if(i=n+1,o=A[n][n],s=A[n][i],l=A[i][n],u=A[i][i],0===s&&0===l)continue;(p=(c=-o-u)*c-4*(o*u-s*l))>=0?((y=(o-(d=c<0?-.5*(c-x(p)):-.5*(c+x(p))))*(o-d)+s*s)>(b=l*l+(u-d)*(u-d))?(f=(o-d)/(y=x(y)),h=s/y):(f=l/(b=x(b)),h=(u-d)/b),a=new T([[h,-f],[f,h]]),S.setRows(n,i,a.dot(S.getRows(n,i)))):(d=-.5*c,m=.5*x(-p),(y=(o-d)*(o-d)+s*s)>(b=l*l+(u-d)*(u-d))?(f=(o-d)/(y=x(y+m*m)),h=s/y,d=0,m/=y):(f=l/(b=x(b+m*m)),h=(u-d)/b,d=m/b,m=0),a=new T([[h,-f],[f,h]],[[d,m],[m,-d]]),S.setRows(n,i,a.dot(S.getRows(n,i))))}var V=S.dot(e).dot(S.transjugate()),E=(C=e.length,numeric.T.identity(C));for(i=0;i<C;i++)if(i>0)for(r=i-1;r>=0;r--){var $=V.get([r,r]),_=V.get([i,i]);numeric.neq($.x,_.x)||numeric.neq($.y,_.y)?(d=V.getRow(r).getBlock([r],[i-1]),m=E.getRow(i).getBlock([r],[i-1]),E.set([i,r],V.get([r,i]).neg().sub(d.dot(m)).div($.sub(_)))):E.setRow(i,E.getRow(r))}for(i=0;i<C;i++)d=E.getRow(i),E.setRow(i,d.div(d.norm2()));return E=E.transpose(),E=S.transjugate().dot(E),{lambda:V.getDiag(),E:E}},numeric.ccsSparse=function(e){var t,n,r,a=e.length,i=[];for(n=a-1;-1!==n;--n)for(r in t=e[n]){for(r=parseInt(r);r>=i.length;)i[i.length]=0;0!==t[r]&&i[r]++}var o=i.length,s=Array(o+1);for(s[0]=0,n=0;n<o;++n)s[n+1]=s[n]+i[n];var l=Array(s[o]),u=Array(s[o]);for(n=a-1;-1!==n;--n)for(r in t=e[n])0!==t[r]&&(i[r]--,l[s[r]+i[r]]=n,u[s[r]+i[r]]=t[r]);return[s,l,u]},numeric.ccsFull=function(e){var t,n,r,a,i=e[0],o=e[1],s=e[2],l=numeric.ccsDim(e),u=l[0],c=l[1],p=numeric.rep([u,c],0);for(t=0;t<c;t++)for(r=i[t],a=i[t+1],n=r;n<a;++n)p[o[n]][t]=s[n];return p},numeric.ccsTSolve=function(e,t,n,r,a){var i,o,s,l,u,c,p,d=e[0],m=e[1],f=e[2],h=d.length-1,y=Math.max,b=0;function g(e){var t;if(0===n[e]){for(n[e]=1,t=d[e];t<d[e+1];++t)g(m[t]);a[b]=e,++b}}for(void 0===r&&(n=numeric.rep([h],0)),void 0===r&&(r=numeric.linspace(0,n.length-1)),void 0===a&&(a=[]),i=r.length-1;-1!==i;--i)g(r[i]);for(a.length=b,i=a.length-1;-1!==i;--i)n[a[i]]=0;for(i=r.length-1;-1!==i;--i)o=r[i],n[o]=t[o];for(i=a.length-1;-1!==i;--i){for(o=a[i],s=d[o],l=y(d[o+1],s),u=s;u!==l;++u)if(m[u]===o){n[o]/=f[u];break}for(p=n[o],u=s;u!==l;++u)(c=m[u])!==o&&(n[c]-=p*f[u])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,n,r,a,i){var o,s,l,u=0,c=a.length,p=this.k,d=this.k1,m=this.j;if(0===r[e])for(r[e]=1,m[0]=e,p[0]=s=t[e],d[0]=l=t[e+1];;)if(s>=l){if(a[c]=m[u],0===u)return;++c,s=p[--u],l=d[u]}else 0===r[o=i[n[s]]]?(r[o]=1,p[u]=s,m[++u]=o,s=t[o],d[u]=l=t[o+1]):++s},numeric.ccsLPSolve=function(e,t,n,r,a,i,o){var s=e[0],l=e[1],u=e[2];s.length;var c,p,d,m,f,h,y,b,g,v=t[0],T=t[1],C=t[2];for(p=v[a],d=v[a+1],r.length=0,c=p;c<d;++c)o.dfs(i[T[c]],s,l,n,r,i);for(c=r.length-1;-1!==c;--c)n[r[c]]=0;for(c=p;c!==d;++c)n[m=i[T[c]]]=C[c];for(c=r.length-1;-1!==c;--c){for(f=s[m=r[c]],h=s[m+1],y=f;y<h;++y)if(i[l[y]]===m){n[m]/=u[y];break}for(g=n[m],y=f;y<h;++y)(b=i[l[y]])!==m&&(n[b]-=g*u[y])}return n},numeric.ccsLUP1=function(e,t){var n,r,a,i,o,s,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],p=[numeric.rep([u+1],0),[],[]],d=c[0],m=c[1],f=c[2],h=p[0],y=p[1],b=p[2],g=numeric.rep([u],0),v=numeric.rep([u],0),T=numeric.ccsLPSolve,C=Math.abs,N=numeric.linspace(0,u-1),A=numeric.linspace(0,u-1),S=new numeric.ccsDFS(u);for(void 0===t&&(t=1),n=0;n<u;++n){for(T(c,e,g,v,n,A,S),i=-1,o=-1,r=v.length-1;-1!==r;--r)(a=v[r])<=n||(s=C(g[a]))>i&&(o=a,i=s);for(C(g[n])<t*i&&(r=N[n],i=N[o],N[n]=i,A[i]=n,N[o]=r,A[r]=o,i=g[n],g[n]=g[o],g[o]=i),i=d[n],o=h[n],l=g[n],m[i]=N[n],f[i]=1,++i,r=v.length-1;-1!==r;--r)s=g[a=v[r]],v[r]=0,g[a]=0,a<=n?(y[o]=a,b[o]=s,++o):(m[i]=N[a],f[i]=s/l,++i);d[n+1]=i,h[n+1]=o}for(r=m.length-1;-1!==r;--r)m[r]=A[m[r]];return{L:c,U:p,P:N,Pinv:A}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,n,r,a,i,o){var s,l,u,c=0,p=a.length,d=this.k,m=this.k1,f=this.j;if(0===r[e])for(r[e]=1,f[0]=e,d[0]=l=t[i[e]],m[0]=u=t[i[e]+1];;){if(isNaN(l))throw new Error("Ow!");if(l>=u){if(a[p]=i[f[c]],0===c)return;++p,l=d[--c],u=m[c]}else 0===r[s=n[l]]?(r[s]=1,d[c]=l,f[++c]=s,l=t[s=i[s]],m[c]=u=t[s+1]):++l}},numeric.ccsLPSolve0=function(e,t,n,r,a,i,o,s){var l=e[0],u=e[1],c=e[2];l.length;var p,d,m,f,h,y,b,g,v,T=t[0],C=t[1],N=t[2];for(d=T[a],m=T[a+1],r.length=0,p=d;p<m;++p)s.dfs(C[p],l,u,n,r,i,o);for(p=r.length-1;-1!==p;--p)n[o[f=r[p]]]=0;for(p=d;p!==m;++p)n[f=C[p]]=N[p];for(p=r.length-1;-1!==p;--p){for(g=o[f=r[p]],h=l[f],y=l[f+1],b=h;b<y;++b)if(u[b]===g){n[g]/=c[b];break}for(v=n[g],b=h;b<y;++b)n[u[b]]-=v*c[b];n[g]=v}},numeric.ccsLUP0=function(e,t){var n,r,a,i,o,s,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],p=[numeric.rep([u+1],0),[],[]],d=c[0],m=c[1],f=c[2],h=p[0],y=p[1],b=p[2],g=numeric.rep([u],0),v=numeric.rep([u],0),T=numeric.ccsLPSolve0,C=Math.abs,N=numeric.linspace(0,u-1),A=numeric.linspace(0,u-1),S=new numeric.ccsDFS0(u);for(void 0===t&&(t=1),n=0;n<u;++n){for(T(c,e,g,v,n,A,N,S),i=-1,o=-1,r=v.length-1;-1!==r;--r)(a=v[r])<=n||(s=C(g[N[a]]))>i&&(o=a,i=s);for(C(g[N[n]])<t*i&&(r=N[n],i=N[o],N[n]=i,A[i]=n,N[o]=r,A[r]=o),i=d[n],o=h[n],l=g[N[n]],m[i]=N[n],f[i]=1,++i,r=v.length-1;-1!==r;--r)s=g[N[a=v[r]]],v[r]=0,g[N[a]]=0,a<=n?(y[o]=a,b[o]=s,++o):(m[i]=N[a],f[i]=s/l,++i);d[n+1]=i,h[n+1]=o}for(r=m.length-1;-1!==r;--r)m[r]=A[m[r]];return{L:c,U:p,P:N,Pinv:A}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,n){var r=numeric.ccsDim(e),a=r[0],i=r[1];void 0===t?t=numeric.linspace(0,a-1):"number"==typeof t&&(t=[t]),void 0===n?n=numeric.linspace(0,i-1):"number"==typeof n&&(n=[n]);var o,s,l,u,c=t.length,p=n.length,d=numeric.rep([i],0),m=[],f=[],h=[d,m,f],y=e[0],b=e[1],g=e[2],v=numeric.rep([a],0),T=0,C=numeric.rep([a],0);for(s=0;s<p;++s){var N=y[u=n[s]],A=y[u+1];for(o=N;o<A;++o)C[l=b[o]]=1,v[l]=g[o];for(o=0;o<c;++o)C[t[o]]&&(m[T]=o,f[T]=v[t[o]],++T);for(o=N;o<A;++o)C[l=b[o]]=0;d[s+1]=T}return h},numeric.ccsDot=function(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],o=t[1],s=t[2],l=numeric.ccsDim(e),u=numeric.ccsDim(t),c=l[0];l[1];var p,d,m,f,h,y,b,g,v,T,C,N=u[1],A=numeric.rep([c],0),S=numeric.rep([c],0),w=Array(c),x=numeric.rep([N],0),V=[],E=[],$=[x,V,E];for(m=0;m!==N;++m){for(f=i[m],h=i[m+1],v=0,d=f;d<h;++d)for(T=o[d],C=s[d],y=n[T],b=n[T+1],p=y;p<b;++p)0===S[g=r[p]]&&(w[v]=g,S[g]=1,v+=1),A[g]=A[g]+a[p]*C;for(h=(f=x[m])+v,x[m+1]=h,d=v-1;-1!==d;--d)C=f+d,p=w[d],V[C]=p,E[C]=A[p],S[p]=0,A[p]=0;x[m+1]=x[m]+v}return $},numeric.ccsLUPSolve=function(e,t){var n=e.L,r=e.U;e.P;var a=t[0],i=!1;"object"!=typeof a&&(a=(t=[[0,t.length],numeric.linspace(0,t.length-1),t])[0],i=!0);var o,s,l,u,c,p,d=t[1],m=t[2],f=n[0].length-1,h=a.length-1,y=numeric.rep([f],0),b=Array(f),g=numeric.rep([f],0),v=Array(f),T=numeric.rep([h+1],0),C=[],N=[],A=numeric.ccsTSolve,S=0;for(o=0;o<h;++o){for(c=0,l=a[o],u=a[o+1],s=l;s<u;++s)p=e.Pinv[d[s]],v[c]=p,g[p]=m[s],++c;for(v.length=c,A(n,g,y,v,b),s=v.length-1;-1!==s;--s)g[v[s]]=0;if(A(r,y,g,b,v),i)return g;for(s=b.length-1;-1!==s;--s)y[b[s]]=0;for(s=v.length-1;-1!==s;--s)p=v[s],C[S]=p,N[S]=g[p],g[p]=0,++S;T[o+1]=S}return[T,C,N]},numeric.ccsbinop=function(e,t){return void 0===t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,n=e[0],r=e[1],a=e[2],i=numeric.sup(r)+1,o=n.length,s=numeric.rep([i],0),l=Array(o),u=Array(o),c=numeric.rep([i],0);for(t=0;t<o;++t)c[r[t]]++;for(t=0;t<i;++t)s[t+1]=s[t]+c[t];var p,d,m=s.slice(0);for(t=0;t<o;++t)l[p=m[d=r[t]]]=n[t],u[p]=a[t],m[d]=m[d]+1;return[s,l,u]},numeric.ccsGather=function(e){var t,n,r,a,i,o=e[0],s=e[1],l=e[2],u=o.length-1,c=s.length,p=Array(c),d=Array(c),m=Array(c);for(i=0,t=0;t<u;++t)for(r=o[t],a=o[t+1],n=r;n!==a;++n)d[i]=t,p[i]=s[n],m[i]=l[n],++i;return[p,d,m]},numeric.sdim=function e(t,n,r){if(void 0===n&&(n=[]),"object"!=typeof t)return n;var a;for(a in void 0===r&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length),t)t.hasOwnProperty(a)&&e(t[a],n,r+1);return n},numeric.sclone=function e(t,n,r){void 0===n&&(n=0),void 0===r&&(r=numeric.sdim(t).length);var a,i=Array(t.length);if(n===r-1){for(a in t)t.hasOwnProperty(a)&&(i[a]=t[a]);return i}for(a in t)t.hasOwnProperty(a)&&(i[a]=e(t[a],n+1,r));return i},numeric.sdiag=function(e){var t,n,r=e.length,a=Array(r);for(t=r-1;t>=1;t-=2)n=t-1,a[t]=[],a[t][t]=e[t],a[n]=[],a[n][n]=e[n];return 0===t&&(a[0]=[],a[0][0]=e[t]),a},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,n,r,a=[];for(t in e.length,e)if(e.hasOwnProperty(t))for(n in r=e[t])r.hasOwnProperty(n)&&("object"!=typeof a[n]&&(a[n]=[]),a[n][t]=r[n]);return a},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var n=e.length;t.length;var r,a,i,o,s,l,u,c=numeric.stranspose(t),p=c.length,d=Array(n);for(i=n-1;i>=0;i--){for(u=[],r=e[i],s=p-1;s>=0;s--){for(o in l=0,a=c[s],r)r.hasOwnProperty(o)&&o in a&&(l+=r[o]*a[o]);l&&(u[s]=l)}d[i]=u}return d},numeric.sdotMV=function(e,t){var n,r,a,i,o=e.length,s=Array(o);for(r=o-1;r>=0;r--){for(a in i=0,n=e[r])n.hasOwnProperty(a)&&t[a]&&(i+=n[a]*t[a]);i&&(s[r]=i)}return s},numeric.sdotVM=function(e,t){var n,r,a,i,o=[];for(n in e)if(e.hasOwnProperty(n))for(r in a=t[n],i=e[n],a)a.hasOwnProperty(r)&&(o[r]||(o[r]=0),o[r]+=i*a[r]);return o},numeric.sdotVV=function(e,t){var n,r=0;for(n in e)e[n]&&t[n]&&(r+=e[n]*t[n]);return r},numeric.sdot=function(e,t){var n=numeric.sdim(e).length,r=numeric.sdim(t).length;switch(1e3*n+r){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+r)}},numeric.sscatter=function(e){var t,n,r,a,i=e[0].length,o=e.length,s=[];for(n=i-1;n>=0;--n)if(e[o-1][n]){for(a=s,r=0;r<o-2;r++)a[t=e[r][n]]||(a[t]=[]),a=a[t];a[e[r][n]]=e[r+1][n]}return s},numeric.sgather=function e(t,n,r){var a,i,o;for(i in void 0===n&&(n=[]),void 0===r&&(r=[]),a=r.length,t)if(t.hasOwnProperty(i))if(r[a]=parseInt(i),"number"==typeof(o=t[i])){if(o){if(0===n.length)for(i=a+1;i>=0;--i)n[i]=[];for(i=a;i>=0;--i)n[i].push(r[i]);n[a+1].push(o)}}else e(o,n,r);return r.length>a&&r.pop(),n},numeric.cLU=function(e){var t,n,r,a,i,o,s=e[0],l=e[1],u=e[2],c=s.length,p=0;for(t=0;t<c;t++)s[t]>p&&(p=s[t]);p++;var d,m=Array(p),f=Array(p),h=numeric.rep([p],1/0),y=numeric.rep([p],-1/0);for(r=0;r<c;r++)t=s[r],(n=l[r])<h[t]&&(h[t]=n),n>y[t]&&(y[t]=n);for(t=0;t<p-1;t++)y[t]>y[t+1]&&(y[t+1]=y[t]);for(t=p-1;t>=1;t--)h[t]<h[t-1]&&(h[t-1]=h[t]);for(t=0;t<p;t++)f[t]=numeric.rep([y[t]-h[t]+1],0),m[t]=numeric.rep([t-h[t]],0),h[t],y[t];for(r=0;r<c;r++)f[t=s[r]][l[r]-h[t]]=u[r];for(t=0;t<p-1;t++)for(a=t-h[t],v=f[t],n=t+1;h[n]<=t&&n<p;n++)if(i=t-h[n],o=y[t]-t,d=(T=f[n])[i]/v[a]){for(r=1;r<=o;r++)T[r+i]-=d*v[r+a];m[n][t-h[n]]=d}var b,g,v=[],T=[],C=[],N=[],A=[],S=[];for(c=0,b=0,t=0;t<p;t++){for(a=h[t],i=y[t],g=f[t],n=t;n<=i;n++)g[n-a]&&(v[c]=t,T[c]=n,C[c]=g[n-a],c++);for(g=m[t],n=a;n<t;n++)g[n-a]&&(N[b]=t,A[b]=n,S[b]=g[n-a],b++);N[b]=t,A[b]=t,S[b]=1,b++}return{U:[v,T,C],L:[N,A,S]}},numeric.cLUsolve=function(e,t){var n=e.L,r=e.U,a=numeric.clone(t),i=n[0],o=n[1],s=n[2],l=r[0],u=r[1],c=r[2],p=l.length;i.length;var d,m,f=a.length;for(m=0,d=0;d<f;d++){for(;o[m]<d;)a[d]-=s[m]*a[o[m]],m++;m++}for(m=p-1,d=f-1;d>=0;d--){for(;u[m]>d;)a[d]-=c[m]*a[u[m]],m--;a[d]/=c[m],m--}return a},numeric.cgrid=function(e,t){"number"==typeof e&&(e=[e,e]);var n,r,a,i=numeric.rep(e,-1);for("function"!=typeof t&&(t="L"===t?function(t,n){return t>=e[0]/2||n<e[1]/2}:function(e,t){return!0}),a=0,n=1;n<e[0]-1;n++)for(r=1;r<e[1]-1;r++)t(n,r)&&(i[n][r]=a,a++);return i},numeric.cdelsq=function(e){var t,n,r,a,i,o=[[-1,0],[0,-1],[0,1],[1,0]],s=numeric.dim(e),l=s[0],u=s[1],c=[],p=[],d=[];for(t=1;t<l-1;t++)for(n=1;n<u-1;n++)if(!(e[t][n]<0)){for(r=0;r<4;r++)a=t+o[r][0],i=n+o[r][1],e[a][i]<0||(c.push(e[t][n]),p.push(e[a][i]),d.push(-1));c.push(e[t][n]),p.push(e[t][n]),d.push(4)}return[c,p,d]},numeric.cdotMV=function(e,t){var n,r,a,i=e[0],o=e[1],s=e[2],l=i.length;for(a=0,r=0;r<l;r++)i[r]>a&&(a=i[r]);for(a++,n=numeric.rep([a],0),r=0;r<l;r++)n[i[r]]+=s[r]*t[o[r]];return n},numeric.Spline=function(e,t,n,r,a){this.x=e,this.yl=t,this.yr=n,this.kl=r,this.kr=a},numeric.Spline.prototype._at=function(e,t){var n,r,a,i=this.x,o=this.yl,s=this.yr,l=this.kl,u=this.kr,c=numeric.add,p=numeric.sub,d=numeric.mul;n=p(d(l[t],i[t+1]-i[t]),p(s[t+1],o[t])),r=c(d(u[t+1],i[t]-i[t+1]),p(s[t+1],o[t]));var m=(a=(e-i[t])/(i[t+1]-i[t]))*(1-a);return c(c(c(d(1-a,o[t]),d(a,s[t+1])),d(n,m*(1-a))),d(r,m*a))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var t,n,r,a=this.x,i=a.length,o=Math.floor;for(t=0,n=i-1;n-t>1;)a[r=o((t+n)/2)]<=e?t=r:n=r;return this._at(e,t)}i=e.length;var s,l=Array(i);for(s=i-1;-1!==s;--s)l[s]=this.at(e[s]);return l},numeric.Spline.prototype.diff=function(){var e,t,n,r=this.x,a=this.yl,i=this.yr,o=this.kl,s=this.kr,l=a.length,u=o,c=s,p=Array(l),d=Array(l),m=numeric.add,f=numeric.mul,h=numeric.div,y=numeric.sub;for(e=l-1;-1!==e;--e)t=r[e+1]-r[e],n=y(i[e+1],a[e]),p[e]=h(m(f(n,6),f(o[e],-4*t),f(s[e+1],-2*t)),t*t),d[e+1]=h(m(f(n,-6),f(o[e],2*t),f(s[e+1],4*t)),t*t);return new numeric.Spline(r,u,c,p,d)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],n=this.x,r=this.yl,a=this.yr,i=this.kl,o=this.kr;"number"==typeof r[0]&&(r=[r],a=[a],i=[i],o=[o]);var s,l,u,c,p,d,m,f,h,y,b,g,v,T,C,N,A,S,w,x,V,E,$,_=r.length,O=n.length-1,I=(t=Array(_),Math.sqrt);for(s=0;s!==_;++s){for(c=r[s],p=a[s],d=i[s],m=o[s],f=[],l=0;l!==O;l++){for(l>0&&p[l]*c[l]<0&&f.push(n[l]),N=n[l+1]-n[l],b=c[l],g=p[l+1],h=d[l]/N,v=(y=m[l+1]/N)+3*b+2*h-3*g,T=3*(y+h+2*(b-g)),(C=e(h-y+3*(b-g))+12*y*b)<=0?A=(S=v/T)>n[l]&&S<n[l+1]?[n[l],S,n[l+1]]:[n[l],n[l+1]]:(S=(v-I(C))/T,w=(v+I(C))/T,A=[n[l]],S>n[l]&&S<n[l+1]&&A.push(S),w>n[l]&&w<n[l+1]&&A.push(w),A.push(n[l+1])),V=A[0],S=this._at(V,l),u=0;u<A.length-1;u++)if(E=A[u+1],w=this._at(E,l),0!==S)if(0===w||S*w>0)V=E,S=w;else{for(var D=0;!(($=(S*E-w*V)/(S-w))<=V||$>=E);)if((x=this._at($,l))*w>0)E=$,w=x,-1===D&&(S*=.5),D=-1;else{if(!(x*S>0))break;V=$,S=x,1===D&&(w*=.5),D=1}f.push($),V=A[u+1],S=this._at(V,l)}else f.push(V),V=E,S=w;0===w&&f.push(E)}t[s]=f}return"number"==typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,n,r){var a,i=e.length,o=[],s=[],l=[],u=numeric.sub,c=numeric.mul,p=numeric.add;for(a=i-2;a>=0;a--)s[a]=e[a+1]-e[a],l[a]=u(t[a+1],t[a]);"string"!=typeof n&&"string"!=typeof r||(n=r="periodic");var d=[[],[],[]];switch(typeof n){case"undefined":o[0]=c(3/(s[0]*s[0]),l[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/s[0],1/s[0]);break;case"string":o[0]=p(c(3/(s[i-2]*s[i-2]),l[i-2]),c(3/(s[0]*s[0]),l[0])),d[0].push(0,0,0),d[1].push(i-2,0,1),d[2].push(1/s[i-2],2/s[i-2]+2/s[0],1/s[0]);break;default:o[0]=n,d[0].push(0),d[1].push(0),d[2].push(1)}for(a=1;a<i-1;a++)o[a]=p(c(3/(s[a-1]*s[a-1]),l[a-1]),c(3/(s[a]*s[a]),l[a])),d[0].push(a,a,a),d[1].push(a-1,a,a+1),d[2].push(1/s[a-1],2/s[a-1]+2/s[a],1/s[a]);switch(typeof r){case"undefined":o[i-1]=c(3/(s[i-2]*s[i-2]),l[i-2]),d[0].push(i-1,i-1),d[1].push(i-2,i-1),d[2].push(1/s[i-2],2/s[i-2]);break;case"string":d[1][d[1].length-1]=0;break;default:o[i-1]=r,d[0].push(i-1),d[1].push(i-1),d[2].push(1)}o="number"!=typeof o[0]?numeric.transpose(o):[o];var m=Array(o.length);if("string"==typeof n)for(a=m.length-1;-1!==a;--a)m[a]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(d)),o[a]),m[a][i-1]=m[a][0];else for(a=m.length-1;-1!==a;--a)m[a]=numeric.cLUsolve(numeric.cLU(d),o[a]);return m="number"==typeof t[0]?m[0]:numeric.transpose(m),new numeric.Spline(e,t,t,m,m)},numeric.fftpow2=function e(t,n){var r=t.length;if(1!==r){var a,i,o=Math.cos,s=Math.sin,l=Array(r/2),u=Array(r/2),c=Array(r/2),p=Array(r/2);for(i=r/2,a=r-1;-1!==a;--a)c[--i]=t[a],p[i]=n[a],--a,l[i]=t[a],u[i]=n[a];e(l,u),e(c,p),i=r/2;var d,m,f,h=-6.283185307179586/r;for(a=r-1;-1!==a;--a)-1==--i&&(i=r/2-1),m=o(d=h*a),f=s(d),t[a]=l[i]+m*c[i]-f*p[i],n[a]=u[i]+m*p[i]+f*c[i]}},numeric._ifftpow2=function e(t,n){var r=t.length;if(1!==r){var a,i,o=Math.cos,s=Math.sin,l=Array(r/2),u=Array(r/2),c=Array(r/2),p=Array(r/2);for(i=r/2,a=r-1;-1!==a;--a)c[--i]=t[a],p[i]=n[a],--a,l[i]=t[a],u[i]=n[a];e(l,u),e(c,p),i=r/2;var d,m,f,h=6.283185307179586/r;for(a=r-1;-1!==a;--a)-1==--i&&(i=r/2-1),m=o(d=h*a),f=s(d),t[a]=l[i]+m*c[i]-f*p[i],n[a]=u[i]+m*p[i]+f*c[i]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,n,r){var a,i,o,s,l;for(numeric.fftpow2(e,t),numeric.fftpow2(n,r),a=e.length-1;-1!==a;--a)i=e[a],s=t[a],o=n[a],l=r[a],e[a]=i*o-s*l,t[a]=i*l+s*o;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,n=this.x,r=this.y,a=n.length,i=Math.log,o=i(2),s=Math.ceil(i(2*a-1)/o),l=Math.pow(2,s),u=numeric.rep([l],0),c=numeric.rep([l],0),p=Math.cos,d=Math.sin,m=-3.141592653589793/a,f=numeric.rep([l],0),h=numeric.rep([l],0);for(e=0;e<a;e++)f[e]=n[e];if(void 0!==r)for(e=0;e<a;e++)h[e]=r[e];for(u[0]=1,e=1;e<=l/2;e++)t=m*e*e,u[e]=p(t),c[e]=d(t),u[l-e]=p(t),c[l-e]=d(t);var y=new numeric.T(f,h),b=new numeric.T(u,c);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),(y=y.mul(b)).x.length=a,y.y.length=a,y},numeric.T.prototype.ifft=function(){var e,t,n=this.x,r=this.y,a=n.length,i=Math.log,o=i(2),s=Math.ceil(i(2*a-1)/o),l=Math.pow(2,s),u=numeric.rep([l],0),c=numeric.rep([l],0),p=Math.cos,d=Math.sin,m=3.141592653589793/a,f=numeric.rep([l],0),h=numeric.rep([l],0);for(e=0;e<a;e++)f[e]=n[e];if(void 0!==r)for(e=0;e<a;e++)h[e]=r[e];for(u[0]=1,e=1;e<=l/2;e++)t=m*e*e,u[e]=p(t),c[e]=d(t),u[l-e]=p(t),c[l-e]=d(t);var y=new numeric.T(f,h),b=new numeric.T(u,c);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),(y=y.mul(b)).x.length=a,y.y.length=a,y.div(a)},numeric.gradient=function(e,t){var n=t.length,r=e(t);if(isNaN(r))throw new Error("gradient: f(x) is a NaN!");var a,i,o,s=Math.max,l=numeric.clone(t),u=Array(n);numeric.div,numeric.sub,s=Math.max;var c,p,d,m,f,h,y=Math.abs,b=Math.min,g=0;for(a=0;a<n;a++)for(var v=s(1e-6*r,1e-8);;){if(++g>20)throw new Error("Numerical gradient fails");if(l[a]=t[a]+v,i=e(l),l[a]=t[a]-v,o=e(l),l[a]=t[a],isNaN(i)||isNaN(o))v/=16;else{if(u[a]=(i-o)/(2*v),c=t[a]-v,p=t[a],d=t[a]+v,m=(i-r)/v,f=(r-o)/v,h=s(y(u[a]),y(r),y(i),y(o),y(c),y(p),y(d),1e-8),!(b(s(y(m-u[a]),y(f-u[a]),y(m-f))/h,v/h)>.001))break;v/=16}}return u},numeric.uncmin=function(e,t,n,r,a,i,o){var s=numeric.gradient;void 0===o&&(o={}),void 0===n&&(n=1e-8),void 0===r&&(r=function(t){return s(e,t)}),void 0===a&&(a=1e3);var l,u,c=(t=numeric.clone(t)).length,p=e(t);if(isNaN(p))throw new Error("uncmin: f(x0) is a NaN!");var d=Math.max,m=numeric.norm2;n=d(n,numeric.epsilon);var f,h,y,b=o.Hinv||numeric.identity(c),g=numeric.dot;numeric.inv;var v,T,C,N,A,S,w,x=numeric.sub,V=numeric.add,E=numeric.tensor,$=numeric.div,_=numeric.mul,O=numeric.all,I=numeric.isFinite,D=numeric.neg,R=0,P="";for(h=r(t);R<a;){if("function"==typeof i&&i(R,t,p,h,b)){P="Callback returned true";break}if(!O(I(h))){P="Gradient has Infinity or NaN";break}if(!O(I(f=D(g(b,h))))){P="Search direction has Infinity or NaN";break}if((w=m(f))<n){P="Newton step smaller than tol";break}for(S=1,u=g(h,f),T=t;R<a&&!(S*w<n)&&(T=V(t,v=_(f,S)),(l=e(T))-p>=.1*S*u||isNaN(l));)S*=.5,++R;if(S*w<n){P="Line search step size smaller than tol";break}if(R===a){P="maxit reached during line search";break}A=g(C=x(y=r(T),h),v),N=g(b,C),b=x(V(b,_((A+g(C,N))/(A*A),E(v,v))),$(V(E(N,v),E(v,N)),A)),t=T,p=l,h=y,++R}return{solution:t,f:p,gradient:h,invHessian:b,iterations:R,message:P}},numeric.Dopri=function(e,t,n,r,a,i,o){this.x=e,this.y=t,this.f=n,this.ymid=r,this.iterations=a,this.events=o,this.message=i},numeric.Dopri.prototype._at=function(e,t){function n(e){return e*e}var r,a,i,o,s,l,u=this,c=u.x,p=u.y,d=u.f,m=u.ymid;c.length;var f,h,y,b=numeric.add,g=numeric.mul,v=numeric.sub;return r=c[t],a=c[t+1],o=p[t],s=p[t+1],i=r+.5*(a-r),l=m[t],f=v(d[t],g(o,1/(r-i)+2/(r-a))),h=v(d[t+1],g(s,1/(a-i)+2/(a-r))),b(b(b(b(g(o,(y=[n(e-a)*(e-i)/n(r-a)/(r-i),n(e-r)*n(e-a)/n(r-i)/n(a-i),n(e-r)*(e-i)/n(a-r)/(a-i),(e-r)*n(e-a)*(e-i)/n(r-a)/(r-i),(e-a)*n(e-r)*(e-i)/n(r-a)/(a-i)])[0]),g(l,y[1])),g(s,y[2])),g(f,y[3])),g(h,y[4]))},numeric.Dopri.prototype.at=function(e){var t,n,r,a=Math.floor;if("number"!=typeof e){var i=e.length,o=Array(i);for(t=i-1;-1!==t;--t)o[t]=this.at(e[t]);return o}var s=this.x;for(t=0,n=s.length-1;n-t>1;)s[r=a(.5*(t+n))]<=e?t=r:n=r;return this._at(e,t)},numeric.dopri=function(e,t,n,r,a,i,o){void 0===a&&(a=1e-6),void 0===i&&(i=1e3);var s,l,u,c,p,d,m,f,h,y,b,g,v,T=[e],C=[n],N=[r(e,n)],A=[],S=[3/40,9/40],w=[44/45,-56/15,32/9],x=[19372/6561,-25360/2187,64448/6561,-212/729],V=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],E=[35/384,0,500/1113,125/192,-2187/6784,11/84],$=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],_=[.2,.3,.8,8/9,1,1],O=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],I=0,D=(t-e)/10,R=0,P=numeric.add,k=numeric.mul,M=Math.min,F=Math.abs,B=numeric.norminf,L=Math.pow,j=numeric.any,U=numeric.lt,z=numeric.and;numeric.sub;var H=new numeric.Dopri(T,C,N,A,-1,"");for("function"==typeof o&&(b=o(e,n));e<t&&R<i;)if(++R,e+D>t&&(D=t-e),s=r(e+_[0]*D,P(n,k(.2*D,N[I]))),l=r(e+_[1]*D,P(P(n,k(S[0]*D,N[I])),k(S[1]*D,s))),u=r(e+_[2]*D,P(P(P(n,k(w[0]*D,N[I])),k(w[1]*D,s)),k(w[2]*D,l))),c=r(e+_[3]*D,P(P(P(P(n,k(x[0]*D,N[I])),k(x[1]*D,s)),k(x[2]*D,l)),k(x[3]*D,u))),p=r(e+_[4]*D,P(P(P(P(P(n,k(V[0]*D,N[I])),k(V[1]*D,s)),k(V[2]*D,l)),k(V[3]*D,u)),k(V[4]*D,c))),d=r(e+D,h=P(P(P(P(P(n,k(N[I],D*E[0])),k(l,D*E[2])),k(u,D*E[3])),k(c,D*E[4])),k(p,D*E[5]))),(y="number"==typeof(m=P(P(P(P(P(k(N[I],D*O[0]),k(l,D*O[2])),k(u,D*O[3])),k(c,D*O[4])),k(p,D*O[5])),k(d,D*O[6])))?F(m):B(m))>a){if(e+(D=.2*D*L(a/y,.25))===e){H.msg="Step size became too small";break}}else{if(A[I]=P(P(P(P(P(P(n,k(N[I],D*$[0])),k(l,D*$[2])),k(u,D*$[3])),k(c,D*$[4])),k(p,D*$[5])),k(d,D*$[6])),T[++I]=e+D,C[I]=h,N[I]=d,"function"==typeof o){var G,W,q=e,K=e+.5*D;if(g=o(K,A[I-1]),j(v=z(U(b,0),U(0,g)))||(q=K,b=g,g=o(K=e+D,h),v=z(U(b,0),U(0,g))),j(v)){for(var X,Y,Z=0,J=1,Q=1;;){if("number"==typeof b)W=(Q*g*q-J*b*K)/(Q*g-J*b);else for(W=K,f=b.length-1;-1!==f;--f)b[f]<0&&g[f]>0&&(W=M(W,(Q*g[f]*q-J*b[f]*K)/(Q*g[f]-J*b[f])));if(W<=q||W>=K)break;Y=o(W,G=H._at(W,I-1)),j(X=z(U(b,0),U(0,Y)))?(K=W,g=Y,v=X,Q=1,-1===Z?J*=.5:J=1,Z=-1):(q=W,b=Y,J=1,1===Z?Q*=.5:Q=1,Z=1)}return h=H._at(.5*(e+W),I-1),H.f[I]=r(W,G),H.x[I]=W,H.y[I]=G,H.ymid[I-1]=h,H.events=v,H.iterations=R,H}}e+=D,n=h,b=g,D=M(.8*D*L(a/y,.25),4*D)}return H.iterations=R,H},numeric.LU=function(e,t){t=t||!1;var n,r,a,i,o,s,l,u,c,p=Math.abs,d=e.length,m=d-1,f=new Array(d);for(t||(e=numeric.clone(e)),a=0;a<d;++a){for(l=a,c=p((s=e[a])[a]),r=a+1;r<d;++r)c<(i=p(e[r][a]))&&(c=i,l=r);for(f[a]=l,l!=a&&(e[a]=e[l],e[l]=s,s=e[a]),o=s[a],n=a+1;n<d;++n)e[n][a]/=o;for(n=a+1;n<d;++n){for(u=e[n],r=a+1;r<m;++r)u[r]-=u[a]*s[r],u[++r]-=u[a]*s[r];r===m&&(u[r]-=u[a]*s[r])}}return{LU:e,P:f}},numeric.LUsolve=function(e,t){var n,r,a,i,o,s=e.LU,l=s.length,u=numeric.clone(t),c=e.P;for(n=l-1;-1!==n;--n)u[n]=t[n];for(n=0;n<l;++n)for(a=c[n],c[n]!==n&&(o=u[n],u[n]=u[a],u[a]=o),i=s[n],r=0;r<n;++r)u[n]-=u[r]*i[r];for(n=l-1;n>=0;--n){for(i=s[n],r=n+1;r<l;++r)u[n]-=u[r]*i[r];u[n]/=i[n]}return u},numeric.solve=function(e,t,n){return numeric.LUsolve(numeric.LU(e,n),t)},numeric.echelonize=function(e){var t,n,r,a,i,o,s,l,u=numeric.dim(e),c=u[0],p=u[1],d=numeric.identity(c),m=Array(c),f=Math.abs,h=numeric.diveq;for(e=numeric.clone(e),t=0;t<c;++t){for(r=0,i=e[t],o=d[t],n=1;n<p;++n)f(i[r])<f(i[n])&&(r=n);for(m[t]=r,h(o,i[r]),h(i,i[r]),n=0;n<c;++n)if(n!==t){for(l=(s=e[n])[r],a=p-1;-1!==a;--a)s[a]-=i[a]*l;for(s=d[n],a=c-1;-1!==a;--a)s[a]-=o[a]*l}}return{I:d,A:e,P:m}},numeric.__solveLP=function(e,t,n,r,a,i,o){var s=numeric.sum;numeric.log;var l,u=numeric.mul,c=numeric.sub,p=numeric.dot,d=numeric.div,m=numeric.add,f=e.length,h=n.length,y=!1,b=1;numeric.transpose(t),numeric.svd;var g=numeric.transpose;numeric.leq;var v=Math.sqrt,T=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var C,N=Math.min,A=numeric.all,S=numeric.gt,w=Array(f),x=Array(h);numeric.rep([h],1);var V,E,$=numeric.solve,_=c(n,p(t,i)),O=p(e,e);for(V=0;V<a;++V){var I,D;for(I=h-1;-1!==I;--I)x[I]=d(t[I],_[I]);var R=g(x);for(I=f-1;-1!==I;--I)w[I]=s(R[I]);b=.25*T(O/p(e,w));var P=100*v(O/p(w,w));for((!isFinite(b)||b>P)&&(b=P),E=m(e,u(b,w)),C=p(R,x),I=f-1;-1!==I;--I)C[I][I]+=1;D=$(C,d(E,b),!0);var k=d(_,p(t,D)),M=1;for(I=h-1;-1!==I;--I)k[I]<0&&(M=N(M,-.999*k[I]));if(l=c(i,u(D,M)),!A(S(_=c(n,p(t,l)),0)))return{solution:i,message:"",iterations:V};if(i=l,b<r)return{solution:l,message:"",iterations:V};if(o){var F=p(e,E),B=p(t,E);for(y=!0,I=h-1;-1!==I;--I)if(F*B[I]<0){y=!1;break}}else y=!(i[f-1]>=0);if(y)return{solution:l,message:"Unbounded",iterations:V}}return{solution:i,message:"maximum iteration count exceeded",iterations:V}},numeric._solveLP=function(e,t,n,r,a){var i=e.length,o=n.length;numeric.sum,numeric.log,numeric.mul;var s=numeric.sub,l=numeric.dot;numeric.div,numeric.add;var u=numeric.rep([i],0).concat([1]),c=numeric.rep([o,1],-1),p=numeric.blockMatrix([[t,c]]),d=n,m=numeric.rep([i],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),f=numeric.__solveLP(u,p,d,r,a,m,!1),h=numeric.clone(f.solution);if(h.length=i,numeric.inf(s(n,l(t,h)))<0)return{solution:NaN,message:"Infeasible",iterations:f.iterations};var y=numeric.__solveLP(e,t,n,r,a-f.iterations,h,!0);return y.iterations+=f.iterations,y},numeric.solveLP=function(e,t,n,r,a,i,o){if(void 0===o&&(o=1e3),void 0===i&&(i=numeric.epsilon),void 0===r)return numeric._solveLP(e,t,n,i,o);var s,l=r.length,u=r[0].length,c=t.length,p=numeric.echelonize(r),d=numeric.rep([u],0),m=p.P,f=[];for(s=m.length-1;-1!==s;--s)d[m[s]]=1;for(s=u-1;-1!==s;--s)0===d[s]&&f.push(s);var h=numeric.getRange,y=numeric.linspace(0,l-1),b=numeric.linspace(0,c-1),g=h(r,y,f),v=h(t,b,m),T=h(t,b,f),C=numeric.dot,N=numeric.sub,A=C(v,p.I),S=N(T,C(A,g)),w=N(n,C(A,a)),x=Array(m.length),V=Array(f.length);for(s=m.length-1;-1!==s;--s)x[s]=e[m[s]];for(s=f.length-1;-1!==s;--s)V[s]=e[f[s]];var E=N(V,C(x,C(p.I,g))),$=numeric._solveLP(E,S,w,i,o),_=$.solution;if(_!=_)return $;var O=C(p.I,N(a,C(g,_))),I=Array(e.length);for(s=m.length-1;-1!==s;--s)I[m[s]]=O[s];for(s=f.length-1;-1!==s;--s)I[f[s]]=_[s];return{solution:I,message:$.message,iterations:$.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,n,r,a,i=0,o=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],s=e.length,l=0,u={},c=[],p=0,d={},m=0,f=[],h=[],y=[];function b(n){throw new Error("MPStoLP: "+n+"\nLine "+t+": "+e[t]+"\nCurrent state: "+o[i]+"\n")}for(t=0;t<s;++t){var g=(r=e[t]).match(/\S*/g),v=[];for(n=0;n<g.length;++n)""!==g[n]&&v.push(g[n]);if(0!==v.length){for(n=0;n<o.length&&r.substr(0,o[n].length)!==o[n];++n);if(n<o.length){if(i=n,1===n&&(a=v[1]),6===n)return{name:a,c:f,A:numeric.transpose(h),b:y,rows:u,vars:d}}else switch(i){case 0:case 1:b("Unexpected line");case 2:switch(v[0]){case"N":0===l?l=v[1]:b("Two or more N rows");break;case"L":u[v[1]]=p,c[p]=1,y[p]=0,++p;break;case"G":u[v[1]]=p,c[p]=-1,y[p]=0,++p;break;case"E":u[v[1]]=p,c[p]=0,y[p]=0,++p;break;default:b("Parse error "+numeric.prettyPrint(v))}break;case 3:d.hasOwnProperty(v[0])||(d[v[0]]=m,f[m]=0,h[m]=numeric.rep([p],0),++m);var T=d[v[0]];for(n=1;n<v.length;n+=2)if(v[n]!==l){var C=u[v[n]];h[T][C]=(c[C]<0?-1:1)*parseFloat(v[n+1])}else f[T]=parseFloat(v[n+1]);break;case 4:for(n=1;n<v.length;n+=2)y[u[v[n]]]=(c[u[v[n]]]<0?-1:1)*parseFloat(v[n+1]);break;case 5:break;case 6:b("Internal error")}}}b("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,a,i,o){function s(e){var t,r,a=this,i=e.length,o=0,s=a.i=a.j=a.m=0;for(a.S=[],a.c=[],i||(e=[i++]);o<n;)a.S[o]=o++;for(o=0;o<n;o++)s=c(s+(t=a.S[o])+e[o%i]),r=a.S[s],a.S[o]=r,a.S[s]=t;a.g=function(e){var t=a.S,r=c(a.i+1),i=t[r],o=c(a.j+i),s=t[o];t[r]=s,t[o]=i;for(var l=t[c(i+s)];--e;)r=c(r+1),s=t[o=c(o+(i=t[r]))],t[r]=s,t[o]=i,l=l*n+t[c(i+s)];return a.i=r,a.j=o,l},a.g(n)}function l(e,t,n,r,a){if(n=[],a=typeof e,t&&"object"==a)for(r in e)if(r.indexOf("S")<5)try{n.push(l(e[r],t-1))}catch(e){}return n.length?n:e+("string"!=a?"\0":"")}function u(e,t,n,r){for(e+="",n=0,r=0;r<e.length;r++)t[c(r)]=c((n^=19*t[c(r)])+e.charCodeAt(r));for(r in e="",t)e+=String.fromCharCode(t[r]);return e}function c(e){return 255&e}t.seedrandom=function(r,c){var p,d=[];return r=u(l(c?[r,e]:arguments.length?r:[(new Date).getTime(),e,window],3),d),u((p=new s(d)).S,e),t.random=function(){for(var e=p.g(6),t=o,r=0;e<a;)e=(e+r)*n,t*=n,r=p.g(1);for(;e>=i;)e/=2,t/=2,r>>>=1;return(e+r)/t},r},o=t.pow(n,6),a=t.pow(2,a),i=2*a,u(t.random(),e)}([],numeric.seedrandom,256,0,52),function(e){function t(e){if("object"!=typeof e)return e;var n,r=[],a=e.length;for(n=0;n<a;n++)r[n+1]=t(e[n]);return r}function n(e){if("object"!=typeof e)return e;var t,r=[],a=e.length;for(t=1;t<a;t++)r[t-1]=n(e[t]);return r}e.solveQP=function(e,r,a,i,o,s){e=t(e),r=t(r),a=t(a);var l,u,c,p,d,m=[],f=[],h=[],y=[],b=[];if(o=o||0,s=s?t(s):[void 0,0],i=i?t(i):[],u=e.length-1,c=a[1].length-1,!i)for(l=1;l<=c;l+=1)i[l]=0;for(l=1;l<=c;l+=1)f[l]=0;for(p=Math.min(u,c),l=1;l<=u;l+=1)h[l]=0;for(m[1]=0,l=1;l<=2*u+p*(p+5)/2+2*c+1;l+=1)y[l]=0;for(l=1;l<=2;l+=1)b[l]=0;return function(e,t,n,r,a,i,o,s,l,u,c,p,d,m,f,h){var y,b,g,v,T,C,N,A,S,w,x,V,E,$,_,O,I,D,R,P,k,M,F,B,L,j,U;E=Math.min(r,u),g=2*r+E*(E+5)/2+2*u+1,B=1e-60;do{L=1+.1*(B+=B),j=1+.2*B}while(L<=1||j<=1);for(y=1;y<=r;y+=1)f[y]=t[y];for(y=r+1;y<=g;y+=1)f[y]=0;for(y=1;y<=u;y+=1)p[y]=0;if(T=[],0===h[1]){if(function(e,t,n,r){var a,i,o,s,l,u;for(i=1;i<=n;i+=1){if(r[1]=i,u=0,(o=i-1)<1){if((u=e[i][i]-u)<=0)break;e[i][i]=Math.sqrt(u)}else{for(s=1;s<=o;s+=1){for(l=e[s][i],a=1;a<s;a+=1)l-=e[a][i]*e[a][s];l/=e[s][s],e[s][i]=l,u+=l*l}if((u=e[i][i]-u)<=0)break;e[i][i]=Math.sqrt(u)}r[1]=0}}(e,0,r,T),0!==T[1])return void(h[1]=2);!function(e,t,n,r){var a,i,o,s;for(i=1;i<=n;i+=1){for(s=0,a=1;a<i;a+=1)s+=e[a][i]*r[a];r[i]=(r[i]-s)/e[i][i]}for(o=1;o<=n;o+=1)for(r[i=n+1-o]=r[i]/e[i][i],s=-r[i],a=1;a<i;a+=1)r[a]=r[a]+s*e[a][i]}(e,0,r,t),function(e,t,n){var r,a,i,o,s;for(i=1;i<=n;i+=1){for(e[i][i]=1/e[i][i],s=-e[i][i],r=1;r<i;r+=1)e[r][i]=s*e[r][i];if(n<(o=i+1))break;for(a=o;a<=n;a+=1)for(s=e[i][a],e[i][a]=0,r=1;r<=i;r+=1)e[r][a]=e[r][a]+s*e[r][i]}}(e,0,r)}else{for(b=1;b<=r;b+=1)for(a[b]=0,y=1;y<=b;y+=1)a[b]=a[b]+e[y][b]*t[y];for(b=1;b<=r;b+=1)for(t[b]=0,y=b;y<=r;y+=1)t[b]=t[b]+e[b][y]*a[y]}for(i[1]=0,b=1;b<=r;b+=1)for(a[b]=t[b],i[1]=i[1]+f[b]*a[b],f[b]=0,y=b+1;y<=r;y+=1)e[y][b]=0;for(i[1]=-i[1]/2,h[1]=0,$=(w=(S=(x=(A=(N=r)+r)+E)+E+1)+E*(E+1)/2)+u,y=1;y<=u;y+=1){for(O=0,b=1;b<=r;b+=1)O+=o[b][y]*o[b][y];f[$+y]=Math.sqrt(O)}function z(){for(m[1]=m[1]+1,g=w,y=1;y<=u;y+=1){for(g+=1,O=-s[y],b=1;b<=r;b+=1)O+=o[b][y]*a[b];if(Math.abs(O)<B&&(O=0),y>c)f[g]=O;else if(f[g]=-Math.abs(O),O>0){for(b=1;b<=r;b+=1)o[b][y]=-o[b][y];s[y]=-s[y]}}for(y=1;y<=d;y+=1)f[w+p[y]]=0;for(V=0,_=0,y=1;y<=u;y+=1)f[w+y]<_*f[$+y]&&(V=y,_=f[w+y]/f[$+y]);return 0===V?999:0}function H(){for(y=1;y<=r;y+=1){for(O=0,b=1;b<=r;b+=1)O+=e[b][y]*o[b][V];f[y]=O}for(v=N,y=1;y<=r;y+=1)f[v+y]=0;for(b=d+1;b<=r;b+=1)for(y=1;y<=r;y+=1)f[v+y]=f[v+y]+e[y][b]*f[b];for(M=!0,y=d;y>=1;y-=1){for(O=f[y],v=(g=S+y*(y+3)/2)-y,b=y+1;b<=d;b+=1)O-=f[g]*f[A+b],g+=b;if(O/=f[v],f[A+y]=O,p[y]<c)break;if(O<0)break;M=!1,C=y}if(!M)for(I=f[x+C]/f[A+C],y=1;y<=d&&!(p[y]<c)&&!(f[A+y]<0);y+=1)(_=f[x+y]/f[A+y])<I&&(I=_,C=y);for(O=0,y=N+1;y<=N+r;y+=1)O+=f[y]*f[y];if(Math.abs(O)<=B){if(M)return h[1]=1,999;for(y=1;y<=d;y+=1)f[x+y]=f[x+y]-I*f[A+y];return f[x+d+1]=f[x+d+1]+I,700}for(O=0,y=1;y<=r;y+=1)O+=f[N+y]*o[y][V];for(D=-f[w+V]/O,F=!0,M||I<D&&(D=I,F=!1),y=1;y<=r;y+=1)a[y]=a[y]+D*f[N+y],Math.abs(a[y])<B&&(a[y]=0);for(i[1]=i[1]+D*O*(D/2+f[x+d+1]),y=1;y<=d;y+=1)f[x+y]=f[x+y]-D*f[A+y];if(f[x+d+1]=f[x+d+1]+D,!F){for(O=-s[V],b=1;b<=r;b+=1)O+=a[b]*o[b][V];if(V>c)f[w+V]=O;else if(f[w+V]=-Math.abs(O),O>0){for(b=1;b<=r;b+=1)o[b][V]=-o[b][V];s[V]=-s[V]}return 700}for(p[d+=1]=V,g=S+(d-1)*d/2+1,y=1;y<=d-1;y+=1)f[g]=f[y],g+=1;if(d===r)f[g]=f[r];else{for(y=r;y>=d+1&&0!==f[y]&&(R=Math.max(Math.abs(f[y-1]),Math.abs(f[y])),P=Math.min(Math.abs(f[y-1]),Math.abs(f[y])),_=f[y-1]>=0?Math.abs(R*Math.sqrt(1+P*P/(R*R))):-Math.abs(R*Math.sqrt(1+P*P/(R*R))),R=f[y-1]/_,P=f[y]/_,1!==R);y-=1)if(0===R)for(f[y-1]=P*_,b=1;b<=r;b+=1)_=e[b][y-1],e[b][y-1]=e[b][y],e[b][y]=_;else for(f[y-1]=_,k=P/(1+R),b=1;b<=r;b+=1)_=R*e[b][y-1]+P*e[b][y],e[b][y]=k*(e[b][y-1]+_)-e[b][y],e[b][y-1]=_;f[g]=f[d]}return 0}function G(){if(0===f[v=(g=S+C*(C+1)/2+1)+C])return 798;if(R=Math.max(Math.abs(f[v-1]),Math.abs(f[v])),P=Math.min(Math.abs(f[v-1]),Math.abs(f[v])),_=f[v-1]>=0?Math.abs(R*Math.sqrt(1+P*P/(R*R))):-Math.abs(R*Math.sqrt(1+P*P/(R*R))),R=f[v-1]/_,P=f[v]/_,1===R)return 798;if(0===R){for(y=C+1;y<=d;y+=1)_=f[v-1],f[v-1]=f[v],f[v]=_,v+=y;for(y=1;y<=r;y+=1)_=e[y][C],e[y][C]=e[y][C+1],e[y][C+1]=_}else{for(k=P/(1+R),y=C+1;y<=d;y+=1)_=R*f[v-1]+P*f[v],f[v]=k*(f[v-1]+_)-f[v],f[v-1]=_,v+=y;for(y=1;y<=r;y+=1)_=R*e[y][C]+P*e[y][C+1],e[y][C+1]=k*(e[y][C]+_)-e[y][C+1],e[y][C]=_}return 0}function W(){for(v=g-C,y=1;y<=C;y+=1)f[v]=f[g],g+=1,v+=1;return f[x+C]=f[x+C+1],p[C]=p[C+1],(C+=1)<d?797:0}function q(){return f[x+d]=f[x+d+1],f[x+d+1]=0,p[d]=0,d-=1,m[2]=m[2]+1,0}for(d=0,m[1]=0,m[2]=0,U=0;;){if(999===(U=z()))return;for(;0!==(U=H());){if(999===U)return;if(700===U)if(C===d)q();else{for(;G(),797===(U=W()););q()}}}}(e,r,0,u,h,m,a,i,0,c,o,f,0,b,y,s),d="",1===s[1]&&(d="constraints are inconsistent, no solution!"),2===s[1]&&(d="matrix D in quadratic function is not positive definite!"),{solution:n(h),value:n(m),unconstrained_solution:n(r),iterations:n(b),iact:n(f),message:d}}}(numeric),numeric.svd=function(e){var t,n=numeric.epsilon,r=1e-64/n,a=0,i=0,o=0,s=0,l=0,u=numeric.clone(e),c=u.length,p=u[0].length;if(c<p)throw"Need more rows than columns";var d=new Array(p),m=new Array(p);for(i=0;i<p;i++)d[i]=m[i]=0;var f=numeric.rep([p,p],0);function h(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var y=0,b=0,g=0,v=0,T=0,C=0,N=0;for(i=0;i<p;i++){for(d[i]=b,N=0,l=i+1,o=i;o<c;o++)N+=u[o][i]*u[o][i];if(N<=r)b=0;else for(y=u[i][i],b=Math.sqrt(N),y>=0&&(b=-b),g=y*b-N,u[i][i]=y-b,o=l;o<p;o++){for(N=0,s=i;s<c;s++)N+=u[s][i]*u[s][o];for(y=N/g,s=i;s<c;s++)u[s][o]+=y*u[s][i]}for(m[i]=b,N=0,o=l;o<p;o++)N+=u[i][o]*u[i][o];if(N<=r)b=0;else{for(y=u[i][i+1],b=Math.sqrt(N),y>=0&&(b=-b),g=y*b-N,u[i][i+1]=y-b,o=l;o<p;o++)d[o]=u[i][o]/g;for(o=l;o<c;o++){for(N=0,s=l;s<p;s++)N+=u[o][s]*u[i][s];for(s=l;s<p;s++)u[o][s]+=N*d[s]}}(T=Math.abs(m[i])+Math.abs(d[i]))>v&&(v=T)}for(i=p-1;-1!=i;i+=-1){if(0!=b){for(g=b*u[i][i+1],o=l;o<p;o++)f[o][i]=u[i][o]/g;for(o=l;o<p;o++){for(N=0,s=l;s<p;s++)N+=u[i][s]*f[s][o];for(s=l;s<p;s++)f[s][o]+=N*f[s][i]}}for(o=l;o<p;o++)f[i][o]=0,f[o][i]=0;f[i][i]=1,b=d[i],l=i}for(i=p-1;-1!=i;i+=-1){for(l=i+1,b=m[i],o=l;o<p;o++)u[i][o]=0;if(0!=b){for(g=u[i][i]*b,o=l;o<p;o++){for(N=0,s=l;s<c;s++)N+=u[s][i]*u[s][o];for(y=N/g,s=i;s<c;s++)u[s][o]+=y*u[s][i]}for(o=i;o<c;o++)u[o][i]=u[o][i]/b}else for(o=i;o<c;o++)u[o][i]=0;u[i][i]+=1}for(n*=v,s=p-1;-1!=s;s+=-1)for(var A=0;A<50;A++){var S=!1;for(l=s;-1!=l;l+=-1){if(Math.abs(d[l])<=n){S=!0;break}if(Math.abs(m[l-1])<=n)break}if(!S){a=0,N=1;var w=l-1;for(i=l;i<s+1&&(y=N*d[i],d[i]=a*d[i],!(Math.abs(y)<=n));i++)for(g=h(y,b=m[i]),m[i]=g,a=b/g,N=-y/g,o=0;o<c;o++)T=u[o][w],C=u[o][i],u[o][w]=T*a+C*N,u[o][i]=-T*N+C*a}if(C=m[s],l==s){if(C<0)for(m[s]=-C,o=0;o<p;o++)f[o][s]=-f[o][s];break}if(A>=49)throw"Error: no convergence.";for(v=m[l],b=h(y=(((T=m[s-1])-C)*(T+C)+((b=d[s-1])-(g=d[s]))*(b+g))/(2*g*T),1),y=y<0?((v-C)*(v+C)+g*(T/(y-b)-g))/v:((v-C)*(v+C)+g*(T/(y+b)-g))/v,a=1,N=1,i=l+1;i<s+1;i++){for(b=d[i],T=m[i],g=N*b,b*=a,C=h(y,g),d[i-1]=C,y=v*(a=y/C)+b*(N=g/C),b=-v*N+b*a,g=T*N,T*=a,o=0;o<p;o++)v=f[o][i-1],C=f[o][i],f[o][i-1]=v*a+C*N,f[o][i]=-v*N+C*a;for(C=h(y,g),m[i-1]=C,y=(a=y/C)*b+(N=g/C)*T,v=-N*b+a*T,o=0;o<c;o++)T=u[o][i-1],C=u[o][i],u[o][i-1]=T*a+C*N,u[o][i]=-T*N+C*a}d[l]=0,d[s]=y,m[s]=v}for(i=0;i<m.length;i++)m[i]<n&&(m[i]=0);for(i=0;i<p;i++)for(o=i-1;o>=0;o--)if(m[o]<m[i]){for(a=m[o],m[o]=m[i],m[i]=a,s=0;s<u.length;s++)t=u[s][i],u[s][i]=u[s][o],u[s][o]=t;for(s=0;s<f.length;s++)t=f[s][i],f[s][i]=f[s][o],f[s][o]=t;i=o}return{U:u,S:m,V:f}}}));function create$2(e){var t=core.create(e);t.create=create$2,t.import(lib$1),t.import(numeric1_2_6,{wrap:!0,silent:!0});var n=t.pow;function r(e,t){return 0!==t||"number"!=typeof e||0!==e&&Number.isFinite(e)?n(e,t):NaN}return Object.defineProperty(t,"pow_strict",{get:()=>t.pow===r,set:function(e){e?t.import({pow:r},{override:!0}):t.import({pow:n},{override:!0})}}),t.pow_strict=!0,Object.defineProperty(t,"define_e",{get:()=>!1!==t.config().define_e,set:function(e){e?t.config({define_e:!0}):t.config({define_e:!1})}}),Object.defineProperty(t,"define_i",{get:()=>!1!==t.config().define_i,set:function(e){e?t.config({define_i:!0}):t.config({define_i:!1})}}),Object.defineProperty(t,"define_pi",{get:()=>!1!==t.config().define_pi,set:function(e){e?t.config({define_pi:!0}):t.config({define_pi:!1})}}),t}var math$3=create$2();function leaves(e,t){if(!Array.isArray(e))return[e];var n=e[0],r=e.slice(1);return!t||"_"!==n||"string"!=typeof r[0]||"string"!=typeof r[1]&&"number"!=typeof r[1]?("apply"===n&&(r=e.slice(2)),0===r.length?[]:r.map((function(e,n){return leaves(e,t)})).reduce((function(e,t){return e.concat(t)}))):[r[0]+"_"+r[1]]}function variables(e,t=!1){var n=leaves(get_tree(e),t);return n=(n=n.filter((function(e,t){return"string"==typeof e&&(math$3.define_e||"e"!==e)&&(math$3.define_pi||"pi"!==e)&&(math$3.define_i||"i"!==e)}))).filter((function(e,t,r){return t===n.indexOf(e)})),n}function operators_list(e){if(!Array.isArray(e))return[];var t=e[0],n=e.slice(1);return"apply"===t&&(n=e.slice(2)),0===n.length?[t]:[t].concat(n.map((function(e,t){return operators_list(e)})).reduce((function(e,t){return e.concat(t)})))}function operators$3(e){var t=operators_list(get_tree(e));return t=(t=t.filter((function(e,t){return"apply"!==e}))).filter((function(e,n,r){return n===t.indexOf(e)})),t}function functions_list(e){if("number"==typeof e)return[];if("string"==typeof e)return[];if("boolean"==typeof e)return[];var t=e[0],n=e.slice(1),r=[];return"apply"===t&&(r=[n[0]],n=e.slice(2)),r.concat(n.map((function(e,t){return functions_list(e)})).reduce((function(e,t){return e.concat(t)})))}function functions$2(e){var t=functions_list(get_tree(e));return t=t.filter((function(e,n,r){return n===t.indexOf(e)})),t}var variables$1=Object.freeze({__proto__:null,variables:variables,operators:operators$3,functions:functions$2}),VERSION="1.13.2",root="object"==typeof self&&self.self===self&&self||"object"==typeof commonjsGlobal&&commonjsGlobal.global===commonjsGlobal&&commonjsGlobal||Function("return this")()||{},ArrayProto=Array.prototype,ObjProto=Object.prototype,SymbolProto="undefined"!=typeof Symbol?Symbol.prototype:null,push=ArrayProto.push,slice=ArrayProto.slice,toString$1=ObjProto.toString,hasOwnProperty$1=ObjProto.hasOwnProperty,supportsArrayBuffer="undefined"!=typeof ArrayBuffer,supportsDataView="undefined"!=typeof DataView,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create,nativeIsView=supportsArrayBuffer&&ArrayBuffer.isView,_isNaN=isNaN,_isFinite=isFinite,hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],MAX_ARRAY_INDEX=Math.pow(2,53)-1;function restArguments(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),a=0;a<n;a++)r[a]=arguments[a+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var i=Array(t+1);for(a=0;a<t;a++)i[a]=arguments[a];return i[t]=r,e.apply(this,i)}}function isObject$1(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function isNull$1(e){return null===e}function isUndefined$1(e){return void 0===e}function isBoolean$1(e){return!0===e||!1===e||"[object Boolean]"===toString$1.call(e)}function isElement(e){return!(!e||1!==e.nodeType)}function tagTester(e){var t="[object "+e+"]";return function(e){return toString$1.call(e)===t}}var isString$1=tagTester("String"),isNumber$1=tagTester("Number"),isDate$1=tagTester("Date"),isRegExp$1=tagTester("RegExp"),isError$1=tagTester("Error"),isSymbol$1=tagTester("Symbol"),isArrayBuffer=tagTester("ArrayBuffer"),isFunction$1=tagTester("Function"),nodelist=root.document&&root.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof nodelist&&(isFunction$1=function(e){return"function"==typeof e||!1});var isFunction$2=isFunction$1,hasObjectTag=tagTester("Object"),hasStringTagBug=supportsDataView&&hasObjectTag(new DataView(new ArrayBuffer(8))),isIE11="undefined"!=typeof Map&&hasObjectTag(new Map),isDataView=tagTester("DataView");function ie10IsDataView(e){return null!=e&&isFunction$2(e.getInt8)&&isArrayBuffer(e.buffer)}var isDataView$1=hasStringTagBug?ie10IsDataView:isDataView,isArray$1=nativeIsArray||tagTester("Array");function has$1(e,t){return null!=e&&hasOwnProperty$1.call(e,t)}var isArguments=tagTester("Arguments");!function(){isArguments(arguments)||(isArguments=function(e){return has$1(e,"callee")})}();var isArguments$1=isArguments;function isFinite$1(e){return!isSymbol$1(e)&&_isFinite(e)&&!isNaN(parseFloat(e))}function isNaN$1(e){return isNumber$1(e)&&_isNaN(e)}function constant(e){return function(){return e}}function createSizePropertyCheck(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=MAX_ARRAY_INDEX}}function shallowProperty(e){return function(t){return null==t?void 0:t[e]}}var getByteLength=shallowProperty("byteLength"),isBufferLike=createSizePropertyCheck(getByteLength),typedArrayPattern=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function isTypedArray(e){return nativeIsView?nativeIsView(e)&&!isDataView$1(e):isBufferLike(e)&&typedArrayPattern.test(toString$1.call(e))}var isTypedArray$1=supportsArrayBuffer?isTypedArray:constant(!1),getLength=shallowProperty("length");function emulatedSet(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(e){return!0===t[e]},push:function(n){return t[n]=!0,e.push(n)}}}function collectNonEnumProps(e,t){t=emulatedSet(t);var n=nonEnumerableProps.length,r=e.constructor,a=isFunction$2(r)&&r.prototype||ObjProto,i="constructor";for(has$1(e,i)&&!t.contains(i)&&t.push(i);n--;)(i=nonEnumerableProps[n])in e&&e[i]!==a[i]&&!t.contains(i)&&t.push(i)}function keys(e){if(!isObject$1(e))return[];if(nativeKeys)return nativeKeys(e);var t=[];for(var n in e)has$1(e,n)&&t.push(n);return hasEnumBug&&collectNonEnumProps(e,t),t}function isEmpty(e){if(null==e)return!0;var t=getLength(e);return"number"==typeof t&&(isArray$1(e)||isString$1(e)||isArguments$1(e))?0===t:0===getLength(keys(e))}function isMatch(e,t){var n=keys(t),r=n.length;if(null==e)return!r;for(var a=Object(e),i=0;i<r;i++){var o=n[i];if(t[o]!==a[o]||!(o in a))return!1}return!0}function _$1(e){return e instanceof _$1?e:this instanceof _$1?void(this._wrapped=e):new _$1(e)}function toBufferView(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,getByteLength(e))}_$1.VERSION=VERSION,_$1.prototype.value=function(){return this._wrapped},_$1.prototype.valueOf=_$1.prototype.toJSON=_$1.prototype.value,_$1.prototype.toString=function(){return String(this._wrapped)};var tagDataView="[object DataView]";function eq(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var a=typeof e;return("function"===a||"object"===a||"object"==typeof t)&&deepEq(e,t,n,r)}function deepEq(e,t,n,r){e instanceof _$1&&(e=e._wrapped),t instanceof _$1&&(t=t._wrapped);var a=toString$1.call(e);if(a!==toString$1.call(t))return!1;if(hasStringTagBug&&"[object Object]"==a&&isDataView$1(e)){if(!isDataView$1(t))return!1;a=tagDataView}switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return SymbolProto.valueOf.call(e)===SymbolProto.valueOf.call(t);case"[object ArrayBuffer]":case tagDataView:return deepEq(toBufferView(e),toBufferView(t),n,r)}var i="[object Array]"===a;if(!i&&isTypedArray$1(e)){if(getByteLength(e)!==getByteLength(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;i=!0}if(!i){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(isFunction$2(o)&&o instanceof o&&isFunction$2(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),i){if((l=e.length)!==t.length)return!1;for(;l--;)if(!eq(e[l],t[l],n,r))return!1}else{var u,c=keys(e);if(l=c.length,keys(t).length!==l)return!1;for(;l--;)if(!has$1(t,u=c[l])||!eq(e[u],t[u],n,r))return!1}return n.pop(),r.pop(),!0}function isEqual(e,t){return eq(e,t)}function allKeys(e){if(!isObject$1(e))return[];var t=[];for(var n in e)t.push(n);return hasEnumBug&&collectNonEnumProps(e,t),t}function ie11fingerprint(e){var t=getLength(e);return function(n){if(null==n)return!1;var r=allKeys(n);if(getLength(r))return!1;for(var a=0;a<t;a++)if(!isFunction$2(n[e[a]]))return!1;return e!==weakMapMethods||!isFunction$2(n[forEachName])}}var forEachName="forEach",hasName="has",commonInit=["clear","delete"],mapTail=["get",hasName,"set"],mapMethods=commonInit.concat(forEachName,mapTail),weakMapMethods=commonInit.concat(mapTail),setMethods=["add"].concat(commonInit,forEachName,hasName),isMap=isIE11?ie11fingerprint(mapMethods):tagTester("Map"),isWeakMap=isIE11?ie11fingerprint(weakMapMethods):tagTester("WeakMap"),isSet=isIE11?ie11fingerprint(setMethods):tagTester("Set"),isWeakSet=tagTester("WeakSet");function values(e){for(var t=keys(e),n=t.length,r=Array(n),a=0;a<n;a++)r[a]=e[t[a]];return r}function pairs(e){for(var t=keys(e),n=t.length,r=Array(n),a=0;a<n;a++)r[a]=[t[a],e[t[a]]];return r}function invert(e){for(var t={},n=keys(e),r=0,a=n.length;r<a;r++)t[e[n[r]]]=n[r];return t}function functions$1(e){var t=[];for(var n in e)isFunction$2(e[n])&&t.push(n);return t.sort()}function createAssigner(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var a=1;a<r;a++)for(var i=arguments[a],o=e(i),s=o.length,l=0;l<s;l++){var u=o[l];t&&void 0!==n[u]||(n[u]=i[u])}return n}}var extend$1=createAssigner(allKeys),extendOwn=createAssigner(keys),defaults=createAssigner(allKeys,!0);function ctor(){return function(){}}function baseCreate(e){if(!isObject$1(e))return{};if(nativeCreate)return nativeCreate(e);var t=ctor();t.prototype=e;var n=new t;return t.prototype=null,n}function create$1(e,t){var n=baseCreate(e);return t&&extendOwn(n,t),n}function clone$1(e){return isObject$1(e)?isArray$1(e)?e.slice():extend$1({},e):e}function tap(e,t){return t(e),e}function toPath$1(e){return isArray$1(e)?e:[e]}function toPath(e){return _$1.toPath(e)}function deepGet(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function get(e,t,n){var r=deepGet(e,toPath(t));return isUndefined$1(r)?n:r}function has(e,t){for(var n=(t=toPath(t)).length,r=0;r<n;r++){var a=t[r];if(!has$1(e,a))return!1;e=e[a]}return!!n}function identity(e){return e}function matcher(e){return e=extendOwn({},e),function(t){return isMatch(t,e)}}function property(e){return e=toPath(e),function(t){return deepGet(t,e)}}function optimizeCb(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,a){return e.call(t,n,r,a)};case 4:return function(n,r,a,i){return e.call(t,n,r,a,i)}}return function(){return e.apply(t,arguments)}}function baseIteratee(e,t,n){return null==e?identity:isFunction$2(e)?optimizeCb(e,t,n):isObject$1(e)&&!isArray$1(e)?matcher(e):property(e)}function iteratee(e,t){return baseIteratee(e,t,1/0)}function cb(e,t,n){return _$1.iteratee!==iteratee?_$1.iteratee(e,t):baseIteratee(e,t,n)}function mapObject(e,t,n){t=cb(t,n);for(var r=keys(e),a=r.length,i={},o=0;o<a;o++){var s=r[o];i[s]=t(e[s],s,e)}return i}function noop$1(){}function propertyOf(e){return null==e?noop$1:function(t){return get(e,t)}}function times(e,t,n){var r=Array(Math.max(0,e));t=optimizeCb(t,n,1);for(var a=0;a<e;a++)r[a]=t(a);return r}function random(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}_$1.toPath=toPath$1,_$1.iteratee=iteratee;var now=Date.now||function(){return(new Date).getTime()};function createEscaper(e){var t=function(t){return e[t]},n="(?:"+keys(e).join("|")+")",r=RegExp(n),a=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(a,t):e}}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},escape=createEscaper(escapeMap),unescapeMap=invert(escapeMap),unescape=createEscaper(unescapeMap),templateSettings=_$1.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g;function escapeChar(e){return"\\"+escapes[e]}var bareIdentifier=/^\s*(\w|\$)+\s*$/;function template(e,t,n){!t&&n&&(t=n),t=defaults({},t,_$1.templateSettings);var r=RegExp([(t.escape||noMatch).source,(t.interpolate||noMatch).source,(t.evaluate||noMatch).source].join("|")+"|$","g"),a=0,i="__p+='";e.replace(r,(function(t,n,r,o,s){return i+=e.slice(a,s).replace(escapeRegExp,escapeChar),a=s+t.length,n?i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?i+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t})),i+="';\n";var o,s=t.variable;if(s){if(!bareIdentifier.test(s))throw new Error("variable is not a bare identifier: "+s)}else i="with(obj||{}){\n"+i+"}\n",s="obj";i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{o=new Function(s,"_",i)}catch(e){throw e.source=i,e}var l=function(e){return o.call(this,e,_$1)};return l.source="function("+s+"){\n"+i+"}",l}function result(e,t,n){var r=(t=toPath(t)).length;if(!r)return isFunction$2(n)?n.call(e):n;for(var a=0;a<r;a++){var i=null==e?void 0:e[t[a]];void 0===i&&(i=n,a=r),e=isFunction$2(i)?i.call(e):i}return e}var idCounter=0;function uniqueId(e){var t=++idCounter+"";return e?e+t:t}function chain(e){var t=_$1(e);return t._chain=!0,t}function executeBound(e,t,n,r,a){if(!(r instanceof t))return e.apply(n,a);var i=baseCreate(e.prototype),o=e.apply(i,a);return isObject$1(o)?o:i}var partial=restArguments((function(e,t){var n=partial.placeholder,r=function(){for(var a=0,i=t.length,o=Array(i),s=0;s<i;s++)o[s]=t[s]===n?arguments[a++]:t[s];for(;a<arguments.length;)o.push(arguments[a++]);return executeBound(e,r,this,this,o)};return r}));partial.placeholder=_$1;var bind=restArguments((function(e,t,n){if(!isFunction$2(e))throw new TypeError("Bind must be called on a function");var r=restArguments((function(a){return executeBound(e,r,t,this,n.concat(a))}));return r})),isArrayLike=createSizePropertyCheck(getLength);function flatten$2(e,t,n,r){if(r=r||[],t||0===t){if(t<=0)return r.concat(e)}else t=1/0;for(var a=r.length,i=0,o=getLength(e);i<o;i++){var s=e[i];if(isArrayLike(s)&&(isArray$1(s)||isArguments$1(s)))if(t>1)flatten$2(s,t-1,n,r),a=r.length;else for(var l=0,u=s.length;l<u;)r[a++]=s[l++];else n||(r[a++]=s)}return r}var bindAll=restArguments((function(e,t){var n=(t=flatten$2(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=bind(e[r],e)}return e}));function memoize(e,t){var n=function(r){var a=n.cache,i=""+(t?t.apply(this,arguments):r);return has$1(a,i)||(a[i]=e.apply(this,arguments)),a[i]};return n.cache={},n}var delay=restArguments((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),defer=partial(delay,_$1,1);function throttle(e,t,n){var r,a,i,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:now(),r=null,o=e.apply(a,i),r||(a=i=null)},u=function(){var u=now();s||!1!==n.leading||(s=u);var c=t-(u-s);return a=this,i=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=u,o=e.apply(a,i),r||(a=i=null)):r||!1===n.trailing||(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),s=0,r=a=i=null},u}function debounce(e,t,n){var r,a,i,o,s,l=function(){var u=now()-a;t>u?r=setTimeout(l,t-u):(r=null,n||(o=e.apply(s,i)),r||(i=s=null))},u=restArguments((function(u){return s=this,i=u,a=now(),r||(r=setTimeout(l,t),n&&(o=e.apply(s,i))),o}));return u.cancel=function(){clearTimeout(r),r=i=s=null},u}function wrap(e,t){return partial(t,e)}function negate(e){return function(){return!e.apply(this,arguments)}}function compose(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}function after(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function before(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var once$1=partial(before,2);function findKey(e,t,n){t=cb(t,n);for(var r,a=keys(e),i=0,o=a.length;i<o;i++)if(t(e[r=a[i]],r,e))return r}function createPredicateIndexFinder(e){return function(t,n,r){n=cb(n,r);for(var a=getLength(t),i=e>0?0:a-1;i>=0&&i<a;i+=e)if(n(t[i],i,t))return i;return-1}}var findIndex=createPredicateIndexFinder(1),findLastIndex=createPredicateIndexFinder(-1);function sortedIndex(e,t,n,r){for(var a=(n=cb(n,r,1))(t),i=0,o=getLength(e);i<o;){var s=Math.floor((i+o)/2);n(e[s])<a?i=s+1:o=s}return i}function createIndexFinder(e,t,n){return function(r,a,i){var o=0,s=getLength(r);if("number"==typeof i)e>0?o=i>=0?i:Math.max(i+s,o):s=i>=0?Math.min(i+1,s):i+s+1;else if(n&&i&&s)return r[i=n(r,a)]===a?i:-1;if(a!=a)return(i=t(slice.call(r,o,s),isNaN$1))>=0?i+o:-1;for(i=e>0?o:s-1;i>=0&&i<s;i+=e)if(r[i]===a)return i;return-1}}var indexOf=createIndexFinder(1,findIndex,sortedIndex),lastIndexOf=createIndexFinder(-1,findLastIndex);function find(e,t,n){var r=(isArrayLike(e)?findIndex:findKey)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function findWhere(e,t){return find(e,matcher(t))}function each(e,t,n){var r,a;if(t=optimizeCb(t,n),isArrayLike(e))for(r=0,a=e.length;r<a;r++)t(e[r],r,e);else{var i=keys(e);for(r=0,a=i.length;r<a;r++)t(e[i[r]],i[r],e)}return e}function map(e,t,n){t=cb(t,n);for(var r=!isArrayLike(e)&&keys(e),a=(r||e).length,i=Array(a),o=0;o<a;o++){var s=r?r[o]:o;i[o]=t(e[s],s,e)}return i}function createReduce(e){var t=function(t,n,r,a){var i=!isArrayLike(t)&&keys(t),o=(i||t).length,s=e>0?0:o-1;for(a||(r=t[i?i[s]:s],s+=e);s>=0&&s<o;s+=e){var l=i?i[s]:s;r=n(r,t[l],l,t)}return r};return function(e,n,r,a){var i=arguments.length>=3;return t(e,optimizeCb(n,a,4),r,i)}}var reduce$1=createReduce(1),reduceRight=createReduce(-1);function filter(e,t,n){var r=[];return t=cb(t,n),each(e,(function(e,n,a){t(e,n,a)&&r.push(e)})),r}function reject(e,t,n){return filter(e,negate(cb(t)),n)}function every(e,t,n){t=cb(t,n);for(var r=!isArrayLike(e)&&keys(e),a=(r||e).length,i=0;i<a;i++){var o=r?r[i]:i;if(!t(e[o],o,e))return!1}return!0}function some(e,t,n){t=cb(t,n);for(var r=!isArrayLike(e)&&keys(e),a=(r||e).length,i=0;i<a;i++){var o=r?r[i]:i;if(t(e[o],o,e))return!0}return!1}function contains(e,t,n,r){return isArrayLike(e)||(e=values(e)),("number"!=typeof n||r)&&(n=0),indexOf(e,t,n)>=0}var invoke=restArguments((function(e,t,n){var r,a;return isFunction$2(t)?a=t:(t=toPath(t),r=t.slice(0,-1),t=t[t.length-1]),map(e,(function(e){var i=a;if(!i){if(r&&r.length&&(e=deepGet(e,r)),null==e)return;i=e[t]}return null==i?i:i.apply(e,n)}))}));function pluck(e,t){return map(e,property(t))}function where(e,t){return filter(e,matcher(t))}function max(e,t,n){var r,a,i=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=isArrayLike(e)?e:values(e)).length;s<l;s++)null!=(r=e[s])&&r>i&&(i=r);else t=cb(t,n),each(e,(function(e,n,r){((a=t(e,n,r))>o||a===-1/0&&i===-1/0)&&(i=e,o=a)}));return i}function min(e,t,n){var r,a,i=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=isArrayLike(e)?e:values(e)).length;s<l;s++)null!=(r=e[s])&&r<i&&(i=r);else t=cb(t,n),each(e,(function(e,n,r){((a=t(e,n,r))<o||a===1/0&&i===1/0)&&(i=e,o=a)}));return i}var reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function toArray(e){return e?isArray$1(e)?slice.call(e):isString$1(e)?e.match(reStrSymbol):isArrayLike(e)?map(e,identity):values(e):[]}function sample(e,t,n){if(null==t||n)return isArrayLike(e)||(e=values(e)),e[random(e.length-1)];var r=toArray(e),a=getLength(r);t=Math.max(Math.min(t,a),0);for(var i=a-1,o=0;o<t;o++){var s=random(o,i),l=r[o];r[o]=r[s],r[s]=l}return r.slice(0,t)}function shuffle(e){return sample(e,1/0)}function sortBy(e,t,n){var r=0;return t=cb(t,n),pluck(map(e,(function(e,n,a){return{value:e,index:r++,criteria:t(e,n,a)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")}function group(e,t){return function(n,r,a){var i=t?[[],[]]:{};return r=cb(r,a),each(n,(function(t,a){var o=r(t,a,n);e(i,t,o)})),i}}var groupBy=group((function(e,t,n){has$1(e,n)?e[n].push(t):e[n]=[t]})),indexBy=group((function(e,t,n){e[n]=t})),countBy=group((function(e,t,n){has$1(e,n)?e[n]++:e[n]=1})),partition=group((function(e,t,n){e[n?0:1].push(t)}),!0);function size(e){return null==e?0:isArrayLike(e)?e.length:keys(e).length}function keyInObj(e,t,n){return t in n}var pick=restArguments((function(e,t){var n={},r=t[0];if(null==e)return n;isFunction$2(r)?(t.length>1&&(r=optimizeCb(r,t[1])),t=allKeys(e)):(r=keyInObj,t=flatten$2(t,!1,!1),e=Object(e));for(var a=0,i=t.length;a<i;a++){var o=t[a],s=e[o];r(s,o,e)&&(n[o]=s)}return n})),omit=restArguments((function(e,t){var n,r=t[0];return isFunction$2(r)?(r=negate(r),t.length>1&&(n=t[1])):(t=map(flatten$2(t,!1,!1),String),r=function(e,n){return!contains(t,n)}),pick(e,r,n)}));function initial(e,t,n){return slice.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function first(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:initial(e,e.length-t)}function rest(e,t,n){return slice.call(e,null==t||n?1:t)}function last(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:rest(e,Math.max(0,e.length-t))}function compact(e){return filter(e,Boolean)}function flatten$1(e,t){return flatten$2(e,t,!1)}var difference=restArguments((function(e,t){return t=flatten$2(t,!0,!0),filter(e,(function(e){return!contains(t,e)}))})),without=restArguments((function(e,t){return difference(e,t)}));function uniq(e,t,n,r){isBoolean$1(t)||(r=n,n=t,t=!1),null!=n&&(n=cb(n,r));for(var a=[],i=[],o=0,s=getLength(e);o<s;o++){var l=e[o],u=n?n(l,o,e):l;t&&!n?(o&&i===u||a.push(l),i=u):n?contains(i,u)||(i.push(u),a.push(l)):contains(a,l)||a.push(l)}return a}var union=restArguments((function(e){return uniq(flatten$2(e,!0,!0))}));function intersection(e){for(var t=[],n=arguments.length,r=0,a=getLength(e);r<a;r++){var i=e[r];if(!contains(t,i)){var o;for(o=1;o<n&&contains(arguments[o],i);o++);o===n&&t.push(i)}}return t}function unzip(e){for(var t=e&&max(e,getLength).length||0,n=Array(t),r=0;r<t;r++)n[r]=pluck(e,r);return n}var zip=restArguments(unzip);function object(e,t){for(var n={},r=0,a=getLength(e);r<a;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}function range(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),a=Array(r),i=0;i<r;i++,e+=n)a[i]=e;return a}function chunk(e,t){if(null==t||t<1)return[];for(var n=[],r=0,a=e.length;r<a;)n.push(slice.call(e,r,r+=t));return n}function chainResult(e,t){return e._chain?_$1(t).chain():t}function mixin(e){return each(functions$1(e),(function(t){var n=_$1[t]=e[t];_$1.prototype[t]=function(){var e=[this._wrapped];return push.apply(e,arguments),chainResult(this,n.apply(_$1,e))}})),_$1}each(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=ArrayProto[e];_$1.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),chainResult(this,n)}})),each(["concat","join","slice"],(function(e){var t=ArrayProto[e];_$1.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),chainResult(this,e)}}));var allExports=Object.freeze({__proto__:null,VERSION:VERSION,restArguments:restArguments,isObject:isObject$1,isNull:isNull$1,isUndefined:isUndefined$1,isBoolean:isBoolean$1,isElement:isElement,isString:isString$1,isNumber:isNumber$1,isDate:isDate$1,isRegExp:isRegExp$1,isError:isError$1,isSymbol:isSymbol$1,isArrayBuffer:isArrayBuffer,isDataView:isDataView$1,isArray:isArray$1,isFunction:isFunction$2,isArguments:isArguments$1,isFinite:isFinite$1,isNaN:isNaN$1,isTypedArray:isTypedArray$1,isEmpty:isEmpty,isMatch:isMatch,isEqual:isEqual,isMap:isMap,isWeakMap:isWeakMap,isSet:isSet,isWeakSet:isWeakSet,keys:keys,allKeys:allKeys,values:values,pairs:pairs,invert:invert,functions:functions$1,methods:functions$1,extend:extend$1,extendOwn:extendOwn,assign:extendOwn,defaults:defaults,create:create$1,clone:clone$1,tap:tap,get:get,has:has,mapObject:mapObject,identity:identity,constant:constant,noop:noop$1,toPath:toPath$1,property:property,propertyOf:propertyOf,matcher:matcher,matches:matcher,times:times,random:random,now:now,escape:escape,unescape:unescape,templateSettings:templateSettings,template:template,result:result,uniqueId:uniqueId,chain:chain,iteratee:iteratee,partial:partial,bind:bind,bindAll:bindAll,memoize:memoize,delay:delay,defer:defer,throttle:throttle,debounce:debounce,wrap:wrap,negate:negate,compose:compose,after:after,before:before,once:once$1,findKey:findKey,findIndex:findIndex,findLastIndex:findLastIndex,sortedIndex:sortedIndex,indexOf:indexOf,lastIndexOf:lastIndexOf,find:find,detect:find,findWhere:findWhere,each:each,forEach:each,map:map,collect:map,reduce:reduce$1,foldl:reduce$1,inject:reduce$1,reduceRight:reduceRight,foldr:reduceRight,filter:filter,select:filter,reject:reject,every:every,all:every,some:some,any:some,contains:contains,includes:contains,include:contains,invoke:invoke,pluck:pluck,where:where,max:max,min:min,shuffle:shuffle,sample:sample,sortBy:sortBy,groupBy:groupBy,indexBy:indexBy,countBy:countBy,partition:partition,toArray:toArray,size:size,pick:pick,omit:omit,first:first,head:first,take:first,initial:initial,last:last,rest:rest,tail:rest,drop:rest,compact:compact,flatten:flatten$1,without:without,uniq:uniq,unique:uniq,union:union,intersection:intersection,difference:difference,unzip:unzip,transpose:unzip,zip:zip,object:object,range:range,chunk:chunk,mixin:mixin,default:_$1}),_=mixin(allExports);function handleNaNInfinityStringify(e,t){return t!=t?"0/0":t===1/0?"1/0":t===-1/0?"-1/0":t}function handleNaNInfinityParse(e,t){return"0/0"===t?NaN:"1/0"===t?1/0:"-1/0"===t?-1/0:t}function deepClone(e){return JSON.parse(JSON.stringify(e,handleNaNInfinityStringify),handleNaNInfinityParse)}_._=_;const equal=function(e,t,{allowed_error_in_numbers:n=0,include_error_in_number_exponents:r=!1,allowed_error_is_absolute:a=!1}={}){if(!Array.isArray(e)||!Array.isArray(t)){if(typeof e!=typeof t)return!1;if("number"==typeof e&&Number.isFinite(e)){let r=1e-14,i=Math.min(Math.abs(e),Math.abs(t));return a?(r*=i,n>r&&(r=n)):(n>r&&(r=n),r*=i),Math.abs(e-t)<=r}return e===t}var i=e[0],o=e.slice(1),s=t[0],l=t.slice(1);return i===s&&(o.length===l.length&&(n>0&&!r&&"^"===i?!!equal(o[0],l[0],{allowed_error_in_numbers:n,include_error_in_number_exponents:r,allowed_error_is_absolute:a})&&equal(o[1],l[1]):_.every(_.zip(o,l),(function(e){return equal(e[0],e[1],{allowed_error_in_numbers:n,include_error_in_number_exponents:r,allowed_error_is_absolute:a})}))))},match=function(e,t,n){var r=!1;void 0===n?n={}:n.allow_extended_match&&(r=!0,delete(n=Object.assign({},n)).allow_extended_match);var a=n.variables;if(void 0===a){a={};let e=variables(t);for(let t=0;t<e.length;t++)a[e[t]]=!0;(n=Object.assign({},n)).variables=a}if(t in a){let n=a[t];if(!0!==n)if(n instanceof RegExp){if("string"==typeof e){if(!e.match(n))return!1}else if(!JSON.stringify(e).match(n))return!1}else{if("function"!=typeof a[t])return!1;if(!a[t](e))return!1}let r={};return r[t]=e,r}if(n.allow_permutations&&(e=default_order(e),t=default_order(t)),!Array.isArray(t))return e===t&&{};var i=allChildren(e),o=t[0],s=t.slice(1);if(!Array.isArray(e)||e[0]!==o||i.length<s.length){if(Array.isArray(n.allow_implicit_identities)){let r=matchImplicitIdentity(e,t,n);if(r)return r}if("*"!==o||!Array.isArray(e)||"-"!==e[0]||!Array.isArray(e[1])||"*"!==e[1][0])return!1;(i=allChildren(e[1]))[0]=["-",i[0]]}return matchOperands(o,i,s,n,r)||!!Array.isArray(n.allow_implicit_identities)&&matchImplicitIdentity([o].concat(i),t,n)};function matchOperands(e,t,n,r,a){var i=n.map((e=>Object())),o=n.length,s=!1;function l(u,c,p){let d,m=1,f=1;if(is_associative$1[e]&&(m=u.length-(o-c-1),f=u.length),void 0!==r.max_group&&(m=r.max_group<m?r.max_group:m),void 0!==r.max_last_group&&(f=r.max_last_group<f?r.max_last_group:f),a||c!==o-1)if(s)d=subsets(u,m);else{d=[];for(let e=1;e<=m;e++)d.push(u.slice(0,e))}else{if(!(u.length<=f))return!1;d=[u]}for(let a of d){let s=i[c][a];if(void 0===s){let o=a.reduce((function(e,n){return e.concat([t[n]])}),[]);o=o.length>1?[e].concat(o):o[0],s=match(o,n[c],r),i[c][a]=s}if(!s)continue;if(!_.every(_.intersection(Object.keys(p),Object.keys(s)),(function(e){return equal(p[e],s[e])})))continue;let d=Object.assign({},s);Object.assign(d,p);let m=u.filter((e=>!a.includes(e)));if(c===o-1)return{matches:d,skipped:m.reduce((function(e,n){return e.concat([t[n]])}),[])};let f=l(m,c+1,d);if(f)return f}return!1}!r.allow_permutations||"*"!==e&&"+"!==e&&"="!==e&&"and"!==e&&"or"!==e&&"ne"!==e&&"union"!==e&&"intersect"!==e||(s=!0);var u={},c=[...Array(t.length).keys()];if(s){let e=l(c,0,{});return!!e&&(u=e.matches,e.skipped.length>0&&(u._skipped=e.skipped),u)}{let e,n=a?t.length-o:0,r=[];for(let a=0;a<=n&&(e=l(c,0,{}),!e);a++)c=c.slice(1),r.push(t[a]);return!!e&&(u=e.matches,e.skipped.length>0&&(u._skipped=e.skipped),r.length>0&&(u._skipped_before=r),u)}}function matchImplicitIdentity(e,t,n){var r=t[0],a=t.slice(1);if("+"!==r&&"*"!==r&&"^"!==r)return!1;var i=null;for(let e=0;e<a.length;e++){let t=a[e];if("string"==typeof t&&n.allow_implicit_identities.includes(t)){i=t;break}}if(null===i)return!1;var o={};o[i]="+"===r?0:1,"*"===r&&a.includes(i)&&Array.isArray(e)&&"-"===e[0]&&(o[i]=-1,e=e[1]);var s=a.indexOf(i);if(a.splice(s,1),"^"===r&&0===s)return!1;t=1===a.length?a[0]:[r].concat(a);var l=match(e,t,n);return!!l&&!(i in l&&!equal(l[i],o[i]))&&(Object.assign(o,l),o)}const substitute$1=function(e,t){return"number"==typeof e||"boolean"==typeof e?e:"string"==typeof e?void 0!==t[e]?deepClone(t[e]):e:Array.isArray(e)?[e[0]].concat(e.slice(1).map((function(e){return substitute$1(e,t)}))):[]},transform=function(e,t){if(Array.isArray(e)){let n=[e[0]];for(let r=1;r<e.length;r++)n.push(transform(e[r],t));return t(n)}return t(e)},applyAllTransformations=function(e,t,n){void 0===n&&(n=5);for(var r,a=e;n>0;n--){r=a;for(let e=0;e<t.length;e++){let n=t[e][0],r=t[e][1],i=t[e][2];void 0===i&&(i={}),a=transform(a,(function(e){let t=match(e,n,i);if(t){let e=substitute$1(r,t);i.evaluate_numbers&&(e=evaluate_numbers(e,{max_digits:i.max_digits}));let a=[],o=[];return t._skipped&&(a=t._skipped),t._skipped_before&&(o=t._skipped_before),(o.length>0||a.length>0)&&(Array.isArray(e)&&(e=e[0]===n[0]?e.slice(1):[e]),e=[n[0]].concat(o,e,a)),i.evaluate_numbers&&(e=evaluate_numbers(e,{max_digits:i.max_digits})),e}return e}))}if(equal(r,a))return a}return a};var endsWith=string$a.endsWith,clone=object$6.clone;function factory$5(e,t,n,r,a){var i,o,s,l=n(addScalar),u=n(subtract$1),c=n(multiplyScalar),p=n(divideScalar),d=n(pow$1),m=n(abs$1),f=n(fix),h=n(round$1),y=n(equal$1),b=n(isNumeric),g=n(format$2),v=n(_typeof),T=n(number$2),C=n(Complex_1);function N(t,n){if(!(this instanceof N))throw new Error("Constructor must be called with the new operator");if(null!=t&&!b(t)&&!e.isComplex(t))throw new TypeError("First parameter in Unit constructor must be number, BigNumber, Fraction, Complex, or undefined");if(null!=n&&("string"!=typeof n||""===n))throw new TypeError("Second parameter in Unit constructor must be a string");if(null!=n){var r=N.parse(n);this.units=r.units,this.dimensions=r.dimensions}else{this.units=[{unit:k,prefix:I.NONE,power:0}],this.dimensions=[];for(var a=0;a<R.length;a++)this.dimensions[a]=0}this.value=null!=t?this._normalize(t):null,this.fixPrefix=!1,this.isUnitListSimplified=!0}function A(){for(;" "==s||"\t"==s;)w()}function S(e){return e>="0"&&e<="9"}function w(){o++,s=i.charAt(o)}function x(e){o=e,s=i.charAt(o)}function V(){var e,t="";if(e=o,"+"==s?w():"-"==s&&(t+=s,w()),!function(e){return e>="0"&&e<="9"||"."==e}(s))return x(e),null;if("."==s){if(t+=s,w(),!S(s))return x(e),null}else{for(;S(s);)t+=s,w();"."==s&&(t+=s,w())}for(;S(s);)t+=s,w();if("E"==s||"e"==s){var n="",r=o;if(n+=s,w(),"+"!=s&&"-"!=s||(n+=s,w()),!S(s))return x(r),t;for(t+=n;S(s);)t+=s,w()}return t}function E(){for(var e="",t=i.charCodeAt(o);t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122;)e+=s,w(),t=i.charCodeAt(o);return((t=e.charCodeAt(0))>=65&&t<=90||t>=97&&t<=122)&&e||null}function $(e){return s===e?(w(),e):null}function _(e){if(M.hasOwnProperty(e))return{unit:r=M[e],prefix:n=r.prefixes[""]};for(var t in M)if(M.hasOwnProperty(t)&&endsWith(e,t)){var n,r=M[t],a=e.length-t.length,i=e.substring(0,a);if(void 0!==(n=r.prefixes.hasOwnProperty(i)?r.prefixes[i]:void 0))return{unit:r,prefix:n}}return null}N.prototype.type="Unit",N.prototype.isUnit=!0,N.parse=function(n,r){if(r=r||{},o=-1,s="","string"!=typeof(i=n))throw new TypeError("Invalid argument in Unit.parse, string expected");var a=new N;a.units=[];var l=1,u=!1;w(),A();var c=V(),p=null;c&&(p="BigNumber"===t.number?new e.BigNumber(c):"Fraction"===t.number?new e.Fraction(c):parseFloat(c),A(),$("*")?(l=1,u=!0):$("/")&&(l=-1,u=!0));for(var d=[],m=1;;){for(A();"("===s;)d.push(l),m*=l,l=1,w(),A();if(!s)break;var f=s,h=E();if(null==h)throw new SyntaxError('Unexpected "'+f+'" in "'+i+'" at index '+o.toString());var y=_(h);if(null==y)throw new SyntaxError('Unit "'+h+'" not found.');var b=l*m;if(A(),$("^")){A();var g=V();if(null==g)throw new SyntaxError('In "'+n+'", "^" must be followed by a floating-point number');b*=g}a.units.push({unit:y.unit,prefix:y.prefix,power:b});for(var v=0;v<R.length;v++)a.dimensions[v]+=(y.unit.dimensions[v]||0)*b;for(A();")"===s;){if(0===d.length)throw new SyntaxError('Unmatched ")" in "'+i+'" at index '+o.toString());m/=d.pop(),w(),A()}if(u=!1,$("*")?(l=1,u=!0):$("/")?(l=-1,u=!0):l=1,y.unit.base){var T=y.unit.base.key;L.auto[T]={unit:y.unit,prefix:y.prefix}}}if(A(),s)throw new SyntaxError('Could not parse: "'+n+'"');if(u)throw new SyntaxError('Trailing characters: "'+n+'"');if(0!==d.length)throw new SyntaxError('Unmatched "(" in "'+i+'"');if(0==a.units.length&&!r.allowNoUnits)throw new SyntaxError('"'+n+'" contains no units');return a.value=null!=p?a._normalize(p):null,a},N.prototype.clone=function(){var e=new N;e.fixPrefix=this.fixPrefix,e.isUnitListSimplified=this.isUnitListSimplified,e.value=clone(this.value),e.dimensions=this.dimensions.slice(0),e.units=[];for(var t=0;t<this.units.length;t++)for(var n in e.units[t]={},this.units[t])this.units[t].hasOwnProperty(n)&&(e.units[t][n]=this.units[t][n]);return e},N.prototype._isDerived=function(){return 0!==this.units.length&&(this.units.length>1||Math.abs(this.units[0].power-1)>1e-15)},N.prototype._normalize=function(e){var t,n,r,a,i;if(null==e||0===this.units.length)return e;if(this._isDerived()){var o=e;i=N._getNumberConverter(v(e));for(var s=0;s<this.units.length;s++)t=i(this.units[s].unit.value),a=i(this.units[s].prefix.value),r=i(this.units[s].power),o=c(o,d(c(t,a),r));return o}return t=(i=N._getNumberConverter(v(e)))(this.units[0].unit.value),n=i(this.units[0].unit.offset),a=i(this.units[0].prefix.value),c(l(e,n),c(t,a))},N.prototype._denormalize=function(e,t){var n,r,a,i,o;if(null==e||0===this.units.length)return e;if(this._isDerived()){var s=e;o=N._getNumberConverter(v(e));for(var l=0;l<this.units.length;l++)n=o(this.units[l].unit.value),i=o(this.units[l].prefix.value),a=o(this.units[l].power),s=p(s,d(c(n,i),a));return s}return n=(o=N._getNumberConverter(v(e)))(this.units[0].unit.value),i=o(this.units[0].prefix.value),r=o(this.units[0].unit.offset),u(p(p(e,n),null==t?i:t),r)},N.isValuelessUnit=function(e){return null!=_(e)},N.prototype.hasBase=function(e){if("string"==typeof e&&(e=P[e]),!e)return!1;for(var t=0;t<R.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},N.prototype.equalBase=function(e){for(var t=0;t<R.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},N.prototype.equals=function(e){return this.equalBase(e)&&y(this.value,e.value)},N.prototype.multiply=function(e){for(var t=this.clone(),n=0;n<R.length;n++)t.dimensions[n]=(this.dimensions[n]||0)+(e.dimensions[n]||0);for(n=0;n<e.units.length;n++){var r={};for(var a in e.units[n])r[a]=e.units[n][a];t.units.push(r)}if(null!=this.value||null!=e.value){var i=null==this.value?this._normalize(1):this.value,o=null==e.value?e._normalize(1):e.value;t.value=c(i,o)}else t.value=null;return t.isUnitListSimplified=!1,O(t)},N.prototype.divide=function(e){for(var t=this.clone(),n=0;n<R.length;n++)t.dimensions[n]=(this.dimensions[n]||0)-(e.dimensions[n]||0);for(n=0;n<e.units.length;n++){var r={};for(var a in e.units[n])r[a]=e.units[n][a];r.power=-r.power,t.units.push(r)}if(null!=this.value||null!=e.value){var i=null==this.value?this._normalize(1):this.value,o=null==e.value?e._normalize(1):e.value;t.value=p(i,o)}else t.value=null;return t.isUnitListSimplified=!1,O(t)},N.prototype.pow=function(e){for(var t=this.clone(),n=0;n<R.length;n++)t.dimensions[n]=(this.dimensions[n]||0)*e;for(n=0;n<t.units.length;n++)t.units[n].power*=e;return null!=t.value?t.value=d(t.value,e):t.value=null,t.isUnitListSimplified=!1,O(t)};var O=function(e){return e.equalBase(P.NONE)&&null!==e.value&&!t.predictable?e.value:e};N.prototype.abs=function(){var e=this.clone();for(var t in e.value=null!==e.value?m(e.value):null,e.units)"VA"!==e.units[t].unit.name&&"VAR"!==e.units[t].unit.name||(e.units[t].unit=M.W);return e},N.prototype.to=function(t){var n,r=null==this.value?this._normalize(1):this.value;if("string"==typeof t){if(n=N.parse(t),!this.equalBase(n))throw new Error("Units do not match");if(null!==n.value)throw new Error("Cannot convert to a unit with a value");return n.value=clone(r),n.fixPrefix=!0,n.isUnitListSimplified=!0,n}if(e.isUnit(t)){if(!this.equalBase(t))throw new Error("Units do not match");if(null!==t.value)throw new Error("Cannot convert to a unit with a value");return(n=t.clone()).value=clone(r),n.fixPrefix=!0,n.isUnitListSimplified=!0,n}throw new Error("String or Unit expected as parameter")},N.prototype.toNumber=function(e){return T(this.toNumeric(e))},N.prototype.toNumeric=function(e){var t=this;return e&&(t=this.to(e)),t.simplifyUnitListLazy(),t._isDerived()?t._denormalize(t.value):t._denormalize(t.value,t.units[0].prefix.value)},N.prototype.toString=function(){return this.format()},N.prototype.toJSON=function(){return{mathjs:"Unit",value:this._denormalize(this.value),unit:this.formatUnits(),fixPrefix:this.fixPrefix}},N.fromJSON=function(e){var t=new N(e.value,e.unit);return t.fixPrefix=e.fixPrefix||!1,t},N.prototype.valueOf=N.prototype.toString,N.prototype.simplifyUnitListLazy=function(){if(!this.isUnitListSimplified&&null!=this.value){var e,t,n=[];for(var r in j)if(this.hasBase(P[r])){e=r;break}if("NONE"===e)this.units=[];else if(e&&j.hasOwnProperty(e)&&(t=j[e]),t)this.units=[{unit:t.unit,prefix:t.prefix,power:1}];else{for(var a=!1,i=0;i<R.length;i++){var o=R[i];Math.abs(this.dimensions[i]||0)>1e-12&&(j.hasOwnProperty(o)?n.push({unit:j[o].unit,prefix:j[o].prefix,power:this.dimensions[i]||0}):a=!0)}n.length<this.units.length&&!a&&(this.units=n)}this.isUnitListSimplified=!0}},N.prototype.toSI=function(){for(var e=this.clone(),t=[],n=0;n<R.length;n++){var r=R[n];if(Math.abs(e.dimensions[n]||0)>1e-12){if(!L.si.hasOwnProperty(r))throw new Error("Cannot express custom unit "+r+" in SI units");t.push({unit:L.si[r].unit,prefix:L.si[r].prefix,power:e.dimensions[n]||0})}}return e.units=t,e.isUnitListSimplified=!0,e},N.prototype.formatUnits=function(){this.simplifyUnitListLazy();for(var e="",t="",n=0,r=0,a=0;a<this.units.length;a++)this.units[a].power>0?(n++,e+=" "+this.units[a].prefix.name+this.units[a].unit.name,Math.abs(this.units[a].power-1)>1e-15&&(e+="^"+this.units[a].power)):this.units[a].power<0&&r++;if(r>0)for(a=0;a<this.units.length;a++)this.units[a].power<0&&(n>0?(t+=" "+this.units[a].prefix.name+this.units[a].unit.name,Math.abs(this.units[a].power+1)>1e-15&&(t+="^"+-this.units[a].power)):(t+=" "+this.units[a].prefix.name+this.units[a].unit.name,t+="^"+this.units[a].power));e=e.substr(1),t=t.substr(1),n>1&&r>0&&(e="("+e+")"),r>1&&n>0&&(t="("+t+")");var i=e;return n>0&&r>0&&(i+=" / "),i+t},N.prototype.format=function(t){this.simplifyUnitListLazy();var n=!1;for(var r in void 0!==this.value&&null!==this.value&&e.isComplex(this.value)&&(n=Math.abs(this.value.re)<1e-14,Math.abs(this.value.im)),this.units)this.units[r].unit&&("VA"===this.units[r].unit.name&&n?this.units[r].unit=M.VAR:"VAR"!==this.units[r].unit.name||n||(this.units[r].unit=M.VA));1!==this.units.length||this.fixPrefix||Math.abs(this.units[0].power-Math.round(this.units[0].power))<1e-14&&(this.units[0].prefix=this._bestPrefix());var a=this._denormalize(this.value),i=null!==this.value?g(a,t||{}):"",o=this.formatUnits();return this.value&&e.isComplex(this.value)&&(i="("+i+")"),o.length>0&&i.length>0&&(i+=" "),i+o},N.prototype._bestPrefix=function(){if(1!==this.units.length)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");if(Math.abs(this.units[0].power-Math.round(this.units[0].power))>=1e-14)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");var e=null!==this.value?m(this.value):0,t=m(this.units[0].unit.value),n=this.units[0].prefix;if(0===e)return n;var r=this.units[0].power,a=Math.log(e/Math.pow(n.value*t,r))/Math.LN10-1.2;if(a>-2.200001&&a<1.800001)return n;a=Math.abs(a);var i=this.units[0].unit.prefixes;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];if(s.scientific){var l=Math.abs(Math.log(e/Math.pow(s.value*t,r))/Math.LN10-1.2);(l<a||l===a&&s.name.length<n.name.length)&&(n=s,a=l)}}return n},N.prototype.splitUnit=function(e){for(var t=this.clone(),n=[],r=0;r<e.length&&(t=t.to(e[r]),r!=e.length-1);r++){var a=t.toNumeric(),i=h(a),o=new N(y(i,a)?i:f(t.toNumeric()),e[r].toString());n.push(o),t=u(t,o)}var s=0;for(r=0;r<n.length;r++)s=l(s,n[r].value);return y(s,this.value)&&(t.value=0),n.push(t),n};var I={NONE:{"":{name:"",value:1,scientific:!0}},SHORT:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:10,scientific:!1},h:{name:"h",value:100,scientific:!1},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},d:{name:"d",value:.1,scientific:!1},c:{name:"c",value:.01,scientific:!1},m:{name:"m",value:.001,scientific:!0},u:{name:"u",value:1e-6,scientific:!0},n:{name:"n",value:1e-9,scientific:!0},p:{name:"p",value:1e-12,scientific:!0},f:{name:"f",value:1e-15,scientific:!0},a:{name:"a",value:1e-18,scientific:!0},z:{name:"z",value:1e-21,scientific:!0},y:{name:"y",value:1e-24,scientific:!0}},LONG:{"":{name:"",value:1,scientific:!0},deca:{name:"deca",value:10,scientific:!1},hecto:{name:"hecto",value:100,scientific:!1},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},deci:{name:"deci",value:.1,scientific:!1},centi:{name:"centi",value:.01,scientific:!1},milli:{name:"milli",value:.001,scientific:!0},micro:{name:"micro",value:1e-6,scientific:!0},nano:{name:"nano",value:1e-9,scientific:!0},pico:{name:"pico",value:1e-12,scientific:!0},femto:{name:"femto",value:1e-15,scientific:!0},atto:{name:"atto",value:1e-18,scientific:!0},zepto:{name:"zepto",value:1e-21,scientific:!0},yocto:{name:"yocto",value:1e-24,scientific:!0}},SQUARED:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:100,scientific:!1},h:{name:"h",value:1e4,scientific:!1},k:{name:"k",value:1e6,scientific:!0},M:{name:"M",value:1e12,scientific:!0},G:{name:"G",value:1e18,scientific:!0},T:{name:"T",value:1e24,scientific:!0},P:{name:"P",value:1e30,scientific:!0},E:{name:"E",value:1e36,scientific:!0},Z:{name:"Z",value:1e42,scientific:!0},Y:{name:"Y",value:1e48,scientific:!0},d:{name:"d",value:.01,scientific:!1},c:{name:"c",value:1e-4,scientific:!1},m:{name:"m",value:1e-6,scientific:!0},u:{name:"u",value:1e-12,scientific:!0},n:{name:"n",value:1e-18,scientific:!0},p:{name:"p",value:1e-24,scientific:!0},f:{name:"f",value:1e-30,scientific:!0},a:{name:"a",value:1e-36,scientific:!0},z:{name:"z",value:1e-42,scientific:!0},y:{name:"y",value:1e-48,scientific:!0}},CUBIC:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:1e3,scientific:!1},h:{name:"h",value:1e6,scientific:!1},k:{name:"k",value:1e9,scientific:!0},M:{name:"M",value:1e18,scientific:!0},G:{name:"G",value:1e27,scientific:!0},T:{name:"T",value:1e36,scientific:!0},P:{name:"P",value:1e45,scientific:!0},E:{name:"E",value:1e54,scientific:!0},Z:{name:"Z",value:1e63,scientific:!0},Y:{name:"Y",value:1e72,scientific:!0},d:{name:"d",value:.001,scientific:!1},c:{name:"c",value:1e-6,scientific:!1},m:{name:"m",value:1e-9,scientific:!0},u:{name:"u",value:1e-18,scientific:!0},n:{name:"n",value:1e-27,scientific:!0},p:{name:"p",value:1e-36,scientific:!0},f:{name:"f",value:1e-45,scientific:!0},a:{name:"a",value:1e-54,scientific:!0},z:{name:"z",value:1e-63,scientific:!0},y:{name:"y",value:1e-72,scientific:!0}},BINARY_SHORT:{"":{name:"",value:1,scientific:!0},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},Ki:{name:"Ki",value:1024,scientific:!0},Mi:{name:"Mi",value:Math.pow(1024,2),scientific:!0},Gi:{name:"Gi",value:Math.pow(1024,3),scientific:!0},Ti:{name:"Ti",value:Math.pow(1024,4),scientific:!0},Pi:{name:"Pi",value:Math.pow(1024,5),scientific:!0},Ei:{name:"Ei",value:Math.pow(1024,6),scientific:!0},Zi:{name:"Zi",value:Math.pow(1024,7),scientific:!0},Yi:{name:"Yi",value:Math.pow(1024,8),scientific:!0}},BINARY_LONG:{"":{name:"",value:1,scientific:!0},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},kibi:{name:"kibi",value:1024,scientific:!0},mebi:{name:"mebi",value:Math.pow(1024,2),scientific:!0},gibi:{name:"gibi",value:Math.pow(1024,3),scientific:!0},tebi:{name:"tebi",value:Math.pow(1024,4),scientific:!0},pebi:{name:"pebi",value:Math.pow(1024,5),scientific:!0},exi:{name:"exi",value:Math.pow(1024,6),scientific:!0},zebi:{name:"zebi",value:Math.pow(1024,7),scientific:!0},yobi:{name:"yobi",value:Math.pow(1024,8),scientific:!0}},BTU:{"":{name:"",value:1,scientific:!0},MM:{name:"MM",value:1e6,scientific:!0}},SHORTLONG:{}};for(var D in I.SHORT)I.SHORT.hasOwnProperty(D)&&(I.SHORTLONG[D]=I.SHORT[D]);for(var D in I.LONG)I.LONG.hasOwnProperty(D)&&(I.SHORTLONG[D]=I.LONG[D]);var R=["MASS","LENGTH","TIME","CURRENT","TEMPERATURE","LUMINOUS_INTENSITY","AMOUNT_OF_SUBSTANCE","ANGLE","BIT"],P={NONE:{dimensions:[0,0,0,0,0,0,0,0,0]},MASS:{dimensions:[1,0,0,0,0,0,0,0,0]},LENGTH:{dimensions:[0,1,0,0,0,0,0,0,0]},TIME:{dimensions:[0,0,1,0,0,0,0,0,0]},CURRENT:{dimensions:[0,0,0,1,0,0,0,0,0]},TEMPERATURE:{dimensions:[0,0,0,0,1,0,0,0,0]},LUMINOUS_INTENSITY:{dimensions:[0,0,0,0,0,1,0,0,0]},AMOUNT_OF_SUBSTANCE:{dimensions:[0,0,0,0,0,0,1,0,0]},FORCE:{dimensions:[1,1,-2,0,0,0,0,0,0]},SURFACE:{dimensions:[0,2,0,0,0,0,0,0,0]},VOLUME:{dimensions:[0,3,0,0,0,0,0,0,0]},ENERGY:{dimensions:[1,2,-2,0,0,0,0,0,0]},POWER:{dimensions:[1,2,-3,0,0,0,0,0,0]},PRESSURE:{dimensions:[1,-1,-2,0,0,0,0,0,0]},ELECTRIC_CHARGE:{dimensions:[0,0,1,1,0,0,0,0,0]},ELECTRIC_CAPACITANCE:{dimensions:[-1,-2,4,2,0,0,0,0,0]},ELECTRIC_POTENTIAL:{dimensions:[1,2,-3,-1,0,0,0,0,0]},ELECTRIC_RESISTANCE:{dimensions:[1,2,-3,-2,0,0,0,0,0]},ELECTRIC_INDUCTANCE:{dimensions:[1,2,-2,-2,0,0,0,0,0]},ELECTRIC_CONDUCTANCE:{dimensions:[-1,-2,3,2,0,0,0,0,0]},MAGNETIC_FLUX:{dimensions:[1,2,-2,-1,0,0,0,0,0]},MAGNETIC_FLUX_DENSITY:{dimensions:[1,0,-2,-1,0,0,0,0,0]},FREQUENCY:{dimensions:[0,0,-1,0,0,0,0,0,0]},ANGLE:{dimensions:[0,0,0,0,0,0,0,1,0]},BIT:{dimensions:[0,0,0,0,0,0,0,0,1]}};for(var D in P)P[D].key=D;var k={name:"",base:{},value:1,offset:0,dimensions:[0,0,0,0,0,0,0,0,0]},M={meter:{name:"meter",base:P.LENGTH,prefixes:I.LONG,value:1,offset:0},inch:{name:"inch",base:P.LENGTH,prefixes:I.NONE,value:.0254,offset:0},foot:{name:"foot",base:P.LENGTH,prefixes:I.NONE,value:.3048,offset:0},yard:{name:"yard",base:P.LENGTH,prefixes:I.NONE,value:.9144,offset:0},mile:{name:"mile",base:P.LENGTH,prefixes:I.NONE,value:1609.344,offset:0},link:{name:"link",base:P.LENGTH,prefixes:I.NONE,value:.201168,offset:0},rod:{name:"rod",base:P.LENGTH,prefixes:I.NONE,value:5.02921,offset:0},chain:{name:"chain",base:P.LENGTH,prefixes:I.NONE,value:20.1168,offset:0},angstrom:{name:"angstrom",base:P.LENGTH,prefixes:I.NONE,value:1e-10,offset:0},m:{name:"m",base:P.LENGTH,prefixes:I.SHORT,value:1,offset:0},in:{name:"in",base:P.LENGTH,prefixes:I.NONE,value:.0254,offset:0},ft:{name:"ft",base:P.LENGTH,prefixes:I.NONE,value:.3048,offset:0},yd:{name:"yd",base:P.LENGTH,prefixes:I.NONE,value:.9144,offset:0},mi:{name:"mi",base:P.LENGTH,prefixes:I.NONE,value:1609.344,offset:0},li:{name:"li",base:P.LENGTH,prefixes:I.NONE,value:.201168,offset:0},rd:{name:"rd",base:P.LENGTH,prefixes:I.NONE,value:5.02921,offset:0},ch:{name:"ch",base:P.LENGTH,prefixes:I.NONE,value:20.1168,offset:0},mil:{name:"mil",base:P.LENGTH,prefixes:I.NONE,value:254e-7,offset:0},m2:{name:"m2",base:P.SURFACE,prefixes:I.SQUARED,value:1,offset:0},sqin:{name:"sqin",base:P.SURFACE,prefixes:I.NONE,value:64516e-8,offset:0},sqft:{name:"sqft",base:P.SURFACE,prefixes:I.NONE,value:.09290304,offset:0},sqyd:{name:"sqyd",base:P.SURFACE,prefixes:I.NONE,value:.83612736,offset:0},sqmi:{name:"sqmi",base:P.SURFACE,prefixes:I.NONE,value:2589988.110336,offset:0},sqrd:{name:"sqrd",base:P.SURFACE,prefixes:I.NONE,value:25.29295,offset:0},sqch:{name:"sqch",base:P.SURFACE,prefixes:I.NONE,value:404.6873,offset:0},sqmil:{name:"sqmil",base:P.SURFACE,prefixes:I.NONE,value:6.4516e-10,offset:0},acre:{name:"acre",base:P.SURFACE,prefixes:I.NONE,value:4046.86,offset:0},hectare:{name:"hectare",base:P.SURFACE,prefixes:I.NONE,value:1e4,offset:0},m3:{name:"m3",base:P.VOLUME,prefixes:I.CUBIC,value:1,offset:0},L:{name:"L",base:P.VOLUME,prefixes:I.SHORT,value:.001,offset:0},l:{name:"l",base:P.VOLUME,prefixes:I.SHORT,value:.001,offset:0},litre:{name:"litre",base:P.VOLUME,prefixes:I.LONG,value:.001,offset:0},cuin:{name:"cuin",base:P.VOLUME,prefixes:I.NONE,value:16387064e-12,offset:0},cuft:{name:"cuft",base:P.VOLUME,prefixes:I.NONE,value:.028316846592,offset:0},cuyd:{name:"cuyd",base:P.VOLUME,prefixes:I.NONE,value:.764554857984,offset:0},teaspoon:{name:"teaspoon",base:P.VOLUME,prefixes:I.NONE,value:5e-6,offset:0},tablespoon:{name:"tablespoon",base:P.VOLUME,prefixes:I.NONE,value:15e-6,offset:0},drop:{name:"drop",base:P.VOLUME,prefixes:I.NONE,value:5e-8,offset:0},gtt:{name:"gtt",base:P.VOLUME,prefixes:I.NONE,value:5e-8,offset:0},minim:{name:"minim",base:P.VOLUME,prefixes:I.NONE,value:6.161152e-8,offset:0},fluiddram:{name:"fluiddram",base:P.VOLUME,prefixes:I.NONE,value:36966911e-13,offset:0},fluidounce:{name:"fluidounce",base:P.VOLUME,prefixes:I.NONE,value:2957353e-11,offset:0},gill:{name:"gill",base:P.VOLUME,prefixes:I.NONE,value:.0001182941,offset:0},cc:{name:"cc",base:P.VOLUME,prefixes:I.NONE,value:1e-6,offset:0},cup:{name:"cup",base:P.VOLUME,prefixes:I.NONE,value:.0002365882,offset:0},pint:{name:"pint",base:P.VOLUME,prefixes:I.NONE,value:.0004731765,offset:0},quart:{name:"quart",base:P.VOLUME,prefixes:I.NONE,value:.0009463529,offset:0},gallon:{name:"gallon",base:P.VOLUME,prefixes:I.NONE,value:.003785412,offset:0},beerbarrel:{name:"beerbarrel",base:P.VOLUME,prefixes:I.NONE,value:.1173478,offset:0},oilbarrel:{name:"oilbarrel",base:P.VOLUME,prefixes:I.NONE,value:.1589873,offset:0},hogshead:{name:"hogshead",base:P.VOLUME,prefixes:I.NONE,value:.238481,offset:0},fldr:{name:"fldr",base:P.VOLUME,prefixes:I.NONE,value:36966911e-13,offset:0},floz:{name:"floz",base:P.VOLUME,prefixes:I.NONE,value:2957353e-11,offset:0},gi:{name:"gi",base:P.VOLUME,prefixes:I.NONE,value:.0001182941,offset:0},cp:{name:"cp",base:P.VOLUME,prefixes:I.NONE,value:.0002365882,offset:0},pt:{name:"pt",base:P.VOLUME,prefixes:I.NONE,value:.0004731765,offset:0},qt:{name:"qt",base:P.VOLUME,prefixes:I.NONE,value:.0009463529,offset:0},gal:{name:"gal",base:P.VOLUME,prefixes:I.NONE,value:.003785412,offset:0},bbl:{name:"bbl",base:P.VOLUME,prefixes:I.NONE,value:.1173478,offset:0},obl:{name:"obl",base:P.VOLUME,prefixes:I.NONE,value:.1589873,offset:0},g:{name:"g",base:P.MASS,prefixes:I.SHORT,value:.001,offset:0},gram:{name:"gram",base:P.MASS,prefixes:I.LONG,value:.001,offset:0},ton:{name:"ton",base:P.MASS,prefixes:I.SHORT,value:907.18474,offset:0},tonne:{name:"tonne",base:P.MASS,prefixes:I.SHORT,value:1e3,offset:0},grain:{name:"grain",base:P.MASS,prefixes:I.NONE,value:6479891e-11,offset:0},dram:{name:"dram",base:P.MASS,prefixes:I.NONE,value:.0017718451953125,offset:0},ounce:{name:"ounce",base:P.MASS,prefixes:I.NONE,value:.028349523125,offset:0},poundmass:{name:"poundmass",base:P.MASS,prefixes:I.NONE,value:.45359237,offset:0},hundredweight:{name:"hundredweight",base:P.MASS,prefixes:I.NONE,value:45.359237,offset:0},stick:{name:"stick",base:P.MASS,prefixes:I.NONE,value:.115,offset:0},stone:{name:"stone",base:P.MASS,prefixes:I.NONE,value:6.35029318,offset:0},gr:{name:"gr",base:P.MASS,prefixes:I.NONE,value:6479891e-11,offset:0},dr:{name:"dr",base:P.MASS,prefixes:I.NONE,value:.0017718451953125,offset:0},oz:{name:"oz",base:P.MASS,prefixes:I.NONE,value:.028349523125,offset:0},lbm:{name:"lbm",base:P.MASS,prefixes:I.NONE,value:.45359237,offset:0},cwt:{name:"cwt",base:P.MASS,prefixes:I.NONE,value:45.359237,offset:0},s:{name:"s",base:P.TIME,prefixes:I.SHORT,value:1,offset:0},min:{name:"min",base:P.TIME,prefixes:I.NONE,value:60,offset:0},h:{name:"h",base:P.TIME,prefixes:I.NONE,value:3600,offset:0},second:{name:"second",base:P.TIME,prefixes:I.LONG,value:1,offset:0},sec:{name:"sec",base:P.TIME,prefixes:I.LONG,value:1,offset:0},minute:{name:"minute",base:P.TIME,prefixes:I.NONE,value:60,offset:0},hour:{name:"hour",base:P.TIME,prefixes:I.NONE,value:3600,offset:0},day:{name:"day",base:P.TIME,prefixes:I.NONE,value:86400,offset:0},week:{name:"week",base:P.TIME,prefixes:I.NONE,value:604800,offset:0},month:{name:"month",base:P.TIME,prefixes:I.NONE,value:2629800,offset:0},year:{name:"year",base:P.TIME,prefixes:I.NONE,value:31557600,offset:0},decade:{name:"decade",base:P.TIME,prefixes:I.NONE,value:315576e3,offset:0},century:{name:"century",base:P.TIME,prefixes:I.NONE,value:315576e4,offset:0},millennium:{name:"millennium",base:P.TIME,prefixes:I.NONE,value:315576e5,offset:0},hertz:{name:"Hertz",base:P.FREQUENCY,prefixes:I.LONG,value:1,offset:0,reciprocal:!0},Hz:{name:"Hz",base:P.FREQUENCY,prefixes:I.SHORT,value:1,offset:0,reciprocal:!0},rad:{name:"rad",base:P.ANGLE,prefixes:I.SHORT,value:1,offset:0},radian:{name:"radian",base:P.ANGLE,prefixes:I.LONG,value:1,offset:0},deg:{name:"deg",base:P.ANGLE,prefixes:I.SHORT,value:null,offset:0},degree:{name:"degree",base:P.ANGLE,prefixes:I.LONG,value:null,offset:0},grad:{name:"grad",base:P.ANGLE,prefixes:I.SHORT,value:null,offset:0},gradian:{name:"gradian",base:P.ANGLE,prefixes:I.LONG,value:null,offset:0},cycle:{name:"cycle",base:P.ANGLE,prefixes:I.NONE,value:null,offset:0},arcsec:{name:"arcsec",base:P.ANGLE,prefixes:I.NONE,value:null,offset:0},arcmin:{name:"arcmin",base:P.ANGLE,prefixes:I.NONE,value:null,offset:0},A:{name:"A",base:P.CURRENT,prefixes:I.SHORT,value:1,offset:0},ampere:{name:"ampere",base:P.CURRENT,prefixes:I.LONG,value:1,offset:0},K:{name:"K",base:P.TEMPERATURE,prefixes:I.NONE,value:1,offset:0},degC:{name:"degC",base:P.TEMPERATURE,prefixes:I.NONE,value:1,offset:273.15},degF:{name:"degF",base:P.TEMPERATURE,prefixes:I.NONE,value:1/1.8,offset:459.67},degR:{name:"degR",base:P.TEMPERATURE,prefixes:I.NONE,value:1/1.8,offset:0},kelvin:{name:"kelvin",base:P.TEMPERATURE,prefixes:I.NONE,value:1,offset:0},celsius:{name:"celsius",base:P.TEMPERATURE,prefixes:I.NONE,value:1,offset:273.15},fahrenheit:{name:"fahrenheit",base:P.TEMPERATURE,prefixes:I.NONE,value:1/1.8,offset:459.67},rankine:{name:"rankine",base:P.TEMPERATURE,prefixes:I.NONE,value:1/1.8,offset:0},mol:{name:"mol",base:P.AMOUNT_OF_SUBSTANCE,prefixes:I.SHORT,value:1,offset:0},mole:{name:"mole",base:P.AMOUNT_OF_SUBSTANCE,prefixes:I.LONG,value:1,offset:0},cd:{name:"cd",base:P.LUMINOUS_INTENSITY,prefixes:I.NONE,value:1,offset:0},candela:{name:"candela",base:P.LUMINOUS_INTENSITY,prefixes:I.NONE,value:1,offset:0},N:{name:"N",base:P.FORCE,prefixes:I.SHORT,value:1,offset:0},newton:{name:"newton",base:P.FORCE,prefixes:I.LONG,value:1,offset:0},dyn:{name:"dyn",base:P.FORCE,prefixes:I.SHORT,value:1e-5,offset:0},dyne:{name:"dyne",base:P.FORCE,prefixes:I.LONG,value:1e-5,offset:0},lbf:{name:"lbf",base:P.FORCE,prefixes:I.NONE,value:4.4482216152605,offset:0},poundforce:{name:"poundforce",base:P.FORCE,prefixes:I.NONE,value:4.4482216152605,offset:0},kip:{name:"kip",base:P.FORCE,prefixes:I.LONG,value:4448.2216,offset:0},J:{name:"J",base:P.ENERGY,prefixes:I.SHORT,value:1,offset:0},joule:{name:"joule",base:P.ENERGY,prefixes:I.SHORT,value:1,offset:0},erg:{name:"erg",base:P.ENERGY,prefixes:I.NONE,value:1e-7,offset:0},Wh:{name:"Wh",base:P.ENERGY,prefixes:I.SHORT,value:3600,offset:0},BTU:{name:"BTU",base:P.ENERGY,prefixes:I.BTU,value:1055.05585262,offset:0},eV:{name:"eV",base:P.ENERGY,prefixes:I.SHORT,value:1602176565e-28,offset:0},electronvolt:{name:"electronvolt",base:P.ENERGY,prefixes:I.LONG,value:1602176565e-28,offset:0},W:{name:"W",base:P.POWER,prefixes:I.SHORT,value:1,offset:0},watt:{name:"watt",base:P.POWER,prefixes:I.LONG,value:1,offset:0},hp:{name:"hp",base:P.POWER,prefixes:I.NONE,value:745.6998715386,offset:0},VAR:{name:"VAR",base:P.POWER,prefixes:I.SHORT,value:C.I,offset:0},VA:{name:"VA",base:P.POWER,prefixes:I.SHORT,value:1,offset:0},Pa:{name:"Pa",base:P.PRESSURE,prefixes:I.SHORT,value:1,offset:0},psi:{name:"psi",base:P.PRESSURE,prefixes:I.NONE,value:6894.75729276459,offset:0},atm:{name:"atm",base:P.PRESSURE,prefixes:I.NONE,value:101325,offset:0},bar:{name:"bar",base:P.PRESSURE,prefixes:I.SHORTLONG,value:1e5,offset:0},torr:{name:"torr",base:P.PRESSURE,prefixes:I.NONE,value:133.322,offset:0},mmHg:{name:"mmHg",base:P.PRESSURE,prefixes:I.NONE,value:133.322,offset:0},mmH2O:{name:"mmH2O",base:P.PRESSURE,prefixes:I.NONE,value:9.80665,offset:0},cmH2O:{name:"cmH2O",base:P.PRESSURE,prefixes:I.NONE,value:98.0665,offset:0},coulomb:{name:"coulomb",base:P.ELECTRIC_CHARGE,prefixes:I.LONG,value:1,offset:0},C:{name:"C",base:P.ELECTRIC_CHARGE,prefixes:I.SHORT,value:1,offset:0},farad:{name:"farad",base:P.ELECTRIC_CAPACITANCE,prefixes:I.LONG,value:1,offset:0},F:{name:"F",base:P.ELECTRIC_CAPACITANCE,prefixes:I.SHORT,value:1,offset:0},volt:{name:"volt",base:P.ELECTRIC_POTENTIAL,prefixes:I.LONG,value:1,offset:0},V:{name:"V",base:P.ELECTRIC_POTENTIAL,prefixes:I.SHORT,value:1,offset:0},ohm:{name:"ohm",base:P.ELECTRIC_RESISTANCE,prefixes:I.SHORTLONG,value:1,offset:0},henry:{name:"henry",base:P.ELECTRIC_INDUCTANCE,prefixes:I.LONG,value:1,offset:0},H:{name:"H",base:P.ELECTRIC_INDUCTANCE,prefixes:I.SHORT,value:1,offset:0},siemens:{name:"siemens",base:P.ELECTRIC_CONDUCTANCE,prefixes:I.LONG,value:1,offset:0},S:{name:"S",base:P.ELECTRIC_CONDUCTANCE,prefixes:I.SHORT,value:1,offset:0},weber:{name:"weber",base:P.MAGNETIC_FLUX,prefixes:I.LONG,value:1,offset:0},Wb:{name:"Wb",base:P.MAGNETIC_FLUX,prefixes:I.SHORT,value:1,offset:0},tesla:{name:"tesla",base:P.MAGNETIC_FLUX_DENSITY,prefixes:I.LONG,value:1,offset:0},T:{name:"T",base:P.MAGNETIC_FLUX_DENSITY,prefixes:I.SHORT,value:1,offset:0},b:{name:"b",base:P.BIT,prefixes:I.BINARY_SHORT,value:1,offset:0},bits:{name:"bits",base:P.BIT,prefixes:I.BINARY_LONG,value:1,offset:0},B:{name:"B",base:P.BIT,prefixes:I.BINARY_SHORT,value:8,offset:0},bytes:{name:"bytes",base:P.BIT,prefixes:I.BINARY_LONG,value:8,offset:0}},F={meters:"meter",inches:"inch",feet:"foot",yards:"yard",miles:"mile",links:"link",rods:"rod",chains:"chain",angstroms:"angstrom",lt:"l",litres:"litre",liter:"litre",liters:"litre",teaspoons:"teaspoon",tablespoons:"tablespoon",minims:"minim",fluiddrams:"fluiddram",fluidounces:"fluidounce",gills:"gill",cups:"cup",pints:"pint",quarts:"quart",gallons:"gallon",beerbarrels:"beerbarrel",oilbarrels:"oilbarrel",hogsheads:"hogshead",gtts:"gtt",grams:"gram",tons:"ton",tonnes:"tonne",grains:"grain",drams:"dram",ounces:"ounce",poundmasses:"poundmass",hundredweights:"hundredweight",sticks:"stick",lb:"lbm",lbs:"lbm",kips:"kip",acres:"acre",hectares:"hectare",sqfeet:"sqft",sqyard:"sqyd",sqmile:"sqmi",sqmiles:"sqmi",mmhg:"mmHg",mmh2o:"mmH2O",cmh2o:"cmH2O",seconds:"second",secs:"second",minutes:"minute",mins:"minute",hours:"hour",hr:"hour",hrs:"hour",days:"day",weeks:"week",months:"month",years:"year",decades:"decade",centuries:"century",millennia:"millennium",hertz:"hertz",radians:"radian",degrees:"degree",gradians:"gradian",cycles:"cycle",arcsecond:"arcsec",arcseconds:"arcsec",arcminute:"arcmin",arcminutes:"arcmin",BTUs:"BTU",watts:"watt",joules:"joule",amperes:"ampere",coulombs:"coulomb",volts:"volt",ohms:"ohm",farads:"farad",webers:"weber",teslas:"tesla",electronvolts:"electronvolt",moles:"mole"};function B(t){if("BigNumber"===t.number){var n=constants$2.pi(e.BigNumber);M.rad.value=new e.BigNumber(1),M.deg.value=n.div(180),M.grad.value=n.div(200),M.cycle.value=n.times(2),M.arcsec.value=n.div(648e3),M.arcmin.value=n.div(10800)}else M.rad.value=1,M.deg.value=Math.PI/180,M.grad.value=Math.PI/200,M.cycle.value=2*Math.PI,M.arcsec.value=Math.PI/648e3,M.arcmin.value=Math.PI/10800;M.radian.value=M.rad.value,M.degree.value=M.deg.value,M.gradian.value=M.grad.value}B(t),a.on("config",(function(e,t){e.number!==t.number&&B(e)}));var L={si:{NONE:{unit:k,prefix:I.NONE[""]},LENGTH:{unit:M.m,prefix:I.SHORT[""]},MASS:{unit:M.g,prefix:I.SHORT.k},TIME:{unit:M.s,prefix:I.SHORT[""]},CURRENT:{unit:M.A,prefix:I.SHORT[""]},TEMPERATURE:{unit:M.K,prefix:I.SHORT[""]},LUMINOUS_INTENSITY:{unit:M.cd,prefix:I.SHORT[""]},AMOUNT_OF_SUBSTANCE:{unit:M.mol,prefix:I.SHORT[""]},ANGLE:{unit:M.rad,prefix:I.SHORT[""]},BIT:{unit:M.bit,prefix:I.SHORT[""]},FORCE:{unit:M.N,prefix:I.SHORT[""]},ENERGY:{unit:M.J,prefix:I.SHORT[""]},POWER:{unit:M.W,prefix:I.SHORT[""]},PRESSURE:{unit:M.Pa,prefix:I.SHORT[""]},ELECTRIC_CHARGE:{unit:M.C,prefix:I.SHORT[""]},ELECTRIC_CAPACITANCE:{unit:M.F,prefix:I.SHORT[""]},ELECTRIC_POTENTIAL:{unit:M.V,prefix:I.SHORT[""]},ELECTRIC_RESISTANCE:{unit:M.ohm,prefix:I.SHORT[""]},ELECTRIC_INDUCTANCE:{unit:M.H,prefix:I.SHORT[""]},ELECTRIC_CONDUCTANCE:{unit:M.S,prefix:I.SHORT[""]},MAGNETIC_FLUX:{unit:M.Wb,prefix:I.SHORT[""]},MAGNETIC_FLUX_DENSITY:{unit:M.T,prefix:I.SHORT[""]},FREQUENCY:{unit:M.Hz,prefix:I.SHORT[""]}}};L.cgs=JSON.parse(JSON.stringify(L.si)),L.cgs.LENGTH={unit:M.m,prefix:I.SHORT.c},L.cgs.MASS={unit:M.g,prefix:I.SHORT[""]},L.cgs.FORCE={unit:M.dyn,prefix:I.SHORT[""]},L.cgs.ENERGY={unit:M.erg,prefix:I.NONE[""]},L.us=JSON.parse(JSON.stringify(L.si)),L.us.LENGTH={unit:M.ft,prefix:I.NONE[""]},L.us.MASS={unit:M.lbm,prefix:I.NONE[""]},L.us.TEMPERATURE={unit:M.degF,prefix:I.NONE[""]},L.us.FORCE={unit:M.lbf,prefix:I.NONE[""]},L.us.ENERGY={unit:M.BTU,prefix:I.BTU[""]},L.us.POWER={unit:M.hp,prefix:I.NONE[""]},L.us.PRESSURE={unit:M.psi,prefix:I.NONE[""]},L.auto=JSON.parse(JSON.stringify(L.si));var j=L.auto;for(var D in N.setUnitSystem=function(e){if(!L.hasOwnProperty(e))throw new Error("Unit system "+e+" does not exist. Choices are: "+Object.keys(L).join(", "));j=L[e]},N.getUnitSystem=function(){for(var e in L)if(L[e]===j)return e},N.typeConverters={BigNumber:function(t){return new e.BigNumber(t+"")},Fraction:function(t){return new e.Fraction(t)},Complex:function(e){return e},number:function(e){return e}},N._getNumberConverter=function(e){if(!N.typeConverters[e])throw new TypeError('Unsupported type "'+e+'"');return N.typeConverters[e]},M)(z=M[D]).dimensions=z.base.dimensions;for(var U in F)if(F.hasOwnProperty(U)){var z=M[F[U]],H={};for(var D in z)z.hasOwnProperty(D)&&(H[D]=z[D]);H.name=U,M[U]=H}return N.createUnit=function(e,t){if("object"!=typeof e)throw new TypeError("createUnit expects first parameter to be of type 'Object'");if(t&&t.override)for(var n in e)if(e.hasOwnProperty(n)&&N.deleteUnit(n),e[n].aliases)for(var r=0;r<e[n].aliases.length;r++)N.deleteUnit(e[n].aliases[r]);var a;for(var n in e)e.hasOwnProperty(n)&&(a=N.createUnitSingle(n,e[n]));return a},N.createUnitSingle=function(e,t,n){if(null==t&&(t={}),"string"!=typeof e)throw new TypeError("createUnitSingle expects first parameter to be of type 'string'");if(M.hasOwnProperty(e))throw new Error('Cannot create unit "'+e+'": a unit with that name already exists');!function(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),r=function(e){return/^[a-zA-Z]$/.test(e)};if(0===t&&!r(n))throw new Error('Invalid unit name (must begin with alpha character): "'+e+'"');if(t>0&&!r(n)&&!function(e){return e>="0"&&e<="9"}(n))throw new Error('Invalid unit name (only alphanumeric characters are allowed): "'+e+'"')}}(e);var r,a,i=null,o=[],s=0;if(t&&"Unit"===t.type)i=t.clone();else if("string"==typeof t)""!==t&&(r=t);else{if("object"!=typeof t)throw new TypeError('Cannot create unit "'+e+'" from "'+t.toString()+'": expecting "string" or "Unit" or "Object"');r=t.definition,a=t.prefixes,s=t.offset,t.aliases&&(o=t.aliases.valueOf())}if(o)for(var l=0;l<o.length;l++)if(M.hasOwnProperty(o[l]))throw new Error('Cannot create alias "'+o[l]+'": a unit with that name already exists');if(r&&"string"==typeof r&&!i)try{i=N.parse(r,{allowNoUnits:!0})}catch(t){throw t.message='Could not create unit "'+e+'" from "'+r+'": '+t.message,t}else r&&"Unit"===r.type&&(i=r.clone());o=o||[],s=s||0,a=a&&a.toUpperCase&&I[a.toUpperCase()]||I.NONE;var u={};if(i){u={name:e,value:i.value,dimensions:i.dimensions.slice(0),prefixes:a,offset:s};var c=!1;for(var l in P)if(P.hasOwnProperty(l)){for(var p=!0,d=0;d<R.length;d++)if(Math.abs((u.dimensions[d]||0)-(P[l].dimensions[d]||0))>1e-12){p=!1;break}if(p){c=!0;break}}c||(m=e+"_STUFF",(h={dimensions:i.dimensions.slice(0)}).key=m,P[m]=h,j[m]={unit:u,prefix:I.NONE[""]},u.base=m)}else{var m=e+"_STUFF";if(R.indexOf(m)>=0)throw new Error('Cannot create new base unit "'+e+'": a base unit with that name already exists (and cannot be overridden)');for(var f in R.push(m),P)P.hasOwnProperty(f)&&(P[f].dimensions[R.length-1]=0);var h={dimensions:[]};for(l=0;l<R.length;l++)h.dimensions[l]=0;h.dimensions[R.length-1]=1,h.key=m,P[m]=h,u={name:e,value:1,dimensions:P[m].dimensions.slice(0),prefixes:a,offset:s,base:m},j[m]={unit:u,prefix:I.NONE[""]}}for(N.UNITS[e]=u,l=0;l<o.length;l++){var y=o[l],b={};for(var g in u)u.hasOwnProperty(g)&&(b[g]=u[g]);b.name=y,N.UNITS[y]=b}return new N(null,e)},N.deleteUnit=function(e){delete N.UNITS[e]},N.PREFIXES=I,N.BASE_DIMENSIONS=R,N.BASE_UNITS=P,N.UNIT_SYSTEMS=L,N.UNITS=M,N}var name$3="Unit",path="type",factory_1$5=factory$5,math$2=!0,Unit={name:name$3,path:path,factory:factory_1$5,math:math$2};function factory$4(e,t,n,r){var a=r("unit",{Unit:function(e){return e.clone()},string:function(t){return e.Unit.isValuelessUnit(t)?new e.Unit(null,t):e.Unit.parse(t)},"number | BigNumber | Fraction | Complex, string":function(t,n){return new e.Unit(t,n)},"Array | Matrix":function(e){return deepMap(e,a)}});return a.toTex={1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},a}var name$2="unit",factory_1$4=factory$4,unit$1={name:name$2,factory:factory_1$4};function factory$3(e,t,n,r){var a=r("createUnit",{"Object, Object":function(t,n){return e.Unit.createUnit(t,n)},Object:function(t){return e.Unit.createUnit(t,{})},"string, Unit | string | Object, Object":function(t,n,r){var a={};return a[t]=n,e.Unit.createUnit(a,r)},"string, Unit | string | Object":function(t,n){var r={};return r[t]=n,e.Unit.createUnit(r,{})},string:function(t){var n={};return n[t]={},e.Unit.createUnit(n,{})}});return a}var name$1="createUnit",factory_1$3=factory$3,createUnit={name:name$1,factory:factory_1$3};function factory$2(e,t,n,r){var a=r("splitUnit",{"Unit, Array":function(e,t){return e.splitUnit(t)}});return a}var name="splitUnit",factory_1$2=factory$2,splitUnit={name:name,factory:factory_1$2},lazy$1=object$6.lazy;function factory$1(e,t,n,r,a){function i(t){var n=e.Unit.parse(t);return n.fixPrefix=!0,n}setLazyConstant$1(a,"speedOfLight",(function(){return i("299792458 m s^-1")})),setLazyConstant$1(a,"gravitationConstant",(function(){return i("6.6738480e-11 m^3 kg^-1 s^-2")})),setLazyConstant$1(a,"planckConstant",(function(){return i("6.626069311e-34 J s")})),setLazyConstant$1(a,"reducedPlanckConstant",(function(){return i("1.05457172647e-34 J s")})),setLazyConstant$1(a,"magneticConstant",(function(){return i("1.2566370614e-6 N A^-2")})),setLazyConstant$1(a,"electricConstant",(function(){return i("8.854187817e-12 F m^-1")})),setLazyConstant$1(a,"vacuumImpedance",(function(){return i("376.730313461 ohm")})),setLazyConstant$1(a,"coulomb",(function(){return i("8.9875517873681764e9 N m^2 C^-2")})),setLazyConstant$1(a,"elementaryCharge",(function(){return i("1.60217656535e-19 C")})),setLazyConstant$1(a,"bohrMagneton",(function(){return i("9.2740096820e-24 J T^-1")})),setLazyConstant$1(a,"conductanceQuantum",(function(){return i("7.748091734625e-5 S")})),setLazyConstant$1(a,"inverseConductanceQuantum",(function(){return i("12906.403721742 ohm")})),setLazyConstant$1(a,"magneticFluxQuantum",(function(){return i("2.06783375846e-15 Wb")})),setLazyConstant$1(a,"nuclearMagneton",(function(){return i("5.0507835311e-27 J T^-1")})),setLazyConstant$1(a,"klitzing",(function(){return i("25812.807443484 ohm")})),setLazyConstant$1(a,"bohrRadius",(function(){return i("5.291772109217e-11 m")})),setLazyConstant$1(a,"classicalElectronRadius",(function(){return i("2.817940326727e-15 m")})),setLazyConstant$1(a,"electronMass",(function(){return i("9.1093829140e-31 kg")})),setLazyConstant$1(a,"fermiCoupling",(function(){return i("1.1663645e-5 GeV^-2")})),setLazyConstant$1(a,"fineStructure",(function(){return.007297352569824})),setLazyConstant$1(a,"hartreeEnergy",(function(){return i("4.3597443419e-18 J")})),setLazyConstant$1(a,"protonMass",(function(){return i("1.67262177774e-27 kg")})),setLazyConstant$1(a,"deuteronMass",(function(){return i("3.3435830926e-27 kg")})),setLazyConstant$1(a,"neutronMass",(function(){return i("1.6749271613e-27 kg")})),setLazyConstant$1(a,"quantumOfCirculation",(function(){return i("3.636947552024e-4 m^2 s^-1")})),setLazyConstant$1(a,"rydberg",(function(){return i("10973731.56853955 m^-1")})),setLazyConstant$1(a,"thomsonCrossSection",(function(){return i("6.65245873413e-29 m^2")})),setLazyConstant$1(a,"weakMixingAngle",(function(){return.222321})),setLazyConstant$1(a,"efimovFactor",(function(){return 22.7})),setLazyConstant$1(a,"atomicMass",(function(){return i("1.66053892173e-27 kg")})),setLazyConstant$1(a,"avogadro",(function(){return i("6.0221412927e23 mol^-1")})),setLazyConstant$1(a,"boltzmann",(function(){return i("1.380648813e-23 J K^-1")})),setLazyConstant$1(a,"faraday",(function(){return i("96485.336521 C mol^-1")})),setLazyConstant$1(a,"firstRadiation",(function(){return i("3.7417715317e-16 W m^2")})),setLazyConstant$1(a,"loschmidt",(function(){return i("2.686780524e25 m^-3")})),setLazyConstant$1(a,"gasConstant",(function(){return i("8.314462175 J K^-1 mol^-1")})),setLazyConstant$1(a,"molarPlanckConstant",(function(){return i("3.990312717628e-10 J s mol^-1")})),setLazyConstant$1(a,"molarVolume",(function(){return i("2.241396820e-10 m^3 mol^-1")})),setLazyConstant$1(a,"sackurTetrode",(function(){return-1.164870823})),setLazyConstant$1(a,"secondRadiation",(function(){return i("1.438777013e-2 m K")})),setLazyConstant$1(a,"stefanBoltzmann",(function(){return i("5.67037321e-8 W m^-2 K^-4")})),setLazyConstant$1(a,"wienDisplacement",(function(){return i("2.897772126e-3 m K")})),setLazyConstant$1(a,"molarMass",(function(){return i("1e-3 kg mol^-1")})),setLazyConstant$1(a,"molarMassC12",(function(){return i("1.2e-2 kg mol^-1")})),setLazyConstant$1(a,"gravity",(function(){return i("9.80665 m s^-2")})),setLazyConstant$1(a,"planckLength",(function(){return i("1.61619997e-35 m")})),setLazyConstant$1(a,"planckMass",(function(){return i("2.1765113e-8 kg")})),setLazyConstant$1(a,"planckTime",(function(){return i("5.3910632e-44 s")})),setLazyConstant$1(a,"planckCharge",(function(){return i("1.87554595641e-18 C")})),setLazyConstant$1(a,"planckTemperature",(function(){return i("1.41683385e+32 K")}))}function setLazyConstant$1(e,t,n){lazy$1(e,t,n),lazy$1(e.expression.mathWithTransform,t,n)}var factory_1$1=factory$1,lazy_1=!1,math$1=!0,physicalConstants={factory:factory_1$1,lazy:lazy_1,math:math$1},unit=[Unit,unit$1,createUnit,splitUnit,physicalConstants],type=[bignumber$1,boolean_1$2,chain$1,complex$2,fraction$1,matrix$4,number$2,resultset,string$4,unit],version$1="4.4.2";function factory(e,t,n,r,a){a.on("config",(function(i,o){i.number!==o.number&&factory(e,t,n,r,a)})),setConstant(a,"true",!0),setConstant(a,"false",!1),setConstant(a,"null",null),setConstant(a,"uninitialized","Error: Constant uninitialized is removed since v4.0.0. Use null instead"),"BigNumber"===t.number?(setConstant(a,"Infinity",new e.BigNumber(1/0)),setConstant(a,"NaN",new e.BigNumber(NaN)),setLazyConstant(a,"pi",(function(){return constants$2.pi(e.BigNumber)})),setLazyConstant(a,"tau",(function(){return constants$2.tau(e.BigNumber)})),setLazyConstant(a,"e",(function(){return constants$2.e(e.BigNumber)})),setLazyConstant(a,"phi",(function(){return constants$2.phi(e.BigNumber)})),setLazyConstant(a,"E",(function(){return a.e})),setLazyConstant(a,"LN2",(function(){return new e.BigNumber(2).ln()})),setLazyConstant(a,"LN10",(function(){return new e.BigNumber(10).ln()})),setLazyConstant(a,"LOG2E",(function(){return new e.BigNumber(1).div(new e.BigNumber(2).ln())})),setLazyConstant(a,"LOG10E",(function(){return new e.BigNumber(1).div(new e.BigNumber(10).ln())})),setLazyConstant(a,"PI",(function(){return a.pi})),setLazyConstant(a,"SQRT1_2",(function(){return new e.BigNumber("0.5").sqrt()})),setLazyConstant(a,"SQRT2",(function(){return new e.BigNumber(2).sqrt()}))):(setConstant(a,"Infinity",1/0),setConstant(a,"NaN",NaN),setConstant(a,"pi",Math.PI),setConstant(a,"tau",2*Math.PI),setConstant(a,"e",Math.E),setConstant(a,"phi",1.618033988749895),setConstant(a,"E",a.e),setConstant(a,"LN2",Math.LN2),setConstant(a,"LN10",Math.LN10),setConstant(a,"LOG2E",Math.LOG2E),setConstant(a,"LOG10E",Math.LOG10E),setConstant(a,"PI",a.pi),setConstant(a,"SQRT1_2",Math.SQRT1_2),setConstant(a,"SQRT2",Math.SQRT2)),setConstant(a,"i",e.Complex.I),setConstant(a,"version",version$1)}function setConstant(e,t,n){e[t]=n,e.expression.mathWithTransform[t]=n}function setLazyConstant(e,t,n){object$6.lazy(e,t,n),object$6.lazy(e.expression.mathWithTransform,t,n)}var factory_1=factory,lazy=!1,math=!0,constants={factory:factory_1,lazy:lazy,math:math},lib=[type,constants,expression,_function,json,error];function create(e){var t=core.create(e);return t.create=create,t.import(lib),t}var mathjs=create(),node$1=mathjs.expression.node;const operators$2={"+":function(e){return new node$1.OperatorNode("+","add",e)},"*":function(e){return new node$1.OperatorNode("*","multiply",e)},"/":function(e){return new node$1.OperatorNode("/","divide",e)},"-":function(e){return new node$1.OperatorNode("-","unaryMinus",[e[0]])},"^":function(e){return new node$1.OperatorNode("^","pow",e)},vector:function(e){return new node$1.ArrayNode(e)},and:function(e){return new node$1.OperatorNode("and","and",e)},or:function(e){return new node$1.OperatorNode("or","or",e)},not:function(e){return new node$1.OperatorNode("not","not",[e[0]])},"<":function(e){return new node$1.OperatorNode("<","smaller",e)},">":function(e){return new node$1.OperatorNode(">","larger",e)},le:function(e){return new node$1.OperatorNode("<=","smallerEq",e)},ge:function(e){return new node$1.OperatorNode(">=","largerEq",e)},ne:function(e){return new node$1.OperatorNode("!=","unequal",e)}};class astToMathjs$1{constructor({mathjs:e=null}={}){e&&(node$1=e.expression.node)}convert(e){if("number"==typeof e)return Number.isFinite(e)?new node$1.ConstantNode(e):Number.isNaN(e)?new node$1.SymbolNode("NaN"):e<0?operators$2["-"]([new node$1.SymbolNode("Infinity")]):new node$1.SymbolNode("Infinity");if("string"==typeof e)return new node$1.SymbolNode(e);if("boolean"==typeof e)throw Error("no support for boolean");if(!Array.isArray(e))throw Error("Invalid ast");const t=e[0],n=e.slice(1);if("apply"===t){if("string"!=typeof n[0])throw Error("Non string functions not implemented for conversion to mathjs");if("factorial"===n[0])return new node$1.OperatorNode("!","factorial",[this.convert(n[1])]);const e=new node$1.SymbolNode(n[0]),t=n[1];let r;return r="tuple"===t[0]?t.slice(1).map(function(e,t){return this.convert(e)}.bind(this)):[this.convert(t)],new node$1.FunctionNode(e,r)}if("lts"===t||"gts"===t){const e=n[0],r=n[1];if("tuple"!==e[0]||"tuple"!==r[0])throw new Error("Badly formed ast");const a=e.slice(1).map(function(e,t){return this.convert(e)}.bind(this));let i=[];for(let n=1;n<e.length-1;n++)r[n]?"lts"===t?i.push(new node$1.OperatorNode("<","smaller",a.slice(n-1,n+1))):i.push(new node$1.OperatorNode(">","larger",a.slice(n-1,n+1))):"lts"===t?i.push(new node$1.OperatorNode("<=","smallerEq",a.slice(n-1,n+1))):i.push(new node$1.OperatorNode(">=","largerEq",a.slice(n-1,n+1)));let o=new node$1.OperatorNode("and","and",i.slice(0,2));for(let e=2;e<i.length;e++)o=new node$1.OperatorNode("and","and",[o,i[e]]);return o}if("="===t){let e=n.map(function(e,t){return this.convert(e)}.bind(this)),t=[];for(let n=1;n<e.length;n++)t.push(new node$1.OperatorNode("==","equal",e.slice(n-1,n+1)));if(1===t.length)return t[0];let r=new node$1.OperatorNode("and","and",t.slice(0,2));for(let e=2;e<t.length;e++)r=new node$1.OperatorNode("and","and",[r,t[e]]);return r}if("in"===t||"notin"===t||"ni"===t||"notni"===t){let e,r;if("in"===t||"notin"===t?(e=n[0],r=n[1]):(e=n[1],r=n[0]),"number"!=typeof e&&"string"!=typeof e)throw Error("Set membership non-string variables not implemented for conversion to mathjs");if(e=this.convert(e),"interval"!==r[0])throw Error("Set membership in non-intervals not implemented for conversion to mathjs");let a=r[1],i=r[2];if("tuple"!==a[0]||"tuple"!==i[0])throw new Error("Badly formed ast");let o=this.convert(a[1]),s=this.convert(a[2]),l=[];i[1]?l.push(new node$1.OperatorNode(">=","largerEq",[e,o])):l.push(new node$1.OperatorNode(">","larger",[e,o])),i[2]?l.push(new node$1.OperatorNode("<=","smallerEq",[e,s])):l.push(new node$1.OperatorNode("<","smaller",[e,s]));let u=new node$1.OperatorNode("and","and",l);return"notin"!==t&&"notni"!==t||(u=new node$1.OperatorNode("not","not",[u])),u}if("subset"===t||"notsubset"===t||"superset"===t||"notsuperset"===t){let e,r;if("subset"===t||"notsubset"===t?(r=n[0],e=n[1]):(r=n[1],e=n[0]),"interval"!==r[0]||"interval"!==e[0])throw Error("Set containment of non-intervals not implemented for conversion to mathjs");let a=r[1],i=r[2],o=e[1],s=e[2];if("tuple"!==a[0]||"tuple"!==i[0]||"tuple"!==o[0]||"tuple"!==s[0])throw Error("Badly formed ast");let l=this.convert(a[1]),u=this.convert(a[2]),c=this.convert(o[1]),p=this.convert(o[2]),d=[];i[1]&&!s[1]?d.push(new node$1.OperatorNode(">","larger",[l,c])):d.push(new node$1.OperatorNode(">=","largerEq",[l,c])),i[2]&&!s[2]?d.push(new node$1.OperatorNode("<","smaller",[u,p])):d.push(new node$1.OperatorNode("<=","smallerEq",[u,p]));let m=new node$1.OperatorNode("and","and",d);return"notsubset"!==t&&"notsuperset"!==t||(m=new node$1.OperatorNode("not","not",[m])),m}if("matrix"===t){let e=n[0],t=e[1],r=e[2],a=n[1];if(!Number.isInteger(t)||!Number.isInteger(r))throw Error("Matrix must have integer dimensions");let i=[];for(let e=1;e<=t;e++){let t=[];for(let n=1;n<=r;n++)t.push(this.convert(a[e][n]));i.push(new node$1.ArrayNode(t))}return new node$1.ArrayNode(i)}if(t in operators$2)return operators$2[t](n.map(function(e,t){return this.convert(e)}.bind(this)));throw Error("Operator "+t+" not implemented for conversion to mathjs")}}var function_normalizations={ln:"log",arccos:"acos",arccosh:"acosh",arcsin:"asin",arcsinh:"asinh",arctan:"atan",arctanh:"atanh",arcsec:"asec",arcsech:"asech",arccsc:"acsc",arccsch:"acsch",arccot:"acot",arccoth:"acoth",cosec:"csc"};function normalize_function_names(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if("apply"===n){if("sqrt"===r[0])return["^",normalize_function_names(r[1]),.5];var a=normalize_function_names_sub(r[0]);a=["apply",a];var i=r.slice(1).map((function(e){return normalize_function_names(e)}));return i=i.length>1?["tuple"].concat(i):i[0],a.push(i),a}return"^"===n&&"e"===r[0]&&math$3.define_e?["apply","exp",normalize_function_names(r[1])]:[n].concat(r.map((function(e){return normalize_function_names(e)})))}function normalize_function_names_sub(e){if("string"==typeof e)return e in function_normalizations?function_normalizations[e]:e;if(!Array.isArray(e))return e;var t=e[0],n=e.slice(1);return[t].concat(n.map((function(e){return normalize_function_names_sub(e)})))}function normalize_applied_functions(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if("apply"===n){let e=strip_function_names(r[0]),t=["apply",e.tree,r[1]];for(let n=0;n<e.n_primes;n++)t=["prime",t];return void 0!==e.exponent&&(t=["^",t,e.exponent]),t}return[n].concat(r.map((function(e,t){return normalize_applied_functions(e)})))}function strip_function_names(e){if(!Array.isArray(e))return{tree:e,n_primes:0};var t=e[0],n=e.slice(1);if("^"===t){let e=strip_function_names(n[0]),t=normalize_applied_functions(n[1]);return e.exponent=t,e}if("prime"===t){let e=strip_function_names(n[0]);return e.n_primes+=1,e}return{tree:normalize_applied_functions(e),n_primes:0}}function substitute_abs(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);return"apply"===n&&"abs"===r[0]?["^",["^",substitute_abs(r[1]),2],.5]:[n].concat(r.map((function(e){return substitute_abs(e)})))}function constants_to_floats(e){var t=get_tree(e);if(!math$3.define_e&&!math$3.define_pi)return t;if("string"==typeof t){if("e"===t){if(math$3.define_e)return math$3.e}else if("pi"===t&&math$3.define_pi)return math$3.pi;return t}if(!Array.isArray(t))return t;let n=t[0],r=t.slice(1);return"^"===n&&"e"===r[0]?["^","e",constants_to_floats(r[1])]:[n,...r.map(constants_to_floats)]}var astToMathjs=new astToMathjs$1({mathjs:math$3});const f=function(e){var t=get_tree(e),n=factorial_to_gamma_function(astToMathjs.convert(normalize_function_names(normalize_applied_functions(t))));return n.eval.bind(n)},evaluate=function(e,t){return f(e)(t)},evaluate_to_constant=function(e){var t=get_tree(e);if("number"==typeof t)return t;if("string"==typeof t)return"pi"===t&&math$3.define_pi?Math.PI:"e"===t&&math$3.define_e?Math.E:"i"===t&&math$3.define_i?{re:0,im:1}:null;var n=null;try{n=f(e)()}catch(e){}return n};function factorial_to_gamma_function(e){var t=e.transform((function(e,t,n){if(e.isOperatorNode&&"!"===e.op&&"factorial"===e.fn){var r=[new math$3.expression.node.OperatorNode("+","add",[e.args[0],new math$3.expression.node.ConstantNode(1)])];return new math$3.expression.node.FunctionNode(new math$3.expression.node.SymbolNode("gamma"),r)}return e}));return t}var evaluation=Object.freeze({__proto__:null,f:f,evaluate:evaluate,evaluate_to_constant:evaluate_to_constant}),functions={C:{},R:{},nonzeroC:{},nonneg:{},pos:{}};function negate_adjust(e,t){return e?!t:!1===e?t:void 0}function narrow_assumptions(e,t){if(!Array.isArray(t))return[];var n=t[0],r=t.slice(1);if("and"!==n)return[];for(var a=[],i=0;i<r.length;i++)equal(r[i],e)||a.push(r[i]);return 0===a.length?[]:1===a.legnth?a[0]:[n].concat(a)}function simple_assumption_combination(e,t,n){return"and"===e?void 0===t?n:void 0===n?t:t||n:void 0!==t&&void 0!==n&&t===n?t:void 0}function is_integer_ast(e,t,n){if("object"!=typeof t&&(t=[]),void 0===n&&(n=t),"number"==typeof e)return Number.isInteger(e);var r=evaluate_to_constant(e);if(null!==r)return Number.isInteger(r);if("string"==typeof e){let r;if(r=Array.isArray(t)?t:t.get_assumptions(e),!Array.isArray(r))return;let a=r,i=r[0],o=r.slice(1),s=!1;for(;"not"===i;){if(s=!s,r=o[0],!Array.isArray(r))return;i=r[0],o=r.slice(1)}if("in"===i&&o[0]===e&&"Z"===o[1])return negate_adjust(!0,s);if("notin"===i&&o[0]===e&&"Z"===o[1])return negate_adjust(!1,s);if(!1===s){if("notin"===i){if(o[0]===e&&"R"===o[1])return!1;if(o[0]===e&&"C"===o[1])return!1}}else if("in"===i){if(o[0]===e&&"R"===o[1])return!1;if(o[0]===e&&"Z"===o[1])return!1}if("="===i&&!s||"ne"===i&&s){let t=narrow_assumptions(a,n);if(o[0]===e)return is_integer_ast(o[1],t);if(o[1]===e)return is_integer_ast(o[0],t)}if("and"!==i&&"or"!==i)return;if(s)return;return o.length>2&&(r=unflattenRight(r),o=r.slice(1)),simple_assumption_combination(i,is_integer_ast(e,o[0],n),is_integer_ast(e,o[1],n))}if(Array.isArray(e)){let r;r=Array.isArray(t)?t:t.get_assumptions([variables(e)]);let a=e[0],i=e.slice(1);if("-"===a)return is_integer_ast(i[0],r,n);if("*"===a)return!!i.every((function(e){return is_integer_ast(e,r,n)}))||void 0;if("^"===a){let e=is_nonzero_ast(i[0],r,n);if(e){if(!1===is_nonzero_ast(i[1],r,n))return i[0]!==1/0&&i[0]!==-1/0}else{if(Number.isNaN(i[0]))return!1;if(!is_positive_ast(i[1],r,!0,n))return;if(!1===e)return!0}let t=is_integer_ast(i[0],r,n),a=is_integer_ast(i[1],r,n);if(!t)return t;if(!a)return;return!!is_positive_ast(i[1],r,!1,n)||void 0}if("+"===a){let e=0;for(let t=0;t<i.length;t++){let a=is_integer_ast(i[t],r,n);if(!1===a){if(e>0)return;e+=1}if(void 0===a)return}return 0===e}if("apply"===a)return!!(functions.C.Z&&functions.C.Z.includes(i[0])&&is_complex_ast(i[1],r,n))||!!(functions.R.Z&&functions.R.Z.includes(i[0])&&is_real_ast(i[1],r,n))||!!(functions.nonzeroC.Z&&functions.nonzeroC.Z.includes(i[0])&&is_nonzero_ast(i[1],r,n)&&is_complex_ast(i[1],r,n))||!!(functions.nonneg.Z&&functions.nonneg.Z.includes(i[0])&&is_positive_ast(i[1],r,!1,n))||!!(functions.pos.Z&&functions.pos.Z.includes(i[0])&&is_positive_ast(i[1],r,!0,n))||void 0;if("/"===a||"prime"===a)return;return!1}return!1}function is_real_ast(e,t,n){if("object"!=typeof t&&(t=[]),void 0===n&&(n=t),"number"==typeof e)return Number.isFinite(e);var r=evaluate_to_constant(e);if(null!==r)return"number"==typeof r&&Number.isFinite(r);if("string"==typeof e){let r;if(r=Array.isArray(t)?t:t.get_assumptions(e),!Array.isArray(r))return;let a=r,i=r[0],o=r.slice(1),s=!1;for(;"not"===i;){if(s=!s,r=o[0],!Array.isArray(r))return;i=r[0],o=r.slice(1)}if("in"===i&&o[0]===e&&"R"===o[1])return negate_adjust(!0,s);if("notin"===i&&o[0]===e&&"R"===o[1])return negate_adjust(!1,s);if(!1===s){if("in"===i&&o[0]===e&&"Z"===o[1])return!0}else if("notin"===i&&o[0]===e&&"Z"===o[1])return!0;if("<"===i||"le"===i){let t=variables(r),n=functions$2(r);if(-1!==t.indexOf(e)&&0===n.length)return!0}if("="===i&&!s||"ne"===i&&s){let t=narrow_assumptions(a,n);if(o[0]===e)return is_real_ast(o[1],t);if(o[1]===e)return is_real_ast(o[0],t)}if("and"!==i&&"or"!==i)return;if(s)return;return o.length>2&&(r=unflattenRight(r),o=r.slice(1)),simple_assumption_combination(i,is_real_ast(e,o[0],n),is_real_ast(e,o[1],n))}if(Array.isArray(e)){let r;r=Array.isArray(t)?t:t.get_assumptions([variables(e)]);let a=e[0],i=e.slice(1);if("-"===a)return is_real_ast(i[0],r,n);if("*"===a||"+"===a){if(i.length>2&&(i=(e=unflattenRight(e)).slice(1)),"*"===a&&(!1===is_nonzero_ast(i[0],r,n)||!1===is_nonzero_ast(i[1],r,n)))return!0;let t=is_real_ast(i[0],r,n),o=is_real_ast(i[1],r,n);return!(!t||!o)||!(t&&!1===o||o&&!1===t)&&void 0}if("^"===a){let e=is_nonzero_ast(i[0],r,n),t=is_positive_ast(i[1],r,!0,n);if(e){if(!1===is_nonzero_ast(i[1],r,n))return i[0]!==1/0&&i[0]!==-1/0}else{if(Number.isNaN(i[0]))return!1;if(!t)return;if(!1===e)return!0}let a=is_real_ast(i[0],r,n),o=is_real_ast(i[1],r,n);if(!a||!o)return;return is_positive_ast(i[0],r,!1,n)?!!is_positive_ast(i[0],r,!0,n)||!!t||void 0:!!is_integer_ast(i[1],r,n)||void 0}if("/"===a){if(!is_nonzero_ast(i[1],r,n))return;if(!1===is_nonzero_ast(i[0],r,n))return!0;if(!is_real_ast(i[0],r,n)||!is_real_ast(i[1],r,n))return;return!0}if("apply"===a)return!!(functions.C.R&&functions.C.R.includes(i[0])&&is_complex_ast(i[1],r,n))||!!(functions.R.R&&functions.R.R.includes(i[0])&&is_real_ast(i[1],r,n))||!!(functions.nonzeroC.R&&functions.nonzeroC.R.includes(i[0])&&is_nonzero_ast(i[1],r,n)&&is_complex_ast(i[1],r,n))||!!(functions.nonneg.R&&functions.nonneg.R.includes(i[0])&&is_positive_ast(i[1],r,!1,n))||!!(functions.pos.R&&functions.pos.R.includes(i[0])&&is_positive_ast(i[1],r,!0,n))||void 0;if("prime"===a)return;return!1}return!1}function is_complex_ast(e,t,n){if("object"!=typeof t&&(t=[]),void 0===n&&(n=t),"number"==typeof e)return Number.isFinite(e);var r=evaluate_to_constant(e);if(null!==r)return"number"==typeof r?Number.isFinite(r):!(void 0===r.re||!Number.isFinite(r.re)||void 0===r.im||!Number.isFinite(r.im));if("string"==typeof e){let r;if(r=Array.isArray(t)?t:t.get_assumptions(e),!Array.isArray(r))return;let a=r,i=r[0],o=r.slice(1),s=!1;for(;"not"===i;){if(s=!s,r=o[0],!Array.isArray(r))return;i=r[0],o=r.slice(1)}if("in"===i&&o[0]===e&&"C"===o[1])return negate_adjust(!0,s);if("notin"===i&&o[0]===e&&"C"===o[1])return negate_adjust(!1,s);if(!1===s){if("in"===i){if(o[0]===e&&"Z"===o[1])return!0;if(o[0]===e&&"R"===o[1])return!0}}else if("notin"===i){if(o[0]===e&&"Z"===o[1])return!0;if(o[0]===e&&"R"===o[1])return!0}if("<"===i||"le"===i){let t=variables(r),n=functions$2(r);if(-1!==t.indexOf(e)&&0===n.length)return!0}if("="===i&&!s||"ne"===i&&s){let t=narrow_assumptions(a,n);if(o[0]===e)return is_complex_ast(o[1],t);if(o[1]===e)return is_complex_ast(o[0],t)}if("and"!==i&&"or"!==i)return;if(s)return;return o.length>2&&(r=unflattenRight(r),o=r.slice(1)),simple_assumption_combination(i,is_complex_ast(e,o[0],n),is_complex_ast(e,o[1],n))}if(Array.isArray(e)){let r;r=Array.isArray(t)?t:t.get_assumptions([variables(e)]);let a=e[0],i=e.slice(1);if("-"===a)return is_complex_ast(i[0],r,n);if("*"===a||"+"===a)return"*"===a&&!i.every((e=>!1!==is_nonzero_ast(e,r,n)))||(!!i.every((e=>is_complex_ast(e,r,n)))||void 0);if("^"===a){let e=is_nonzero_ast(i[0],r,n),t=is_positive_ast(i[1],r,!0,n);if(e){if(!1===is_nonzero_ast(i[1],r,n))return i[0]!==1/0&&i[0]!==-1/0}else{if(Number.isNaN(i[0]))return!1;if(!t)return;if(!1===e)return!0}let a=is_complex_ast(i[0],r,n),o=is_complex_ast(i[1],r,n);return!(!a||!o)||void 0}if("/"===a){if(!is_nonzero_ast(i[1],r,n))return;if(!1===is_nonzero_ast(i[0],r,n))return!0;if(!is_complex_ast(i[0],r,n)||!is_complex_ast(i[1],r,n))return;return!0}if("apply"===a)return!!(functions.C.C&&functions.C.C.includes(i[0])&&is_complex_ast(i[1],r,n))||!!(functions.R.C&&functions.R.C.includes(i[0])&&is_real_ast(i[1],r,n))||!!(functions.nonzeroC.C&&functions.nonzeroC.C.includes(i[0])&&is_nonzero_ast(i[1],r,n)&&is_complex_ast(i[1],r,n))||!!(functions.nonneg.C&&functions.nonneg.C.includes(i[0])&&is_positive_ast(i[1],r,!1,n))||!!(functions.pos.C&&functions.pos.C.includes(i[0])&&is_positive_ast(i[1],r,!0,n))||void 0;if("prime"===a)return;return!1}return!1}function is_nonzero_ast(e,t,n){if("object"!=typeof t&&(t=[]),void 0===n&&(n=t),"number"==typeof e){if(Number.isFinite(e))return 0!==e;if(Number.isNaN(e))return;return!0}var r=evaluate_to_constant(e);if(null!==r){if("number"==typeof r){if(Number.isFinite(r))return 0!==r;if(Number.isNaN(r))return;return!0}return void 0!==r.re&&void 0!==r.im&&(0!==r.re||0!==r.im)||void 0}if("string"==typeof e){let r;if(r=Array.isArray(t)?t:t.get_assumptions(e),!Array.isArray(r))return;let a=r,i=r[0],o=r.slice(1),s=!1;for(;"not"===i;){if(s=!s,r=o[0],!Array.isArray(r))return;i=r[0],o=r.slice(1)}let l=narrow_assumptions(a,n);if("="===i&&!s||"ne"===i&&s){if(o[0]===e)return is_nonzero_ast(o[1],l);if(o[1]===e)return is_nonzero_ast(o[0],l)}if("ne"===i&&!s||"="===i&&s){if(o[0]===e&&!1===is_nonzero_ast(o[1],l))return!0;if(o[1]===e&&!1===is_nonzero_ast(o[0],l))return!0}if("<"===i)if(s){if(o[0]===e&&is_positive_ast(o[1],l,!0))return!0;if(o[1]===e&&is_negative_ast(o[0],l,!0))return!0}else{if(o[0]===e&&is_negative_ast(o[1],l,!1))return!0;if(o[1]===e&&is_positive_ast(o[0],l,!1))return!0}if("le"===i)if(s){if(o[0]===e&&is_positive_ast(o[1],l,!1))return!0;if(o[1]===e&&is_negative_ast(o[0],l,!1))return!0}else{if(o[0]===e&&is_negative_ast(o[1],l,!0))return!0;if(o[1]===e&&is_positive_ast(o[0],l,!0))return!0}if("and"!==i&&"or"!==i)return;if(s)return;return o.length>2&&(r=unflattenRight(r),o=r.slice(1)),simple_assumption_combination(i,is_nonzero_ast(e,o[0],n),is_nonzero_ast(e,o[1],n))}if(Array.isArray(e)){let r;r=Array.isArray(t)?t:t.get_assumptions([variables(e)]);let a=e[0],i=e.slice(1);if("-"===a)return is_nonzero_ast(i[0],r,n);if("+"===a){if(i.length>2&&(i=(e=unflattenRight(e)).slice(1)),equal(i[0],simplify(["-",i[1]],n)))return!1;let t=is_nonzero_ast(i[0],r,n),a=is_nonzero_ast(i[1],r,n);if(!1===t)return a;if(!1===a)return t;let o=is_real_ast(i[0],r,n),s=is_real_ast(i[1],r,n);if(!o||!s)return!0===o?!1===s||void 0:!0===s&&!1===o||void 0;let l=is_positive_ast(i[0],r,!1,n),u=is_positive_ast(i[1],r,!1,n),c=is_positive_ast(i[0],r,!0,n),p=is_positive_ast(i[1],r,!0,n);return!!(l&&p||c&&u)||!1===l&&!1===p||!1===c&&!1===u||void 0}if("*"===a){let e=!0;for(let t=0;t<i.length;t++){let a=is_nonzero_ast(i[t],r,n);if(!1===a)return!1;void 0===a&&(e=!1)}return!!e||void 0}if("/"===a){let e=is_nonzero_ast(i[0],r,n);return is_nonzero_ast(i[1],r,n)?e:void 0}if("^"===a){let e=is_nonzero_ast(i[0],r,n);if(e){if((i[0]===1/0||i[0]===-1/0)&&!1===is_nonzero_ast(i[1],r,n))return;return!0}return(!is_positive_ast(i[1],r,!0,n)||!1!==e)&&void 0}if("apply"===a)return!!(functions.C.nonzero&&functions.C.nonzero.includes(i[0])&&is_complex_ast(i[1],r,n))||!!(functions.R.nonzero&&functions.R.nonzero.includes(i[0])&&is_real_ast(i[1],r,n))||!!(functions.nonzeroC.nonzero&&functions.nonzeroC.nonzero.includes(i[0])&&is_nonzero_ast(i[1],r,n)&&is_complex_ast(i[1],r,n))||!!(functions.nonneg.nonzero&&functions.nonneg.nonzero.includes(i[0])&&is_positive_ast(i[1],r,!1,n))||!!(functions.pos.nonzero&&functions.pos.nonzero.includes(i[0])&&is_positive_ast(i[1],r,!0,n))||void 0;if("prime"===a)return;return!1}return!1}function is_positive_ast(e,t,n,r){if("object"!=typeof t&&(t=[]),void 0===r&&(r=t),void 0===n&&(n=!0),"number"==typeof e)return!!Number.isFinite(e)&&(n?e>0:e>=0);var a=is_real_ast(e,t,r);if(!a)return a;var i=evaluate_to_constant(e);if(null!==i)return"number"==typeof i&&!!Number.isFinite(i)&&(n?i>0:i>=0);if("string"==typeof e){let a;if(a=Array.isArray(t)?t:t.get_assumptions(e),!Array.isArray(a))return;let i=a,o=a[0],s=a.slice(1),l=!1;for(;"not"===o;){if(l=!l,a=s[0],!Array.isArray(a))return;o=a[0],s=a.slice(1)}let u=narrow_assumptions(i,r);if("="===o&&!l||"ne"===o&&l){if(s[0]===e)return is_positive_ast(s[1],u,n);if(s[1]===e)return is_positive_ast(s[0],u,n)}if("<"===o)if(l){if(s[0]===e&&is_positive_ast(s[1],u,n))return!0;if(s[1]===e&&is_negative_ast(s[0],u,!n))return!1}else{if(s[0]===e&&is_negative_ast(s[1],u,!1))return!1;if(s[1]===e&&is_positive_ast(s[0],u,!1))return!0}if("le"===o)if(l){if(s[0]===e&&is_positive_ast(s[1],u,!1))return!0;if(s[1]===e&&is_negative_ast(s[0],u,!1))return!1}else{if(s[0]===e&&is_negative_ast(s[1],u,!n))return!1;if(s[1]===e&&is_positive_ast(s[0],u,n))return!0}if("and"!==o&&"or"!==o)return;if(l)return;return s.length>2&&(a=unflattenRight(a),s=a.slice(1)),simple_assumption_combination(o,is_positive_ast(e,s[0],n,r),is_positive_ast(e,s[1],n,r))}if(Array.isArray(e)){let a;a=Array.isArray(t)?t:t.get_assumptions([variables(e)]);let i=e[0],o=e.slice(1);if("-"===i)return is_negative_ast(o[0],a,n,r);if("+"===i){o.length>2&&(o=(e=unflattenRight(e)).slice(1));let t=is_positive_ast(o[0],a,!1,r),i=is_positive_ast(o[1],a,!1,r),s=is_positive_ast(o[0],a,!0,r),l=is_positive_ast(o[1],a,!0,r);if(n){if(t&&l||s&&i)return!0}else if(t&&i)return!0;if(n){if(!1===s&&!1===l)return!1}else if(!1===t&&!1===l||!1===s&&!1===i)return!1;return}if("*"===i){if(!o.every((e=>!1!==is_nonzero_ast(e,a,r))))return!n;o.length>2&&(o=(e=unflattenRight(e)).slice(1));let t=is_real_ast(o[0],a,r),i=is_real_ast(o[1],a,r);if(void 0===t||void 0===i)return;if(!1===t)return!1===i&&void 0;if(!1===i)return!1;let s=is_positive_ast(o[0],a,!1,r),l=is_positive_ast(o[1],a,!1,r),u=is_positive_ast(o[0],a,!0,r),c=is_positive_ast(o[1],a,!0,r);if(n){if(u&&c||!1===s&&!1===l)return!0;if(!1===u&&l||s&&!1===c)return!1}else{if(s&&l||!1===u&&!1===c)return!0;if(u&&!1===l||!1===s&&c)return!1}return}if("/"===i){if(!is_nonzero_ast(o[1],a,r))return;if(!1===is_nonzero_ast(o[0],a,r))return!n;let e=is_positive_ast(o[1],a,!0,r);if(void 0===e)return;let t=e?n:!n,i=is_positive_ast(o[0],a,t,r);if(void 0===i)return;return!0===i?!0===e:!0!==e}if("^"===i){let e=is_nonzero_ast(o[0],a,r);if(e){if(!1===is_nonzero_ast(o[1],a,r)){if(o[0]===1/0||o[0]===-1/0)return;return!0}}else{if(!is_positive_ast(o[1],a,!0,r))return;if(!1===e)return!n;if(n)return}if(!0!==is_real_ast(o[0],a,r))return;return is_positive_ast(o[0],a,n,r)?!!is_real_ast(o[1],a,r)||void 0:!!is_integer_ast(simplify(["/",o[1],2],r),a,r)||void 0}if("apply"===i&&!n)return!!(functions.C.nonneg&&functions.C.nonneg.includes(o[0])&&is_complex_ast(o[1],a,r))||!!(functions.R.nonneg&&functions.R.nonneg.includes(o[0])&&is_real_ast(o[1],a,r))||!!(functions.nonzeroC.nonneg&&functions.nonzeroC.nonneg.includes(o[0])&&is_nonzero_ast(o[1],a,r)&&is_complex_ast(o[1],a,r))||!!(functions.nonneg.nonneg&&functions.nonneg.nonneg.includes(o[0])&&is_positive_ast(o[1],a,!1,r))||!!(functions.pos.nonneg&&functions.pos.nonneg.includes(o[0])&&is_positive_ast(o[1],a,!0,r))||void 0;if("apply"===i&&n)return!!(functions.C.pos&&functions.C.pos.includes(o[0])&&is_complex_ast(o[1],a,r))||!!(functions.R.pos&&functions.R.pos.includes(o[0])&&is_real_ast(o[1],a,r))||!!(functions.nonzeroC.pos&&functions.nonzeroC.pos.includes(o[0])&&is_nonzero_ast(o[1],a,r)&&is_complex_ast(o[1],a,r))||!!(functions.nonneg.pos&&functions.nonneg.pos.includes(o[0])&&is_positive_ast(o[1],a,!1,r))||!!(functions.pos.pos&&functions.pos.pos.includes(o[0])&&is_positive_ast(o[1],a,!0,r))||void 0;if("prime"===i)return;return!1}return!1}function is_negative_ast(e,t,n,r){void 0===n&&(n=!0);var a=is_real_ast(e,t,r);if(!0===a){let a=is_positive_ast(e,t,!n,r);return!1===a||!0!==a&&void 0}return a}function clean(e){return flatten$k(get_tree(e))}function evalf(e,t){return parseFloat(number_8(e,t))}function collapse_unary_minus(e){var t=get_tree(e);if(!Array.isArray(t))return t;var n=t[0],r=t.slice(1);if(r=r.map((e=>collapse_unary_minus(e))),"-"===n){if("number"==typeof r[0])return-r[0];if(Array.isArray(r[0])&&"*"===r[0][0]&&"number"==typeof r[0][1])return["*",-r[0][1]].concat(r[0].slice(2));if(Array.isArray(r[0])&&"/"===r[0][0]){if("number"==typeof r[0][1])return["/",-r[0][1],r[0][2]];if(Array.isArray(r[0][1])&&"*"===r[0][1][0]&&"number"==typeof r[0][1][1])return["/",["*",-r[0][1][1]].concat(r[0][1].slice(2)),r[0][2]]}}return[n].concat(r)}function simplify(e,t,n){var r=get_tree(e);return void 0===t&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(t=e.context.get_assumptions([e.variables()])),r=evaluate_numbers(r,{assumptions:t,max_digits:n,evaluate_functions:!0}),Array.isArray(r)?r=collect_like_terms_factors(r=simplify_logical(r,t),t,n):r}function simplify_logical(e,t){var n=get_tree(e);void 0===t&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(t=e.context.get_assumptions([e.variables()])),n=evaluate_numbers(n,{assumptions:t}),n=unflattenRight(n);var r=[];return r.push([["not",["not","a"]],"a"]),r.push([["not",["and","a","b"]],["or",["not","a"],["not","b"]]]),r.push([["not",["or","a","b"]],["and",["not","a"],["not","b"]]]),r.push([["not",["=","a","b"]],["ne","a","b"]]),r.push([["not",["ne","a","b"]],["=","a","b"]]),r.push([["not",["<","a","b"]],["le","b","a"]]),r.push([["not",["le","a","b"]],["not",["le","a","b"]]]),r.push([["not",["in","a","b"]],["notin","a","b"]]),r.push([["not",["subset","a","b"]],["notsubset","a","b"]]),flatten$k(n=applyAllTransformations(n,r,20))}function contains_decimal_number(e){return"string"!=typeof e&&("number"==typeof e?!(!Number.isFinite(e)||Number.isInteger(e)):!!Array.isArray(e)&&e.slice(1).some((e=>contains_decimal_number(e))))}function contains_only_numbers(e,{include_number_symbols:t=!1}={}){if("string"==typeof e){if(t){if("e"===e&&math$3.define_e)return!0;if("pi"===e&&math$3.define_pi)return!0}return!1}return"number"==typeof e||!!Array.isArray(e)&&e.slice(1).every((e=>contains_only_numbers(e,{include_number_symbols:t})))}function evaluate_numbers_sub(e,t,n,r,a,i){if(void 0===e)return e;if("number"==typeof e)return i>0&&math$3.abs(e)<i?0:e;if(a||contains_only_numbers(e,{include_number_symbols:!0})){var o=evaluate_to_constant(e);if(null!==o&&"number"==typeof o&&Number.isFinite(o)){if(i>0&&math$3.abs(o)<i)return 0;if(n===1/0)return o;if(Number.isInteger(o))return 0===o?0:o;let t=evalf(o,14),r=evalf(o,n);if(0===n&&(r=math$3.round(o)),r===t)return o;if(contains_decimal_number(e)&&contains_only_numbers(e))return o;let a=math$3.fraction(o),s=evalf(a.d,3);if((a.n<1e4||s===a.d)&&evalf(a.s*a.n/a.d,14)===t)return 1===a.d?a.s*a.n:["/",a.s*a.n,a.d]}}if(!Array.isArray(e))return e;var s=e[0],l=e.slice(1).map((e=>evaluate_numbers_sub(e,t,n,r,a,i)));if("+"===s){let e=l[0],t=l[1];if(void 0===t)return e;if("number"==typeof e){if(0===e)return t;if("number"==typeof t)return e+t;if(Array.isArray(t)&&"+"===t[0]&&"number"==typeof t[1])return["+",e+t[1],t[2]];if(!r&&Array.isArray(t)&&"+"===t[0]&&"number"==typeof t[2])return["+",e+t[2],t[1]]}return"number"==typeof t&&0===t?e:[s].concat(l)}if("-"===s){if("number"==typeof l[0])return-l[0];if(Array.isArray(l[0])&&"*"===l[0][0]&&"number"==typeof l[0][1])return["*",-l[0][1]].concat(l[0].slice(2));if(Array.isArray(l[0])&&"/"===l[0][0]){if("number"==typeof l[0][1])return["/",-l[0][1],l[0][2]];if(Array.isArray(l[0][1])&&"*"===l[0][1][0]&&"number"==typeof l[0][1][1])return["/",["*",-l[0][1][1]].concat(l[0][1].slice(2)),l[0][2]]}return[s].concat(l)}if("*"===s){let e=l[0],t=l[1];if(void 0===t)return e;if("number"==typeof e){if(isNaN(e))return NaN;if("number"==typeof t)return e*t;if(!isFinite(e))return e===1/0&&is_negative_ast(t)||e===-1/0&&is_positive_ast(t)?-1/0:!1===is_nonzero_ast(t)?NaN:1/0;if(0===e)return 0;if(1===e)return t;if(-1===e)return["-",t];if(Array.isArray(t)&&"*"===t[0]&&"number"==typeof t[1])return e*=t[1],t=t[2],1===e?t:-1===e?["-",t]:["*",e,t]}if("number"==typeof t){if(isNaN(t))return NaN;if(!isFinite(t))return t===1/0&&is_negative_ast(e)||t===-1/0&&is_positive_ast(e)?-1/0:!1===is_nonzero_ast(e)?NaN:1/0;if(0===t)return 0;if(1===t)return e;if(-1===t)return["-",e];if(Array.isArray(e)&&"*"===e[0]&&"number"==typeof e[1])return t*=e[1],e=e[2],1===t?e:-1===t?["-",e]:["*",e,t]}return[s].concat(l)}if("/"===s){let e=l[0],r=l[1];if("number"==typeof e){if(0===e){let e=is_nonzero_ast(r,t);if(e)return 0;if(!1===e)return NaN}if("number"==typeof r){let t=e/r;if(n===1/0||math$3.round(t,n)===t)return t;if(r<0)return["/",-e,-r]}if(Array.isArray(r)&&"*"===r[0]&&"number"==typeof r[1]){let t=e/r[1];if(n===1/0||math$3.round(t,n)===t)return["/",t,r[2]]}}else if("number"==typeof r){if(Array.isArray(e)&&"*"===e[0]&&"number"==typeof e[1]){let t=e[1]/r;if(n===1/0||math$3.round(t,n)===t)return 1===t?e[2]:["*",t,e[2]];if(r<0)return["/",["*",-e[1],e[2]],-r]}let t=1/r;if(n===1/0||math$3.round(t,n)===t)return["*",t,e];if(r<0)return Array.isArray(e)&&"-"===e[0]?["/",e[1],-r]:["-",["/",e,-r]]}return[s].concat(l)}if("^"===s){let e=l[0],r=l[1];if("number"==typeof r)if(0===r){if(!math$3.pow_strict)return 1;let n=is_nonzero_ast(e,t);if(n&&e!==1/0&&e!==-1/0)return 1;if(!1===n)return NaN}else{if(1===r)return e;if("number"==typeof e){let t=math$3.pow(e,r);if(n===1/0||math$3.round(t,n)===t)return t}}else if(1===e)return 1;return[s].concat(l)}return[s].concat(l)}function evaluate_numbers(e,{assumptions:t,max_digits:n,skip_ordering:r=!1,evaluate_functions:a=!1,set_small_zero:i=0}={}){(void 0===n||!Number.isInteger(n)&&n!==1/0)&&(n=0),!0===i&&(i=1e-14);var o,s=get_tree(e);return void 0===t&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(t=e.context.get_assumptions([e.variables()])),r?o=evaluate_numbers_sub(s=unflattenRight(flatten$k(s)),t,n,r,a,i):(s=unflattenRight(default_order(flatten$k(s))),o=default_order(evaluate_numbers_sub(s,t,n,r,a,i)),o=default_order(evaluate_numbers_sub(unflattenRight(o),t,n,r,a,i))),0===o&&(o=0),flatten$k(o)}function collect_like_terms_factors(e,t,n){function r(e){return"number"==typeof e||!(!Array.isArray(e)||"-"!==e[0]||"number"!=typeof e[1])}function a(e){return"number"==typeof e&&e<0||!(!Array.isArray(e)||"-"!==e[0]||"number"!=typeof e[1])}function i(e){if("number"==typeof e)return!0;if(Array.isArray(e)&&"-"===e[0]&&"number"==typeof e[1])return!0;let t=evaluate_to_constant(e);return!("number"!=typeof t||!Number.isFinite(t))}var o=get_tree(e);void 0===t&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(t=e.context.get_assumptions([e.variables()])),o=evaluate_numbers(o,{assumptions:t,max_digits:n,evaluate_functions:!0});var s=[];return s.push([["/","x",["^","y","a"]],["*","x",["^","y",["-","a"]]],{evaluate_numbers:!0,max_digits:n}]),s.push([["/","x",["apply","exp","a"]],["*","x",["apply","exp",["-","a"]]],{evaluate_numbers:!0,max_digits:n,variables:{x:!0,a:!0}}]),s.push([["/","x","y"],["*","x",["^","y",["-",1]]],{evaluate_numbers:!0,max_digits:n}]),o=applyAllTransformations(o,s,40),(s=[]).push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:e=>is_nonzero_ast(e,t),n:r,m:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:!0,n:e=>r(e)&&is_positive_ast(e,t),m:e=>r(e)&&is_positive_ast(e,t)},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["*",["^","x","n"],["^","x","m"]],["^","x",["+","n","m"]],{variables:{x:!0,n:e=>r(e)&&is_negative_ast(e,t),m:e=>r(e)&&is_negative_ast(e,t)},evaluate_numbers:!0,max_digits:n,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["*",["apply","exp","n"],["apply","exp","m"]],["apply","exp",["+","n","m"]],{variables:{n:r,m:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*","n","x"],["*","m","x"]],["*",["+","n","m"],"x"],{variables:{x:!0,n:r,m:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*","n1","x"],["*",["/","n2","m2"],"x"]],["*",["+","n1",["/","n2","m2"]],"x"],{variables:{x:!0,n1:r,n2:r,m2:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*","n1","x"],["*",["-",["/","n2","m2"]],"x"]],["*",["+","n1",["-",["/","n2","m2"]]],"x"],{variables:{x:!0,n1:r,n2:r,m2:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*",["/","n1","m1"],"x"],["*",["/","n2","m2"],"x"]],["*",["+",["/","n1","m1"],["/","n2","m2"]],"x"],{variables:{x:!0,n1:r,m1:r,n2:r,m2:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m1","m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*",["/","n1","m1"],"x"],["*",["-",["/","n2","m2"]],"x"]],["*",["+",["/","n1","m1"],["-",["/","n2","m2"]]],"x"],{variables:{x:!0,n1:r,m1:r,n2:r,m2:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m1","m2","n1","n2"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["+",["*","n","x"],["-",["*","m","x"]]],["*",["+","n",["-","m"]],"x"],{variables:{x:!0,n:r,m:r},evaluate_numbers:!0,max_digits:n,allow_implicit_identities:["m","n"],allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["^",["*","x","y"],"a"],["*",["^","x","a"],["^","y","a"]],{allow_permutations:!0}]),s.push([["^",["^","x","n"],"m"],["^","x",["*","n","m"]],{variables:{x:!0,n:r,m:r},evaluate_numbers:!0,max_digits:n,allow_permutations:!0}]),s.push([["-",["+","a","b"]],["+",["-","a"],["-","b"]]]),s.push([["*","x","y"],["*","x","y"],{variables:{x:i,y:i},evaluate_numbers:!0,max_digits:n,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),o=applyAllTransformations(o,s,40),(s=[]).push([["*","x",["^","y",["-","a"]]],["/","x",["^","y","a"]],{allow_extended_match:!0,allow_permutations:!0,evaluate_numbers:!0,max_digits:n,max_group:1}]),s.push([["*","x",["apply","exp",["-","a"]]],["/","x",["apply","exp","a"]],{allow_extended_match:!0,allow_permutations:!0,evaluate_numbers:!0,max_digits:n,max_group:1,variables:{x:!0,a:!0}}]),s.push([["*","x",["^","y","n"]],["/","x",["^","y",["-","n"]]],{variables:{x:!0,y:!0,n:a},evaluate_numbers:!0,max_digits:n,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["*","x",["apply","exp","n"]],["/","x",["apply","exp",["-","n"]]],{variables:{x:!0,n:a},evaluate_numbers:!0,max_digits:n,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),o=applyAllTransformations(o,s,40),(s=[]).push([["^","y","n"],["/",1,["^","y",["-","n"]]],{variables:{y:!0,n:a},evaluate_numbers:!0,max_digits:n}]),s.push([["apply","exp","n"],["/",1,["apply","exp",["-","n"]]],{variables:{n:a},evaluate_numbers:!0,max_digits:n}]),o=applyAllTransformations(o,s,40),(s=[]).push([["*","x",["/","y","z"]],["/",["*","x","y"],"z"],{allow_extended_match:!0,allow_permutations:!0,max_group:1}]),s.push([["/",["/","x","y"],"z"],["/","x",["*","y","z"]],{allow_extended_match:!0,allow_permutations:!0}]),s.push([["/","x",["/","y","z"]],["/",["*","x","z"],"y"],{allow_extended_match:!0,allow_permutations:!0}]),evaluate_numbers(o=applyAllTransformations(o,s,40),{assumptions:t,max_digits:n})}function simplify_ratios(e,t){function n(e){var t=1;return e=e.map((function(e){if("number"==typeof e)return e<0?(t*=-1,-e):e;if(!Array.isArray(e))return e;if("-"===e[0])return t*=-1,e[1];if("+"!==e[0])return e;var n=!1;if(("number"==typeof e[1]&&e[1]<0||Array.isArray(e[1])&&"-"===e[1][0]||Array.isArray(e[1])&&"*"===e[1][0]&&Number(e[1][1])<0)&&(n=!0),n){t*=-1;var r=e.slice(1).map((e=>["-",e]));return evaluate_numbers(["+"].concat(r))}return e})),{factors:e,sign_change:t}}var r=get_tree(e);return void 0===t&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(t=e.context.get_assumptions([e.variables()])),function e(t,r){if(!Array.isArray(t))return r?["-",t]:t;var a=t[0];if("-"===a)return e(t[1],r=!0);var i=t.slice(1).map((t=>e(t)));if("/"!==a)return r?["-",[a,...i]]:[a,...i];var o,s=i[0],l=i[1];s=default_order(s,{ignore_negatives:!0});var u,c=n(o=Array.isArray(s)&&"*"===s[0]?s.slice(1):[s]);o=c.factors,r&&(c.sign_change*=-1),l=default_order(l,{ignore_negatives:!0});var p=n(Array.isArray(l)&&"*"===l[0]?l.slice(1):[l]);return u=p.factors,c.sign_change*p.sign_change<0&&(o[0]=["-",o[0]]),["/",s=1===o.length?o[0]:["*"].concat(o),l=1===u.length?u[0]:["*"].concat(u)]}(r)}functions.C.nonneg=["abs"],functions.C.nonzero=["exp"],functions.C.R=["abs","arg"],functions.C.C=["abs","arg","exp","sign","cos","cosh","sin","sinh","erf","sqrt","log","ln","log10"],functions.R.pos=["exp"],functions.R.nonneg=["abs","exp","arg"],functions.R.R=["abs","arg","exp","sign","cos","cosh","sin","sinh","erf"],functions.R.Z=["sign"],functions.nonzeroC.pos=["abs"],functions.nonneg.nonneg=["abs","exp","arg","sqrt","erf"],functions.nonzeroC.nonzero=["abs"],functions.nonneg.R=[...new Set(functions.R.R.concat(functions.nonneg.nonneg))],functions.pos.pos=["abs","exp","sqrt","erf"],functions.pos.nonneg=functions.pos.pos,functions.pos.nonzero=["abs","exp","sqrt","erf"],functions.pos.R=functions.nonneg.R.concat(["log","ln","log10"]);var simplify$1=Object.freeze({__proto__:null,clean:clean,simplify:simplify,simplify_logical:simplify_logical,evaluate_numbers:evaluate_numbers,collect_like_terms_factors:collect_like_terms_factors,collapse_unary_minus:collapse_unary_minus,simplify_ratios:simplify_ratios,default_order:default_order});function tuples_to_vectors(e){var t=get_tree(e);if("number"==typeof t)return t;if("string"==typeof t)return t;if("boolean"==typeof t)return t;var n=t[0],r=t.slice(1);if("tuple"===n)return["vector"].concat(r.map((function(e,t){return tuples_to_vectors(e)})));if("apply"===n){if("tuple"===r[1][0]){let e=tuples_to_vectors(r[0]),t=r[1].slice(1);return["apply",e,["tuple"].concat(t.map((function(e,t){return tuples_to_vectors(e)})))]}}else if("gts"===n||"lts"===n||"interval"===n){let e=r[0],t=r[1];if("tuple"!==e[0]||"tuple"!==t[0])throw new Error("Badly formed ast");return[n,["tuple"].concat(e.slice(1).map((function(e,t){return tuples_to_vectors(e)}))),t]}return[n].concat(r.map((function(e,t){return tuples_to_vectors(e)})))}function to_intervals(e){var t=get_tree(e);if("number"==typeof t)return t;if("string"==typeof t)return t;if("boolean"==typeof t)return t;var n=t[0],r=t.slice(1);if("tuple"===n&&2===r.length){let e=["tuple"].concat(r.map((function(e,t){return to_intervals(e)})));return e=["interval",e,["tuple",!1,!1]],e}if("array"===n&&2===r.length){let e=["tuple"].concat(r.map((function(e,t){return to_intervals(e)})));return e=["interval",e,["tuple",!0,!0]],e}if("apply"===n){if("tuple"===r[1][0]){let e=to_intervals(r[0]),t=r[1].slice(1);return["apply",e,["tuple"].concat(t.map((function(e,t){return to_intervals(e)})))]}}else if("gts"===n||"lts"===n||"interval"===n){let e=r[0],t=r[1];if("tuple"!==e[0]||"tuple"!==t[0])throw new Error("Badly formed ast");return[n,["tuple"].concat(e.slice(1).map((function(e,t){return to_intervals(e)}))),t]}return[n].concat(r.map((function(e,t){return to_intervals(e)})))}function ParseError(e,t){this.name="ParseError",this.message=e||"Error parsing input",this.stack=(new Error).stack,this.location=t}ParseError.prototype=Object.create(Error.prototype),ParseError.prototype.constructor=ParseError;class lexer{constructor(e,t="\\s"){this.input="",this.location=0,this.token_rules=[],this.initial_whitespace=new RegExp("^("+t+")+");for(let t of e)this.token_rules.push([new RegExp("^"+t[0])].concat(t.slice(1)))}set_input(e){if("string"!=typeof e)throw new Error("Input must be a string");this.input=e,this.location=0}return_state(){return{input:this.input,location:this.location}}set_state({input:e=null,location:t=0}={}){null!==e&&(this.input=e,this.location=t)}advance({remove_initial_space:e=!0}={}){let t=this.initial_whitespace.exec(this.input);if(t){let n=t[0].length;if(this.input=this.input.slice(n),this.location+=n,!e)return{token_type:"SPACE",token_text:t[0],original_text:t[0]}}if(0===this.input.length)return{token_type:"EOF",token_text:"",original_text:""};for(var n of(t=null,this.token_rules))if(t=n[0].exec(this.input),t){let e=t[0].length;this.input=this.input.slice(e),this.location+=e;break}return null===t?{token_type:"INVALID",token_text:this.input[0],original_text:this.input[0]}:n.length>2?{token_type:n[1],token_text:n[2],original_text:t[0]}:{token_type:n[1],token_text:t[0],original_text:t[0]}}unput(e){if("string"!=typeof e)throw new Error("Input must be a string");this.location-=e.length,this.input=e+this.input}}var is_associative={"+":!0,"*":!0,and:!0,or:!0,union:!0,intersect:!0};function flatten(e){if(!Array.isArray(e))return e;var t=e[0],n=e.slice(1);if(n=n.map((function(e,t){return flatten(e)})),is_associative[t]){for(var r=[],a=0;a<n.length;a++)Array.isArray(n[a])&&n[a][0]===t?r=r.concat(n[a].slice(1)):r.push(n[a]);n=r}return[t].concat(n)}const sci_notat_exp_regex$1="(E[+\\-]?[0-9]+\\s*($|(?=\\,|\\||\\)|\\}|\\])))?",text_rules=[["[0-9]+(\\.[0-9]*)?"+sci_notat_exp_regex$1,"NUMBER"],["\\.[0-9]+"+sci_notat_exp_regex$1,"NUMBER"],["\\*\\*","^"],["\\*","*"],["\\xB7","*"],["","*"],["","*"],["","*"],["","*"],["/","/"],["-","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["","-"],["\\+","+"],["\\^","^"],["","^"],["","^"],["\\|","|"],["\\(","("],["\\)",")"],["\\[","["],["\\]","]"],["\\{","{"],["\\}","}"],[",",","],[":",":"],["","VARMULTICHAR","alpha"],["","VARMULTICHAR","beta"],["","VARMULTICHAR","beta"],["","VARMULTICHAR","Gamma"],["","VARMULTICHAR","gamma"],["","VARMULTICHAR","Delta"],["","VARMULTICHAR","delta"],["","VARMULTICHAR","epsilon"],["","VARMULTICHAR","epsilon"],["","VARMULTICHAR","zeta"],["","VARMULTICHAR","eta"],["","VARMULTICHAR","Theta"],["","VARMULTICHAR","Theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","theta"],["","VARMULTICHAR","iota"],["","VARMULTICHAR","kappa"],["","VARMULTICHAR","Lambda"],["","VARMULTICHAR","lambda"],["","VARMULTICHAR","mu"],["","VARMULTICHAR","mu"],["","VARMULTICHAR","nu"],["","VARMULTICHAR","Xi"],["","VARMULTICHAR","xi"],["","VARMULTICHAR","Pi"],["","VARMULTICHAR","pi"],["","VARMULTICHAR","pi"],["","VARMULTICHAR","rho"],["","VARMULTICHAR","rho"],["","VARMULTICHAR","Sigma"],["","VARMULTICHAR","sigma"],["","VARMULTICHAR","sigma"],["","VARMULTICHAR","tau"],["","VARMULTICHAR","Upsilon"],["","VARMULTICHAR","upsilon"],["","VARMULTICHAR","Phi"],["","VARMULTICHAR","phi"],["","VARMULTICHAR","phi"],["","VARMULTICHAR","Psi"],["","VARMULTICHAR","psi"],["","VARMULTICHAR","Omega"],["","VARMULTICHAR","omega"],["oo\\b","INFINITY"],["OO\\b","INFINITY"],["infty\\b","INFINITY"],["infinity\\b","INFINITY"],["Infinity\\b","INFINITY"],["","INFINITY"],["","VAR","e"],["","VARMULTICHAR","spade"],["","VARMULTICHAR","heart"],["","VARMULTICHAR","diamond"],["","VARMULTICHAR","club"],["","VARMULTICHAR","bigstar"],["","VARMULTICHAR","bigcirc"],["","VARMULTICHAR","lozenge"],["","VARMULTICHAR","bigtriangleup"],["","VARMULTICHAR","bigtriangledown"],["","VARMULTICHAR","blacklozenge"],["","VARMULTICHAR","blacksquare"],["","VARMULTICHAR","blacktriangle"],["","VARMULTICHAR","blacktriangledown"],["","VARMULTICHAR","blacktriangleleft"],["","VARMULTICHAR","blacktriangleright"],["","VARMULTICHAR","Box"],["","VARMULTICHAR","circ"],["","VARMULTICHAR","star"],["and\\b","AND"],["\\&\\&?","AND"],["","AND"],["or\\b","OR"],["","OR"],["not\\b","NOT"],["","NOT"],["=","="],["","="],["","="],["!=","NE"],["","NE"],["<=","LE"],["","LE"],[">=","GE"],["","GE"],["<","<"],[">",">"],["elementof\\b","IN"],["","IN"],["notelementof\\b","NOTIN"],["","NOTIN"],["containselement\\b","NI"],["","NI"],["notcontainselement\\b","NOTNI"],["","NOTNI"],["subset\\b","SUBSET"],["","SUBSET"],["notsubset\\b","NOTSUBSET"],["","NOTSUBSET"],["superset\\b","SUPERSET"],["","SUPERSET"],["notsuperset\\b","NOTSUPERSET"],["","NOTSUPERSET"],["union\\b","UNION"],["","UNION"],["intersect\\b","INTERSECT"],["","INTERSECT"],["!","!"],["'","'"],["_","_"],["\\.\\.\\.","LDOTS"],["[a-zA-Z][a-zA-Z0-9]*","VAR"]],allowSimplifiedFunctionApplicationDefault$1=!0,splitSymbolsDefault=!0,unsplitSymbolsDefault=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega"],appliedFunctionSymbolsDefault$1=["abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg","conj"],functionSymbolsDefault$1=["f","g"],parseLeibnizNotationDefault$1=!0;class textToAst$4{constructor({allowSimplifiedFunctionApplication:e=allowSimplifiedFunctionApplicationDefault$1,splitSymbols:t=splitSymbolsDefault,unsplitSymbols:n=unsplitSymbolsDefault,appliedFunctionSymbols:r=appliedFunctionSymbolsDefault$1,functionSymbols:a=functionSymbolsDefault$1,parseLeibnizNotation:i=parseLeibnizNotationDefault$1}={}){this.allowSimplifiedFunctionApplication=e,this.splitSymbols=t,this.unsplitSymbols=n,this.appliedFunctionSymbols=r,this.functionSymbols=a,this.parseLeibnizNotation=i,this.lexer=new lexer(text_rules)}advance(e){if(this.token=this.lexer.advance(e),"INVALID"===this.token.token_type)throw new ParseError("Invalid symbol '"+this.token.original_text+"'",this.lexer.location)}return_state(){return{lexer_state:this.lexer.return_state(),token:Object.assign({},this.token)}}set_state(e){this.lexer.set_state(e.lexer_state),this.token=Object.assign({},e.token)}convert(e){this.lexer.set_input(e),this.advance();var t=this.statement_list();if("EOF"!==this.token.token_type)throw new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return flatten(t)}statement_list(){for(var e=[this.statement()];","===this.token.token_type;)this.advance(),e.push(this.statement());return e.length>1?["list"].concat(e):e[0]}statement({inside_absolute_value:e=0}={}){if("LDOTS"===this.token.token_type)return this.advance(),["ldots"];var t;try{t=this.return_state();let n=this.statement_a({inside_absolute_value:e});return":"!==this.token.token_type?n:(this.advance(),[":",n,this.statement_a()])}catch(e){try{this.set_state(t);let n=this.statement_a({parse_absolute_value:!1});if("|"!==this.token.token_type)throw e;return this.advance(),["|",n,this.statement_a({parse_absolute_value:!1})]}catch(t){throw e}}}statement_a({inside_absolute_value:e=0,parse_absolute_value:t=!0}={}){for(var n=this.statement_b({inside_absolute_value:e,parse_absolute_value:t});"OR"===this.token.token_type;){let r=this.token.token_type.toLowerCase();this.advance(),n=[r,n,this.statement_b({inside_absolute_value:e,parse_absolute_value:t})]}return n}statement_b(e){for(var t=this.relation(e);"AND"===this.token.token_type;){let n=this.token.token_type.toLowerCase();this.advance(),t=[n,t,this.relation(e)]}return t}relation(e){if("NOT"===this.token.token_type||"!"===this.token.token_type)return this.advance(),["not",this.relation(e)];for(var t=this.expression(e);"="===this.token.token_type||"NE"===this.token.token_type||"<"===this.token.token_type||">"===this.token.token_type||"LE"===this.token.token_type||"GE"===this.token.token_type||"IN"===this.token.token_type||"NOTIN"===this.token.token_type||"NI"===this.token.token_type||"NOTNI"===this.token.token_type||"SUBSET"===this.token.token_type||"NOTSUBSET"===this.token.token_type||"SUPERSET"===this.token.token_type||"NOTSUPERSET"===this.token.token_type;){let n=this.token.token_type.toLowerCase(),r=0;"<"===this.token.token_type||"LE"===this.token.token_type?r=-1:">"!==this.token.token_type&&"GE"!==this.token.token_type||(r=1),this.advance();let a=this.expression(e);if(-1===r)if("<"===this.token.token_type||"LE"===this.token.token_type){let r=["tuple"];"<"===n?r.push(!0):r.push(!1);let i=["tuple",t,a];for(;"<"===this.token.token_type||"LE"===this.token.token_type;)"<"===this.token.token_type?r.push(!0):r.push(!1),this.advance(),i.push(this.expression(e));t=["lts",i,r]}else t=[n,t,a];else if(1===r)if(">"===this.token.token_type||"GE"===this.token.token_type){let r=["tuple"];">"===n?r.push(!0):r.push(!1);let i=["tuple",t,a];for(;">"===this.token.token_type||"GE"===this.token.token_type;)">"===this.token.token_type?r.push(!0):r.push(!1),this.advance(),i.push(this.expression(e));t=["gts",i,r]}else t=[n,t,a];else if("="===n)for(t=["=",t,a];"="===this.token.token_type;)this.advance(),t.push(this.expression(e));else t=[n,t,a]}return t}expression(e){"+"===this.token.token_type&&this.advance();let t=!1;"-"===this.token.token_type&&(t=!0,this.advance());var n=this.term(e);for(t&&(n=n>0?-n:["-",n]);"+"===this.token.token_type||"-"===this.token.token_type||"UNION"===this.token.token_type||"INTERSECT"===this.token.token_type;){let t=this.token.token_type.toLowerCase(),r=!1;"-"===this.token.token_type?(t="+",r=!0,this.advance()):(this.advance(),"+"===t&&"-"===this.token.token_type&&(r=!0,this.advance()));let a=this.term(e);r&&(a=a>0?-a:["-",a]),n=[t,n,a]}return n}term(e){var t=this.factor(e),n=!1;do{if(n=!1,"*"===this.token.token_type)this.advance(),t=["*",t,this.factor(e)],n=!0;else if("/"===this.token.token_type)this.advance(),t=["/",t,this.factor(e)],n=!0;else{let r=Object.assign({},e);r.allow_absolute_value_closing=!0;let a=this.nonMinusFactor(r);!1!==a&&(t=["*",t,a],n=!0)}}while(n);return t}factor(e){if("-"===this.token.token_type){this.advance();let t=this.factor(e);return t>0?-t:["-",t]}var t=this.nonMinusFactor(e);if(!1===t)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return t}nonMinusFactor(e){var t=this.baseFactor(e);if("!"===this.token.token_type||"'"===this.token.token_type){if(!1===t)throw new ParseError("Invalid location of "+this.token.token_type,this.lexer.location);for(;"!"===this.token.token_type||"'"===this.token.token_type;)t="!"===this.token.token_type?["apply","factorial",t]:["prime",t],this.advance()}if("^"===this.token.token_type){if(!1===t)throw new ParseError("Invalid location of ^",this.lexer.location);this.advance();let n=Object.assign({},e);return delete n.allow_absolute_value_closing,delete n.inside_absolute_value,["^",t,this.factor(n)]}return t}baseFactor({inside_absolute_value:e=0,parse_absolute_value:t=!0,allow_absolute_value_closing:n=!1}={}){var r=!1;if("NUMBER"===this.token.token_type)r=parseFloat(this.token.token_text),this.advance();else if("INFINITY"===this.token.token_type)r=1/0,this.advance();else if("VAR"===this.token.token_type||"VARMULTICHAR"===this.token.token_type)if(r=this.token.token_text,this.appliedFunctionSymbols.includes(r)||this.functionSymbols.includes(r)){let e=!1;if(this.appliedFunctionSymbols.includes(r)&&(e=!0),this.advance(),"_"===this.token.token_type){this.advance();let e=this.baseFactor({parse_absolute_value:t});if(!1===e)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);r=["_",r,e]}for(;"'"===this.token.token_type;)r=["prime",r],this.advance();if("^"===this.token.token_type&&(this.advance(),r=["^",r,this.factor({parse_absolute_value:t})]),"("===this.token.token_type){this.advance();let e=this.statement_list();if(")"!==this.token.token_type)throw new ParseError("Expecting )",this.lexer.location);this.advance(),"list"===e[0]&&(e[0]="tuple"),r=["apply",r,e]}else if(e){if(!this.allowSimplifiedFunctionApplication)throw new ParseError("Expecting ( after function",this.lexer.location);r=["apply",r,this.factor({parse_absolute_value:t})]}}else{if(this.parseLeibnizNotation){let e=this.return_state(),t=this.leibniz_notation();if(t)return t;this.set_state(e)}let a=this.splitSymbols;if(a&&("VARMULTICHAR"===this.token.token_type||this.unsplitSymbols.includes(r)||1===r.length||r.match(/[\d]/g))&&(a=!1),a){for(let e=r.length-1;e>=0;e--)this.lexer.unput(" "),this.lexer.unput(r[e]);return this.advance(),this.baseFactor({inside_absolute_value:e,parse_absolute_value:t,allow_absolute_value_closing:n})}this.advance()}else if("("===this.token.token_type||"["===this.token.token_type||"{"===this.token.token_type){let e,t,n=this.token.token_type;"("===this.token.token_type?(e=")",t="]"):"["===this.token.token_type?(e="]",t=")"):(e="}",t=null),this.advance();let a=1;if("list"===(r=this.statement_list())[0]&&(a=r.length-1),this.token.token_type!==e){if(2!==a||null===t)throw new ParseError("Expecting "+e,this.lexer.location);if(this.token.token_type!==t)throw new ParseError("Expecting ) or ]",this.lexer.location);let i;r[0]="tuple",i="("===n?["tuple",!1,!0]:["tuple",!0,!1],(r=["interval",r]).push(i)}else a>=2?r[0]="("===n?"tuple":"["===n?"array":"set":"{"===n&&("|"===r[0]||r[0],r=["set",r]);this.advance()}else if("|"===this.token.token_type&&t&&(0===e||!n)){if(e+=1,this.advance(),r=["apply","abs",r=this.statement({inside_absolute_value:e})],"|"!==this.token.token_type)throw new ParseError("Expecting |",this.lexer.location);this.advance()}if("_"===this.token.token_type){if(!1===r)throw new ParseError("Invalid location of _",this.lexer.location);this.advance();let e=this.baseFactor({parse_absolute_value:t});if(!1===e)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return["_",r,e]}return r}leibniz_notation(){var e=this.token.token_text;if("VAR"!==this.token.token_type||"d"!==e[0]&&""!==e[0]||!(1===e.length||2===e.length&&/[a-zA-Z]/.exec(e[1])))return!1;let t=e[0],n=1,r="",a=[],i=[];if(2===e.length)r=e[1];else if(this.advance(),"VARMULTICHAR"===this.token.token_type||"VAR"===this.token.token_type&&!this.token.token_text.includes(""))r=this.token.token_text;else{if("^"!==this.token.token_type)return!1;if(this.advance(),"NUMBER"!==this.token.token_type)return!1;if(n=parseFloat(this.token.token_text),!Number.isInteger(n))return!1;if(this.advance(),("VAR"!==this.token.token_type||this.token.token_text.includes(""))&&"VARMULTICHAR"!==this.token.token_type)return!1;r=this.token.token_text}if(this.advance(),"/"!==this.token.token_type)return!1;let o=0;for(this.advance();;){if("VAR"!==this.token.token_type||this.token.token_text[0]!==t)return!1;this.token.token_text.length>2&&(this.lexer.unput(this.token.token_text.slice(2)),this.token.token_text=this.token.token_text.slice(0,2));let s=this.token.token_text;if(2===s.length){if(!/[a-zA-Z]/.exec(s[1]))return!1;a.push(s[1])}else{if(this.advance(),("VAR"!==this.token.token_type||this.token.token_text.includes(""))&&"VARMULTICHAR"!==this.token.token_type)return!1;a.push(this.token.token_text)}let l=1,u=!1;if(this.advance({remove_initial_space:!1}),"SPACE"===this.token.token_type&&(u=!0,this.advance()),"^"===this.token.token_type){if(this.advance(),"NUMBER"!==this.token.token_type)return!1;if(l=parseFloat(this.token.token_text),!Number.isInteger(l))return!1;u=!1,this.advance({remove_initial_space:!1}),"SPACE"===this.token.token_type&&(u=!0,this.advance())}if(i.push(l),o+=l,o>n)return!1;if(o===n){if(!u&&("VAR"===this.token.token_type||"VARMULTICHAR"===this.token.token_type))return!1;"SPACE"===this.token.token_type&&this.advance();let o="derivative_leibniz";""===t&&(o="partial_"+o),e=[o],1===n?e.push(r):e.push(["tuple",r,n]);let s=[];for(let e=0;e<a.length;e+=1)1===i[e]?s.push(a[e]):s.push(["tuple",a[e],i[e]]);return s=["tuple"].concat(s),e.push(s),e}}}}var textToAst$3=new textToAst$4;function expand(e,t){var n=get_tree(e),r=[];return r.push([textToAst$3.convert("a*(b+c)"),textToAst$3.convert("a*b+a*c")]),r.push([textToAst$3.convert("(a+b)*c"),textToAst$3.convert("a*c+b*c")]),t||r.push([textToAst$3.convert("(a+b)/c"),textToAst$3.convert("a/c+b/c")]),r.push([textToAst$3.convert("-(a+b)"),textToAst$3.convert("-a-b")]),r.push([textToAst$3.convert("a(-b)"),textToAst$3.convert("-ab")]),r.push([textToAst$3.convert("(a+b)^2"),textToAst$3.convert("a^2+2ab+b^2")]),r.push([textToAst$3.convert("(a+b)^3"),textToAst$3.convert("a^3+3a^2b+3ab^2+b^3")]),r.push([textToAst$3.convert("(a+b)^4"),textToAst$3.convert("a^4+4a^3b+6a^2b^2+4ab^3+b^4")]),r.push([textToAst$3.convert("(-a)^2"),textToAst$3.convert("a^2")]),r.push([textToAst$3.convert("(-a)^3"),textToAst$3.convert("-a^3")]),r.push([textToAst$3.convert("(-a)^4"),textToAst$3.convert("a^4")]),r.push([textToAst$3.convert("a*(b+c)*d"),textToAst$3.convert("(a*b+a*c)*d")]),normalize_negatives(n=collect_like_terms_factors(n=evaluate_numbers(n=flatten$k(n=applyAllTransformations(n,r,20)))))}function expand_relations(e){var t=get_tree(e);return transform(t,expand_relations_transform)}function expand_relations_transform(e){if(!Array.isArray(e))return e;var t=e[0],n=e.slice(1);if("="===t){if(n.length<=2)return e;let t=["and"];for(let e=0;e<n.length-1;e++)t.push(["=",n[e],n[e+1]]);return t}if("gts"===t||"lts"===t){let e=n[0],r=n[1];if("tuple"!==e[0]||"tuple"!==r[0])throw new Error("Badly formed ast");let a=[];for(let n=1;n<e.length-1;n++){let i;i=r[n]?"lts"===t?"<":">":"lts"===t?"le":"ge",a.push([i,e[n],e[n+1]])}let i=["and",a[0],a[1]];for(let e=2;e<a.length;e++)i=["and",i,a[e]];return i}if("in"===t||"notin"===t||"ni"===t||"notni"===t){let r,a,i=!1;if("notin"!==t&&"notni"!==t||(i=!0),"in"===t||"notin"===t?(r=n[0],a=n[1]):(r=n[1],a=n[0]),a=to_intervals(a),"interval"!==a[0])return e;let o=a[1],s=a[2];if("tuple"!==o[0]||"tuple"!==s[0])throw new Error("Badly formed ast");let l,u=o[1],c=o[2],p=[];return s[1]?i?p.push(["<",r,u]):p.push(["ge",r,u]):i?p.push(["le",r,u]):p.push([">",r,u]),s[2]?i?p.push([">",r,c]):p.push(["le",r,c]):i?p.push(["ge",r,c]):p.push(["<",r,c]),l=i?["or"].concat(p):["and"].concat(p),l}if("subset"===t||"notsubset"===t||"superset"===t||"notsuperset"===t){let r,a,i=!1;if("notsubset"!==t&&"notsuperset"!==t||(i=!0),"subset"===t||"notsubset"===t?(r=n[0],a=n[1]):(r=n[1],a=n[0]),r=to_intervals(r),a=to_intervals(a),"interval"!==r[0]||"interval"!==a[0])return e;let o=r[1],s=r[2],l=a[1],u=a[2];if("tuple"!==o[0]||"tuple"!==s[0]||"tuple"!==l[0]||"tuple"!==u[0])throw new Error("Badly formed ast");let c,p=o[1],d=o[2],m=l[1],f=l[2],h=[];return s[1]&&!u[1]?i?h.push(["le",p,m]):h.push([">",p,m]):i?h.push(["<",p,m]):h.push(["ge",p,m]),s[2]&&!u[2]?i?h.push(["ge",d,f]):h.push(["<",d,f]):i?h.push([">",d,f]):h.push(["le",d,f]),c=i?["or"].concat(h):["and"].concat(h),c}return e}function substitute(e,t){var n=get_tree(e),r={};for(let e in t)r[e]=get_tree(t[e]);return substitute$1(n,r)}function substitute_component(e,t,n){let r=get_tree(e);if(get_tree(n),"number"==typeof t)t=[t];else if(!Array.isArray(t))throw Error("Invalid substitute_component: "+t);let a=["list","tuple","vector","array"];return function e(t,r,i){if(0===r.length)return n;if(!Array.isArray(t))throw Error("Invalid substitute_component: expected list, tuple, vector, or array");let o=t[0],s=t.slice(1);if(!a.includes(o))throw Error("Invalid substitute_component: expected list, tuple, vector, or array");let l=r[0];if(l<0||l>s.length-1)throw Error("Invalid substitute_component: component out of range");let u=r.slice(1),c=e(s[l],u);return[o,...s.slice(0,l),c,...s.slice(l+1)]}(r,t)}function get_component(e,t){let n=get_tree(e);if("number"==typeof t)t=[t];else if(!Array.isArray(t))throw Error("Invalid get_component: "+t);let r=["list","tuple","vector","array"];return function e(t,n){if(0===n.length)return t;if(!Array.isArray(t))throw Error("Invalid get_component: expected list, tuple, vector, or array");let a=t[0],i=t.slice(1);if(!r.includes(a))throw Error("Invalid get_component: expected list, tuple, vector, or array");let o=n[0];if(o<0||o>i.length-1)throw Error("Invalid get_component: component out of range");let s=n.slice(1);return e(i[o],s)}(n,t)}var transformation=Object.freeze({__proto__:null,expand:expand,expand_relations:expand_relations,substitute:substitute,substitute_component:substitute_component,get_component:get_component});function solve_linear(e,t,n){if("string"==typeof t){void 0===n&&void 0!==e.context&&void 0!==e.context.get_assumptions&&(n=e.context.get_assumptions([e.variables()]));var r=simplify(get_tree(e),n);if(Array.isArray(r)){var a=r[0],i=r.slice(1);if("="===a||"ne"===a||"<"===a||"le"===a||">"===a||"ge"===a){var o=simplify(["+",i[0],["-",i[1]]],n),s=e=>!variables(e).includes(t);if(variables(o=simplify(applyAllTransformations(o,[[["+",["*","_a",t],["*","_b",t]],["*",["+","_a","_b"],t],{variables:{_a:s,_b:s},allow_permutations:!0,allow_extended_match:!0,allow_implicit_identities:["_a","_b"],evaluate_numbers:!0}]],20))).includes(t)){var l=match(o,["+",["*","_a",t],"_b"],{variables:{_a:s,_b:s},allow_permutations:!0,allow_implicit_identities:["_a","_b"]});if(l){var u=simplify(l._a),c=simplify(l._b);if(is_nonzero_ast(u,n)){if("="===a||"ne"===a||is_positive_ast(u,n)){let e=simplify(["/",["-",c],u]);return[a,t,e]}if(is_negative_ast(u,n)){var p=simplify(["/",["-",c],u]);return[a="<"===a?">":"le"===a?"ge":">"===a?"<":"le",t,p]}}}}}}}}var solve=Object.freeze({__proto__:null,solve_linear:solve_linear});function clean_assumptions(e,t){if(!Array.isArray(e)||0===e.length)return e;var n=(e=flatten$k(default_order(simplify_logical(expand_relations(e)))))[0],r=e.slice(1);if("and"===n||"or"===n){if(r=r.reduce((function(e,t){return e.every((function(e){return!equal(e,t)}))&&e.push(t),e}),[]),"and"===n&&t&&Array.isArray(t)){let e;e="and"===t[0]?t.slice(1):[t],r=r.filter((t=>e.every((e=>!equal(e,t)))))}e=1===r.length?r[0]:[n].concat(r)}if("and"!==n&&t&&Array.isArray(t)){let n;if(n="and"===t[0]?t.slice(1):[t],!n.every((t=>!equal(t,e))))return}return e}function calculate_derived_assumptions(e,t){if(void 0===t){t=[];for(let n in e.byvar){let r=e.byvar[n];r.length>0&&t.push(r)}if(0===t.length)return{};t=clean_assumptions(t=1===t.length?t[0]:["and"].concat(t))}if(!Array.isArray(t)||0===t.length)return{};var n=t[0],r=t.slice(1);if("and"===n||"or"===n){let t=r.map((function(t){return calculate_derived_assumptions(e,t)})),a=[...new Set(t.reduce(((e,t)=>[...e,...Object.keys(t)]),[]))],i={};for(let r of a){let a=t.reduce((function(e,t){return void 0!==t[r]&&e.push(t[r]),e}),[]);if("and"===n||a.length===t.length){let t=i[r];t=void 0===t?a.length>1?[n].concat(a):a[0]:a.length>1?["and",t,[n].concat(a)]:["and",t,a[0]],i[r]=clean_assumptions(t,get_assumptions(e,r,{omit_derived:!0}))}}return i}let a={};if("="===n||"ne"===n||"<"===n||"le"===n||"in"===n||"subset"===n||"notin"===n||"notsubset"===n){var i=!1;for(let t=0;t<2;t++){let s=r[t],l=r[1-t],u=variables(l);if("string"!=typeof s||0===u.length||u.includes(s))continue;i=!0;var o=n;1===t&&("<"===n?o=">":"le"===n?o="ge":"in"===n?o="ni":"subset"===n?o="superset":"notin"===n?o="notni":"notsubset"===n&&(o="notsuperset"));let c=get_assumptions_for_expr(e,l,[s]);if(c=combine_assumptions(s,o,l,c),void 0!==c){let t=a[s];t=void 0===t?c:["and",t,c],a[s]=clean_assumptions(t,get_assumptions(e,s,{omit_derived:!0}))}}if(i)return a}let s=[];for(let t of r){let n=get_assumptions_for_expr(e,t,[]);void 0!==n&&s.push(n)}if(0===s.length)return{};s=1===s.length?s[0]:["and"].concat(s);for(let n of variables(t))a[n]=clean_assumptions(s,get_assumptions(e,n,{omit_derived:!0}));return a}function get_assumptions_for_expr(e,t,n){let r=variables(t);if(r=r.filter((e=>!n.includes(e))),0===r.length)return;function a(e){return"number"==typeof e||!(!Array.isArray(e)||"-"!==e[0]||"number"!=typeof e[1])}var i=["_b"],o=["_b"],s={_b:a},l={};for(let e=0;e<r.length;e++){let t="_a"+e;l[r[e]]=t,i.push(["*",t,r[e]]),o.push(t),s[t]=a}i=["+"].concat(i);var u=match(t,i,{variables:s,allow_permutations:!0,allow_extended_match:!1,allow_implicit_identities:o,max_group:1});if(!u){let r=[];for(let a of variables(t)){let t=get_assumptions_for_expr(e,a,n);void 0!==t&&r.push(t)}if(0===r.length)return;return 1===r.length?r[0]:["and"].concat(r)}for(let e of r)l[e]=u[l[e]];let c=!1;var p;return 0===u._b&&1===u._a0&&1===r.length&&(c=!0),void 0!==(p=get_assumptions(e,[r],{exclude_variables:n}))?clean_assumptions(function a(i){if(!Array.isArray(i))return;var o=i[0],s=i.slice(1);if("and"===o||"or"===o){let e=s.map(a).filter((e=>void 0!==e));if(0===e.length)return;return"or"===o?e.length===s.length?["or"].concat(e):void 0:1===e.length?e[0]:["and"].concat(e)}if(!(["=","ne","<","le"].includes(o)||["in","notin","subset","notsubset"].includes(o)&&c)){let r=n.concat(variables(t)),a=[];for(let t of variables(i)){if(r.includes(t))continue;let n=get_assumptions_for_expr(e,t,r);void 0!==n&&a.push(n)}return 0===a.length?i:1===a.length?["and",i,a[0]]:["and",i].concat(a)}let u=[];for(let a=0;a<=1;a++){let i=s[a],c=s[1-a];if("string"==typeof i&&r.includes(i)){var p={};p[i]=c;var d=simplify(substitute$1(t,p)),m=!1,f=o;(1===a&&l[i]>0||0===a&&l[i]<0)&&("<"===o?(m=!0,f=">"):"le"===o?(m=!0,f="ge"):"in"===o?(m=!0,f="ni"):"subset"===o?(m=!0,f="superset"):"notin"===o?(m=!0,f="notni"):"notsubset"===o&&(m=!0,f="notsuperset")),m?u.push([o,d,t]):u.push([o,t,d]);let r=n.concat([i]),s=get_assumptions_for_expr(e,d,r);s=combine_assumptions(t,f,d,s),void 0!==s&&u.push(s)}}if(1===u.length)return u[0];if(u.length>1)return["and"].concat(u);let h=n.concat(variables(t));u=[];for(let t of variables(i)){if(h.includes(t))continue;let n=get_assumptions_for_expr(e,t,h);void 0!==n&&u.push(n)}return 0===u.length?i:1===u.length?["and",i,u[0]]:["and",i].concat(u)}(p)):void 0}function combine_assumptions(e,t,n,r){if(!["=","ne","<","le",">","ge","in","notin","ni","notni","subset","notsubset","superset","notsuperset"].includes(t))return r;if(Array.isArray(r)){var a=r[0],i=r.slice(1);if("and"===a||"or"===a){let r=i.map((r=>combine_assumptions(e,t,n,r))).filter((e=>void 0!==e));if(0===r.length)return;return"or"===a?r.length===i.length?[["or"].concat(r)]:void 0:1===r.length?r[0]:["and"].concat(r)}if(!["=","ne","<","le","in","notin","subset","notsubset"].includes(a))return r;var o,s,l=a;if(equal(i[0],n))o=i[1];else{if(!equal(i[1],n))return r;o=i[0],"<"===a?l=">":"le"===a?l="ge":"in"===a?l="ni":"notin"===a?l="notni":"subset"===a?l="superset":"notsubset"===a&&(l="notsuperset")}if("="===t)s=l;else if("="===l)s=t;else if("<"===t){if("<"!==l&&"le"!==l)return"in"===l||"notin"===l?r:void 0;s="<"}else if("le"===t)if("<"===l)s="<";else{if("le"!==l)return"in"===l||"notin"===l?r:void 0;s="le"}else if(">"===t){if(">"!==l&&"ge"!==l)return"in"===l||"notin"===l?r:void 0;s=">"}else if("ge"===t)if(">"===l)s=">";else{if("ge"!==l)return"in"===l||"notin"===l?r:void 0;s="ge"}else if("in"===t){if("subset"!==l)return;s="in"}else if("notin"===t){if("superset"!==l)return;s="notin"}else if("ni"===t){if("notin"!==l)return;s="notsubset"}else if("notni"===t){if("in"!==l)return;s="notsuperset"}else if("subset"===t)if("subset"===l)s="subset";else if("notni"===l)s="notni";else{if("notsuperset"!==l)return;s="notsuperset"}else if("notsubset"===t){if("superset"!==l)return;s="notsubset"}else if("superset"===t)if("superset"===l)s="superset";else if("ni"===l)s="ni";else{if("notsubset"!==l)return;s="notsubset"}else{if("notsuperset"!==t)return;if("subset"!==l)return;s="notsuperset"}return">"===s?["<",o,e]:"ge"===s?["le",o,e]:"ni"===s?["in",o,e]:"notni"===s?["notin",o,e]:"superset"===s?["subset",o,e]:"notsuperset"===s?["notsubset",o,e]:[s,e,o]}}function filter_assumptions_from_tree(e,t){if(Array.isArray(e)&&0!==e.length){Array.isArray(t)||(t=[t]);var n=e[0],r=e.slice(1);if("and"===n){var a=r.map((function(e){return filter_assumptions_from_tree(e,t)}));return 0===(a=a.filter((e=>void 0!==e))).length?void 0:1===a.length?a[0]:["and"].concat(a)}var i=variables(e);return t.filter((e=>i.includes(e))).length>0?void 0:e}}function get_assumptions_sub(e,t,n,r){Array.isArray(t)||(t=[t]);var a=[];return t.forEach((function(t){if(e.byvar[t]||e.derived[t]){if(e.byvar[t]&&e.byvar[t].length>0){var i=filter_assumptions_from_tree(e.byvar[t],n);void 0!==i&&a.push(i)}if(e.derived[t]&&e.derived[t].length>0&&!r){var o=filter_assumptions_from_tree(e.derived[t],n);void 0!==o&&a.push(o)}}else e.generic.length>0&&("x"!==t&&variables(e.generic).includes(t)||a.push(substitute$1(e.generic,{x:t})))})),1===a.length?a=a[0]:a.length>1&&(a=["and"].concat(a)),a.length>0?clean_assumptions(a):void 0}function get_assumptions(e,t,n){void 0===n&&(n={});var r,a=n.exclude_variables;void 0===a?a=[]:Array.isArray(a)||(a=[a]);var i=get_tree(t);if("string"==typeof i)r=[i];else{if(!Array.isArray(i))return;Array.isArray(i[0])&&(r=i[0])}return r?get_assumptions_sub(e,r,a,n.omit_derived):get_assumptions_for_expr(e,i,a)}function add_assumption(e,t,n){var r=get_tree(t);if(!Array.isArray(r))return 0;var a=add_assumption_sub(e,r=clean_assumptions(simplify(r,e)),n);return a&&(e.derived=calculate_derived_assumptions(e)),a}function add_assumption_sub(e,t,n){if("and"===t[0])return t.slice(1).map((t=>add_assumption_sub(e,t,n))).reduce((function(e,t){return e+t}));var r=variables(t);if(0===r.length)return 0;let a=0;!n&&e.generic.length>0&&r.forEach((function(t){void 0===e.byvar[t]&&("x"!==t&&variables(e.generic).includes(t)||(add_assumption_sub(e,substitute$1(e.generic,{x:t}),!0),a+=1))}));for(let n of r){let r=solve_linear(t,n,e),i=t;r&&(i=r);let o=e.byvar[n];void 0!==o&&0!==o.length&&(i=["and",o,i]),i=clean_assumptions(i),equal(i,o)||(e.byvar[n]=i,a+=1)}return a}function add_generic_assumption(e,t){var n=get_tree(t);if(!Array.isArray(n))return 0;var r=add_generic_assumption_sub(e,n=clean_assumptions(simplify(n,e)));return r&&(e.derived=calculate_derived_assumptions(e)),r}function add_generic_assumption_sub(e,t){if("and"===t[0])return t.slice(1).map((t=>add_generic_assumption_sub(e,t))).reduce((function(e,t){return e+t}));if(!variables(t).includes("x"))return 0;let n=solve_linear(t,"x",e),r=t;n&&(r=n);let a=e.generic;return 0!==a.length&&(r=["and",a,r]),r=clean_assumptions(r),equal(r,a)?0:(e.generic=r,1)}function remove_assumption(e,t){var n=get_tree(t);if(!Array.isArray(n))return 0;var r=remove_assumption_sub(e,n=clean_assumptions(simplify(n,e)));return r&&(e.derived=calculate_derived_assumptions(e)),r}function remove_assumption_sub(e,t){if("and"===t[0])return t.slice(1).map((t=>remove_assumption_sub(e,t))).reduce((function(e,t){return e+t}));var n=variables(t);if(0===n.length)return 0;var r=0;for(let a of n){let n=solve_linear(t,a,e),i=e.byvar[a];if(!i||0===i.length)continue;let o,s=i[0],l=i.slice(1),u=l.length;if("and"===s)if(l=l.filter((e=>!(equal(e,t)||equal(e,n)))),0===l.length)o=[];else if(1===l.length)o=l[0];else{if(!(l.length<u))continue;o=[s].concat(l)}else{if(!equal(i,t)&&!equal(i,n))continue;o=[]}r+=1,e.byvar[a]=o}return r}function remove_generic_assumption(e,t){var n=get_tree(t);if(!Array.isArray(n))return 0;var r=remove_generic_assumption_sub(e,n=clean_assumptions(simplify(n,e)));return r&&(e.derived=calculate_derived_assumptions(e)),r}function remove_generic_assumption_sub(e,t){if("and"===t[0])return t.slice(1).map((t=>remove_generic_assumption_sub(e,t))).reduce((function(e,t){return e+t}));if(!variables(t).includes("x"))return 0;var n=e.generic;if(0===n.length)return 0;let r=solve_linear(t,"x",e);var a,i=n[0],o=n.slice(1),s=o.length;if("and"===i)if(0===(o=o.filter((e=>!(equal(e,t)||equal(e,r))))).length)a=[];else if(1===o.length)a=o[0];else{if(!(o.length<s))return 0;a=[i].concat(o)}else{if(!equal(n,t)&&!equal(n,r))return 0;a=[]}return e.generic=a,1}function initialize_assumptions(){var e={byvar:{},derived:{},generic:[],not_commutative:[],get_assumptions:function(t,n){return get_assumptions(e,t,n)},add_assumption:function(t,n){return add_assumption(e,t,n)},add_generic_assumption:function(t){return add_generic_assumption(e,t)},remove_assumption:function(t){return remove_assumption(e,t)},remove_generic_assumption:function(t){return remove_generic_assumption(e,t)}};return e}function padNumberStringToDigits(e,t){let n=Math.floor(t);if(n>0)if(e.includes(".")){if("0"!==e[0]?n++:n+=e.match(/^0\.0*/)[0].length,e.length<n){let t=n-e.length;e+="0".repeat(t)}}else if(e.length<n){let t=n-e.length;e+="."+"0".repeat(t)}return e}function padNumberStringToDecimals(e,t){let n=Math.floor(t);if(n>0)if(e.includes(".")){let t=e.match(/\.\d*$/)[0].length-1;t<n&&(e+="0".repeat(n-t))}else e+="."+"0".repeat(n);return e}const operators$1={"+":function(e){return e.join(" ")},"-":function(e){return"-"+e[0]},"*":function(e){return e.join(" ")},"/":function(e){return"\\frac{"+e[0]+"}{"+e[1]+"}"},_:function(e){return e[0]+"_{"+e[1]+"}"},"^":function(e){return e[0]+"^{"+e[1]+"}"},prime:function(e){return e[0]+"'"},tuple:function(e){return"\\left( "+e.join(", ")+" \\right)"},array:function(e){return"\\left[ "+e.join(", ")+" \\right]"},list:function(e){return e.join(", ")},set:function(e){return"\\left\\{ "+e.join(", ")+" \\right\\}"},vector:function(e){return"\\left( "+e.join(", ")+" \\right)"},interval:function(e){return"\\left( "+e.join(", ")+" \\right)"},matrix:function(e){return"\\left( "+e.join(", ")+" \\right)"},and:function(e){return e.join(" \\land ")},or:function(e){return e.join(" \\lor ")},not:function(e){return"\\lnot "+e[0]},"=":function(e){return e.join(" = ")},"<":function(e){return e.join(" < ")},">":function(e){return e.join(" > ")},lts:function(e){return e.join(" < ")},gts:function(e){return e.join(" > ")},le:function(e){return e.join(" \\le ")},ge:function(e){return e.join(" \\ge ")},ne:function(e){return e.join(" \\ne ")},in:function(e){return e[0]+" \\in "+e[1]},notin:function(e){return e[0]+" \\notin "+e[1]},ni:function(e){return e[0]+" \\ni "+e[1]},notni:function(e){return e[0]+" \\not\\ni "+e[1]},subset:function(e){return e[0]+" \\subset "+e[1]},notsubset:function(e){return e[0]+" \\not\\subset "+e[1]},superset:function(e){return e[0]+" \\supset "+e[1]},notsuperset:function(e){return e[0]+" \\not\\supset "+e[1]},union:function(e){return e.join(" \\cup ")},intersect:function(e){return e.join(" \\cap ")},derivative_leibniz:function(e){return"\\frac{d"+e[0]+"}{d"+e[1]+"}"},partial_derivative_leibniz:function(e){return"\\frac{d"+e[0]+"}{d"+e[1]+"}"},"|":function(e){return e[0]+" \\mid "+e[1]},":":function(e){return e[0]+" : "+e[1]}},allowedLatexSymbolsDefault$1=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial","abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg"],matrixEnvironmentDefault="bmatrix";class astToLatex$1{constructor({allowedLatexSymbols:e=allowedLatexSymbolsDefault$1,matrixEnvironment:t=matrixEnvironmentDefault,padToDigits:n=null,padToDecimals:r=null}={}){this.allowedLatexSymbols=e,this.matrixEnvironment=t,this.padToDigits=n,this.padToDecimals=r}convert(e){return this.statement(e)}statement(e){if("string"==typeof e||"number"==typeof e)return this.single_statement(e);var t=e[0],n=e.slice(1);if("ldots"===t)return"\\ldots";if(!(t in operators$1)&&"apply"!==t)throw new Error("Badly formed ast: operator "+t+" not recognized.");return"and"===t||"or"===t?operators$1[t](n.map(function(e,t){let n=this.single_statement(e);return n.toString().match(/ /)&&!n.toString().match(/^\\left\(.*\\right\)$/)?"\\left("+n+"\\right)":n}.bind(this))):this.single_statement(e)}single_statement(e){if("string"==typeof e||"number"==typeof e)return this.expression(e);var t=e[0],n=e.slice(1);if("not"===t)return operators$1[t](n.map(function(e,t){let n=this.single_statement(e);return n.toString().match(/ /)&&!n.toString().match(/^\\left\(.*\\right\)$/)?"\\left("+n+"\\right)":n}.bind(this)));if("="===t||"ne"===t||"<"===t||">"===t||"le"===t||"ge"===t||"in"===t||"notin"===t||"ni"===t||"notni"===t||"subset"===t||"notsubset"===t||"superset"===t||"notsuperset"===t)return operators$1[t](n.map(function(e,t){return this.expression(e)}.bind(this)));if("lts"===t||"gts"===t){let e=n[0],r=n[1];if("tuple"!==e[0]||"tuple"!==r[0])throw new Error("Badly formed ast");let a=this.expression(e[1]);for(let n=1;n<e.length-1;n++)r[n]?a+="lts"===t?" < ":" > ":a+="lts"===t?" \\le ":" \\ge ",a+=this.expression(e[n+1]);return a}return this.expression(e)}expression(e){if("string"==typeof e||"number"==typeof e)return this.term(e);var t=e[0],n=e.slice(1);return"+"===t?operators$1[t](n.map(function(e,t){return t>0?this.termWithPlusIfNotNegated(e):this.term(e)}.bind(this))):"union"===t||"intersect"===t?operators$1[t](n.map(function(e,t){return this.term(e)}.bind(this))):this.term(e)}term(e){if("string"==typeof e||"number"==typeof e)return this.factor(e);var t=e[0],n=e.slice(1);return"-"===t?operators$1[t](n.map(function(e,t){return this.term(e)}.bind(this))):"*"===t?operators$1[t](n.map(function(e,t){let n;return t>0?(n=this.factorWithParenthesesIfNegated(e),n.toString().match(/^[0-9]/)?"\\cdot "+n:"\\, "+n):this.factor(e)}.bind(this))):"/"===t?operators$1[t](n.map(function(e,t){return this.expression(e)}.bind(this))):this.factor(e)}simple_factor_or_function_or_parens(e){var t=this.factor(e);return!!(1===t.toString().length||"string"==typeof e||"apply"===e[0]&&"sqrt"!==e[1]||t.toString().match(/^\\left\(.*\\right\)$/))||"number"==typeof e&&e>=0&&!e.toString().includes("e")}stringConvert(e){return e.length>1?this.allowedLatexSymbols.includes(e)?"\\"+e:"\\var{"+e+"}":e}factor(e){if("string"==typeof e)return this.stringConvert(e);if("number"==typeof e){if(e===1/0)return"\\infty";if(e===-1/0)return"-\\infty";if(Number.isNaN(e))return"NaN";{let t=e.toString(),n=t.indexOf("e");if(-1===n)return null!==this.padToDigits?t=padNumberStringToDigits(t,this.padToDigits):null!==this.padToDecimals&&(t=padNumberStringToDecimals(t,this.padToDecimals)),t;let r=t.substring(0,n),a=t.substring(n+1);if("+"===a[0]&&(a=a.slice(1)),null!==this.padToDigits)r=padNumberStringToDigits(r,this.padToDigits);else if(null!==this.padToDecimals){let n=Number(a);if(n>0)return t=e.toLocaleString("fullwide",{useGrouping:!1}),padNumberStringToDecimals(t,this.padToDecimals);r=padNumberStringToDecimals(r,this.padToDecimals+n)}return r+" \\cdot 10^{"+a+"}"}}var t=e[0],n=e.slice(1);if("^"===t){if(Number.isInteger(n[0])&&Number.isInteger(n[1]))return n[0]<0?"\\left("+n[0].toString()+"\\right)^{"+n[1].toString()+"}":n[0].toString()+"^{"+n[1].toString()+"}";let e=this.factor(n[0]),t=n[0];for(;"prime"===t[0];)t=t[1];return this.simple_factor_or_function_or_parens(t)||"_"===t[0]&&"string"==typeof t[1]||(e="\\left("+e.toString()+"\\right)"),e+"^{"+this.statement(n[1])+"}"}if("_"===t){let e=this.factor(n[0]);return this.simple_factor_or_function_or_parens(n[0])||(e="\\left("+e.toString()+"\\right)"),e+"_{"+this.statement(n[1])+"}"}if("prime"===t){let e=n[0],t=1;for(;"prime"===e[0];)t+=1,e=e[1];let r=this.factor(e);this.simple_factor_or_function_or_parens(e)||"_"===e[0]&&"string"==typeof e[1]||(r="\\left("+r.toString()+"\\right)");for(let e=0;e<t;e++)r+="'";return r}if("-"===t)return operators$1[t](n.map(function(e,t){return this.factor(e)}.bind(this)));if("tuple"===t||"array"===t||"list"===t||"set"===t||"vector"===t||"|"===t||":"===t)return operators$1[t](n.map(function(e,t){return this.statement(e)}.bind(this)));if("interval"===t){let e=n[0],t=n[1];if("tuple"!==e[0]||"tuple"!==t[0])throw new Error("Badly formed ast");let r=this.statement(e[1])+", "+this.statement(e[2]);return r=t[1]?"\\left[ "+r:"\\left( "+r,t[2]?r+=" \\right]":r+=" \\right)",r}if("matrix"===t){let e=n[0],t=n[1],r="\\begin{"+this.matrixEnvironment+"} ";for(let n=0;n<e[1];n+=1){for(let a=0;a<e[2];a+=1)r+=this.statement(t[n+1][a+1]),a<e[2]-1&&(r+=" & ");n<e[1]-1&&(r+=" \\\\ ")}return r=r+" \\end{"+this.matrixEnvironment+"}",r}if("derivative_leibniz"===t||"partial_derivative_leibniz"===t){let e="d";"partial_derivative_leibniz"===t&&(e="\\partial ");let r=n[0],a=n[1],i=1,o="";Array.isArray(r)?(o=r[1],i=r[2]):o=r;let s=e;i>1?s=s.trimRight()+"^{"+i+"}"+this.stringConvert(o):s+=this.stringConvert(o),s="\\frac{ "+s+" }{ ";let l=1;Array.isArray(a)&&(l=a.length-1);for(let t=1;t<=l;t++){let n=a[t],r=1,i="";Array.isArray(n)?(i=n[1],r=n[2]):i=n,s=s+e+this.stringConvert(i),r>1&&(s=s+"^{"+r+"}"),s+=" "}return s+="}",s}if("apply"===t){if("abs"===n[0])return"\\left|"+this.statement(n[1])+"\\right|";if("factorial"===n[0]){let e=this.factor(n[1]);return this.simple_factor_or_function_or_parens(n[1])||"_"===n[1][0]&&"string"==typeof n[1][1]?e+"!":"\\left("+e.toString()+"\\right)!"}if("sqrt"===n[0])return"\\sqrt{"+this.statement(n[1])+"}";if("log10"===n[0])return"\\log_{10}\\left("+this.statement(n[1])+"\\right)";let e=this.factor(n[0]),t=this.statement(n[1]);return"tuple"!==n[1][0]&&(t="\\left("+t+"\\right)"),e+t}return"\\left("+this.statement(e)+"\\right)"}factorWithParenthesesIfNegated(e){var t=this.factor(e);return t.toString().match(/^-/)?"\\left("+t.toString()+"\\right)":t}termWithPlusIfNotNegated(e){var t=this.term(e);let n=t.toString();return n.match(/^-/)?n.match(/^-[^ ]/)?"- "+n.slice(1):t:"+ "+n}}const textToAst$2=new textToAst$4,astToLatex=new astToLatex$1;var derivatives={sin:textToAst$2.convert("cos x"),cos:textToAst$2.convert("-(sin x)"),tan:textToAst$2.convert("(sec x)^2"),cot:textToAst$2.convert("-((csc x)^2)"),sec:textToAst$2.convert("(sec x)*(tan x)"),csc:textToAst$2.convert("-(csc x)*(cot x)"),sqrt:textToAst$2.convert("1/(2*sqrt(x))"),log:textToAst$2.convert("1/x"),ln:textToAst$2.convert("1/x"),exp:textToAst$2.convert("exp(x)"),arcsin:textToAst$2.convert("1/sqrt(1 - x^2)"),arccos:textToAst$2.convert("-1/sqrt(1 - x^2)"),arctan:textToAst$2.convert("1/(1 + x^2)"),arccsc:textToAst$2.convert("-1/(sqrt(-1/x^2 + 1)*x^2)"),arcsec:textToAst$2.convert("1/(sqrt(-1/x^2 + 1)*x^2)"),arccot:textToAst$2.convert("-1/(1 + x^2)"),abs:textToAst$2.convert("abs(x)/x")};function derivative(e,t,n=[]){var r=get_tree(e),a="\\frac{d}{d"+t+"} ";if("number"==typeof r)return n.push("The derivative of a constant is zero, that is, \\("+a+astToLatex.convert(r)+" = 0\\)."),0;if(variables(r).indexOf(t)<0)return n.push("The derivative of a constant is zero, that is, \\("+a+astToLatex.convert(r)+" = 0\\)."),0;if("string"==typeof r)return t===r?(n.push("We know the derivative of the identity function is one, that is, \\("+a+astToLatex.convert(r)+" = 1\\)."),1):(n.push("As far as \\("+astToLatex.convert(t)+"\\) is concerned, \\("+astToLatex.convert(r)+"\\) is constant, so "+a+astToLatex.convert(r)+" = 0\\)."),0);var i=r[0],o=r.slice(1);if("+"===i||"-"===i||"~"===i){n.push("Using the sum rule, \\("+a+astToLatex.convert(r)+" = "+o.map((function(e,t){return a+astToLatex.convert(e)})).join(" + ")+"\\).");let e=[i].concat(o.map((function(e,r){return derivative(e,t,n)})));return e=simplify(e),n.push("So using the sum rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+"\\)."),e}if("*"===i){let e=[],i=[];for(let n=0;n<o.length;n++)"number"==typeof o[n]||variables(o[n]).indexOf(t)<0?i.push(o[n]):e.push(o[n]);if(i.length>0){if(0===e.length)return n.push("Since the derivative of a constant is zero, \\("+a+astToLatex.convert(r)+" = 0.\\)"),0;let o=["*"].concat(e);if(1===e.length&&(o=e[0]),o===t){n.push("By the constant multiple rule, \\("+a+astToLatex.convert(r)+" = "+i.map((function(e,t){return astToLatex.convert(e)})).join(" \\cdot ")+"\\).");let e=["*"].concat(i);return e=simplify(e),e}n.push("By the constant multiple rule, \\("+a+astToLatex.convert(r)+" = "+i.map((function(e,t){return astToLatex.convert(e)})).join(" \\cdot ")+" \\cdot "+a+"\\left("+astToLatex.convert(o)+"\\right)\\).");let s=derivative(o,t,n),l=["*"].concat(i.concat([s]));return l=simplify(l),n.push("And so \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}n.push("Using the product rule, \\("+a+astToLatex.convert(r)+" = "+o.map((function(e,t){return o.map((function(n,r){return t===r?a+"\\left("+astToLatex.convert(e)+"\\right)":astToLatex.convert(n)})).join(" \\cdot ")})).join(" + ")+"\\).");let s=o.slice(),l=["+"].concat(o.map((function(e,r){return["*"].concat(s.map((function(e,a){if(r===a){let r=derivative(e,t,n);return 1===r?null:r}return e})).filter((function(e){return null!=e})))})));return l=simplify(l),n.push("So using the product rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}if("/"===i){let e=o[0],i=o[1];if(variables(i).indexOf(t)<0){n.push("By the constant multiple rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(["/",1,i])+" \\cdot "+a+"\\left("+astToLatex.convert(e)+"\\right)\\).");let o=derivative(e,t,n),s=textToAst$2.convert("(1/g)*d"),l=substitute$1(s,{d:o,g:i});return l=simplify(l),n.push("So \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}if(variables(e).indexOf(t)<0){1!==e&&n.push("By the constant multiple rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+" \\cdot "+a+"\\left("+astToLatex.convert(["/",1,i])+"\\right)\\)."),n.push("Since \\(\\frac{d}{du} \\frac{1}{u}\\) is \\(\\frac{-1}{u^2}\\), the chain rule gives \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+"\\cdot \\frac{-1}{ "+astToLatex.convert(i)+"^2} \\cdot "+a+astToLatex.convert(i)+"\\).");let o=derivative(i,t,n),s=textToAst$2.convert("f * (-a/(g^2))"),l=substitute$1(s,{f:e,a:o,g:i});return l=simplify(l),n.push("So since \\(\\frac{d}{du} \\frac{1}{u}\\) is \\(\\frac{-1}{u^2}\\), the chain rule gives \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}n.push("Using the quotient rule, \\("+a+astToLatex.convert(r)+" = \\frac{"+a+"\\left("+astToLatex.convert(e)+"\\right) \\cdot "+astToLatex.convert(i)+" - "+astToLatex.convert(e)+"\\cdot "+a+"\\left("+astToLatex.convert(i)+"\\right)}{ \\left( "+astToLatex.convert(i)+" \\right)^2} \\).");let s=derivative(e,t,n),l=derivative(i,t,n),u=textToAst$2.convert("(a * g - f * b)/(g^2)"),c=substitute$1(u,{a:s,b:l,f:e,g:i});return c=simplify(c),n.push("So using the quotient rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(c)+"\\)."),c}if("^"===i){let e=o[0],i=o[1];if(variables(i).indexOf(t)<0){if("string"==typeof e&&"x"===e){if("number"==typeof i){let t=textToAst$2.convert("n * (f^m)"),o=substitute$1(t,{n:i,m:i-1,f:e});return o=simplify(o),n.push("By the power rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(i)+" \\cdot \\left("+astToLatex.convert(e)+"\\right)^{"+astToLatex.convert(["-",i,1])+"}\\)."),o}let t=textToAst$2.convert("n * (f^(n-1))"),o=substitute$1(t,{n:i,f:e});return o=simplify(o),n.push("By the power rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(i)+" \\cdot \\left("+astToLatex.convert(e)+"\\right)^{"+astToLatex.convert(["-",i,1])+"}\\)."),o}1!==i&&n.push("By the power rule and the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(i)+" \\cdot \\left("+astToLatex.convert(e)+"\\right)^{"+astToLatex.convert(["-",i,1])+"} \\cdot "+a+astToLatex.convert(e)+"\\).");let o=derivative(e,t,n);if(1===i)return o;if("number"==typeof i){let t=textToAst$2.convert("n * (f^m) * a"),s=substitute$1(t,{n:i,m:i-1,f:e,a:o});return s=simplify(s),n.push("So by the power rule and the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(s)+"\\)."),s}let s=textToAst$2.convert("n * (f^(n-1)) * a"),l=substitute$1(s,{n:i,f:e,a:o});return l=simplify(l),n.push("So by the power rule and the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}if("e"===e&&math$3.define_e){if("string"==typeof i&&i===t){let e=textToAst$2.convert("e^(f)"),o=substitute$1(e,{f:i});return o=simplify(o),n.push("The derivative of \\(e^"+astToLatex.convert(t)+"\\) is itself, that is, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(r)+"\\)."),o}n.push("Using the rule for \\(e^x\\) and the chain rule, we know \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(r)+" \\cdot "+a+astToLatex.convert(i)+"\\).");let e=textToAst$2.convert("e^(f)*d"),o=derivative(i,t,n),s=substitute$1(e,{f:i,d:o});return s=simplify(s),n.push("So using the rule for \\(e^x\\) and the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(s)+"\\)."),s}if("number"==typeof e){if("string"==typeof i&&i===t){let o=textToAst$2.convert("a^(f) * log(a)"),s=substitute$1(o,{a:e,f:i});return s=simplify(s),n.push("The derivative of \\(a^"+astToLatex.convert(t)+"\\) is \\(a^{"+astToLatex.convert(t)+"} \\, \\log a\\), that is, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(s)+"\\)."),s}let o=textToAst$2.convert("a^(f) * log(a)"),s=substitute$1(o,{a:e,f:i});n.push("Using the rule for \\(a^x\\) and the chain rule, we know \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(s)+" \\cdot "+a+astToLatex.convert(i)+"\\).");let l=textToAst$2.convert("a^(b)*log(a)*d"),u=derivative(i,t,n),c=substitute$1(l,{a:e,b:i,d:u});return c=simplify(c),n.push("So using the rule for \\(a^x\\) and the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(c)+"\\)."),c}let s=e,l=i;n.push("Recall the general rule for exponents, namely that \\(\\frac{d}{dx} u(x)^{v(x)} = u(x)^{v(x)} \\cdot \\left( v'(x) \\cdot \\log u(x) + \\frac{v(x) \\cdot u'(x)}{u(x)} \\right)\\).  In this case, \\(u(x) = "+astToLatex.convert(s)+"\\) and \\(v(x) = "+astToLatex.convert(l)+"\\).");let u=derivative(s,t,n),c=derivative(l,t,n),p=textToAst$2.convert("(f^g)*(b * log(f) + (g * a)/f)"),d=substitute$1(p,{a:u,b:c,f:s,g:l});return d=simplify(d),n.push("So by the general rule for exponents, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(d)+"\\)."),d}if("apply"===i&&!(o[0]in derivatives)){let e=o[1];n.push("By the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(substitute$1(["apply",o[0]+"'","x"],{x:e}))+" \\cdot "+a+astToLatex.convert(e)+"\\).");let i=["*",substitute$1(["apply",o[0]+"'","x"],{x:e}),derivative(e,t,n)];return i=simplify(i),n.push("So by the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(i)+"\\)."),i}if("apply"===i&&o[0]in derivatives||i in derivatives){let e=!1;"apply"===i&&(i=o[0],o=o.slice(1),e=!0);let s=o[0];if("number"==typeof s){let e=0;return n.push("The derivative of a constant is zero so \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+"\\)."),e}if("string"==typeof s&&s===t){let e=["*",substitute$1(derivatives[i],{x:s})];return e=simplify(e),n.push("It is the case that \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+"\\)."),e}if("string"==typeof s&&s!==t){let e=0;return n.push("Since the derivative of a constant is zero, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(e)+"\\)."),e}{let o=[i,"u"];e&&(o=["apply"].concat(o)),n.push("Recall \\(\\frac{d}{du}"+astToLatex.convert(o)+" = "+astToLatex.convert(derivative(o,"u",[]))+"\\)."),n.push("By the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(substitute$1(derivatives[i],{x:s}))+" \\cdot "+a+astToLatex.convert(s)+"\\).");let l=["*",substitute$1(derivatives[i],{x:s}),derivative(s,t,n)];return l=simplify(l),n.push("So by the chain rule, \\("+a+astToLatex.convert(r)+" = "+astToLatex.convert(l)+"\\)."),l}}return 0}function lowercaseFirstLetter(e){return e.charAt(0).toLowerCase()+e.slice(1)}function simplify_story(e){for(let t=e.length-1;t>=1;t--)e[t]===e[t-1]&&e.splice(t,1);for(let t=0;t<e.length;t++)for(let n=t+1;n<e.length;n++)e[t]===e[n]&&(e[n]="Again, "+lowercaseFirstLetter(e[n]));return e}function derivative_story(e,t){var n=[];return derivative(e,t,n),simplify_story(n)}const derivativeStory=derivative_story;var differentiation=Object.freeze({__proto__:null,derivative:derivative,derivative_story:derivative_story,derivativeStory:derivativeStory});const unicode_operators={"+":function(e){return e.join(" ")},"-":function(e){return"-"+e[0]},"*":function(e){return e.join(" ")},"/":function(e){return e[0]+"/"+e[1]},_:function(e){return e[0]+"_"+e[1]},"^":function(e){return e[0]+"^"+e[1]},prime:function(e){return e[0]+"'"},tuple:function(e){return"( "+e.join(", ")+" )"},array:function(e){return"[ "+e.join(", ")+" ]"},list:function(e){return e.join(", ")},set:function(e){return"{ "+e.join(", ")+" }"},vector:function(e){return"( "+e.join(", ")+" )"},interval:function(e){return"( "+e.join(", ")+" )"},matrix:function(e){return"( "+e.join(", ")+" )"},and:function(e){return e.join(" and ")},or:function(e){return e.join(" or ")},not:function(e){return"not "+e[0]},"=":function(e){return e.join(" = ")},"<":function(e){return e.join(" < ")},">":function(e){return e.join(" > ")},lts:function(e){return e.join(" < ")},gts:function(e){return e.join(" > ")},le:function(e){return e.join("  ")},ge:function(e){return e.join("  ")},ne:function(e){return e.join("  ")},in:function(e){return e[0]+"  "+e[1]},notin:function(e){return e[0]+"  "+e[1]},ni:function(e){return e[0]+"  "+e[1]},notni:function(e){return e[0]+"  "+e[1]},subset:function(e){return e[0]+"  "+e[1]},notsubset:function(e){return e[0]+"  "+e[1]},superset:function(e){return e[0]+"  "+e[1]},notsuperset:function(e){return e[0]+"  "+e[1]},union:function(e){return e.join("  ")},intersect:function(e){return e.join("  ")},derivative_leibniz:function(e){return"d"+e[0]+"/d"+e[1]},partial_derivative_leibniz:function(e){return""+e[0]+"/"+e[1]},"|":function(e){return e[0]+" | "+e[1]},":":function(e){return e[0]+" : "+e[1]}},nonunicode_operators={"+":function(e){return e.join(" ")},"-":function(e){return"-"+e[0]},"*":function(e){return e.join(" ")},"/":function(e){return e[0]+"/"+e[1]},_:function(e){return e[0]+"_"+e[1]},"^":function(e){return e[0]+"^"+e[1]},prime:function(e){return e[0]+"'"},tuple:function(e){return"( "+e.join(", ")+" )"},array:function(e){return"[ "+e.join(", ")+" ]"},list:function(e){return e.join(", ")},set:function(e){return"{ "+e.join(", ")+" }"},vector:function(e){return"( "+e.join(", ")+" )"},interval:function(e){return"( "+e.join(", ")+" )"},matrix:function(e){return"( "+e.join(", ")+" )"},and:function(e){return e.join(" and ")},or:function(e){return e.join(" or ")},not:function(e){return"not "+e[0]},"=":function(e){return e.join(" = ")},"<":function(e){return e.join(" < ")},">":function(e){return e.join(" > ")},lts:function(e){return e.join(" < ")},gts:function(e){return e.join(" > ")},le:function(e){return e.join(" <= ")},ge:function(e){return e.join(" >= ")},ne:function(e){return e.join(" ne ")},in:function(e){return e[0]+" elementof "+e[1]},notin:function(e){return e[0]+" notelementof "+e[1]},ni:function(e){return e[0]+" containselement "+e[1]},notni:function(e){return e[0]+" notcontainselement "+e[1]},subset:function(e){return e[0]+" subset "+e[1]},notsubset:function(e){return e[0]+" notsubset "+e[1]},superset:function(e){return e[0]+" superset "+e[1]},notsuperset:function(e){return e[0]+" notsuperset "+e[1]},union:function(e){return e.join(" union ")},intersect:function(e){return e.join(" intersect ")},derivative_leibniz:function(e){return"d"+e[0]+"/d"+e[1]},partial_derivative_leibniz:function(e){return""+e[0]+"/"+e[1]},"|":function(e){return e[0]+" | "+e[1]},":":function(e){return e[0]+" : "+e[1]}},output_unicodeDefault=!0;class astToText$1{constructor({output_unicode:e=output_unicodeDefault,padToDigits:t=null,padToDecimals:n=null}={}){this.output_unicode=e,this.operators=unicode_operators,e||(this.operators=nonunicode_operators),this.padToDigits=t,this.padToDecimals=n}convert(e){return this.statement(e)}statement(e){if("string"==typeof e||"number"==typeof e)return this.single_statement(e);let t=e[0],n=e.slice(1);if("ldots"===t)return"...";if(!(t in this.operators)&&"apply"!==t)throw new Error("Badly formed ast: operator "+t+" not recognized.");return"and"===t||"or"===t?this.operators[t](n.map(function(e,t){let n=this.single_statement(e);return n.toString().match(/ /)&&!n.toString().match(/^\(.*\)$/)?"("+n+")":n}.bind(this))):this.single_statement(e)}single_statement(e){if("string"==typeof e||"number"==typeof e)return this.expression(e);let t=e[0],n=e.slice(1);if("not"===t)return this.operators[t](n.map(function(e,t){let n=this.single_statement(e);return n.toString().match(/ /)&&!n.toString().match(/^\(.*\)$/)?"("+n+")":n}.bind(this)));if("="===t||"ne"===t||"<"===t||">"===t||"le"===t||"ge"===t||"in"===t||"notin"===t||"ni"===t||"notni"===t||"subset"===t||"notsubset"===t||"superset"===t||"notsuperset"===t)return this.operators[t](n.map(function(e,t){return this.expression(e)}.bind(this)));if("lts"===t||"gts"===t){let e=n[0],r=n[1];if("tuple"!==e[0]||"tuple"!==r[0])throw new Error("Badly formed ast");let a=this.expression(e[1]);for(let n=1;n<e.length-1;n++)r[n]?a+="lts"===t?" < ":" > ":"lts"===t?this.output_unicode?a+="  ":a+=" <= ":this.output_unicode?a+="  ":a+=" >= ",a+=this.expression(e[n+1]);return a}return this.expression(e)}expression(e){if("string"==typeof e||"number"==typeof e)return this.term(e);let t=e[0],n=e.slice(1);return"+"===t?this.operators[t](n.map(function(e,t){return t>0?this.termWithPlusIfNotNegated(e):this.term(e)}.bind(this))):"union"===t||"intersect"===t?this.operators[t](n.map(function(e,t){return this.term(e)}.bind(this))):this.term(e)}term(e){if("string"==typeof e||"number"==typeof e)return this.factor(e);let t=e[0],n=e.slice(1);return"-"===t?this.operators[t](n.map(function(e,t){return this.term(e)}.bind(this))):"*"===t?this.operators[t](n.map(function(e,t){let n;return t>0?(n=this.factorWithParenthesesIfNegated(e),n.toString().match(/^[0-9]/)?"* "+n:n):this.factor(e)}.bind(this))):"/"===t?this.operators[t](n.map(function(e,t){return this.factor(e)}.bind(this))):this.factor(e)}symbolConvert(e){let t={alpha:"",beta:"",Gamma:"",gamma:"",Delta:"",delta:"",epsilon:"",zeta:"",eta:"",Theta:"",theta:"",iota:"",kappa:"",Lambda:"",lambda:"",mu:"",nu:"",Xi:"",xi:"",Pi:"",pi:"",rho:"",Sigma:"",sigma:"",tau:"",Upsilon:"",upsilon:"",Phi:"",phi:"",Psi:"",psi:"",Omega:"",omega:""};return this.output_unicode&&e in t?t[e]:e}simple_factor_or_function_or_parens(e){let t=this.factor(e);return!(1!==t.toString().length&&"string"!=typeof e&&"apply"!==e[0]&&!t.toString().match(/^\(.*\)$/))||"number"==typeof e&&e>=0&&!e.toString().includes("e")}factor(e){if("string"==typeof e)return this.symbolConvert(e);if("number"==typeof e){if(e===1/0)return this.output_unicode?"":"infinity";if(e===-1/0)return this.output_unicode?"-":"-infinity";if(Number.isNaN(e))return"NaN";{let t=e.toString(),n=t.indexOf("e");if(-1===n)return null!==this.padToDigits?t=padNumberStringToDigits(t,this.padToDigits):null!==this.padToDecimals&&(t=padNumberStringToDecimals(t,this.padToDecimals)),t;let r=t.substring(0,n),a=t.substring(n+1);if(null!==this.padToDigits)r=padNumberStringToDigits(r,this.padToDigits);else if(null!==this.padToDecimals){let n=Number(a);if(n>0)return t=e.toLocaleString("fullwide",{useGrouping:!1}),padNumberStringToDecimals(t,this.padToDecimals);r=padNumberStringToDecimals(r,this.padToDecimals+n)}return"+"===a[0]?r+" * 10^"+a.substring(1):r+" * 10^("+a+")"}}let t=e[0],n=e.slice(1);if("^"===t){if(Number.isInteger(n[0])&&Number.isInteger(n[1])){let e;return e=n[0]<0?"("+n[0].toString()+")":n[0].toString(),n[1]<0?e+"^("+n[1].toString()+")":e+"^"+n[1].toString()}let e=this.factor(n[0]),t=n[0];for(;"prime"===t[0];)t=t[1];this.simple_factor_or_function_or_parens(t)||"_"===t[0]&&"string"==typeof t[1]||(e="("+e.toString()+")");let r=this.factor(n[1]);return this.simple_factor_or_function_or_parens(n[1])||(r="("+r.toString()+")"),e+"^"+r}if("_"===t)return this.operators[t](n.map(function(e,t){let n=this.factor(e);return this.simple_factor_or_function_or_parens(e)?n:"("+n.toString()+")"}.bind(this)));if("prime"===t){let e=n[0],t=1;for(;"prime"===e[0];)t+=1,e=e[1];let r=this.factor(e);this.simple_factor_or_function_or_parens(e)||"_"===e[0]&&"string"==typeof e[1]||(r="("+r.toString()+")");for(let e=0;e<t;e++)r+="'";return r}if("-"===t)return this.operators[t](n.map(function(e,t){return this.factor(e)}.bind(this)));if("tuple"===t||"array"===t||"list"===t||"set"===t||"vector"===t||"|"===t||":"===t)return this.operators[t](n.map(function(e,t){return this.statement(e)}.bind(this)));if("interval"===t){let e=n[0],t=n[1];if("tuple"!==e[0]||"tuple"!==t[0])throw new Error("Badly formed ast");let r=this.statement(e[1])+", "+this.statement(e[2]);return r=t[1]?"[ "+r:"( "+r,t[2]?r+=" ]":r+=" )",r}if("matrix"===t){let e=n[0],t=n[1],r="[ ";for(let n=0;n<e[1];n+=1){r+="[ ";for(let a=0;a<e[2];a+=1)r+=this.statement(t[n+1][a+1]),a<e[2]-1&&(r+=","),r+=" ";r+="]",n<e[1]-1&&(r+=","),r+=" "}return r+="]",r}if("derivative_leibniz"===t||"partial_derivative_leibniz"===t){let e="d";"partial_derivative_leibniz"===t&&(e="");let r=n[0],a=n[1],i=1,o="";Array.isArray(r)?(o=r[1],i=r[2]):o=r;let s=e;i>1&&(s=s+"^"+i),s=s+this.symbolConvert(o)+"/";let l=1;Array.isArray(a)&&(l=a.length-1);for(let t=1;t<=l;t++){let n=a[t],r=1,i="";Array.isArray(n)?(i=n[1],r=n[2]):i=n,s=s+e+this.symbolConvert(i),r>1&&(s=s+"^"+r)}return s}if("apply"===t){if("abs"===n[0])return"|"+this.statement(n[1])+"|";if("factorial"===n[0]){let e=this.factor(n[1]);return this.simple_factor_or_function_or_parens(n[1])||"_"===n[1][0]&&"string"==typeof n[1][1]?e+"!":"("+e.toString()+")!"}let e=this.factor(n[0]),t=this.statement(n[1]);return"tuple"!==n[1][0]&&(t="("+t+")"),e+t}return"("+this.statement(e)+")"}factorWithParenthesesIfNegated(e){let t=this.factor(e);return t.toString().match(/^-/)?"("+t.toString()+")":t}termWithPlusIfNotNegated(e){let t=this.term(e),n=t.toString();return n.match(/^-/)?n.match(/^-[^ ]/)?"- "+n.slice(1):t:"+ "+n}}var astToText=new astToText$1;function subscripts_to_strings(e,t=!1){var n=get_tree(e);if(!Array.isArray(n))return n;let r=n[0],a=n.slice(1);return"_"===r&&(t||a.every((e=>["number","string"].includes(typeof e))))?astToText.convert(n):[r].concat(a.map((e=>subscripts_to_strings(e,t))))}function strings_to_subscripts(e){var t=get_tree(e);if("string"==typeof t){let e=t.match(/^([0-9a-zA-Z]+)_([a-zA-Z]+|[0-9]+)$/);if(e){let t=Number(e[1]);isNaN(t)&&(t=e[1]);let n=Number(e[2]);return isNaN(n)&&(n=e[2]),["_",t,n]}return t}if(!Array.isArray(t))return t;let n=t[0],r=t.slice(1);return[n].concat(r.map(strings_to_subscripts))}var normalization=Object.freeze({__proto__:null,normalize_function_names:normalize_function_names,normalize_applied_functions:normalize_applied_functions,substitute_abs:substitute_abs,default_order:default_order,constants_to_floats:constants_to_floats,tuples_to_vectors:tuples_to_vectors,to_intervals:to_intervals,subscripts_to_strings:subscripts_to_strings,strings_to_subscripts:strings_to_subscripts});function generate_random_integer(e,t,n){return e=math$3.ceil(e),t=math$3.floor(t),math$3.floor(n()*(t-e+1))+e}const equals$5=function({expr:e,other:t,randomBindings:n,expr_context:r,other_context:a,relative_tolerance:i=1e-12,absolute_tolerance:o=0,tolerance_for_zero:s=1e-15,allowed_error_in_numbers:l=0,include_error_in_number_exponents:u=!1,allowed_error_is_absolute:c=!1,rng:p}){if(Array.isArray(e.tree)&&Array.isArray(t.tree)){let d=e.tree[0],m=e.tree.slice(1),f=t.tree[0],h=t.tree.slice(1);if("tuple"===d||"vector"===d||"list"===d||"array"===d||"matrix"===d||"interval"===d){if(f!==d)return!1;if(h.length!==m.length)return!1;for(let e=0;e<m.length;e++)if(!equals$5({expr:r.fromAst(m[e]),other:a.fromAst(h[e]),randomBindings:n,expr_context:r,other_context:a,relative_tolerance:i,absolute_tolerance:o,tolerance_for_zero:s,allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c,rng:p}))return!1;return!0}if(2===m.length&&["=",">","<","ge","le"].includes(d)){if(2!==h.length)return!1;if(">"===d?(d="<",m=[m[1],m[0]]):"ge"===d&&(d="le",m=[m[1],m[0]]),">"===f?(f="<",h=[h[1],h[0]]):"ge"===f&&(f="le",h=[h[1],h[0]]),d!==f)return!1;let e=["+",m[0],["-",m[1]]],t=["+",h[0],["-",h[1]]],y="="!==d;return component_equals({expr:r.fromAst(e),other:a.fromAst(t),randomBindings:n,expr_context:r,other_context:a,allow_proportional:!0,require_positive_proportion:y,relative_tolerance:i,absolute_tolerance:o,tolerance_for_zero:s,allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c,rng:p})}}return component_equals({expr:e,other:t,randomBindings:n,expr_context:r,other_context:a,relative_tolerance:i,absolute_tolerance:o,tolerance_for_zero:s,allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c,rng:p})},component_equals=function({expr:e,other:t,randomBindings:n,expr_context:r,other_context:a,allow_proportional:i=!1,require_positive_proportion:o=!1,relative_tolerance:s,absolute_tolerance:l,tolerance_for_zero:u,allowed_error_in_numbers:c,include_error_in_number_exponents:p,allowed_error_is_absolute:d,rng:m}){var f=1e-20*Number.MAX_VALUE;e=e.normalize_function_names(),t=t.normalize_function_names(),e=e.subscripts_to_strings(),t=t.subscripts_to_strings();var h=[e.variables(),t.variables()];h=(h=h.reduce((function(e,t){return e.concat(t)}))).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),math$3.define_pi&&(h=h.filter((function(e){return"pi"!==e}))),math$3.define_i&&(h=h.filter((function(e){return"i"!==e}))),math$3.define_e&&(h=h.filter((function(e){return"e"!==e})));var y=[];for(let e=0;e<h.length;e++)(is_integer_ast(h[e],r.assumptions)||is_integer_ast(h[e],a.assumptions))&&y.push(h[e]);var b=[e.functions(),t.functions()];b=(b=b.reduce((function(e,t){return e.concat(t)}))).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),b=b.filter((function(e){return 1==e.length}));try{var g=e.f(),v=t.f()}catch(n){return e.equalsViaSyntax(t)}let T,C,N;if(c>0){let t=replace_numbers_with_parameters({expr:e,variables:h,include_exponents:p});T=r.fromAst(t.expr_with_params),C=t.parameters;let n=Object.keys(C);if(n.length>0){let t=T.derivative(n[0]);if(d||(t=t.multiply(C[n[0]])),n.length>1)for(let e of n.slice(1)){let n=T.derivative(e);d||(n=n.multiply(C[e])),t=t.add(n)}let r=t.multiply(c);try{N=r.f()}catch(e){}}}var A=[10,1,100,.1,1e3,.01],S=0;let w=0,x=!0,V=0;for(let t=0;t<1e3;t++){try{var E=$(A[S],m)}catch(e){continue}if(!1===E.always_zero&&(x=!1),!E.equal&&!E.out_of_bounds&&!E.always_zero&&!1!==E.sufficient_finite_values&&(V++,V>100))return!1;if(E.equal){if(E.always_zero){if(!x)continue;if(w+=1,w>5&&(S+=1,w=0),S>=A.length)return!0;continue}return!0}}return!1;function $(e,t){var r,a=n(t,h,e);for(let e=0;e<y.length;e++)a[y[e]]=generate_random_integer(-10,10,t);for(let e=0;e<b.length;e++){var c=generate_random_integer(-10,10,t),p=generate_random_integer(-10,10,t),d=generate_random_integer(-10,10,t);a[b[e]]=function(e){return math$3.add(math$3.multiply(math$3.add(math$3.multiply(c,e),p),e),d)}}N&&(r=Object.assign({},a,C));var m=g(a),T=v(a);if("boolean"==typeof m||"boolean"==typeof T)return{out_of_bounds:!0,always_zero:!1};var A=math$3.abs(m),S=math$3.abs(T);if(!(A<f&&S<f))return{out_of_bounds:!0,always_zero:!1};if(!(0===A||A>0)||!(0===S||S>0))return{out_of_bounds:!0,always_zero:!1};var w=Math.min(A,S),x=Math.max(A,S),V=1;let E=0;if(N){try{E=math$3.abs(N(r))}catch(e){return{equal_at_start:!1,always_zero:!1}}if(!Number.isFinite(E))return{equal_at_start:!1,always_zero:!1}}if(E+=w*s,E=Math.min(E,.1*w),E+=0!==E||0!==m&&0!==T?l:u,!(0===x||math$3.abs(math$3.subtract(m,T))<E)){if(!i)return{equal_at_start:!1,always_zero:!1};if(0===A||0===S)return{equal_at_start:!1,always_zero:!1};if(V=math$3.divide(m,T),o&&!(V>0))return{equal_at_start:!1,always_zero:!1}}var $=0===x,_=0;for(let r=0;r<100;r++){var O,I=n(t,h,.01,a);for(let e=0;e<y.length;e++)I[y[e]]=generate_random_integer(-10,10,t);for(let e=0;e<b.length;e++)c=generate_random_integer(-10,10,t),p=generate_random_integer(-10,10,t),d=generate_random_integer(-10,10,t),I[b[e]]=function(e){return math$3.add(math$3.multiply(math$3.add(math$3.multiply(c,e),p),e),d)};N&&(O=Object.assign({},I,C));try{m=g(I),T=math$3.multiply(v(I),V)}catch(e){continue}if(A=math$3.abs(m),S=math$3.abs(T),A<f&&S<f){w=Math.min(A,S),x=Math.max(A,S),_++;let t=0;if(N){try{t=math$3.abs(N(O))}catch(e){continue}if(!Number.isFinite(t))continue}if(t+=w*s,t=Math.min(t,.1*w),t+=0!==t||0!==m&&0!==T?l:u,!(0===x||math$3.abs(math$3.subtract(m,T))<t))return{equality_in_middle:!1,always_zero:!1};if($=$&&0===x,_>=10)return{equal:!0,always_zero:$}}}return{sufficient_finite_values:!1,always_zero:$}}};function replace_numbers_with_parameters({expr:e,variables:t,include_exponents:n=!1}){let r={},a=0;function i(){a++;let e="par"+a;for(;t.includes(e);)a++,e="par"+a;return e}return{expr_with_params:function e(t){if("number"==typeof t){if(0===t)return t;{let e=i();return r[e]=t,e}}if("string"==typeof t){if("pi"===t){if(math$3.define_pi){let e=i();return r[e]=math$3.PI,e}}else if("e"===t&&math$3.define_e){let e=i();return r[e]=math$3.e,e}return t}if(!Array.isArray(t))return t;let a=t[0],o=t.slice(1);return"^"!==a||n?[a,...o.map(e)]:[a,e(o[0]),o[1]]}((e=e.evaluate_numbers({max_digits:1/0})).tree),parameters:r}}var alea=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),xor128=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),xorwow=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),xorshift7=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),xor4096=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,i=-32;i<l;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),tychei=createCommonjsModule((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),require$$2={},seedrandom$2=createCommonjsModule((function(e){!function(t,n,r){var a,i=256,o=r.pow(i,6),s=r.pow(2,52),l=2*s,u=255;function c(e,u,c){var y=[],b=f(m((u=1==u?{entropy:!0}:u||{}).entropy?[e,h(n)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),h(e)}catch(e){var r=t.navigator,o=r&&r.plugins;return[+new Date,t,o,t.screen,h(n)]}}():e,3),y),g=new p(y),v=function(){for(var e=g.g(6),t=o,n=0;e<s;)e=(e+n)*i,t*=i,n=g.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|g.g(4)},v.quick=function(){return g.g(4)/4294967296},v.double=v,f(h(g.S),n),(u.pass||c||function(e,t,n,a){return a&&(a.S&&d(a,g),e.state=function(){return d(g,{})}),n?(r.random=e,t):e})(v,b,"global"in u?u.global:this==r,u.state)}function p(e){var t,n=e.length,r=this,a=0,o=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<i;)s[a]=a++;for(a=0;a<i;a++)s[a]=s[o=u&o+e[a%n]+(t=s[a])],s[o]=t;(r.g=function(e){for(var t,n=0,a=r.i,o=r.j,s=r.S;e--;)t=s[a=u&a+1],n=n*i+s[u&(s[a]=s[o=u&o+t])+(s[o]=t)];return r.i=a,r.j=o,n})(i)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}function f(e,t){for(var n,r=e+"",a=0;a<r.length;)t[u&a]=u&(n^=19*t[u&a])+r.charCodeAt(a++);return h(t)}function h(e){return String.fromCharCode.apply(0,e)}if(f(r.random(),n),e.exports){e.exports=c;try{a=require$$2}catch(e){}}else r.seedrandom=c}("undefined"!=typeof self?self:commonjsGlobal$1,[],Math)}));seedrandom$2.alea=alea,seedrandom$2.xor128=xor128,seedrandom$2.xorwow=xorwow,seedrandom$2.xorshift7=xorshift7,seedrandom$2.xor4096=xor4096,seedrandom$2.tychei=tychei;var seedrandom$1=seedrandom$2;function randomComplexBindings(e,t,n,r){var a={};return void 0===r?t.forEach((function(t){a[t]=math$3.complex(2*e()*n-n,2*e()*n-n)})):t.forEach((function(t){a[t]=math$3.complex(r[t].re+2*e()*n-n,r[t].im+2*e()*n-n)})),a}const equals$4=function(e,t,{relative_tolerance:n=1e-12,absolute_tolerance:r=0,tolerance_for_zero:a=1e-15,allowed_error_in_numbers:i=0,include_error_in_number_exponents:o=!1,allowed_error_is_absolute:s=!1}={}){let l=seedrandom$1("complex_seed");return!(!e.isAnalytic({allow_abs:!0,allow_relation:!0})||!t.isAnalytic({allow_abs:!0,allow_relation:!0}))&&equals$5({expr:e,other:t,randomBindings:randomComplexBindings,expr_context:e.context,other_context:t.context,relative_tolerance:n,absolute_tolerance:r,tolerance_for_zero:a,allowed_error_in_numbers:i,include_error_in_number_exponents:o,allowed_error_is_absolute:s,rng:l})};function randomRealBindings(e,t,n,r){var a={};return void 0===r?t.forEach((function(t){a[t]=2*e()*n-n})):t.forEach((function(t){a[t]=r[t]+2*e()*n-n})),a}const equals$3=function(e,t,{relative_tolerance:n=1e-12,absolute_tolerance:r=0,tolerance_for_zero:a=1e-15,allowed_error_in_numbers:i=0,include_error_in_number_exponents:o=!1,allowed_error_is_absolute:s=!1}={}){if(!e.isAnalytic()||!t.isAnalytic())return!1;let l=seedrandom("real_seed");return equals$5({expr:e,other:t,randomBindings:randomRealBindings,expr_context:e.context,other_content:t.context,relative_tolerance:n,absolute_tolerance:r,tolerance_for_zero:a,allowed_error_in_numbers:i,include_error_in_number_exponents:o,allowed_error_is_absolute:s,rng:l})},equals$2=function(e,t,{allowed_error_in_numbers:n=0,include_error_in_number_exponents:r=!1,allowed_error_is_absolute:a=!1}={}){return equal(e.tree,t.tree,{allowed_error_in_numbers:n,include_error_in_number_exponents:r,allowed_error_is_absolute:a})},equals$1=function(e,t,{min_elements_match:n=3,match_partial:r=!1}={}){if(!is_discrete_infinite_set(e))return!1;if(is_discrete_infinite_set(t)){var a=[];let n=e.context.get_assumptions(e);if(void 0!==n&&a.push(n),n=t.context.get_assumptions(t),void 0!==n&&a.push(n),a=0===a.length?void 0:1===a.length?a[0]:clean_assumptions(["and"].concat(a)),r){let n=contained_in(e.tree,t.tree,a,r);if(!1===n)return 0;let i=contained_in(t.tree,e.tree,a,r);return!1===i?0:!0===n?!0===i?1:i:!0===i?n:Math.min(n,i)}return contained_in(e.tree,t.tree,a,r)&&contained_in(t.tree,e.tree,a,r)}{let r=t.tree;if("list"!==r[0])return!1;let a=r.length-2;if("ldots"!==r[a+1][0])return!1;if(a<n)return!1;let i=r.slice(0,a+1),o=sequence_from_discrete_infinite(e,a);return!!o&&(o=["list"].concat(o),equals(e.context.from(o),t.context.from(i)))}};function is_discrete_infinite_set(e){var t=e.tree;if(!Array.isArray(t))return!1;if("discrete_infinite_set"!==t[0])return!1;var n=t.slice(1);for(var r of n){if(!Array.isArray(r))return!1;if("tuple"!==r[0])return!1;if(5!==r.length)return!1}return!0}function contained_in(e,t,n,r){if("discrete_infinite_set"===e[0]){if(r){let a=0;for(let i of e.slice(1)){let e=contained_in(i,t,n,r);!0===e?a++:!1!==e&&(a+=e)}let i=e.length-1;return a===i||0!==a&&a/i}return e.slice(1).every((e=>contained_in(e,t,n)))}var a=e[1],i=e[2],o=e[3],s=e[4];if(!Array.isArray(o)||"-"!==o[0]||o[1]!==1/0||s!==1/0)return!1;a=simplify(["/",a,i],n,1/0);var l=t.slice(1),u=[];for(let e=0;e<l.length;e++){let t=l[e][3],r=l[e][4];if(!Array.isArray(t)||"-"!==t[0]||t[1]!==1/0||r!==1/0)return!1;let a=simplify(["/",l[e][1],i],n,1/0),o=simplify(["/",l[e][2],i],n,1/0);if("number"!=typeof o)return!1;let s=math$3.fraction(o),c=s.n,p=s.d;u.push([c,p,a,o])}for(u.sort();1===u[0][0];){let e=u[0][2],t=u[0][3],r=simplify(expand(["+",e,["-",a]]),n,1/0);if(Number.isFinite(r)&&Number.isFinite(t)&&(r=math$3.mod(r,t),math$3.min(r,t-r)<1e-10*t))return!0;if(u.splice(0,1),0===u.length)return!1}var c=[...new Set(u.map((e=>e[0])))];let p=0;for(let e of c){let t=u.map((function(t,n){let r=e/t[0];return Number.isInteger(r)?[t[0],r,n]:void 0})).filter((e=>e)),i=[];for(let r of t){let t=r[0],o=r[1],s=r[2],l=u[s][2],c=u[s][3];for(let r=0;r<t;r++){let s=simplify(expand(["+",l,["-",["+",a,r]]]),n,1/0);if(Number.isFinite(s)&&Number.isFinite(c)&&(s=math$3.mod(s,c),math$3.min(s,c-s)<1e-10*c)){for(let e=0;e<o;e++)i[r+e*t]=!0;let n=!0;for(let t=0;t<e;t++)if(!i[t]){n=!1;break}if(n)return!0;break}}}if(r){let t=0;for(let n=0;n<e;n++)i[n]&&t++;t/=e,t>p&&(p=t)}}return!!(r&&p>0)&&p}function sequence_from_discrete_infinite(e,t){var n=e.tree.slice(1);if(n.length>1)return;let r=n[0][1],a=n[0][2],i=evaluate_numbers(n[0][3]),o=n[0][4];if(!Number.isInteger(i)||o!==1/0)return;let s=[];for(let e=0;e<t;e++)s.push(evaluate_numbers(["+",["*",a,i+e],r]));return s}const equals=function(e,t,{relative_tolerance:n=1e-12,absolute_tolerance:r=0,tolerance_for_zero:a=1e-15,allowed_error_in_numbers:i=0,include_error_in_number_exponents:o=!1,allowed_error_is_absolute:s=!1}={}){if(e.variables().includes("")||t.variables().includes(""))return!1;let l=e.evaluate_numbers({max_digits:1/0}).normalize_function_names().normalize_applied_functions().simplify(),u=t.evaluate_numbers({max_digits:1/0}).normalize_function_names().normalize_applied_functions().simplify();return!!l.equalsViaSyntax(u,{allowed_error_in_numbers:i,include_error_in_number_exponents:o,allowed_error_is_absolute:s})||!!e.equalsViaComplex(t,{relative_tolerance:n,absolute_tolerance:r,tolerance_for_zero:a,allowed_error_in_numbers:i,include_error_in_number_exponents:o,allowed_error_is_absolute:s})||!!equals$1(e,t)};var equality=Object.freeze({__proto__:null,equals:equals,equalsViaComplex:equals$4,equalsViaReal:equals$3,equalsViaSyntax:equals$2,equalsDiscreteInfinite:equals$1});const equalWithSignErrors=function(e,t,{equalityFunction:n=equals,max_sign_errors:r=1}={}){if(n(e,t))return{matched:!0,n_sign_errors:0};for(let a=1;a<=r;a++)if(equalSpecifiedSignErrors(e,t,{equalityFunction:n,n_sign_errors:a}))return{matched:!0,n_sign_errors:a};return{matched:!1}},equalSpecifiedSignErrors=function(e,t,{equalityFunction:n=u,n_sign_errors:r=1}={}){if(0===r)return n(e,t);if(!(Number.isInteger(r)&&r>0))throw Error(`Have not implemented equality check with ${r} sign errors.`);if(r>1){let e=n;n=function(t,n){return equalSpecifiedSignErrors(t,n,{equalityFunction:e,n_sign_errors:r-1})}}var a,i,o=e.tree,s=[[o]],l=0;e.tree=["-",o];var u=n(e,t);if(e.tree=o,u)return!0;for(;a=s[l++];)if(a=a[0],Array.isArray(a))for(i=1;i<a.length;i++)if(s.push([a[i]]),a[i]=["-",a[i]],u=n(e,t),a[i]=a[i][1],u)return!0;return!1};var sign_error=Object.freeze({__proto__:null,equalSpecifiedSignErrors:equalSpecifiedSignErrors,equalWithSignErrors:equalWithSignErrors});function add(e,t){return clean(["+",get_tree(e),get_tree(t)])}function subtract(e,t){return clean(["+",get_tree(e),["-",get_tree(t)]])}function multiply(e,t){return clean(["*",get_tree(e),get_tree(t)])}function divide(e,t){return clean(["/",get_tree(e),get_tree(t)])}function pow(e,t){return clean(["^",get_tree(e),get_tree(t)])}function mod(e,t){return clean(["apply","mod",["tuple",get_tree(e),get_tree(t)]])}function copy(e){return get_tree(e)}var arithmetic=Object.freeze({__proto__:null,add:add,subtract:subtract,multiply:multiply,divide:divide,pow:pow,mod:mod,copy:copy}),analytic_operators=["+","-","*","/","^","tuple","vector","list","array","matrix","interval"],analytic_functions=["exp","log","log10","sqrt","factorial","gamma","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec"],relation_operators=["=","le","ge","<",">"];function isAnalytic(e,{allow_abs:t=!1,allow_relation:n=!1}={}){var r=normalize_applied_functions(normalize_function_names(e)),a=operators$3(r=subscripts_to_strings(r));for(let e=0;e<a.length;e++){let t=a[e];if(-1===analytic_operators.indexOf(t)){if(!n)return!1;if(-1===relation_operators.indexOf(t))return!1}}var i=functions$2(r);for(let e=0;e<i.length;e++){let n=i[e];if(-1===analytic_functions.indexOf(n)&&(!t||"abs"!==n))return!1}return!0}var analytic=Object.freeze({__proto__:null,isAnalytic:isAnalytic});function create_discrete_infinite_set({offsets:e,periods:t,min_index:n=["-",1/0],max_index:r=1/0}={}){if(e=get_tree(e),t=get_tree(t),n=get_tree(n),r=get_tree(r),void 0===e||void 0===t)return;let a=[];if("list"===e[0])if("list"===t[0]){if(e.length!==t.length||1===e.length)return;for(let i=1;i<e.length;i++)a.push(["tuple",e[i],t[i],n,r])}else for(let i=1;i<e.length;i++)a.push(["tuple",e[i],t,n,r]);else a.push(["tuple",e,t,n,r]);return["discrete_infinite_set"].concat(a)}var sets=Object.freeze({__proto__:null,create_discrete_infinite_set:create_discrete_infinite_set});function tuple(e){var t=[];t.push("tuple");var n=e.length;for(let r=0;r<n;r++)t.push(e[r]);return t}function matrix(e){var t=[];t.push("matrix");var n=e.length,r=e[0].length;for(let t=1;t<n;t++)if(e[t].length!==r)throw new Error("Matrix dimensions mismatch");t.push(tuple([n,r]));let a=[];for(let t=0;t<n;t++)a.push(tuple(e[t].map((function(e){return e.tree}))));return t.push(tuple(a)),t}function vector_add(e,t){if(e=get_tree(e),t=get_tree(t),e.length!==t.length||"tuple"!==e[0]&&"vector"!==e[0]||"tuple"!==t[0]&&"vector"!==t[0])throw new Error("Can't add. Those aren't vectors, or the dimensions don't match");var n=["vector"],r=e.length;for(let a=1;a<r;a+=1)n.push(["+",e[a],t[a]]);return simplify(n)}function scalar_mul(e,t){if("tuple"!==(t=get_tree(t))[0]&&"vector"!==t[0])throw new Error("Can't scalar multiply. Isn't a vector");var n=["vector"],r=t.length;for(let a=1;a<r;a+=1)n.push(["*",t[a],e]);return simplify(n)}function vector_sub(e,t){return vector_add(e,scalar_mul(-1,t))}function dot_prod(e,t){if(e=get_tree(e),t=get_tree(t),e.length!==t.length||"tuple"!==e[0]&&"vector"!==e[0]||"tuple"!==t[0]&&"vector"!==t[0])throw new Error("Can't take dot product. Those aren't vectors, or the dimensions don't match");var n=0,r=0,a=e.length;for(let i=1;i<a;i+=1)r=["*",e[i],t[i]],n=["+",n,r];return simplify(n)}function cross_prod(e,t){if(e=get_tree(e),t=get_tree(t),"tuple"!==e[0]&&"vector"!==e[0]||"tuple"!==t[0]&&"vector"!==t[0])throw new Error("Can't take cross product. Those aren't vectors");if(3===e.length&&3===t.length)return simplify(["+",["*",e[1],t[2]],["-",["*",e[2],t[1]]]]);if(4===e.length&&4===t.length)return simplify(["vector",["+",["*",e[2],t[3]],["-",["*",e[3],t[2]]]],["+",["*",e[3],t[1]],["-",["*",e[1],t[3]]]],["+",["*",e[1],t[2]],["-",["*",e[2],t[1]]]]]);throw new Error("Can't take cross product. The dimensions aren't both 2 or 3.")}var matrix$1=Object.freeze({__proto__:null,matrix:matrix,vector_add:vector_add,scalar_mul:scalar_mul,vector_sub:vector_sub,dot_prod:dot_prod,cross_prod:cross_prod});class astToGuppy$1{constructor(){this.operators={"+":function(e){return e.join("<e>+</e>")},"-":function(e){return"<e>-"+e.join("-")+"</e>"},"*":function(e){return e.join('<f type="*" group="operations" c="yes"><b p="latex">\\cdot</b><b p="text">*</b></f>')},"/":function(e){return astToGuppy$1.dfrac(e[0],e[1])},"^":function(e){return astToGuppy$1.power(e[0],e[1])},sin:function(e){return astToGuppy$1.trig("sin",e[0])},cos:function(e){return astToGuppy$1.trig("cos",e[0])},tan:function(e){return astToGuppy$1.trig("tan",e[0])},arcsin:function(e){return astToGuppy$1.trig("arcsin",e[0])},arccos:function(e){return astToGuppy$1.trig("arccos",e[0])},arctan:function(e){return astToGuppy$1.trig("arctan",e[0])},arccsc:function(e){return astToGuppy$1.trig("arccsc",e[0])},arcsec:function(e){return astToGuppy$1.trig("arcsec",e[0])},arccot:function(e){return astToGuppy$1.trig("arccot",e[0])},csc:function(e){return astToGuppy$1.trig("csc",e[0])},sec:function(e){return astToGuppy$1.trig("sec",e[0])},cot:function(e){return astToGuppy$1.trig("cot",e[0])},log:function(e){return astToGuppy$1.trig("log",e[0])},exp:function(e){return astToGuppy$1.trig("exp",e[0])},ln:function(e){return astToGuppy$1.trig("ln",e[0])},sqrt:function(e){return astToGuppy$1.sqrt(e[0])},abs:function(e){return astToGuppy$1.abs(e[0])}}}static dfrac(e,t){return'<f type="fraction" group="functions"><b p="latex">\\dfrac{<r ref="1"/>}{<r ref="2"/>}</b><b p="small_latex">\\frac{<r ref="1"/>}{<r ref="2"/>}</b><b p="text">(<r ref="1"/>)/(<r ref="2"/>)</b><c up="1" down="2" name="numerator"><e></e>'+e+'<e></e></c><c up="1" down="2" name="denominator"><e></e>'+t+"<e></e></c></f>"}static trig(e,t){return'<f type="'+e+'" group="functions"><b p="latex">\\'+e+'\\left(<r ref="1"/>\\right)</b><b p="text"> '+e+'(<r ref="1"/>)</b><c delete="1"><e></e>'+t+"<e></e></c></f>"}static sqrt(e){return'<f type="square_root" group="functions"><b p="latex">\\sqrt{<r ref="1"/>}</b><b p="text">sqrt(<r ref="1"/>)</b><c delete="1"><e></e>'+e+"<e></e></c></f>"}static power(e,t){return'<f type="exponential" group="functions"><b p="latex">{<r ref="1"/>}^{<r ref="2"/>}</b><b p="text">(<r ref="1"/>)^(<r ref="2"/>)</b><c up="2" bracket="yes" delete="1" name="base"><e></e>'+e+'<e></e></c><c down="1" delete="1" name="exponent" small="yes"><e></e>'+t+"<e></e></c></f>"}static abs(e){return'<f type="absolute_value" group="functions"><b p="latex">\\left|<r ref="1"/>\\right|</b><b p="text">abs(<r ref="1"/>)</b><c delete="1"><e></e>'+e+"<e></e></c></f>"}static paren(e){return'<f type="bracket" group="functions"><b p="latex">\\left(<r ref="1"/>\\right)</b><b p="text">(<r ref="1"/>)</b><c delete="1" is_bracket="yes"><e></e>'+e+"<e></e></c></f>"}static isFunctionSymbol(e){return-1!==["sin","cos","tan","csc","sec","cot","arcsin","arccos","arctan","arccsc","arcsec","arccot","log","ln","exp","sqrt","abs","this.factorial"].indexOf(e)}static isGreekLetterSymbol(e){return-1!==["pi","theta","theta","Theta","alpha","nu","beta","xi","Xi","gamma","Gamma","delta","Delta","pi","Pi","epsilon","epsilon","rho","rho","zeta","sigma","Sigma","eta","tau","upsilon","Upsilon","iota","phi","phi","Phi","kappa","chi","lambda","Lambda","psi","Psi","omega","Omega"].indexOf(e)}factorWithParenthesesIfNegated(e){var t=this.factor(e);return t.toString().match(/^<e>-/)?astToGuppy$1.paren(t.toString()):t}factor(e){if("string"==typeof e)return astToGuppy$1.isGreekLetterSymbol(e)?'<f type="'+e+'" group="greek" c="yes"><b p="latex">\\'+e+'</b><b p="text"> $'+e+"</b></f>":"<e>"+e+"</e>";if("number"==typeof e)return"<e>"+e+"</e>";var t=e[0],n=e.slice(1);return"apply"===t&&(t=e[1],n=e.slice(2)),"abs"===t?this.operators[t](n.map(function(e,t){return this.expression(e)}.bind(this))):astToGuppy$1.isFunctionSymbol(t)?"this.factorial"!==t||1!==n[0].toString().length&&!n[0].toString().match(/^[0-9]*$/)?this.operators[t](n.map(function(e,t){return this.factor(e)}.bind(this))):this.operators[t](n):"^"===t||"~"===t?this.operators[t](n.map(function(e,t){return this.factor(e)}.bind(this))):astToGuppy$1.paren(this.expression(e))}term(e){if("string"==typeof e||"number"==typeof e)return this.factor(e);var t=e[0],n=e.slice(1);return"*"===t?this.operators[t](n.map(function(e,t){var n=this.factorWithParenthesesIfNegated(e);return n.toString().match(/^[0-9]/)&&t>0?" * "+n:n}.bind(this))):"/"===t?this.operators[t](n.map(function(e,t){return this.factor(e)}.bind(this))):this.factor(e)}expression(e){if("string"==typeof e||"number"==typeof e)return this.term(e);var t=e[0],n=e.slice(1);return"+"===t||"-"===t?this.operators[t](n.map(function(e,t){return this.factorWithParenthesesIfNegated(e)}.bind(this))):this.term(e)}convert(e){return("<m><e></e>"+this.expression(e)+"<e></e></m>").replace(/<\/e><e>/g,"")}}const glslOperators={"+":function(e){var t=e[0];return e.slice(1).forEach((function(e){t=t+"+"+e})),t},"-":function(e){var t="-"+e[0];return e.slice(1).forEach((function(e){t=t+"-"+e})),t},"~":function(e){var t="vec2(0.0,0.0)";return e.forEach((function(e){t=t+"-"+e})),t},"*":function(e){var t=e[0];return e.slice(1).forEach((function(e){t="cmul("+t+","+e+")"})),t},"/":function(e){var t=e[0];return e.slice(1).forEach((function(e){t="cdiv("+t+","+e+")"})),t},sin:function(e){return"csin("+e[0]+")"},cos:function(e){return"ccos("+e[0]+")"},tan:function(e){return"ctan("+e[0]+")"},sinh:function(e){return"csinh("+e[0]+")"},cosh:function(e){return"ccosh("+e[0]+")"},arcsin:function(e){return"carcsin("+e[0]+")"},arccos:function(e){return"carccos("+e[0]+")"},arctan:function(e){return"carctan("+e[0]+")"},arccsc:function(e){return"carcsin(cdiv(vec2(1.0,0),"+e[0]+"))"},arcsec:function(e){return"carccos(cdiv(vec2(1.0,0),"+e[0]+"))"},arccot:function(e){return"carctan(cdiv(vec2(1.0,0),"+e[0]+"))"},csc:function(e){return"ccsc("+e[0]+")"},sec:function(e){return"csec("+e[0]+")"},cot:function(e){return"ccot("+e[0]+")"},exp:function(e){return"cexp("+e[0]+")"},conj:function(e){return"conjugate("+e[0]+")"},sqrt:function(e){return"cpower("+e[0]+",vec2(0.5,0.0))"},log:function(e){return"clog("+e[0]+")"},ln:function(e){return"clog("+e[0]+")"},"^":function(e){return"cpower("+e[0]+","+e[1]+")"},abs:function(e){return"cabs("+e[0]+")"},apply:function(e){return"vec2(NaN,NaN)"}};class astToGLSL$1{constructor(){}convert(e){if("boolean"==typeof e)throw Error("no support for boolean");if("string"==typeof e)return"e"===e?"vec2(2.71828182845905,0.0)":"pi"===e?"vec2(3.14159265358979,0.0)":"i"===e?"vec2(0.0,1.0)":String(e);if("number"==typeof e)return"vec2("+String(e)+",0.0)";if("real"in e&&"imaginary"in e)return e;if(!Array.isArray(e))throw Error("Invalid ast");var t=e[0],n=e.slice(1);if("apply"===t){if("string"!=typeof n[0])throw Error("Non string functions not implemented for conversion to GLSL");return t=n[0],n=n.slice(1),glslOperators[t](n.map(function(e,t){return this.convert(e)}.bind(this)))}if(t in glslOperators)return glslOperators[t](n.map(function(e,t){return this.convert(e)}.bind(this)));throw Error("Operator "+t+" not implemented for conversion to mathjs")}}var astToGuppy=new astToGuppy$1,astToGLSL=new astToGLSL$1;const tex=function(e,t){return new astToLatex$1(t).convert(e.tree)},toLatex=tex,toString=function(e,t){return new astToText$1(t).convert(e.tree)},toGLSL=function(e){return astToGLSL.convert(e.tree)},toXML=function(e){return astToGuppy.convert(e.tree)};var printing=Object.freeze({__proto__:null,tex:tex,toLatex:toLatex,toString:toString,toXML:toXML,toGLSL:toGLSL});const integrateNumerically=function(e,t,n,r){for(var a=0,i={},o=0;o<100;o++){var s=n+(r-n)*(o+.5)/100;i[t]=s,a+=e.evaluate(i)}return a*(r-n)/100};var integration=Object.freeze({__proto__:null,integrateNumerically:integrateNumerically});function expression_to_polynomial(e){var t=get_tree(e);if("string"==typeof t)return"pi"===t&&math$3.define_pi||"i"===t&&math$3.define_i||"e"===t&&math$3.define_e?t:["polynomial",t,[[1,1]]];if("number"==typeof t)return t;let n=evaluate_to_constant(t);if(null!==n&&Number.isFinite(n))return simplify(t);if(!Array.isArray(t))return!1;if(!operators$3(t).every((e=>["+","-","*","^","/","_","prime"].includes(e))))return!1;var r=t[0],a=t.slice(1);if("+"===r){let e=a.map(expression_to_polynomial);return!!e.every((e=>!1!==e))&&e.reduce(((e,t)=>polynomial_add(e,t)))}if("-"===r){let e=expression_to_polynomial(a[0]);return!!e&&polynomial_neg(e)}if("*"===r){let e=a.map(expression_to_polynomial);return!!e.every((e=>!1!==e))&&e.reduce(((e,t)=>polynomial_mul(e,t)))}if("^"===r){let e=a[0],n=expression_to_polynomial(e);if(!1===n)return!1;let r=simplify(a[1]);if("number"!=typeof r||r<0||!Number.isInteger(r)){let n=evaluate_to_constant(r);if(null!==n||Number.isFinite(n)){let t=math$3.fraction(n);if(t.d<=100){e=t.s<0?["^",e,["/",-1,t.d]]:["^",e,["/",1,t.d]];var i=["polynomial",simplify(e),[]];return i[2].push([t.n,1]),i}}return["polynomial",t,[[1,1]]]}return 0===r?1:1===r?n:polynomial_pow(n,r)}if("/"===r){var o=a[1],s=evaluate_to_constant(o);return null!==s&&Number.isFinite(s)?polynomial_mul(expression_to_polynomial(a[0]),["/",1,s]):["polynomial",t,[[1,1]]]}return["polynomial",t,[[1,1]]]}function polynomials_in_same_leading_variable(e,t){return e[1]!==t[1]&&(compare_function(e[1],t[1])<0?t=["polynomial",e[1],[[0,t]]]:e=["polynomial",t[1],[[0,e]]]),[e,t]}function polynomial_add(e,t){if("polynomial"!==e[0]){if("polynomial"!==t[0])return simplify(["+",e,t]);e=["polynomial",t[1],[[0,e]]]}else if("polynomial"!==t[0])t=["polynomial",e[1],[[0,t]]];else{let n=polynomials_in_same_leading_variable(e,t);e=n[0],t=n[1]}let n=["polynomial",e[1],[]],r=e[2],a=t[2],i=n[2],o=r.length,s=a.length,l=0,u=0;for(;l<o||u<s;)if(l===o)a[u][1]&&i.push(a[u]),u+=1;else if(u===s)r[l][1]&&i.push(r[l]),l+=1;else if(r[l][0]===a[u][0]){let e=polynomial_add(r[l][1],a[u][1]);e&&i.push([r[l][0],e]),l+=1,u+=1}else r[l][0]<a[u][0]?(r[l][1]&&i.push(r[l]),l+=1):(a[u][1]&&i.push(a[u]),u+=1);return 0===i.length?0:1===i.length&&0===i[0][0]?i[0][1]:n}function polynomial_neg(e){if("polynomial"!==e[0])return simplify(["-",e]);let t=["polynomial",e[1],[]],n=e[2],r=t[2],a=n.length;for(var i=0;i<a;i+=1)r.push([n[i][0],polynomial_neg(n[i][1])]);return t}function polynomial_sub(e,t){return polynomial_add(e,polynomial_neg(t))}function polynomial_mul(e,t){if("polynomial"!==e[0]){if("polynomial"!==t[0])return simplify(["*",e,t]);if(e){let n=["polynomial",t[1],[]],r=t[2],a=n[2];for(let t of r)t[1]&&a.push([t[0],polynomial_mul(e,t[1])]);return n}}else if(t&&"polynomial"!==t[0]){let n=["polynomial",e[1],[]],r=e[2],a=n[2];for(let e of r)e[1]&&a.push([e[0],polynomial_mul(e[1],t)]);return n}let n=polynomials_in_same_leading_variable(e,t);e=n[0],t=n[1];let r=e[2],a=t[2],i=["polynomial",e[1],[]],o=i[2],s=r.length,l=a.length,u=[];for(let e of r)for(let t of a){let n=!1,r=e[0]+t[0];for(let e of u)if(r===e){n=!0;break}n||u.push(r)}u.sort((function(e,t){return e-t}));for(let e of u){let t=0,n=0;for(;n<s&&r[n][0]<=e;){let i=0;for(;i<l&&a[i][0]<=e;){if(r[n][0]+a[i][0]===e){t=polynomial_add(t,polynomial_mul(r[n][1],a[i][1]));break}i+=1}n+=1}t&&o.push([e,t])}return i}function polynomial_pow(e,t){if(isNaN(t)||t<0||!Number.isInteger(t))return;let n=1;for(;t>0;)1&t&&(n=polynomial_mul(n,e)),e=polynomial_mul(e,e),t>>=1;return n}function polynomial_to_expression(e){if(!Array.isArray(e)||"polynomial"!==e[0])return e;let t=e[1],n=e[2],r=[],a=n.length;for(var i=0;i<a;i+=1)n[i][1]&&(0===n[i][0]?r.push(polynomial_to_expression(n[i][1])):1===n[i][0]?r.push(["*",polynomial_to_expression(n[i][1]),t]):r.push(["*",polynomial_to_expression(n[i][1]),["^",t,n[i][0]]]));return 0===r.length?0:(1===r.length?r=r[0]:r.unshift("+"),simplify(r))}function initial_term(e){if(!Array.isArray(e)||"polynomial"!==e[0])return e;let t=[];for(;Array.isArray(e)&&"polynomial"===e[0];){let n=e[1],r=e[2],a=r[r.length-1][0];e=r[r.length-1][1],t.push([n,a])}return["monomial",e,t]}function mono_less_than(e,t){if(!Array.isArray(t)||"monomial"!==t[0])return!1;if(!Array.isArray(e)||"monomial"!==e[0])return!0;let n=e[2],r=t[2],a=n.length,i=r.length;var o;o=a<i?a:i;for(var s=0;s<o;s++){if(n[s][0]!==r[s][0])return!(compare_function(n[s][0],r[s][0])<0);if(n[s][1]<r[s][1])return!0;if(n[s][1]>r[s][1])return!1}return a!==i&&o!==i}function mono_gcd(e,t){if(!Array.isArray(e)||!Array.isArray(t)||"monomial"!==e[0]||"monomial"!==t[0])return 1;let n=e[2],r=t[2],a=[],i=n.length,o=r.length,s=0,l=0;for(;s<i&&l<o;)n[s][0]===r[l][0]?(n[s][1]<r[l][1]?a.push(n[s]):a.push(r[l]),s+=1,l+=1):compare_function(n[s][0],r[l][0])<0?s+=1:compare_function(r[l][0],n[s][0])<0&&(l+=1);return 0===a.length?1:["monomial",1,a]}function mono_div(e,t){
//!!This function should only be called if bottom has coefficient 1 and divides the top (e.g., bottom was computed using mono_gcd)!!
if(!Array.isArray(t)||"monomial"!==t[0])return 1===t?e:Array.isArray(e)&&"monomial"===e[0]?[e[0],evaluate_numbers(["/",e[1],t]),e[2]]:evaluate_numbers(["/",e,t]);if(!Array.isArray(e)||"monomial"!==e[0])return;let n=e[2],r=t[2],a=[],i=n.length,o=r.length,s=0,l=0;for(;s<i&&l<o;)if(n[s][0]===r[l][0]){if(n[s][1]<r[l][1])return;{let e=n[s][1]-r[l][1];0!==e&&a.push([n[s][0],e])}s+=1,l+=1}else if(compare_function(n[s][0],r[l][0])<0)a.push(n[s]),s+=1;else if(compare_function(r[l][0],n[s][0])<0)return;if(!(l<o)){for(;s<i;)a.push(n[s]),s+=1;return 0===a.length?1===t[1]?e[1]:evaluate_numbers(["/",e[1],t[1]]):1===t[1]?["monomial",e[1],a]:["monomial",evaluate_numbers(["/",e[1],t[1]]),a]}}function mono_is_div(e,t){if(0===t)return!1;if(!Array.isArray(t)||"monomial"!==t[0])return!0;if(!Array.isArray(e)||"monomial"!==e[0])return!1;let n=e[2],r=t[2],a=[],i=n.length,o=r.length,s=0,l=0;for(;s<i&&l<o;)if(n[s][0]===r[l][0]){if(n[s][1]<r[l][1])return!1;{let e=n[s][1]-r[l][1];0!==e&&a.push([n[s][0],e])}s+=1,l+=1}else if(compare_function(n[s][0],r[l][0])<0)a.push(n[s]),s+=1;else if(compare_function(r[l][0],n[s][0])<0)return!1;return!(l<o)}function mono_to_poly(e){if(!Array.isArray(e)||"monomial"!==e[0])return e;let t=e[2].length-1,n=e[1];for(;t>=0;){var r=[];r.push([e[2][t][1],n]),n=["polynomial",e[2][t][0],r],t-=1}return n}function max_div_init(e,t){if(0===e)return 0;let n=e,r=[];for(;Array.isArray(n)&&"polynomial"===n[0];){let e=n[1],t=n[2],a=t[t.length-1][0];n=t[t.length-1][1],r.push([e,a])}let a=["monomial",n,r],i=t.length;for(var o=0;o<i;o+=1)if(mono_is_div(a,t[o]))return[a,o];return max_div_init(polynomial_sub(e,mono_to_poly(a)),t)}function poly_div(e,t){let n=[],r=[],a=[],i=[],o=e;for(var s of t)n.push(initial_term(s));let l=max_div_init(o,n);for(;0!==l;)a=l[1],i=mono_div(l[0],n[a]),r.push([a,i]),o=polynomial_sub(o,polynomial_mul(mono_to_poly(i),t[a])),l=max_div_init(o,n);return[r,o]}function prereduce(e){let t=e.length,n=[];for(var r=0;r<t;r++){if(0!==e[r]&&(!Array.isArray(e[r])||"polynomial"!==e[r][0]))return[1];0!==e[r]&&n.push(e[r])}return 0===n.length?[0]:n}function reduce_ith(e,t){let n=[],r=[],a=[],i=t[e],o=t.length;for(var s=0;s<o;s+=1)s===e?n.push(0):n.push(initial_term(t[s]));let l=max_div_init(i,n);for(;0!==l;)r=l[1],a=mono_div(l[0],n[r]),i=polynomial_sub(i,polynomial_mul(mono_to_poly(a),t[r])),l=max_div_init(i,n);return i}function reduce(e){let t=0,n=[],r=prereduce(e),a=r.length;if(1===a)return r;let i=!0;for(;i;)for(i=!1,r=prereduce(r),a=r.length,t=0;t<a;)n=reduce_ith(t,r),_.isEqual(n,r[t])||(r[t]=n,i=!0),t+=1;t=0;let o=[],s=0;for(;t<a;)o=initial_term(r[t]),Array.isArray(o)&&"monomial"===o[0]?(s=o[1],1!==s&&(r[t]=polynomial_mul(r[t],["/",1,s]))):r[t]=1,t+=1;return r}function hij(e,t,n){let r=initial_term(n[e]),a=initial_term(n[t]),i=mono_gcd(r,a),o=mono_to_poly(mono_div(r,i));return poly_div(polynomial_sub(polynomial_mul(mono_to_poly(mono_div(a,i)),n[e]),polynomial_mul(o,n[t])),n)[1]}function build_hij_table(e,t){let n=t.length,r=0,a=1,i=[];for(;a<n;){for(;r<a;)e[[r,a]]=hij(r,a,t),0!==e[[r,a]]&&i.push(e[[r,a]]),r+=1;r=0,a+=1}return i.length>0?choice_lowest_degree(i):0}function update_hij_table(e,t,n){let r=t.length;t.push(n);let a=0,i=1,o=[];for(;i<r;){for(;a<i;)0!==e[[a,i]]&&(e[[a,i]]=hij(a,i,t),0!==e[[a,i]]&&o.push(e[[a,i]])),a+=1;a=0,i+=1}for(;a<r;)e[[a,r]]=hij(a,r,t),0!==e[[a,r]]&&o.push(e[[a,r]]),a+=1;return o.length>0?choice_lowest_degree(o):0}function choice_lowest_degree(e){let t=[],n=e.length;for(a=0;a<n;a+=1)t.push(initial_term(e[a]));let r=0;for(var a=1;a<n;a+=1){if(1===t[a])return 1;mono_less_than(t[a],t[r])&&(r=a)}return e[r]}function reduced_grobner(e){let t=reduce(e),n={},r=build_hij_table(n,t);for(;0!==r;)r=update_hij_table(n,t,r);return t=reduce(t),t}function poly_lcm(e,t){let n=reduced_grobner([polynomial_mul(["polynomial","_t",[[1,1]]],e),polynomial_mul(["polynomial","_t",[[0,1],[1,-1]]],t)]),r=n.length;for(var a=0;a<r;a+=1){if(!Array.isArray(n[a])||"polynomial"!==n[a][0])return 1;if("_t"!==n[a][1])return n[a]}}function poly_gcd(e,t){let n=poly_lcm(e,t),r=poly_div(polynomial_mul(e,t),[n]),a=0,i=r[0].length;for(var o=0;o<i;o+=1)a=polynomial_add(a,mono_to_poly(r[0][o][1]));let s=initial_term(a);if(Array.isArray(s)&&"monomial"===s[0]){let e=s[1];1!==e&&(a=polynomial_mul(a,["/",1,e]))}else a=1;return a}function poly_by_divisor(e,t){
//!!Only call if d evenly divides f!!
let n=poly_div(e,[t]),r=0,a=n[0].length;for(var i=0;i<a;i+=1)r=polynomial_add(r,mono_to_poly(n[0][i][1]));return r}function reduce_rational_expression(e,t){let n=stringify_vars(e),r=stringify_vars(t),a=polynomial_mul(poly_gcd(e=n[0],t=r[0]),initial_term(t)[1]),i=poly_by_divisor(e,a),o=poly_by_divisor(t,a);return[destringify_vars(destringify_vars(i,n[1]),r[1]),destringify_vars(destringify_vars(o,n[1]),r[1])]}function stringify_vars(e){if(!Array.isArray(e)||"polynomial"!==e[0])return[e,{}];let t={},n="z"+JSON.stringify(e[1]);t[n]=e[1],e[1]=n;let r=e[2],a=[];for(let e of r){a=stringify_vars(e[1]),e[1]=a[0];for(let e in a[1])t[e]=a[1][e]}return[e,t]}function destringify_vars(e,t){if(!Array.isArray(e)||"polynomial"!==e[0])return e;t[e[1]]&&(e[1]=t[e[1]]);let n=e[2];for(let e of n)e[1]=destringify_vars(e[1],t);return e}var textToAst$1=new textToAst$4;function common_denominator(e,t){e=simplify(e,t);var n=[];return n.push([textToAst$1.convert("a/c+b/c"),textToAst$1.convert("(a+b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("a/c-b/c"),textToAst$1.convert("(a-b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("a+b/c"),textToAst$1.convert("(ac+b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("a-b/c"),textToAst$1.convert("(ac-b)/c"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("a/d+b/c"),textToAst$1.convert("(ac+bd)/(cd)"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("a/d-b/c"),textToAst$1.convert("(ac-bd)/(cd)"),{evaluate_numbers:!0,allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("x*(y/z)"),textToAst$1.convert("(x*y)/z"),{allow_extended_match:!0,allow_permutations:!0,max_group:1}]),n.push([textToAst$1.convert("(x/y)/z"),textToAst$1.convert("x/(y*z)"),{allow_extended_match:!0,allow_permutations:!0}]),n.push([textToAst$1.convert("x/(y/z)"),textToAst$1.convert("xz/y"),{allow_extended_match:!0,allow_permutations:!0}]),expand(e=applyAllTransformations(e,n,40),!0)}function as_num_denom(e){var t=get_tree(e);return"/"===(t=common_denominator(t))[0]?[t[1],t[2]]:[t,1]}function reduce_rational(e){var t=get_tree(e),n=as_num_denom(t);if(1===n[1])return t;var r=reduce_rational_expression(expression_to_polynomial(n[0]),expression_to_polynomial(n[1])),a=polynomial_to_expression(r[0]),i=polynomial_to_expression(r[1]);return 1===i?a:["/",a,i]}const common_demoninator=common_denominator;var rational=Object.freeze({__proto__:null,reduce_rational:reduce_rational,common_demoninator:common_demoninator});function round_numbers_to_precision(e,t=14){var n=get_tree(e);if(t<1)throw Error("For round_numbers_to_precision, digits must be positive");if(!Number.isFinite(t))throw Error("For round_numbers_to_precision, digits must be a number");return t>15?n:(t=Math.round(t),round_numbers_to_precision_sub(n,t))}const round_numbers_to_precision_sub=function(e,t=14){if("number"==typeof e&&Number.isFinite(e)&&0!==e){const n=math$3.floor(math$3.log10(math$3.abs(e))),r=t-n-1;return r<0?parseFloat(number_7(e,r)+"0".repeat(math$3.abs(r))):parseFloat(number_7(e,r))}return Array.isArray(e)?[e[0],...e.slice(1).map((e=>round_numbers_to_precision_sub(e,t)))]:e};function round_numbers_to_decimals(e,t=14){var n=get_tree(e);if(!Number.isFinite(t))throw Error("For round_numbers_to_decimals, ndecimals must be a number");return t=Math.round(t),t=Math.max(-330,Math.min(330,t)),round_numbers_to_decimals_sub(n,t)}const round_numbers_to_decimals_sub=function(e,t=0){return"number"==typeof e?t<0?parseFloat(number_7(e,t)+"0".repeat(math$3.abs(t))):parseFloat(number_7(e,t)):Array.isArray(e)?[e[0],...e.slice(1).map((e=>round_numbers_to_decimals_sub(e,t)))]:e};var round=Object.freeze({__proto__:null,round_numbers_to_precision:round_numbers_to_precision,round_numbers_to_decimals:round_numbers_to_decimals});const expression_to_tree$1=[simplify$1,differentiation,normalization,arithmetic,transformation,solve,sets,matrix$1,rational,round],expression_to_other=[variables$1,printing,equality,integration,evaluation,analytic,sign_error];function abs(e){return["apply","abs",get_tree(e)]}function exp(e){return["apply","exp",get_tree(e)]}function log$1(e){return["apply","log",get_tree(e)]}function log10(e){return["apply","log10",get_tree(e)]}function sign(e){return["apply","sign",get_tree(e)]}function sqrt(e){return["apply","sqrt",get_tree(e)]}function conj(e){return["apply","conj",get_tree(e)]}function im(e){return["apply","im",get_tree(e)]}function re(e){return["apply","re",get_tree(e)]}function factorial(e){return["apply","factorial",get_tree(e)]}function gamma(e){return["apply","gamma",get_tree(e)]}function erf(e){return["apply","erf",get_tree(e)]}function acos(e){return["apply","acos",get_tree(e)]}function acosh(e){return["apply","acosh",get_tree(e)]}function acot(e){return["apply","acot",get_tree(e)]}function acoth(e){return["apply","acoth",get_tree(e)]}function acsc(e){return["apply","acsc",get_tree(e)]}function acsch(e){return["apply","acsch",get_tree(e)]}function asec(e){return["apply","asec",get_tree(e)]}function asech(e){return["apply","asech",get_tree(e)]}function asin(e){return["apply","asin",get_tree(e)]}function asinh(e){return["apply","asinh",get_tree(e)]}function atan(e){return["apply","atan",get_tree(e)]}function atanh(e){return["apply","atanh",get_tree(e)]}function cos(e){return["apply","cos",get_tree(e)]}function cosh(e){return["apply","cosh",get_tree(e)]}function cot(e){return["apply","cot",get_tree(e)]}function coth(e){return["apply","coth",get_tree(e)]}function csc(e){return["apply","csc",get_tree(e)]}function csch(e){return["apply","csch",get_tree(e)]}function sec(e){return["apply","sec",get_tree(e)]}function sech(e){return["apply","sech",get_tree(e)]}function sin(e){return["apply","sin",get_tree(e)]}function sinh(e){return["apply","sinh",get_tree(e)]}function tan(e){return["apply","tan",get_tree(e)]}function tanh(e){return["apply","tanh",get_tree(e)]}function atan2(e,t){return["apply","atan2",["tuple",get_tree(e),get_tree(t)]]}var standard=Object.freeze({__proto__:null,abs:abs,exp:exp,log:log$1,log10:log10,sign:sign,sqrt:sqrt,conj:conj,im:im,re:re,factorial:factorial,gamma:gamma,erf:erf,acos:acos,acosh:acosh,acot:acot,acoth:acoth,acsc:acsc,acsch:acsch,asec:asec,asech:asech,asin:asin,asinh:asinh,atan:atan,atanh:atanh,cos:cos,cosh:cosh,cot:cot,coth:coth,csc:csc,csch:csch,sec:sec,sech:sech,sin:sin,sinh:sinh,tan:tan,tanh:tanh,atan2:atan2});const expression_to_tree=[standard],whitespace_rule="\\s|\\\\,|\\\\!|\\\\ |\\\\>|\\\\;|\\\\:|\\\\quad\\b|\\\\qquad\\b",sci_notat_exp_regex="(E[+\\-]?[0-9]+\\s*($|(?=\\,|&|\\||\\\\\\||\\)|\\}|\\\\}|\\]|\\\\\\\\|\\\\end)))?",latex_rules=[["[0-9]+(\\.[0-9]*)?"+sci_notat_exp_regex,"NUMBER"],["\\.[0-9]+"+sci_notat_exp_regex,"NUMBER"],["\\*","*"],["\\/","/"],["-","-"],["\\+","+"],["\\^","^"],["\\(","("],["\\\\left\\s*\\(","("],["\\\\bigl\\s*\\(","("],["\\\\Bigl\\s*\\(","("],["\\\\biggl\\s*\\(","("],["\\\\Biggl\\s*\\(","("],["\\)",")"],["\\\\right\\s*\\)",")"],["\\\\bigr\\s*\\)",")"],["\\\\Bigr\\s*\\)",")"],["\\\\biggr\\s*\\)",")"],["\\\\Biggr\\s*\\)",")"],["\\[","["],["\\\\left\\s*\\[","["],["\\\\bigl\\s*\\[","["],["\\\\Bigl\\s*\\[","["],["\\\\biggl\\s*\\[","["],["\\\\Biggl\\s*\\[","["],["\\]","]"],["\\\\right\\s*\\]","]"],["\\\\bigr\\s*\\]","]"],["\\\\Bigr\\s*\\]","]"],["\\\\biggr\\s*\\]","]"],["\\\\Biggr\\s*\\]","]"],["\\|","|"],["\\\\left\\s*\\|","|L"],["\\\\bigl\\s*\\|","|L"],["\\\\Bigl\\s*\\|","|L"],["\\\\biggl\\s*\\|","|L"],["\\\\Biggl\\s*\\|","|L"],["\\\\right\\s*\\|","|"],["\\\\bigr\\s*\\|","|"],["\\\\Bigr\\s*\\|","|"],["\\\\biggr\\s*\\|","|"],["\\\\Biggr\\s*\\|","|"],["\\\\big\\s*\\|","|"],["\\\\Big\\s*\\|","|"],["\\\\bigg\\s*\\|","|"],["\\\\Bigg\\s*\\|","|"],["{","{"],["}","}"],["\\\\{","LBRACE"],["\\\\left\\s*\\\\{","LBRACE"],["\\\\bigl\\s*\\\\{","LBRACE"],["\\\\Bigl\\s*\\\\{","LBRACE"],["\\\\biggl\\s*\\\\{","LBRACE"],["\\\\Biggl\\s*\\\\{","LBRACE"],["\\\\}","RBRACE"],["\\\\right\\s*\\\\}","RBRACE"],["\\\\bigr\\s*\\\\}","RBRACE"],["\\\\Bigr\\s*\\\\}","RBRACE"],["\\\\biggr\\s*\\\\}","RBRACE"],["\\\\Biggr\\s*\\\\}","RBRACE"],["\\\\cdot(?![a-zA-Z])","*"],["\\\\div(?![a-zA-Z])","/"],["\\\\times(?![a-zA-Z])","*"],["\\\\frac(?![a-zA-Z])","FRAC"],[",",","],[":",":"],["\\\\mid","MID"],["\\\\vartheta(?![a-zA-Z])","LATEXCOMMAND","\\theta"],["\\\\varepsilon(?![a-zA-Z])","LATEXCOMMAND","\\epsilon"],["\\\\varrho(?![a-zA-Z])","LATEXCOMMAND","\\rho"],["\\\\varphi(?![a-zA-Z])","LATEXCOMMAND","\\phi"],["\\\\infty(?![a-zA-Z])","INFINITY"],["\\\\asin(?![a-zA-Z])","LATEXCOMMAND","\\arcsin"],["\\\\acos(?![a-zA-Z])","LATEXCOMMAND","\\arccos"],["\\\\atan(?![a-zA-Z])","LATEXCOMMAND","\\arctan"],["\\\\sqrt(?![a-zA-Z])","SQRT"],["\\\\land(?![a-zA-Z])","AND"],["\\\\wedge(?![a-zA-Z])","AND"],["\\\\lor(?![a-zA-Z])","OR"],["\\\\vee(?![a-zA-Z])","OR"],["\\\\lnot(?![a-zA-Z])","NOT"],["=","="],["\\\\neq(?![a-zA-Z])","NE"],["\\\\ne(?![a-zA-Z])","NE"],["\\\\not\\s*=","NE"],["\\\\leq(?![a-zA-Z])","LE"],["\\\\le(?![a-zA-Z])","LE"],["\\\\geq(?![a-zA-Z])","GE"],["\\\\ge(?![a-zA-Z])","GE"],["<","<"],["\\\\lt(?![a-zA-Z])","<"],[">",">"],["\\\\gt(?![a-zA-Z])",">"],["\\\\in(?![a-zA-Z])","IN"],["\\\\notin(?![a-zA-Z])","NOTIN"],["\\\\not\\s*\\\\in(?![a-zA-Z])","NOTIN"],["\\\\ni(?![a-zA-Z])","NI"],["\\\\not\\s*\\\\ni(?![a-zA-Z])","NOTNI"],["\\\\subset(?![a-zA-Z])","SUBSET"],["\\\\not\\s*\\\\subset(?![a-zA-Z])","NOTSUBSET"],["\\\\supset(?![a-zA-Z])","SUPERSET"],["\\\\not\\s*\\\\supset(?![a-zA-Z])","NOTSUPERSET"],["\\\\cup(?![a-zA-Z])","UNION"],["\\\\cap(?![a-zA-Z])","INTERSECT"],["!","!"],["'","'"],["_","_"],["&","&"],["\\\\ldots","LDOTS"],["\\\\\\\\","LINEBREAK"],["\\\\begin\\s*{\\s*[a-zA-Z0-9]+\\s*}","BEGINENVIRONMENT"],["\\\\end\\s*{\\s*[a-zA-Z0-9]+\\s*}","ENDENVIRONMENT"],["\\\\var\\s*{\\s*[a-zA-Z0-9]+\\s*}","VARMULTICHAR"],["\\\\[a-zA-Z]+(?![a-zA-Z])","LATEXCOMMAND"],["[a-zA-Z]","VAR"]],allowSimplifiedFunctionApplicationDefault=!0,allowedLatexSymbolsDefault=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial"],appliedFunctionSymbolsDefault=["abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg"],functionSymbolsDefault=["f","g"],parseLeibnizNotationDefault=!0;class latexToAst$1{constructor({allowSimplifiedFunctionApplication:e=allowSimplifiedFunctionApplicationDefault,allowedLatexSymbols:t=allowedLatexSymbolsDefault,appliedFunctionSymbols:n=appliedFunctionSymbolsDefault,functionSymbols:r=functionSymbolsDefault,parseLeibnizNotation:a=parseLeibnizNotationDefault}={}){this.allowSimplifiedFunctionApplication=e,this.allowedLatexSymbols=t,this.appliedFunctionSymbols=n,this.functionSymbols=r,this.parseLeibnizNotation=a,this.lexer=new lexer(latex_rules,whitespace_rule)}advance(e){if(this.token=this.lexer.advance(e),"INVALID"===this.token.token_type)throw new ParseError("Invalid symbol '"+this.token.original_text+"'",this.lexer.location)}return_state(){return{lexer_state:this.lexer.return_state(),token:Object.assign({},this.token)}}set_state(e){this.lexer.set_state(e.lexer_state),this.token=Object.assign({},e.token)}convert(e){this.lexer.set_input(e),this.advance();var t=this.statement_list();if("EOF"!==this.token.token_type)throw new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return flatten(t)}statement_list(){for(var e=[this.statement()];","===this.token.token_type;)this.advance(),e.push(this.statement());return e.length>1?["list"].concat(e):e[0]}statement({inside_absolute_value:e=0}={}){if("LDOTS"===this.token.token_type)return this.advance(),["ldots"];var t;try{t=this.return_state();let n=this.statement_a({inside_absolute_value:e});if(":"!==this.token.token_type&&"MID"!==this.token.token_type)return n;let r=":"===this.token.token_type?":":"|";return this.advance(),[r,n,this.statement_a()]}catch(e){try{this.set_state(t);let n=this.statement_a({parse_absolute_value:!1});if("|"!==this.token.token_type[0])throw e;return this.advance(),["|",n,this.statement_a({parse_absolute_value:!1})]}catch(t){throw e}}}statement_a({inside_absolute_value:e=0,parse_absolute_value:t=!0}={}){for(var n=this.statement_b({inside_absolute_value:e,parse_absolute_value:t});"OR"===this.token.token_type;){let r=this.token.token_type.toLowerCase();this.advance(),n=[r,n,this.statement_b({inside_absolute_value:e,parse_absolute_value:t})]}return n}statement_b(e){for(var t=this.relation(e);"AND"===this.token.token_type;){let n=this.token.token_type.toLowerCase();this.advance(),t=[n,t,this.relation(e)]}return t}relation(e){if("NOT"===this.token.token_type||"!"===this.token.token_type)return this.advance(),["not",this.relation(e)];for(var t=this.expression(e);"="===this.token.token_type||"NE"===this.token.token_type||"<"===this.token.token_type||">"===this.token.token_type||"LE"===this.token.token_type||"GE"===this.token.token_type||"IN"===this.token.token_type||"NOTIN"===this.token.token_type||"NI"===this.token.token_type||"NOTNI"===this.token.token_type||"SUBSET"===this.token.token_type||"NOTSUBSET"===this.token.token_type||"SUPERSET"===this.token.token_type||"NOTSUPERSET"===this.token.token_type;){let n=this.token.token_type.toLowerCase(),r=0;"<"===this.token.token_type||"LE"===this.token.token_type?r=-1:">"!==this.token.token_type&&"GE"!==this.token.token_type||(r=1),this.advance();let a=this.expression(e);if(-1===r)if("<"===this.token.token_type||"LE"===this.token.token_type){let r=["tuple"];"<"===n?r.push(!0):r.push(!1);let i=["tuple",t,a];for(;"<"===this.token.token_type||"LE"===this.token.token_type;)"<"===this.token.token_type?r.push(!0):r.push(!1),this.advance(),i.push(this.expression(e));t=["lts",i,r]}else t=[n,t,a];else if(1===r)if(">"===this.token.token_type||"GE"===this.token.token_type){let r=["tuple"];">"===n?r.push(!0):r.push(!1);let i=["tuple",t,a];for(;">"===this.token.token_type||"GE"===this.token.token_type;)">"===this.token.token_type?r.push(!0):r.push(!1),this.advance(),i.push(this.expression(e));t=["gts",i,r]}else t=[n,t,a];else if("="===n)for(t=["=",t,a];"="===this.token.token_type;)this.advance(),t.push(this.expression(e));else t=[n,t,a]}return t}expression(e){"+"===this.token.token_type&&this.advance();let t=!1;"-"===this.token.token_type&&(t=!0,this.advance());var n=this.term(e);for(t&&(n=n>0?-n:["-",n]);"+"===this.token.token_type||"-"===this.token.token_type||"UNION"===this.token.token_type||"INTERSECT"===this.token.token_type;){let t=this.token.token_type.toLowerCase(),r=!1;"-"===this.token.token_type?(t="+",r=!0,this.advance()):(this.advance(),"+"===t&&"-"===this.token.token_type&&(r=!0,this.advance()));let a=this.term(e);r&&(a=a>0?-a:["-",a]),n=[t,n,a]}return n}term(e){var t=this.factor(e),n=!1;do{if(n=!1,"*"===this.token.token_type)this.advance(),t=["*",t,this.factor(e)],n=!0;else if("/"===this.token.token_type)this.advance(),t=["/",t,this.factor(e)],n=!0;else{let r=Object.assign({},e);r.allow_absolute_value_closing=!0;let a=this.nonMinusFactor(r);!1!==a&&(t=["*",t,a],n=!0)}}while(n);return t}factor(e){if("-"===this.token.token_type){this.advance();let t=this.factor(e);return t>0?-t:["-",t]}var t=this.nonMinusFactor(e);if(!1===t)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return t}nonMinusFactor(e){var t=this.baseFactor(e);if("!"===this.token.token_type||"'"===this.token.token_type){if(!1===t)throw new ParseError("Invalid location of "+this.token.token_type,this.lexer.location);for(;"!"===this.token.token_type||"'"===this.token.token_type;)t="!"===this.token.token_type?["apply","factorial",t]:["prime",t],this.advance()}if("^"===this.token.token_type){if(!1===t)throw new ParseError("Invalid location of ^",this.lexer.location);if(this.advance(),"NUMBER"===this.token.token_type&&this.token.token_text.length>1&&"."!==this.token.token_text[0]){let e=Number(this.token.token_text[0]);return this.lexer.unput(this.token.token_text.slice(1)),this.advance(),["^",t,e]}let n=Object.assign({},e);return delete n.allow_absolute_value_closing,delete n.inside_absolute_value,["^",t,this.factor(n)]}return t}baseFactor({inside_absolute_value:e=0,parse_absolute_value:t=!0,allow_absolute_value_closing:n=!1}={}){var r=!1;if("FRAC"===this.token.token_type){if(this.advance(),"{"!==this.token.token_type)throw new ParseError("Expecting {",this.lexer.location);if(this.advance(),this.parseLeibnizNotation){let e=this.return_state(),t=this.leibniz_notation();if(t)return t;this.set_state(e)}let e=this.statement({parse_absolute_value:t});if("}"!==this.token.token_type)throw new ParseError("Expecting }",this.lexer.location);if(this.advance(),"{"!==this.token.token_type)throw new ParseError("Expecting {",this.lexer.location);this.advance();let n=this.statement({parse_absolute_value:t});if("}"!==this.token.token_type)throw new ParseError("Expecting }",this.lexer.location);return this.advance(),["/",e,n]}if("BEGINENVIRONMENT"===this.token.token_type){let e=/\\begin\s*{\s*([a-zA-Z0-9]+)\s*}/.exec(this.token.token_text)[1];if(["matrix","pmatrix","bmatrix"].includes(e)){let n=0,a=0,i=[],o=[],s=0,l=this.token.token_type;for(this.advance();"ENDENVIRONMENT"!==this.token.token_type;)"&"===this.token.token_type?("&"!==l&&"LINEBREAK"!==l||(o.push(0),s+=1),l=this.token.token_type,this.advance()):"LINEBREAK"===this.token.token_type?("&"!==l&&"LINEBREAK"!==l||(o.push(0),s+=1),i.push(o),s>a&&(a=s),n+=1,s=0,o=[],l=this.token.token_type,this.advance()):(o.push(this.statement({parse_absolute_value:t})),s+=1,l=" ");if(/\\end\s*{\s*([a-zA-Z0-9]+)\s*}/.exec(this.token.token_text)[1]!==e)throw new ParseError("Expecting \\end{"+e+"}",this.lexer.location);"&"===l&&(o.push(0),s+=1),i.push(o),s>a&&(a=s),n+=1,this.advance(),r=["matrix",["tuple",n,a]];let u=["tuple"];for(let e of i){let t=["tuple"].concat(e);for(let n=e.length;n<a;n+=1)t.push(0);u.push(t)}return r.push(u),r}throw new ParseError("Unrecognized environment "+e,this.lexer.location)}if("NUMBER"===this.token.token_type)r=parseFloat(this.token.token_text),this.advance();else if("INFINITY"===this.token.token_type)r=1/0,this.advance();else if("SQRT"===this.token.token_type){this.advance();let e=2;if("["===this.token.token_type){this.advance();let n=this.statement({parse_absolute_value:t});if("]"!==this.token.token_type)throw new ParseError("Expecting ]",this.lexer.location);this.advance(),e=n}if("{"!==this.token.token_type)throw new ParseError("Expecting {",this.lexer.location);this.advance();let n=this.statement({parse_absolute_value:t});if("}"!==this.token.token_type)throw new ParseError("Expecting }",this.lexer.location);this.advance(),r=2===e?["apply","sqrt",n]:["^",n,["/",1,e]]}else if("VAR"===this.token.token_type||"LATEXCOMMAND"===this.token.token_type||"VARMULTICHAR"===this.token.token_type){if(r=this.token.token_text,"LATEXCOMMAND"===this.token.token_type){if(r=r.slice(1),!(this.appliedFunctionSymbols.includes(r)||this.functionSymbols.includes(r)||this.allowedLatexSymbols.includes(r)))throw new ParseError("Unrecognized latex command "+this.token.original_text,this.lexer.location)}else"VARMULTICHAR"===this.token.token_type&&(r=/\\var\s*\{\s*([a-zA-Z0-9]+)\s*\}/.exec(r)[1]);if(this.appliedFunctionSymbols.includes(r)||this.functionSymbols.includes(r)){let e=!1;if(this.appliedFunctionSymbols.includes(r)&&(e=!0),this.advance(),"_"===this.token.token_type){this.advance();let e=this.baseFactor({parse_absolute_value:t});if(!1===e)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);r="log"===r&&10===e?"log10":["_",r,e]}for(;"'"===this.token.token_type;)r=["prime",r],this.advance();if("^"===this.token.token_type&&(this.advance(),r=["^",r,this.factor({parse_absolute_value:t})]),"{"===this.token.token_type||"("===this.token.token_type){let e;e="{"===this.token.token_type?"}":")",this.advance();let t=this.statement_list();if(this.token.token_type!==e)throw new ParseError("Expecting "+e,this.lexer.location);this.advance(),"list"===t[0]&&(t[0]="tuple"),r=["apply",r,t]}else if(e){if(!this.allowSimplifiedFunctionApplication)throw new ParseError("Expecting ( after function",this.lexer.location);r=["apply",r,this.factor({parse_absolute_value:t})]}}else this.advance()}else if("("===this.token.token_type||"["===this.token.token_type||"{"===this.token.token_type||"LBRACE"===this.token.token_type){let e,t,n=this.token.token_type;"("===this.token.token_type?(e=")",t="]"):"["===this.token.token_type?(e="]",t=")"):"{"===this.token.token_type?(e="}",t=null):(e="RBRACE",t=null),this.advance();let a=1;if("list"===(r=this.statement_list())[0]&&(a=r.length-1),this.token.token_type!==e){if(2!==a||null===t)throw new ParseError("Expecting "+e,this.lexer.location);if(this.token.token_type!==t)throw new ParseError("Expecting ) or ]",this.lexer.location);let i;r[0]="tuple",i="("===n?["tuple",!1,!0]:["tuple",!0,!1],(r=["interval",r]).push(i)}else a>=2?r[0]="("===n||"{"===n?"tuple":"["===n?"array":"set":"LBRACE"===n&&("|"===r[0]||r[0],r=["set",r]);this.advance()}else if("|"===this.token.token_type[0]&&t&&(0===e||!n||"L"===this.token.token_type[1])){if(e+=1,this.advance(),r=["apply","abs",r=this.statement({inside_absolute_value:e})],"|"!==this.token.token_type)throw new ParseError("Expecting |",this.lexer.location);this.advance()}if("_"===this.token.token_type){if(!1===r)throw new ParseError("Invalid location of _",this.lexer.location);this.advance();let e=this.baseFactor({parse_absolute_value:t});if(!1===e)throw"EOF"===this.token.token_type?new ParseError("Unexpected end of input",this.lexer.location):new ParseError("Invalid location of '"+this.token.original_text+"'",this.lexer.location);return["_",r,e]}return r}leibniz_notation(){var e=this.token.token_text;let t="",n=1,r="",a=[],i=[];if("LATEXCOMMAND"===this.token.token_type&&"partial"===e.slice(1))t="";else{if("VAR"!==this.token.token_type||"d"!==e)return!1;t="d"}if(this.advance(),"^"===this.token.token_type){this.advance();let e=!1;if("{"===this.token.token_type&&(e=!0,this.advance()),"NUMBER"!==this.token.token_type)return!1;if(n=parseFloat(this.token.token_text),!Number.isInteger(n))return!1;if(e&&(this.advance(),"}"!==this.token.token_type))return!1;this.advance()}if("VAR"===this.token.token_type)r=this.token.token_text;else if("VARMULTICHAR"===this.token.token_type)r=/\\var\s*\{\s*([a-zA-Z0-9]+)\s*\}/.exec(this.token.token_text)[1];else if("LATEXCOMMAND"===this.token.token_type){if(e=this.token.token_text.slice(1),!this.allowedLatexSymbols.includes(e))return!1;r=e}if(this.advance(),"}"!==this.token.token_type)return!1;if(this.advance(),"{"!==this.token.token_type)return!1;this.advance();let o=0;for(;;){if(!("d"===t&&"VAR"===this.token.token_type&&"d"===this.token.token_text||""===t&&"LATEXCOMMAND"===this.token.token_type&&"partial"===this.token.token_text.slice(1)))return!1;if(this.advance(),"VAR"===this.token.token_type)a.push(this.token.token_text);else if("VARMULTICHAR"===this.token.token_type)a.push(/\\var\s*\{\s*([a-zA-Z0-9]+)\s*\}/.exec(this.token.token_text)[1]);else{if("LATEXCOMMAND"!==this.token.token_type)return!1;{let e=this.token.token_text.slice(1);if(!this.allowedLatexSymbols.includes(e))return!1;a.push(e)}}let s=1;if(this.advance(),"^"===this.token.token_type){this.advance();let e=!1;if("{"===this.token.token_type&&(e=!0,this.advance()),"NUMBER"!==this.token.token_type)return!1;if(s=parseFloat(this.token.token_text),!Number.isInteger(s))return!1;if(e&&(this.advance(),"}"!==this.token.token_type))return!1;this.advance()}if(i.push(s),o+=s,o>n)return!1;if(o===n){if("}"!==this.token.token_type)return!1;this.advance();let o="derivative_leibniz";""===t&&(o="partial_"+o),e=[o],1===n?e.push(r):e.push(["tuple",r,n]);let s=[];for(let e=0;e<a.length;e+=1)1===i[e]?s.push(a[e]):s.push(["tuple",a[e],i[e]]);return s=["tuple"].concat(s),e.push(s),e}}}}class latexToGuppy{constructor(){this.latexToAst=new latexToAst$1,this.astToGuppy=new astToGuppy$1}convert(e){return this.astToGuppy.convert(this.latexToAst.convert(e))}}class latexToMathjs{constructor(){this.latexToAst=new latexToAst$1,this.astToMathjs=new astToMathjs$1}convert(e){return this.astToMathjs.convert(this.latexToAst.convert(e))}}class latexToText{constructor(){this.latexToAst=new latexToAst$1,this.astToText=new astToText$1}convert(e){return this.astToText.convert(this.latexToAst.convert(e))}}const operators={"+,add":function(e){return["+"].concat(e)},"*,multiply":function(e){return["*"].concat(e)},"/,divide":function(e){return["/",e[0],e[1]]},"-,unaryMinus":function(e){return["-",e[0]]},"-,subtract":function(e){return["+",e[0],["-",e[1]]]},"^,pow":function(e){return["^",e[0],e[1]]},"and,and":function(e){return["and"].concat(e)},"or,or":function(e){return["or"].concat(e)},"not,not":function(e){return["not",e[0]]},"==,equal":function(e){return["="].concat(e)},"<,smaller":function(e){return["<",e[0],e[1]]},">,larger":function(e){return[">",e[0],e[1]]},"<=,smallerEq":function(e){return["le",e[0],e[1]]},">=,largerEq":function(e){return["ge",e[0],e[1]]},"!=,unequal":function(e){return["ne",e[0],e[1]]},"!,factorial":function(e){return["apply","factorial",e[0]]}};class mathjsToAst{convert(e){if(e.isConstantNode)return e.value;if(e.isSymbolNode)return e.name;if(e.isOperatorNode){var t=[e.op,e.fn].join(",");if(t in operators)return operators[t](e.args.map(function(e,t){return this.convert(e)}.bind(this)));throw Error("Unsupported operator: "+e.op+", "+e.fn)}if(e.isFunctionNode){var n=e.args.map(function(e,t){return this.convert(e)}.bind(this));n=n.length>1?["tuple"].concat(n):n[0];var r=["apply",e.name];return r.push(n),r}if(e.isArrayNode)return["vector"].concat(e.args.map(function(e,t){return this.convert(e)}.bind(this)));if(e.isParenthesisNode)return this.convert(e.content);throw Error("Unsupported node type: "+e.type)}}class mathjsToGuppy{constructor(){this.mathjsToAst=new mathjsToAst,this.astToGuppy=new astToGuppy$1}convert(e){return this.astToGuppy.convert(this.mathjsToAst.convert(e))}}class mathjsToLatex{constructor(){this.mathjsToAst=new mathjsToAst,this.astToLatex=new astToLatex$1}convert(e){return this.astToLatex.convert(this.mathjsToAst.convert(e))}}class mathjsToText{constructor(){this.mathjsToAst=new mathjsToAst,this.astToText=new astToText$1}convert(e){return this.astToText.convert(this.mathjsToAst.convert(e))}}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d,ms=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return parse$1(e);if("number"===n&&!1===isNaN(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse$1(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function fmtShort(e){return e>=d?Math.round(e/d)+"d":e>=h?Math.round(e/h)+"h":e>=m?Math.round(e/m)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){return plural(e,d,"day")||plural(e,h,"hour")||plural(e,m,"minute")||plural(e,s,"second")||e+" ms"}function plural(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var debug$1=createCommonjsModule((function(e,t){var n;function r(e){function r(){if(r.enabled){var e=r,a=+new Date,i=a-(n||a);e.diff=i,e.prev=n,e.curr=a,n=a;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var l=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;l++;var a=t.formatters[r];if("function"==typeof a){var i=o[l];n=a.call(e,i),o.splice(l,1),l--}return n})),t.formatArgs.call(e,o);var u=r.log||t.log||console.log.bind(console);u.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,a=0;a<r;a++)n[a]&&("-"===(e=n[a].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=ms,t.names=[],t.skips=[],t.formatters={}}));debug$1.coerce,debug$1.disable,debug$1.enable,debug$1.enabled,debug$1.humanize,debug$1.names,debug$1.skips,debug$1.formatters;var browser$1$1=createCommonjsModule((function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==browser$1&&"env"in browser$1&&(e=browser$1.env.DEBUG),e}(t=e.exports=debug$1).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var a=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(a++,"%c"===e&&(i=a))})),e.splice(i,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}));function isatty(){return!1}function ReadStream(){throw new Error("tty.ReadStream is not implemented")}function WriteStream(){throw new Error("tty.ReadStream is not implemented")}browser$1$1.log,browser$1$1.formatArgs,browser$1$1.save,browser$1$1.load,browser$1$1.useColors,browser$1$1.storage,browser$1$1.colors;var tty={isatty:isatty,ReadStream:ReadStream,WriteStream:WriteStream};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof commonjsGlobal.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof commonjsGlobal.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=commonjsGlobal.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process$1={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},inherits;inherits="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e};var inherits$1=inherits,formatRegExp=/%[sdj%]/g;function format(e){if(!isString(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(inspect(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,i=String(e).replace(formatRegExp,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),o=r[n];n<a;o=r[++n])isNull(o)||!isObject(o)?i+=" "+o:i+=" "+inspect(o);return i}function deprecate(e,t){if(isUndefined(commonjsGlobal.process))return function(){return deprecate(e,t).apply(this,arguments)};if(!0===process$1.noDeprecation)return e;var n=!1;return function(){if(!n){if(process$1.throwDeprecation)throw new Error(t);process$1.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}}var debugs={},debugEnviron;function debuglog(e){return isUndefined(debugEnviron)&&(debugEnviron=process$1.env.NODE_DEBUG||""),e=e.toUpperCase(),debugs[e]||(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)?debugs[e]=function(){var t=format.apply(null,arguments);console.error("%s %d: %s",e,0,t)}:debugs[e]=function(){}),debugs[e]}function inspect(e,t){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(t)?n.showHidden=t:t&&_extend(n,t),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,e,n.depth)}function stylizeWithColor(e,t){var n=inspect.styles[t];return n?"["+inspect.colors[n][0]+"m"+e+"["+inspect.colors[n][1]+"m":e}function stylizeNoColor(e,t){return e}function arrayToHash(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}function formatValue(e,t,n){if(e.customInspect&&t&&isFunction(t.inspect)&&t.inspect!==inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return isString(r)||(r=formatValue(e,r,n)),r}var a=formatPrimitive(e,t);if(a)return a;var i=Object.keys(t),o=arrayToHash(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),isError(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return formatError(t);if(0===i.length){if(isFunction(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError(t)}var l,u="",c=!1,p=["{","}"];return isArray(t)&&(c=!0,p=["[","]"]),isFunction(t)&&(u=" [Function"+(t.name?": "+t.name:"")+"]"),isRegExp(t)&&(u=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(u=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(u=" "+formatError(t)),0!==i.length||c&&0!=t.length?n<0?isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=c?formatArray(e,t,n,o,i):i.map((function(r){return formatProperty(e,t,n,o,r,c)})),e.seen.pop(),reduceToSingleString(l,u,p)):p[0]+u+p[1]}function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return isNumber(t)?e.stylize(""+t,"number"):isBoolean(t)?e.stylize(""+t,"boolean"):isNull(t)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,t,n,r,a){for(var i=[],o=0,s=t.length;o<s;++o)hasOwnProperty(t,String(o))?i.push(formatProperty(e,t,n,r,String(o),!0)):i.push("");return a.forEach((function(a){a.match(/^\d+$/)||i.push(formatProperty(e,t,n,r,a,!0))})),i}function formatProperty(e,t,n,r,a,i){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),hasOwnProperty(r,a)||(o="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=isNull(n)?formatValue(e,l.value,null):formatValue(e,l.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),isUndefined(o)){if(i&&a.match(/^\d+$/))return s;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function reduceToSingleString(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var e=new Date,t=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],t].join(" ")}function log(){console.log("%s - %s",timestamp(),format.apply(null,arguments))}function _extend(e,t){if(!t||!isObject(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var util={inherits:inherits$1,_extend:_extend,log:log,isBuffer:isBuffer,isPrimitive:isPrimitive,isFunction:isFunction,isError:isError,isDate:isDate,isObject:isObject,isRegExp:isRegExp,isUndefined:isUndefined,isSymbol:isSymbol,isString:isString,isNumber:isNumber,isNullOrUndefined:isNullOrUndefined,isNull:isNull,isBoolean:isBoolean,isArray:isArray,inspect:inspect,deprecate:deprecate,format:format,debuglog:debuglog},node=createCommonjsModule((function(e,t){(t=e.exports=debug$1).init=function(e){e.inspectOpts={};for(var n=Object.keys(t.inspectOpts),r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(){return r.write(util.format.apply(util,arguments)+"\n")},t.formatArgs=function(e){var n=this.namespace;if(this.useColors){var r=this.color,a="  [3"+r+";1m"+n+" [0m";e[0]=a+e[0].split("\n").join("\n"+a),e.push("[3"+r+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+n+" "+e[0]},t.save=function(e){null==e?delete browser$1.env.DEBUG:browser$1.env.DEBUG=e},t.load=a,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):tty.isatty(n)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(browser$1.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),r=browser$1.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e}),{});var n=parseInt(browser$1.env.DEBUG_FD,10)||2;1!==n&&2!==n&&util.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var r=1===n?browser$1.stdout:2===n?browser$1.stderr:function(e){var t;switch(browser$1.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new tty.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new require$$2.SyncWriteStream(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new require$$2.Socket({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(n);function a(){return browser$1.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,util.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,util.inspect(e,this.inspectOpts)},t.enable(a())}));node.init,node.log,node.formatArgs,node.save,node.load,node.useColors,node.colors,node.inspectOpts;var src=createCommonjsModule((function(e){void 0!==browser$1&&"renderer"===browser$1.type?e.exports=browser$1$1:e.exports=node})),debug=src("xml-parser"),xmlParser=parse;function parse(e){return e=(e=e.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:function(){if(n(/^<\?xml\s*/)){for(var e={attributes:{}};!r()&&!a("?>");){var i=t();if(!i)return e;e.attributes[i.name]=i.value}return n(/\?>\s*/),e}}(),root:function i(){debug("tag %j",e);var o=n(/^<([\w-:.]+)\s*/);if(o){for(var s,l={name:o[1],attributes:{},children:[]};!(r()||a(">")||a("?>")||a("/>"));){var u=t();if(!u)return l;l.attributes[u.name]=u.value}if(n(/^\s*\/>\s*/))return l;for(n(/\??>\s*/),l.content=function(){debug("content %j",e);var t=n(/^([^<]*)/);return t?t[1]:""}();s=i();)l.children.push(s);return n(/^<\/[\w-:.]+>\s*/),l}}()};function t(){debug("attribute %j",e);var t,r=n(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(r)return{name:r[1],value:(t=r[2],t.replace(/^['"]|['"]$/g,""))}}function n(t){var n=e.match(t);if(n)return e=e.slice(n[0].length),n}function r(){return 0==e.length}function a(t){return 0==e.indexOf(t)}}const entities={"&#913;":"\\Alpha","&Alpha;":"\\Alpha","&#x0391;":"\\Alpha","\\u0391;":"\\Alpha","&#914;":"\\Beta","&Beta;":"\\Beta","&#x0392;":"\\Beta","\\u0392;":"\\Beta","&#915;":"\\Gamma","&Gamma;":"\\Gamma","&#x0393;":"\\Gamma","\\u0393;":"\\Gamma","&#916;":"\\Delta","&Delta;":"\\Delta","&#x0394;":"\\Delta","\\u0394;":"\\Delta","&#917;":"\\Epsilon","&Epsilon;":"\\Epsilon","&#x0395;":"\\Epsilon","\\u0395;":"\\Epsilon","&#918;":"\\Zeta","&Zeta;":"\\Zeta","&#x0396;":"\\Zeta","\\u0396;":"\\Zeta","&#919;":"\\Eta","&Eta;":"\\Eta","&#x0397;":"\\Eta","\\u0397;":"\\Eta","&#920;":"\\Theta","&Theta;":"\\Theta","&#x0398;":"\\Theta","\\u0398;":"\\Theta","&#921;":"\\Iota","&Iota;":"\\Iota","&#x0399;":"\\Iota","\\u0399;":"\\Iota","&#922;":"\\Kappa","&Kappa;":"\\Kappa","&#x039A;":"\\Kappa","\\u039A;":"\\Kappa","&#923;":"\\Lambda","&Lambda;":"\\Lambda","&#x039B;":"\\Lambda","\\u039B;":"\\Lambda","&#924;":"\\Mu","&Mu;":"\\Mu","&#x039C;":"\\Mu","\\u039C;":"\\Mu","&#925;":"\\Nu","&Nu;":"\\Nu","&#x039D;":"\\Nu","\\u039D;":"\\Nu","&#926;":"\\Xi","&Xi;":"\\Xi","&#x039E;":"\\Xi","\\u039E;":"\\Xi","&#927;":"\\Omicron","&Omicron;":"\\Omicron","&#x039F;":"\\Omicron","\\u039F;":"\\Omicron","&#928;":"\\Pi","&Pi;":"\\Pi","&#x03A0;":"\\Pi","\\u03A0;":"\\Pi","&#929;":"\\Rho","&Rho;":"\\Rho","&#x03A1;":"\\Rho","\\u03A1;":"\\Rho","&#931;":"\\Sigma","&Sigma;":"\\Sigma","&#x03A3;":"\\Sigma","\\u03A3;":"\\Sigma","&#932;":"\\Tau","&Tau;":"\\Tau","&#x03A4;":"\\Tau","\\u03A4;":"\\Tau","&#933;":"\\Upsilon","&Upsilon;":"\\Upsilon","&#x03A5;":"\\Upsilon","\\u03A5;":"\\Upsilon","&#934;":"\\Phi","&Phi;":"\\Phi","&#x03A6;":"\\Phi","\\u03A6;":"\\Phi","&#935;":"\\Chi","&Chi;":"\\Chi","&#x03A7;":"\\Chi","\\u03A7;":"\\Chi","&#936;":"\\Psi","&Psi;":"\\Psi","&#x03A8;":"\\Psi","\\u03A8;":"\\Psi","&#937;":"\\Omega","&Omega;":"\\Omega","&#x03A9;":"\\Omega","\\u03A9;":"\\Omega","&#945;":"\\alpha","&alpha;":"\\alpha","&#x03B1;":"\\alpha","\\u03B1;":"\\alpha","&#946;":"\\beta","&beta;":"\\beta","&#x03B2;":"\\beta","\\u03B2;":"\\beta","&#947;":"\\gamma","&gamma;":"\\gamma","&#x03B3;":"\\gamma","\\u03B3;":"\\gamma","&#948;":"\\delta","&delta;":"\\delta","&#x03B4;":"\\delta","\\u03B4;":"\\delta","&#949;":"\\epsilon","&epsilon;":"\\epsilon","&#x03B5;":"\\epsilon","\\u03B5;":"\\epsilon","&#950;":"\\zeta","&zeta;":"\\zeta","&#x03B6;":"\\zeta","\\u03B6;":"\\zeta","&#951;":"\\eta","&eta;":"\\eta","&#x03B7;":"\\eta","\\u03B7;":"\\eta","&#952;":"\\theta","&theta;":"\\theta","&#x03B8;":"\\theta","\\u03B8;":"\\theta","&#953;":"\\iota","&iota;":"\\iota","&#x03B9;":"\\iota","\\u03B9;":"\\iota","&#954;":"\\kappa","&kappa;":"\\kappa","&#x03BA;":"\\kappa","\\u03BA;":"\\kappa","&#955;":"\\lambda","&lambda;":"\\lambda","&#x03BB;":"\\lambda","\\u03BB;":"\\lambda","&#956;":"\\mu","&mu;":"\\mu","&#x03BC;":"\\mu","\\u03BC;":"\\mu","&#957;":"\\nu","&nu;":"\\nu","&#x03BD;":"\\nu","\\u03BD;":"\\nu","&#958;":"\\xi","&xi;":"\\xi","&#x03BE;":"\\xi","\\u03BE;":"\\xi","&#959;":"\\omicron","&omicron;":"\\omicron","&#x03BF;":"\\omicron","\\u03BF;":"\\omicron","&#960;":"\\pi","&pi;":"\\pi","&#x03C0;":"\\pi","\\u03C0;":"\\pi","&#961;":"\\rho","&rho;":"\\rho","&#x03C1;":"\\rho","\\u03C1;":"\\rho","&#962;":"\\sigma",";":"\\sigma","&#x03C2;":"\\sigma","\\u03C2;":"\\sigma","&#963;":"\\sigma","&sigma;":"\\sigma","&#x03C3;":"\\sigma","\\u03C3;":"\\sigma","&#964;":"\\tau","&tau;":"\\tau","&#x03C4;":"\\tau","\\u03C4;":"\\tau","&#965;":"\\upsilon","&upsilon;":"\\upsilon","&#x03C5;":"\\upsilon","\\u03C5;":"\\upsilon","&#966;":"\\phi","&phi;":"\\phi","&#x03C6;":"\\phi","\\u03C6;":"\\phi","&#967;":"\\chi","&chi;":"\\chi","&#x03C7;":"\\chi","\\u03C7;":"\\chi","&#968;":"\\psi","&psi;":"\\psi","&#x03C8;":"\\psi","\\u03C8;":"\\psi","&#969;":"\\omega","&omega;":"\\omega","&#x03C9;":"\\omega","\\u03C9;":"\\omega","&#x2212;":"-","&minus;":"-","&#x221E;":"\\infty","&#8734;":"\\infty","&infin;":"\\infty","&sdot;":"\\cdot","&#x22C5;":"\\cdot","&#8901;":"\\cdot","&times;":"\\times","&#x00D7;":"\\times","&#215;":"\\times"};class mmlToLatex{parse(e){return"mi"===e.name?entities[e.content]?entities[e.content]:e.content.length>1?"\\"+e.content:e.content:"mn"===e.name?e.content:"msup"===e.name?this.parse(e.children[0])+"^{"+this.parse(e.children[1])+"}":"mroot"===e.name?"\\sqrt["+this.parse(e.children[1])+"]{"+this.parse(e.children[1])+"}":"mfrac"===e.name?"\\frac{"+this.parse(e.children[0])+"}{"+this.parse(e.children[1])+"}":"msqrt"===e.name?"\\sqrt{"+e.children.map(function(e,t){return this.parse(e)}.bind(this)).join(" ")+"}":"mo"===e.name?entities[e.content]?entities[e.content]:"&#x2061;"===e.content?" ":e.content:"mrow"===e.name&&"MJX-TeXAtom-ORD"===e.attributes.class?e.children.map(function(e,t){return this.parse(e)}.bind(this)).join(" "):"math"===e.name||"mrow"===e.name?"("+e.children.map(function(e,t){return this.parse(e)}.bind(this)).join(" ")+")":void 0}convert(e){return this.parse(xmlParser(e).root)}}class mmlToAst$1{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1}convert(e){return this.latexToAst.convert(this.mmlToLatex.convert(e))}}class mmlToGuppy{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToGuppy=new astToGuppy$1}convert(e){return this.astToGuppy.convert(this.latexToAst.convert(this.mmlToLatex.convert(e)))}}class mmlToMathjs{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToMathjs=new astToMathjs$1}convert(e){return this.astToMathjs.convert(this.latexToAst.convert(this.mmlToLatex.convert(e)))}}class mmlToText{constructor(){this.mmlToLatex=new mmlToLatex,this.latexToAst=new latexToAst$1,this.astToText=new astToText$1}convert(e){return this.astToText.convert(this.latexToAst.convert(this.mmlToLatex.convert(e)))}}class textToGuppy{constructor(){this.textToAst=new textToAst$4,this.astToGuppy=new astToGuppy$1}convert(e){return this.astToGuppy.convert(this.textToAst.convert(e))}}class textToLatex{constructor(){this.textToAst=new textToAst$4,this.astToLatex=new astToLatex$1}convert(e){return this.astToLatex.convert(this.textToAst.convert(e))}}class textToMathjs{constructor(){this.textToAst=new textToAst$4,this.astToMathjs=new astToMathjs$1}convert(e){return this.astToMathjs.convert(this.textToAst.convert(e))}}var converters=Object.freeze({__proto__:null,astToLatexObj:astToLatex$1,astToTextObj:astToText$1,astToGuppyObj:astToGuppy$1,astToMathjsObj:astToMathjs$1,latexToAstObj:latexToAst$1,latexToGuppyObj:latexToGuppy,latexToMathjsObj:latexToMathjs,latexToTextObj:latexToText,mathjsToAstObj:mathjsToAst,mathjsToGuppyObj:mathjsToGuppy,mathjsToLatexObj:mathjsToLatex,mathjsToTextObj:mathjsToText,mmlToAstObj:mmlToAst$1,mmlToGuppyObj:mmlToGuppy,mmlToLatexObj:mmlToLatex,mmlToMathjsObj:mmlToMathjs,mmlToTextObj:mmlToText,textToAstObj:textToAst$4,textToGuppyObj:textToGuppy,textToLatexObj:textToLatex,textToMathjsObj:textToMathjs,astToGLSL:astToGLSL$1}),textToAst=new textToAst$4,latexToAst=new latexToAst$1,mmlToAst=new mmlToAst$1,utils={match:match,flatten:flatten$k,unflattenLeft:unflattenLeft,unflattenRight:unflattenRight};function Expression(e,t){this.tree=flatten$k(e),this.context=t,this.toJSON=function(){let e={objectType:"math-expression",tree:this.tree},t={};for(let e in this.context.assumptions)Object.keys(this.context.assumptions[e]).length>0&&(t[e]=this.context.assumptions[e]);return Object.keys(t).length>0&&(e.assumptions=t),e}}function extend(e,t){var n=flatten_array(Array.prototype.slice.call(arguments,2));return n.forEach((function(n){if(n)for(var r in n)t?function(){var t=r;e[t]=function(){return this.fromAst(n[t].apply(null,arguments))}}():e[r]=n[r]})),e}function extend_prototype(e,t){var n=flatten_array(Array.prototype.slice.call(arguments,2));return n.forEach((function(n){if(n)for(var r in n)!function(){var a=r;e[a]=function(){var e=[this].concat(Array.prototype.slice.call(arguments));return t?this.context.fromAst(n[a].apply(null,e)):n[a].apply(null,e)}}()})),e}function create_from_multiple(e,t){if(Array.isArray(e)||"number"==typeof e)return new Expression(e,Context);if("string"==typeof e)try{return new Expression(textToAst.convert(e),Context)}catch(t){try{return new Expression(latexToAst.convert(e),Context)}catch(n){try{return new Expression(mmlToAst.convert(e),Context)}catch(r){if(-1!==e.indexOf("\\"))throw n;if(-1!==e.indexOf("</"))throw r;throw t}}}}function parseText(e,t){return new Expression(textToAst.convert(e),Context)}function parseLatex(e,t){return new Expression(latexToAst.convert(e),Context)}function parseMml(e,t){return new Expression(mmlToAst.convert(e),Context)}var Context={assumptions:initialize_assumptions(),parser_parameters:{},from:create_from_multiple,fromText:parseText,parse:parseText,fromLaTeX:parseLatex,fromLatex:parseLatex,fromTeX:parseLatex,fromTex:parseLatex,fromMml:parseMml,parse_tex:parseLatex,converters:converters,utils:utils,fromAst:function(e){return new Expression(e,this)},set_to_default:function(){this.assumptions=initialize_assumptions()},get_assumptions:function(e,t){return get_assumptions(this.assumptions,e,t)},add_assumption:function(e,t){return add_assumption(this.assumptions,e,t)},add_generic_assumption:function(e){return add_generic_assumption(this.assumptions,e)},remove_assumption:function(e){return remove_assumption(this.assumptions,e)},remove_generic_assumption:function(e){return remove_generic_assumption(this.assumptions,e)},clear_assumptions:function(){this.assumptions=initialize_assumptions()},math:math$3,reviver:function(e,t){if(t&&"math-expression"===t.objectType&&void 0!==t.tree){let e=Context.fromAst(t.tree);return void 0!==t.assumptions&&(e.assumptions=t.assumptions),e}return t},class:Expression};function flatten_array(e,t){t=void 0===t?[]:t;for(var n=0;n<e.length;n++)Array.isArray(e[n])?flatten_array(e[n],t):t.push(e[n]);return t}return Context.set_to_default(),extend(Context,!0,expression_to_tree$1,expression_to_tree),extend(Context,!1,expression_to_other),extend_prototype(Expression.prototype,!0,expression_to_tree$1),extend_prototype(Expression.prototype,!1,expression_to_other),Context}))})(mathExpressions_umd);var me$3=getDefaultExportFromCjs(mathExpressions_umd.exports),sha1$1={exports:{}},core$1={exports:{}},hasRequiredCore,module,CryptoJS;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,core$1.exports=(e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},a=r.lib={},i=a.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=a.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,a=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<a;i++){var o=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=o<<24-(r+i)%4*8}else for(i=0;i<a;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],a=function(t){var n=987654321,r=4294967295;return function(){var a=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return a/=4294967296,(a+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=a(4294967296*(n||e.random()));n=987654071*s(),r.push(4294967296*s()|0)}return new o.init(r,t)}}),s=r.enc={},l=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,a=n.sigBytes,i=this.blockSize,s=a/(4*i),l=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*i,u=e.min(4*l,a);if(l){for(var c=0;c<l;c+=i)this._doProcessBlock(r,c);var p=r.splice(0,l);n.sigBytes-=u}return new o.init(p,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}});var d=r.algo={};return r}(Math),e)),core$1.exports;var e}module=sha1$1,module.exports=(CryptoJS=requireCore(),function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,a=e.algo,i=[],o=a.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=0;u<80;u++){if(u<16)i[u]=0|e[t+u];else{var c=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=c<<1|c>>>31}var p=(r<<5|r>>>27)+l+i[u];p+=u<20?1518500249+(a&o|~a&s):u<40?1859775393+(a^o^s):u<60?(a&o|a&s|o&s)-1894007588:(a^o^s)-899497514,l=s,s=o,o=a<<30|a>>>2,a=r,r=p}n[0]=n[0]+r|0,n[1]=n[1]+a|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=r._createHelper(o),e.HmacSHA1=r._createHmacHelper(o)}(),CryptoJS.SHA1);var sha1=sha1$1.exports,encBase64={exports:{}};!function(e,t){e.exports=function(e){return function(){var t=e,n=t.lib.WordArray;function r(e,t,r){for(var a=[],i=0,o=0;o<t;o++)if(o%4){var s=r[e.charCodeAt(o-1)]<<o%4*2,l=r[e.charCodeAt(o)]>>>6-o%4*2;a[i>>>2]|=(s|l)<<24-i%4*8,i++}return n.create(a,i)}t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var a=[],i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)a.push(r.charAt(o>>>6*(3-s)&63));var l=r.charAt(64);if(l)for(;a.length%4;)a.push(l);return a.join("")},parse:function(e){var t=e.length,n=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var i=0;i<n.length;i++)a[n.charCodeAt(i)]=i}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return r(e,t,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(requireCore())}(encBase64);var Base64=encBase64.exports;let rePlus=/\+/g,reSlash=/\//g;function createUniqueName(e,t){return"__"+e+"_"+Base64.stringify(sha1(t)).slice(0,10).replace(rePlus,"_").replace(reSlash,"-")}function getUniqueIdentifierFromBase(e,t){let n=1,r=e+n;for(;t.includes(r);)n+=1,r=e+n;return t.push(r),r}function getNamespaceFromName(e){let t=e.lastIndexOf("/");if(-1===t)throw Error(`Encountered name ${e} that doesn't include a slash`);return e.slice(0,t+1)}function flattenDeep(e){return e.reduce(((e,t)=>Array.isArray(t)?e.concat(flattenDeep(t)):e.concat(t)),[])}function flattenLevels(e,t){return console.log(`levels: ${t}`),e.reduce(((e,n)=>Array.isArray(n)&&t>1?e.concat(flattenLevels(n,t-1)):e.concat(n)),[])}class Subset{union(e){return this.complement().intersect(e.complement()).complement()}intersectWithOpenInterval(e){return this.intersect(e)}setMinus(e){return this.intersect(e.complement())}symmetricDifference(e){return this.setMinus(e).union(e.setMinus(this))}equals(e){return this.symmetricDifference(e).isEmpty()}toJSON(){return{objectType:"subset",data:Object.assign({},this),subsetType:this.constructor.subsetType}}static reviver(e,t){if(t&&"subset"===t.objectType&&void 0!==t.subsetType){if("emptySet"===t.subsetType)return new EmptySet;if("realLine"===t.subsetType)return new RealLine;if("singleton"===t.subsetType)return new Singleton(t.data.element);if("union"===t.subsetType)return new Union(t.data.subsets);if("openInterval"===t.subsetType)return new OpenInterval(t.data.left,t.data.right)}return t}copy(){return this.constructor.reviver(null,this.toJSON())}}class EmptySet extends Subset{static subsetType="emptySet";union(e){return e}intersect(){return new EmptySet}contains(){return!1}isEmpty(){return!0}complement(){return new RealLine}toString(){return""}toMathExpression(){return me$3.fromAst("")}}class RealLine extends Subset{static subsetType="realLine";union(){return new RealLine}intersect(e){return e}contains(){return!0}complement(){return new EmptySet}isEmpty(){return!1}toString(){return""}toMathExpression(){return me$3.fromAst("R")}}class Singleton extends Subset{static subsetType="singleton";constructor(e){if(super(),!Number.isFinite(e))return new EmptySet;this.element=e}union(e){return e.contains(this.element)?e:new Union([e,this])}intersect(e){return e.contains(this.element)?new Singleton(this.element):new EmptySet}isEmpty(){return!1}contains(e){return e===this.element}complement(){return new Union([new OpenInterval(-1/0,this.element),new OpenInterval(this.element,1/0)])}toString(){return`{${this.element}}`}toMathExpression(){return me$3.fromAst(["set",this.element])}}class Union extends Subset{static subsetType="union";intersect(e){return new Union(this.subsets.map((t=>e.intersect(t))))}toString(){return this.subsets.map((e=>e.toString())).join(" U ")}toMathExpression(){return me$3.fromAst(["union",...this.subsets.map((e=>e.toMathExpression().tree))])}constructor(e){super();let t=e.filter((e=>!e.isEmpty()));if(0===t.length)return new EmptySet;t=t.reduce(((e,t)=>t instanceof Union?e.concat(t.subsets):e.concat(t)),[]),this.subsets=[];for(let e=0;e<t.length;e++){let n=t[e],r=!0;if(n instanceof RealLine)return new RealLine;if(n instanceof OpenInterval){let a=n.left,i=n.right;for(let n=e+1;n<t.length;n++){let o=t[n];if(o instanceof OpenInterval){if(a<o.right&&o.left<i){a=Math.min(a,o.left),i=Math.max(i,o.right),t.splice(n,1),n--,r=!1,e--;break}if(a===o.right||i===o.left){let s=a===o.right?a:i,l=!1;for(let e=0;e<this.subsets.length;e++){let t=this.subsets[e];if(t instanceof Singleton&&t.element===s){this.subsets.splice(e,1),l=!0;break}}if(!l)for(let n=e+1;n<t.length;n++){let e=t[n];if(e instanceof Singleton&&e.element===s){t.splice(n,1),l=!0;break}}if(l){a=Math.min(a,o.left),i=Math.max(i,o.right),t.splice(n,1),n--,r=!1,e--;break}}}else o.element>a&&o.element<i&&(t.splice(n,1),n--)}if(n.left=a,n.right=i,n.left===-1/0&&n.right===1/0)return new RealLine}else{let a=n.element;for(let n=e+1;n<t.length;n++){let i=t[n];if(i instanceof OpenInterval){if(a>i.left&&a<i.right){t.splice(e,1),e--,r=!1;break}}else i.element===a&&(t.splice(n,1),n--)}}r&&this.subsets.push(n)}return 1===this.subsets.length?this.subsets[0]:this}contains(e){return this.subsets.some((t=>t.contains(e)))}isEmpty(){return this.subsets.every((e=>e.isEmpty()))}complement(){return this.subsets.map((e=>e.complement())).reduce(((e,t)=>e.intersect(t)))}}class Interval extends Subset{constructor(e,t){return super(),this.left=e,this.right=t,this.left<=this.right?this.left===-1/0&&this.right===1/0?new RealLine:this:new EmptySet}}class OpenInterval extends Interval{static subsetType="openInterval";constructor(e,t){return super(e,t),e===t?new EmptySet:this}intersect(e){return e.intersectWithOpenInterval(this)}intersectWithOpenInterval(e){return new OpenInterval(Math.max(this.left,e.left),Math.min(this.right,e.right))}complement(){return new Union([new OpenClosedInterval(-1/0,this.left),new ClosedOpenInterval(this.right,1/0)])}isEmpty(){return this.left>=this.right}contains(e){return e>this.left&&e<this.right}toString(){return`(${this.left.toString()},${this.right.toString()})`}toMathExpression(){return me$3.fromAst(["interval",["tuple",this.left,this.right],["tuple",!1,!1]])}}class ClosedInterval extends Interval{constructor(e,t){if(super(e,t),!(e<=t))return new EmptySet;let n=[new OpenInterval(e,t)];return Number.isFinite(e)&&n.push(new Singleton(e)),Number.isFinite(t)&&n.push(new Singleton(t)),new Union(n)}}class OpenClosedInterval extends Interval{constructor(e,t){if(super(e,t),!(e<t))return new EmptySet;let n=[new OpenInterval(e,t)];return Number.isFinite(t)&&n.push(new Singleton(t)),new Union(n)}}class ClosedOpenInterval extends Interval{constructor(e,t){if(super(e,t),!(e<t))return new EmptySet;let n=[new OpenInterval(e,t)];return Number.isFinite(e)&&n.push(new Singleton(e)),new Union(n)}}const theModule={Subset:Subset,EmptySet:EmptySet,RealLine:RealLine,Singleton:Singleton,Union:Union,Interval:Interval,OpenInterval:OpenInterval,ClosedInterval:ClosedInterval,OpenClosedInterval:OpenClosedInterval,ClosedOpenInterval:ClosedOpenInterval};function buildSubsetFromIntervals(e,t){if(!Array.isArray(e))return Number.isFinite(e)?new Singleton(e):"R"===e?new RealLine:new EmptySet;let n=e[0];if("interval"===n){let t=e[1],n=e[2],r=t[1];if(!Number.isFinite(r)&&(r=me$3.fromAst(r).evaluate_to_constant(),!Number.isFinite(r)&&r!==1/0&&r!==-1/0))return new EmptySet;let a=t[2];return Number.isFinite(a)||(a=me$3.fromAst(a).evaluate_to_constant(),Number.isFinite(a)||a===1/0||a===-1/0)?n[1]?n[2]?new ClosedInterval(r,a):new ClosedOpenInterval(r,a):n[2]?new OpenClosedInterval(r,a):new OpenInterval(r,a):new EmptySet}if("union"===n||"or"===n){let n=e.slice(1).map((e=>buildSubsetFromIntervals(e,t))).filter((e=>e));return 0===n.length?new EmptySet:1===n.length?n[0]:new Union(n)}if("intersect"===n||"and"===n){let n=e.slice(1).map((e=>buildSubsetFromIntervals(e,t))).filter((e=>e));return 0===n.length?new RealLine:n.reduce(((e,t)=>e.intersect(t)))}if("set"===n){let n=e.slice(1).map((e=>buildSubsetFromIntervals(e,t))).filter((e=>e));return 0===n.length?new EmptySet:1===n.length?n[0]:new Union(n)}if(["<","le",">","ge","=","ne"].includes(n)){let r=e[1],a=!1;if(!Number.isFinite(r))if(deepCompare(r,t))a=!0;else if(r=me$3.fromAst(r).evaluate_to_constant(),!Number.isFinite(r)&&r!==1/0&&r!==-1/0)return new EmptySet;let i=e[2],o=!1;if(!Number.isFinite(i))if(deepCompare(i,t))o=!0;else if(i=me$3.fromAst(i).evaluate_to_constant(),!Number.isFinite(i)&&i!==1/0&&i!==-1/0)return new EmptySet;return a?o?new EmptySet:"<"===n?new OpenInterval(-1/0,i):"le"===n?new OpenClosedInterval(-1/0,i):">"===n?new OpenInterval(i,1/0):"ge"===n?new ClosedOpenInterval(i,1/0):"="===n?Number.isFinite(i)?new Singleton(i):new EmptySet:Number.isFinite(i)?new Union([new OpenInterval(-1/0,i),new OpenInterval(i,1/0)]):new RealLine:o?"<"===n?new OpenInterval(r,1/0):"le"===n?new ClosedOpenInterval(r,1/0):">"===n?new OpenInterval(-1/0,r):"ge"===n?new OpenClosedInterval(-1/0,r):"="===n?Number.isFinite(r)?new Singleton(r):new EmptySet:Number.isFinite(r)?new Union([new OpenInterval(-1/0,r),new OpenInterval(r,1/0)]):new RealLine:new EmptySet}if(["lts","gts"].includes(n)){let r=e[1].slice(1),a=e[2].slice(1);if(3!==r.length||!deepCompare(r[1],t))return new EmptySet;"gts"===n&&(r.reverse(),a.reverse());let i=r[0];if(!Number.isFinite(i)&&(i=me$3.fromAst(i).evaluate_to_constant(),!Number.isFinite(i)&&i!==1/0&&i!==-1/0))return new EmptySet;let o=r[2];return Number.isFinite(o)||(o=me$3.fromAst(o).evaluate_to_constant(),Number.isFinite(o)||o===1/0||o===-1/0)?a[0]?a[1]?new OpenInterval(i,o):new OpenClosedInterval(i,o):a[1]?new ClosedOpenInterval(i,o):new ClosedInterval(i,o):new EmptySet}if("|"===n){let t=e[1];return buildSubsetFromIntervals(e[2],t)}if("^"!==n||"C"!==e[2]&&"c"!==e[2]){if("in"===n)return deepCompare(e[1],t)?buildSubsetFromIntervals(e[2],t):new EmptySet;if("ni"===n)return deepCompare(e[2],t)?buildSubsetFromIntervals(e[1],t):new EmptySet;if("notin"===n){if(deepCompare(e[1],t)){let n=buildSubsetFromIntervals(e[2],t);if(n)return n.complement()}return new EmptySet}if("notni"===n){if(deepCompare(e[2],t)){let n=buildSubsetFromIntervals(e[1],t);if(n)return n.complement()}return new EmptySet}{let t=me$3.fromAst(e).evaluate_to_constant();return Number.isFinite(t)?new Singleton(t):new EmptySet}}{let n=buildSubsetFromIntervals(e[1],t);return n?n.complement():new EmptySet}}function buildSubsetFromMathExpression(e,t){return buildSubsetFromIntervals(e.to_intervals().tree,t.tree)}function deepClone(e,t,n){if(Object(e)!==e||e instanceof Function)return e;if(void 0!==t&&e instanceof t)return e;if(e instanceof me$3.class||e instanceof theModule.Subset)return e.copy();if(void 0===n&&(n=new WeakMap),Array.isArray(e))return[...e.map((e=>deepClone(e,t,n)))];if(e.constructor===Object&&0===Object.entries(e).length)return{};if(n.has(e))return n.get(e);try{var r=new e.constructor}catch(t){r=Object.create(Object.getPrototypeOf(e))}return e instanceof Map?Array.from(e,(([e,a])=>r.set(deepClone(e,t,n),deepClone(a,t,n)))):e instanceof Set&&Array.from(e,(e=>r.add(deepClone(e,t,n)))),n.set(e,r),Object.assign(r,...Object.keys(e).map((r=>({[r]:deepClone(e[r],t,n)}))))}function deepCompare(e,t,n){var r,a;return r=[],a=[],function e(t,i){var o;if(Number.isNaN(t)&&Number.isNaN(i))return!0;if(t===i)return!0;if(void 0!==n&&t instanceof n&&i instanceof n)return t.componentName===i.componentName;if(t instanceof me$3.class&&i instanceof me$3.class)return e(t.tree,i.tree);if("function"==typeof t&&"function"==typeof i||t instanceof Date&&i instanceof Date||t instanceof RegExp&&i instanceof RegExp||t instanceof String&&i instanceof String||t instanceof Number&&i instanceof Number)return t.toString()===i.toString();if(!(t instanceof Object&&i instanceof Object))return!1;if(t.isPrototypeOf(i)||i.isPrototypeOf(t))return!1;if(t.constructor!==i.constructor)return!1;if(t.prototype!==i.prototype)return!1;if(r.indexOf(t)>-1||a.indexOf(i)>-1)return!1;for(o in i){if(i.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof i[o]!=typeof t[o])return!1}for(o in t){if(i.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof i[o]!=typeof t[o])return!1;switch(typeof t[o]){case"object":case"function":if(r.push(t),a.push(i),!e(t[o],i[o]))return!1;r.pop(),a.pop();break;default:if(!(t[o]===i[o]||Number.isNaN(t[o])&&Number.isNaN(i[o])))return!1}}return!0}(e,t)}function breakStringsAndOthersIntoComponentsByStringCommas(e){return null}function returnBreakStringsSugarFunction({childrenToComponentFunction:e,mustStripOffOuterParentheses:t=!1}){return function({matchedChildren:n}){let r=0,a=[],i=[],o=!1,s=n.length;if(t){let e=n[0];if("string"!=typeof e||"("!==e.trimLeft()[0])return{success:!1}}for(let[e,l]of n.entries()){if("string"!=typeof l){i.push(l);continue}let u=l.trim();if(0===e&&t&&"("===u[0]){let e=n[s-1];if("string"==typeof e){let t=e.trimRight();")"===t[t.length-1]&&(o=!0,u=u.substring(1))}}let c=0;for(let t=0;t<u.length;t++){let n=u[t];if("("===n&&r++,")"===n){if(0===r){if(o&&e===s-1&&t===u.length-1){u=u.substring(0,u.length-1);break}return{success:!1}}r--}","===n&&0===r&&(t>c&&i.push(u.substring(c,t)),a.push(i),i=[],c=t+1)}u.length>c&&i.push(u.substring(c,u.length))}return 0!==r?{success:!1}:(a.push(i),{success:!0,newChildren:a.map(e)})}}function breakEmbeddedStringByCommas({childrenList:e}){let t=0,n=[],r=[];for(let a of e){if("string"!=typeof a){r.push(a);continue}let e=a.trim(),i=0;for(let a=0;a<e.length;a++){let o=e[a];if("("===o&&t++,")"===o){if(0===t)return{success:!1};t--}if(","===o&&0===t){if(a>i){let t=e.substring(i,a).trim();r.push(t)}n.push(r),r=[],i=a+1}}if(e.length>i){let t=e.substring(i,e.length).trim();r.push(t)}}return 0!==t?{success:!1}:(n.push(r),{success:!0,pieces:n})}function breakEmbeddedStringsIntoParensPieces({componentList:e,removeParens:t=!1}){let n=0,r=[],a=[];for(let i of e){if("string"!=typeof i){0===n?r.push([i]):a.push(i);continue}let e=i.trim(),o=0;for(let i=0;i<e.length;i++){let s=e[i];if("("===s)0===n&&t&&(o=i+1),n++;else if(")"===s){if(0===n)return{success:!1};if(1===n){if(i+1>o){let n=t?i:i+1,r=e.substring(o,n).trim();r.length>0&&a.push(r)}r.push(a),a=[],o=i+1}n--}else if(0===n&&!s.match(/\s/))return{success:!1}}if(e.length>o){let t=e.substring(o,e.length).trim();a.push(t)}}return 0!==n?{success:!1}:(a.length>0&&r.push(a),{success:!0,pieces:r})}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,t){this.from=e,this.to=t}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=NodeType.match(e)),t=>{let n=e(t);return void 0===n?null:[this,n]}}}NodeProp.closedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.group=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(e,t,n,r=0){this.name=e,this.props=t,this.id=n,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):noProps,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),r=new NodeType(e.name||"",t,e.id,n);if(e.props)for(let n of e.props)if(Array.isArray(n)||(n=n(r)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}return r}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(NodeProp.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let r of n.split(" "))t[r]=e[n];return e=>{for(let n=e.prop(NodeProp.group),r=-1;r<(n?n.length:0);r++){let a=t[r<0?e.name:n[r]];if(a)return a}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let n of this.types){let r=null;for(let t of e){let e=t(n);e&&(r||(r=Object.assign({},n.props)),r[e[0].id]=e[1])}t.push(r?new NodeType(n.name,r,n.id,n.flags):n)}return new NodeSet(t)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;class Tree{constructor(e,t,n,r,a){if(this.type=e,this.children=t,this.positions=n,this.length=r,this.props=null,a&&a.length){this.props=Object.create(null);for(let[e,t]of a)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let n=e.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e,t=0){let n=null!=e&&CachedNode.get(this)||this.topNode,r=new TreeCursor(n);return null!=e&&(r.moveTo(e,t),CachedNode.set(this,r._tree)),r}fullCursor(){return new TreeCursor(this.topNode,1)}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,t=0){let n=resolveNode(CachedNode.get(this)||this.topNode,e,t,!1);return CachedNode.set(this,n),n}resolveInner(e,t=0){let n=resolveNode(CachedInnerNode.get(this)||this.topNode,e,t,!0);return CachedInnerNode.set(this,n),n}iterate(e){let{enter:t,leave:n,from:r=0,to:a=this.length}=e;for(let e=this.cursor(),i=()=>e.node;;){let o=!1;if(e.from<=a&&e.to>=r&&(e.type.isAnonymous||!1!==t(e.type,e.from,e.to,i))){if(e.firstChild())continue;e.type.isAnonymous||(o=!0)}for(;o&&n&&n(e.type,e.from,e.to,i),o=e.type.isAnonymous,!e.nextSibling();){if(!e.parent())return;o=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,n)=>new Tree(this.type,e,t,n,this.propValues)),e.makeTree||((e,t,n)=>new Tree(NodeType.none,e,t,n)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return NodeType.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],r=this.set.types[t],a=r.name;if(/\W/.test(a)&&!r.isError&&(a=JSON.stringify(a)),n==(e+=4))return a;let i=[];for(;e<n;)i.push(this.childString(e)),e=this.buffer[e+3];return a+"("+i.join(",")+")"}findChild(e,t,n,r,a){let{buffer:i}=this,o=-1;for(let s=e;s!=t&&!(checkSide(a,r,i[s+1],i[s+2])&&(o=s,n>0));s=i[s+3]);return o}slice(e,t,n,r){let a=this.buffer,i=new Uint16Array(t-e);for(let r=e,o=0;r<t;)i[o++]=a[r++],i[o++]=a[r++]-n,i[o++]=a[r++]-n,i[o++]=a[r++]-e;return new TreeBuffer(i,r-n,this.set)}}function checkSide(e,t,n,r){switch(e){case-2:return n<t;case-1:return r>=t&&n<t;case 0:return n<t&&r>t;case 1:return n<=t&&r>t;case 2:return r>t;case 4:return!0}}function enterUnfinishedNodesBefore(e,t){let n=e.childBefore(t);for(;n;){let t=n.lastChild;if(!t||t.to!=n.to)break;t.type.isError&&t.from==t.to?(e=n,n=t.prevSibling):n=t}return e}function resolveNode(e,t,n,r){for(var a;e.from==e.to||(n<1?e.from>=t:e.from>t)||(n>-1?e.to<=t:e.to<t);){let t=!r&&e instanceof TreeNode&&e.index<0?null:e.parent;if(!t)return e;e=t}if(r)for(let r=e,i=r.parent;i;r=i,i=r.parent)r instanceof TreeNode&&r.index<0&&(null===(a=i.enter(t,n,!0))||void 0===a?void 0:a.from)!=r.from&&(e=i);for(;;){let a=e.enter(t,n,r);if(!a)return e;e=a}}class TreeNode{constructor(e,t,n,r){this.node=e,this._from=t,this.index=n,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(e,t,n,r,a=0){for(let i=this;;){for(let{children:o,positions:s}=i.node,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],u=s[e]+i._from;if(checkSide(r,n,u,u+l.length))if(l instanceof TreeBuffer){if(2&a)continue;let o=l.findChild(0,l.buffer.length,t,n-u,r);if(o>-1)return new BufferNode(new BufferContext(i,l,e,u),null,o)}else if(1&a||!l.type.isAnonymous||hasChild(l)){let o;if(!(1&a)&&l.props&&(o=l.prop(NodeProp.mounted))&&!o.overlay)return new TreeNode(o.tree,u,e,i);let s=new TreeNode(l,u,e,i);return 1&a||!s.type.isAnonymous?s:s.nextChild(t<0?l.children.length-1:0,t,n,r)}}if(1&a||!i.type.isAnonymous)return null;if(e=i.index>=0?i.index+t:t<0?-1:i._parent.node.children.length,i=i._parent,!i)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this.node.children.length-1,-1,e,-2)}enter(e,t,n=!0,r=!0){let a;if(n&&(a=this.node.prop(NodeProp.mounted))&&a.overlay){let n=e-this.from;for(let{from:e,to:r}of a.overlay)if((t>0?e<=n:e<n)&&(t<0?r>=n:r>n))return new TreeNode(a.tree,a.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r?0:2)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new TreeCursor(this)}get tree(){return this.node}toTree(){return this.node}resolve(e,t=0){return resolveNode(this,e,t,!1)}resolveInner(e,t=0){return resolveNode(this,e,t,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}getChild(e,t=null,n=null){let r=getChildren(this,e,t,n);return r.length?r[0]:null}getChildren(e,t=null,n=null){return getChildren(this,e,t,n)}toString(){return this.node.toString()}}function getChildren(e,t,n,r){let a=e.cursor,i=[];if(!a.firstChild())return i;if(null!=n)for(;!a.type.is(n);)if(!a.nextSibling())return i;for(;;){if(null!=r&&a.type.is(r))return i;if(a.type.is(t)&&i.push(a.node),!a.nextSibling())return null==r?i:[]}}class BufferContext{constructor(e,t,n,r){this.parent=e,this.buffer=t,this.index=n,this.start=r}}class BufferNode{constructor(e,t,n){this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,n){let{buffer:r}=this.context,a=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,n);return a<0?null:new BufferNode(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n,r=!0){if(!r)return null;let{buffer:a}=this.context,i=a.findChild(this.index+4,a.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return i<0?null:new BufferNode(this.context,this,i)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get cursor(){return new TreeCursor(this)}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,r=this.index+4,a=n.buffer[this.index+3];if(a>r){let i=n.buffer[this.index+1],o=n.buffer[this.index+2];e.push(n.slice(r,a,i,o)),t.push(0)}return new Tree(this.type,e,t,this.to-this.from)}resolve(e,t=0){return resolveNode(this,e,t,!1)}resolveInner(e,t=0){return resolveNode(this,e,t,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,n=null){let r=getChildren(this,e,t,n);return r.length?r[0]:null}getChildren(e,t=null,n=null){return getChildren(this,e,t,n)}}class TreeCursor{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:n,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=n+r.buffer[e+1],this.to=n+r.buffer[e+2],!0}yield(e){return!!e&&(e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,n,this.mode));let{buffer:r}=this.buffer,a=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,n);return!(a<0)&&(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=!0,r=!0){return this.buffer?!!r&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n&&!(1&this.mode),r))}parent(){if(!this.buffer)return this.yieldNode(1&this.mode?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=1&this.mode?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let e=n<0?0:this.stack[n]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(e)}return n<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(r.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:n}=r)}else({index:t,_parent:n}=this._tree);for(;n;({index:t,_parent:n}=n))if(t>-1)for(let r=t+e,a=e<0?-1:n.node.children.length;r!=a;r+=e){let e=n.node.children[r];if(1&this.mode||e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer)e:for(let r=this.index,a=this.stack.length;a>=0;){for(let i=e;i;i=i._parent)if(i.index==r){if(r==this.index)return i;t=i,n=a+1;break e}r=this.stack[--a]}for(let e=n;e<this.stack.length;e++)t=new BufferNode(this.buffer,t,this.stack[e]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree.node}}function hasChild(e){return e.children.some((e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e)))}function buildTree(e){var t;let{buffer:n,nodeSet:r,maxBufferLength:a=DefaultBufferLength,reused:i=[],minRepeatType:o=r.types.length}=e,s=Array.isArray(n)?new FlatBufferCursor(n,n.length):n,l=r.types,u=0,c=0;function p(e,t,n,h,y){let{id:b,start:g,end:v,size:T}=s,C=c;for(;T<0;){if(s.next(),-1==T){let t=i[b];return n.push(t),void h.push(g-e)}if(-3==T)return void(u=b);if(-4==T)return void(c=b);throw new RangeError(`Unrecognized record size: ${T}`)}let N,A,S=l[b],w=g-e;if(v-g<=a&&(A=function(e,t){let n=s.fork(),r=0,i=0,l=0,u=n.end-a,c={size:0,start:0,skip:0};e:for(let a=n.pos-e;n.pos>a;){let e=n.size;if(n.id==t&&e>=0){c.size=r,c.start=i,c.skip=l,l+=4,r+=4,n.next();continue}let s=n.pos-e;if(e<0||s<a||n.start<u)break;let p=n.id>=o?4:0,d=n.start;for(n.next();n.pos>s;){if(n.size<0){if(-3!=n.size)break e;p+=4}else n.id>=o&&(p+=4);n.next()}i=d,r+=e,l+=p}(t<0||r==e)&&(c.size=r,c.start=i,c.skip=l);return c.size>4?c:void 0}(s.pos-t,y))){let t=new Uint16Array(A.size-A.skip),n=s.pos-A.size,a=t.length;for(;s.pos>n;)a=f(A.start,t,a);N=new TreeBuffer(t,v-A.start,r),w=A.start-e}else{let e=s.pos-T;s.next();let t=[],n=[],r=b>=o?b:-1,i=0,l=v;for(;s.pos>e;)r>=0&&s.id==r&&s.size>=0?(s.end<=l-a&&(d(t,n,g,i,s.end,l,r,C),i=t.length,l=s.end),s.next()):p(g,e,t,n,r);if(r>=0&&i>0&&i<t.length&&d(t,n,g,i,g,l,r,C),t.reverse(),n.reverse(),r>-1&&i>0){let e=function(e){return(t,n,r)=>{let a,i,o=0,s=t.length-1;if(s>=0&&(a=t[s])instanceof Tree){if(!s&&a.type==e&&a.length==r)return a;(i=a.prop(NodeProp.lookAhead))&&(o=n[s]+a.length+i)}return m(e,t,n,r,o)}}(S);N=balanceRange(S,t,n,0,t.length,0,v-g,e,e)}else N=m(S,t,n,v-g,C-v)}n.push(N),h.push(w)}function d(e,t,n,a,i,o,s,l){let u=[],c=[];for(;e.length>a;)u.push(e.pop()),c.push(t.pop()+n-i);e.push(m(r.types[s],u,c,o-i,l-o)),t.push(i-n)}function m(e,t,n,r,a=0,i){if(u){let e=[NodeProp.contextHash,u];i=i?[e].concat(i):[e]}if(a>25){let e=[NodeProp.lookAhead,a];i=i?[e].concat(i):[e]}return new Tree(e,t,n,r,i)}function f(e,t,n){let{id:r,start:a,end:i,size:l}=s;if(s.next(),l>=0&&r<o){let o=n;if(l>4){let r=s.pos-(l-4);for(;s.pos>r;)n=f(e,t,n)}t[--n]=o,t[--n]=i-e,t[--n]=a-e,t[--n]=r}else-3==l?u=r:-4==l&&(c=r);return n}let h=[],y=[];for(;s.pos>0;)p(e.start||0,e.bufferStart||0,h,y,-1);let b=null!==(t=e.length)&&void 0!==t?t:h.length?y[0]+h[0].length:0;return new Tree(l[e.topID],h.reverse(),y.reverse(),b)}const nodeSizeCache=new WeakMap;function nodeSize(e,t){if(!e.isAnonymous||t instanceof TreeBuffer||t.type!=e)return 1;let n=nodeSizeCache.get(t);if(null==n){n=1;for(let r of t.children){if(r.type!=e||!(r instanceof Tree)){n=1;break}n+=nodeSize(e,r)}nodeSizeCache.set(t,n)}return n}function balanceRange(e,t,n,r,a,i,o,s,l){let u=0;for(let n=r;n<a;n++)u+=nodeSize(e,t[n]);let c=Math.ceil(1.5*u/8),p=[],d=[];return function t(n,r,a,o,s){for(let u=a;u<o;){let a=u,m=r[u],f=nodeSize(e,n[u]);for(u++;u<o;u++){let t=nodeSize(e,n[u]);if(f+t>=c)break;f+=t}if(u==a+1){if(f>c){let e=n[a];t(e.children,e.positions,0,e.children.length,r[a]+s);continue}p.push(n[a])}else{let t=r[u-1]+n[u-1].length-m;p.push(balanceRange(e,n,r,a,u,m,t,null,l))}d.push(m+s-i)}}(t,n,r,a,0),(s||l)(p,d,o)}class Parser$1{startParse(e,t,n){return"string"==typeof e&&(e=new StringInput(e)),n=n?n.length?n.map((e=>new Range(e.from,e.to))):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let r=this.startParse(e,t,n);for(;;){let e=r.advance();if(e)return e}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new NodeProp({perNode:!0});class Stack$1{constructor(e,t,n,r,a,i,o,s,l,u=0,c){this.p=e,this.stack=t,this.state=n,this.reducePos=r,this.pos=a,this.score=i,this.buffer=o,this.bufferBase=s,this.curContext=l,this.lookAhead=u,this.parent=c}toString(){return`[${this.stack.filter(((e,t)=>t%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,n=0){let r=e.parser.context;return new Stack$1(e,[],t,n,n,0,[],0,r?new StackContext(r,r.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){let t=e>>19,n=65535&e,{parser:r}=this.p,a=r.dynamicPrecedence(n);if(a&&(this.score+=a),0==t)return this.pushState(r.getGoto(this.state,n,!0),this.reducePos),n<r.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),void this.reduceContext(n,this.reducePos);let i=this.stack.length-3*(t-1)-(262144&e?6:0),o=this.stack[i-2],s=this.stack[i-1],l=this.bufferBase+this.buffer.length-s;if(n<r.minRepeatTerm||131072&e){let e=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,o,e,l+4,!0)}if(262144&e)this.state=this.stack[i];else{let e=this.stack[i-3];this.state=r.getGoto(e,n,!0)}for(;this.stack.length>i;)this.stack.pop();this.reduceContext(n,o)}storeNode(e,t,n,r=4,a=!1){if(0==e){let e=this,r=this.buffer.length;if(0==r&&e.parent&&(r=e.bufferBase-e.parent.bufferBase,e=e.parent),r>0&&0==e.buffer[r-4]&&e.buffer[r-1]>-1){if(t==n)return;if(e.buffer[r-2]>=t)return void(e.buffer[r-2]=n)}}if(a&&this.pos!=n){let a=this.buffer.length;if(a>0&&0!=this.buffer[a-4])for(;a>0&&this.buffer[a-2]>n;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,r>4&&(r-=4);this.buffer[a]=e,this.buffer[a+1]=t,this.buffer[a+2]=n,this.buffer[a+3]=r}else this.buffer.push(e,t,n,r)}shift(e,t,n){let r=this.pos;if(131072&e)this.pushState(65535&e,this.pos);else if(0==(262144&e)){let a=e,{parser:i}=this.p;(n>this.pos||t<=i.maxNode)&&(this.pos=n,i.stateFlag(a,1)||(this.reducePos=n)),this.pushState(a,r),this.shiftContext(t,r),t<=i.maxNode&&this.buffer.push(t,r,n,4)}else this.pos=n,this.shiftContext(t,r),t<=this.p.parser.maxNode&&this.buffer.push(t,r,n,4)}apply(e,t,n){65536&e?this.reduce(e):this.shift(e,t,n)}useNode(e,t){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=e)&&(this.p.reused.push(e),n++);let r=this.pos;this.reducePos=this.pos=r+e.length,this.pushState(t,r),this.buffer.push(n,r,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let n=e.buffer.slice(t),r=e.bufferBase+t;for(;e&&r==e.bufferBase;)e=e.parent;return new Stack$1(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,r,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let n=e<=this.p.parser.maxNode;n&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,n?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new SimulatedStack(this);;){let n=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==(65536&n))return!0;if(0==n)return!1;t.reduce(n)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let n=[];for(let r,a=0;a<t.length;a+=2)(r=t[a+1])!=this.state&&this.p.parser.hasAction(r,e)&&n.push(t[a],r);if(this.stack.length<120)for(let e=0;n.length<8&&e<t.length;e+=2){let r=t[e+1];n.some(((e,t)=>1&t&&e==r))||n.push(t[e],r)}t=n}let n=[];for(let e=0;e<t.length&&n.length<4;e+=2){let r=t[e+1];if(r==this.state)continue;let a=this.split();a.storeNode(0,a.pos,a.pos,4,!0),a.pushState(r,this.pos),a.shiftContext(t[e],this.pos),a.score-=200,n.push(a)}return n}forceReduce(){let e=this.p.parser.stateSlot(this.state,5);if(0==(65536&e))return!1;let{parser:t}=this.p;if(!t.validAction(this.state,e)){let n=e>>19,r=65535&e,a=this.stack.length-3*n;if(a<0||t.getGoto(this.stack[a],r,!1)<0)return!1;this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100}return this.reduce(e),!0}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new StackContext(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}var Recover;!function(e){e[e.Insert=200]="Insert",e[e.Delete=190]="Delete",e[e.Reduce=100]="Reduce",e[e.MaxNext=4]="MaxNext",e[e.MaxInsertStackDepth=300]="MaxInsertStackDepth",e[e.DampenInsertStackDepth=120]="DampenInsertStackDepth"}(Recover||(Recover={}));class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,n=e>>19;0==n?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(n-1);let r=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=r}}class StackBufferCursor{constructor(e,t,n){this.stack=e,this.pos=t,this.index=n,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let n=this.range,r=this.rangeIndex,a=this.pos+e;for(;a<n.from;){if(!r)return null;let e=this.ranges[--r];a-=n.from-e.to,n=e}for(;t<0?a>n.to:a>=n.to;){if(r==this.ranges.length-1)return null;let e=this.ranges[++r];a+=e.from-n.to,n=e}return a}peek(e){let t,n,r=this.chunkOff+e;if(r>=0&&r<this.chunk.length)t=this.pos+e,n=this.chunk.charCodeAt(r);else{let r=this.resolveOffset(e,1);if(null==r)return-1;if(t=r,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,r=this.range;for(;r.to<=t;)r=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>r.to&&(this.chunk2=this.chunk2.slice(0,r.to-t)),n=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),n}acceptToken(e,t=0){let n=t?this.resolveOffset(t,-1):this.pos;if(null==n||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=n}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let n="";for(let r of this.ranges){if(r.from>=t)break;r.to>e&&(n+=this.input.read(Math.max(r.from,e),Math.min(r.to,t)))}return n}}class TokenGroup{constructor(e,t){this.data=e,this.id=t}token(e,t){readToken(this.data,e,t,this.id)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;class ExternalTokenizer{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function readToken(e,t,n,r){let a=0,i=1<<r,{parser:o}=n.p,{dialect:s}=o;e:for(;0!=(i&e[a]);){let n=e[a+1];for(let r=a+3;r<n;r+=2)if((e[r+1]&i)>0){let n=e[r];if(s.allows(n)&&(-1==t.token.value||t.token.value==n||o.overrides(n,t.token.value))){t.acceptToken(n);break}}for(let r=t.next,i=0,o=e[a+2];i<o;){let s=i+o>>1,l=n+s+(s<<1),u=e[l],c=e[l+1];if(r<u)o=s;else{if(!(r>=c)){a=e[l+2],t.advance();continue e}i=s+1}}break}}function decodeArray(e,t=Uint16Array){if("string"!=typeof e)return e;let n=null;for(let r=0,a=0;r<e.length;){let i=0;for(;;){let t=e.charCodeAt(r++),n=!1;if(126==t){i=65535;break}t>=92&&t--,t>=34&&t--;let a=t-32;if(a>=46&&(a-=46,n=!0),i+=a,n)break;i*=46}n?n[a++]=i:n=new t(i)}return n}const verbose=void 0!==browser$1&&/\bparse\b/.test(browser$1.env.LOG);let stackIDs=null;var Safety,Rec;function cutAt(e,t,n){let r=e.fullCursor();for(r.moveTo(t);;)if(!(n<0?r.childBefore(t):r.childAfter(t)))for(;;){if((n<0?r.to<t:r.from>t)&&!r.type.isError)return n<0?Math.max(0,Math.min(r.to-1,t-25)):Math.min(e.length,Math.max(r.from+1,t+25));if(n<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return n<0?0:e.length}}!function(e){e[e.Margin=25]="Margin"}(Safety||(Safety={}));class FragmentCursor{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let n=this.trees[t],r=this.index[t];if(r==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=n.children[r],i=this.start[t]+n.positions[r];if(i>e)return this.nextStart=i,null;if(a instanceof Tree){if(i==e){if(i<this.safeFrom)return null;let e=i+a.length;if(e<=this.safeTo){let t=a.prop(NodeProp.lookAhead);if(!t||e+t<this.fragment.to)return a}}this.index[t]++,i+a.length>=Math.max(this.safeFrom,e)&&(this.trees.push(a),this.start.push(i),this.index.push(0))}else this.index[t]++,this.nextStart=i+a.length}}}class TokenCache{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map((e=>new CachedToken))}getActions(e){let t=0,n=null,{parser:r}=e.p,{tokenizers:a}=r,i=r.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,s=0;for(let r=0;r<a.length;r++){if(0==(1<<r&i))continue;let l=a[r],u=this.tokens[r];if((!n||l.fallback)&&((l.contextual||u.start!=e.pos||u.mask!=i||u.context!=o)&&(this.updateCachedToken(u,l,e),u.mask=i,u.context=o),u.lookAhead>u.end+25&&(s=Math.max(u.lookAhead,s)),0!=u.value)){let r=t;if(u.extended>-1&&(t=this.addActions(e,u.extended,u.end,t)),t=this.addActions(e,u.value,u.end,t),!l.extend&&(n=u,t>r))break}}for(;this.actions.length>t;)this.actions.pop();return s&&e.setLookAhead(s),n||e.pos!=this.stream.end||(n=new CachedToken,n.value=e.p.parser.eofTerm,n.start=n.end=e.pos,t=this.addActions(e,n.value,n.end,t)),this.mainToken=n,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new CachedToken,{pos:n,p:r}=e;return t.start=n,t.end=Math.min(n+1,r.stream.end),t.value=n==r.stream.end?r.parser.eofTerm:0,t}updateCachedToken(e,t,n){if(t.token(this.stream.reset(n.pos,e),n),e.value>-1){let{parser:t}=n.p;for(let r=0;r<t.specialized.length;r++)if(t.specialized[r]==e.value){let a=t.specializers[r](this.stream.read(e.start,e.end),n);if(a>=0&&n.p.parser.dialect.allows(a>>1)){0==(1&a)?e.value=a>>1:e.extended=a>>1;break}}}else e.value=0,e.end=Math.min(n.p.stream.end,n.pos+1)}putAction(e,t,n,r){for(let t=0;t<r;t+=3)if(this.actions[t]==e)return r;return this.actions[r++]=e,this.actions[r++]=t,this.actions[r++]=n,r}addActions(e,t,n,r){let{state:a}=e,{parser:i}=e.p,{data:o}=i;for(let e=0;e<2;e++)for(let s=i.stateSlot(a,e?2:1);;s+=3){if(65535==o[s]){if(1!=o[s+1]){0==r&&2==o[s+1]&&(r=this.putAction(pair(o,s+2),t,n,r));break}s=pair(o,s+2)}o[s]==t&&(r=this.putAction(pair(o,s+1),t,n,r))}return r}}!function(e){e[e.Distance=5]="Distance",e[e.MaxRemainingPerStep=3]="MaxRemainingPerStep",e[e.MinBufferLengthPrune=500]="MinBufferLengthPrune",e[e.ForceReduceLimit=10]="ForceReduceLimit",e[e.CutDepth=15e3]="CutDepth",e[e.CutTo=9e3]="CutTo"}(Rec||(Rec={}));class Parse{constructor(e,t,n,r){this.parser=e,this.input=t,this.ranges=r,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.stream=new InputStream(t,r),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:a}=r[0];this.stacks=[Stack$1.start(this,e.top[0],a)],this.fragments=n.length&&this.stream.end-a>4*e.bufferLength?new FragmentCursor(n,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,n=this.stacks,r=this.minStackPos,a=this.stacks=[];for(let i=0;i<n.length;i++){let o=n[i];for(;;){if(this.tokens.mainToken=null,o.pos>r)a.push(o);else{if(this.advanceStack(o,a,n))continue;{e||(e=[],t=[]),e.push(o);let n=this.tokens.getMainToken(o);t.push(n.value,n.end)}}break}}if(!a.length){let t=e&&findFinished(e);if(t)return this.stackToTree(t);if(this.parser.strict)throw verbose&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&e){let n=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,a);if(n)return this.stackToTree(n.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(a.length>e)for(a.sort(((e,t)=>t.score-e.score));a.length>e;)a.pop();a.some((e=>e.reducePos>r))&&this.recovering--}else if(a.length>1)e:for(let e=0;e<a.length-1;e++){let t=a[e];for(let n=e+1;n<a.length;n++){let r=a[n];if(t.sameState(r)||t.buffer.length>500&&r.buffer.length>500){if(!((t.score-r.score||t.buffer.length-r.buffer.length)>0)){a.splice(e--,1);continue e}a.splice(n--,1)}}}this.minStackPos=a[0].pos;for(let e=1;e<a.length;e++)a[e].pos<this.minStackPos&&(this.minStackPos=a[e].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,n){let r=e.pos,{parser:a}=this,i=verbose?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&r>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,n=t?e.curContext.hash:0;for(let o=this.fragments.nodeAt(r);o;){let r=this.parser.nodeSet.types[o.type.id]==o.type?a.getGoto(e.state,o.type.id):-1;if(r>-1&&o.length&&(!t||(o.prop(NodeProp.contextHash)||0)==n))return e.useNode(o,r),verbose&&console.log(i+this.stackID(e)+` (via reuse of ${a.getName(o.type.id)})`),!0;if(!(o instanceof Tree)||0==o.children.length||o.positions[0]>0)break;let s=o.children[0];if(!(s instanceof Tree&&0==o.positions[0]))break;o=s}}let o=a.stateSlot(e.state,4);if(o>0)return e.reduce(o),verbose&&console.log(i+this.stackID(e)+` (via always-reduce ${a.getName(65535&o)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let s=this.tokens.getActions(e);for(let o=0;o<s.length;){let l=s[o++],u=s[o++],c=s[o++],p=o==s.length||!n,d=p?e:e.split();if(d.apply(l,u,c),verbose&&console.log(i+this.stackID(d)+` (via ${0==(65536&l)?"shift":`reduce of ${a.getName(65535&l)}`} for ${a.getName(u)} @ ${r}${d==e?"":", split"})`),p)return!0;d.pos>r?t.push(d):n.push(d)}return!1}advanceFully(e,t){let n=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>n)return pushStackDedup(e,t),!0}}runRecovery(e,t,n){let r=null,a=!1;for(let i=0;i<e.length;i++){let o=e[i],s=t[i<<1],l=t[1+(i<<1)],u=verbose?this.stackID(o)+" -> ":"";if(o.deadEnd){if(a)continue;if(a=!0,o.restart(),verbose&&console.log(u+this.stackID(o)+" (restarted)"),this.advanceFully(o,n))continue}let c=o.split(),p=u;for(let e=0;c.forceReduce()&&e<10;e++){if(verbose&&console.log(p+this.stackID(c)+" (via force-reduce)"),this.advanceFully(c,n))break;verbose&&(p=this.stackID(c)+" -> ")}for(let e of o.recoverByInsert(s))verbose&&console.log(u+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,n);this.stream.end>o.pos?(l==o.pos&&(l++,s=0),o.recoverByDelete(s,l),verbose&&console.log(u+this.stackID(o)+` (via recover-delete ${this.parser.getName(s)})`),pushStackDedup(o,n)):(!r||r.score<o.score)&&(r=o)}return r}stackToTree(e){return e.close(),Tree.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(stackIDs||(stackIDs=new WeakMap)).get(e);return t||stackIDs.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function pushStackDedup(e,t){for(let n=0;n<t.length;n++){let r=t[n];if(r.pos==e.pos&&r.sameState(e))return void(t[n].score<e.score&&(t[n]=e))}t.push(e)}class Dialect{constructor(e,t,n){this.source=e,this.flags=t,this.disabled=n}allows(e){return!this.disabled||0==this.disabled[e]}}const id$3=e=>e;class ContextTracker{constructor(e){this.start=e.start,this.shift=e.shift||id$3,this.reduce=e.reduce||id$3,this.reuse=e.reuse||id$3,this.hash=e.hash||(()=>0),this.strict=!1!==e.strict}}class LRParser extends Parser$1{constructor(e){if(super(),this.wrappers=[],13!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (13)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let n=0;n<e.repeatNodeCount;n++)t.push("");let n=Object.keys(e.topRules).map((t=>e.topRules[t][1])),r=[];for(let e=0;e<t.length;e++)r.push([]);function a(e,t,n){r[e].push([t,t.deserialize(String(n))])}if(e.nodeProps)for(let t of e.nodeProps){let e=t[0];for(let n=1;n<t.length;){let r=t[n++];if(r>=0)a(r,e,t[n++]);else{let i=t[n+-r];for(let o=-r;o>0;o--)a(t[n++],e,i);n++}}}this.nodeSet=new NodeSet(t.map(((t,a)=>NodeType.define({name:a>=this.minRepeatTerm?void 0:t,id:a,props:r[a],top:n.indexOf(a)>-1,error:0==a,skipped:e.skippedNodes&&e.skippedNodes.indexOf(a)>-1})))),this.strict=!1,this.bufferLength=DefaultBufferLength;let i=decodeArray(e.tokenData);if(this.context=e.context,this.specialized=new Uint16Array(e.specialized?e.specialized.length:0),this.specializers=[],e.specialized)for(let t=0;t<e.specialized.length;t++)this.specialized[t]=e.specialized[t].term,this.specializers[t]=e.specialized[t].get;this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map((e=>"number"==typeof e?new TokenGroup(i,e):e)),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,n){let r=new Parse(this,e,t,n);for(let a of this.wrappers)r=a(r,e,t,n);return r}getGoto(e,t,n=!1){let r=this.goto;if(t>=r[0])return-1;for(let a=r[t+1];;){let t=r[a++],i=1&t,o=r[a++];if(i&&n)return o;for(let n=a+(t>>1);a<n;a++)if(r[a]==e)return o;if(i)return-1}}hasAction(e,t){let n=this.data;for(let r=0;r<2;r++)for(let a,i=this.stateSlot(e,r?2:1);;i+=3){if(65535==(a=n[i])){if(1!=n[i+1]){if(2==n[i+1])return pair(n,i+2);break}a=n[i=pair(n,i+2)]}if(a==t||0==a)return pair(n,i+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){if(t==this.stateSlot(e,4))return!0;for(let n=this.stateSlot(e,1);;n+=3){if(65535==this.data[n]){if(1!=this.data[n+1])return!1;n=pair(this.data,n+2)}if(t==pair(this.data,n+1))return!0}}nextStates(e){let t=[];for(let n=this.stateSlot(e,1);;n+=3){if(65535==this.data[n]){if(1!=this.data[n+1])break;n=pair(this.data,n+2)}if(0==(1&this.data[n+2])){let e=this.data[n+1];t.some(((t,n)=>1&n&&t==e))||t.push(this.data[n],e)}}return t}overrides(e,t){let n=findOffset(this.data,this.tokenPrecTable,t);return n<0||findOffset(this.data,this.tokenPrecTable,e)<n}configure(e){let t=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let n=this.topRules[e.top];if(!n)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=n}return e.tokenizers&&(t.tokenizers=this.tokenizers.map((t=>{let n=e.tokenizers.find((e=>e.from==t));return n?n.to:t}))),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),n=t.map((()=>!1));if(e)for(let r of e.split(" ")){let e=t.indexOf(r);e>=0&&(n[e]=!0)}let r=null;for(let e=0;e<t.length;e++)if(!n[e])for(let n,a=this.dialects[t[e]];65535!=(n=this.data[a++]);)(r||(r=new Uint8Array(this.maxTerm+1)))[n]=1;return new Dialect(e,n,r)}static deserialize(e){return new LRParser(e)}}function pair(e,t){return e[t]|e[t+1]<<16}function findOffset(e,t,n){for(let r,a=t;65535!=(r=e[a]);a++)if(r==n)return a-t;return-1}function findFinished(e){let t=null;for(let n of e){let e=n.p.stoppedAt;(n.pos==n.p.stream.end||null!=e&&n.pos>e)&&n.p.parser.stateFlag(n.state,2)&&(!t||t.score<n.score)&&(t=n)}return t}const StartTag=1,StartCloseTag=2,MissingCloseTag=3,mismatchedStartCloseTag=4,incompleteStartCloseTag=5,commentContent$1=27,Element=9,OpenTag=10;function nameChar(e){return 45==e||46==e||58==e||e>=65&&e<=90||95==e||e>=97&&e<=122||e>=161}function isSpace(e){return 9==e||10==e||13==e||32==e}let cachedName=null,cachedInput=null,cachedPos=0;function tagNameAfter(e,t){let n=e.pos+t;if(cachedInput==e&&cachedPos==n)return cachedName;for(;isSpace(e.peek(t));)t++;let r="";for(;;){let n=e.peek(t);if(!nameChar(n))break;r+=String.fromCharCode(n),t++}return cachedInput=e,cachedPos=n,cachedName=r||null}function ElementContext(e,t){this.name=e,this.parent=t,this.hash=t?t.hash:0;for(let t=0;t<e.length;t++)this.hash+=(this.hash<<4)+e.charCodeAt(t)+(e.charCodeAt(t)<<8)}const elementContext=new ContextTracker({start:null,shift:(e,t,n,r)=>t==StartTag?new ElementContext(tagNameAfter(r,1)||"",e):e,reduce:(e,t)=>t==Element&&e?e.parent:e,reuse(e,t,n,r){let a=t.type.id;return a==StartTag||a==OpenTag?new ElementContext(tagNameAfter(r,1)||"",e):e},hash:e=>e?e.hash:0,strict:!1}),startTag=new ExternalTokenizer(((e,t)=>{if(60==e.next)if(e.advance(),47==e.next){e.advance();let n=tagNameAfter(e,0);if(!n)return e.acceptToken(incompleteStartCloseTag);if(t.context&&n.toLowerCase()==t.context.name.toLowerCase())return e.acceptToken(StartCloseTag);for(let r=t.context;r;r=r.parent)if(r.name==n)return e.acceptToken(MissingCloseTag,-2);e.acceptToken(mismatchedStartCloseTag)}else if(33!=e.next&&63!=e.next&&!isSpace(e.next))return e.acceptToken(StartTag)}),{contextual:!0});function scanTo(e,t){return new ExternalTokenizer((n=>{for(let r=0,a=0;;a++){if(n.next<0){a&&n.acceptToken(e);break}if(n.next==t.charCodeAt(r)){if(r++,r==t.length){a>t.length&&n.acceptToken(e,1-t.length);break}}else r=0;n.advance()}}))}const commentContent=scanTo(commentContent$1,"--\x3e"),parser=LRParser.deserialize({version:13,states:"*[OQOTOOO]OYO'#CdOeO`O'#CfO!OOTO'#CeOOOP'#Ce'#CeOOOP'#Cx'#CxOOOP'#Co'#CoQQOTOOOOOQ'#Cp'#CpO!VOYO,59OOOOP,59O,59OO!_OpO,59QO!mO`O'#ClOOOP'#DT'#DTOOOP'#Cu'#CuO!rOTO,59PO!yO`O'#CmOOOP,59P,59POOOP-E6m-E6mOOOQ-E6n-E6nOOOP1G.j1G.jOOOO'#Cq'#CqO#ROpO1G.lO#aOpO'#ChOOOO'#Cr'#CrO#rOpO1G.lOOOP1G.l1G.lOOOP1G.t1G.tO#}OWO,59WOOOP-E6s-E6sOOOP1G.k1G.kO$SO`O,59XO$[OWO,59XOOOO-E6o-E6oO$dOpO7+$WOOOP7+$W7+$WOOOP7+$`7+$`O$oOpO,59SO%QOWO,59SOOOO-E6p-E6pOOOP1G.r1G.rO%]OWO1G.sO%]OWO1G.sOOOP1G.s1G.sOOOP<<Gr<<GrOOOP<<Gz<<GzO%QOWO1G.nO%QOWO1G.nO%eO!bO'#C}O%mO#tO'#DQOOOO'#Ck'#CkO%uOpO1G.nO&TOWO7+$_OOOP7+$_7+$_O%QOWO7+$YO&]OpO7+$YOOOO'#Cs'#CsO&kO!bO,59iOOOO,59i,59iOOOO'#Ct'#CtO&sO#tO,59lOOOO,59l,59lO&]OpO7+$YOOOP<<Gy<<GyO&{OpO<<GtO&{OpO<<GtOOOO-E6q-E6qOOOO1G/T1G/TOOOO-E6r-E6rOOOO1G/W1G/WO'ZOpOAN=`",stateData:"'i~OPQOVTOnPO~OkWOmYO~OZZO~OPQOQ`OS[OT]OV]OnPO~ORaO~PjOkWOmdO~O]gOojOpeOxkO~OZlO~ORnO~PjOZpOpeO~O]gOosOpeOxtO~O^vOpeO][Xo[Xx[X~O]gOosOxtO~OoxO~OZyOpeO~Oo{OpeO~O]gOo|Ox}O~O^!OOpeO][ao[ax[a~OpeOr!QOu!RO~Oo!VOpeO~Or![Os!YO~Ou!_Ov!]O~OpeO][io[ix[i~Oo!aOpeO~OpeO][qo[qx[q~Or!eOs!YO~Ou!gOv!]O~OpeO][yo[yx[y~OpeO][!Ro[!Rx[!R~O",goto:"$yxPPPPPPPPyy!RP!XPP!_}!i!o!u!{#R#}$X$_$ePP$kPPPP$oPP$oPP$uSTOVT]R_XRORV_XhZfirQ!TvS!X!O!PR!b!WQaRRn_XSORV_QVORbVQXPRcXQfZQo`dqfouz!P!U!W!`!c!hQugQzpQ!PvQ!UyQ!W!OQ!`!TQ!c!XR!h!bQiZQrfTwirQ!Z!QR!d!ZQ!^!RR!f!^Q_RRm_TUOVX!Sv!O!P!WT^R_",nodeNames:" StartTag StartCloseTag MissingCloseTag StartCloseTag StartCloseTag Document Text Comment Element OpenTag TagName Attribute AttributeName Is AttributeValue MismatchedCloseTag CloseTag SelfClosingTag",maxTerm:40,context:elementContext,nodeProps:[[NodeProp.closedBy,1,"SelfCloseEndTag EndTag",10,"CloseTag MissingCloseTag"],[NodeProp.openedBy,17,"OpenTag"]],skippedNodes:[0],repeatNodeCount:7,tokenData:"6e!aRxOX#oX^({^p#opq({qr#ors*{sw#owx+ex}#o}!O+}!O!P#o!P!Q0}!Q![.y![!^#o!^!_2e!_!`5R!`!a5s!a!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o#y#o#y#z({#z$f#o$f$g({$g#BY#o#BY#BZ({#BZ$IS#o$IS$I_({$I_$I|#o$I|$JO({$JO$JT#o$JT$JU({$JU$KV#o$KV$KW({$KW&FU#o&FU&FV({&FV~#o!R#xVVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#oa$fTVPs`Ow$_wx$ux!^$_!^!_%a!_~$_P$zRVPO!^$u!^!_%T!_~$uP%WRYZ$upq$u!_!`$ua%fWs`OY&OYZ$_Zp&Opq$_qw&Ox!_&O!_!`$_!`~&O`&TQs`Ow&Ox~&Oq&bTVPvpOr&Zrs$us!^&Z!^!_&q!_~&Zq&vWvpOY'`YZ&ZZp'`pq&Zqr'`s!_'`!_!`&Z!`~'`p'eQvpOr'`s~'`!R'rZvps`OY(eYZ#oZp(epq#oqr(ers&Osw(ewx'`x!_(e!_!`#o!`~(e!Q(lTvps`Or(ers&Osw(ewx'`x~(e!a)WkVPvps`p^OX#oX^({^p#opq({qr#ors$_sw#owx&Zx!^#o!^!_'k!_#y#o#y#z({#z$f#o$f$g({$g#BY#o#BY#BZ({#BZ$IS#o$IS$I_({$I_$I|#o$I|$JO({$JO$JT#o$JT$JU({$JU$KV#o$KV$KW({$KW&FU#o&FU&FV({&FV~#o!T+UTurVPs`Ow$_wx$ux!^$_!^!_%a!_~$_!T+nTrbVPvpOr&Zrs$us!^&Z!^!_&q!_~&Z!a,[a]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O-a!O!Q#o!Q![.y![!^#o!^!_'k!_!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!a-nc]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O.y!O!Q#o!Q![.y![!^#o!^!_'k!_!`#o!`!a0]!a!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!_/Wa]WZSVPvps`Or#ors$_sw#owx&Zx}#o}!O.y!O!Q#o!Q![.y![!^#o!^!_'k!_!c#o!c!}.y!}#R#o#R#S.y#S#T#o#T#o.y#o~#o!T0hVmQVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!Z1WXVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_!`#o!`!a1s!a~#o!Z2OVVPvps`xWOr#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!R2lZvps`OY(eYZ#oZp(epq#oqr3_rs&Osw(ewx'`x!_(e!_!`#o!`~(e!R3fVvps`Or(ers&Osw(ewx'`x}(e}!O3{!O~(e!R4SVvps`Or(ers&Osw(ewx'`x}(e}!O4i!O~(e!R4rTvps`nPOr(ers&Osw(ewx'`x~(e!Z5^V^WVPvps`Or#ors$_sw#owx&Zx!^#o!^!_'k!_~#o!]6OVVPvps`oYOr#ors$_sw#owx&Zx!^#o!^!_'k!_~#o",tokenizers:[startTag,commentContent,0,1,2,3,4,5],topRules:{Document:[0,6]},tokenPrec:0});function parse(e){return parser.parse(e).cursor()}function parseAndCompile(e){function t(n){if("Element"!==n.name)throw Error("compileElement() called on a non-Element");if(n.firstChild(),"OpenTag"===n.name){n.firstChild(),n.nextSibling();let r=e.substring(n.from,n.to),a=n.from,i=n.to,o={};for(;n.nextSibling();){if("Attribute"!==n.name){let t=n.from,i=n.to;for(;n.parent(););throw Error(`Invalid DoenetML at positions ${t} to ${i}. Error in opening <${r}> tag.  Found ${e.slice(a-1,i)}`)}n.firstChild();let t=e.substring(n.from,n.to);if(!1===n.nextSibling()){if(t in o)throw Error(`Duplicate attribute ${t}.  Found in component of type ${r} at indices ${n.from}-${n.to}`);o[t]=!0}else{n.nextSibling();let a=e.substring(n.from+1,n.to-1);if(t in o)throw Error(`Duplicate attribute ${t}.  Found in component of type ${r} at indices ${n.from}-${n.to}`);o[t]=a}n.parent()}n.parent();let s={componentType:r,props:{...o},children:[]};for(;n.nextSibling();)if("Text"===n.name){let t=e.substring(n.from,n.to);""!==t&&s.children.push(t)}else{if("Element"!==n.name){if("CloseTag"===n.name)break;if("Comment"===n.name)continue;throw"MismatchedCloseTag"===n.name?Error(`Invalid DoenetML at position ${n.from}. Mismatched closing tag.  Expected </${r}>.  Found ${e.slice(n.from,n.to)}.`):Error(`Invalid DoenetML at position ${n.from}. Expected a closing </${r}> tag.  Instead found ${e.slice(n.from,n.to)}.`)}s.children.push(t(n.node.cursor))}return s.range={openBegin:a,openEnd:i,closeBegin:n.from,closeEnd:n.to},s}if("SelfClosingTag"===n.name){n.firstChild(),n.nextSibling();let t=e.substring(n.from,n.to),r={};for(;n.nextSibling();){if("Attribute"!==n.name)throw Error(`Invalid DoenetML at positions ${n.from} to ${n.to}. Error in self-closing <${t}/> tag.`);n.firstChild();let a=e.substring(n.from,n.to);if(!1===n.nextSibling()){if(a in r)throw Error(`Duplicate attribute ${a}.  Found in component of type ${t} at indices ${n.from}-${n.to}`);r[a]=!0}else{if(n.nextSibling(),a in r)throw Error(`Duplicate attribute ${a}.  Found in component of type ${t} at indices ${n.from}-${n.to}`);let i=e.substring(n.from+1,n.to-1);r[a]=i}n.parent()}let a={selfCloseBegin:n.from,selfCloseEnd:n.to};return{componentType:t,props:{...r},children:[],range:a}}throw Error("Non SelfClosingTag/OpenTag in Element. How did you do that?")}function n(n){if("Element"===n.node.name)return t(n.node.cursor);if("Comment"===n.node.name)return null;if("Text"!==n.node.name)throw Error(`Invalid DoenetML at positions ${n.node.from} to ${n.node.to}.  Found ${e.substring(n.node.from,n.node.to)}`);{let t=e.substring(n.node.from,n.node.to);if(""!==t)return t}}if(!e)return[];let r=parse(e),a=[];if(!r.firstChild())return a;let i=n(r);for(null!=i&&a.push(i);r.nextSibling();){let e=n(r);null!=e&&a.push(e)}return a}var base32$1={exports:{}};!function(e){!function(){var t="object"==typeof window?window:{};!t.HI_BASE32_NO_NODE_JS&&"object"==typeof browser$1&&browser$1.versions&&browser$1.versions.node&&(t=commonjsGlobal);var n=!t.HI_BASE32_NO_COMMON_JS&&e.exports,r="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),a={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},i=[0,0,0,0,0,0,0,0],o=function(e,t){t.length>10&&(t="..."+t.substr(-10));var n=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+e+" bytes: "+t+" <-");throw n.position=e,n},s=function(e){if(""===e)return[];if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");for(var t,n,r,i,o,s,l,u,c=[],p=0,d=(e=e.replace(/=/g,"")).length,m=0,f=d>>3<<3;m<f;)t=a[e.charAt(m++)],n=a[e.charAt(m++)],r=a[e.charAt(m++)],i=a[e.charAt(m++)],o=a[e.charAt(m++)],s=a[e.charAt(m++)],l=a[e.charAt(m++)],u=a[e.charAt(m++)],c[p++]=255&(t<<3|n>>>2),c[p++]=255&(n<<6|r<<1|i>>>4),c[p++]=255&(i<<4|o>>>1),c[p++]=255&(o<<7|s<<2|l>>>3),c[p++]=255&(l<<5|u);var h=d-f;return 2===h?(t=a[e.charAt(m++)],n=a[e.charAt(m++)],c[p++]=255&(t<<3|n>>>2)):4===h?(t=a[e.charAt(m++)],n=a[e.charAt(m++)],r=a[e.charAt(m++)],i=a[e.charAt(m++)],c[p++]=255&(t<<3|n>>>2),c[p++]=255&(n<<6|r<<1|i>>>4)):5===h?(t=a[e.charAt(m++)],n=a[e.charAt(m++)],r=a[e.charAt(m++)],i=a[e.charAt(m++)],o=a[e.charAt(m++)],c[p++]=255&(t<<3|n>>>2),c[p++]=255&(n<<6|r<<1|i>>>4),c[p++]=255&(i<<4|o>>>1)):7===h&&(t=a[e.charAt(m++)],n=a[e.charAt(m++)],r=a[e.charAt(m++)],i=a[e.charAt(m++)],o=a[e.charAt(m++)],s=a[e.charAt(m++)],l=a[e.charAt(m++)],c[p++]=255&(t<<3|n>>>2),c[p++]=255&(n<<6|r<<1|i>>>4),c[p++]=255&(i<<4|o>>>1),c[p++]=255&(o<<7|s<<2|l>>>3)),c},l=function(e,t){if(!t)return function(e){for(var t,n,r="",a=e.length,i=0,s=0;i<a;)if((t=e[i++])<=127)r+=String.fromCharCode(t);else{t>191&&t<=223?(n=31&t,s=1):t<=239?(n=15&t,s=2):t<=247?(n=7&t,s=3):o(i,r);for(var l=0;l<s;++l)((t=e[i++])<128||t>191)&&o(i,r),n<<=6,n+=63&t;n>=55296&&n<=57343&&o(i,r),n>1114111&&o(i,r),n<=65535?r+=String.fromCharCode(n):(n-=65536,r+=String.fromCharCode(55296+(n>>10)),r+=String.fromCharCode(56320+(1023&n)))}return r}(s(e));if(""===e)return"";if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");var n,r,i,l,u,c,p,d,m="",f=e.indexOf("=");-1===f&&(f=e.length);for(var h=0,y=f>>3<<3;h<y;)n=a[e.charAt(h++)],r=a[e.charAt(h++)],i=a[e.charAt(h++)],l=a[e.charAt(h++)],u=a[e.charAt(h++)],c=a[e.charAt(h++)],p=a[e.charAt(h++)],d=a[e.charAt(h++)],m+=String.fromCharCode(255&(n<<3|r>>>2))+String.fromCharCode(255&(r<<6|i<<1|l>>>4))+String.fromCharCode(255&(l<<4|u>>>1))+String.fromCharCode(255&(u<<7|c<<2|p>>>3))+String.fromCharCode(255&(p<<5|d));var b=f-y;return 2===b?(n=a[e.charAt(h++)],r=a[e.charAt(h++)],m+=String.fromCharCode(255&(n<<3|r>>>2))):4===b?(n=a[e.charAt(h++)],r=a[e.charAt(h++)],i=a[e.charAt(h++)],l=a[e.charAt(h++)],m+=String.fromCharCode(255&(n<<3|r>>>2))+String.fromCharCode(255&(r<<6|i<<1|l>>>4))):5===b?(n=a[e.charAt(h++)],r=a[e.charAt(h++)],i=a[e.charAt(h++)],l=a[e.charAt(h++)],u=a[e.charAt(h++)],m+=String.fromCharCode(255&(n<<3|r>>>2))+String.fromCharCode(255&(r<<6|i<<1|l>>>4))+String.fromCharCode(255&(l<<4|u>>>1))):7===b&&(n=a[e.charAt(h++)],r=a[e.charAt(h++)],i=a[e.charAt(h++)],l=a[e.charAt(h++)],u=a[e.charAt(h++)],c=a[e.charAt(h++)],p=a[e.charAt(h++)],m+=String.fromCharCode(255&(n<<3|r>>>2))+String.fromCharCode(255&(r<<6|i<<1|l>>>4))+String.fromCharCode(255&(l<<4|u>>>1))+String.fromCharCode(255&(u<<7|c<<2|p>>>3))),m},u={encode:function(e,t){var n="string"!=typeof e;return n&&e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),n?function(e){for(var t,n,a,i,o,s="",l=e.length,u=0,c=5*parseInt(l/5);u<c;)t=e[u++],n=e[u++],a=e[u++],i=e[u++],o=e[u++],s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|i>>>7)]+r[i>>>2&31]+r[31&(i<<3|o>>>5)]+r[31&o];var p=l-c;return 1===p?(t=e[u],s+=r[t>>>3]+r[t<<2&31]+"======"):2===p?(t=e[u++],n=e[u],s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[n<<4&31]+"===="):3===p?(t=e[u++],n=e[u++],a=e[u],s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[a<<1&31]+"==="):4===p&&(t=e[u++],n=e[u++],a=e[u++],i=e[u],s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|i>>>7)]+r[i>>>2&31]+r[i<<3&31]+"="),s}(e):t?function(e){for(var t,n,a,i,o,s="",l=e.length,u=0,c=5*parseInt(l/5);u<c;)t=e.charCodeAt(u++),n=e.charCodeAt(u++),a=e.charCodeAt(u++),i=e.charCodeAt(u++),o=e.charCodeAt(u++),s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|i>>>7)]+r[i>>>2&31]+r[31&(i<<3|o>>>5)]+r[31&o];var p=l-c;return 1===p?(t=e.charCodeAt(u),s+=r[t>>>3]+r[t<<2&31]+"======"):2===p?(t=e.charCodeAt(u++),n=e.charCodeAt(u),s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[n<<4&31]+"===="):3===p?(t=e.charCodeAt(u++),n=e.charCodeAt(u++),a=e.charCodeAt(u),s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[a<<1&31]+"==="):4===p&&(t=e.charCodeAt(u++),n=e.charCodeAt(u++),a=e.charCodeAt(u++),i=e.charCodeAt(u),s+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|i>>>7)]+r[i>>>2&31]+r[i<<3&31]+"="),s}(e):function(e){var t,n,a,o,s,l,u,c=!1,p="",d=0,m=0,f=e.length;if(""===e)return p;do{for(i[0]=i[5],i[1]=i[6],i[2]=i[7],u=m;d<f&&u<5;++d)(l=e.charCodeAt(d))<128?i[u++]=l:l<2048?(i[u++]=192|l>>6,i[u++]=128|63&l):l<55296||l>=57344?(i[u++]=224|l>>12,i[u++]=128|l>>6&63,i[u++]=128|63&l):(l=65536+((1023&l)<<10|1023&e.charCodeAt(++d)),i[u++]=240|l>>18,i[u++]=128|l>>12&63,i[u++]=128|l>>6&63,i[u++]=128|63&l);m=u-5,d===f&&++d,d>f&&u<6&&(c=!0),t=i[0],u>4?(n=i[1],a=i[2],o=i[3],s=i[4],p+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|o>>>7)]+r[o>>>2&31]+r[31&(o<<3|s>>>5)]+r[31&s]):1===u?p+=r[t>>>3]+r[t<<2&31]+"======":2===u?(n=i[1],p+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[n<<4&31]+"===="):3===u?(n=i[1],a=i[2],p+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[a<<1&31]+"==="):(n=i[1],a=i[2],o=i[3],p+=r[t>>>3]+r[31&(t<<2|n>>>6)]+r[n>>>1&31]+r[31&(n<<4|a>>>4)]+r[31&(a<<1|o>>>7)]+r[o>>>2&31]+r[o<<3&31]+"=")}while(!c);return p}(e)},decode:l};l.asBytes=s,n?e.exports=u:t.base32=u}()}(base32$1);var base32=base32$1.exports;async function cidFromText(e){let t=(new TextEncoder).encode(e);return await cidFromArrayBuffer(t)}async function cidFromArrayBuffer(e){let t=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(36);return n.set([1,85,18,32]),n.set(new Uint8Array(t),4),"b"+base32.encode(n).toLowerCase().replace(/=+/,"")}function retrieveTextFileForCid(e,t="doenet"){return new Promise(((n,r)=>{let a,i,o=retrieveTextFileFromIPFS(e),s=o.promise,l=o.controller,u=!1,c=!1;s.then((e=>{clearTimeout(i),a&&!c&&a.abort(),n(e)})).catch((e=>{u=!0,c&&(clearTimeout(i),r(e))})),i=setTimeout((()=>{let o=retrieveTextFileFromServer(e,t),s=o.promise;a=o.controller,s.then((e=>{u||l.abort(),n(e)})).catch((e=>{c=!0,u?r(e):i=setTimeout((()=>{l.abort(),r(e)}),5e3)}))}),100)}))}function retrieveTextFileFromIPFS(e){let t=new AbortController,n=t.signal;return{promise:async function(){try{let t=await fetch(`https://${e}.ipfs.dweb.link/`,{signal:n});if(t.ok){let n=await t.text();return await cidFromText(n)===e?n:Promise.reject(new Error("cid mismatch"))}return Promise.reject(new Error(`cid not found: ${e}`))}catch(t){return Promise.reject(new Error(`cid not found: ${e}`))}}(),controller:t}}function retrieveTextFileFromServer(e,t){let n=new AbortController,r=n.signal;return{promise:async function(){try{let n=await fetch(`/media/${e}.${t}`,{signal:r});if(n.ok){let t=await n.text(),r=await cidFromText(t);return r===e?t:(console.warn(`cid mismatch, ${e}, ${r}`),Promise.reject(new Error("cid mismatch")))}return Promise.reject(new Error(`cid not found: ${e}`))}catch(t){return Promise.reject(new Error(`cid not found: ${e}`))}}(),controller:n}}async function expandDoenetMLsToFullSerializedComponents({cids:e,doenetMLs:t,componentInfoObjects:n}){let r=[],a={};for(let e of t){let t=parseAndCompile(e);t=cleanIfHaveJustDocument(t),substituteDeprecations(t),correctComponentTypeCapitalization(t,n.componentTypeLowerCaseMapping),createAttributesFromProps(t,n),applyMacros(t,n),removeBlankStringChildren(t,n),decodeXMLEntities(t),applySugar({serializedComponents:t,componentInfoObjects:n}),r.push(t);let i=findContentCopies({serializedComponents:t});for(let e in i.cidComponents)void 0===a[e]&&(a[e]=[]),a[e].push(...i.cidComponents[e])}let i=Object.keys(a);if(i.length>0){let{newDoenetMLs:e,newCids:t}=await cidsToDoenetMLs(i);for(let[e,n]of i.entries())if(t[e]&&t[e].substring(0,n.length)!==n)return Promise.reject(new Error(`Requested cid ${n} but got back ${t[e]}!`));let r=i.length;for(let n=0;n<r;n++){t[n]||(console.warn(`Unable to retrieve content with cid = ${i[n]}`),e[n]="")}let{fullSerializedComponents:o}=await expandDoenetMLsToFullSerializedComponents({doenetMLs:e,cids:t,componentInfoObjects:n});for(let[e,t]of i.entries()){let n=o[e];for(let e of a[t])void 0===e.children&&(e.children=[]),e.children.push({componentType:"externalContent",children:JSON.parse(JSON.stringify(n)),attributes:{newNamespace:{primitive:!0}},doenetAttributes:{createUniqueName:!0}})}}return{cids:e,fullSerializedComponents:r}}function cidsToDoenetMLs(e){let t=[],n=e;for(let n of e)t.push(retrieveTextFileForCid(n,"doenet"));return Promise.all(t).then((e=>Promise.resolve({newDoenetMLs:e,newCids:n}))).catch((e=>{let t;return t=1===n.length?`Could not retrieve cid ${n[0]}`:`Could not retrieve cids ${n.join(",")}`,t+=": "+e.message,console.error(t),Promise.reject(new Error(t))}))}function removeBlankStringChildren(e,t){for(let n of e){if(n.children){let e=t.allComponentClasses[n.componentType];e&&!e.includeBlankStringChildren&&(n.children=n.children.filter((e=>"string"!=typeof e||""!==e.trim()))),removeBlankStringChildren(n.children,t)}for(let e in n.attributes){let r=n.attributes[e].component;r&&r.children&&removeBlankStringChildren([r],t)}}}function findContentCopies({serializedComponents:e}){let t={};for(let n of e)if("copy"===n.componentType){if(n.attributes&&n.attributes.uri){let e=n.attributes.uri.primitive;if(e&&"doenet:"===e.substring(0,7).toLowerCase()){let r=e.match(/[:&]cid=([^&]+)/i);if(r){let e=r[1];void 0===t[e]&&(t[e]=[]),t[e].push(n)}}}}else if(void 0!==n.children){let e=findContentCopies({serializedComponents:n.children});for(let n in e.cidComponents)void 0===t[n]&&(t[n]=[]),t[n].push(...e.cidComponents[n])}return{cidComponents:t}}function addDocumentIfItsMissing(e){if(1!==e.length||"document"!==e[0].componentType){let t=e.splice(0);e.push({componentType:"document",children:t})}}function substituteDeprecations(e){let t={tname:"target",triggerwithtnames:"triggerWithTargets",updatewithtname:"updateWithTarget",paginatortname:"paginator",randomizeorder:"shuffleOrder"};for(let n of e)if("object"==typeof n){if(n.props){let e=!0;for(;e;){e=!1;for(let r in n.props){let a=r.toLowerCase();if(a in t){let i=t[a];console.warn(`Attribute ${r} is deprecated.  Use ${i} instead.`),n.props[i]=n.props[r],delete n.props[r],e=!0;break}}}}n.children&&substituteDeprecations(n.children)}}function cleanIfHaveJustDocument(e){let t=e.filter((e=>"string"!=typeof e||""!==e.trim()));return 1===t.length&&"document"===t[0].componentType?t:e}function correctComponentTypeCapitalization(e,t){for(let n of e){if("object"!=typeof n)continue;let e=t[n.componentType.toLowerCase()];if(!e)throw Error(`Invalid component type${indexRangeString(n)}: ${n.componentType}`);n.componentType=e,n.children&&correctComponentTypeCapitalization(n.children,t)}}function createAttributesFromProps(e,t){for(let n of e){if("object"!=typeof n)continue;let e=t.allComponentClasses[n.componentType],r=e.createAttributesObject(),a={};for(let e in r)a[e.toLowerCase()]=e;let i={},o=Object.assign({},n.props);if(n.props)for(let s in n.props){let l=a[s.toLowerCase()],u=r[l];if(u){if(l in i)throw Error(`Cannot repeat prop ${l}.  Found in component type ${n.componentType}${indexRangeString(n)}`);i[l]=componentFromAttribute({attrObj:u,value:n.props[s],originalComponentProps:o,componentInfoObjects:t}),delete n.props[s]}else if(!["name","assignnames","target"].includes(s.toLowerCase())){if(!e.acceptAnyAttribute)throw Error(`Invalid attribute ${s} for component of type ${n.componentType}${indexRangeString(n)}`);i[s]=componentFromAttribute({value:n.props[s],originalComponentProps:o,componentInfoObjects:t})}}for(let e in r){let n=r[e];n.createPrimitiveOfType&&"defaultPrimitiveValue"in n&&!(e in i)&&(i[e]=componentFromAttribute({attrObj:n,originalComponentProps:o,value:n.defaultPrimitiveValue.toString(),componentInfoObjects:t}))}n.attributes=i,void 0!==n.children&&createAttributesFromProps(n.children,t)}}function componentFromAttribute({attrObj:e,value:t,originalComponentProps:n,componentInfoObjects:r}){if("object"!=typeof t?t={rawString:t.toString()}:null===t&&(t={rawString:""}),e&&e.createComponentOfType){let a,i=t.rawString.trim().toLowerCase();if("true"===i&&void 0!==e.valueForTrue)a={componentType:e.createComponentOfType,state:{value:e.valueForTrue}};else if("false"===i&&void 0!==e.valueForFalse)a={componentType:e.createComponentOfType,state:{value:e.valueForFalse}};else if(r.isInheritedComponentType({inheritedComponentType:e.createComponentOfType,baseComponentType:"boolean"})&&["true","false"].includes(i))a={componentType:e.createComponentOfType,state:{value:"true"===i}};else{let n=t.childrenForComponent;n=n?JSON.parse(JSON.stringify(n)):[t.rawString],a={componentType:e.createComponentOfType,children:n},removeBlankStringChildren([a],r)}if(e.attributesForCreatedComponent||e.copyComponentAttributesForCreatedComponent){if(e.attributesForCreatedComponent?a.props=e.attributesForCreatedComponent:a.props={},e.copyComponentAttributesForCreatedComponent)for(let t of e.copyComponentAttributesForCreatedComponent)n[t]&&(a.props[t]=JSON.parse(JSON.stringify(n[t])));createAttributesFromProps([a],r)}return{component:a}}if(e&&e.createPrimitiveOfType){let n;if("boolean"===e.createPrimitiveOfType){n="true"===t.rawString.trim().toLowerCase()}else n="number"===e.createPrimitiveOfType?Number(t.rawString):"integer"===e.createPrimitiveOfType?Math.round(Number(t.rawString)):t.rawString;return e.validationFunction&&(n=e.validationFunction(n)),{primitive:n}}return t.childrenForComponent||(t.childrenForComponent=[t.rawString]),t}function findPreSugarIndsAndMarkFromSugar(e){let t=[];for(let n of e)if("object"==typeof n)if(void 0!==n.preSugarInd)t.push(n.preSugarInd);else if(n.doenetAttributes||(n.doenetAttributes={}),n.doenetAttributes.createdFromSugar=!0,n.children){let e=findPreSugarIndsAndMarkFromSugar(n.children);t.push(...e)}return t}function applyMacros(e,t){for(let n of e)if(n.children&&applyMacros(n.children,t),n.attributes)for(let e in n.attributes){let r=n.attributes[e];if(r.component){let e=r.component;e.children&&applyMacros(e.children,t)}else r.childrenForComponent&&applyMacros(r.childrenForComponent,t)}substituteMacros(e,t)}function substituteMacros(e,t){for(let n=0;n<e.length;n++){let r=e[n];if("string"==typeof r){let a=0;for(;a<r.length;){let i=r,o=findFirstFullMacroInString(i.slice(a));if(!o.success)break;let s,l=o.firstIndMatched+a,u=o.matchLength,c=o.nDollarSigns;if(o.additionalAttributes){let r,a=`<copy target="${o.targetName}" ${o.additionalAttributes} />`;try{r=parseAndCompile(a)}catch(t){let r=i.slice(l,l+u),a=l;if(n>0&&e[n-1].range){let t=e[n-1].range;t.closeEnd?a+=t.closeEnd:t.selfCloseEnd&&(a+=t.selfCloseBegin)}throw Error(`Error in macro at indices ${a}-${a+u}.  Found: ${r}`)}createAttributesFromProps(r,t),markCreatedFromMacro(r),applyMacros(r,t),s=r}else{let e={target:o.targetName,createdFromMacro:!0};void 0===o.additionalAttributes&&(e.isPlainMacro=!0),s=[{componentType:"copy",doenetAttributes:e}]}let p=1,d=i.substring(l+u);if(2===c){let r=i.slice(l+u).match(/^\s*\(/);if(!r){a=l+2;continue}let o=u+r[0].length,c=[],m=!1;i.length>l+o&&(m=!0,c.push(i.substring(l+o))),c.push(...e.slice(n+1));let f=createEvaluateIfFindMatchedClosingParens({componentsFromMacro:s,remainingComponents:c,includeFirstInRemaining:m,componentInfoObjects:t});if(!f.success){a=l+2;continue}s=f.componentsFromMacro,p=f.lastComponentIndMatched+1,m||p++,d=""}let m=[];l>0&&m.push(i.substring(0,l)),m.push(...s),d.length>0&&m.push(d),e.splice(n,p,...m),l>0&&n++;break}}if("award"===r.componentType&&r.children&&r.attributes.targetsAreResponses){let e=r.attributes.targetsAreResponses.primitive.split(/\s+/).filter((e=>e));for(let t of e)addResponsesToDescendantsWithTarget(r.children,t)}}}function addResponsesToDescendantsWithTarget(e,t){for(let n of e){let e=n.props;if(e||(e=n.doenetAttributes),e)for(let r in e)if("target"===r.toLowerCase()&&e[r]===t){n.attributes||(n.attributes={});let e=Object.keys(n.attributes).map((e=>e.toLowerCase())).includes("isresponse");e||(n.attributes.isResponse=!0)}n.children&&addResponsesToDescendantsWithTarget(n.children,t)}}function findFirstFullMacroInString(e){let t,n=/(\$\$?)(([a-zA-Z_]\w*\b)|\(([a-zA-Z0-9_:.\/\-]+)\s*(\)|{))/,r=0;for(;;){if(t=e.substring(r).match(n),!t)return{success:!1};if(0===t.index||"$"!==e[r+t.index-1])break;r+=t.index+t[0].length}let a=t.index+r,i=t[0].length,o=t[1].length;if(t[3])return{success:!0,firstIndMatched:a,matchLength:i,targetName:t[3],nDollarSigns:o};let s=t[4];if(")"===t[5])return{success:!0,firstIndMatched:a,matchLength:i,targetName:s,nDollarSigns:o};let l=e.substring(a+i),u=findFirstUnmatchedClosingBraceParen(l);if(u.success)return{success:!0,firstIndMatched:a,matchLength:i+u.parenInd+1,targetName:s,nDollarSigns:o,additionalAttributes:l.substring(0,u.braceInd)};{let e=findFirstFullMacroInString(l);return e.success?{success:!0,firstIndMatched:a+i+e.firstIndMatched,matchLength:e.matchLength,targetName:e.targetName,nDollarSigns:e.nDollarSigns,additionalAttributes:e.additionalAttributes}:{success:!1}}}function findFirstUnmatchedClosingBraceParen(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n];if("}"===r){if(0===t){if(")"===e.substring(n+1).trim()[0]){return{success:!0,braceInd:n,parenInd:e.substring(n+1).indexOf(")")+n+1}}return{success:!1}}t--}else"{"===r&&t++}return{success:!1}}function markCreatedFromMacro(e){for(let t of e)t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createdFromMacro=!0,t.children&&markCreatedFromMacro(t.children)}function createEvaluateIfFindMatchedClosingParens({componentsFromMacro:e,remainingComponents:t,includeFirstInRemaining:n,componentInfoObjects:r}){let a=findFirstUnmatchedClosingParens(t);if(!a.success)return a;let i=a.componentInd,o=(t=t.slice(0,i+1))[i],s="";a.charInd+1<o.length&&(s=o.substring(a.charInd+1)),a.charInd>0?t[i]=o.substring(0,a.charInd):t=t.slice(0,i);let l=breakEmbeddedStringByCommas({childrenList:t});l.pieces.forEach((e=>applyMacros(e,r)));let u=l.pieces.map((e=>1===e.length&&"string"!=typeof e[0]?e[0]:{componentType:"math",doenetAttributes:{createdFromMacro:!0},children:e})),c=[{componentType:"evaluate",doenetAttributes:{createdFromMacro:!0},attributes:{function:{component:{componentType:"function",doenetAttributes:{createdFromMacro:!0},children:e}},input:{component:{componentType:"mathList",doenetAttributes:{createdFromMacro:!0},children:u}}}}];return s.length>0&&c.push(s),{success:!0,componentsFromMacro:c,lastComponentIndMatched:i}}function findFirstUnmatchedClosingParens(e){let t=0;for(let[n,r]of e.entries())if("string"==typeof r){let e=r;for(let r=0;r<e.length;r++){let a=e[r];if("("===a)t++;else if(")"===a){if(0===t)return{success:!0,componentInd:n,charInd:r};t--}}}return{success:!1}}function decodeXMLEntities(e){function t(e){return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&dollar;/g,"$").replace(/&amp;/g,"&")}for(let[n,r]of e.entries())if("string"==typeof r)e[n]=t(r);else if(r.children&&decodeXMLEntities(r.children),r.attributes)for(let e in r.attributes){let n=r.attributes[e];n.component?decodeXMLEntities([n.component]):n.primitive?"string"==typeof n.primitive&&(n.primitive=t(n.primitive)):(n.childrenForComponent&&decodeXMLEntities(n.childrenForComponent),n.rawString&&(n.rawString=t(n.rawString)))}}function applySugar({serializedComponents:e,parentParametersFromSugar:t={},parentAttributes:n={},componentInfoObjects:r,parentUniqueId:a="",isAttributeComponent:i=!1}){for(let[o,s]of e.entries()){if("object"!=typeof s)continue;let e=s.componentType,l=r.allComponentClasses[e];if(!l)throw Error(`Unrecognized component type ${e}`);let u=a+"|"+e+o,c={};for(let e in s.attributes){let t=s.attributes[e];void 0!==t.primitive&&(c[e]=t.primitive)}if(s.children){let a={};if(!s.skipSugar)for(let[o,p]of l.returnSugarInstructions().entries()){let l=s.children.map((e=>"string"==typeof e?"s":"n")).join("");if(p.childrenRegex){let e=l.match(p.childrenRegex);if(!e||e[0].length!==s.children.length)continue}let d=deepClone(s.children),m=0;for(let e of d)"string"!=typeof e&&(e.preSugarInd=m,m++);let f=!1;s.doenetAttributes&&s.doenetAttributes.createdFromMacro&&(f=!0);let h=p.replacementFunction({matchedChildren:d,parentParametersFromSugar:t,parentAttributes:n,componentAttributes:c,uniqueId:u+"|sugar"+o,componentInfoObjects:r,isAttributeComponent:i,createdFromMacro:f});if(h.success){let t=h.newChildren,n=h.newAttributes,r=[],i=[];if(t&&(r=findPreSugarIndsAndMarkFromSugar(t)),n)for(let e in n){let t=n[e].component;t&&i.push(...findPreSugarIndsAndMarkFromSugar(t.children))}let o=[...r,...i];if(o.length!==m||!o.sort(((e,t)=>e-t)).every(((e,t)=>e===t)))throw Error(`Invalid sugar for ${e} as didn't return set of original components`);if(r.length>0){let t=[...r].sort(((e,t)=>e-t));if(!t.every(((e,t)=>e===r[t])))throw Error(`Invalid sugar for ${e} as didn't return original components in order`)}h.parametersForChildrenSugar&&Object.assign(a,h.parametersForChildrenSugar),s.children=t||[],n&&(s.attributes||(s.attributes={}),Object.assign(s.attributes,n))}}l.removeBlankStringChildrenPostSugar&&(s.children=s.children.filter((e=>"string"!=typeof e||/\S/.test(e)))),applySugar({serializedComponents:s.children,parentParametersFromSugar:a,parentAttributes:c,componentInfoObjects:r,parentUniqueId:u})}if(s.attributes)for(let e in s.attributes){let t=s.attributes[e];t.component&&applySugar({serializedComponents:[t.component],parentAttributes:c,componentInfoObjects:r,parentUniqueId:u,isAttributeComponent:!0})}}}function breakStringInPiecesBySpacesOrParens(e){if("string"!=typeof e)return{success:!1};let t=0,n=[];e=e.trim();let r=0;for(let a=0;a<e.length;a++){let i=e[a];if("("===i){if(0===t){let t=e.substring(r,a).trim();t.length>0&&n.push(t),r=a}t++}else if(")"===i){if(0===t)return{success:!1};if(1===t){let t=e.substring(r+1,a).trim();if(t.length>0){let e=breakStringInPiecesBySpacesOrParens(t);!0===e.success?n.push(e.pieces):n.push(t)}r=a+1}t--}else if(0===t&&i.match(/\s/)){let t=e.substring(r,a).trim();t.length>0&&n.push(t),r=a}}if(0!==t)return{success:!1};let a=e.substring(r,e.length).trim();return a.length>0&&n.push(a),{success:!0,pieces:n}}function createComponentNames({serializedComponents:e,namespaceStack:t=[],componentInfoObjects:n,parentDoenetAttributes:r={},parentName:a,useOriginalNames:i=!1,doenetAttributesByTargetComponentName:o,indOffset:s=0,createNameContext:l=""}){0===t.length&&t.push({namespace:"",componentCounts:{},namesUsed:{}});let u=t.length-1,c=t[u];for(let[r,p]of e.entries()){if("object"!=typeof p)continue;let e=p.componentType,d=n.allComponentClasses[e],m=p.doenetAttributes;void 0===m&&(m=p.doenetAttributes={});let f=p.attributes;f||(f=p.attributes={});let h,y=m.prescribedName,b=m.assignNames,g=m.target,v=m.isAttributeChild||m.createdFromSugar||m.createdFromMacro||m.createUniqueName;(f.newNamespace?.primitive||i&&p.originalAttributes&&p.originalAttributes.newNamespace)&&(h=!0);let T=void 0!==y,C=p.props;if(void 0===C)C=p.props={};else for(let e in C){let t=e.toLowerCase();if("name"===t){if(void 0!==y)throw Error(`Cannot define name twice.  Found in component of type ${p.componentType}${indexRangeString(p)}`);y=C[e],delete C[e]}else if("assignnames"===t){if(void 0!==b)throw Error(`Cannot define assignNames twice for a component.  Found in component of type ${p.componentType}${indexRangeString(p)}`);{let t=breakStringInPiecesBySpacesOrParens(C[e]);if(!t.success)throw Error(`Invalid format for assignnames.  Found in component of type ${p.componentType}${indexRangeString(p)}`);b=t.pieces,delete C[e]}}else if("target"===t){if(void 0!==g)throw Error(`Cannot define target twice for a component.  Found in component of type ${p.componentType}${indexRangeString(p)}`);if("string"!=typeof C[e])throw Error(`Must specify value for target.  Found in component of type ${p.componentType}${indexRangeString(p)}`);g=C[e].trim(),delete C[e]}}if(y){if(!T&&!m.createdFromSugar){if(!/[a-zA-Z]/.test(y.substring(0,1)))throw Error(`Invalid component name: ${y}.  Component name must begin with a letter.  Found in component of type ${p.componentType}${indexRangeString(p)}`);if(!/^[a-zA-Z0-9_\-]+$/.test(y))throw Error(`Invalid component name: ${y}.  Component name can contain only letters, numbers, hyphens, and underscores.  Found in component of type ${p.componentType}${indexRangeString(p)}`)}m.prescribedName=y}else if(v){let t=a+"|createUniqueName|";p.downstreamDependencies?t+=JSON.stringify(p.downstreamDependencies):t+=r+"|"+s+"|"+l,y=createUniqueName(e.toLowerCase(),t)}if(!b&&i&&p.originalDoenetAttributes&&p.originalDoenetAttributes.assignNames&&(b=p.originalDoenetAttributes.assignNames),b){if(!d.assignNamesToReplacements)throw Error(`Cannot assign names for component type ${p.componentType}${indexRangeString(p)}`);if(m.assignNames=b,!m.createUniqueAssignNames){let e=flattenDeep(b);for(let t of e){if(!/[a-zA-Z]/.test(t.substring(0,1)))throw Error(`All assigned names must begin with a letter.  Found in component of type ${p.componentType}${indexRangeString(p)}`);if(!/^[a-zA-Z0-9_\-]+$/.test(t))throw Error(`Assigned names can contain only letters, numbers, hyphens, and underscores.  Found in component of type ${p.componentType}${indexRangeString(p)}`)}if(e.length!==new Set(e).size)throw Error(`Duplicate assigned names.  Found in component of type ${p.componentType}${indexRangeString(p)}`)}}h&&(f.newNamespace={primitive:h});let N=c.componentCounts[e];void 0===N&&(N=0),m.isAttributeChild||m.createdFromSugar||m.createdFromMacro||(c.componentCounts[e]=++N);let A="";for(let e=0;e<=u;e++)A+=t[e].namespace+"/";if(!y){if(i&&p.originalName){let e=p.originalName.lastIndexOf("/");y=p.originalName.substring(e+1)}y||(y="_"+e.toLowerCase()+N)}if(A+=y,p.componentName=A,y){if(y in c.namesUsed)throw Error(`Duplicate component name ${A}.  Found in component of type ${p.componentType}${indexRangeString(p)}`);c.namesUsed[y]=!0}if(!h&&b)for(let e of flattenDeep(b)){if(e in c.namesUsed)throw Error(`Duplicate component name ${e} (from assignNames of ${A}).  Found in component of type ${p.componentType}${indexRangeString(p)}`);c.namesUsed[e]=!0}if(p.doenetAttributes.createUniqueAssignNames&&p.originalName){let e=p.doenetAttributes.assignNames;e||(e=p.doenetAttributes.originalAssignNames);let n,r=A+"|createUniqueName|assignNames|",a="";if(h)a=A+"/",n=p.originalName+"/";else{for(let e=0;e<=u;e++)a+=t[e].namespace+"/";let e=p.originalName.lastIndexOf("/");n=p.originalName.slice(0,e+1)}let i=createNewAssignNamesAndRenameMatchingTNames({originalAssignNames:e,longNameIdBase:r,namespace:a,oldNamespace:n,doenetAttributesByTargetComponentName:o});b=p.doenetAttributes.assignNames=i}if(renameMatchingTNames(p,o),g){if(!d.acceptTarget)throw Error(`Component type ${e} does not accept a target attribute.   Found in component ${A}${indexRangeString(p)}`);if(g.includes("|"))throw Error(`target cannot include |.  Found in component of type ${p.componentType}${indexRangeString(p)}`);m.target=g,m.targetComponentName=convertComponentTarget({target:g,oldTargetComponentName:m.targetComponentName,namespaceStack:t,acceptDoubleUnderscore:m.createdFromSugar})}if(p.children)if(h){let e={};b&&flattenDeep(b).forEach((t=>e[t]=!0));let r={namespace:y,componentCounts:{},namesUsed:e};t.push(r),createComponentNames({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:n,parentDoenetAttributes:m,parentName:A,useOriginalNames:i,doenetAttributesByTargetComponentName:o}),t.pop()}else createComponentNames({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:n,parentDoenetAttributes:m,parentName:A,useOriginalNames:i,doenetAttributesByTargetComponentName:o});if(p.attributes)for(let e in p.attributes){let r=p.attributes[e];if(r.component){let a=r.component;a.doenetAttributes||(a.doenetAttributes={}),a.doenetAttributes.isAttributeChild=!0,createComponentNames({serializedComponents:[a],namespaceStack:t,componentInfoObjects:n,parentDoenetAttributes:m,parentName:A,useOriginalNames:i,doenetAttributesByTargetComponentName:o,createNameContext:e})}else r.childrenForComponent&&createComponentNames({serializedComponents:r.childrenForComponent,namespaceStack:t,componentInfoObjects:n,parentDoenetAttributes:m,parentName:A,useOriginalNames:i,doenetAttributesByTargetComponentName:o,createNameContext:e})}}return e}function createNewAssignNamesAndRenameMatchingTNames({originalAssignNames:e,longNameIdBase:t,namespace:n,oldNamespace:r,doenetAttributesByTargetComponentName:a}){let i=[];for(let[o,s]of e.entries())if(Array.isArray(s)){let e=createNewAssignNamesAndRenameMatchingTNames({originalAssignNames:s,longNameIdBase:t+o+"_",namespace:n,oldNamespace:r,doenetAttributesByTargetComponentName:a});i.push(e)}else{let e=createUniqueName("fromAssignNames",t+o);i.push(e),renameMatchingTNames({componentName:n+e,originalName:r+s},a,!0)}return i}function convertComponentTarget({target:e,oldTargetComponentName:t,namespaceStack:n,acceptDoubleUnderscore:r}){if(!t&&/__/.test(e)&&!r)throw Error("Invalid reference target: "+e);let a;if("/"===e.substring(0,1))a=e;else{let t=n.length-1;for(;"../"===e.substring(0,3);)e=e.substring(3),t--;t<0&&(t=0),a="";for(let e=0;e<=t;e++)a+=n[e].namespace+"/";a+=e}return a}function serializedComponentsReplacer(e,t){return t!=t?{objectType:"special-numeric",stringValue:"NaN"}:t===1/0?{objectType:"special-numeric",stringValue:"Infinity"}:t===-1/0?{objectType:"special-numeric",stringValue:"-Infinity"}:t}let nanInfinityReviver=function(e,t){if(t&&"special-numeric"===t.objectType){if("NaN"===t.stringValue)return NaN;if("Infinity"===t.stringValue)return 1/0;if("-Infinity"===t.stringValue)return-1/0}return t};function serializedComponentsReviver(e,t){return me$3.reviver(e,theModule.Subset.reviver(e,nanInfinityReviver(e,t)))}function gatherVariantComponents({serializedComponents:e,componentInfoObjects:t}){let n=[];for(let r of e){if(r.variants?.isVariantComponent){n.push(r);continue}if(r.componentType in t.componentTypesCreatingVariants){r.variants={isVariantComponent:!0},n.push(r);continue}if(!r.children)continue;if(r.children.some((e=>"variantControl"===e.componentType))){r.variants={isVariantComponent:!0},n.push(r);continue}let e=gatherVariantComponents({serializedComponents:r.children,componentInfoObjects:t});e.length>0&&(r.variants={descendantVariantComponents:e},n.push(...e))}return n}function getNumberOfVariants({serializedComponent:e,componentInfoObjects:t}){let n;e.variants||(e.variants={});for(let t of e.children)if("variantControl"===t.componentType){n=t;break}if(!n){if("document"===e.componentType){let n=e.children.filter((e=>e.componentType||""!==e.trim()));if(1===n.length&&t.isInheritedComponentType({inheritedComponentType:n[0].componentType,baseComponentType:"_sectioningComponent"})){let r=getNumberOfVariants({serializedComponent:n[0],componentInfoObjects:t});if(r.success)return e.variants.numberOfVariants=r.numberOfVariants,e.variants.variantNames=r.variantNames,e.variants.variantsFromChild=!0,e.variants.numberOfVariantsPreIgnore=r.numberOfVariantsPreIgnore,e.variants.indicesToIgnore=r.indicesToIgnore,r}let r=100,a=100,i=t.allComponentClasses[e.componentType].determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});return i.success&&i.numberOfVariantsPreIgnore<=100&&(a=i.numberOfVariantsPreIgnore,r=i.numberOfVariants,e.variants.uniqueVariants=!0),e.variants.numberOfVariantsPreIgnore=a,e.variants.numberOfVariants=r,e.variants.indicesToIgnore=[],{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:a,indicesToIgnore:[]}}return{success:!1}}let r=n.attributes.nVariants?.primitive;void 0===r&&(r=100);let a=n.attributes.variantNames?.component?.children.map((e=>e.toLowerCase().substring(0,1e3))),i=[];n.attributes.variantIndicesToIgnore&&(i=n.attributes.variantIndicesToIgnore.component.children.map(Number).filter((e=>Number.isInteger(e)&&e>=1&&e<=r)).sort(((e,t)=>e-t)));let o=r;if(!n.attributes.uniqueVariants?.primitive)return i.length>0&&(e.variants.numberOfVariantsPreIgnore=o,e.variants.indicesToIgnore=i,r-=i.length),e.variants.numberOfVariants=r,{success:!0,numberOfVariants:r,variantNames:a,numberOfVariantsPreIgnore:o,indicesToIgnore:i};let s=t.allComponentClasses[e.componentType].determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});return s.success?(o=s.numberOfVariantsPreIgnore,r=s.numberOfVariants,e.variants.uniqueVariants=!0,i=i.filter((e=>e<=o))):(e.variants.numberOfVariantsPreIgnore=o,e.variants.numberOfVariants=r),{success:!0,numberOfVariants:r,variantNames:a,numberOfVariantsPreIgnore:o,indicesToIgnore:i}}function processAssignNames({assignNames:e=[],serializedComponents:t,parentName:n,parentCreatesNewNamespace:r,componentInfoObjects:a,indOffset:i=0,originalNamesAreConsistent:o=!1}){let s=t.length;moveComponentNamesToOriginalNames(t);let l={},u=null;if(o){if(s>0){let e=t.filter((e=>"object"==typeof e))[0];if(e&&e.originalName){let t=e.originalName.lastIndexOf("/");u=e.originalName.substring(0,t)}}if(null!==u)for(let e of t)setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:u,components:[e],doenetAttributesByTargetComponentName:l})}else for(let e=0;e<s;e++){let n=t[e];if("object"==typeof n){if(u=null,s>0&&n.originalName){let e=n.originalName.lastIndexOf("/");u=n.originalName.substring(0,e)}null!==u&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:u,components:[n],doenetAttributesByTargetComponentName:l})}}let c=[],p=0;for(let d=0;d<s;d++){let m=d+i,f=t[d];if("object"!=typeof f){p++,c.push(f);continue}let h=e[m-p];if(f.doenetAttributes||(f.doenetAttributes={}),!o&&(u=null,s>0&&f.originalName)){let e=f.originalName.lastIndexOf("/");u=f.originalName.substring(0,e)}if(a.allComponentClasses[f.componentType].assignNamesSkipOver)h=[h];else if(f.attributes&&f.attributes.assignNamesSkip){let e=f.attributes.assignNamesSkip.primitive;if(e>0)for(let t=0;t<e;t++)h=[h]}if(Array.isArray(h)){if(a.allComponentClasses[f.componentType].assignNamesToReplacements){let e=n+"|assignName|"+m.toString();f.doenetAttributes.prescribedName=createUniqueName(f.componentType.toLowerCase(),e);let t=n;if(!r){let e=n.lastIndexOf("/");t=n.substring(0,e)}t+="/"+f.doenetAttributes.prescribedName,f.componentName=t,f.doenetAttributes.assignNames=h,c.push(f);continue}console.warn(`Cannot assign names recursively to ${f.componentType}`),h=null}if(!h)if(o&&f.originalName&&!f.doenetAttributes?.createUniqueName)h=f.originalName.slice(u.length+1);else{let e=n+"|assignName|"+m.toString();h=createUniqueName(f.componentType.toLowerCase(),e)}f.doenetAttributes.prescribedName=h,o&&!f.doenetAttributes.assignNames&&f.originalDoenetAttributes&&f.originalDoenetAttributes.assignNames&&(f.doenetAttributes.assignNames=f.originalDoenetAttributes.assignNames),createComponentNamesFromParentName({parentName:n,ind:m,component:f,parentCreatesNewNamespace:r,componentInfoObjects:a,doenetAttributesByTargetComponentName:l,originalNamesAreConsistent:o}),c.push(f)}return{serializedComponents:c}}function createComponentNamesFromParentName({parentName:e,component:t,ind:n,parentCreatesNewNamespace:r,componentInfoObjects:a,doenetAttributesByTargetComponentName:i,originalNamesAreConsistent:o}){let s=e.split("/");r||s.pop();let l,u=s.map((e=>({namespace:e,componentCounts:{},namesUsed:{}})));"/"!==e[0]&&u.splice(0,0,{componentCounts:{},namesUsed:{},namespace:""}),t.doenetAttributes||(t.doenetAttributes={}),t.attributes||(t.attributes={}),t.attributes.newNamespace?.primitive||o?l=!0:(l=!1,t.children&&markToCreateAllUniqueNames(t.children));for(let e in t.attributes){let n=t.attributes[e];n.component?markToCreateAllUniqueNames([n.component]):n.childrenForComponent&&markToCreateAllUniqueNames(n.childrenForComponent)}createComponentNames({serializedComponents:[t],namespaceStack:u,componentInfoObjects:a,parentName:e,useOriginalNames:l,doenetAttributesByTargetComponentName:i,indOffset:n})}function setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:e,components:t,doenetAttributesByTargetComponentName:n}){let r=e.length;for(let a of t)if("object"==typeof a){if(a.doenetAttributes&&a.doenetAttributes.target){let t=a.doenetAttributes.targetComponentName;void 0!==t&&(t.substring(0,r)!==e&&(a.doenetAttributes.target=t),n[t]||(n[t]=[]),n[t].push(a.doenetAttributes))}if(a.children&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:e,components:a.children,doenetAttributesByTargetComponentName:n}),a.attributes)for(let t in a.attributes){let r=a.attributes[t];r.component?setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:e,components:[r.component],doenetAttributesByTargetComponentName:n}):r.childrenForComponent&&setTargetsOutsideNamespaceToAbsoluteAndRecordAllTargetComponentNames({namespace:e,components:r.childrenForComponent,doenetAttributesByTargetComponentName:n})}}}function renameMatchingTNames(e,t,n=!1){if(e.originalName&&t&&e.componentName!==e.originalName){if(t[e.originalName])for(let n of t[e.originalName])n.target=e.componentName,n.targetComponentName=e.componentName;if(n){let n=e.originalName+"/",r=n.length;for(let a in t)if(a.substring(0,r)===n){let n=a.substring(r);for(let r of t[a])r.target=e.componentName+"/"+n,r.targetComponentName=e.componentName+"/"+n}}}}function moveComponentNamesToOriginalNames(e){for(let t of e)if(t.componentName&&(t.originalName=t.componentName,delete t.componentName),t.children&&moveComponentNamesToOriginalNames(t.children),t.attributes)for(let e in t.attributes){let n=t.attributes[e];n.component?moveComponentNamesToOriginalNames([n.component]):n.childrenForComponent&&moveComponentNamesToOriginalNames(n.childrenForComponent)}}function markToCreateAllUniqueNames(e){for(let t of e)if("object"==typeof t&&(t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createUniqueName=!0,delete t.doenetAttributes.prescribedName,t.attributes?.newNamespace?.primitive||(t.doenetAttributes.assignNames?(t.doenetAttributes.createUniqueAssignNames=!0,t.doenetAttributes.originalAssignNames=t.doenetAttributes.assignNames,delete t.doenetAttributes.assignNames):t.originalDoenetAttributes&&t.originalDoenetAttributes.assignNames&&(t.doenetAttributes.createUniqueAssignNames=!0,t.doenetAttributes.originalAssignNames=t.originalDoenetAttributes.assignNames),t.children&&markToCreateAllUniqueNames(t.children)),t.attributes))for(let e in t.attributes){let n=t.attributes[e];n.component?markToCreateAllUniqueNames([n.component]):n.childrenForComponent&&markToCreateAllUniqueNames(n.childrenForComponent)}}function setTNamesToAbsolute(e){for(let t of e){if(t.doenetAttributes&&t.doenetAttributes.target){let e=t.doenetAttributes.targetComponentName;void 0!==e&&(t.doenetAttributes.target=e)}if(t.children&&setTNamesToAbsolute(t.children),t.attributes)for(let e in t.attributes){let n=t.attributes[e];n.component?setTNamesToAbsolute([n.component]):n.childrenForComponent&&setTNamesToAbsolute(n.childrenForComponent)}}}function restrictTNamesToNamespace({components:e,namespace:t,parentNamespace:n,parentIsCopy:r=!1}){void 0===n&&(n=t);let a=t.length;for(let i of e){if(i.doenetAttributes&&i.doenetAttributes.target){let e=i.doenetAttributes.target;if("/"===e[0]){if(e.substring(0,a)!==t){let n=t+e.substring(1);i.doenetAttributes.target=n,i.doenetAttributes.targetComponentName=n}}else if("../"===e.substring(0,3)){let r=e,o=n;for(;"../"===r.substring(0,3);){r=r.substring(3);let e=o.substring(0,o.length-1).lastIndexOf("/");if(o=o.substring(0,e+1),o.substring(0,a)!==t){for(;"../"===r.substring(0,3);)r=r.substring(3);let e=t+r;i.doenetAttributes.target=e,i.doenetAttributes.targetComponentName=e;break}}}}if(i.children){let e=t;r&&"externalContent"===i.componentType&&(e=i.componentName+"/");let a=n;i.attributes&&i.attributes.newNamespace?.primitive&&(a=i.componentName),restrictTNamesToNamespace({components:i.children,namespace:e,parentNamespace:a,parentIsCopy:"copy"===i.componentType})}if(i.attributes)for(let e in i.attributes){let r=i.attributes[e];r.component?restrictTNamesToNamespace({components:[r.component],namespace:t,parentNamespace:n}):r.childrenForComponent&&restrictTNamesToNamespace({components:r.childrenForComponent,namespace:t,parentNamespace:n})}}}function indexRangeString(e){let t="";if(e.range){let n,r;void 0!==e.range.selfCloseBegin?(n=e.range.selfCloseBegin,r=e.range.selfCloseEnd):void 0!==e.range.openBegin&&(n=e.range.openBegin,r=e.range.openEnd),void 0!==n&&(t+=` at indices ${n}-${r}`)}return t}function createStateProxyHandler(){return{get:function(e,t){let n=e[t];return void 0!==n&&(n=n.isArray&&(n.public||n.trackChanges)?new Proxy(n.value,createArrayProxyHandler({variable:t,nDimensions:n.nDimensions})):n.value),n},set:function(e,t,n){throw Error("Property "+t+" is read-only")},deleteProperty:function(e,t){throw Error("Property "+t+" is read-only")}}}function createArrayProxyHandler({variable:e,nDimensions:t,indicesSoFar:n=[]}){return{variable:e,nDimensions:t,indicesSoFar:n,get:function(e,n){if("then"===n&&e instanceof Promise)return t=>e.then.bind(e)((e=>t(null!==e&&"object"==typeof e?new Proxy(e,createArrayProxyHandler({variable:this.variable,nDimensions:this.nDimensions,indicesSoFar:this.indicesSoFar})):e)));let r=e[n];return null!==r&&"object"==typeof r&&t>1&&(r=new Proxy(r,createArrayProxyHandler({variable:this.variable,nDimensions:this.nDimensions-1,indicesSoFar:[...this.indicesSoFar,n]}))),r},set:function(e,t,n){throw Error("Property "+t+" is read-only")},deleteProperty:function(e,t){throw Error("Property "+t+" is read-only")}}}function postProcessCopy({serializedComponents:e,componentName:t,addShadowDependencies:n=!0,uniqueIdentifiersUsed:r=[],identifierPrefix:a="",unlinkExternalCopies:i=!1,copiesByTargetComponentName:o={},componentNamesFound:s=[],assignNamesFound:l=[],activeAliases:u=[],init:c=!0}){for(let p in e){let d,m=e[p];if("object"==typeof m){if(m.originalName){if(i){if(s.push(m.originalName),m.originalDoenetAttributes&&m.originalDoenetAttributes.assignNames){let e;if(m.attributes.newNamespace?.primitive)e=m.originalName;else{let t=m.originalName.lastIndexOf("/");e=m.originalName.substring(0,t)}for(let t of m.originalDoenetAttributes.assignNames)s.push(e+"/"+t),l.push(e+"/"+t)}m.attributes&&(m.attributes.alias&&u.push(m.attributes.alias.primitive),m.attributes.indexAlias&&u.push(m.attributes.indexAlias.primitive))}if(d=a+m.originalName+"|shadow",n&&!m.originalNameFromSerializedComponent){let e={[m.originalName]:[{dependencyType:"referenceShadow",compositeName:t}]};if(c&&(e[m.originalName][0].firstLevelReplacement=!0),m.state){let t=Object.keys(m.state);e[m.originalName].downstreamStateVariables=t,e[m.originalName].upstreamStateVariables=t}m.downstreamDependencies=e}}else d=a+m.componentType+"|shadowUnnamed";if("copy"===m.componentType&&i){let e=m.doenetAttributes.targetComponentName;if(e)u.includes(m.doenetAttributes.target)?m.doenetAttributes.targetComponentName=m.doenetAttributes.target:(void 0===o[e]&&(o[e]=[]),o[e].push(m));else if(!m.attributes.uri)throw Error("we need to create a targetComponentName here, then.")}m.uniqueIdentifier=getUniqueIdentifierFromBase(d,r)}}for(let c in e){let p=e[c];if("object"==typeof p){postProcessCopy({serializedComponents:p.children,componentName:t,addShadowDependencies:n,uniqueIdentifiersUsed:r,identifierPrefix:a,unlinkExternalCopies:i,copiesByTargetComponentName:o,componentNamesFound:s,assignNamesFound:l,activeAliases:[...u],init:!1});for(let e in p.attributes){let c=p.attributes[e];c.component&&(c.component=postProcessCopy({serializedComponents:[c.component],componentName:t,addShadowDependencies:n,uniqueIdentifiersUsed:r,identifierPrefix:a,unlinkExternalCopies:i,copiesByTargetComponentName:o,componentNamesFound:s,assignNamesFound:l,activeAliases:[...u],init:!1})[0])}p.replacements&&postProcessCopy({serializedComponents:p.replacements,componentName:t,addShadowDependencies:n,uniqueIdentifiersUsed:r,identifierPrefix:a,unlinkExternalCopies:i,copiesByTargetComponentName:o,componentNamesFound:s,assignNamesFound:l,activeAliases:[...u],init:!1})}}if(c&&i)for(let e in o)if(!s.includes(e)){let t=!1;for(let n of l){let r=n+"/",a=r.length;if(e.substring(0,a)===r){t=!0;break}}if(!t)for(let t of o[e])t.attributes||(t.attributes={}),t.attributes.link={primitive:!1},t.doenetAttributes.target=t.doenetAttributes.targetComponentName}return e}function convertAttributesForComponentType({attributes:e,componentType:t,componentInfoObjects:n,compositeAttributesObj:r={},compositeCreatesNewNamespace:a,flags:i}){let o=n.allComponentClasses[t],s=o.createAttributesObject(),l={};for(let e in s)l[e.toLowerCase()]=e;let u={};for(let t in e){if(t in r&&!r[t].leaveRaw)continue;let i=l[t.toLowerCase()],c=s[i];if(c){if(i in u)throw Error(`Cannot repeat prop ${i}`);if(u[i]=componentFromAttribute({attrObj:c,value:JSON.parse(JSON.stringify(e[t])),componentInfoObjects:n}),u[i].component?.children){let e=[u[i].component];if(applyMacros(e,n),removeBlankStringChildren(e,n),applySugar({serializedComponents:e,componentInfoObjects:n,isAttributeComponent:!0}),a)for(let e of u[i].component.children)if("copy"===e.componentType){let t=e.doenetAttributes.target;/[a-zA-Z_]/.test(t[0])&&(e.doenetAttributes.target="../"+t)}}}else o.acceptAnyAttribute&&(u[t]=JSON.parse(JSON.stringify(e[t])))}return u}function gatherDescendants({ancestor:e,descendantTypes:t,recurseToMatchedChildren:n=!0,useReplacementsForComposites:r=!1,includeNonActiveChildren:a=!1,skipOverAdapters:i=!1,ignoreReplacementsOfMatchedComposites:o=!1,ignoreReplacementsOfEncounteredComposites:s=!1,init:l=!0,componentInfoObjects:u}){let c=e=>t.some((t=>u.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:t}))),p=[];if(r&&u.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"_composite"}))l&&p.push(...replacementsForComposites({composite:e,componentInfoObjects:u,includeComposites:a}).filter((e=>"object"==typeof e)));else for(let t of e.allChildrenOrdered){let n,r=e.allChildren[t],o=!1,s=!1;if(r)n=r.component,n.adaptedFrom&&(s=!0),e.activeChildren.includes(n)&&(o=!0);else for(let r of e.activeChildren){if(r.placeholderInd===t){n=r,o=!0,"string"==typeof t&&"adapt"===t.substring(t.length-5,t.length)&&(s=!0);break}if(r.adaptedFrom&&achild.adaptedFrom.placeholderInd===t){n=r.adaptedFrom;break}}n&&(s&&i?p.includes(n.adaptedFrom)||p.push(n.adaptedFrom):(o||a)&&p.push(n))}if(o||s){let e=[];for(let t of p){let n=c(t);s&&!n&&(n=!("copy"===t.componentType&&"externalContent"===t.replacements?.[0]?.componentType)),n&&u.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"_composite"})&&(e=[...e,...replacementsForComposites({composite:t,componentInfoObjects:u,includeComposites:!0}).filter((e=>"object"==typeof e)).map((e=>e.componentName?e.componentName:e.placeholderInd))])}e.length>0&&(p=p.filter((t=>!(e.includes(t.componentName)||e.includes(t.placeholderInd)))))}let d=[];for(let e of p){let l=c(e);if(l&&d.push({componentName:e.componentName?e.componentName:e.placeholderInd,componentType:e.componentType}),(!l||n)&&void 0===e.placeholderInd){let l=gatherDescendants({ancestor:e,descendantTypes:t,recurseToMatchedChildren:n,useReplacementsForComposites:r,includeNonActiveChildren:a,skipOverAdapters:i,ignoreReplacementsOfMatchedComposites:o,ignoreReplacementsOfEncounteredComposites:s,init:!1,componentInfoObjects:u});d.push(...l)}}return d}function replacementsForComposites({composite:e,includeComposites:t=!1,componentInfoObjects:n}){let r=[];if(e.replacements){let a;if(e.replacementsToWithhold){let t=e.replacements.length-e.replacementsToWithhold;a=e.replacements.slice(0,t)}else a=e.replacements;for(let e of a)n.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"_composite"})?(t&&r.push(e),r.push(...replacementsForComposites({composite:e,componentInfoObjects:n,includeComposites:t}))):r.push(e)}return r}function ancestorsIncludingComposites(e,t){if(void 0===e.ancestors||0===e.ancestors.length)return[];let n=[e.ancestors[0].componentName],r=t[e.ancestors[0].componentName];if(r&&n.push(...ancestorsIncludingComposites(r,t)),e.replacementOf){n.push(e.replacementOf.componentName);let r=ancestorsIncludingComposites(e.replacementOf,t);for(let e of r)n.includes(e)||n.push(e)}return n}const dependencyTypeArray=[];class DependencyHandler{constructor({_components:e,componentInfoObjects:t,core:n}){this.upstreamDependencies={},this.downstreamDependencies={},this.switchDependencies={},this.circularCheckPassed={},this.circularResolveBlockedCheckPassed={},this.dependencyTypes={},dependencyTypeArray.forEach((e=>this.dependencyTypes[e.dependencyType]=e)),this.core=n,this._components=e,this.componentInfoObjects=t,this.updateTriggers={descendantDependenciesByAncestor:{},ancestorDependenciesByPotentialAncestor:{},replacementDependenciesByComposite:{},childDependenciesByParent:{},parentDependenciesByParent:{},dependenciesMissingComponentBySpecifiedName:{},dependenciesBasedOnDependenciesOfStateVariables:{}},this.resolveBlockers={neededToResolve:{},resolveBlockedBy:{}}}async setUpComponentDependencies(e){this.downstreamDependencies[e.componentName]&&this.deleteAllDownstreamDependencies({component:e}),this.downstreamDependencies[e.componentName]={},this.upstreamDependencies[e.componentName]||(this.upstreamDependencies[e.componentName]={});let t=[],n=[];for(let r in e.state)e.state[r].isArrayEntry||e.state[r].isAlias||n.includes(r)||(t.push(r),e.state[r].additionalStateVariablesDefined&&n.push(...e.state[r].additionalStateVariablesDefined));for(let n of t){let t=[n];e.state[n].additionalStateVariablesDefined&&t.push(...e.state[n].additionalStateVariablesDefined),await this.setUpStateVariableDependencies({component:e,stateVariable:n,allStateVariablesAffected:t})}}async setUpStateVariableDependencies({component:e,stateVariable:t,allStateVariablesAffected:n}){let r,a=e.state[t];a.stateVariablesDeterminingDependencies?(r={},a.stateVariablesDeterminingDependencies&&(r.__determine_dependencies={dependencyType:"determineDependencies",variableNames:a.stateVariablesDeterminingDependencies})):r=await a.returnDependencies({componentInfoObjects:this.componentInfoObjects,sharedParameters:e.sharedParameters});for(let a in r){let i=r[a];if(!(i.dependencyType in this.dependencyTypes))throw Error(`Unrecognized dependency type ${i.dependencyType} for ${a} of ${t} of ${e.componentName}`);let o=new this.dependencyTypes[i.dependencyType]({component:e,stateVariable:t,allStateVariablesAffected:n,dependencyName:a,dependencyDefinition:i,dependencyHandler:this,expandComposites:!1,forceExpandComposites:!1});await o.initialize(),o.checkForCircular()}}deleteAllDownstreamDependencies({component:e,stateVariables:t="__all__"}){let n,r=e.componentName;n="__all__"===t?Object.keys(this.downstreamDependencies[r]):t;for(let e of n){let t=this.downstreamDependencies[r][e];for(let e in t)t[e].deleteDependency();delete this.downstreamDependencies[r][e]}0!==Object.keys(this.downstreamDependencies[r]).length||this.components[r]||delete this.downstreamDependencies[r]}async deleteAllUpstreamDependencies({component:e,stateVariables:t="__all__",completelyDelete:n=!1}){let r,a=e.componentName;r="__all__"===t?Object.keys(this.upstreamDependencies[a]):t;for(let e of r){if(this.upstreamDependencies[a][e])for(let t of[...this.upstreamDependencies[a][e]])if(n){for(let e of t.upstreamVariableNames)this._components[t.upstreamComponentName].state[e].initiallyResolved&&await this.core.recordActualChangeInStateVariable({componentName:t.upstreamComponentName,varName:e});t.deleteDependency()}else await t.removeDownstreamComponent({indexToRemove:t.downstreamComponentNames.indexOf(a)});delete this.upstreamDependencies[a][e]}0!==Object.keys(this.upstreamDependencies[a]).length||this._components[a]||delete this.upstreamDependencies[a]}async addBlockersFromChangedStateVariableDependencies({componentName:e,stateVariables:t}){let n=this.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[e];if(n)for(let r of t){let t=n[r];if(t)for(let n of t)if(n.gettingValue){let t=n.varsWithUpdatedDeps[e];t||(t=n.varsWithUpdatedDeps[e]=[]),t.includes(r)||t.push(r)}else for(let e of n.upstreamVariableNames)await this.addBlocker({blockerComponentName:n.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:n.dependencyName,componentNameBlocked:n.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e})}}async addBlockersFromChangedActiveChildren({parent:e}){if(await this.collateCountersAndPropagateToAncestors(e),this.updateTriggers.childDependenciesByParent[e.componentName])for(let t of this.updateTriggers.childDependenciesByParent[e.componentName]){for(let e of t.upstreamVariableNames)await this.addBlocker({blockerComponentName:t.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:t.dependencyName,componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});await this.addBlockersFromChangedStateVariableDependencies({componentName:t.upstreamComponentName,stateVariables:t.upstreamVariableNames})}if(e.ancestors){if(this.updateTriggers.parentDependenciesByParent[e.componentName])for(let t of this.updateTriggers.parentDependenciesByParent[e.componentName]){for(let e of t.upstreamVariableNames)await this.addBlocker({blockerComponentName:t.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:t.dependencyName,componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});await this.addBlockersFromChangedStateVariableDependencies({componentName:t.upstreamComponentName,stateVariables:t.upstreamVariableNames})}for(let t of[e.componentName,...ancestorsIncludingComposites(e,this.components)])await this.addDescendantBlockersToAncestor(t);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[e.componentName])for(let t of this.updateTriggers.ancestorDependenciesByPotentialAncestor[e.componentName]){for(let e of t.upstreamVariableNames)await this.addBlocker({blockerComponentName:t.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:t.dependencyName,componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});await this.addBlockersFromChangedStateVariableDependencies({componentName:t.upstreamComponentName,stateVariables:t.upstreamVariableNames})}}}async resolveBlockersFromChangedActiveChildren(e,t=!1){if(await this.collateCountersAndPropagateToAncestors(e),this.updateTriggers.childDependenciesByParent[e.componentName])for(let n of this.updateTriggers.childDependenciesByParent[e.componentName])await this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:t});if(e.ancestors){if(this.updateTriggers.parentDependenciesByParent[e.componentName])for(let n of this.updateTriggers.parentDependenciesByParent[e.componentName])await this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:t});for(let n of[e.componentName,...ancestorsIncludingComposites(e,this.components)])await this.resolveDescendantBlockersToAncestor(n,t);if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[e.componentName])for(let n of this.updateTriggers.ancestorDependenciesByPotentialAncestor[e.componentName])await this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:t})}}async addDescendantBlockersToAncestor(e){if(this.updateTriggers.descendantDependenciesByAncestor[e])for(let t of this.updateTriggers.descendantDependenciesByAncestor[e]){for(let e of t.upstreamVariableNames)await this.addBlocker({blockerComponentName:t.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:t.dependencyName,componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});await this.addBlockersFromChangedStateVariableDependencies({componentName:t.upstreamComponentName,stateVariables:t.upstreamVariableNames})}}async resolveDescendantBlockersToAncestor(e,t=!1){if(this.updateTriggers.descendantDependenciesByAncestor[e])for(let n of this.updateTriggers.descendantDependenciesByAncestor[e])await this.resolveIfReady({componentName:n.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:n.representativeStateVariable,dependency:n.dependencyName,force:t})}async addBlockersFromChangedReplacements(e){if(this.updateTriggers.replacementDependenciesByComposite[e.componentName])for(let t of this.updateTriggers.replacementDependenciesByComposite[e.componentName])for(let e of t.upstreamVariableNames)await this.addBlocker({blockerComponentName:t.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:t.dependencyName,componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});for(let t of[e.componentName,...ancestorsIncludingComposites(e,this.components)])await this.addDescendantBlockersToAncestor(t)}checkForCircularDependency({componentName:e,varName:t,previouslyVisited:n=[]}){let r=e+":"+t;if(n.includes(r)){console.log("found circular",r,n);let e,t=/^(.*):/,a=n.map((e=>e.match(t)[1])),i=a.filter((e=>"__"!==e.slice(0,2))).reduce(((e,t)=>e.includes(t)?e:[...e,t]),[]);throw 0===i.length&&(i=[a[0]]),1===i.length?e=i[0]:2===i.length?e=i.join(" and "):(i[i.length-2]=i.slice(i.length-2).join(", and "),i.pop(),e=i.join(", ")),Error(`Circular dependency involving ${e}`)}if(n=[...n,r],!this.circularCheckPassed[r]&&(this.circularCheckPassed[r]=!0,e in this.downstreamDependencies)){let r=this.downstreamDependencies[e][t];for(let e in r){let t=r[e],a=t.downstreamComponentNames;if(!a)continue;let i=t.mappedDownstreamVariableNamesByComponent;if(i)for(let[e,t]of a.entries()){let r=i[e];for(let e of r)this.checkForCircularDependency({componentName:t,varName:e,previouslyVisited:n})}}}}resetCircularCheckPassed(e,t){let n=e+":"+t;if(this.circularCheckPassed[n]){delete this.circularCheckPassed[n];let r=this.upstreamDependencies[e][t];if(r)for(let e of r)for(let t of e.upstreamVariableNames)"__identity"!==t&&this.resetCircularCheckPassed(e.upstreamComponentName,t)}}async updateDependencies({componentName:e,stateVariable:t,dependency:n}){let r=this._components[e],a=r.state[t],i=[t];a.additionalStateVariablesDefined&&i.push(...a.additionalStateVariablesDefined);let o,s=this.downstreamDependencies[e][t].__determine_dependencies;if(s){let t=!0;if(s.originalDownstreamVariableNames.length>0)for(let[r,a]of s.downstreamComponentNames.entries()){let o=this._components[a];for(let l of s.mappedDownstreamVariableNamesByComponent[r]){let r=o.state[l].isResolved;if(!r){r=(await this.resolveItem({componentName:a,type:"stateVariable",stateVariable:l})).success}if(!r){t=!1;for(let t of i)await this.addBlocker({blockerComponentName:a,blockerType:"stateVariable",blockerStateVariable:l,componentNameBlocked:e,typeBlocked:"determineDependencies",stateVariableBlocked:t,dependencyBlocked:n})}}}if(!t)return{success:!1};o=await s.getValue()}else o={changes:{},value:{stateValues:{}}};if(0===Object.keys(o.changes).length&&void 0!==a._previousValue)return{success:!0};let l={stateValues:Object.assign({},o.value.stateValues),componentInfoObjects:this.componentInfoObjects,sharedParameters:r.sharedParameters},u=await a.returnDependencies(l);a.stateVariablesDeterminingDependencies&&(u.__determine_dependencies={dependencyType:"determineDependencies",variableNames:a.stateVariablesDeterminingDependencies});let c=await this.replaceDependenciesIfChanged({component:r,stateVariable:t,newDependencies:u,allStateVariablesAffected:i});if(!c.changedDependency&&!l.changedDependency)return{success:!0};for(let e of c.newlyCreatedDependencies)e.checkForCircular();for(let e of i)this.checkForCircularDependency({componentName:r.componentName,varName:e}),r.state[e].forceRecalculation=!0;a.initiallyResolved&&await this.core.markStateVariableAndUpstreamDependentsStale({component:r,varName:t});for(let e of i)r.state[e].initiallyResolved&&this.recordActualChangeInUpstreamDependencies({component:r,varName:e});return await this.addBlockersFromChangedStateVariableDependencies({componentName:e,stateVariables:i}),{success:!0}}async replaceDependenciesIfChanged({component:e,stateVariable:t,newDependencies:n,allStateVariablesAffected:r}){let a=this.downstreamDependencies[e.componentName][t],i=!1,o=[];for(let e in a)e in n||(i=!0,a[e].deleteDependency());for(let s in n)if(s in a){if(!deepCompare(n[s],a[s].definition)){i=!0,a[s].deleteDependency();let l=n[s],u=new this.dependencyTypes[l.dependencyType]({component:e,stateVariable:t,allStateVariablesAffected:r,dependencyName:s,dependencyDefinition:l,dependencyHandler:this});await u.initialize(),o.push(u)}}else{i=!0;let a=n[s],l=new this.dependencyTypes[a.dependencyType]({component:e,stateVariable:t,allStateVariablesAffected:r,dependencyName:s,dependencyDefinition:a,dependencyHandler:this});await l.initialize(),o.push(l)}return{changedDependency:i,newlyCreatedDependencies:o}}async checkForDependenciesOnNewComponent(e){let t=[],n={};if(this.updateTriggers.dependenciesMissingComponentBySpecifiedName[e]){for(let r of this.updateTriggers.dependenciesMissingComponentBySpecifiedName[e]){let a=this._components[r.upstreamComponentName];if(!a)continue;let i=!0;for(let e of r.upstreamVariableNames)if(!(e in a.state)){i=!1;break}if(i){for(let e of r.upstreamVariableNames){a.state[e].initiallyResolved&&(n[r.upstreamComponentName]&&n[r.upstreamComponentName][e]||t.push({componentName:r.upstreamComponentName,varName:e}))}for(let t of r.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:r.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:t,dependencyBlocked:r.dependencyName,blockerComponentName:e,blockerType:"componentIdentity"});if((await this.resolveIfReady({componentName:r.upstreamComponentName,type:"recalculateDownstreamComponents",stateVariable:r.representativeStateVariable,dependency:r.dependencyName,expandComposites:!1,recurseUpstream:!0})).success)for(let e of r.upstreamVariableNames)a.state[e].initiallyResolved||(n[r.upstreamComponentName]||(n[r.upstreamComponentName]={}),n[r.upstreamComponentName][e]=!0);else for(let e of r.upstreamVariableNames)await this.addBlocker({blockerComponentName:r.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:r.dependencyName,componentNameBlocked:r.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e})}}delete this.updateTriggers.dependenciesMissingComponentBySpecifiedName[e]}return t}async getStateVariableDependencyValues({component:e,stateVariable:t}){let n={},r={},a={},i=this.downstreamDependencies[e.componentName][t];for(let e in i){let{value:t,changes:o,usedDefault:s}=await i[e].getValue();n[e]=t,Object.keys(o).length>0&&(r[e]=o),s&&(a[e]=s)}return{dependencyValues:n,changes:r,usedDefault:a}}recordActualChangeInUpstreamDependencies({component:e,varName:t,changes:n}){let r=e.componentName,a=this.upstreamDependencies[r][t];if(a)for(let i of a)if(i.valuesChanged){let a=i.downstreamComponentNames.indexOf(r),o=i.valuesChanged[a][t];if(!o&&e.stateVarAliases)for(let n in e.stateVarAliases)e.stateVarAliases[n]===t&&n in upValuesChangedSub&&(o=upValuesChangedSub[n]);if(!o){if(!e.state[t].isArrayEntry)throw Error(`Something is wrong, as a variable ${t} of ${e.componentName} actually changed, but wasn't marked with a potential change`);o=upValuesChangedSub[t]={changed:{}}}e.state[t]&&e.state[t].isArray?(void 0===o.changed?o.changed={arrayKeysChanged:{}}:!0===o.changed&&(o.changed={allArrayKeysChanged:!0,arraySizeChanged:!0,arrayKeysChanged:{}}),n&&(n.allArrayKeysChanged&&(o.changed.allArrayKeysChanged=!0),n.arraySizeChanged&&(o.changed.arraySizeChanged=!0),Object.assign(o.changed.arrayKeysChanged,n.arrayKeysChanged))):o.changed=!0}}async collateCountersAndPropagateToAncestors(e){let t=Object.keys(e.counters);for(let n of e.allChildrenOrdered){let e=this._components[n];if(e)for(let n in e.counters)t.includes(n)||t.push(n)}let n=!1;for(let r of t){let t=e.counters[r];t||(t=e.counters[r]={dependencies:[],componentList:[]});let a=[];t.dependencies.length>0&&a.push(e.componentName);for(let t of e.allChildrenOrdered){let e=this._components[t];if(e){let t=e.counters[r];t&&a.push(...t.componentList)}}(a.length!==t.componentList.length||t.componentList.some(((e,t)=>e!=a[t])))&&(n=!0,t.componentList=a)}if(!n)return{foundChange:!1};if(!e.ancestors[0]){for(let n of t){let t=e.counters[n];for(let[e,r]of t.componentList.entries()){let t=this._components[r],a=t.counters[n];a.value=e+1;for(let e of a.dependencies)if(t.state[e.representativeStateVariable].initiallyResolved){await this.core.markStateVariableAndUpstreamDependentsStale({component:t,varName:e.representativeStateVariable});for(let n of e.upstreamVariableNames)t.state[n].forceRecalculation=!0,this.recordActualChangeInUpstreamDependencies({component:t,varName:n})}}}return{foundChange:!0,finishedPropagation:!0}}let r=this._components[e.ancestors[0].componentName];if(!r||!r.allChildrenOrdered.includes(e.componentName))return{foundChange:!0,finishedPropagation:!1};let a=await this.collateCountersAndPropagateToAncestors(r);return a.foundChange||console.error(`we found a change in propagating counters for ${e.componentName}, but no change for ancestors!`),{foundChange:!0,finishedPropagation:a.finishedPropagation}}getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r}){let a=this.resolveBlockers.neededToResolve[e];a||(a=this.resolveBlockers.neededToResolve[e]={});let i=a[t];if(i||(i=a[t]={}),n){let e=i;if(i=e[n],i||(i=e[n]={}),r){let e=i;i=e[r],i||(i=e[r]={})}}return i}deleteFromNeededToResolve({componentNameBlocked:e,typeBlocked:t,stateVariableBlocked:n,dependencyBlocked:r,blockerType:a,blockerCode:i,deleteFromReciprocal:o=!0}){let s=e;n&&(s+="|"+n,r&&(s+="|"+r));let l=function(e){if(a){if(e[a])if(i){let n=e[a].indexOf(i);if(-1!==n&&e[a].splice(n,1),0===e[a].length&&delete e[a],o){let[e,n,r]=i.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:e,blockerType:a,blockerStateVariable:n,blockerDependency:r,typeBlocked:t,codeBlocked:s,deleteFromReciprocal:!1})}}else{if(o)for(let n of e[a]){let[e,r,i]=n.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:e,blockerType:a,blockerStateVariable:r,blockerDependency:i,typeBlocked:t,codeBlocked:s,deleteFromReciprocal:!1})}delete e[a]}}else if(o)for(let n in e)for(let r of e[n]){let[e,a,i]=r.split("|");this.deleteFromResolveBlockedBy({blockerComponentName:e,blockerType:n,blockerStateVariable:a,blockerDependency:i,typeBlocked:t,codeBlocked:s,deleteFromReciprocal:!1})}}.bind(this),u=this.resolveBlockers.neededToResolve[e];if(u){let i=u[t];if(i)if(n){let e=i[n];if(e)if(r){let t=e[r];t&&(l(t),a&&0!==Object.keys(t).length||delete e[r]),0===Object.keys(e).length&&delete i[n]}else l(e),a&&0!==Object.keys(e).length||delete i[n];0===Object.keys(i).length&&delete u[t]}else l(i),a&&0!==Object.keys(i).length||delete u[t];0===Object.keys(u).length&&delete this.resolveBlockers.neededToResolve[e]}}checkIfHaveNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r}){let a=this.resolveBlockers.neededToResolve[e];if(!a)return!1;let i=a[t];if(!i)return!1;if(n){if(i=i[n],!i)return!1;if(r){if(i=i[r],!i)return!1}}return Object.keys(i).length>0}getResolveBlockedBy({componentName:e,type:t,stateVariable:n,dependency:r}){let a=this.resolveBlockers.resolveBlockedBy[e];a||(a=this.resolveBlockers.resolveBlockedBy[e]={});let i=a[t];if(i||(i=a[t]={}),n){let e=i;if(i=e[n],i||(i=e[n]={}),r){let e=i;i=e[r],i||(i=e[r]={})}}return i}deleteFromResolveBlockedBy({blockerComponentName:e,blockerType:t,blockerStateVariable:n,blockerDependency:r,typeBlocked:a,codeBlocked:i,deleteFromReciprocal:o=!0}){let s=e;n&&(s+="|"+n,r&&(s+="|"+r));let l=function(e){if(a){if(e[a])if(i){let n=e[a].indexOf(i);if(-1!==n&&e[a].splice(n,1),0===e[a].length&&delete e[a],o){let[e,n,r]=i.split("|");this.deleteFromNeededToResolve({componentNameBlocked:e,typeBlocked:a,stateVariableBlocked:n,dependencyBlocked:r,blockerType:t,blockerCode:s,deleteFromReciprocal:!1})}}else{if(o)for(let n of e[a]){let[e,r,i]=n.split("|");this.deleteFromNeededToResolve({componentNameBlocked:e,typeBlocked:a,stateVariableBlocked:r,dependencyBlocked:i,blockerType:t,blockerCode:s,deleteFromReciprocal:!1})}delete e[a]}}else if(o)for(let n in e)for(let r of e[n]){let[e,a,i]=r.split("|");this.deleteFromNeededToResolve({componentNameBlocked:e,typeBlocked:n,stateVariableBlocked:a,dependencyBlocked:i,blockerType:t,blockerCode:s,deleteFromReciprocal:!1})}}.bind(this),u=this.resolveBlockers.resolveBlockedBy[e];if(u){let i=u[t];if(i)if(n){let e=i[n];if(e)if(r){let t=e[r];t&&(l(t),a&&0!==Object.keys(t).length||delete e[r]),0===Object.keys(e).length&&delete i[n]}else l(e),a&&0!==Object.keys(e).length||delete i[n];0===Object.keys(i).length&&delete u[t]}else l(i),a&&0!==Object.keys(i).length||delete u[t];0===Object.keys(u).length&&delete this.resolveBlockers.resolveBlockedBy[e]}}async addBlocker({blockerComponentName:e,blockerType:t,blockerStateVariable:n,blockerDependency:r,componentNameBlocked:a,typeBlocked:i,stateVariableBlocked:o,dependencyBlocked:s}){let l=e;n&&(l+="|"+n,r&&(l+="|"+r));let u=a;o&&(u+="|"+o,s&&(u+="|"+s));let c=this.getNeededToResolve({componentName:a,type:i,stateVariable:o,dependency:s}),p=c[t];if(p||(p=c[t]=[]),p.includes(l))return;if(p.push(l),"stateVariable"===i){let e=this._components[a];if(e){let t=e.state[o];if(t.isResolved=!1,t.initiallyResolved){await this.core.markStateVariableAndUpstreamDependentsStale({component:e,varName:o});let t=this.upstreamDependencies[a][o];if(t)for(let e of t)if(this._components[e.upstreamComponentName])for(let t of e.upstreamVariableNames)await this.addBlocker({blockerComponentName:a,blockerType:"stateVariable",blockerStateVariable:o,componentNameBlocked:e.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t})}}}let d=this.getResolveBlockedBy({componentName:e,type:t,stateVariable:n,dependency:r}),m=d[i];m||(m=d[i]=[]),m.includes(u)||m.push(u),this.resetCircularResolveBlockerCheckPassed({componentName:a,type:i,stateVariable:o,dependency:s}),this.checkForCircularResolveBlocker({componentName:a,type:i,stateVariable:o,dependency:s})}async processNewlyResolved({componentNameNewlyResolved:e,typeNewlyResolved:t,stateVariableNewlyResolved:n,dependencyNewlyResolved:r,expandComposites:a=!0,force:i=!1,recurseUpstream:o=!1}){if("stateVariable"===t){let t=this._components[e];if(t){t.state[n]&&(t.state[n].isResolved=!0,t.state[n].initiallyResolved=!0)}}else if("componentIdentity"===t){if(!(e in this._components)&&!i)return{success:!1}}else if("recalculateDownstreamComponents"===t){let t;try{t=this.downstreamDependencies[e][n][r]}catch(e){}if(t){let e=await t.recalculateDownstreamComponents({force:i});if(!e.success&&!i)return e;for(let e of t.upstreamVariableNames)this.deleteFromNeededToResolve({componentNameBlocked:t.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e,blockerType:"recalculateDownstreamComponents",blockerCode:t.upstreamComponentName+"|"+e+"|"+r});for(let e of t.upstreamVariableNames)await this.resolveIfReady({componentName:t.upstreamComponentName,type:"stateVariable",stateVariable:e,expandComposites:a,force:i,recurseUpstream:o});return{success:!0}}}else if("determineDependencies"===t){let t;try{t=this.downstreamDependencies[e][n][r]}catch(e){}if(t){let s=this.getNeededToResolve({componentName:e,type:"stateVariable",stateVariable:n}),l=!1,u=[];if(s.determineDependencies)for(let t of s.determineDependencies){let[r,a,i]=t.split("|");if(this.checkIfHaveNeededToResolve({componentName:e,type:"determineDependency",stateVariable:n,dependency:i})){l=!0;break}u.push(i)}if(l)return{success:!0};if(!(await this.updateDependencies({componentName:e,stateVariable:n,dependency:r})).success)return{success:!1};for(let n of t.upstreamVariableNames){for(let e of u)this.deleteFromResolveBlockedBy({blockerComponentName:t.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:n,blockerDependency:e});await this.resolveIfReady({componentName:e,type:"stateVariable",stateVariable:n,expandComposites:a,force:i,recurseUpstream:o})}return{success:!0}}}else if("childMatches"===t){let t=this._components[e];if(t&&!t.childrenMatched){if(!(await this.core.deriveChildResultsFromDefiningChildren({parent:t,expandComposites:a,forceExpandComposites:i})).skipping&&!t.childrenMatchedWithPlaceholders&&!i)return{success:!1}}}else{if("expandComposite"!==t)throw Error(`Unrecognized type newly resolved: ${t}`);if(!this._components[e].isExpanded){if(this.core.updateInfo.compositesBeingExpanded.includes(e))return{success:!1};await this.core.expandCompositeComponent(this._components[e])}}let s=this.getResolveBlockedBy({componentName:e,type:t,stateVariable:n,dependency:r});s=Object.assign({},s);for(let l in s)for(let u of[...s[l]])if(this.deleteFromResolveBlockedBy({blockerComponentName:e,blockerType:t,blockerStateVariable:n,blockerDependency:r,typeBlocked:l,codeBlocked:u}),o){let[e,t,n]=u.split("|");await this.resolveIfReady({componentName:e,type:l,stateVariable:t,dependency:n,expandComposites:a,force:i,recurseUpstream:o})}return{success:!0}}async resolveStateVariablesIfReady({component:e,stateVariables:t}){let n=e.componentName;t||(await this.resolveIfReady({componentName:n,type:"componentIdentity",expandComposites:!1}),t=Object.keys(e.state));for(let r of t){let t=e.state[r];if(t&&t.determineDependenciesImmediately){let e=this.getNeededToResolve({componentName:n,type:"stateVariable",stateVariable:r}).determineDependencies;if(e)for(let t of e){let[e,n,r]=t.split("|");await this.resolveIfReady({componentName:e,type:"determineDependencies",stateVariable:n,dependency:r,expandComposites:!0})}}await this.resolveIfReady({componentName:n,type:"stateVariable",stateVariable:r,expandComposites:!1})}}async resolveIfReady({componentName:e,type:t,stateVariable:n,dependency:r,expandComposites:a=!0,force:i=!1,recurseUpstream:o=!1}){return this.checkIfHaveNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r})?{success:!1}:(this.deleteFromNeededToResolve({componentNameBlocked:e,typeBlocked:t,stateVariableBlocked:n,dependencyBlocked:r}),await this.processNewlyResolved({componentNameNewlyResolved:e,typeNewlyResolved:t,stateVariableNewlyResolved:n,dependencyNewlyResolved:r,expandComposites:a,force:i,recurseUpstream:o}))}async resolveItem({componentName:e,type:t,stateVariable:n,dependency:r,force:a=!1,recurseUpstream:i=!1,expandComposites:o=!0,numPreviouslyNeeded:s}){let l,u=this.getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r}),c=u.determineDependencies;if(c&&c.length>0)for(let e of[...c]){let[t,n,r]=e.split("|"),i=await this.resolveItem({componentName:t,type:"determineDependencies",stateVariable:n,dependency:r,force:a,expandComposites:o});if(!i.success)return i}"stateVariable"===t&&this._components[e]&&(l=this._components[e].state[n],l&&(l.currentlyResolving=!0));let p=1/0,d=1/0;for(;(Object.keys(u).length>0||d>0)&&!(Number.isFinite(d)&&d>=p);){d>0&&(u=this.getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r})),p=d,d=0;for(let i in u){if("determineDependencies"===i)throw Error(`Shouldn't have determine dependencies blocker after determining dependencies: ${e}, ${t}, ${n}, ${r}`);for(let e of[...u[i]]){let[t,n,r]=e.split("|"),s=await this.resolveItem({componentName:t,type:i,stateVariable:n,dependency:r,expandComposites:o});if(!s.success){if(!a)return s;d++}}}}if(d>0)for(u=this.getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r});Object.keys(u).length>0;)for(let i in u){if("determineDependencies"===i)throw Error(`Shouldn't have determine dependencies blocker after determining dependencies: ${e}, ${t}, ${n}, ${r}`);for(let e of[...u[i]]){let[t,n,r]=e.split("|"),s=await this.resolveItem({componentName:t,type:i,stateVariable:n,dependency:r,force:a,expandComposites:o});if(!s.success)return s}}l&&(l.currentlyResolving=!1);let m=await this.resolveIfReady({componentName:e,type:t,stateVariable:n,dependency:r,force:a,recurseUpstream:i,expandComposites:o});if(!m.success){let l=this.getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r}),u=Object.keys(l).length;u>0&&(void 0===s||u<s)&&(m=await this.resolveItem({componentName:e,type:t,stateVariable:n,dependency:r,force:a,recurseUpstream:i,expandComposites:o,numPreviouslyNeeded:u}))}return m}checkForCircularResolveBlocker({componentName:e,type:t,stateVariable:n,dependency:r,previouslyVisited:a=[]}){let i=e;n&&(i+="|"+n,r&&(i+="|"+r));let o=i+"|"+t;if(a.includes(o)){console.log("found circular",o,a);let e,t=/^([^\|]*)\|/,n=a.map((e=>e.match(t)[1])),r=n.filter((e=>"__"!==e.slice(0,2))).reduce(((e,t)=>e.includes(t)?e:[...e,t]),[]);0===r.length&&(r=[n[0]]),1===r.length?e=r[0]:2===r.length?e=r.join(" and "):(r[r.length-2]=r.slice(r.length-2).join(", and "),r.pop(),e=r.join(", "));let i=[],s=[];for(let e of a){let[t,n]=e.split("|"),r=this._components[t];if(r){this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"_composite"})&&!r.attributes.createComponentOfType?.primitive&&("readyToExpandWhenResolved"===n?i.push(t):n===r.constructor.stateVariableToEvaluateAfterReplacements&&s.push(t))}}let l=!1;for(let e of i)if(s.includes(e)){l=!0;break}let u=`Circular dependency involving ${e}.`;throw l&&(u+="  Specifying the type of a composite component may address this circular dependency."),Error(u)}if(a=[...a,o],!this.circularResolveBlockedCheckPassed[o]){this.circularResolveBlockedCheckPassed[o]=!0;let i=this.getNeededToResolve({componentName:e,type:t,stateVariable:n,dependency:r});for(let e in i)for(let t of i[e]){let[n,r,i]=t.split("|");this.checkForCircularResolveBlocker({componentName:n,type:e,stateVariable:r,dependency:i,previouslyVisited:a})}}}resetCircularResolveBlockerCheckPassed({componentName:e,type:t,stateVariable:n,dependency:r}){let a=e;n&&(a+="|"+n,r&&(a+="|"+r));let i=a+"|"+t;if(this.circularResolveBlockedCheckPassed[i]){delete this.circularResolveBlockedCheckPassed[i];let a=this.getResolveBlockedBy({componentName:e,type:t,stateVariable:n,dependency:r});for(let e in a)for(let t of a[e]){let[n,r,a]=t.split("|");this.resetCircularResolveBlockerCheckPassed({componentName:n,type:e,stateVariable:r,dependency:a})}}}get components(){return this._components}set components(e){return null}}class Dependency{constructor({component:e,stateVariable:t,allStateVariablesAffected:n,dependencyName:r,dependencyDefinition:a,dependencyHandler:i}){this.dependencyName=r,this.dependencyHandler=i,this.upstreamComponentName=e.componentName,this.upstreamVariableNames=n,this.definition=Object.assign({},a),this.representativeStateVariable=t,a.doNotProxy&&(this.doNotProxy=!0),a.variablesOptional&&(this.variablesOptional=!0),a.publicStateVariablesOnly&&(this.publicStateVariablesOnly=!0),a.caseInsensitiveVariableMatch&&(this.caseInsensitiveVariableMatch=!0),a.useMappedVariableNames&&(this.useMappedVariableNames=!0),Number.isInteger(a.propIndex)&&(this.propIndex=a.propIndex),this.returnSingleVariableValue=!1,this.returnSingleComponent=!1,this.originalDownstreamVariableNames=[]}static dependencyType="_base";downstreamVariableNameIfNoVariables="__identity";static get rendererType(){return this.componentType}get dependencyType(){return this.constructor.dependencyType}setUpParameters(){}async determineDownstreamComponents(){return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}async initialize(){this.setUpParameters();let e=await this.determineDownstreamComponents(),t=e.downstreamComponentNames,n=e.downstreamComponentTypes;this.componentIdentitiesChanged=!0;let r=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];r||(r=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName]={});for(let e of this.upstreamVariableNames)r[e]||(r[e]={}),r[e][this.dependencyName]=this;0!==this.originalDownstreamVariableNames.length||this.originalVariablesByComponent?(this.mappedDownstreamVariableNamesByComponent=[],this.valuesChanged=[]):(delete this.mappedDownstreamVariableNamesByComponent,delete this.upValuesChanged),this.downstreamComponentNames=[],this.downstreamComponentTypes=[];for(let[e,r]of t.entries())await this.addDownstreamComponent({downstreamComponentName:r,downstreamComponentType:n[e],index:e})}async addDownstreamComponent({downstreamComponentName:e,downstreamComponentType:t,index:n}){this.componentIdentitiesChanged=!0,this.downstreamComponentNames.splice(n,0,e),this.downstreamComponentTypes.splice(n,0,t);let r=this.dependencyHandler._components[e];if(r){let t;t=this.originalVariablesByComponent?this.originalDownstreamVariableNamesByComponent[n]:this.originalDownstreamVariableNames,this.caseInsensitiveVariableMatch&&(t=this.dependencyHandler.core.findCaseInsensitiveMatches({stateVariables:t,componentClass:r.constructor})),this.publicStateVariablesOnly&&(t=this.dependencyHandler.core.matchPublicStateVariables({stateVariables:t,componentClass:r.constructor}));let a=this.dependencyHandler.core.substituteAliases({stateVariables:t,componentClass:r.constructor});this.constructor.convertToArraySize&&(a=a.map((function(e){let t=r.state[e];if(t)return t.arraySizeStateVariable?t.arraySizeStateVariable:`__${e}_is_not_an_array`;if(r.arrayEntryPrefixes){let t=Object.keys(r.arrayEntryPrefixes).sort(((e,t)=>t.length-e.length));for(let n of t)if(e.substring(0,n.length)===n){let t=r.arrayEntryPrefixes[n],a=r.state[t];if(a.getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:e.substring(n.length),nDimensions:a.nDimensions}).length>0)return r.state[t].arraySizeStateVariable}}return`__${e}_is_not_an_array`}))),void 0!==this.propIndex&&(a=await this.dependencyHandler.core.arrayEntryNamesFromPropIndex({stateVariables:a,component:r,propIndex:this.propIndex}));let i=a;if(t.length>0||this.originalVariablesByComponent){this.mappedDownstreamVariableNamesByComponent.splice(n,0,a);let t={};for(let e of a)t[e]={changed:!0};this.valuesChanged.splice(n,0,t),this.variablesOptional&&(i=i.filter((e=>e in r.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:e,component:r}))));for(let t of i)if(r.state[t]||await this.dependencyHandler.core.createFromArrayEntry({component:r,stateVariable:t}),!r.state[t].isResolved)for(let n of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"stateVariable",blockerStateVariable:t,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:n}),"determineDependencies"===this.dependencyType&&await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"stateVariable",blockerStateVariable:t,componentNameBlocked:this.upstreamComponentName,typeBlocked:"determineDependencies",stateVariableBlocked:n,dependencyBlocked:this.dependencyName})}0===i.length&&(i=[this.downstreamVariableNameIfNoVariables]);let o=this.dependencyHandler.upstreamDependencies[e];o||(o=this.dependencyHandler.upstreamDependencies[e]={});for(let e of i)if(void 0===o[e]&&(o[e]=[]),o[e].push(this),e!==this.downstreamVariableNameIfNoVariables)for(let e of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,e)}for(let e of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[e].initiallyResolved&&await this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:e})}async removeDownstreamComponent({indexToRemove:e,recordChange:t=!0}){t&&(this.componentIdentitiesChanged=!0);let n=this.downstreamComponentNames[e];if(this.downstreamComponentNames.splice(e,1),this.downstreamComponentTypes.splice(e,1),n in this.dependencyHandler._components){let t;this.mappedDownstreamVariableNamesByComponent?(t=this.mappedDownstreamVariableNamesByComponent[e],this.mappedDownstreamVariableNamesByComponent.splice(e,1),this.valuesChanged.splice(e,1),this.variablesOptional&&t.push(this.downstreamVariableNameIfNoVariables)):t=[this.downstreamVariableNameIfNoVariables];for(let e of t){let t=this.dependencyHandler.upstreamDependencies[n][e];if(t){let r=t.indexOf(this);-1!==r&&(1===t.length?delete this.dependencyHandler.upstreamDependencies[n][e]:t.splice(r,1))}if(e!==this.downstreamVariableNameIfNoVariables)for(let e of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,e)}}if(t)for(let e of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[e].initiallyResolved&&await this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:e})}async swapDownstreamComponents(e,t){this.componentIdentitiesChanged=!0,[this.downstreamComponentNames[e],this.downstreamComponentNames[t]]=[this.downstreamComponentNames[t],this.downstreamComponentNames[e]],[this.downstreamComponentTypes[e],this.downstreamComponentTypes[t]]=[this.downstreamComponentTypes[t],this.downstreamComponentTypes[e]],(this.originalDownstreamVariableNames.length>0||this.originalVariablesByComponent)&&([this.mappedDownstreamVariableNamesByComponent[e],this.mappedDownstreamVariableNamesByComponent[t]]=[this.mappedDownstreamVariableNamesByComponent[t],this.mappedDownstreamVariableNamesByComponent[e]],[this.valuesChanged[e],this.valuesChanged[t]]=[this.valuesChanged[t],this.valuesChanged[e]]);for(let e of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[e].initiallyResolved&&await this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:e})}deleteDependency(){let e=[];if(this.mappedDownstreamVariableNamesByComponent){if(e=this.mappedDownstreamVariableNamesByComponent,this.variablesOptional){let t=[];for(let[n,r]of this.downstreamComponentNames.entries()){let a=[];for(let t of e[n])this.dependencyHandler.components[r].state[t]&&a.push(t);a.length>0?t.push(a):t.push([this.downstreamVariableNameIfNoVariables])}e=t}}else e=Array(this.downstreamComponentNames.length).fill([this.downstreamVariableNameIfNoVariables]);for(let[t,n]of this.downstreamComponentNames.entries())for(let r of e[t]){let e=this.dependencyHandler.upstreamDependencies[n][r];if(e){let t=e.indexOf(this);-1!==t&&(1===e.length?delete this.dependencyHandler.upstreamDependencies[n][r]:e.splice(t,1))}for(let e of this.upstreamVariableNames)this.dependencyHandler.deleteFromNeededToResolve({componentNameBlocked:this.componentName,typeBlocked:"stateVariable",stateVariableBlocked:e,blockerType:"stateVariable",blockerCode:n+"|"+r});if(r!==this.downstreamVariableNameIfNoVariables)for(let e of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,e)}this.deleteFromUpdateTriggers();let t=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];for(let e of this.upstreamVariableNames)delete t[e][this.dependencyName]}deleteFromUpdateTriggers(){}async getValue({verbose:e=!1,skipProxy:t=!1}={}){let n=[],r={},a=[];this.componentIdentitiesChanged&&(r.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1);for(let[e,t]of this.downstreamComponentNames.entries()){let i=this.dependencyHandler._components[t];if(a[e]=!1,i){let o,s={componentType:i.componentType};if(this.skipComponentNames||(s.componentName=t),o=this.originalVariablesByComponent?this.originalDownstreamVariableNamesByComponent[e]:this.originalDownstreamVariableNames,o.length>0){s.stateValues={};let t={},n=!1;for(let[a,l]of o.entries()){let o=this.mappedDownstreamVariableNamesByComponent[e][a],u=this.useMappedVariableNames?o:l;if(!this.variablesOptional||o in i.state){let a=i.state[o];if(!a.deferred)if(s.stateValues[u]=await a.value,this.valuesChanged[e][o].changed&&(r.valuesChanged||(r.valuesChanged={}),r.valuesChanged[e]||(r.valuesChanged[e]={}),r.valuesChanged[e][u]=this.valuesChanged[e][o]),this.valuesChanged[e][o]={},a.usedDefault)t[u]=!0,n=!0;else if(a.isArrayEntry&&1===a.arrayKeys.length){i.state[a.arrayStateVariable].usedDefaultByArrayKey[a.arrayKeys[0]]&&(t[u]=!0,n=!0)}}}n&&(a[e]=t)}n.push(s)}else n.push({componentType:this.downstreamComponentTypes[e]})}if(!e)if(this.returnSingleVariableValue)if(1===n.length){n=n[0],r.valuesChanged&&r.valuesChanged[0]?r.valuesChanged=r.valuesChanged[0]:delete r.valuesChanged,a=a[0];let e=Object.keys(n.stateValues);if(1===e.length){let t=e[0];n=n.stateValues[t],r.valuesChanged&&r.valuesChanged[t]&&(r.valuesChanged=r.valuesChanged[t]),a&&(a=a[t])}else n=null,r.valuesChanged={},a=!1}else n=null,r.valuesChanged={},a=!1;else this.returnSingleComponent&&(1===n.length?(n=n[0],r.valuesChanged&&r.valuesChanged[0]?r.valuesChanged=r.valuesChanged[0]:delete r.valuesChanged,a=a[0]):(n=null,a=!1));return{value:n,changes:r,usedDefault:a}}checkForCircular(){for(let e of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,e);for(let e of this.upstreamVariableNames)this.dependencyHandler.checkForCircularDependency({componentName:this.upstreamComponentName,varName:e})}async recalculateDownstreamComponents({force:e=!1}={}){let t=await this.determineDownstreamComponents({force:e}),n=t.downstreamComponentNames,r=n.length!==this.downstreamComponentNames.length||this.downstreamComponentNames.some(((e,t)=>e!=n[t]));if(r){this.componentIdentitiesChanged=!0;let e=0;for(let[t,r]of[...this.downstreamComponentNames].entries())n.includes(r)||(await this.removeDownstreamComponent({indexToRemove:t-e}),e++);for(let[e,r]of n.entries()){let n=this.downstreamComponentNames.indexOf(r);-1!==n?n!==e&&await this.swapDownstreamComponents(n,e):await this.addDownstreamComponent({downstreamComponentName:r,downstreamComponentType:t.downstreamComponentTypes[e],index:e})}}if(this.originalVariablesByComponent)for(let[e,n]of[...this.downstreamComponentNames].entries())(this.mappedDownstreamVariableNamesByComponent[e].length!==this.originalDownstreamVariableNamesByComponent[e].length||this.mappedDownstreamVariableNamesByComponent[e].some(((t,n)=>this.originalDownstreamVariableNamesByComponent[e][n]!==t)))&&(await this.removeDownstreamComponent({indexToRemove:e}),await this.addDownstreamComponent({downstreamComponentName:n,downstreamComponentType:t.downstreamComponentTypes[e],index:e}));return{success:t.success}}}class StateVariableDependency extends Dependency{static dependencyType="stateVariable";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,void 0===this.definition.variableName)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.returnAsComponentObject?this.returnSingleComponent=!0:this.returnSingleVariableValue=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(StateVariableDependency);class MultipleStateVariablesDependency extends Dependency{static dependencyType="multipleStateVariables";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,void 0===this.definition.variableNames)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.originalDownstreamVariableNames=this.definition.variableNames,this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(MultipleStateVariablesDependency);class StateVariableComponentTypeDependency extends StateVariableDependency{static dependencyType="stateVariableComponentType";async getValue({verbose:e=!1}={}){let t=[],n={};if(this.staticValue)t=[this.staticValue];else if(this.componentIdentitiesChanged&&(n.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),1===this.downstreamComponentNames.length){let e=this.downstreamComponentNames[0],r=this.dependencyHandler.components[e],a={componentName:r.componentName,componentType:r.componentType,stateValues:{}},i=this.originalDownstreamVariableNames[0],o=this.mappedDownstreamVariableNamesByComponent[0][0],s=this.useMappedVariableNames?o:i;if((!this.variablesOptional||o in r.state)&&!r.state[o].deferred){let e=r.state[o];if(await e.value,a.stateValues[s]=e.componentType,e.isArray&&e.wrappingComponents?.length>0){let t=e.wrappingComponents[e.wrappingComponents.length-1][0];"object"==typeof t&&(t=t.componentType),a.stateValues[s]=t}this.valuesChanged[0][o].changed&&(n.valuesChanged||(n.valuesChanged={}),n.valuesChanged[0]||(n.valuesChanged[0]={}),n.valuesChanged[0][s]=this.valuesChanged[0][o]),this.valuesChanged[0][o]={};let t=e.shadowingInstructions?.hasVariableComponentType;if(!t&&e.isArrayEntry){t=r.state[e.arrayStateVariable].shadowingInstructions?.hasVariableComponentType}t||(this.staticValue=a,await this.removeDownstreamComponent({indexToRemove:0,recordChange:!1}))}t=[a]}if(!e)if(this.returnSingleVariableValue)if(1===t.length){t=t[0];let e=Object.keys(t.stateValues);n.valuesChanged&&n.valuesChanged[0]&&n.valuesChanged[0][0]&&(n.valuesChanged=n.valuesChanged[0][0]),t=1===e.length?t.stateValues[e[0]]:null}else t=null;else this.returnSingleComponent&&(1===t.length?(t=t[0],n.valuesChanged&&n.valuesChanged[0]&&(n.valuesChanged=n.valuesChanged[0])):t=null);return{value:t,changes:n,usedDefault:!1}}}dependencyTypeArray.push(StateVariableComponentTypeDependency);class StateVariableArraySizeDependency extends StateVariableDependency{static dependencyType="stateVariableArraySize";static convertToArraySize=!0}dependencyTypeArray.push(StateVariableArraySizeDependency);class RecursiveDependencyValuesDependency extends Dependency{static dependencyType="recursiveDependencyValues";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,void 0===this.definition.variableNames)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.startingVariableNames=this.definition.variableNames,this.originalVariablesByComponent=!0,this.includeImmediateValueWithValue=this.definition.includeImmediateValueWithValue,this.includeRawValueWithImmediateValue=this.definition.includeRawValueWithImmediateValue,this.includeOnlyEssentialValues=this.definition.includeOnlyEssentialValues,this.variablesOptional=!0}async determineDownstreamComponents({force:e=!1}={}){this.missingComponents=[],this.originalDownstreamVariableNamesByComponent=[];let t=await this.getRecursiveDependencyVariables({componentName:this.componentName,variableNames:this.startingVariableNames,force:e});if(!t.success)return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]};let n=[],r=[];for(let e in t.components)if(this.includeOnlyEssentialValues){let a=[],i=this.dependencyHandler._components[e];for(let n of t.components[e].variableNames)(i.state[n]?.hasEssential||i.state[n]?.isArrayEntry&&i.state[i.state[n].arrayStateVariable].hasEssential)&&a.push(n);a.length>0&&(n.push(e),r.push(t.components[e].componentType),this.originalDownstreamVariableNamesByComponent.push(a))}else n.push(e),r.push(t.components[e].componentType),this.originalDownstreamVariableNamesByComponent.push(t.components[e].variableNames);return{success:!0,downstreamComponentNames:n,downstreamComponentTypes:r}}async getRecursiveDependencyVariables({componentName:e,variableNames:t,force:n,components:r={}}){let a=this.dependencyHandler._components[e];if(!a){if(!this.missingComponents.includes(e)){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e];t||(t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e]=[]),t.includes(this)||t.push(this)}for(let t of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:t,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t});return{success:!1}}this.includeImmediateValueWithValue&&t.includes("value")&&!t.includes("immediateValue")&&"immediateValue"in a.state&&(t=[...t,"immediateValue"]),this.includeRawValueWithImmediateValue&&t.includes("immediateValue")&&!t.includes("rawRendererValue")&&"rawRendererValue"in a.state&&(t=[...t,"rawRendererValue"]);let i=r[e];i||(i=r[e]={componentName:e,componentType:a.componentType,variableNames:[]});let o=this.dependencyHandler.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[e];o||(o=this.dependencyHandler.updateTriggers.dependenciesBasedOnDependenciesOfStateVariables[e]={});for(let s of t)if(!i.variableNames.includes(s)){i.variableNames.push(s);let t=o[s];t||(t=o[s]=[]),t.includes(this)||t.push(this);let l=a.state[s];if(l){if(!l.isResolved){if(!n){for(let t of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"stateVariable",blockerStateVariable:s,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:t,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t});return{success:!1}}await l.value}let t=this.dependencyHandler.downstreamDependencies[a.componentName][s];for(let e in t){let a=t[e];for(let[e,t]of a.downstreamComponentNames.entries()){let i=[];if((a.originalDownstreamVariableNames.length>0||a.originalVariablesByComponent)&&(i=a.mappedDownstreamVariableNamesByComponent[e]),!(await this.getRecursiveDependencyVariables({componentName:t,variableNames:i,force:n,components:r})).success)return{success:!1}}}}}return{success:!0,components:r}}async getValue(){let e;this.gettingValue=!0,this.varsWithUpdatedDeps={};let t={},n=!0,r={};for(;n;){if(n=!1,e=await super.getValue(),e.changes.valuesChanged)if(r.valuesChanged)for(let t in e.changes.valuesChanged){let n=e.changes.valuesChanged[t];if(r.valuesChanged[t])for(let e in n)r.valuesChanged[t][e]=n[e];else r.valuesChanged[t]=n}else r.valuesChanged=e.changes.valuesChanged;for(let e in this.varsWithUpdatedDeps){let r=t[e];r||(r=t[e]=[]);for(let t of this.varsWithUpdatedDeps[e])r.includes(t)||(r.push(t),n=!0)}n&&await this.recalculateDownstreamComponents()}return this.gettingValue=!1,e.changes=r,e}deleteFromUpdateTriggers(){for(let e of this.missingComponents){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}}}dependencyTypeArray.push(RecursiveDependencyValuesDependency);class ComponentIdentityDependency extends Dependency{static dependencyType="componentIdentity";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(ComponentIdentityDependency);class AttributeComponentDependency extends Dependency{static dependencyType="attributeComponent";setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.attributeName=this.definition.attributeName,this.fallBackToAttributeFromShadowTarget=!0,void 0!==this.definition.fallBackToAttributeFromShadowTarget&&(this.fallBackToAttributeFromShadowTarget=this.definition.fallBackToAttributeFromShadowTarget),this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.parentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let t=e.attributes[this.attributeName];if(t?.component)return{success:!0,downstreamComponentNames:[t.component.componentName],downstreamComponentTypes:[t.component.componentType]};if(this.fallBackToAttributeFromShadowTarget){let n=e;for(;n.shadows;){let e=n.shadows.propVariable;if(n=this.dependencyHandler._components[n.shadows.componentName],!n)break;if(e&&!n.state[e]?.shadowingInstructions?.attributeComponentsToShadow?.includes(this.attributeName))break;if(t=n.attributes[this.attributeName],t?.component)return{success:!0,downstreamComponentNames:[t.component.componentName],downstreamComponentTypes:[t.component.componentType]}}}return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(AttributeComponentDependency);class ChildDependency extends Dependency{static dependencyType="child";setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];if(this.childGroups=this.definition.childGroups,!Array.isArray(this.childGroups))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childGroups must be an array`);void 0!==this.definition.childIndices&&(this.childIndices=this.definition.childIndices.map((e=>Number(e)))),this.skipComponentNames=this.definition.skipComponentNames,this.skipPlaceholders=this.definition.skipPlaceholders,this.proceedIfAllChildrenNotMatched=this.definition.proceedIfAllChildrenNotMatched}async determineDownstreamComponents(){this.downstreamPrimitives?this.previousDownstreamPrimitives=[...this.downstreamPrimitives]:this.previousDownstreamPrimitives=[],this.downstreamPrimitives=[];let e=this.dependencyHandler._components[this.parentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];t||(t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),t.includes(this)||t.push(this);let n=e.returnMatchedChildIndices(this.childGroups);if(void 0===n)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childGroups ${this.childGroups} does not exist.`);if(this.childIndices&&(n=n.filter(((e,t)=>this.childIndices.includes(t)))),!e.childrenMatched&&!this.proceedIfAllChildrenNotMatched){let t=!1;if(e.childrenMatchedWithPlaceholders&&(this.skipPlaceholders&&(n=n.filter((t=>!e.placeholderActiveChildrenIndices.includes(t)))),t=!(!this.skipComponentNames||0!==this.originalDownstreamVariableNames.length)||n.every((t=>!e.placeholderActiveChildrenIndices.includes(t)))),!t){let t=e.unexpandedCompositesNotReady.length>0;if(!t&&e.unexpandedCompositesReady.length>0){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(t){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});let t=[],r=[];for(let a of e.unexpandedCompositesNotReady){if(e.childrenMatchedWithPlaceholders){if(e.placeholderActiveChildrenIndicesByComposite[a].every((e=>!n.includes(e))))continue}this.dependencyHandler._components[a].attributes.createComponentOfType?.primitive?t.push(a):r.push(a)}let a=r;0===a.length&&(a=t);for(let e of a)for(let t of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childMatches",stateVariableBlocked:t});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}}let r=n.map((t=>e.activeChildren[t]));if(this.compositeReplacementRange=[],e.compositeReplacementActiveRange&&r.length>0){let t=0;for(;t<n.length;){let r=n[t];for(let a of e.compositeReplacementActiveRange)if(a.firstInd<=r&&a.lastInd>=r){let e=t,i=t;for(;a.lastInd>r&&t<n.length-1&&(t++,r=n[t],a.lastInd>=r);)i=t;if(this.compositeReplacementRange.push({compositeName:a.compositeName,target:a.target,firstInd:e,lastInd:i}),t++,t===n.length)break;r=n[t]}t++}}this.activeChildrenIndices=n;let a=[],i=[];for(let[e,t]of r.entries())"object"==typeof t?(this.downstreamPrimitives.push(null),a.push(t.componentName?t.componentName:`__placeholder_${e}`),i.push(t.componentType)):this.downstreamPrimitives.push(t);return{success:!0,downstreamComponentNames:a,downstreamComponentTypes:i}}async getValue({verbose:e}={}){let t=await super.getValue({verbose:e,skipProxy:!0}),n=[],r=0;for(let e of this.downstreamPrimitives)null===e?(n.push(t.value[r]),r++):n.push(e);return n.compositeReplacementRange=this.compositeReplacementRange,t.value=n,(this.downstreamPrimitives.length!==this.previousDownstreamPrimitives.length||this.downstreamPrimitives.some(((e,t)=>e!==this.previousDownstreamPrimitives[t])))&&(t.changes.componentIdentitiesChanged=!0,this.previousDownstreamPrimitives=[...this.downstreamPrimitives]),t}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(ChildDependency);class DescendantDependency extends Dependency{static dependencyType="descendant";setUpParameters(){if(this.definition.ancestorName?(this.ancestorName=this.definition.ancestorName,this.specifiedComponentName=this.ancestorName):this.ancestorName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.componentTypes=this.definition.componentTypes,this.recurseToMatchedChildren=this.definition.recurseToMatchedChildren,this.useReplacementsForComposites=this.definition.useReplacementsForComposites,this.includeNonActiveChildren=this.definition.includeNonActiveChildren,this.includeAttributeChildren=this.definition.includeAttributeChildren,this.skipOverAdapters=this.definition.skipOverAdapters,this.ignoreReplacementsOfMatchedComposites=this.definition.ignoreReplacementsOfMatchedComposites,this.ignoreReplacementsOfEncounteredComposites=this.definition.ignoreReplacementsOfEncounteredComposites,Number.isInteger(this.definition.componentIndex)&&(this.componentIndex=this.definition.componentIndex)}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.ancestorName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.ancestorName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let t=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];t||(t=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName]=[]),t.includes(this)||t.push(this);let n=this.gatherUnexpandedComposites(e);if(n.haveCompositesNotReady||n.haveUnexpandedCompositeReady){for(let e of this.upstreamVariableNames){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});for(let t in n.unexpandedCompositesReadyByParentName)await this.dependencyHandler.addBlocker({blockerComponentName:t,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName});for(let t in n.unexpandedCompositesNotReadyByParentName)await this.dependencyHandler.addBlocker({blockerComponentName:t,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName})}return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let r=gatherDescendants({ancestor:e,descendantTypes:this.componentTypes,recurseToMatchedChildren:this.recurseToMatchedChildren,useReplacementsForComposites:this.useReplacementsForComposites,includeNonActiveChildren:this.includeNonActiveChildren,skipOverAdapters:this.skipOverAdapters,ignoreReplacementsOfMatchedComposites:this.ignoreReplacementsOfMatchedComposites,ignoreReplacementsOfEncounteredComposites:this.ignoreReplacementsOfEncounteredComposites,componentInfoObjects:this.dependencyHandler.componentInfoObjects});if(void 0!==this.componentIndex){let e=r[this.componentIndex-1];r=e?[e]:[]}return{success:!0,downstreamComponentNames:r.map((e=>e.componentName)),downstreamComponentTypes:r.map((e=>e.componentType))}}gatherUnexpandedComposites(e){let t={},n={},r=!1,a=!1,i=this.skipComponentNames&&0===this.originalDownstreamVariableNames.length;if(!e.childrenMatched)if(e.childrenMatchedWithPlaceholders){if(e.unexpandedCompositesReady.length>0){let n=this.unexpandedCompositesAdjustedForPlacedholders(e.unexpandedCompositesReady,i);n.length>0&&(t[e.componentName]=n,r=!0)}if(e.unexpandedCompositesNotReady.length>0){let t=this.unexpandedCompositesAdjustedForPlacedholders(e.unexpandedCompositesNotReady,i);t.length>0&&(n[e.componentName]=t,a=!0)}}else e.unexpandedCompositesReady.length>0&&(t[e.componentName]=e.unexpandedCompositesReady,r=!0),e.unexpandedCompositesNotReady.length>0&&(n[e.componentName]=e.unexpandedCompositesNotReady,a=!0);for(let i in e.allChildren){let o=e.allChildren[i].component;if("object"==typeof o){let e=this.gatherUnexpandedComposites(o);e.haveUnexpandedCompositeReady&&(Object.assign(t,e.unexpandedCompositesReadyByParentName),r=!0),e.haveCompositesNotReady&&(Object.assign(n,e.unexpandedCompositesNotReadyByParentName),a=!0)}}return{unexpandedCompositesReadyByParentName:t,haveUnexpandedCompositeReady:r,unexpandedCompositesNotReadyByParentName:n,haveCompositesNotReady:a}}unexpandedCompositesAdjustedForPlacedholders(e,t){let n=[];for(let r of e){let e=this.dependencyHandler._components[r];if(e.attributes.createComponentOfType){let a=e.attributes.createComponentOfType.primitive,i=this.componentTypes.some((e=>this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:a,baseComponentType:e})));i&&t||n.push(r)}else n.push(r)}return n}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(DescendantDependency);class ParentDependency extends Dependency{static dependencyType="parentStateVariable";setUpParameters(){if(this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,!this.definition.variableName)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.parentComponentType&&(this.parentComponentType=this.definition.parentComponentType),this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.childName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.childName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.parentName)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=e.parentName;let t=this.dependencyHandler._components[this.parentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(this.parentComponentType&&!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:this.parentComponentType}))return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return n||(n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}}dependencyTypeArray.push(ParentDependency);class ParentIdentityDependency extends Dependency{static dependencyType="parentIdentity";setUpParameters(){this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,this.definition.parentComponentType&&(this.parentComponentType=this.definition.parentComponentType),this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.childName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.childName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.childName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.parentName)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=e.parentName;let t=this.dependencyHandler._components[this.parentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(this.parentComponentType&&!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:this.parentComponentType}))return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return n||(n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}}dependencyTypeArray.push(ParentIdentityDependency);class AncestorDependency extends Dependency{static dependencyType="ancestor";setUpParameters(){if(this.definition.descendantName?(this.descendantName=this.definition.descendantName,this.specifiedComponentName=this.descendantName):this.descendantName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0,this.definition.componentType&&(this.componentType=this.definition.componentType)}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.descendantName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.descendantName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.descendantName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!(this.dependencyHandler.core.documentName in this.dependencyHandler._components)){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e}),await this.dependencyHandler.addBlocker({blockerComponentName:this.dependencyHandler.core.documentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let t=this.findMatchingAncestor(e);if(t.missingComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[t.missingComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[t.missingComponentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:t.missingComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let e of t.ancestorsExamined){let t=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[e];t||(t=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[e]=[]),t.includes(this)||t.push(this)}return this.ancestorResults=t,t.ancestorFound?{success:!0,downstreamComponentNames:[t.ancestorFound.componentName],downstreamComponentTypes:[t.ancestorFound.componentClass.componentType]}:{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}findMatchingAncestor(e){let t=[];if(this.componentType){for(let n of e.ancestors){let e=this.dependencyHandler._components[n.componentName];if(!e)return{missingComponentName:n.componentName};if(t.push(n.componentName),this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:this.componentType}))return{ancestorsExamined:t,ancestorFound:n}}return{ancestorsExamined:t}}if(0===this.originalDownstreamVariableNames.length)return console.warn(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must specify componentType or variableNames to find ancestor`),{ancestorsExamined:t};let n=this.originalDownstreamVariableNames;for(let r of e.ancestors){let e=this.dependencyHandler._components[r.componentName];if(!e)return{missingComponentName:r.componentName};t.push(r.componentName);let a=!0;for(let t of n)if(!(t in e.state)&&!this.dependencyHandler.core.checkIfArrayEntry({stateVariable:t,component:e})){a=!1;break}if(a)return{ancestorsExamined:t,ancestorFound:r}}return{ancestorsExamined:t}}deleteFromUpdateTriggers(){for(let e of this.ancestorResults.ancestorsExamined){let t=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[e];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}if(this.ancestorResults&&this.ancestorResults.missingComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorResults.missingComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(AncestorDependency);class ReplacementDependency extends Dependency{static dependencyType="replacement";setUpParameters(){if(this.definition.compositeName?(this.compositeName=this.definition.compositeName,this.specifiedComponentName=this.compositeName):this.compositeName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.recursive=this.definition.recursive,this.recurseNonStandardComposites=this.definition.recurseNonStandardComposites,Number.isInteger(this.definition.componentIndex)&&(this.componentIndex=this.definition.componentIndex),this.includeWithheldReplacements=this.definition.includeWithheldReplacements,this.expandReplacements=!0}async determineDownstreamComponents(){this.replacementPrimitives?this.previousReplacementPrimitives=[...this.replacementPrimitives]:this.previousReplacementPrimitives=[],this.replacementPrimitives=[];let e=this.dependencyHandler._components[this.compositeName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.compositeName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.isExpanded){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e}),await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName});return e.state.readyToExpandWhenResolved.isResolved||await this.dependencyHandler.addBlocker({blockerComponentName:this.compositeName,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.compositeName,typeBlocked:"expandComposite"}),{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}this.compositesFound=[this.compositeName];let t=e.replacements;if(!this.includeWithheldReplacements&&e.replacementsToWithhold>0&&(t=t.slice(0,-e.replacementsToWithhold)),this.recursive){let e=this.dependencyHandler.core.recursivelyReplaceCompositesWithReplacements({replacements:t,recurseNonStandardComposites:this.recurseNonStandardComposites,includeWithheldReplacements:this.includeWithheldReplacements});if(e.unexpandedCompositesNotReady.length>0||e.unexpandedCompositesReady.length>0){for(let t of this.upstreamVariableNames){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t});for(let n of[...e.unexpandedCompositesReady,...e.unexpandedCompositesNotReady])await this.dependencyHandler.addBlocker({blockerComponentName:n,blockerType:"expandComposite",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:t,dependencyBlocked:this.dependencyName})}for(let t of e.unexpandedCompositesNotReady)await this.dependencyHandler.addBlocker({blockerComponentName:t,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:t,typeBlocked:"expandComposite"});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}t=e.newReplacements,this.compositesFound.push(...e.compositesFound)}for(let e of this.compositesFound){let t=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[e];t||(t=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[e]=[]),t.includes(this)||t.push(this)}if(void 0!==this.componentIndex){let e=t[this.componentIndex-1];t=e?[e]:[]}let n=[],r=[];for(let e of t)"object"==typeof e?(this.replacementPrimitives.push(null),n.push(e.componentName),r.push(e.componentType)):this.replacementPrimitives.push(e);return{success:!0,downstreamComponentNames:n,downstreamComponentTypes:r}}async getValue({verbose:e}={}){let t=await super.getValue({verbose:e,skipProxy:!0}),n=[],r=0;for(let e of this.replacementPrimitives)null===e?(n.push(t.value[r]),r++):n.push(e);return t.value=n,(this.replacementPrimitives.length!==this.previousReplacementPrimitives.length||this.replacementPrimitives.some(((e,t)=>e!==this.previousReplacementPrimitives[t])))&&(t.changes.componentIdentitiesChanged=!0,this.previousReplacementPrimitives=[...this.replacementPrimitives]),t}deleteFromUpdateTriggers(){if(this.compositesFound)for(let e of this.compositesFound){let t=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[e];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(ReplacementDependency);class SourceCompositeDependency extends Dependency{static dependencyType="sourceCompositeStateVariable";setUpParameters(){if(this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,!this.definition.variableName)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.compositeComponentType&&(this.compositeComponentType=this.definition.compositeComponentType),this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.replacementName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.replacementName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let t=e.replacementOf;if(this.compositeComponentType)for(;!this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:this.compositeComponentType});){if(!t.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};t=t.replacementOf}return{success:!0,downstreamComponentNames:[t.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(SourceCompositeDependency);class SourceCompositeIdentityDependency extends Dependency{static dependencyType="sourceCompositeIdentity";setUpParameters(){this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.replacementName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.replacementName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.replacementName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.replacementOf)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let t=e.replacementOf;return{success:!0,downstreamComponentNames:[t.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(SourceCompositeIdentityDependency);class AdapterSourceDependency extends Dependency{static dependencyType="adapterSourceStateVariable";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,!this.definition.variableName)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.originalDownstreamVariableNames=[this.definition.variableName],this.returnSingleVariableValue=!0,this.variablesOptional=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.adaptedFrom)return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};let t=e.adaptedFrom;return{success:!0,downstreamComponentNames:[t.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(AdapterSourceDependency);class CountAmongSiblingsDependency extends Dependency{static dependencyType="countAmongSiblingsOfSameType";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(!e.parentName)return console.warn(`component ${this.componentName} does not have a parent for state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}.`),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=e.parentName;let t=this.dependencyHandler._components[this.parentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}let n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(n||(n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),!t.childrenMatched){if(!t.childrenMatchedWithPlaceholders){let e=t.unexpandedCompositesNotReady.length>0;if(!e&&t.unexpandedCompositesReady.length>0){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}if(e){for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"childMatches",blockerStateVariable:e,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});for(let e of t.unexpandedCompositesNotReady)for(let t of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:e,blockerType:"stateVariable",blockerStateVariable:"readyToExpandWhenResolved",componentNameBlocked:this.upstreamComponentName,typeBlocked:"childMatches",stateVariableBlocked:t});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}}}return{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(t){let e=t.indexOf(this);-1!==e&&t.splice(e,1)}}async getValue(){let e=this.dependencyHandler.components[this.upstreamComponentName].componentType,t=this.dependencyHandler.components[this.parentName].activeChildren.filter((t=>t.componentType===e)),n=t.map((e=>e.componentName)).indexOf(this.upstreamComponentName)+1;return{value:n,changes:{}}}}dependencyTypeArray.push(CountAmongSiblingsDependency);class TargetComponentDependency extends Dependency{static dependencyType="targetComponent";setUpParameters(){let e=this.dependencyHandler._components[this.upstreamComponentName];if(this.target=e.doenetAttributes.target,this.target&&(this.targetComponentName=this.specifiedComponentName=e.doenetAttributes.targetComponentName),this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0}async determineDownstreamComponents(){if(!this.target)return{downstreamComponentNames:[],downstreamComponentTypes:[]};let e=this.dependencyHandler._components[this.targetComponentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.targetComponentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.targetComponentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.targetComponentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}dependencyTypeArray.push(TargetComponentDependency);class ExpandTargetNameDependency extends Dependency{static dependencyType="expandTargetName";setUpParameters(){this.parentName=this.upstreamComponentName,this.target=this.definition.target}async getValue(){let e,t=this.dependencyHandler._components[this.parentName].attributes.newNamespace?.primitive,n=this.parentName.split("/").map((e=>({namespace:e})));t||(n=n.slice(0,n.length-1));try{e=convertComponentTarget({target:this.target,namespaceStack:n})}catch(t){e=null}return{value:e,changes:{}}}}dependencyTypeArray.push(ExpandTargetNameDependency);class ValueDependency extends Dependency{static dependencyType="value";setUpParameters(){this.value=this.definition.value}async getValue(){return{value:this.value,changes:{}}}}dependencyTypeArray.push(ValueDependency);class FlagDependency extends ValueDependency{static dependencyType="flag";setUpParameters(){this.flagName=this.definition.flagName,this.value=this.dependencyHandler.core.flags[this.flagName]}}dependencyTypeArray.push(FlagDependency);class DoenetAttributeDependency extends StateVariableDependency{static dependencyType="doenetAttribute";setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async getValue(){let e=null,t={};if(this.componentIdentitiesChanged&&(t.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),1===this.downstreamComponentNames.length){e=this.dependencyHandler.components[this.downstreamComponentNames[0]].doenetAttributes[this.attributeName]}return{value:e,changes:t}}}dependencyTypeArray.push(DoenetAttributeDependency);class AttributePrimitiveDependency extends StateVariableDependency{static dependencyType="attributePrimitive";setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async getValue(){let e=null,t={};if(this.componentIdentitiesChanged&&(t.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),1===this.downstreamComponentNames.length){e=this.dependencyHandler.components[this.downstreamComponentNames[0]].attributes[this.attributeName],e=e?e.primitive:null}return{value:e,changes:t}}}dependencyTypeArray.push(AttributePrimitiveDependency);class SerializedChildrenDependency extends Dependency{static dependencyType="serializedChildren";setUpParameters(){this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.parentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.parentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.parentName],downstreamComponentTypes:[e.componentType]}}async getValue(){return{value:this.dependencyHandler._components[this.parentName].serializedChildren,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(SerializedChildrenDependency);class VariantsDependency extends Dependency{static dependencyType="variants";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[e.componentType]}}async getValue(){return{value:this.dependencyHandler._components[this.componentName].variants,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}}dependencyTypeArray.push(VariantsDependency);class CounterDependency extends Dependency{static dependencyType="counter";setUpParameters(){this.counterName=this.definition.counterName,this.componentName=this.upstreamComponentName}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName],t=e.counters[this.counterName];return t||(t=e.counters[this.counterName]={dependencies:[],componentList:[],value:null}),t.dependencies.includes(this)||t.dependencies.push(this),await this.dependencyHandler.collateCountersAndPropagateToAncestors(e),{success:!0,downstreamComponentNames:[],downstreamComponentTypes:[]}}async getValue(){return{value:this.dependencyHandler._components[this.componentName].counters[this.counterName].value,changes:{}}}}dependencyTypeArray.push(CounterDependency);class DetermineDependenciesDependency extends Dependency{static dependencyType="determineDependencies";setUpParameters(){if(this.recalculateDependencies=!0,this.definition.componentName?this.componentName=this.definition.componentName:this.componentName=this.upstreamComponentName,void 0===this.definition.variableNames)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames is not defined`);this.originalDownstreamVariableNames=this.definition.variableNames,this.returnSingleComponent=!0}async determineDownstreamComponents(){let e=this.dependencyHandler._components[this.componentName];if(!e){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.componentName]=[]),e.includes(this)||e.push(this);for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.componentName,blockerType:"componentIdentity",componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:e,dependencyBlocked:this.dependencyName}),await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"recalculateDownstreamComponents",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!1,downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let e of this.upstreamVariableNames)await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:e,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:e});return{success:!0,downstreamComponentNames:[this.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let t=e.indexOf(this);-1!==t&&e.splice(t,1)}}}async markStale(){let e=this.dependencyHandler._components[this.upstreamComponentName];for(let t of this.upstreamVariableNames)if(!(e&&e.state[t]&&e.state[t].currentlyResolving)){await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"stateVariable",stateVariableBlocked:t});for(let e in this.dependencyHandler.downstreamDependencies[this.upstreamComponentName][t]){"determineDependencies"!==this.dependencyHandler.downstreamDependencies[this.upstreamComponentName][t][e].dependencyType&&await this.dependencyHandler.addBlocker({blockerComponentName:this.upstreamComponentName,blockerType:"determineDependencies",blockerStateVariable:t,blockerDependency:this.dependencyName,componentNameBlocked:this.upstreamComponentName,typeBlocked:"recalculateDownstreamComponents",stateVariableBlocked:t,dependencyBlocked:e})}}}}dependencyTypeArray.push(DetermineDependenciesDependency);class FileDependency extends Dependency{static dependencyType="file";setUpParameters(){this.cid=this.definition.cid,this.uri=this.definition.uri,this.fileType=this.definition.fileType}async getValue(){let e;if(this.cid){if("csv"!==this.fileType.toLowerCase())return{value:null,changes:{}};return e="csv",{value:await retrieveTextFileForCid(this.cid,e),changes:{}}}{let e=await fetch(this.uri);if(e.ok){return{value:await e.text(),changes:{}}}return{value:null,changes:{}}}}}dependencyTypeArray.push(FileDependency);var appliedFunctionSymbolsDefault=["abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg","min","max","mean","median","floor","ceil","round","sum","prod","var","std","count","mod"];let allowedLatexSymbols=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","Tau","upsilon","Upsilon","phi","Phi","chi","psi","Psi","omega","Omega","partial","varnothing","emptyset"];var textToAst$1=new me$3.converters.textToAstObj({appliedFunctionSymbols:appliedFunctionSymbolsDefault});function getFromText({functionSymbols:e,appliedFunctionSymbols:t=appliedFunctionSymbolsDefault,splitSymbols:n=!0}){return r=>me$3.fromAst(new me$3.converters.textToAstObj({appliedFunctionSymbols:t,functionSymbols:e,splitSymbols:n}).convert(r))}var latexToAst=new me$3.converters.latexToAstObj({appliedFunctionSymbols:appliedFunctionSymbolsDefault,allowedLatexSymbols:allowedLatexSymbols});function getFromLatex({functionSymbols:e,appliedFunctionSymbols:t=appliedFunctionSymbolsDefault,splitSymbols:n=!0}){return n?n=>me$3.fromAst(new me$3.converters.latexToAstObj({appliedFunctionSymbols:t,functionSymbols:e,allowedLatexSymbols:allowedLatexSymbols}).convert(wrapWordIncludingNumberWithVar(n))):n=>me$3.fromAst(new me$3.converters.latexToAstObj({appliedFunctionSymbols:t,functionSymbols:e,allowedLatexSymbols:allowedLatexSymbols}).convert(wrapWordWithVar(n)))}function normalizeMathExpression({value:e,simplify:t,expand:n=!1,createVectors:r=!1,createIntervals:a=!1}){return r&&(e=e.tuples_to_vectors()),a&&(e=e.to_intervals()),n&&(e=e.expand()),"full"===t?e.simplify():"numbers"===t?e.evaluate_numbers():"numberspreserveorder"===t?e.evaluate_numbers({skip_ordering:!0}):e}function findFiniteNumericalValue(e){if(void 0!==e)return Number.isFinite(e)||void 0!==e.evaluate_to_constant&&(e=e.evaluate_to_constant(),Number.isFinite(e))?e:null}function convertValueToMathExpression(e){return e instanceof me$3.class?e:"number"==typeof e||"string"==typeof e||Array.isArray(e)?me$3.fromAst(e):me$3.fromAst("")}function returnNVariables(e,t){if(!Number.isInteger(e)||e<1)return[];let n=t.length;if(0===n){if(1===e)return[me$3.fromAst("x")];if(2===e)return[me$3.fromAst("x"),me$3.fromAst("y")];if(3===e)return[me$3.fromAst("x"),me$3.fromAst("y"),me$3.fromAst("z")];{let t=[];for(let n=1;n<=e;n++)t.push(me$3.fromAst(textToAst$1.convert(`x_${n}`)));return t}}if(new Set(t.map((e=>e.toString()))).size<n&&console.warn("Duplicate variables specified"),e<=n)return t.slice(0,e);let r=[...t.map((e=>e.toString()))],a=[...t];for(let t=n+1;t<=e;t++){let n;n=1==t?e>3?["x_1"]:["x"]:2==t?e>3?["x_2","y_2"]:["y","x_2"]:3==t?e>3?["x_3","y_3","z_3"]:["z","x_3","z_3"]:["x","y","z","u","v","w","X","Y","Z"].map((e=>`${e}_${t}`));let i=!1;for(let e of n)if(!r.includes(e)){a.push(me$3.fromAst(textToAst$1.convert(e))),r.push(e),i=!0;break}if(!i){let e=n[0];a.push(me$3.fromAst(textToAst$1.convert(e))),r.push(e),console.warn("Variables added were not unique")}}return a}async function preprocessMathInverseDefinition({desiredValue:e,stateValues:t,variableName:n="value",arrayKey:r,workspace:a}){if("tuple"!==e.tree[0]&&"vector"!==e.tree[0]||!e.tree.includes())return{desiredValue:e};let i,o=n+"Ast";if(void 0!==r&&(o+=`_${r}`),a[o])i=a[o].slice(0,e.tree.length);else{let a=await t[n];a&&void 0!==r&&(a=a[r]),!a||"tuple"!==a.tree[0]&&"vector"!==a.tree[0]||(i=a.tree.slice(0,e.tree.length))}if(i){let t=[],n=!1;for(let[r,a]of e.tree.entries())void 0===a?(n=!0,t.push(r)):i[r]=a;return e=me$3.fromAst(i),a[o]=i,n?{desiredValue:e,vectorComponentsNotAffected:t}:{desiredValue:e}}{let t=[];for(let n of e.tree.slice(1))void 0===n?t.push(""):t.push(n);return{desiredValue:e=me$3.fromAst([e.tree[0],...t])}}}function normalizeLatexString(e,{unionFromU:t=!1}={}){let n=[["","\\alpha "],["","\\beta "],["","\\beta "],["","\\Gamma "],["","\\gamma "],["","\\Delta "],["","\\delta "],["","\\epsilon "],["","\\epsilon "],["","\\zeta "],["","\\eta "],["","\\Theta "],["","\\Theta "],["","\\theta "],["","\\theta "],["","\\theta "],["","\\iota "],["","\\kappa "],["","\\Lambda "],["","\\lambda "],["","\\mu "],["","\\mu "],["","\\nu "],["","\\Xi "],["","\\xi "],["","\\Pi "],["","\\pi "],["","\\pi "],["","\\rho "],["","\\rho "],["","\\Sigma "],["","\\sigma "],["","\\sigma "],["","\\tau "],["","\\Upsilon "],["","\\upsilon "],["","\\Phi "],["","\\phi "],["","\\phi "],["","\\Psi "],["","\\psi "],["","\\Omega "],["","\\omega "],["","-"],[""," \\cdot "],[""," \\cdot "],[""," \\cup "],[""," \\cap "],[""," \\infty "],[""," \\emptyset "]];for(let t of n)e=e.replaceAll(t[0],t[1]);let r=e.match(/^(\\ )*(\\ldots|\.(\\ )*\.(\\ )*\.)(\\ )*(.*)$/);if(r){let t=r[6];e=","!==t[0]?"\\ldots,"+t:"\\ldots"+t}let a=e.match(/^(.*?)(\\ )*(\\ldots|\.(\\ )*\.(\\ )*\.)(\\ )*$/);if(a){let t=a[1];e=","!==t[t.length-1]?t+",\\ldots":t+"\\ldots"}return e=(e=e.replaceAll(/(\b|\\ )or(\b|\\ )/g,"$1\\lor$2")).replaceAll(/(\b|\\ )and(\b|\\ )/g,"$1\\land$2"),t&&(e=e.replaceAll(/(\b|\\ )U(\b|\\ )/g,"$1\\cup$2")),e}function isValidVariable(e){let t=e.tree,n=!0;return"string"==typeof t?""===t&&(n=!1):(!Array.isArray(t)||"_"!==t[0]||"string"!=typeof t[1]||"string"!=typeof t[2]&&"number"!=typeof t[2])&&(n=!1),n}function mathStateVariableFromNumberStateVariable({numberVariableName:e="number",mathVariableName:t="math",isPublic:n=!1}={}){let r={returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:e}}),definition:function({dependencyValues:e}){return{setValue:{[t]:me$3.fromAst(e.number)}}},inverseDefinition:function({desiredStateVariableValues:e}){let n=e[t].evaluate_to_constant();return null===n&&(n=NaN),{success:!0,instructions:[{setDependency:"number",desiredValue:n}]}}};return n&&(r.public=!0,r.shadowingInstructions={createComponentOfType:"math"}),r}function roundForDisplay({value:e,dependencyValues:t,usedDefault:n}){let r;return!n.displayDigits&&t.displayDigits>=1||n.displayDecimals||!Number.isFinite(t.displayDecimals)?(r=t.displayDigits>=1?me$3.round_numbers_to_precision(e,t.displayDigits):me$3.round_numbers_to_precision(e,10),t.displaySmallAsZero>0&&(r=me$3.evaluate_numbers(r,{skip_ordering:!0,set_small_zero:t.displaySmallAsZero}))):r=me$3.round_numbers_to_decimals(e,t.displayDecimals),r}function mergeListsWithOtherContainers(e){if(!Array.isArray(e))return e;let t=e[0],n=e.slice(1);return["tuple","vector","list","set"].includes(t)&&(n=n.reduce(((e,t)=>Array.isArray(t)&&"list"===t[0]?[...e,...t.slice(1)]:[...e,t]),[])),n=n.map((e=>mergeListsWithOtherContainers(e))),[t,...n]}function wrapWordWithVar(e){let t="",n=/\\var\s*{[^{}]*}/,r=e.match(n);for(;r;){let a=r.index,i=a+r[0].length;t+=wrapWordWithVarSub(e.substring(0,a)),t+=e.substring(a,i),r=(e=e.substring(i)).match(n)}return t+=wrapWordWithVarSub(e),t}function wrapWordWithVarSub(e){let t="",n=/([^a-zA-Z0-9]?)([a-zA-Z][a-zA-Z0-9]+)([^a-zA-Z0-9]?)/,r=e.match(n);for(;r;){let a=r.index,i=a+r[0].length-r[3].length;if("\\"===r[1])t+=e.substring(0,i),e=e.substring(i);else{let n=a+r[1].length;t+=e.substring(0,n),t+=`\\var{${r[2]}}`,e=e.substring(i)}r=e.match(n)}return t+=e,t}function wrapWordIncludingNumberWithVar(e){let t="",n=/\\var\s*{[^{}]*}/,r=e.match(n);for(;r;){let a=r.index,i=a+r[0].length;t+=wrapWordIncludingNumberWithVarSub(e.substring(0,a)),t+=e.substring(a,i),r=(e=e.substring(i)).match(n)}return t+=wrapWordIncludingNumberWithVarSub(e),t}function wrapWordIncludingNumberWithVarSub(e){let t="",n=/([^a-zA-Z0-9\s]?\s*)([a-zA-Z][a-zA-Z0-9]*[0-9][a-zA-Z0-9]*)([^a-zA-Z0-9]?)/,r=e.match(n);for(;r;){let a=r.index,i=a+r[0].length-r[3].length;if("\\"===r[1]||"^"===r[1][0])t+=e.substring(0,i),e=e.substring(i);else{let n=a+r[1].length;t+=e.substring(0,n),t+=`\\var{${r[2]}}`,e=e.substring(i)}r=e.match(n)}return t+=e,t}function stripLatex(e){return e.replaceAll("\\,","").replaceAll(/\\var{([^{}]*)}/g,"$1")}function renameStateVariable({stateVariableDefinitions:e,oldName:t,newName:n}){let r=e[n]=e[t];if(delete e[t],r.additionalStateVariablesDefined){let e=r.additionalStateVariablesDefined.indexOf(t);-1!==e&&(r.additionalStateVariablesDefined[e]=n)}let a=r.definition,i=["setValue","useEssentialOrDefaultValue","setEssentialValue"],o=["noChanges"];r.definition=function(e){let r=a(e);for(let e of i)r[e]&&t in r[e]&&(r[e][n]=r[e][t],delete r[e][t]);for(let e of o)if(r[e]){let a=r[e].indexOf(t);-1!==a&&(r[e][a]=n)}return r};let s=r.inverseDefinition;s&&(r.inverseDefinition=async function(e){let r=e.desiredStateVariableValues;r[t]=r[n],delete r[n];let a=await s(e);if(a.success)for(let e of a.instructions)e.setEssentialValue===t&&(e.setEssentialValue=n);return a})}function returnDefaultGetArrayKeysFromVarName(e){return e>1?function({arrayEntryPrefix:e,varEnding:t,arraySize:n,nDimensions:r}){let a=t.split("_").map((e=>Number(e)-1));return a.length===r&&a.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?a.every(((e,t)=>e<n[t]))?[String(a)]:[]:[String(a)]:[]}:function({arrayEntryPrefix:e,varEnding:t,arraySize:n}){let r=Number(t)-1;return Number.isInteger(r)&&r>=0?n?r<n[0]?[String(r)]:[]:[String(r)]:[]}}let nanoid=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t},core,queuedRequestActions=[];async function createCore(e){core=new Core(e),core.getInitializedPromise().then((()=>{for(let e of queuedRequestActions)core.requestAction(e);queuedRequestActions=[]}))}async function returnAllStateVariables(e){if(!e.components)return{};let t={};for(let n in e.components){let r=e.components[n],a=t[n]={componentName:n,componentType:r.componentType,stateValues:{}};for(let e in r.state)a.stateValues[e]=removeFunctionsMathExpressionClass(await r.state[e].value);a.activeChildren=r.activeChildren.map((e=>e.componentName?{componentName:e.componentName,componentType:e.componentType}:e)),r.replacements&&(a.replacements=r.replacements.map((e=>e.componentName?{componentName:e.componentName,componentType:e.componentType}:e)),void 0!==r.replacementsToWithhold&&(a.replacementsToWithhold=r.replacementsToWithhold))}return t[e.documentName].sharedParameters=removeFunctionsMathExpressionClass(e.components[e.documentName].sharedParameters),t}function removeFunctionsMathExpressionClass(e){if(e instanceof me$3.class)e=e.tree;else if("function"==typeof e)e=void 0;else if(Array.isArray(e))e=e.map((e=>removeFunctionsMathExpressionClass(e)));else if("object"==typeof e&&null!==e){let t={};for(let n in e)t[n]=removeFunctionsMathExpressionClass(e[n]);e=t}return e}function enumerateSelectionCombinations({numberOfIndices:e,numberOfOptions:t,maxNumber:n=1/0,withReplacement:r=!1,skipZero:a=!1}){if(1===e){let e=[...Array(t).keys()];return e=e.slice(1),a||(e=[...e,0]),e=e.slice(0,n),e=e.map((e=>[e])),e}let i=enumerateSelectionCombinations({numberOfIndices:e-1,numberOfOptions:t,maxNumber:n,withReplacement:r,skipZero:!r}),o=[],s=0;for(let e of i)for(let r=1;r<=t;r++){let i=[r%t,...e.map((e=>(r+e)%t))];if((!a||!i.includes(0))&&(o.push(i),s++,s>=n))return o}return o}function enumerateCombinations({numberOfOptionsByIndex:e,maxNumber:t=1/0}){let n=e.length;if(0===n)return[];let r=[];for(let t=0;t<n;t++){let n=[];for(let r=0;r<t;r++)n.push(me$3.math.gcd(e[t],e[r]));r.push(n)}let a=r.reduce(((e,t)=>[...t,...e]),[]).reduce(((e,t)=>Math.max(e,t)),1);if(1===a){let n=e.reduce(((e,t)=>e*t));n=Math.min(n,t);let r=[];for(let t=0;t<n;t++){let n=e.map((e=>t%e));r.push(n)}return r}if(2===n){let n=a,r=me$3.math.lcm(...e),i=[],o=0;for(let a=0;a<n;a++)for(let n=0;n<r;n++){let r=[n%e[0],(n+a)%e[1]];if(i.push(r),o++,o>=t)return i}return i}let i=[];for(let t=0;t<n;t++){let n=[];for(let a=0;a<t;a++)r[t][a]>1?n.push(me$3.math.lcm(e[t],e[a])):n.push(null);i.push(n)}let o,s=i.reduce(((e,t)=>[...t,...e]),[]).filter((e=>null!==e)).reduce(((e,t)=>Math.min(e,t)),1/0);for(let e=0;e<n;e++){for(let t=0;t<e;t++)if(i[e][t]===s){o=[t,e];break}if(o)break}let l=e[o[0]],u=e[o[1]],c=[l,u],p=e;p[o[0]]=l*u,p.splice(o[1],1);let d=enumerateCombinations({numberOfOptionsByIndex:p,maxNumber:t}),m=enumerateCombinations({numberOfOptionsByIndex:c,maxNumber:t});for(let e of d){let t=m[e[o[0]]];e.splice(o[0],1,t[0]),e.splice(o[1],0,t[1])}return d}function enumeratePermutations({values:e,maxNumber:t}){let n=[];const r=(e,a=[])=>{if(0===e.length)n.push(a);else for(let i=0;i<e.length;i++){let o=e.slice(),s=o.splice(i,1);if(r(o.slice(),a.concat(s)),n.length>=t)return}};return r(e),n}onmessage=function(e){"createCore"===e.data.messageType?createCore(e.data.args):"requestAction"===e.data.messageType?core?.initialized?core.requestAction(e.data.args):queuedRequestActions.push(e.data.args):"returnAllStateVariables"===e.data.messageType&&(console.log("all components"),console.log(core._components),console.log("core",core),returnAllStateVariables(core).then((e=>{postMessage({messageType:"returnAllStateVariables",args:e})})))};class BaseComponent{constructor({componentName:e,ancestors:t,serializedComponent:n,definingChildren:r,serializedChildren:a,attributes:i,stateVariableDefinitions:o,componentInfoObjects:s,coreFunctions:l,flags:u,shadow:c,numerics:p,parentSharedParameters:d,sharedParameters:m}){this.numerics=p,this.parentSharedParameters=d,this.sharedParameters=m,this.componentName=e,this.ancestors=t,this.counters={},this.componentInfoObjects=s,this.coreFunctions=l,this.flags=u,!0===c&&(this.isShadow=!0),this.definingChildren=r,void 0===this.definingChildren&&(this.definingChildren=[]),this.serializedChildren=a,this.attributes=i,this.state={};for(let e in o)this.state[e]=Object.assign({},o[e]);this.stateValues=new Proxy(this.state,createStateProxyHandler()),this.essentialState={},n.state&&(this.essentialState=deepClone(n.state)),this.doenetAttributes={},void 0!==n.doenetAttributes&&Object.assign(this.doenetAttributes,n.doenetAttributes),void 0!==n.variants&&(this.variants=n.variants)}static componentType="_base";static get rendererType(){return this.componentType}get componentType(){return this.constructor.componentType}get componentOrAdaptedName(){return this.adaptedFrom?this.adaptedFrom.componentOrAdaptedName:this.componentName}get rendererType(){return this.constructor.rendererType}get allPotentialRendererTypes(){let e=[];this.rendererType&&e.push(this.rendererType);for(let t in this.state){let n=this.state[t];if(n.public){let t=n.componentType;Array.isArray(t)||(t=[t]),n.wrappingComponents&&t.push(...flattenDeep(n.wrappingComponents).map((e=>"object"==typeof e?e.componentType:e)));for(let n of t){let t=this.componentInfoObjects.allComponentClasses[n];if(t){let n=t.rendererType;n&&!e.includes(n)&&e.push(n)}}}}if(this.constructor.adapters)for(let t of this.constructor.adapters){let n;n="string"==typeof t?t:t.componentType;let r=this.componentInfoObjects.allComponentClasses[n];if(r){let t=r.rendererType;t&&!e.includes(t)&&e.push(t)}}if(!this.rendererType)return e;for(let t in this.allChildren){let n=this.allChildren[t].component;if("object"==typeof n)for(let t of n.allPotentialRendererTypes)e.includes(t)||e.push(t)}return e}potentialRendererTypesFromSerializedComponents(e){let t=[];for(let n of e){let e=this.componentInfoObjects.allComponentClasses[n.componentType];if(e){let n=e.rendererType;n&&!t.includes(n)&&t.push(n);let r=e.returnStateVariableInfo({onlyPublic:!0}).stateVariableDescriptions;for(let e in r){let n=r[e],a=n.shadowingInstructions?.createComponentOfType;Array.isArray(a)||(a=[a]),n.wrappingComponents&&a.push(...flattenDeep(n.wrappingComponents).map((e=>"object"==typeof e?e.componentType:e)));for(let e of a){let n=this.componentInfoObjects.allComponentClasses[e];if(n){let e=n.rendererType;e&&!t.includes(e)&&t.push(e)}}}if(e.adapters)for(let n of e.adapters){let e;e="string"==typeof n?n:n.componentType;let r=this.componentInfoObjects.allComponentClasses[e];if(r){let e=r.rendererType;e&&!t.includes(e)&&t.push(e)}}}if(n.children){let e=this.potentialRendererTypesFromSerializedComponents(n.children);for(let n of e)t.includes(n)||t.push(n)}}return t}get childrenMatched(){return this.childrenMatchedWithPlaceholders&&!this.placeholderActiveChildrenIndices}static createAttributesObject(){return{hide:{createComponentOfType:"boolean",createStateVariable:"hide",defaultValue:!1,public:!0},disabled:{createComponentOfType:"boolean",createStateVariable:"disabledPreliminary",defaultValue:null},disabledIgnoresParentReadOnly:{createComponentOfType:"boolean",createStateVariable:"disabledIgnoresParentReadOnly",defaultValue:!1},modifyIndirectly:{createComponentOfType:"boolean",createStateVariable:"modifyIndirectly",defaultValue:!0,public:!0,propagateToProps:!0},fixed:{createComponentOfType:"boolean",createStateVariable:"fixedPreliminary",defaultValue:null},styleNumber:{createComponentOfType:"number",createStateVariable:"styleNumber",defaultValue:1,public:!0,fallBackToParentStateVariable:"styleNumber"},isResponse:{createPrimitiveOfType:"boolean",createStateVariable:"isResponse",defaultValue:!1,public:!0},newNamespace:{createPrimitiveOfType:"boolean"}}}static returnSugarInstructions(){return[]}static returnChildGroups(){return[]}static get childGroups(){return this.hasOwnProperty("childGroupsData")||(this.childGroupsData=this.returnChildGroups()),this.childGroupsData}static childGroupOfComponentTypeData;static get childGroupOfComponentType(){return this.hasOwnProperty("childGroupOfComponentTypeData")||(this.childGroupOfComponentTypeData={}),this.childGroupOfComponentTypeData}static childGroupIndsByNameData;static get childGroupIndsByName(){if(this.hasOwnProperty("childGroupIndsByNameData"))return Object.assign({},this.childGroupIndsByNameData);this.childGroupIndsByNameData={};for(let[e,t]of this.childGroups.entries()){if(t.group in this.childGroupIndsByNameData)throw Error(`Invalid childGroups for componentClass ${this.componentType}: ${t} is repeated`);this.childGroupIndsByNameData[t.group]=e}return Object.assign({},this.childGroupIndsByNameData)}returnMatchedChildIndices(e){let t=[];for(let n of e){let e=this.childMatchesByGroup[n];if(!e)throw Error(`child group ${n} is not defined for a component of type ${this.componentType}`);t.push(...e)}return t.sort(((e,t)=>e-t))}static returnStateVariableDefinitions(){let e={hidden:{public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide",variablesOptional:!0},parentHidden:{dependencyType:"parentStateVariable",variableName:"hidden"},sourceCompositeHidden:{dependencyType:"sourceCompositeStateVariable",variableName:"hidden"},adapterSourceHidden:{dependencyType:"adapterSourceStateVariable",variableName:"hidden"}}),definition:({dependencyValues:e})=>({setValue:{hidden:!0===e.parentHidden||!0===e.sourceCompositeHidden||!0===e.adapterSourceHidden||!0===e.hide}}),markStale:()=>({updateParentRenderedChildren:!0})}};return e.disabled={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,hasEssential:!0,doNotShadowEssential:!0,defaultValue:!1,returnDependencies:()=>({disabledPreliminary:{dependencyType:"stateVariable",variableName:"disabledPreliminary",variablesOptional:!0},disabledAttr:{dependencyType:"attributeComponent",attributeName:"disabled"},readOnly:{dependencyType:"flag",flagName:"readOnly"},disabledIgnoresParentReadOnly:{dependencyType:"stateVariable",variableName:"disabledIgnoresParentReadOnly",variablesOptional:!0},parentDisabled:{dependencyType:"parentStateVariable",variableName:"disabled"},sourceCompositeDisabled:{dependencyType:"sourceCompositeStateVariable",variableName:"disabled"},adapterSourceDisabled:{dependencyType:"adapterSourceStateVariable",variableName:"disabled"}}),definition({dependencyValues:e,usedDefault:t}){if(e.readOnly&&!e.disabledIgnoresParentReadOnly)return{setValue:{disabled:!0}};if(null!==e.disabledPreliminary&&null!==e.disabledAttr)return{setValue:{disabled:e.disabledPreliminary}};let n=!1,r=!0;return e.disabledIgnoresParentReadOnly||null===e.parentDisabled||t.parentDisabled||(n=n||e.parentDisabled,r=!1),null===e.sourceCompositeDisabled||t.sourceCompositeDisabled||(n=n||e.sourceCompositeDisabled,r=!1),null===e.adapterSourceDisabled||t.adapterSourceDisabled||(n=n||e.adapterSourceDisabled,r=!1),r&&null!==e.disabledPreliminary&&!t.disabledPreliminary&&(r=!1,n=e.disabledPreliminary),r?{useEssentialOrDefaultValue:{disabled:!0}}:{setValue:{disabled:n}}}},e.fixed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({fixedPreliminary:{dependencyType:"stateVariable",variableName:"fixedPreliminary",variablesOptional:!0},fixedAttr:{dependencyType:"attributeComponent",attributeName:"fixed"},parentFixed:{dependencyType:"parentStateVariable",variableName:"fixed"},sourceCompositeFixed:{dependencyType:"sourceCompositeStateVariable",variableName:"fixed"},adapterSourceFixed:{dependencyType:"adapterSourceStateVariable",variableName:"fixed"}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.fixedPreliminary&&null!==e.fixedAttr)return{setValue:{fixed:e.fixedPreliminary}};let n=!1,r=!0;return null===e.parentFixed||t.parentFixed||(n=n||e.parentFixed,r=!1),null===e.sourceCompositeFixed||t.sourceCompositeFixed||(n=n||e.sourceCompositeFixed,r=!1),null===e.adapterSourceFixed||t.adapterSourceFixed||(n=n||e.adapterSourceFixed,r=!1),r&&null!==e.fixedPreliminary&&!t.fixedPreliminary&&(r=!1,n=e.fixedPreliminary),r?{useEssentialOrDefaultValue:{fixed:!0}}:{setValue:{fixed:n}}}},e.isInactiveCompositeReplacement={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{isInactiveCompositeReplacement:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:{variableName:"isInactiveCompositeReplacement",value:e.isInactiveCompositeReplacement}}]})},e}static returnNormalizedStateVariableDefinitions({attributeNames:e,numerics:t}){let n=this.returnStateVariableDefinitions({attributeNames:e,numerics:t});if(!n)throw Error(`Error in state variable definitions of ${this.componentType}: returnStateVariableDefinitions did not return anything`);let r=function(e){for(let[t,n]of e.entries())"object"==typeof n&&(e[t]=n.variableName)},a=["returnDependencies","definition","inverseDefinition","stateVariablesDeterminingDependencies","stateVariablesDeterminingArraySizeDependencies","isArray","nDimensions","returnArraySizeDependencies","returnArraySize","returnArrayDependenciesByKey","arrayDefinitionByKey","inverseArrayDefinitionByKey","basedOnArrayKeyStateVariables","markStale","getPreviousDependencyValuesForMarkStale","determineDependenciesImmediately","createWorkspace","workspace","provideEssentialValuesInDefinition","providePreviousValuesInDefinition"],i={};for(let e in n){let t=n[e];if(i[e]=t,t.createWorkspace&&(t.workspace={}),t.additionalStateVariablesDefined){for(let[n,o]of t.additionalStateVariablesDefined.entries()){let s={};for(let e of a)e in t&&(s[e]=t[e]);s.additionalStateVariablesDefined=[...t.additionalStateVariablesDefined],s.additionalStateVariablesDefined[n]=e,r(s.additionalStateVariablesDefined);let l=o;"object"==typeof o&&(l=o.variableName,o=Object.assign({},o),delete o.variableName,Object.assign(s,o)),i[l]=s}r(t.additionalStateVariablesDefined)}}return i}static returnStateVariableInfo({onlyPublic:e=!1,onlyForRenderer:t=!1}={}){let n=this.createAttributesObject(),r={},a={},i={};for(let a in n){let i=n[a],o=i.createStateVariable;if(o&&(!e||i.public)&&(!t||i.forRenderer))if(i.public){let e;!i.createComponentOfType?(e=i.createPrimitiveOfType,"string"===e&&(e="text")):e=i.createComponentOfType,r[o]={createComponentOfType:e,public:!0}}else r[o]={}}let o=this.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(r)});for(let n in o){let s=o[n];if(s.isAlias)i[n]=s.targetVariableName;else if((!e||s.public)&&(!t||s.forRenderer)&&(s.public?r[n]={createComponentOfType:s.shadowingInstructions.createComponentOfType,public:!0}:r[n]={},s.isArray)){let e;r[n].isArray=!0,r[n].nDimensions=void 0===s.nDimensions?1:s.nDimensions,r[n].wrappingComponents=s.shadowingInstructions?.returnWrappingComponents?s.shadowingInstructions.returnWrappingComponents():[],e=s.entryPrefixes?s.entryPrefixes:[n];for(let t of e)a[t]={arrayVariableName:n,nDimensions:s.returnEntryDimensions?s.returnEntryDimensions(t):1,wrappingComponents:s.shadowingInstructions?.returnWrappingComponents?s.shadowingInstructions.returnWrappingComponents(t):[]};s.getArrayKeysFromVarName?r[n].getArrayKeysFromVarName=s.getArrayKeysFromVarName:r[n].getArrayKeysFromVarName=returnDefaultGetArrayKeysFromVarName(r[n].nDimensions)}}return{stateVariableDescriptions:r,arrayEntryPrefixes:a,aliases:i}}get parentName(){if(void 0!==this.ancestors&&0!==this.ancestors.length)return this.ancestors[0].componentName}getAllChildrenDownstreamComponentNames(e=!1){const t=Object.keys(this.allChildren);let n=Object.keys(this.downstreamDependencies);return!0!==e&&(n=n.filter((e=>!0!==this.downstreamDependencies[e].inactive))),[...t,...n]}get allDescendants(){let e=[];for(let t in this.allChildren){let n=this.allChildren[t].component;e=[...e,t,...n.allDescendants]}return e}async serialize(e={}){let t={componentType:this.componentType},n=[];for(let t of this.definingChildren)"object"!=typeof t?n.push(t):n.push(await t.serialize(e));if(void 0!==this.serializedChildren)for(let e of this.serializedChildren)n.push(this.copySerializedComponent(e));n.length>0&&(t.children=n);let r=this.constructor.createAttributesObject();t.attributes={};for(let n in this.attributes){let a=this.attributes[n];a.component?(r[n],e.copyAll&&(t.attributes[n]={component:await a.component.serialize(e)})):("isResponse"!==n||e.copyAll)&&(t.attributes[n]=JSON.parse(JSON.stringify(a)))}return this.essentialState&&Object.keys(this.essentialState).length>0&&(t.state=deepClone(this.essentialState)),e.copyVariants&&this.state.generatedVariantInfo&&(t.variants={desiredVariant:await this.stateValues.generatedVariantInfo}),t.originalName=this.componentName,t.originalDoenetAttributes=deepClone(this.doenetAttributes),t.doenetAttributes=deepClone(this.doenetAttributes),t.originalAttributes=deepClone(t.attributes),delete t.doenetAttributes.prescribedName,delete t.doenetAttributes.assignNames,t}copySerializedComponent(e){if("object"!=typeof e)return e;let t=[];if(void 0!==e.children)for(let n of e.children)t.push(this.copySerializedComponent(n));let n={componentType:e.componentType,originalName:e.componentName,originalNameFromSerializedComponent:!0,children:t,state:{},doenetAttributes:{}};return void 0!==e.doenetAttributes&&(n.originalDoenetAttributes=deepClone(e.doenetAttributes),n.doenetAttributes=deepClone(e.doenetAttributes),n.originalAttributes=deepClone(e.attributes),n.attributes=deepClone(e.attributes),delete n.doenetAttributes.prescribedName,delete n.doenetAttributes.assignNames),void 0!==e.state&&Object.assign(n.state,e.state),n}static adapters=[];static get nAdapters(){return this.adapters.length}getAdapter(e){if(e>=this.constructor.adapters.length)return;let t,n,r,a,i=this.constructor.adapters[e];"string"==typeof i?t=i:(t=i.stateVariable,n=i.componentType,r=i.substituteForPrimaryStateVariable,a=i.stateVariablesToShadow);let o=this.state[t];if(void 0===o||!o.public&&!n)throw Error("Invalid adapter "+t+" in "+this.componentType);return void 0===n&&(n=o.shadowingInstructions.createComponentOfType),{componentType:n,downstreamDependencies:{[this.componentName]:[{dependencyType:"adapter",adapterVariable:t,adapterTargetIdentity:{componentName:this.componentName,componentType:this.componentType},substituteForPrimaryStateVariable:r,stateVariablesToShadow:a}]}}}static getAdapterComponentType(e,t){if(e>=this.adapters.length)return;let n,r,a=this.adapters[e];if("string"==typeof a?n=a:(n=a.stateVariable,r=a.componentType),void 0===r){let e=t[this.componentType].stateVariableDescriptions[n];if(!e)throw Error("Invalid adapter "+n+" in "+this.componentType);if(r=e.createComponentOfType,!r)throw Error(`Couldn't get adapter component type for ${n} of componentType ${this.componentType}`)}return r}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){let n=e.variants?.numberOfVariants;if(void 0!==n)return{success:!0,numberOfVariants:n};let r=gatherVariantComponents({serializedComponents:e.children,componentInfoObjects:t});void 0===e.variants&&(e.variants={}),e.variants.descendantVariantComponents=r,n=1;let a=[];for(let e of r){let r=t.allComponentClasses[e.componentType].determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});if(!r.success)return{success:!1};a.push(r.numberOfVariants),n*=r.numberOfVariants}return e.variants.numberOfVariants=n,e.variants.uniqueVariantData={numberOfVariantsByDescendant:a},{success:!0,numberOfVariants:n}}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r=e.variants?.numberOfVariants;if(void 0===r)return{success:!1};if(!Number.isInteger(t)||t<1||t>r)return{success:!1};let a=!1,i=e.variants.uniqueVariantData.numberOfVariantsByDescendant,o=e.variants.descendantVariantComponents,s=[];if(o.length>0){let e=enumerateCombinations({numberOfOptionsByIndex:i,maxNumber:t})[t-1].map((e=>e+1));for(let t=0;t<i.length;t++)if(i[t]>1){let r=o[t],i=n.allComponentClasses[r.componentType].getUniqueVariant({serializedComponent:r,variantIndex:e[t],componentInfoObjects:n});if(!i.success)return{success:!1};s.push(i.desiredVariant),a=!0}else s.push({})}let l={index:t};return a&&(l.subvariants=s),{success:!0,desiredVariant:l}}}class InlineComponent extends BaseComponent{static componentType="_inline"}class Text extends InlineComponent{static componentType="text";static includeBlankStringChildren=!0;static variableForPlainMacro="value";static returnChildGroups(){return[{group:"textLike",componentTypes:["string","text","_singleCharacterInline","_inlineRenderInlineChildren"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType,addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},hasEssential:!0,returnDependencies:()=>({textLikeChildren:{dependencyType:"child",childGroups:["textLike"],variableNames:["text"]}}),defaultValue:"",set:e=>null===e?"":String(e),definition:function({dependencyValues:e}){if(0===e.textLikeChildren.length)return{useEssentialOrDefaultValue:{value:!0}};let t="";for(let n of e.textLikeChildren)t+="string"==typeof n?n:n.stateValues.text;return{setValue:{value:t}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){let n=t.textLikeChildren.length;return n>1?{success:!1}:1===n?{success:!0,instructions:[{setDependency:"textLikeChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:null===e.value?"":String(e.value)}]}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({setValue:{text:e.value}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"value",desiredValue:e.text}]})},e}}class TextOrInline extends InlineComponent{static componentType="_textOrInline";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text&&(t+=n.stateValues.text);return{setValue:{value:t}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({setValue:{text:e.value}})},e}}class CompositeComponent extends BaseComponent{constructor(e){super(e),this.replacementsWorkspace={}}static componentType="_composite";static rendererType=void 0;static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.replacements={returnDependencies:()=>({replacements:{dependencyType:"replacement"}}),definition:({dependencyValues:e})=>({setValue:{replacements:e.replacements}})},e.recursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0}}),definition:({dependencyValues:e})=>({setValue:{recursiveReplacements:e.recursiveReplacements}})},e.fullRecursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0,recurseNonStandardComposites:!0}}),definition:({dependencyValues:e})=>({setValue:{fullRecursiveReplacements:e.recursiveReplacements}})},e}static createSerializedReplacements(){return{replacements:[]}}static calculateReplacementChanges(){return[]}get allPotentialRendererTypes(){let e=super.allPotentialRendererTypes;for(let t in this.allChildren){let n=this.allChildren[t].component;for(let t of n.allPotentialRendererTypes)e.includes(t)||e.push(t)}if(this.replacements)for(let t of this.replacements)if("object"==typeof t)for(let n of t.allPotentialRendererTypes)e.includes(n)||e.push(n);return e}}function getVariantsForDescendantsForUniqueVariants({variantIndex:e,serializedComponent:t,componentInfoObjects:n}){let r=t.variants?.descendantVariantComponents;if(void 0===r)return{success:!1};let a=r.map((e=>e.variants.numberOfVariants)),i=enumerateCombinations({numberOfOptionsByIndex:a,maxNumber:e})[e-1],o=[];for(let[e,t]of r.entries()){let r=n.allComponentClasses[t.componentType].getUniqueVariant({serializedComponent:t,variantIndex:i[e]+1,componentInfoObjects:n});if(!r.success)return{succss:!1};o.push(r.desiredVariant)}return{success:!0,desiredVariants:o}}function setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){let r,a;if(e.variants&&(a=e.variants.desiredVariant),r=void 0!==a?.seed?a.seed.toString():t.variantRng().toString().slice(2),t.variantSeed=r,t.variantRng=new t.rngClass(t.variantSeed),a?.subvariants&&n)for(let e in a.subvariants){let t=a.subvariants[e],r=n[e];if(void 0===r)break;r.variants.desiredVariant=t}}class Template extends CompositeComponent{static componentType="template";static treatAsComponentForRecursiveReplacements=!0;static includeBlankStringChildren=!0;static renderedDefault=!1;static assignNamesToReplacements=!0;static createsVariants=!0;static keepChildrenSerialized({serializedComponent:e}){return void 0===e.children?[]:Object.keys(e.children)}static createAttributesObject(){let e=super.createAttributesObject();return e.rendered={createComponentOfType:"boolean",createStateVariable:"rendered",defaultValue:this.renderedDefault,public:!0},e.isResponse={leaveRaw:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:e}){return{setValue:{serializedChildren:e.serializedChildren}}}},e.newNamespace={returnDependencies:()=>({newNamespace:{dependencyType:"attributePrimitive",attributeName:"newNamespace"}}),definition:({dependencyValues:e})=>({setValue:{newNamespace:e.newNamespace}})},e.readyToExpandWhenResolved={returnDependencies:()=>({}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={seed:e.variantSeed,meta:{createdBy:t}},r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n}}}},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,alwaysCreateReplacements:n,flags:r}){if(await e.stateValues.rendered||n){let n=deepClone(await e.state.serializedChildren.value),a=e.attributes.newNamespace?.primitive;if("isResponse"in e.attributes)for(let i of n){if("object"!=typeof i)continue;let n=convertAttributesForComponentType({attributes:{isResponse:e.attributes.isResponse},componentType:i.componentType,componentInfoObjects:t,compositeCreatesNewNamespace:a,flags:r});i.attributes||(i.attributes={}),Object.assign(i.attributes,n)}return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:n,parentName:e.componentName,parentCreatesNewNamespace:a,componentInfoObjects:t,originalNamesAreConsistent:!0}).serializedComponents}}return{replacements:[]}}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}get allPotentialRendererTypes(){let e=super.allPotentialRendererTypes,t=this.potentialRendererTypesFromSerializedComponents(this.serializedChildren);for(let n of t)e.includes(n)||e.push(n);return e}}class MathComponent extends InlineComponent{static componentType="math";static primaryStateVariableForDefinition="value";static variableForPlainMacro="value";static descendantCompositesMustHaveAReplacement=!0;static descendantCompositesDefaultReplacementType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0,toLowerCase:!0,validValues:["text","latex"]},e.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={createComponentOfType:"boolean",createStateVariable:"expand",defaultValue:!1,public:!0},e.displayDigits={createComponentOfType:"integer"},e.displayDecimals={createComponentOfType:"integer"},e.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},e.padZeros={createComponentOfType:"boolean"},e.renderMode={createComponentOfType:"text",createStateVariable:"renderMode",defaultValue:"inline",public:!0,forRenderer:!0},e.unordered={createComponentOfType:"boolean"},e.createVectors={createComponentOfType:"boolean",createStateVariable:"createVectors",defaultValue:!1,public:!0},e.createIntervals={createComponentOfType:"boolean",createStateVariable:"createIntervals",defaultValue:!1,public:!0},e.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},e.targetsAreFunctionSymbols={createComponentOfType:"textList",createStateVariable:"targetsAreFunctionSymbols",defaultValue:[]},e.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0},e.groupCompositeReplacements={createPrimitiveOfType:"boolean",createStateVariable:"groupCompositeReplacements",defaultValue:!0},e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displayDigits"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplayDigits){if(!t.mathListParentDisplayDigits)return{setValue:{displayDigits:e.mathListParentDisplayDigits}};r=!0,n=e.mathListParentDisplayDigits}if(null!==e.numberListParentDisplayDigits){if(!t.numberListParentDisplayDigits)return{setValue:{displayDigits:e.numberListParentDisplayDigits}};r=!0,n=e.numberListParentDisplayDigits}let a=null!==e.numberListParentDisplayDecimals&&!t.numberListParentDisplayDecimals||null!==e.mathListParentDisplayDecimals&&!t.mathListParentDisplayDecimals;if(!a&&null!==e.displayDigitsAttr){if(!t.displayDigitsAttr)return{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}};r=!0,n=e.displayDigitsAttr.stateValues.value}if(!a&&(null===e.displayDecimalsAttr||t.displayDecimalsAttr)&&1===e.mathChildren.length&&0===e.stringChildren.length){if(!t.mathChildren[0]||!t.mathChildren[0].displayDigits)return{setValue:{displayDigits:e.mathChildren[0].stateValues.displayDigits}};r=!0,n=e.mathChildren[0].stateValues.displayDigits}return r?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displayDecimals"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplayDecimals){if(!t.mathListParentDisplayDecimals)return{setValue:{displayDecimals:e.mathListParentDisplayDecimals}};r=!0,n=e.mathListParentDisplayDecimals}if(null!==e.numberListParentDisplayDecimals){if(!t.numberListParentDisplayDecimals)return{setValue:{displayDecimals:e.numberListParentDisplayDecimals}};r=!0,n=e.numberListParentDisplayDecimals}if(null!==e.displayDecimalsAttr){if(!t.displayDecimalsAttr)return{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}};r=!0,n=e.displayDecimalsAttr.stateValues.value}if(1===e.mathChildren.length&&0===e.stringChildren.length){if(!t.mathChildren[0]||!t.mathChildren[0].displayDecimals)return{setValue:{displayDecimals:e.mathChildren[0].stateValues.displayDecimals}};r=!0,n=e.mathChildren[0].stateValues.displayDecimals}return r?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["displaySmallAsZero"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplaySmallAsZero){if(!t.mathListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.mathListParentDisplaySmallAsZero}};r=!0,n=e.mathListParentDisplaySmallAsZero}if(null!==e.numberListParentDisplaySmallAsZero){if(!t.numberListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.numberListParentDisplaySmallAsZero}};r=!0,n=e.numberListParentDisplaySmallAsZero}if(null!==e.displaySmallAsZeroAttr){if(!t.displaySmallAsZeroAttr)return{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}};r=!0,n=e.displaySmallAsZeroAttr.stateValues.value}if(1===e.mathChildren.length&&0===e.stringChildren.length){if(!t.mathChildren[0]||!t.mathChildren[0].displaySmallAsZero)return{setValue:{displaySmallAsZero:e.mathChildren[0].stateValues.displaySmallAsZero}};r=!0,n=e.mathChildren[0].stateValues.displaySmallAsZero}return r?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["padZeros"]},stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentPadZeros){if(!t.mathListParentPadZeros)return{setValue:{padZeros:e.mathListParentPadZeros}};r=!0,n=e.mathListParentPadZeros}if(null!==e.numberListParentPadZeros){if(!t.numberListParentPadZeros)return{setValue:{padZeros:e.numberListParentPadZeros}};r=!0,n=e.numberListParentPadZeros}if(null!==e.padZerosAttr){if(!t.padZerosAttr)return{setValue:{padZeros:e.padZerosAttr.stateValues.value}};r=!0,n=e.padZerosAttr.stateValues.value}if(1===e.mathChildren.length&&0==e.stringChildren.length){if(!t.mathChildren[0]||!t.mathChildren[0].padZeros)return{setValue:{padZeros:e.mathChildren[0].stateValues.padZeros}};r=!0,n=e.mathChildren[0].stateValues.padZeros}return r?{useEssentialOrDefaultValue:{padZeros:{defaultValue:n}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},e.valueShadow={defaultValue:me$3.fromAst(""),hasEssential:!0,essentialVarName:"value",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{valueShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"valueShadow",value:e.valueShadow}]}}},e.unordered={defaultValue:!1,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,returnDependencies:()=>({unorderedAttr:{dependencyType:"attributeComponent",attributeName:"unordered",variableNames:["value"]},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["unordered"]}}),definition({dependencyValues:e}){if(null===e.unorderedAttr){if(e.mathChildren.length>0){let t=e.mathChildren.every((e=>e.stateValues.unordered));return{setValue:{unordered:t}}}return{useEssentialOrDefaultValue:{unordered:!0}}}return{setValue:{unordered:e.unorderedAttr.stateValues.value}}}},e.codePre={returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition({dependencyValues:e}){let t="math",n=!1;do{n=!1;for(let r of e.stringChildren)if(!0===r.includes(t)){n=!0,t+="m";break}}while(n);return{setValue:{codePre:t}}}},e.mathChildrenFunctionSymbols={returnDependencies:()=>({targetsAreFunctionSymbols:{dependencyType:"stateVariable",variableName:"targetsAreFunctionSymbols"},mathChildren:{dependencyType:"child",childGroups:["maths"]}}),definition({dependencyValues:e}){let t=[];if(e.mathChildren.compositeReplacementRange)for(let n of e.mathChildren.compositeReplacementRange)if(e.targetsAreFunctionSymbols.includes(n.target))for(let e=n.firstInd;e<=n.lastInd;e++)t.push(e);return{setValue:{mathChildrenFunctionSymbols:t}}}},e.expressionWithCodes={hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childGroups:["strings","maths"]},stringChildren:{dependencyType:"child",childGroups:["strings"]},mathChildren:{dependencyType:"child",childGroups:["maths"]},format:{dependencyType:"stateVariable",variableName:"format"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},functionSymbols:{dependencyType:"stateVariable",variableName:"functionSymbols"},mathChildrenFunctionSymbols:{dependencyType:"stateVariable",variableName:"mathChildrenFunctionSymbols"},splitSymbols:{dependencyType:"stateVariable",variableName:"splitSymbols"},groupCompositeReplacements:{dependencyType:"stateVariable",variableName:"groupCompositeReplacements"}}),set:e=>null===e?null:convertValueToMathExpression(e),definition:calculateExpressionWithCodes,async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,componentName:r}){let a=e.expressionWithCodes,i=[{setEssentialValue:"expressionWithCodes",value:a}],o=t.stringChildren.length;if(0===o)return{success:!1};if(0===t.mathChildren.length){let e;e="latex"===await n.format?a.toLatex():a.toString(),i.push({setDependency:"stringChildren",desiredValue:e,childIndex:0,variableIndex:0,ignoreChildChangeForComponent:!0});for(let e=1;e<o;e++)i.push({setDependency:"stringChildren",desiredValue:"",childIndex:e,variableIndex:0,ignoreChildChangeForComponent:!0})}else{let e;e="latex"===await n.format?a.toLatex():a.toString();for(let[t,r]of(await n.codesAdjacentToStrings).entries()){let n=e;0===Object.keys(r).length?i.push({setDependency:"stringChildren",desiredValue:"",childIndex:t,variableIndex:0,ignoreChildChangeForComponent:!0}):(r.prevCode&&(n=n.split(r.prevCode)[1]),r.nextCode&&(n=n.split(r.nextCode)[0]),i.push({setDependency:"stringChildren",desiredValue:n,childIndex:t,variableIndex:0,ignoreChildChangeForComponent:!0}))}}return{success:!0,instructions:i}}},e.mathChildrenWithCanBeModified={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value","canBeModified"]}}),definition:({dependencyValues:e})=>({setValue:{mathChildrenWithCanBeModified:e.mathChildren}})},e.unnormalizedValue={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"}}),set:convertValueToMathExpression,defaultValue:me$3.fromAst(""),definition:calculateMathValue,inverseDefinition:invertMath},e.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType,attributeComponentsToShadow:["unordered","displayDigits","displayDecimals","displaySmallAsZero","padZeros","simplify","expand"],addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},returnDependencies:()=>({unnormalizedValue:{dependencyType:"stateVariable",variableName:"unnormalizedValue"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:function({dependencyValues:e}){let t=e.unnormalizedValue,{simplify:n,expand:r,createVectors:a,createIntervals:i}=e;return t=normalizeMathExpression({value:t,simplify:n,expand:r,createVectors:a,createIntervals:i}),{setValue:{value:t}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"unnormalizedValue",desiredValue:e.value}]}}},e.number={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let t=e.value.evaluate_to_constant();return null===t&&(t=NaN),{setValue:{number:t}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"value",desiredValue:me$3.fromAst(e.number)}]}}},e.isNumber={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{setValue:{isNumber:Number.isFinite(e.value.tree)}}}},e.isNumeric={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:"number"}}),definition:function({dependencyValues:e}){return{setValue:{isNumeric:Number.isFinite(e.number)}}}},e.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"}}),definition:function({dependencyValues:e,usedDefault:t}){return{setValue:{valueForDisplay:normalizeMathExpression({value:roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t}),simplify:e.simplify,expand:e.expand})}}}},e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"}}),definition:function({dependencyValues:e,usedDefault:t}){let n,r={};e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(r.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(r.padToDigits=e.displayDigits));try{n=e.valueForDisplay.toLatex(r)}catch(e){n=""}return{setValue:{latex:n}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){return{setValue:{latexWithInputChildren:[e.latex]}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,usedDefault:t}){let n,r={};e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(r.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(r.padToDigits=e.displayDigits));try{n=e.valueForDisplay.toString(r)}catch(e){n=""}return{setValue:{text:n}}},async inverseDefinition({desiredStateVariableValues:e,stateValues:t}){let n,r=getFromText({functionSymbols:await t.functionSymbols,splitSymbols:await t.splitSymbols});try{n=r(e.text)}catch(e){return{success:!1}}return{success:!0,instructions:[{setDependency:"value",desiredValue:n}]}}},e.codesAdjacentToStrings={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childGroups:["strings","maths"]},codePre:{dependencyType:"stateVariable",variableName:"codePre"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:calculateCodesAdjacentToStrings},e.canBeModified={additionalStateVariablesDefined:["constantChildIndices","codeForExpression","inverseMaps","template","mathChildrenMapped"],returnDependencies:()=>({mathChildrenModifiable:{dependencyType:"child",childGroups:["maths"],variableNames:["canBeModified"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition:determineCanBeModified},e.mathChildrenByVectorComponent={returnDependencies:()=>({codePre:{dependencyType:"stateVariable",variableName:"codePre"},mathChildren:{dependencyType:"child",childGroups:["maths"]},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"}}),definition:function({dependencyValues:e}){if(null===e.expressionWithCodes)return{setValue:{mathChildrenByVectorComponent:null}};let t=e.expressionWithCodes.tree,n=e.mathChildren.length;if(0===n||!Array.isArray(t)||!["tuple","vector"].includes(t[0]))return{setValue:{mathChildrenByVectorComponent:null}};let r={},a=0,i=e.codePre+a;for(let o=1;o<t.length;o++){let s=t[o],l=r[o]=[];if(Array.isArray(s)){let t=flattenDeep(s);for(;t.includes(i);)l.push(a),a++,i=e.codePre+a}else s===i&&(l.push(a),a++,i=e.codePre+a);if(a>=n)break}return{setValue:{mathChildrenByVectorComponent:r}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:e}){let t=1,n=e.value.tree;return Array.isArray(n)&&["vector","tuple","list"].includes(n[0])&&(t=n.length-1),{setValue:{nDimensions:t}}}},e.xs={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{value:{dependencyType:"stateVariable",variableName:"value"}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t,arraySize:n}){let r=e.value.tree,a={};if(Array.isArray(r)&&["vector","tuple","list"].includes(r[0]))for(let e=0;e<n[0];e++)a[e]=me$3.fromAst(r[e+1]);else a[0]=e.value;return{setValue:{xs:a}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,stateValues:t,workspace:n,arraySize:r}){n.desiredXs||(n.desiredXs=[]);for(let a=0;a<r[0];a++)void 0!==e.xs[a]?n.desiredXs[a]=convertValueToMathExpression(e.xs[a]):void 0===n.desiredXs[a]&&(n.desiredXs[a]=(await t.xs)[a]);let a;if(r[0]>1){let e=(await t.value).tree[0];a=me$3.fromAst([e,...n.desiredXs.map((e=>e.tree))])}else a=n.desiredXs[0];return{success:!0,instructions:[{setDependency:"value",desiredValue:a}]}}},e.x={isAlias:!0,targetVariableName:"x1"},e.y={isAlias:!0,targetVariableName:"x2"},e.z={isAlias:!0,targetVariableName:"x3"},e}static adapters=[{stateVariable:"number",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text",{componentType:"subsetOfReals",stateVariable:"value",substituteForPrimaryStateVariable:"subsetValue"}]}function calculateExpressionWithCodes({dependencyValues:e,changes:t}){if(!("stringMathChildren"in t&&t.stringMathChildren.componentIdentitiesChanged||"format"in t||"splitSymbols"in t||"functionSymbols"in t||"mathChildrenFunctionSymbols"in t))return{useEssentialOrDefaultValue:{expressionWithCodes:!0}};if(0===e.stringMathChildren.length)return{setValue:{expressionWithCodes:null}};let n,r,a,i,o="",s=0,l="",u=e.stringMathChildren.compositeReplacementRange;e.groupCompositeReplacements&&u.length>0&&(a=0,i=u[a].firstInd);for(let[t,c]of e.stringMathChildren.entries()){if(void 0===n&&t===i){n=a,r=u[a].lastInd,l="";let o=r===t;if(!o)for(let n=t;n<=r;n++)if("string"==typeof e.stringMathChildren[n]){o=!0;break}o&&(u.length>n+1?(a=n+1,i=u[a].firstInd):(a=void 0,i=void 0),n=void 0,r=void 0)}if("string"==typeof c)o+=" "+c+" ";else{let t,r=e.codePre+s;s++,t="latex"===e.format?"\\var{"+r+"}":" "+r+" ",void 0!==n?(l&&(l+=","),l+=t):o+=t}if(t===r){let s=o.trimEnd(),c=!1;if(0===s.length)c=!0;else{let n=s[s.length-1];if(["{","[","(","|",","].includes(n)){let n=e.stringMathChildren[t+1];if("string"!=typeof n)c=!0;else{let t=n.trimStart();if(0===t.length)c=!0;else{let n=t[0];"latex"===e.format&&"\\"===n&&t.length>1&&(n=t[1]),["}","]",")","|",","].includes(n)||(c=!0)}}}else c=!0}c&&(l="("+l+")"),o+=l,l="",u.length>n+1?(a=n+1,i=u[a].firstInd):(a=void 0,i=void 0),n=void 0,r=void 0}}let c=null,p=[...e.functionSymbols];if(p.push(...e.mathChildrenFunctionSymbols.map((t=>e.codePre+t))),""===o)c=me$3.fromAst("");else if("text"===e.format){let t=getFromText({functionSymbols:p,splitSymbols:e.splitSymbols});try{c=t(o)}catch(e){c=me$3.fromAst(""),console.log("Invalid value for a math of text format: "+o)}}else if("latex"===e.format){let t=getFromLatex({functionSymbols:p,splitSymbols:e.splitSymbols});try{c=t(o)}catch(e){c=me$3.fromAst(""),console.log("Invalid value for a math of latex format: "+o)}}return{setValue:{expressionWithCodes:c},setEssentialValue:{expressionWithCodes:c}}}function calculateMathValue({dependencyValues:e}={}){if(null===e.expressionWithCodes)return{setValue:{unnormalizedValue:e.valueShadow}};let t={};for(let[n,r]of e.mathChildren.entries())t[e.codePre+n]=r.stateValues.value;let n=e.expressionWithCodes;return e.mathChildren.length>0&&(n=n.substitute(t)),n=me$3.fromAst(mergeListsWithOtherContainers(n.tree)),{setValue:{unnormalizedValue:n}}}function calculateCodesAdjacentToStrings({dependencyValues:e}){let t,n=[];for(let[r,a]of e.stringMathChildren.entries())if("string"==typeof a){let a=e.stringMathChildren[r+1];if(void 0!==a&&"string"==typeof a)continue;let i={};if(void 0!==t&&("latex"===e.format?i.prevCode="\\var{"+e.codePre+t+"}":i.prevCode=e.codePre+t),void 0!==a){let n=0;void 0!==t&&(n=t+1),"latex"===e.format?i.nextCode="\\var{"+e.codePre+n+"}":i.nextCode=e.codePre+n}n.push(i)}else void 0===t?t=0:t++;return{setValue:{codesAdjacentToStrings:n}}}function determineCanBeModified({dependencyValues:e}){if(!e.modifyIndirectly||e.fixed)return{setValue:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};if(0===e.mathChildrenModifiable.length)return{setValue:{canBeModified:!0,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};let t=[],n=[],r=[],a={};for(let[i,o]of e.mathChildrenModifiable.entries()){let s=e.codePre+i;!0===o.stateValues.canBeModified?(t.push(i),n.push(s)):(r.push(s),a[s]=i)}let i=e.codePre+"expr",o=checkForLinearExpression(me$3.utils.unflattenLeft(e.expressionWithCodes.tree),n,i,r);if(o.foundLinear){let e={},r=o.template,s=new Set;for(let r in o.mappings){e[r]=o.mappings[r];let a=e[r].mathChildSub;if(a){let i=t[n.indexOf(a)];e[r].mathChildInd=i,s.add(Number(i))}}return s.has=s.has.bind(s),{setValue:{canBeModified:!0,constantChildIndices:a,codeForExpression:i,inverseMaps:e,template:r,mathChildrenMapped:s}}}return{setValue:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}}}function checkForLinearExpression(e,t,n,r=[],a=[]){let i=me$3.variables(e);if(i.every((e=>!t.includes(e)))&&i.every((e=>!r.includes(e)))){let e={},t="x"+a.join("_");return e[t]={result:me$3.fromAst(n).simplify(),components:a},{foundLinear:!0,mappings:e,template:t}}if(!Array.isArray(e))return checkForScalarLinearExpression(e,t,n,a);let o=e[0],s=e.slice(1);if("tuple"===o||"vector"===o||"list"===o){let e={mappings:{},template:[o]},i=0;for(let o=0;o<s.length;o++){let l=[...a,o],u=checkForLinearExpression(s[o],t,n,r,l);u.foundLinear?(i++,e.mappings=Object.assign(e.mappings,u.mappings),e.template.push(u.template)):e.template.push("x"+l.join("_"))}return 0===i?{foundLinear:!1}:(e.foundLinear=!0,e)}return checkForScalarLinearExpression(e,t,n,a)}function checkForScalarLinearExpression(e,t,n,r=[]){if("string"==typeof e&&t.includes(e)){let t={},a="x"+r.join("_");return t[a]={result:me$3.fromAst(n).simplify(),components:r,mathChildSub:e},{foundLinear:!0,mappings:t,template:a}}if(!Array.isArray(e))return{foundLinear:!1};let a=e[0],i=e.slice(1);return"-"===a?(n=["-",n],checkForScalarLinearExpression(i[0],t,n,r)):"+"===a?me$3.variables(i[0]).every((e=>!t.includes(e)))?(n=["+",n,["-",i[0]]],checkForScalarLinearExpression(i[1],t,n,r)):me$3.variables(i[1]).every((e=>!t.includes(e)))?(n=["+",n,["-",i[1]]],checkForScalarLinearExpression(i[0],t,n,r)):{foundLinear:!1}:"*"===a?me$3.variables(i[0]).every((e=>!t.includes(e)))?(n=["/",n,i[0]],checkForScalarLinearExpression(i[1],t,n,r)):me$3.variables(i[1]).every((e=>!t.includes(e)))?(n=["/",n,i[1]],checkForScalarLinearExpression(i[0],t,n,r)):{foundLinear:!1}:"/"===a&&me$3.variables(i[1]).every((e=>!t.includes(e)))?(n=["*",n,i[1]],checkForScalarLinearExpression(i[0],t,n,r)):{foundLinear:!1}}async function invertMath({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,workspace:r,overrideFixed:a,componentName:i}){if(!await n.canBeModified&&!a)return{success:!1};let o=t.mathChildren,s=t.stringChildren.length;if(1===o.length&&0===s)return{success:!0,instructions:[{setDependency:"mathChildren",desiredValue:e.unnormalizedValue,childIndex:0,variableIndex:0}]};let l=convertValueToMathExpression(e.unnormalizedValue),u=await preprocessMathInverseDefinition({desiredValue:l,stateValues:n,variableName:"value",workspace:r}),c=u.vectorComponentsNotAffected;if(l=u.desiredValue,0===o.length){let h=[];return s>0?h.push({setDependency:"expressionWithCodes",desiredValue:l}):h.push({setDependency:"valueShadow",desiredValue:l}),{success:!0,instructions:h}}let p=await getExpressionPieces({expression:l,stateValues:n});if(!p)return{success:!1};let d=[],m=[];if(c&&await n.mathChildrenByVectorComponent){let y=await n.mathChildrenByVectorComponent;for(let b of c)y[b]&&m.push(...y[b])}let f=await n.mathChildrenWithCanBeModified;for(let[g,v]of o.entries())if(n.mathChildrenMapped.has(g)&&f[g].stateValues.canBeModified){if(!m.includes(g)){let T=p[g],C={},N=!1,A=await n.constantChildIndices;for(let S in A){let w=A[S];C[S]=o[w].stateValues.value,N=!0}N&&(T=T.substitute(C)),T=T.simplify(),d.push({setDependency:"mathChildren",desiredValue:T,childIndex:g,variableIndex:0})}delete p[g]}if(s>0){let x=t.expressionWithCodes,V=t.codePre,E=V.length;function $(e){return"string"==typeof e&&e.substring(0,E)===V}function _(e){return Array.isArray(e)?flattenDeep(e.slice(1)).some($):$(e)}if(["vector","tuple","list"].includes(x.tree[0])&&!x.tree.slice(1).every(_)){let O=await n.inverseMaps;for(let I in p){let D=O[I];if(void 0!==D.mathChildInd)continue;let R=D.components;x=x.substitute_component(R,p[I])}d.push({setDependency:"expressionWithCodes",desiredValue:x})}}return{success:!0,instructions:d}}async function getExpressionPieces({expression:e,stateValues:t}){let n=await t.template,r=me$3.utils.match(e.tree,n);if(!(r||(r=me$3.utils.match(e.tuples_to_vectors().tree,me$3.fromAst(n).tuples_to_vectors().tree),r||(r=me$3.utils.match(e.to_intervals().tree,me$3.fromAst(n).to_intervals().tree),r||(r=me$3.utils.match(e.tuples_to_vectors().to_intervals().tree,me$3.fromAst(n).tuples_to_vectors().to_intervals().tree),r)))))return!1;let a={};for(let e in r){let n={};n[await t.codeForExpression]=r[e];let i=(await t.inverseMaps)[e];if(void 0!==i){let r=e;void 0!==i.mathChildInd&&(r=i.mathChildInd),a[r]=i.result.substitute(n),a[r]=normalizeMathExpression({value:a[r],simplify:await t.simplify,expand:await t.expand,createVectors:await t.createVectors,createIntervals:await t.createIntervals})}}return a}class Columns extends Text{static componentType="columns";static rendererType="text"}class Title extends TextOrInline{static componentType="title";static rendererType="textOrInline"}class RightHandSide extends MathComponent{static componentType="rightHandSide";static rendererType="math"}class Description extends TextOrInline{static componentType="description";static rendererType=void 0}class Else extends Template{static componentType="else"}class externalContent extends Template{static componentType="externalContent"}var Aliases=Object.freeze({__proto__:null,Columns:Columns,Title:Title,RightHandSide:RightHandSide,Description:Description,Else:Else,externalContent:externalContent});class M$3 extends InlineComponent{static componentType="m";static rendererType="math";static includeBlankStringChildren=!0;static primaryStateVariableForDefinition="latex";static returnChildGroups(){return[{group:"inline",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"",hasEssential:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["latex","text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){if(0===e.inlineChildren.length)return{useEssentialOrDefaultValue:{latex:!0}};let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n:"string"==typeof n.stateValues.latex?t+=n.stateValues.latex:"string"==typeof n.stateValues.text&&(t+=n.stateValues.text);return{setValue:{latex:t}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["latex","text"],variablesOptional:!0},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){if(0===e.inlineChildren.length)return{setValue:{latexWithInputChildren:[e.latex]}};let n=[],r="",a=0;for(let i of e.inlineChildren)"object"!=typeof i?r+=i:t.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"input"})?(r.length>0&&(n.push(r),r=""),n.push(a),a++):"string"==typeof i.stateValues.latex?r+=i.stateValues.latex:"string"==typeof i.stateValues.text&&(r+=i.stateValues.text);return r.length>0&&n.push(r),{setValue:{latexWithInputChildren:n}}}},e.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{renderMode:"inline"}})},e.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let t;try{t=me$3.fromAst(latexToAst.convert(e.latex))}catch(t){return{setValue:{text:e.latex}}}return{setValue:{text:t.toString()}}}},e}}class Me$2 extends M$3{static componentType="me";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.renderMode.definition=()=>({setValue:{renderMode:"display"}}),e}}class Men extends M$3{static componentType="men";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.renderMode.definition=()=>({setValue:{renderMode:"numbered"}}),e.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({equationCounter:{dependencyType:"counter",counterName:"equation"}}),definition:({dependencyValues:e})=>({setValue:{equationTag:String(e.equationCounter)}})},e}}var MMeMen=Object.freeze({__proto__:null,M:M$3,Me:Me$2,Men:Men});class Md extends InlineComponent{static componentType="md";static rendererType="math";static primaryStateVariableForDefinition="latex";static returnChildGroups(){return[{group:"mrows",componentTypes:["mrow"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mrowChildNames={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"]}}),definition:({dependencyValues:e})=>({setValue:{mrowChildNames:e.mrowChildren.map((e=>e.componentName))}})},e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"",hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"],variableNames:["latex","hide","equationTag","numbered"]}}),definition:function({dependencyValues:e}){if(e.mrowChildren.length>0){let t="";for(let n of e.mrowChildren)n.stateValues.hide||(t.length>0&&(t+="\\\\"),n.stateValues.numbered?t+=`\\tag{${n.stateValues.equationTag}}`:t+="\\notag ",t+=n.stateValues.latex);return{setValue:{latex:t}}}return{useEssentialOrDefaultValue:{latex:!0}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childGroups:["mrows"],variableNames:["latexWithInputChildren","hide","equationTag","numbered"]},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){if(e.mrowChildren.length>0){let t=[],n=0,r="";for(let a of e.mrowChildren)if(!a.stateValues.hide){r.length>0&&(r+="\\\\"),a.stateValues.numbered?r+=`\\tag{${a.stateValues.equationTag}}`:r+="\\notag ";for(let e of a.stateValues.latexWithInputChildren)"number"==typeof e?(r.length>0&&(t.push(r),r=""),t.push(n),n++):r+=e}return r.length>0&&t.push(r),{setValue:{latexWithInputChildren:t}}}return{setValue:{latexWithInputChildren:[e.latex]}}}},e.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let t;try{t=e.latex.replaceAll("\\notag","").replaceAll("\\amp","").split("\\\\").map((e=>me$3.fromAst(latexToAst.convert(e)).toString())).join("\\\\\n")}catch(t){return{setValue:{text:e.latex}}}return{setValue:{text:t}}}},e.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{renderMode:"align"}})},e.numbered={returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!1}})},e}}class Mdn extends Md{static componentType="mdn";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numbered={returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!0}})},e}}class Mrow extends M$3{static componentType="mrow";static createAttributesObject(){let e=super.createAttributesObject();return e.number={createComponentOfType:"boolean"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.renderMode.definition=()=>({setValue:{renderMode:"display"}}),e.numbered={forRenderer:!0,returnDependencies:()=>({parentNumbered:{dependencyType:"parentStateVariable",variableName:"numbered"},numberAttr:{dependencyType:"attributeComponent",attributeName:"number",variableNames:["value"]}}),definition({dependencyValues:e}){let t;return t=null!==e.numberAttr?e.numberAttr.stateValues.value:e.parentNumbered,{setValue:{numbered:t}}}},e.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["numbered"],returnDependencies:({stateValues:e})=>e.numbered?{equationCounter:{dependencyType:"counter",counterName:"equation"}}:{},definition:({dependencyValues:e})=>void 0!==e.equationCounter?{setValue:{equationTag:String(e.equationCounter)}}:{setValue:{equationTag:null}}},e}}var MdMdnMrow=Object.freeze({__proto__:null,Md:Md,Mdn:Mdn,Mrow:Mrow});function periodicSetEquality(e,t,{min_elements_match:n=3,match_partial:r=!1}={}){if(!is_periodic_set(e))return!1;if(is_periodic_set(t)){if(r){let n=contained_in(e.tree,t.tree,r);if(!1===n)return 0;let a=contained_in(t.tree,e.tree,r);return!1===a?0:!0===n?!0===a?1:a:!0===a?n:Math.min(n,a)}return contained_in(e.tree,t.tree,r)&&contained_in(t.tree,e.tree,r)}{let a=e.tree.slice(1);if(a.length>1)return!1;let i=me$3.fromAst(a[0][1]).evaluate_to_constant(),o=me$3.fromAst(["apply","abs",a[0][2]]).evaluate_to_constant();if(!Number.isFinite(i)||!Number.isFinite(o))return!1;let s=a[0][3],l=a[0][4];if(s!==-1/0||l!==1/0)return!1;if("list"!==t.tree[0])return!1;let u=t.tree.slice(1),c=0;if("ldots"===u[0][0])c++,u=u.slice(1);else if(!r)return!1;if("ldots"===u[u.length-1][0])c++,u=u.slice(0,u.length-1);else if(!r)return!1;let p=u.length;if(0===p)return!1;if(!r&&p<n)return!1;u=u.map((e=>me$3.fromAst(e).evaluate_to_constant())).map((e=>Number.isFinite(e)?e:NaN));let d=me$3.math.mod(u[0]-i,o);if(!(me$3.math.min(d,o-d)<1e-10*o))return!1;let m=1;for(let e=1;e<p;e++){if(!(Math.abs(u[e]-u[e-1]-o)<1e-10*o)){if(!r)return!1;break}m++}if(m===p&&2===c&&p>=n)return!0;let f=m/Math.max(p,n);return f*=(9+c/2)/10,f}}function is_periodic_set(e){var t=e.tree;if(!Array.isArray(t))return!1;if("periodic_set"!==t[0])return!1;var n=t.slice(1);for(var r of n){if(!Array.isArray(r))return!1;if("tuple"!==r[0])return!1;if(5!==r.length)return!1}return!0}function contained_in(e,t,n){if("periodic_set"===e[0]){if(n){let r=0;for(let a of e.slice(1)){let e=contained_in(a,t,n);!0===e?r++:!1!==e&&(r+=e)}let a=e.length-1;return r===a||0!==r&&r/a}return e.slice(1).every((e=>contained_in(e,t)))}var r=e[1],a=e[2],i=e[3],o=e[4];if(i!==-1/0||o!==1/0)return!1;r=me$3.fromAst(["/",r,a]).evaluate_to_constant();var s=t.slice(1),l=[];for(let e=0;e<s.length;e++){let t=s[e][3],n=s[e][4];if(t!==-1/0||n!==1/0)return!1;let r=me$3.fromAst(["/",s[e][1],a]).evaluate_to_constant(),i=me$3.fromAst(["apply","abs",["/",s[e][2],a]]).evaluate_to_constant();if("number"!=typeof i)return!1;let o=me$3.math.fraction(i),u=o.n;if(u>1e3)return!1;let c=o.d;l.push([u,c,r,i])}for(l.sort();;){if(1!==l[0][0])break;let e=l[0][2],t=l[0][3],n=me$3.fromAst(["+",e,["-",r]]).evaluate_to_constant();if(Number.isFinite(n)&&Number.isFinite(t)&&(n=me$3.math.mod(n,t),me$3.math.min(n,t-n)<1e-10*t))return!0;if(l.splice(0,1),0===l.length)return!1}var u=[...new Set(l.map((e=>e[0])))];let c=0;for(let e of u){let t=l.map((function(t,n){let r=e/t[0];return Number.isInteger(r)?[t[0],r,n]:void 0})).filter((e=>e)),a=[];for(let n of t){let t=n[0],i=n[1],o=n[2],s=l[o][2],u=l[o][3];for(let n=0;n<t;n++){let o=me$3.fromAst(["+",s,["-",["+",r,n]]]).evaluate_to_constant();if(Number.isFinite(o)&&Number.isFinite(u)&&(o=me$3.math.mod(o,u),me$3.math.min(o,u-o)<1e-10*u)){for(let e=0;e<i;e++)a[n+e*t]=!0;let r=!0;for(let t=0;t<e;t++)if(!a[t]){r=!1;break}if(r)return!0;break}}}if(n){let t=0;for(let n=0;n<e;n++)a[n]&&t++;t/=e,t>c&&(c=t)}}return!!(n&&c>0)&&c}function checkEquality({object1:e,object2:t,isUnordered:n=!1,partialMatches:r=!1,matchByExactPositions:a=!1,symbolicEquality:i=!1,simplify:o="none",expand:s=!1,allowedErrorInNumbers:l=0,includeErrorInNumberExponents:u=!1,allowedErrorIsAbsolute:c=!1,nSignErrorsMatched:p=0,nPeriodicSetMatchesRequired:d=3}){let m=!1;if(e instanceof me$3.class){if(m=!0,!(t instanceof me$3.class)){if("number"!=typeof t&&"string"!=typeof t)return{fraction_equal:0};t=me$3.fromAst(t)}}else if(t instanceof me$3.class){if(m=!0,"number"!=typeof e&&"string"!=typeof e)return{fraction_equal:0};e=me$3.fromAst(e)}let f,h=function(e){return e instanceof me$3.class||(e=me$3.fromAst(e)),e=e.normalize_function_names().normalize_applied_functions(),"none"===o?l>0&&(e=e.constants_to_floats()):e="numberspreserveorder"===o?e.evaluate_numbers({max_digits:1/0,skip_ordering:!0}):"number"===o?e.evaluate_numbers({max_digits:1/0}):e.evaluate_numbers({max_digits:1/0,evaluate_functions:!0}),normalizeMathExpression({value:e,simplify:o,expand:s})};if(f=m?i?function(e,t){let n=h(e),r=h(t);if(p>0){r=JSON.parse(JSON.stringify(r),me$3.reviver);let e=function(e,t){return!e.variables().includes("")&&!t.variables().includes("")&&(e=h(e)).equalsViaSyntax(t,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})};return n.tree.im||r.tree.im?{fraction_equal:0}:{fraction_equal:me$3.equalSpecifiedSignErrors(r,n,{equalityFunction:e,n_sign_errors:p})?1:0}}if(n.variables().includes("")||r.variables().includes(""))return{fraction_equal:0};if(n.tree.im||r.tree.im)return{fraction_equal:0};return{fraction_equal:n.equalsViaSyntax(r,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})?1:0}}:function(e,t){let n=e,r=t;if(e instanceof me$3.class||(n=me$3.fromAst(e)),t instanceof me$3.class||(r=me$3.fromAst(t)),p>0){r=JSON.parse(JSON.stringify(r),me$3.reviver);let e=function(e,t){return e.equals(t,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})};return n.tree.im||r.tree.im?{fraction_equal:0}:{fraction_equal:me$3.equalSpecifiedSignErrors(r,n,{equalityFunction:e,n_sign_errors:p})?1:0}}if(n.tree.im||r.tree.im)return{fraction_equal:0};return{fraction_equal:n.equals(r,{allowed_error_in_numbers:l,include_error_in_number_exponents:u,allowed_error_is_absolute:c})?1:0}}:(e,t)=>({fraction_equal:deepCompare(e,t)?1:0}),m){let i=e.tree[0],o=t.tree[0];if("periodic_set"===i||"periodic_set"===o){let n=e,a=t;"periodic_set"!==i&&(n=t,a=e);let o=periodicSetEquality(n,a,{match_partial:r,min_elements_match:d});return!0===o?{fraction_equal:1}:!1===o?{fraction_equal:0}:{fraction_equal:o}}if("list"===i)e=e.tree.slice(1),t="list"===o?t.tree.slice(1):[t.tree];else if("list"===o)t=t.tree.slice(1),e=[e.tree];else if("vector"===i){if(e=e.tree.slice(1),"interval"===o||"matrix"===o||"array"===o||"set"===o)return{fraction_equal:0};t="tuple"===o||"vector"===o?t.tree.slice(1):[t.tree]}else if("vector"===o){if(t=t.tree.slice(1),"interval"===i||"matrix"===i||"array"===i||"set"===i)return{fraction_equal:0};e="tuple"===i?e.tree.slice(1):[e.tree]}else if("interval"===i){a=!0;let n=e.tree[2],r=n[1],i=n[2];if(e=e.tree[1].slice(1),"matrix"===o||"set"===o)return{fraction_equal:0};if("tuple"===o){let e=t.tree.slice(1);if(2!==e.length||!1!==r||!1!==i)return{fraction_equal:0};t=e}else if("array"===o){let e=t.tree.slice(1);if(2!==e.length||!0!==r||!0!==i)return{fraction_equal:0};t=e}else{if("interval"!==o)return{fraction_equal:0};{let e=t.tree[2];if(e[1]!==r||e[2]!==i)return{fraction_equal:0};t=t.tree[1].slice(1)}}}else if("interval"===o){a=!0;let n=t.tree[2],r=n[1],o=n[2];if(t=t.tree[1].slice(1),"matrix"===i||"set"===i)return{fraction_equal:0};if("tuple"===i){let t=e.tree.slice(1);if(2!==t.length||!1!==r||!1!==o)return{fraction_equal:0};e=t}else{if("array"!==i)return{fraction_equal:0};{let t=e.tree.slice(1);if(2!==t.length||!0!==r||!0!==o)return{fraction_equal:0};e=t}}}else if("matrix"===i){if("matrix"!==o)return{fraction_equal:0};e=e.tree.slice(1),t=t.tree.slice(1)}else{if("matrix"===o)return{fraction_equal:0};if("set"===i){let r=[];for(let t of e.tree.slice(1))r.some((e=>1===f(e,t).fraction_equal))||r.push(t);if(e=r,n=!0,"tuple"===o||"array"===o)return{fraction_equal:0};if("set"===o){r=[];for(let e of t.tree.slice(1))r.some((t=>1===f(t,e).fraction_equal))||r.push(e);t=r}else t=[t.tree]}else if("set"===o){let r=[];for(let e of t.tree.slice(1))r.some((t=>1===f(t,e).fraction_equal))||r.push(e);if(t=r,n=!0,"tuple"===i||"array"===i)return{fraction_equal:0};e=[e.tree]}else if("tuple"===i){if(e=e.tree.slice(1),"array"===o)return{fraction_equal:0};t="tuple"===o?t.tree.slice(1):[t.tree]}else if("tuple"===o){if(t=t.tree.slice(1),"array"===i)return{fraction_equal:0};e=[e.tree]}else if("array"===i)e=e.tree.slice(1),t="array"===o?t.tree.slice(1):[t.tree];else{if("array"!==o)return f(e.tree,t.tree);t=t.tree.slice(1),e=[e.tree]}}}else if(Array.isArray(e))Array.isArray(t)||(t="string"==typeof t&&e.every((e=>"string"==typeof e&&!e.includes(",")))?t.split(",").map((e=>e.trim())):[t]);else{if(!Array.isArray(t))return f(e,t);e="string"==typeof e&&t.every((e=>"string"==typeof e&&!e.includes(",")))?e.split(",").map((e=>e.trim())):[e]}let y=e.length,b=t.length,g={fraction_equal:0};if(a&&(n=!1),!n){let n=0,u=Math.min(y,b);for(let r=0;r<u;r++){n+=checkEquality({object1:me$3.fromAst(e[r]),object2:me$3.fromAst(t[r]),isUnordered:!1,partialMatches:!1,matchByExactPositions:!1,symbolicEquality:i,simplify:o,expand:s,allowedErrorInNumbers:l,allowedErrorIsAbsolute:c,nSignErrorsMatched:p,nPeriodicSetMatchesRequired:d}).fraction_equal}if(y===b&&y===n)return g.fraction_equal=1,g;if(!r)return g;if(a)return g.fraction_equal=n/Math.max(y,b),g;let m=Array.from(Array(y+1),(e=>Array(b+1).fill(0)));for(let n=0;n<y;n++)for(let r=0;r<b;r++){let a=checkEquality({object1:me$3.fromAst(e[n]),object2:me$3.fromAst(t[r]),isUnordered:!1,partialMatches:!1,matchByExactPositions:!1,symbolicEquality:i,simplify:o,expand:s,allowedErrorInNumbers:l,allowedErrorIsAbsolute:c,nSignErrorsMatched:p,nPeriodicSetMatchesRequired:d});m[n+1][r+1]=Math.max(m[n][r]+a.fraction_equal,m[n+1][r],m[n][r+1])}let f=m[y][b];return g.fraction_equal=f/Math.max(y,b),g}let v=new Set,T=0;for(let n of e){let e=-1,r=0;for(let[a,u]of t.entries()){if(v.has(a))continue;let t=checkEquality({object1:me$3.fromAst(n),object2:me$3.fromAst(u),isUnordered:!1,partialMatches:!1,matchByExactPositions:!1,symbolicEquality:i,simplify:o,expand:s,allowedErrorInNumbers:l,allowedErrorIsAbsolute:c,nSignErrorsMatched:p,nPeriodicSetMatchesRequired:d});t.fraction_equal>r&&(r=t.fraction_equal,e=a)}-1!==e&&(T+=r,v.add(e))}return y===b&&y===T?(g.fraction_equal=1,g):r?(g.fraction_equal=T/Math.max(y,b),g):g}const appliedFunctionSymbolsWithBooleanOperators=[...appliedFunctionSymbolsDefault,"isnumber","isinteger"];var fromTextUnsplit=getFromText({splitSymbols:!1,appliedFunctionSymbols:appliedFunctionSymbolsWithBooleanOperators});function buildParsedExpression({dependencyValues:e,componentInfoObjects:t}){let n="comp",r=!0;for(;r;){r=!1;for(let t of e.stringChildren)if(t.includes(n)){r=!0,n+="p";break}}let a="",i=0,o=[],s=0;for(let r of e.allChildren)if("string"==typeof r)a+=" "+e.stringChildren[s]+" ",s++;else{let e=n+i;a+=" "+e+" ",t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"math"})||t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"mathList"})||t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"number"})||t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"numberList"})||o.push(e),i+=1}let l=null;try{l=fromTextUnsplit(a)}catch(e){}return l&&(l=me$3.fromAst(splitSymbolsIfMath({logicTree:l.tree,nonMathCodes:o}))),{setValue:{codePre:n,parsedExpression:l}}}function evaluateLogic({logicTree:e,canOverrideUnorderedCompare:t=!1,dependencyValues:n,valueOnInvalid:r=0}){let a=e=>evaluateLogic({logicTree:e,canOverrideUnorderedCompare:t,dependencyValues:n,valueOnInvalid:r});if(!Array.isArray(e)){if("string"==typeof e){let t=n.booleanChildrenByCode[e];if(t)return n.matchPartial&&void 0!==t.stateValues.fractionSatisfied?t.stateValues.fractionSatisfied:t.stateValues.value?1:0;{let t=n.mathChildrenByCode[e];if(t){let e=t.stateValues.value.simplify().evaluate_to_constant();return Number.isFinite(e)&&0!==e?1:0}{let t=n.numberChildrenByCode[e];if(t){let e=t.stateValues.value;return Number.isFinite(e)&&0!==e?1:0}if("true"===e.toLowerCase())return 1;if("false"===e.toLowerCase())return 0}}}else if("number"==typeof e)return 0===e?0:1;return console.warn("Invalid format for boolean condition"),r}let i=e[0],o=e.slice(1);if("not"===i)return 1!==o.length?(console.warn("Invalid format for boolean condition"),r):0===a(o[0])?1:0;if("and"===i)return n.matchPartial?o.reduce(((e,t)=>e+a(t)),0)/o.length:o.every((e=>1===a(e)))?1:0;if("or"===i)return n.matchPartial?o.reduce(((e,t)=>Math.max(a(t),e)),0):o.some((e=>1===a(e)))?1:0;let s=!1,l=!1,u=!1,c=!1;o.forEach((function(e){"string"==typeof e&&(e in n.mathChildrenByCode||e in n.mathListChildrenByCode||e in n.numberChildrenByCode||e in n.numberListChildrenByCode?s=!0:e in n.textChildrenByCode||e in n.textListChildrenByCode?l=!0:e in n.booleanChildrenByCode||e in n.booleanListChildrenByCode?u=!0:e in n.otherChildrenByCode&&(c=!0))}));let p,d=function(e){if("string"==typeof e){let t=n.mathChildrenByCode[e];return void 0!==t?t.stateValues.value.tree:(t=n.mathListChildrenByCode[e],void 0!==t?["list",...t.stateValues.maths.map((e=>e.tree))]:(t=n.numberChildrenByCode[e],void 0!==t?t.stateValues.value:(t=n.numberListChildrenByCode[e],void 0!==t?["list",...t.stateValues.numbers]:e)))}return Array.isArray(e)?[e[0],...e.slice(1).map(d)]:e};if("apply"===i&&["isnumber","isinteger"].includes(o[0])){if(l||u||c)return 0;let e=me$3.fromAst(d(o[1])).simplify().evaluate_to_constant();if(!Number.isFinite(e))return 0;if("isnumber"===o[0])return 1;{let t=Math.round(e);return Math.abs(t-e)<=1e-15*Math.abs(e)?1:0}}if(!["=","ne","<",">","le","ge","lts","gts","in","notin"].includes(i)){if(l||u||c)return console.warn("Invalid format for boolean condition"),r;let t=me$3.fromAst(d(e)).simplify().evaluate_to_constant();return Number.isFinite(t)&&0!==t?1:0}if(u){if(s||l||c)return console.warn("Invalid format for boolean condition"),r;let e=!1,a=!1;if(o=o.map((function(t){if("string"==typeof t){let i=n.booleanChildrenByCode[t];return void 0!==i?i.stateValues.value:(i=n.booleanListChildrenByCode[t],void 0!==i?(i.stateValues.unordered&&(a=!0),i.stateValues.booleans):"true"===(t=t.toLowerCase().trim())||"t"===t||"false"!==t&&"f"!==t&&(console.warn("Invalid format for boolean condition"),e=!0,r))}return console.warn("Invalid format for boolean condition"),e=!0,r})),e)return r;let u=n.unorderedCompare;if(t&&a&&(u=!0),"="===i){let e=o[0];if(n.matchPartial){let t=o.slice(1).map((t=>checkEquality({object1:e,object2:t,isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}))),r=t.reduce(((e,t)=>e+t.fraction_equal),0);return r/t.length}return o.slice(1).every((t=>1===checkEquality({object1:e,object2:t,isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}).fraction_equal))?1:0}if("ne"===i){if(2!==o.length)return console.warn("Invalid format for boolean condition"),r;return 0===checkEquality({object1:o[0],object2:o[1],isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}).fraction_equal?1:0}return console.warn("Invalid format for boolean condition"),r}if(l){if(s||c)return console.warn("Invalid format for boolean condition"),r;let e=!1,a=!1,l=function(t,r=!1){if("string"==typeof t){let e=n.textChildrenByCode[t];return void 0!==e?e.stateValues.value.trim():(e=n.textListChildrenByCode[t],void 0!==e?(e.stateValues.unordered&&(a=!0),e.stateValues.texts.map((e=>e.trim()))):t.trim())}return"number"==typeof t?t.toString():r&&Array.isArray(t)&&"*"===t[0]?t.slice(1).map(l).join(" "):(console.warn("Invalid format for boolean condition"),e=!0,"")};if(o=o.map((e=>l(e,!0))),e)return r;let u=n.unorderedCompare;if(t&&a&&(u=!0),"="===i){let e=o[0];if(n.matchPartial){let t=o.slice(1).map((t=>checkEquality({object1:e,object2:t,isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}))),r=t.reduce(((e,t)=>e+t.fraction_equal),0);return r/t.length}return o.slice(1).every((t=>1===checkEquality({object1:e,object2:t,isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}).fraction_equal))?1:0}if("ne"===i){if(2!==o.length)return console.warn("Invalid format for boolean condition"),0;return 0===checkEquality({object1:o[0],object2:o[1],isUnordered:u,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions}).fraction_equal?1:0}return console.warn("Invalid format for boolean condition"),r}if(c){if(s)return console.warn("Invalid format for boolean condition"),r;let e=!1;return o=o.map((function(t){if("string"==typeof t){let e=n.otherChildrenByCode[t];if(void 0!==e)return e.stateValues.value}return console.warn("Invalid format for boolean condition"),e=!0,null})),e?r:"="===i?o.slice(1).every((e=>deepCompare(e,o[0])))?1:0:"ne"===i?2!==o.length?(console.warn("Invalid format for boolean condition"),0):deepCompare(o[0],o[1])?0:1:(console.warn("Invalid format for boolean condition"),0)}"lts"!==i&&"gts"!==i||(p=o[1].slice(1),o=o[0].slice(1));let m=!1,f=function(e){if("string"==typeof e){let t=n.mathChildrenByCode[e];return void 0!==t?(t.stateValues.unordered&&(m=!0),t.stateValues.value.tree):(t=n.mathListChildrenByCode[e],void 0!==t?(t.stateValues.unordered&&(m=!0),["list",...t.stateValues.maths.map((e=>e.tree))]):(t=n.numberChildrenByCode[e],void 0!==t?t.stateValues.value:(t=n.numberListChildrenByCode[e],void 0!==t?(t.stateValues.unordered&&(m=!0),["list",...t.stateValues.numbers]):e)))}return Array.isArray(e)?[e[0],...e.slice(1).map(f)]:e},h=o.map((function(e){return me$3.fromAst(f(e))})),y=n.unorderedCompare;if(t&&m&&(y=!0),"="===i){let e=h[0];if(Number.isNaN(e.tree))return h.slice(1).every((e=>Number.isNaN(e.tree)))?1:0;if(n.matchPartial){let t=h.slice(1).map((t=>checkEquality({object1:e,object2:t,isUnordered:y,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions,symbolicEquality:n.symbolicEquality,simplify:n.simplifyOnCompare,expand:n.expandOnCompare,allowedErrorInNumbers:n.allowedErrorInNumbers,includeErrorInNumberExponents:n.includeErrorInNumberExponents,allowedErrorIsAbsolute:n.allowedErrorIsAbsolute,nSignErrorsMatched:n.nSignErrorsMatched,nPeriodicSetMatchesRequired:n.nPeriodicSetMatchesRequired}))),r=t.reduce(((e,t)=>e+t.fraction_equal),0);return r/t.length}return h.slice(1).every((t=>1===checkEquality({object1:e,object2:t,isUnordered:y,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions,symbolicEquality:n.symbolicEquality,simplify:n.simplifyOnCompare,expand:n.expandOnCompare,allowedErrorInNumbers:n.allowedErrorInNumbers,includeErrorInNumberExponents:n.includeErrorInNumberExponents,allowedErrorIsAbsolute:n.allowedErrorIsAbsolute,nSignErrorsMatched:n.nSignErrorsMatched,nPeriodicSetMatchesRequired:n.nPeriodicSetMatchesRequired}).fraction_equal))?1:0}if("ne"===i){return 0===checkEquality({object1:h[0],object2:h[1],isUnordered:y,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions,symbolicEquality:n.symbolicEquality,simplify:n.simplifyOnCompare,expand:n.expandOnCompare,allowedErrorInNumbers:n.allowedErrorInNumbers,includeErrorInNumberExponents:n.includeErrorInNumberExponents,allowedErrorIsAbsolute:n.allowedErrorIsAbsolute,nSignErrorsMatched:n.nSignErrorsMatched,nPeriodicSetMatchesRequired:n.nPeriodicSetMatchesRequired}).fraction_equal?1:0}if("in"===i||"notin"===i){let e=h[0],t=h[1].tree;if(!Array.isArray(t)||"set"!==t[0])return console.warn("Invalid format for boolean condition"),r;if(n.matchPartial){let r=t.slice(1).map((t=>checkEquality({object1:e,object2:me$3.fromAst(t),isUnordered:y,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions,symbolicEquality:n.symbolicEquality,simplify:n.simplifyOnCompare,expand:n.expandOnCompare,allowedErrorInNumbers:n.allowedErrorInNumbers,includeErrorInNumberExponents:n.includeErrorInNumberExponents,allowedErrorIsAbsolute:n.allowedErrorIsAbsolute,nSignErrorsMatched:n.nSignErrorsMatched,nPeriodicSetMatchesRequired:n.nPeriodicSetMatchesRequired}))),a=r.reduce(((e,t)=>Math.max(e,t.fraction_equal)),0);return"in"===i?a:1-a}{let r=t.slice(1).some((t=>1===checkEquality({object1:e,object2:me$3.fromAst(t),isUnordered:y,partialMatches:n.matchPartial,matchByExactPositions:n.matchByExactPositions,symbolicEquality:n.symbolicEquality,simplify:n.simplifyOnCompare,expand:n.expandOnCompare,allowedErrorInNumbers:n.allowedErrorInNumbers,includeErrorInNumberExponents:n.includeErrorInNumberExponents,allowedErrorIsAbsolute:n.allowedErrorIsAbsolute,nSignErrorsMatched:n.nSignErrorsMatched,nPeriodicSetMatchesRequired:n.nPeriodicSetMatchesRequired}).fraction_equal));return"in"===i?r?1:0:r?0:1}}let b=h.map((e=>e.simplify().evaluate_to_constant()));if(b.some((e=>null===e||Number.isNaN(e))))return 0;if("<"===i)return b[0]<b[1]?1:0;if(">"===i)return b[0]>b[1]?1:0;if("le"===i)return b[0]<=b[1]?1:0;if("ge"===i)return b[0]>=b[1]?1:0;for(let e=0;e<p.length;e++)if("lts"===i){if(!0===p[e]){if(!(b[e]<b[e+1]))return 0}else if(!(b[e]<=b[e+1]))return 0}else if(!0===p[e]){if(!(b[e]>b[e+1]))return 0}else if(!(b[e]>=b[e+1]))return 0;return 1}function splitSymbolsIfMath({logicTree:e,nonMathCodes:t,foundNonMath:n=!1,init:r=!0}){if(!Array.isArray(e))return"string"!=typeof e||n||r?e:me$3.fromAst(textToAst$1.convert(e)).tree;let a=e[0],i=e.slice(1);return["and","not","or"].includes(a)?"apply"===a?[a,i[0],...i.slice(1).map((e=>splitSymbolsIfMath({logicTree:e,nonMathCodes:t,foundNonMath:n,init:r})))]:[a,...i.map((e=>splitSymbolsIfMath({logicTree:e,nonMathCodes:t,foundNonMath:n,init:r})))]:(i.some((e=>t.includes(e)))&&(n=!0),"apply"===a?[a,i[0],...i.slice(1).map((e=>splitSymbolsIfMath({logicTree:e,nonMathCodes:t,foundNonMath:n,init:!1})))]:[a,...i.map((e=>splitSymbolsIfMath({logicTree:e,nonMathCodes:t,foundNonMath:n,init:!1})))])}class BooleanComponent extends InlineComponent{static componentType="boolean";static variableForPlainMacro="value";static descendantCompositesMustHaveAReplacement=!0;static descendantCompositesDefaultReplacementType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0},e.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0},e.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0},e.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0},e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"comparableTypes",componentTypes:["math","mathList","number","numberList","text","textList","boolean","booleanList","orbitalDiagram"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]}}),definition:buildParsedExpression},e.mathChildrenByCode={additionalStateVariablesDefined:["mathListChildrenByCode","numberChildrenByCode","numberListChildrenByCode","textChildrenByCode","textListChildrenByCode","booleanChildrenByCode","booleanListChildrenByCode","otherChildrenByCode"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"],variableNames:["value","texts","maths","numbers","booleans","fractionSatisfied","unordered"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:e,componentInfoObjects:t}){let n={},r={},a={},i={},o={},s={},l={},u={},c={},p=0,d=e.codePre;for(let m of e.allChildren)if("string"!=typeof m){let e=d+p;t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"math"})?n[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"mathList"})?r[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"number"})?a[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"numberList"})?i[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"text"})?o[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"textList"})?s[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"boolean"})?l[e]=m:t.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"booleanList"})?u[e]=m:c[e]=m,p+=1}return{setValue:{mathChildrenByCode:n,mathListChildrenByCode:r,numberChildrenByCode:a,numberListChildrenByCode:i,textChildrenByCode:o,textListChildrenByCode:s,booleanChildrenByCode:l,booleanListChildrenByCode:u,otherChildrenByCode:c}}}},e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean",attributeComponentsToShadow:["fixed"]},forRenderer:!0,hasEssential:!0,defaultValue:!1,set:Boolean,returnDependencies:()=>({symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},allChildren:{dependencyType:"child",childGroups:["strings","comparableTypes"],variableNames:["value"],variablesOptional:!0},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},numberListChildrenByCode:{dependencyType:"stateVariable",variableName:"numberListChildrenByCode"},otherChildrenByCode:{dependencyType:"stateVariable",variableName:"otherChildrenByCode"}}),definition({dependencyValues:e,usedDefault:t}){if(0===e.allChildren.length)return{useEssentialOrDefaultValue:{value:!0}};if(null===e.parsedExpression)return{setValue:{value:!1}};let n=t.unorderedCompare;return{setValue:{value:1===evaluateLogic({logicTree:e.parsedExpression.tree,canOverrideUnorderedCompare:n,dependencyValues:e})}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t,componentInfoObjects:n}){if(0===t.allChildren.length)return{success:!0,instructions:[{setEssentialValue:"value",value:Boolean(e.value)}]};if(1===t.allChildren.length){let r=t.allChildren[0];if("string"==typeof r)return{success:!0,instructions:[{setDependency:"allChildren",desiredValue:e.value.toString(),childIndex:0,variableIndex:0}]};if(n.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"boolean"}))return{success:!0,instructions:[{setDependency:"allChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}}return{success:!1}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.value?"true":"false"}}},inverseDefinition({desiredStateVariableValues:e}){let t,n=String(e.text).toLowerCase();return"true"===n?t=!0:"false"===n&&(t=!1),void 0!==t?{success:!0,instructions:[{setDependency:"value",desiredValue:t}]}:{success:!1}}},e}static adapters=["text"]}class BooleanOperator extends BooleanComponent{static componentType="_booleanOperator";static rendererType="boolean";static descendantCompositesMustHaveAReplacement=!1;static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e)).map((e=>({componentType:"boolean",children:[e]})))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"booleans",componentTypes:["boolean"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();delete e.parsedExpression,delete e.mathChildrenByCode;let t=this;return e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({booleanChildren:{dependencyType:"child",childGroups:["booleans"],variableNames:["value"]}}),definition:function({dependencyValues:e}){return{setValue:{value:t.applyBooleanOperator(e.booleanChildren.map((e=>e.stateValues.value)))}}}},e}}class BooleanOperatorOneInput extends BooleanComponent{static componentType="_booleanOperatorOneInput";static rendererType="boolean";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=this;return renameStateVariable({stateVariableDefinitions:e,oldName:"value",newName:"valuePreOperator"}),e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"valuePreOperator"}}),definition:function({dependencyValues:e}){return{setValue:{value:t.applyBooleanOperator(e.value)}}}},e}}class Not extends BooleanOperatorOneInput{static componentType="not";static applyBooleanOperator(e){return!e}}class And extends BooleanOperator{static componentType="and";static applyBooleanOperator(e){return e.every((e=>e))}}class Or$1 extends BooleanOperator{static componentType="or";static applyBooleanOperator(e){return e.some((e=>e))}}class Xor extends BooleanOperator{static componentType="xor";static applyBooleanOperator(e){return 1===e.reduce(((e,t)=>e+t),0)}}var BooleanOperators=Object.freeze({__proto__:null,Not:Not,And:And,Or:Or$1,Xor:Xor});class BooleanBaseOperatorOfMath extends BooleanComponent{static componentType="_booleanOperatorOfMath";static rendererType="boolean";static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e}){return e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro))?1===e.length&&"string"!=typeof e[0]?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:e}]}:{success:!1}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.parsedExpression,delete e.mathChildrenByCode,e.booleanOperator={returnDependencies:()=>({}),definition:()=>({setValue:{booleanOperator:e=>!1}})},e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},booleanOperator:{dependencyType:"stateVariable",variableName:"booleanOperator"}}),definition:function({dependencyValues:e}){return{setValue:{value:e.booleanOperator(e.mathChildren.map((e=>e.stateValues.value)))}}}},e}}class IsInteger extends BooleanBaseOperatorOfMath{static componentType="isInteger";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.booleanOperator.definition=()=>({setValue:{booleanOperator:function(e){if(0===e.length)return!1;if(1!==e.length)return console.warn("IsInteger requires exactly one math child"),null;let t=e[0].evaluate_to_constant();if(!Number.isFinite(t))return!1;let n=Math.round(t);return Math.abs(n-t)<=1e-15*Math.abs(t)}}}),e}}class IsNumber extends BooleanBaseOperatorOfMath{static componentType="isNumber";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.booleanOperator.definition=()=>({setValue:{booleanOperator:function(e){if(0===e.length)return!1;if(1!==e.length)return console.warn("IsNumber requires exactly one math child"),null;let t=e[0].evaluate_to_constant();return Number.isFinite(t)}}}),e}}class IsBetween extends BooleanBaseOperatorOfMath{static componentType="isBetween";static createAttributesObject(){let e=super.createAttributesObject();return e.limits={createComponentOfType:"numberList",createStateVariable:"limits",defaultValue:[],public:!0},e.strict={createComponentOfType:"boolean",createStateVariable:"strict",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.booleanOperator={returnDependencies:()=>({limits:{dependencyType:"stateVariable",variableName:"limits"},strict:{dependencyType:"stateVariable",variableName:"strict"}}),definition({dependencyValues:e}){let t,n,r=e.limits[0],a=e.limits[1];if(r<a)n=r,t=a;else{if(!(a<r))return{setValue:{booleanOperator:()=>!1}};n=a,t=r}let i=e.strict;return{setValue:{booleanOperator:function(e){if(0===e.length)return!1;if(1!==e.length)return console.warn("IsBetween requires exactly one math child"),null;let r=e[0].evaluate_to_constant();return i?r>n&&r<t:r>=n&&r<=t}}}}},e}}var BooleanOperatorsOfMath=Object.freeze({__proto__:null,IsInteger:IsInteger,IsNumber:IsNumber,IsBetween:IsBetween});class MathOperator extends MathComponent{static componentType="_mathOperator";static rendererType="math";static descendantCompositesMustHaveAReplacement=!1;static createAttributesObject(){let e=super.createAttributesObject();return e.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},e.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e)).map((e=>({componentType:Number.isFinite(Number(e))?"number":"math",children:[e]})))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"numbers",componentTypes:["number"]},{group:"mathLists",componentTypes:["mathList"]},{group:"numberLists",componentTypes:["numberList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displayDigits"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDigitsAttr?{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}}:null!==e.displayDecimalsAttr||1!==e.mathLikeChildren.length||t.mathLikeChildren[0]&&t.mathLikeChildren[0].displayDigits?{useEssentialOrDefaultValue:{displayDigits:!0}}:{setValue:{displayDigits:e.mathLikeChildren[0].stateValues.displayDigits}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displayDecimals"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDecimalsAttr?{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}}:1!==e.mathLikeChildren.length||t.mathLikeChildren[0]&&t.mathLikeChildren[0].displayDecimals?{useEssentialOrDefaultValue:{displayDecimals:!0}}:{setValue:{displayDecimals:e.mathLikeChildren[0].stateValues.displayDecimals}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["displaySmallAsZero"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displaySmallAsZeroAttr?{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}}:1!==e.mathLikeChildren.length||t.mathLikeChildren[0]&&t.mathLikeChildren[0].displaySmallAsZero?{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}:{setValue:{displaySmallAsZero:e.mathLikeChildren[0].stateValues.displaySmallAsZero}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},mathLikeChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["padZeros"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.padZerosAttr?{setValue:{padZeros:e.padZerosAttr.stateValues.value}}:1!==e.mathLikeChildren.length||t.mathLikeChildren[0]&&t.mathLikeChildren[0].padZeros?{useEssentialOrDefaultValue:{padZeros:!0}}:{setValue:{padZeros:e.mathLikeChildren[0].stateValues.padZeros}}},e.isNumericOperator={returnDependencies:()=>({forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["isNumber"],variablesOptional:!0},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],variableNames:["maths"]}}),definition({dependencyValues:e}){let t;return t=!!e.forceNumeric||!e.forceSymbolic&&(0===e.mathChildren.length&&0===e.mathListChildren.length||e.mathChildren.every((e=>e.stateValues.isNumber))&&e.mathListChildren.every((e=>e.stateValues.maths.every((e=>Number.isFinite(e.tree)))))),{setValue:{isNumericOperator:t}}}},delete e.codePre,delete e.expressionWithCodes,delete e.mathChildrenFunctionSymbols,delete e.codesAdjacentToStrings,delete e.mathChildrenByVectorComponent,e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:e=>me$3.fromAst("")}})},e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:e=>me$3.fromAst("")}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:null}})},e.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseNumericOperator:null}})},e.unnormalizedValue={returnDependencies:()=>({mathNumberChildren:{dependencyType:"child",childGroups:["maths","numbers","mathLists","numberLists"],variableNames:["value","maths","numbers"],variablesOptional:!0},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},numericOperator:{dependencyType:"stateVariable",variableName:"numericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){if(0===e.mathNumberChildren.length)return{setValue:{unnormalizedValue:me$3.fromAst("")}};if(e.isNumericOperator){let n=[];for(let r of e.mathNumberChildren)if(t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"number"}))n.push(r.stateValues.value);else if(t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"math"})){let e=r.stateValues.value.evaluate_to_constant();Number.isFinite(e)||(e=NaN),n.push(e)}else if(t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"numberList"}))n.push(...r.stateValues.numbers);else{let e=r.stateValues.maths.map((e=>{let t=e.evaluate_to_constant();return Number.isFinite(t)||(t=NaN),t}));n.push(...e)}return{setValue:{unnormalizedValue:me$3.fromAst(e.numericOperator(n))}}}{let n=[];for(let r of e.mathNumberChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"number"})?n.push(me$3.fromAst(r.stateValues.value)):t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"math"})?n.push(r.stateValues.value):t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"numberList"})?n.push(...r.stateValues.numbers.map((e=>me$3.fromAst(e)))):n.push(...r.stateValues.maths);return{setValue:{unnormalizedValue:e.mathOperator(n)}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){if(0===t.mathNumberChildren.length)return{success:!1};if(t.isNumericOperator){if(t.inverseNumericOperator){let n=[];for(let e of t.mathNumberChildren)if(componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"number"}))n.push(e.stateValues.value);else if(componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"math"})){let t=e.stateValues.value.evaluate_to_constant();Number.isFinite(t)||(t=NaN),n.push(t)}else if(componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"numberList"}))n.push(...e.stateValues.numbers);else{let t=e.stateValues.maths.map((e=>{let t=e.evaluate_to_constant();return Number.isFinite(t)||(t=NaN),t}));n.push(...t)}let r=t.inverseNumericOperator({desiredValue:e.unnormalizedValue.evaluate_to_constant(),inputs:n});return r.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:r.inputValue,childIndex:r.inputNumber,variableIndex:0}]}:{success:!1}}return{success:!1}}if(t.inverseMathOperator){let n=[];for(let e of t.mathNumberChildren)componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"number"})?n.push(me$3.fromAst(e.stateValues.value)):componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"math"})?n.push(e.stateValues.value):componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"numberList"})?n.push(...e.stateValues.numbers.map((e=>me$3.fromAst(e)))):n.push(...e.stateValues.maths);let r=t.inverseMathOperator({desiredValue:e.unnormalizedValue,inputs:n});return r.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:r.inputValue,childIndex:r.inputNumber,variableIndex:0}]}:{success:!1}}return{success:!1}}},e.canBeModified={returnDependencies:()=>({modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},mathNumberChildren:{dependencyType:"child",childGroups:["maths","numbers"]},mathNumberListChildren:{dependencyType:"child",childGroups:["mathLists","numberLists"],variableNames:["nComponents"]},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e}){let t=e.modifyIndirectly&&!e.fixed&&e.mathNumberChildren.length+e.mathNumberListChildren.reduce(((e,t)=>e+t.stateValues.nComponents),0)===1&&(e.isNumericOperator?e.inverseNumericOperator:e.inverseMathOperator);return{setValue:{canBeModified:t}}}},e}}class MathOperatorOneInput extends MathComponent{static componentType="_mathOperatorOneInput";static rendererType="math";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:e=>me.fromAst("")}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:null}})},renameStateVariable({stateVariableDefinitions:e,oldName:"unnormalizedValue",newName:"unnormalizedValuePreOperator"}),e.unnormalizedValue={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"unnormalizedValuePreOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"}}),definition:function({dependencyValues:e}){return{setValue:{unnormalizedValue:e.mathOperator(e.value)}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t,componentName:n}){if(t.inverseMathOperator){return{success:!0,instructions:[{setDependency:"value",desiredValue:t.inverseMathOperator(e.unnormalizedValue)}]}}return{success:!1}}},renameStateVariable({stateVariableDefinitions:e,oldName:"canBeModified",newName:"canBeModifiedPreOperator"}),e.canBeModified={returnDependencies:()=>({canBeModifiedPreOperator:{dependencyType:"stateVariable",variableName:"canBeModifiedPreOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"}}),definition:function({dependencyValues:e}){let t=e.canBeModifiedPreOperator;return e.inverseMathOperator||(t=!1),{setValue:{canBeModified:t}}}},e}}class Sum extends MathOperator{static componentType="sum";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.reduce(((e,t)=>e+t))}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return e.reduce(((e,t)=>e.add(t)))}}})},e}}class Product extends MathOperator{static componentType="product";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.reduce(((e,t)=>e*t))}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return e.reduce(((e,t)=>e.multiply(t)))}}})},e}}class ClampNumber extends MathOperatorOneInput{static componentType="clampNumber";static createAttributesObject(){let e=super.createAttributesObject();return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},e.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({setValue:{mathOperator:function(t){return clamp({value:t,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},e.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({setValue:{inverseMathOperator:function(t){return clamp({value:t,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},e}}function clamp({value:e,lowerValue:t,upperValue:n}){let r=e;return r instanceof me$3.class&&(r=r.evaluate_to_constant()),Number.isFinite(r)?me$3.fromAst(Math.max(t,Math.min(n,r))):me$3.fromAst(NaN)}class WrapNumberPeriodic extends MathOperatorOneInput{static componentType="wrapNumberPeriodic";static createAttributesObject(){let e=super.createAttributesObject();return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},e.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({setValue:{mathOperator:function(t){return makePeriodic({value:t,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},e.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({setValue:{inverseMathOperator:function(t){return makePeriodic({value:t,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},e}}function makePeriodic({value:e,lowerValue:t,upperValue:n}){let r=e;return r instanceof me$3.class&&(r=r.evaluate_to_constant()),Number.isFinite(r)?t===n?me$3.fromAst(t):(t>n&&([n,t]=[t,n]),me$3.fromAst(t+me$3.math.mod(r-t,n-t))):me$3.fromAst(NaN)}class Round extends MathOperatorOneInput{static componentType="round";static createAttributesObject(){let e=super.createAttributesObject();return e.numberDecimals={createComponentOfType:"number",createStateVariable:"numberDecimals",defaultValue:0,public:!0},e.numberDigits={createComponentOfType:"number",createStateVariable:"numberDigits",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({numberDecimals:{dependencyType:"stateVariable",variableName:"numberDecimals"},numberDigits:{dependencyType:"stateVariable",variableName:"numberDigits"}}),definition:({dependencyValues:e})=>({setValue:{mathOperator:function(t){let n=t.evaluate_numbers({max_digits:1/0,evaluate_functions:!0});return null!==e.numberDigits?n.round_numbers_to_precision(e.numberDigits):n.round_numbers_to_decimals(e.numberDecimals)}}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:e=>e}})},e}}class ConvertSetToList extends MathOperatorOneInput{static componentType="convertSetToList";static createAttributesObject(){let e=super.createAttributesObject();return delete e.unordered,e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.unordered={returnDependencies:()=>({}),definition:()=>({setValue:{unordered:!0}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){if(void 0!==e&&Array.isArray(e.tree)&&"set"===e.tree[0]){let t=[];for(let n of e.tree.slice(1))t.some((t=>e.context.equalsViaSyntax(e.context.fromAst(t),e.context.fromAst(n))))||t.push(n);return e.context.fromAst(["list",...t])}return e}}})},e}}class Ceil extends MathOperatorOneInput{static componentType="ceil";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){let t=e.evaluate_to_constant();if(!Number.isFinite(t))return me$3.fromAst(["apply","ceil",e.tree]);let n=Math.round(t);return Math.abs((n-t)/t)<1e-15?me$3.fromAst(n):me$3.fromAst(Math.ceil(t))}}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:e=>e}})},e}}class Floor extends MathOperatorOneInput{static componentType="floor";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){let t=e.evaluate_to_constant();if(!Number.isFinite(t))return me$3.fromAst(["apply","floor",e.tree]);let n=Math.round(t);return Math.abs((n-t)/t)<1e-15?me$3.fromAst(n):me$3.fromAst(Math.floor(t))}}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:e=>e}})},e}}class Abs extends MathOperatorOneInput{static componentType="abs";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){let t=e.evaluate_to_constant();return Number.isFinite(t)?me$3.fromAst(Math.abs(t)):me$3.fromAst(["apply","abs",e.tree])}}})},e.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{inverseMathOperator:function(e){let t=e,n=e.evaluate_to_constant();return Number.isFinite(n)?n<0&&(t=me$3.fromAst(0)):Array.isArray(e.tree)&&"apply"===e.tree[0]&&"abs"===e.tree[1]&&(t=me$3.fromAst(e.tree[2])),t}}})},e}}class Sign extends MathOperatorOneInput{static componentType="sign";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){let t=e.evaluate_to_constant();return Number.isFinite(t)?me$3.fromAst(Math.sign(t)):me$3.fromAst(["apply","sign",e.tree])}}})},e}}class Mean extends MathOperator{static componentType="mean";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){let t=e.reduce(((e,t)=>e+t));return t/=e.length,t}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return e.reduce(((e,t)=>e.add(t))).divide(e.length)}}})},e}}class Variance extends MathOperator{static componentType="variance";static createAttributesObject(){let e=super.createAttributesObject();return e.population={createComponentOfType:"boolean",createStateVariable:"population",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({setValue:{numericOperator:function(t){return calculateNumericVariance(t,e.population)}}})},e.mathOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({setValue:{mathOperator:function(t){return calculateSymbolicVariance(t,e.population)}}})},e}}function calculateNumericVariance(e,t){let n=0,r=0;for(let t of e)n+=t,r+=t*t;let a=e.length;return r-=n**2/a,r/=t?a:a-1,r}function calculateSymbolicVariance(e,t){let n=e.length,r=e.reduce(((e,t)=>e.add(t))),a=e.slice(1).reduce(((e,t)=>e.add(t.pow(2))),e[0].pow(2)).subtract(r.pow(2).divide(n));return a=t?a.divide(n):a.divide(n-1),a}class StandardDeviation extends Variance{static componentType="standardDeviation";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator.definition=({dependencyValues:e})=>({setValue:{numericOperator:function(t){return Math.sqrt(calculateNumericVariance(t,e.population))}}}),e.mathOperator.definition=({dependencyValues:e})=>({setValue:{mathOperator:function(t){return me$3.fromAst(["apply","sqrt",calculateSymbolicVariance(t,e.population).tree])}}}),e}}class Count extends MathOperator{static componentType="count";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.isNumericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{isNumericOperator:!0}})},e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.length}}})},e}}class Min extends MathOperator{static componentType="min";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.reduce(((e,t)=>Math.min(e,t)),1/0)}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return me$3.fromAst(["apply","min",["tuple",...e.map((e=>e.tree))]])}}})},e}}class Max extends MathOperator{static componentType="max";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.reduce(((e,t)=>Math.max(e,t)),-1/0)}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return me$3.fromAst(["apply","max",["tuple",...e.map((e=>e.tree))]])}}})},e}}class Mod extends MathOperator{static componentType="mod";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return 2!==e.length?NaN:me$3.math.mod(e[0],e[1])}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return 2!==e.length?me$3.fromAst(""):me$3.fromAst(["apply","mod",["tuple",...e.map((e=>e.tree))]])}}})},e}}class Gcd extends MathOperator{static componentType="gcd";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numericOperator={returnDependencies:()=>({}),definition:()=>({setValue:{numericOperator:function(e){return e.every(Number.isInteger)?gcd(...e):NaN}}})},e.mathOperator={returnDependencies:()=>({}),definition:()=>({setValue:{mathOperator:function(e){return me$3.fromAst(["apply","gcd",["tuple",...e.map((e=>e.tree))]])}}})},e}}class ExtractMath extends MathOperatorOneInput{static componentType="extractMath";static createAttributesObject(){let e=super.createAttributesObject();return e.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:null,toLowerCase:!0,validValues:["operand","function","functionargument","numberofoperands"]},e.operandNumber={createComponentOfType:"number",createStateVariable:"operandNumber",defaultValue:null,public:!0},e.argumentNumber={createComponentOfType:"number",createStateVariable:"argumentNumber",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.mathOperator={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},operandNumber:{dependencyType:"stateVariable",variableName:"operandNumber"},argumentNumber:{dependencyType:"stateVariable",variableName:"argumentNumber"}}),definition:({dependencyValues:e})=>"operand"===e.type?null===e.operandNumber?(console.warn("Must specify a operandNumber when extracting a math operand"),{setValue:{mathOperator:e=>me$3.fromAst("")}}):{setValue:{mathOperator:function(t){let n=t.tree;if(!Array.isArray(n))return 1===e.operandNumber?t:me$3.fromAst("");if("apply"===n[0])return 1===e.operandNumber?t:me$3.fromAst("");let r=n[e.operandNumber];return void 0===r?me$3.fromAst(""):me$3.fromAst(r)}}}:"function"===e.type?{setValue:{mathOperator:function(e){let t=e.tree;return Array.isArray(t)?"apply"!==t[0]?me$3.fromAst(""):me$3.fromAst(t[1]):me$3.fromAst("")}}}:"functionargument"===e.type?{setValue:{mathOperator:function(t){let n=t.tree;if(!Array.isArray(n))return me$3.fromAst("");if("apply"!==n[0])return me$3.fromAst("");let r=n[2];if(null===e.argumentNumber)return me$3.fromAst(r);if(1===e.argumentNumber)return Array.isArray(r)&&"tuple"===r[0]?me$3.fromAst(r[1]):me$3.fromAst(r);if(Array.isArray(r)&&"tuple"===r[0]){let t=r[e.argumentNumber];return void 0===t?me$3.fromAst(""):me$3.fromAst(t)}return me$3.fromAst("")}}}:"numberofoperands"===e.type?{setValue:{mathOperator:function(e){let t=e.tree;return Array.isArray(t)?"apply"===t[0]?me$3.fromAst(1):me$3.fromAst(t.length-1):me$3.fromAst(1)}}}:{setValue:{mathOperator:e=>me$3.fromAst("_")}}},e}}function gcd(e,t,...n){return!t&&n.length>0?gcd(e,...n):t?gcd(t,e%t,...n):e}var MathOperators=Object.freeze({__proto__:null,Sum:Sum,Product:Product,ClampNumber:ClampNumber,WrapNumberPeriodic:WrapNumberPeriodic,Round:Round,ConvertSetToList:ConvertSetToList,Ceil:Ceil,Floor:Floor,Abs:Abs,Sign:Sign,Mean:Mean,Variance:Variance,StandardDeviation:StandardDeviation,Count:Count,Min:Min,Max:Max,Mod:Mod,Gcd:Gcd,ExtractMath:ExtractMath});let styleAttributes={lineColor:{componentType:"text"},lineColorWord:{componentType:"text"},lineOpacity:{componentType:"number"},lineWidth:{componentType:"number"},lineWidthWord:{componentType:"text"},lineStyle:{componentType:"text"},lineStyleWord:{componentType:"text"},markerColor:{componentType:"text"},markerColorWord:{componentType:"text"},markerStyle:{componentType:"text"},markerStyleWord:{componentType:"text"},markerSize:{componentType:"number"},fillColor:{componentType:"text"},fillColorWord:{componentType:"text"},fillOpacity:{componentType:"number"}},defaultStyle={lineColor:"#648FFF",lineColorWord:"blue",lineOpacity:.7,lineWidth:4,lineWidthWord:"thick",lineStyle:"solid",lineStyleWord:"",markerColor:"#648FFF",markerColorWord:"blue",markerStyle:"circle",markerStyleWord:"point",markerSize:3,fillColor:"none",fillColorWord:"none",fillOpacity:.3};function returnDefaultStyleDefinitions(){return{1:{lineColor:"#648FFF",lineColorWord:"blue",lineOpacity:.7,lineWidth:4,lineWidthWord:"thick",lineStyle:"solid",lineStyleWord:"",markerColor:"#648FFF",markerColorWord:"blue",markerStyle:"circle",markerStyleWord:"point",markerSize:3,fillColor:"none",fillColorWord:"none",fillOpacity:.3},2:{lineColor:"#D4042D",lineColorWord:"red",lineOpacity:.7,lineWidth:2,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#D4042D",markerColorWord:"red",markerStyle:"square",markerStyleWord:"square",markerSize:4,fillColor:"none",fillColorWord:"none",fillOpacity:.3},3:{lineColor:"#F19143",lineColorWord:"orange",lineOpacity:.7,lineWidth:3,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#F19143",markerColorWord:"orange",markerStyle:"triangle",markerStyleWord:"triangle",markerSize:5,fillColor:"none",fillColorWord:"none",fillOpacity:.3},4:{lineColor:"#644CD6",lineColorWord:"purple",lineOpacity:.7,lineWidth:2,lineWidthWord:"",lineStyle:"solid",lineStyleWord:"",markerColor:"#644CD6",markerColorWord:"purple",markerStyle:"diamond",markerStyleWord:"diamond",markerSize:4,fillColor:"none",fillColorWord:"none",fillOpacity:.3},5:{lineColor:"black",lineColorWord:"black",lineOpacity:.7,lineWidth:1,lineWidthWord:"thin",lineStyle:"solid",lineStyleWord:"",markerColor:"black",markerColorWord:"black",markerStyle:"circle",markerStyleWord:"point",markerSize:2,fillColor:"none",fillColorWord:"none",fillOpacity:.3},6:{lineColor:"gray",lineColorWord:"gray",lineOpacity:.7,lineWidth:1,lineWidthWord:"thin",lineStyle:"dotted",lineStyleWord:"dotted",markerColor:"gray",markerColorWord:"gray",markerStyle:"circle",markerStyleWord:"point",markerSize:2,fillColor:"none",fillColorWord:"none",fillOpacity:.3}}}function returnStyleDefinitionStateVariables(){let e={setupChildren:{returnDependencies:()=>({setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}}),definition:({dependencyValues:e})=>({setValue:{setupChildren:e.setupChildren}})}};return e.styleDefinitions={stateVariablesDeterminingDependencies:["setupChildren"],returnDependencies({stateValues:e}){let t={ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]},setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}};for(let n of e.setupChildren)t[`styleDefinitionsOf${n.componentName}`]={dependencyType:"child",parentName:n.componentName,childGroups:["styleDefinitions"],variableNames:["value"]};return t},definition({dependencyValues:e}){let t,n={};e.ancestorWithStyle&&(t=e.ancestorWithStyle.stateValues.styleDefinitions),t||(t=returnDefaultStyleDefinitions());for(let e in t)n[e]=Object.assign({},t[e]);let r=[];for(let t of e.setupChildren)r.push(...e[`styleDefinitionsOf${t.componentName}`]);for(let e of r){let t=e.stateValues.value;for(let e in t){let r=n[e];r||(r=n[e]=Object.assign({},defaultStyle));let a=Object.assign({},t[e]);"markerColor"in a&&!("markerColorWord"in a)&&(a.markerColorWord=a.markerColor),"markerStyle"in a&&!("markerStyleWord"in a)&&(a.markerStyleWord=a.markerStyle,"circle"===a.markerStyleWord?a.markerStyleWord="point":"triangle"===a.markerStyleWord.slice(0,8)&&(a.markerStyleWord="triangle")),"lineColor"in a&&!("lineColorWord"in a)&&(a.lineColorWord=a.lineColor),"fillColor"in a&&!("fillColorWord"in a)&&(a.fillColorWord=a.fillColor),"lineWidth"in a&&!("lineWidthWord"in a)&&(a.lineWidth>=4?a.lineWidthWord="thick":a.lineWidth<=1?a.lineWidthWord="thin":a.lineWidthWord=""),"lineStyle"in a&&!("lineStyleWord"in a)&&("dashed"===a.lineStyle?a.lineStyleWord="dashed":"dotted"===a.lineStyle?a.lineStyleWord="dotted":a.lineStyleWord=""),Object.assign(r,a)}}return{setValue:{styleDefinitions:n}}}},e}function returnSelectedStyleStateVariableDefinition(){return{selectedStyle:{forRenderer:!0,willNeverBeEssential:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:e}){let t=e.ancestorWithStyle.stateValues.styleDefinitions;t||(t=returnDefaultStyleDefinitions());let n=t[e.styleNumber];return void 0===n&&(n=defaultStyle),{setValue:{selectedStyle:n}}}}}}function returnNumericalFunctionFromFormula({formula:e,nInputs:t,variables:n,domain:r,component:a=0}){let i;if(a=Number(a),Array.isArray(e.tree)&&["tuple","vector"].includes(e.tree[0]))try{e=e.get_component(Number(a))}catch(e){return()=>NaN}else if(0!==a)return()=>NaN;try{i=e.subscripts_to_strings().f()}catch(e){return()=>NaN}if(1===t){let e=n[0].subscripts_to_strings().tree,t=-1/0,a=1/0;if(null!==r){let e=r[0];if(void 0!==e)try{t=e[0].evaluate_to_constant(),Number.isFinite(t)||(t=-1/0),a=e[1].evaluate_to_constant(),Number.isFinite(a)||(a=1/0)}catch(e){}}return function(n){if(n<t||n>a)return NaN;try{return i({[e]:n})}catch(e){return NaN}}}let o=[];for(let e=0;e<t;e++)o.push(n[e].subscripts_to_strings().tree);return function(...e){let n={};for(let r=0;r<t;r++)n[o[r]]=e[r];try{return i(n)}catch(e){return NaN}}}function returnSymbolicFunctionFromFormula(e,t){let n=e.formula;if(Array.isArray(n.tree)&&["tuple","vector"].includes(n.tree[0]))try{n=n.get_component(Number(t))}catch(e){return e=>me$3.fromAst("")}else if("0"!==t)return e=>me$3.fromAst("");let r=e.simplify,a=e.expand,i=n.subscripts_to_strings();if(1===e.nInputs){let t=e.variables[0].subscripts_to_strings().tree;return e=>normalizeMathExpression({value:i.substitute({[t]:e}).strings_to_subscripts(),simplify:r,expand:a})}let o=[];for(let t=0;t<e.nInputs;t++)o.push(e.variables[t].subscripts_to_strings().tree);return function(...t){let n={};for(let r=0;r<e.nInputs;r++)n[o[r]]=t[r];return normalizeMathExpression({value:i.substitute(n).strings_to_subscripts(),simplify:r,expand:a})}}function returnBezierFunctions({nThroughPoints:e,numericalThroughPoints:t,splineCoeffs:n,extrapolateForward:r,extrapolateForwardCoeffs:a,extrapolateBackward:i,extrapolateBackwardCoeffs:o}){if(e<1){let e={};for(let t=0;t<2;t++)e[t]=()=>NaN;return e}let s=e-1,l={};for(let e=0;e<2;e++){let u,c,p=t[0][e],d=t[s][e],m=n.map((t=>t[e]));i&&(u=o[e]),r&&(c=a[e]),l[e]=function(e){if(isNaN(e))return NaN;if(e<0)return i?(u[2]*e+u[1])*e+u[0]:p;if(e>=s)return r?(e-=s,(c[2]*e+c[1])*e+c[0]):d;let t=Math.floor(e);e-=t;let n=m[t];return((n[3]*e+n[2])*e+n[1])*e+n[0]}}return l}function returnInterpolatedFunction({xs:e,coeffs:t,interpolationPoints:n,domain:r}){let a=[];if(n&&(a=n.map((e=>e.y))),null===e)return e=>NaN;let i=-1/0,o=1/0;if(null!==r&&void 0!==(r=r[0]))try{i=r[0].evaluate_to_constant(),Number.isFinite(i)||(i=-1/0),o=r[1].evaluate_to_constant(),Number.isFinite(o)||(o=1/0)}catch(e){}let s=e[0],l=e[e.length-1];return function(n){if(isNaN(n)||n<i||n>o)return NaN;if(n<=s){n-=s;let e=t[0];return((e[3]*n+e[2])*n+e[1])*n+e[0]}if(n>=l){let r=e.length-2;n-=e[r];let a=t[r];return((a[3]*n+a[2])*n+a[1])*n+a[0]}for(var r,u=0,c=e.length-1;u<=c;){r=Math.floor(.5*(u+c));let t=e[r];if(t<n)u=r+1;else{if(!(t>n))return a[r];c=r-1}}let p=Math.max(0,c);n-=e[p];let d=t[p];return((d[3]*n+d[2])*n+d[1])*n+d[0]}}function returnReturnDerivativesOfInterpolatedFunction({xs:e,coeffs:t,variables:n}){if(!e)return e=>NaN;let r=n[0].subscripts_to_strings().tree,a=e[0],i=e[e.length-1];return function(n){let o=n.map((e=>e.subscripts_to_strings().tree)),s=o.length;return s>3||!o.every((e=>e===r))||o.includes("")?e=>0:0===s||null===e?e=>NaN:function(n){if(isNaN(n))return NaN;if(n<=a){n-=a;let e=t[0];return 1===s?(3*e[3]*n+2*e[2])*n+e[1]:2===s?6*e[3]*n+2*e[2]:6*e[3]}if(n>=i){let r=e.length-2;n-=e[r];let a=t[r];return 1===s?(3*a[3]*n+2*a[2])*n+a[1]:2===s?6*a[3]*n+2*a[2]:6*a[3]}for(var r,o=0,l=e.length-1;o<=l;){r=Math.floor(.5*(o+l));let a=e[r];if(a<n)o=r+1;else{if(!(a>n))return 1===s?t[r][1]:2===s?2*t[r][2]:6*t[r][3];l=r-1}}let u=Math.max(0,l);n-=e[u];let c=t[u];return 1===s?(3*c[3]*n+2*c[2])*n+c[1]:2===s?6*c[3]*n+2*c[2]:6*c[3]}}}var functionOperatorDefinitions={clampFunction:function(e,t){return function(n){return Number.isFinite(n)?Math.max(e,Math.min(t,n)):NaN}},wrapFunctionPeriodic:function(e,t){return function(n){if(!Number.isFinite(n))return NaN;let r=e,a=t;return r===a?r:(r>a&&([a,r]=[r,a]),r+me$3.math.mod(n-r,a-r))}},derivative:function(e,t){if("interpolatedFunction"===e.derivativeType){let n=returnReturnDerivativesOfInterpolatedFunction({xs:e.xs,coeffs:e.coeffs,variables:e.variables.map(convertValueToMathExpression)}),r=t.map(convertValueToMathExpression);if(e.additionalDerivVariables){r=[...e.additionalDerivVariables.map(convertValueToMathExpression),...r]}if(e.variableMappings)for(let t of e.variableMappings){let e=[];for(let n of r){let r=t[n.subscripts_to_strings().tree];r?e.push(convertValueToMathExpression(r)):e.push(me$3.fromAst(""))}r=e}return n(r)}return e=>NaN}};class Function$2 extends InlineComponent{static componentType="function";static rendererType="math";static primaryStateVariableForDefinition="numericalfShadow";static createAttributesObject(){let e=super.createAttributesObject();return e.simplify={createComponentOfType:"text",createStateVariable:"simplifySpecified",defaultValue:"none",toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={createComponentOfType:"boolean",createStateVariable:"expandSpecified",defaultValue:!1,public:!0},e.xscale={createComponentOfType:"number",createStateVariable:"xscale",defaultValue:1,public:!0},e.yscale={createComponentOfType:"number",createStateVariable:"yscale",defaultValue:1,public:!0},e.nInputs={createComponentOfType:"integer"},e.nOutputs={createComponentOfType:"integer"},e.domain={createComponentOfType:"_pointListComponent"},e.label={createComponentOfType:"_textOrLatexFromInline",createStateVariable:"label",defaultValue:"",public:!0,forRenderer:!0},e.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},e.applyStyleToLabel={createComponentOfType:"boolean",createStateVariable:"applyStyleToLabel",defaultValue:!1,public:!0,forRenderer:!0},e.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},e.layer={createComponentOfType:"number",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},e.minima={createComponentOfType:"extrema"},e.maxima={createComponentOfType:"extrema"},e.extrema={createComponentOfType:"extrema"},e.through={createComponentOfType:"_pointListComponent"},e.throughSlopes={createComponentOfType:"mathList"},e.variables={createComponentOfType:"variables"},e.symbolic={createComponentOfType:"boolean"},e.displayDigits={createComponentOfType:"integer"},e.displayDecimals={createComponentOfType:"integer"},e.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},e.padZeros={createComponentOfType:"boolean"},e.nearestPointAsCurve={createComponentOfType:"boolean",createStateVariable:"nearestPointAsCurve",defaultValue:!1},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){return 1===e.length&&"string"!=typeof e[0]||0===e.length?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:e}]}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"functions",componentTypes:["function"]}]}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions(),n=returnSelectedStyleStateVariableDefinition();return Object.assign(t,n),t.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},t.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" function"}}}},t.labelIsLatex={forRenderer:!0,returnDependencies:()=>({labelAttr:{dependencyType:"attributeComponent",attributeName:"label",variableNames:["isLatex"]}}),definition:({dependencyValues:e})=>({setValue:{labelIsLatex:!0===e.labelAttr?.stateValues.isLatex}})},t.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displayDigits"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDigitsAttr?{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}}:null===e.displayDecimalsAttr&&e.functionChild.length>0&&!t.functionChild[0]?{setValue:{displayDigits:e.functionChild[0].stateValues.displayDigits}}:{useEssentialOrDefaultValue:{displayDigits:!0}}},t.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:null,hasEssential:!0,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displayDecimals"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDecimalsAttr?{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}}:e.functionChild.length>0&&!t.functionChild[0]?{setValue:{displayDecimals:e.functionChild[0].stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}},t.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["displaySmallAsZero"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displaySmallAsZeroAttr?{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}}:e.functionChild.length>0&&!t.functionChild[0]?{setValue:{displaySmallAsZero:e.functionChild[0].stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}},t.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["padZeros"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.padZerosAttr?{setValue:{padZeros:e.padZerosAttr.stateValues.value}}:e.functionChild.length>0&&!t.functionChild[0]?{setValue:{padZeros:e.functionChild[0].stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}},t.isInterpolatedFunction={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through"},minima:{dependencyType:"attributeComponent",attributeName:"minima"},maxima:{dependencyType:"attributeComponent",attributeName:"maxima"},extrema:{dependencyType:"attributeComponent",attributeName:"extrema"}}),definition:({dependencyValues:e})=>({setValue:{isInterpolatedFunction:e.through||e.minima||e.maxima||e.extrema}})},t.nInputs={defaultValue:1,public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,returnDependencies:()=>({nInputsAttr:{dependencyType:"attributeComponent",attributeName:"nInputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nInputs"]},variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["nComponents"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition({dependencyValues:e}){if(e.isInterpolatedFunction)return{setValue:{nInputs:1}};if(null!==e.nInputsAttr){let t=e.nInputsAttr.stateValues.value;return t>=0||(t=1),{setValue:{nInputs:t}}}return null!==e.variablesAttr?{setValue:{nInputs:Math.max(1,e.variablesAttr.stateValues.nComponents)}}:e.functionChild.length>0?{setValue:{nInputs:e.functionChild[0].stateValues.nInputs}}:{useEssentialOrDefaultValue:{nInputs:!0}}}},t.nOutputs={defaultValue:1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({nOutputsAttr:{dependencyType:"attributeComponent",attributeName:"nOutputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nOutputs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}),definition({dependencyValues:e}){if(e.functionChild.length>0)return{setValue:{nOutputs:e.functionChild[0].stateValues.nOutputs}};if(null!==e.nOutputsAttr){let t=e.nOutputsAttr.stateValues.value;return t>=0||(t=1),{setValue:{nOutputs:t}}}if(e.mathChild.length>0){let t=e.mathChild[0].stateValues.value,n=1;return Array.isArray(t.tree)&&["tuple","vector"].includes(t.tree[0])&&(n=t.tree.length-1),{setValue:{nOutputs:n}}}return{useEssentialOrDefaultValue:{nOutputs:!0}}}},t.domain={defaultValue:null,hasEssential:!0,returnDependencies:()=>({domainAttr:{dependencyType:"attributeComponent",attributeName:"domain",variableNames:["points"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]}}),definition:({dependencyValues:e})=>null!==e.domainAttr?{setValue:{domain:e.domainAttr.stateValues.points}}:e.functionChild.length>0?{setValue:{domain:e.functionChild[0].stateValues.domain}}:{useEssentialOrDefaultValue:{domain:!0}}},t.simplify={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({simplifySpecified:{dependencyType:"stateVariable",variableName:"simplifySpecified"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["simplify"]}}),definition:({dependencyValues:e,usedDefault:t})=>t.simplifySpecified&&e.functionChild.length>0?{setValue:{simplify:e.functionChild[0].stateValues.simplify}}:{setValue:{simplify:e.simplifySpecified}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t,usedDefault:n})=>n.simplifySpecified&&t.functionChild.length>0?{success:!0,instructions:[{setDependency:"functionChild",desiredValue:e.simplify,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"simplifySpecified",desiredValue:e.simplify}]}},t.expand={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({expandSpecified:{dependencyType:"stateVariable",variableName:"expandSpecified"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["expand"]}}),definition:({dependencyValues:e,usedDefault:t})=>t.expandSpecified&&e.functionChild.length>0?{setValue:{expand:e.functionChild[0].stateValues.expand}}:{setValue:{expand:e.expandSpecified}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t,usedDefault:n})=>n.expandSpecified&&t.functionChild.length>0?{success:!0,instructions:[{setDependency:"functionChild",desiredValue:e.expand,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"expandSpecified",desiredValue:e.expand}]}},t.numericalfShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{numericalfShadow:!0}})},t.symbolicfShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{symbolicfShadow:!0}})},t.symbolic={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({symbolicAttr:{dependencyType:"attributeComponent",attributeName:"symbolic",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolic"]},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"}}),definition:({dependencyValues:e})=>null!==e.symbolicAttr?{setValue:{symbolic:e.symbolicAttr.stateValues.value}}:e.functionChild.length>0?{setValue:{symbolic:e.functionChild[0].stateValues.symbolic}}:e.numericalfShadow?{setValue:{symbolic:!1}}:e.symbolicfShadow?{setValue:{symbolic:!0}}:{useEssentialOrDefaultValue:{symbolic:!0}}},t.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({nInputs:{dependencyType:"stateVariable",variableName:"nInputs"}}),returnArraySize:({dependencyValues:e})=>[e.nInputs],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["variable"+(Number(n)+1)]}};return{globalDependencies:{variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},functionChild:{dependencyType:"child",childGroups:["functions"]}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arraySize:n,arrayKeys:r,usedDefault:a}){if(null!==e.variablesAttr){let t=e.variablesAttr.stateValues.variables;return{setValue:{variables:returnNVariables(n[0],t)}}}if(e.functionChild.length>0){let e={};for(let n of r)e[n]=t[n].functionChild[0].stateValues["variable"+(Number(n)+1)];return{setValue:{variables:e}}}return e.parentVariableForChild&&!a.parentVariableForChild?{setValue:{variables:Array(n[0]).fill(e.parentVariableForChild)}}:{setValue:{variables:returnNVariables(n[0],[])}}}},t.variable={isAlias:!0,targetVariableName:"variable1"},t.unnormalizedFormula={defaultValue:me$3.fromAst(0),hasEssential:!0,returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["formula"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:e,usedDefault:t}){return e.isInterpolatedFunction?{setValue:{unnormalizedFormula:me$3.fromAst("")}}:e.mathChild.length>0?{setValue:{unnormalizedFormula:e.mathChild[0].stateValues.value}}:e.functionChild.length>0&&!t.functionChild[0].formula?{setValue:{unnormalizedFormula:e.functionChild[0].stateValues.formula}}:{useEssentialOrDefaultValue:{unnormalizedFormula:!0}}}},t.formula={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},defaultValue:me$3.fromAst(0),hasEssential:!0,returnDependencies:()=>({unnormalizedFormula:{dependencyType:"stateVariable",variableName:"unnormalizedFormula"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"}}),definition:function({dependencyValues:e,usedDefault:t}){if(t.unnormalizedFormula)return{useEssentialOrDefaultValue:{formula:!0}};return{setValue:{formula:normalizeMathExpression({value:e.unnormalizedFormula,simplify:e.simplify,expand:e.expand})}}}},t.nPrescribedPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:e}){let t=0;return null!==e.through&&(t=e.through.stateValues.nPoints),{setValue:{nPrescribedPoints:t}}}},t.prescribedPoints={isArray:!0,entryPrefixes:["prescribedPoint"],returnArraySizeDependencies:()=>({nPrescribedPoints:{dependencyType:"stateVariable",variableName:"nPrescribedPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nPrescribedPoints],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["point"+e]},throughSlopes:{dependencyType:"attributeComponent",attributeName:"throughSlopes",variableNames:["math"+e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].through;if(null!==t){let a=Number(r)+1,i=t.stateValues["point"+a],o=null,s=e[r].throughSlopes;null!==s&&(o=s.stateValues["math"+a],void 0===o&&(o=null)),n[r]={x:i[0],y:i[1],slope:o}}}return{setValue:{prescribedPoints:n}}}},t.prescribedMinima={returnDependencies:()=>({minima:{dependencyType:"attributeComponent",attributeName:"minima",variableNames:["extrema"]}}),definition({dependencyValues:e}){let t=[];return null!==e.minima&&(t=e.minima.stateValues.extrema.map((e=>({x:e[0],y:e[1]})))),{setValue:{prescribedMinima:t}}}},t.prescribedMaxima={returnDependencies:()=>({maxima:{dependencyType:"attributeComponent",attributeName:"maxima",variableNames:["extrema"]}}),definition({dependencyValues:e}){let t=[];return null!==e.maxima&&(t=e.maxima.stateValues.extrema.map((e=>({x:e[0],y:e[1]})))),{setValue:{prescribedMaxima:t}}}},t.prescribedExtrema={returnDependencies:()=>({extrema:{dependencyType:"attributeComponent",attributeName:"extrema",variableNames:["extrema"]}}),definition({dependencyValues:e}){let t=[];return null!==e.extrema&&(t=e.extrema.stateValues.extrema.map((e=>({x:e[0],y:e[1]})))),{setValue:{prescribedExtrema:t}}}},t.interpolationPoints={returnDependencies:()=>({xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"},prescribedPoints:{dependencyType:"stateVariable",variableName:"prescribedPoints"},prescribedMinima:{dependencyType:"stateVariable",variableName:"prescribedMinima"},prescribedMaxima:{dependencyType:"stateVariable",variableName:"prescribedMaxima"},prescribedExtrema:{dependencyType:"stateVariable",variableName:"prescribedExtrema"}}),definition:({dependencyValues:t})=>calculateInterpolationPoints({dependencyValues:t,numerics:e})},t.xs={additionalStateVariablesDefined:["coeffs"],returnDependencies:()=>({interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"}}),definition:computeSplineParamCoeffs},t.symbolicfs={isArray:!0,entryPrefixes:["symbolicf"],stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize:({dependencyValues:e})=>[e.nOutputs],returnArrayDependenciesByKey:({stateValues:e})=>e.isInterpolatedFunction?{globalDependencies:{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}:{globalDependencies:{formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolicfs"]},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}}},arrayDefinitionByKey:function({globalDependencyValues:e,usedDefault:t,arrayKeys:n}){if(e.isInterpolatedFunction){let t={};for(let r of n)if("0"===r){let n=returnInterpolatedFunction({xs:e.xs,coeffs:e.coeffs,interpolationPoints:e.interpolationPoints,domain:e.domain});t[r]=function(e){me$3.fromAst(n(e.evaluate_to_constant()))}}else t[r]=e=>me$3.fromAst("");return{setValue:{symbolicfs:t}}}if(t.formula||""===e.formula.tree&&0!==e.functionChild.length){if(e.functionChild.length>0){let t={};for(let r of n)t[r]=e.functionChild[0].stateValues.symbolicfs[r];return{setValue:{symbolicfs:t}}}if(e.symbolicfShadow){let t={};for(let r of n)t[r]="0"===r?e.symbolicfShadow:e=>me$3.fromAst("");return{setValue:{symbolicfs:t}}}if(e.numericalfShadow){let t={};for(let r of n)t[r]="0"===r?function(t){let n=t.evaluate_to_constant();return null===n?NaN:me$3.fromAst(e.numericalfShadow(n))}:e=>me$3.fromAst("");return{setValue:{symbolicfs:t}}}{let t={};for(let r of n)t[r]=returnSymbolicFunctionFromFormula(e,r);return{setValue:{symbolicfs:t}}}}{let t={};for(let r of n)t[r]=returnSymbolicFunctionFromFormula(e,r);return{setValue:{symbolicfs:t}}}}},t.symbolicf={isAlias:!0,targetVariableName:"symbolicf1"},t.numericalfs={isArray:!0,entryPrefixes:["numericalf"],stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize:({dependencyValues:e})=>[e.nOutputs],returnArrayDependenciesByKey:({stateValues:e})=>e.isInterpolatedFunction?{globalDependencies:{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}:{globalDependencies:{formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalfs"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}}},arrayDefinitionByKey:function({globalDependencyValues:e,usedDefault:t,arrayKeys:n}){if(e.isInterpolatedFunction){let t={};for(let r of n)t[r]="0"===r?returnInterpolatedFunction({xs:e.xs,coeffs:e.coeffs,interpolationPoints:e.interpolationPoints,domain:e.domain}):e=>me$3.fromAst("");return{setValue:{numericalfs:t}}}if(t.formula||""===e.formula.tree&&0!==e.functionChild.length){if(e.functionChild.length>0){let t={};for(let r of n)t[r]=e.functionChild[0].stateValues.numericalfs[r];return{setValue:{numericalfs:t}}}if(e.numericalfShadow){let t={};for(let r of n)t[r]="0"===r?e.numericalfShadow:()=>NaN;return{setValue:{numericalfs:t}}}if(e.symbolicfShadow){let e={};for(let t of n)e[t]="0"===t?function(e){let t=dependencyValues.symbolicfShadow(me$3.fromAst(e)).evaluate_to_constant();return null===t&&(t=NaN),t}:()=>NaN;return{setValue:{numericalfs:e}}}{let t={};for(let r of n)t[r]=returnNumericalFunctionFromFormula({formula:e.formula,nInputs:e.nInputs,variables:e.variables,domain:e.domain,component:r});return{setValue:{numericalfs:t}}}}{let t={};for(let r of n)t[r]=returnNumericalFunctionFromFormula({formula:e.formula,nInputs:e.nInputs,variables:e.variables,domain:e.domain,component:r});return{setValue:{numericalfs:t}}}}},t.numericalf={returnDependencies:()=>({numericalf1:{dependencyType:"stateVariable",variableName:"numericalf1"}}),definition:({dependencyValues:e})=>({setValue:{numericalf:e.numericalf1}})},t.fDefinition={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies:({stateValues:e})=>e.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}:{formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["fDefinition"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},symbolicfShadow:{dependencyType:"stateVariable",variableName:"symbolicfShadow"},numericalfShadow:{dependencyType:"stateVariable",variableName:"numericalfShadow"},domain:{dependencyType:"stateVariable",variableName:"domain"}},definition:({dependencyValues:e,usedDefault:t})=>e.isInterpolatedFunction?{setValue:{fDefinition:{functionType:"interpolated",xs:e.xs,coeffs:e.coeffs,interpolationPoints:e.interpolationPoints,domain:e.domain}}}:t.formula||""===e.formula.tree&&0!==e.functionChild.length?e.functionChild.length>0?{setValue:{fDefinition:e.functionChild[0].stateValues.fDefinition}}:e.numericalfShadow||e.symbolicfShadow?{setValue:{fDefinition:{}}}:{setValue:{fDefinition:{functionType:"formula",formula:e.formula.tree,variables:e.variables.map((e=>e.tree)),nInputs:e.nInputs,nOutputs:e.nOutputs,domain:e.domain}}}:{setValue:{fDefinition:{functionType:"formula",formula:e.formula.tree,variables:e.variables.map((e=>e.tree)),nInputs:e.nInputs,nOutputs:e.nOutputs,domain:e.domain}}}},t.fs={isArray:!0,entryPrefixes:["f"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize:({dependencyValues:e})=>[e.nOutputs],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={symbolicf:{dependencyType:"stateVariable",variableName:"symbolicf"+e},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"+e}}}return{globalDependencies:{symbolic:{dependencyType:"stateVariable",variableName:"symbolic"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};if(e.symbolic)for(let e of n)r[e]=t[e].symbolicf;else for(let e of n)r[e]=t[e].numericalf;return{setValue:{fs:r}}}},t.f={isAlias:!0,targetVariableName:"f1"},t.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({formula:{dependencyType:"stateVariable",variableName:"formula"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n={};return e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits)),{setValue:{latex:roundForDisplay({value:e.formula,dependencyValues:e,usedDefault:t}).toLatex(n)}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){return{setValue:{latexWithInputChildren:[e.latex]}}}},t.allMinima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies:({stateValues:e})=>e.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["allMinima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},domain:{dependencyType:"stateVariable",variableName:"domain"}},definition:function({dependencyValues:t}){if(t.isInterpolatedFunction){let n=t.xs,r=t.coeffs,a=e.eps,i=[];if(null===n)return{setValue:{allMinima:i}};let o=!1,s=-1/0,l=1/0;if(null!==t.domain){let e=t.domain[0];if(void 0!==e)try{s=e[0].evaluate_to_constant(),Number.isFinite(s)||(s=-1/0),l=e[1].evaluate_to_constant(),Number.isFinite(l)||(l=1/0)}catch(e){}}let u=r[0],c=n[1]-n[0];if(0===u[3]){if(u[2]>0){let e=-u[1]/(2*u[2]);e+n[0]>=s&&e+n[0]<=l&&(e<=c-a?i.push([e+n[0],((u[3]*e+u[2])*e+u[1])*e+u[0]]):Math.abs(e-c)<a&&(o=!0))}}else{let e=4*u[2]*u[2]-12*u[3]*u[1];if(e>0){let t=Math.sqrt(e),r=(-2*u[2]+t)/(6*u[3]);r+n[0]>=s&&r+n[0]<=l&&(r<=c-a?i.push([r+n[0],((u[3]*r+u[2])*r+u[1])*r+u[0]]):Math.abs(r-c)<a&&(o=!0))}}for(let e=1;e<n.length-2;e++)if(u=r[e],c=n[e+1]-n[e],0===u[3])if(u[2]>0){let t=-u[1]/(2*u[2]);if(t+n[e]>=s){if(!(t+n[e]<=l)){o=!1;continue}Math.abs(t)<a?o&&i.push([t+n[e],((u[3]*t+u[2])*t+u[1])*t+u[0]]):t>=a&&t<=c-a&&i.push([t+n[e],((u[3]*t+u[2])*t+u[1])*t+u[0]]),o=Math.abs(t-c)<a}}else o=!1;else{let t=4*u[2]*u[2]-12*u[3]*u[1];if(t>0){let r=Math.sqrt(t),p=(-2*u[2]+r)/(6*u[3]);if(p+n[e]>=s){if(!(p+n[e]<=l)){o=!1;continue}Math.abs(p)<a?o&&i.push([p+n[e],((u[3]*p+u[2])*p+u[1])*p+u[0]]):p>=a&&p<=c-a&&i.push([p+n[e],((u[3]*p+u[2])*p+u[1])*p+u[0]]),o=Math.abs(p-c)<a}}else o=!1}if(u=r[n.length-2],0===u[3]){if(u[2]>0){let e=-u[1]/(2*u[2]);e+n[n.length-2]>=s&&e+n[n.length-2]<=l&&(Math.abs(e)<a?o&&i.push([e+n[n.length-2],((u[3]*e+u[2])*e+u[1])*e+u[0]]):e>=a&&i.push([e+n[n.length-2],((u[3]*e+u[2])*e+u[1])*e+u[0]]))}}else{let e=4*u[2]*u[2]-12*u[3]*u[1];if(e>0){let t=Math.sqrt(e),r=(-2*u[2]+t)/(6*u[3]);r+n[n.length-2]>=s&&r+n[n.length-2]<=l&&(r>=a||Math.abs(r)<a&&o)&&i.push([r+n[n.length-2],((u[3]*r+u[2])*r+u[1])*r+u[0]])}}return{setValue:{allMinima:i}}}{if(t.functionChild&&t.functionChild.length>0)return{setValue:{allMinima:t.functionChild[0].stateValues.allMinima}};if(1!==t.nInputs||1!==t.nOutputs)return{setValue:{allMinima:[]}};let n,r,a=t.variables[0].subscripts_to_strings().tree,i=t.formula.subscripts_to_strings().derivative(a),o=!0;try{n=i.subscripts_to_strings().f()}catch(e){o=!1,r=()=>NaN}o&&(r=function(e){try{return n({[a]:e})}catch(e){return NaN}});let s=t.numericalf,l=-100*t.xscale,u=100*t.xscale;if(null!==t.domain){let e=t.domain[0];if(void 0!==e)try{l=e[0].evaluate_to_constant(),Number.isFinite(l)||(l=-100*t.xscale),u=e[1].evaluate_to_constant(),Number.isFinite(u)||(u=100*t.xscale)}catch(e){}}let c=1e3,p=(u-l)/c,d=[],m=!1,f=s(l),h=r(l);for(let t=0;t<c;t++){let n=l+t*p,a=l+(t+1)*p,i=f;f=s(a);let u=h;if(h=r(a),Number.isNaN(i)||Number.isNaN(f))continue;let c=!1;if(o&&u*h<=0){let t=e.fzero(r,[n,a]),i=.5*1e-6*(Math.abs(t)+1);r(t-i)<0&&r(t+i)>0&&t!==a&&(c=!0,d.push([t,s(t)]),m=!1)}if(!c){let t=e.fminbr(s,[n,a]);if(!0!==t.success)continue;let r=t.x,o=t.fx;i<o?(m&&Number.isFinite(i)&&d.push([n,i]),m=!1):f<o?m=!0:(m=!1,o<f&&o<i&&o<s(r+t.tol)&&o<s(r-t.tol)&&Number.isFinite(o)&&d.push([r,o]))}}return{setValue:{allMinima:d}}}}},t.numberMinima={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}),definition:({dependencyValues:e})=>({setValue:{numberMinima:e.allMinima.length},checkForActualChange:{numberMinima:!0}})},t.minima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"minimum"===e||void 0===e?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},isArray:!0,nDimensions:2,entryPrefixes:["minimum","minimumLocations","minimumLocation","minimumValues","minimumValue"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if(["minimum","minimumLocation","minimumValue"].includes(e)){let r=Number(t)-1;return Number.isInteger(r)&&r>=0&&(!n||r<n[0])?"minimum"===e?[r+",0",r+",1"]:"minimumLocation"===e?[r+",0"]:[r+",1"]:[]}return"minimumLocations"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",0")):["0,0"]:"minimumValues"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",1")):["0,1"]:[]},arrayVarNameFromArrayKey(e){let[t,n]=e.split(",");return"0"===n?"minimumLocation"+(Number(t)+1):"minimumValue"+(Number(t)+1)},arrayVarNameFromPropIndex(e,t){if("minima"===t)return"minimum"+e;if("minimumLocations"===t)return"minimumLocation"+e;if("minimumValues"===t)return"minimumValue"+e;if("minimum"===t.slice(0,7)){let n=Number(t.slice(7));if(Number.isInteger(n)&&n>0){if(1===e)return"minimumLocation"+n;if(2===e)return"minimumValue"+n}}return null},returnArraySizeDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"}}),returnArraySize:({dependencyValues:e})=>[e.numberMinima,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allMinima[n][r]}return{setValue:{minima:t}}}},t.allMaxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies:({stateValues:e})=>e.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},domain:{dependencyType:"stateVariable",variableName:"domain"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["allMaxima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},domain:{dependencyType:"stateVariable",variableName:"domain"}},definition:function({dependencyValues:t}){if(t.isInterpolatedFunction){let n=t.xs,r=t.coeffs,a=e.eps,i=[];if(null===n)return{setValue:{allMaxima:i}};let o=!1,s=-1/0,l=1/0;if(null!==t.domain){let e=t.domain[0];if(void 0!==e)try{s=e[0].evaluate_to_constant(),Number.isFinite(s)||(s=-1/0),l=e[1].evaluate_to_constant(),Number.isFinite(l)||(l=1/0)}catch(e){}}let u=r[0],c=n[1]-n[0];if(0===u[3]){if(u[2]<0){let e=-u[1]/(2*u[2]);e+n[0]>=s&&e+n[0]<=l&&(e<=c-a?i.push([e+n[0],((u[3]*e+u[2])*e+u[1])*e+u[0]]):Math.abs(e-c)<a&&(o=!0))}}else{let e=4*u[2]*u[2]-12*u[3]*u[1];if(e>0){let t=Math.sqrt(e),r=(-2*u[2]-t)/(6*u[3]);r+n[0]>=s&&r+n[0]<=l&&(r<=c-a?i.push([r+n[0],((u[3]*r+u[2])*r+u[1])*r+u[0]]):Math.abs(r-c)<a&&(o=!0))}}for(let e=1;e<n.length-2;e++)if(u=r[e],c=n[e+1]-n[e],0===u[3])if(u[2]<0){let t=-u[1]/(2*u[2]);if(t+n[e]>=s){if(!(t+n[e]<=l)){o=!1;continue}Math.abs(t)<a?o&&i.push([t+n[e],((u[3]*t+u[2])*t+u[1])*t+u[0]]):t>=a&&t<=c-a&&i.push([t+n[e],((u[3]*t+u[2])*t+u[1])*t+u[0]]),o=Math.abs(t-c)<a}}else o=!1;else{let t=4*u[2]*u[2]-12*u[3]*u[1];if(t>0){let r=Math.sqrt(t),p=(-2*u[2]-r)/(6*u[3]);if(p+n[e]>=s){if(!(p+n[e]<=l)){o=!1;continue}Math.abs(p)<a?o&&i.push([p+n[e],((u[3]*p+u[2])*p+u[1])*p+u[0]]):p>=a&&p<=c-a&&i.push([p+n[e],((u[3]*p+u[2])*p+u[1])*p+u[0]]),o=Math.abs(p-c)<a}}else o=!1}if(u=r[n.length-2],0===u[3]){if(u[2]<0){let e=-u[1]/(2*u[2]);e+n[n.length-2]>=s&&e+n[n.length-2]<=l&&(Math.abs(e)<a?o&&i.push([e+n[n.length-2],((u[3]*e+u[2])*e+u[1])*e+u[0]]):e>=a&&i.push([e+n[n.length-2],((u[3]*e+u[2])*e+u[1])*e+u[0]]))}}else{let e=4*u[2]*u[2]-12*u[3]*u[1];if(e>0){let t=Math.sqrt(e),r=(-2*u[2]-t)/(6*u[3]);r+n[n.length-2]>=s&&r+n[n.length-2]<=l&&(r>=a||Math.abs(r)<a&&o)&&i.push([r+n[n.length-2],((u[3]*r+u[2])*r+u[1])*r+u[0]])}}return{setValue:{allMaxima:i}}}{if(t.functionChild&&t.functionChild.length>0)return{setValue:{allMaxima:t.functionChild[0].stateValues.allMaxima}};if(1!==t.nInputs||1!==t.nOutputs)return{setValue:{allMaxima:[]}};let n,r,a=t.variables[0].subscripts_to_strings().tree,i=t.formula.subscripts_to_strings().derivative(a),o=!0;try{n=i.subscripts_to_strings().f()}catch(e){o=!1,r=()=>NaN}o&&(r=function(e){try{return n({[a]:e})}catch(e){return NaN}});let s=e=>-t.numericalf(e),l=-100*t.xscale,u=100*t.xscale;if(null!==t.domain){let e=t.domain[0];if(void 0!==e)try{l=e[0].evaluate_to_constant(),Number.isFinite(l)||(l=-100*t.xscale),u=e[1].evaluate_to_constant(),Number.isFinite(u)||(u=100*t.xscale)}catch(e){}}let c=1e3,p=(u-l)/c,d=[],m=!1,f=s(l),h=r(l);for(let t=0;t<c;t++){let n=l+t*p,a=l+(t+1)*p,i=f;f=s(a);let u=h;if(h=r(a),Number.isNaN(i)||Number.isNaN(f))continue;let c=!1;if(o&&u*h<=0){let t=e.fzero(r,[n,a]),i=.5*1e-6*(Math.abs(t)+1);r(t-i)>0&&r(t+i)<0&&t!==a&&(c=!0,d.push([t,-s(t)]),m=!1)}if(!c){let t=e.fminbr(s,[n,a],void 0,1e-6);if(!0!==t.success)continue;let r=t.x,o=t.fx;i<o?(m&&Number.isFinite(i)&&d.push([n,-i]),m=!1):f<o?m=!0:(m=!1,o<f&&o<i&&o<s(r+t.tol)&&o<s(r-t.tol)&&Number.isFinite(o)&&d.push([r,-o]))}}return{setValue:{allMaxima:d}}}}},t.numberMaxima={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition:({dependencyValues:e})=>({setValue:{numberMaxima:e.allMaxima.length},checkForActualChange:{numberMaxima:!0}})},t.maxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"maximum"===e||void 0===e?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},isArray:!0,nDimensions:2,entryPrefixes:["maximum","maximumLocations","maximumLocation","maximumValues","maximumValue"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if(["maximum","maximumLocation","maximumValue"].includes(e)){let r=Number(t)-1;return Number.isInteger(r)&&r>=0&&(!n||r<n[0])?"maximum"===e?[r+",0",r+",1"]:"maximumLocation"===e?[r+",0"]:[r+",1"]:[]}return"maximumLocations"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",0")):["0,0"]:"maximumValues"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",1")):["0,1"]:[]},arrayVarNameFromArrayKey(e){let[t,n]=e.split(",");return"0"===n?"maximumLocation"+(Number(t)+1):"maximumValue"+(Number(t)+1)},arrayVarNameFromPropIndex(e,t){if("maxima"===t)return"maximum"+e;if("maximumLocations"===t)return"maximumLocation"+e;if("maximumValues"===t)return"maximumValue"+e;if("maximum"===t.slice(0,7)){let n=Number(t.slice(7));if(Number.isInteger(n)&&n>0){if(1===e)return"maximumLocation"+n;if(2===e)return"maximumValue"+n}}return null},returnArraySizeDependencies:()=>({numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),returnArraySize:({dependencyValues:e})=>[e.numberMaxima,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allMaxima[n][r]}return{setValue:{maxima:t}}}},t.numberExtrema={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"},numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),definition:function({dependencyValues:e}){return{setValue:{numberExtrema:e.numberMinima+e.numberMaxima},checkForActualChange:{numberExtrema:!0}}}},t.allExtrema={returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"},allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:e}){let t=[...e.allMinima,...e.allMaxima].sort(((e,t)=>e[0]-t[0]));return{setValue:{allExtrema:t}}}},t.extrema={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"extremum"===e||void 0===e?[["point",{componentType:"mathList",isAttribute:"xs"}]]:[]},isArray:!0,nDimensions:2,entryPrefixes:["extremum","extremumLocations","extremumLocation","extremumValues","extremumValue"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if(["extremum","extremumLocation","extremumValue"].includes(e)){let r=Number(t)-1;return Number.isInteger(r)&&r>=0&&(!n||r<n[0])?"extremum"===e?[r+",0",r+",1"]:"extremumLocation"===e?[r+",0"]:[r+",1"]:[]}return"extremumLocations"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",0")):["0,0"]:"extremumValues"===e?""!==t?[]:n?Array.from(Array(n[0]),((e,t)=>t+",1")):["0,1"]:[]},arrayVarNameFromArrayKey(e){let[t,n]=e.split(",");return"0"===n?"extremumLocation"+(Number(t)+1):"extremumValue"+(Number(t)+1)},arrayVarNameFromPropIndex(e,t){if("extrema"===t)return"extremum"+e;if("extremumLocations"===t)return"extremumLocation"+e;if("extremumValues"===t)return"extremumValue"+e;if("extremum"===t.slice(0,8)){let n=Number(t.slice(8));if(Number.isInteger(n)&&n>0){if(1===e)return"extremumLocation"+n;if(2===e)return"extremumValue"+n}}return null},returnArraySizeDependencies:()=>({numberExtrema:{dependencyType:"stateVariable",variableName:"numberExtrema"}}),returnArraySize:({dependencyValues:e})=>[e.numberExtrema,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allExtrema:{dependencyType:"stateVariable",variableName:"allExtrema"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allExtrema[n][r]}return{setValue:{extrema:t}}}},t.returnNumericalDerivatives={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies:({stateValues:e})=>e.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}:{functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["returnNumericalDerivatives","variables"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}},definition:function({dependencyValues:e}){if(e.isInterpolatedFunction)return{setValue:{returnNumericalDerivatives:returnReturnDerivativesOfInterpolatedFunction(e)}};if(e.functionChild.length>0&&e.functionChild[0].stateValues.returnNumericalDerivatives){let t=e.variables.map((e=>e.subscripts_to_strings().tree)),n=e.functionChild[0].stateValues.variables,r=n.map((e=>e.subscripts_to_strings().tree)),a={};for(let[e,i]of t.entries())r[e]&&r[e]!==i&&(a[i]=n[e]);if(0===Object.keys(a).length)return{setValue:{returnNumericalDerivatives:e.functionChild[0].stateValues.returnNumericalDerivatives}};return{setValue:{returnNumericalDerivatives:function(t){let n=[];for(let e of t){let t=a[e.subscripts_to_strings().tree];t?n.push(t):n.push(me$3.fromAst(""))}return e.functionChild[0].stateValues.returnNumericalDerivatives(n)}}}}return{setValue:{returnNumericalDerivatives:null}}}},t.numericalDerivativesDefinition={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies:({stateValues:e})=>e.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}}:{functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalDerivativesDefinition","variables"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},variables:{dependencyType:"stateVariable",variableName:"variables"}},definition:function({dependencyValues:e}){if(e.isInterpolatedFunction)return{setValue:{numericalDerivativesDefinition:{derivativeType:"interpolatedFunction",xs:e.xs,coeffs:e.coeffs,variables:e.variables}}};if(e.functionChild.length>0&&e.functionChild[0].stateValues.numericalDerivativesDefinition){let t=e.variables.map((e=>e.subscripts_to_strings().tree)),n=e.functionChild[0].stateValues.variables,r=n.map((e=>e.subscripts_to_strings().tree)),a={};for(let[e,i]of t.entries())r[e]&&r[e]!==i&&(a[i]=n[e]);if(0===Object.keys(a).length)return{setValue:{numericalDerivativesDefinition:e.functionChild[0].stateValues.numericalDerivativesDefinition}};{let t={...e.functionChild[0].stateValues.numericalDerivativesDefinition};return t.variableMappings?t.variableMappings=[a,...t.variableMappings]:t.variableMappings=[a],{setValue:{numericalDerivativesDefinition:t}}}}return{setValue:{numericalDerivativesDefinition:{}}}}},t}static adapters=[{stateVariable:"numericalf",componentType:"curve",stateVariablesToShadow:["labelIsLatex"]},{stateVariable:"formula",componentType:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}]}function calculateInterpolationPoints({dependencyValues:e,numerics:t}){let n=[],r=[],a={maximum:e.prescribedMaxima,minimum:e.prescribedMinima,extremum:e.prescribedExtrema,point:e.prescribedPoints};for(let e in a)for(let t of a[e]){let a=null,i=null,o=null;if(null===t.x||(a=t.x.evaluate_to_constant(),Number.isFinite(a)))if(null===t.y||(i=t.y.evaluate_to_constant(),Number.isFinite(i)))if(null!==t.slope&&void 0!==t.slope&&(o=t.slope.evaluate_to_constant(),Number.isFinite(o)||(console.warn("Ignoring non-numerical slope"),o=null)),null===a){if(null===i){console.warn(`Ignoring empty ${e}`);continue}r.push({type:e,y:i,slope:o})}else n.push({type:e,x:a,y:i,slope:o});else console.warn(`Ignoring non-numerical ${e}`);else console.warn(`Ignoring non-numerical ${e}`)}n.sort(((e,t)=>e.x-t.x)),r.sort(((e,t)=>e.y-t.y));let i=-1/0,o=t.eps;for(let e=0;e<n.length;e++){let t=n[e];if(t.x<=i+o)return console.warn("Two points with locations too close together.  Can't define function"),{setValue:{interpolationPoints:null}};i=t.x}let s,l,u=e.xscale,c=e.yscale;i=void 0;let p=[],d=n[0];for(let e=0;e<n.length;e++){let t=d;d=n[e+1];let r=y({p:t,pNext:d,typePrev:l,xPrev:i,yPrev:s});l=r.type,i=r.x,s=r.y}let m=!1;for(0===n.length&&(m=!0);r.length>0;){let e,t;void 0===l?e=v({allowedTypes:["maximum","minimum","extremum"],comparison:"atLeast",value:-1/0}):"maximum"===l?e=v({allowedTypes:["minimum","extremum"],comparison:"atMost",value:s-c}):"minimum"===l?e=v({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:s+c}):"point"===l&&(e=v({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:s+c}),!0!==e.success&&(e=v({allowedTypes:["minimum","extremum"],comparison:"atMost",value:s-c}))),!0===e.success?(t=e.point,r.splice(e.ind,1),m?(t.x=0,m=!1):t.x=i+u):(t=r.pop(),m?(t.x=0,m=!1):t.x=i+2*u);let n=y({p:t,typePrev:l,xPrev:i,yPrev:s});l=n.type,i=n.x,s=n.y}if(0===p.length&&p.push({type:"point",x:0,y:0,slope:0}),m=p[0],"maximum"===m.type){let e={type:"point",x:m.x-u,y:m.y-c,slope:2*c/u};p.splice(0,0,e)}else if("minimum"===m.type){let e={type:"point",x:m.x-u,y:m.y+c,slope:-2*c/u};p.splice(0,0,e)}else if("point"===m.type)if(1===p.length)null===m.slope&&(m.slope=0);else{let e=p[1],t=(e.y-m.y)/(e.x-m.x);if("maximum"===e.type||"minimum"===e.type)null===m.slope&&(m.slope=2*t);else{2===p.length?null===m.slope&&(m.slope=t):(null===e.slope&&(e.slope=h({point:e,prevPoint:m,nextPoint:p[2]})),null===m.slope&&(m.slope=2*(m.y-e.y)/(m.x-e.x)-e.slope));let n={x:m.x-u,y:m.y-u*m.slope,slope:m.slope};p.splice(0,0,n)}}let f=p[p.length-1];if("maximum"===f.type){let e={type:"point",x:f.x+u,y:f.y-c,slope:-2*c/u};p.push(e)}else if("minimum"===f.type){let e={type:"point",x:f.x+u,y:f.y+c,slope:2*c/u};p.push(e)}else if("point"===f.type)if(1===p.length){let e={type:"point",x:f.x+u,y:f.y+m.slope*u,slope:m.slope};p.push(e)}else{let e=p[p.length-2],t=(e.y-f.y)/(e.x-f.x);if("maximum"===e.type||"minimum"===e.type)null===f.slope&&(f.slope=2*t);else{2===p.length?null===f.slope&&(f.slope=t):(null===e.slope&&(e.slope=h({point:e,prevPoint:p[p.length-3],nextPoint:f})),null===f.slope&&(f.slope=2*(e.y-f.y)/(e.x-f.x)-e.slope));let n={x:f.x+u,y:f.y+u*f.slope,slope:f.slope};p.push(n)}}for(let e=1;e<p.length-1;e++){let t=p[e];null===t.slope&&(t.slope=h({point:t,prevPoint:p[e-1],nextPoint:p[e+1]}))}return{setValue:{interpolationPoints:p}};function h({point:e,prevPoint:t,nextPoint:n}){let r=e.x-t.x,a=n.x-e.x,i=(e.y-t.y)/r,o=(n.y-e.y)/a,s=(i*a+o*r)/(r+a);return(Math.sign(i)+Math.sign(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(s))}function y({p:e,pNext:t,typePrev:n,xPrev:a,yPrev:i}){let o;if(void 0!==t&&(o=t.y),"maximum"===e.type)return b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t});if("minimum"===e.type)return g({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t});if("extremum"===e.type){let r;if(void 0===n){if(void 0===t)return b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t});r=t.type}if("maximum"===n||"maximum"===r)return null!==e.y&&e.y>i-c||void 0!==r&&null!==e.y&&e.y>t.y-c?b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t}):g({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t});if("minimum"===n||"minimum"===r)return null!==e.y&&e.y<i+c||void 0!==r&&null!==e.y&&e.y>t.y+c?g({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t}):b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t});if("point"===n||"point"===r){let s="maximum";return(null===e.y&&void 0!==t&&t.type===maximum||null!==e.y&&e.y<=i-c||void 0!==r&&null!==e.y&&e.y>=t.y-c)&&(s="minimum"),"minimum"===s?g({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t}):b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t})}return null!==e.y&&e.y<t.y-c?g({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t}):b({x:e.x,y:e.y,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t})}return"point"===e.type?function({x:e,y:t,slope:n,typePrev:a,xPrev:i,yPrev:o,yNext:s,pNext:l}){if("maximum"===a){if(t>o-c){let n,a,s=(e+i)/2,l=null,u=v({allowedTypes:["minimum","extremum"],comparison:"atMost",value:Math.min(o,t)-c});!0===u.success?(a="minimum",n=u.point.y,r.splice(u.ind,1),l=0):(a="point",n=o-c),p.push({type:a,x:s,y:n,slope:l})}}else if("minimum"===a&&t<o+c){let n,a,s=(e+i)/2,l=null,u=v({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:Math.max(o,t)+c});!0===u.success?(a="maximum",n=u.point.y,r.splice(u.ind,1),l=0):(a="point",n=o+c),p.push({type:a,x:s,y:n,slope:l})}let u={type:"point",x:e,y:t,slope:n};return p.push(u),u}({x:e.x,y:e.y,slope:e.slope,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:t}):void 0}function b({x:e,y:t,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:s}){if(void 0===n)null===t&&(t=void 0===o?0:"maximum"===s.type?o:o+c);else if("maximum"===n){null===t&&(t=void 0===o?i:"maximum"===s.type?Math.max(i,o):Math.max(i,o+c));let n,l,u=Math.min(i,t)-c,d=(e+a)/2,m=null,f=v({allowedTypes:["minimum","extremum"],comparison:"atMost",value:u});!0===f.success?(l="minimum",n=f.point.y,r.splice(f.ind,1),m=0):(l="point",n=u),p.push({type:l,x:d,y:n,slope:m})}else if("minimum"===n){if(null===t)t=void 0===o?i+c:"maximum"===s.type?Math.max(i+c,o):Math.max(i,o)+c;else if(t<i+c){let n=[(2*a+e)/3,(a+2*e)/3],o=[i+c,t-c],s=["atLeast","atMost"],l=[["maximum","extremum"],["minimum","extremum"]];for(let e=0;e<2;e++){let t,a,i=n[e],u=null,c=v({allowedTypes:l[e],comparison:s[e],value:o[e]});!0===c.success?(a=l[e][0],t=c.point.y,r.splice(c.ind,1),u=0):(a="point",t=o[e],u=null),p.push({type:a,x:i,y:t,slope:u})}}}else if("point"===n)if(null===t)t=void 0===o?i+c:"maximum"===s.type?Math.max(i+c,o):Math.max(i,o)+c;else if(t<i+c){let n,i,o=(e+a)/2,s=null,l=v({allowedTypes:["minimum","extremum"],comparison:"atMost",value:t-c});!0===l.success?(i="minimum",n=l.point.y,r.splice(l.ind,1),s=0):(i="point",n=t-c),p.push({type:i,x:o,y:n,slope:s})}let l={type:"maximum",x:e,y:t,slope:0};return p.push(l),l}function g({x:e,y:t,typePrev:n,xPrev:a,yPrev:i,yNext:o,pNext:s}){if(void 0===n)null===t&&(t=void 0===o?0:"minimum"===s.type?o:o-c);else if("maximum"===n){if(null===t)t=void 0===o?i-c:"minimum"===s.type?Math.min(i-c,o):Math.min(i,o)-c;else if(t>i-c){let n=[(2*a+e)/3,(a+2*e)/3],o=[i-c,t+c],s=["atMost","atLeast"],l=[["minimum","extremum"],["maximum","extremum"]];for(let e=0;e<2;e++){let t,a,i=n[e],u=null,c=v({allowedTypes:l[e],comparison:s[e],value:o[e]});!0===c.success?(a=l[e][0],t=c.point.y,r.splice(c.ind,1),u=0):(a="point",t=o[e],u=null),p.push({type:a,x:i,y:t,slope:u})}}}else if("minimum"===n){null===t&&(t=void 0===o?i:"minimum"===s.type?Math.min(i,o):Math.min(i,o-c));let n,l,u=Math.max(i,t)+c,d=(e+a)/2,m=null,f=v({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:u});!0===f.success?(l="maximum",n=f.point.y,r.splice(f.ind,1),m=0):(l="point",n=u),p.push({type:l,x:d,y:n,slope:m})}else if("point"===n)if(null===t)t=void 0===o?i-c:"minimum"===s.type?Math.min(i-c,o):Math.min(i,o)-c;else if(t>i-c){let n,i,o=(e+a)/2,s=null,l=v({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:t+c});!0===l.success?(i="maximum",n=l.point.y,r.splice(l.ind,1),s=0):(i="point",n=t+c),p.push({type:i,x:o,y:n,slope:s})}let l={type:"minimum",x:e,y:t,slope:0};return p.push(l),l}function v({allowedTypes:e,comparison:t,value:n}){let a=[];if("atMost"===t)a=Object.keys(r).reverse();else{if("atLeast"!==t)return{success:!1};a=Object.keys(r)}for(let i of e)for(let e of a){let a=r[e];if(a.type===i)if("atMost"===t){if(a.y<=n)return{success:!0,ind:e,point:a}}else if(a.y>=n)return{success:!0,ind:e,point:a}}return{success:!1}}}function computeSplineParamCoeffs({dependencyValues:e}){let t=e.interpolationPoints;if(null===t)return{setValue:{xs:null,coeffs:null}};let n,r=[],a=[],i=t[0];a.push(i.x);for(let e=1;e<t.length;e++){n=i,i=t[e];let p=(o=n.y,s=i.y,l=n.slope,u=i.slope,c=i.x-n.x,[o,l,(-3*o/c+3*s/c-2*l-u)/c,(2*o/c-2*s/c+l+u)/(c*c)]);Math.abs(p[3])<1e-14*Math.max(Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2]))&&(p[3]=0,Math.abs(p[2])<1e-14*Math.max(Math.abs(p[0]),Math.abs(p[1]))&&(p[2]=0)),r.push(p),a.push(i.x)}var o,s,l,u,c;return{setValue:{xs:a,coeffs:r}}}class FunctionOperator extends Function$2{static componentType="_functionOperator";static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e}){return e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro))?1===e.length&&"string"!=typeof e[0]?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:e}]}:{success:!1}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"functions",componentTypes:["function"]}]}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e}),n=this.componentType;t.isInterpolatedFunction={returnDependencies:()=>({}),definition:()=>({setValue:{isInterpolatedFunction:!1}})},delete t.nPrescribedPoints,delete t.prescribedPoints,delete t.prescribedMinima,delete t.prescribedMaxima,delete t.prescribedExtrema,delete t.interpolationPoints,delete t.xs,t.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({setValue:{operatorBasedOnFormulaIfAvailable:!1}})},t.formula.returnDependencies=()=>({}),t.formula.definition=()=>({setValue:{formula:me$3.fromAst("")}}),t.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({setValue:{operatorComposesWithOriginal:!0}})},t.symbolicFunctionOperator={returnDependencies:()=>({}),definition:()=>({setValue:{symbolicFunctionOperator:e=>me$3.fromAst("")}})},t.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({}),definition:()=>({setValue:{numericalFunctionOperator:e=>NaN,numericalFunctionOperatorArguments:[]}})},t.numericalFunctionOperatorArguments={returnDependencies:()=>({}),definition:()=>({setValue:{numericalFunctionOperatorArguments:{}}})},t.formulaOperator={returnDependencies:()=>({}),definition:()=>({setValue:{formulaOperator:e=>me$3.fromAst("")}})},t.returnNumericalDerivatives={returnDependencies:()=>({}),definition:()=>({setValue:{returnNumericalDerivatives:null}})},t.formula={public:!0,shadowingInstructions:{createComponentOfType:"math"},additionalStateVariablesDefined:["operatorBasedOnFormula"],returnDependencies:()=>({operatorBasedOnFormulaIfAvailable:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormulaIfAvailable"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["formula"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},formulaOperator:{dependencyType:"stateVariable",variableName:"formulaOperator"}}),definition:function({dependencyValues:e}){if(!e.operatorBasedOnFormulaIfAvailable||(0===e.functionChild.length||""===e.functionChild[0].stateValues.formula.tree)&&(0===e.mathChild.length||""===e.mathChild[0].stateValues.value.tree))return{setValue:{formula:me$3.fromAst(""),operatorBasedOnFormula:!1}};let t;return t=0===e.functionChild.length?e.mathChild[0].stateValues.value:e.functionChild[0].stateValues.formula,{setValue:{formula:e.formulaOperator(t),operatorBasedOnFormula:!0}}}},t.symbolicfs={isArray:!0,entryPrefixes:["symbolicf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize:({dependencyValues:e})=>[e.nOutputs],returnArrayDependenciesByKey:()=>({globalDependencies:{operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["symbolicfs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},symbolicFunctionOperator:{dependencyType:"stateVariable",variableName:"symbolicFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}),arrayDefinitionByKey:function({globalDependencyValues:e,usedDefault:t,arrayKeys:n,arraySize:r}){if(!e.operatorBasedOnFormula){if(e.operatorComposesWithOriginal){if(0===e.functionChild.length){if(0===e.mathChild.length){let e={};for(let t of n)e[t]=e=>me$3.fromAst("");return{setValue:{symbolicfs:e}}}{let t=Object.assign({},e);t.formula=e.mathChild[0].stateValues.value;let a=[];for(let e=0;e<r[0];e++)a.push(returnSymbolicFunctionFromFormula(t,e));let i={};for(let t of n)i[t]=(...t)=>e.symbolicFunctionOperator(...a.map((e=>e(...t))));return{setValue:{symbolicfs:i}}}}{let t=[];for(let n=0;n<r[0];n++)t.push(e.functionChild[0].stateValues.symbolicfs[n]);let a={};for(let r of n)a[r]=(...n)=>e.symbolicFunctionOperator(...t.map((e=>e(...n))));return{setValue:{symbolicfs:a}}}}{let t={};for(let r of n)t[r]=(...t)=>e.symbolicFunctionOperator(...t);return{setValue:{symbolicfs:t}}}}{let t={};for(let r of n)return t[r]=returnSymbolicFunctionFromFormula(e,r),{setValue:{symbolicfs:t}}}}},t.numericalfs={isArray:!0,entryPrefixes:["numericalf"],returnArraySizeDependencies:()=>({nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"}}),returnArraySize:({dependencyValues:e})=>[e.nOutputs],returnArrayDependenciesByKey:()=>({globalDependencies:{operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalfs"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}}),arrayDefinitionByKey:function({globalDependencyValues:e,usedDefault:t,arrayKeys:n,arraySize:r}){if(!e.operatorBasedOnFormula){if(e.operatorComposesWithOriginal){if(0===e.functionChild.length){if(0===e.mathChild.length){let e={};for(let t of n)e[t]=e=>NaN;return{setValue:{numericalfs:e}}}{Object.assign({},e).formula=e.mathChild[0].stateValues.value;let t=[];for(let n=0;n<r[0];n++)t.push(returnNumericalFunctionFromFormula({formula:e.formula,nInputs:e.nInputs,variables:e.variables,domain:e.domain,component:n}));let a={};for(let r of n)a[r]=(...n)=>e.numericalFunctionOperator(...t.map((e=>e(...n))));return{setValue:{numericalfs:a}}}}{let t=[];for(let n=0;n<r[0];n++)t.push(e.functionChild[0].stateValues.numericalfs[n]);let a={};for(let r of n)a[r]=(...n)=>e.numericalFunctionOperator(...t.map((e=>e(...n))));return{setValue:{numericalfs:a}}}}{let t={};for(let r of n)t[r]=(...t)=>e.numericalFunctionOperator(...t);return{setValue:{numericalfs:t}}}}{let t={};for(let r of n)return t[r]=returnNumericalFunctionFromFormula({formula:e.formula,nInputs:e.nInputs,variables:e.variables,domain:e.domain,component:r}),{setValue:{numericalfs:t}}}}},t.fDefinition={returnDependencies:()=>({operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variables:{dependencyType:"stateVariable",variableName:"variables"},nInputs:{dependencyType:"stateVariable",variableName:"nInputs"},nOutputs:{dependencyType:"stateVariable",variableName:"nOutputs"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["fDefinition"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},numericalFunctionOperatorArguments:{dependencyType:"stateVariable",variableName:"numericalFunctionOperatorArguments"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"},domain:{dependencyType:"stateVariable",variableName:"domain"}}),definition({dependencyValues:e}){if(e.operatorBasedOnFormula)return{setValue:{fDefinition:{functionType:"formula",formula:e.formula.tree,variables:e.variables.map((e=>e.tree)),nInputs:e.nInputs,nOutputs:e.nOutputs,domain:e.domain}}};if(e.operatorComposesWithOriginal){if(0===e.functionChild.length){if(0===e.mathChild.length)return{setValue:{fDefinition:{functionType:"formula",formula:"",variables:e.variables.map((e=>e.tree)),nInputs:e.nInputs,nOutputs:e.nOutputs,domain:e.domain}}};throw Error("function operator with math child not implemented yet")}return{setValue:{fDefinition:{functionType:"functionOperator",componentType:n,nOutputs:e.nOutputs,functionOperatorArguments:e.numericalFunctionOperatorArguments,operatorComposesWithOriginal:!0,originalFDefinition:e.functionChild[0].stateValues.fDefinition}}}}return{setValue:{fDefinition:{functionType:"functionOperator",componentType:n,nOutputs:e.nOutputs,functionOperatorArguments:e.numericalFunctionOperatorArguments,operatorComposesWithOriginal:!1,originalFDefinition:e.functionChild[0].stateValues.fDefinition}}}}};let r=t.allMinima.returnDependencies;t.allMinima.returnDependencies=function(e){let t=r(e);return delete t.functionChild,t};let a=t.allMaxima.returnDependencies;return t.allMaxima.returnDependencies=function(e){let t=a(e);return delete t.functionChild,t},t}}class ClampFunction extends FunctionOperator{static componentType="clampFunction";static createAttributesObject(){let e=super.createAttributesObject();return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:e}){return{setValue:{numericalFunctionOperator:functionOperatorDefinitions.clampFunction(e.lowerValue,e.upperValue),numericalFunctionOperatorArguments:[e.lowerValue,e.upperValue]}}}},t.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition:({dependencyValues:e})=>({setValue:{symbolicFunctionOperator:t=>me$3.fromAst(e.numericalFunctionOperator(t.evaluate_to_constant()))}})},t}}class WrapFunctionPeriodic extends FunctionOperator{static componentType="wrapFunctionPeriodic";static createAttributesObject(){let e=super.createAttributesObject();return e.lowerValue={createComponentOfType:"number",createStateVariable:"lowerValue",defaultValue:0,public:!0},e.upperValue={createComponentOfType:"number",createStateVariable:"upperValue",defaultValue:1,public:!0},e}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.numericalFunctionOperator={additionalStateVariablesDefined:["numericalFunctionOperatorArguments"],returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:e}){return{setValue:{numericalFunctionOperator:functionOperatorDefinitions.wrapFunctionPeriodic(e.lowerValue,e.upperValue),numericalFunctionOperatorArguments:[e.lowerValue,e.upperValue]}}}},t.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition:({dependencyValues:e})=>({setValue:{symbolicFunctionOperator:t=>me$3.fromAst(e.numericalFunctionOperator(t.evaluate_to_constant()))}})},t}}class Derivative extends FunctionOperator{static componentType="derivative";static createAttributesObject(){let e=super.createAttributesObject();return e.derivVariables={createComponentOfType:"variables"},e}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({setValue:{operatorBasedOnFormulaIfAvailable:!0}})},t.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({setValue:{operatorComposesWithOriginal:!1}})},t.haveFunctionChild={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"]}}),definition:({dependencyValues:e})=>({setValue:{haveFunctionChild:e.functionChild.length>0}})},t.nInputs={defaultValue:1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},stateVariablesDeterminingDependencies:["haveFunctionChild"],returnDependencies({stateValues:e}){let t={nInputsAttr:{dependencyType:"attributeComponent",attributeName:"nInputs",variableNames:["value"]},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nInputs"]},variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["nComponents"]}};return e.haveFunctionChild||(t.derivVariablesAttr={dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]}),t},definition({dependencyValues:e}){if(null!==e.nInputsAttr){let t=e.nInputsAttr.stateValues.value;return t>=0||(t=1),{setValue:{nInputs:t}}}if(null!==e.variablesAttr)return{setValue:{nInputs:Math.max(1,e.variablesAttr.stateValues.nComponents)}};if(e.functionChild.length>0)return{setValue:{nInputs:e.functionChild[0].stateValues.nInputs}};if(null!==e.derivVariablesAttr){let t=[...new Set(e.derivVariablesAttr.stateValues.variables.map((e=>e.subscripts_to_strings().tree)))].length;return{setValue:{nInputs:t}}}return{useEssentialOrDefaultValue:{nInputs:!0}}}},t.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({nInputs:{dependencyType:"stateVariable",variableName:"nInputs"}}),returnArraySize:({dependencyValues:e})=>[e.nInputs],stateVariablesDeterminingDependencies:["haveFunctionChild"],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"},haveFunctionChild:{dependencyType:"stateVariable",variableName:"haveFunctionChild"}},r={};if(t.haveFunctionChild)for(let t of e)r[t]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["variable"+(Number(t)+1)]}};else n.derivVariablesAttr={dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arraySize:n,arrayKeys:r,usedDefault:a}){if(null!==e.variablesAttr){let t=e.variablesAttr.stateValues.variables;return{setValue:{variables:returnNVariables(n[0],t)}}}if(e.haveFunctionChild){let e={};for(let n of r)e[n]=t[n].functionChild[0].stateValues["variable"+(Number(n)+1)];return{setValue:{variables:e}}}if(null!==e.derivVariablesAttr){let t=[],r=[];for(let n of e.derivVariablesAttr.stateValues.variables){let e=n.subscripts_to_strings().tree;r.includes(e)||(t.push(n),r.push(e))}return{setValue:{variables:returnNVariables(n[0],t)}}}return e.parentVariableForChild&&!a.parentVariableForChild?{setValue:{variables:Array(n[0]).fill(e.parentVariableForChild)}}:{setValue:{variables:returnNVariables(n[0],[])}}}},t.nDerivatives={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({derivVariablesAttr:{dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["nComponents"]}}),definition:({dependencyValues:e})=>null!==e.derivVariablesAttr?{setValue:{nDerivatives:e.derivVariablesAttr.stateValues.nComponents}}:{setValue:{nDerivatives:1}}},t.derivVariables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["derivVariable"],returnArraySizeDependencies:()=>({nDerivatives:{dependencyType:"stateVariable",variableName:"nDerivatives"}}),returnArraySize:({dependencyValues:e})=>[e.nDerivatives],returnArrayDependenciesByKey:()=>({globalDependencies:{derivVariablesAttr:{dependencyType:"attributeComponent",attributeName:"derivVariables",variableNames:["variables"]},variable1:{dependencyType:"stateVariable",variableName:"variable1"}}}),arrayDefinitionByKey:({globalDependencyValues:e})=>null!==e.derivVariablesAttr?{setValue:{derivVariables:e.derivVariablesAttr.stateValues.variables}}:{setValue:{derivVariables:{0:e.variable1}}}},t.formulaOperator={returnDependencies:()=>({derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),definition:({dependencyValues:e})=>({setValue:{formulaOperator:function(t){let n=t.subscripts_to_strings();for(let t of e.derivVariables)n=n.derivative(t.subscripts_to_strings().tree);return n.strings_to_subscripts()}}})},t.numericalFunctionOperator={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["returnNumericalDerivatives"],variablesOptional:!0},derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),additionalStateVariablesDefined:["returnNumericalDerivatives"],definition:function({dependencyValues:e}){if(0===e.functionChild.length||!e.functionChild[0].stateValues.returnNumericalDerivatives)return{setValue:{numericalFunctionOperator:e=>NaN,returnNumericalDerivatives:null}};return{setValue:{numericalFunctionOperator:e.functionChild[0].stateValues.returnNumericalDerivatives(e.derivVariables),returnNumericalDerivatives:function(t){let n=[...e.derivVariables,...t];return e.functionChild[0].stateValues.returnNumericalDerivatives(n)}}}}},t.numericalFunctionOperatorArguments={returnDependencies:()=>({functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalDerivativesDefinition"],variablesOptional:!0},derivVariables:{dependencyType:"stateVariable",variableName:"derivVariables"}}),additionalStateVariablesDefined:["numericalDerivativesDefinition"],definition:function({dependencyValues:e}){if(0===e.functionChild.length||!e.functionChild[0].stateValues.numericalDerivativesDefinition)return{setValue:{numericalFunctionOperatorArguments:[],numericalDerivativesDefinition:{}}};let t=e.functionChild[0].stateValues.numericalDerivativesDefinition,n={...t};return n.additionalDerivVariables?n.additionalDerivVariables=[...e.derivVariables,...n.additionalDerivVariables]:n.additionalDerivVariables=[...e.derivVariables],{setValue:{numericalFunctionOperatorArguments:[t,e.derivVariables],numericalDerivativesDefinition:n}}}},t.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition:({dependencyValues:e})=>({setValue:{symbolicFunctionOperator:t=>me$3.fromAst(e.numericalFunctionOperator(t.evaluate_to_constant()))}})},t}}var FunctionOperators=Object.freeze({__proto__:null,ClampFunction:ClampFunction,WrapFunctionPeriodic:WrapFunctionPeriodic,Derivative:Derivative});class TextBaseOperatorOfMath extends Text{static componentType="_textOperatorOfMath";static rendererType="text";static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=this;return e.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}),definition:function({dependencyValues:e}){return{setValue:{value:t.applyTextOperator(e.mathChildren.map((e=>e.stateValues.value)))}}}},e}}class ExtractMathOperator extends TextBaseOperatorOfMath{static componentType="extractMathOperator";static applyTextOperator(e){return 0===e.length?"":1!==e.length?(console.warn("MathOperator requires exactly one math child"),""):Array.isArray(e[0].tree)?e[0].tree[0]:""}}var TextOperatorsOfMath=Object.freeze({__proto__:null,ExtractMathOperator:ExtractMathOperator});class Extremum extends BaseComponent{static componentType="extremum";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.location={createComponentOfType:"math"},e.value={createComponentOfType:"math"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({childrenRegex:/s+(.*s)?/,replacementFunction:function({matchedChildren:e}){let t=returnBreakStringsSugarFunction({childrenToComponentFunction:e=>({componentType:"math",children:e}),mustStripOffOuterParentheses:!0}),n=t({matchedChildren:e});if(!n.success&&1===e.length)return{success:!0,newAttributes:{value:{component:{componentType:"math",children:e}}}};if(n.success){if(1===n.newChildren.length)return{success:!0,newAttributes:{value:{component:n.newChildren[0]}}};if(2===n.newChildren.length){let e=n.newChildren[0],t=n.newChildren[1],r={location:{component:e},value:{component:t}};return(0===e.children.length||1===e.children.length&&"string"==typeof e.children[0]&&""===e.children[0].trim())&&delete r.location,(0===t.children.length||1===t.children.length&&"string"==typeof t.children[0]&&""===t.children[0].trim())&&delete r.value,{success:!0,newAttributes:r}}return{success:!1}}return n}}),e}static returnChildGroups(){return[{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e}),n=this;return t.value={public:!0,shadowingInstructions:{createComponentOfType:"math"},defaultValue:null,hasEssential:!0,additionalStateVariablesDefined:[{variableName:"location",public:!0,shadowingInstructions:{createComponentOfType:"math"},defaultValue:null,hasEssential:!0}],returnDependencies:()=>({extremumChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions","xs"]},location:{dependencyType:"attributeComponent",attributeName:"location",variableNames:["value"]},value:{dependencyType:"attributeComponent",attributeName:"value",variableNames:["value"]}}),definition:function({dependencyValues:e}){let t,r;if(e.extremumChild.length>0){let a=e.extremumChild[0];2!==a.stateValues.nDimensions?(console.log("Cannot determine "+n.componentType+" from a point that isn't 2D"),t=null,r=null):(t=a.stateValues.xs[0],r=a.stateValues.xs[1])}else null!==e.location&&(t=e.location.stateValues.value),null!==e.value&&(r=e.value.stateValues.value);let a={},i={},o=!1,s=!1;void 0===t?(i.location=!0,s=!0):(a.location=t,o=!0),void 0===r?(i.value=!0,s=!0):(a.value=r,o=!0);let l={};return o&&(l.setValue=a),s&&(l.useEssentialOrDefaultValue=i),l}},t}}class Extrema extends BaseComponent{static componentType="extrema";static rendererType=void 0;static componentTypeSingular="extremum";static get componentTypeCapitalized(){return this.componentType.charAt(0).toUpperCase()+this.componentType.slice(1)}static returnSugarInstructions(){let e=super.returnSugarInstructions(),t=this;return e.push({replacementFunction:function({matchedChildren:e}){let n=breakEmbeddedStringsIntoParensPieces({componentList:e});return!0!==n.success?{success:!1}:{success:!0,newChildren:n.pieces.map((function(e){return e.length>1||"string"==typeof e[0]?{componentType:t.componentTypeSingular,children:e}:e[0]}))}}}),e}static returnChildGroups(){return[{group:"extrema",componentTypes:[this.componentTypeSingular]},{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=this;return e["n"+t.componentTypeCapitalized]={additionalStateVariablesDefined:["childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childGroups:["extrema","points"]}}),definition:function({dependencyValues:e}){return{setValue:{["n"+t.componentTypeCapitalized]:e.children.length,childIdentities:e.children}}}},e[t.componentType]={isArray:!0,nDimensions:2,entryPrefixes:[t.componentTypeSingular,t.componentTypeSingular+"Locations",t.componentTypeSingular+"Location",t.componentTypeSingular+"Values",t.componentTypeSingular+"Value"],stateVariablesDeterminingDependencies:["childIdentities"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if([t.componentTypeSingular,t.componentTypeSingular+"Location",t.componentTypeSingular+"Value"].includes(e)){let a=Number(n)-1;return Number.isInteger(a)&&a>=0&&(!r||a<r[0])?e===t.componentTypeSingular?[a+",0",a+",1"]:e===t.componentTypeSingular+"Location"?[a+",0"]:[a+",1"]:[]}return e===t.componentTypeSingular+"Locations"?""!==n?[]:r?Array.from(Array(r[0]),((e,t)=>t+",0")):["0,0"]:e===t.componentTypeSingular+"Values"?""!==n?[]:r?Array.from(Array(r[0]),((e,t)=>t+",1")):["0,1"]:[]},arrayVarNameFromArrayKey(e){let[n,r]=e.split(",");return"0"===r?t.componentTypeSingular+"Location"+(Number(n)+1):t.componentTypeSingular+"Value"+(Number(n)+1)},arrayVarNameFromPropIndex(e,n){if(n===t.componentType)return t.componentTypeSingular+e;if(n===t.componentTypeSingular+"Locations")return t.componentTypeSingular+"Location"+e;if(n===t.componentTypeSingular+"Values")return t.componentTypeSingular+"Value"+e;let r=t.componentTypeSingular.length;if(n.slice(0,r)===t.componentTypeSingular){let a=Number(n.slice(r));if(Number.isInteger(a)&&a>0){if(1===e)return t.componentTypeSingular+"Location"+a;if(2===e)return t.componentTypeSingular+"Value"+a}}return null},returnArraySizeDependencies:()=>({nChildren:{dependencyType:"stateVariable",variableName:"n"+t.componentTypeCapitalized}}),returnArraySize:({dependencyValues:e})=>[e.nChildren,2],returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let a of e){let e,[i,o]=a.split(",");e=n.childIdentities[i].componentType===t.componentTypeSingular?0===Number(o)?"location":"value":"x"+(Number(o)+1),r[a]={child:{dependencyType:"child",childGroups:["extrema","points"],variableNames:[e],childIndices:[i]}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let t of n){let n=e[t].child[0];if(n){let e=t.split(",")[1],a=0===Number(e)?"location":"value";a in n.stateValues?r[t]=n.stateValues[a]:r[t]=n.stateValues["x"+(Number(e)+1)]}}return{setValue:{[t.componentType]:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n}){let r=[];for(let a in e[t.componentType])r.push({setDependency:n[a].extremumChild,desiredValue:e[t.componentType][a],childIndex:0,variableIndex:0});return{success:!0,instructions:r}}},e}}var Extrema$1=Object.freeze({__proto__:null,Extremum:Extremum,Extrema:Extrema});class InlineRenderInlineChildren extends InlineComponent{static componentType="_inlineRenderInlineChildren";static renderChildren=!0;static includeBlankStringChildren=!0;static beginTextDelimiter="";static endTextDelimiter="";static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=this;return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let t of e.inlineChildren)"object"!=typeof t?n+=t.toString():"string"==typeof t.stateValues.text?n+=t.stateValues.text:n+=" ";return n=t.beginTextDelimiter+n+t.endTextDelimiter,{setValue:{text:n}}}},e}}class Em extends InlineRenderInlineChildren{static componentType="em"}class Alert extends InlineRenderInlineChildren{static componentType="alert"}class Q$2 extends InlineRenderInlineChildren{static componentType="q";static beginTextDelimiter='"';static endTextDelimiter='"'}class SQ extends InlineRenderInlineChildren{static componentType="sq";static beginTextDelimiter="'";static endTextDelimiter="'"}class Term extends InlineRenderInlineChildren{static componentType="term";static rendererType="alert"}class C$2 extends InlineRenderInlineChildren{static componentType="c"}class Tag extends InlineRenderInlineChildren{static componentType="tag";static rendererType="tag";static beginTextDelimiter="<";static endTextDelimiter=">"}class Tage extends InlineRenderInlineChildren{static componentType="tage";static rendererType="tag";static beginTextDelimiter="<";static endTextDelimiter="/>";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.selfClosed={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{selfClosed:!0}})},e}}class Attr extends InlineRenderInlineChildren{static componentType="attr";static rendererType="c"}var ParagraphMarkup=Object.freeze({__proto__:null,Em:Em,Alert:Alert,Q:Q$2,SQ:SQ,Term:Term,C:C$2,Tag:Tag,Tage:Tage,Attr:Attr});class SingleCharacter extends InlineComponent{static componentType="_singleCharacterInline";static unicodeCharacter="";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({}),definition:()=>({setValue:{text:this.unicodeCharacter}})},e}}class Ndash extends SingleCharacter{static componentType="ndash";static unicodeCharacter=""}class Mdash extends SingleCharacter{static componentType="mdash";static unicodeCharacter=""}class NBSP extends SingleCharacter{static componentType="nbsp";static unicodeCharacter=""}class Ellipsis extends SingleCharacter{static componentType="ellipsis";static unicodeCharacter=""}var SingleCharacterComponents=Object.freeze({__proto__:null,Ndash:Ndash,Mdash:Mdash,NBSP:NBSP,Ellipsis:Ellipsis});class BlockComponent extends BaseComponent{static componentType="_block"}function returnStandardSequenceAttributes(){return{type:{createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"number",toLowerCase:!0,validValues:["number","math","letters"]},from:{createComponentOfType:"_componentWithSelectableType"},to:{createComponentOfType:"_componentWithSelectableType"},step:{createComponentOfType:"math"},length:{createComponentOfType:"number"},exclude:{createComponentOfType:"_componentListWithSelectableType"}}}function returnStandardSequenceStateVariableDefinitions(){let e={specifiedFrom:{returnDependencies:()=>({fromAttr:{dependencyType:"attributeComponent",attributeName:"from",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"from",definition:function({dependencyValues:e}){return null===e.fromAttr?{useEssentialOrDefaultValue:{specifiedFrom:!0}}:null===e.fromAttr.stateValues.value?{setValue:{specifiedFrom:NaN}}:{setValue:{specifiedFrom:e.fromAttr.stateValues.value}}}},specifiedTo:{returnDependencies:()=>({toAttr:{dependencyType:"attributeComponent",attributeName:"to",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"to",definition:function({dependencyValues:e}){return null===e.toAttr?{useEssentialOrDefaultValue:{specifiedTo:!0}}:null===e.toAttr.stateValues.value?{setValue:{specifiedTo:NaN}}:{setValue:{specifiedTo:e.toAttr.stateValues.value}}}},specifiedLength:{returnDependencies:()=>({lengthAttr:{dependencyType:"attributeComponent",attributeName:"length",variableNames:["value"]}}),defaultValue:null,hasEssential:!0,essentialVarName:"length",definition:function({dependencyValues:e}){return null===e.lengthAttr?{useEssentialOrDefaultValue:{specifiedLength:!0}}:null===e.lengthAttr.stateValues.value?{setValue:{specifiedLength:NaN}}:{setValue:{specifiedLength:e.lengthAttr.stateValues.value}}}},specifiedStep:{returnDependencies:()=>({stepAttr:{dependencyType:"attributeComponent",attributeName:"step",variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"}}),defaultValue:null,hasEssential:!0,essentialVarName:"step",definition:function({dependencyValues:e}){if(null===e.stepAttr)return{useEssentialOrDefaultValue:{specifiedStep:!0}};let t=e.stepAttr.stateValues.value;return null===t?{setValue:{specifiedStep:NaN}}:{setValue:{specifiedStep:t}}}},specifiedExclude:{returnDependencies:()=>({excludeAttr:{dependencyType:"attributeComponent",attributeName:"exclude",variableNames:["values"]}}),defaultValue:[],hasEssential:!0,essentialVarName:"exclude",definition:function({dependencyValues:e}){return null===e.excludeAttr?{useEssentialOrDefaultValue:{specifiedExclude:!0}}:{setValue:{specifiedExclude:e.excludeAttr.stateValues.values}}}},lowercase:{returnDependencies:()=>({specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"}}),definition:function({dependencyValues:e}){let t=/^[A-Z]*$/,n=!0;return null!==e.specifiedFrom?t.test(e.specifiedFrom)&&(n=!1):null!==e.specifiedTo&&t.test(e.specifiedTo)&&(n=!1),{setValue:{lowercase:n}}}}};return e.validSequence={returnDependencies:()=>({specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition:function({dependencyValues:e}){let t=!0;if(null!==e.specifiedLength&&(!Number.isInteger(e.specifiedLength)||e.specifiedLength<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),t=!1),null!==e.specifiedStep&&"math"!==e.type){let n=findFiniteNumericalValue(e.specifiedStep);Number.isFinite(n)||(console.warn("Invalid step of sequence.  Must be a number for sequence of type "+e.type+"."),t=!1)}if(null!==e.specifiedFrom)if("number"===e.type){let n=findFiniteNumericalValue(e.specifiedFrom);Number.isFinite(n)||(console.warn("Invalid from of number sequence.  Must be a number"),t=!1)}else Number.isNaN(e.specifiedFrom)&&(console.warn("Invalid from of sequence"),t=!1);if(null!==e.specifiedTo)if("number"===e.type){let n=findFiniteNumericalValue(e.specifiedTo);Number.isFinite(n)||(console.warn("Invalid to of number sequence.  Must be a number"),t=!1)}else Number.isNaN(e.specifiedTo)&&(console.warn("Invalid to of sequence"),t=!1);return{setValue:{validSequence:t}}}},e.from={additionalStateVariablesDefined:["step","length","exclude"],returnDependencies:()=>({specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},type:{dependencyType:"stateVariable",variableName:"type"},specifiedExclude:{dependencyType:"stateVariable",variableName:"specifiedExclude"},validSequence:{dependencyType:"stateVariable",variableName:"validSequence"}}),definition:function({dependencyValues:e}){let t=e.specifiedFrom,n=e.specifiedTo,r=e.specifiedStep,a=e.specifiedLength,i=[...e.specifiedExclude],o=e.type;if("math"===e.type)null!==n&&(n instanceof me$3.class||(n=me$3.fromAst(n))),null!==t&&(t instanceof me$3.class||(t=me$3.fromAst(t))),null!==r&&(r instanceof me$3.class||(r=me$3.fromAst(r)));else if(null!==r&&r instanceof me$3.class&&(r=r.evaluate_to_constant()),"letters"===e.type)null!==t&&(t=lettersToNumber$1(t)),null!==n&&(n=lettersToNumber$1(n)),i=i.map(lettersToNumber$1);else if("number"===e.type){null!==n&&(n=n instanceof me$3.class?n.evaluate_to_constant():Number(n)),null!==t&&(t=t instanceof me$3.class?t.evaluate_to_constant():Number(t));for(let[e,t]of i.entries())t instanceof me$3.class?i[e]=t.evaluate_to_constant():i[e]=Number(t)}if(e.validSequence){let e=calculateSequenceParameters({from:t,to:n,step:r,length:a,type:o});return e.exclude=i,{setValue:e}}return(!Number.isInteger(a)||a<0)&&(a=0),{setValue:{from:t,step:r,length:a,exclude:i}}}},e}function calculateSequenceParameters({from:e,to:t,step:n,length:r,type:a}){if(null===e)null===t?(e="math"===a?me$3.fromAst(1):1,null===n?(n="math"===a?me$3.fromAst(1):1,null===r&&(r=10)):null===r&&(r=10)):(null===n&&(n="math"===a?me$3.fromAst(1):1),null===r&&(r="math"===a?Math.floor((t.subtract(1).divide(n).evaluate_to_constant()+1)*(1+1e-14)):Math.floor(((t-1)/n+1)*(1+1e-14))),"math"===a?e=t.subtract(n.multiply(r-1)).simplify():(e=t-n*(r-1),"letters"===a&&e<1&&(e=t-n*((r=Math.floor(((t-1)/n+1)*(1+1e-14)))-1))));else if(null===t)null===n&&(n="math"===a?me$3.fromAst(1):1),null===r&&(r=10);else if(null===n)null===r?"math"===a?(n=me$3.fromAst(1),r=Math.floor(t.subtract(e).add(1).evaluate_to_constant()*(1+1e-14))):(n=1,r=Math.floor((t-e+1)*(1+1e-14))):"math"===a?n=t.subtract(e).divide(r-1):(n=(t-e)/(r-1),"letters"===a&&(n=Math.floor(n)));else{if(null!==r)throw Error("Can't define from, to, step, and length for sequence");r="math"===a?Math.floor(t.subtract(e).divide(n).add(1).evaluate_to_constant()*(1+1e-14)):Math.floor(((t-e)/n+1)*(1+1e-14))}return(!Number.isInteger(r)||r<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),r=0),{from:e,step:n,length:r}}function returnSequenceValues({from:e,step:t,length:n,exclude:r,type:a,lowercase:i,maxNum:o},s=!1){let l=[],u=0;for(let c=0;c<n;c++){let n=e;if(c>0&&("math"===a?n=n.add(t.multiply(me$3.fromAst(c))).expand().simplify():n+=t*c),"math"===a){if(r.some((e=>e&&e.equals(n))))continue}else if("number"===a){if(r.some((e=>Math.abs(e-n)<=1e-14*Math.max(Math.abs(e),Math.abs(n)))))continue}else if(r.includes(n))continue;if("letters"===a&&(n=numberToLetters(n,i)),s?l.push({value:n,originalIndex:c}):l.push(n),u++,u===o)break}return l}function returnSequenceValueForIndex({index:e,from:t,step:n,length:r,exclude:a,type:i,lowercase:o}){if(!(e>=0&&(void 0===r||e<r)))return null;let s=t;if(e>0&&("math"===i?s=s.add(n.multiply(me$3.fromAst(e))).expand().simplify():s+=n*e),"math"===i){if(a.some((e=>e&&e.equals(s))))return null}else if("number"===i){if(a.some((e=>Math.abs(e-s)<=1e-14*Math.max(Math.abs(e),Math.abs(s)))))return null}else if(a.includes(s))return null;return"letters"===i&&(s=numberToLetters(s,o)),s}function lettersToNumber$1(e){try{e=e.toUpperCase()}catch(t){return void console.warn("Cannot convert "+e+" to a number")}let t=0,n=e.length,r=n;for(;(r-=1)>-1;){let a=e.charCodeAt(r)-64;if(a<1||a>26)return void console.warn("Cannot convert "+e+" to a number");t+=a*Math.pow(26,n-1-r)}return t}function numberToLetters(e,t){e--;let n=65;t&&(n=97);let r="";for(;;){let t=e%26;if(r=String.fromCharCode(n+t)+r,e<26)break;e=Math.floor(e/26)-1}return r}function returnDefaultFeedbackDefinitions(){return{numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."}}function returnFeedbackDefinitionStateVariables(){let e={setupChildren:{returnDependencies:()=>({setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}}),definition:({dependencyValues:e})=>({setValue:{setupChildren:e.setupChildren}})}};return e.feedbackDefinitions={stateVariablesDeterminingDependencies:["setupChildren"],returnDependencies({stateValues:e}){let t={ancestorWithFeedback:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},setupChildren:{dependencyType:"child",childGroups:["setups"],proceedIfAllChildrenNotMatched:!0}};for(let n of e.setupChildren)t[`feedbackDefinitionsOf${n.componentName}`]={dependencyType:"child",parentName:n.componentName,childGroups:["feedbackDefinitions"],variableNames:["value"]};return t},definition({dependencyValues:e}){let t,n={};e.ancestorWithFeedback&&(t=e.ancestorWithFeedback.stateValues.feedbackDefinitions),t||(t=returnDefaultFeedbackDefinitions()),Object.assign(n,t);let r=[];for(let t of e.setupChildren)r.push(...e[`feedbackDefinitionsOf${t.componentName}`]);for(let e of r)Object.assign(n,e.stateValues.value);return{setValue:{feedbackDefinitions:n}}}},e}class SectioningComponent extends BlockComponent{static componentType="_sectioningComponent";static renderChildren=!0;static createsVariants=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.aggregateScores={createComponentOfType:"boolean",createStateVariable:"aggregateScores",defaultValue:!1,public:!0},e.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},e.sectionWideCheckWork={createComponentOfType:"boolean",createStateVariable:"sectionWideCheckWork",defaultValue:!1,public:!0},e.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},e.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},e.boxed={createComponentOfType:"boolean",createStateVariable:"boxed",defaultValue:!1,public:!0,forRenderer:!0},e}static returnChildGroups(){return[{group:"variantControls",componentTypes:["variantControl"]},{group:"titles",componentTypes:["title"]},{group:"setups",componentTypes:["setup"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=this,t=super.returnStateVariableDefinitions(),n=returnStyleDefinitionStateVariables();Object.assign(t,n);let r=returnFeedbackDefinitionStateVariables();return Object.assign(t,r),t.enumeration={forRenderer:!0,returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["enumeration"]}}),definition({dependencyValues:e}){let t=[];return e.sectionAncestor&&t.push(...e.sectionAncestor.stateValues.enumeration),t.push(e.countAmongSiblings),{setValue:{enumeration:t}}}},t.sectionName={returnDependencies:()=>({}),definition:()=>({setValue:{sectionName:"Section"}})},t.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition({dependencyValues:e}){let t=null;return e.titleChild.length>0&&(t=e.titleChild[0].componentName),{setValue:{titleChildName:t}}}},t.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,shadowVariable:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]},sectionName:{dependencyType:"stateVariable",variableName:"sectionName"},enumeration:{dependencyType:"stateVariable",variableName:"enumeration"}}),definition({dependencyValues:t}){if(0===t.titleChild.length){let n=e.defaultTitle;return n||(n=t.sectionName+" "+t.enumeration.join(".")),{setValue:{title:n}}}return{setValue:{title:t.titleChild[0].stateValues.text}}}},t.containerTag={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{containerTag:"section"}})},t.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{level:1}})},t.viewedSolution={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"viewedSolution",value:e.viewedSolution}]})},t.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer","setup"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:e}){let t=[];for(let n of e.scoredDescendants)"setup"!==n.componentType&&(n.stateValues.aggregateScores||void 0===n.stateValues.scoredDescendants?t.push(n):t.push(...n.stateValues.scoredDescendants));return{setValue:{scoredDescendants:t}}}},t.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition:({dependencyValues:e})=>({setValue:{answerDescendants:e.answerDescendants}})},t.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition:({dependencyValues:e})=>({setValue:{justSubmitted:e.answerDescendants.every((e=>e.stateValues.justSubmitted))}})},t.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition:({dependencyValues:e})=>({setValue:{showCorrectness:!1!==e.showCorrectnessFlag}})},t.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({setValue:{displayDigitsForCreditAchieved:3}})},t.creditAchieved={public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},forRenderer:!0,defaultValue:0,hasEssential:!0,additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},defaultValue:0,hasEssential:!0}],stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:e}){let t={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(e.aggregateScores){t.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[n,r]of e.scoredDescendants.entries())t["creditAchieved"+n]={dependencyType:"stateVariable",componentName:r.componentName,variableName:"creditAchieved"}}return t},definition({dependencyValues:e}){if(!e.aggregateScores)return{setValue:{creditAchieved:0,percentCreditAchieved:0}};let t,n=0,r=0;for(let[t,a]of e.scoredDescendants.entries()){let i=a.stateValues.weight;n+=e["creditAchieved"+t]*i,r+=i}return t=r>0?n/r:1,{setValue:{creditAchieved:t,percentCreditAchieved:100*t}}}},t.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:e}){let t={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(e.aggregateScores){t.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[n,r]of e.scoredDescendants.entries())t["creditAchievedIfSubmit"+n]={dependencyType:"stateVariable",componentName:r.componentName,variableName:"creditAchievedIfSubmit"}}return t},definition({dependencyValues:e}){if(!e.aggregateScores)return{setValue:{creditAchievedIfSubmit:0}};let t=0,n=0;for(let[r,a]of e.scoredDescendants.entries()){let i=a.stateValues.weight;t+=e["creditAchievedIfSubmit"+r]*i,n+=i}return{setValue:{creditAchievedIfSubmit:t/n}}}},t.generatedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed},variantIndex:{dependencyType:"value",value:e.variantIndex},variantName:{dependencyType:"value",value:e.variantName},variantControlChild:{dependencyType:"child",childGroups:["variantControls"],variableNames:["selectedVariantIndex","selectedVariantName"]},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={};0===e.variantControlChild.length?n.seed=e.variantSeed:(n.index=e.variantControlChild[0].stateValues.selectedVariantIndex,n.name=e.variantControlChild[0].stateValues.selectedVariantName),n.meta={createdBy:t};let r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n,isVariantComponent:!0}}}},t.collapsible={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{collapsible:!1}})},t.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{open:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"open",value:e.open}]})},t.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"suppressAnswerSubmitButtons",forRenderer:!0}],returnDependencies:()=>({sectionWideCheckWork:{dependencyType:"stateVariable",variableName:"sectionWideCheckWork"},aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons"]},documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["suppressAnswerSubmitButtons"]}}),definition({dependencyValues:e,componentName:t}){let n=!1,r=!1;return e.documentAncestor.stateValues.suppressAnswerSubmitButtons||e.sectionAncestor&&e.sectionAncestor.stateValues.suppressAnswerSubmitButtons?r=!0:e.sectionWideCheckWork&&(e.aggregateScores?(n=!0,r=!0):console.warn(`Cannot create submit all button for ${t} because it doesn't aggegrate scores`)),{setValue:{createSubmitAllButton:n,suppressAnswerSubmitButtons:r}}}},t}actions={submitAllAnswers:this.submitAllAnswers.bind(this),revealSection:this.revealSection.bind(this),closeSection:this.closeSection.bind(this)};async submitAllAnswers({actionId:e}){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{creditAchieved:await this.stateValues.creditAchievedIfSubmit}});for(let e of await this.stateValues.answerDescendants)await e.stateValues.justSubmitted||await this.coreFunctions.performAction({componentName:e.componentName,actionName:"submitAnswer"});this.coreFunctions.resolveAction({actionId:e})}async revealSection({actionId:e}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],actionId:e,event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}async closeSection({actionId:e}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],actionId:e,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}static async setUpVariant({serializedComponent:e,sharedParameters:t,definingChildrenSoFar:n,descendantVariantComponents:r}){let a,i;for(let e of n)if(void 0!==e&&"variantControl"===e.componentType){a=e;break}if(void 0===a?setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:r}):(t.variantSeed=await a.state.selectedSeed.value,t.variantName=await a.state.selectedVariantName.value,t.variantIndex=await a.state.selectedVariantIndex.value,t.variantRng=await a.state.variantRng.value,t.allPossibleVariants=await a.state.variantNames.value,t.variantIndicesToIgnore=await a.state.variantIndicesToIgnore.value),e.variants&&(i=e.variants.desiredVariant),void 0===i&&(i={}),i.subvariants&&r)for(let e in i.subvariants){let t=i.subvariants[e],n=r[e];if(void 0===n)break;n.variants.desiredVariant=t}}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){let n;void 0===e.variants&&(e.variants={});for(let t of e.children)if("variantControl"===t.componentType){n=t;break}if(!n)return super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});let r=n.attributes.nVariants?.primitive;void 0===r&&(r=100);let a=r,i=[];if(n.attributes.variantIndicesToIgnore&&(i=n.attributes.variantIndicesToIgnore.component.children.map(Number).filter((e=>Number.isInteger(e)&&e>=1&&e<=r)).sort(((e,t)=>e-t))),!n.attributes.uniqueVariants?.primitive)return i.length>0&&(e.variants.indicesToIgnore=i,r-=i.length),e.variants.numberOfVariantsPreIgnore=a,e.variants.numberOfVariants=r,{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:a};let o=super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});return o.success?(r=Math.min(o.numberOfVariants,r),a=r,i.length>0&&(i=i.filter((e=>e<=r)),i.length>0&&(e.variants.indicesToIgnore=i,r-=i.length)),e.variants.numberOfVariantsPreIgnore=a,e.variants.numberOfVariants=r,e.variants.uniqueVariants=!0,{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:a}):(i.length>0&&(e.variants.indicesToIgnore=i,r-=i.length),e.variants.numberOfVariantsPreIgnore=a,e.variants.numberOfVariants=r,{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:a})}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r,a=e.variants?.numberOfVariants;if(void 0===a)return{success:!1};if(e.variants.desiredVariantFromDocument&&(a=e.variants.numberOfVariantsPreIgnore),!Number.isInteger(t)||t<1||t>a)return{success:!1};for(let t of e.children)if("variantControl"===t.componentType){r=t;break}if(!r)return super.getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n});if(!e.variants.desiredVariantFromDocument&&e.variants.indicesToIgnore)for(let n of e.variants.indicesToIgnore){if(!(t>=n))break;t++}if(!e.variants.uniqueVariants)return{success:!0,desiredVariant:{index:t}};let i=getVariantsForDescendantsForUniqueVariants({variantIndex:t,serializedComponent:e,componentInfoObjects:n});return i.success?(e.variants.selectedUniqueVariant=!0,{success:!0,desiredVariant:{index:t,subvariants:i.desiredVariants}}):(console.log("Failed to get unique variant for section."),{success:!1})}static includeBlankStringChildren=!0}class Section extends SectioningComponent{static componentType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.level.definition=()=>({setValue:{level:1}}),e}}class Subsection extends SectioningComponent{static componentType="subsection";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.level.definition=()=>({setValue:{level:2}}),e}}class Subsubsection extends SectioningComponent{static componentType="subsubsection";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.level.definition=()=>({setValue:{level:3}}),e}}class Paragraphs extends SectioningComponent{static componentType="paragraphs";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.level.definition=()=>({setValue:{level:4}}),e}}class Aside extends SectioningComponent{static componentType="aside";static rendererType="section";static createAttributesObject(){let e=super.createAttributesObject();return e.collapsible={createComponentOfType:"boolean",createStateVariable:"collapsible",defaultValue:!0,public:!0,forRenderer:!0},e.startOpen={createComponentOfType:"boolean",createStateVariable:"startOpen",defaultValue:!1},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.collapsible,e.open.returnDependencies=()=>({startOpen:{dependencyType:"stateVariable",variableName:"startOpen"}}),e.open.definition=({dependencyValues:e})=>({useEssentialOrDefaultValue:{open:{defaultValue:e.startOpen}}}),e.level.definition=()=>({setValue:{level:3}}),e.containerTag.definition=()=>({setValue:{containerTag:"aside"}}),e}}class Problem extends SectioningComponent{static componentType="problem";static rendererType="section";static createAttributesObject(){let e=super.createAttributesObject();return e.aggregateScores.defaultValue=!0,e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.sectionName.definition=()=>({setValue:{sectionName:"Problem"}}),e.level.definition=()=>({setValue:{level:3}}),e}}class Exercise extends Problem{static componentType="exercise";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.sectionName.definition=()=>({setValue:{sectionName:"Exercise"}}),e}}class Example extends SectioningComponent{static componentType="example";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.sectionName.definition=()=>({setValue:{sectionName:"Example"}}),e.level.definition=()=>({setValue:{level:3}}),e}}class StandinForFutureLayoutTag extends SectioningComponent{static componentType="standinForFutureLayoutTag";static rendererType="section";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.level.definition=()=>({setValue:{level:3}}),e.containerTag.definition=()=>({setValue:{containerTag:"aside"}}),e}}var Sectioning=Object.freeze({__proto__:null,Section:Section,Subsection:Subsection,Subsubsection:Subsubsection,Paragraphs:Paragraphs,Aside:Aside,Problem:Problem,Exercise:Exercise,Example:Example,StandinForFutureLayoutTag:StandinForFutureLayoutTag});class Ol extends BlockComponent{static componentType="ol";static rendererType="list";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:null,public:!0,forRenderer:!0},e}static returnChildGroups(){return[{group:"lis",componentTypes:["li"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!0}})},e}}class Ul extends Ol{static componentType="ul";static rendererType="list";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{numbered:!1}})},e}}class Li$1 extends BaseComponent{static componentType="li";static rendererType="list";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.item={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{item:!0}})},e}}var Lists=Object.freeze({__proto__:null,Ol:Ol,Ul:Ul,Li:Li$1});class ODESystem extends InlineComponent{static componentType="odesystem";static rendererType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.independentVariable={createComponentOfType:"variable",createStateVariable:"independentVariable",defaultValue:me$3.fromAst("t"),public:!0},e.initialIndependentVariableValue={createComponentOfType:"math",createStateVariable:"initialIndependentVariableValue",defaultValue:me$3.fromAst(0),public:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:14,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e.renderMode={createComponentOfType:"text",createStateVariable:"renderMode",defaultValue:"align",public:!0,forRenderer:!0},e.chunkSize={createComponentOfType:"number",createStateVariable:"chunkSize",defaultValue:10,public:!0},e.tolerance={createComponentOfType:"number",createStateVariable:"tolerance",defaultValue:1e-6,public:!0},e.maxIterations={createComponentOfType:"number",createStateVariable:"maxIterations",defaultValue:1e3,public:!0},e.hideInitialCondition={createComponentOfType:"boolean",createStateVariable:"hideInitialCondition",defaultValue:!1,public:!0},e.initialConditions={createComponentOfType:"mathList"},e.variables={createComponentOfType:"variables"},e.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!1,public:!0},e}static returnChildGroups(){return[{group:"rightHandSides",componentTypes:["rightHandSide"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.validIndependentVariable={returnDependencies:()=>({independentVarAttr:{dependencyType:"attributeComponent",attributeName:"independentVariable",variableNames:["validVariable"]}}),definition({dependencyValues:e}){let t=!0;return e.independentVarAttr&&(t=e.independentVarAttr.stateValues.validVariable),{setValue:{validIndependentVariable:t}}}},e.nDimensions={returnDependencies:()=>({rhsChildren:{dependencyType:"child",childGroups:["rightHandSides"],skipComponentNames:!0}}),definition:function({dependencyValues:e}){return{setValue:{nDimensions:e.rhsChildren.length},checkForActualChange:{nDimensions:!0}}}},e.variables={additionalStateVariablesDefined:[{variableName:"validVariables",isArray:!0,entryPrefixes:["validVar"]}],isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},variables:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables","validVariables"]},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=[],n=[],r=e.nDimensions;null!==e.variables&&(t=e.variables.stateValues.variables,n=[...e.variables.stateValues.validVariables].slice(0,r));let a=returnNVariables(r,t);return a.some((t=>t.equals(e.independentVariable)))&&console.warn("Variables of odesystem must be different than independent variable."),n.length<r&&n.push(...Array(r-n.length).fill(!0)),{setValue:{variables:a,validVariables:n}}}},e.rhss={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["rhs","righthandside"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={rhsChild:{dependencyType:"child",childGroups:["rightHandSides"],variableNames:["value"],childIndices:[n]}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].rhsChild[0].stateValues.value;return{setValue:{rhss:n}}}},e.rhs={isAlias:!0,targetVariableName:"rhs1"},e.righthandside={isAlias:!0,targetVariableName:"rhs1"},e.righthandsides={isAlias:!0,targetVariableName:"rhss"},e.initialConditions={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["initialCondition"],defaultValueByArrayKey:()=>me$3.fromAst(0),returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={initialConditionAttr:{dependencyType:"attributeComponent",attributeName:"initialConditions",variableNames:[`math${Number(n)+1}`]}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={},r={};for(let a of t){let t=!1;if(e[a].initialConditionAttr){let r=e[a].initialConditionAttr.stateValues[`math${Number(a)+1}`];void 0!==r&&(t=!0,n[a]=r)}t||(r[a]=!0)}let a={};return Object.keys(n).length>0&&(a.setValue={initialConditions:n}),Object.keys(r).length>0&&(a.useEssentialOrDefaultValue={initialConditions:r}),a}},e.initialCondition={isAlias:!0,targetVariableName:"initialCondition1"},e.equationTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],returnDependencies:({stateValues:e})=>e.number?{equationCounter:{dependencyType:"counter",counterName:"equation"}}:{},definition:({dependencyValues:e})=>void 0!==e.equationCounter?{setValue:{equationTag:String(e.equationCounter)}}:{setValue:{equationTag:null}}},e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},variables:{dependencyType:"stateVariable",variableName:"variables"},initialConditions:{dependencyType:"stateVariable",variableName:"initialConditions"},hideInitialCondition:{dependencyType:"stateVariable",variableName:"hideInitialCondition"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},initialIndependentVariableValue:{dependencyType:"stateVariable",variableName:"initialIndependentVariableValue"},rhss:{dependencyType:"stateVariable",variableName:"rhss"},number:{dependencyType:"stateVariable",variableName:"number"},equationTag:{dependencyType:"stateVariable",variableName:"equationTag"}}),definition({dependencyValues:e,usedDefault:t}){let n={};e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits));let r=[],a=e.independentVariable.toLatex();for(let i=0;i<e.nDimensions;i++){let o=`\\frac{d${e.variables[i].toLatex()}}{d${a}} &=  ${roundForDisplay({value:e.rhss[i],dependencyValues:e,usedDefault:t}).toLatex(n)}`;e.number&&0===i?o+=`\\tag{${e.equationTag}}`:o+="\\notag",r.push(o)}if(!e.hideInitialCondition){let a=e.initialIndependentVariableValue;for(let i=0;i<e.nDimensions;i++){let o=e.variables[i].toLatex(),s=roundForDisplay({value:e.initialConditions[i],dependencyValues:e,usedDefault:t});r.push(`${o}(${a}) &= ${s.toLatex(n)}\\notag`)}}return{setValue:{latex:r.join("\\\\")}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){return{setValue:{latexWithInputChildren:[e.latex]}}}},e.numericalRHSf={additionalStateVariablesDefined:["numericalRHSfDefinitions"],returnDependencies:()=>({validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},rhss:{dependencyType:"stateVariable",variableName:"rhss"}}),definition({dependencyValues:e}){let t=!0;e.validIndependentVariable||(console.warn("Can't define ODE RHS functions with invalid independent variable."),t=!1),e.validVariables.every((e=>e))||(console.warn("Can't define ODE RHS functions with an invalid variable."),t=!1);let n,r=e.independentVariable.subscripts_to_strings().tree,a=e.variables.map((e=>e.subscripts_to_strings().tree));a.includes(r)&&(console.warn("Can't define ODE RHS functions when independent variable is a dependent variable"),t=!1),[...new Set(a)].length!==a.length&&(console.warn("Can't define ODE RHS functions with duplicate dependent variable names"),t=!1);try{n=e.rhss.map((e=>e.subscripts_to_strings().f()))}catch(e){console.warn("Cannot define ODE RHS function.  Error creating mathjs function"),t=!1}if(!t){let t=e.rhss.length;return{setValue:{numericalRHSf:()=>NaN,numericalRHSfDefinitions:Array(t).fill({})}}}return{setValue:{numericalRHSf:function(e,t){let i={[r]:e};Array.isArray(t)?t.forEach(((e,t)=>i[a[t]]=e)):i[a[0]]=t;try{return n.map((e=>e(i)))}catch(e){return NaN}},numericalRHSfDefinitions:e.rhss.map((e=>({functionType:"formula",formula:e,nInputs:a.length+1,variables:[r,...a]})))}}}},e.haveNumericalInitialConditions={additionalStateVariablesDefined:["t0","x0s"],returnDependencies:()=>({initialIndependentVariableValue:{dependencyType:"stateVariable",variableName:"initialIndependentVariableValue"},initialConditions:{dependencyType:"stateVariable",variableName:"initialConditions"}}),definition({dependencyValues:e}){let t=e.initialIndependentVariableValue.evaluate_to_constant(),n=e.initialConditions.map((e=>e.evaluate_to_constant())),r=Number.isFinite(t)&&n.every((e=>Number.isFinite(e)));return{setValue:{t0:t,x0s:n,haveNumericalInitialConditions:r}}}},e.numericalSolutions={isArray:!0,entryPrefixes:["numericalSolution"],public:!0,shadowingInstructions:{createComponentOfType:"function",addStateVariablesShadowingStateVariables:{fDefinition:{stateVariableToShadow:"numericalSolutionFDefinitions"}}},createWorkspace:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},chunkSize:{dependencyType:"stateVariable",variableName:"chunkSize"},tolerance:{dependencyType:"stateVariable",variableName:"tolerance"},maxIterations:{dependencyType:"stateVariable",variableName:"maxIterations"},haveNumericalInitialConditions:{dependencyType:"stateVariable",variableName:"haveNumericalInitialConditions"},t0:{dependencyType:"stateVariable",variableName:"t0"},x0s:{dependencyType:"stateVariable",variableName:"x0s"},numericalRHSf:{dependencyType:"stateVariable",variableName:"numericalRHSf"}}}),arrayDefinitionByKey({globalDependencyValues:e,workspace:t,componentName:n}){let r={};if(t.calculatedNumericSolutions=[],t.endingNumericalValues=[],t.maxPossibleTime=void 0,!e.haveNumericalInitialConditions){for(let t=0;t<e.nDimensions;t++)r[t]=e=>NaN;return{setValue:{numericalSolutions:r}}}let a=e.t0,i=e.x0s,o=e.chunkSize,s=e.tolerance,l=e.numericalRHSf,u=e.maxIterations;for(let c=0;c<e.nDimensions;c++)r[c]=function(e){if(!Number.isFinite(e))return NaN;if(e===a)return i[c];let r=t.calculatedNumericSolutions.length,p=Math.ceil((e-a)/o)-1;if(p<0)return NaN;if(void 0===t.maxPossibleTime&&p>=r)for(let e=r;e<=p;e++){let r=t.endingNumericalValues[e-1];void 0===r&&(r=i);let c=a+e*o,p=me$3.math.dopri(c,c+o,r,l,s,u);t.endingNumericalValues.push(p.y[p.y.length-1]),t.calculatedNumericSolutions.push(p.at.bind(p));let d=p.x[p.x.length-1];if(d<.999999*(c+o)){t.maxPossibleTime=d;let e="For chunksize "+o+" and tolerance "+s+", odesystem";void 0!==n&&(e+=" ("+n+")"),e+=" hit maxiterations ("+u+") at t = "+t.maxPossibleTime+". Will not calculate solution beyond that time. Decrease chunksize, increase maxiterations, or increase tolerance to calculate further.";break}}return e>t.maxPossibleTime?NaN:t.calculatedNumericSolutions[p](e)[c]};return{setValue:{numericalSolutions:r}}}},e.numericalSolution={isAlias:!0,targetVariableName:"numericalSolution1"},e.numericalSolutionFDefinitions={forRenderer:!0,isArray:!0,entryPrefixes:["numericalSolutionFDefinition"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},validIndependentVariable:{dependencyType:"stateVariable",variableName:"validIndependentVariable"},independentVariable:{dependencyType:"stateVariable",variableName:"independentVariable"},validVariables:{dependencyType:"stateVariable",variableName:"validVariables"},variables:{dependencyType:"stateVariable",variableName:"variables"},chunkSize:{dependencyType:"stateVariable",variableName:"chunkSize"},tolerance:{dependencyType:"stateVariable",variableName:"tolerance"},maxIterations:{dependencyType:"stateVariable",variableName:"maxIterations"},haveNumericalInitialConditions:{dependencyType:"stateVariable",variableName:"haveNumericalInitialConditions"},t0:{dependencyType:"stateVariable",variableName:"t0"},x0s:{dependencyType:"stateVariable",variableName:"x0s"},numericalRHSfDefinitions:{dependencyType:"stateVariable",variableName:"numericalRHSfDefinitions"}}}),arrayDefinitionByKey:({globalDependencyValues:e})=>e.haveNumericalInitialConditions?{setValue:{numericalSolutionFDefinitions:[...Array(e.nDimensions).keys()].map((t=>({functionType:"ODESolution",nDimensions:e.nDimensions,t0:e.t0,x0s:e.x0s,chunkSize:e.chunkSize,tolerance:e.tolerance,numericalRHSfDefinitions:e.numericalRHSfDefinitions,maxIterations:e.maxIterations,component:t})))}}:{setValue:{numericalSolutionFDefinitions:Array(e.nDimensions).fill({})}}},e}}class GraphicalComponent extends BaseComponent{static componentType="_graphical";static createAttributesObject(){let e=super.createAttributesObject();return e.label={createComponentOfType:"_textOrLatexFromInline",createStateVariable:"label",defaultValue:"",public:!0,forRenderer:!0},e.showLabel={createComponentOfType:"boolean",createStateVariable:"showLabel",defaultValue:!0,public:!0,forRenderer:!0},e.applyStyleToLabel={createComponentOfType:"boolean",createStateVariable:"applyStyleToLabel",defaultValue:!1,public:!0,forRenderer:!0},e.layer={createComponentOfType:"integer",createStateVariable:"layer",defaultValue:0,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=returnSelectedStyleStateVariableDefinition();return Object.assign(e,t),e.labelIsLatex={forRenderer:!0,returnDependencies:()=>({labelAttr:{dependencyType:"attributeComponent",attributeName:"label",variableNames:["isLatex"]}}),definition:({dependencyValues:e})=>({setValue:{labelIsLatex:!0===e.labelAttr?.stateValues.isLatex}})},e}}class Polyline extends GraphicalComponent{static componentType="polyline";actions={movePolyline:this.movePolyline.bind(this),finalizePolylinePosition:this.finalizePolylinePosition.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.vertices={createComponentOfType:"_pointListComponent"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" polyline"}}}},e.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return null!==e.vertices?{setValue:{nVertices:e.vertices.stateValues.nPoints}}:{setValue:{nVertices:0}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){if(null!==e.vertices){return{setValue:{nDimensions:e.vertices.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}}return{setValue:{nDimensions:2}}}},e.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"vertexX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("vertexX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},getAllArrayKeys(e,t=!0,n){function r(e){if(1===e.length)return Array.from(Array(e[0]),((e,t)=>String(t)));{let n=e[0],a=r(e.slice(1)),i=[];for(let e=0;e<n;e++)t?i.push(...a.map((t=>e+","+t))):i.push(a.map((t=>e+","+t)));return i}}if(n){if(0!==n.length&&e){let t=[...e];return t[0]=n[0],r(t)}return[]}return e&&0!==e.length?r(e):[]},arrayVarNameFromPropIndex(e,t){if("vertices"===t)return"vertex"+e;if("vertex"===t.slice(0,6)){let n=Number(t.slice(6));if(Number.isInteger(n)&&n>0)return`vertexX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nVertices,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={vertices:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+a]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let[t,a]=r.split(","),i=Number(t)+1+"_"+(Number(a)+1),o=e[r].vertices;null!==o&&o.stateValues["pointX"+i]?n[r]=o.stateValues["pointX"+i]:n[r]=me$3.fromAst("")}return{setValue:{vertices:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.vertices){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);if(null===t[r].vertices||!t[r].vertices.stateValues["pointX"+s])return{success:!1};i.push({setDependency:n[r].vertices,desiredValue:e.vertices[r],variableIndex:0})}return{success:!0,instructions:i}}},e.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize:({dependencyValues:e})=>[e.nVertices],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].vertex.map((e=>e.evaluate_to_constant()));t.every((e=>Number.isFinite(e)))||(t=Array(t.length).fill(NaN)),n[r]=t}return{setValue:{numericalVertices:n}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e}){let t,n,r=e.nDimensions,a=e.nVertices,i=e.numericalVertices,o=[],s=i[0]?.[0],l=i[0]?.[1];for(let e=1;e<a;e++)if(t=s,n=l,s=i[e]?.[0],l=i[e]?.[1],Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(l)){let e=s-t,r=l-n;0===e&&0===r?o.push(null):o.push([e,r])}else o.push(null);return{setValue:{nearestPoint:function({variables:e,scales:t}){let n=t[0],s=t[1];if(2!==r||0===a)return{};let l,u,c=1/0,p={},d=e.x1?.evaluate_to_constant(),m=e.x2?.evaluate_to_constant(),f=i[0][0],h=i[0][1];for(let e=1;e<a;e++){l=f,u=h,f=i[e][0],h=i[e][1];let t=o[e-1];if(null===t)continue;let r,a=t[0]/n,y=t[1]/s,b=((d-l)/n*a+(m-u)/s*y)/(a*a+y*y);r=b<=0?{x1:l,x2:u}:b>=1?{x1:f,x2:h}:{x1:l+b*a*n,x2:u+b*y*s};let g=Math.pow((d-r.x1)/n,2)+Math.pow((m-r.x2)/s,2);g<c&&(c=g,p=r)}return void 0!==e.x3&&Object.keys(p).length>0&&(p.x3=0),p}}}}},e}async movePolyline({pointCoords:e,transient:t,sourceInformation:n,actionId:r}){let a={};for(let t in e)a[t+",0"]=me$3.fromAst(e[t][0]),a[t+",1"]=me$3.fromAst(e[t][1]);return t?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:a,sourceInformation:n}],transient:t,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:a,sourceInformation:n}],actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:e}}})}async finalizePolylinePosition(){return await this.actions.movePolyline({pointCoords:await this.stateValues.numericalVertices,transient:!1})}}class CobwebPolyline extends Polyline{static componentType="cobwebPolyline";static rendererType="cobwebPolyline";static createAttributesObject(){let e=super.createAttributesObject();return e.attractThreshold={createComponentOfType:"number",createStateVariable:"attractThreshold",defaultValue:.5,public:!0},e.nPoints={createComponentOfType:"number",createStateVariable:"nPoints",defaultValue:1,public:!0,clamp:[0,1/0],forRenderer:!0},e.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:me$3.fromAst("x"),public:!0,forRenderer:!0},e.nIterationsRequired={createComponentOfType:"number",createStateVariable:"nIterationsRequired",defaultValue:0,public:!0},e.initialPoint={createComponentOfType:"point"},e.function={createComponentOfType:"function"},e.lockToSolution={createComponentOfType:"boolean",createStateVariable:"lockToSolution",defaultValue:!1},e.defaultPoint={createComponentOfType:"point"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nDimensions.returnDependencies=()=>({}),e.nDimensions.definition=()=>({setValue:{nDimensions:2}}),e.initialPoint={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"initialPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},entryPrefixes:["initialPointX"],defaultValueByArrayKey:()=>me$3.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={initialPointAttr:{dependencyType:"attributeComponent",attributeName:"initialPoint",variableNames:["x"+e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={},r={};for(let a of t){let t=Number(a)+1;e[a].initialPointAttr?n[a]=e[a].initialPointAttr.stateValues["x"+t]:r[a]=!0}let a={};return Object.keys(n).length>0&&(a.setValue={initialPoint:n}),Object.keys(r).length>0&&(a.useEssentialOrDefaultValue={initialPoint:r}),a},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n}){let r=[];for(let a in e.initialPoint)t[a].initialPointAttr&&t[a].initialPointAttr.stateValues["x"+(Number(a)+1)]?r.push({setDependency:n[a].initialPointAttr,desiredValue:e.initialPoint[a],variableIndex:0}):r.push({setEssentialValue:"initialPoint",value:{[a]:e.initialPoint[a]}});return{success:!0,instructions:r}}},e.f={additionalStateVariablesDefined:[{variableName:"fDefinition",forRenderer:!0}],returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["numericalf","fDefinition"]}}),definition:({dependencyValues:e})=>e.functionAttr?{setValue:{f:e.functionAttr.stateValues.numericalf,fDefinition:e.functionAttr.stateValues.fDefinition}}:{setValue:{f:null,fDefinition:null}}},e.nVertices={isAlias:!0,targetVariableName:"nPoints"},e.nOriginalVertices={providePreviousValuesInDefinition:!0,returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e,previousValues:t}){let n=e.nVertices;return t.nOriginalVertices>n&&(n=t.nOriginalVertices),{setValue:{nOriginalVertices:n}}}},e.originalVertices={isArray:!0,nDimensions:2,hasEssential:!0,entryPrefixes:["originalVertexX","originalVertex"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("originalVertexX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("originalVertices"===t)return"originalVertex"+e;if("originalVertex"===t.slice(0,14)){let n=Number(t.slice(14));if(Number.isInteger(n)&&n>0)return`originalVertexX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nOriginalVertices:{dependencyType:"stateVariable",variableName:"nOriginalVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nOriginalVertices-1,e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]},defaultPoint:{dependencyType:"attributeComponent",attributeName:"defaultPoint",variableNames:["xs"]}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t){let t=r.split(",").map(Number);n[r]={get defaultValue(){if(e.defaultPoint){let n=e.defaultPoint.stateValues.xs;if(2===n.length&&t[1]<2)return n[t[1]]}if(e.graphAncestor){if(0===t[1]){let t=e.graphAncestor.stateValues.xmin,n=e.graphAncestor.stateValues.xmax;return me$3.fromAst((t+n)/2)}if(1===t[1]){let t=e.graphAncestor.stateValues.ymin,n=e.graphAncestor.stateValues.ymax;return me$3.fromAst((t+n)/2)}}return me$3.fromAst(0)}}}return{useEssentialOrDefaultValue:{originalVertices:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t=[];for(let n in e.originalVertices)t.push({setEssentialValue:"originalVertices",value:{[n]:e.originalVertices[n]}});return{success:!0,instructions:t}}},e.vertices.additionalStateVariablesDefined=[{variableName:"prelimCorrectVertices",entryPrefixes:["prelimCorrectVertexX","prelimCorrectVertex"],getArrayKeysFromVarName:function({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("prelimCorrectVertexX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}}}],e.vertices.basedOnArrayKeyStateVariables=!0,e.vertices.returnArrayDependenciesByKey=function({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(",");t[n]="0"===e?{initialPoint:{dependencyType:"stateVariable",variableName:"initialPointX"+(Number(r)+1)}}:{originalVertexX1:{dependencyType:"stateVariable",variableName:"originalVertexX"+e+"_1"},originalVertexX2:{dependencyType:"stateVariable",variableName:"originalVertexX"+e+"_2"},previousVertexX1:{dependencyType:"stateVariable",variableName:"vertexX"+e+"_1"},previousVertexX2:{dependencyType:"stateVariable",variableName:"vertexX"+e+"_2"}}}return{globalDependencies:{f:{dependencyType:"stateVariable",variableName:"f"},attractThreshold:{dependencyType:"stateVariable",variableName:"attractThreshold"},lockToSolution:{dependencyType:"stateVariable",variableName:"lockToSolution"}},dependenciesByKey:t}},e.vertices.arrayDefinitionByKey=function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={},a={};for(let i of n){let[n,o]=i.split(",");if("0"===n)r[i]=t[i].initialPoint,a[i]=null;else{let o,s,l;try{o=[t[i].originalVertexX1.evaluate_to_constant(),t[i].originalVertexX2.evaluate_to_constant()],s=[t[i].previousVertexX1.evaluate_to_constant(),t[i].previousVertexX2.evaluate_to_constant()]}catch(e){r[n+",0"]=me$3.fromAst(0),r[n+",1"]=me$3.fromAst(0),a[n+",0"]=!1;continue}if(Number(n)%2==1){let t=e.f(s[0]);l=[s[0],t]}else l=[s[1],s[1]];Math.pow(o[0]-l[0],2)+Math.pow(o[1]-l[1],2)<e.attractThreshold*e.attractThreshold||e.lockToSolution?(r[n+",0"]=me$3.fromAst(l[0]),r[n+",1"]=me$3.fromAst(l[1]),a[n+",0"]=!0):(r[n+",0"]=t[i].originalVertexX1,r[n+",1"]=t[i].originalVertexX2,a[n+",0"]=!1),a[n+",1"]=null}}return{setValue:{vertices:r,prelimCorrectVertices:a}}},e.vertices.inverseArrayDefinitionByKey=async function({desiredStateVariableValues:e,dependencyNamesByKey:t,initialChange:n,stateValues:r}){if(n&&!await r.draggable)return{success:!1};let a=[];for(let n in e.vertices){let[r,i]=n.split(",");"0"===r?a.push({setDependency:t[n].initialPoint,desiredValue:e.vertices[n]}):a.push({setDependency:t[n]["originalVertexX"+(Number(i)+1)],desiredValue:e.vertices[n]})}return{success:!0,instructions:a}},e.correctVertices={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},entryPrefixes:["correctVertex"],returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize:({dependencyValues:e})=>[e.nVertices-1],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={prelimCorrectVertex:{dependencyType:"stateVariable",variableName:"prelimCorrectVertexX"+(Number(n)+2)+"_1"}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].prelimCorrectVertex;return{setValue:{correctVertices:n}}}},e.fractionCorrectVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"nGradedVertices",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"nCorrectVertices",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({correctVertices:{dependencyType:"stateVariable",variableName:"correctVertices"}}),definition({dependencyValues:e}){let t,n,r=e.correctVertices.length;return 0===r?(t=0,n=0):(n=e.correctVertices.reduce(((e,t)=>e+t),0),t=n/r),{setValue:{fractionCorrectVertices:t,nGradedVertices:r,nCorrectVertices:n}}}},e.fractionCorrectVerticesAdjusted={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"nGradedVerticesAdjusted",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({nCorrectVertices:{dependencyType:"stateVariable",variableName:"nCorrectVertices"},nGradedVertices:{dependencyType:"stateVariable",variableName:"nGradedVertices"},nIterationsRequired:{dependencyType:"stateVariable",variableName:"nIterationsRequired"}}),definition({dependencyValues:e}){let t=0;e.nIterationsRequired>0&&(t=2*e.nIterationsRequired-1);let n,r=Math.max(e.nGradedVertices,t);return n=0===r?0:e.nCorrectVertices/r,{setValue:{fractionCorrectVerticesAdjusted:n,nGradedVerticesAdjusted:r}}}},e.nIterateValues={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({setValue:{nIterateValues:Math.ceil((e.nVertices+1)/2)}})},e.iterateValues={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["iterateValue"],returnArraySizeDependencies:()=>({nIterateValues:{dependencyType:"stateVariable",variableName:"nIterateValues"}}),returnArraySize:({dependencyValues:e})=>[e.nIterateValues],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]="0"===n?{iterateValue:{dependencyType:"stateVariable",variableName:"vertexX1_1"}}:{iterateValue:{dependencyType:"stateVariable",variableName:"vertexX"+2*Number(n)+"_2"}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].iterateValue;return{setValue:{iterateValues:n}}}},e}}class Point extends GraphicalComponent{static componentType="point";static primaryStateVariableForDefinition="coordsShadow";static stateVariableForAttributeValue="coords";static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.x={createComponentOfType:"math"},e.y={createComponentOfType:"math"},e.z={createComponentOfType:"math"},e.xs={createComponentOfType:"mathList"},e.coords={createComponentOfType:"coords"},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},e.showCoordsWhenDragging={createComponentOfType:"boolean",createStateVariable:"showCoordsWhenDragging",defaultValue:!0,public:!0,forRenderer:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=returnBreakStringsSugarFunction({childrenToComponentFunction:e=>({componentType:"math",children:e}),mustStripOffOuterParentheses:!0}),n=e.map((e=>typeof e)),r=n.indexOf("string"),a=n.lastIndexOf("string");if(-1===r){let t=e.filter((e=>e.doenetAttributes&&e.doenetAttributes.createdFromMacro));if(1===t.length){let n=t[0],r=e.indexOf(n);return{success:!0,newAttributes:{coords:{component:{componentType:"math",children:t}}},newChildren:[...e.slice(0,r),...e.slice(r+1)]}}return{success:!1}}let i=[...e.slice(0,r),...e.slice(a+1)],o=t({matchedChildren:e=e.slice(r,a+1)});return o.success||1!==e.length?o.success?{success:!0,newAttributes:{xs:{component:{componentType:"mathList",children:o.newChildren,skipSugar:!0}}},newChildren:i}:{success:!1}:{success:!0,newAttributes:{x:{component:{componentType:"math",children:e}}},newChildren:i}}}),e}static returnChildGroups(){return[{group:"points",componentTypes:["point"]},{group:"constraints",componentTypes:["constraints"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescription:e.selectedStyle.markerColorWord}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.selectedStyle.markerColorWord+" "+e.selectedStyle.markerStyleWord}}}},e.coordsShadow={defaultValue:null,hasEssential:!0,essentialVarName:"coords",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{coordsShadow:!0}}),inverseDefinition:async function({desiredStateVariableValues:e,stateValues:t,workspace:n}){return{success:!0,instructions:[{setEssentialValue:"coordsShadow",value:e.coordsShadow}]}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]},x:{dependencyType:"attributeComponent",attributeName:"x"},y:{dependencyType:"attributeComponent",attributeName:"y"},z:{dependencyType:"attributeComponent",attributeName:"z"},xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){let t,n,r=!1;if(n=null!==e.z?3:null!==e.y?2:null!==e.x?1:0,null!==e.coords?(r=!0,t=e.coords.stateValues.value):e.coordsShadow&&(r=!0,t=e.coordsShadow),r){let e=t.tree;return n=Array.isArray(e)&&["tuple","vector"].includes(e[0])?Math.max(e.length-1,n):Math.max(1,n),{setValue:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}return null!==e.xs?{setValue:{nDimensions:Math.max(e.xs.stateValues.nComponents,n)}}:e.pointChild.length>0?{setValue:{nDimensions:Math.max(e.pointChild[0].stateValues.nDimensions,n)}}:(0===n&&(n=2),{setValue:{nDimensions:n},checkForActualChange:{nDimensions:!0}})}},e.arrayVariableForConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{arrayVariableForConstraints:"unconstrainedXs"}})},e.arrayEntryPrefixForConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{arrayEntryPrefixForConstraints:"unconstrainedX"}})},e.nDimensionsForConstraints={isAlias:!0,targetVariableName:"nDimensions"},e.unconstrainedXs={isArray:!0,entryPrefixes:["unconstrainedX"],defaultValueByArrayKey:()=>me$3.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={xs:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+e]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+e]}},"0"===n?t[n].component={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:"1"===n?t[n].component={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:"2"===n&&(t[n].component={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]})}return{globalDependencies:{coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coords:{dependencyType:"attributeComponent",attributeName:"coords",variableNames:["value"]}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r,a={},i={},o=!1;if(null!==e.coords?(o=!0,r=e.coords.stateValues.value):e.coordsShadow&&(o=!0,r=e.coordsShadow),o){let e=r.tree;if(Array.isArray(e)&&["tuple","vector"].includes(e[0]))for(let t of n){let n=Number(t);(n>=0||n<e.length-1)&&(void 0===r.tree[n+1]?a[t]=me$3.fromAst(""):a[t]=r.get_component(n).simplify())}else n.includes("0")&&(a[0]=r.simplify())}else for(let e of n){let n=Number(e)+1,r=t[e].xs;if(null!==r){let t=r.stateValues["math"+n];void 0!==t&&(a[e]=t.simplify())}else{let r=t[e].pointChild;r.length>0&&(a[e]=r[0].stateValues["x"+n])}}for(let e of n){let n=t[e].component;n?a[e]=n.stateValues.value.simplify():void 0===a[e]&&(i[e]=!0)}let s={};return Object.keys(a).length>0&&(s.setValue={unconstrainedXs:a}),Object.keys(i).length>0&&(s.useEssentialOrDefaultValue={unconstrainedXs:i}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i,o,s=[],l=!1,u=!1;null!==t.coords?(l=!0,i="coords",o=Array(a[0]+1)):null!==t.coordsShadow&&(l=!0,i="coordsShadow",o=Array(a[0]+1));for(let t of Object.keys(e.unconstrainedXs).reverse()){let a=convertValueToMathExpression(e.unconstrainedXs[t]);if(null!==n[t].component)s.push({setDependency:r[t].component,desiredValue:a,childIndex:0,variableIndex:0});else if(l)o[Number(t)+1]=a.tree,u=!0;else{if(null!==n[t].xs)s.push({setDependency:r[t].xs,desiredValue:a,childIndex:0,variableIndex:0});else{n[t].pointChild.length>0?s.push({setDependency:r[t].pointChild,desiredValue:a,childIndex:0,variableIndex:0}):s.push({setEssentialValue:"unconstrainedXs",value:{[t]:a}})}}}if(u){let e;1===a[0]?e=me$3.fromAst(o[1]):(o[0]="vector",e=me$3.fromAst(o));let t={setDependency:i,desiredValue:e};"coords"===i&&(t.childIndex=0,t.variableIndex=0),s.push(t)}return{success:!0,instructions:s}}},e.xs={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1,r={};r.unconstrainedX={dependencyType:"stateVariable",variableName:`unconstrainedX${e}`},r.constraintsChild={dependencyType:"child",childGroups:["constraints"],variableNames:[`constraintResult${e}`]},t[n]=r}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)if(e[r].constraintsChild.length>0){let t=Number(r)+1;n[r]=convertValueToMathExpression(e[r].constraintsChild[0].stateValues["constraintResult"+t])}else n[r]=convertValueToMathExpression(e[r].unconstrainedX);return t.length>0?{setValue:{xs:n}}:{}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r of Object.keys(e.xs).reverse())t[r]&&(t[r].constraintsChild.length>0?i.push({setDependency:n[r].constraintsChild,desiredValue:e.xs[r],childIndex:0,variableIndex:0}):i.push({setDependency:n[r].unconstrainedX,desiredValue:e.xs[r]}));return{success:!0,instructions:i}}},e.x={isAlias:!0,targetVariableName:"x1"},e.y={isAlias:!0,targetVariableName:"x2"},e.z={isAlias:!0,targetVariableName:"x3"},e.coords={public:!0,shadowingInstructions:{createComponentOfType:"coords",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({xs:{dependencyType:"stateVariable",variableName:"xs"}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.xs)n?t.push(n.tree):t.push("");return t=t.length>1?["vector",...t]:1===t.length?t[0]:"",{setValue:{coords:me$3.fromAst(t)}}},inverseDefinition:async function({desiredStateVariableValues:e,stateValues:t,initialChange:n}){if(n&&!await t.draggable)return{success:!1};let r=[],a={},i=e.coords.tree;if(Array.isArray(i)&&["tuple","vector"].includes(i[0]))for(let t=0;t<i.length-1;t++){let n=e.coords.get_component(t);void 0!==n.tree&&(a[t]=n)}else a[0]=e.coords;return r.push({setDependency:"xs",desiredValue:a}),{success:!0,instructions:r}}},e.coordsLatex={forRenderer:!0,returnDependencies:()=>({coords:{dependencyType:"stateVariable",variableName:"coords"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n={};return e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits)),{setValue:{coordsLatex:roundForDisplay({value:e.coords,dependencyValues:e,usedDefault:t}).toLatex(n)}}}},e.value={isAlias:!0,targetVariableName:"coords"},e.constraintUsed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({constraintsChild:{dependencyType:"child",childGroups:["constraints"],variableNames:["constraintUsed"]}}),definition:function({dependencyValues:e}){return 0===e.constraintsChild.length?{setValue:{constraintUsed:!1}}:{setValue:{constraintUsed:e.constraintsChild[0].stateValues.constraintUsed}}}},e.numericalXs={isArray:!0,entryPrefixes:["numericalX"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={x:{dependencyType:"stateVariable",variableName:`x${e}`}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].x;t?(t=e[r].x.evaluate_to_constant(),Number.isFinite(t)?n[r]=t:n[r]=NaN):n[r]=NaN}return{setValue:{numericalXs:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,initialChange:n,stateValues:r}){if(n&&!await r.draggable)return{success:!1};let a=[];for(let n in e.numericalXs)dependencyValuesByKey[n]&&a.push({setDependency:t[n].xs,desiredValue:e.numericalXs[n]});return{success:!0,instructions:a}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalXs:{dependencyType:"stateVariable",variableName:"numericalXs"}}),definition:({dependencyValues:e})=>({setValue:{nearestPoint:function(){let t={};for(let n=1;n<=e.nDimensions;n++){let r=e.numericalXs[n-1];if(!Number.isFinite(r))return{};t["x"+n]=r}return t}}})},e}static adapters=[{stateVariable:"coords",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}];async movePoint({x:e,y:t,z:n,transient:r,actionId:a}){let i={};return void 0!==e&&(i[0]=me$3.fromAst(e)),void 0!==t&&(i[1]=me$3.fromAst(t)),void 0!==n&&(i[2]=me$3.fromAst(n)),r?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:i}],transient:r,actionId:a}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:i}],actionId:a,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:e,y:t,z:n}}})}switchPoint(){}actions={movePoint:this.movePoint.bind(this),switchPoint:this.switchPoint.bind(this)}}class EquilibriumPoint extends Point{static componentType="equilibriumPoint";static rendererType="point";static createAttributesObject(){let e=super.createAttributesObject();return e.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},e.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.open={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition:({dependencyValues:e})=>({setValue:{open:!e.stable}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"stable",desiredValue:!e.open}]})},e}async switchPoint({actionId:e}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:e})}}class Line extends GraphicalComponent{static componentType="line";actions={moveLine:this.moveLine.bind(this),switchLine:this.switchLine.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.equation={createComponentOfType:"math"},e.through={createComponentOfType:"_pointListComponent"},e.slope={createComponentOfType:"number"},e.variables={createComponentOfType:"variables"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){return 0===e.length?{success:!1}:e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro))?{success:!0,newAttributes:{equation:{component:{componentType:"math",children:e}}}}:{success:!1}}}),e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" line"}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["equationIdentity"],returnDependencies:function({stateValues:e}){return null===e.equationIdentity?{through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}:{equation:{dependencyType:"attributeComponent",attributeName:"equation"}}},definition:function({dependencyValues:e,changes:t}){if(e.equation)return t.equation&&t.equation.componentIdentitiesChanged?{setValue:{nDimensions:2},checkForActualChange:{nDimensions:!0}}:{noChanges:["nDimensions"]};if(e.through){return{setValue:{nDimensions:e.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}}return{setValue:{nDimensions:2}}}},e.nPointsPrescribed={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return null===e.throughAttr?{setValue:{nPointsPrescribed:0}}:{setValue:{nPointsPrescribed:e.throughAttr.stateValues.nPoints}}}},e.basedOnSlope={returnDependencies:()=>({slopeAttr:{dependencyType:"attributeComponent",attributeName:"slope"},nPointsPrescribed:{dependencyType:"stateVariable",variableName:"nPointsPrescribed"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition:({dependencyValues:e})=>({setValue:{basedOnSlope:e.nPointsPrescribed<2&&null!==e.slopeAttr&&2===e.nDimensions}})},e.dForSlope={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{dForSlope:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"dForSlope",value:e.dForSlope}]})},e.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey:()=>({globalDependencies:{variables:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]}}}),arrayDefinitionByKey({globalDependencyValues:e,arraySize:t}){let n=[];return null!==e.variables&&(n=e.variables.stateValues.variables),{setValue:{variables:returnNVariables(t[0],n)}}}},e.equationIdentity={returnDependencies:()=>({equation:{dependencyType:"attributeComponent",attributeName:"equation"}}),definition:function({dependencyValues:e}){return null!==e.equation?{setValue:{equationIdentity:e.equation}}:{setValue:{equationIdentity:null}}}},e.essentialPoints={isArray:!0,nDimensions:"2",hasEssential:!0,entryPrefixes:["essentialPointX","essentialPoint"],set:convertValueToMathExpression,defaultValueByArrayKey:e=>me$3.fromAst("0,0"===e?1:0),getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("essentialPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[2,e.nDimensions],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialPoints:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t=[];for(let n in e.essentialPoints)t.push({setEssentialValue:"essentialPoints",value:{[n]:convertValueToMathExpression(e.essentialPoints[n])}});return{success:!0,instructions:t}}},e.points={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"pointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("pointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("points"===t)return"point"+e;if("point"===t.slice(0,5)){let n=Number(t.slice(5));if(Number.isInteger(n)&&n>0)return`pointX${n}_${e}`}return null},stateVariablesDeterminingDependencies:["equationIdentity","nPointsPrescribed","basedOnSlope"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[2,e.nDimensions],returnArrayDependenciesByKey({stateValues:e,arrayKeys:t}){if(null===e.equationIdentity){let n={};for(let r of t){let[t,a]=r.split(","),i=Number(t)+1+"_"+(Number(a)+1);n[r]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+i]}},e.basedOnSlope?("1"===t&&(1===e.nPointsPrescribed&&n[r].through.variableNames.push("pointX1_"+(Number(a)+1)),n[r].dForSlope={dependencyType:"stateVariable",variableName:"dForSlope"},n[r].slopeAttr={dependencyType:"attributeComponent",attributeName:"slope",variableNames:["value"]}),0===e.nPointsPrescribed&&(n[r].essentialPoint={dependencyType:"stateVariable",variableName:"essentialPointX2_"+(Number(a)+1)})):n[r].essentialPoint={dependencyType:"stateVariable",variableName:"essentialPointX"+i}}return{dependenciesByKey:n,globalDependencies:{nPointsPrescribed:{dependencyType:"stateVariable",variableName:"nPointsPrescribed"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},basedOnSlope:{dependencyType:"stateVariable",variableName:"basedOnSlope"}}}}return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,arraySize:r,componentName:a}){if("coeff0"in e){let t=calculatePointsFromCoeffs(e);if(t.success)return{setValue:{points:t.points}};{let e={};for(let t=0;t<r[0];t++)for(let n=0;n<r[1];n++)e[t+","+n]=me$3.fromAst("");return{setValue:{points:e}}}}{let r={};for(let a of n){let[n,i]=a.split(","),o=Number(n)+1+"_"+(Number(i)+1);if(null!==t[a].through&&t[a].through.stateValues["pointX"+o])r[a]=t[a].through.stateValues["pointX"+o];else if(e.basedOnSlope){let o;if(o=1===e.nPointsPrescribed?t[a].through.stateValues["pointX1_"+(Number(i)+1)]:t[a].essentialPoint,"0"===n)r[a]=o;else{let e=t[a].slopeAttr.stateValues.value;if(e===1/0||e===-1/0)r[a]="0"===i?o:me$3.fromAst(["+",o.tree,t[a].dForSlope*Math.sign(e)]);else if(Number.isFinite(e)){let n=Math.atan(e);r[a]="0"===i?me$3.fromAst(["+",o.tree,t[a].dForSlope*Math.cos(n)]):me$3.fromAst(["+",o.tree,t[a].dForSlope*Math.sin(n)])}else r[a]=me$3.fromAst("")}}else r[a]=t[a].essentialPoint}return{setValue:{points:r}}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:a,stateValues:i,workspace:o}){if(a&&!await i.draggable)return{success:!1};if("coeff0"in t){o.desiredPoints||(o.desiredPoints={}),Object.assign(o.desiredPoints,e.points);let t,n,r,a,s=await i.points;if(t=o.desiredPoints["0,0"]?o.desiredPoints["0,0"]:s[0][0],n=o.desiredPoints["0,1"]?o.desiredPoints["0,1"]:s[0][1],r=o.desiredPoints["1,0"]?o.desiredPoints["1,0"]:s[1][0],a=o.desiredPoints["1,1"]?o.desiredPoints["1,1"]:s[1][1],"number"==typeof t.tree&&"number"==typeof n.tree&&"number"==typeof r.tree&&"number"==typeof a.tree){let e=[t.tree,n.tree],o=[r.tree,a.tree],s=e[1]-o[1],l=o[0]-e[0],u=e[0]*o[1]-e[1]*o[0],c=await i.coeffvar1,p=await i.coeffvar2,d=[];return Math.abs(s*p-c*l)<1e-12*Math.abs(s*p)?(u*=0!==s?c/s:p/l,d.push({setDependency:"coeff0",desiredValue:u,additionalDependencyValues:{coeffvar1:c,coeffvar2:p}})):d.push({setDependency:"coeff0",desiredValue:u,additionalDependencyValues:{coeffvar1:s,coeffvar2:l}}),d.push({setDependency:"lastPointsFromInverting",desiredValue:[e,o]}),{success:!0,instructions:d}}let l=n.subtract(a).simplify(),u=r.subtract(t).simplify();return{success:!0,instructions:[{setDependency:"coeff0",desiredValue:t.multiply(a).subtract(n.multiply(r)).simplify(),additionalDependencyValues:{coeffvar1:l,coeffvar2:u}}]}}{let a=[];for(let s of Object.keys(e.points).reverse()){let[l,u]=s.split(","),c=Number(l)+1+"_"+(Number(u)+1);if(null!==n[s].through&&n[s].through.stateValues["pointX"+c])a.push({setDependency:r[s].through,desiredValue:e.points[s],variableIndex:0});else if(t.basedOnSlope)if("0"===l)a.push({setDependency:r[s].essentialPoint,desiredValue:e.points[s],variableIndex:0});else{let t=e.points[s];t instanceof me$3.class&&(t=t.evaluate_to_constant(),null===t&&(t=NaN)),o.desiredPoint1||(o.desiredPoint1=[]),o.desiredPoint1[u]=t;let n="0"===u?"1":"0";if(void 0===o.desiredPoint1[n]){let e=(await i.points)[1][n].evaluate_to_constant();null===e&&(e=NaN),o.desiredPoint1[n]=e}if(o.desiredPoint1.every(Number.isFinite)){let e=(await i.points)[0][0].evaluate_to_constant(),t=(await i.points)[0][1].evaluate_to_constant();if(Number.isFinite(e)&&Number.isFinite(t)){let n=o.desiredPoint1[0]-e,i=o.desiredPoint1[1]-t,l=Math.sqrt(n*n+i*i);0!==n&&(l*=Math.sign(n)),a.push({setDependency:r[s].dForSlope,desiredValue:l}),a.push({setDependency:r[s].slopeAttr,desiredValue:i/n,variableIndex:0})}}}else a.push({setDependency:r[s].essentialPoint,desiredValue:e.points[s]})}return{success:!0,instructions:a}}}},e.equation={public:!0,shadowingInstructions:{createComponentOfType:"math"},forRenderer:!0,stateVariablesDeterminingDependencies:["equationIdentity"],additionalStateVariablesDefined:[{variableName:"coeff0",public:!0,shadowingInstructions:{createComponentOfType:"math"}},{variableName:"coeffvar1",public:!0,shadowingInstructions:{createComponentOfType:"math"}},{variableName:"coeffvar2",public:!0,shadowingInstructions:{createComponentOfType:"math"}}],returnDependencies:function({stateValues:e}){let t={variables:{dependencyType:"stateVariable",variableName:"variables"}};return null===e.equationIdentity?(t.points={dependencyType:"stateVariable",variableName:"points"},t.nDimensions={dependencyType:"stateVariable",variableName:"nDimensions"}):t.equation={dependencyType:"attributeComponent",attributeName:"equation",variableNames:["value"]},t},definition:function({dependencyValues:e}){let t=e.variables,n=me$3.fromAst("");if(e.equation){let r=e.equation.stateValues.value,a=calculateCoeffsFromEquation({equation:r,variables:t});if(!a.success)return{setValue:{equation:r,coeff0:n,coeffvar1:n,coeffvar2:n}};let{coeff0:i,coeffvar1:o,coeffvar2:s}=a;return{setValue:{equation:r,coeff0:i,coeffvar1:o,coeffvar2:s}}}let r=e.nDimensions;if(Number.isNaN(r))return console.warn("Line through points of undetermined dimensions"),{setValue:{equation:n,coeff0:n,coeffvar1:n,coeffvar2:n}};if(r<2)return console.warn("Line must be through points of at least two dimensions"),{setValue:{equation:n,coeff0:n,coeffvar1:n,coeffvar2:n}};let a=e.points[0][0],i=e.points[0][1],o=e.points[1][0],s=e.points[1][1],l=[...t.map((e=>e.toString()))];for(let e=0;e<r;e++)if(-1!==a.variables().indexOf(l[e])||-1!==i.variables().indexOf(l[e])||-1!==o.variables().indexOf(l[e])||-1!==s.variables().indexOf(l[e]))return console.warn("Points through line depend on variables: "+l.join(", ")),{setValue:{equation:n,coeff0:n,coeffvar1:n,coeffvar2:n}};if(2!==r)return{setValue:{equation:n,coeff0:n,coeffvar1:n,coeffvar2:n}};if(a.equals(o)&&i.equals(s)){let e=me$3.fromAst(0);return{setValue:{equation:n,coeff0:e,coeffvar1:e,coeffvar2:e}}}let u=i.subtract(s).simplify(),c=o.subtract(a).simplify(),p=a.multiply(s).subtract(i.multiply(o)).simplify();return{setValue:{equation:me$3.fromAst(["=",["+",["*","a","x"],["*","b","y"],"c"],0]).substitute({a:u,b:c,c:p,x:t[0],y:t[1]}).simplify(),coeff0:p,coeffvar1:u,coeffvar2:c}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){if(t.points)return console.log("Haven't implemented inverse definition of equation of line based on points"),{success:!1};if(e.equation)return{success:!0,instructions:[{setDependency:"equation",desiredValue:e.equation,variableIndex:0}]};if(!("coeff0"in e&&"coeffvar1"in e&&"coeffvar2"in e))return console.log("Haven't implemented inverting coeffs if not specifying all of them"),{success:!1};return{success:!0,instructions:[{setDependency:"equation",desiredValue:me$3.fromAst(["=",0,["+",["*","a","x"],["*","b","y"],"c"]]).substitute({a:e.coeffvar1,b:e.coeffvar2,c:e.coeff0,x:t.variables[0],y:t.variables[1]}).simplify(),variableIndex:0}]}}},e.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>Number.isNaN(e.nDimensions)?[0]:[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(n)+1)}};return{globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,componentName:r}){if(Number.isNaN(e.nDimensions))return{};let a={};for(let r of n){let n=t[r].point;Array.isArray(n)||(n=[n]);let i=[];for(let t=0;t<e.nDimensions;t++){let e=n[t].evaluate_to_constant();Number.isFinite(e)||(e=NaN),i.push(e)}a[r]=i}return{setValue:{numericalPoints:a}}}},e.numericalCoeff0={additionalStateVariablesDefined:["numericalCoeffvar1","numericalCoeffvar2"],returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){let t=e.coeff0.evaluate_to_constant();Number.isFinite(t)||(t=NaN);let n=e.coeffvar1.evaluate_to_constant();Number.isFinite(n)||(n=NaN);let r=e.coeffvar2.evaluate_to_constant();return Number.isFinite(r)||(r=NaN),{setValue:{numericalCoeff0:t,numericalCoeffvar1:n,numericalCoeffvar2:r}}}},e.slope={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){return{setValue:{slope:me$3.fromAst(["-",["/","a","b"]]).substitute({a:e.coeffvar1,b:e.coeffvar2}).simplify()}}}},e.xintercept={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"}}),definition:({dependencyValues:e})=>({setValue:{xintercept:me$3.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar1}).simplify()}})},e.yintercept={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:({dependencyValues:e})=>({setValue:{yintercept:me$3.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar2}).simplify()}})},e.lastPointsFromInverting={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{lastPointsFromInverting:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"lastPointsFromInverting",value:e.lastPointsFromInverting}]})},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalCoeff0:{dependencyType:"stateVariable",variableName:"numericalCoeff0"},numericalCoeffvar1:{dependencyType:"stateVariable",variableName:"numericalCoeffvar1"},numericalCoeffvar2:{dependencyType:"stateVariable",variableName:"numericalCoeffvar2"}}),definition({dependencyValues:e}){let t=e.numericalCoeffvar1,n=e.numericalCoeffvar2,r=e.numericalCoeff0,a=Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(r),i=2!==e.nDimensions||!a||0===t&&0===n;return{setValue:{nearestPoint:function({variables:e,scales:a=[1,1]}){if(i)return{};let o=a[0],s=a[1],l=t*o,u=n*s,c=l*l+u*u,p=e.x1?.evaluate_to_constant(),d=e.x2?.evaluate_to_constant();if(!Number.isFinite(p)||!Number.isFinite(d))return{};let m=p/o,f=d/s,h={};return h.x1=(u*(u*m-l*f)-l*r)*o/c,h.x2=(l*(-u*m+l*f)-u*r)*s/c,void 0!==e.x3&&(h.x3=0),h}}}}},e}static adapters=["equation"];async moveLine({point1coords:e,point2coords:t,transient:n,actionId:r}){let a={"0,0":me$3.fromAst(e[0]),"0,1":me$3.fromAst(e[1])};return await this.stateValues.basedOnSlope||(a["1,0"]=me$3.fromAst(t[0]),a["1,1"]=me$3.fromAst(t[1])),n?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:a}],transient:!0,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:a}],actionId:r,event:{verb:"interacted",object:{componentId:this.componentName},result:{point1:e,point2:t}}})}switchLine(){}}function calculateCoeffsFromEquation({equation:e,variables:t}){let n=t[0],r=t[1],a=n.toString(),i=r.toString();e=e.expand().simplify();let o=me$3.fromAst(["+",e.tree[2],["-",e.tree[1]]]).expand().simplify(),s=[];s=Array.isArray(o.tree)&&"+"===o.tree[0]?o.tree.slice(1):[o.tree];let l=me$3.fromAst(0),u=me$3.fromAst(0),c=me$3.fromAst(0);for(let e of s){let t=p(e);if(!t.success)return{success:!1};l=l.add(t.coeffvar1),u=u.add(t.coeffvar2),c=c.add(t.coeff0)}return l=l.simplify(),u=u.simplify(),c=c.simplify(),{success:!0,coeff0:c,coeffvar1:l,coeffvar2:u};function p(e){let t=0,o=0,s=0;if("string"==typeof e)e===a?t=1:e===i?o=1:s=e;else if("number"==typeof e)s=e;else{if(!Array.isArray(e))return console.warn("Invalid format for equation of line in variables "+n+" and "+r),{success:!1};{let a=e[0],i=e.slice(1);if("-"===a){let e=p(i[0]);if(!e.success)return{success:!1};t=["-",e.coeffvar1.tree],o=["-",e.coeffvar2.tree],s=["-",e.coeff0.tree]}else{if("+"===a)return console.warn("Invalid format for equation of line in variables "+n+" and "+r),{success:!1};if("*"===a){let a=-1,l=-1;for(let e=0;e<i.length;e++){if(n.equals(me$3.fromAst(i[e]))){a=e;break}if(r.equals(me$3.fromAst(i[e]))){l=e;break}}-1!==a?(i.splice(a,1),t=1===i.length?i[0]:["*"].concat(i)):-1!==l?(i.splice(l,1),o=1===i.length?i[0]:["*"].concat(i)):s=e}else if("/"===a){let e=p(i[0]);if(!e.success)return{success:!1};t=["/",e.coeffvar1.tree,i[1]],o=["/",e.coeffvar2.tree,i[1]],s=["/",e.coeff0.tree,i[1]]}else"_"===a?n.equals(me$3.fromAst(e))?t=1:r.equals(me$3.fromAst(e))?o=1:s=e:s=e}}}return{success:!0,coeffvar1:me$3.fromAst(t),coeffvar2:me$3.fromAst(o),coeff0:me$3.fromAst(s)}}}function calculatePointsFromCoeffs({coeff0:e,coeffvar1:t,coeffvar2:n,variables:r,lastPointsFromInverting:a}){let i=r[0],o=r[1],s=i.toString(),l=o.toString();if(-1!==t.variables(!0).indexOf(s)||-1!==t.variables(!0).indexOf(l)||-1!==n.variables(!0).indexOf(s)||-1!==n.variables(!0).indexOf(l)||-1!==e.variables(!0).indexOf(s)||-1!==e.variables(!0).indexOf(l))return console.warn("Invalid format for equation of line in variables "+s+" and "+l),{success:!1};let u=me$3.fromAst(0);if(t.equals(u)&&n.equals(u))return console.warn("Invalid format for equation of line in variables "+s+" and "+l),{success:!1};let c,p,d,m,f=t.evaluate_to_constant(),h=n.evaluate_to_constant(),y=e.evaluate_to_constant(),b={};if(Number.isFinite(y)&&Number.isFinite(f)&&Number.isFinite(h)){let e=f*f+h*h;if(0===e)return{success:!1};if(a){let t=a[0][0],n=a[0][1];c=(h*(h*t-f*n)-f*y)/e,p=(f*(-h*t+f*n)-h*y)/e,t=a[1][0],n=a[1][1],d=(h*(h*t-f*n)-f*y)/e,m=(f*(-h*t+f*n)-h*y)/e}else c=(2*h-f*y)/e,p=(-2*f-h*y)/e,d=(h-f*y)/e,m=-(f+h*y)/e;b["0,0"]=me$3.fromAst(c),b["0,1"]=me$3.fromAst(p),b["1,0"]=me$3.fromAst(d),b["1,1"]=me$3.fromAst(m)}else{let r=t.pow(2).add(n.pow(2));c=n.multiply(2).subtract(t.multiply(e)).divide(r),p=t.multiply(-2).subtract(n.multiply(e)).divide(r),d=n.subtract(t.multiply(e)).divide(r),m=t.add(n.multiply(e)).multiply(-1).divide(r),b["0,0"]=c,b["0,1"]=p,b["1,0"]=d,b["1,1"]=m}return{success:!0,points:b}}class EquilibriumLine extends Line{static componentType="equilibriumLine";static rendererType="line";static createAttributesObject(){let e=super.createAttributesObject();return e.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},e.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.dashed={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition:({dependencyValues:e})=>({setValue:{dashed:!e.stable}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"stable",desiredValue:!e.dashed}]})},e}async switchLine({actionId:e}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:e})}}class Curve extends GraphicalComponent{static componentType="curve";static rendererType="curve";actions={moveControlVector:this.moveControlVector.bind(this),moveThroughPoint:this.moveThroughPoint.bind(this),changeVectorControlDirection:this.changeVectorControlDirection.bind(this),switchCurve:this.switchCurve.bind(this)};static primaryStateVariableForDefinition="fShadow";static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.labelPosition={createComponentOfType:"text",createStateVariable:"labelPosition",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft","top","bottom","left","right"]},e.flipFunction={createComponentOfType:"boolean",createStateVariable:"flipFunction",defaultValue:!1,public:!0,forRenderer:!0},e.nDiscretizationPoints={createComponentOfType:"number",createStateVariable:"nDiscretizationPoints",defaultValue:1e3,public:!0},e.periodic={createComponentOfType:"boolean",createStateVariable:"periodic",defaultValue:!1,public:!0},e.splineTension={createComponentOfType:"number",createStateVariable:"splineTension",defaultValue:.8,clamp:[0,1],public:!0},e.extrapolateBackward={createComponentOfType:"boolean",createStateVariable:"extrapolateBackward",defaultValue:!1,public:!0,forRenderer:!0},e.extrapolateForward={createComponentOfType:"boolean",createStateVariable:"extrapolateForward",defaultValue:!1,public:!0,forRenderer:!0},e.splineForm={createComponentOfType:"text",createStateVariable:"splineForm",defaultValue:"centripetal",public:!0,toLowerCase:!0,validValues:["centripetal","uniform"]},e.variable={createComponentOfType:"variable",createStateVariable:"variableForChild",defaultValue:me$3.fromAst("x")},e.through={createComponentOfType:"_pointListComponent"},e.parMin={createComponentOfType:"math"},e.parMax={createComponentOfType:"math"},e.nearestPointAsCurve={createComponentOfType:"boolean",createStateVariable:"nearestPointAsCurvePrelim",defaultValue:!1},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){if(0===e.length||!e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro)))return{success:!1};let t=returnBreakStringsSugarFunction({childrenToComponentFunction:e=>({componentType:"function",children:e}),mustStripOffOuterParentheses:!0}),n=t({matchedChildren:e});return n.success?n:{success:!0,newChildren:[{componentType:"function",children:e}]}}}),e}static returnChildGroups(){return[{group:"functions",componentTypes:["function"]},{group:"bezierControls",componentTypes:["bezierControls"]}]}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},t.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" curve"}}}},t.curveType={forRenderer:!0,returnDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"]},through:{dependencyType:"attributeComponent",attributeName:"through"}}),definition({dependencyValues:e}){let t="function";return null!==e.through?t="bezier":e.functionChildren.length>1&&(t="parameterization"),{setValue:{curveType:t}}}},t.fShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fShadow:!0}})},t.graphXmin={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"graphXmax",forRenderer:!0},{variableName:"graphYmin",forRenderer:!0},{variableName:"graphYmax",forRenderer:!0}],returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]}}),definition:({dependencyValues:e})=>e.graphAncestor?{setValue:{graphXmin:e.graphAncestor.stateValues.xmin,graphXmax:e.graphAncestor.stateValues.xmax,graphYmin:e.graphAncestor.stateValues.ymin,graphYmax:e.graphAncestor.stateValues.ymax}}:{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}}},t.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMaxAttr:{dependencyType:"attributeComponent",attributeName:"parMax",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]},adapterSourceDomain:{dependencyType:"adapterSourceStateVariable",variableName:"domain"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"}}),definition:function({dependencyValues:e}){let t;if("bezier"===e.curveType)t=e.nThroughPoints-1,e.extrapolateForward&&(t*=2);else if(null!==e.parMaxAttr)t=e.parMaxAttr.stateValues.value.evaluate_to_constant(),Number.isFinite(t)||(t=NaN);else if("function"===e.curveType){let n,r,a=null;if(a=1===e.functionChild.length?e.functionChild[0].stateValues.domain:e.adapterSourceDomain,null!==a){a=a[0];try{t=a[1].evaluate_to_constant(),Number.isFinite(t)||t===1/0||(t=NaN)}catch(e){}}e.flipFunction?(r=e.graphYmax,n=e.graphYmin):(r=e.graphXmax,n=e.graphXmin),null!==r&&null!==n&&(t=void 0===t?r+.1*(r-n):Math.min(t,r+.1*(r-n))),void 0===t&&(t=1/0)}else t=10;return{setValue:{parMax:t}}}},t.parMin={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMinAttr:{dependencyType:"attributeComponent",attributeName:"parMin",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["domain"]},adapterSourceDomain:{dependencyType:"adapterSourceStateVariable",variableName:"domain"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"}}),definition:function({dependencyValues:e}){let t;if("bezier"===e.curveType)t=0,e.extrapolateBackward&&(t=-(e.nThroughPoints-1));else if(null!==e.parMinAttr)t=e.parMinAttr.stateValues.value.evaluate_to_constant(),Number.isFinite(t)||(t=NaN);else if("function"===e.curveType){let n,r,a=null;if(a=1===e.functionChild.length?e.functionChild[0].stateValues.domain:e.adapterSourceDomain,null!==a){a=a[0];try{t=a[0].evaluate_to_constant(),Number.isFinite(t)||t===-1/0||(t=NaN)}catch(e){}}e.flipFunction?(r=e.graphYmax,n=e.graphYmin):(r=e.graphXmax,n=e.graphXmin),null!==r&&null!==n&&(t=void 0===t?n+.1*(n-r):Math.max(t,n+.1*(n-r))),void 0===t&&(t=-1/0)}else t=-10;return{setValue:{parMin:t}}}},t.nThroughPoints={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition({dependencyValues:e}){let t=0;return null!==e.through&&(t=e.through.stateValues.nPoints),{setValue:{nThroughPoints:t}}}},t.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){if(null!==e.through){return{setValue:{nDimensions:e.through.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}}return{setValue:{nDimensions:2}}}},t.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"throughPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("throughPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("throughPoints"===t)return"throughPoint"+e;if("throughPoint"===t.slice(0,12)){let n=Number(t.slice(12));if(Number.isInteger(n)&&n>0)return`throughPointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+a]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let[t,a]=r.split(","),i=Number(t)+1+"_"+(Number(a)+1),o=e[r].through;null!==o&&o.stateValues["pointX"+i]?n[r]=o.stateValues["pointX"+i]:n[r]=me$3.fromAst(0)}return{setValue:{throughPoints:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.throughPoints){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);if(null===t[r].through||!t[r].through.stateValues["pointX"+s])return{success:!1};i.push({setDependency:n[r].through,desiredValue:e.throughPoints[r],childIndex:0,variableIndex:0})}return{success:!0,instructions:i}}},t.numericalThroughPoints={isArray:!0,entryPrefixes:["numericalThroughPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].throughPoint.map((e=>e.evaluate_to_constant()));t.every((e=>Number.isFinite(e)))||(t=Array(t.length).fill(NaN)),n[r]=t}return{setValue:{numericalThroughPoints:n}}}},t.haveBezierControls={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childGroups:["bezierControls"]}}),definition:({dependencyValues:e})=>({setValue:{haveBezierControls:e.controlChild.length>0}})},t.bezierControlsAlwaysVisible={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["alwaysVisible"]}}),definition:({dependencyValues:e})=>({setValue:{bezierControlsAlwaysVisible:e.controlChild.length>0&&e.controlChild[0].stateValues.alwaysVisible}})},t.vectorControlDirections={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["vectorControlDirection"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["direction"+(Number(n)+1)]}};return{dependenciesByKey:t,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].controlChild;t&&t.length>0?n[r]=t[0].stateValues["direction"+(Number(r)+1)]:n[r]="none"}return{setValue:{vectorControlDirections:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n,globalDependencyValues:r}){if(!r.haveBezierControls)return{success:!1};let a=[];for(let r in e.vectorControlDirections){let i=n[r].controlChild;i&&i.length>0&&a.push({setDependency:t[r].controlChild,desiredValue:e.vectorControlDirections[r],childIndex:0,variableIndex:0})}return{success:!0,instructions:a}}},t.hiddenControls={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},isArray:!0,entryPrefixes:["hiddenControl"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["hiddenControl"+(Number(n)+1)]}};return{dependenciesByKey:t,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].controlChild;t&&t.length>0?n[r]=t[0].stateValues["hiddenControl"+(Number(r)+1)]:n[r]=!1}return{setValue:{hiddenControls:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n,globalDependencyValues:r}){if(!r.haveBezierControls)return{success:!1};let a=[];for(let r in e.hiddenControls){let i=n[r].controlChild;i&&i.length>0&&a.push({setDependency:t[r].controlChild,desiredValue:e.hiddenControls[r],childIndex:0,variableIndex:0})}return{success:!0,instructions:a}}},t.controlVectors={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"controlVectorX"===e?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]},entryPrefixes:["controlVectorX","controlVector"],nDimensions:3,stateVariablesDeterminingDependencies:["vectorControlDirections","nThroughPoints"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("controlVectorX"===e){let e=t.split("_").map((e=>Number(e)-1));return 3===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every((e=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?Array.from(Array(n[2]),((t,n)=>String(e)+","+n)):[]:[String(e)+",0"]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=r.split(",").map((e=>Number(e))),a=e.map((e=>e+1)),i=a.join("_");n[r]={direction:{dependencyType:"stateVariable",variableName:"vectorControlDirection"+a[0]},controlChild:{dependencyType:"child",childGroups:["bezierControls"],variableNames:["control"+i]}};let o=e[0],s=t.vectorControlDirections[o],l=[];"none"===s?l=[o-1,o,o+1]:"previous"===s?l=[o,o+1]:"next"===s&&(l=[o-1,o]);for(let e of l)e>=0&&e<t.nThroughPoints&&(n[r]["throughPoint"+(e+1)]={dependencyType:"stateVariable",variableName:"throughPoint"+(e+1)})}return{globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},splineTension:{dependencyType:"stateVariable",variableName:"splineTension"},splineForm:{dependencyType:"stateVariable",variableName:"splineForm"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:t,dependencyValuesByKey:n,arrayKeys:r}){let a={};for(let i of r){if(2!==t.nDimensions){a[i]=me$3.fromAst(NaN);continue}if(i in a)continue;let r=i.split(",").map((e=>Number(e))),o=r.map((e=>e+1)),s=o.join("_"),l=r[0],u=r[1],c=n[i].direction;if("none"===c){let r,o,s=n[i]["throughPoint"+(l+1)];l>0&&(r=n[i]["throughPoint"+l]),l<t.nThroughPoints&&(o=n[i]["throughPoint"+(l+2)]);let{coordsNumeric:c,numericEntries:p}=calculateControlVectorFromSpline({tau:t.splineTension,eps:e.eps,splineForm:t.splineForm,point1:r,point2:s,point3:o});for(let e=0;e<2;e++){let t=l+","+u+","+e,n=l+","+(1-u)+","+e;0===u?(a[t]=c[e],a[n]=me$3.fromAst(-c[e].tree)):(a[t]=me$3.fromAst(-c[e].tree),a[n]=c[e])}}else if(0===r[1]&&"next"===c||1===r[1]&&"previous"===c){let r=n[i]["throughPoint"+l],o=n[i]["throughPoint"+(l+1)],s=n[i]["throughPoint"+(l+2)],{coordsNumeric:c,numericEntries:p}=calculateControlVectorFromSpline({tau:t.splineTension,eps:e.eps,splineForm:t.splineForm,point1:r||s,point2:o,point3:void 0});for(let e=0;e<2;e++){a[l+","+u+","+e]=c[e]}}else a[i]=n[i].controlChild[0].stateValues["control"+s]}return{setValue:{controlVectors:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n,globalDependencyValues:r}){if(!r.haveBezierControls||2!==r.nDimensions)return{success:!1};let a=[];for(let r in e.controlVectors){let i=r.split(",").map((e=>Number(e))),o=i.map((e=>e+1)),s=o.join("_"),l=n[r].controlChild;if(l.length>0){l[0].stateValues["control"+s]&&a.push({setDependency:t[r].controlChild,desiredValue:e.controlVectors[r],childIndex:0,variableIndex:0})}}return{success:!0,instructions:a}}},t.numericalControlVectors={isArray:!0,entryPrefixes:["numericalControlVector"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=n.split(",").map((e=>Number(e))),r=e.map((e=>e+1)),a=r.join("_");t[n]={controlVector:{dependencyType:"stateVariable",variableName:"controlVector"+a}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].controlVector.map((e=>e.tree));n[r]=t}return{setValue:{numericalControlVectors:n}}}},t.controlPoints={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"controlPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},entryPrefixes:["controlPointX","controlPoint"],nDimensions:3,getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("controlPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 3===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every((e=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?Array.from(Array(n[2]),((t,n)=>String(e)+","+n)):[]:[String(e)+",0"]:[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=n.split(",").map((e=>Number(e))),r=e.map((e=>e+1)),a=r.join("_");t[n]={throughPointX:{dependencyType:"stateVariable",variableName:"throughPointX"+r[0]+"_"+r[2]},controlVectorX:{dependencyType:"stateVariable",variableName:"controlVectorX"+a}}}return{globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n)if(2!==e.nDimensions)r[a]=me$3.fromAst(NaN);else{let e=t[a].controlVectorX;if(e){let n=t[a].throughPointX.evaluate_to_constant();Number.isFinite(n)||(n=NaN),r[a]=me$3.fromAst(n+e.tree)}else r[a]=null}return{setValue:{controlPoints:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n,globalDependencyValues:r}){if(!r.haveBezierControls||2!==r.nDimensions)return{success:!1};let a=[];for(let r in e.controlPoints){if(n[r].controlVectorX){let i=n[r].throughPointX,o=e.controlPoints[r];o.tree&&(o=o.tree);let s=me$3.fromAst(["+",o,["-",i.tree]]);a.push({setDependency:t[r].controlVectorX,desiredValue:s})}}return{success:!0,instructions:a}}},t.numericalControlPoints={isArray:!0,entryPrefixes:["numericalControlPoint"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=n.split(",").map((e=>Number(e))),r=e.map((e=>e+1)),a=r.join("_");t[n]={controlPoint:{dependencyType:"stateVariable",variableName:"controlPoint"+a}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].controlPoint.map((e=>e.tree));n[r]=t}return{setValue:{numericalControlPoints:n}}}},t.splineCoeffs={isArray:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints-1],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1,r=e+1;t[n]={previousPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+e},nextPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+r},previousVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+e+"_2"},nextVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+r+"_1"}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].previousPoint,a=e[r].nextPoint,i=e[r].previousVector,o=e[r].nextVector,s=[];for(let e=0;e<2;e++)s.push(initCubicPoly(t[e],a[e],3*i[e],-3*o[e]));n[r]=s}return{setValue:{splineCoeffs:n}}}},t.extrapolateBackwardCoeffs={stateVariablesDeterminingDependencies:["extrapolateBackward"],additionalStateVariablesDefined:[{variableName:"extrapolateBackwardMode",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies({stateValues:e}){let t={extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return e.extrapolateBackward&&(t.firstSplineCoeffs={dependencyType:"stateVariable",variableName:"splineCoeffs1"},t.graphXmin={dependencyType:"stateVariable",variableName:"graphXmin"},t.graphXmax={dependencyType:"stateVariable",variableName:"graphXmax"},t.graphYmin={dependencyType:"stateVariable",variableName:"graphYmin"},t.graphYmax={dependencyType:"stateVariable",variableName:"graphYmax"}),t},definition({dependencyValues:e}){if(!e.extrapolateBackward||!e.firstSplineCoeffs)return{setValue:{extrapolateBackwardCoeffs:null,extrapolateBackwardMode:""}};let t=e.firstSplineCoeffs[0],n=e.firstSplineCoeffs[1],r=t[0],a=t[1],i=2*t[2],o=n[0],s=n[1],l=a*a+s*s,u=(s*i-a*(2*n[2]))/(l*l);if(Math.abs(u)<1e-12||Math.abs(a)<1e-12||Math.abs(s)<1e-12){let t=a,n=s;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,a=e.graphYmax-e.graphYmin,i=e.nThroughPoints-1,o=r/i/Math.abs(t),s=a/i/Math.abs(n),l=Math.min(o,s);l>1&&(t*=l,n*=l)}return{setValue:{extrapolateBackwardCoeffs:[[r,t,0],[o,n,0]],extrapolateBackwardMode:"line"}}}let c=s*u,p=-a*u;if(c*a>0){let t=c/p,n=(1+t*t)**2,i=a;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,a=e.graphYmax-e.graphYmin,o=e.nThroughPoints-1,s=r/o,l=1/0;if(0!==p){let e=p*n/2*o*o,r=-t*o,i=Math.sqrt(r*r+4*Math.abs(e)*a);l=(Math.abs(r)+i)/(2*Math.abs(e))}let u=Math.min(s,l);u>Math.abs(i)&&(i*=u/Math.abs(i))}return{setValue:{extrapolateBackwardCoeffs:[[r,i,0],[o,-i*t,p*i*i*n/2]],extrapolateBackwardMode:"parabolaVertical"}}}{let t=p/c,n=(1+t*t)**2,a=s;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,i=e.graphYmax-e.graphYmin,o=e.nThroughPoints-1,s=i/o,l=1/0;if(0!==c){let e=c*n/2*o*o,a=-t*o,i=Math.sqrt(a*a+4*Math.abs(e)*r);l=(Math.abs(a)+i)/(2*Math.abs(e))}let u=Math.min(l,s);u>Math.abs(a)&&(a*=u/Math.abs(a))}return{setValue:{extrapolateBackwardCoeffs:[[r,-a*t,c*a*a*n/2],[o,a,0]],extrapolateBackwardMode:"parabolaHorizontal"}}}}},t.extrapolateForwardCoeffs={stateVariablesDeterminingDependencies:["nThroughPoints","extrapolateForward"],additionalStateVariablesDefined:[{variableName:"extrapolateForwardMode",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies({stateValues:e}){let t={extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return e.extrapolateForward&&e.nThroughPoints>=2&&(t.lastSplineCoeffs={dependencyType:"stateVariable",variableName:"splineCoeffs"+(e.nThroughPoints-1)},t.graphXmin={dependencyType:"stateVariable",variableName:"graphXmin"},t.graphXmax={dependencyType:"stateVariable",variableName:"graphXmax"},t.graphYmin={dependencyType:"stateVariable",variableName:"graphYmin"},t.graphYmax={dependencyType:"stateVariable",variableName:"graphYmax"}),t},definition({dependencyValues:e}){if(!e.extrapolateForward||!e.lastSplineCoeffs)return{setValue:{extrapolateForwardCoeffs:null,extrapolateForwardMode:""}};let t=e.lastSplineCoeffs[0],n=e.lastSplineCoeffs[1],r=t[0]+t[1]+t[2]+t[3],a=t[1]+2*t[2]+3*t[3],i=2*t[2]+6*t[3],o=n[0]+n[1]+n[2]+n[3],s=n[1]+2*n[2]+3*n[3],l=a*a+s*s,u=(s*i-a*(2*n[2]+6*n[3]))/(l*l);if(Math.abs(u)<1e-12||Math.abs(a)<1e-12||Math.abs(s)<1e-12){let t=a,n=s;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,a=e.graphYmax-e.graphYmin,i=e.nThroughPoints-1,o=r/i/Math.abs(t),s=a/i/Math.abs(n),l=Math.min(o,s);l>1&&(t*=l,n*=l)}return{setValue:{extrapolateForwardCoeffs:[[r,t,0],[o,n,0]],extrapolateForwardMode:"line"}}}let c=s*u,p=-a*u;if(c*a<0){let t=c/p,n=(1+t*t)**2,i=a;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,a=e.graphYmax-e.graphYmin,o=e.nThroughPoints-1,s=r/o,l=1/0;if(0!==p){let e=p*n/2*o*o,r=-t*o,i=Math.sqrt(r*r+4*Math.abs(e)*a);l=(Math.abs(r)+i)/(2*Math.abs(e))}let u=Math.min(s,l);u>Math.abs(i)&&(i*=u/Math.abs(i))}return{setValue:{extrapolateForwardCoeffs:[[r,i,0],[o,-i*t,p*i*i*n/2]],extrapolateForwardMode:"parabolaVertical"}}}{let t=p/c,n=(1+t*t)**2,a=s;if(null!==e.graphXmin&&null!==e.graphXmax&&null!==e.graphYmin&&null!==e.graphYmax){let r=e.graphXmax-e.graphXmin,i=e.graphYmax-e.graphYmin,o=e.nThroughPoints-1,s=i/o,l=1/0;if(0!==c){let e=c*n/2*o*o,a=-t*o,i=Math.sqrt(a*a+4*Math.abs(e)*r);l=(Math.abs(a)+i)/(2*Math.abs(e))}let u=Math.min(l,s);u>Math.abs(a)&&(a*=u/Math.abs(a))}return{setValue:{extrapolateForwardCoeffs:[[r,-a*t,c*a*a*n/2],[o,a,0]],extrapolateForwardMode:"parabolaHorizontal"}}}}},t.fs={isArray:!0,entryPrefixes:["f"],additionalStateVariablesDefined:[{variableName:"fDefinitions",isArray:!0,forRenderer:!0}],returnArraySizeDependencies:()=>({functionChildren:{dependencyType:"child",childGroups:["functions"]},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),returnArraySize:({dependencyValues:e})=>"bezier"===e.curveType?[2]:[Math.max(1,e.functionChildren.length)],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["numericalf","fDefinition"],childIndices:[n]}},0===Number(n)&&(t[n].fShadow={dependencyType:"stateVariable",variableName:"fShadow"},t[n].fDefinitionAdapted={dependencyType:"adapterSourceStateVariable",variableName:"fDefinition"});return{globalDependencies:{curveType:{dependencyType:"stateVariable",variableName:"curveType"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},extrapolateBackwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateBackwardCoeffs"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},extrapolateForwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateForwardCoeffs"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){if("bezier"===e.curveType)return{setValue:{fs:returnBezierFunctions(e),fDefinitions:{0:{functionType:"bezier",nThroughPoints:e.nThroughPoints,numericalThroughPoints:e.numericalThroughPoints,splineCoeffs:e.splineCoeffs,extrapolateForward:e.extrapolateForward,extrapolateForwardCoeffs:e.extrapolateForwardCoeffs,extrapolateBackward:e.extrapolateBackward,extrapolateBackwardCoeffs:e.extrapolateBackwardCoeffs},1:null}}};let r={},a={};for(let e of n){let n=t[e].functionChild;1===n.length?(r[e]=n[0].stateValues.numericalf,a[e]=n[0].stateValues.fDefinition):0===Number(e)&&t[e].fShadow?(r[e]=t[e].fShadow,a[e]=t[e].fDefinitionAdapted):(r[e]=()=>0,a[e]={functionType:"zero"})}return{setValue:{fs:r,fDefinitions:a}}}},t.f={isAlias:!0,targetVariableName:"f1"},t.allXCriticalPoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:e}){let t=[];if("bezier"!==e.curveType)return{setValue:{allXCriticalPoints:t}};let n=e.fs[0],r=e.fs[1],a=[],i=!1;for(let[t,n]of e.splineCoeffs.entries()){let e=n[0],r=3*e[3],o=2*e[2],s=e[1];if(Math.abs(r)<1e-14){i=addTimePointBezier({t:-s/o,ind:t,ts:a,ignoreLeft:i})}else{let e=o*o-4*r*s;if(0==e){i=addTimePointBezier({t:-o/(2*r),ind:t,ts:a,ignoreLeft:i})}else if(e>0){let n=Math.sqrt(e),s=[(-o-n)/(2*r),(-o+n)/(2*r)];r<0&&(s=[s[1],s[0]]);let l=!1;for(let e of s){addTimePointBezier({t:e,ind:t,ts:a,ignoreLeft:i})&&(l=!0)}i=l}else i=!1}}for(let e of a)t.push([n(e),r(e)]);return{setValue:{allXCriticalPoints:t}}}},t.nXCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allXCriticalPoints:{dependencyType:"stateVariable",variableName:"allXCriticalPoints"}}),definition:({dependencyValues:e})=>({setValue:{nXCriticalPoints:e.allXCriticalPoints.length}})},t.xCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"xCriticalPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["xCriticalPointX","xCriticalPoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("xCriticalPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("xCriticalPoints"===t)return"xCriticalPoint"+e;if("xCriticalPoint"===t.slice(0,14)){let n=Number(t.slice(14));if(Number.isInteger(n)&&n>0)return`xCriticalPointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nXCriticalPoints:{dependencyType:"stateVariable",variableName:"nXCriticalPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nXCriticalPoints,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allXCriticalPoints:{dependencyType:"stateVariable",variableName:"allXCriticalPoints"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allXCriticalPoints[n][r]}return{setValue:{xCriticalPoints:t}}}},t.allYCriticalPoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:e}){let t=[];if("bezier"!==e.curveType)return{setValue:{allYCriticalPoints:t}};let n=e.fs[0],r=e.fs[1],a=[],i=!1;for(let[t,n]of e.splineCoeffs.entries()){let e=n[1],r=3*e[3],o=2*e[2],s=e[1];if(Math.abs(r)<1e-14){i=addTimePointBezier({t:-s/o,ind:t,ts:a,ignoreLeft:i})}else{let e=o*o-4*r*s;if(0==e){i=addTimePointBezier({t:-o/(2*r),ind:t,ts:a,ignoreLeft:i})}else if(e>0){let n=Math.sqrt(e),s=[(-o-n)/(2*r),(-o+n)/(2*r)];r<0&&(s=[s[1],s[0]]);let l=!1;for(let e of s){addTimePointBezier({t:e,ind:t,ts:a,ignoreLeft:i})&&(l=!0)}i=l}else i=!1}}for(let e of a)t.push([n(e),r(e)]);return{setValue:{allYCriticalPoints:t}}}},t.nYCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allYCriticalPoints:{dependencyType:"stateVariable",variableName:"allYCriticalPoints"}}),definition:({dependencyValues:e})=>({setValue:{nYCriticalPoints:e.allYCriticalPoints.length}})},t.yCriticalPoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"yCriticalPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["yCriticalPointX","yCriticalPoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("yCriticalPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("yCriticalPoints"===t)return"yCriticalPoint"+e;if("yCriticalPoint"===t.slice(0,14)){let n=Number(t.slice(14));if(Number.isInteger(n)&&n>0)return`yCriticalPointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nYCriticalPoints:{dependencyType:"stateVariable",variableName:"nYCriticalPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nYCriticalPoints,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allYCriticalPoints:{dependencyType:"stateVariable",variableName:"allYCriticalPoints"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allYCriticalPoints[n][r]}return{setValue:{yCriticalPoints:t}}}},t.allCurvatureChangePoints={returnDependencies:()=>({splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},fs:{dependencyType:"stateVariable",variableName:"fs"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),definition({dependencyValues:e}){let t=[];if("bezier"!==e.curveType)return{setValue:{allCurvatureChangePoints:t}};let n=e.fs[0],r=e.fs[1],a=[],i=!1;for(let[t,n]of e.splineCoeffs.entries()){let[e,r,o,s]=n[0],[l,u,c,p]=n[1],d=3*(o*p-c*s),m=3*(r*p-u*s),f=r*c-u*o;if(Math.abs(d)<1e-14){i=addTimePointBezier({t:-f/m,ind:t,ts:a,ignoreLeft:i})}else{let e=m*m-4*d*f;if(0==e){i=addTimePointBezier({t:-m/(2*d),ind:t,ts:a,ignoreLeft:i})}else if(e>0){let n=Math.sqrt(e),r=[(-m-n)/(2*d),(-m+n)/(2*d)];d<0&&(r=[r[1],r[0]]);let o=!1;for(let e of r){addTimePointBezier({t:e,ind:t,ts:a,ignoreLeft:i})&&(o=!0)}i=o}else i=!1}}for(let e of a)t.push([n(e),r(e)]);return{setValue:{allCurvatureChangePoints:t}}}},t.nCurvatureChangePoints={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"allCurvatureChangePoints"}}),definition:({dependencyValues:e})=>({setValue:{nCurvatureChangePoints:e.allCurvatureChangePoints.length}})},t.curvatureChangePoints={public:!0,shadowingInstructions:{createComponentOfType:"number",returnWrappingComponents:e=>"curvatureChangePointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["curvatureChangePointX","curvatureChangePoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("curvatureChangePointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("curvatureChangePoints"===t)return"curvatureChangePoint"+e;if("curvatureChangePoint"===t.slice(0,20)){let n=Number(t.slice(20));if(Number.isInteger(n)&&n>0)return`curvatureChangePointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"nCurvatureChangePoints"}}),returnArraySize:({dependencyValues:e})=>[e.nCurvatureChangePoints,2],returnArrayDependenciesByKey:()=>({globalDependencies:{allCurvatureChangePoints:{dependencyType:"stateVariable",variableName:"allCurvatureChangePoints"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)for(let r=0;r<2;r++){t[`${n},${r}`]=e.allCurvatureChangePoints[n][r]}return{setValue:{curvatureChangePoints:t}}}},t.nearestPointAsCurve={returnDependencies:()=>({nearestPointAsCurvePrelim:{dependencyType:"stateVariable",variableName:"nearestPointAsCurvePrelim"},functionChild:{dependencyType:"child",childGroups:["functions"],variableNames:["nearestPointAsCurve"]},adapterSourceValue:{dependencyType:"adapterSourceStateVariable",variableName:"nearestPointAsCurve"}}),definition({dependencyValues:e,usedDefault:t}){let n=e.nearestPointAsCurvePrelim;return t.nearestPointAsCurvePrelim&&(e.functionChild.length>0?n=e.functionChild[0].stateValues.nearestPointAsCurve:null!==e.adapterSourceValue&&(n=e.adapterSourceValue)),{setValue:{nearestPointAsCurve:n}}}},t.nearestPoint={returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},fs:{dependencyType:"stateVariable",variableName:"fs"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"},parMin:{dependencyType:"stateVariable",variableName:"parMin"},parMax:{dependencyType:"stateVariable",variableName:"parMax"},periodic:{dependencyType:"stateVariable",variableName:"periodic"},graphXmin:{dependencyType:"stateVariable",variableName:"graphXmin"},graphXmax:{dependencyType:"stateVariable",variableName:"graphXmax"},graphYmin:{dependencyType:"stateVariable",variableName:"graphYmin"},graphYmax:{dependencyType:"stateVariable",variableName:"graphYmax"},nearestPointAsCurve:{dependencyType:"stateVariable",variableName:"nearestPointAsCurve"}}),definition({dependencyValues:t}){let n=null;return"function"===t.curveType?n=getNearestPointFunctionCurve({dependencyValues:t,numerics:e}):["parameterization","bezier"].includes(t.curveType)&&(n=getNearestPointParametrizedCurve({dependencyValues:t,numerics:e})),{setValue:{nearestPoint:n}}}},t}async moveControlVector({controlVector:e,controlVectorInds:t,transient:n,actionId:r}){let a={[t+",0"]:me$3.fromAst(e[0]),[t+",1"]:me$3.fromAst(e[1])};return n?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:a,sourceInformation:{controlVectorMoved:t}}],transient:n,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:a,sourceInformation:{controlVectorMoved:t}}],actionId:r,event:{verb:"interacted",object:{componentId:this.componentName},result:{["controlVector"+t.join("_")]:e}}})}async moveThroughPoint({throughPoint:e,throughPointInd:t,transient:n,actionId:r}){let a={[t+",0"]:me$3.fromAst(e[0]),[t+",1"]:me$3.fromAst(e[1])};return n?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:a,sourceInformation:{throughPointMoved:t}}],transient:n,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:a,sourceInformation:{throughPointMoved:t}}],actionId:r,event:{verb:"interacted",object:{componentId:this.componentName},result:{["throughPoint"+t]:e}}})}async changeVectorControlDirection({direction:e,throughPointInd:t,actionId:n}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vectorControlDirection",value:{[t]:e}}],actionId:n})}switchCurve(){}}function getNearestPointFunctionCurve({dependencyValues:e,numerics:t}){let n=e.flipFunction,r=e.fs[0],a=e.nDiscretizationPoints,i=e.parMax,o=e.parMin;return function({variables:s,scales:l}){let u,c,p,d,m=s.x1?.evaluate_to_constant(),f=s.x2?.evaluate_to_constant(),h=l[0],y=l[1];if(o!==-1/0&&(n?(u=r(o),c=o):(u=o,c=r(o))),i!==1/0&&(n?(p=r(i),d=i):(p=i,d=r(i))),!e.nearestPointAsCurve||!Number.isFinite(m)||!Number.isFinite(f)){let e,t;if(n?(t=f,e=r(t)):(e=m,t=r(e)),!Number.isFinite(e)||!Number.isFinite(t)){let r,a;n?(r=Math.abs(o-f),a=Math.abs(i-f)):(r=Math.abs(o-m),a=Math.abs(i-m)),r<a||!Number.isFinite(a)?(e=u,t=c):(e=p,t=d)}if(Number.isFinite(e)&&Number.isFinite(t)){let n={x1:e,x2:t};return void 0!==s.x3&&(n.x3=0),n}if(!Number.isFinite(m)||!Number.isFinite(f))return{}}let b=function(e){let t=-10*Math.log(1/e-1),a=m,i=f;return n?(a-=r(t),i-=t):(a-=t,i-=r(t)),a/=h,i/=y,a*a+i*i},g=0,v=1;o!==-1/0&&(g=1/(Math.exp(-o/10)+1)),i!==-1/0&&(v=1/(Math.exp(-i/10)+1));let T,C,N=a,A=(v-g)/N,S=g,w=b(g),x=g,V=g+A;for(let e=1;e<=N;e++){let t=g+e*A,n=b(t);Number.isFinite(n)&&Number.isFinite(T)&&(n<w||Number.isNaN(w))&&(S=t,w=n,x=C,V=e===N?t:t+A),T=n,C=t}let E=b(V);Number.isFinite(E)||(V-=A);let $=t.fminbr(b,[x,V]);S=$.x;let _,O=-10*Math.log(1/S-1),I=r(O);if($.success&&Number.isFinite(O)&&Number.isFinite(I)?(n&&([O,I]=[I,O]),_=Math.pow((O-m)/h,2)+Math.pow((I-f)/y,2)):_=1/0,o!==-1/0){let e=Math.pow((u-m)/h,2)+Math.pow((c-f)/y,2);e<_&&(O=u,I=c,_=e)}if(i!==1/0){let e=Math.pow((p-m)/h,2)+Math.pow((d-f)/y,2);e<_&&(O=p,I=d,_=e)}return $={x1:O,x2:I},void 0!==s.x3&&($.x3=0),$}}function getNearestPointParametrizedCurve({dependencyValues:e,numerics:t}){let n=e.fs,r=e.parMin,a=e.parMax,i=e.nDiscretizationPoints,o=e.periodic;return function({variables:s,scales:l}){let u=l[0],c=l[1];if(2!==e.fs.length)return{};let p=s.x1?.evaluate_to_constant(),d=s.x2?.evaluate_to_constant();if(!Number.isFinite(p)||!Number.isFinite(d))return{};let m,f,h=function(e){let t=(p-n[0](e))/u,r=(d-n[1](e))/c;return t*t+r*r},y=r,b=a,g=i,v=(b-y)/g,T=y,C=h(y),N=y,A=y+v;for(let e=1;e<=g;e++){let t=y+e*v,n=h(t);Number.isFinite(n)&&Number.isFinite(m)&&(n<C||Number.isNaN(C))&&(T=t,C=n,N=f,A=e===g?t:t+v),m=n,f=t}o&&(Math.abs(T-y)<t.eps?N=y-v:Math.abs(T-b)<t.eps&&(A=b+v));let S=t.fminbr(h,[N,A]);T=S.x;let w=n[0](T),x=n[1](T),V=h(T);if(!S.success&&Number.isFinite(w)&&Number.isFinite(x)&&(V=1/0),Number.isFinite(r)){let e=h(r);e<V&&(T=r,w=n[0](T),x=n[1](T),V=e)}if(Number.isFinite(a)){let e=h(a);e<V&&(T=a,w=n[0](T),x=n[1](T),V=e)}return S={x1:w,x2:x},void 0!==s.x3&&(S.x3=0),S}}function calculateControlVectorFromSpline({tau:e,eps:t,point1:n,point2:r,point3:a,splineForm:i}){let o,s,l,u=function(e,t){let n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)};if(!r)return{coordsNumeric:[me$3.fromAst(NaN),me$3.fromAst(NaN)],numericEntries:!1};if(s=r.map((e=>e.evaluate_to_constant())),a)l=a.map((e=>e.evaluate_to_constant())),o=n?n.map((e=>e.evaluate_to_constant())):[2*s[0]-l[0],2*s[1]-l[1]];else{if(!n)return{coordsNumeric:[me$3.fromAst(NaN),me$3.fromAst(NaN)],numericEntries:!1};o=n.map((e=>e.evaluate_to_constant())),l=[2*s[0]-o[0],2*s[1]-o[1]]}let c=[];if("centripetal"===i){let n=u(o,s),r=u(s,l);n=Math.sqrt(n),r=Math.sqrt(r),r<t&&(r=1),n<t&&(n=r);for(let t=0;t<2;t++){let a=(s[t]-o[t])/n-(l[t]-o[t])/(r+n)+(l[t]-s[t])/r;a*=e*Math.sqrt(n*r),c.push(-a/3)}}else for(let t=0;t<2;t++)c.push(-e*(l[t]-o[t])/3);let p=c.map((e=>me$3.fromAst(e)));return{coordsNumeric:p,numericEntries:Number.isFinite(c[0])&&Number.isFinite(c[1])}}function initCubicPoly(e,t,n,r){return[e,n,-3*e+3*t-2*n-r,2*e-2*t+n+r]}function addTimePointBezier({t:e,ind:t,ts:n,ignoreLeft:r=!1}){const a=1e-14;let i=!1;return e>=a?e<=.99999999999999?n.push(t+e):e<1.00000000000001&&(n.push(t+1),i=!0):e>-a&&!r&&n.push(t),i}class EquilibriumCurve extends Curve{static componentType="equilibriumCurve";static rendererType="curve";static createAttributesObject(){let e=super.createAttributesObject();return e.stable={createComponentOfType:"boolean",createStateVariable:"stable",defaultValue:!0,public:!0},e.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.dashed={forRenderer:!0,returnDependencies:()=>({stable:{dependencyType:"stateVariable",variableName:"stable"}}),definition:({dependencyValues:e})=>({setValue:{dashed:!e.stable}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"stable",desiredValue:!e.dashed}]})},t}async switchCurve({actionId:e}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"stable",value:!this.stateValues.stable}],actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{stable:!this.stateValues.stable}}});this.coreFunctions.resolveAction({actionId:e})}}var DynamicalSystems=Object.freeze({__proto__:null,ODESystem:ODESystem,CobwebPolyline:CobwebPolyline,EquilibriumPoint:EquilibriumPoint,EquilibriumLine:EquilibriumLine,EquilibriumCurve:EquilibriumCurve});class Atom extends InlineComponent{static componentType="atom";static rendererType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.symbol={createComponentOfType:"text"},e.atomicNumber={createComponentOfType:"integer"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.dataForAtom={returnDependencies:()=>({fileContents:{dependencyType:"file",cid:"bafkreifow4gfnfdgxu44ahkx565dt7rb75vhollgt3nbcdfwwksyzw53ry",fileType:"csv"},symbolAttr:{dependencyType:"attributeComponent",attributeName:"symbol",variableNames:["value"]},atomicNumberAttr:{dependencyType:"attributeComponent",attributeName:"atomicNumber",variableNames:["value"]}}),definition:function({dependencyValues:e}){let t=null,n=null;if(e.symbolAttr)t=e.symbolAttr.stateValues.value.toLowerCase();else{if(!e.atomicNumberAttr)return{setValue:{dataForAtom:null}};n=e.atomicNumberAttr.stateValues.value}let r,a=e.fileContents.trim().split("\n");r=null!==n?n-1:["h","he","li","be","b","c","n","o","f","ne","na","mg","al","si","p","s","cl","ar","k","ca","sc","ti","v","cr","mn","fe","co","ni","cu","zn","ga","ge","as","se","br","kr","rb","sr","y","zr","nb","mo","tc","ru","rh","pd","ag","cd","in","sn","sb","te","i","xe","cs","ba","la","ce","pr","nd","pm","sm","eu","gd","tb","dy","ho","er","tm","yb","lu","hf","ta","w","re","os","ir","pt","au","hg","tl","pb","bi","po","at","rn","fr","ra","ac","th","pa","u","np","pu","am","cm","bk","cf","es","fm","md","no","lr","rf","db","sg","bh","hs","mt","ds","rg","cn","nh","fl","mc","lv","ts","og"].indexOf(t.toLowerCase());let i=a.slice(1)[r];if(!i)return{setValue:{dataForAtom:null}};i=i.trim().split(",").map((e=>e.trim()));let o=a[0].trim().split(",").map((e=>e.trim())).map((e=>(['"',"'"].includes(e[0])&&e[e.length-1]===e[0]&&(e=e.substring(1,e.length-1).trim()),e))),s=o.length,l=["number","string","string","number","number","string","number","number","number","number","number","number","number","string"],u={};for(let e=0;e<s;e++){let t,n=o[e];"number"===l[e]?t=Number(i[e]):(t=i[e],['"',"'"].includes(t[0])&&t[t.length-1]===t[0]&&(t=t.substring(1,t.length-1))),u[n]="Electron Configuration"===n?me$3.fromText(t):t}return{setValue:{dataForAtom:u}}}},e.atomicNumber={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Atomic Number"]:null,{setValue:{atomicNumber:t}}}},e.symbol={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Symbol:null,{setValue:{symbol:t}}}},e.name={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Name:null,{setValue:{name:t}}}},e.group={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Group:null,{setValue:{group:t}}}},e.atomicMass={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Atomic Mass"]:null,{setValue:{atomicMass:t}}}},e.phaseAtSTP={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Phase at STP"]:null,{setValue:{phaseAtSTP:t}}}},e.period={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Period:null,{setValue:{period:t}}}},e.ionizationEnergy={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Ionization Energy"]:null,{setValue:{ionizationEnergy:t}}}},e.meltingPoint={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Melting Point"]:null,{setValue:{meltingPoint:t}}}},e.boilingPoint={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Boiling Point"]:null,{setValue:{boilingPoint:t}}}},e.atomicRadius={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Atomic Radius"]:null,{setValue:{atomicRadius:t}}}},e.density={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Density:null,{setValue:{density:t}}}},e.electronegativity={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom.Electronegativity:null,{setValue:{electronegativity:t}}}},e.electronConfiguration={public:!0,shadowingInstructions:{createComponentOfType:"electronConfiguration"},returnDependencies:()=>({dataForAtom:{dependencyType:"stateVariable",variableName:"dataForAtom"}}),definition({dependencyValues:e}){let t;return t=e.dataForAtom?e.dataForAtom["Electron Configuration"]:null,{setValue:{electronConfiguration:t}}}},e.orbitalDiagram={public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},returnDependencies:()=>({electronConfiguration:{dependencyType:"stateVariable",variableName:"electronConfiguration"}}),definition({dependencyValues:e}){let t;return t=e.electronConfiguration?electronConfigurationToOrbitalDiagram(e.electronConfiguration):null,{setValue:{orbitalDiagram:t}}}},e.latex={additionalStateVariablesDefined:[{variableName:"latexWithInputChildren",forRenderer:!0}],returnDependencies:()=>({symbol:{dependencyType:"stateVariable",variableName:"symbol"}}),definition({dependencyValues:e}){let t;return t=e.symbol?`\\text{${e.symbol}}`:"[Invalid Chemical Symbol]",{setValue:{latex:t,latexWithInputChildren:[t]}}}},e}}function electronConfigurationToOrbitalDiagram(e){let t=e.tree;if(!Array.isArray(t)||"*"!==t[0])return null;t=t.slice(1);let n=t.length/2;if(!Number.isInteger(n))return null;let r=[];for(let e=0;e<n;e++){let n=t[2*e];if(!(Number.isInteger(n)&&n>0))return null;let a=t[2*e+1];if(!Array.isArray(a)||"^"!==a[0])return null;let i=a[1],o=a[2];if(!(["s","p","d","f"].includes(i)&&Number.isInteger(o)&&o>0))return null;let s,l=`${n}${i}`;s="s"===i?1:"p"===i?3:"d"===i?5:7;let u=Array(s).fill("");for(let e=0;e<Math.min(s,o);e++)u[e]=o<=e+s?"U":"UD";r.push({orbitalText:l,boxes:u})}return r}class ElectronConfiguration extends MathComponent{static componentType="electronConfiguration";static rendererType="math";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e,usedDefault:t}){let n;try{n=e.valueForDisplay.toLatex()}catch(e){n=""}return n=n.replaceAll("\\,",""),n=n.replaceAll("\\cdot","~"),{setValue:{latex:n}}}},e}}var Chemistry=Object.freeze({__proto__:null,Atom:Atom,ElectronConfiguration:ElectronConfiguration});class FeedbackDefinition extends BaseComponent{static componentType="feedbackDefinition";static createAttributesObject(){let e=super.createAttributesObject();return e.code={createComponentOfType:"text"},e.text={createComponentOfType:"text"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.feedbackDefinition={returnDependencies:()=>({codeAttr:{dependencyType:"attributeComponent",attributeName:"code",variableNames:["value"]},textAttr:{dependencyType:"attributeComponent",attributeName:"text",variableNames:["value"]}}),definition({dependencyValues:e}){if(null!==e.codeAttr&&null!==e.textAttr){return{setValue:{feedbackDefinition:{[e.codeAttr.stateValues.value.toLowerCase()]:e.textAttr.stateValues.value}}}}return{setValue:{feedbackDefinition:null}}}},e}}class FeedbackDefinitions extends BaseComponent{static componentType="feedbackDefinitions";static rendererType=void 0;static returnChildGroups(){return[{group:"feedbackDefinition",componentTypes:["feedbackDefinition"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={returnDependencies:()=>({feedbackDefinitionChildren:{dependencyType:"child",childGroups:["feedbackDefinition"],variableNames:["feedbackDefinition"]}}),definition({dependencyValues:e}){let t={};for(let n of e.feedbackDefinitionChildren)n.stateValues.feedbackDefinition&&Object.assign(t,n.stateValues.feedbackDefinition);return{setValue:{value:t}}}},e}}var FeedbackDefinitions$1=Object.freeze({__proto__:null,FeedbackDefinition:FeedbackDefinition,FeedbackDefinitions:FeedbackDefinitions});class StyleDefinition extends BaseComponent{static componentType="styleDefinition";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();e.styleNumber={createPrimitiveOfType:"number",createStateVariable:"styleNumber",defaultValue:1};for(let t in styleAttributes)e[t]={createComponentOfType:styleAttributes[t].componentType};return e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDefinition={returnDependencies:function(){let e={};for(let t in styleAttributes)e[t]={dependencyType:"attributeComponent",attributeName:t,variableNames:["value"]};return e},definition:function({dependencyValues:e}){let t={};for(let n in styleAttributes)null!==e[n]&&(t[n]=e[n].stateValues.value,"string"==typeof t[n]&&(t[n]=t[n].toLowerCase()));return{setValue:{styleDefinition:t}}}},e}}class StyleDefinitions extends BaseComponent{static componentType="styleDefinitions";static rendererType=void 0;static returnChildGroups(){return[{group:"styleDefinition",componentTypes:["styleDefinition"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={returnDependencies:()=>({styleDefinitionChildren:{dependencyType:"child",childGroups:["styleDefinition"],variableNames:["styleNumber","styleDefinition"]}}),definition({dependencyValues:e}){let t={};for(let n of e.styleDefinitionChildren){let e=n.stateValues.styleNumber,r=t[e];r||(r=t[e]={}),Object.assign(r,n.stateValues.styleDefinition)}return{setValue:{value:t}}}},e}}var StyleDefinitions$1=Object.freeze({__proto__:null,StyleDefinition:StyleDefinition,StyleDefinitions:StyleDefinitions});function returnGroupIntoComponentTypeSeparatedBySpaces({componentType:e,forceComponentType:t=!1}){return function({matchedChildren:n,componentInfoObjects:r}){let a=[],i=[];function o(){let n=!1;if(t){if(1===i.length){let t=i[0],o=t.componentType;"copy"===o&&t.attributes?.createComponentOfType&&(t.attributes.nComponents&&1!==t.attributes.nComponents.primitive||(o=t.attributes.createComponentOfType.primitive)),r.isInheritedComponentType({inheritedComponentType:o,baseComponentType:e})&&(a.push(t),n=!0)}}else 1===i.length&&"string"!=typeof i[0]&&(a.push(i[0]),n=!0);!n&&i.length>0&&a.push({componentType:e,children:i}),i=[]}for(let e of n)if("string"!=typeof e)i.push(e);else{let t=e.split(/\s+/),n=t[0];""===n?o():i.push(n);for(let e of t.slice(1))o(),""!==e&&i.push(e)}return o(),{success:!0,newChildren:a}}}function returnBreakStringsIntoComponentTypeBySpaces({componentType:e}){return function({matchedChildren:t}){let n=t.reduce((function(t,n){return"string"==typeof n?[...t,...n.split(/\s+/).filter((e=>e)).map((t=>({componentType:e,children:[t]})))]:[...t,n]}),[]);return{success:!0,newChildren:n}}}class ComponentWithSelectableType extends BaseComponent{static componentType="_componentWithSelectableType";static rendererType=void 0;static includeBlankStringChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.type={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t,parentAttributes:n}){let r=t.type;r||(r=n.type),r?["number","letters","math","text","boolean"].includes(r)||(console.warn(`Invalid type ${r}, setting type to number`),r="number"):r="number";let a="letters"===r?"text":r;return"text"!==a&&(e=e.filter((e=>"string"!=typeof e||""!==e.trim()))),{success:!0,newChildren:[{componentType:a,children:e}]}}}),e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.type={shadowVariable:!0,returnDependencies:()=>({type:{dependencyType:"doenetAttribute",attributeName:"type"},parentType:{dependencyType:"parentStateVariable",variableName:"type"}}),definition:function({dependencyValues:e,componentName:t}){let n=e.type;return n||(n=e.parentType),n?["number","letters","math","text","boolean"].includes(n)||(console.warn(`Invalid type ${n}, setting type to number`),n="number"):n="number",{setValue:{type:n}}}},e.value={public:!0,shadowingInstructions:{hasVariableComponentType:!0},shadowVariable:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},atMostOneChild:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition({dependencyValues:e}){let t;return t=e.atMostOneChild.length>0?e.atMostOneChild[0].stateValues.value:"text"===e.type||"letters"===e.type?"":"boolean"!==e.type&&("number"===e.type?NaN:me$3.fromAst("")),{setValue:{value:t},setCreateComponentOfType:{value:e.type}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.atMostOneChild.length>0?{success:!0,instructions:[{setDependency:"atMostOneChild",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!1}},e}}class ComponentListWithSelectableType extends ComponentWithSelectableType{static componentType="_componentListWithSelectableType";static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.type={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t,parentAttributes:n,isAttributeComponent:r=!1,createdFromMacro:a=!1,componentInfoObjects:i}){let o=t.type;o||(o=n.type),o?["number","letters","math","text","boolean"].includes(o)||(console.warn(`Invalid type ${o}, setting type to number`),o="number"):o="number";let s="letters"===o?"text":o;if(r&&!a){return returnGroupIntoComponentTypeSeparatedBySpaces({componentType:s})({matchedChildren:e})}return returnBreakStringsIntoComponentTypeBySpaces({componentType:s})({matchedChildren:e})}}),e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.value,e.nValues={additionalStateVariablesDefined:["childForValue"],returnDependencies:()=>({anythingForSelectedType:{dependencyType:"child",childGroups:["anything"],variableNames:["nValues"],variablesOptional:!0}}),definition({dependencyValues:e}){let t=0,n=[];for(let[r,a]of e.anythingForSelectedType.entries()){let e=Number.isInteger(a.stateValues.nValues)?a.stateValues.nValues:1;t+=e;for(let t=0;t<e;t++)n.push({child:r,valueIndex:t})}return{setValue:{nValues:t,childForValue:n}}}},e.values={public:!0,isArray:!0,shadowingInstructions:{hasVariableComponentType:!0},entryPrefixes:["value"],stateVariablesDeterminingDependencies:["childForValue"],returnArraySizeDependencies:()=>({nValues:{dependencyType:"stateVariable",variableName:"nValues"}}),returnArraySize:({dependencyValues:e})=>[e.nValues],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=t.childForValue[r];n[r]={anythingForSelectedType:{dependencyType:"child",childGroups:["anything"],variableNames:["value","values"],childIndices:[e.child],variablesOptional:!0},valueIndex:{dependencyType:"value",value:e.valueIndex}}}return{globalDependencies:{type:{dependencyType:"stateVariable",variableName:"type"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,componentName:r}){let a={};for(let r of n)if(t[r].anythingForSelectedType&&1===t[r].anythingForSelectedType.length){let n,i=t[r].anythingForSelectedType[0];n=i.stateValues.values?i.stateValues.values[t[r].valueIndex]:i.stateValues.value,a[r]=convertValueToType(n,e.type)}return{setValue:{values:a},setCreateComponentOfType:{values:e.type}}}},e}}class ComponentListOfListsWithSelectableType extends ComponentWithSelectableType{static componentType="_componentListOfListsWithSelectableType";static createAttributesObject(){let e=super.createAttributesObject();return e.type={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t,parentAttributes:n}){let r=breakEmbeddedStringsIntoParensPieces({componentList:e,removeParens:!0});if(!0!==r.success)return{success:!1};let a=t.type;return a||(a=n.type),a?["number","letters","math","text","boolean"].includes(a)||(console.warn(`Invalid type ${a}, setting type to number`),a="number"):a="number",{success:!0,newChildren:r.pieces.map((e=>({componentType:"_componentListWithSelectableType",attributes:{type:{primitive:a}},children:e})))}}}),e}static returnChildGroups(){return[{group:"lists",componentTypes:["_componentListWithSelectableType"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.value,e.nLists={returnDependencies:()=>({listChildren:{dependencyType:"child",childGroups:["lists"]}}),definition:({dependencyValues:e})=>({setValue:{nLists:e.listChildren.length}})},e.lists={isArray:!0,entryPrefixes:["list"],returnArraySizeDependencies:()=>({nLists:{dependencyType:"stateVariable",variableName:"nLists"}}),returnArraySize:({dependencyValues:e})=>[e.nLists],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={listChildren:{dependencyType:"child",childGroups:["lists"],variableNames:["values","type"],childIndices:[n]}};return{globalDependencies:{type:{dependencyType:"stateVariable",variableName:"type"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n)if(t[a].listChildren&&1===t[a].listChildren.length){let n=t[a].listChildren[0];n.stateValues.type===e.type?r[a]=n.stateValues.values:r[a]=n.stateValues.values.map((t=>convertValueToType(t,e.type)))}return{setValue:{lists:r}}}},e}}function convertValueToType(e,t){if(Array.isArray(e)&&(e=e[0]),"number"===t){if(e instanceof me$3.class){let t=e.evaluate_to_constant();return Number.isFinite(t)||(t=NaN),t}return Number(e)}if("math"===t){if("string"==typeof e)try{return me$3.fromAst(textToAst$1.convert(e))}catch(e){}return convertValueToMathExpression(e)}return"boolean"===t?Boolean(e):String(e)}var ComponentWithSelectableType$1=Object.freeze({__proto__:null,ComponentWithSelectableType:ComponentWithSelectableType,ComponentListWithSelectableType:ComponentListWithSelectableType,ComponentListOfListsWithSelectableType:ComponentListOfListsWithSelectableType});class SideBySide extends BlockComponent{static componentType="sideBySide";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize"},e.widths={createComponentOfType:"_componentSizeList"},e.margins={createComponentOfType:"_componentSizeList"},e.valign={createComponentOfType:"text"},e.valigns={createComponentOfType:"textList"},e}static returnChildGroups(){return[{group:"blocks",componentTypes:["_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nPanels={forRenderer:!0,returnDependencies:()=>({blockChildren:{dependencyType:"child",childGroups:["blocks"],skipComponentNames:!0}}),definition:({dependencyValues:e})=>({setValue:{nPanels:e.blockChildren.length},checkForActualChange:{nPanels:!0}})},e.essentialWidths={isArray:!0,entryPrefixes:["essentialWidth"],defaultValueByArrayKey:()=>null,hasEssential:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize:({dependencyValues:e})=>[e.nPanels],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialWidths:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t={};for(let n in e.essentialWidths)t[n]=e.essentialWidths[n];return{success:!0,instructions:[{setEssentialValue:"essentialWidths",value:t}]}}},e.allWidthsSpecified={additionalStateVariablesDefined:["widthsAbsolute"],returnDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents","componentSizes"]},parentWidths:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"specifiedWidths"},parentWidthsAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"widthsAbsolute"},essentialWidth:{dependencyType:"stateVariable",variableName:"essentialWidths"}}),definition({dependencyValues:e}){let t,n=[],r=null,a=!1;null!==e.widthsAttr?t=e.widthsAttr.stateValues.nComponents:null!==e.widthAttr?(t=e.nPanels,a=!0):t=0;for(let i=0;i<e.nPanels;i++){let o=null;if(i<t?a?e.widthAttr.stateValues.componentSize?(n[i]=e.widthAttr.stateValues.componentSize.size,o=Boolean(e.widthAttr.stateValues.componentSize.isAbsolute)):n[i]=null:e.widthsAttr.stateValues.componentSizes[i]?(n[i]=e.widthsAttr.stateValues.componentSizes[i].size,o=Boolean(e.widthsAttr.stateValues.componentSizes[i].isAbsolute)):n[i]=null:e.parentWidths?(null===e.essentialWidth[i]?n[i]=e.parentWidths[i]:n[i]=e.essentialWidth[i],o=e.parentWidthsAbsolute):n[i]=e.essentialWidth[i],null===r)r=o;else if(null!==o&&r!==o)throw Error("SideBySide is not implemented for absolute measurements")}return n=n.map((e=>Number.isFinite(e)?e:null)),{setValue:{allWidthsSpecified:n,widthsAbsolute:r}}}},e.essentialMargins={isArray:!0,entryPrefixes:["essentialMargin"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialMargins:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t={};for(let n in e.essentialMargins)t[n]=e.essentialMargins[n];return{success:!0,instructions:[{setEssentialValue:"essentialMargins",value:t}]}}},e.allMarginsSpecified={additionalStateVariablesDefined:["marginsAbsolute"],returnDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["nComponents","componentSizes"]},parentMargins:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"specifiedMargins"},parentMarginsAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:"marginsAbsolute"},essentialMargins:{dependencyType:"stateVariable",variableName:"essentialMargins"}}),definition({dependencyValues:e}){let t=[],n=null;if(null===e.marginsAttr)if(e.parentMargins){n=e.parentMarginsAbsolute;for(let n=0;n<2;n++)null===e.essentialMargins[n]?t[n]=e.parentMargins[n]:t[n]=e.essentialMargins[n]}else for(let n=0;n<2;n++)t[n]=e.essentialMargins[n];else if(0===e.marginsAttr.stateValues.nComponents)for(let n=0;n<2;n++)t[n]=e.essentialMargins[n];else if(1===e.marginsAttr.stateValues.nComponents){let r=null;e.marginsAttr.stateValues.componentSizes[0]&&(r=e.marginsAttr.stateValues.componentSizes[0].size,Number.isFinite(r)||(r=null),n=Boolean(e.marginsAttr.stateValues.componentSizes[0].isAbsolute)),t=[r,r]}else{let r;if(n=!!e.marginsAttr.stateValues.componentSizes[0]&&Boolean(e.marginsAttr.stateValues.componentSizes[0].isAbsolute),r=!!e.marginsAttr.stateValues.componentSizes[1]&&Boolean(e.marginsAttr.stateValues.componentSizes[1].isAbsolute),r!==n)throw Error("SideBySide is not implemented for absolute measurements");t=e.marginsAttr.stateValues.componentSizes.slice(0,2).map((e=>e&&Number.isFinite(e.size)?e.size:null))}return{setValue:{allMarginsSpecified:t,marginsAbsolute:n}}}},e.absoluteMeasurements={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({widthsAbsolute:{dependencyType:"stateVariable",variableName:"widthsAbsolute"},marginsAbsolute:{dependencyType:"stateVariable",variableName:"marginsAbsolute"}}),definition({dependencyValues:e}){let t;if(null===e.widthsAbsolute)t=null!==e.marginsAbsolute&&e.marginsAbsolute;else if(null===e.marginsAbsolute)t=e.widthsAbsolute;else{if(e.widthsAbsolute!==e.marginsAbsolute)throw Error("SideBySide is not implemented for absolute measurements");t=e.widthsAbsolute}if(!0===t)throw Error("SideBySide is not implemented for absolute measurements");return{setValue:{absoluteMeasurements:t}}}},e.allWidths={additionalStateVariablesDefined:["allMargins",{variableName:"gapWidth",public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0}],returnDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"},allWidthsSpecified:{dependencyType:"stateVariable",variableName:"allWidthsSpecified"},allMarginsSpecified:{dependencyType:"stateVariable",variableName:"allMarginsSpecified"},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}}),definition({dependencyValues:e}){let t=0,n=[...e.allWidthsSpecified],r=[...e.allMarginsSpecified],a=0,i=0;for(let t=0;t<e.nPanels;t++){let e=n[t];null===e?i++:a+=e}let o=0,s=0;for(let e=0;e<2;e++){let t=r[e];null===t?s++:o+=t}if(o*=e.nPanels,!e.absoluteMeasurements)if(a+o>=100){let t=100/(a+o);for(let r=0;r<e.nPanels;r++)null===n[r]?n[r]=0:n[r]*=t;for(let e=0;e<2;e++){null===r[e]?r[e]=0:r[e]*=t}}else if(i>0){let t=(100-(a+o))/i;for(let r=0;r<e.nPanels;r++)null===n[r]&&(n[r]=t);for(let e=0;e<2;e++){null===r[e]&&(r[e]=0)}}else if(s>0){let t=(100-(a+o))/(s*e.nPanels);for(let e=0;e<2;e++)null===r[e]&&(r[e]=t)}else e.nPanels>1?t=(100-(a+o))/(e.nPanels-1):1===e.nPanels?r[1]=100-(r[0]+n[0]):console.warn("Invalid sideBySide, as it must have at least one block child");return{setValue:{allWidths:n,allMargins:r,gapWidth:t}}}},e.widths={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["width"],forRenderer:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize:({dependencyValues:e})=>[e.nPanels],returnArrayDependenciesByKey({arrayKeys:e}){let t={allWidths:{dependencyType:"stateVariable",variableName:"allWidths"},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents"]},widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}},n={};for(let t of e){let e=Number(t)+1;n[t]={widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:[`componentSize${e}`]},essentialWidth:{dependencyType:"stateVariable",variableName:`essentialWidth${e}`}}}return{globalDependencies:t,dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e.allWidths[r];return{setValue:{widths:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n,globalDependencyValues:r,arraySize:a}){let i,o=!1;null!==r.widthsAttr?i=r.widthsAttr.stateValues.nComponents:null!==r.widthAttr?(i=a[0],o=!0):i=0;let s=[];for(let n in e.widths){Number(n)<i?o?s.push({setDependency:"widthAttr",desiredValue:{size:e.widths[n],isAbsolute:r.absoluteMeasurements},variableIndex:0}):s.push({setDependency:t[n].widthsAttr,desiredValue:{size:e.widths[n],isAbsolute:r.absoluteMeasurements},variableIndex:0}):s.push({setDependency:t[n].essentialWidth,desiredValue:e.widths[n]})}return{success:!0,instructions:s}}},e.margins={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["margin"],forRenderer:!0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={allMargins:{dependencyType:"stateVariable",variableName:"allMargins"},marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["componentSize1","componentSize2","nComponents"]},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}},n={};for(let t of e){let e=Number(t)+1;n[t]={essentialMargin:{dependencyType:"stateVariable",variableName:`essentialMargin${e}`}}}return{globalDependencies:t,dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e.allMargins[r];return{setValue:{margins:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyNamesByKey:n}){let r=[];if(null===t.marginsAttr)for(let t in e.margins)r.push({setDependency:n[t].essentialMargin,desiredValue:e.margins[t]});else if(t.marginsAttr.stateValues.componentSize1&&Number.isFinite(t.marginsAttr.stateValues.componentSize1.size)){let n=1===t.marginsAttr.stateValues.nComponents;for(let a in e.margins)n?r.push({setDependency:"marginsAttr",desiredValue:{size:e.margins[a],isAbsolute:t.absoluteMeasurements},variableIndex:0}):r.push({setDependency:"marginsAttr",desiredValue:{size:e.margins[a],isAbsolute:t.absoluteMeasurements},variableIndex:a})}else"0"in e.margins?r.push({setDependency:"marginsAttr",desiredValue:{size:e.margins[0],isAbsolute:t.absoluteMeasurements},variableIndex:0}):r.push({setDependency:"marginsAttr",desiredValue:{size:e.margins[1],isAbsolute:t.absoluteMeasurements},variableIndex:0}),"1"in e.margins&&t.marginsAttr.stateValues.nComponents>1&&r.push({setDependency:"marginsAttr",desiredValue:{size:e.margins[1],isAbsolute:t.absoluteMeasurements},variableIndex:1});return{success:!0,instructions:r}}},e.essentialValigns={isArray:!0,entryPrefixes:["essentialValign"],defaultValueByArrayKey:()=>null,hasEssential:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize:({dependencyValues:e})=>[e.nPanels],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialValigns:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t={};for(let n in e.essentialValigns)t[n]=e.essentialValigns[n];return{success:!0,instructions:[{setEssentialValue:"essentialValigns",value:t}]}}},e.valigns={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"text"},entryPrefixes:["valign"],forRenderer:!0,returnArraySizeDependencies:()=>({nPanels:{dependencyType:"stateVariable",variableName:"nPanels"}}),returnArraySize:({dependencyValues:e})=>[e.nPanels],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:[`text${e}`]},parentValign:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:`valign${e}`},parentValignAbsolute:{dependencyType:"parentStateVariable",parentComponentType:"sbsGroup",variableName:`valignAbsolute${e}`},essentialValign:{dependencyType:"stateVariable",variableName:`essentialValign${e}`}}}return{globalDependencies:{valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:["nComponents"]}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,arraySize:r}){let a,i={},o=!1;null!==e.valignsAttr?a=e.valignsAttr.stateValues.nComponents:null!==e.valignAttr?(a=r[0],o=!0):a=0;for(let r of n){let n=Number(r);if(n<a){if(o)i[r]=e.valignAttr.stateValues.value.toLowerCase();else{let e=n+1;i[r]=t[r].valignsAttr.stateValues[`text${e}`].toLowerCase()}["top","middle","bottom"].includes(i[r])||(i[r]="top")}else t[r].parentValign?null===t[r].essentialValign?i[r]=t[r].parentValign:i[r]=t[r].essentialValign:null===t[r].essentialValign?i[r]="top":i[r]=t[r].essentialValign}return{setValue:{valigns:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,globalDependencyValues:n,arraySize:r}){let a,i=!1;null!==n.valignsAttr?a=n.valignsAttr.stateValues.nComponents:null!==n.valignAttr?(a=r[0],i=!0):a=0;let o=[];for(let n in e.valigns){let r=e.valigns[n].toLowerCase();["top","middle","bottom"].includes(r)&&(Number(n)<a?i?o.push({setDependency:"valignAttr",desiredValue:r,variableIndex:0}):o.push({setDependency:t[n].valignsAttr,desiredValue:r,variableIndex:0}):o.push({setDependency:t[n].essentialValign,desiredValue:r}))}return{success:!0,instructions:o}}},e}}class SbsGroup extends BlockComponent{static componentType="sbsGroup";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize"},e.widths={createComponentOfType:"_componentSizeList"},e.margins={createComponentOfType:"_componentSizeList"},e.valign={createComponentOfType:"text"},e.valigns={createComponentOfType:"textList"},e}static returnChildGroups(){return[{group:"sideBySides",componentTypes:["sideBySide"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.maxNPanelsPerRow={returnDependencies:()=>({sideBySideChildren:{dependencyType:"child",childGroups:["sideBySides"],variableNames:["nPanels"]}}),definition:({dependencyValues:e})=>({setValue:{maxNPanelsPerRow:me$3.math.max(e.sideBySideChildren.map((e=>e.stateValues.nPanels)))},checkForActualChange:{maxNPanelsPerRow:!0}})},e.specifiedWidths={additionalStateVariablesDefined:[{variableName:"widthsAbsoluteArray",isArray:!0}],isArray:!0,entryPrefixes:["specifiedWidth"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize:({dependencyValues:e})=>[e.maxNPanelsPerRow],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:[`componentSize${e}`]}}}return{globalDependencies:{widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},widthsAttr:{dependencyType:"attributeComponent",attributeName:"widths",variableNames:["nComponents"]}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,arraySize:r}){let a,i={},o={},s={},l=!1;null!==e.widthsAttr?a=e.widthsAttr.stateValues.nComponents:null!==e.widthAttr?(a=r[0],l=!0):a=0;for(let r of n){let n=Number(r);if(n<a)if(l)e.widthAttr.stateValues.componentSize&&(i[r]=e.widthAttr.stateValues.componentSize.size,s[r]=e.widthAttr.stateValues.componentSize.isAbsolute);else{let e=n+1,a=t[r].widthsAttr.stateValues[`componentSize${e}`];a&&(i[r]=a.size,s[r]=a.isAbsolute)}else o[r]=!0,s[r]=null}let u={setValue:{widthsAbsoluteArray:s,specifiedWidths:i}};return Object.keys(o).length>0&&(u.useEssentialOrDefaultValue={specifiedWidths:o}),u},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,globalDependencyValues:n,stateValues:r,arraySize:a}){let i,o=!1;null!==n.widthsAttr?i=n.widthsAttr.stateValues.nComponents:null!==n.widthAttr?(i=a[0],o=!0):i=0;let s=[];for(let n in e.specifiedWidths){Number(n)<i?o?s.push({setDependency:"widthAttr",desiredValue:{size:e.specifiedWidths[n],isAbsolute:r.widthsAbsolute},variableIndex:0}):s.push({setDependency:t[n].widthsAttr,desiredValue:{size:e.specifiedWidths[n],isAbsolute:r.widthsAbsolute},variableIndex:0}):s.push({setEssentialValue:"specifiedWidths",value:{[n]:e.specifiedWidths[n]}})}return{success:!0,instructions:s}}},e.widthsAbsolute={returnDependencies:()=>({widthsAbsoluteArray:{dependencyType:"stateVariable",variableName:"widthsAbsoluteArray"}}),definition({dependencyValues:e}){let t=null;for(let n in e.widthsAbsoluteArray){let r=e.widthsAbsoluteArray[n];if(null!==r)if(r=Boolean(r),null===t)t=r;else if(t!==r)throw Error("SbsGroup is not implemented for absolute measurements")}return{setValue:{widthsAbsolute:t}}}},e.specifiedMargins={additionalStateVariablesDefined:[{variableName:"marginsAbsoluteArray",isArray:!0,entryPrefixes:["marginAbsolute"]}],isArray:!0,entryPrefixes:["specifiedMargin"],hasEssential:!0,defaultValueByArrayKey:()=>null,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey:({arrayKeys:e})=>({globalDependencies:{marginsAttr:{dependencyType:"attributeComponent",attributeName:"margins",variableNames:["componentSize1","componentSize2","nComponents"]}}}),arrayDefinitionByKey({dependencyValuesByKey:e,globalDependencyValues:t,arrayKeys:n}){let r={},a={},i={};if(null===t.marginsAttr||0===t.marginsAttr.stateValues.nComponents)for(let e of n)a[e]=!0,i[e]=null;else if(1===t.marginsAttr.stateValues.nComponents){let e=null,a=null;t.marginsAttr.stateValues.componentSize1&&(e=t.marginsAttr.stateValues.componentSize1.size,Number.isFinite(e)||(e=null),a=Boolean(t.marginsAttr.stateValues.componentSize1.isAbsolute));for(let t of n)r[t]=e,i[t]=a}else for(let e of n)if(t.marginsAttr.stateValues[`componentSize${Number(e)+1}`]){let n=t.marginsAttr.stateValues[`componentSize${Number(e)+1}`].size;Number.isFinite(n)||(n=null);let a=Boolean(t.marginsAttr.stateValues[`componentSize${Number(e)+1}`].isAbsolute);r[e]=n,i[e]=a}let o={setValue:{marginsAbsoluteArray:i,specifiedMargins:r}};return Object.keys(a).length>0&&(o.useEssentialOrDefaultValue={specifiedMargins:a}),o},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,globalDependencyValues:n,stateValues:r}){let a=[];if(null===n.marginsAttr)a.push({setEssentialValue:"specifiedMargins",value:e.specifiedMargins});else if(n.marginsAttr.stateValues.componentSize1&&Number.isFinite(n.marginsAttr.stateValues.componentSize1.size)){let t=1===n.marginsAttr.stateValues.nComponents;for(let n in e.specifiedMargins)t?a.push({setDependency:"marginsAttr",desiredValue:{size:e.specifiedMargins[n],isAbsolute:await r.marginsAbsolute},variableIndex:0}):a.push({setDependency:"marginsAttr",desiredValue:{size:e.specifiedMargins[n],isAbsolute:await r.marginsAbsolute},variableIndex:n})}else"0"in e.specifiedMargins?a.push({setDependency:"marginsAttr",desiredValue:{size:e.specifiedMargins[0],isAbsolute:await r.marginsAbsolute},variableIndex:0}):a.push({setDependency:"marginsAttr",desiredValue:{size:e.specifiedMargins[1],isAbsolute:await r.marginsAbsolute},variableIndex:0}),"1"in e.specifiedMargins&&n.marginsAttr.stateValues.nComponents>1&&a.push({setDependency:"marginsAttr",desiredValue:{size:e.specifiedMargins[1],isAbsolute:await r.marginsAbsolute},variableIndex:1});return{success:!0,instructions:a}}},e.marginsAbsolute={returnDependencies:()=>({marginsAbsoluteArray:{dependencyType:"stateVariable",variableName:"marginsAbsoluteArray"}}),definition({dependencyValues:e}){let t=null;for(let n in e.marginsAbsoluteArray){let r=e.marginsAbsoluteArray[n];if(null!==r)if(r=Boolean(r),null===t)t=r;else if(t!==r)throw Error("SbsGroup is not implemented for absolute measurements")}return{setValue:{marginsAbsolute:t}}}},e.absoluteMeasurements={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({widthsAbsolute:{dependencyType:"stateVariable",variableName:"widthsAbsolute"},marginsAbsolute:{dependencyType:"stateVariable",variableName:"marginsAbsolute"}}),definition({dependencyValues:e}){let t;if(null===e.widthsAbsolute)t=null!==e.marginsAbsolute&&e.marginsAbsolute;else if(null===e.marginsAbsolute)t=e.widthsAbsolute;else{if(e.widthsAbsolute!==e.marginsAbsolute)throw Error("SbsGroup is not implemented for absolute measurements");t=e.widthsAbsolute}if(!0===t)throw Error("SbsGroup is not implemented for absolute measurements");return{setValue:{absoluteMeasurements:t}}}},e.allWidths={additionalStateVariablesDefined:["allMargins",{variableName:"gapWidth",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"},specifiedWidths:{dependencyType:"stateVariable",variableName:"specifiedWidths"},specifiedMargins:{dependencyType:"stateVariable",variableName:"specifiedMargins"},absoluteMeasurements:{dependencyType:"stateVariable",variableName:"absoluteMeasurements"}}),definition({dependencyValues:e}){let t=0,n=[...e.specifiedWidths],r=[...e.specifiedMargins],a=0,i=0;for(let t=0;t<e.maxNPanelsPerRow;t++){let e=n[t];null===e?i++:a+=e}let o=0,s=0;for(let e=0;e<2;e++){let t=r[e];null===t?s++:o+=t}if(o*=e.maxNPanelsPerRow,!e.absoluteMeasurements)if(a+o>=100){let t=100/(a+o);for(let r=0;r<e.maxNPanelsPerRow;r++)null===n[r]?n[r]=0:n[r]*=t;for(let e=0;e<2;e++){null===r[e]?r[e]=0:r[e]*=t}}else if(i>0){let t=(100-(a+o))/i;for(let r=0;r<e.maxNPanelsPerRow;r++)null===n[r]&&(n[r]=t);for(let e=0;e<2;e++){null===r[e]&&(r[e]=0)}}else if(s>0){let t=(100-(a+o))/(s*e.maxNPanelsPerRow);for(let e=0;e<2;e++)null===r[e]&&(r[e]=t)}else e.maxNPanelsPerRow>1?t=(100-(a+o))/(e.maxNPanelsPerRow-1):1===e.maxNPanelsPerRow?r[1]=100-(r[0]+n[0]):console.warn("Invalid sideBySide, as it must have at least one block child");return{setValue:{allWidths:n,allMargins:r,gapWidth:t}}}},e.widths={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["width"],returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize:({dependencyValues:e})=>[e.maxNPanelsPerRow],returnArrayDependenciesByKey({arrayKeys:e}){let t={allWidths:{dependencyType:"stateVariable",variableName:"allWidths"}},n={};for(let t of e){let e=Number(t)+1;n[t]={specifiedWidth:{dependencyType:"stateVariable",variableName:`specifiedWidth${e}`}}}return{globalDependencies:t,dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e.allWidths[r];return{setValue:{widths:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.widths)n.push({setDependency:t[r].specifiedWidth,desiredValue:e.widths[r],variableIndex:0});return{success:!0,instructions:n}}},e.margins={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"number"},entryPrefixes:["margin"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={allMargins:{dependencyType:"stateVariable",variableName:"allMargins"}},n={};for(let t of e){let e=Number(t)+1;n[t]={specifiedMargin:{dependencyType:"stateVariable",variableName:`specifiedMargin${e}`}}}return{globalDependencies:t,dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e.allMargins[r];return{setValue:{margins:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.margins)n.push({setDependency:t[r].specifiedMargin,desiredValue:e.margins[r],variableIndex:0});return{success:!0,instructions:n}}},e.valigns={public:!0,isArray:!0,shadowingInstructions:{createComponentOfType:"text"},entryPrefixes:["valign"],hasEssential:!0,defaultValueByArrayKey:()=>"top",returnArraySizeDependencies:()=>({maxNPanelsPerRow:{dependencyType:"stateVariable",variableName:"maxNPanelsPerRow"}}),returnArraySize:({dependencyValues:e})=>[e.maxNPanelsPerRow],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:[`text${e}`]}}}return{globalDependencies:{valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},valignsAttr:{dependencyType:"attributeComponent",attributeName:"valigns",variableNames:["nComponents"]}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,arraySize:r}){let a,i={},o={},s=!1;null!==e.valignsAttr?a=e.valignsAttr.stateValues.nComponents:null!==e.valignAttr?(a=r[0],s=!0):a=0;for(let r of n){let n=Number(r);if(n<a){if(s)i[r]=e.valignAttr.stateValues.value.toLowerCase();else{let e=n+1;i[r]=t[r].valignsAttr.stateValues[`text${e}`].toLowerCase()}["top","middle","bottom"].includes(i[r])||(i[r]="top")}else o[r]=!0}let l={};return Object.keys(i).length>0&&(l.setValue={valigns:i}),Object.keys(o).length>0&&(l.useEssentialOrDefaultValue={valigns:o}),l},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,globalDependencyValues:n,arraySize:r}){let a,i=!1;null!==n.valignsAttr?a=n.valignsAttr.stateValues.nComponents:null!==n.valignAttr?(a=r[0],i=!0):a=0;let o=[];for(let n in e.valigns){let r=e.valigns[n].toLowerCase();["top","middle","bottom"].includes(r)&&(Number(n)<a?i?o.push({setDependency:"valignAttr",desiredValue:r,variableIndex:0}):o.push({setDependency:t[n].valignsAttr,desiredValue:r,variableIndex:0}):o.push({setEssentialValue:"valigns",value:{[n]:r}}))}return{success:!0,instructions:o}}},e}}class Stack extends BlockComponent{static componentType="stack";static rendererType="container";static renderChildren=!0;static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}}var SideBySide$1=Object.freeze({__proto__:null,SideBySide:SideBySide,SbsGroup:SbsGroup,Stack:Stack});class H$2 extends Text{static componentType="h";static rendererType="text"}class Idx extends BaseComponent{static componentType="idx";static rendererType=void 0;static returnChildGroups(){return[{group:"hs",componentTypes:["h"]},{group:"stringsTexts",componentTypes:["string","text"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.terms={returnDependencies:()=>({stringTextChildren:{dependencyType:"child",childGroups:["stringsTexts"],variableNames:["value"]},hChildren:{dependencyType:"child",childGroups:["hs"],variableNames:["value"]}}),definition({dependencyValues:e}){let t;if(e.hChildren.length>0)t=e.hChildren.map((e=>e.stateValues.value));else{let n="";for(let t of e.stringTextChildren)n+="string"==typeof t?t:t.stateValues.value;t=[n]}return{setValue:{terms:t}}}},e}}var Indexing=Object.freeze({__proto__:null,H:H$2,Idx:Idx});class Div extends BlockComponent{static componentType="div";static rendererType="container";static renderChildren=!0;static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}}class Span extends InlineComponent{static componentType="span";static rendererType="container";static renderChildren=!0;static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}}var Divisions=Object.freeze({__proto__:null,Div:Div,Span:Span});class Pre extends BlockComponent{static componentType="pre";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}}var Verbatim=Object.freeze({__proto__:null,Pre:Pre});class Paginator extends BlockComponent{static componentType="paginator";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.initialPage={createComponentOfType:"integer",createStateVariable:"initialPage",defaultValue:1},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nPages={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"]}}),definition:({dependencyValues:e})=>({setValue:{nPages:e.children.length}})},e.currentPage={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,returnDependencies:()=>({initialPage:{dependencyType:"stateVariable",variableName:"initialPage"},nPages:{dependencyType:"stateVariable",variableName:"nPages"}}),definition:({dependencyValues:e})=>({useEssentialOrDefaultValue:{currentPage:{get defaultValue(){let t=e.initialPage;return Number.isInteger(t)?Math.max(1,Math.min(e.nPages,t)):1}}}}),async inverseDefinition({desiredStateVariableValues:e,stateValues:t,sourceInformation:n={}}){if(!n.fromSetPage)return{success:!1};let r=Number(e.currentPage);return Number.isInteger(r)?(r=Math.max(1,Math.min(await t.nPages,r)),{success:!0,instructions:[{setEssentialValue:"currentPage",value:r}]}):{success:!1}}},e.childIndicesToRender={returnDependencies:()=>({currentPage:{dependencyType:"stateVariable",variableName:"currentPage"}}),definition:({dependencyValues:e})=>({setValue:{childIndicesToRender:[e.currentPage-1]}}),markStale:()=>({updateRenderedChildren:!0})},e}async setPage({number:e,actionId:t}){if(!Number.isInteger(e))return void this.coreFunctions.resolveAction({actionId:t});let n=Math.max(1,Math.min(await this.stateValues.nPages,e)),r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"currentPage",value:n,sourceInformation:{fromSetPage:!0}}];await this.coreFunctions.performUpdate({updateInstructions:r,actionId:t,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:n,responseText:n.toString()}}})}actions={setPage:this.setPage.bind(this)}}class PaginatorControls extends BlockComponent{constructor(e){super(e),this.externalActions={},Object.defineProperty(this.externalActions,"setPage",{enumerable:!0,get:async function(){let e=await this.stateValues.paginatorComponentName;return e?{componentName:e,actionName:"setPage"}:void 0}.bind(this)})}static componentType="paginatorControls";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.previousLabel={createComponentOfType:"text",createStateVariable:"previousLabel",defaultValue:"Previous",forRenderer:!0,public:!0},e.nextLabel={createComponentOfType:"text",createStateVariable:"nextLabel",defaultValue:"Next",forRenderer:!0,public:!0},e.pageLabel={createComponentOfType:"text",createStateVariable:"pageLabel",defaultValue:"Page",forRenderer:!0,public:!0},e.paginator={createPrimitiveOfType:"string",createStateVariable:"paginator",defaultValue:null},e.disabledIgnoresParentReadOnly.defaultValue=!0,e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.paginatorComponentName={stateVariablesDeterminingDependencies:["paginator"],returnDependencies:({stateValues:e})=>e.paginator?{paginatorComponentName:{dependencyType:"expandTargetName",target:e.paginator}}:{},definition:({dependencyValues:e})=>({setValue:{paginatorComponentName:e.paginatorComponentName}})},e.currentPage={forRenderer:!0,stateVariablesDeterminingDependencies:["paginatorComponentName"],returnDependencies:({stateValues:e})=>e.paginatorComponentName?{paginatorPage:{dependencyType:"stateVariable",componentName:e.paginatorComponentName,variableName:"currentPage"}}:{},definition:({dependencyValues:e})=>"paginatorPage"in e?{setValue:{currentPage:e.paginatorPage}}:{setValue:{currentPage:1}}},e.nPages={forRenderer:!0,stateVariablesDeterminingDependencies:["paginatorComponentName"],returnDependencies:({stateValues:e})=>e.paginatorComponentName?{paginatorNPages:{dependencyType:"stateVariable",componentName:e.paginatorComponentName,variableName:"nPages"}}:{},definition:({dependencyValues:e})=>"paginatorNPages"in e?{setValue:{nPages:e.paginatorNPages}}:{setValue:{nPages:1}}},e}}var Paginator$1=Object.freeze({__proto__:null,Paginator:Paginator,PaginatorControls:PaginatorControls});class Input extends InlineComponent{static componentType="_input";static createAttributesObject(){let e=super.createAttributesObject();return e.collaborateGroups={createComponentOfType:"collaborateGroups",createStateVariable:"collaborateGroups",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nValues={returnDependencies:()=>({}),definition:()=>({setValue:{nValues:1}})},e.answerAncestor={returnDependencies:()=>({answerAncestor:{dependencyType:"ancestor",componentType:"answer",variableNames:["delegateCheckWorkToInput","justSubmitted","creditAchieved","showCorrectness","numberOfAttemptsLeft"]}}),definition:function({dependencyValues:e}){return{setValue:{answerAncestor:e.answerAncestor}}}},e.includeCheckWork={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let t=!1;return e.answerAncestor&&(t=e.answerAncestor.stateValues.delegateCheckWorkToInput),{setValue:{includeCheckWork:t}}}},e.creditAchieved={defaultValue:0,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let t=0;return e.answerAncestor&&(t=e.answerAncestor.stateValues.creditAchieved),{setValue:{creditAchieved:t}}}},e.valueHasBeenValidated={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let t=!1;return e.answerAncestor&&e.answerAncestor.stateValues.justSubmitted&&(t=!0),{setValue:{valueHasBeenValidated:t}}}},e.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:e}){let t;return t=e.answerAncestor?e.answerAncestor.stateValues.showCorrectness:!1!==e.showCorrectnessFlag,{setValue:{showCorrectness:t}}}},e.numberOfAttemptsLeft={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:e}){let t;return t=e.answerAncestor?e.answerAncestor.stateValues.numberOfAttemptsLeft:1/0,{setValue:{numberOfAttemptsLeft:t}}}},e}}class MatrixInput extends Input{constructor(e){super(e),this.actions={updateNumRows:this.updateNumRows.bind(this),updateNumColumns:this.updateNumColumns.bind(this)},this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let e=await this.stateValues.answerAncestor;return null!==e?{componentName:e.componentName,actionName:"submitAnswer"}:void 0}.bind(this)})}static componentType="matrixInput";static variableForPlainMacro="value";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.numRows={createComponentOfType:"integer",createStateVariable:"numRowsPreliminary",defaultValue:1,transformNonFiniteTo:0},e.numColumns={createComponentOfType:"integer",createStateVariable:"numColumnsPreliminary",defaultValue:1,transformNonFiniteTo:0},e.showSizeControls={createComponentOfType:"boolean",createStateVariable:"showSizeControls",defaultValue:!0,public:!0,forRenderer:!0},e.defaultEntry={createComponentOfType:"math",createStateVariable:"defaultEntry",defaultValue:me$3.fromAst("")},e.prefill={createComponentOfType:"math",createStateVariable:"prefill",defaultValue:me$3.fromAst(""),public:!0,copyComponentAttributesForCreatedComponent:["format","functionSymbols","splitSymbols"]},e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},e.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},e.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.bindValueTo={createComponentOfType:"math"},e.unionFromU={createComponentOfType:"boolean",createStateVariable:"unionFromU",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){if(e.length>0)return{success:!1};return{success:!0,newChildren:[{componentType:"matrixInputGrid"}]}}}),e}static returnChildGroups(){return[{group:"matrixComponentInputs",componentTypes:["matrixComponentInput"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.valueOriginal={hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),set:convertValueToMathExpression,definition:function({dependencyValues:e}){return e.bindValueTo?{setValue:{valueOriginal:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{valueOriginal:{defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.valueOriginal,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"valueOriginal",value:e.valueOriginal}]}}},e.immediateValueOriginal={hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),set:convertValueToMathExpression,definition:function({dependencyValues:e,changes:t,justUpdatedForNewComponent:n}){return t.valueOriginal&&!n?{setValue:{immediateValueOriginal:e.valueOriginal},setEssentialValue:{immediateValueOriginal:e.valueOriginal}}:{useEssentialOrDefaultValue:{immediateValueOriginal:{defaultValue:e.valueOriginal}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:t,shadowedVariable:n}){let r=[{setEssentialValue:"immediateValueOriginal",value:e.immediateValueOriginal}];return t||n||r.push({setDependency:"valueOriginal",desiredValue:e.immediateValueOriginal}),{success:!0,instructions:r}}},e.haveBoundValue={returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo"}}),definition:({dependencyValues:e})=>({setValue:{haveBoundValue:null!==e.bindValueTo}})},e.numRows={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({numRowsPreliminary:{dependencyType:"stateVariable",variableName:"numRowsPreliminary"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},haveBoundValue:{dependencyType:"stateVariable",variableName:"haveBoundValue"}}),definition({dependencyValues:e,usedDefault:t}){let n=e.numRowsPreliminary;if(t.numRowsPreliminary||e.haveBoundValue){let t=e.valueOriginal.tree;if(n=1,Array.isArray(t)){let e=t[0];"matrix"===e?n=t[1][1]:"vector"!==e&&"tuple"!=e||(n=t.length-1)}}return{setValue:{numRows:n}}},async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){let r=e.numRows;if(!Number.isInteger(r))return{success:!1};r=Math.max(0,r);let a=[{setDependency:"numRowsPreliminary",desiredValue:r}];if(t.haveBoundValue){let e=t.valueOriginal.tree,i=(await n.defaultEntry).tree;if(1!==await n.numColumns||!Array.isArray(e)||"vector"!==e[0]&&"tuple"!==e[0]){let e=deepClone((await n.value).tree),t=e[1][1];if(e[1][1]=r,r!==t){if(r<t)e[2].length=r+1;else{let a=await n.numColumns,o=e[2],s=await n.accumulatedComponents;for(let e=t;e<r;e++){o[e+1]||(o[e+1]=["tuple"]);let t=s[e];t||(t=[]);for(let n=0;n<a;n++){let r=t[n];o[e+1][n+1]=void 0===r?i:r}}}a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(e)})}}else{let t=e.length-1;if(r<t){let t=deepClone(e).slice(0,r+1);a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(t)})}else if(r>t){let o=deepClone(e),s=await n.accumulatedComponents;for(let e=t;e<r;e++){let t,n=s[e];n&&(t=n[0]),o[e+1]=void 0===t?i:t}a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(o)})}}}return{success:!0,instructions:a}}},e.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({numColumnsPreliminary:{dependencyType:"stateVariable",variableName:"numColumnsPreliminary"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},haveBoundValue:{dependencyType:"stateVariable",variableName:"haveBoundValue"}}),definition({dependencyValues:e,usedDefault:t}){let n=e.numColumnsPreliminary;if(t.numColumnsPreliminary||e.haveBoundValue){let t=e.valueOriginal.tree;if(n=1,Array.isArray(t)){let e=t[0];"matrix"===e?n=t[1][2]:!Array.isArray(t[1])||"vector"!==t[1][0]&&"tuple"!==t[1][0]||("^"!==e||"T"!==t[2])&&"prime"!==e||(n=t[1].length-1)}}return{setValue:{numColumns:n}}},async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){let r=e.numColumns;if(!Number.isInteger(r))return{success:!1};r=Math.max(0,r);let a=[{setDependency:"numColumnsPreliminary",desiredValue:r}];if(t.haveBoundValue){let e=(await n.defaultEntry).tree,i=t.valueOriginal.tree,o=i[0];if(!Array.isArray(i[1])||"vector"!==i[1][0]&&"tuple"!==i[1][0]||("^"!==o||"T"!==i[2])&&"prime"!==o){let t=deepClone((await n.value).tree),i=t[1][2];if(t[1][2]=r,r!==i){let o=await n.numRows,s=t[2];if(r<i)for(let e=0;e<o;e++)s[e+1].length=r+1;else{let t=await n.accumulatedComponents;for(let n=0;n<o;n++){let a=t[n];a||(a=[]);for(let t=i;t<r;t++){let r=a[t];s[n+1][t+1]=void 0===r?e:r}}}a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(t)})}}else{let t=i[1].length-1;if(r<t){let e=deepClone(i);e[1]=e[1].slice(0,r+1),a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(e)})}else if(r>t){let o=deepClone(i),s=(await n.accumulatedComponents)[0];s||(s=[]);for(let n=t;n<r;n++){let t=s[n];o[1][n+1]=void 0===t?e:t}a.push({setDependency:"valueOriginal",desiredValue:me$3.fromAst(o)})}}}return{success:!0,instructions:a}}},e.accumulatedComponents={providePreviousValuesInDefinition:!0,returnDependencies:()=>({valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),definition({dependencyValues:e,previousValues:t}){let n=[];t.accumulatedComponents&&(n=deepClone(t.accumulatedComponents));let r=e.valueOriginal.tree;if(Array.isArray(r)){let e=r[0];if("matrix"===e){let e=r[2];for(let[t,r]of e.slice(1).entries()){let e=n[t];e||(e=n[t]=[]);for(let[t,n]of r.slice(1).entries())e[t]=n}return{setValue:{accumulatedComponents:n}}}if("vector"===e||"tuple"===e){for(let[e,t]of r.slice(1).entries()){let r=n[e];r||(r=n[e]=[]),r[0]=t}return{setValue:{accumulatedComponents:n}}}if(Array.isArray(r[1])&&("vector"===r[1][0]||"tuple"===r[1][0])&&("^"===e&&"T"===r[2]||"prime"===e)){let e=n[0];e||(e=n[0]=[]);for(let[t,n]of r[1].slice(1).entries())e[t]=n;return{setValue:{accumulatedComponents:n}}}}let a=n[0];return a||(a=n[0]=[]),a[0]=r,{setValue:{accumulatedComponents:n}}}},e.componentValues={isArray:!0,entryPrefixes:["componentValue"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnArrayDependenciesByKey:()=>({globalDependencies:{valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},accumulatedComponents:{dependencyType:"stateVariable",variableName:"accumulatedComponents"},defaultEntry:{dependencyType:"stateVariable",variableName:"defaultEntry"}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n=e.valueOriginal.tree,r=e.accumulatedComponents,a=e.numRows,i=e.numColumns;if(Array.isArray(n)){let t=n[0];if("matrix"===t){if(n[1][1]===a&&n[1][2]===i){let e={},t=n[2];for(let n=0;n<a;n++)for(let r=0;r<i;r++){e[`${n},${r}`]=me$3.fromAst(t[n+1][r+1])}return{setValue:{componentValues:e}}}let t=n[1][1],o=n[1][2],s={},l=n[2],u=Math.min(a,t),c=Math.min(i,o);for(let e=0;e<u;e++)for(let t=0;t<c;t++){s[`${e},${t}`]=me$3.fromAst(l[e+1][t+1])}if(i>o)for(let t=0;t<u;t++){let n=r[t];for(let r=o;r<i;r++){let a=n[r];s[`${t},${r}`]=me$3.fromAst(void 0===a?e.defaultEntry.tree:a)}}if(a>t)for(let n=t;n<a;n++){let t=r[n];t||(t=[]);for(let r=0;r<i;r++){let a=t[r];s[`${n},${r}`]=me$3.fromAst(void 0===a?e.defaultEntry.tree:a)}}return{setValue:{componentValues:s}}}if("vector"===t||"tuple"===t){let t=n.slice(1),o=t.length,s={};for(let n=0;n<a;n++){let a=0;if(n<o){s[`${n},0`]=me$3.fromAst(t[n]),a=1}let l=r[n];l||(l=[]);for(let t=a;t<i;t++){let r=l[t];s[`${n},${t}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentValues:s}}}if(Array.isArray(n[1])&&("vector"===n[1][0]||"tuple"===n[1][0])&&("^"===t&&"T"===n[2]||"prime"===t)){let t=n[1].slice(1,i+1);r[0];let o={};for(let n=0;n<a;n++){let a=r[n];a||(a=[]);let s=0;if(0===n){for(let e=0;e<t.length;e++){o[`0,${e}`]=me$3.fromAst(t[e])}s=t.length}for(let t=s;t<i;t++){let r=a[t];o[`${n},${t}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentValues:o}}}}let o={};for(let t=0;t<a;t++){let a=0;if(0===t){o["0,0"]=me$3.fromAst(n),a=1}let s=r[t];s||(s=[]);for(let n=a;n<i;n++){let r=s[n];o[`${t},${n}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentValues:o}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,initialChange:n,workspace:r}){let a,i=t.numRows,o=t.numColumns,s=!1,l=!1,u=!1,c=t.valueOriginal.tree;if(Array.isArray(c)){let e=c[0];"vector"===e||"tuple"===e?s=!0:"matrix"===e?u=!0:!Array.isArray(c[1])||"vector"!==c[1][0]&&"tuple"!==c[1][0]||("^"!==e||"T"!==c[2])&&"prime"!==e||(l=!0)}if(r.valueData)a=r.valueData.map((e=>[...e]));else{let e=t.valueOriginal.tree;if(s){if(a=e.slice(1,1+i).map((e=>[e])),a.length<i)for(let e=a.length;e<i;e++)a.push([""]);if(o>1)for(let e=0;e<i;e++)a[e].push(...Array(o-1).fill(""))}else if(l){if(a=[e[1].slice(1,1+o)],a[0].length<o&&a[0].push(...Array(o-a[0].length).fill("")),i>1)for(let e=1;e<i;e++)a.push(Array(o).fill(""))}else if(u){if(a=e[2].slice(1,i+1).map((e=>e.slice(1,o+1))),a[0].length<o)for(let e=0;e<a.length;e++)a[e].push(...Array(o-a[e].length).fill(""));if(a.length<i)for(let e=a.length;e<i;e++)a.push(Array(o).fill(""))}else if(a=[[e]],o>1&&a[0].push(...Array(o-1).fill("")),i>1)for(let e=1;e<i;e++)a.push(Array(o).fill(""))}for(let t in e.componentValues){let[n,r]=t.split(",");a[n][r]=convertValueToMathExpression(e.componentValues[t]).tree}if(r.valueData=a,1===o&&s){let e=t.valueOriginal.tree[0],r=me$3.fromAst([e,...a.map((e=>e[0]))]);return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:r,treatAsInitialChange:n}]}}if(1===i&&l){let e=t.valueOriginal.tree,r=e[0],i=[e[1][0],...a[0]];return i="^"===r?me$3.fromAst(["^",i,"T"]):me$3.fromAst(["prime",i]),{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:i,treatAsInitialChange:n}]}}{let e=["matrix",["tuple",t.numRows,t.numColumns],["tuple",...a.map((e=>["tuple",...e]))]];return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:me$3.fromAst(e),treatAsInitialChange:n}]}}}},e.componentImmediateValues={isArray:!0,entryPrefixes:["componentImmediateValue"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnArrayDependenciesByKey:()=>({globalDependencies:{immediateValueOriginal:{dependencyType:"stateVariable",variableName:"immediateValueOriginal"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},accumulatedComponents:{dependencyType:"stateVariable",variableName:"accumulatedComponents"},defaultEntry:{dependencyType:"stateVariable",variableName:"defaultEntry"}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n=e.immediateValueOriginal.tree,r=e.accumulatedComponents,a=e.numRows,i=e.numColumns;if(Array.isArray(n)){let t=n[0];if("matrix"===t){if(n[1][1]===a&&n[1][2]===i){let e={},t=n[2];for(let n=0;n<a;n++)for(let r=0;r<i;r++){e[`${n},${r}`]=me$3.fromAst(t[n+1][r+1])}return{setValue:{componentImmediateValues:e}}}let t=n[1][1],o=n[1][2],s={},l=n[2],u=Math.min(a,t),c=Math.min(i,o);for(let e=0;e<u;e++)for(let t=0;t<c;t++){s[`${e},${t}`]=me$3.fromAst(l[e+1][t+1])}if(i>o)for(let t=0;t<u;t++){let n=r[t];for(let r=o;r<i;r++){let a=n[r];s[`${t},${r}`]=me$3.fromAst(void 0===a?e.defaultEntry.tree:a)}}if(a>t)for(let n=t;n<a;n++){let t=r[n];t||(t=[]);for(let r=0;r<i;r++){let a=t[r];s[`${n},${r}`]=me$3.fromAst(void 0===a?e.defaultEntry.tree:a)}}return{setValue:{componentImmediateValues:s}}}if("vector"===t||"tuple"===t){let t=n.slice(1),o=t.length,s={};for(let n=0;n<a;n++){let a=0;if(n<o){s[`${n},0`]=me$3.fromAst(t[n]),a=1}let l=r[n];l||(l=[]);for(let t=a;t<i;t++){let r=l[t];s[`${n},${t}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentImmediateValues:s}}}if(Array.isArray(n[1])&&("vector"===n[1][0]||"tuple"===n[1][0])&&("^"===t&&"T"===n[2]||"prime"===t)){let t=n[1].slice(1,i+1);r[0];let o={};for(let n=0;n<a;n++){let a=r[n];a||(a=[]);let s=0;if(0===n){for(let e=0;e<t.length;e++){o[`0,${e}`]=me$3.fromAst(t[e])}s=t.length}for(let t=s;t<i;t++){let r=a[t];o[`${n},${t}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentImmediateValues:o}}}}let o={};for(let t=0;t<a;t++){let a=0;if(0===t){o["0,0"]=me$3.fromAst(n),a=1}let s=r[t];s||(s=[]);for(let n=a;n<i;n++){let r=s[n];o[`${t},${n}`]=me$3.fromAst(void 0===r?e.defaultEntry.tree:r)}}return{setValue:{componentImmediateValues:o}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,initialChange:n,workspace:r}){let a,i=t.numRows,o=t.numColumns,s=!1,l=!1,u=!1,c=t.immediateValueOriginal.tree;if(Array.isArray(c)){let e=c[0];"vector"===e||"tuple"===e?s=!0:"matrix"===e?u=!0:!Array.isArray(c[1])||"vector"!==c[1][0]&&"tuple"!==c[1][0]||("^"!==e||"T"!==c[2])&&"prime"!==e||(l=!0)}if(r.immediateValueData)a=r.immediateValueData.map((e=>[...e]));else{let e=t.immediateValueOriginal.tree;if(s){if(a=e.slice(1,1+i).map((e=>[e])),a.length<i)for(let e=a.length;e<i;e++)a.push([""]);if(o>1)for(let e=0;e<i;e++)a[e].push(...Array(o-1).fill(""))}else if(l){if(a=[e[1].slice(1,1+o)],a[0].length<o&&a[0].push(...Array(o-a[0].length).fill("")),i>1)for(let e=1;e<i;e++)a.push(Array(o).fill(""))}else if(u){if(a=e[2].slice(1,i+1).map((e=>e.slice(1,o+1))),a[0].length<o)for(let e=0;e<a.length;e++)a[e].push(...Array(o-a[e].length).fill(""));if(a.length<i)for(let e=a.length;e<i;e++)a.push(Array(o).fill(""))}else if(a=[[e]],o>1&&a[0].push(...Array(o-1).fill("")),i>1)for(let e=1;e<i;e++)a.push(Array(o).fill(""))}for(let t in e.componentImmediateValues){let[n,r]=t.split(",");a[n][r]=convertValueToMathExpression(e.componentImmediateValues[t]).tree}if(r.immediateValueData=a,1===o&&s){let e=t.immediateValueOriginal.tree[0],r=me$3.fromAst([e,...a.map((e=>e[0]))]);return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:r,treatAsInitialChange:n}]}}if(1===i&&l){let e=t.immediateValueOriginal.tree,r=e[0],i=[e[1][0],...a[0]];return i="^"===r?me$3.fromAst(["^",i,"T"]):me$3.fromAst(["prime",i]),{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:i,treatAsInitialChange:n}]}}{let e=["matrix",["tuple",t.numRows,t.numColumns],["tuple",...a.map((e=>["tuple",...e]))]];return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:me$3.fromAst(e),treatAsInitialChange:n}]}}}},e.componentValuesForDisplay={isArray:!0,entryPrefixes:["componentValueForDisplay"],nDimensions:2,forRenderer:!0,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={componentValue:{dependencyType:"stateVariable",variableName:`componentValue${a}`}}}return{globalDependencies:{displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,usedDefault:r}){let a={};for(let i of n){let n=roundForDisplay({value:t[i].componentValue,dependencyValues:e,usedDefault:r});a[i]=n}return{setValue:{componentValuesForDisplay:a}}}},e.value={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({componentValues:{dependencyType:"stateVariable",variableName:"componentValues"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},valueOriginal:{dependencyType:"stateVariable",variableName:"valueOriginal"}}),definition({dependencyValues:e}){let t=e.numRows,n=e.numColumns,r=["matrix",["tuple",t,n]],a=r[2]=["tuple"];for(let r=0;r<t;r++){a[r+1]=["tuple"];for(let t=0;t<n;t++)a[r+1][t+1]=e.componentValues[r][t].tree}return{setValue:{value:me$3.fromAst(r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){let n=e.value.tree;if(Array.isArray(n)&&"matrix"===n[0]&&n[1][1]===t.numRows&&n[1][2]===t.numColumns){if(1===t.numColumns){let e=t.valueOriginal.tree;if(Array.isArray(e)){let t=e[0];if("vector"===t||"tuple"===t){let e=me$3.fromAst([t,...n[2].slice(1).map((e=>e[1]))]);return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:e}]}}}}else if(1===t.numRows){let e=t.valueOriginal.tree;if(Array.isArray(e)){let t=e[0];if(Array.isArray(e[1])&&("vector"===e[1][0]||"tuple"===e[1][0])&&("^"===t&&"T"===e[2]||"prime"===t)){let r=[e[1][0],...n[2][1].slice(1)];return r="^"===t?me$3.fromAst(["^",r,"T"]):me$3.fromAst(["prime",r]),{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:r}]}}}}return{success:!0,instructions:[{setDependency:"valueOriginal",desiredValue:e.value}]}}return{success:!1}}},e.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({componentImmediateValues:{dependencyType:"stateVariable",variableName:"componentImmediateValues"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},immediateValueOriginal:{dependencyType:"stateVariable",variableName:"immediateValueOriginal"}}),definition({dependencyValues:e}){let t=e.numRows,n=e.numColumns,r=["matrix",["tuple",t,n]],a=r[2]=["tuple"];for(let r=0;r<t;r++){a[r+1]=["tuple"];for(let t=0;t<n;t++)a[r+1][t+1]=e.componentImmediateValues[r][t].tree}return{setValue:{immediateValue:me$3.fromAst(r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){let n=e.immediateValue.tree;if(Array.isArray(n)&&"matrix"===n[0]&&n[1][1]===t.numRows&&n[1][2]===t.numColumns){if(1===t.numColumns){let e=t.immediateValueOriginal.tree;if(Array.isArray(e)){let t=e[0];if("vector"===t||"tuple"===t){let e=me$3.fromAst([t,...n[2].slice(1).map((e=>e[1]))]);return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:e}]}}}}else if(1===t.numRows){let e=t.immediateValueOriginal.tree;if(Array.isArray(e)){let t=e[0];if(Array.isArray(e[1])&&("vector"===e[1][0]||"tuple"===e[1][0])&&("^"===t&&"T"===e[2]||"prime"===t)){let r=[e[1][0],...n[2][1].slice(1)];return r="^"===t?me$3.fromAst(["^",r,"T"]):me$3.fromAst(["prime",r]),{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:r}]}}}}return{success:!0,instructions:[{setDependency:"immediateValueOriginal",desiredValue:e.immediateValue}]}}return{success:!1}}},e.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:e,usedDefault:t}){return{setValue:{valueForDisplay:roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t})}}}},e}async updateRawValues({rawRendererValues:e,transient:t=!1,actionId:n}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValues",value:e}],transient:t,actionId:n});this.coreFunctions.resolveAction({actionId:n})}async updateNumRows({numRows:e,actionId:t}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numRows",value:e}],actionId:t});this.coreFunctions.resolveAction({actionId:t})}async updateNumColumns({numColumns:e,actionId:t}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numColumns",value:e}],actionId:t});this.coreFunctions.resolveAction({actionId:t})}}class MatrixInputGrid extends CompositeComponent{static componentType="matrixInputGrid";static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.numRows={returnDependencies:()=>({parentNumRows:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numRows"}}),definition:({dependencyValues:e})=>({setValue:{numRows:e.parentNumRows}})},e.numColumns={returnDependencies:()=>({parentNumColumns:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numColumns"}}),definition:({dependencyValues:e})=>({setValue:{numColumns:e.parentNumColumns}})},e.readyToExpandWhenResolved={returnDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n,workspace:r}){let a=[],i=await e.stateValues.numRows;r.previousNumRows=i;for(let e=0;e<i;e++)a.push({componentType:"matrixInputRow",state:{rowInd:e},uniqueIdentifier:e});return{replacements:a}}static async calculateReplacementChanges({component:e,componentChanges:t,componentInfoObjects:n,flags:r,workspace:a}){let i,o=[],s=a.previousNumRows,l=await e.stateValues.numRows,u=0;if(l<s){i=e.replacements.length-l;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};o.push(t)}else if(l>s&&(u=l-s,e.replacementsToWithhold>0))if(e.replacementsToWithhold>=u){i=e.replacementsToWithhold-u,s+=u,u=0;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};o.push(t)}else u-=e.replacementsToWithhold,s+=e.replacementsToWithhold,i=0;if(u>0){let e=[];for(let t=s;t<l;t++)e.push({componentType:"matrixInputRow",state:{rowInd:t},uniqueIdentifier:t});let t={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,serializedReplacements:e,replacementsToWithhold:0,assignNamesOffset:s};o.push(t)}return a.previousNumRows=l,o}}class MatrixInputRow extends CompositeComponent{static componentType="matrixInputRow";static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.rowInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{rowInd:!0}})},e.numColumns={returnDependencies:()=>({parentNumColumns:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"numColumns"}}),definition:({dependencyValues:e})=>({setValue:{numColumns:e.parentNumColumns}})},e.readyToExpandWhenResolved={returnDependencies:()=>({numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e}j;static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n,workspace:r}){let a=[],i=await e.stateValues.numColumns,o=await e.stateValues.rowInd;r.previousNumColumns=i;for(let e=0;e<i;e++)a.push({componentType:"matrixComponentInput",state:{rowInd:o,colInd:e},uniqueIdentifier:e});return{replacements:a}}static async calculateReplacementChanges({component:e,componentChanges:t,componentInfoObjects:n,flags:r,workspace:a}){let i,o=[],s=a.previousNumColumns,l=await e.stateValues.numColumns,u=await e.stateValues.rowInd,c=0;if(l<s){i=e.replacements.length-l;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};o.push(t)}else if(l>s&&(c=l-s,e.replacementsToWithhold>0))if(e.replacementsToWithhold>=c){i=e.replacementsToWithhold-c,s+=c,c=0;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:i};o.push(t)}else c-=e.replacementsToWithhold,s+=e.replacementsToWithhold,i=0;if(c>0){let e=[];for(let t=s;t<l;t++)e.push({componentType:"matrixComponentInput",state:{rowInd:u,colInd:t},uniqueIdentifier:t});let t={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,serializedReplacements:e,replacementsToWithhold:0,assignNamesOffset:s};o.push(t)}return a.previousNumColumns=l,o}}class MatrixComponentInput extends BaseComponent{constructor(e){super(e),this.actions={updateRawValue:this.updateRawValue.bind(this),updateValue:this.updateValue.bind(this)}}static componentType="matrixComponentInput";static rendererType="mathInput";static variableForPlainMacro="value";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.rowInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{rowInd:!0}})},e.colInd={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{colInd:!0}})},e.format={returnDependencies:()=>({parentFormat:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"format"}}),definition:({dependencyValues:e})=>({setValue:{format:e.parentFormat}})},e.functionSymbols={returnDependencies:()=>({parentFunctionSymbols:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"functionSymbols"}}),definition:({dependencyValues:e})=>({setValue:{functionSymbols:e.parentFunctionSymbols}})},e.splitSymbols={returnDependencies:()=>({parentSplitSymbols:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"splitSymbols"}}),definition:({dependencyValues:e})=>({setValue:{splitSymbols:e.parentSplitSymbols}})},e.displayDigits={returnDependencies:()=>({parentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displayDigits"}}),definition({dependencyValues:e,usedDefault:t}){let n={setValue:{displayDigits:e.parentDisplayDigits}};return t.parentDisplayDigits&&(n.markAsUsedDefault={displayDigits:!0}),n}},e.displayDecimals={returnDependencies:()=>({parentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displayDecimals"}}),definition({dependencyValues:e,usedDefault:t}){let n={setValue:{displayDecimals:e.parentDisplayDecimals}};return t.parentDisplayDecimals&&(n.markAsUsedDefault={displayDecimals:!0}),n}},e.displaySmallAsZero={returnDependencies:()=>({parentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"displaySmallAsZero"}}),definition:({dependencyValues:e})=>({setValue:{displaySmallAsZero:e.parentDisplaySmallAsZero}})},e.unionFromU={returnDependencies:()=>({parentUnionFromU:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:"unionFromU"}}),definition:({dependencyValues:e})=>({setValue:{unionFromU:e.parentUnionFromU}})},e.value={stateVariablesDeterminingDependencies:["rowInd","colInd"],returnDependencies:({stateValues:e})=>{let t="";return null!==e.rowInd&&null!==e.colInd&&(t=`${e.rowInd+1}_${e.colInd+1}`),{parentComponentValue:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:`componentValue${t}`}}},definition:function({dependencyValues:e}){return e.parentComponentValue?{setValue:{value:e.parentComponentValue}}:{setValue:{value:me$3.fromAst("")}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return{success:!0,instructions:[{setDependency:"parentComponentValue",desiredValue:e.value}]}}},e.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},stateVariablesDeterminingDependencies:["rowInd","colInd"],returnDependencies:({stateValues:e})=>{let t="";return null!==e.rowInd&&null!==e.colInd&&(t=`${e.rowInd+1}_${e.colInd+1}`),{parentComponentImmediateValue:{dependencyType:"parentStateVariable",parentComponentType:"matrixInput",variableName:`componentImmediateValue${t}`}}},definition:function({dependencyValues:e}){return{setValue:{immediateValue:e.parentComponentImmediateValue}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:t}){return{success:!0,instructions:[{setDependency:"parentComponentImmediateValue",desiredValue:e.immediateValue,treatAsInitialChange:t}]}}},e.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:e,usedDefault:t}){return{setValue:{valueForDisplay:roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t})}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.valueForDisplay.toString()}}}},e.rawRendererValue={forRenderer:!0,hasEssential:!0,shadowVariable:!0,defaultValue:"",provideEssentialValuesInDefinition:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"lastValueForDisplay",hasEssential:!0,shadowVariable:!0,defaultValue:null,set:convertValueToMathExpression}],returnDependencies:()=>({immediateValue:{dependencyType:"stateVariable",variableName:"immediateValue"},valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition({dependencyValues:e,essentialValues:t}){if(void 0!==t.rawRendererValue&&deepCompare(t.lastValueForDisplay.tree,e.valueForDisplay.tree))return{useEssentialOrDefaultValue:{rawRendererValue:!0,lastValueForDisplay:!0}};{let t=stripLatex(e.valueForDisplay.toLatex());return""===t&&(t=""),{setValue:{rawRendererValue:t,lastValueForDisplay:e.valueForDisplay},setEssentialValue:{rawRendererValue:t,lastValueForDisplay:e.valueForDisplay}}}},async inverseDefinition({desiredStateVariableValues:e,stateValues:t,essentialValues:n}){const r=async e=>{let n;e=(e=normalizeLatexString(e,{unionFromU:await t.unionFromU})).replace(/\^(\w)/g,"^{$1}");let r=getFromLatex({functionSymbols:await t.functionSymbols,splitSymbols:await t.splitSymbols});try{n=r(e)}catch(e){n=me$3.fromAst("")}return n};let a=[];if("string"==typeof e.rawRendererValue){let t=n.rawRendererValue,i=e.rawRendererValue;t!==i&&a.push({setEssentialValue:"rawRendererValue",value:i});let o=await r(t),s=await r(i);deepCompare(s.tree,o.tree)||a.push({setDependency:"immediateValue",desiredValue:s,treatAsInitialChange:!0})}else{a.push({setEssentialValue:"lastValueForDisplay",value:e.rawRendererValue});let t=await r(n.rawRendererValue);if(!deepCompare(e.rawRendererValue.tree,t.tree)){let t=stripLatex(e.rawRendererValue.toLatex());""===t&&(t=""),a.push({setEssentialValue:"rawRendererValue",value:t})}}return{success:!0,instructions:a}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"math"}})},e}async updateRawValue({rawRendererValue:e,actionId:t}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",value:e}],actionId:t});this.coreFunctions.resolveAction({actionId:t})}async updateValue({actionId:e}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:e});else{let t=await this.stateValues.immediateValue;if(!deepCompare((await this.stateValues.value).tree,t.tree)){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}];""!==t.tree&&n.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"valueForDisplay"});let r={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}},a=await this.stateValues.answerAncestor;return a&&(r.context={answerAncestor:a.componentName}),await this.coreFunctions.performUpdate({updateInstructions:n,actionId:e,event:r}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"rawRendererValue"}],actionId:e})}}}var MatrixInput$1=Object.freeze({__proto__:null,MatrixInput:MatrixInput,MatrixInputGrid:MatrixInputGrid,MatrixInputRow:MatrixInputRow,default:MatrixComponentInput});class Document extends BaseComponent{static componentType="document";static rendererType="section";static renderChildren=!0;static createsVariants=!0;static createAttributesObject(){let e=super.createAttributesObject();return delete e.hide,delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.documentWideCheckWork={createComponentOfType:"boolean",createStateVariable:"documentWideCheckWork",defaultValue:!1,public:!0},e.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},e.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},e.displayDigitsForCreditAchieved={createComponentOfType:"integer",createStateVariable:"displayDigitsForCreditAchieved",defaultValue:3,public:!0},e.xmlns={createPrimitiveOfType:"string"},e.type={createPrimitiveOfType:"string"},e}static returnChildGroups(){return[{group:"variantControl",componentTypes:["variantControl"]},{group:"title",componentTypes:["title"]},{group:"description",componentTypes:["description"]},{group:"setups",componentTypes:["setup"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=returnStyleDefinitionStateVariables();Object.assign(e,t);let n=returnFeedbackDefinitionStateVariables();return Object.assign(e,n),e.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["title"]}}),definition({dependencyValues:e}){let t=null;return e.titleChild.length>0&&(t=e.titleChild[0].componentName),{setValue:{titleChildName:t}}}},e.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["title"],variableNames:["text"]}}),definition:({dependencyValues:e})=>0===e.titleChild.length?{setValue:{title:""}}:{setValue:{title:e.titleChild[0].stateValues.text}}},e.description={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({descriptionChild:{dependencyType:"child",childGroups:["description"],variableNames:["text"]}}),definition:({dependencyValues:e})=>0===e.descriptionChild.length?{setValue:{description:""}}:{setValue:{description:e.descriptionChild[0].stateValues.text}}},e.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{level:0}})},e.viewedSolution={defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"viewedSolution",value:e.viewedSolution}]})},e.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningComponent","answer","setup"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:e}){let t=[];for(let n of e.scoredDescendants)"setup"!==n.componentType&&(n.stateValues.aggregateScores||void 0===n.stateValues.scoredDescendants?t.push(n):t.push(...n.stateValues.scoredDescendants));return{setValue:{scoredDescendants:t}}}},e.nScoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}}),definition:({dependencyValues:e})=>({setValue:{nScoredDescendants:e.scoredDescendants.length}})},e.itemCreditAchieved={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize:({dependencyValues:e})=>[e.nScoredDescendants],stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=t.scoredDescendants[r];e&&(n[r]={creditAchieved:{dependencyType:"stateVariable",componentName:e.componentName,variableName:"creditAchieved"}})}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].creditAchieved;return{setValue:{itemCreditAchieved:n}}}},e.itemNumberByAnswerName={stateVariablesDeterminingDependencies:["scoredDescendants"],returnDependencies({stateValues:e}){let t={scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}};for(let n in e.scoredDescendants){let r=e.scoredDescendants[n];t[`descendantsOf${n}`]={dependencyType:"descendant",ancestorName:r.componentName,componentTypes:["answer"],recurseToMatchedChildren:!1}}return t},definition({dependencyValues:e,componentInfoObjects:t}){let n={};for(let[r,a]of e.scoredDescendants.entries()){let i=r+1;for(let t of e[`descendantsOf${r}`])n[t.componentName]=i;t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"answer"})&&(n[a.componentName]=i)}return{setValue:{itemNumberByAnswerName:n}}}},e.itemVariantInfo={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize:({dependencyValues:e})=>[e.nScoredDescendants],stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=t.scoredDescendants[r];e&&(n[r]={generatedVariantInfo:{dependencyType:"stateVariable",componentName:e.componentName,variableName:"generatedVariantInfo",variablesOptional:!0}})}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].generatedVariantInfo;return{setValue:{itemVariantInfo:n}}}},e.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition:({dependencyValues:e})=>({setValue:{answerDescendants:e.answerDescendants}})},e.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition:({dependencyValues:e})=>({setValue:{justSubmitted:e.answerDescendants.every((e=>e.stateValues.justSubmitted))}})},e.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition:({dependencyValues:e})=>({setValue:{showCorrectness:!1!==e.showCorrectnessFlag}})},e.creditAchieved={public:!0,forRenderer:!0,defaultValue:0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,shadowingInstructions:{createComponentOfType:"number",addAttributeComponentsShadowingStateVariables:{displayDigits:{stateVariableToShadow:"displayDigitsForCreditAchieved"}}}}],returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"},itemCreditAchieved:{dependencyType:"stateVariable",variableName:"itemCreditAchieved"}}),definition({dependencyValues:e}){let t,n=0,r=0;for(let[t,a]of e.scoredDescendants.entries()){let i=a.stateValues.weight;n+=e.itemCreditAchieved[t]*i,r+=i}return t=r>0?n/r:1,{setValue:{creditAchieved:t,percentCreditAchieved:100*t}}}},e.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["scoredDescendants"],returnDependencies({stateValues:e}){let t={scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}};for(let[n,r]of e.scoredDescendants.entries())t["creditAchievedIfSubmit"+n]={dependencyType:"stateVariable",componentName:r.componentName,variableName:"creditAchievedIfSubmit"};return t},definition({dependencyValues:e}){let t=0,n=0;for(let[r,a]of e.scoredDescendants.entries()){let i=a.stateValues.weight;t+=e["creditAchievedIfSubmit"+r]*i,n+=i}return{setValue:{creditAchievedIfSubmit:t/n}}}},e.generatedVariantInfo={providePreviousValuesInDefinition:!0,returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantIndex:{dependencyType:"value",value:e.variantIndex},variantName:{dependencyType:"value",value:e.variantName},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t,previousValues:n}){let r={index:e.variantIndex,name:e.variantName,meta:{createdBy:t}},a=r.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?a.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&a.push(...t.stateValues.generatedVariantInfo.subvariants);for(let[e,t]of a.entries())if(!t.subvariants&&n.generatedVariantInfo){let t=n.generatedVariantInfo.subvariants;t[e]?.subvariants&&(a[e]=Object.assign({},a[e]),a[e].subvariants=t[e].subvariants)}return{setValue:{generatedVariantInfo:r}}}},e.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"suppressAnswerSubmitButtons",forRenderer:!0}],returnDependencies:()=>({documentWideCheckWork:{dependencyType:"stateVariable",variableName:"documentWideCheckWork"}}),definition({dependencyValues:e,componentName:t}){let n=!1,r=!1;return e.documentWideCheckWork&&(n=!0,r=!0),{setValue:{createSubmitAllButton:n,suppressAnswerSubmitButtons:r}}}},e}actions={submitAllAnswers:this.submitAllAnswers.bind(this)};async submitAllAnswers({actionId:e}){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType}});for(let e of await this.stateValues.answerDescendants)await e.stateValues.justSubmitted||await this.coreFunctions.performAction({componentName:e.componentName,actionName:"submitAnswer"});this.coreFunctions.resolveAction({actionId:e})}static async setUpVariant({serializedComponent:e,sharedParameters:t,definingChildrenSoFar:n,descendantVariantComponents:r}){let a;for(let e of n)if(void 0!==e&&"variantControl"===e.componentType){a=e;break}if(void 0===a){let n,r,a;if(e.variants.variantsFromChild){if(n=e.variants.numberOfVariantsPreIgnore,e.variants.variantNames){if(r=[...e.variants.variantNames],r.length>=n)r=r.slice(0,n);else{let e,t=[...r],a=r.length,i=a;for(;a<n;){for(a++,i++,e=indexToLowercaseLetters$1(i);t.includes(e);)i++,e=indexToLowercaseLetters$1(i);r.push(e)}}t.allPossibleVariants=r}else t.allPossibleVariants=[...Array(n).keys()].map((e=>indexToLowercaseLetters$1(e+1)));t.variantIndicesToIgnore=e.variants.indicesToIgnore}else n=100,e.variants?.numberOfVariantsPreIgnore<=100&&(n=e.variants.numberOfVariantsPreIgnore),t.allPossibleVariants=[...Array(n).keys()].map((e=>indexToLowercaseLetters$1(e+1))),t.variantIndicesToIgnore=[];let i=e.variants.desiredVariant;if(void 0!==i&&void 0!==i.index){let e=Number(i.index);if(Number.isFinite(e)){Number.isInteger(e)||(console.warn("Variant index "+i.index+" must be an integer"),e=Math.round(e));let t=(e-1)%n;t<0&&(t+=n),a=t+1}else console.warn("Variant index "+i.index+" must be a number"),a=1}void 0===a&&(a=1),t.variantSeed=a.toString(),t.variantIndex=a,t.variantName=r?r[a-1]:indexToLowercaseLetters$1(a),t.variantRng=new t.rngClass(t.variantSeed)}else t.variantSeed=await a.state.selectedSeed.value,t.variantName=await a.state.selectedVariantName.value,t.variantIndex=await a.state.selectedVariantIndex.value,t.variantRng=await a.state.variantRng.value,t.allPossibleVariants=await a.state.variantNames.value,t.variantIndicesToIgnore=await a.state.variantIndicesToIgnore.value;let i=e.variants.desiredVariant;if(void 0===i&&(i={}),i.subvariants&&r)for(let e in i.subvariants){let t=i.subvariants[e],n=r[e];if(void 0===n)break;n.variants.desiredVariant=t}else e.variants.variantsFromChild&&1===r?.length&&(r[0].variants.desiredVariant=i,r[0].variants.desiredVariantFromDocument=!0)}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){if(void 0===e.children)return{success:!0,numberOfVariants:1,numberOfVariantsPreIgnore:1};let n;for(let t of e.children)if("variantControl"===t.componentType){n=t;break}if(!n){let n=super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});if(n.success&&n.numberOfVariants<=100){return{success:!0,numberOfVariants:n.numberOfVariants,numberOfVariantsPreIgnore:n.numberOfVariants}}return{success:!1}}let r=n.attributes.nVariants?.primitive;if(void 0===r&&(r=100),!n.attributes.uniqueVariants?.primitive)return{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:r};let a=super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});return a.success?(r=Math.min(a.numberOfVariants,r),e.variants.numberOfVariants=r,e.variants.numberOfVariantsPreIgnore=r,{success:!0,numberOfVariants:r,numberOfVariantsPreIgnore:r}):a}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r=e.variants?.numberOfVariants;if(void 0===r)return{success:!1};if(!Number.isInteger(t)||t<1||t>r)return{success:!1};let a=getVariantsForDescendantsForUniqueVariants({variantIndex:t,serializedComponent:e,componentInfoObjects:n});return a.success?{success:!0,desiredVariant:{index:t,subvariants:a.desiredVariants}}:(console.log("Failed to get unique variant for document."),{success:!1})}static includeBlankStringChildren=!0}function indexToLowercaseLetters$1(e){return numberToLetters(e,!0)}class TextList$1 extends InlineComponent{static componentType="textList";static renderChildren=!0;static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static stateVariableForAttributeValue="texts";static primaryStateVariableForDefinition="textsShadow";static descendantCompositesMustHaveAReplacement=!1;static createAttributesObject(){let e=super.createAttributesObject();return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions(),t=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"text"}),n=returnBreakStringsIntoComponentTypeBySpaces({componentType:"text"});return e.push({replacementFunction:function({matchedChildren:e,isAttributeComponent:r=!1,createdFromMacro:a=!1}){return r&&!a?t({matchedChildren:e}):n({matchedChildren:e})}}),e}static returnChildGroups(){return[{group:"texts",componentTypes:["text"]},{group:"textLists",componentTypes:["textList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},e.textsShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{textsShadow:!0}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},textListChildren:{dependencyType:"child",childGroups:["textLists"],variableNames:["nComponents"]},textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],skipComponentNames:!0},textsShadow:{dependencyType:"stateVariable",variableName:"textsShadow"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=0,r=[];if(e.textAndTextListChildren.length>0){let a=0;for(let[i,o]of e.textAndTextListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"textList"})){let t=e.textListChildren[a];a++;for(let e=0;e<t.stateValues.nComponents;e++)r[n+e]=[i,e];n+=t.stateValues.nComponents}else r[n]=[i,0],n+=1}else null!==e.textsShadow&&(n=e.textsShadow.length);let a=e.maximumNumber;return null!==a&&n>a&&(n=a,r=r.slice(0,a)),{setValue:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},e.texts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["text"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=[],a="1";t.childIndexByArrayKey[r]&&(e=[t.childIndexByArrayKey[r][0]],a=t.childIndexByArrayKey[r][1]+1),n[r]={textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],variableNames:["value","text"+a],variablesOptional:!0,childIndices:e}}}return{globalDependencies:{childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},textsShadow:{dependencyType:"stateVariable",variableName:"textsShadow"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=t[a].textAndTextListChildren[0];if(n)if(void 0!==n.stateValues.value)r[a]=n.stateValues.value;else{let t=e.childIndexByArrayKey[a][1]+1;r[a]=n.stateValues["text"+t]}else null!==e.textsShadow&&(r[a]=e.textsShadow[a])}return{setValue:{texts:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[];for(let t in e.texts){if(!n[t])continue;let a=n[t].textAndTextListChildren[0];a&&(void 0!==a.stateValues.value?i.push({setDependency:r[t].textAndTextListChildren,desiredValue:e.texts[t],childIndex:0,variableIndex:0}):i.push({setDependency:r[t].textAndTextListChildren,desiredValue:e.texts[t],childIndex:0,variableIndex:1}))}return{success:!0,instructions:i}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"texts"},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({setValue:{text:e.texts.join(", ")}})},e.componentNamesInList={returnDependencies:()=>({textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[];for(let r of e.textAndTextListChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"textList"})?n.push(...r.stateValues.componentNamesInList):n.push(r.componentName);let r=e.maximumNumber;return null!==r&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{setValue:{componentNamesInList:n}}}},e.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},textListChildren:{dependencyType:"child",childGroups:["textLists"],variableNames:["nComponents"]},textAndTextListChildren:{dependencyType:"child",childGroups:["texts","textLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"textList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:e,componentInfoObjects:t,componentName:n}){let r=e.nComponents;null!==e.parentNComponentsToDisplayByChild&&(r=e.parentNComponentsToDisplayByChild[n]);let a={},i=0,o=0,s=0;for(let n of e.textAndTextListChildren){let l=Math.max(0,r-i);if(l>0&&o++,t.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"textList"})){let t=e.textListChildren[s];s++;let n=Math.min(l,t.stateValues.nComponents);a[t.componentName]=n,i+=n}else i+=1}return{setValue:{nComponentsToDisplayByChild:a,nChildrenToRender:o}}},markStale:()=>({updateRenderedChildren:!0})},e}}class TextList extends InlineComponent{static componentType="randomizedTextList";static stateVariableForAttributeValue="texts";static createAttributesObject(){let e=super.createAttributesObject();return e.unordered={default:!1},e.maximumNumber={default:null},e}static returnChildLogic(e){let t=super.returnChildLogic(e),n=t.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),r=t.newLeaf({name:"atLeastZeroTextLists",componentType:"textList",comparison:"atLeast",number:0}),a=t.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,returnSugarDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"exactlyOneString",variableNames:["value"]}}),logicToWaitOnSugar:["atLeastZeroTexts"],replacementFunction:function({dependencyValues:e}){let t=e.stringChildren[0],n=t.stateValues.value.split(",").map((e=>({componentType:"text",state:{value:e.trim()}})));return{success:!0,newChildren:n,toDelete:[t.componentName]}}}),i=t.newOperator({name:"textAndTextLists",operator:"and",propositions:[n,r]});return t.newOperator({name:"TextsXorSugar",operator:"xor",propositions:[a,i],setAsBase:!0}),t}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.texts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["text"],returnDependencies:()=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},childrenToRender:{dependencyType:"stateVariable",variableName:"childrenToRender"}}),definition:function({dependencyValues:e}){let t=[],n=e.textAndTextListChildren.map((e=>e.componentName));for(let r of e.childrenToRender){let a=n.indexOf(r),i=e.textAndTextListChildren[a];i.stateValues.texts?t.push(...i.stateValues.texts):t.push(i.stateValues.value)}return{setValue:{texts:t}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({setValue:{text:e.texts.join(", ")}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:function({dependencyValues:e}){return{setValue:{nComponents:e.texts.length}}}},e.childrenToRender={returnDependencies:({sharedParameters:e})=>({textAndTextListChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.textAndTextListChildren)n.stateValues.childrenToRender?t.push(...n.stateValues.childrenToRender):t.push(n.componentName);let n=e.maximumNumber;null!==n&&t.length>n&&(n=Math.max(0,Math.floor(n)),t=t.slice(0,n)),console.log("randomizing children");for(let n=t.length-1;n>0;n--){const r=e.selectRng(),a=Math.floor(r*(n+1));[t[n],t[a]]=[t[a],t[n]]}let r=Math.ceil(e.selectRng()*t.length);return console.log(`numChildren: ${r}`),t=t.slice(0,r),{setValue:{childrenToRender:t}}}},e}initializeRenderer(){void 0===this.renderer&&(this.renderer=new this.availableRenderers.aslist({key:this.componentName}))}}class MathList extends InlineComponent{static componentType="mathList";static renderChildren=!0;static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static stateVariableForAttributeValue="maths";static primaryStateVariableForDefinition="mathsShadow";static descendantCompositesMustHaveAReplacement=!1;static createAttributesObject(){let e=super.createAttributesObject();return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e.mergeMathLists={createComponentOfType:"boolean",createStateVariable:"mergeMathListsPreliminary",defaultValue:!1},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions(),t=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"math"}),n=returnBreakStringsIntoComponentTypeBySpaces({componentType:"math"});return e.push({replacementFunction:function({matchedChildren:e,isAttributeComponent:r=!1,createdFromMacro:a=!1}){return r&&!a?t({matchedChildren:e}):n({matchedChildren:e})}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"mathLists",componentTypes:["mathList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},e.mathsShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{mathsShadow:!0}})},e.mergeMathLists={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({mergeMathListsPreliminary:{dependencyType:"stateVariable",variableName:"mergeMathListsPreliminary"},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],skipComponentNames:!0},mathChildren:{dependencyType:"child",childGroups:["maths"],skipComponentNames:!0}}),definition:({dependencyValues:e})=>({setValue:{mergeMathLists:e.mergeMathListsPreliminary||0===e.mathListChildren.length&&1===e.mathChildren.length}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["mergeMathLists"],additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies({stateValues:e}){let t={maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}};return e.mergeMathLists?t.mathAndMathListChildren={dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["value","nComponents"],variablesOptional:!0}:(t.mathListChildren={dependencyType:"child",childGroups:["mathLists"],variableNames:["nComponents"]},t.mathAndMathListChildren={dependencyType:"child",childGroups:["maths","mathLists"],skipComponentNames:!0}),t},definition:function({dependencyValues:e,componentInfoObjects:t}){let n=0,r=[];if(e.mathAndMathListChildren.length>0)if(e.mergeMathLists)for(let[a,i]of e.mathAndMathListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"mathList"})){for(let e=0;e<i.stateValues.nComponents;e++)r[n+e]=[a,e];n+=i.stateValues.nComponents}else{let e=i.stateValues.value;if(e&&Array.isArray(e.tree)&&"list"===e.tree[0]){let t=e.tree.length-1;for(let e=0;e<t;e++)r[e+n]=[a,e];n+=t}else r[n]=[a,0],n+=1}else{let a=0;for(let[i,o]of e.mathAndMathListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"mathList"})){let t=e.mathListChildren[a];a++;for(let e=0;e<t.stateValues.nComponents;e++)r[n+e]=[i,e];n+=t.stateValues.nComponents}else r[n]=[i,0],n+=1}else null!==e.mathsShadow&&(n=e.mathsShadow.length);let a=e.maximumNumber;return null!==a&&n>a&&(n=a,r=r.slice(0,a)),{setValue:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},e.maths={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["math"],stateVariablesDeterminingDependencies:["mergeMathLists","childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=[],a="1";t.childIndexByArrayKey[r]&&(e=[t.childIndexByArrayKey[r][0]],a=t.childIndexByArrayKey[r][1]+1),n[r]={mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["value","math"+a],variablesOptional:!0,childIndices:e}}}return{globalDependencies:{mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=t[a].mathAndMathListChildren[0];if(n)if(void 0!==n.stateValues.value){let t=n.stateValues.value;if(e.mergeMathLists&&Array.isArray(t.tree)&&"list"===t.tree[0]){let n=e.childIndexByArrayKey[a][1];r[a]=t.get_component(n)}else r[a]=t}else{let t=e.childIndexByArrayKey[a][1]+1;r[a]=n.stateValues["math"+t]}else null!==e.mathsShadow&&(r[a]=e.mathsShadow[a])}return{setValue:{maths:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){if(t.mergeMathLists)return console.log("Have not implemented inverse definition for math list with mergeMathLists=true"),{success:!1};let i=[];for(let t in e.maths){if(!n[t])continue;let a=n[t].mathAndMathListChildren[0];a&&(void 0!==a.stateValues.value?i.push({setDependency:r[t].mathAndMathListChildren,desiredValue:e.maths[t],childIndex:0,variableIndex:0}):i.push({setDependency:r[t].mathAndMathListChildren,desiredValue:e.maths[t],childIndex:0,variableIndex:1}))}return{success:!0,instructions:i}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"maths"},e.latex={additionalStateVariablesDefined:["latexs"],public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["valueForDisplay","latex","latexs"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n=[],r={};if(e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(r.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(r.padToDigits=e.displayDigits)),e.mathAndMathListChildren.length>0)for(let t of e.mathAndMathListChildren)if(t.stateValues.valueForDisplay){let a=t.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(a.tree)&&"list"===a.tree[0])for(let e=0;e<a.tree.length-1;e++)n.push(a.get_component(e).toLatex(r));else n.push(t.stateValues.latex)}else n.push(...t.stateValues.latexs);else null!==e.mathsShadow&&(n=e.mathsShadow.map((n=>roundForDisplay({value:n,dependencyValues:e,usedDefault:t}).toLatex(r))));let a=e.maximumNumber;return null!==a&&n.length>a&&(a=Math.max(0,Math.floor(a)),n=n.slice(0,a)),{setValue:{latex:n.join(", "),latexs:n}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},mathsShadow:{dependencyType:"stateVariable",variableName:"mathsShadow"}}),definition:function({dependencyValues:e}){let t=[];if(e.mathAndMathListChildren.length>0)for(let n of e.mathAndMathListChildren)if(n.stateValues.valueForDisplay){let r=n.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(r.tree)&&"list"===r.tree[0])for(let e=0;e<r.tree.length-1;e++)t.push(r.get_component(e).toString());else t.push(n.stateValues.text)}else t.push(...n.stateValues.texts);else null!==e.mathsShadow&&(t=e.mathsShadow.map((e=>e.toString())));let n=e.maximumNumber;return null!==n&&t.length>n&&(n=Math.max(0,Math.floor(n)),t=t.slice(0,n)),{setValue:{text:t.join(", "),texts:t}}}},e.componentNamesInList={returnDependencies:()=>({mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[];for(let r of e.mathAndMathListChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"mathList"})?n.push(...r.stateValues.componentNamesInList):n.push(r.componentName);let r=e.maximumNumber;return null!==r&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{setValue:{componentNamesInList:n}}}},e.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},mathListChildren:{dependencyType:"child",childGroups:["mathLists"],variableNames:["nComponents"]},mathAndMathListChildren:{dependencyType:"child",childGroups:["maths","mathLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:e,componentInfoObjects:t,componentName:n}){let r=e.nComponents;null!==e.parentNComponentsToDisplayByChild&&(r=e.parentNComponentsToDisplayByChild[n]);let a={},i=0,o=0,s=0;for(let n of e.mathAndMathListChildren){let l=Math.max(0,r-i);if(l>0&&o++,t.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"mathList"})){let t=e.mathListChildren[s];s++;let n=Math.min(l,t.stateValues.nComponents);a[t.componentName]=n,i+=n}else i+=1}return{setValue:{nComponentsToDisplayByChild:a,nChildrenToRender:o}}},markStale:()=>({updateRenderedChildren:!0})},e}}class TupleList extends MathList{static componentType="tupleList";static includeBlankStringChildren=!1;static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e}){let t=breakEmbeddedStringsIntoParensPieces({componentList:e});return!0!==t.success?{success:!1}:{success:!0,newChildren:t.pieces.map((function(e){return e.length>1||"string"==typeof e[0]?{componentType:"math",children:e}:e[0]}))}}}),e}}class NumberList extends InlineComponent{static componentType="numberList";static rendererType="asList";static renderChildren=!0;static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static stateVariableForAttributeValue="numbers";static primaryStateVariableForDefinition="numbersShadow";static createAttributesObject(){let e=super.createAttributesObject();return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions(),t=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"number"}),n=returnBreakStringsIntoComponentTypeBySpaces({componentType:"number"});return e.push({replacementFunction:function({matchedChildren:e,isAttributeComponent:r=!1,createdFromMacro:a=!1}){return r&&!a?t({matchedChildren:e}):n({matchedChildren:e})}}),e}static returnChildGroups(){return[{group:"numbers",componentTypes:["number"]},{group:"numberLists",componentTypes:["numberList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},e.numbersShadow={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{numbersShadow:!0}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numberListChildren:{dependencyType:"child",childGroups:["numberLists"],variableNames:["nComponents"]},numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],skipComponentNames:!0},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=0,r=[],a=0;if(e.numberAndNumberListChildren.length>0)for(let[i,o]of e.numberAndNumberListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"numberList"})){let t=e.numberListChildren[a];a++;for(let e=0;e<t.stateValues.nComponents;e++)r[n+e]=[i,e];n+=t.stateValues.nComponents}else r[n]=[i,0],n+=1;else null!==e.numbersShadow&&(n=e.numbersShadow.length);let i=e.maximumNumber;return null!==i&&n>i&&(n=i,r=r.slice(0,i)),{setValue:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},e.numbers={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},isArray:!0,entryPrefixes:["number"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=[],a="1";t.childIndexByArrayKey[r]&&(e=[t.childIndexByArrayKey[r][0]],a=t.childIndexByArrayKey[r][1]+1),n[r]={numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["value","number"+a],variablesOptional:!0,childIndices:e}}}return{globalDependencies:{childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=t[a].numberAndNumberListChildren[0];if(n)if(void 0!==n.stateValues.value)r[a]=n.stateValues.value;else{let t=e.childIndexByArrayKey[a][1]+1;r[a]=n.stateValues["number"+t]}else null!==e.numbersShadow&&(r[a]=e.numbersShadow[a])}return{setValue:{numbers:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[];for(let t in e.numbers){if(!n[t])continue;let a=n[t].numberAndNumberListChildren[0];a&&(void 0!==a.stateValues.value?i.push({setDependency:r[t].numberAndNumberListChildren,desiredValue:e.numbers[t],childIndex:0,variableIndex:0}):i.push({setDependency:r[t].numberAndNumberListChildren,desiredValue:e.numbers[t],childIndex:0,variableIndex:1}))}return{success:!0,instructions:i}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"numbers"},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numbersShadow:{dependencyType:"stateVariable",variableName:"numbersShadow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n=[],r={};if(e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(r.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(r.padToDigits=e.displayDigits)),e.numberAndNumberListChildren.length>0)for(let t of e.numberAndNumberListChildren)void 0!==t.stateValues.valueForDisplay?n.push(t.stateValues.text):n.push(...t.stateValues.texts);else null!==e.numbersShadow&&(n=e.numbersShadow.map((n=>roundForDisplay({value:me.fromAst(n),dependencyValues:e,usedDefault:t}).toString(r))));let a=e.maximumNumber;return null!==a&&n.length>a&&(a=Math.max(0,Math.floor(a)),n=n.slice(0,a)),{setValue:{text:n.join(", "),texts:n}}}},e.componentNamesInList={returnDependencies:()=>({numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[];for(let r of e.numberAndNumberListChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"numberList"})?n.push(...r.stateValues.componentNamesInList):n.push(r.componentName);let r=e.maximumNumber;return null!==r&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{setValue:{componentNamesInList:n}}}},e.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},numberListChildren:{dependencyType:"child",childGroups:["numberLists"],variableNames:["nComponents"]},numberAndNumberListChildren:{dependencyType:"child",childGroups:["numbers","numberLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:e,componentInfoObjects:t,componentName:n}){let r=e.nComponents;null!==e.parentNComponentsToDisplayByChild&&(r=e.parentNComponentsToDisplayByChild[n]);let a={},i=0,o=0,s=0;for(let n of e.numberAndNumberListChildren){let l=Math.max(0,r-i);if(l>0&&o++,t.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"numberList"})){let t=e.numberListChildren[s];s++;let n=Math.min(l,t.stateValues.nComponents);a[t.componentName]=n,i+=n}else i+=1}return{setValue:{nComponentsToDisplayByChild:a,nChildrenToRender:o}}},markStale:()=>({updateRenderedChildren:!0})},e}}class NumberListFromString extends InlineComponent{static componentType="numberListFromString";static rendererType="asList";static renderChildren=!0;static stateVariableForAttributeValue="numbers";static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition:function({dependencyValues:e}){return{setValue:{nComponents:e.stringChildren.length}}}},e.numbers={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["number"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey:()=>({globalDependencies:{stringChildren:{dependencyType:"child",childGroups:["strings"]}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let[t,r]of e.stringChildren.entries())n[t]=Number(r);return{setValue:{numbers:n}}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"numbers"},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numbers:{dependencyType:"stateVariable",variableName:"numbers"}}),definition:function({dependencyValues:e}){let t=e.numbers.map((e=>e.toString()));return{setValue:{text:t.join(", "),texts:t}}}},e}}class P$2 extends BlockComponent{static componentType="p";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text?t+=n.stateValues.text:t+=" ";return{setValue:{text:t}}}},e}}class BooleanList extends InlineComponent{static componentType="booleanList";static rendererType="asList";static renderChildren=!0;static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static stateVariableForAttributeValue="booleans";static descendantCompositesMustHaveAReplacement=!1;static createAttributesObject(){let e=super.createAttributesObject();return e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions(),t=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:"boolean"}),n=returnBreakStringsIntoComponentTypeBySpaces({componentType:"boolean"});return e.push({replacementFunction:function({matchedChildren:e,isAttributeComponent:r=!1,createdFromMacro:a=!1}){return r&&!a?t({matchedChildren:e}):n({matchedChildren:e})}}),e}static returnChildGroups(){return[{group:"booleans",componentTypes:["boolean"]},{group:"booleanLists",componentTypes:["booleanList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},booleanListChildren:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["nComponents"]},booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],skipComponentNames:!0}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=0,r=[],a=0;for(let[i,o]of e.booleanAndBooleanListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"booleanList"})){let t=e.booleanListChildren[a];a++;for(let e=0;e<t.stateValues.nComponents;e++)r[n+e]=[i,e];n+=t.stateValues.nComponents}else r[n]=[i,0],n+=1;let i=e.maximumNumber;return null!==i&&n>i&&(n=i,r=r.slice(0,i)),{setValue:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},e.booleans={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},isArray:!0,entryPrefixes:["boolean"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=[],a="1";t.childIndexByArrayKey[r]&&(e=[t.childIndexByArrayKey[r][0]],a=t.childIndexByArrayKey[r][1]+1),n[r]={booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],variableNames:["value","boolean"+a],variablesOptional:!0,childIndices:e}}}return{globalDependencies:{childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=t[a].booleanAndBooleanListChildren[0];if(n)if(void 0!==n.stateValues.value)r[a]=n.stateValues.value;else{let t=e.childIndexByArrayKey[a][1]+1;r[a]=n.stateValues["boolean"+t]}}return{setValue:{booleans:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[];for(let t in e.booleans){if(!n[t])continue;let a=n[t].booleanAndBooleanListChildren[0];a&&(void 0!==a.stateValues.value?i.push({setDependency:r[t].booleanAndBooleanListChildren,desiredValue:e.booleans[t],childIndex:0,variableIndex:0}):i.push({setDependency:r[t].booleanAndBooleanListChildren,desiredValue:e.booleans[t],childIndex:0,variableIndex:1}))}return{success:!0,instructions:i}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"booleans"},e.componentNamesInList={returnDependencies:()=>({booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],variableNames:["componentNamesInList"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[];for(let r of e.booleanAndBooleanListChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"booleanList"})?n.push(...r.stateValues.componentNamesInList):n.push(r.componentName);let r=e.maximumNumber;return null!==r&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{setValue:{componentNamesInList:n}}}},e.nComponentsToDisplayByChild={additionalStateVariablesDefined:["nChildrenToRender"],returnDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"},booleanListChildren:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["nComponents"]},booleanAndBooleanListChildren:{dependencyType:"child",childGroups:["booleans","booleanLists"],skipComponentNames:!0},parentNComponentsToDisplayByChild:{dependencyType:"parentStateVariable",parentComponentType:"booleanList",variableName:"nComponentsToDisplayByChild"}}),definition:function({dependencyValues:e,componentInfoObjects:t,componentName:n}){let r=e.nComponents;null!==e.parentNComponentsToDisplayByChild&&(r=e.parentNComponentsToDisplayByChild[n]);let a={},i=0,o=0,s=0;for(let n of e.booleanAndBooleanListChildren){let l=Math.max(0,r-i);if(l>0&&o++,t.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"booleanList"})){let t=e.booleanListChildren[s];s++;let n=Math.min(l,t.stateValues.nComponents);a[t.componentName]=n,i+=n}else i+=1}return{setValue:{nComponentsToDisplayByChild:a,nChildrenToRender:o}}},markStale:()=>({updateRenderedChildren:!0})},e}}class Copy extends CompositeComponent{static componentType="copy";static assignNamesToReplacements=!0;static acceptTarget=!0;static acceptAnyAttribute=!0;static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(){let e=super.createAttributesObject();return delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.assignNamesSkip={createPrimitiveOfType:"number"},e.prop={createPrimitiveOfType:"string"},e.obtainPropFromComposite={createPrimitiveOfType:"boolean",createStateVariable:"obtainPropFromComposite",defaultValue:!1,public:!0},e.createComponentOfType={createPrimitiveOfType:"string"},e.nComponents={createPrimitiveOfType:"number"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.uri={createPrimitiveOfType:"string",createStateVariable:"uri",defaultValue:null,public:!0},e.targetAttributesToIgnore={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnore",defaultValue:["hide"],public:!0},e.targetAttributesToIgnoreRecursively={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnoreRecursively",defaultValue:["isResponse"],public:!0},e.link={createPrimitiveOfType:"boolean"},e.removeEmptyArrayEntries={createPrimitiveOfType:"boolean",createStateVariable:"removeEmptyArrayEntries",defaultValue:!1},e}static keepChildrenSerialized({serializedComponent:e}){return void 0===e.children?[]:Object.keys(e.children)}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:e})=>({setValue:{target:e.target}})},e.targetSourcesName={additionalStateVariablesDefined:[{variableName:"sourcesChildNumber",hasEssential:!0,shadowVariable:!0}],stateVariablesDeterminingDependencies:["target"],determineDependenciesImmediately:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:function({stateValues:e,sharedParameters:t}){let n=t.sourceNameMappings;if(!n)return{};let r=n[e.target];return r?{targetSourcesName:{dependencyType:"value",value:r.name},sourcesChildNumber:{dependencyType:"value",value:r.childNumber}}:{}},definition:function({dependencyValues:e}){let t=e.targetSourcesName,n=e.sourcesChildNumber;return t||(t=null,n=null),{setValue:{targetSourcesName:t,sourcesChildNumber:n},setEssentialValue:{targetSourcesName:t,sourcesChildNumber:n}}}},e.targetSources={stateVariablesDeterminingDependencies:["targetSourcesName"],determineDependenciesImmediately:!0,returnDependencies:({stateValues:e})=>e.targetSourcesName?{targetSourcesComponent:{dependencyType:"componentIdentity",componentName:e.targetSourcesName}}:{},definition:function({dependencyValues:e}){let t=e.targetSourcesComponent;return t||(t=null),{setValue:{targetSources:t}}}},e.sourceIndex={stateVariablesDeterminingDependencies:["target"],determineDependenciesImmediately:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:function({stateValues:e,sharedParameters:t}){let n=t.sourceIndexMappings;if(!n)return{};let r=n[e.target];return void 0===r?{}:{sourceIndex:{dependencyType:"value",value:r}}},definition:function({dependencyValues:e}){let t=e.sourceIndex;return void 0===t&&(t=null),{setValue:{sourceIndex:t},setEssentialValue:{sourceIndex:t}}}},e.targetComponent={shadowVariable:!0,stateVariablesDeterminingDependencies:["targetSources","sourceIndex"],determineDependenciesImmediately:!0,returnDependencies:({stateValues:e})=>null!==e.sourceIndex?{}:null!==e.targetSources?{targetSourcesChildren:{dependencyType:"stateVariable",componentName:e.targetSources.componentName,variableName:"childIdentities"},sourcesChildNumber:{dependencyType:"stateVariable",variableName:"sourcesChildNumber"}}:{targetComponent:{dependencyType:"targetComponent"}},definition:function({dependencyValues:e}){let t=null;return e.targetSourcesChildren?(t=e.targetSourcesChildren[e.sourcesChildNumber],t||(t=null)):e.targetComponent&&(t=e.targetComponent),{setValue:{targetComponent:t}}}},e.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies:({stateValues:e})=>e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{},definition:function({dependencyValues:e}){return{setValue:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},e.cid={additionalStateVariablesDefined:["doenetId"],returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:e}){if(!e.uri||"doenet:"!==e.uri.substring(0,7).toLowerCase())return{setValue:{cid:null,doenetId:null}};let t=null,n=null,r=e.uri.match(/[:&]cid=([^&]+)/i);return r&&(t=r[1]),r=e.uri.match(/[:&]doenetid=([^&]+)/i),r&&(n=r[1]),{setValue:{cid:t,doenetId:n}}}},e.serializedComponentsForCid={returnDependencies:()=>({cid:{dependencyType:"stateVariable",variableName:"cid"},serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:e}){if(!e.cid)return{setValue:{serializedComponentsForCid:null}};let t=e.serializedChildren?.[0];if(!t)return{setValue:{serializedComponentsForCid:null}};let n={componentType:"externalContent",state:{rendered:!0},children:t.children,originalName:t.componentName,variants:t.variants};return t.attributes?.newNamespace?.primitive&&(n.attributes={newNamespace:{primitive:!0}}),{setValue:{serializedComponentsForCid:n}}}},e.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{setValue:{propName:e.propName}}}},e.isPlainMacro={returnDependencies:()=>({isPlainMacro:{dependencyType:"doenetAttribute",attributeName:"isPlainMacro"}}),definition:function({dependencyValues:e}){return{setValue:{isPlainMacro:e.isPlainMacro}}}},e.linkAttrForDetermineDeps={returnDependencies:()=>({linkAttr:{dependencyType:"attributePrimitive",attributeName:"link"}}),definition({dependencyValues:e}){let t;return t=null===e.linkAttr||e.linkAttr,{setValue:{linkAttrForDetermineDeps:t}}}},e.replacementSourceIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex","propName","obtainPropFromComposite","linkAttrForDetermineDeps"],additionalStateVariablesDefined:["addLevelToAssignNames"],returnDependencies:function({stateValues:e,componentInfoObjects:t}){let n={},r=!1,a=!1;return null!==e.targetComponent&&(!t.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})||e.propName&&e.obtainPropFromComposite||(e.linkAttrForDetermineDeps?(a=!0,n.targets={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,componentIndex:e.componentIndex}):r=!0),a||null!==e.componentIndex&&1!==e.componentIndex||(n.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),n.addLevelToAssignNames={dependencyType:"value",value:r},n},definition({dependencyValues:e}){let t=null;return e.targets&&(t=e.targets,Array.isArray(t)||(t=[t])),{setValue:{replacementSourceIdentities:t,addLevelToAssignNames:e.addLevelToAssignNames}}}},e.replacementSources={stateVariablesDeterminingDependencies:["replacementSourceIdentities","propName","propIndex","isPlainMacro"],additionalStateVariablesDefined:["effectivePropNameBySource"],returnDependencies:function({stateValues:e,componentInfoObjects:t}){let n={replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"},propIndex:{dependencyType:"stateVariable",variableName:"propIndex"}};if(!e.propName&&null!==e.propIndex)throw Error("You cannot specify a propIndex without specifying a prop.");if(null!==e.replacementSourceIdentities)for(let[r,a]of e.replacementSourceIdentities.entries()){let i,o=e.propName;e.isPlainMacro&&(o=t.allComponentClasses[a.componentType].variableForPlainMacro),o?(n["propName"+r]={dependencyType:"value",value:o},i={dependencyType:"stateVariable",componentName:a.componentName,variableName:o,returnAsComponentObject:!0,variablesOptional:!0,propIndex:e.propIndex,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}):i={dependencyType:"componentIdentity",componentName:a.componentName},n["target"+r]=i}return n},definition({dependencyValues:e}){let t=null,n=null;if(null!==e.replacementSourceIdentities){t=[],n=[];for(let r in e.replacementSourceIdentities){let a=e["target"+r];if(a){let i;t.push(a),a.stateValues&&(i=Object.keys(a.stateValues)[0]),!i&&e["propName"+r]&&(i=e["propName"+r]),n.push(i)}}}return{setValue:{replacementSources:t,effectivePropNameBySource:n}}}},e.nComponentsSpecified={returnDependencies:()=>({nComponentsAttr:{dependencyType:"attributePrimitive",attributeName:"nComponents"},typeAttr:{dependencyType:"attributePrimitive",attributeName:"createComponentOfType"}}),definition({dependencyValues:e,componentInfoObjects:t}){let n;if(e.typeAttr){if(!(e.typeAttr in t.allComponentClasses))throw Error(`Invalid componentType ${e.typeAttr} of copy.`);n=null!==e.nComponentsAttr?e.nComponentsAttr:1}else{if(null!==e.nComponentsAttr)throw Error("You must specify createComponentOfType when specifying nComponents for a copy.");n=null}return{setValue:{nComponentsSpecified:n}}}},e.link={returnDependencies:()=>({linkAttr:{dependencyType:"attributePrimitive",attributeName:"link"},serializedComponentsForCid:{dependencyType:"stateVariable",variableName:"serializedComponentsForCid"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}}),definition({dependencyValues:e,componentInfoObjects:t}){let n;return n=null===e.linkAttr?!(e.serializedComponentsForCid||e.replacementSourceIdentities&&e.replacementSourceIdentities.some((e=>t.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"module"})))):!1!==e.linkAttr,{setValue:{link:n}}}},e.readyToExpandWhenResolved={stateVariablesDeterminingDependencies:["targetComponent","propName","obtainPropFromComposite","link"],returnDependencies({stateValues:e,componentInfoObjects:t}){let n={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"},serializedComponentsForCid:{dependencyType:"stateVariable",variableName:"serializedComponentsForCid"},link:{dependencyType:"stateVariable",variableName:"link"}};return!e.targetComponent||!t.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})||e.propName&&e.obtainPropFromComposite||(n.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"readyToExpandWhenResolved"}),e.link||(n.replacementSources={dependencyType:"stateVariable",variableName:"replacementSources"}),n},definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.needsReplacementsUpdatedWhenStale={stateVariablesDeterminingDependencies:["targetComponent","replacementSourceIdentities","effectivePropNameBySource","propName","obtainPropFromComposite","link","removeEmptyArrayEntries"],returnDependencies:function({stateValues:e,componentInfoObjects:t}){if(!e.link)return{};let n={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"},propIndex:{dependencyType:"stateVariable",variableName:"propIndex"}};if(null!==e.effectivePropNameBySource)for(let[t,r]of e.effectivePropNameBySource.entries())if(r){let a=e.replacementSourceIdentities[t];n["sourceArraySize"+t]={dependencyType:"stateVariableArraySize",componentName:a.componentName,variableName:r,variablesOptional:!0,caseInsensitiveVariableMatch:!0},n["sourceComponentType"+t]={dependencyType:"stateVariableComponentType",componentName:a.componentName,variableName:r,variablesOptional:!0,caseInsensitiveVariableMatch:!0}}return null===e.targetComponent||!t.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})||e.propName&&e.obtainPropFromComposite||(n.allReplacementIdentities={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,variableNames:["isInactiveCompositeReplacement"]}),e.removeEmptyArrayEntries&&(n.replacementSources={dependencyType:"stateVariable",variableName:"replacementSources"}),n},markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{needsReplacementsUpdatedWhenStale:!0}})},e.effectiveAssignNames={returnDependencies:()=>({assignNames:{dependencyType:"doenetAttribute",attributeName:"assignNames"},addLevelToAssignNames:{dependencyType:"stateVariable",variableName:"addLevelToAssignNames"}}),definition({dependencyValues:e}){let t=e.assignNames;return t&&e.addLevelToAssignNames&&(t=[t]),{setValue:{effectiveAssignNames:t}}}},e}static async createSerializedReplacements({component:e,components:t,workspace:n,componentInfoObjects:r,flags:a,resolveItem:i,publicCaseInsensitiveAliasSubstitutions:o}){n.numReplacementsBySource=[],n.numNonStringReplacementsBySource=[],n.propVariablesCopiedBySource=[],n.sourceNames=[],n.uniqueIdentifiersUsedBySource={};let s=e.attributes.newNamespace?.primitive,l=this.createAttributesObject(),u=await e.stateValues.effectiveAssignNames,c=await e.stateValues.serializedComponentsForCid;if(c){let t=[deepClone(c)];t[0].children&&restrictTNamesToNamespace({components:t[0].children,namespace:t[0].originalName+"/"});for(let n of t[0].children){if("object"!=typeof n)continue;n.attributes||(n.attributes={});let t=convertAttributesForComponentType({attributes:e.attributes,componentType:n.componentType,componentInfoObjects:r,compositeAttributesObj:l,compositeCreatesNewNamespace:s,flags:a});for(let e in t){let n=t[e];n.component?setTNamesToAbsolute([n.component]):n.childrenForComponent&&setTNamesToAbsolute(n.childrenForComponent)}Object.assign(n.attributes,t)}return t=processAssignNames({assignNames:u,serializedComponents:t,parentName:e.componentName,parentCreatesNewNamespace:s,componentInfoObjects:r}).serializedComponents,{replacements:(await this.verifyReplacementsMatchSpecifiedType({component:e,replacements:t,workspace:n,componentInfoObjects:r,compositeAttributesObj:l,flags:a})).replacements}}let p=await e.stateValues.sourceIndex;if(null!==p){let t=processAssignNames({assignNames:u,serializedComponents:[{componentType:"number",attributes:convertAttributesForComponentType({attributes:e.attributes,componentType:"number",componentInfoObjects:r,compositeAttributesObj:l,compositeCreatesNewNamespace:s,flags:a}),state:{value:p,fixed:!0}}],parentName:e.componentName,parentCreatesNewNamespace:s,componentInfoObjects:r});return{replacements:(await this.verifyReplacementsMatchSpecifiedType({component:e,replacements:t.serializedComponents,workspace:n,componentInfoObjects:r,compositeAttributesObj:l,flags:a})).replacements}}let d=await e.stateValues.replacementSourceIdentities;if(!await e.stateValues.targetComponent||!d){return{replacements:(await this.verifyReplacementsMatchSpecifiedType({component:e,replacements:[],workspace:n,componentInfoObjects:r,compositeAttributesObj:l})).replacements}}let m=await i({componentName:e.componentName,type:"determineDependencies",stateVariable:"replacementSources",dependency:"__determine_dependencies",expandComposites:!1});if(!m.success)throw Error(`Couldn't resolve determineDependencies of replacementSources of ${e.componentName}`);let f=await e.stateValues.effectivePropNameBySource;for(let t in d){if(f[t]&&(m=await i({componentName:e.componentName,type:"recalculateDownstreamComponents",stateVariable:"replacementSources",dependency:"target"+t,expandComposites:!1}),!m.success))throw Error(`Couldn't resolve recalculateDownstreamComponents for target${t} of replacementSources of ${e.componentName}`)}let h=[],y=[],b=[],g=0,v=0;for(let i in d){let s,u=n.uniqueIdentifiersUsedBySource[i]=[];if(e.attributes.createComponentOfType?.primitive){let t=await e.stateValues.nComponentsSpecified,n=d.length;s=Math.floor(t/n),i<t%n&&s++}let c=await this.createReplacementForSource({component:e,sourceNum:i,components:t,numReplacementsSoFar:g,numNonStringReplacementsSoFar:v,uniqueIdentifiersUsed:u,compositeAttributesObj:l,componentInfoObjects:r,nComponentsForSource:s,publicCaseInsensitiveAliasSubstitutions:o,flags:a});n.propVariablesCopiedBySource[i]=c.propVariablesCopiedByReplacement;let p=c.serializedReplacements;y[i]=p.length,b[i]=p.filter((e=>"string"!=typeof e)).length,g+=y[i],v+=b[i],h.push(...p)}return n.numReplacementsBySource=y,n.numNonStringReplacementsBySource=b,n.sourceNames=d.map((e=>e.componentName)),{replacements:(await this.verifyReplacementsMatchSpecifiedType({component:e,replacements:h,workspace:n,componentInfoObjects:r,compositeAttributesObj:l,flags:a})).replacements}}static async verifyReplacementsMatchSpecifiedType({component:e,replacements:t,replacementChanges:n,workspace:r,componentInfoObjects:a,compositeAttributesObj:i,flags:o}){if(!e.attributes.createComponentOfType?.primitive&&!e.sharedParameters.compositesMustHaveAReplacement)return{replacements:t,replacementChanges:n};let s,l=e.replacementsToWithhold;if(n){s=e.replacements.map((e=>e.componentType));for(let e of n)if("add"===e.changeType){if(void 0!==e.replacementsToWithhold&&(l=e.replacementsToWithhold),!e.changeTopLevelReplacements)continue;if(e.serializedReplacements){let t=e.numberReplacementsToReplace;t>0||(t=0);let n=e.firstReplacementInd,r=e.serializedReplacements.map((e=>e.componentType));s.splice(n,t,...r)}}else if("delete"===e.changeType){if(void 0!==e.replacementsToWithhold&&(l=e.replacementsToWithhold),e.changeTopLevelReplacements){let t=e.firstReplacementInd,n=e.numberReplacementsToDelete;s.splice(t,n)}}else"changeReplacementsToWithhold"===e.changeType&&void 0!==e.replacementsToWithhold&&(l=e.replacementsToWithhold)}else s=t.map((e=>e.componentType)),1===s.length&&"externalContent"===s[0]&&(s=t[0].children.filter((e=>e.componentType||e.trim().length>0)).map((e=>e.componentType)));if(l>0&&(s=s.slice(0,s.length-l)),!e.attributes.createComponentOfType?.primitive&&e.sharedParameters.compositesMustHaveAReplacement&&s.length>0)return{replacements:t,replacementChanges:n};let u=e.attributes.createComponentOfType?.primitive,c=await e.stateValues.nComponentsSpecified;if(!u){if(u=e.sharedParameters.compositesDefaultReplacementType,!u)throw Error("A component class specified descendantCompositesMustHaveAReplacement but didn't specify descendantCompositesDefaultReplacementType");c=1}if(s.length!==c||!s.every((e=>e===u))){r.numReplacementsBySource=[],r.numNonStringReplacementsBySource=[],r.propVariablesCopiedBySource=[],r.sourceNames=[],r.uniqueIdentifiersUsedBySource={};let s=r.uniqueIdentifiersUsedBySource[0]=[],l=e.attributes.newNamespace?.primitive;t=[];for(let n=0;n<c;n++){let r=convertAttributesForComponentType({attributes:e.attributes,componentType:u,componentInfoObjects:a,compositeAttributesObj:i,compositeCreatesNewNamespace:l,flags:o}),c=getUniqueIdentifierFromBase(u+"|empty"+n,s);t.push({componentType:u,attributes:r,uniqueIdentifier:c})}if(t=processAssignNames({assignNames:await e.stateValues.effectiveAssignNames,serializedComponents:t,parentName:e.componentName,parentCreatesNewNamespace:l,componentInfoObjects:a}).serializedComponents,r.numReplacementsBySource.push(t.length),r.numNonStringReplacementsBySource.push(t.filter((e=>"string"!=typeof e)).length),n){n=[],e.replacementsToWithhold>0&&n.push({changeType:"changeReplacementsToWithhold",replacementsToWithhold:0});let r=0;e.replacements&&(r=e.replacements.length),n.push({changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:r,serializedReplacements:t})}}return{replacements:t,replacementChanges:n}}static async createReplacementForSource({component:e,sourceNum:t,components:n,numReplacementsSoFar:r,numNonStringReplacementsSoFar:a,uniqueIdentifiersUsed:i,compositeAttributesObj:o,componentInfoObjects:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u,flags:c}){let p=(await e.stateValues.replacementSourceIdentities)[t];if("object"!=typeof p)return{serializedReplacements:[p]};let d=n[p.componentName],m=await e.stateValues.link;m&&!await e.stateValues.removeEmptyArrayEntries||(p=(await e.stateValues.replacementSources)[t]);let f=e.attributes.newNamespace?.primitive,h=await e.stateValues.effectiveAssignNames,y=(await e.stateValues.effectivePropNameBySource)[t];if(y){let t=await replacementFromProp({component:e,components:n,replacementSource:p,propName:y,numReplacementsSoFar:r,numNonStringReplacementsSoFar:a,uniqueIdentifiersUsed:i,compositeAttributesObj:o,componentInfoObjects:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u,flags:c});return{serializedReplacements:processAssignNames({assignNames:h,serializedComponents:t.serializedReplacements,parentName:e.componentName,parentCreatesNewNamespace:f,indOffset:a,componentInfoObjects:s}).serializedComponents,propVariablesCopiedByReplacement:t.propVariablesCopiedByReplacement}}let b=[await d.serialize({copyAll:!m,copyVariants:!m})];b=postProcessCopy({serializedComponents:b,componentName:e.componentName,uniqueIdentifiersUsed:i,addShadowDependencies:m,unlinkExternalCopies:!m});for(let t of b){if("object"!=typeof t)continue;t.attributes||(t.attributes={});let n=convertAttributesForComponentType({attributes:e.attributes,componentType:t.componentType,componentInfoObjects:s,compositeAttributesObj:o,compositeCreatesNewNamespace:f,flags:c});Object.assign(t.attributes,n)}return{serializedReplacements:processAssignNames({assignNames:h,serializedComponents:b,parentName:e.componentName,parentCreatesNewNamespace:f,indOffset:a,componentInfoObjects:s,originalNamesAreConsistent:f&&!h}).serializedComponents}}static async calculateReplacementChanges({component:e,componentChanges:t,components:n,workspace:r,componentInfoObjects:a,flags:i,resolveItem:o,publicCaseInsensitiveAliasSubstitutions:s}){if(await e.stateValues.serializedComponentsForCid)return[];if(null!==await e.stateValues.sourceIndex)return[];let l=this.createAttributesObject(),u=await e.stateValues.replacementSourceIdentities;if(!await e.stateValues.targetComponent||!u){if(await e.stateValues.targetSources)return[];{let t=[];if(e.replacements.length>0){let n={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:e.replacements.length};t.push(n)}let n=0===r.sourceNames.length;r.sourceNames=[],r.numReplacementsBySource=[],r.numNonStringReplacementsBySource=[],r.propVariablesCopiedBySource=[];let o=await this.verifyReplacementsMatchSpecifiedType({component:e,replacementChanges:t,workspace:r,componentInfoObjects:a,compositeAttributesObj:l,flags:i});return n?[]:o.replacementChanges}}if(await e.stateValues.targetInactive){let t=[],n=e.replacements.length;if(n>0){if(e.replacementsToWithhold!==n){let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:n};t.push(e)}t=(await this.verifyReplacementsMatchSpecifiedType({component:e,replacementChanges:t,workspace:r,componentInfoObjects:a,compositeAttributesObj:l,flags:i})).replacementChanges}return t}let c=await o({componentName:e.componentName,type:"determineDependencies",stateVariable:"replacementSources",dependency:"__determine_dependencies",expandComposites:!1});if(!c.success)throw Error(`Couldn't resolve determineDependencies of replacementSources of ${e.componentName}`);let p=await e.stateValues.effectivePropNameBySource;for(let t in u){if(p[t]&&(c=await o({componentName:e.componentName,type:"recalculateDownstreamComponents",stateVariable:"replacementSources",dependency:"target"+t,expandComposites:!1}),!c.success))throw Error(`Couldn't resolve recalculateDownstreamComponents for target${t} of replacementSources of ${e.componentName}`)}let d=[];if(e.replacementsToWithhold>0){let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};d.push(e)}let m=0,f=0,h=[],y=[],b=[],g=Math.max(u.length,r.numReplacementsBySource.length),v=!1;for(let t=0;t<g;t++){let o;if(e.attributes.createComponentOfType?.primitive){let n=await e.stateValues.nComponentsSpecified,r=u.length;o=Math.floor(n/r),t<n%r&&o++}let c=u[t];if(void 0===c){if(r.numReplacementsBySource[t]>0){if(!v){let e=r.numReplacementsBySource.slice(t).reduce(((e,t)=>e+t),0);if(e>0){let t={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:m,numberReplacementsToDelete:e};d.push(t)}v=!0,r.numReplacementsBySource.slice(t).forEach(((e,t)=>r.numReplacementsBySource[t]=0)),r.numNonStringReplacementsBySource.slice(t).forEach(((e,t)=>r.numNonStringReplacementsBySource[t]=0))}r.uniqueIdentifiersUsedBySource[t]=[]}h[t]=0,y[t]=0,b.push([]);continue}let g=r.sourceNames[t],T=void 0===g||c.componentName!==g||v;if(!T)for(let n=0;n<r.numReplacementsBySource[t];n++){let r=e.replacements[m+n];if(!r){T=!0;break}if(!p[t]&&r.shadows&&r.shadows.componentName!==u[t].componentName){T=!0;break}}if(T){let u=0;t in r.numReplacementsBySource&&(u=r.numReplacementsBySource[t]);let c=u;v&&(c=0);let p=r.uniqueIdentifiersUsedBySource[t]=[],g=await this.recreateReplacements({component:e,sourceNum:t,numReplacementsSoFar:m,numNonStringReplacementsSoFar:f,numReplacementsToDelete:c,components:n,uniqueIdentifiersUsed:p,compositeAttributesObj:l,componentInfoObjects:a,nComponentsForSource:o,publicCaseInsensitiveAliasSubstitutions:s,flags:i});m+=g.numReplacements,f+=g.numNonStringReplacements,h[t]=g.numReplacements,y[t]=g.numNonStringReplacements,b[t]=g.propVariablesCopiedByReplacement;let T=g.replacementInstruction;if(!v&&g.numReplacements!==u){let e=r.numReplacementsBySource.slice(t).reduce(((e,t)=>e+t),0);T.numberReplacementsToReplace=e,v=!0,r.numReplacementsBySource.slice(t).forEach(((e,t)=>r.numReplacementsBySource[t]=0)),r.numNonStringReplacementsBySource.slice(t).forEach(((e,t)=>r.numNonStringReplacementsBySource[t]=0))}d.push(T);continue}if(!p[t]&&r.numReplacementsBySource[t]>0){m+=r.numReplacementsBySource[t],f+=r.numNonStringReplacementsBySource[t],h[t]=r.numReplacementsBySource[t],y[t]=r.numNonStringReplacementsBySource[t];continue}let C=r.uniqueIdentifiersUsedBySource[t]=[],N=await this.createReplacementForSource({component:e,sourceNum:t,components:n,numReplacementsSoFar:m,numNonStringReplacementsSoFar:f,uniqueIdentifiersUsed:C,compositeAttributesObj:l,componentInfoObjects:a,nComponentsForSource:o,publicCaseInsensitiveAliasSubstitutions:s,flags:i}),A=N.propVariablesCopiedByReplacement,S=N.serializedReplacements,w=S.length;if(w!==r.numReplacementsBySource[t]){let e=r.numReplacementsBySource.slice(t).reduce(((e,t)=>e+t),0),n={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:m,numberReplacementsToReplace:e,serializedReplacements:S,assignNamesOffset:f};d.push(n),v=!0,r.numReplacementsBySource.slice(t).forEach(((e,t)=>r.numReplacementsBySource[t]=0)),r.numNonStringReplacementsBySource.slice(t).forEach(((e,t)=>r.numNonStringReplacementsBySource[t]=0))}else{let n=0;for(let a=0;a<w;a++){if(A[a].length!==r.propVariablesCopiedBySource[t][a].length||r.propVariablesCopiedBySource[t][a].some(((e,t)=>e!==A[a][t]))||e.replacements[m+a].componentType!==S[a].componentType){let e={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:m+a,numberReplacementsToReplace:1,serializedReplacements:[S[a]],assignNamesOffset:f+n};d.push(e)}"string"!=typeof S[a]&&n++}}let x=S.filter((e=>"string"!=typeof e)).length;m+=w,f+=x,h[t]=w,y[t]=x,b[t]=A}let T=0===r.sourceNames.length;r.numReplacementsBySource=h,r.numNonStringReplacementsBySource=y,r.sourceNames=u.map((e=>e.componentName)),r.propVariablesCopiedBySource=b;let C=await this.verifyReplacementsMatchSpecifiedType({component:e,replacementChanges:d,workspace:r,componentInfoObjects:a,compositeAttributesObj:l,flags:i});return T&&0===r.sourceNames.length?[]:C.replacementChanges}static async recreateReplacements({component:e,sourceNum:t,numReplacementsSoFar:n,numNonStringReplacementsSoFar:r,numReplacementsToDelete:a,uniqueIdentifiersUsed:i,components:o,compositeAttributesObj:s,componentInfoObjects:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c,flags:p}){let d=await this.createReplacementForSource({component:e,sourceNum:t,numReplacementsSoFar:n,numNonStringReplacementsSoFar:r,components:o,uniqueIdentifiersUsed:i,compositeAttributesObj:s,componentInfoObjects:l,nComponentsForSource:u,publicCaseInsensitiveAliasSubstitutions:c,flags:p}),m=d.propVariablesCopiedByReplacement,f=d.serializedReplacements,h={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:a,serializedReplacements:f,assignNamesOffset:r};return{numReplacements:f.length,numNonStringReplacements:f.filter((e=>"string"!=typeof e)).length,propVariablesCopiedByReplacement:m,replacementInstruction:h}}}async function replacementFromProp({component:e,components:t,replacementSource:n,propName:r,uniqueIdentifiersUsed:a,compositeAttributesObj:i,componentInfoObjects:o,nComponentsForSource:s,publicCaseInsensitiveAliasSubstitutions:l,flags:u}){let c=[],p=[],d=e.attributes.newNamespace?.primitive,m=-1,f=t[n.componentName],h=l({stateVariables:[r],componentClass:f.constructor})[0];if(void 0===h||"__not_public"===h.slice(0,12))return console.warn(`Could not find prop ${r} on a component of type ${n.componentType}`),{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let y=f.state[h],b=await y.value,g=await e.stateValues.link;if(y.isArray||y.isArrayEntry){let t,r,l,b;if(y.isArray?(t=y,l=await y.arraySize,r=y.getAllArrayKeys(l,!1)):(t=f.state[y.arrayStateVariable],r=await y.unflattenedArrayKeys,b=await y.arrayKeys),t.shadowingInstructions?.hasVariableComponentType&&(await e.stateValues.replacementSources,!t.shadowingInstructions.createComponentOfType))return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let v=y.wrappingComponents,T=v.length,C=s;if(y.isArray)C=l.slice(0,l.length-T).reduce(((e,t)=>e*t),1);else if(0===b.length)C=0;else if(0===T)C=b.length;else if(T>=y.nDimensions)C=1;else if(T===y.nDimensions-1)C=r.length;else{C=flattenLevels(r,y.nDimensions-T-1).length}if(0===T){let s=flattenDeep(r);for(let r=0;r<C;r++){let l=s[r];if(await e.stateValues.removeEmptyArrayEntries){if(!l)continue;let e=t.keyToIndex(l);Array.isArray(e)||(e=[e]);let n=await t.value;for(let t of e)n=n[t];if(null==n)continue}m++;let h=p[m]=[],b=t.shadowingInstructions.createComponentOfType;if(Array.isArray(b)&&(b=b[t.keyToIndex(l)]?b[t.keyToIndex(l)]:b[0]),l){let r=t.arrayVarNameFromArrayKey(l);h.push(r);let s,p,m=getUniqueIdentifierFromBase(n.componentName+"|shadow|"+r,a),v=convertAttributesForComponentType({attributes:e.attributes,componentType:b,componentInfoObjects:o,compositeAttributesObj:i,compositeCreatesNewNamespace:d,flags:u});if(t.shadowingInstructions.addAttributeComponentsShadowingStateVariables){s={};for(let e in t.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let n=t.shadowingInstructions.addAttributeComponentsShadowingStateVariables[e].stateVariableToShadow,r=f.state[n];r.isArray&&(n=r.arrayVarNameFromArrayKey(l)),s[e]={stateVariableToShadow:n}}}if(t.shadowingInstructions.addStateVariablesShadowingStateVariables){p={};for(let e in t.shadowingInstructions.addStateVariablesShadowingStateVariables){let n=t.shadowingInstructions.addStateVariablesShadowingStateVariables[e].stateVariableToShadow,r=f.state[n];r.isArray&&(n=r.arrayVarNameFromArrayKey(l)),p[e]={stateVariableToShadow:n}}}if(g){let t={};if(s){let n=o.allComponentClasses[b].createAttributesObject();for(let r in s){let a=s[r].stateVariableToShadow,i={componentType:n[r].createComponentOfType,downstreamDependencies:{[f.componentName]:[{compositeName:e.componentName,dependencyType:"referenceShadow",propVariable:a}]}};t[r]={component:i}}}Object.assign(t,v),c.push({componentType:b,attributes:t,downstreamDependencies:{[n.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:r,additionalStateVariableShadowing:p}]},uniqueIdentifier:m})}else{let e={};if(s){let t={};for(let e in s){let n=s[e].stateVariableToShadow,r=f.state[n],a=await r.value;r.isArray&&(a=a[r.keyToIndex[l]]),f.state[n].usedDefault||(t[e]=a)}let n=convertAttributesForComponentType({attributes:t,componentType:b,componentInfoObjects:o,flags:u});if(y.shadowingInstructions.attributeComponentsToShadow)for(let e of y.shadowingInstructions.attributeComponentsToShadow)f.attributes[e]?.component&&(n[e]={component:await(f.attributes[e]?.component.serialize({copyAll:!0,copyVariants:!0}))});Object.assign(e,n)}Object.assign(e,v);let n="value",r=o.allComponentClasses[b];r.primaryStateVariableForDefinition&&(n=r.primaryStateVariableForDefinition);let a=t.keyToIndex(l);Array.isArray(a)||(a=[a]);let i=await t.value;for(let e of a)i=i[e];let p={componentType:b,attributes:e,state:{[n]:i},uniqueIdentifier:m};c.push(p)}}else{let e=getUniqueIdentifierFromBase(b+"|empty",a);c.push({componentType:b,uniqueIdentifier:e})}}}else{let s=async function(r,i){let l=[],c=[];if(i>1)for(let e of r){let t=await s(e,i-1);l.push(...t.pieces),c.push(...t.propVariablesCopiedByPiece)}else for(let i of r){let r,s,p=t.arrayVarNameFromArrayKey(i),d=[p],m=getUniqueIdentifierFromBase(n.componentName+"|shadow|"+p,a),h=t.shadowingInstructions.createComponentOfType;if(Array.isArray(h)&&(h=h[t.keyToIndex(i)]),t.shadowingInstructions.addAttributeComponentsShadowingStateVariables){r={};for(let e in t.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let n=t.shadowingInstructions.addAttributeComponentsShadowingStateVariables[e].stateVariableToShadow,a=f.state[n];a.isArray&&(n=a.arrayVarNameFromArrayKey(i)),r[e]={stateVariableToShadow:n}}}if(t.shadowingInstructions.addStateVariablesShadowingStateVariables){s={};for(let e in t.shadowingInstructions.addStateVariablesShadowingStateVariables){let n=t.shadowingInstructions.addStateVariablesShadowingStateVariables[e].stateVariableToShadow,r=f.state[n];r.isArray&&(n=r.arrayVarNameFromArrayKey(i)),s[e]={stateVariableToShadow:n}}}if(g){let t={};if(r){let n=o.allComponentClasses[h].createAttributesObject();for(let a in r){let i=r[a].stateVariableToShadow,o={componentType:n[a].createComponentOfType,downstreamDependencies:{[f.componentName]:[{compositeName:e.componentName,dependencyType:"referenceShadow",propVariable:i}]}};t[a]={component:o}}}l.push({componentType:h,attributes:t,downstreamDependencies:{[n.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:p,additionalStateVariableShadowing:s}]},uniqueIdentifier:m})}else{let e={};if(r){let t={};for(let e in r){let n=r[e].stateVariableToShadow,a=f.state[n],o=await a.value;a.isArray&&(o=o[a.keyToIndex[i]]),f.state[n].usedDefault||(t[e]=o)}let n=convertAttributesForComponentType({attributes:t,componentType:h,componentInfoObjects:o,flags:u});if(y.shadowingInstructions.attributeComponentsToShadow)for(let e of y.shadowingInstructions.attributeComponentsToShadow)f.attributes[e]?.component&&(n[e]={component:await(f.attributes[e]?.component.serialize({copyAll:!0,copyVariants:!0}))});Object.assign(e,n)}let n="value",a=o.allComponentClasses[h];a.primaryStateVariableForDefinition&&(n=a.primaryStateVariableForDefinition);let s=t.keyToIndex(i);Array.isArray(s)||(s=[s]);let c=await t.value;for(let e of s)c=c[e];let p={componentType:h,attributes:e,state:{[n]:c},uniqueIdentifier:m};l.push(p)}c.push(d)}let p=v[i-1];if(l.length>0&&p&&p.length>0){for(let e=p.length-1;e>=0;e--){let t="object"==typeof p[e]?p[e].componentType:p[e],n=getUniqueIdentifierFromBase(t+"|wrapper",a),r=[],i={};for(let e of l)if(e.isAttribute){let t=e.isAttribute;delete e.isAttribute,i[t]={component:e}}else r.push(e);l=[{componentType:t,children:r,attributes:i,uniqueIdentifier:n,skipSugar:!0}],"object"==typeof p[e]&&(p[e].doenetAttributes&&(l[0].doenetAttributes=Object.assign({},p[e].doenetAttributes)),p[e].isAttribute&&(l[0].isAttribute=p[e].isAttribute))}c=[flattenDeep(c)]}return{pieces:l,propVariablesCopiedByPiece:c}},l=await s(r,y.nDimensions),T=l.pieces;p=l.propVariablesCopiedByPiece;for(let t of T){if("object"!=typeof t)continue;t.attributes||(t.attributes={});let r=convertAttributesForComponentType({attributes:e.attributes,componentType:t.componentType,componentInfoObjects:o,compositeAttributesObj:i,compositeCreatesNewNamespace:d,flags:u});Object.assign(t.attributes,r),g&&(t.downstreamDependencies={[n.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:h,ignorePrimaryStateVariable:!0}]})}if(m+=T.length,c.push(...T),T.length<C)for(let e=T.length;e<C;e++){let n;m++,p[m]=[];let r,i=v[0];i&&i.length>0?"object"==typeof i[0]?(n=i[0].componentType,r=Object.assign({},i[0].doenetAttributes)):n=i[0]:(n=t.shadowingInstructions.createComponentOfType,Array.isArray(n)&&(n=y.isArrayEntry?n[t.keyToIndex(b[e])]:n[e]));let o={componentType:n,uniqueIdentifier:getUniqueIdentifierFromBase(n+"|empty",a)};r&&(o.doenetAttributes=r),c.push(o)}else if(T>C)throw Error(`Something went wrong when creating replacements for ${e.componentName} as we ended up with too many replacements`)}}else{if(y.shadowingInstructions?.hasVariableComponentType&&await y.value,!y.shadowingInstructions?.createComponentOfType)return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};m++,(p[m]=[]).push(h);let t=getUniqueIdentifierFromBase(f.componentName+"|shadow|"+h,a);if("string"===y.shadowingInstructions.createComponentOfType)c.push(await y.value);else{let n=convertAttributesForComponentType({attributes:e.attributes,componentType:y.shadowingInstructions.createComponentOfType,componentInfoObjects:o,compositeAttributesObj:i,compositeCreatesNewNamespace:d,flags:u});if(g){let r={};if(y.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let t=o.allComponentClasses[y.shadowingInstructions.createComponentOfType].createAttributesObject();for(let n in y.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let a=y.shadowingInstructions.addAttributeComponentsShadowingStateVariables[n].stateVariableToShadow,i={componentType:t[n].createComponentOfType,downstreamDependencies:{[f.componentName]:[{compositeName:e.componentName,dependencyType:"referenceShadow",propVariable:a}]}};r[n]={component:i}}}Object.assign(r,n),c.push({componentType:y.shadowingInstructions.createComponentOfType,attributes:r,downstreamDependencies:{[f.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:h,additionalStateVariableShadowing:y.shadowingInstructions.addStateVariablesShadowingStateVariables}]},uniqueIdentifier:t})}else{let e={};if(y.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let t={};for(let e in y.shadowingInstructions.addAttributeComponentsShadowingStateVariables){let n=y.shadowingInstructions.addAttributeComponentsShadowingStateVariables[e].stateVariableToShadow,r=await f.state[n].value;f.state[n].usedDefault||(t[e]=r)}let n=convertAttributesForComponentType({attributes:t,componentType:y.shadowingInstructions.createComponentOfType,componentInfoObjects:o,flags:u});if(y.shadowingInstructions.attributeComponentsToShadow)for(let e of y.shadowingInstructions.attributeComponentsToShadow)f.attributes[e]?.component&&(n[e]={component:await(f.attributes[e]?.component.serialize({copyAll:!0,copyVariants:!0}))});Object.assign(e,n)}Object.assign(e,n);let r="value",a=o.allComponentClasses[y.shadowingInstructions.createComponentOfType];a.primaryStateVariableForDefinition&&(r=a.primaryStateVariableForDefinition);let i={componentType:y.shadowingInstructions.createComponentOfType,attributes:e,state:{[r]:b},uniqueIdentifier:t};c.push(i)}}}return{serializedReplacements:c,propVariablesCopiedByReplacement:p}}class Extract extends CompositeComponent{static componentType="extract";static assignNamesToReplacements=!0;static acceptAnyAttribute=!0;static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(){let e=super.createAttributesObject();return delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.assignNamesSkip={createPrimitiveOfType:"number"},e.prop={createPrimitiveOfType:"string"},e.createComponentOfType={createPrimitiveOfType:"string"},e.nComponents={createPrimitiveOfType:"number"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.link={returnDependencies:()=>({}),definition:()=>({setValue:{link:!0}})},e.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{setValue:{propName:e.propName}}}},e.sourceComponents={stateVariablesDeterminingDependencies:["propName","componentIndex","propIndex"],additionalStateVariablesDefined:["effectivePropNameBySource"],returnDependencies:function({stateValues:e}){let t,n;return null!==e.componentIndex&&(n=Number(e.componentIndex)),Number.isInteger(n)&&(t=[n-1]),{children:{dependencyType:"child",childGroups:["anything"],variableNames:[e.propName],variablesOptional:!0,childIndices:t,propIndex:e.propIndex,publicCaseInsensitiveVariableMatch:!0,useMappedVariableNames:!0},propName:{dependencyType:"stateVariable",variableName:"propName"}}},definition:function({dependencyValues:e}){let t=e.children,n=[];for(let r of t){let t;r.stateValues&&(t=Object.keys(r.stateValues)[0]),t||(t=e.propName),n.push(t)}return{setValue:{sourceComponents:t,effectivePropNameBySource:n}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({replacementClasses:{dependencyType:"stateVariable",variableName:"sourceComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({sourceComponents:{dependencyType:"stateVariable",variableName:"sourceComponents"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{needsReplacementsUpdatedWhenStale:!0}})},e}static async createSerializedReplacements({component:e,components:t,workspace:n,componentInfoObjects:r,flags:a,publicCaseInsensitiveAliasSubstitutions:i}){let o=[],s=[],l=0;n.propVariablesCopiedBySource=[],n.uniqueIdentifiersUsedBySource={};let u=this.createAttributesObject(),c=await e.stateValues.sourceComponents;for(let a=0;a<c.length;a++)if(void 0!==c[a]){let c=n.uniqueIdentifiersUsedBySource[a]=[],p=await this.createReplacementForSource({component:e,sourceNum:a,components:t,numReplacementsSoFar:l,uniqueIdentifiersUsed:c,componentInfoObjects:r,compositeAttributesObj:u,publicCaseInsensitiveAliasSubstitutions:i});n.propVariablesCopiedBySource[a]=p.propVariablesCopiedByReplacement;let d=p.serializedReplacements;s[a]=d.length,l+=d.length,o.push(...d)}else s[a]=0;return n.numReplacementsBySource=s,n.sourceNames=c.map((e=>e.componentName)),{replacements:o}}static async createReplacementForSource({component:e,components:t,sourceNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:a,componentInfoObjects:i,compositeAttributesObj:o,publicCaseInsensitiveAliasSubstitutions:s}){let l=(await e.stateValues.effectivePropNameBySource)[n],u=await replacementFromProp({component:e,components:t,replacementSource:(await e.stateValues.sourceComponents)[n],propName:l,uniqueIdentifiersUsed:a,compositeAttributesObj:o,componentInfoObjects:i,publicCaseInsensitiveAliasSubstitutions:s}),c=u.serializedReplacements,p=u.propVariablesCopiedByReplacement,d=e.attributes.newNamespace?.primitive;return c=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:c,parentName:e.componentName,indOffset:r,parentCreatesNewNamespace:d,componentInfoObjects:i}).serializedComponents,{serializedReplacements:c,propVariablesCopiedByReplacement:p}}static async calculateReplacementChanges({component:e,components:t,workspace:n,componentInfoObjects:r,flags:a,publicCaseInsensitiveAliasSubstitutions:i}){let o=[],s=0,l=[],u=[],c=this.createAttributesObject(),p=await e.stateValues.sourceComponents,d=Math.max(p.length,n.numReplacementsBySource.length),m=!1;for(let a=0;a<d;a++){let d=p[a];if(void 0===d){if(n.numReplacementsBySource[a]>0){if(!m){let e=n.numReplacementsBySource.slice(a).reduce(((e,t)=>e+t),0);if(e>0){let t={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToDelete:e};o.push(t)}m=!0,n.numReplacementsBySource.slice(a).forEach(((e,t)=>n.numReplacementsBySource[t]=0))}n.uniqueIdentifiersUsedBySource[a]=[]}l[a]=0,u.push([]);continue}let f=n.sourceNames[a],h=void 0===f||d.componentName!==f||m;if(!h)for(let t=0;t<n.numReplacementsBySource[a];t++){if(!e.replacements[s+t]){h=!0;break}}if(h){let p=0;void 0!==f&&(p=n.numReplacementsBySource[a]);let d=p;m&&(d=0);let h=n.uniqueIdentifiersUsedBySource[a]=[],y=await this.recreateReplacements({component:e,sourceNum:a,numReplacementsSoFar:s,numReplacementsToDelete:d,components:t,uniqueIdentifiersUsed:h,componentInfoObjects:r,compositeAttributesObj:c,publicCaseInsensitiveAliasSubstitutions:i});s+=y.numReplacements,l[a]=y.numReplacements,u[a]=y.propVariablesCopiedByReplacement;let b=y.replacementInstruction;if(!m&&y.numReplacements!==p){let e=n.numReplacementsBySource.slice(a).reduce(((e,t)=>e+t),0);b.numberReplacementsToReplace=e,m=!0,n.numReplacementsBySource.slice(a).forEach(((e,t)=>n.numReplacementsBySource[t]=0))}o.push(b);continue}let y=n.uniqueIdentifiersUsedBySource[a]=[],b=await this.createReplacementForSource({component:e,sourceNum:a,components:t,numReplacementsSoFar:s,uniqueIdentifiersUsed:y,componentInfoObjects:r,compositeAttributesObj:c,publicCaseInsensitiveAliasSubstitutions:i}),g=b.propVariablesCopiedByReplacement,v=b.serializedReplacements,T=v.length;if(T!==n.numReplacementsBySource[a]){let e=n.numReplacementsBySource.slice(a).reduce(((e,t)=>e+t),0),t={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToReplace:e,serializedReplacements:v,assignNamesOffset:s};o.push(t),m=!0,n.numReplacementsBySource.slice(a).forEach(((e,t)=>n.numReplacementsBySource[t]=0))}else for(let e=0;e<T;e++)if(g[e].length!==n.propVariablesCopiedBySource[a][e].length||n.propVariablesCopiedBySource[a][e].some(((t,n)=>t!==g[e][n]))){let t={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s+e,numberReplacementsToReplace:1,serializedReplacements:[v[e]],assignNamesOffset:s+e};o.push(t)}s+=T,l[a]=T,u[a]=g}return n.numReplacementsBySource=l,n.sourceNames=p.map((e=>e.componentName)),n.propVariablesCopiedBySource=u,o}static async recreateReplacements({component:e,sourceNum:t,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:a,components:i,componentInfoObjects:o,compositeAttributesObj:s,publicCaseInsensitiveAliasSubstitutions:l}){let u=await this.createReplacementForSource({component:e,sourceNum:t,numReplacementsSoFar:n,components:i,uniqueIdentifiersUsed:a,componentInfoObjects:o,compositeAttributesObj:s,publicCaseInsensitiveAliasSubstitutions:l}),c=u.propVariablesCopiedByReplacement,p=u.serializedReplacements,d={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:p,assignNamesOffset:n};return{numReplacements:p.length,propVariablesCopiedByReplacement:c,replacementInstruction:d}}}class Collect extends CompositeComponent{static componentType="collect";static assignNamesToReplacements=!0;static acceptTarget=!0;static acceptAnyAttribute=!0;static stateVariableToEvaluateAfterReplacements="needsReplacementsUpdatedWhenStale";static createAttributesObject(){let e=super.createAttributesObject();return delete e.disabled,delete e.modifyIndirectly,delete e.fixed,delete e.styleNumber,delete e.isResponse,e.assignNamesSkip={createPrimitiveOfType:"number"},e.prop={createPrimitiveOfType:"string"},e.maximumNumber={createComponentOfType:"number",createStateVariable:"maximumNumber",defaultValue:null,public:!0},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.targetAttributesToIgnore={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnore",defaultValue:[],public:!0},e.targetAttributesToIgnoreRecursively={createComponentOfType:"textList",createStateVariable:"targetAttributesToIgnoreRecursively",defaultValue:["isResponse"],public:!0},e.componentTypes={createComponentOfType:"textList"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.link={returnDependencies:()=>({}),definition:()=>({setValue:{link:!0}})},e.targetComponent={shadowVariable:!0,returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{setValue:{targetComponent:e.targetComponent}}}},e.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies:({stateValues:e})=>e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{},definition:function({dependencyValues:e}){return{setValue:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},e.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition:function({dependencyValues:e}){return null===e.targetComponent?(console.warn("No copy target"),{setValue:{targetName:""}}):{setValue:{targetName:e.targetComponent.componentName}}}},e.propName={shadowVariable:!0,returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{setValue:{propName:e.propName}}}},e.componentTypesToCollect={shadowVariable:!0,additionalStateVariablesDefined:[{variableName:"componentClassesToCollect",shadowVariable:!0}],returnDependencies:()=>({componentTypesAttr:{dependencyType:"attributeComponent",attributeName:"componentTypes",variableNames:["texts"]}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[],r=[];if(null!==e.componentTypesAttr)for(let a of e.componentTypesAttr.stateValues.texts){let e=t.componentTypeLowerCaseMapping[a.toLowerCase()],i=t.allComponentClasses[e];if(i)n.push(e),r.push(i);else{let e="Cannot collect component type "+a+". Component type not found.";console.warn(e)}}return{setValue:{componentTypesToCollect:n,componentClassesToCollect:r}}}},e.collectedComponents={stateVariablesDeterminingDependencies:["componentTypesToCollect","targetName","propName","componentIndex","propIndex"],additionalStateVariablesDefined:["effectivePropNameByComponent"],returnDependencies:function({stateValues:e}){if(!e.targetName)return{};let t={dependencyType:"descendant",ancestorName:e.targetName,componentTypes:e.componentTypesToCollect,useReplacementsForComposites:!0,includeNonActiveChildren:!0,recurseToMatchedChildren:!1,componentIndex:e.componentIndex};return e.propName&&(t.variableNames=[e.propName],t.variablesOptional=!0,t.propIndex=e.propIndex,t.publicCaseInsensitiveVariableMatch=!0,t.useMappedVariableNames=!0),{descendants:t,maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},propName:{dependencyType:"stateVariable",variableName:"propName"}}},definition:function({dependencyValues:e}){let t=e.descendants;if(t||(t=[]),null!==e.maximumNumber&&t.length>e.maximumNumber){let n=Math.max(0,Math.floor(e.maximumNumber));t=t.slice(0,n)}let n=[];for(let r of t){let t;r.stateValues&&(t=Object.keys(r.stateValues)[0]),!t&&e.propName&&(t=e.propName),n.push(t)}return{setValue:{collectedComponents:t,effectivePropNameByComponent:n}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{needsReplacementsUpdatedWhenStale:!0}})},e}static async createSerializedReplacements({component:e,components:t,workspace:n,componentInfoObjects:r,nComponentsForSource:a,publicCaseInsensitiveAliasSubstitutions:i,flags:o}){if(!await e.stateValues.targetComponent)return{replacements:[]};let s=[],l=[],u=0,c=[];n.propVariablesCopiedByCollected=[],n.uniqueIdentifiersUsedByCollected={};let p=this.createAttributesObject(),d=await e.stateValues.collectedComponents;for(let m=0;m<d.length;m++)if(d[m]){let d=n.uniqueIdentifiersUsedByCollected[m]=[],f=await this.createReplacementForCollected({component:e,collectedNum:m,components:t,numReplacementsSoFar:u,uniqueIdentifiersUsed:d,componentInfoObjects:r,compositeAttributesObj:p,nComponentsForSource:a,publicCaseInsensitiveAliasSubstitutions:i,flags:o});n.propVariablesCopiedByCollected[m]=f.propVariablesCopiedByReplacement;let h=f.serializedReplacements;l[m]=h.length,u+=h.length,s.push(...h),c[m]=h.map((e=>e.componentName))}else l[m]=0,c[m]=[],n.propVariablesCopiedByCollected[m]=[];return n.numReplacementsByCollected=l,n.collectedNames=d.map((e=>e.componentName)),n.replacementNamesByCollected=c,{replacements:s}}static async createReplacementForCollected({component:e,components:t,collectedNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:a,componentInfoObjects:i,compositeAttributesObj:o,nComponentsForSource:s,publicCaseInsensitiveAliasSubstitutions:l,flags:u}){let c=(await e.stateValues.collectedComponents)[n],p=t[c.componentName],d=[],m=[];if(!p)return{serializedReplacements:d,propVariablesCopiedByReplacement:m};let f=e.attributes.newNamespace?.primitive,h=(await e.stateValues.effectivePropNameByComponent)[n];if(h){let n=await replacementFromProp({component:e,components:t,replacementSource:c,propName:h,uniqueIdentifiersUsed:a,compositeAttributesObj:o,componentInfoObjects:i,nComponentsForSource:s,publicCaseInsensitiveAliasSubstitutions:l});d=n.serializedReplacements,m=n.propVariablesCopiedByReplacement}else{d=postProcessCopy({serializedComponents:[await p.serialize()],componentName:e.componentName,uniqueIdentifiersUsed:a,identifierPrefix:n+"|"});for(let t of d){t.attributes||(t.attributes={});let n=convertAttributesForComponentType({attributes:e.attributes,componentType:t.componentType,componentInfoObjects:i,compositeAttributesObj:o,compositeCreatesNewNamespace:f,flags:u});Object.assign(t.attributes,n)}}return d=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:d,parentName:e.componentName,indOffset:r,parentCreatesNewNamespace:f,componentInfoObjects:i}).serializedComponents,{serializedReplacements:d,propVariablesCopiedByReplacement:m}}static async calculateReplacementChanges({component:e,componentChanges:t,components:n,workspace:r,componentInfoObjects:a,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:o,flags:s}){let l=0;for(let t=0;t<r.numReplacementsByCollected.length;t++){let n=[];for(let[a,i]of r.replacementNamesByCollected[t].entries())e.replacements[l]&&e.replacements[l].componentName===i?l++:n.push(a);for(let e of n.reverse())r.replacementNamesByCollected[t].splice(e,1),r.propVariablesCopiedByCollected[t].splice(e,1);r.numReplacementsByCollected[t]-=n.length}let u=[],c=0,p=[],d=[],m=[],f=await e.stateValues.collectedComponents,h=Math.max(f.length,r.numReplacementsByCollected.length),y=!1,b=this.createAttributesObject();for(let t=0;t<h;t++){let l=f[t];if(void 0===l){if(r.numReplacementsByCollected[t]>0){if(!y){let e=r.numReplacementsByCollected.slice(t).reduce(((e,t)=>e+t),0);if(e>0){let t={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:c,numberReplacementsToDelete:e};u.push(t)}y=!0,r.numReplacementsByCollected.slice(t).forEach(((e,t)=>r.numReplacementsByCollected[t]=0))}r.uniqueIdentifiersUsedByCollected[t]=[]}p[t]=0,d.push([]),m.push([]);continue}let h=r.collectedNames[t];if(void 0===h||l.componentName!==h||y){let l=0;void 0!==h&&(l=r.numReplacementsByCollected[t]);let f=l;y&&(f=0);let g=r.uniqueIdentifiersUsedByCollected[t]=[],v=await this.recreateReplacements({component:e,collectedNum:t,numReplacementsSoFar:c,numReplacementsToDelete:f,components:n,uniqueIdentifiersUsed:g,componentInfoObjects:a,compositeAttributesObj:b,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:o,flags:s});c+=v.numReplacements,p[t]=v.numReplacements,d[t]=v.propVariablesCopiedByReplacement;let T=v.replacementInstruction;if(m[t]=T.serializedReplacements.map((e=>e.componentName)),!y&&v.numReplacements!==l){let e=r.numReplacementsByCollected.slice(t).reduce(((e,t)=>e+t),0);T.numberReplacementsToReplace=e,y=!0,r.numReplacementsByCollected.slice(t).forEach(((e,t)=>r.numReplacementsByCollected[t]=0))}u.push(T);continue}if(!await e.stateValues.propName){c+=r.numReplacementsByCollected[t],p[t]=r.numReplacementsByCollected[t],m[t]=r.replacementNamesByCollected[t],d[t]=[];continue}let g=r.uniqueIdentifiersUsedByCollected[t]=[],v=await this.createReplacementForCollected({component:e,collectedNum:t,components:n,numReplacementsSoFar:c,uniqueIdentifiersUsed:g,componentInfoObjects:a,compositeAttributesObj:b,nComponentsForSource:i,publicCaseInsensitiveAliasSubstitutions:o,flags:s}),T=v.propVariablesCopiedByReplacement,C=v.serializedReplacements,N=C.length;if(N!==r.numReplacementsByCollected[t]){let e=r.numReplacementsByCollected.slice(t).reduce(((e,t)=>e+t),0),n={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c,numberReplacementsToReplace:e,serializedReplacements:C,assignNamesOffset:c};u.push(n),y=!0,r.numReplacementsByCollected.slice(t).forEach(((e,t)=>r.numReplacementsByCollected[t]=0))}else for(let e=0;e<N;e++)if(T[e].length!==r.propVariablesCopiedByCollected[t][e].length||r.propVariablesCopiedByCollected[t][e].some(((t,n)=>t!==T[e][n]))){let t={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c+e,numberReplacementsToReplace:1,serializedReplacements:[C[e]],assignNamesOffset:c+e};u.push(t)}c+=N,p[t]=N,d[t]=T,m[t]=C.map((e=>e.componentName))}return r.numReplacementsByCollected=p,r.collectedNames=f.map((e=>e.componentName)),r.propVariablesCopiedByCollected=d,r.replacementNamesByCollected=m,u}static async recreateReplacements({component:e,collectedNum:t,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:a,components:i,componentInfoObjects:o,compositeAttributesObj:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u,flags:c}){let p=await this.createReplacementForCollected({component:e,collectedNum:t,components:i,numReplacementsSoFar:n,uniqueIdentifiersUsed:a,componentInfoObjects:o,compositeAttributesObj:s,nComponentsForSource:l,publicCaseInsensitiveAliasSubstitutions:u,flags:c}),d=p.propVariablesCopiedByReplacement,m=p.serializedReplacements,f={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:m,assignNamesOffset:n};return{numReplacements:m.length,propVariablesCopiedByReplacement:d,replacementInstruction:f}}}class Ref extends InlineComponent{static componentType="ref";static renderChildren=!0;static acceptTarget=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.textType={createComponentOfType:"text",createStateVariable:"textType",defaultValue:"type-global",public:!0},e.uri={createPrimitiveOfType:"string",createStateVariable:"uri",defaultValue:null,public:!0,forRenderer:!0},e.createButton={createComponentOfType:"boolean",createStateVariable:"createButton",defaultValue:!1,forRenderer:!0},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{setValue:{targetComponent:e.targetComponent}}}},e.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies:({stateValues:e})=>e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{},definition:function({dependencyValues:e}){return{setValue:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},e.targetName={forRenderer:!0,returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},uri:{dependencyType:"stateVariable",variableName:"uri"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},targetAttribute:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:function({dependencyValues:e}){if(e.uri){if(e.targetAttribute){let t=e.targetAttribute;return"/"!==t[0]&&(t="/"+t),{setValue:{targetName:t}}}return{setValue:{targetName:""}}}return null===e.targetComponent||e.targetInactive?{setValue:{targetName:""}}:{setValue:{targetName:e.targetComponent.componentName}}}},e.cid={forRenderer:!0,additionalStateVariablesDefined:[{variableName:"doenetId",forRenderer:!0},{variableName:"pageNumber",forRenderer:!0},{variableName:"variantIndex",forRenderer:!0},{variableName:"edit",forRenderer:!0},{variableName:"draft",forRenderer:!0}],returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:e}){if(!e.uri||"doenet:"!==e.uri.substring(0,7).toLowerCase())return{setValue:{cid:null,doenetId:null,pageNumber:null,variantIndex:null,edit:null,draft:null}};let t=null,n=null,r=null,a=null,i=null,o=null,s=e.uri.match(/[:&]cid=([^&]+)/i);return s&&(t=s[1]),s=e.uri.match(/[:&]doenetid=([^&]+)/i),s&&(n=s[1]),s=e.uri.match(/[:&]page=([^&]+)/i),s&&(r=Number(s[1]),!Number.isInteger(r)&&r>=1&&(r=1)),s=e.uri.match(/[:&]variant=([^&]+)/i),s&&(a=Number(s[1]),!Number.isInteger(a)&&a>=1&&(a=1)),s=e.uri.match(/[:&]edit=([^&]+)/i),s&&(o="true"===s[1].toLowerCase()),s=e.uri.match(/[:&]draft=([^&]+)/i),s&&(i="true"===s[1].toLowerCase()),{setValue:{cid:t,doenetId:n,pageNumber:r,variantIndex:a,edit:o,draft:i}}}},e.linkText={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["targetName"],returnDependencies({stateValues:e}){let t={allChildren:{dependencyType:"child",childGroups:["anything"],variableNames:["text"],variablesOptional:!0},uri:{dependencyType:"stateVariable",variableName:"uri"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"}};return e.targetName&&(t.equationTag={dependencyType:"stateVariable",componentName:e.targetName,variableName:"equationTag",variablesOptional:!0},t.title={dependencyType:"stateVariable",componentName:e.targetName,variableName:"title",variablesOptional:!0}),t},definition:function({dependencyValues:e}){let t="";if(0===e.allChildren.length)null!==e.uri?t=e.uri:e.targetInactive||(null!==e.title?t=e.title:null!==e.equationTag&&(t="("+e.equationTag+")"));else for(let n of e.allChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text&&(t+=n.stateValues.text);return t||(t="???"),{setValue:{linkText:t}}}},e}}class Coords extends MathComponent{static componentType="coords";static rendererType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.createVectors={createComponentOfType:"boolean",createStateVariable:"createVectors",defaultValue:!0,public:!0},e}}class LineSegment extends GraphicalComponent{static componentType="lineSegment";actions={moveLineSegment:this.moveLineSegment.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.endpoints={createComponentOfType:"_pointListComponent"},e.showCoordsWhenDragging={createComponentOfType:"boolean",createStateVariable:"showCoordsWhenDragging",defaultValue:!0,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" line segment"}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){if(null!==e.endpointsAttr){return{setValue:{nDimensions:e.endpointsAttr.stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}}return{setValue:{nDimensions:2}}}},e.endpoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"endpointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["endpointX","endpoint"],hasEssential:!0,set:convertValueToMathExpression,defaultValueByArrayKey:e=>me$3.fromAst("0,0"===e?1:0),getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("endpointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("endpoints"===t)return"endpoint"+e;if("endpoint"===t.slice(0,8)){let n=Number(t.slice(8));if(Number.isInteger(n)&&n>0)return`endpointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[2,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={endpointsAttr:{dependencyType:"attributeComponent",attributeName:"endpoints",variableNames:["pointX"+a]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t,arraySize:n}){let r={},a={};for(let n of t){let[t,i]=n.split(","),o=Number(t)+1+"_"+(Number(i)+1);null!==e[n].endpointsAttr&&e[n].endpointsAttr.stateValues["pointX"+o]?r[n]=e[n].endpointsAttr.stateValues["pointX"+o]:a[n]=!0}let i={};return Object.keys(r).length>0&&(i.setValue={endpoints:r}),Object.keys(a).length>0&&(i.useEssentialOrDefaultValue={endpoints:a}),i},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.endpoints){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);null!==t[r].endpointsAttr&&t[r].endpointsAttr.stateValues["pointX"+s]?i.push({setDependency:n[r].endpointsAttr,desiredValue:e.endpoints[r],childIndex:0,variableIndex:0}):i.push({setEssentialValue:"endpoints",value:{[r]:e.endpoints[r]}})}return{success:!0,instructions:i}}},e.numericalEndpoints={isArray:!0,entryPrefixes:["numericalEndpoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>Number.isNaN(e.nDimensions)?[0]:[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={endpoint:{dependencyType:"stateVariable",variableName:"endpoint"+(Number(n)+1)}};return{globalDependencies:{nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},dependenciesByKey:t}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){if(Number.isNaN(e.nDimensions))return{};let r={};for(let a of n){let n=t[a].endpoint,i=[];for(let t=0;t<e.nDimensions;t++){let e=n[t].evaluate_to_constant();Number.isFinite(e)||(e=NaN),i.push(e)}r[a]=i}return{setValue:{numericalEndpoints:r}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition({dependencyValues:e}){let t=e.numericalEndpoints[0][0],n=e.numericalEndpoints[0][1],r=e.numericalEndpoints[1][0],a=e.numericalEndpoints[1][1],i=Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a),o=2!==e.nDimensions||!i||r===t&&a===n;return{setValue:{nearestPoint:function({variables:e,scales:i}){if(o)return{};let s=i[0],l=i[1],u=(r-t)/s,c=(a-n)/l,p=u*u+c*c,d=((e.x1-t)/s*u+(e.x2-n)/l*c)/p,m={};return m=d<=0?{x1:t,x2:n}:d>=1?{x1:r,x2:a}:{x1:t+d*u*s,x2:n+d*c*l},void 0!==e.x3&&(m.x3=0),m}}}}},e.slope={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition({dependencyValues:e}){if(2!==e.nDimensions)return{setValue:{slope:NaN}};let t=e.numericalEndpoints;return{setValue:{slope:(t[1][1]-t[0][1])/(t[1][0]-t[0][0])}}}},e.length={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition({dependencyValues:e}){let t=e.numericalEndpoints,n=0;for(let r=0;r<e.nDimensions;r++)n+=(t[1][r]-t[0][r])**2;return{setValue:{length:Math.sqrt(n)}}}},e}async moveLineSegment({point1coords:e,point2coords:t,transient:n,actionId:r}){let a={};return void 0!==e&&(a["0,0"]=me$3.fromAst(e[0]),a["0,1"]=me$3.fromAst(e[1])),void 0!==t&&(a["1,0"]=me$3.fromAst(t[0]),a["1,1"]=me$3.fromAst(t[1])),n?await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:a}],transient:!0,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:a}],actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{point1:e,point2:t}}})}}class Ray extends GraphicalComponent{static componentType="ray";actions={moveRay:this.moveRay.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.endpoint={createComponentOfType:"point"},e.through={createComponentOfType:"point"},e.direction={createComponentOfType:"vector"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" ray"}}}},e.directionShadow={defaultValue:null,hasEssential:!0,essentialVarName:"direction",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{directionShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"directionShadow",value:convertValueToMathExpression(e.directionShadow)}]}}},e.throughShadow={defaultValue:null,hasEssential:!0,essentialVarName:"through",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{throughShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"throughShadow",value:convertValueToMathExpression(e.throughShadow)}]}}},e.endpointShadow={defaultValue:null,hasEssential:!0,essentialVarName:"endpoint",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{endpointShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"endpointShadow",value:convertValueToMathExpression(e.endpointShadow)}]}}},e.basedOnThrough={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"},endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint"},directionAttr:{dependencyType:"attributeComponent",attributeName:"direction"}}),definition:function({dependencyValues:e}){return null!==e.endpointAttr&&null!==e.directionAttr?(null!==e.throughAttr&&console.warn("Ray is prescribed by through, endpoint, and direction.  Ignoring specified through."),{setValue:{basedOnThrough:!1},checkForActualChange:{basedOnThrough:!0}}):null!==e.throughAttr?{setValue:{basedOnThrough:!0},checkForActualChange:{basedOnThrough:!0}}:{setValue:{basedOnThrough:null!==e.throughShadow},checkForActualChange:{basedOnThrough:!0}}}},e.basedOnEndpoint={returnDependencies:()=>({endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"}}),definition:function({dependencyValues:e}){return null!==e.endpointAttr?{setValue:{basedOnEndpoint:!0},checkForActualChange:{basedOnEndpoint:!0}}:{setValue:{basedOnEndpoint:null!==e.endpointShadow},checkForActualChange:{basedOnEndpoint:!0}}}},e.basedOnDirection={returnDependencies:()=>({directionAttr:{dependencyType:"attributeComponent",attributeName:"direction"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"}}),definition:function({dependencyValues:e}){return null!==e.directionAttr?{setValue:{basedOnDirection:!0},checkForActualChange:{basedOnDirection:!0}}:{setValue:{basedOnDirection:null!==e.directionShadow},checkForActualChange:{basedOnDirection:!0}}}},e.nDimDirection={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:e}){let t={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"},directionAttr:{dependencyType:"attributeComponent",attributeName:"direction",variableNames:["nDimensions"]}};return e.basedOnDirection||(e.basedOnThrough&&(t.nDimThrough={dependencyType:"stateVariable",variableName:"nDimThrough"}),e.basedOnEndpoint&&(t.nDimEndpoint={dependencyType:"stateVariable",variableName:"nDimEndpoint"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnDirection){if(null!==e.directionAttr)t=e.directionAttr.stateValues.nDimensions;else if(e.directionShadow){let n=e.directionShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:2}}else t=e.basedOnThrough?e.basedOnEndpoint?e.nDimThrough===e.nDimEndpoint?e.nDimThrough:NaN:e.nDimThrough:e.basedOnEndpoint?e.nDimEndpoint:2;return{setValue:{nDimDirection:t},checkForActualChange:{nDimDirection:!0}}}},e.nDimThrough={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:e}){let t={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"},throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nDimensions"]}};return e.basedOnThrough||(e.basedOnEndpoint&&(t.nDimEndpoint={dependencyType:"stateVariable",variableName:"nDimEndpoint"}),e.basedOnDirection&&(t.nDimDirection={dependencyType:"stateVariable",variableName:"nDimDirection"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnThrough){if(null!==e.throughAttr)t=e.throughAttr.stateValues.nDimensions;else if(e.throughShadow){let n=e.throughShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:2}}else t=e.basedOnDirection?e.basedOnEndpoint?e.nDimDirection===e.nDimEndpoint?e.nDimDirection:NaN:e.nDimDirection:e.basedOnEndpoint?e.nDimEndpoint:2;return{setValue:{nDimThrough:t},checkForActualChange:{nDimThrough:!0}}}},e.nDimEndpoint={stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough","basedOnEndpoint"],returnDependencies({stateValues:e}){let t={basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"},endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint",variableNames:["nDimensions"]}};return e.basedOnEndpoint||(e.basedOnThrough&&(t.nDimThrough={dependencyType:"stateVariable",variableName:"nDimThrough"}),e.basedOnDirection&&(t.nDimDirection={dependencyType:"stateVariable",variableName:"nDimDirection"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnEndpoint){if(null!==e.endpointAttr)t=e.endpointAttr.stateValues.nDimensions;else if(e.endpointShadow){let n=e.endpointShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:2}}else t=e.basedOnDirection?e.basedOnThrough?e.nDimDirection===e.nDimThrough?e.nDimDirection:NaN:e.nDimDirection:e.basedOnThrough?e.nDimThrough:2;return{setValue:{nDimEndpoint:t},checkForActualChange:{nDimEndpoint:!0}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},nDimDirection:{dependencyType:"stateVariable",variableName:"nDimDirection"},nDimThrough:{dependencyType:"stateVariable",variableName:"nDimThrough"},nDimEndpoint:{dependencyType:"stateVariable",variableName:"nDimEndpoint"}}),definition:function({dependencyValues:e}){let t;if(e.basedOnDirection){if(e.basedOnEndpoint){if(e.nDimDirection!==e.nDimEndpoint)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}}}else if(e.basedOnThrough&&e.nDimDirection!==e.nDimThrough)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};t=e.nDimDirection}else if(e.basedOnEndpoint){if(e.basedOnThrough&&e.nDimEndpoint!==e.nDimThrough)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};t=e.nDimEndpoint}else t=e.basedOnThrough?e.nDimThrough:2;return{setValue:{nDimensions:t},checkForActualChange:{nDimensions:!0}}}},e.direction={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"directionX"===e?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["directionX"],hasEssential:!0,essentialVarName:"direction2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnDirection","basedOnThrough"],returnArraySizeDependencies:()=>({nDimDirection:{dependencyType:"stateVariable",variableName:"nDimDirection"}}),returnArraySize:({dependencyValues:e})=>[e.nDimDirection],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={directionAttr:{dependencyType:"attributeComponent",attributeName:"direction",variableNames:["x"+e]}},!t.basedOnDirection&&t.basedOnThrough&&(n[r].endpointX={dependencyType:"stateVariable",variableName:"endpointX"+e},n[r].throughX={dependencyType:"stateVariable",variableName:"throughX"+e})}return{globalDependencies:{basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},directionShadow:{dependencyType:"stateVariable",variableName:"directionShadow"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={},a={};for(let i of n){let n=Number(i)+1;e.basedOnDirection?null!==t[i].directionAttr?r[i]=t[i].directionAttr.stateValues["x"+n]:null!==e.directionShadow&&(r[i]=e.directionShadow.get_component(Number(i))):e.basedOnThrough?r[i]=t[i].throughX.subtract(t[i].endpointX).simplify():a[i]={defaultValue:me$3.fromAst("0"===i?1:0)}}let i={};return Object.keys(r).length>0&&(i.setValue={direction:r}),Object.keys(a).length>0&&(i.useEssentialOrDefaultValue={direction:a}),i},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.direction)t.basedOnDirection?null!==n[a].directionAttr?i.push({setDependency:r[a].directionAttr,desiredValue:e.direction[a],variableIndex:0}):o=!0:t.basedOnThrough?i.push({setDependency:r[a].throughX,desiredValue:n[a].endpointX.add(e.direction[a]).simplify()}):i.push({setEssentialValue:"direction",value:{[a]:convertValueToMathExpression(e.direction[a])}});if(o)if(a[0]>1){let t=["vector"];for(let n in e.direction)t[Number(n)+1]=e.direction[n].tree;t.length=a[0]+1,i.push({setDependency:"directionShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.direction&&i.push({setDependency:"directionShadow",desiredValue:e.direction[0]});return{success:!0,instructions:i}}},e.through={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"throughX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["throughX"],set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnThrough"],returnArraySizeDependencies:()=>({nDimThrough:{dependencyType:"stateVariable",variableName:"nDimThrough"}}),returnArraySize:({dependencyValues:e})=>[e.nDimThrough],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["x"+e]}},t.basedOnThrough||(n[r].endpointX={dependencyType:"stateVariable",variableName:"endpointX"+e},n[r].directionX={dependencyType:"stateVariable",variableName:"directionX"+e})}return{globalDependencies:{basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},basedOnEndpoint:{dependencyType:"stateVariable",variableName:"basedOnEndpoint"},basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},throughShadow:{dependencyType:"stateVariable",variableName:"throughShadow"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=Number(a)+1;e.basedOnThrough?null!==t[a].throughAttr?r[a]=t[a].throughAttr.stateValues["x"+n]:null!==e.throughShadow&&(r[a]=e.throughShadow.get_component(Number(a))):r[a]=t[a].endpointX.add(t[a].directionX).simplify()}return{setValue:{through:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.through)t.basedOnThrough?n[a].throughAttr&&null!==n[a].throughAttr?i.push({setDependency:r[a].throughAttr,desiredValue:e.through[a],variableIndex:0}):null!==t.throughShadow&&(o=!0):i.push({setDependency:r[a].directionX,desiredValue:e.through[a].subtract(n[a].endpointX).simplify()});if(o)if(a[0]>1){let t=["vector"];for(let n in e.through)t[Number(n)+1]=e.through[n].tree;t.length=a[0]+1,i.push({setDependency:"throughShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.through&&i.push({setDependency:"throughShadow",desiredValue:e.through[0]});return{success:!0,instructions:i}}},e.endpoint={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"endpointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["endpointX"],hasEssential:!0,defaultValueByArrayKey:()=>me$3.fromAst(0),essentialVarName:"endpoint2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnEndpoint","basedOnThrough","basedOnDirection"],returnArraySizeDependencies:()=>({nDimEndpoint:{dependencyType:"stateVariable",variableName:"nDimEndpoint"}}),returnArraySize:({dependencyValues:e})=>[e.nDimEndpoint],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={endpointAttr:{dependencyType:"attributeComponent",attributeName:"endpoint",variableNames:["x"+e]}},t.basedOnEndpoint||t.basedOnThrough&&t.basedOnDirection&&(n[r].throughX={dependencyType:"stateVariable",variableName:"throughX"+e},n[r].directionX={dependencyType:"stateVariable",variableName:"directionX"+e})}return{globalDependencies:{basedOnDirection:{dependencyType:"stateVariable",variableName:"basedOnDirection"},basedOnThrough:{dependencyType:"stateVariable",variableName:"basedOnThrough"},endpointShadow:{dependencyType:"stateVariable",variableName:"endpointShadow"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={},a={};for(let i of n){let n=Number(i)+1;null!==t[i].endpointAttr?r[i]=t[i].endpointAttr.stateValues["x"+n]:null!==e.endpointShadow?r[i]=e.endpointShadow.get_component(Number(i)):e.basedOnThrough&&e.basedOnDirection?r[i]=t[i].throughX.subtract(t[i].directionX).simplify():a[i]=!0}let i={};return Object.keys(r).length>0&&(i.setValue={endpoint:r}),Object.keys(a).length>0&&(i.useEssentialOrDefaultValue={endpoint:a}),i},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.endpoint)n[a].endpointAttr&&null!==n[a].endpointAttr?i.push({setDependency:r[a].endpointAttr,desiredValue:e.endpoint[a],variableIndex:0}):null!==t.endpointShadow?o=!0:t.basedOnThrough&&t.basedOnDirection?i.push({setDependency:r[a].directionX,desiredValue:n[a].throughX.subtract(e.endpoint[a]).simplify()}):i.push({setEssentialValue:"endpoint",value:{[a]:convertValueToMathExpression(e.endpoint[a])}});if(o)if(a[0]>1){let t=["vector"];for(let n in e.endpoint)t[Number(n)+1]=e.endpoint[n].tree;t.length=a[0]+1,i.push({setDependency:"endpointShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.endpoint&&i.push({setDependency:"endpointShadow",desiredValue:e.endpoint[0]});return{success:!0,instructions:i}}},e.numericalEndpoint={forRenderer:!0,returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},endpoint:{dependencyType:"stateVariable",variableName:"endpoint"}}),definition({dependencyValues:e}){if(Number.isNaN(e.nDimensions))return null;let t=e.endpoint,n=[];for(let r=0;r<e.nDimensions;r++){let e=t[r].evaluate_to_constant();Number.isFinite(e)||(e=NaN),n.push(e)}return{setValue:{numericalEndpoint:n}}}},e.numericalThroughpoint={forRenderer:!0,returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},through:{dependencyType:"stateVariable",variableName:"through"}}),definition({dependencyValues:e}){if(Number.isNaN(e.nDimensions))return null;let t=e.through,n=[];for(let r=0;r<e.nDimensions;r++){let e=t[r].evaluate_to_constant();Number.isFinite(e)||(e=NaN),n.push(e)}return{setValue:{numericalThroughpoint:n}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoint:{dependencyType:"stateVariable",variableName:"numericalEndpoint"},numericalThroughpoint:{dependencyType:"stateVariable",variableName:"numericalThroughpoint"}}),definition({dependencyValues:e}){let t=e.numericalEndpoint[0],n=e.numericalEndpoint[1],r=e.numericalThroughpoint[0],a=e.numericalThroughpoint[1],i=Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a),o=2!==e.nDimensions||!i||r===t&&a===n;return{setValue:{nearestPoint:function({variables:e,scales:i}){if(o)return{};let s=i[0],l=i[1],u=(r-t)/s,c=(a-n)/l,p=u*u+c*c,d=((e.x1-t)/s*u+(e.x2-n)/l*c)/p,m={};return m=d<=0?{x1:t,x2:n}:{x1:t+d*u*s,x2:n+d*c*l},void 0!==e.x3&&(m.x3=0),m}}}}},e}async moveRay({endpointcoords:e,throughcoords:t,transient:n,skippable:r,sourceInformation:a,actionId:i}){let o=[];if(void 0!==e){if(await this.stateValues.basedOnThrough&&await this.stateValues.basedOnDirection){let n;if(void 0===t){let t=await this.stateValues.numericalThroughpoint;n=e.map(((e,n)=>t[n]-e))}else n=e.map(((e,n)=>t[n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}else o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"endpoint",value:e.map((e=>me$3.fromAst(e))),sourceInformation:a});if(void 0===t&&!await this.stateValues.basedOnThrough){let t=await this.stateValues.numericalThroughpoint,n=e.map(((e,n)=>t[n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}}if(void 0!==t){if(await this.stateValues.basedOnThrough)o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"through",value:t.map((e=>me$3.fromAst(e))),sourceInformation:a});else{null==e&&(e=await this.stateValues.numericalEndpoint);let n=e.map(((e,n)=>t[n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}if(void 0===e&&await this.stateValues.basedOnThrough&&await this.stateValues.basedOnDirection){let e=await this.stateValues.numericalEndpoint,n=t.map(((t,n)=>t-e[n]));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"direction",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}}return n?await this.coreFunctions.performUpdate({updateInstructions:o,transient:n,skippable:r,actionId:i}):await this.coreFunctions.performUpdate({updateInstructions:o,actionId:i,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{through:t,endpoint:e}}})}}class Polygon extends Polyline{static componentType="polygon";static representsClosedPath=!0;actions={movePolygon:this.movePolygon.bind(this)};get movePolygon(){return this.movePolyline}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t,n=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(n&&(n+=" "),n+=e.selectedStyle.lineStyleWord),t="none"===e.selectedStyle.fillColor?n+" "+e.selectedStyle.lineColorWord:e.selectedStyle.fillColorWord===e.selectedStyle.lineColorWord?"filled "+e.selectedStyle.fillColorWord+" with "+n+" border":"filled "+e.selectedStyle.fillColorWord+" with "+n+" "+e.selectedStyle.lineColorWord+" border",{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t,n=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(n&&(n+=" "),n+=e.selectedStyle.lineStyleWord),t="none"===e.selectedStyle.fillColor?n+" "+e.selectedStyle.lineColorWord+" polygon":e.selectedStyle.fillColorWord===e.selectedStyle.lineColorWord?"filled "+e.selectedStyle.fillColorWord+" polygon with a "+n+" border":"filled "+e.selectedStyle.fillColorWord+" polygon with a "+n+" "+e.selectedStyle.lineColorWord+" border",{setValue:{styleDescriptionWithNoun:t}}}},e.borderStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{borderStyleDescription:t}}}},e.fillStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t;return t="none"===e.selectedStyle.fillColor?"unfilled":e.selectedStyle.fillColorWord,{setValue:{fillStyleDescription:t}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e}){let t,n,r=e.nDimensions,a=e.nVertices,i=e.numericalVertices,o=[],s=i[a-1]?.[0],l=i[a-1]?.[1];for(let e=0;e<a;e++)if(t=s,n=l,s=i[e]?.[0],l=i[e]?.[1],Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(l)){let e=s-t,r=l-n;0===e&&0===r?o.push(null):o.push([e,r])}else o.push(null);return{setValue:{nearestPoint:function({variables:e,scales:t}){let n=t[0],s=t[1];if(2!==r||0===a)return{};let l,u,c=1/0,p={},d=e.x1?.evaluate_to_constant(),m=e.x2?.evaluate_to_constant(),f=i[a-1][0],h=i[a-1][1];for(let e=0;e<a;e++){l=f,u=h,f=i[e][0],h=i[e][1];let t=o[e];if(null===t)continue;let r,a=t[0]/n,y=t[1]/s,b=((d-l)/n*a+(m-u)/s*y)/(a*a+y*y);r=b<=0?{x1:l,x2:u}:b>=1?{x1:f,x2:h}:{x1:l+b*a*n,x2:u+b*y*s};let g=Math.pow((d-r.x1)/n,2)+Math.pow((m-r.x2)/s,2);g<c&&(c=g,p=r)}return void 0!==e.x3&&Object.keys(p).length>0&&(p.x3=0),p}}}}},e}}class Triangle extends Polygon{static componentType="triangle";static rendererType="polygon";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=e.styleDescriptionWithNoun.definition;return e.styleDescriptionWithNoun.definition=function({dependencyValues:e}){let n=t({dependencyValues:e}).setValue.styleDescriptionWithNoun;return n=n.replaceAll("polygon","triangle"),{setValue:{styleDescriptionWithNoun:n}}},e.vertices.hasEssential=!0,e.vertices.defaultValueByArrayKey=function(e){return["0,1","1,0"].includes(e)?me$3.fromAst(1):me$3.fromAst(0)},e.vertices.returnArraySizeDependencies=()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),e.vertices.returnArraySize=function({dependencyValues:e}){return[3,e.nDimensions]},e.vertices.arrayDefinitionByKey=function({dependencyValuesByKey:e,arrayKeys:t}){let n={},r={};for(let a of t){let[t,i]=a.split(","),o=Number(t)+1+"_"+(Number(i)+1),s=e[a].vertices;null!==s&&s.stateValues["pointX"+o]?n[a]=s.stateValues["pointX"+o]:r[a]=!0}return{setValue:{vertices:n},useEssentialOrDefaultValue:{vertices:r}}},e.vertices.inverseArrayDefinitionByKey=async function({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.vertices){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);null!==t[r].vertices&&t[r].vertices.stateValues["pointX"+s]?i.push({setDependency:n[r].vertices,desiredValue:e.vertices[r],variableIndex:0}):i.push({setEssentialValue:"vertices",value:{[r]:e.vertices[r].simplify()}})}return{success:!0,instructions:i}},e.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{nVertices:3}})},e}}class Rectangle extends Polygon{static componentType="rectangle";static rendererType="polygon";static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.vertices={createComponentOfType:"_pointListComponent"},e.center={createComponentOfType:"point"},e.width={createComponentOfType:"number"},e.height={createComponentOfType:"number"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=e.styleDescriptionWithNoun.definition;return e.styleDescriptionWithNoun.definition=function({dependencyValues:e}){let n=t({dependencyValues:e}).setValue.styleDescriptionWithNoun;return n=n.replaceAll("polygon","rectangle"),{setValue:{styleDescriptionWithNoun:n}}},e.nVerticesSpecified={returnDependencies:()=>({verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return null!==e.verticesAttr?{setValue:{nVerticesSpecified:e.verticesAttr.stateValues.nPoints}}:{setValue:{nVerticesSpecified:0}}}},e.essentialVertex={isArray:!0,entryPrefixes:["essentialVertexX"],defaultValueByArrayKey:()=>me$3.fromAst(0),hasEssential:!0,returnArraySizeDependencies:()=>({nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}}),returnArraySize:({dependencyValues:e})=>[0===e.nVerticesSpecified?2:0],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:function({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialVertex:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t=[];for(let n in e.essentialVertex)t.push({setEssentialValue:"essentialVertex",value:{[n]:e.essentialVertex[n]}});return{success:!0,instructions:t}}},e.haveSpecifiedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:e})=>({setValue:{haveSpecifiedCenter:null!==e.centerAttr}})},e.specifiedCenter={isArray:!0,entryPrefixes:["specifiedCenterX"],returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize:({dependencyValues:e})=>[e.haveSpecifiedCenter?2:0],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=Number(r)+1;null!==e[r].centerAttr&&(n[r]=e[r].centerAttr.stateValues["x"+t])}return{setValue:{specifiedCenter:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n}){let r=[];for(let a in e.specifiedCenter)t[a].centerAttr&&null!==t[a].centerAttr&&r.push({setDependency:n[a].centerAttr,desiredValue:e.specifiedCenter[a],variableIndex:0});return{success:!0,instructions:r}}},e.specifiedWidth={defaultValue:1,hasEssential:!0,essentialVarName:"width",returnDependencies:()=>({widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),definition:({dependencyValues:e})=>null!==e.widthAttr?{setValue:{specifiedWidth:e.widthAttr.stateValues.value}}:(e.haveSpecifiedCenter?1:0)+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedWidth:!0}}:{setValue:{specifiedWidth:null}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>null!==t.widthAttr?{success:!0,instructions:[{setDependency:"widthAttr",desiredValue:e.specifiedWidth,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"specifiedWidth",value:e.specifiedWidth}]}},e.specifiedHeight={defaultValue:1,hasEssential:!0,essentialVarName:"height",returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),definition:({dependencyValues:e})=>null!==e.heightAttr?{setValue:{specifiedHeight:e.heightAttr.stateValues.value}}:(e.haveSpecifiedCenter?1:0)+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedHeight:!0}}:{setValue:{specifiedHeight:null}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>null!==t.heightAttr?{success:!0,instructions:[{setDependency:"heightAttr",desiredValue:e.specifiedHeight,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"specifiedHeight",value:e.specifiedHeight}]}},e.center={public:!0,isArray:!0,entryPrefixes:["centerX"],shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"centerX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_"+e},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_"+e}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].vertex0,a=e[r].vertex2;n[r]=t.add(a).divide(2).simplify()}return{setValue:{center:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,stateValues:r}){let a=[],i=await r.center;for(let r in e.center){let o=Number(r),s=t[r].vertex0,l=t[r].vertex2,u=e.center[o].subtract(i[o]),c=s.add(u).simplify(),p=l.add(u).simplify();a.push({setDependency:n[r].vertex0,desiredValue:c},{setDependency:n[r].vertex2,desiredValue:p})}return{success:!0,instructions:a}}},e.width={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:({})=>({vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_1"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_1"}}),definition({dependencyValues:e}){let t=e.vertex0.evaluate_to_constant(),n=e.vertex2.evaluate_to_constant();return{setValue:{width:Math.abs(t-n)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){let n=t.vertex0.evaluate_to_constant(),r=t.vertex2.evaluate_to_constant(),a=(r+n)/2,i=(r-n<0?-1:1)*Math.max(0,e.width)/2;return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:me$3.fromAst(a-i)},{setDependency:"vertex2",desiredValue:me$3.fromAst(a+i)}]}}},e.height={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:({})=>({vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_2"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_2"}}),definition({dependencyValues:e}){let t=e.vertex0.evaluate_to_constant(),n=e.vertex2.evaluate_to_constant();return{setValue:{height:Math.abs(t-n)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){let n=t.vertex0.evaluate_to_constant(),r=t.vertex2.evaluate_to_constant(),a=(r+n)/2,i=(r-n<0?-1:1)*Math.max(0,e.height)/2;return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:me$3.fromAst(a-i)},{setDependency:"vertex2",desiredValue:me$3.fromAst(a+i)}]}}},e.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"vertexX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("vertexX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("vertices"===t)return"vertex"+e;if("vertex"===t.slice(0,6)){let n=Number(t.slice(6));if(Number.isInteger(n)&&n>0)return`vertexX${n}_${e}`}return null},stateVariablesDeterminingDependencies:["nVerticesSpecified","haveSpecifiedCenter"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[4,2],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={},r={nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}};if(0===t.nVerticesSpecified)if(r.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},t.haveSpecifiedCenter)for(let t of e){let[e,r]=t.split(",");n[t]={specifiedCenter:{dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(r)+1)}},"0"===r?n[t].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}:n[t].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"}}else for(let t of e){let[e,r]=t.split(",");n[t]={essentialVertex:{dependencyType:"stateVariable",variableName:"essentialVertexX"+(Number(r)+1)}},"0"===r?"1"!==e&&"2"!==e||(n[t].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):"2"!==e&&"3"!==e||(n[t].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else if(1===t.nVerticesSpecified)if(r.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},t.haveSpecifiedCenter)for(let t of e){let[e,r]=t.split(","),a="1_"+(Number(r)+1);n[t]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+a]}},("0"===r&&"1"===e||"2"===e||"1"===r&&"2"===e||"3"===e)&&(n[t].specifiedCenter={dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(r)+1)})}else for(let t of e){let[e,r]=t.split(","),a="1_"+(Number(r)+1);n[t]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+a]}},"0"===r?"1"!==e&&"2"!==e||(n[t].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):"2"!==e&&"3"!==e||(n[t].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else for(let t of e){let e,[r,a]=t.split(","),i="1_"+(Number(a)+1),o="2_"+(Number(a)+1);e="0"===r?i:"2"===r?o:"1"===r?"0"===a?o:i:"0"===a?i:o,n[t]={verticesAttr:{dependencyType:"attributeComponent",attributeName:"vertices",variableNames:["pointX"+e]}}}return{dependenciesByKey:n,globalDependencies:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t,globalDependencyValues:n}){let r={};if(0===n.nVerticesSpecified)if(n.haveSpecifiedCenter)for(let n of t){let[t,a]=n.split(","),i=e[n].specifiedCenter;if("0"===a){let a=e[n].specifiedWidth;r[n]="0"===t||"3"===t?i.subtract(a/2):i.add(a/2)}else{let a=e[n].specifiedHeight;r[n]="0"===t||"1"===t?i.subtract(a/2):i.add(a/2)}}else for(let n of t){let[t,a]=n.split(","),i=e[n].essentialVertex;if("0"===a)if("0"===t||"3"===t)r[n]=i;else{let t=e[n].specifiedWidth;r[n]=i.add(t)}else if("0"===t||"1"===t)r[n]=i;else{let t=e[n].specifiedHeight;r[n]=i.add(t)}}else if(1===n.nVerticesSpecified)if(n.haveSpecifiedCenter)for(let n of t){let t,[a,i]=n.split(","),o=e[n].verticesAttr;if(t=null!==o&&1===Object.keys(o.stateValues).length?Object.values(o.stateValues)[0]:me$3.fromAst(""),"0"===i&&("0"===a||"3"===a)||"1"===i&&("0"===a||"1"===a))r[n]=t;else{let a=e[n].specifiedCenter;r[n]=t.add(a.subtract(t).multiply(2))}}else for(let n of t){let t,[a,i]=n.split(","),o=e[n].verticesAttr;if(t=null!==o&&1===Object.keys(o.stateValues).length?Object.values(o.stateValues)[0]:me$3.fromAst(""),"0"===i)if("0"===a||"3"===a)r[n]=t;else{let a=e[n].specifiedWidth;r[n]=t.add(a)}else if("0"===a||"1"===a)r[n]=t;else{let a=e[n].specifiedHeight;r[n]=t.add(a)}}else for(let n of t){let t=e[n].verticesAttr;null!==t&&1===Object.keys(t.stateValues).length?r[n]=Object.values(t.stateValues)[0]:r[n]=me$3.fromAst("")}return{setValue:{vertices:r}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,globalDependencyValues:n,stateValues:r,workspace:a,initialChange:i,dependencyNamesByKey:o}){if(i&&!await r.draggable)return{success:!1};if(!a.v0){let e=await r.vertices;a.v0=[...e[0]],a.v2=[...e[2]]}let s,l,u,c,p,d;for(let t in e.vertices){let[n,r]=t.split(","),i=e.vertices[t];"0"===n?a.v0[Number(r)]=i:"2"===n?a.v2[Number(r)]=i:"1"===n?"0"===r?a.v2[Number(r)]=i:a.v0[Number(r)]=i:"0"===r?a.v0[Number(r)]=i:a.v2[Number(r)]=i,"0"===r?(s=t,"0"===n||"3"===n?u=t:p=t):(l=t,"0"===n||"1"===n?c=t:d=t)}let m=[];if(0===n.nVerticesSpecified)if(n.haveSpecifiedCenter){if(void 0!==s){let e=a.v2[0].subtract(a.v0[0]).evaluate_to_constant(),t=a.v2[0].add(a.v0[0]).divide(2).simplify();m.push({setDependency:o[s].specifiedWidth,desiredValue:e},{setDependency:o[s].specifiedCenter,desiredValue:t})}if(void 0!==l){let e=a.v2[1].subtract(a.v0[1]).evaluate_to_constant(),t=a.v2[1].add(a.v0[1]).divide(2).simplify();m.push({setDependency:o[l].specifiedHeight,desiredValue:e},{setDependency:o[l].specifiedCenter,desiredValue:t})}}else{if(void 0!==u){let e=a.v0[0].simplify();m.push({setDependency:o[u].essentialVertex,desiredValue:e})}if(void 0!==p){let e=a.v2[0].subtract(a.v0[0]).evaluate_to_constant();m.push({setDependency:o[p].specifiedWidth,desiredValue:e})}if(void 0!==c){let e=a.v0[1].simplify();m.push({setDependency:o[c].essentialVertex,desiredValue:e})}if(void 0!==d){let e=a.v2[1].subtract(a.v0[1]).evaluate_to_constant();m.push({setDependency:o[d].specifiedHeight,desiredValue:e})}}else if(1===n.nVerticesSpecified)if(n.haveSpecifiedCenter){if(void 0!==u){let e=a.v0[0].simplify();m.push({setDependency:o[u].verticesAttr,desiredValue:e,variableIndex:0})}if(void 0!==p){let e=a.v2[0].add(a.v0[0]).divide(2).simplify();m.push({setDependency:o[p].specifiedCenter,desiredValue:e})}if(void 0!==c){let e=a.v0[1].simplify();m.push({setDependency:o[c].verticesAttr,desiredValue:e,variableIndex:0})}if(void 0!==d){let e=a.v2[1].add(a.v0[1]).divide(2).simplify();m.push({setDependency:o[d].specifiedCenter,desiredValue:e})}}else{if(void 0!==u){let e=a.v0[0].simplify();m.push({setDependency:o[u].verticesAttr,desiredValue:e,variableIndex:0})}if(void 0!==p){let e=a.v2[0].subtract(a.v0[0]).evaluate_to_constant();m.push({setDependency:o[p].specifiedWidth,desiredValue:e})}if(void 0!==c){let e=a.v0[1].simplify();m.push({setDependency:o[c].verticesAttr,desiredValue:e,variableIndex:0})}if(void 0!==d){let e=a.v2[1].subtract(a.v0[1]).evaluate_to_constant();m.push({setDependency:o[d].specifiedHeight,desiredValue:e})}}else void 0!==u&&m.push({setDependency:o[u].verticesAttr,desiredValue:a.v0[0],variableIndex:0}),void 0!==p&&m.push({setDependency:o[p].verticesAttr,desiredValue:a.v2[0],variableIndex:0}),void 0!==c&&m.push({setDependency:o[c].verticesAttr,desiredValue:a.v0[1],variableIndex:0}),void 0!==d&&m.push({setDependency:o[d].verticesAttr,desiredValue:a.v2[1],variableIndex:0});return{success:!0,instructions:m}}},e.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{nVertices:4}})},e}async movePolygon({pointCoords:e,transient:t,sourceInformation:n,actionId:r}){let a=[],i={};for(let t in e)i[t+",0"]=me$3.fromAst(e[t][0]),i[t+",1"]=me$3.fromAst(e[t][1]);if(a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:i,sourceInformation:n}),1===Object.keys(e).length){let t=Number(Object.keys(e)[0]),n=me$3.fromAst(e[t][0]),r=me$3.fromAst(e[t][1]),i=(t+2)%4,o=await this.stateValues.vertices,s=o[i][0],l=o[i][1];if(await this.stateValues.nVerticesSpecified<2)if(await this.stateValues.haveSpecifiedCenter){let e,i;0===t?(e=n.add(s).divide(2),i=r.add(l).divide(2)):1===t?i=r.add(l).divide(2):3===t&&(e=n.add(s).divide(2)),void 0!==e&&a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{0:e.simplify()}}),void 0!==i&&a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{1:i.simplify()}})}else{let e,i;0===t?(e=s.subtract(n),i=l.subtract(r)):1===t?i=l.subtract(r):3===t&&(e=s.subtract(n)),void 0!==e&&a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedWidth",value:e.simplify()}),void 0!==i&&a.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedHeight",value:i.simplify()})}}return t?await this.coreFunctions.performUpdate({updateInstructions:a,transient:t,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:a,actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:e}}})}}class Circle extends Curve{static componentType="circle";static rendererType="circle";static representsClosedPath=!0;actions={moveCircle:this.moveCircle.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.through={createComponentOfType:"_pointListComponent"},e.center={createComponentOfType:"point"},e.radius={createComponentOfType:"math"},delete e.parMin,delete e.parMax,delete e.variable,e}static returnChildGroups(){return[]}static returnStateVariableDefinitions(e){let t=GraphicalComponent.returnStateVariableDefinitions(e);return t.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t,n=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(n&&(n+=" "),n+=e.selectedStyle.lineStyleWord),t="none"===e.selectedStyle.fillColor?n+" "+e.selectedStyle.lineColorWord:e.selectedStyle.fillColorWord===e.selectedStyle.lineColorWord?"filled "+e.selectedStyle.fillColorWord+" with "+n+" border":"filled "+e.selectedStyle.fillColorWord+" with "+n+" "+e.selectedStyle.lineColorWord+" border",{setValue:{styleDescription:t}}}},t.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t,n=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(n&&(n+=" "),n+=e.selectedStyle.lineStyleWord),t="none"===e.selectedStyle.fillColor?n+" "+e.selectedStyle.lineColorWord+" circle":e.selectedStyle.fillColorWord===e.selectedStyle.lineColorWord?"filled "+e.selectedStyle.fillColorWord+" circle with a "+n+" border":"filled "+e.selectedStyle.fillColorWord+" circle with a "+n+" "+e.selectedStyle.lineColorWord+" border",{setValue:{styleDescriptionWithNoun:t}}}},t.borderStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{borderStyleDescription:t}}}},t.fillStyleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t;return t="none"===e.selectedStyle.fillColor?"unfilled":e.selectedStyle.fillColorWord,{setValue:{fillStyleDescription:t}}}},t.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{curveType:"circle"}})},t.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMax:NaN}})},t.parMin={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMin:NaN}})},t.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[0],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:()=>({setValue:{fs:{}}})},t.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return null!==e.throughAttr?{setValue:{nThroughPoints:e.throughAttr.stateValues.nPoints}}:{setValue:{nThroughPoints:0}}}},t.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"throughPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("throughPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("throughPoints"===t)return"throughPoint"+e;if("throughPoint"===t.slice(0,12)){let n=Number(t.slice(12));if(Number.isInteger(n)&&n>0)return`throughPointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+a]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let[t,a]=r.split(","),i=Number(t)+1+"_"+(Number(a)+1),o=e[r].throughAttr;null!==o&&o.stateValues["pointX"+i]?n[r]=o.stateValues["pointX"+i]:n[r]=me$3.fromAst("")}return{setValue:{throughPoints:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.throughPoints){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);if(null===t[r].throughAttr||!t[r].throughAttr.stateValues["pointX"+s])return{success:!1};i.push({setDependency:n[r].throughAttr,desiredValue:e.throughPoints[r],variableIndex:0})}return{success:!0,instructions:i}}},t.havePrescribedCenter={returnDependencies:()=>({centerAttr:{dependencyType:"attributeComponent",attributeName:"center"}}),definition:({dependencyValues:e})=>({setValue:{havePrescribedCenter:null!==e.centerAttr},checkForActualChange:{havePrescribedCenter:!0}})},t.prescribedCenter={isArray:!0,entryPrefixes:["prescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize:({dependencyValues:e})=>[e.havePrescribedCenter?2:0],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={centerAttr:{dependencyType:"attributeComponent",attributeName:"center",variableNames:["x"+e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let e of n){let n=Number(e)+1;null!==t[e].centerAttr&&(r[e]=t[e].centerAttr.stateValues["x"+n],r[e]||(r[e]=me$3.fromAst("")))}return{setValue:{prescribedCenter:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[];for(let t of Object.keys(e.prescribedCenter).reverse())null!==n[t].centerAttr&&i.push({setDependency:r[t].centerAttr,desiredValue:e.prescribedCenter[t],variableIndex:0});return{success:!0,instructions:i}}},t.prescribedRadius={defaultValue:null,returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius",variableNames:["value"]}}),definition:function({dependencyValues:e}){return null!==e.radiusAttr?{setValue:{prescribedRadius:e.radiusAttr.stateValues.value}}:{setValue:{prescribedRadius:null}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return null!==t.radiusAttr?{success:!0,instructions:[{setDependency:"radiusAttr",desiredValue:e.prescribedRadius,childIndex:0,variableIndex:0}]}:{success:!1}}},t.havePrescribedRadius={returnDependencies:()=>({radiusAttr:{dependencyType:"attributeComponent",attributeName:"radius"}}),definition:({dependencyValues:e})=>({setValue:{havePrescribedRadius:null!==e.radiusAttr},checkForActualChange:{havePrescribedRadius:!0}})},t.numericalPrescribedRadius={returnDependencies:()=>({prescribedRadius:{dependencyType:"stateVariable",variableName:"prescribedRadius"}}),additionalStateVariablesDefined:["haveNonNumericalPrescribedRadius"],definition:function({dependencyValues:e}){let t,n=!1;return null===e.prescribedRadius?t=null:(t=e.prescribedRadius.evaluate_to_constant(),Number.isFinite(t)||(t=NaN,n=!0)),{setValue:{haveNonNumericalPrescribedRadius:n,numericalPrescribedRadius:t},checkForActualChange:{haveNonNumericalEntriesNumericalRadius:!0}}},inverseDefinition:async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){return await n.haveNonNumericalPrescribedRadius?{success:!1}:void 0!==e.numericalPrescribedRadius?null===t.prescribedRadius?{success:!1}:{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:me$3.fromAst(e.numericalPrescribedRadius)}]}:{success:!1}}},t.numericalPrescribedCenter={isArray:!0,entryPrefixes:["numericalPrescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize:({dependencyValues:e})=>[e.havePrescribedCenter?2:0],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=Number(n)+1;t[n]={prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+e}}}return{dependenciesByKey:t}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].prescribedCenterX;t?(n[r]=t.evaluate_to_constant(),Number.isFinite(n[r])||(n[r]=NaN)):n[r]=NaN}return{setValue:{numericalPrescribedCenter:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.numericalPrescribedCenter)n.push({setDependency:t[r].prescribedCenterX,desiredValue:me$3.fromAst(e.numericalPrescribedCenter[r])});return{success:!0,instructions:n}}},t.haveNonNumericalPrescribedCenter={returnDependencies:()=>({numericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"}}),definition({dependencyValues:e}){let t=e.numericalPrescribedCenter.some((e=>!Number.isFinite(e)));return{setValue:{haveNonNumericalPrescribedCenter:t},checkForActualChange:{haveNonNumericalPrescribedCenter:!0}}}},t.numericalThroughPoints={returnDependencies:()=>({throughPoints:{dependencyType:"stateVariable",variableName:"throughPoints"}}),additionalStateVariablesDefined:["haveNonNumericalThroughPoints"],definition:function({dependencyValues:e}){let t=!1,n=[];for(let r of e.throughPoints){let e=[];for(let n=0;n<2;n++){let a;try{a=r[n].evaluate_to_constant()}catch(n){console.warn("Invalid point of circle"),t=!0,e=[];break}if(!Number.isFinite(a)){t=!0,e=[];break}e.push(a)}if(!(e.length>0)){n=[];break}n.push(e)}return{setValue:{haveNonNumericalThroughPoints:t,numericalThroughPoints:n},checkForActualChange:{haveNonNumericalThroughPoints:!0}}},inverseDefinition:async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){if(await n.haveNonNumericalThroughPoints)return{success:!1};if(void 0!==e.numericalThroughPoints){let t={};for(let[n,r]of e.numericalThroughPoints.entries())t[n+",0"]=me$3.fromAst(r[0]),t[n+",1"]=me$3.fromAst(r[1]);return{success:!0,instructions:[{setDependency:"throughPoints",desiredValue:t}]}}return{success:!1}}},t.haveNumericalEntries={returnDependencies:()=>({haveNonNumericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},haveNonNumericalThroughPoints:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:({dependencyValues:e})=>({setValue:{haveNumericalEntries:!(e.haveNonNumericalPrescribedCenter||e.haveNonNumericalPrescribedRadius||e.haveNonNumericalThroughPoints)}})},t.numericalRadiusCalculatedWithCenter={additionalStateVariablesDefined:["numericalCenterCalculatedWithRadius"],returnDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:function({dependencyValues:e}){if(e.haveNonNumericalThroughPoints){let t="Haven't implemented circle through "+e.nThroughPoints+" points";return t+=" in case where don't have numerical values.",console.warn(t),{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}if(2===e.nThroughPoints){let{numericalCenter:t,numericalRadius:n}=circleFromTwoNumericalPoints({point1:e.numericalThroughPoints[0],point2:e.numericalThroughPoints[1]});return{setValue:{numericalCenterCalculatedWithRadius:t,numericalRadiusCalculatedWithCenter:n}}}if(3===e.nThroughPoints){let t,n,r=e.numericalThroughPoints[0][0],a=e.numericalThroughPoints[1][0],i=e.numericalThroughPoints[2][0],o=e.numericalThroughPoints[0][1],s=e.numericalThroughPoints[1][1],l=e.numericalThroughPoints[2][1];if(r===a&&o===s)if(r===i&&o===l)t=[r,o],n=0;else{let e=circleFromTwoNumericalPoints({point1:[r,o],point2:[i,l]});t=e.numericalCenter,n=e.numericalRadius}else if(r===i&&o===l||a===i&&s===l){let e=circleFromTwoNumericalPoints({point1:[r,o],point2:[a,s]});t=e.numericalCenter,n=e.numericalRadius}else{let e=r*r+o*o,u=a*a+s*s,c=i*i+l*l,p=r*(s-l)-o*(a-i)+a*l-i*s,d=e*(l-s)+u*(o-l)+c*(s-o),m=e*(a-i)+u*(i-r)+c*(r-a),f=e*(i*s-a*l)+u*(r*l-i*o)+c*(a*o-r*s);0!==p?(t=[-d/(2*p),-m/(2*p)],n=Math.sqrt((d*d+m*m-4*p*f)/(4*p*p))):(t=[NaN,NaN],n=NaN)}return{setValue:{numericalCenterCalculatedWithRadius:t,numericalRadiusCalculatedWithCenter:n}}}return e.nThroughPoints>3?(console.warn("Can't calculate circle through more than 3 points"),{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}):{setValue:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}},t.essentialRadius={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{essentialRadius:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"essentialRadius",value:e.essentialRadius}]}}},t.numericalRadius={forRenderer:!0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnDependencies:function({stateValues:e}){let t={haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},essentialRadius:{dependencyType:"stateVariable",variableName:"essentialRadius"}};return e.havePrescribedRadius?(t.numericalPrescribedRadius={dependencyType:"stateVariable",variableName:"numericalPrescribedRadius"},e.havePrescribedCenter&&e.nThroughPoints>0&&(t.haveCenterRadiusPoints={dependencyType:"value",value:!0})):e.havePrescribedCenter?1===e.nThroughPoints&&(t.haveNonNumericalPrescribedCenter={dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},t.numericalPrescribedCenter={dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"},t.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},t.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}):e.nThroughPoints>1&&(t.numericalRadiusCalculatedWithCenter={dependencyType:"stateVariable",variableName:"numericalRadiusCalculatedWithCenter"},t.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}),t},definition:function({dependencyValues:e}){if(e.haveNonNumericalPrescribedRadius||e.haveNonNumericalPrescribedCenter||e.haveNonNumericalThroughPoints)return{setValue:{numericalRadius:NaN}};if(void 0!==e.numericalPrescribedRadius)return e.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{numericalRadius:NaN}}):{setValue:{numericalRadius:Math.max(0,e.numericalPrescribedRadius)}};if(void 0!==e.numericalPrescribedCenter){if(0===e.nThroughPoints){let t=e.essentialRadius;if(t instanceof me$3.class){try{t=t.evaluate_to_constant()}catch(e){}Number.isFinite(t)||(t=NaN)}return{setValue:{numericalRadius:t}}}if(1===e.nThroughPoints){let t=e.numericalThroughPoints[0];return void 0===t?{setValue:{numericalRadius:NaN}}:{setValue:{numericalRadius:Math.sqrt(Math.pow(t[0]-e.numericalPrescribedCenter[0],2)+Math.pow(t[1]-e.numericalPrescribedCenter[1],2))}}}return console.warn("Can't calculate circle with specified center through more than 1 point"),{setValue:{numericalRadius:NaN}}}if(e.nThroughPoints<2){let t=e.essentialRadius;if(t instanceof me$3.class){try{t=t.evaluate_to_constant()}catch(e){}Number.isFinite(t)||(t=NaN)}return{setValue:{numericalRadius:t}}}return{setValue:{numericalRadius:e.numericalRadiusCalculatedWithCenter}}},inverseDefinition:async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){if(void 0!==t.numericalPrescribedRadius)return{success:!0,instructions:[{setDependency:"numericalPrescribedRadius",desiredValue:Math.max(0,e.numericalRadius)}]};if(void 0!==t.numericalPrescribedCenter){if(0===t.nThroughPoints)return{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:Math.max(0,e.numericalRadius)}]};if(1===t.nThroughPoints){let t=Math.max(0,e.numericalRadius),r=(await n.throughAngles)[0];if(!Number.isFinite(r))return{success:!1};let a=await n.numericalCenter;return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:[[a[0]+t*Math.cos(r),a[1]+t*Math.sin(r)]]}]}}return{success:!1}}if(t.nThroughPoints<2)return{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:Math.max(0,e.numericalRadius)}]};{let r=[],a=Math.max(0,e.numericalRadius);for(let e=0;e<t.nThroughPoints;e++){let t=(await n.throughAngles)[e];if(!Number.isFinite(t))return{success:!1};let i=await n.numericalCenter,o=[i[0]+a*Math.cos(t),i[1]+a*Math.sin(t)];r.push(o)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:r}]}}}},t.essentialCenter={isArray:!0,entryPrefixes:["essentialCenterX"],hasEssential:!0,defaultValueByArrayKey:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:function({arrayKeys:e}){let t={};for(let n of e)t[n]=!0;return{useEssentialOrDefaultValue:{essentialCenter:t}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,stateValues:t,workspace:n}){let r=[];for(let t in e.essentialCenter)r.push({setEssentialValue:"essentialCenter",value:{[t]:e.essentialCenter[t]}});return{success:!0,instructions:r}}},t.numericalCenter={forRenderer:!0,isArray:!0,entryPrefixes:["numericalCenterX"],stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={},r={};if(t.havePrescribedCenter){for(let t of e){let e=Number(t)+1;r[t]={numericalPrescribedCenterX:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenterX"+e}}}t.havePrescribedRadius&&t.nThroughPoints>0&&(n.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else{for(let t of e){let e=Number(t)+1;r[t]={essentialCenterX:{dependencyType:"stateVariable",variableName:"essentialCenterX"+e}}}n.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},n.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"},n.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},t.havePrescribedRadius||1==t.nThroughPoints?n.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:t.nThroughPoints>1&&(n.numericalCenterCalculatedWithRadius={dependencyType:"stateVariable",variableName:"numericalCenterCalculatedWithRadius"})}return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n)if(void 0!==t[a].numericalPrescribedCenterX){if(e.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{numericalCenter:[NaN,NaN]}};r[a]=t[a].numericalPrescribedCenterX}if(Object.keys(r).length>0)return{setValue:{numericalCenter:r}};if(e.haveNonNumericalPrescribedRadius||e.haveNonNumericalThroughPoints)return{setValue:{numericalCenter:[NaN,NaN]}};if(void 0!==e.numericalRadius){if(0===e.nThroughPoints){for(let e of n){let n=t[e].essentialCenterX;if(n instanceof me$3.class){try{n=n.evaluate_to_constant()}catch(e){}Number.isFinite(n)||(n=NaN)}r[e]=n}return{setValue:{numericalCenter:r}}}if(1===e.nThroughPoints){if(e.numericalThroughPoints.length<1)return{setValue:{numericalCenter:[NaN,NaN]}};return{setValue:{numericalCenter:[e.numericalThroughPoints[0][0],e.numericalThroughPoints[0][1]-e.numericalRadius]}}}if(2===e.nThroughPoints){if(e.numericalThroughPoints.length<2)return{setValue:{numericalCenter:[NaN,NaN]}};let t=e.numericalRadius,n=e.numericalThroughPoints[0][0],r=e.numericalThroughPoints[1][0],a=e.numericalThroughPoints[0][1],i=e.numericalThroughPoints[1][1],o=Math.pow(n-r,2)+Math.pow(a-i,2),s=t*t;return t<0||4*s<o?(console.warn("Can't find circle through given radius and two points"),{setValue:{numericalCenter:[NaN,NaN]}}):0===o?{setValue:{numericalCenter:[n,a-t]}}:{setValue:{numericalCenter:[.5*(o*(n+r)+(a-i)*Math.sqrt((4*s-o)*o))/o,.5*(o*(a+i)+(r-n)*Math.sqrt((4*s-o)*o))/o]}}}return console.warn("Can't create circle through more than two points with given radius"),{setValue:{numericalCenter:[NaN,NaN]}}}if(0===e.nThroughPoints){for(let e of n){let n=t[e].essentialCenterX;if(n instanceof me$3.class){try{n=n.evaluate_to_constant()}catch(e){}Number.isFinite(n)||(n=NaN)}r[e]=n}return{setValue:{numericalCenter:r}}}return void 0===e.numericalCenterCalculatedWithRadius?{setValue:{numericalCenter:[NaN,NaN]}}:{setValue:{numericalCenter:e.numericalCenterCalculatedWithRadius}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,stateValues:a,workspace:i}){let o=[];for(let t in e.numericalCenter)void 0!==n[t].numericalPrescribedCenterX&&o.push({setDependency:r[t].numericalPrescribedCenterX,desiredValue:e.numericalCenter[t]});if(o.length>0)return{success:!0,instructions:o};if(0===t.nThroughPoints){for(let t in e.numericalCenter)o.push({setDependency:r[t].essentialCenterX,desiredValue:e.numericalCenter[t]});return{success:!0,instructions:o}}{i.desiredCenter||(i.desiredCenter={});for(let t=0;t<2;t++)void 0!==e.numericalCenter[t]?i.desiredCenter[t]=e.numericalCenter[t]:void 0===i.desiredCenter[t]&&(i.desiredCenter[t]=a.numericalCenter[t]);let n=[],r=await a.throughAngles,o=await a.numericalRadius;for(let e=0;e<t.nThroughPoints;e++){let t=r[e];if(!Number.isFinite(t))return{success:!1};let a=[i.desiredCenter[0]+o*Math.cos(t),i.desiredCenter[1]+o*Math.sin(t)];n.push(a)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:n}]}}}},t.throughAngles={forRenderer:!0,defaultValue:[],hasEssential:!0,doNotShadowEssential:!0,returnDependencies:()=>({haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNumericalEntries"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"}}),definition:function({dependencyValues:e}){if(!(e.haveNumericalEntries&&e.nThroughPoints>0&&e.numericalRadius>0&&e.numericalCenter.every((e=>Number.isFinite(e)))))return{useEssentialOrDefaultValue:{throughAngles:!0}};let t=[];for(let n of e.numericalThroughPoints)t.push(Math.atan2(n[1]-e.numericalCenter[1],n[0]-e.numericalCenter[0]));return{setValue:{throughAngles:t},setEssentialValue:{throughAngles:t}}}},t.radius={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnDependencies:function({stateValues:e}){let t={numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},essentialRadius:{dependencyType:"stateVariable",variableName:"essentialRadius"}};return e.havePrescribedRadius?(t.prescribedRadius={dependencyType:"stateVariable",variableName:"prescribedRadius"},e.havePrescribedCenter&&e.nThroughPoints>0&&(t.haveCenterRadiusPoints={dependencyType:"value",value:!0})):e.havePrescribedCenter&&1===e.nThroughPoints&&(t.prescribedCenter={dependencyType:"stateVariable",variableName:"prescribedCenter"},t.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"}),t},definition:function({dependencyValues:e}){if(Number.isFinite(e.numericalRadius))return{setValue:{radius:me$3.fromAst(e.numericalRadius)}};if(void 0!==e.prescribedRadius)return e.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{radius:me$3.fromAst("")}}):{setValue:{radius:e.prescribedRadius}};if(void 0!==e.prescribedCenter){if(0===e.nThroughPoints){let t=e.essentialRadius;return t instanceof me$3.class||(t=Number.isFinite(t)?me$3.fromAst(t):me$3.fromAst("")),{setValue:{radius:t}}}if(1!==e.nThroughPoints)return console.warn("Can't calculate circle with specified center through more than 1 point"),{setValue:{radius:me$3.fromAst("")}};try{let t=e.throughPoints[0],n=t[0],r=t[1],a=e.prescribedCenter[0],i=e.prescribedCenter[1];return{setValue:{radius:n.subtract(a).pow(2).add(r.subtract(i).pow(2)).pow(.5).simplify()}}}catch(e){return console.warn("Invalid center or through points of circle"),{setValue:{radius:me$3.fromAst("")}}}}if(e.nThroughPoints<2){let t=e.essentialRadius;return t instanceof me$3.class||(t=Number.isFinite(t)?me$3.fromAst(t):me$3.fromAst("")),{setValue:{radius:t}}}return console.warn(`Have not implemented circle through ${e.nThroughPoints} points when non-numerical values`),{setValue:{radius:me$3.fromAst("")}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){let n=e.radius.evaluate_to_constant();if(Number.isFinite(n)&&Number.isFinite(t.numericalRadius))return{success:!0,instructions:[{setDependency:"numericalRadius",desiredValue:n}]};if(void 0!==t.prescribedRadius)return{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:e.radius}]};if(0===t.nThroughPoints){return{success:!0,instructions:[{setDependency:"essentialRadius",desiredValue:e.radius}]}}return console.warn("Can't change radius of circle with non-numerical values through points"),{success:!1}}},t.diameter={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition:({dependencyValues:e})=>({setValue:{diameter:e.radius.multiply(2).simplify()}}),inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return{success:!0,instructions:[{setDependency:"radius",desiredValue:e.diameter.divide(2).simplify()}]}}},t.center={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"centerX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["centerX"],stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={},r={};if(t.havePrescribedCenter){n.havePrescribedCenter={dependencyType:"value",value:!0};for(let t of e){let e=Number(t)+1;r[t]={numericalCenterX:{dependencyType:"stateVariable",variableName:"numericalCenterX"+e},prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+e}}}t.havePrescribedRadius&&t.nThroughPoints>0&&(n.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else{for(let t of e){let e=Number(t)+1;r[t]={essentialCenterX:{dependencyType:"stateVariable",variableName:"essentialCenterX"+e}}}n.numericalCenter={dependencyType:"stateVariable",variableName:"numericalCenter"},n.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},n.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"},t.havePrescribedRadius?n.radius={dependencyType:"stateVariable",variableName:"prescribedRadius"}:1==t.nThroughPoints&&(n.radius={dependencyType:"stateVariable",variableName:"radius"})}return{dependenciesByKey:r,globalDependencies:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){if(e.havePrescribedCenter){if(e.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{setValue:{center:[me$3.fromAst(""),me$3.fromAst("")]}};let r={};for(let e of n)Number.isFinite(t[e].numericalCenterX)?r[e]=me$3.fromAst(t[e].numericalCenterX):r[e]=t[e].prescribedCenterX;return{setValue:{center:r}}}if(e.numericalCenter.every((e=>Number.isFinite(e))))return{setValue:{center:e.numericalCenter.map((e=>me$3.fromAst(e)))}};if(void 0!==e.radius){if(0===e.nThroughPoints){let e={};for(let r of n){let n=t[r].essentialCenterX;n instanceof me$3.class||(n=Number.isFinite(n)?me$3.fromAst(n):me$3.fromAst("")),e[r]=n}return{setValue:{center:e}}}if(1===e.nThroughPoints){let t;try{t=[e.throughPoints[0][0],e.throughPoints[0][1].subtract(e.radius).simplify()]}catch(e){t=[me$3.fromAst(""),me$3.fromAst("")]}return{setValue:{center:t}}}return console.warn("Can't create circle through more than one point with given radius when don't have numerical values"),{setValue:{center:[me$3.fromAst(""),me$3.fromAst("")]}}}if(0===e.nThroughPoints){let e={};for(let r of n){let n=t[r].essentialCenterX;n instanceof me$3.class||(n=Number.isFinite(n)?me$3.fromAst(n):me$3.fromAst("")),e[r]=n}return{setValue:{center:e}}}return console.warn("Can't create circle through more than one point when don't have numerical values"),{setValue:{center:[me$3.fromAst(""),me$3.fromAst("")]}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,stateValues:n,dependencyNamesByKey:r,workspace:a}){if(t.havePrescribedCenter){let t=[];for(let n in e.center)t.push({setDependency:r[n].prescribedCenterX,desiredValue:e.center[n],arrayKey:n});return{success:!0,instructions:t}}a.desiredCenter||(a.desiredCenter={});for(let t=0;t<2;t++)void 0!==e.center[t]?a.desiredCenter[t]=e.center[t]:void 0===a.desiredCenter[t]&&(a.desiredCenter[t]=(await n.center)[t]);let i=[],o=!0;for(let e=0;e<2;e++){let t=a.desiredCenter[e].evaluate_to_constant();if(!Number.isFinite(t)){o=!1;break}i.push(t)}if(o&&t.numericalCenter.every((e=>Number.isFinite(e))))return{success:!0,instructions:[{setDependency:"numericalCenter",desiredValue:i}]};if(0===t.nThroughPoints){let t=[];for(let n in e.center)t.push({setDependency:r[n].essentialCenterX,desiredValue:e.center[n],arrayKey:n});return{success:!0,instructions:t}}return console.warn("Haven't implemented changing center of circle through points with non numerical values"),{success:!1}}},t.nearestPoint={returnDependencies:()=>({numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"}}),definition({dependencyValues:e}){let t=e.numericalRadius,n=e.numericalCenter[0],r=e.numericalCenter[1];return{setValue:{nearestPoint:function({variables:e,scales:a}){let i=e.x1?.evaluate_to_constant(),o=e.x2?.evaluate_to_constant();if(!Number.isFinite(i)||!Number.isFinite(o))return{};if(!(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(t)))return{};let s=Math.atan2(o-r,i-n),l={x1:n+t*Math.cos(s),x2:r+t*Math.sin(s)};return void 0!==e.x3&&(l.x3=0),l}}}}},t}async moveCircle({center:e,radius:t,throughAngles:n,transient:r,actionId:a}){let i=[],o=await this.stateValues.nThroughPoints,s=await this.stateValues.numericalPrescribedCenter;if((o<=1||null!==s)&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalCenter",value:e}),o>=1){let r=[];void 0===n&&(n=await this.stateValues.throughAngles),void 0===t&&(t=await this.stateValues.numericalRadius);for(let a=0;a<o;a++){let i=n[a],o=[e[0]+t*Math.cos(i),e[1]+t*Math.sin(i)];r.push(o)}i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalThroughPoints",value:r})}return r?await this.coreFunctions.performUpdate({updateInstructions:i,transient:r,actionId:a}):await this.coreFunctions.performUpdate({updateInstructions:i,actionId:a,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{center:e}}})}}function circleFromTwoNumericalPoints({point1:e,point2:t}){let n=(e[0]+t[0])/2,r=(e[1]+t[1])/2;return{numericalCenter:[n,r],numericalRadius:Math.sqrt(Math.pow(n-e[0],2)+Math.pow(r-e[1],2))}}class Parabola extends Curve{static componentType="parabola";static rendererType="curve";static createAttributesObject(){let e=super.createAttributesObject();return e.through={createComponentOfType:"_pointListComponent"},e.vertex={createComponentOfType:"point",createStateVariable:"prescribedVertex",defaultValue:null},delete e.parMin,delete e.parMax,delete e.variable,e}static returnChildGroups(){return[]}static returnStateVariableDefinitions(e){let t=GraphicalComponent.returnStateVariableDefinitions(e),n=super.returnStateVariableDefinitions(e);return t.graphXmin=n.graphXmin,t.styleDescription=n.styleDescription,t.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" parabola"}}}},t.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{curveType:"function"}})},t.parMax={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMax:1/0}})},t.parMin={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{parMin:-1/0}})},t.aShadow={defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{aShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"aShadow",value:e.aShadow}]}}},t.nThroughPoints={returnDependencies:()=>({throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return null===e.throughAttr?{setValue:{nThroughPoints:0}}:{setValue:{nThroughPoints:e.throughAttr.stateValues.nPoints}}}},t.throughPoints={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"throughPointX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("throughPointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("throughPoints"===t)return"throughPoint"+e;if("throughPoint"===t.slice(0,12)){let n=Number(t.slice(12));if(Number.isInteger(n)&&n>0)return`throughPointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints,2],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(","),a=Number(e)+1+"_"+(Number(r)+1);t[n]={throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["pointX"+a]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let[t,a]=r.split(","),i=Number(t)+1+"_"+(Number(a)+1),o=e[r].throughAttr;if(null!==o&&o.stateValues["pointX"+i]){let e=o.stateValues["pointX"+i].evaluate_to_constant();Number.isFinite(e)?n[r]=me$3.fromAst(e):n[r]=me$3.fromAst("")}else n[r]=me$3.fromAst("")}return{setValue:{throughPoints:n}}},async inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,initialChange:r,stateValues:a}){if(r&&!await a.draggable)return{success:!1};let i=[];for(let r in e.throughPoints){let[a,o]=r.split(","),s=Number(a)+1+"_"+(Number(o)+1);if(null===t[r].throughAttr||!t[r].throughAttr.stateValues["pointX"+s])return{success:!1};i.push({setDependency:n[r].throughAttr,desiredValue:e.throughPoints[r],childIndex:0,variableIndex:0})}return{success:!0,instructions:i}}},t.numericalThroughPoints={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize:({dependencyValues:e})=>[e.nThroughPoints],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].throughPoint.map((e=>e.tree));t.every((e=>Number.isFinite(e)))||(t=Array(t.length).fill(NaN)),n[r]=t}return{setValue:{numericalThroughPoints:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n}){let r=[];for(let a in e.numericalThroughPoints){if(!t[a].throughPoint)return{success:!1};r.push({setDependency:n[a].throughPoint,desiredValue:e.numericalThroughPoints[a].map((e=>me$3.fromAst(e)))})}return{success:!0,instructions:r}}},t.numericalPrescribedVertex={returnDependencies:()=>({prescribedVertex:{dependencyType:"stateVariable",variableName:"prescribedVertex"}}),definition({dependencyValues:e}){if(null===e.prescribedVertex)return{setValue:{numericalPrescribedVertex:null}};let t,n;try{t=e.prescribedVertex.get_component(0).evaluate_to_constant(),n=e.prescribedVertex.get_component(1).evaluate_to_constant(),Number.isFinite(t)&&Number.isFinite(n)||(t=NaN,n=NaN)}catch(e){t=NaN,n=NaN}return{setValue:{numericalPrescribedVertex:[t,n]}}}},t.pointsAreNumerical={returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalPrescribedVertex:{dependencyType:"stateVariable",variableName:"numericalPrescribedVertex"}}),definition:({dependencyValues:e})=>({setValue:{pointsAreNumerical:e.numericalThroughPoints.every((e=>Number.isFinite(e[0])))&&(!e.numericalPrescribedVertex||Number.isFinite(e.numericalPrescribedVertex[0]))},checkForActualChange:{pointsAreNumerical:!0}})},t.a={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"b",public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0},{variableName:"c",public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0},"realValued"],returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalPrescribedVertex:{dependencyType:"stateVariable",variableName:"numericalPrescribedVertex"},pointsAreNumerical:{dependencyType:"stateVariable",variableName:"pointsAreNumerical"},aShadow:{dependencyType:"stateVariable",variableName:"aShadow"}}),definition:function({dependencyValues:e,componentName:t}){if(!e.pointsAreNumerical)return{setValue:{a:NaN,b:NaN,c:NaN,realValued:!1}};let n,r,a,i=!0;if(e.numericalPrescribedVertex){if(0===e.numericalThroughPoints.length){let t=e.numericalPrescribedVertex,i=t[0],o=t[1];return n=e.aShadow,r=-2*n*i,a=n*i*i+o,{setValue:{a:n,b:r,c:a,realValued:!0}}}{let t=e.numericalPrescribedVertex,i=t[0],o=t[1],s=e.numericalThroughPoints[0],l=s[0];return n=(s[1]-o)/(l-i)**2,r=-2*n*i,a=n*i*i+o,{setValue:{a:n,b:r,c:a,realValued:!0}}}}if(0===e.numericalThroughPoints.length)return{setValue:{a:e.aShadow,realValued:!0},useEssentialOrDefaultValue:{b:!0,c:!0}};if(1===e.numericalThroughPoints.length){let t=e.numericalThroughPoints[0],i=t[0],o=t[1];return n=e.aShadow,r=-2*n*i,a=n*i*i+o,{setValue:{a:n,b:r,c:a,realValued:!0}}}if(2===e.numericalThroughPoints.length){n=e.aShadow;let t=e.numericalThroughPoints[0],o=t[0],s=t[1],l=o*o,u=e.numericalThroughPoints[1],c=u[0],p=u[1],d=c*c;return o===c?s==p?(r=-2*n*o,a=n*l+s):(i=!1,n=NaN,r=NaN,a=NaN):(r=(s-p-n*(l-d))/(o-c),a=s-n*l-r*o),{setValue:{a:n,b:r,c:a,realValued:i}}}if(3===e.numericalThroughPoints.length){let t=e.numericalThroughPoints[0],o=t[0],s=t[1],l=o*o,u=e.numericalThroughPoints[1],c=u[0],p=u[1],d=c*c,m=e.numericalThroughPoints[2],f=m[0],h=m[1],y=f*f,b=l-y,g=d-y,v=o-f,T=c-f,C=s-h,N=p-h,A=b*T-g*v;if(0===A){let t,u,d,m=!1;o===c?s===p?o===f?s==h?t=1:m=!0:(t=2,u=f,d=h):m=!0:o===f?s===h?(t=2,u=c,d=p):m=!0:c===f&&p===h?(t=2,u=c,d=p):m=!0,m?(i=!1,n=NaN,r=NaN,a=NaN):1===t?(n=e.aShadow,r=-2*n*o,a=n*o*o+s):(n=e.aShadow,r=(s-d-n*(l-u*u))/(o-u),a=s-n*l-r*o)}else n=(C*T-N*v)/A,r=(N*b-C*g)/A,a=s-r*o-n*l;return{setValue:{a:n,b:r,c:a,realValued:i}}}return console.warn("Haven't implemented parabola through more than 3 points"),{setValue:{a:NaN,b:NaN,c:NaN,realValued:!1}}},inverseDefinition:async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,workspace:r}){if(!t.pointsAreNumerical)return{success:!1};let a={},i=function(e){if(Number.isFinite(e))return{success:!0,value:e};if(e instanceof me$3.class){let t=e.evaluate_to_constant();if(Number.isFinite(t))return{success:!0,value:t}}return{success:!1}};if(void 0!==e.a){let t=i(e.a);if(!t.success)return{success:!1};a.a=t.value}if(void 0!==e.b){let t=i(e.b);if(!t.success)return{success:!1};a.b=t.value}if(void 0!==e.c){let t=i(e.c);if(!t.success)return{success:!1};a.c=t.value}Object.assign(r,a);let o=async function(e){return void 0!==r[e]?r[e]:await n[e]};if(0===t.numericalThroughPoints.length){let e=[];return void 0!==a.a&&e.push({setDependency:"aShadow",desiredValue:a.a}),void 0!==a.b&&e.push({setEssentialValue:"b",value:a.b}),void 0!==a.c&&e.push({setEssentialValue:"c",value:a.c}),{success:!0,instructions:e}}if(1===t.numericalThroughPoints.length){let e=await o("a"),t=await o("b"),n=await o("c"),r=[{setDependency:"numericalThroughPoints",desiredValue:[[-t/(2*e),n-t*t/(4*e)]]}];return void 0!==a.a&&r.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:r}}if(2===t.numericalThroughPoints.length){let e=await o("a"),n=await o("b"),r=await o("c"),i=t.numericalThroughPoints[0][0],s=t.numericalThroughPoints[1][0];if(i===s){i=-n/(2*e);let t=r-n*n/(4*e),o=[{setDependency:"numericalThroughPoints",desiredValue:[[i,t],[i,t]]}];return void 0!==a.a&&o.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:o}}{let t=[{setDependency:"numericalThroughPoints",desiredValue:[[i,e*i*i+n*i+r],[s,e*s*s+n*s+r]]}];return void 0!==a.a&&t.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:t}}}if(3===t.numericalThroughPoints.length){let e,n=await o("a"),r=await o("b"),i=await o("c"),s=t.numericalThroughPoints[0][0],l=t.numericalThroughPoints[1][0],u=t.numericalThroughPoints[2][0],c=3;if(s===l?s===u?c=1:(c=2,e=3):s===u?(c=2,e=2):l===u&&(c=2,e=1),3===c){let e=[{setDependency:"numericalThroughPoints",desiredValue:[[s,n*s*s+r*s+i],[l,n*l*l+r*l+i],[u,n*u*u+r*u+i]]}];return void 0!==a.a&&e.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:e}}if(2===c){if(1===e){let e=n*l*l+r*l+i,t=[{setDependency:"numericalThroughPoints",desiredValue:[[s,n*s*s+r*s+i],[l,e],[l,e]]}];return void 0!==a.a&&t.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:t}}if(2===e){let e=n*s*s+r*s+i,t=[{setDependency:"numericalThroughPoints",desiredValue:[[s,e],[l,n*l*l+r*l+i],[s,e]]}];return void 0!==a.a&&t.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:t}}{let e=n*s*s+r*s+i,t=[{setDependency:"numericalThroughPoints",desiredValue:[[s,e],[s,e],[u,n*u*u+r*u+i]]}];return void 0!==a.a&&t.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:t}}}{s=-r/(2*n);let e=i-r*r/(4*n),t=[{setDependency:"numericalThroughPoints",desiredValue:[[s,e],[s,e],[s,e]]}];return void 0!==a.a&&t.push({setDependency:"aShadow",desiredValue:a.a}),{success:!0,instructions:t}}}return{success:!1}}},t.vertex={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"vertexX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["vertexX"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey:()=>({globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"},realValued:{dependencyType:"stateVariable",variableName:"realValued"}}}),arrayDefinitionByKey:function({globalDependencyValues:e}){let t={};return e.realValued&&0!==e.a?(t[0]=me$3.fromAst(-e.b/(2*e.a)),t[1]=me$3.fromAst(e.c-e.b**2/(4*e.a))):(t[0]=me$3.fromAst(""),t[1]=me$3.fromAst("")),{setValue:{vertex:t}}},inverseArrayDefinitionByKey:async function({desiredStateVariableValues:e,globalDependencyValues:t,workspace:n,stateValues:r}){let a,i;if(a="0"in e.vertex?e.vertex[0].evaluate_to_constant():void 0!==n.x?n.x:(await r.vertex)[0].tree,!Number.isFinite(a))return{success:!1};if(n.x=a,i="1"in e.vertex?e.vertex[1].evaluate_to_constant():void 0!==n.y?n.y:(await r.vertex)[1].tree,!Number.isFinite(i))return{success:!1};n.y=i;let o=t.a;return{success:!0,instructions:[{setDependency:"b",desiredValue:-2*o*a,additionalDependencyValues:{c:i+o*a*a}}]}}},t.equation={public:!0,shadowingInstructions:{createComponentOfType:"math"},additionalProperties:{simplify:"numberspreserveorder",displaysmallaszero:!0},returnDependencies:()=>({a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition:function({dependencyValues:e}){let t=["=","y",["+",["*",e.a,["^","x",2]],["*",e.b,"x"],e.c]];return{setValue:{equation:me$3.fromAst(t).evaluate_numbers({skip_ordering:!0})}}}},t.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],additionalStateVariablesDefined:[{variableName:"fDefinitions",isArray:!0,forRenderer:!0}],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[1],returnArrayDependenciesByKey:()=>({globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}}),arrayDefinitionByKey:({globalDependencyValues:e})=>({setValue:{fs:[function(t){return e.a*t*t+e.b*t+e.c}],fDefinitions:[{functionType:"formula",formula:["+",["*",e.a,"x","x"],["*",e.b,"x"],e.c],variables:["x"],nInputs:1,nOutputs:1,domain:null}]}})},t.f={isAlias:!0,targetVariableName:"f1"},t.nearestPoint={returnDependencies:()=>({f:{dependencyType:"stateVariable",variableName:"f"},a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition({dependencyValues:e,componentName:t}){let n=!(Number.isFinite(e.a)&&Number.isFinite(e.b)&&Number.isFinite(e.c));return{setValue:{nearestPoint:function({variables:t,scales:r}){if(n)return{};let a=r[0],i=r[1],o=t.x1?.evaluate_to_constant(),s=t.x2?.evaluate_to_constant();if(!Number.isFinite(o)||!Number.isFinite(s))return{};o/=a,s/=i;let l=e.a*a*a/i,u=e.b*a/i,c=e.c/i;if(0===l){let e=u*u+1,n={};return n.x1=(o+u*s-u*c)/e*a,n.x2=(u*(o+u*s)+c)/e*i,void 0!==t.x3&&(n.x3=0),n}let p=c-s,d=2*l**2,m=cardano(3*l*u/d,(2*l*p+u**2+1)/d,(u*p-o)/d,1e-14),f=m[0],h=e.f(f*a)/i,y=(o-f)**2+(s-h)**2;for(let t of m.slice(1)){let n=t,r=e.f(n*a)/i,l=(o-n)**2+(s-r)**2;l<y&&(f=n,h=r,y=l)}let b={x1:f*a,x2:h*i};return void 0!==t.x3&&(b.x3=0),b}}}}},t}}function cardano(e,t,n,r=1e-10){const[a,i]=[-1/3*e*e+t,2/27*e*e*e-1/3*e*t+n];if(Math.abs(i)<=r){if(Math.abs(a)<=r)return[-e/3];let t=Math.sqrt(Math.abs(a));return a<0?[-t-e/3,-e/3,t-e/3]:[-e/3]}const o=-27*i*i-4*a*a*a;if(Math.abs(o)<=r){const t=Math.cbrt(-i/2);return[2*t-e/3,-t-e/3]}if(o>0){const t=Math.sqrt(o/108),n=2*Math.sqrt(Math.cbrt(i*i/4+o/108)),r=Math.atan2(t,-i/2);return[Math.cos(r/3),Math.cos(r/3+2*Math.PI/3),Math.cos(r/3-2*Math.PI/3)].sort(((e,t)=>e-t)).map((t=>n*t-e/3))}const s=Math.sqrt(-o/108);return[Math.cbrt(-i/2+s)+Math.cbrt(-i/2-s)-e/3]}class BezierControls extends BaseComponent{static componentType="bezierControls";static rendererType="container";static createAttributesObject(){let e=super.createAttributesObject();return e.alwaysVisible={createComponentOfType:"boolean",createStateVariable:"alwaysVisible",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=breakEmbeddedStringsIntoParensPieces({componentList:e});return!0!==t.success?{success:!1}:{success:!0,newChildren:t.pieces.map((function(e){return e.length>1||"string"==typeof e[0]?{componentType:"controlVectors",children:[{componentType:"vector",children:e}]}:e[0]}))}}}),e}static returnChildGroups(){return[{group:"controlVectors",componentTypes:["controlVectors"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nControls={returnDependencies:()=>({nParentPoints:{dependencyType:"parentStateVariable",variableName:"nThroughPoints",skipComponentNames:!0}}),definition({dependencyValues:e}){let t=e.nParentPoints;return Number.isInteger(t)&&t>=0||(t=0),{setValue:{nControls:t}}}},e.pointIndMap={returnDependencies:()=>({controlChildren:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["pointNumber"]}}),definition:function({dependencyValues:e}){let t=[],n=-1;for(let[r,a]of e.controlChildren.entries()){let e=a.stateValues.pointNumber;Number.isFinite(e)?n=Math.round(e)-1:n+=1,t[n]=r}return{setValue:{pointIndMap:t}}}},e.directions={isArray:!0,entryPrefixes:["direction"],hasEssential:!0,defaultValueByArrayKey:()=>"none",stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize:({dependencyValues:e})=>[e.nControls],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=t.pointIndMap[r];void 0!==e&&(n[r]={controlChild:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["direction"],childIndices:[e]}})}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={},r={};for(let a of t){let t=e[a].controlChild;t&&1===t.length?n[a]=t[0].stateValues.direction:r[a]=!0}return{setValue:{directions:n},useEssentialOrDefaultValue:{directions:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n}){let r=[],a={};for(let i in e.directions){let o=n[i].controlChild;o&&1===o.length?r.push({setDependency:t[i].controlChild,desiredValue:e.directions[i],childIndex:0,variableIndex:0}):a[i]=e.directions[i]}return Object.keys(a).length>0&&r.push({setEssentialValue:"directions",value:a}),{success:!0,instructions:r}}},e.hiddenControls={isArray:!0,entryPrefixes:["hiddenControl"],hasEssential:!0,defaultValueByArrayKey:()=>!1,stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize:({dependencyValues:e})=>[e.nControls],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=t.pointIndMap[r];void 0!==e&&(n[r]={controlChild:{dependencyType:"child",childGroups:["controlVectors"],variableNames:["hide"],childIndices:[e]}})}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={},r={};for(let a of t){let t=e[a].controlChild;t&&1===t.length?n[a]=t[0].stateValues.hide:r[a]=!0}return{setValue:{hiddenControls:n},useEssentialOrDefaultValue:{hiddenControls:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n}){let r=[],a={};for(let i in e.hiddenControls){let o=n[i].controlChild;o&&1===o.length?r.push({setDependency:t[i].controlChild,desiredValue:e.hiddenControls[i],childIndex:0,variableIndex:0}):a[i]=e.hiddenControls[i]}return Object.keys(a).length>0&&r.push({setEssentialValue:"hiddenControls",value:a}),{success:!0,instructions:r}}},e.nDimensions={returnDependencies:()=>({nParentDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensions"}}),definition:function({dependencyValues:e}){let t=e.nParentDimensions;return Number.isInteger(t)&&t>=0||(t=0),{setValue:{nDimensions:t},checkForActualChange:{nDimensions:!0}}}},e.essentialSymmetricControls={isArray:!0,entryPrefixes:["essentialSymmetricControl"],nDimensions:2,hasEssential:!0,defaultValueByArrayKey:()=>me$3.fromAst(1),returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nControls,e.nDimensions],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let t={};for(let n of e)n.split(",").map((e=>Number(e))),t[n]=!0;return{useEssentialOrDefaultValue:{essentialSymmetricControls:t}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let t=[],n={};for(let t in e.essentialSymmetricControls)n[t]=e.essentialSymmetricControls[t];return Object.keys(n).length>0&&t.push({setEssentialValue:"essentialSymmetricControls",value:n}),{success:!0,instructions:t}}},e.controls={isArray:!0,entryPrefixes:["control"],nDimensions:3,hasEssential:!0,shadowVariable:!0,defaultValueByArrayKey:()=>me$3.fromAst(1),stateVariablesDeterminingDependencies:["pointIndMap","directions"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nControls,2,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=r.split(",").map((e=>Number(e))),a=e.map((e=>e+1));n[r]={direction:{dependencyType:"stateVariable",variableName:"direction"+a[0]}};let i=t.directions[e[0]];if("none"!==i&&(0===e[1]||1===e[1])){let o=t.pointIndMap[e[0]];void 0!==o&&("symmetric"===i||"previous"===i&&0===e[1]||"next"===i&&1===e[1]?n[r].controlChild={dependencyType:"child",childGroups:["controlVectors"],variableNames:["vectorX1_"+a[2]],childIndices:[o]}:"both"===i&&(n[r].controlChild={dependencyType:"child",childGroups:["controlVectors"],variableNames:["vectorX"+a[1]+"_"+a[2]],childIndices:[o]})),"symmetric"===i&&(n[r].essentialSymmetricControl={dependencyType:"stateVariable",variableName:"essentialSymmetricControl"+a[0]+"_"+a[2]})}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t,componentName:n}){let r={},a={};for(let n of t){let t=n.split(",").map((e=>Number(e))),i=t.map((e=>e+1)),o=e[n].direction;if(0===t[1])if("none"===o||"next"===o)r[n]=null;else{let t=e[n].controlChild,s=!0;if(t&&1===t.length){let e=t[0].stateValues["vectorX1_"+i[2]];e&&(s=!1,e=e.evaluate_to_constant(),Number.isFinite(e)||(e=NaN),r[n]=me$3.fromAst(e))}s&&("symmetric"===o?r[n]=e[n].essentialSymmetricControl:a[n]=!0)}else if(1===t[1])if("none"===o||"previous"===o)r[n]=null;else{let t=e[n].controlChild,s=!0;if(t&&1===t.length)if("both"===o){let e=t[0].stateValues["vectorX2_"+i[2]];e&&(s=!1,e=e.evaluate_to_constant(),Number.isFinite(e)||(e=NaN),r[n]=me$3.fromAst(e))}else{let e=t[0].stateValues["vectorX1_"+i[2]];e&&(s=!1,e=e.evaluate_to_constant(),Number.isFinite(e)||(e=NaN),r[n]="symmetric"===o?me$3.fromAst(-e):me$3.fromAst(e))}s&&("symmetric"===o?e[n].essentialSymmetricControl&&(r[n]=me$3.fromAst(-e[n].essentialSymmetricControl.tree)):a[n]=!0)}}return{setValue:{controls:r},useEssentialOrDefaultValue:{controls:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t,dependencyValuesByKey:n}){let r=[],a={};for(let i in e.controls){let o=i.split(",").map((e=>Number(e))),s=o.map((e=>e+1)),l=n[i].direction;if(l)if(0===o[1]){if("none"!==l&&"next"!==l){let o=n[i].controlChild,u=!0;if(o&&1===o.length){o[0].stateValues["vectorX1_"+s[2]]&&(u=!1,r.push({setDependency:t[i].controlChild,desiredValue:e.controls[i],childIndex:0,variableIndex:0}))}if(u){let n=e.controls[i].evaluate_to_constant();Number.isFinite(n)||(n=NaN),n=me$3.fromAst(n),"symmetric"===l?r.push({setDependency:t[i].essentialSymmetricControl,desiredValue:n}):a[i]=n}}}else if(1===o[1]&&"none"!==l&&"previous"!==l){let o,u=n[i].controlChild,c=!0;if(u&&1===u.length)if("both"===l){u[0].stateValues["vectorX2_"+s[2]]&&(c=!1)}else{u[0].stateValues["vectorX1_"+s[2]]&&(c=!1)}o="symmetric"===l?me$3.fromAst(["-",e.controls[i].tree]):e.controls[i],c?(o=o.evaluate_to_constant(),Number.isFinite(o)||(o=NaN),o=me$3.fromAst(o),"symmetric"===l?r.push({setDependency:t[i].essentialSymmetricControl,desiredValue:o}):a[i]=o):r.push({setDependency:t[i].controlChild,desiredValue:o,childIndex:0,variableIndex:0})}}return Object.keys(a).length>0&&r.push({setEssentialValue:"controls",value:a}),{success:!0,instructions:r}}},e}}class VectorListComponent extends BaseComponent{static componentType="_vectorListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=breakEmbeddedStringsIntoParensPieces({componentList:e});return!0!==t.success?{success:!1}:{success:!0,newChildren:t.pieces.map((function(e){return e.length>1||"string"==typeof e[0]?{componentType:"vector",children:e}:e[0]}))}}}),e}static returnChildGroups(){return[{group:"vectors",componentTypes:["vector"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nVectors={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childGroups:["vectors"],skipComponentNames:!0}}),definition:({dependencyValues:e})=>({setValue:{nVectors:e.vectorChildren.length},checkForActualChange:{nVectors:!0}})},e.nDimensions={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childGroups:["vectors"],variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:e}){let t;if(0===e.vectorChildren.length)t=2;else{t=1;for(let n of e.vectorChildren)Number.isFinite(n.stateValues.nDimensions)&&(t=Math.max(t,n.stateValues.nDimensions))}return{setValue:{nDimensions:t},checkForActualChange:{nDimensions:!0}}}},e.vectors={isArray:!0,nDimensions:2,entryPrefixes:["vectorX","vector"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("vectorX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("vectors"===t)return"vector"+e;if("vector"===t.slice(0,6)){let n=Number(t.slice(6));if(Number.isInteger(n)&&n>0)return`vectorX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nVectors:{dependencyType:"stateVariable",variableName:"nVectors"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nVectors,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(",");t[n]={vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["x"+(Number(r)+1)],childIndices:[e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=r.split(",")[1],a=e[r].vectorChild[0];a&&(n[r]=a.stateValues["x"+(Number(t)+1)])}return{setValue:{vectors:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.vectors)n.push({setDependency:t[r].vectorChild,desiredValue:e.vectors[r],childIndex:0,variableIndex:0});return{success:!0,instructions:n}}},e}}class ControlVectors extends VectorListComponent{static componentType="controlVectors";static createAttributesObject(){let e=super.createAttributesObject();return e.direction={createComponentOfType:"text",createStateVariable:"direction",defaultValue:"symmetric",public:!0,toLowerCase:!0,validValues:["symmetric","previous","next","both","none"]},e.pointNumber={createComponentOfType:"number",createStateVariable:"pointNumber",defaultValue:null,public:!0},e}}class PointListComponent extends BaseComponent{static componentType="_pointListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=breakEmbeddedStringsIntoParensPieces({componentList:e});return!0!==t.success?{success:!1}:{success:!0,newChildren:t.pieces.map((function(e){return e.length>1||"string"==typeof e[0]?{componentType:"point",children:e}:e[0]}))}}}),e}static returnChildGroups(){return[{group:"points",componentTypes:["point"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nPoints={returnDependencies:()=>({pointChildren:{dependencyType:"child",childGroups:["points"],skipComponentNames:!0}}),definition:function({dependencyValues:e}){return{setValue:{nPoints:e.pointChildren.length},checkForActualChange:{nPoints:!0}}}},e.nDimensions={returnDependencies:()=>({pointChildren:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"],skipPlaceholders:!0}}),definition:function({dependencyValues:e}){let t;if(0===e.pointChildren.length)t=2;else{t=1;for(let n of e.pointChildren)Number.isFinite(n.stateValues.nDimensions)&&(t=Math.max(t,n.stateValues.nDimensions))}return{setValue:{nDimensions:t},checkForActualChange:{nDimensions:!0}}}},e.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("pointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("points"===t)return"point"+e;if("point"===t.slice(0,5)){let n=Number(t.slice(5));if(Number.isInteger(n)&&n>0)return`pointX${n}_${e}`}return null},returnArraySizeDependencies:()=>({nPoints:{dependencyType:"stateVariable",variableName:"nPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nPoints,e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let[e,r]=n.split(",");t[n]={pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+(Number(r)+1)],childIndices:[e]}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=r.split(",")[1],a=e[r].pointChild[0];a&&(n[r]=a.stateValues["x"+(Number(t)+1)])}return{setValue:{points:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.points)n.push({setDependency:t[r].pointChild,desiredValue:e.points[r],childIndex:0,variableIndex:0});return{success:!0,instructions:n}}},e}}class LineListComponent extends BaseComponent{static componentType="_lineListComponent";static rendererType="container";static renderChildren=!0;static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e)).map((e=>({componentType:"line",children:[e]})))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"lines",componentTypes:["line"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nLines={returnDependencies:()=>({lineChildren:{dependencyType:"child",childGroups:["lines"],skipComponentNames:!0}}),definition:function({dependencyValues:e}){return{setValue:{nLines:e.lineChildren.length},checkForActualChange:{nLines:!0}}}},e.lineNames={isArray:!0,entryPrefixes:["lineName"],returnArraySizeDependencies:()=>({nLines:{dependencyType:"stateVariable",variableName:"nLines"}}),returnArraySize:({dependencyValues:e})=>[e.nLines],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={lineChild:{dependencyType:"child",childGroups:["lines"],childIndices:[n]}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].lineChild[0];t&&(n[r]=t.componentName)}return{setValue:{lineNames:n}}}},e}}class AngleListComponent extends BaseComponent{static componentType="_angleListComponent";static createAttributesObject(){let e=super.createAttributesObject();return e.hide={default:!0},e}static returnChildLogic(e){let t=super.returnChildLogic(e),n=t.newLeaf({name:"AtLeastZeroAngles",componentType:"angle",comparison:"atLeast",number:0}),r=breakStringsAndOthersIntoComponentsByStringCommas(),a=t.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=t.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),o=t.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:r});return t.newOperator({name:"AnglesXorSugar",operator:"xor",propositions:[n,o],setAsBase:!0}),t}updateState(e={}){if(e.init&&(this._state.angles={trackChanges:!0}),super.updateState(e),!this.childLogicSatisfied)return this.unresolvedState.angles=!0,void(this.unresolvedState.nAngles=!0);if(this.currentTracker.trackChanges.childrenChanged(this.componentName)){delete this.unresolvedState.angles,delete this.unresolvedState.nAngles;let e=this.childLogic.returnMatches("AtLeastZeroAngles");this.state.nAngles=e.length,this.state.angles=e.map((e=>this.activeChildren[e]))}}initializeRenderer(){void 0===this.renderer&&(this.renderer=new this.availableRenderers.container({key:this.componentName}))}updateChildrenWhoRender(){this.childrenWhoRender=this.state.angles.map((e=>e.componentName))}}class Vector extends GraphicalComponent{static componentType="vector";actions={moveVector:this.moveVector.bind(this)};static primaryStateVariableForDefinition="displacementShadow";static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.headDraggable={createComponentOfType:"boolean",createStateVariable:"headDraggable",defaultValue:!0,public:!0,forRenderer:!0},e.tailDraggable={createComponentOfType:"boolean",createStateVariable:"tailDraggable",defaultValue:!0,public:!0,forRenderer:!0},e.x={createComponentOfType:"math"},e.y={createComponentOfType:"math"},e.z={createComponentOfType:"math"},e.xs={createComponentOfType:"mathList"},e.displacement={createComponentOfType:"vector"},e.head={createComponentOfType:"point"},e.tail={createComponentOfType:"point"},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({childrenRegex:/s+(.*s)?/,replacementFunction:function({matchedChildren:e}){let t=returnBreakStringsSugarFunction({childrenToComponentFunction:e=>({componentType:"math",children:e}),mustStripOffOuterParentheses:!0}),n=t({matchedChildren:e});return n.success||1!==e.length?(n.success&&(n.newAttributes={xs:{component:{componentType:"mathList",children:n.newChildren,skipSugar:!0}}},delete n.newChildren),n):{success:!0,newAttributes:{x:{component:{componentType:"math",children:e}}}}}}),e}static returnChildGroups(){return[{group:"points",componentTypes:["point"]},{group:"vectors",componentTypes:["vector"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" vector"}}}},e.displacementShadow={defaultValue:null,hasEssential:!0,essentialVarName:"displacement",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{displacementShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"displacementShadow",value:convertValueToMathExpression(e.displacementShadow)}]}}},e.headShadow={defaultValue:null,hasEssential:!0,essentialVarName:"head",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{headShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"headShadow",value:convertValueToMathExpression(e.headShadow)}]}}},e.tailShadow={defaultValue:null,hasEssential:!0,essentialVarName:"tail",set:convertValueToMathExpression,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{tailShadow:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"tailShadow",value:convertValueToMathExpression(e.tailShadow)}]}}},e.sourceOfDisplacement={returnDependencies:()=>({xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement"},pointChild:{dependencyType:"child",childGroups:["points"]},vectorChild:{dependencyType:"child",childGroups:["vectors"]}}),definition({dependencyValues:e}){let t=null;return e.vectorChild.length>0?t="vectorChild":e.pointChild.length>0?t="pointChild":null!==e.displacementAttr?t="displacementAttr":null!==e.xsAttr?t="xsAttr":null===e.xAttr&&null===e.yAttr&&null===e.zAttr||(t="componentAttrs"),{setValue:{sourceOfDisplacement:t}}}},e.basedOnHead={returnDependencies:()=>({headAttr:{dependencyType:"attributeComponent",attributeName:"head"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}}),definition:function({dependencyValues:e}){return null!==e.tailAttr&&null!==e.sourceOfDisplacement?(null!==e.headAttr&&console.warn("Vector is prescribed by head, tail, and displacement.  Ignoring specified head."),{setValue:{basedOnHead:!1},checkForActualChange:{basedOnHead:!0}}):null!==e.headAttr?{setValue:{basedOnHead:!0},checkForActualChange:{basedOnHead:!0}}:{setValue:{basedOnHead:null!==e.headShadow},checkForActualChange:{basedOnHead:!0}}}},e.basedOnTail={returnDependencies:()=>({tailAttr:{dependencyType:"attributeComponent",attributeName:"tail"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}}),definition:function({dependencyValues:e}){return null!==e.tailAttr?{setValue:{basedOnTail:!0},checkForActualChange:{basedOnTail:!0}}:{setValue:{basedOnTail:null!==e.tailShadow},checkForActualChange:{basedOnTail:!0}}}},e.basedOnDisplacement={returnDependencies:()=>({sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"}}),definition:function({dependencyValues:e}){return null!==e.sourceOfDisplacement?{setValue:{basedOnDisplacement:!0},checkForActualChange:{basedOnDisplacement:!0}}:{setValue:{basedOnDisplacement:null!==e.displacementShadow},checkForActualChange:{basedOnDisplacement:!0}}}},e.nDimDisplacement={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let t={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["nDimensions"]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["nDimensions"]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["nDimensions"]},xAttr:{dependencyType:"attributeComponent",attributeName:"x"},yAttr:{dependencyType:"attributeComponent",attributeName:"y"},zAttr:{dependencyType:"attributeComponent",attributeName:"z"},xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["nComponents"]}};return e.basedOnDisplacement||(e.basedOnHead&&(t.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),e.basedOnTail&&(t.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnDisplacement)switch(e.sourceOfDisplacement){case"vectorChild":t=e.vectorChild[0].stateValues.nDimensions;break;case"pointChild":t=e.pointChild[0].stateValues.nDimensions;break;case"displacementAttr":t=e.displacementAttr.stateValues.nDimensions;break;case"xsAttr":t=e.xsAttr.stateValues.nComponents;break;case"componentAttrs":t=null!==e.zAttr?3:null!==e.yAttr?2:1;break;default:let n=e.displacementShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:1}else t=e.basedOnHead?e.basedOnTail?e.nDimHead===e.nDimTail?e.nDimHead:NaN:e.nDimHead:e.basedOnTail?e.nDimTail:2;return{setValue:{nDimDisplacement:t},checkForActualChange:{nDimDisplacement:!0}}}},e.nDimHead={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let t={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["nDimensions"]}};return e.basedOnHead||(e.basedOnTail&&(t.nDimTail={dependencyType:"stateVariable",variableName:"nDimTail"}),e.basedOnDisplacement&&(t.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnHead){if(null!==e.headAttr)t=e.headAttr.stateValues.nDimensions;else if(e.headShadow){let n=e.headShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:2}}else t=e.basedOnDisplacement?e.basedOnTail?e.nDimDisplacement===e.nDimTail?e.nDimDisplacement:NaN:e.nDimDisplacement:e.basedOnTail?e.nDimTail:2;return{setValue:{nDimHead:t},checkForActualChange:{nDimHead:!0}}}},e.nDimTail={stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","basedOnTail"],returnDependencies({stateValues:e}){let t={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"},tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["nDimensions"]}};return e.basedOnTail||(e.basedOnHead&&(t.nDimHead={dependencyType:"stateVariable",variableName:"nDimHead"}),e.basedOnDisplacement&&(t.nDimDisplacement={dependencyType:"stateVariable",variableName:"nDimDisplacement"})),t},definition:function({dependencyValues:e}){let t;if(e.basedOnTail){if(null!==e.tailAttr)t=e.tailAttr.stateValues.nDimensions;else if(e.tailShadow){let n=e.tailShadow.tree;t=Array.isArray(n)&&["tuple","vector"].includes(n[0])?n.length-1:2}}else t=e.basedOnDisplacement?e.basedOnHead?e.nDimDisplacement===e.nDimHead?e.nDimDisplacement:NaN:e.nDimDisplacement:e.basedOnHead?e.nDimHead:2;return{setValue:{nDimTail:t},checkForActualChange:{nDimTail:!0}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"},nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"},nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),definition:function({dependencyValues:e}){let t;if(e.basedOnDisplacement){if(e.basedOnTail){if(e.nDimDisplacement!==e.nDimTail)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}}}else if(e.basedOnHead&&e.nDimDisplacement!==e.nDimHead)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};t=e.nDimDisplacement}else if(e.basedOnTail){if(e.basedOnHead&&e.nDimTail!==e.nDimHead)return console.warn("nDimensions mismatch in vector"),{setValue:{nDimensions:NaN}};t=e.nDimTail}else t=e.basedOnHead?e.nDimHead:2;return{setValue:{nDimensions:t},checkForActualChange:{nDimensions:!0}}}},e.displacement={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents:e=>"x"===e?[]:[["vector",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["x"],hasEssential:!0,essentialVarName:"displacement2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnDisplacement","basedOnHead","sourceOfDisplacement"],returnArraySizeDependencies:()=>({nDimDisplacement:{dependencyType:"stateVariable",variableName:"nDimDisplacement"}}),returnArraySize:({dependencyValues:e})=>[e.nDimDisplacement],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={xsAttr:{dependencyType:"attributeComponent",attributeName:"xs",variableNames:["math"+e]},displacementAttr:{dependencyType:"attributeComponent",attributeName:"displacement",variableNames:["x"+e]},pointChild:{dependencyType:"child",childGroups:["points"],variableNames:["x"+e]},vectorChild:{dependencyType:"child",childGroups:["vectors"],variableNames:["x"+e]}},"0"===r?n[r].componentAttr={dependencyType:"attributeComponent",attributeName:"x",variableNames:["value"]}:"1"===r?n[r].componentAttr={dependencyType:"attributeComponent",attributeName:"y",variableNames:["value"]}:"2"===r&&(n[r].componentAttr={dependencyType:"attributeComponent",attributeName:"z",variableNames:["value"]}),!t.basedOnDisplacement&&t.basedOnHead&&(n[r].tailX={dependencyType:"stateVariable",variableName:"tailX"+e},n[r].headX={dependencyType:"stateVariable",variableName:"headX"+e})}return{globalDependencies:{basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},sourceOfDisplacement:{dependencyType:"stateVariable",variableName:"sourceOfDisplacement"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={},a={};for(let i of n){let n=Number(i)+1;if(e.basedOnDisplacement)switch(e.sourceOfDisplacement){case"vectorChild":r[i]=t[i].vectorChild[0].stateValues["x"+n];break;case"pointChild":r[i]=t[i].pointChild[0].stateValues["x"+n];break;case"displacementAttr":r[i]=t[i].displacementAttr.stateValues["x"+n];break;case"xsAttr":r[i]=t[i].xsAttr.stateValues["math"+n].simplify();break;case"componentAttrs":let o=t[i].componentAttr;null===o?a[i]={defaultValue:me$3.fromAst(0)}:r[i]=o.stateValues.value.simplify();break;default:let s=e.displacementShadow.tree;Array.isArray(s)&&["tuple","vector"].includes(s[0])?r[i]=e.displacementShadow.get_component(Number(i)):r[i]=e.displacementShadow}else e.basedOnHead?r[i]=t[i].headX.subtract(t[i].tailX).simplify():a[i]={defaultValue:me$3.fromAst("0"===i?1:0)}}let i={};return Object.keys(r).length>0&&(i.setValue={displacement:r}),Object.keys(a).length>0&&(i.useEssentialOrDefaultValue={displacement:a}),i},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.displacement)if(t.basedOnDisplacement)switch(t.sourceOfDisplacement){case"vectorChild":i.push({setDependency:r[a].vectorChild,desiredValue:e.displacement[a],childIndex:0,variableIndex:0});break;case"pointChild":i.push({setDependency:r[a].pointChild,desiredValue:e.displacement[a],childIndex:0,variableIndex:0});break;case"displacementAttr":i.push({setDependency:r[a].displacementAttr,desiredValue:e.displacement[a],variableIndex:0});break;case"xsAttr":i.push({setDependency:r[a].xsAttr,desiredValue:e.displacement[a],variableIndex:0});break;case"componentAttrs":null===n[a].componentAttr?i.push({setEssentialValue:"displacement",value:{[a]:convertValueToMathExpression(e.displacement[a])}}):i.push({setDependency:r[a].componentAttr,desiredValue:e.displacement[a],variableIndex:0});break;default:o=!0}else t.basedOnHead?i.push({setDependency:r[a].headX,desiredValue:n[a].tailX.add(e.displacement[a]).simplify()}):i.push({setEssentialValue:"displacement",value:{[a]:convertValueToMathExpression(e.displacement[a])}});if(o)if(a[0]>1){let t=["vector"];for(let n in e.displacement)t[Number(n)+1]=e.displacement[n].tree;t.length=a[0]+1,i.push({setDependency:"displacementShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.displacement&&i.push({setDependency:"displacementShadow",desiredValue:e.displacement[0]});return{success:!0,instructions:i}}},e.x={isAlias:!0,targetVariableName:"x1"},e.y={isAlias:!0,targetVariableName:"x2"},e.z={isAlias:!0,targetVariableName:"x3"},e.head={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents:e=>"headX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["headX"],set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnHead"],returnArraySizeDependencies:()=>({nDimHead:{dependencyType:"stateVariable",variableName:"nDimHead"}}),returnArraySize:({dependencyValues:e})=>[e.nDimHead],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={headAttr:{dependencyType:"attributeComponent",attributeName:"head",variableNames:["x"+e]}},t.basedOnHead||(n[r].tailX={dependencyType:"stateVariable",variableName:"tailX"+e},n[r].x={dependencyType:"stateVariable",variableName:"x"+e})}return{globalDependencies:{basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let a of n){let n=Number(a)+1;e.basedOnHead?null!==t[a].headAttr?r[a]=t[a].headAttr.stateValues["x"+n]:null!==e.headShadow&&(r[a]=e.headShadow.get_component(Number(a))):r[a]=t[a].tailX.add(t[a].x).simplify()}return{setValue:{head:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.head)t.basedOnHead?n[a].headAttr&&null!==n[a].headAttr?i.push({setDependency:r[a].headAttr,desiredValue:e.head[a],variableIndex:0}):null!==t.headShadow&&(o=!0):i.push({setDependency:r[a].x,desiredValue:e.head[a].subtract(n[a].tailX).simplify()});if(o)if(a[0]>1){let t=["vector"];for(let n in e.head)t[Number(n)+1]=e.head[n].tree;t.length=a[0]+1,i.push({setDependency:"headShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.head&&i.push({setDependency:"headShadow",desiredValue:e.head[0]});return{success:!0,instructions:i}}},e.tail={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],returnWrappingComponents:e=>"tailX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,entryPrefixes:["tailX"],hasEssential:!0,defaultValueByArrayKey:()=>me$3.fromAst(0),essentialVarName:"tail2",set:convertValueToMathExpression,stateVariablesDeterminingDependencies:["basedOnTail","basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimTail:{dependencyType:"stateVariable",variableName:"nDimTail"}}),returnArraySize:({dependencyValues:e})=>[e.nDimTail],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=Number(r)+1;n[r]={tailAttr:{dependencyType:"attributeComponent",attributeName:"tail",variableNames:["x"+e]}},t.basedOnTail||t.basedOnHead&&t.basedOnDisplacement&&(n[r].headX={dependencyType:"stateVariable",variableName:"headX"+e},n[r].x={dependencyType:"stateVariable",variableName:"x"+e})}return{globalDependencies:{basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}},dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={},a={};for(let i of n){let n=Number(i)+1;null!==t[i].tailAttr?r[i]=t[i].tailAttr.stateValues["x"+n]:null!==e.tailShadow?r[i]=e.tailShadow.get_component(Number(i)):e.basedOnHead&&e.basedOnDisplacement?r[i]=t[i].headX.subtract(t[i].x).simplify():a[i]=!0}let i={};return Object.keys(r).length>0&&(i.setValue={tail:r}),Object.keys(a).length>0&&(i.useEssentialOrDefaultValue={tail:a}),i},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a}){let i=[],o=!1;for(let a in e.tail)n[a].tailAttr&&null!==n[a].tailAttr?i.push({setDependency:r[a].tailAttr,desiredValue:e.tail[a],variableIndex:0}):null!==t.tailShadow?o=!0:t.basedOnHead&&t.basedOnDisplacement?i.push({setDependency:r[a].x,desiredValue:n[a].headX.subtract(e.tail[a]).simplify()}):i.push({setEssentialValue:"tail",value:{[a]:convertValueToMathExpression(e.tail[a])}});if(o)if(a[0]>1){let t=["vector"];for(let n in e.tail)t[Number(n)+1]=e.tail[n].tree;t.length=a[0]+1,i.push({setDependency:"tailShadow",desiredValue:me$3.fromAst(t)})}else 1===a[0]&&"0"in e.tail&&i.push({setDependency:"tailShadow",desiredValue:e.tail[0]});return{success:!0,instructions:i}}},e.numericalEndpoints={forRenderer:!0,returnDependencies:()=>({head:{dependencyType:"stateVariable",variableName:"head"},tail:{dependencyType:"stateVariable",variableName:"tail"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition:function({dependencyValues:e}){let t,n;if(1===e.nDimensions)e.head[0].evaluate_to_constant(),n=e.tail[0].evaluate_to_constant(),Number.isFinite(n)||(n=NaN);else{t=[],n=[];for(let r=0;r<e.nDimensions;r++){let a=e.head[r].evaluate_to_constant();Number.isFinite(a)||(a=NaN),t.push(a);let i=e.tail[r].evaluate_to_constant();Number.isFinite(i)||(i=NaN),n.push(i)}}return{setValue:{numericalEndpoints:[n,t]}}}},e.displacementCoords={returnDependencies:()=>({displacement:{dependencyType:"stateVariable",variableName:"displacement"}}),definition({dependencyValues:e}){let t=[];for(let n of e.displacement)n?t.push(n.tree):t.push("");return t=t.length>1?["vector",...t]:1===t.length?t[0]:"",{setValue:{displacementCoords:me$3.fromAst(t)}}},inverseDefinition({desiredStateVariableValues:e}){let t,n=e.displacementCoords.tree;return t=!Array.isArray(n)||"vector"!==n[0]&&"tuple"!==n[0]?[e.displacementCoords]:n.slice(1).map((e=>me$3.fromAst(e))),{success:!0,instructions:[{setDependency:"displacement",desiredValue:t}]}}},e.displacementCoordsLatex={forRenderer:!0,returnDependencies:()=>({displacementCoords:{dependencyType:"stateVariable",variableName:"displacementCoords"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n={};return e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits)),{setValue:{displacementCoordsLatex:roundForDisplay({value:e.displacementCoords,dependencyValues:e,usedDefault:t}).toLatex(n)}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition({dependencyValues:e}){let t=e.numericalEndpoints[0]?.[0],n=e.numericalEndpoints[0]?.[1],r=e.numericalEndpoints[1]?.[0],a=e.numericalEndpoints[1]?.[1],i=Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a),o=2!==e.nDimensions||!i||r===t&&a===n;return{setValue:{nearestPoint:function({variables:e,scales:i}){if(o)return{};let s=i[0],l=i[1],u=(r-t)/s,c=(a-n)/l,p=u*u+c*c,d=((e.x1-t)/s*u+(e.x2-n)/l*c)/p,m={};return m=d<=0?{x1:t,x2:n}:d>=1?{x1:r,x2:a}:{x1:t+d*u*s,x2:n+d*c*l},void 0!==e.x3&&(m.x3=0),m}}}}},e}static adapters=[{stateVariable:"displacementCoords",componentType:"coords",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]}];async moveVector({tailcoords:e,headcoords:t,transient:n,skippable:r,sourceInformation:a,actionId:i}){let o=[];if(void 0!==e){if(await this.stateValues.basedOnHead&&await this.stateValues.basedOnDisplacement){let n;if(void 0===t){let t=await this.stateValues.numericalEndpoints;n=e.map(((e,n)=>t[1][n]-e))}else n=e.map(((e,n)=>t[n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}else o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"tail",value:e.map((e=>me$3.fromAst(e))),sourceInformation:a});if(void 0===t&&!await this.stateValues.basedOnHead){let t=await this.stateValues.numericalEndpoints,n=e.map(((e,n)=>t[1][n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}}if(void 0!==t){if(await this.stateValues.basedOnHead)o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"head",value:t.map((e=>me$3.fromAst(e))),sourceInformation:a});else{null==e&&(e=(await this.stateValues.numericalEndpoints)[0]);let n=e.map(((e,n)=>t[n]-e));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}if(void 0===e&&await this.stateValues.basedOnHead&&await this.stateValues.basedOnDisplacement){let e=await this.stateValues.numericalEndpoints,n=t.map(((t,n)=>t-e[0][n]));o.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:n.map((e=>me$3.fromAst(e))),sourceInformation:a})}}return n?await this.coreFunctions.performUpdate({updateInstructions:o,transient:n,skippable:r,actionId:i}):await this.coreFunctions.performUpdate({updateInstructions:o,actionId:i,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{head:t,tail:e}}})}}class Angle extends GraphicalComponent{static componentType="angle";static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.radius={createComponentOfType:"math",createStateVariable:"radius",defaultValue:me$3.fromAst(1),public:!0},e.chooseReflexAngle={createComponentOfType:"text",createStateVariable:"chooseReflexAngle",defaultValue:"never",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["never","allowed","always"]},e.inDegrees={createComponentOfType:"boolean",createStateVariable:"inDegrees",defaultValue:!1,public:!0,forRenderer:!0},e.radians={createComponentOfType:"math"},e.degrees={createComponentOfType:"math"},e.through={createComponentOfType:"_pointListComponent"},e.betweenLines={createComponentOfType:"_lineListComponent"},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.padZeros={createComponentOfType:"boolean",createStateVariable:"padZeros",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){return 0!==e.length&&e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro))?{success:!0,newAttributes:{radians:{component:{componentType:"math",children:e}}}}:{success:!1}}}),e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.betweenLinesName={returnDependencies:()=>({betweenLines:{dependencyType:"attributeComponent",attributeName:"betweenLines"}}),definition({dependencyValues:e}){let t=null;return null!==e.betweenLines&&(t=e.betweenLines.componentName),{setValue:{betweenLinesName:t}}}},e.nPointsSpecified={returnDependencies:()=>({through:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["nPoints"]}}),definition:({dependencyValues:e})=>null!==e.through?{setValue:{nPointsSpecified:e.through.stateValues.nPoints}}:{setValue:{nPointsSpecified:0}}},e.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],stateVariablesDeterminingDependencies:["betweenLinesName"],returnArraySizeDependencies:()=>({}),returnArraySize:()=>[3,2],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("pointX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},returnArrayDependenciesByKey({stateValues:e}){let t={nPointsSpecified:{dependencyType:"stateVariable",variableName:"nPointsSpecified"},throughAttr:{dependencyType:"attributeComponent",attributeName:"through",variableNames:["points"]},radiansAttr:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degreesAttr:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]}};return null!==e.betweenLinesName&&(t.lineChildren={dependencyType:"child",parentName:e.betweenLinesName,childGroups:["lines"],variableNames:["points","nDimensions","coeff0","coeffvar1","coeffvar2","nearestPoint"]}),{globalDependencies:t}},arrayDefinitionByKey({globalDependencyValues:e}){if(e.lineChildren){if(e.lineChildren.length>2){console.warn(`Cannot define an angle between ${e.lineChildren.length} line(s)`);let t={};for(let e=0;e<3;e++)for(let n=0;n<2;n++)t[e+","+n]=me$3.fromAst("");return{setValue:{points:t}}}if(1===e.lineChildren.length){let t=e.lineChildren[0];if(2!==t.stateValues.nDimensions){let e={};for(let t=0;t<3;t++)for(let n=0;n<2;n++)e[t+","+n]=me$3.fromAst("");return{setValue:{points:e}}}let n=t.stateValues.nearestPoint({variables:{x1:me$3.fromAst(0),x2:me$3.fromAst(0)}}),r=t.stateValues.points[0][0].evaluate_to_constant(),a=t.stateValues.points[0][1].evaluate_to_constant(),i=t.stateValues.points[1][0].evaluate_to_constant(),o=t.stateValues.points[1][1].evaluate_to_constant(),s=Math.atan2(o-a,i-r),l={"0,0":me$3.fromAst(n.x1+Math.cos(s)),"0,1":me$3.fromAst(n.x2+Math.sin(s)),"1,0":me$3.fromAst(n.x1),"1,1":me$3.fromAst(n.x2)},u=null;if(e.radiansAttr){if(u=e.radiansAttr.stateValues.value.evaluate_to_constant(),!Number.isFinite(u)){let e={};return e["2,0"]=me$3.fromAst(""),e["2,1"]=me$3.fromAst(""),{setValue:{points:e}}}}else if(e.degreesAttr){let t=e.degreesAttr.stateValues.value.evaluate_to_constant();if(!Number.isFinite(t))return l["2,0"]=me$3.fromAst(""),l["2,1"]=me$3.fromAst(""),{setValue:{points:l}};u=t/180*Math.PI}else u=Math.PI/2;let c=s+u;return l["2,0"]=me$3.fromAst(n.x1+Math.cos(c)),l["2,1"]=me$3.fromAst(n.x2+Math.sin(c)),{setValue:{points:l}}}{let t=e.lineChildren[0],n=e.lineChildren[1],r=calculateLineIntersection(t,n);if(void 0===r){let e={};for(let t=0;t<3;t++)for(let n=0;n<2;n++)e[t+","+n]=me$3.fromAst("");return{setValue:{points:e}}}let a=r,i=t.stateValues.points[0][0].evaluate_to_constant(),o=t.stateValues.points[0][1].evaluate_to_constant(),s=t.stateValues.points[1][0].evaluate_to_constant(),l=t.stateValues.points[1][1].evaluate_to_constant(),u=[me$3.fromAst(a[0].tree+s-i),me$3.fromAst(a[1].tree+l-o)];i=n.stateValues.points[0][0].evaluate_to_constant(),o=n.stateValues.points[0][1].evaluate_to_constant(),s=n.stateValues.points[1][0].evaluate_to_constant(),l=n.stateValues.points[1][1].evaluate_to_constant();let c=[me$3.fromAst(a[0].tree+s-i),me$3.fromAst(a[1].tree+l-o)];return{setValue:{points:{"0,0":u[0],"0,1":u[1],"1,0":a[0],"1,1":a[1],"2,0":c[0],"2,1":c[1]}}}}}let t,n=e.nPointsSpecified;t=e.throughAttr?e.throughAttr.stateValues.points:[];let r={};for(let[e,n]of t.entries())r[e+",0"]=n[0],r[e+",1"]=n[1];if(0===n&&(r["0,0"]=me$3.fromAst(1),r["0,1"]=me$3.fromAst(0)),n<2&&(r["1,0"]=me$3.fromAst(0),r["1,1"]=me$3.fromAst(0)),n<3){let t=null;if(e.radiansAttr){if(t=e.radiansAttr.stateValues.value.evaluate_to_constant(),!Number.isFinite(t))return r["2,0"]=me$3.fromAst(""),r["2,1"]=me$3.fromAst(""),{setValue:{points:r}}}else if(e.degreesAttr){let n=e.degreesAttr.stateValues.value.evaluate_to_constant();if(!Number.isFinite(n))return r["2,0"]=me$3.fromAst(""),r["2,1"]=me$3.fromAst(""),{setValue:{points:r}};t=n/180*Math.PI}else t=Math.PI/2;let n=r["0,0"].evaluate_to_constant(),a=r["0,1"].evaluate_to_constant(),i=r["1,0"].evaluate_to_constant(),o=r["1,1"].evaluate_to_constant(),s=Math.atan2(a-o,n-i)+t;r["2,0"]=me$3.fromAst(i+Math.cos(s)),r["2,1"]=me$3.fromAst(o+Math.sin(s))}return{setValue:{points:r}}}},e.radians={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},additionalStateVariablesDefined:[{variableName:"swapPointOrder",forRenderer:!0}],returnDependencies:()=>({radians:{dependencyType:"attributeComponent",attributeName:"radians",variableNames:["value"]},degrees:{dependencyType:"attributeComponent",attributeName:"degrees",variableNames:["value"]},points:{dependencyType:"stateVariable",variableName:"points"},chooseReflexAngle:{dependencyType:"stateVariable",variableName:"chooseReflexAngle"}}),definition({dependencyValues:e}){let t=!1;if(null!==e.radians)return{setValue:{radians:e.radians.stateValues.value.simplify(),swapPointOrder:t}};if(null!==e.degrees)return{setValue:{radians:e.degrees.stateValues.value.multiply(me$3.fromAst(["/","pi",180])).simplify(),swapPointOrder:t}};let n,r=[],a=!1;for(let t=0;t<3;t++)r.push([e.points[t][0].evaluate_to_constant(),e.points[t][1].evaluate_to_constant()]),null!==r[t][0]&&null!==r[t][1]||(a=!0);return a?{setValue:{radians:me$3.fromAst(""),swapPointOrder:t}}:(n=Math.atan2(r[2][1]-r[1][1],r[2][0]-r[1][0])-Math.atan2(r[0][1]-r[1][1],r[0][0]-r[1][0]),n<0&&(n+=2*Math.PI),n>Math.PI?"never"===e.chooseReflexAngle&&(n=2*Math.PI-n,t=!0):"always"===e.chooseReflexAngle&&(n=2*Math.PI-n,t=!0),{setValue:{radians:me$3.fromAst(n),swapPointOrder:t}})}},e.value={isAlias:!0,targetVariableName:"radians"},e.angle={isAlias:!0,targetVariableName:"radians"},e.degrees={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},returnDependencies:()=>({radians:{dependencyType:"stateVariable",variableName:"radians"}}),definition({dependencyValues:e}){let t;return t=""===e.radians.tree||Number.isNaN(e.radians.tree)?e.radians:e.radians.multiply(me$3.fromAst(["/",180,"pi"])).simplify(),{setValue:{degrees:t}}}},e.latexForRenderer={forRenderer:!0,returnDependencies:()=>({inDegrees:{dependencyType:"stateVariable",variableName:"inDegrees"},radians:{dependencyType:"stateVariable",variableName:"radians"},degrees:{dependencyType:"stateVariable",variableName:"degrees"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"}}),definition:function({dependencyValues:e,usedDefault:t}){let n={};e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits));let r=roundForDisplay({value:e.inDegrees?e.degrees:e.radians,dependencyValues:e,usedDefault:t}).toLatex(n);return e.inDegrees&&(r+="^\\circ"),{setValue:{latexForRenderer:r}}}},e.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[3],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].point,a=[];for(let e=0;e<2;e++){let n=t[e].evaluate_to_constant();Number.isFinite(n)||(n=NaN),a.push(n)}n[r]=a}return{setValue:{numericalPoints:n}}}},e.numericalRadius={forRenderer:!0,returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:e}){let t=e.radius.evaluate_to_constant();return Number.isFinite(t)||(t=NaN),{setValue:{numericalRadius:t}}}},e}static adapters=["radians"]}function calculateLineIntersection(e,t){if(2!==e.stateValues.nDimensions||2!==t.stateValues.nDimensions)return void console.log("Calculating angle between two lines implemented only in 2D");let n=e.stateValues.coeffvar1.evaluate_to_constant(),r=e.stateValues.coeffvar2.evaluate_to_constant(),a=e.stateValues.coeff0.evaluate_to_constant(),i=t.stateValues.coeffvar1.evaluate_to_constant(),o=t.stateValues.coeffvar2.evaluate_to_constant(),s=t.stateValues.coeff0.evaluate_to_constant();if(!(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(s)))return void console.log("Calculating angle between two lines implemented only for constant coefficients");let l=n*o-i*r;if(Math.abs(l)<1e-14)return Math.abs(s*n-a*i)>1e-14?void console.log("Cannot calculate angle between two parallel lines"):0===n&&0===r&&0===a||0===i&&0===o&&0===s?void 0:0!==r?[me$3.fromAst(0),me$3.fromAst(-a/r)]:[me$3.fromAst(-a/n),me$3.fromAst(0)];let u=(s*r-a*o)/l,c=(a*i-s*n)/l;return[me$3.fromAst(u),me$3.fromAst(c)]}var defaults$5={space:"",cycles:!1,replacer:(e,t)=>t,stringify:JSON.stringify},util$1={isArray:Array.isArray,assign:Object.assign,isObject:e=>"object"==typeof e,isFunction:e=>"function"==typeof e,isBoolean:e=>"boolean"==typeof e,isRegex:e=>e instanceof RegExp,keys:Object.keys};const DEFAULTS=defaults$5,isFunction$2=util$1.isFunction,isBoolean$1=util$1.isBoolean,isObject$n=util$1.isObject,isArray$8=util$1.isArray,isRegex=util$1.isRegex,assign$2=util$1.assign,keys$4=util$1.keys;function serialize(e){return null==e?e:isRegex(e)?e.toString():e.toJSON?e.toJSON():e}function stringifyDeterministic(e,t){t=t||assign$2({},DEFAULTS),isFunction$2(t)&&(t={compare:t});const n=t.space||DEFAULTS.space,r=isBoolean$1(t.cycles)?t.cycles:DEFAULTS.cycles,a=t.replacer||DEFAULTS.replacer,i=t.stringify||DEFAULTS.stringify,o=t.compare&&function(e){return function(t){return function(n,r){const a={key:n,value:t[n]},i={key:r,value:t[r]};return e(a,i)}}}(t.compare);r||i(e);const s=[];return function e(t,l,u,c){const p=n?"\n"+new Array(c+1).join(n):"",d=n?": ":":";if(u=serialize(u),void 0!==(u=a.call(t,l,u))){if(!isObject$n(u)||null===u)return i(u);if(isArray$8(u)){const t=[];for(let r=0;r<u.length;r++){const a=e(u,r,u[r],c+1)||i(null);t.push(p+n+a)}return"["+t.join(",")+p+"]"}{if(r){if(-1!==s.indexOf(u))return i("[Circular]");s.push(u)}const t=keys$4(u).sort(o&&o(u)),a=[];for(let r=0;r<t.length;r++){const o=t[r],s=e(u,o,u[o],c+1);if(!s)continue;const l=i(o)+d+s;a.push(p+n+l)}return s.splice(s.indexOf(u),1),"{"+a.join(",")+p+"}"}}}({"":e},"",e,0)}var lib=stringifyDeterministic;class Answer extends InlineComponent{static componentType="answer";static renderChildren=!0;static variableForPlainMacro="submittedResponses";static createAttributesObject(){let e=super.createAttributesObject();return e.weight={createComponentOfType:"number",createStateVariable:"weight",defaultValue:1,public:!0},e.inline={createComponentOfType:"boolean",createStateVariable:"inline",defaultValue:!1,public:!0},e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0},e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0},e.forceFullCheckworkButton={createComponentOfType:"boolean",createStateVariable:"forceFullCheckworkButton",defaultValue:!1,public:!0},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],public:!0},e.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0},e.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0},e.nAwardsCredited={createComponentOfType:"integer",createStateVariable:"nAwardsCredited",defaultValue:1,public:!0},e.maximumNumberOfAttempts={createComponentOfType:"integer",createStateVariable:"maximumNumberOfAttempts",defaultValue:1/0,public:!0},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0},e.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0},e.showCorrectness={createComponentOfType:"boolean",createStateVariable:"showCorrectnessPreliminary",defaultValue:null},e.type={createPrimitiveOfType:"string"},e.disableAfterCorrect={createComponentOfType:"boolean",createStateVariable:"disableAfterCorrect",defaultValue:!1,public:!0},e.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0},e.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){if(!e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro)))return{success:!1};let n;return n=t.type?t.type:"math",["math","text","boolean"].includes(n)||(console.warn(`Invalid type ${n}`),n="math"),{success:!0,newChildren:[{componentType:"award",children:[{componentType:n,children:e}]}]}}}),e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t,componentInfoObjects:n}){let r,a=!1;for(let t of e){if(n.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"_input"}))return{success:!1};if(n.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"considerAsResponses"}))return{success:!1};(n.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"_composite"})||n.isInheritedComponentType({inheritedComponentType:t.componentType,baseComponentType:"award"})&&t.children&&!t.children.some((e=>n.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"when"}))))&&(a=!0)}return a?(r=t.type?t.type:"math",["math","text","boolean"].includes(r)||(console.warn(`Invalid type ${r}`),r="math"),{success:!0,newChildren:[{componentType:r+"Input"},...e]}):{success:!1}}}),e}static returnChildGroups(){return[{group:"awards",componentTypes:["award"]},{group:"numbers",componentTypes:["number"]},{group:"inputs",componentTypes:["_input"]},{group:"responses",componentTypes:["considerAsResponses"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:e,oldName:"disabled",newName:"disabledOriginal"}),e.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessPreliminary:{dependencyType:"stateVariable",variableName:"showCorrectnessPreliminary"},showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition({dependencyValues:e,usedDefault:t}){let n;return n=t.showCorrectnessPreliminary?!1!==e.showCorrectnessFlag:e.showCorrectnessPreliminary,{setValue:{showCorrectness:n}}}},e.haveAwardThatRequiresInput={returnDependencies:()=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["requireInputInAnswer"]}}),definition:({dependencyValues:e})=>({setValue:{haveAwardThatRequiresInput:e.awardChildren.some((e=>e.stateValues.requireInputInAnswer))}})},e.allInputChildrenIncludingSugared={returnDependencies:()=>({allInputChildrenIncludingSugared:{dependencyType:"child",childGroups:["inputs"]}}),definition:({dependencyValues:e})=>({setValue:{allInputChildrenIncludingSugared:e.allInputChildrenIncludingSugared}})},e.inputChildren={stateVariablesDeterminingDependencies:["allInputChildrenIncludingSugared"],additionalStateVariablesDefined:["inputChildIndices","skippedFirstInput"],forRenderer:!0,returnDependencies({stateValues:e}){let t={allInputChildrenIncludingSugared:{dependencyType:"stateVariable",variableName:"allInputChildrenIncludingSugared"},haveAwardThatRequiresInput:{dependencyType:"stateVariable",variableName:"haveAwardThatRequiresInput"}};return e.allInputChildrenIncludingSugared.length>0&&(t.firstInputFromSugar={dependencyType:"doenetAttribute",componentName:e.allInputChildrenIncludingSugared[0].componentName,attributeName:"createdFromSugar"}),t},definition({dependencyValues:e}){let t=[...e.allInputChildrenIncludingSugared],n=[...e.allInputChildrenIncludingSugared.keys()],r=!1;return(!e.haveAwardThatRequiresInput||e.allInputChildrenIncludingSugared.length>1)&&e.firstInputFromSugar&&(r=!0,t=t.slice(1),n=n.slice(1)),{setValue:{inputChildren:t,inputChildIndices:n,skippedFirstInput:r}}}},e.inputChildrenWithValues={stateVariablesDeterminingDependencies:["inputChildIndices"],forRenderer:!0,returnDependencies:({stateValues:e})=>({inputChildren:{dependencyType:"child",childGroups:["inputs"],variableNames:["valueToRecordOnSubmit","valueRecordedAtSubmit","value","immediateValue"],childIndices:e.inputChildIndices,variablesOptional:!0}}),definition:function({dependencyValues:e}){return{setValue:{inputChildrenWithValues:e.inputChildren}}}},e.inputChildWithValues={returnDependencies:()=>({inputChildrenWithValues:{dependencyType:"stateVariable",variableName:"inputChildrenWithValues"}}),definition({dependencyValues:e}){let t=null;return 1===e.inputChildrenWithValues.length&&(t=e.inputChildrenWithValues[0]),{setValue:{inputChildWithValues:t}}}},e.awardInputResponseChildren={returnDependencies:()=>({awardInputResponseChildren:{dependencyType:"child",childGroups:["awards","inputs","responses"]},skippedFirstInput:{dependencyType:"stateVariable",variableName:"skippedFirstInput"}}),definition({dependencyValues:e}){let t=[...e.awardInputResponseChildren];return e.skippedFirstInput&&(t=t.slice(1)),{setValue:{awardInputResponseChildren:t}}}},e.nResponses={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnDependencies({stateValues:e,componentInfoObjects:t}){let n={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map((e=>e.componentType))}};for(let[r,a]of e.awardInputResponseChildren.entries())t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"award"})?n["child"+r]={dependencyType:"descendant",ancestorName:a.componentName,componentTypes:["_base"],variableNames:["isResponse","nValues"],variablesOptional:!0,recurseToMatchedChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_input"})?n["childNValues"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"nValues",variablesOptional:!0}:n["child"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"childrenWithNValues"};return n},definition({dependencyValues:e,componentInfoObjects:t}){let n=0;for(let[r,a]of e.childTypes.entries())if(t.isInheritedComponentType({inheritedComponentType:a,baseComponentType:"award"}))for(let a of e["child"+r])a.stateValues.isResponse&&!t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_composite"})&&(void 0===a.stateValues.nValues?n+=1:n+=a.stateValues.nValues);else if(t.isInheritedComponentType({inheritedComponentType:a,baseComponentType:"_input"})){let t=e["childNValues"+r];n+=void 0===t?1:t}else for(let t of e["child"+r])void 0===t.stateValues.nValues?n+=1:n+=t.stateValues.nValues;return{setValue:{nResponses:n}}}},e.currentResponses={public:!0,shadowingInstructions:{hasVariableComponentType:!0},isArray:!0,entryPrefixes:["currentResponse"],stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnArraySizeDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),returnArraySize:({dependencyValues:e})=>[e.nResponses],returnArrayDependenciesByKey({stateValues:e,componentInfoObjects:t}){let n={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map((e=>e.componentType))}};for(let[r,a]of e.awardInputResponseChildren.entries())t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"award"})?n["child"+r]={dependencyType:"descendant",ancestorName:a.componentName,componentTypes:["_base"],variableNames:["isResponse","value","values","componentType"],variablesOptional:!0,recurseToMatchedChildren:!0,includeAttributeChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_input"})?(n["childValue"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"value",variablesOptional:!0},n["childValues"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"values",variablesOptional:!0},n["childComponentType"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"componentType",variablesOptional:!0}):n["child"+r]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"childrenAsResponses"};return{globalDependencies:n}},arrayDefinitionByKey({globalDependencyValues:e,componentInfoObjects:t}){let n=[],r=[],a=[];for(let[n,r]of e.childTypes.entries())if(t.isInheritedComponentType({inheritedComponentType:r,baseComponentType:"award"}))for(let r of e["child"+n])r.stateValues.isResponse&&!t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"_composite"})&&a.push(r);else if(t.isInheritedComponentType({inheritedComponentType:r,baseComponentType:"_input"})){let t={componentType:r,stateValues:{value:e["childValue"+n],values:e["childValues"+n],componentType:e["childComponentType"+n]}};a.push(t)}else a.push(...e["child"+n]);for(let e of a){let t=e.stateValues.componentType;t||(t=e.componentType),"mathList"===t?t="math":"numberList"===t?t="number":"textList"===t?t="text":"booleanList"===t&&(t="booelan;"),Array.isArray(e.stateValues.values)?(n.push(...e.stateValues.values),r.push(...Array(e.stateValues.values.length).fill(t))):(n.push(e.stateValues.value),r.push(t))}return{setValue:{currentResponses:n},setCreateComponentOfType:{currentResponses:r}}}},e.currentResponse={isAlias:!0,targetVariableName:"currentResponse1"},e.nSubmittedResponses={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nSubmittedResponses:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"nSubmittedResponses",value:e.nSubmittedResponses}]})},e.submittedResponsesComponentType={hasEssential:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedResponsesComponentType:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return e.submittedResponsesComponentType?{success:!0,instructions:[{setEssentialValue:"submittedResponsesComponentType",value:[...e.submittedResponsesComponentType]}]}:{success:!0,instructions:[{setEssentialValue:"submittedResponsesComponentType",value:[]}]}}},e.submittedResponses={public:!0,shadowingInstructions:{hasVariableComponentType:!0},isArray:!0,entryPrefixes:["submittedResponse"],defaultValueByArrayKey:()=>"",hasEssential:!0,inverseShadowToSetEntireArray:!0,doNotCombineInverseArrayInstructions:!0,returnArraySizeDependencies:()=>({nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}),returnArraySize:({dependencyValues:e})=>[e.nSubmittedResponses],returnArrayDependenciesByKey:()=>({globalDependencies:{submittedResponsesComponentType:{dependencyType:"stateVariable",variableName:"submittedResponsesComponentType"},nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=[];e.submittedResponsesComponentType&&t.push(...e.submittedResponsesComponentType.slice(0,e.nSubmittedResponses));let n={};for(let r=0;r<e.nSubmittedResponses;r++)n[r]=!0,t[r]||(t[r]="math");return{useEssentialOrDefaultValue:{submittedResponses:n},setCreateComponentOfType:{submittedResponses:t}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:e,initialChange:t}){return t?{success:!0,instructions:[{setDependency:"nSubmittedResponses",desiredValue:e.submittedResponses.length},{setEssentialValue:"submittedResponses",value:[...e.submittedResponses]}]}:{success:!1}}},e.submittedResponse={isAlias:!0,targetVariableName:"submittedResponse1"},e.delegateCheckWork={additionalStateVariablesDefined:["delegateCheckWorkToInput","delegateCheckWorkToAncestor"],forRenderer:!0,returnDependencies:()=>({inputChildren:{dependencyType:"stateVariable",variableName:"inputChildren"},forceFullCheckworkButton:{dependencyType:"stateVariable",variableName:"forceFullCheckworkButton"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningComponent",variableNames:["suppressAnswerSubmitButtons"]},documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["suppressAnswerSubmitButtons"]}}),definition:function({dependencyValues:e,componentName:t}){let n=!1,r=!1,a=!1;if(e.documentAncestor.stateValues.suppressAnswerSubmitButtons)n=a=!0;else if(e.sectionAncestor){e.sectionAncestor.stateValues.suppressAnswerSubmitButtons&&(n=a=!0)}return n||1!==e.inputChildren.length||e.forceFullCheckworkButton||(r=a=!0),{setValue:{delegateCheckWork:a,delegateCheckWorkToAncestor:n,delegateCheckWorkToInput:r}}}},e.creditAchievedIfSubmit={additionalStateVariablesDefined:["awardsUsedIfSubmit","awardChildren","inputUsedIfSubmit"],stateVariablesDeterminingDependencies:["inputChildIndices"],returnDependencies:({stateValues:e})=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["credit","creditAchievedIfSubmit","fractionSatisfiedIfSubmit"]},inputChildren:{dependencyType:"child",childGroups:["inputs"],variableNames:["creditAchievedIfSubmit"],childIndices:e.inputChildIndices,variablesOptional:!0},nAwardsCredited:{dependencyType:"stateVariable",variableName:"nAwardsCredited"}}),definition:function({dependencyValues:e}){let t=0,n=e.nAwardsCredited,r=Array(n).fill(null),a=null;if(0===e.awardChildren.length){if(1===e.inputChildren.length){let n=e.inputChildren[0].stateValues.creditAchievedIfSubmit;n>=0&&(t=n,a=e.inputChildren[0].componentName)}}else{let a=Array(n).fill(null),i=0;for(let t of e.awardChildren){let e=t.stateValues.creditAchievedIfSubmit;if((e>i||null===r[n-1])&&t.stateValues.fractionSatisfiedIfSubmit>0)if(null===r[0])r[0]=t.componentName,a[0]=e,i=Math.min(...a);else for(let[o,s]of a.entries())if(e>s||null===s){r.splice(o,0,t.componentName),r=r.slice(0,n),a.splice(o,0,e),a=a.slice(0,n),i=Math.min(...a);break}}t=Math.min(1,a.reduce(((e,t)=>e+t),0))}return{setValue:{creditAchievedIfSubmit:t,awardsUsedIfSubmit:r,awardChildren:e.awardChildren,inputUsedIfSubmit:a}}}},e.creditAchieved={defaultValue:0,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"creditAchieved",value:e.creditAchieved}]}}},e.responseHasBeenSubmitted={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{responseHasBeenSubmitted:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"responseHasBeenSubmitted",value:e.responseHasBeenSubmitted}]}}},e.creditAchievedDependencies={shadowVariable:!0,returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"recursiveDependencyValues",variableNames:["creditAchievedIfSubmit"],includeImmediateValueWithValue:!0,includeRawValueWithImmediateValue:!0,includeOnlyEssentialValues:!0}}),definition({dependencyValues:e}){let t=lib(e.currentCreditAchievedDependencies,{replacer:serializedComponentsReplacer});return{setValue:{creditAchievedDependencies:Base64.stringify(sha1(t))}}}},e.creditAchievedDependenciesAtSubmit={defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchievedDependenciesAtSubmit:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"creditAchievedDependenciesAtSubmit",value:e.creditAchievedDependenciesAtSubmit}]}}},e.justSubmitted={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"stateVariable",variableName:"creditAchievedDependencies"},creditAchievedDependenciesAtSubmit:{dependencyType:"stateVariable",variableName:"creditAchievedDependenciesAtSubmit"},disableAfterCorrect:{dependencyType:"stateVariable",variableName:"disableAfterCorrect"},hasBeenCorrect:{dependencyType:"stateVariable",variableName:"hasBeenCorrect"}}),definition:function({dependencyValues:e,justUpdatedForNewComponent:t,componentName:n}){if(e.disableAfterCorrect&&e.hasBeenCorrect)return{setValue:{justSubmitted:!0}};return e.creditAchievedDependenciesAtSubmit!==e.currentCreditAchievedDependencies&&!t?{setValue:{justSubmitted:!1},setEssentialValue:{justSubmitted:!1}}:{useEssentialOrDefaultValue:{justSubmitted:!0}}},inverseDefinition:({desiredStateVariableValues:e,componentName:t})=>({success:!0,instructions:[{setEssentialValue:"justSubmitted",value:e.justSubmitted}]})},e.allFeedbacks={returnDependencies:()=>({awardChildren:{dependencyType:"child",childGroups:["awards"],variableNames:["feedbacks"]},feedbackComponents:{dependencyType:"descendant",componentTypes:["_input"],variableNames:["feedbacks"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.awardChildren)t.push(...n.stateValues.feedbacks);for(let n of e.feedbackComponents)Array.isArray(n.stateValues.feedbacks)&&t.push(...n.stateValues.feedbacks);return{setValue:{allFeedbacks:t}}}},e.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition:({dependencyValues:e})=>({setValue:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}})},e.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize:({dependencyValues:e})=>[e.numberFeedbacks],returnArrayDependenciesByKey:()=>({globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size;n++)t[n]=e.allFeedbacks[n];return{setValue:{feedbacks:t}}}},e.nSubmissions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nSubmissions:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"nSubmissions",value:e.nSubmissions}]})},e.numberOfAttemptsLeft={public:!0,shadowingInstructions:{createComponentOfType:"integer"},forRenderer:!0,returnDependencies:()=>({nSubmissions:{dependencyType:"stateVariable",variableName:"nSubmissions"},maximumNumberOfAttempts:{dependencyType:"stateVariable",variableName:"maximumNumberOfAttempts"}}),definition:({dependencyValues:e})=>({setValue:{numberOfAttemptsLeft:e.maximumNumberOfAttempts-e.nSubmissions}})},e.hasBeenCorrect={defaultValue:!1,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"}}),definition:({dependencyValues:e})=>1===e.creditAchieved?{setValue:{hasBeenCorrect:!0},setEssentialValue:{hasBeenCorrect:!0}}:{useEssentialOrDefaultValue:{hasBeenCorrect:!0}}},e.disabled={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,stateVariablesDeterminingDependencies:["disableAfterCorrect"],returnDependencies({stateValues:e}){let t={disabledOriginal:{dependencyType:"stateVariable",variableName:"disabledOriginal"},numberOfAttemptsLeft:{dependencyType:"stateVariable",variableName:"numberOfAttemptsLeft"},disableAfterCorrect:{dependencyType:"stateVariable",variableName:"disableAfterCorrect"}};return e.disableAfterCorrect&&(t.hasBeenCorrect={dependencyType:"stateVariable",variableName:"hasBeenCorrect"}),t},definition:({dependencyValues:e})=>({setValue:{disabled:e.disabledOriginal||e.numberOfAttemptsLeft<1||e.disableAfterCorrect&&e.hasBeenCorrect}})},e.inItemNumber={returnDependencies:()=>({documentAncestor:{dependencyType:"ancestor",componentType:"document",variableNames:["itemNumberByAnswerName"]}}),definition:({dependencyValues:e,componentName:t})=>({setValue:{inItemNumber:e.documentAncestor.stateValues.itemNumberByAnswerName[t]}})},e}actions={submitAnswer:this.submitAnswer.bind(this)};async submitAnswer({actionId:e}){let t=await this.stateValues.numberOfAttemptsLeft;if(t<1)return void console.warn(`Cannot submit answer for ${this.componentName} as number of attempts left is ${t}`);let n=await this.stateValues.creditAchievedIfSubmit,r=await this.stateValues.awardsUsedIfSubmit,a=await this.stateValues.inputUsedIfSubmit,i=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchieved",value:n},{updateType:"updateValue",componentName:this.componentName,stateVariable:"responseHasBeenSubmitted",value:!0}],o=await this.stateValues.inputChildrenWithValues;if(1===o.length){let e=o[0];a===e.componentName&&"valueToRecordOnSubmit"in e.stateValues&&"valueRecordedAtSubmit"in e.stateValues&&i.push({updateType:"updateValue",componentName:e.componentName,stateVariable:"valueRecordedAtSubmit",value:e.stateValues.valueToRecordOnSubmit})}let s=await this.stateValues.currentResponses;i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponses",value:s}),i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponsesComponentType",value:this.state.currentResponses.shadowingInstructions.createComponentOfType}),i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"justSubmitted",value:!0}),i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchievedDependenciesAtSubmit",value:await this.stateValues.creditAchievedDependencies}),i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"nSubmissions",value:await this.stateValues.nSubmissions+1});for(let e of await this.stateValues.awardChildren){let t=r.includes(e.componentName);i.push({updateType:"updateValue",componentName:e.componentName,stateVariable:"awarded",value:t}),i.push({updateType:"updateValue",componentName:e.componentName,stateVariable:"creditAchieved",value:e.stateValues.creditAchievedIfSubmit}),i.push({updateType:"updateValue",componentName:e.componentName,stateVariable:"fractionSatisfied",value:e.stateValues.fractionSatisfiedIfSubmit})}let l=[];for(let e of s)e.toString?l.push(e.toString()):l.push(e);return i.push({updateType:"recordItemSubmission",itemNumber:await this.stateValues.inItemNumber,submittedComponent:this.componentName,response:s,responseText:l,creditAchieved:n}),await this.coreFunctions.performUpdate({updateInstructions:i,actionId:e,event:{verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{response:s,responseText:l,creditAchieved:n}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}}class Award extends BaseComponent{static componentType="award";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:1,public:!0,attributesForCreatedComponent:{convertBoolean:!0}},e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"},e.symbolicEquality={createComponentOfType:"boolean",createStateVariable:"symbolicEquality",defaultValue:!1,public:!0,fallBackToParentStateVariable:"symbolicEquality"},e.expandOnCompare={createComponentOfType:"boolean",createStateVariable:"expandOnCompare",defaultValue:!1,public:!0,fallBackToParentStateVariable:"expandOnCompare"},e.simplifyOnCompare={createComponentOfType:"text",createStateVariable:"simplifyOnCompare",defaultValue:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numberspreserveorder"],public:!0,fallBackToParentStateVariable:"simplifyOnCompare"},e.unorderedCompare={createComponentOfType:"boolean",createStateVariable:"unorderedCompare",defaultValue:!1,public:!0,fallBackToParentStateVariable:"unorderedCompare"},e.matchByExactPositions={createComponentOfType:"boolean",createStateVariable:"matchByExactPositions",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchByExactPositions"},e.allowedErrorInNumbers={createComponentOfType:"number",createStateVariable:"allowedErrorInNumbers",defaultValue:0,public:!0,fallBackToParentStateVariable:"allowedErrorInNumbers"},e.includeErrorInNumberExponents={createComponentOfType:"boolean",createStateVariable:"includeErrorInNumberExponents",defaultValue:!1,public:!0,fallBackToParentStateVariable:"includeErrorInNumberExponents"},e.allowedErrorIsAbsolute={createComponentOfType:"boolean",createStateVariable:"allowedErrorIsAbsolute",defaultValue:!1,public:!0,fallBackToParentStateVariable:"allowedErrorIsAbsolute"},e.nSignErrorsMatched={createComponentOfType:"number",createStateVariable:"nSignErrorsMatched",defaultValue:0,public:!0,fallBackToParentStateVariable:"nSignErrorsMatched"},e.nPeriodicSetMatchesRequired={createComponentOfType:"integer",createStateVariable:"nPeriodicSetMatchesRequired",defaultValue:3,public:!0,fallBackToParentStateVariable:"nPeriodicSetMatchesRequired"},e.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0},e.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0},e.targetsAreResponses={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,parentAttributes:t}){if(!e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro)))return{success:!1};let n;return n=t.type?t.type:"math",["math","text","boolean"].includes(n)||(console.warn(`Invalid type ${n}`),n="math"),{success:!0,newChildren:[{componentType:n,children:e}]}}}),e}static returnChildGroups(){return[{group:"whens",componentTypes:["when"]},{group:"maths",componentTypes:["math"]},{group:"numbers",componentTypes:["number"]},{group:"texts",componentTypes:["text"]},{group:"booleans",componentTypes:["boolean"]},{group:"mathLists",componentTypes:["mathList"]},{group:"numberLists",componentTypes:["numberList"]},{group:"textLists",componentTypes:["textList"]},{group:"booleanLists",componentTypes:["booleanList"]},{group:"otherComparableTypes",componentTypes:["orbitalDiagram"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.parsedExpression={additionalStateVariablesDefined:["requireInputInAnswer"],returnDependencies:()=>({whenChild:{dependencyType:"child",childGroups:["whens"]},typeChildren:{dependencyType:"child",childGroups:["maths","numbers","texts","booleans","mathLists","numberLists","textLists","booleanLists","otherComparableTypes"]}}),definition:function({dependencyValues:e}){let t=null,n=!1;return 0==e.whenChild.length&&e.typeChildren.length>0&&(n=!0,t=me$3.fromAst(["=","comp1","comp2"])),{setValue:{parsedExpression:t,requireInputInAnswer:n}}}},e.creditAchievedIfSubmit={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"fractionSatisfiedIfSubmit",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({credit:{dependencyType:"stateVariable",variableName:"credit"},whenChild:{dependencyType:"child",childGroups:["whens"],variableNames:["fractionSatisfied"]},mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value","unordered"]},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},textChild:{dependencyType:"child",childGroups:["texts"],variableNames:["value"]},booleanChild:{dependencyType:"child",childGroups:["booleans"],variableNames:["value"]},mathListChild:{dependencyType:"child",childGroups:["mathLists"],variableNames:["maths","unordered"]},numberListChild:{dependencyType:"child",childGroups:["numberLists"],variableNames:["numbers","unordered"]},textListChild:{dependencyType:"child",childGroups:["textLists"],variableNames:["texts","unordered"]},booleanListChild:{dependencyType:"child",childGroups:["booleanLists"],variableNames:["booleans","unordered"]},otherComparableChild:{dependencyType:"child",childGroups:["otherComparableTypes"],variableNames:["value"]},answerInput:{dependencyType:"parentStateVariable",variableName:"inputChildWithValues"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"}}),definition:function({dependencyValues:e,usedDefault:t}){let n;if(e.whenChild.length>0)n=e.whenChild[0].stateValues.fractionSatisfied;else{if(!e.answerInput||!e.parsedExpression)return{setValue:{creditAchievedIfSubmit:0,fractionSatisfiedIfSubmit:0}};n=evaluateLogicDirectlyFromChildren({dependencyValues:e,usedDefault:t})}n=Math.max(0,Math.min(1,n));let r=0;return Number.isFinite(e.credit)&&(r=Math.max(0,Math.min(1,e.credit))*n),{setValue:{fractionSatisfiedIfSubmit:n,creditAchievedIfSubmit:r}}}},e.fractionSatisfied={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fractionSatisfied:!0}}),inverseDefinition:function({desiredStateVariableValues:e,initialChange:t}){return t?{success:!0,instructions:[{setEssentialValue:"fractionSatisfied",value:e.fractionSatisfied}]}:{success:!1}}},e.creditAchieved={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:!0}}),inverseDefinition:function({desiredStateVariableValues:e,initialChange:t}){return t?{success:!0,instructions:[{setEssentialValue:"creditAchieved",value:e.creditAchieved}]}:{success:!1}}},e.awarded={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{awarded:!0}}),inverseDefinition:function({desiredStateVariableValues:e,initialChange:t}){return t?{success:!0,instructions:[{setEssentialValue:"awarded",value:e.awarded}]}:{success:!1}}},e.allFeedbacks={returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitionAncestor:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},awarded:{dependencyType:"stateVariable",variableName:"awarded"}}),definition:function({dependencyValues:e}){if(!e.awarded)return{setValue:{allFeedbacks:[]}};let t=[],n=e.feedbackDefinitionAncestor.stateValues.feedbackDefinitions;for(let r of e.feedbackCodes){let e=n[r.toLowerCase()];e&&t.push(e)}return null!==e.feedbackText&&t.push(e.feedbackText),{setValue:{allFeedbacks:t}}}},e.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition:({dependencyValues:e})=>({setValue:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}})},e.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize:({dependencyValues:e})=>[e.numberFeedbacks],returnArrayDependenciesByKey:()=>({globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size;n++)t[n]=e.allFeedbacks[n];return{setValue:{feedbacks:t}}}},e.feedback={isAlias:!0,targetVariableName:"feedback1"},e}static adapters=["awarded"];static standardizedFeedback={numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."}}function evaluateLogicDirectlyFromChildren({dependencyValues:e,usedDefault:t}){let n={mathChildrenByCode:{},mathListChildrenByCode:{},numberChildrenByCode:{},numberListChildrenByCode:{},textChildrenByCode:{},textListChildrenByCode:{},booleanChildrenByCode:{},booleanListChildrenByCode:{},otherChildrenByCode:{}};Object.assign(n,e);let r=t.unorderedCompare;e.textChild.length>0?n.textChildrenByCode.comp2=e.textChild[0]:e.mathChild.length>0?n.mathChildrenByCode.comp2=e.mathChild[0]:e.numberChild.length>0?n.numberChildrenByCode.comp2=e.numberChild[0]:e.booleanChild.length>0?n.booleanChildrenByCode.comp2=e.booleanChild[0]:e.textListChild.length>0?n.textListChildrenByCode.comp2=e.textListChild[0]:e.mathListChild.length>0?n.mathListChildrenByCode.comp2=e.mathListChild[0]:e.numberListChild.length>0?n.numberListChildrenByCode.comp2=e.numberListChild[0]:e.booleanListChild.length>0?n.booleanListChildrenByCode.comp2=e.booleanListChild[0]:e.otherComparableChild.length>0&&(n.otherChildrenByCode.comp2=e.otherComparableChild[0]);let a=e.answerInput.stateValues.immediateValue;void 0===a&&(a=e.answerInput.stateValues.value);let i={stateValues:{value:a}};return"textInput"===e.answerInput.componentType?n.textChildrenByCode.comp1=i:"booleanInput"===e.answerInput.componentType?n.booleanChildrenByCode.comp1=i:n.mathChildrenByCode.comp1=i,evaluateLogic({logicTree:e.parsedExpression.tree,canOverrideUnorderedCompare:r,dependencyValues:n})}class When extends BooleanComponent{static componentType="when";static rendererType=void 0;static stateVariableForAttributeValue="conditionSatisfied";static createAttributesObject(){let e=super.createAttributesObject();e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"};for(let t of["symbolicEquality","expandOnCompare","simplifyOnCompare","unorderedCompare","matchByExactPositions","allowedErrorInNumbers","includeErrorInNumberExponents","allowedErrorIsAbsolute","nSignErrorsMatched","nPeriodicSetMatchesRequired"])e[t].fallBackToParentStateVariable=t;return e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},additionalStateVariablesDefined:[{variableName:"fractionSatisfied",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"conditionSatisfied",public:!0,shadowingInstructions:{createComponentOfType:"boolean"}}],returnDependencies:()=>({matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},matchByExactPositions:{dependencyType:"stateVariable",variableName:"matchByExactPositions"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},nPeriodicSetMatchesRequired:{dependencyType:"stateVariable",variableName:"nPeriodicSetMatchesRequired"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanListChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanListChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textListChildrenByCode:{dependencyType:"stateVariable",variableName:"textListChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathListChildrenByCode:{dependencyType:"stateVariable",variableName:"mathListChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},numberListChildrenByCode:{dependencyType:"stateVariable",variableName:"numberListChildrenByCode"},otherChildrenByCode:{dependencyType:"stateVariable",variableName:"otherChildrenByCode"}}),definition({dependencyValues:e,usedDefault:t}){if(null===e.parsedExpression)return{setValue:{conditionSatisfied:!1,value:!1,fractionSatisfied:0}};let n=t.unorderedCompare,r=evaluateLogic({logicTree:e.parsedExpression.tree,canOverrideUnorderedCompare:n,dependencyValues:e}),a=1===r;return{setValue:{fractionSatisfied:r,conditionSatisfied:a,value:a}}}},e}}class MathInput extends Input{constructor(e){super(e),this.actions={updateRawValue:this.updateRawValue.bind(this),updateValue:this.updateValue.bind(this)},this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let e=await this.stateValues.answerAncestor;return null!==e?{componentName:e.componentName,actionName:"submitAnswer"}:void 0}.bind(this)})}static componentType="mathInput";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.prefill={createComponentOfType:"math",createStateVariable:"prefill",defaultValue:me$3.fromAst(""),public:!0,copyComponentAttributesForCreatedComponent:["format","functionSymbols","splitSymbols"]},e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},e.functionSymbols={createComponentOfType:"textList",createStateVariable:"functionSymbols",defaultValue:["f","g"],public:!0},e.splitSymbols={createComponentOfType:"boolean",createStateVariable:"splitSymbols",defaultValue:!0,public:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.bindValueTo={createComponentOfType:"math"},e.unionFromU={createComponentOfType:"boolean",createStateVariable:"unionFromU",defaultValue:!1,public:!0},e.hideNaN={createComponentOfType:"boolean",createStateVariable:"hideNaN",defaultValue:!0,public:!0},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e}){return 0===e.length?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:e}]}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),set:convertValueToMathExpression,definition:function({dependencyValues:e}){return e.mathChild.length>0?{setValue:{value:e.mathChild[0].stateValues.value}}:e.bindValueTo?{setValue:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return t.mathChild.length>0?{success:!0,instructions:[{setDependency:"mathChild",desiredValue:e.value,variableIndex:0,childIndex:0}]}:t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:e.value}]}}},e.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"math",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),set:convertValueToMathExpression,definition:function({dependencyValues:e,changes:t,justUpdatedForNewComponent:n}){return t.value&&!n?{setValue:{immediateValue:e.value},setEssentialValue:{immediateValue:e.value}}:{useEssentialOrDefaultValue:{immediateValue:{defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:t,shadowedVariable:n}){let r=[{setEssentialValue:"immediateValue",value:e.immediateValue}];return t||n||r.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:r}}},e.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),set:convertValueToMathExpression,definition:function({dependencyValues:e,usedDefault:t}){return{setValue:{valueForDisplay:roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t})}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.valueForDisplay.toString()}}}},e.rawRendererValue={forRenderer:!0,hasEssential:!0,shadowVariable:!0,defaultValue:"",provideEssentialValuesInDefinition:!0,public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"lastValueForDisplay",hasEssential:!0,shadowVariable:!0,defaultValue:null,set:convertValueToMathExpression}],returnDependencies:()=>({immediateValue:{dependencyType:"stateVariable",variableName:"immediateValue"},valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},hideNaN:{dependencyType:"stateVariable",variableName:"hideNaN"}}),definition({dependencyValues:e,essentialValues:t,justUpdatedForNewComponent:n,componentName:r}){if(void 0===t.rawRendererValue||!n&&!deepCompare(t.lastValueForDisplay.tree,e.valueForDisplay.tree)){let t=stripLatex(e.valueForDisplay.toLatex());return(""===t||e.hideNaN&&"NaN"===t)&&(t=""),{setValue:{rawRendererValue:t,lastValueForDisplay:e.valueForDisplay},setEssentialValue:{rawRendererValue:t,lastValueForDisplay:e.valueForDisplay}}}return{useEssentialOrDefaultValue:{rawRendererValue:!0,lastValueForDisplay:!0}}},async inverseDefinition({desiredStateVariableValues:e,stateValues:t,essentialValues:n,dependencyValues:r,componentName:a}){const i=async e=>{let n;e=normalizeLatexString(e,{unionFromU:await t.unionFromU});let r=getFromLatex({functionSymbols:await t.functionSymbols,splitSymbols:await t.splitSymbols});try{n=r(e)}catch(e){n=me$3.fromAst("")}return n};let o=[];if("string"==typeof e.rawRendererValue){let t=n.rawRendererValue,r=e.rawRendererValue;t!==r&&o.push({setEssentialValue:"rawRendererValue",value:r});let a=await i(t),s=await i(r);deepCompare(s.tree,a.tree)||o.push({setDependency:"immediateValue",desiredValue:s,treatAsInitialChange:!0})}else if(e.rawRendererValue instanceof me$3.class){o.push({setEssentialValue:"lastValueForDisplay",value:e.rawRendererValue});let t=await i(n.rawRendererValue);if(!deepCompare(e.rawRendererValue.tree,t.tree)){let t=stripLatex(e.rawRendererValue.toLatex());(""===t||r.hideNaN&&"NaN"===t)&&(t=""),o.push({setEssentialValue:"rawRendererValue",value:t})}}else e.lastValueForDisplay instanceof me$3.class&&o.push({setEssentialValue:"lastValueForDisplay",value:e.lastValueForDisplay});return{success:!0,instructions:o}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"math"}})},e}async updateRawValue({rawRendererValue:e,actionId:t}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",value:e}],transient:!0,actionId:t});this.coreFunctions.resolveAction({actionId:t})}async updateValue({actionId:e}){if(await this.stateValues.disabled)this.coreFunctions.resolveAction({actionId:e});else{let t=await this.stateValues.immediateValue;if(!deepCompare((await this.stateValues.value).tree,t.tree)){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}];""!==t.tree?n.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"rawRendererValue",valueOfStateVariable:"valueForDisplay"}):n.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"lastValueForDisplay",valueOfStateVariable:"valueForDisplay"});let r={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}},a=await this.stateValues.answerAncestor;return a&&(r.context={answerAncestor:a.componentName}),await this.coreFunctions.performUpdate({updateInstructions:n,actionId:e,event:r}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}this.coreFunctions.resolveAction({actionId:e})}}}class Textinput extends Input{constructor(e){super(e),this.actions={updateImmediateValue:this.updateImmediateValue.bind(this),updateValue:this.updateValue.bind(this)},this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let e=await this.stateValues.answerAncestor;return null!==e?{componentName:e.componentName,actionName:"submitAnswer"}:void 0}.bind(this)})}static componentType="textInput";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e.size={createComponentOfType:"number",createStateVariable:"size",defaultValue:10,forRenderer:!0,public:!0},e.bindValueTo={createComponentOfType:"text"},e.expanded={createComponentOfType:"boolean",createStateVariable:"expanded",defaultValue:!1,forRenderer:!0,public:!0},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:600,isAbsolute:!0},forRenderer:!0,public:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:120,isAbsolute:!0},forRenderer:!0,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{setValue:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:e.value}]}}},e.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:t,justUpdatedForNewComponent:n}){return t.value&&!n?{setValue:{immediateValue:e.value},setEssentialValue:{immediateValue:e.value}}:{useEssentialOrDefaultValue:{immediateValue:{defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:t,shadowedVariable:n}){let r=[{setEssentialValue:"immediateValue",value:e.immediateValue}];return t||n||r.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:r}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.value}}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"text"}})},e}async updateImmediateValue({text:e,actionId:t}){if(!await this.stateValues.disabled)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:e}],transient:!0,actionId:t});this.coreFunctions.resolveAction({actionId:t})}async updateValue({actionId:e}){if(!await this.stateValues.disabled){let t=await this.stateValues.immediateValue;if(await this.stateValues.value!==t){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],r={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t}},a=await this.stateValues.answerAncestor;return a&&(r.context={answerAncestor:a.componentName}),await this.coreFunctions.performUpdate({updateInstructions:n,actionId:e,event:r}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}}this.coreFunctions.resolveAction({actionId:e})}}class BooleanInput extends Input{constructor(e){super(e),this.actions={updateBoolean:this.updateBoolean.bind(this)},this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let e=await this.stateValues.answerAncestor;return null!==e?{componentName:e.componentName,actionName:"submitAnswer"}:void 0}.bind(this)})}static componentType="booleanInput";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.prefill={createComponentOfType:"boolean",createStateVariable:"prefill",defaultValue:!1,public:!0},e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"",forRenderer:!0,public:!0},e.asToggleButton={createComponentOfType:"boolean",createStateVariable:"asToggleButton",defaultValue:!1,forRenderer:!0,public:!0},e.bindValueTo={createComponentOfType:"boolean"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{setValue:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:e.value}]}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.value?"true":"false"}}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"boolean"}})},e}async updateBoolean({boolean:e,actionId:t}){if(!await this.stateValues.disabled){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:e}],r={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:e,responseText:e.toString()}},a=await this.stateValues.answerAncestor;return a&&(r.context={answerAncestor:a.componentName}),await this.coreFunctions.performUpdate({updateInstructions:n,event:r,actionId:t}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}this.coreFunctions.resolveAction({actionId:t})}}class Choiceinput extends Input{constructor(e){super(e),this.actions={updateSelectedIndices:this.updateSelectedIndices.bind(this)},this.externalActions={},Object.defineProperty(this.externalActions,"submitAnswer",{enumerable:!0,get:async function(){let e=await this.stateValues.answerAncestor;return null!==e?{componentName:e.componentName,actionName:"submitAnswer"}:void 0}.bind(this)})}static componentType="choiceInput";static renderChildren=!0;static variableForPlainMacro="values";static createsVariants=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.selectMultiple={createComponentOfType:"boolean",createStateVariable:"selectMultiple",defaultValue:!1,public:!0,forRenderer:!0},e.matchPartial={createComponentOfType:"boolean",createStateVariable:"matchPartial",defaultValue:!1,public:!0,fallBackToParentStateVariable:"matchPartial"},e.inline={createComponentOfType:"boolean"},e.shuffleOrder={createPrimitiveOfType:"boolean",createStateVariable:"shuffleOrder",defaultValue:!1,public:!0},e.preselectChoice={createComponentOfType:"number",createStateVariable:"preselectChoice",defaultValue:null},e.bindValueTo={createComponentOfType:"text"},e.placeHolder={createComponentOfType:"text",createStateVariable:"placeHolder",defaultValue:"",forRenderer:!0},e.submitLabel={createComponentOfType:"text",createStateVariable:"submitLabel",defaultValue:"Check Work",public:!0,forRenderer:!0,fallBackToParentStateVariable:"submitLabel"},e.submitLabelNoCorrectness={createComponentOfType:"text",createStateVariable:"submitLabelNoCorrectness",defaultValue:"Submit Response",public:!0,forRenderer:!0,fallBackToParentStateVariable:"submitLabelNoCorrectness"},e}static returnChildGroups(){return[{group:"choices",componentTypes:["choice"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.inline={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({inlineAttr:{dependencyType:"attributeComponent",attributeName:"inline",variableNames:["value"]},parentInline:{dependencyType:"parentStateVariable",variableName:"inline"}}),definition:({dependencyValues:e})=>e.inlineAttr?{setValue:{inline:e.inlineAttr.stateValues.value}}:null!==e.parentInline?{setValue:{inline:e.parentInline}}:{useEssentialOrDefaultValue:{inline:{}}}},e.numberChoices={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({choiceChildren:{dependencyType:"child",childGroups:["choices"]}}),definition:({dependencyValues:e})=>({setValue:{numberChoices:e.choiceChildren.length}})},e.choiceOrder={forRenderer:!0,shadowVariable:!0,returnDependencies:({sharedParameters:e})=>({choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},shuffleOrder:{dependencyType:"stateVariable",variableName:"shuffleOrder"},variantRng:{dependencyType:"value",value:e.variantRng,doNotProxy:!0},variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){let t,n=e.choiceChildren.length;if(e.shuffleOrder){let r=e.variants?.desiredVariant?.indices;if(void 0!==r)if(r.length!==n)console.warn("Ignoring indices specified for choiceInput as number of indices doesn't match number of choice children.");else{if(r=r.map(Number),!r.every(Number.isInteger))throw Error("All indices specified for choiceInput must be integers");if(r.every((e=>e>=1&&e<=n)))return{setValue:{choiceOrder:r}};console.warn("Ignoring indices specified for choiceInput as some indices out of range.")}t=[...Array(n).keys()].map((e=>e+1));for(let r=n-1;r>0;r--){const n=e.variantRng(),a=Math.floor(n*(r+1));[t[r],t[a]]=[t[a],t[r]]}}else t=[...Array(n).keys()].map((e=>e+1));return{setValue:{choiceOrder:t}}}},e.generatedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:e,sharedParameters:t})=>({variantSeed:{dependencyType:"value",value:t.variantSeed},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},shuffleOrder:{dependencyType:"stateVariable",variableName:"shuffleOrder"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={seed:e.variantSeed,meta:{createdBy:t}};e.shuffleOrder&&(n.indices=e.choiceOrder);let r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n,isVariantComponent:!0}}}},e.choiceChildrenOrdered={additionalStateVariablesDefined:[{variableName:"numberChoices",public:!0,shadowingInstructions:{createComponentOfType:"number"}}],returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"]}}),definition:function({dependencyValues:e}){let t=e.choiceChildren.length,n=e.choiceOrder.map((t=>e.choiceChildren[t-1]));return{setValue:{choiceChildrenOrdered:n,numberChoices:t}}}},e.choiceTexts={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["choiceText"],forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize:({dependencyValues:e})=>[e.numberChoices],returnArrayDependenciesByKey:()=>({globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1]));return{setValue:{choiceTexts:t.map((e=>e.stateValues.text))}}}},e.choicePreselects={isArray:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize:({dependencyValues:e})=>[e.numberChoices],returnArrayDependenciesByKey:()=>({globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["preSelect"]}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1]));return{setValue:{choicePreselects:t.map((e=>e.stateValues.preSelect))}}}},e.choicesDisabled={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize:({dependencyValues:e})=>[e.numberChoices],returnArrayDependenciesByKey:()=>({globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["disabled"]}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1]));return{setValue:{choicesDisabled:t.map((e=>e.stateValues.disabled))}}}},e.choicesHidden={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize:({dependencyValues:e})=>[e.numberChoices],returnArrayDependenciesByKey:()=>({globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["hidden"]}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1]));return{setValue:{choicesHidden:t.map((e=>e.stateValues.hidden))}}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"text"}})},e.indicesMatchedByBoundValue={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"}}),definition({dependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1]));if(null!==e.bindValueTo){let n=t.map((e=>e.stateValues.text.toLowerCase().trim()));if(e.bindValueTo.stateValues.value){if(e.selectMultiple){let t=e.bindValueTo.stateValues.value.toLowerCase().split(",").map((e=>e.trim())),r=[];for(let e of t){let t=n.indexOf(e);-1===t||r.includes(t+1)||r.push(t+1)}return r.sort(((e,t)=>e-t)),{setValue:{indicesMatchedByBoundValue:r}}}{let t=n.indexOf(e.bindValueTo.stateValues.value.toLowerCase().trim());if(-1!==t)return{setValue:{indicesMatchedByBoundValue:[t+1]}}}}}return{setValue:{indicesMatchedByBoundValue:[]}}}},e.allSelectedIndices={hasEssential:!0,returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["text"]},indicesMatchedByBoundValue:{dependencyType:"stateVariable",variableName:"indicesMatchedByBoundValue"},preselectChoice:{dependencyType:"stateVariable",variableName:"preselectChoice"},choicePreselects:{dependencyType:"stateVariable",variableName:"choicePreselects"},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}),definition:({dependencyValues:e})=>null!==e.bindValueTo?{setValue:{allSelectedIndices:e.indicesMatchedByBoundValue}}:{useEssentialOrDefaultValue:{allSelectedIndices:{get defaultValue(){let t=e.choicePreselects.indexOf(!0);return-1!==t?[t+1]:null!==e.preselectChoice?[e.preselectChoice]:[]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){if(null===t.bindValueTo)return{success:!0,instructions:[{setEssentialValue:"allSelectedIndices",value:e.allSelectedIndices}]};{let n="";if(e.allSelectedIndices.length>0){let r=t.choiceOrder.map((e=>t.choiceChildren[e-1])),a=[];for(let t of e.allSelectedIndices){let e=r[t-1];e&&a.push(e.stateValues.text)}n=a.join(", ")}return{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:n,variableIndex:0}]}}}},e.nSelectedIndices={returnDependencies:()=>({allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}),definition:({dependencyValues:e})=>({setValue:{nSelectedIndices:e.allSelectedIndices.length}})},e.selectedIndices={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["selectedIndex"],forRenderer:!0,returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize:({dependencyValues:e})=>[e.nSelectedIndices],returnArrayDependenciesByKey:()=>({globalDependencies:{allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n in e.allSelectedIndices)t[n]=e.allSelectedIndices[n];return{setValue:{selectedIndices:t}}}},e.selectedIndex={isAlias:!0,targetVariableName:"selectedIndex1"},e.selectedValues={public:!0,shadowingInstructions:{createComponentOfType:"text"},isArray:!0,entryPrefixes:["selectedValue"],returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize:({dependencyValues:e})=>[e.nSelectedIndices],returnArrayDependenciesByKey:()=>({globalDependencies:{selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceTexts:{dependencyType:"stateVariable",variableName:"choiceTexts"}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e.choiceTexts[e.selectedIndices[r]-1];return{setValue:{selectedValues:n}}}},e.selectedValue={isAlias:!0,targetVariableName:"selectedValue1"},e.values={isAlias:!0,targetVariableName:"selectedValues"},e.nValues={isAlias:!0,targetVariableName:"nSelectedIndices"},e.childIndicesSelected={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"}}),definition({dependencyValues:e}){let t=e.selectedIndices.map((t=>e.choiceOrder[t-1]));return{setValue:{childIndicesSelected:t}}}},e.creditAchievedIfSubmit={returnDependencies:()=>({choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["selected","credit"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"}}),definition:function({dependencyValues:e}){let t=0;if(e.selectMultiple){let n=0,r=0,a=0;for(let t of e.choiceChildren)t.stateValues.selected?1===t.stateValues.credit?n++:r++:1===t.stateValues.credit&&a++;if(e.matchPartial){let e=n+r+a;t=0===e?1:n/e}else r+a===0&&(t=1)}else for(let n of e.choiceChildren)if(n.stateValues.selected){t=n.stateValues.credit;break}return{setValue:{creditAchievedIfSubmit:t}}}},e.valueToRecordOnSubmit={isAlias:!0,targetVariableName:"selectedIndices"},e.submittedIndices={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["submitted"]}}),definition({dependencyValues:e}){let t=[],n=e.choiceOrder.map((t=>e.choiceChildren[t-1]));for(let[e,r]of n.entries())r.stateValues.submitted&&t.push(e+1);return{setValue:{submittedIndices:t}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){let n=[];for(let[r,a]of t.choiceOrder.entries())n.push({setDependency:"choiceChildren",desiredValue:e.submittedIndices.includes(r+1),variableIndex:0,childIndex:a-1});return{success:!0,instructions:n}}},e.valueRecordedAtSubmit={isAlias:!0,targetVariableName:"submittedIndices"},e.allFeedbacks={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childGroups:["choices"],variableNames:["feedbacks"]}}),definition({dependencyValues:e}){let t=e.choiceOrder.map((t=>e.choiceChildren[t-1])),n=[];for(let e of t)n.push(...e.stateValues.feedbacks);return{setValue:{allFeedbacks:n}}}},e.numberFeedbacks={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}),definition:({dependencyValues:e})=>({setValue:{numberFeedbacks:e.allFeedbacks.length},checkForActualChange:{numberFeedbacks:!0}})},e.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedback"},isArray:!0,entryPrefixes:["feedback"],returnArraySizeDependencies:()=>({numberFeedbacks:{dependencyType:"stateVariable",variableName:"numberFeedbacks"}}),returnArraySize:({dependencyValues:e})=>[e.numberFeedbacks],returnArrayDependenciesByKey:()=>({globalDependencies:{allFeedbacks:{dependencyType:"stateVariable",variableName:"allFeedbacks"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size;n++)t[n]=e.allFeedbacks[n];return{setValue:{feedbacks:t}}}},e}async updateSelectedIndices({selectedIndices:e,actionId:t}){if(!await this.stateValues.disabled){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"allSelectedIndices",value:e}],r=await this.stateValues.choiceTexts,a={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:e,responseText:e.map((e=>r[e-1]))}},i=await this.stateValues.answerAncestor;return i&&(a.context={answerAncestor:i.componentName}),await this.coreFunctions.performUpdate({updateInstructions:n,actionId:t,event:a}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}this.coreFunctions.resolveAction({actionId:t})}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){if(!e.attributes.shuffleOrder?.primitive)return super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});let n=0;for(let r of e.children)if("choice"===r.componentType)n++;else{if(!t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"composite"})||"choice"!==r.attributes.createComponentOfType?.primitive)return{success:!1};if(void 0!==r.attributes.nComponents?.primitive){let e=Number(r.attributes.nComponents?.primitive);if(!(Number.isInteger(e)&&e>=0))return{success:!1};n+=e}else n++}let r=1;for(let e=2;e<=n;e++)r*=e;let a=super.determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}).numberOfVariants*r;return e.variants.numberOfVariants=a,e.variants.uniqueVariantData={numberOfVariantsByDescendant:e.variants.uniqueVariantData.numberOfVariantsByDescendant,numberOfPermutations:r,numberOfChoices:n},{success:!0,numberOfVariants:a}}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r=e.variants?.numberOfVariants;if(void 0===r)return{success:!1};if(!Number.isInteger(t)||t<1||t>r)return{success:!1};if(!e.attributes.shuffleOrder?.primitive)return super.getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n});let a=e.variants.uniqueVariantData.numberOfVariantsByDescendant,i=e.variants.descendantVariantComponents,o=e.variants.uniqueVariantData.numberOfPermutations,s=e.variants.uniqueVariantData.numberOfChoices,l=[...a];l.push(o);let u=enumerateCombinations({numberOfOptionsByIndex:l,maxNumber:t})[t-1].map((e=>e+1)),c=u.pop(),p=u,d=[...Array(s).keys()].map((e=>e+1)),m=enumeratePermutations({values:d,maxNumber:c})[c-1],f=!1,h=[];for(let e=0;e<a.length;e++)if(a[e]>1){let t=i[e],r=n.allComponentClasses[t.componentType].getUniqueVariant({serializedComponent:t,variantIndex:p[e],componentInfoObjects:n});if(!r.success)return{success:!1};h.push(r.desiredVariant),f=!0}else h.push({});let y={indices:m};return f&&(y.subvariants=h),{success:!0,desiredVariant:y}}}class Choice extends InlineComponent{static componentType="choice";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.credit={createComponentOfType:"number",createStateVariable:"credit",defaultValue:0,public:!0,attributesForCreatedComponent:{convertBoolean:!0}},e.feedbackCodes={createComponentOfType:"textList",createStateVariable:"feedbackCodes",defaultValue:[],public:!0},e.feedbackText={createComponentOfType:"text",createStateVariable:"feedbackText",defaultValue:null,public:!0},e.preSelect={createComponentOfType:"boolean",createStateVariable:"preSelect",defaultValue:!1},e}static returnChildGroups(){return[{group:"children",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["children"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text&&(t+=n.stateValues.text);return{setValue:{text:t}}}},e.selected={defaultValue:!1,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},childIndicesSelected:{dependencyType:"parentStateVariable",variableName:"childIndicesSelected"}}),definition({dependencyValues:e}){let t;return t=!!e.childIndicesSelected&&e.childIndicesSelected.includes(e.countAmongSiblings),{setValue:{selected:t}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"selected",value:e.selected}]}}},e.submitted={defaultValue:!1,hasEssential:!0,public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submitted:!0}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setEssentialValue:"submitted",value:e.submitted}]}}},e.feedbacks={public:!0,shadowingInstructions:{createComponentOfType:"feedbacktext"},returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitionAncestor:{dependencyType:"ancestor",variableNames:["feedbackDefinitions"]},submitted:{dependencyType:"stateVariable",variableName:"submitted"}}),definition({dependencyValues:e}){if(!e.submitted)return{setValue:{feedbacks:[]}};let t=[],n=e.feedbackDefinitionAncestor.stateValues.feedbackDefinitions;for(let r of e.feedbackCodes){let e=n[r.toLowerCase()];e&&t.push(e)}return null!==e.feedbackText&&t.push(e.feedbackText),{setValue:{feedbacks:t}}}},e}static includeBlankStringChildren=!0;static adapters=["submitted"]}class NumberComponent extends InlineComponent{static componentType="number";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.displayDigits={createComponentOfType:"integer"},e.displayDecimals={createComponentOfType:"integer"},e.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},e.padZeros={createComponentOfType:"boolean"},e.renderAsMath={createComponentOfType:"boolean",createStateVariable:"renderAsMath",defaultValue:!1,public:!0,forRenderer:!0},e.convertBoolean={createPrimitiveOfType:"boolean",createStateVariable:"convertBoolean",defaultValue:!1},e.valueOnNaN={createPrimitiveOfType:"number",createStateVariable:"valueOnNaN",defaultValue:NaN},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({childrenRegex:/..+/,replacementFunction:({matchedChildren:e,componentAttributes:t})=>({success:!t.convertBoolean,newChildren:[{componentType:"math",children:e}]})}),e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"numbers",componentTypes:["number"]},{group:"maths",componentTypes:["math"]},{group:"texts",componentTypes:["text"]},{group:"booleans",componentTypes:["boolean"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displayDigits"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.numberListParentDisplayDigits){if(!t.numberListParentDisplayDigits)return{setValue:{displayDigits:e.numberListParentDisplayDigits}};r=!0,n=e.numberListParentDisplayDigits}if(null!==e.mathListParentDisplayDigits){if(!t.mathListParentDisplayDigits)return{setValue:{displayDigits:e.mathListParentDisplayDigits}};r=!0,n=e.mathListParentDisplayDigits}let a=null!==e.numberListParentDisplayDecimals&&!t.numberListParentDisplayDecimals||null!==e.mathListParentDisplayDecimals&&!t.mathListParentDisplayDecimals;if(!a&&null!==e.displayDigitsAttr){if(!t.displayDigitsAttr)return{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}};r=!0,n=e.displayDigitsAttr.stateValues.value}if(!a&&(null===e.displayDecimalsAttr||t.displayDecimalsAttr)&&1===e.numberMathChildren.length&&0===e.otherChildren.length){if(!t.numberMathChildren[0]||!t.numberMathChildren[0].displayDigits)return{setValue:{displayDigits:e.numberMathChildren[0].stateValues.displayDigits}};r=!0,n=e.numberMathChildren[0].stateValues.displayDigits}return r?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displayDecimals"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.numberListParentDisplayDecimals){if(!t.numberListParentDisplayDecimals)return{setValue:{displayDecimals:e.numberListParentDisplayDecimals}};r=!0,n=e.numberListParentDisplayDecimals}if(null!==e.mathListParentDisplayDecimals){if(!t.mathListParentDisplayDecimals)return{setValue:{displayDecimals:e.mathListParentDisplayDecimals}};r=!0,n=e.mathListParentDisplayDecimals}if(null!==e.displayDecimalsAttr){if(!t.displayDecimalsAttr)return{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}};r=!0,n=e.displayDecimalsAttr.stateValues.value}if(1===e.numberMathChildren.length&&0===e.otherChildren.length){if(!t.numberMathChildren[0]||!t.numberMathChildren[0].displayDecimals)return{setValue:{displayDecimals:e.numberMathChildren[0].stateValues.displayDecimals}};r=!0,n=e.numberMathChildren[0].stateValues.displayDecimals}return r?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["displaySmallAsZero"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.numberListParentDisplaySmallAsZero){if(!t.numberListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.numberListParentDisplaySmallAsZero}};r=!0,n=e.numberListParentDisplaySmallAsZero}if(null!==e.mathListParentDisplaySmallAsZero){if(!t.mathListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.mathListParentDisplaySmallAsZero}};r=!0,n=e.mathListParentDisplaySmallAsZero}if(null!==e.displaySmallAsZeroAttr){if(!t.displaySmallAsZeroAttr)return{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}};r=!0,n=e.displaySmallAsZeroAttr.stateValues.value}if(1===e.numberMathChildren.length&&0===e.otherChildren.length){if(!t.numberMathChildren[0]||!t.numberMathChildren[0].displaySmallAsZero)return{setValue:{displaySmallAsZero:e.numberMathChildren[0].stateValues.displaySmallAsZero}};r=!0,n=e.numberMathChildren[0].stateValues.displaySmallAsZero}return r?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},numberMathChildren:{dependencyType:"child",childGroups:["numbers","maths"],variableNames:["padZeros"]},otherChildren:{dependencyType:"child",childGroups:["strings","texts","booleans"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.numberListParentPadZeros){if(!t.numberListParentPadZeros)return{setValue:{padZeros:e.numberListParentPadZeros}};r=!0,n=e.numberListParentPadZeros}if(null!==e.mathListParentPadZeros){if(!t.mathListParentPadZeros)return{setValue:{padZeros:e.mathListParentPadZeros}};r=!0,n=e.mathListParentPadZeros}if(null!==e.padZerosAttr){if(!t.padZerosAttr)return{setValue:{padZeros:e.padZerosAttr.stateValues.value}};r=!0,n=e.padZerosAttr.stateValues.value}if(1===e.numberMathChildren.length&&0==e.otherChildren.length){if(!t.numberMathChildren[0]||!t.numberMathChildren[0].padZeros)return{setValue:{padZeros:e.numberMathChildren[0].stateValues.padZeros}};r=!0,n=e.numberMathChildren[0].stateValues.padZeros}return r?{useEssentialOrDefaultValue:{padZeros:{defaultValue:n}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},e.singleNumberOrStringChild={additionalStateVariablesDefined:["singleMathChild"],returnDependencies:()=>({numberChildren:{dependencyType:"child",childGroups:["numbers"]},stringChildren:{dependencyType:"child",childGroups:["strings"]},mathChildren:{dependencyType:"child",childGroups:["maths"]},booleanChildren:{dependencyType:"child",childGroups:["booleans"]},textChildren:{dependencyType:"child",childGroups:["texts"]}}),definition({dependencyValues:e}){let t=e.numberChildren.length+e.stringChildren.length,n=e.mathChildren.length,r=e.booleanChildren.length+e.textChildren.length;return{setValue:{singleNumberOrStringChild:t<=1&&n+r===0,singleMathChild:1===n&&t+r===0}}}},e.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"]},stringChildren:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]}}),definition:buildParsedExpression},e.mathChildrenByCode={additionalStateVariablesDefined:["textChildrenByCode","numberChildrenByCode","booleanChildrenByCode"],returnDependencies:()=>({allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"],variableNames:["value","texts","maths","booleans"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:e,componentInfoObjects:t}){let n={},r={},a={},i={},o=0,s=e.codePre;for(let l of e.allChildren)if("string"!=typeof l){let e=s+o;t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"math"})?n[e]=l:t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"number"})?r[e]=l:t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"text"})?a[e]=l:i[e]=l,o+=1}return{setValue:{mathChildrenByCode:n,numberChildrenByCode:r,textChildrenByCode:a,booleanChildrenByCode:i}}}},e.value={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],addAttributeComponentsShadowingStateVariables:{fixed:{stateVariableToShadow:"fixed"}}},hasEssential:!0,stateVariablesDeterminingDependencies:["singleNumberOrStringChild"],returnDependencies:({stateValues:e})=>e.singleNumberOrStringChild?{singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},convertBoolean:{dependencyType:"stateVariable",variableName:"convertBoolean"},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},valueOnNaN:{dependencyType:"stateVariable",variableName:"valueOnNaN"}}:{singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},singleMathChild:{dependencyType:"stateVariable",variableName:"singleMathChild"},convertBoolean:{dependencyType:"stateVariable",variableName:"convertBoolean"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},allChildren:{dependencyType:"child",childGroups:["strings","numbers","maths","texts","booleans"],variableNames:["value","texts","maths","unordered"],variablesOptional:!0},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},numberChildrenByCode:{dependencyType:"stateVariable",variableName:"numberChildrenByCode"},valueOnNaN:{dependencyType:"stateVariable",variableName:"valueOnNaN"}},definition({dependencyValues:e,componentInfoObjects:t}){if(e.singleNumberOrStringChild){if(0===e.numberChild.length){if(0===e.stringChild.length)return{useEssentialOrDefaultValue:{value:{defaultValue:e.valueOnNaN}}};let n=Number(e.stringChild[0]);if(Number.isNaN(n))try{if(n=me$3.fromAst(textToAst$1.convert(e.stringChild[0])).evaluate_to_constant(),"boolean"==typeof n)n=e.convertBoolean?n?1:0:e.valueOnNaN;else if(null===n||Number.isNaN(n))if(e.convertBoolean){n=evaluateLogic({logicTree:buildParsedExpression({dependencyValues:{stringChildren:e.stringChild,allChildren:e.stringChild},componentInfoObjects:t}).setValue.parsedExpression.tree,dependencyValues:{booleanChildrenByCode:{},booleanListChildrenByCode:{},textChildrenByCode:{},textListChildrenByCode:{},mathChildrenByCode:{},mathListChildrenByCode:{},numberChildrenByCode:{},numberListChildrenByCode:{},otherChildrenByCode:{}},valueOnInvalid:e.valueOnNaN})}else n=e.valueOnNaN}catch(t){n=e.valueOnNaN}return{setValue:{value:n}}}{let t=e.numberChild[0].stateValues.value;return Number.isNaN(t)&&(t=e.valueOnNaN),{setValue:{value:t}}}}if(null===e.parsedExpression)return{setValue:{value:e.valueOnNaN}};if(0===Object.keys(e.textChildrenByCode).length&&0===Object.keys(e.booleanChildrenByCode).length){let t,n=function(t){if("string"==typeof t){let n=e.mathChildrenByCode[t];return void 0!==n?n.stateValues.value.tree:(n=e.numberChildrenByCode[t],void 0!==n?n.stateValues.value:t)}return Array.isArray(t)?[t[0],...t.slice(1).map(n)]:t};try{t=me$3.fromAst(n(e.parsedExpression.tree)).evaluate_to_constant()}catch(n){t=e.valueOnNaN}if(Number.isFinite(t)||t===1/0||t===-1/0)return{setValue:{value:t}}}if(!e.convertBoolean)return{setValue:{value:e.valueOnNaN}};return(e=Object.assign({},e)).mathListChildrenByCode={},e.numberListChildrenByCode={},e.textListChildrenByCode={},e.booleanListChildrenByCode={},e.otherChildrenByCode={},{setValue:{value:evaluateLogic({logicTree:e.parsedExpression.tree,dependencyValues:e,valueOnInvalid:e.valueOnNaN})}}},set:function(e){if(null===e)return NaN;let t=Number(e);if(Number.isNaN(t))try{t=me$3.fromAst(textToAst$1.convert(e)).evaluate_to_constant(),null===t&&(t=NaN)}catch(e){t=NaN}return t},inverseDefinition:async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,overrideFixed:r}){if(!await n.canBeModified&&!r)return{success:!1};let a,i=e.value;return i instanceof me$3.class?(i=i.evaluate_to_constant(),Number.isFinite(i)||(i=t.valueOnNaN)):(i=Number(i),Number.isNaN(i)&&(i=t.valueOnNaN)),t.singleNumberOrStringChild?(a=0===t.numberChild.length?0===t.stringChild.length?[{setEssentialValue:"value",value:i}]:[{setDependency:"stringChild",desiredValue:i.toString(),childIndex:0,variableIndex:0}]:[{setDependency:"numberChild",desiredValue:i,childIndex:0,variableIndex:0}],{success:!0,instructions:a}):t.singleMathChild?{success:!0,instructions:[{setDependency:"allChildren",desiredValue:me$3.fromAst(i),childIndex:0,variableIndex:0}]}:{success:!1}}},e.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"}}),definition:function({dependencyValues:e,usedDefault:t}){let n=roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t});return n instanceof me$3.class&&(n=n.tree),{setValue:{valueForDisplay:n}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,usedDefault:t}){let n={};return e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits)),{setValue:{text:me$3.fromAst(e.valueForDisplay).toString(n)}}},async inverseDefinition({desiredStateVariableValues:e,stateValues:t}){let n=Number(e.text);if(Number.isFinite(n))return{success:!0,instructions:[{setDependency:"value",desiredValue:n}]};{let r,a=getFromText({functionSymbols:await t.functionSymbols,splitSymbols:await t.splitSymbols});try{r=a(e.text)}catch(e){return{success:!1}}return n=r.evaluate_to_constant(),Number.isFinite(n)?{success:!0,instructions:[{setDependency:"value",desiredValue:n}]}:{success:!1}}}},e.math=mathStateVariableFromNumberStateVariable({numberVariableName:"value",mathVariableName:"math",isPublic:!0}),e.math.shadowingInstructions.attributeComponentsToShadow=["displayDigits","displayDecimals","displaySmallAsZero","padZeros"],e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"},padZeros:{dependencyType:"stateVariable",variableName:"padZeros"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"}}),definition({dependencyValues:e,usedDefault:t}){let n={};return e.padZeros&&(t.displayDigits&&!t.displayDecimals?Number.isFinite(e.displayDecimals)&&(n.padToDecimals=e.displayDecimals):e.displayDigits>=1&&(n.padToDigits=e.displayDigits)),{setValue:{latex:me$3.fromAst(e.valueForDisplay).toLatex(n)}}}},e.canBeModified={returnDependencies:()=>({numberChildModifiable:{dependencyType:"child",childGroups:["numbers"],variableNames:["canBeModified"]},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},singleNumberOrStringChild:{dependencyType:"stateVariable",variableName:"singleNumberOrStringChild"},singleMathChild:{dependencyType:"stateVariable",variableName:"singleMathChild"}}),definition:function({dependencyValues:e}){return!e.modifyIndirectly||e.fixed||!e.singleNumberOrStringChild&&!e.singleMathChild?{setValue:{canBeModified:!1}}:1!==e.numberChildModifiable.length||e.numberChildModifiable[0].stateValues.canBeModified?{setValue:{canBeModified:!0}}:{setValue:{canBeModified:!1}}}},e}static adapters=[{stateVariable:"math",stateVariablesToShadow:["displayDigits","displayDecimals","displaySmallAsZero","padZeros"]},"text"]}class Integer extends NumberComponent{static componentType="integer";static rendererType="number";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:e,oldName:"value",newName:"valuePreRound"}),e.value={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({valuePreRound:{dependencyType:"stateVariable",variableName:"valuePreRound"}}),set:function(e){if(null===e)return NaN;let t=Number(e);if(Number.isNaN(t))try{t=me$3.fromAst(textToAst.convert(e)).evaluate_to_constant(),null===t&&(t=NaN)}catch(e){t=NaN}return Math.round(t)},definition:({dependencyValues:e})=>({setValue:{value:Math.round(e.valuePreRound)}}),inverseDefinition({desiredStateVariableValues:e}){let t=e.value;return t instanceof me$3.class?(t=t.evaluate_to_constant(),Number.isFinite(t)||(t=NaN)):t=Number(t),t=Math.round(t),{success:!0,instructions:[{setDependency:"valuePreRound",desiredValue:t}]}}},e}}class Graph$1 extends BlockComponent{static componentType="graph";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.xmin={createComponentOfType:"number",createStateVariable:"xminPrelim",defaultValue:-10},e.xmax={createComponentOfType:"number",createStateVariable:"xmaxPrelim",defaultValue:10},e.ymin={createComponentOfType:"number",createStateVariable:"yminPrelim",defaultValue:-10},e.ymax={createComponentOfType:"number",createStateVariable:"ymaxPrelim",defaultValue:10},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},e.aspectRatio={createComponentOfType:"number"},e.height={createComponentOfType:"_componentSize"},e.identicalAxisScales={createPrimitiveOfType:"boolean",createStateVariable:"identicalAxisScales",defaultValue:!1,public:!0},e.displayXAxis={createComponentOfType:"boolean",createStateVariable:"displayXAxis",defaultValue:!0,public:!0,forRenderer:!0},e.displayYAxis={createComponentOfType:"boolean",createStateVariable:"displayYAxis",defaultValue:!0,public:!0,forRenderer:!0},e.displayXAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayXAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},e.displayYAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayYAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},e.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},e.xlabelPosition={createComponentOfType:"text",createStateVariable:"xlabelPosition",defaultValue:"right",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["right","left"]},e.xTickScaleFactor={createComponentOfType:"math",createStateVariable:"xTickScaleFactor",defaultValue:null,public:!0,forRenderer:!0},e.ylabel={createComponentOfType:"text",createStateVariable:"ylabel",defaultValue:"",public:!0,forRenderer:!0},e.ylabelPosition={createComponentOfType:"text",createStateVariable:"ylabelPosition",defaultValue:"top",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["top","bottom"]},e.ylabelAlignment={createComponentOfType:"text",createStateVariable:"ylabelAlignment",defaultValue:"left",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["left","right"]},e.yTickScaleFactor={createComponentOfType:"math",createStateVariable:"yTickScaleFactor",defaultValue:null,public:!0,forRenderer:!0},e.showNavigation={createComponentOfType:"boolean",createStateVariable:"showNavigation",defaultValue:!0,public:!0,forRenderer:!0},e.fixAxes={createComponentOfType:"boolean",createStateVariable:"fixAxes",defaultValue:!1,public:!0,forRenderer:!0},e.grid={createComponentOfType:"text",createStateVariable:"grid",defaultValue:"none",public:!0,forRenderer:!0,toLowerCase:!0,valueTransformations:{true:"medium",false:"none"},validValues:["none","medium","dense"]},e}static returnChildGroups(){return[{group:"graphical",componentTypes:["_graphical"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.graphicalDescendants={forRenderer:!0,returnDependencies:()=>({graphicalDescendants:{dependencyType:"descendant",componentTypes:["_graphical"],variableNames:["selectedStyle","styleNumber"]}}),definition:function({dependencyValues:e}){return{setValue:{graphicalDescendants:e.graphicalDescendants}}}},e.nChildrenAdded={defaultValue:0,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{nChildrenAdded:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"nChildrenAdded",value:e.nChildrenAdded}]})},e.aspectRatioFromAxisScales={returnDependencies:()=>({aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]},identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]}}),definition:({dependencyValues:e})=>(null!==e.heightAttr&&console.warn("Height attribute of graph is deprecated and is being ignored.  Use aspectRatio attribute instead."),{setValue:{aspectRatioFromAxisScales:e.identicalAxisScales&&null===e.aspectRatioAttr},checkForActualChange:{aspectRatioFromAxisScales:!0}})},e.aspectRatio={public:!0,forRenderer:!0,defaultValue:1,hasEssential:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["aspectRatioFromAxisScales"],returnDependencies:({stateValues:e})=>e.aspectRatioFromAxisScales?{aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"}}:{aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]},width:{dependencyType:"stateVariable",variableName:"width"}},definition({dependencyValues:e}){if(e.aspectRatioFromAxisScales){return{setValue:{aspectRatio:e.xscale/e.yscale}}}if(null!==e.aspectRatioAttr){let t=e.aspectRatioAttr.stateValues.value;return Number.isFinite(t)||(t=1),{setValue:{aspectRatio:t}}}return{useEssentialOrDefaultValue:{aspectRatio:!0}}}},e.xmin={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xminPrelim:{dependencyType:"stateVariable",variableName:"xminPrelim"}};return e.identicalAxisScales&&!e.aspectRatioFromAxisScales&&(t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales||e.aspectRatioFromAxisScales)return{setValue:{xmin:e.xminPrelim}};if(!t.xminPrelim)return{setValue:{xmin:e.xminPrelim}};let n=!t.xmaxPrelim,r=!t.yminPrelim,a=!t.ymaxPrelim;if(r&&a){let t=e.aspectRatio,r=(e.ymaxPrelim-e.yminPrelim)*t;return n?{setValue:{xmin:e.xmaxPrelim-r}}:{setValue:{xmin:-r/2}}}return n?{setValue:{xmin:e.xmaxPrelim-20}}:{setValue:{xmin:-10}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xminPrelim",desiredValue:e.xmin}]}},e.xmax={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},xmaxPrelim:{dependencyType:"stateVariable",variableName:"xmaxPrelim"}};return e.identicalAxisScales&&!e.aspectRatioFromAxisScales&&(t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales||e.aspectRatioFromAxisScales)return{setValue:{xmax:e.xmaxPrelim}};let n=!t.xminPrelim,r=!t.xmaxPrelim,a=!t.yminPrelim,i=!t.ymaxPrelim,o=a&&i,s=n&&r,l=e.xminPrelim;if(o){let t=e.aspectRatio,a=(e.ymaxPrelim-e.yminPrelim)*t;if(s){let t=e.xmaxPrelim-l;return{setValue:{xmax:l+Math.max(t,a)}}}return n?{setValue:{xmax:l+a}}:r?{setValue:{xmax:e.xmaxPrelim}}:{setValue:{xmax:a/2}}}return r?{setValue:{xmax:e.xmaxPrelim}}:n?{setValue:{xmax:l+20}}:{setValue:{xmax:10}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xmaxPrelim",desiredValue:e.xmax}]}},e.ymin={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},yminPrelim:{dependencyType:"stateVariable",variableName:"yminPrelim"}};return e.identicalAxisScales&&!e.aspectRatioFromAxisScales&&(t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales||e.aspectRatioFromAxisScales)return{setValue:{ymin:e.yminPrelim}};if(!t.yminPrelim)return{setValue:{ymin:e.yminPrelim}};let n=!t.ymaxPrelim,r=!t.xminPrelim,a=!t.xmaxPrelim,i=r&&a,o=e.aspectRatio;if(i){let t=(e.xmaxPrelim-e.xminPrelim)/o;return n?{setValue:{ymin:e.ymaxPrelim-t}}:{setValue:{ymin:-t/2}}}return n?{setValue:{ymin:e.ymaxPrelim-20/o}}:{setValue:{ymin:-10/o}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"yminPrelim",desiredValue:e.ymin}]}},e.ymax={stateVariablesDeterminingDependencies:["identicalAxisScales","aspectRatioFromAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},aspectRatioFromAxisScales:{dependencyType:"stateVariable",variableName:"aspectRatioFromAxisScales"},ymaxPrelim:{dependencyType:"stateVariable",variableName:"ymaxPrelim"}};return e.identicalAxisScales&&!e.aspectRatioFromAxisScales&&(t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.aspectRatio={dependencyType:"stateVariable",variableName:"aspectRatio"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales||e.aspectRatioFromAxisScales)return{setValue:{ymax:e.ymaxPrelim}};let n=!t.xminPrelim,r=!t.xmaxPrelim,a=!t.yminPrelim,i=!t.ymaxPrelim,o=a&&i,s=n&&r,l=e.yminPrelim,u=e.aspectRatio;if(s){let t=(e.xmaxPrelim-e.xminPrelim)/u;if(o){let n=e.ymaxPrelim-l;return{setValue:{ymax:l+Math.max(n,t)}}}return a?{setValue:{ymax:l+t}}:i?{setValue:{ymax:e.ymaxPrelim}}:{setValue:{ymax:t/2}}}return i?{setValue:{ymax:e.ymaxPrelim}}:a?{setValue:{ymax:l+20/u}}:{setValue:{ymax:10/u}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"ymaxPrelim",desiredValue:e.ymax}]}},e.xscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({xmin:{dependencyType:"stateVariable",variableName:"xmin"},xmax:{dependencyType:"stateVariable",variableName:"xmax"}}),definition:({dependencyValues:e})=>({setValue:{xscale:e.xmax-e.xmin}})},e.yscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({ymin:{dependencyType:"stateVariable",variableName:"ymin"},ymax:{dependencyType:"stateVariable",variableName:"ymax"}}),definition:({dependencyValues:e})=>({setValue:{yscale:e.ymax-e.ymin}})},e}async changeAxisLimits({xmin:e,xmax:t,ymin:n,ymax:r,actionId:a}){let i=[];return void 0!==e&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmin",value:e}),void 0!==t&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmax",value:t}),void 0!==n&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymin",value:n}),void 0!==r&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymax",value:r}),await this.coreFunctions.performUpdate({updateInstructions:i,actionId:a,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{xmin:e,xmax:t,ymin:n,ymax:r}}})}async addChildren({serializedComponents:e,actionId:t}){if(e&&e.length>0){let n=processAssignNames({serializedComponents:e,parentName:this.componentName,parentCreatesNewNamespace:this.attributes.newNamespace?.primitive,componentInfoObjects:this.componentInfoObjects,indOffset:await this.stateValues.nChildrenAdded});return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"addComponents",serializedComponents:n.serializedComponents,parentName:this.componentName,assignNamesOffset:await this.stateValues.nChildrenAdded},{updateType:"updateValue",componentName:this.componentName,stateVariable:"nChildrenAdded",value:await this.stateValues.nChildrenAdded+n.serializedComponents.length}],actionId:t})}this.coreFunctions.resolveAction({actionId:t})}async deleteChildren({number:e,actionId:t}){let n=Math.min(e,await this.stateValues.nChildrenAdded);if(n>0){let e=this.definingChildren.length,r=this.definingChildren.slice(e-n,e).map((e=>e.componentName));return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"deleteComponents",componentNames:r},{updateType:"updateValue",componentName:this.componentName,stateVariable:"nChildrenAdded",value:await this.stateValues.nChildrenAdded-n}],actionId:t})}this.coreFunctions.resolveAction({actionId:t})}actions={changeAxisLimits:this.changeAxisLimits.bind(this),addChildren:this.addChildren.bind(this),deleteChildren:this.deleteChildren.bind(this)}}class Variables extends MathList{static componentType="variables";static stateVariableForAttributeValue="variables";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();e.variables={public:!0,shadowingInstructions:{createComponentOfType:"variable"},isArray:!0,entryPrefixes:["var"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={math:{dependencyType:"stateVariable",variableName:"math"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)n[r]=e[r].math;return{setValue:{variables:n}}}};let t=this.componentType;return e.validVariables={returnDependencies:()=>({variables:{dependencyType:"stateVariable",variableName:"variables"}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.variables){let e=isValidVariable(r);e||(console.warn("Invalid value for "+t),e=!1),n.push(e)}return{setValue:{validVariables:n}}}},e}}class Variable extends MathComponent{static componentType="variable";static rendererType="math";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.validVariable={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let t=isValidVariable(e.value);return t||console.warn("Invalid value of a "+this.componentType),{setValue:{validVariable:t}}}},e}}class Group extends Template{static componentType="group";static renderedDefault=!0}class Option$1 extends Group{static componentType="option";static renderedDefault=!1;static createAttributesObject(){let e=super.createAttributesObject();return e.selectForVariantNames={createComponentOfType:"variantNames",createStateVariable:"selectForVariantNames",defaultValue:[],public:!0},e.selectWeight={createComponentOfType:"number",createStateVariable:"selectWeight",defaultValue:1,public:!0},e}}class Sequence extends CompositeComponent{static componentType="sequence";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();e.fixed={leaveRaw:!0},e.displayDigits={leaveRaw:!0},e.displayDecimals={leaveRaw:!0},e.displaySmallAsZero={leaveRaw:!0},e.padZeros={leaveRaw:!0};let t=returnStandardSequenceAttributes();return Object.assign(e,t),e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=returnStandardSequenceStateVariableDefinitions();return Object.assign(e,t),e.readyToExpandWhenResolved={returnDependencies:()=>({from:{dependencyType:"stateVariable",variableName:"from"},length:{dependencyType:"stateVariable",variableName:"length"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"},exclude:{dependencyType:"stateVariable",variableName:"exclude"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,workspace:t,componentInfoObjects:n,flags:r}){if(!await e.stateValues.validSequence)return t.lastReplacementParameters={from:null,length:null,step:null,type:null,exclude:null},{replacements:[]};let a=await e.stateValues.from,i=await e.stateValues.length,o=await e.stateValues.step,s=await e.stateValues.type,l=await e.stateValues.exclude;t.lastReplacementParameters={from:a,length:i,step:o,type:s,exclude:l};let u=e.attributes.newNamespace?.primitive,c=returnSequenceValues({from:a,step:o,length:i,exclude:l,type:s,lowercase:await e.stateValues.lowercase}),p=s;"letters"===s&&(p="text");let d=[],m={};for(let t of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])t in e.attributes&&(m[t]=e.attributes[t]);for(let e of c){let t={};Object.keys(m).length>0&&(t=convertAttributesForComponentType({attributes:m,componentType:p,componentInfoObjects:n,compositeCreatesNewNamespace:u,flags:r}));let a={componentType:p,attributes:t,state:{value:e,fixed:!0}};d.push(a)}return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:d,parentName:e.componentName,parentCreatesNewNamespace:u,componentInfoObjects:n}).serializedComponents}}static async calculateReplacementChanges({component:e,workspace:t,componentInfoObjects:n,flags:r}){let a=t.lastReplacementParameters,i=[];if(!await e.stateValues.validSequence){let t=e.replacementsToWithhold;if(t||(t=0),e.replacements.length-t>0){let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:e.replacements.length};i.push(t)}return a.length=0,i}let o=await e.stateValues.from,s=await e.stateValues.length,l=await e.stateValues.step,u=await e.stateValues.type,c=await e.stateValues.exclude,p=await e.stateValues.lowercase;if(a.type!==u||a.exclude.length>0||c.length>0){let a=(await this.createSerializedReplacements({component:e,workspace:t,componentInfoObjects:n,flags:r})).replacements,o={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:a,replacementsToWithhold:0};i.push(o)}else{let t=!1;"math"===u?o.equals(a.from)&&l.equals(a.step)||(t=!0):o===a.from&&l===a.step||(t=!0);let c,d=a.length,m=0,f=0,h=d;if(s<d){c=e.replacements.length-s;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:c};i.push(t)}else if(s>d&&(m=s-d,e.replacementsToWithhold>0))if(e.replacementsToWithhold>=m){c=e.replacementsToWithhold-m,f+=m,d+=m,m=0;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:c};i.push(t)}else m-=e.replacementsToWithhold,f+=e.replacementsToWithhold,d+=e.replacementsToWithhold,c=0;if(!0===t&&(f=d,h=0),f>0)for(let t=h;t<h+f;t++){let n=returnSequenceValueForIndex({index:t,from:o,step:l,exclude:[],type:u,lowercase:p}),r={changeType:"updateStateVariables",component:e.replacements[t],stateChanges:{value:n}};i.push(r)}if(m>0){let t=[],a=e.attributes.newNamespace?.primitive,s={};for(let t of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])t in e.attributes&&(s[t]=e.attributes[t]);for(let i=d;i<await e.stateValues.length;i++){let c=returnSequenceValueForIndex({index:i,from:o,step:l,exclude:[],type:u,lowercase:p}),d=await e.stateValues.type;"letters"===d&&(d="text");let m={};Object.keys(s).length>0&&(m=convertAttributesForComponentType({attributes:s,componentType:d,componentInfoObjects:n,compositeCreatesNewNamespace:a,flags:r}));let f={componentType:d,attributes:m,state:{value:c,fixed:!0}};t.push(f)}let c={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:d,serializedReplacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:t,parentName:e.componentName,parentCreatesNewNamespace:a,componentInfoObjects:n,indOffset:d}).serializedComponents,replacementsToWithhold:0,assignNamesOffset:d};i.push(c)}}return a.type=u,a.from=o,a.length=s,a.step=l,a.exclude=c,i}get allPotentialRendererTypes(){let e=super.allPotentialRendererTypes,t="number";this.attributes.type&&this.attributes.type.primitive&&(t=this.attributes.type.primitive);let n=this.componentInfoObjects.allComponentClasses["letters"===t?"text":t].rendererType;return e.includes(n)||e.push(n),e}}class Map$1 extends CompositeComponent{static componentType="map";static assignNamesToReplacements=!0;static createsVariants=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.behavior={createComponentOfType:"text",createStateVariable:"behavior",defaultValue:"combination",public:!0,trim:!0},e.isResponse={leaveRaw:!0},e}static returnChildGroups(){return[{group:"templates",componentTypes:["template"]},{group:"sources",componentTypes:["sources"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nSources={additionalStateVariablesDefined:["sourcesNames","sourceAliases","sourceIndexAliases"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childGroups:["sources"],variableNames:["alias","indexAlias"]}}),definition:function({dependencyValues:e}){return{setValue:{nSources:e.sourcesChildren.length,sourcesNames:e.sourcesChildren.map((e=>e.componentName)),sourceAliases:e.sourcesChildren.map((e=>e.stateValues.alias)),sourceIndexAliases:e.sourcesChildren.map((e=>e.stateValues.indexAlias))}}}},e.nIterates={additionalStateVariablesDefined:["minNIterates","sourcesChildNames"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childGroups:["sources"],variableNames:["numberOfChildren","childComponentNames"]}}),definition:function({dependencyValues:e}){let t=e.sourcesChildren.map((e=>e.stateValues.numberOfChildren)),n=Math.min(...t),r=e.sourcesChildren.map((e=>[...e.stateValues.childComponentNames]));return{setValue:{nIterates:t,minNIterates:n,sourcesChildNames:r}}}},e.template={returnDependencies:()=>({templateChild:{dependencyType:"child",childGroups:["templates"],variableNames:["serializedChildren","newNamespace"]}}),definition:function({dependencyValues:e}){let t=e.templateChild[0];if(!t)return{setValue:{template:null}};let n={componentType:"template",state:{rendered:!0},children:t.stateValues.serializedChildren,originalName:t.componentName};return t.stateValues.newNamespace&&(n.attributes={newNamespace:{primitive:!0}}),{setValue:{template:n}}}},e.validBehavior={returnDependencies:()=>({behavior:{dependencyType:"stateVariable",variableName:"behavior"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition:function({dependencyValues:e}){let t=!0;return"parallel"===e.behavior?e.nIterates.slice(1).some((t=>t!=e.nIterates[0]))&&console.warn("Warning: map with parallel behavior and different numbers of iterates in sources activeChildren. Extra iterates will be ignored."):"combination"!==e.behavior&&(console.warn("Invalid map behavior: "+e.behavior),t=!1),{setValue:{validBehavior:t}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({validBehavior:{dependencyType:"stateVariable",variableName:"validBehavior"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={seed:e.variantSeed,meta:{createdBy:t}},r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n}}}},e}static async createSerializedReplacements({component:e,workspace:t,componentInfoObjects:n,flags:r}){if(!await e.stateValues.validBehavior)return t.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0},{replacements:[]};t.lastReplacementParameters={sourcesNames:await e.stateValues.sourcesNames,sourcesChildNames:await e.stateValues.sourcesChildNames,behavior:await e.stateValues.behavior,nIterates:await e.stateValues.nIterates,minNIterates:await e.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]};let a=[];if("parallel"===await e.stateValues.behavior)for(let t=0;t<await e.stateValues.minNIterates;t++)a.push(...await this.parallelReplacement({component:e,iter:t,componentInfoObjects:n,flags:r}));else{a=(await this.recurseThroughCombinations({component:e,sourcesNumber:0,iterateNumber:-1,componentInfoObjects:n,flags:r})).replacements}return{replacements:a}}static async parallelReplacement({component:e,iter:t,componentInfoObjects:n,flags:r}){let a=[deepClone(await e.stateValues.template)],i=e.attributes.newNamespace?.primitive;if("isResponse"in e.attributes){let t=convertAttributesForComponentType({attributes:{isResponse:e.attributes.isResponse},componentType:repl.componentType,componentInfoObjects:n,compositeCreatesNewNamespace:i,flags:r});a[0].attributes||(a[0].attributes={}),Object.assign(a[0].attributes,t)}return!a[0].attributes?.newNamespace?.primitive&&a[0].children&&markToCreateAllUniqueNames(a[0].children),a=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:a,parentName:e.componentName,parentCreatesNewNamespace:i,componentInfoObjects:n,indOffset:t}).serializedComponents,await addSharedParameters(a[0],e,Array(await e.stateValues.nSources).fill(t)),a}static async recurseThroughCombinations({component:e,sourcesNumber:t,childnumberArray:n=[],iterateNumber:r,componentInfoObjects:a,flags:i}){let o=[],s=[...n,0],l=e.attributes.newNamespace?.primitive,u=await e.stateValues.nIterates,c=await e.stateValues.nSources,p=await e.stateValues.template,d=this.createAttributesObject();for(let n=0;n<u[t];n++)if(s[t]=n,t>=c-1){r++;let t=[deepClone(p)],n={};n=convertAttributesForComponentType({attributes:e.attributes,componentType:t[0].componentType,componentInfoObjects:a,compositeAttributesObj:d,compositeCreatesNewNamespace:l,flags:i}),t[0].attributes||(t[0].attributes={}),Object.assign(t[0].attributes,n),!t[0].attributes.newNamespace?.primitive&&t[0].children&&markToCreateAllUniqueNames(t[0].children);let u=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:t,parentName:e.componentName,parentCreatesNewNamespace:l,componentInfoObjects:a,indOffset:r}).serializedComponents[0];await addSharedParameters(u,e,s),o.push(u)}else{let n=await this.recurseThroughCombinations({component:e,sourcesNumber:t+1,childnumberArray:s,iterateNumber:r,componentInfoObjects:a,flags:i});o.push(...n.replacements),r=n.iterateNumber}return{replacements:o,iterateNumber:r}}static async calculateReplacementChanges({component:e,components:t,workspace:n,componentInfoObjects:r,flags:a}){let i=[];if(!await e.stateValues.validBehavior){if(n.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},e.replacements.length>0){let t={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:e.replacements.length,replacementsToWithhold:0};i.push(t)}return i}let o=n.lastReplacementParameters,s=!1,l=!0,u=await e.stateValues.nSources,c=await e.stateValues.sourcesNames;if(u!==o.sourcesNames.length)l=!1;else for(let e=0;e<u;e++)if(c[e]!==o.sourcesNames[e]){l=!1;break}let p=await e.stateValues.nIterates,d=await e.stateValues.sourcesChildNames,m=await e.stateValues.behavior;if(l&&o.behavior===await m){let e=!0;if(void 0===o.nIterates)s=!0;else for(let t=0;t<u;t++){let n=p[t],r=o.nIterates[t];n!==r&&(e=!1);let a=Math.min(n,r);for(let n=0;n<a;n++)if(d[t][n]!=o.sourcesChildNames[t][n]){s=!0,e=!1;break}if(s)break}if(e)return[];"combination"===m&&u>1&&(s=!0)}else s=!0;if(s){let t=await this.createSerializedReplacements({component:e,workspace:n,componentInfoObjects:r,flags:a}).replacements,o={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:t,replacementsToWithhold:0};return i.push(o),n.lastReplacementParameters={sourcesNames:c,sourcesChildNames:d,behavior:m,nIterates:p,minNIterates:await e.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},i}let f=await e.stateValues.minNIterates,h=o.minNIterates,y=0,b=e.replacementsToWithhold;b||(b=0);let g=o.withheldSubstitutionChildNames,v=!1;if(f<h){for(let e=0;e<u;e++)for(let n=f;n<h;n++)void 0===t[o.sourcesChildNames[e][n]]&&(v=!0);if(!v)for(let e of o.withheldSubstitutionChildNames)for(let n of e)void 0===t[n]&&(v=!0)}if(v){let t=Math.min(f,h),n={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:t,numberReplacementsToDelete:e.replacements.length-t,replacementsToWithhold:0};i.push(n),g=[],b=0}if(f<h){if(!v){y=e.replacements.length-f;let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:y};i.push(t);for(let e=0;e<u;e++){let t=o.withheldSubstitutionChildNames[e];t=t?[...t]:[],t=new Set([...o.sourcesChildNames[e].slice(f),...t]),g[e]=t}}}else if(f>h){let t=f-h;if(b>0)if(b>=t){y=b-t,t=0;let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:y};i.push(e)}else t-=b,h+=b,y=0;if(t>0){let t=[];for(let n=h;n<f;n++)t.push(...await this.parallelReplacement({component:e,iter:n,componentInfoObjects:r,flags:a}));e.doenetAttributes.assignNames&&e.doenetAttributes.assignNames.length;let n={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:h,serializedReplacements:t,replacementsToWithhold:0,assignNamesOffset:h};i.push(n)}}return n.lastReplacementParameters={sourcesNames:c,sourcesChildNames:d,behavior:m,nIterates:p,minNIterates:f,replacementsToWithhold:y,withheldSubstitutionChildNames:g},i}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){let n=e.variants?.numberOfVariants;if(void 0!==n)return{success:!0,numberOfVariants:n};let r=gatherVariantComponents({serializedComponents:e.children,componentInfoObjects:t}),a=[];for(let e of r){let n=t.allComponentClasses[e.componentType].determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});if(!n.success)return{success:!1};a.push(n.numberOfVariants)}return 1===a.length&&1===a[0]?(e.variants.numberOfVariants=1,{success:!0,numberOfVariants:1}):{success:!1}}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r=e.variants?.numberOfVariants;return void 0===r||!Number.isInteger(t)||t<1||t>r?{success:!1}:{success:!0,desiredVariant:{index:t}}}}async function addSharedParameters(e,t,n){let r=e.doenetAttributes.addToSharedParameters=[],a=await t.stateValues.sourcesNames;for(let[e,i]of(await t.stateValues.sourceAliases).entries())if(i){let t=a[e];r.push({parameterName:"sourceNameMappings",key:i,value:{name:t,childNumber:n[e]}})}for(let[e,a]of(await t.stateValues.sourceIndexAliases).entries())a&&r.push({parameterName:"sourceIndexMappings",key:a,value:n[e]+1})}class Sources extends BaseComponent{static componentType="sources";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.alias={createPrimitiveOfType:"string",validationFunction:function(e){if(!/[a-zA-Z_]/.test(e.substring(0,1)))throw Error("All aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(e))throw Error("Aliases can contain only letters, numbers, hyphens, and underscores");return e}},e.indexAlias={createPrimitiveOfType:"string",validationFunction:function(e){if(!/[a-zA-Z_]/.test(e.substring(0,1)))throw Error("All index aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_\-]+$/.test(e))throw Error("Index aliases can contain only letters, numbers, hyphens, and underscores");return e}},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.alias={returnDependencies:()=>({alias:{dependencyType:"attributePrimitive",attributeName:"alias"}}),definition:({dependencyValues:e})=>({setValue:{alias:e.alias}})},e.indexAlias={returnDependencies:()=>({indexAlias:{dependencyType:"attributePrimitive",attributeName:"indexAlias"}}),definition:({dependencyValues:e})=>({setValue:{indexAlias:e.indexAlias}})},e.numberOfChildren={additionalStateVariablesDefined:["childComponentNames","childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"]}}),definition:function({dependencyValues:e}){let t=e.children.length,n=e.children.map((e=>e.componentName));return{setValue:{numberOfChildren:t,childComponentNames:n,childIdentities:e.children}}}},e}}class Slider extends BaseComponent{constructor(e){super(e),this.changeValue=this.changeValue.bind(this),this.actions={changeValue:this.changeValue}}static componentType="slider";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultValue:"number",toLowerCase:!0,validValues:["number","text"],forRenderer:!0},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:100,isAbsolute:!0},public:!0,forRenderer:!0},e.initialValue={createComponentOfType:"_componentWithSelectableType",createStateVariable:"initialValue",defaultValue:null},e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:null,public:!0,forRenderer:!0},e.showControls={createComponentOfType:"boolean",createStateVariable:"showControls",defaultValue:!1,public:!0,forRenderer:!0},e.showTicks={createComponentOfType:"boolean",createStateVariable:"showTicks",defaultValue:!0,public:!0,forRenderer:!0},e.showValue={createComponentOfType:"boolean",createStateVariable:"showValue",defaultValue:!0,public:!0,forRenderer:!0},e.from={createComponentOfType:"number",createStateVariable:"from",defaultValue:0,public:!0,forRenderer:!0},e.to={createComponentOfType:"number",createStateVariable:"to",defaultValue:10,public:!0,forRenderer:!0},e.step={createComponentOfType:"number",createStateVariable:"step",defaultValue:1,public:!0,forRenderer:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.bindValueTo={createComponentOfType:"_componentWithSelectableType"},e}static returnChildGroups(){return[{group:"numbersTexts",componentTypes:["number","text"]},{group:"markers",componentTypes:["markers"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.items={forRenderer:!0,public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({numberAndTextChildren:{dependencyType:"child",childGroups:["numbersTexts"],variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=[];if("text"===e.type)for(let r of e.numberAndTextChildren)t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"text"})?n.push(r.stateValues.value):n.push(r.stateValues.value.toString());else if(e.numberAndTextChildren.length>0){for(let r of e.numberAndTextChildren)if(t.isInheritedComponentType({inheritedComponentType:r.componentType,baseComponentType:"number"}))n.push(r.stateValues.value);else{let e=Number(r.stateValues.value);Number.isFinite(e)&&n.push(e)}n.sort(((e,t)=>e-t))}return{setValue:{items:n},setCreateComponentOfType:{items:e.type}}}},e.nItems={forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:e}){let t=e.items.length;return 0===t&&"number"===e.type&&(t=Math.floor((e.to-e.from)/e.step+1e-10)+1,t>=0&&Number.isFinite(t)||(t=0)),{setValue:{nItems:t}}}},e.firstItem={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:e}){let t;return t=e.items.length>0?e.items[0]:"number"===e.type?e.from:null,{setValue:{firstItem:t}}}},e.lastItem={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"},from:{dependencyType:"stateVariable",variableName:"from"},nItems:{dependencyType:"stateVariable",variableName:"nItems"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition({dependencyValues:e}){let t;return t=e.items.length>0?e.items[e.items.length-1]:"number"===e.type?e.from+(e.nItems-1)*e.step:null,{setValue:{lastItem:t}}}},e.valueToIndex={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let t={};for(let[n,r]of e.items.entries())t[r]=n;return{setValue:{valueToIndex:t}}}},e.preliminaryValue={hasEssential:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]}}),definition:({dependencyValues:e})=>e.bindValueTo?{setValue:{preliminaryValue:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{preliminaryValue:{get defaultValue(){return e.initialValue}}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.preliminaryValue,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"preliminaryValue",value:e.preliminaryValue}]}},e.index={forRenderer:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},valueToIndex:{dependencyType:"stateVariable",variableName:"valueToIndex"},items:{dependencyType:"stateVariable",variableName:"items"},preliminaryValue:{dependencyType:"stateVariable",variableName:"preliminaryValue"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},nItems:{dependencyType:"stateVariable",variableName:"nItems"}}),definition:function({dependencyValues:e}){let t=findIndexOfClosestValidValue(e);return void 0===t&&(t=0),{setValue:{index:t}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){if(0===t.items.length){let n=t.from,r=t.step,a=e.index;return Number.isInteger(a)&&(a>=0&&a<t.nItems)?{success:!0,instructions:[{setDependency:"preliminaryValue",desiredValue:n+a*r}]}:{success:!1}}let n=t.items[e.index];return void 0===n?{success:!1}:{success:!0,instructions:[{setDependency:"preliminaryValue",desiredValue:n}]}}},e.value={forRenderer:!0,public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},items:{dependencyType:"stateVariable",variableName:"items"},index:{dependencyType:"stateVariable",variableName:"index"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"}}),definition:function({dependencyValues:e}){let t;return t=e.items.length>0?e.items[e.index]:e.from+e.step*e.index,{setValue:{value:t},setCreateComponentOfType:{value:e.type}}},inverseDefinition:invertSliderValue},e.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:e,usedDefault:t}){return{setValue:{valueForDisplay:roundForDisplay({value:e.value,dependencyValues:e,usedDefault:t}).tree}}}},e.markers={forRenderer:!0,returnDependencies:()=>({markersChild:{dependencyType:"child",childGroups:["markers"],variableNames:["markerType","markers"]},type:{dependencyType:"stateVariable",variableName:"type"},items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let t=[];if(e.markersChild.length>0){let n=e.markersChild[0].stateValues.markerType;"empty"===n?t=[...e.items]:n!==e.type?(console.warn("Markers type doesn't match slider type."),t=[]):t=e.markersChild[0].stateValues.markers}return{setValue:{markers:t}}}},e}async changeValue({value:e,transient:t,actionId:n}){if(!await this.stateValues.disabled)return t?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:e}],transient:t,actionId:n}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:e}],actionId:n,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:e,responseText:e.toString()}}});this.coreFunctions.resolveAction({actionId:n})}}function findIndexOfClosestValidValue({preliminaryValue:e,valueToIndex:t,type:n,items:r,from:a,step:i,nItems:o}){let s=e;if(0===r.length){if(!Number.isFinite(s))return;let e=Math.round((s-a)/i);return e>=0?e<o?e:o-1:0}let l=t[s];if(void 0!==l)return l;if("text"===n)return;let u=function(e=0,t=r.length-1){if(t<=e+1)return s>r[e]?t:e;let n=Math.round((t+e)/2);return s>r[n]?u(n,t):u(e,n)},c=u();if(0!==c){let e=r[c-1],t=r[c];Math.abs(s-e)<Math.abs(s-t)&&c--}return c}async function invertSliderValue({desiredStateVariableValues:e,stateValues:t}){let n=e.value;if("text"===await t.type)n=n.toString();else if(n instanceof me$3.class){if(n=n.evaluate_to_constant(),null===n)return{success:!1}}else n=Number(n);let r=findIndexOfClosestValidValue({preliminaryValue:n,valueToIndex:await t.valueToIndex,type:await t.type,items:await t.items,from:await t.from,step:await t.step,nItems:await t.nItems});return void 0===r?{success:!1}:{success:!0,instructions:[{setDependency:"index",desiredValue:r}]}}class Markers extends BaseComponent{static componentType="markers";static returnChildGroups(){return[{group:"texts",componentTypes:["text"]},{group:"numbers",componentTypes:["number"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.markerType={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({textChildren:{dependencyType:"child",childGroups:["texts"]},numberChildren:{dependencyType:"child",childGroups:["numbers"]}}),definition:function({dependencyValues:e}){let t;return t=e.textChildren.length>0?"text":e.numberChildren.length>0?"number":"empty",{setValue:{markerType:t}}}},e.markers={public:!0,isArray:!0,shadowingInstructions:{hasVariableComponentType:!0},entryPrefixes:["item"],returnDependencies:()=>({markerType:{dependencyType:"stateVariable",variableName:"markerType"},textChildren:{dependencyType:"child",childGroups:["texts"],variableNames:["value"]},numberChildren:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]}}),definition:function({dependencyValues:e}){let t=[],n=e.markerType;return"text"===e.markerType?t=e.textChildren.map((e=>e.stateValues.value)):"number"===e.markerType?(t=e.numberChildren.map((e=>e.stateValues.value)),t.sort(((e,t)=>e-t))):n="text",{setValue:{markers:t},setCreateComponentOfType:{markers:n}}}},e}}function applyConstraintFromComponentConstraints({variables:e,applyComponentConstraint:t,scales:n}){let r={},a=!1;for(let i in e){let o=t({variables:{[i]:e[i]},scales:n});o.constrained&&(a=!0,r[i]=o.variables[i])}return a?{constrained:a,variables:r}:{}}class Constraints extends BaseComponent{static componentType="constraints";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.baseOnGraph={createPrimitiveOfType:"string",createStateVariable:"baseOnGraph",defaultValue:null},e}static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.independentComponentConstraints={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["independentComponentConstraints"]}}),definition:({dependencyValues:e})=>({setValue:{independentComponentConstraints:e.constraintChildren.every((e=>e.stateValues.independentComponentConstraints))}})},e.arrayEntryPrefixForConstraints={returnDependencies:()=>({arrayEntryPrefixForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayEntryPrefixForConstraints"}}),definition:({dependencyValues:e})=>({setValue:{arrayEntryPrefixForConstraints:e.arrayEntryPrefixForConstraints}})},e.arrayVariableForConstraints={returnDependencies:()=>({arrayVariableForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayVariableForConstraints"}}),definition:({dependencyValues:e})=>({setValue:{arrayVariableForConstraints:e.arrayVariableForConstraints}})},e.nDimensions={returnDependencies:()=>({nDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensionsForConstraints"}}),definition:({dependencyValues:e})=>({setValue:{nDimensions:e.nDimensions}})},e.graphComponentName={stateVariablesDeterminingDependencies:["baseOnGraph"],returnDependencies:({stateValues:e})=>e.baseOnGraph?{graphComponentName:{dependencyType:"expandTargetName",target:e.baseOnGraph}}:{},definition:({dependencyValues:e})=>e.graphComponentName?{setValue:{graphComponentName:e.graphComponentName}}:{setValue:{graphComponentName:null}}},e.scales={public:!0,shadowingInstructions:{createComponentOfType:"number"},stateVariablesDeterminingDependencies:["graphComponentName"],returnDependencies:({stateValues:e})=>e.graphComponentName?{graph:{dependencyType:"multipleStateVariables",componentName:e.graphComponentName,variableNames:["xscale","yscale"],variablesOptional:!0}}:{},definition({dependencyValues:e}){if(e.graph){let t=e.graph.stateValues,n=[t.xscale,t.yscale,1];if(n.every((e=>Number.isFinite(e)&&e>0)))return{setValue:{scales:n}}}return{setValue:{scales:[1,1,1]}}}},e.graphXmin={additionalStateVariablesDefined:["graphXmax","graphYmin","graphYmax"],stateVariablesDeterminingDependencies:["graphComponentName"],returnDependencies:({stateValues:e})=>e.graphComponentName?{graph:{dependencyType:"multipleStateVariables",componentName:e.graphComponentName,variableNames:["xmin","xmax","ymin","ymax"],variablesOptional:!0}}:{},definition({dependencyValues:e}){if(!e.graph)return{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}};let t=e.graph.stateValues.xmin,n=e.graph.stateValues.xmax,r=e.graph.stateValues.ymin,a=e.graph.stateValues.ymax;return[t,n,r,a].every(Number.isFinite)?{setValue:{graphXmin:t,graphXmax:n,graphYmin:r,graphYmax:a}}:{setValue:{graphXmin:null,graphXmax:null,graphYmin:null,graphYmax:null}}}},e.constraintResults={additionalStateVariablesDefined:[{variableName:"constraintUsedByComponent",isArray:!0,entryPrefixes:["constraintUsedByComponent"]}],isArray:!0,entryPrefixes:["constraintResult"],stateVariablesDeterminingDependencies:["independentComponentConstraints","arrayEntryPrefixForConstraints","arrayVariableForConstraints"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize:({dependencyValues:e})=>[e.nDimensions],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},scales:{dependencyType:"stateVariable",variableName:"scales"}},r=t.arrayEntryPrefixForConstraints,a={};if(t.independentComponentConstraints)for(let t of e)a[t]={x:{dependencyType:"parentStateVariable",variableName:r+(Number(t)+1)}};else{let e=t.arrayVariableForConstraints?t.arrayVariableForConstraints:"__null";n.xs={dependencyType:"parentStateVariable",variableName:e}}return{globalDependencies:n,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){if(e.independentComponentConstraints){let r={},a={};for(let i of n){let n=Number(i)+1,o={["x"+n]:t[i].x},s=!1;for(let t of e.constraintChildren){let r=t.stateValues.applyComponentConstraint({variables:o,scales:e.scales});r.constrained&&(o["x"+n]=convertValueToMathExpression(r.variables["x"+n]),s=!0)}r[i]=o["x"+n],a[i]=s}return{setValue:{constraintResults:r,constraintUsedByComponent:a}}}{let t={},n=!1;for(let n in e.xs)t[`x${Number(n)+1}`]=e.xs[n];for(let r of e.constraintChildren){let a;if(a=r.stateValues.applyConstraint?r.stateValues.applyConstraint({variables:t,scales:e.scales}):applyConstraintFromComponentConstraints({variables:t,applyComponentConstraint:r.stateValues.applyComponentConstraint,scales:e.scales}),a.constrained){for(let e in a.variables)t[e]=convertValueToMathExpression(a.variables[e]);n=!0}}let r={},a={};for(let i in e.xs)r[i]=t[`x${Number(i)+1}`],a[i]=n;return{setValue:{constraintResults:r,constraintUsedByComponent:a}}}},inverseArrayDefinitionByKey:async function({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,stateValues:a,workspace:i}){if(t.independentComponentConstraints){let n=[];for(let a in e.constraintResults){let i=Number(a)+1,o={["x"+i]:convertValueToMathExpression(e.constraintResults[a])};for(let e of t.constraintChildren){let n=e.stateValues.applyComponentConstraint({variables:o,scales:t.scales});n.constrained&&(o["x"+i]=convertValueToMathExpression(n.variables["x"+i]))}n.push({setDependency:r[a].x,desiredValue:o["x"+i]})}return{success:!0,instructions:n}}{let n={};i.desiredConstraintResults||(i.desiredConstraintResults={}),Object.assign(i.desiredConstraintResults,e.constraintResults);let r=await a.constraintResults;for(let e in r){let t=Number(e)+1;e in i.desiredConstraintResults?n["x"+t]=convertValueToMathExpression(i.desiredConstraintResults[e]):n["x"+t]=convertValueToMathExpression(r[e])}for(let e of t.constraintChildren){let r;if(r=e.stateValues.applyConstraint?e.stateValues.applyConstraint({variables:n,scales:t.scales}):applyConstraintFromComponentConstraints({variables:n,applyComponentConstraint:e.stateValues.applyComponentConstraint,scales:t.scales}),r.constrained)for(let e in r.variables)n[e]=convertValueToMathExpression(r.variables[e])}let o={};for(let e in i.desiredConstraintResults)o[e]=n[`x${Number(e)+1}`];return{success:!0,instructions:[{setDependency:"xs",desiredValue:o}]}}}},e.constraintUsed={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({constraintUsedByComponent:{dependencyType:"stateVariable",variableName:"constraintUsedByComponent"}}),definition:function({dependencyValues:e}){let t=Object.values(e.constraintUsedByComponent).some((e=>e));return{setValue:{constraintUsed:t}}}},e}}class ConstraintComponent extends BaseComponent{static componentType="_constraint";static rendererType=void 0;static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!1}})},e}}class ConstrainToGrid extends ConstraintComponent{static componentType="constrainToGrid";static createAttributesObject(){let e=super.createAttributesObject();return e.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},e.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},e.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},e.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},e.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},e.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!0}})},e.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"}}),definition:({dependencyValues:e})=>({setValue:{applyComponentConstraint:function({variables:t,scales:n}){if("x1"in t){let n=findFiniteNumericalValue(t.x1);if(!Number.isFinite(n))return{};let r=e.dx,a=e.xoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)?{constrained:!0,variables:{x1:i}}:{}}if("x2"in t){let n=findFiniteNumericalValue(t.x2);if(!Number.isFinite(n))return{};let r=e.dy,a=e.yoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)?{constrained:!0,variables:{x2:i}}:{}}if("x3"in t){let n=findFiniteNumericalValue(t.x3);if(!Number.isFinite(n))return{};let r=e.dz,a=e.zoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)?{constrained:!0,variables:{x3:i}}:{}}return{}}}})},e}}class ConstrainToGraph extends ConstraintComponent{static componentType="constrainToGraph";static createAttributesObject(){let e=super.createAttributesObject();return e.buffer={createComponentOfType:"number",createStateVariable:"buffer",defaultValue:.01,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({setValue:{independentComponentConstraints:!0}})},e.applyComponentConstraint={returnDependencies:()=>({constraintAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin","graphXmax","graphYmin","graphYmax"]},buffer:{dependencyType:"stateVariable",variableName:"buffer"}}),definition:({dependencyValues:e})=>({setValue:{applyComponentConstraint:function({variables:t,scales:n}){if(null===e.constraintAncestor||null===e.constraintAncestor.stateValues.graphXmin)return{};if("x1"in t){let n=findFiniteNumericalValue(t.x1);if(!Number.isFinite(n))return{};let r=e.constraintAncestor.stateValues.graphXmin,a=e.constraintAncestor.stateValues.graphXmax;if(!Number.isFinite(r)||!Number.isFinite(a))return{};let i=r,o=a,s=e.buffer;if(s>0){let e=s*(a-r);i+=e,o-=e}return{constrained:!0,variables:{x1:Math.max(i,Math.min(o,n))}}}if("x2"in t){let n=findFiniteNumericalValue(t.x2);if(!Number.isFinite(n))return{};let r=e.constraintAncestor.stateValues.graphYmin,a=e.constraintAncestor.stateValues.graphYmax;if(!Number.isFinite(r)||!Number.isFinite(a))return{};let i=r,o=a,s=e.buffer;if(s>0){let e=s*(a-r);i+=e,o-=e}return{constrained:!0,variables:{x2:Math.max(i,Math.min(o,n))}}}return{}}}})},e}}class AttractToGrid extends ConstraintComponent{static componentType="attractToGrid";static createAttributesObject(){let e=super.createAttributesObject();return e.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:1,public:!0},e.dy={createComponentOfType:"number",createStateVariable:"dy",defaultValue:1,public:!0},e.dz={createComponentOfType:"number",createStateVariable:"dz",defaultValue:1,public:!0},e.xoffset={createComponentOfType:"number",createStateVariable:"xoffset",defaultValue:0,public:!0},e.yoffset={createComponentOfType:"number",createStateVariable:"yoffset",defaultValue:0,public:!0},e.zoffset={createComponentOfType:"number",createStateVariable:"zoffset",defaultValue:0,public:!0},e.xthreshold={createComponentOfType:"number",createStateVariable:"xthreshold",defaultValue:.2,public:!0},e.ythreshold={createComponentOfType:"number",createStateVariable:"ythreshold",defaultValue:.2,public:!0},e.zthreshold={createComponentOfType:"number",createStateVariable:"zthreshold",defaultValue:.2,public:!0},e.includeGridlines={createComponentOfType:"boolean",createStateVariable:"includeGridlines",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.independentComponentConstraints={returnDependencies:()=>({includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"}}),definition:({dependencyValues:e})=>({setValue:{independentComponentConstraints:e.includeGridlines}})},e.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"}}),definition:({dependencyValues:e})=>({setValue:{applyComponentConstraint:function({variables:t,scales:n}){if("x1"in t){let n=findFiniteNumericalValue(t.x1);if(!Number.isFinite(n))return{};let r=e.dx,a=e.xoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)&&Math.abs(n-i)<e.xthreshold?{constrained:!0,variables:{x1:i}}:{}}if("x2"in t){let n=findFiniteNumericalValue(t.x2);if(!Number.isFinite(n))return{};let r=e.dy,a=e.yoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)&&Math.abs(n-i)<e.ythreshold?{constrained:!0,variables:{x2:i}}:{}}if("x3"in t){let n=findFiniteNumericalValue(t.x3);if(!Number.isFinite(n))return{};let r=e.dz,a=e.zoffset,i=Math.round((n-a)/r)*r+a;return Number.isFinite(i)&&Math.abs(n-i)<e.zthreshold?{constrained:!0,variables:{x3:i}}:{}}return{}}}})},e.applyConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"},includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"},applyComponentConstraint:{dependencyType:"stateVariable",variableName:"applyComponentConstraint"}}),definition:({dependencyValues:e})=>({setValue:{applyConstraint:function({variables:t,scales:n}){let r={},a=!1;for(let i in t){let o=e.applyComponentConstraint({variables:{[i]:t[i]},scales:n});o.constrained&&(a=!0,r[i]=o.variables[i])}if(!a)return{};if(!e.includeGridlines){if(void 0!==t.x1&&void 0===r.x1)return{};if(void 0!==t.x2&&void 0===r.x2)return{};if(void 0!==t.x3&&void 0===r.x3)return{}}return{constrained:a,variables:r}}}})},e}}class ConstrainTo extends ConstraintComponent{static componentType="constrainTo";static returnChildGroups(){return[{group:"graphical",componentTypes:["_graphical"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childGroups:["graphical"],variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.graphicalChildren)n.stateValues.nearestPoint?t.push(n.stateValues.nearestPoint):console.warn(`cannot attract to ${n.componentName} as it doesn't have a nearestPoint state variable`);return{setValue:{nearestPointFunctions:t}}}},e.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"}}),definition:({dependencyValues:e})=>({setValue:{applyConstraint:function({variables:t,scales:n}){let r=1/0,a={},i=!1,o={};for(let e in t)o[e]=findFiniteNumericalValue(t[e]);for(let s of e.nearestPointFunctions){let e=s({variables:t,scales:n});if(void 0===e)continue;let l={},u=0;if(void 0!==o.x1){if(void 0===e.x1)continue;l.x1=e.x1,u+=Math.pow(o.x1-e.x1,2)}if(void 0!==o.x2){if(void 0===e.x2)continue;l.x2=e.x2,u+=Math.pow(o.x2-e.x2,2)}if(void 0!==o.x3){if(void 0===e.x3)continue;l.x3=e.x3,u+=Math.pow(o.x3-e.x3,2)}u<r&&(a=l,r=u,i=!0)}return i?{constrained:i,variables:a}:{}}}})},e}}class AttractTo extends ConstraintComponent{static componentType="attractTo";static createAttributesObject(){let e=super.createAttributesObject();return e.threshold={createComponentOfType:"number"},e}static returnChildGroups(){return[{group:"graphical",componentTypes:["_graphical"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.threshold={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,returnDependencies:()=>({thresholdAttr:{dependencyType:"attributeComponent",attributeName:"threshold",variableNames:["value"]},constraintsAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["graphXmin"]}}),definition({dependencyValues:e}){if(e.thresholdAttr)return{setValue:{threshold:e.thresholdAttr.stateValues.value}};{let t=.02;return null!==e.constraintsAncestor&&null!==e.constraintsAncestor.stateValues.graphXmin||(t=.5),{useEssentialOrDefaultValue:{threshold:{defaultValue:t}}}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.thresholdAttr?{success:!0,instructions:[{setDependency:"thresholdAttr",desiredValue:e.threshold}]}:{success:!0,instructions:[{setEssentialValue:"threshold",value:e.threshold}]}},e.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childGroups:["graphical"],variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.graphicalChildren)n.stateValues.nearestPoint?t.push(n.stateValues.nearestPoint):console.warn(`cannot attract to ${n.componentName} as it doesn't have a nearestPoint state variable`);return{setValue:{nearestPointFunctions:t}}}},e.graphXscale={additionalStateVariablesDefined:["graphYscale"],returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["scales"]}}),definition({dependencyValues:e}){if(!e.graphAncestor)return{setValue:{graphXscale:null,graphYscale:null}};return{setValue:{graphXscale:e.graphAncestor.stateValues.xscale,graphYscale:e.graphAncestor.stateValues.yscale}}}},e.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"},threshold:{dependencyType:"stateVariable",variableName:"threshold"},constraintsAncestor:{dependencyType:"ancestor",componentType:"constraints",variableNames:["scales"]}}),definition({dependencyValues:e}){let t=1,n=1;return e.constraintsAncestor&&([t,n]=e.constraintsAncestor.stateValues.scales),{setValue:{applyConstraint:function({variables:r,scales:a}){let i=1/0,o={},s={};for(let e in r)s[e]=findFiniteNumericalValue(r[e]);for(let l of e.nearestPointFunctions){let e=l({variables:r,scales:a});if(void 0===e)continue;let u={},c=0;if(void 0!==s.x1){if(void 0===e.x1)continue;u.x1=e.x1,c+=Math.pow((s.x1-e.x1)/t,2)}if(void 0!==s.x2){if(void 0===e.x2)continue;u.x2=e.x2,c+=Math.pow((s.x2-e.x2)/n,2)}if(void 0!==s.x3){if(void 0===e.x3)continue;u.x3=e.x3,c+=Math.pow(s.x3-e.x3,2)}c<i&&(o=u,i=c)}return i>e.threshold*e.threshold?{}:{constrained:!0,variables:o}}}}}},e}}class ConstraintUnion extends ConstraintComponent{static componentType="constraintUnion";static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.applyConstraint={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({setValue:{applyConstraint:function({variables:t,scales:n}){let r;if(1===e.constraintChildren.length){let a=e.constraintChildren[0];return r=a.stateValues.applyConstraint?a.stateValues.applyConstraint({variables:t,scales:n}):applyConstraintFromComponentConstraints({variables:t,applyComponentConstraint:a.stateValues.applyComponentConstraint,scales:n}),r}let a,i=1/0,o={};for(let[s,l]of e.constraintChildren.entries()){if(r=l.stateValues.applyConstraint?l.stateValues.applyConstraint({variables:t,scales:n}):applyConstraintFromComponentConstraints({variables:t,applyComponentConstraint:l.stateValues.applyComponentConstraint,scales:n}),!r.constrained)continue;let e=0;for(let n in r.variables){let a=findFiniteNumericalValue(t[n]),i=findFiniteNumericalValue(r.variables[n]);if(!Number.isFinite(a)||!Number.isFinite(i)){e=1/0;break}e+=Math.pow(a-i,2)}e<i&&(o=r,a=s+1,i=e)}return void 0===a?{}:(void 0===o.constraintIndices?o.constraintIndices=[a]:o.constraintIndices=[a,...o.constraintIndices],o)}}})},e}}class AttractToConstraint extends ConstraintComponent{static componentType="attractToConstraint";static createAttributesObject(){let e=super.createAttributesObject();return e.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.5,public:!0},e}static returnChildGroups(){return[{group:"constraints",componentTypes:["_constraint"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.applyConstraint={returnDependencies:()=>({constraintChild:{dependencyType:"child",childGroups:["constraints"],variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:e})=>({setValue:{applyConstraint:function({variables:t,scales:n}){let r,a=e.constraintChild[0];if(!a)return{};r=a.stateValues.applyConstraint?a.stateValues.applyConstraint({variables:t,scales:n}):applyConstraintFromComponentConstraints({variables:t,applyComponentConstraint:a.stateValues.applyComponentConstraint,scales:n});let i=0;for(let e in r.variables){let n=findFiniteNumericalValue(t[e]),a=findFiniteNumericalValue(r.variables[e]);if(!Number.isFinite(n)||!Number.isFinite(a))return{};i+=Math.pow(n-a,2)}return i>e.threshold*e.threshold?{}:r}}})},e}}class Intersection extends CompositeComponent{static componentType="intersection";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e}static returnChildGroups(){return[{group:"lines",componentTypes:["line"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.lineChildren={returnDependencies:()=>({lineChildren:{dependencyType:"child",childGroups:["lines"],variableNames:["numericalCoeff0","numericalCoeffvar1","numericalCoeffvar2","nDimensions"]}}),definition:({dependencyValues:e})=>({setValue:{lineChildren:e.lineChildren}})},e.readyToExpandWhenResolved={returnDependencies:()=>({lineChildren:{dependencyType:"stateVariable",variableName:"lineChildren"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,components:t,componentInfoObjects:n}){let r=await e.stateValues.lineChildren,a=r.length;if(0===a)return{replacements:[]};if(1===a){let a=r[0].componentName,i=await t[a].serialize();i.state||(i.state={}),i.state.draggable=!1,i.state.fixed=!0;let o=postProcessCopy({serializedComponents:[i],componentName:e.componentName}),s=e.attributes.newNamespace?.primitive;return o=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:o,parentName:e.componentName,parentCreatesNewNamespace:s,componentInfoObjects:n}).serializedComponents,{replacements:o}}if(a>2)return console.warn("Haven't implemented intersection for more than two objects"),{replacements:[]};let i=r[0],o=r[1];if(2!==i.stateValues.nDimensions||2!==o.stateValues.nDimensions)return console.log("Intersection of lines implemented only in 2D"),{replacements:[]};let s=i.stateValues.numericalCoeffvar1,l=i.stateValues.numericalCoeffvar2,u=i.stateValues.numericalCoeff0,c=o.stateValues.numericalCoeffvar1,p=o.stateValues.numericalCoeffvar2,d=o.stateValues.numericalCoeff0;if(!(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(u)&&Number.isFinite(c)&&Number.isFinite(p)&&Number.isFinite(d)))return console.log("Intersection of lines implemented only for constant coefficients"),{replacements:[]};let m=s*p-c*l;if(Math.abs(m)<1e-14){if(Math.abs(d*s-u*c)>1e-14)return{replacements:[]};if(0===s&&0===l&&0===u||0===c&&0===p&&0===d)return{replacements:[]};{let a=r[0].componentName,i=await t[a].serialize();i.state||(i.state={}),i.state.draggable=!1,i.state.fixed=!0;let o=postProcessCopy({serializedComponents:[i],componentName:e.componentName}),s=e.attributes.newNamespace?.primitive;return o=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:o,parentName:e.componentName,parentCreatesNewNamespace:s,componentInfoObjects:n}).serializedComponents,{replacements:o}}}let f=(d*l-u*p)/m,h=(u*c-d*s)/m,y=[{componentType:"point",state:{coords:me$3.fromAst(["vector",f,h]),draggable:!1,fixed:!0}}],b=e.attributes.newNamespace?.primitive;return y=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:y,parentName:e.componentName,parentCreatesNewNamespace:b,componentInfoObjects:n}).serializedComponents,{replacements:y}}static async calculateReplacementChanges({component:e,components:t,componentInfoObjects:n}){let r=[],a=(await this.createSerializedReplacements({component:e,components:t,componentInfoObjects:n})).replacements,i=a.length,o=!0;if(i===e.replacements.length){o=!1;for(let t=0;t<i;t++){if(a[t].componentType!==e.replacements[t].componentType){o=!0;break}if(void 0===a[t].state){console.warn("No state by which to update intersection component, so recreating"),o=!0;break}if("point"!==a[t].componentType){console.warn(`Have not implemented state changes for an intersection that results in a  ${a[t].componentType}, so recreating`),o=!0;break}let n={changeType:"updateStateVariables",component:e.replacements[t],stateChanges:{coords:a[t].state.coords}};r.push(n)}}return!1===o?r:[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:a}]}}class panel extends InlineComponent{static componentType="panel";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.columns={createComponentOfType:"text",createStateVariable:"columns",defaultValue:null,public:!0},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.breakpoints={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["width"]},columns:{dependencyType:"stateVariable",variableName:"columns"}}),definition:function({dependencyValues:e}){let t=[],n=e.children.map((e=>e.stateValues.width));if(null!==e.columns){let r;if(-1!==e.columns.indexOf(","))r=e.columns.split(",").map(Number);else if(-1!==e.columns.indexOf("-")){let[t,n]=e.columns.split("-");r=[];for(let e=Number(t);e<=n;e++)r.push(e)}else r=[Number(e.columns)];let a={},i={};for(let e of r){let t=[],r=0;for(let a=0;a<e;a++){let i=-1;for(let t=a;t<n.length;t+=e)n[t]>i&&(i=n[t]);t.push(i),r+=Number(i)}a[e]=t,i[e]=r}let o=-1;for(let e of r){let e=Number.POSITIVE_INFINITY,n=-1;for(let t of r)i[t]<=e&&t>o&&(e=i[t],n=t);e<Number.POSITIVE_INFINITY&&(t.push({breakpoint:e,possibleColumnNumbers:n,arrayOfWidths:a[n]}),o=n)}}return{setValue:{breakpoints:t}}}},e}}class ConstrainToAngles extends ConstraintComponent{static componentType="constrainToAngles";static returnChildLogic(e){let t=super.returnChildLogic(e),n=function({activeChildrenMatched:e}){let t=[];for(let n of e)t.push({createdComponent:!0,componentName:n.componentName});return{success:!0,newChildren:[{componentType:"angles",children:t}]}},r=t.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),a=t.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=t.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),o=t.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),s=t.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),l=t.newOperator({name:"Angles",operator:"xor",propositions:[r,o,s],setAsBase:!0}),u=t.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return t.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[l,u],setAsBase:!0}),t}updateState(e={}){if(super.updateState(e),!this.childLogicSatisfied)return this.unresolvedState.angles=!0,void(this.unresolvedState.offset=!0);let t=this.currentTracker.trackChanges,n=t.childrenChanged(this.componentName);if(n){let e=this.childLogic.returnMatches("AtMostOneAngles");1===e.length?this.state.anglesChild=this.activeChildren[e[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let t=this.childLogic.returnMatches("AtMostOnePoint");1===t.length?this.state.pointChild=this.activeChildren[t[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles)return void(this.unresolvedState.angles=!0);(n||t.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs)return void(this.unresolvedState.offset=!0);if(n||t.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let e=0;e<this.state.pointChild.state.ndimensions;e++){let t=this.state.pointChild.state.xs[e].evaluate_to_constant();if(!Number.isFinite(t)){this.state.offset=NaN;break}this.state.offset.push(t)}}}}applyTheConstraint({x1:e,x2:t,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(void 0===e||void 0===t||void 0!==n)return{};if(e=this.findFiniteNumericalValue(e),t=this.findFiniteNumericalValue(t),!Number.isFinite(e)||!Number.isFinite(t))return{};if(void 0===r&&(r=this.state.offset),Number.isNaN(r))return{};let a,i,o=e-r[0],s=t-r[1],l=Math.atan2(s,o),u=1/0;for(let[e,t]of this.state.angles.entries()){let n=t.state.angle.evaluate_to_constant();if(!Number.isFinite(n))continue;let r=Math.abs((n-l+Math.PI)%(2*Math.PI)-Math.PI);r<u&&(a=n,i=e,u=r)}if(void 0===a)return{};let c=Math.sqrt(o*o+s*s);return{variables:{x1:r[0]+c*Math.cos(a),x2:r[1]+c*Math.sin(a)},constraintIndices:[i+1],constrained:!0}}}class AttractToAngles extends ConstraintComponent{static componentType="attractToAngles";static createAttributesObject(){let e=super.createAttributesObject();return e.threshold={createComponentOfType:"number",createStateVariable:"threshold",defaultValue:.3,public:!0},e}static returnChildLogic(e){let t=super.returnChildLogic(e),n=function({activeChildrenMatched:e}){let t=[];for(let n of e)t.push({createdComponent:!0,componentName:n.componentName});return{success:!0,newChildren:[{componentType:"angles",children:t}]}},r=t.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),a=t.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),i=t.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),o=t.newOperator({name:"StringsAndMaths",operator:"or",propositions:[a,i],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),s=t.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),l=t.newOperator({name:"Angles",operator:"xor",propositions:[r,o,s],setAsBase:!0}),u=t.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return t.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[l,u],setAsBase:!0}),t}updateState(e={}){if(super.updateState(e),!this.childLogicSatisfied)return this.unresolvedState.angles=!0,void(this.unresolvedState.offset=!0);let t=this.currentTracker.trackChanges,n=t.childrenChanged(this.componentName);if(n){let e=this.childLogic.returnMatches("AtMostOneAngles");1===e.length?this.state.anglesChild=this.activeChildren[e[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let t=this.childLogic.returnMatches("AtMostOnePoint");1===t.length?this.state.pointChild=this.activeChildren[t[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles)return void(this.unresolvedState.angles=!0);(n||t.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs)return void(this.unresolvedState.offset=!0);if(n||t.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let e=0;e<this.state.pointChild.state.ndimensions;e++){let t=this.state.pointChild.state.xs[e].evaluate_to_constant();if(!Number.isFinite(t)){this.state.offset=NaN;break}this.state.offset.push(t)}}}}applyTheConstraint({x1:e,x2:t,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(void 0===e||void 0===t||void 0!==n)return{};if(e=this.findFiniteNumericalValue(e),t=this.findFiniteNumericalValue(t),!Number.isFinite(e)||!Number.isFinite(t))return{};if(void 0===r&&(r=this.state.offset),Number.isNaN(r))return{};let a,i,o=e-r[0],s=t-r[1],l=Math.atan2(s,o),u=1/0;for(let[e,t]of this.state.angles.entries()){let n=t.state.angle.evaluate_to_constant();if(!Number.isFinite(n))continue;let r=Math.abs((n-l+Math.PI)%(2*Math.PI)-Math.PI);r<u&&(a=n,i=e,u=r)}if(void 0===a)return{};let c=Math.sqrt(o*o+s*s),p=r[0]+c*Math.cos(a),d=r[1]+c*Math.sin(a);return Math.sqrt(Math.pow(p-e,2)+Math.pow(d-t,2))>=this.state.threshold?{}:{variables:{x1:p,x2:d},constraintIndices:[i+1],constrained:!0}}}class ConditionalContent extends CompositeComponent{static componentType="conditionalContent";static includeBlankStringChildren=!0;static assignNamesToReplacements=!0;static createsVariants=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static keepChildrenSerialized({serializedComponent:e}){if(void 0===e.children)return[];let t=[];for(let[n,r]of e.children.entries())["case","else"].includes(r.componentType)||["case","else"].includes(r.attributes?.createComponentOfType?.primitive)||t.push(n);return t}static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.maximumNumberToShow={createComponentOfType:"number",createStateVariable:"maximumNumberToShow",defaultValue:null,public:!0},e.condition={createComponentOfType:"boolean"},e}static returnChildGroups(){return[{group:"cases",componentTypes:["case"]},{group:"elses",componentTypes:["else"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.baseConditionSatisfied={returnDependencies:()=>({conditionAttr:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let t=!0;return e.conditionAttr&&(t=e.conditionAttr.stateValues.value),{setValue:{baseConditionSatisfied:t}}}},e.nCases={additionalStateVariablesDefined:["caseChildren"],returnDependencies:()=>({caseChildren:{dependencyType:"child",childGroups:["cases"]}}),definition:({dependencyValues:e})=>({setValue:{caseChildren:e.caseChildren,nCases:e.caseChildren.length}})},e.elseChild={returnDependencies:()=>({elseChild:{dependencyType:"child",childGroups:["elses"]}}),definition({dependencyValues:e}){let t=null;return e.elseChild.length>0&&(t=e.elseChild[0]),{setValue:{elseChild:t}}}},e.haveCasesOrElse={returnDependencies:()=>({nCases:{dependencyType:"stateVariable",variableName:"nCases"},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"}}),definition:({dependencyValues:e})=>({setValue:{haveCasesOrElse:e.nCases>0||null!==e.elseChild}})},e.selectedIndices={returnDependencies:()=>({caseChildren:{dependencyType:"child",childGroups:["cases"],variableNames:["conditionSatisfied"]},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"},maximumNumberToShow:{dependencyType:"stateVariable",variableName:"maximumNumberToShow"}}),definition({dependencyValues:e}){let t=[];for(let[n,r]of e.caseChildren.entries())r.stateValues.conditionSatisfied&&t.push(n);if(0===t.length&&e.elseChild&&t.push(e.caseChildren.length),null!==e.maximumNumberToShow&&t.length>e.maximumNumberToShow){let n=Math.max(0,Math.floor(e.maximumNumberToShow));t=t.slice(0,n)}return{setValue:{selectedIndices:t}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({baseConditionSatisfied:{dependencyType:"stateVariable",variableName:"baseConditionSatisfied"},haveCasesOrElse:{dependencyType:"stateVariable",variableName:"haveCasesOrElse"},selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={seed:e.variantSeed,meta:{createdBy:t}},r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n}}}},e}static async createSerializedReplacements({component:e,components:t,workspace:n,componentInfoObjects:r}){let a=await this.getReplacements(e,t,r);return n.previousSelectedIndices=[...await e.stateValues.selectedIndices],n.previousBaseConditionSatisfied=await e.stateValues.baseConditionSatisfied,{replacements:a}}static async getReplacements(e,t,n){if(!await e.stateValues.baseConditionSatisfied)return[];let r=[];if(await e.stateValues.haveCasesOrElse){let n=await e.stateValues.caseChildren;for(let[a,i]of(await e.stateValues.selectedIndices).entries()){let o,s,l;i<await e.stateValues.nCases?(o=n[i].componentName,l=createUniqueName("case",`${e.componentName}|replacement|${i}`),s="case"):(o=(await e.stateValues.elseChild).componentName,l=createUniqueName("else",`${e.componentName}|replacement|${i}`),s="else");let u=o.lastIndexOf("/");l=o.substring(0,u)+"/"+l;let c=deepClone(await t[o].state.serializedChildren.value),p={componentType:s,state:{rendered:!0},doenetAttributes:Object.assign({},t[o].doenetAttributes),children:c,originalName:l,variants:{desiredVariant:{seed:e.sharedParameters.variantSeed+a.toString()+"|"+i.toString()}}};t[o].attributes.newNamespace&&(p.attributes={newNamespace:{primitive:!0}}),r.push(p)}}else r=deepClone(e.serializedChildren);let a=e.attributes.newNamespace?.primitive;return processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:r,parentName:e.componentName,parentCreatesNewNamespace:a,componentInfoObjects:n,originalNamesAreConsistent:!0}).serializedComponents}static async calculateReplacementChanges({component:e,componentChanges:t,components:n,workspace:r,componentInfoObjects:a}){let i=await e.stateValues.selectedIndices,o=await e.stateValues.baseConditionSatisfied;if(r.previousSelectedIndices.length===i.length&&r.previousSelectedIndices.every(((e,t)=>e===i[t]))){if(r.previousBaseConditionSatisfied===o)return[];if(!o){let t={changeType:"changeReplacementsToWithhold",replacementsToWithhold:e.replacements.length};return r.previousBaseConditionSatisfied=o,[t]}if(e.replacements.length===e.serializedChildren.length){let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};return r.previousBaseConditionSatisfied=o,[e]}}let s=[],l=await this.getReplacements(e,n,a),u={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:l,replacementsToWithhold:0};return s.push(u),r.previousSelectedIndices=[...i],r.previousBaseConditionSatisfied=o,s}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}get allPotentialRendererTypes(){let e=super.allPotentialRendererTypes;if(this.serializedChildren){let t=this.potentialRendererTypesFromSerializedComponents(this.serializedChildren);for(let n of t)e.includes(n)||e.push(n)}return e}}class AsList extends InlineComponent{static componentType="asList";static renderChildren=!0;static returnChildGroups(){return[{group:"inline",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.inlineChildren)"object"!=typeof n?t.push(n.toString()):"string"==typeof n.stateValues.text?t.push(n.stateValues.text):t.push("");return{setValue:{text:t.join(", ")}}}},e.latex={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inline"],variableNames:["text","latex"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t=[];for(let n of e.inlineChildren)"object"!=typeof n?t.push(n.toString()):"string"==typeof n.stateValues.latex?t.push(n.stateValues.latex):"string"==typeof n.stateValues.text?t.push(n.stateValues.text):t.push("");return{setValue:{latex:t.join(", ")}}}},e}}function normalizeIndex(e){if(null!==e&&""!==e){if(Number.isFinite(Number(e)))return Number(e)-1;if("string"==typeof e)return lettersToNumber(e)}}function lettersToNumber(e){let t=0,n=(e=e.toUpperCase()).length,r=n;for(;(r-=1)>-1;){let a=e.charCodeAt(r)-64;if(a<1||a>26)return void console.warn("Cannot convert "+e+" to a number");t+=a*Math.pow(26,n-1-r)}return t--,t}var check=function(e){return e&&e.Math==Math&&e},global$U=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$B=function(e){try{return!!e()}catch(e){return!0}},fails$A=fails$B,descriptors=!fails$A((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),fails$z=fails$B,functionBindNative=!fails$z((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND$4=functionBindNative,call$h=Function.prototype.call,functionCall=NATIVE_BIND$4?call$h.bind(call$h):function(){return call$h.apply(call$h,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable$2={}.propertyIsEnumerable,getOwnPropertyDescriptor$4=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$4&&!$propertyIsEnumerable$2.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$4(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$2;var createPropertyDescriptor$5=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},NATIVE_BIND$3=functionBindNative,FunctionPrototype$3=Function.prototype,bind$9=FunctionPrototype$3.bind,call$g=FunctionPrototype$3.call,uncurryThis$I=NATIVE_BIND$3&&bind$9.bind(call$g,call$g),functionUncurryThis=NATIVE_BIND$3?function(e){return e&&uncurryThis$I(e)}:function(e){return e&&function(){return call$g.apply(e,arguments)}},uncurryThis$H=functionUncurryThis,toString$i=uncurryThis$H({}.toString),stringSlice$a=uncurryThis$H("".slice),classofRaw$1=function(e){return stringSlice$a(toString$i(e),8,-1)},global$T=global$U,uncurryThis$G=functionUncurryThis,fails$y=fails$B,classof$b=classofRaw$1,Object$5=global$T.Object,split$1=uncurryThis$G("".split),indexedObject=fails$y((function(){return!Object$5("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$b(e)?split$1(e,""):Object$5(e)}:Object$5,global$S=global$U,TypeError$j=global$S.TypeError,requireObjectCoercible$b=function(e){if(null==e)throw TypeError$j("Can't call method on "+e);return e},IndexedObject$4=indexedObject,requireObjectCoercible$a=requireObjectCoercible$b,toIndexedObject$b=function(e){return IndexedObject$4(requireObjectCoercible$a(e))},isCallable$l=function(e){return"function"==typeof e},isCallable$k=isCallable$l,isObject$m=function(e){return"object"==typeof e?null!==e:isCallable$k(e)},global$R=global$U,isCallable$j=isCallable$l,aFunction=function(e){return isCallable$j(e)?e:void 0},getBuiltIn$8=function(e,t){return arguments.length<2?aFunction(global$R[e]):global$R[e]&&global$R[e][t]},uncurryThis$F=functionUncurryThis,objectIsPrototypeOf=uncurryThis$F({}.isPrototypeOf),getBuiltIn$7=getBuiltIn$8,engineUserAgent=getBuiltIn$7("navigator","userAgent")||"",global$Q=global$U,userAgent$3=engineUserAgent,process=global$Q.process,Deno=global$Q.Deno,versions=process&&process.versions||Deno&&Deno.version,v8=versions&&versions.v8,match,version;v8&&(match=v8.split("."),version=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version&&userAgent$3&&(match=userAgent$3.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent$3.match(/Chrome\/(\d+)/),match&&(version=+match[1])));var engineV8Version=version,V8_VERSION$2=engineV8Version,fails$x=fails$B,nativeSymbol=!!Object.getOwnPropertySymbols&&!fails$x((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION$2&&V8_VERSION$2<41})),NATIVE_SYMBOL$3=nativeSymbol,useSymbolAsUid=NATIVE_SYMBOL$3&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,global$P=global$U,getBuiltIn$6=getBuiltIn$8,isCallable$i=isCallable$l,isPrototypeOf$7=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,Object$4=global$P.Object,isSymbol$4=USE_SYMBOL_AS_UID$1?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn$6("Symbol");return isCallable$i(t)&&isPrototypeOf$7(t.prototype,Object$4(e))},global$O=global$U,String$5=global$O.String,tryToString$4=function(e){try{return String$5(e)}catch(e){return"Object"}},global$N=global$U,isCallable$h=isCallable$l,tryToString$3=tryToString$4,TypeError$i=global$N.TypeError,aCallable$6=function(e){if(isCallable$h(e))return e;throw TypeError$i(tryToString$3(e)+" is not a function")},aCallable$5=aCallable$6,getMethod$5=function(e,t){var n=e[t];return null==n?void 0:aCallable$5(n)},global$M=global$U,call$f=functionCall,isCallable$g=isCallable$l,isObject$l=isObject$m,TypeError$h=global$M.TypeError,ordinaryToPrimitive$1=function(e,t){var n,r;if("string"===t&&isCallable$g(n=e.toString)&&!isObject$l(r=call$f(n,e)))return r;if(isCallable$g(n=e.valueOf)&&!isObject$l(r=call$f(n,e)))return r;if("string"!==t&&isCallable$g(n=e.toString)&&!isObject$l(r=call$f(n,e)))return r;throw TypeError$h("Can't convert object to primitive value")},shared$5={exports:{}},global$L=global$U,defineProperty$a=Object.defineProperty,setGlobal$3=function(e,t){try{defineProperty$a(global$L,e,{value:t,configurable:!0,writable:!0})}catch(n){global$L[e]=t}return t},global$K=global$U,setGlobal$2=setGlobal$3,SHARED="__core-js_shared__",store$3=global$K[SHARED]||setGlobal$2(SHARED,{}),sharedStore=store$3,store$2=sharedStore;(shared$5.exports=function(e,t){return store$2[e]||(store$2[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"});var global$J=global$U,requireObjectCoercible$9=requireObjectCoercible$b,Object$3=global$J.Object,toObject$e=function(e){return Object$3(requireObjectCoercible$9(e))},uncurryThis$E=functionUncurryThis,toObject$d=toObject$e,hasOwnProperty=uncurryThis$E({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty(toObject$d(e),t)},uncurryThis$D=functionUncurryThis,id$2=0,postfix=Math.random(),toString$h=uncurryThis$D(1..toString),uid$4=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$h(++id$2+postfix,36)},global$I=global$U,shared$4=shared$5.exports,hasOwn$h=hasOwnProperty_1,uid$3=uid$4,NATIVE_SYMBOL$2=nativeSymbol,USE_SYMBOL_AS_UID=useSymbolAsUid,WellKnownSymbolsStore$1=shared$4("wks"),Symbol$1=global$I.Symbol,symbolFor=Symbol$1&&Symbol$1.for,createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid$3,wellKnownSymbol$o=function(e){if(!hasOwn$h(WellKnownSymbolsStore$1,e)||!NATIVE_SYMBOL$2&&"string"!=typeof WellKnownSymbolsStore$1[e]){var t="Symbol."+e;NATIVE_SYMBOL$2&&hasOwn$h(Symbol$1,e)?WellKnownSymbolsStore$1[e]=Symbol$1[e]:WellKnownSymbolsStore$1[e]=USE_SYMBOL_AS_UID&&symbolFor?symbolFor(t):createWellKnownSymbol(t)}return WellKnownSymbolsStore$1[e]},global$H=global$U,call$e=functionCall,isObject$k=isObject$m,isSymbol$3=isSymbol$4,getMethod$4=getMethod$5,ordinaryToPrimitive=ordinaryToPrimitive$1,wellKnownSymbol$n=wellKnownSymbol$o,TypeError$g=global$H.TypeError,TO_PRIMITIVE$1=wellKnownSymbol$n("toPrimitive"),toPrimitive$2=function(e,t){if(!isObject$k(e)||isSymbol$3(e))return e;var n,r=getMethod$4(e,TO_PRIMITIVE$1);if(r){if(void 0===t&&(t="default"),n=call$e(r,e,t),!isObject$k(n)||isSymbol$3(n))return n;throw TypeError$g("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPrimitive$1=toPrimitive$2,isSymbol$2=isSymbol$4,toPropertyKey$4=function(e){var t=toPrimitive$1(e,"string");return isSymbol$2(t)?t:t+""},global$G=global$U,isObject$j=isObject$m,document$1=global$G.document,EXISTS$1=isObject$j(document$1)&&isObject$j(document$1.createElement),documentCreateElement$2=function(e){return EXISTS$1?document$1.createElement(e):{}},DESCRIPTORS$h=descriptors,fails$w=fails$B,createElement=documentCreateElement$2,ie8DomDefine=!DESCRIPTORS$h&&!fails$w((function(){return 7!=Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a})),DESCRIPTORS$g=descriptors,call$d=functionCall,propertyIsEnumerableModule$2=objectPropertyIsEnumerable,createPropertyDescriptor$4=createPropertyDescriptor$5,toIndexedObject$a=toIndexedObject$b,toPropertyKey$3=toPropertyKey$4,hasOwn$g=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$g?$getOwnPropertyDescriptor$2:function(e,t){if(e=toIndexedObject$a(e),t=toPropertyKey$3(t),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$2(e,t)}catch(e){}if(hasOwn$g(e,t))return createPropertyDescriptor$4(!call$d(propertyIsEnumerableModule$2.f,e,t),e[t])};var objectDefineProperty={},DESCRIPTORS$f=descriptors,fails$v=fails$B,v8PrototypeDefineBug=DESCRIPTORS$f&&fails$v((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),global$F=global$U,isObject$i=isObject$m,String$4=global$F.String,TypeError$f=global$F.TypeError,anObject$j=function(e){if(isObject$i(e))return e;throw TypeError$f(String$4(e)+" is not an object")},global$E=global$U,DESCRIPTORS$e=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG$1=v8PrototypeDefineBug,anObject$i=anObject$j,toPropertyKey$2=toPropertyKey$4,TypeError$e=global$E.TypeError,$defineProperty$1=Object.defineProperty,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable";objectDefineProperty.f=DESCRIPTORS$e?V8_PROTOTYPE_DEFINE_BUG$1?function(e,t,n){if(anObject$i(e),t=toPropertyKey$2(t),anObject$i(n),"function"==typeof e&&"prototype"===t&&"value"in n&&WRITABLE in n&&!n[WRITABLE]){var r=$getOwnPropertyDescriptor$1(e,t);r&&r[WRITABLE]&&(e[t]=n.value,n={configurable:CONFIGURABLE$1 in n?n[CONFIGURABLE$1]:r[CONFIGURABLE$1],enumerable:ENUMERABLE in n?n[ENUMERABLE]:r[ENUMERABLE],writable:!1})}return $defineProperty$1(e,t,n)}:$defineProperty$1:function(e,t,n){if(anObject$i(e),t=toPropertyKey$2(t),anObject$i(n),IE8_DOM_DEFINE)try{return $defineProperty$1(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError$e("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var DESCRIPTORS$d=descriptors,definePropertyModule$6=objectDefineProperty,createPropertyDescriptor$3=createPropertyDescriptor$5,createNonEnumerableProperty$8=DESCRIPTORS$d?function(e,t,n){return definePropertyModule$6.f(e,t,createPropertyDescriptor$3(1,n))}:function(e,t,n){return e[t]=n,e},redefine$b={exports:{}},uncurryThis$C=functionUncurryThis,isCallable$f=isCallable$l,store$1=sharedStore,functionToString$1=uncurryThis$C(Function.toString);isCallable$f(store$1.inspectSource)||(store$1.inspectSource=function(e){return functionToString$1(e)});var inspectSource$3=store$1.inspectSource,global$D=global$U,isCallable$e=isCallable$l,inspectSource$2=inspectSource$3,WeakMap$2=global$D.WeakMap,nativeWeakMap=isCallable$e(WeakMap$2)&&/native code/.test(inspectSource$2(WeakMap$2)),shared$3=shared$5.exports,uid$2=uid$4,keys$3=shared$3("keys"),sharedKey$4=function(e){return keys$3[e]||(keys$3[e]=uid$2(e))},hiddenKeys$6={},NATIVE_WEAK_MAP$1=nativeWeakMap,global$C=global$U,uncurryThis$B=functionUncurryThis,isObject$h=isObject$m,createNonEnumerableProperty$7=createNonEnumerableProperty$8,hasOwn$f=hasOwnProperty_1,shared$2=sharedStore,sharedKey$3=sharedKey$4,hiddenKeys$5=hiddenKeys$6,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$d=global$C.TypeError,WeakMap$1=global$C.WeakMap,set$1,get$1,has$1,enforce=function(e){return has$1(e)?get$1(e):set$1(e,{})},getterFor=function(e){return function(t){var n;if(!isObject$h(t)||(n=get$1(t)).type!==e)throw TypeError$d("Incompatible receiver, "+e+" required");return n}};if(NATIVE_WEAK_MAP$1||shared$2.state){var store=shared$2.state||(shared$2.state=new WeakMap$1),wmget=uncurryThis$B(store.get),wmhas=uncurryThis$B(store.has),wmset=uncurryThis$B(store.set);set$1=function(e,t){if(wmhas(store,e))throw new TypeError$d(OBJECT_ALREADY_INITIALIZED);return t.facade=e,wmset(store,e,t),t},get$1=function(e){return wmget(store,e)||{}},has$1=function(e){return wmhas(store,e)}}else{var STATE=sharedKey$3("state");hiddenKeys$5[STATE]=!0,set$1=function(e,t){if(hasOwn$f(e,STATE))throw new TypeError$d(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$7(e,STATE,t),t},get$1=function(e){return hasOwn$f(e,STATE)?e[STATE]:{}},has$1=function(e){return hasOwn$f(e,STATE)}}var internalState={set:set$1,get:get$1,has:has$1,enforce:enforce,getterFor:getterFor},DESCRIPTORS$c=descriptors,hasOwn$e=hasOwnProperty_1,FunctionPrototype$2=Function.prototype,getDescriptor=DESCRIPTORS$c&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$e(FunctionPrototype$2,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS$c||DESCRIPTORS$c&&getDescriptor(FunctionPrototype$2,"name").configurable),functionName$1={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},global$B=global$U,isCallable$d=isCallable$l,hasOwn$d=hasOwnProperty_1,createNonEnumerableProperty$6=createNonEnumerableProperty$8,setGlobal$1=setGlobal$3,inspectSource$1=inspectSource$3,InternalStateModule$5=internalState,CONFIGURABLE_FUNCTION_NAME$1=functionName$1.CONFIGURABLE,getInternalState$4=InternalStateModule$5.get,enforceInternalState$2=InternalStateModule$5.enforce,TEMPLATE=String(String).split("String");(redefine$b.exports=function(e,t,n,r){var a,i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet,l=r&&void 0!==r.name?r.name:t;isCallable$d(n)&&("Symbol("===String(l).slice(0,7)&&(l="["+String(l).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!hasOwn$d(n,"name")||CONFIGURABLE_FUNCTION_NAME$1&&n.name!==l)&&createNonEnumerableProperty$6(n,"name",l),(a=enforceInternalState$2(n)).source||(a.source=TEMPLATE.join("string"==typeof l?l:""))),e!==global$B?(i?!s&&e[t]&&(o=!0):delete e[t],o?e[t]=n:createNonEnumerableProperty$6(e,t,n)):o?e[t]=n:setGlobal$1(t,n)})(Function.prototype,"toString",(function(){return isCallable$d(this)&&getInternalState$4(this).source||inspectSource$1(this)}));var objectGetOwnPropertyNames={},ceil$2=Math.ceil,floor$5=Math.floor,toIntegerOrInfinity$7=function(e){var t=+e;return t!=t||0===t?0:(t>0?floor$5:ceil$2)(t)},toIntegerOrInfinity$6=toIntegerOrInfinity$7,max$4=Math.max,min$6=Math.min,toAbsoluteIndex$6=function(e,t){var n=toIntegerOrInfinity$6(e);return n<0?max$4(n+t,0):min$6(n,t)},toIntegerOrInfinity$5=toIntegerOrInfinity$7,min$5=Math.min,toLength$6=function(e){return e>0?min$5(toIntegerOrInfinity$5(e),9007199254740991):0},toLength$5=toLength$6,lengthOfArrayLike$b=function(e){return toLength$5(e.length)},toIndexedObject$9=toIndexedObject$b,toAbsoluteIndex$5=toAbsoluteIndex$6,lengthOfArrayLike$a=lengthOfArrayLike$b,createMethod$6=function(e){return function(t,n,r){var a,i=toIndexedObject$9(t),o=lengthOfArrayLike$a(i),s=toAbsoluteIndex$5(r,o);if(e&&n!=n){for(;o>s;)if((a=i[s++])!=a)return!0}else for(;o>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},arrayIncludes={includes:createMethod$6(!0),indexOf:createMethod$6(!1)},uncurryThis$A=functionUncurryThis,hasOwn$c=hasOwnProperty_1,toIndexedObject$8=toIndexedObject$b,indexOf$2=arrayIncludes.indexOf,hiddenKeys$4=hiddenKeys$6,push$7=uncurryThis$A([].push),objectKeysInternal=function(e,t){var n,r=toIndexedObject$8(e),a=0,i=[];for(n in r)!hasOwn$c(hiddenKeys$4,n)&&hasOwn$c(r,n)&&push$7(i,n);for(;t.length>a;)hasOwn$c(r,n=t[a++])&&(~indexOf$2(i,n)||push$7(i,n));return i},enumBugKeys$3=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,enumBugKeys$2=enumBugKeys$3,hiddenKeys$3=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys$1(e,hiddenKeys$3)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getBuiltIn$5=getBuiltIn$8,uncurryThis$z=functionUncurryThis,getOwnPropertyNamesModule$2=objectGetOwnPropertyNames,getOwnPropertySymbolsModule$2=objectGetOwnPropertySymbols,anObject$h=anObject$j,concat$3=uncurryThis$z([].concat),ownKeys$1=getBuiltIn$5("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule$2.f(anObject$h(e)),n=getOwnPropertySymbolsModule$2.f;return n?concat$3(t,n(e)):t},hasOwn$b=hasOwnProperty_1,ownKeys=ownKeys$1,getOwnPropertyDescriptorModule$2=objectGetOwnPropertyDescriptor,definePropertyModule$5=objectDefineProperty,copyConstructorProperties$2=function(e,t,n){for(var r=ownKeys(t),a=definePropertyModule$5.f,i=getOwnPropertyDescriptorModule$2.f,o=0;o<r.length;o++){var s=r[o];hasOwn$b(e,s)||n&&hasOwn$b(n,s)||a(e,s,i(t,s))}},fails$u=fails$B,isCallable$c=isCallable$l,replacement=/#|\.prototype\./,isForced$4=function(e,t){var n=data$1[normalize(e)];return n==POLYFILL||n!=NATIVE&&(isCallable$c(t)?fails$u(t):!!t)},normalize=isForced$4.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data$1=isForced$4.data={},NATIVE=isForced$4.NATIVE="N",POLYFILL=isForced$4.POLYFILL="P",isForced_1=isForced$4,global$A=global$U,getOwnPropertyDescriptor$3=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty$5=createNonEnumerableProperty$8,redefine$a=redefine$b.exports,setGlobal=setGlobal$3,copyConstructorProperties$1=copyConstructorProperties$2,isForced$3=isForced_1,_export=function(e,t){var n,r,a,i,o,s=e.target,l=e.global,u=e.stat;if(n=l?global$A:u?global$A[s]||setGlobal(s,{}):(global$A[s]||{}).prototype)for(r in t){if(i=t[r],a=e.noTargetGet?(o=getOwnPropertyDescriptor$3(n,r))&&o.value:n[r],!isForced$3(l?r:s+(u?".":"#")+r,e.forced)&&void 0!==a){if(typeof i==typeof a)continue;copyConstructorProperties$1(i,a)}(e.sham||a&&a.sham)&&createNonEnumerableProperty$5(i,"sham",!0),redefine$a(n,r,i,e)}},fails$t=fails$B,correctPrototypeGetter=!fails$t((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),global$z=global$U,hasOwn$a=hasOwnProperty_1,isCallable$b=isCallable$l,toObject$c=toObject$e,sharedKey$2=sharedKey$4,CORRECT_PROTOTYPE_GETTER$1=correctPrototypeGetter,IE_PROTO$1=sharedKey$2("IE_PROTO"),Object$2=global$z.Object,ObjectPrototype$2=Object$2.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER$1?Object$2.getPrototypeOf:function(e){var t=toObject$c(e);if(hasOwn$a(t,IE_PROTO$1))return t[IE_PROTO$1];var n=t.constructor;return isCallable$b(n)&&t instanceof n?n.prototype:t instanceof Object$2?ObjectPrototype$2:null},$$O=_export,fails$s=fails$B,toObject$b=toObject$e,nativeGetPrototypeOf=objectGetPrototypeOf,CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,FAILS_ON_PRIMITIVES$4=fails$s((function(){nativeGetPrototypeOf(1)}));$$O({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$4,sham:!CORRECT_PROTOTYPE_GETTER},{getPrototypeOf:function(e){return nativeGetPrototypeOf(toObject$b(e))}});var objectGetOwnPropertyNamesExternal={},toPropertyKey$1=toPropertyKey$4,definePropertyModule$4=objectDefineProperty,createPropertyDescriptor$2=createPropertyDescriptor$5,createProperty$5=function(e,t,n){var r=toPropertyKey$1(t);r in e?definePropertyModule$4.f(e,r,createPropertyDescriptor$2(0,n)):e[r]=n},global$y=global$U,toAbsoluteIndex$4=toAbsoluteIndex$6,lengthOfArrayLike$9=lengthOfArrayLike$b,createProperty$4=createProperty$5,Array$4=global$y.Array,max$3=Math.max,arraySliceSimple=function(e,t,n){for(var r=lengthOfArrayLike$9(e),a=toAbsoluteIndex$4(t,r),i=toAbsoluteIndex$4(void 0===n?r:n,r),o=Array$4(max$3(i-a,0)),s=0;a<i;a++,s++)createProperty$4(o,s,e[a]);return o.length=s,o},classof$a=classofRaw$1,toIndexedObject$7=toIndexedObject$b,$getOwnPropertyNames$1=objectGetOwnPropertyNames.f,arraySlice$6=arraySliceSimple,windowNames="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(e){try{return $getOwnPropertyNames$1(e)}catch(e){return arraySlice$6(windowNames)}};objectGetOwnPropertyNamesExternal.f=function(e){return windowNames&&"Window"==classof$a(e)?getWindowNames(e):$getOwnPropertyNames$1(toIndexedObject$7(e))};var $$N=_export,fails$r=fails$B,getOwnPropertyNames$2=objectGetOwnPropertyNamesExternal.f,FAILS_ON_PRIMITIVES$3=fails$r((function(){return!Object.getOwnPropertyNames(1)}));$$N({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$3},{getOwnPropertyNames:getOwnPropertyNames$2});var wellKnownSymbol$m=wellKnownSymbol$o,TO_STRING_TAG$3=wellKnownSymbol$m("toStringTag"),test$2={};test$2[TO_STRING_TAG$3]="z";var toStringTagSupport="[object z]"===String(test$2),global$x=global$U,TO_STRING_TAG_SUPPORT$2=toStringTagSupport,isCallable$a=isCallable$l,classofRaw=classofRaw$1,wellKnownSymbol$l=wellKnownSymbol$o,TO_STRING_TAG$2=wellKnownSymbol$l("toStringTag"),Object$1=global$x.Object,CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}},classof$9=TO_STRING_TAG_SUPPORT$2?classofRaw:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=tryGet(t=Object$1(e),TO_STRING_TAG$2))?n:CORRECT_ARGUMENTS?classofRaw(t):"Object"==(r=classofRaw(t))&&isCallable$a(t.callee)?"Arguments":r},global$w=global$U,classof$8=classof$9,String$3=global$w.String,toString$g=function(e){if("Symbol"===classof$8(e))throw TypeError("Cannot convert a Symbol value to a string");return String$3(e)},isObject$g=isObject$m,classof$7=classofRaw$1,wellKnownSymbol$k=wellKnownSymbol$o,MATCH$2=wellKnownSymbol$k("match"),isRegexp=function(e){var t;return isObject$g(e)&&(void 0!==(t=e[MATCH$2])?!!t:"RegExp"==classof$7(e))},global$v=global$U,isRegExp$3=isRegexp,TypeError$c=global$v.TypeError,notARegexp=function(e){if(isRegExp$3(e))throw TypeError$c("The method doesn't accept regular expressions");return e},wellKnownSymbol$j=wellKnownSymbol$o,MATCH$1=wellKnownSymbol$j("match"),correctIsRegexpLogic=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[MATCH$1]=!1,"/./"[e](t)}catch(e){}}return!1},$$M=_export,uncurryThis$y=functionUncurryThis,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,toLength$4=toLength$6,toString$f=toString$g,notARegExp$2=notARegexp,requireObjectCoercible$8=requireObjectCoercible$b,correctIsRegExpLogic$2=correctIsRegexpLogic,un$StartsWith=uncurryThis$y("".startsWith),stringSlice$9=uncurryThis$y("".slice),min$4=Math.min,CORRECT_IS_REGEXP_LOGIC$1=correctIsRegExpLogic$2("startsWith"),MDN_POLYFILL_BUG$1=!(CORRECT_IS_REGEXP_LOGIC$1||(descriptor=getOwnPropertyDescriptor$2(String.prototype,"startsWith"),!descriptor||descriptor.writable)),descriptor;$$M({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG$1&&!CORRECT_IS_REGEXP_LOGIC$1},{startsWith:function(e){var t=toString$f(requireObjectCoercible$8(this));notARegExp$2(e);var n=toLength$4(min$4(arguments.length>1?arguments[1]:void 0,t.length)),r=toString$f(e);return un$StartsWith?un$StartsWith(t,r,n):stringSlice$9(t,n,n+r.length)===r}});var TO_STRING_TAG_SUPPORT$1=toStringTagSupport,classof$6=classof$9,objectToString=TO_STRING_TAG_SUPPORT$1?{}.toString:function(){return"[object "+classof$6(this)+"]"},TO_STRING_TAG_SUPPORT=toStringTagSupport,redefine$9=redefine$b.exports,toString$e=objectToString;TO_STRING_TAG_SUPPORT||redefine$9(Object.prototype,"toString",toString$e,{unsafe:!0});var NATIVE_BIND$2=functionBindNative,FunctionPrototype$1=Function.prototype,apply$4=FunctionPrototype$1.apply,call$c=FunctionPrototype$1.call,functionApply="object"==typeof Reflect&&Reflect.apply||(NATIVE_BIND$2?call$c.bind(apply$4):function(){return call$c.apply(apply$4,arguments)}),uncurryThis$x=functionUncurryThis,arraySlice$5=uncurryThis$x([].slice),global$u=global$U,uncurryThis$w=functionUncurryThis,aCallable$4=aCallable$6,isObject$f=isObject$m,hasOwn$9=hasOwnProperty_1,arraySlice$4=arraySlice$5,NATIVE_BIND$1=functionBindNative,Function$1=global$u.Function,concat$2=uncurryThis$w([].concat),join$1=uncurryThis$w([].join),factories={},construct$1=function(e,t,n){if(!hasOwn$9(factories,t)){for(var r=[],a=0;a<t;a++)r[a]="a["+a+"]";factories[t]=Function$1("C,a","return new C("+join$1(r,",")+")")}return factories[t](e,n)},functionBind=NATIVE_BIND$1?Function$1.bind:function(e){var t=aCallable$4(this),n=t.prototype,r=arraySlice$4(arguments,1),a=function(){var n=concat$2(r,arraySlice$4(arguments));return this instanceof a?construct$1(t,n.length,n):t.apply(e,n)};return isObject$f(n)&&(a.prototype=n),a},uncurryThis$v=functionUncurryThis,fails$q=fails$B,isCallable$9=isCallable$l,classof$5=classof$9,getBuiltIn$4=getBuiltIn$8,inspectSource=inspectSource$3,noop=function(){},empty$1=[],construct=getBuiltIn$4("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec$3=uncurryThis$v(constructorRegExp.exec),INCORRECT_TO_STRING=!constructorRegExp.exec(noop),isConstructorModern=function(e){if(!isCallable$9(e))return!1;try{return construct(noop,empty$1,e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!isCallable$9(e))return!1;switch(classof$5(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING||!!exec$3(constructorRegExp,inspectSource(e))}catch(e){return!0}};isConstructorLegacy.sham=!0;var isConstructor$4=!construct||fails$q((function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){e=!0}))||e}))?isConstructorLegacy:isConstructorModern,global$t=global$U,isConstructor$3=isConstructor$4,tryToString$2=tryToString$4,TypeError$b=global$t.TypeError,aConstructor$2=function(e){if(isConstructor$3(e))return e;throw TypeError$b(tryToString$2(e)+" is not a constructor")},objectDefineProperties={},internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$3,objectKeys$4=Object.keys||function(e){return internalObjectKeys(e,enumBugKeys$1)},DESCRIPTORS$b=descriptors,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,definePropertyModule$3=objectDefineProperty,anObject$g=anObject$j,toIndexedObject$6=toIndexedObject$b,objectKeys$3=objectKeys$4;objectDefineProperties.f=DESCRIPTORS$b&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function(e,t){anObject$g(e);for(var n,r=toIndexedObject$6(t),a=objectKeys$3(t),i=a.length,o=0;i>o;)definePropertyModule$3.f(e,n=a[o++],r[n]);return e};var getBuiltIn$3=getBuiltIn$8,html$1=getBuiltIn$3("document","documentElement"),anObject$f=anObject$j,definePropertiesModule$1=objectDefineProperties,enumBugKeys=enumBugKeys$3,hiddenKeys$2=hiddenKeys$6,html=html$1,documentCreateElement$1=documentCreateElement$2,sharedKey$1=sharedKey$4,GT=">",LT="<",PROTOTYPE$1="prototype",SCRIPT="script",IE_PROTO=sharedKey$1("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return LT+SCRIPT+GT+e+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=documentCreateElement$1("iframe"),n="java"+SCRIPT+":";return t.style.display="none",html.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},activeXDocument,NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var e=enumBugKeys.length;e--;)delete NullProtoObject[PROTOTYPE$1][enumBugKeys[e]];return NullProtoObject()};hiddenKeys$2[IE_PROTO]=!0;var objectCreate=Object.create||function(e,t){var n;return null!==e?(EmptyConstructor[PROTOTYPE$1]=anObject$f(e),n=new EmptyConstructor,EmptyConstructor[PROTOTYPE$1]=null,n[IE_PROTO]=e):n=NullProtoObject(),void 0===t?n:definePropertiesModule$1.f(n,t)},$$L=_export,getBuiltIn$2=getBuiltIn$8,apply$3=functionApply,bind$8=functionBind,aConstructor$1=aConstructor$2,anObject$e=anObject$j,isObject$e=isObject$m,create$4=objectCreate,fails$p=fails$B,nativeConstruct=getBuiltIn$2("Reflect","construct"),ObjectPrototype$1=Object.prototype,push$6=[].push,NEW_TARGET_BUG=fails$p((function(){function e(){}return!(nativeConstruct((function(){}),[],e)instanceof e)})),ARGS_BUG=!fails$p((function(){nativeConstruct((function(){}))})),FORCED$6=NEW_TARGET_BUG||ARGS_BUG;$$L({target:"Reflect",stat:!0,forced:FORCED$6,sham:FORCED$6},{construct:function(e,t){aConstructor$1(e),anObject$e(t);var n=arguments.length<3?e:aConstructor$1(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return apply$3(push$6,r,t),new(apply$3(bind$8,e,r))}var a=n.prototype,i=create$4(isObject$e(a)?a:ObjectPrototype$1),o=apply$3(e,i,t);return isObject$e(o)?o:i}});var classof$4=classofRaw$1,isArray$7=Array.isArray||function(e){return"Array"==classof$4(e)},fails$o=fails$B,wellKnownSymbol$i=wellKnownSymbol$o,V8_VERSION$1=engineV8Version,SPECIES$5=wellKnownSymbol$i("species"),arrayMethodHasSpeciesSupport$5=function(e){return V8_VERSION$1>=51||!fails$o((function(){var t=[];return(t.constructor={})[SPECIES$5]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},$$K=_export,global$s=global$U,isArray$6=isArray$7,isConstructor$2=isConstructor$4,isObject$d=isObject$m,toAbsoluteIndex$3=toAbsoluteIndex$6,lengthOfArrayLike$8=lengthOfArrayLike$b,toIndexedObject$5=toIndexedObject$b,createProperty$3=createProperty$5,wellKnownSymbol$h=wellKnownSymbol$o,arrayMethodHasSpeciesSupport$4=arrayMethodHasSpeciesSupport$5,un$Slice=arraySlice$5,HAS_SPECIES_SUPPORT$3=arrayMethodHasSpeciesSupport$4("slice"),SPECIES$4=wellKnownSymbol$h("species"),Array$3=global$s.Array,max$2=Math.max;$$K({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$3},{slice:function(e,t){var n,r,a,i=toIndexedObject$5(this),o=lengthOfArrayLike$8(i),s=toAbsoluteIndex$3(e,o),l=toAbsoluteIndex$3(void 0===t?o:t,o);if(isArray$6(i)&&(n=i.constructor,(isConstructor$2(n)&&(n===Array$3||isArray$6(n.prototype))||isObject$d(n)&&null===(n=n[SPECIES$4]))&&(n=void 0),n===Array$3||void 0===n))return un$Slice(i,s,l);for(r=new(void 0===n?Array$3:n)(max$2(l-s,0)),a=0;s<l;s++,a++)s in i&&createProperty$3(r,a,i[s]);return r.length=a,r}});var DESCRIPTORS$a=descriptors,FUNCTION_NAME_EXISTS=functionName$1.EXISTS,uncurryThis$u=functionUncurryThis,defineProperty$9=objectDefineProperty.f,FunctionPrototype=Function.prototype,functionToString=uncurryThis$u(FunctionPrototype.toString),nameRE=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,regExpExec$1=uncurryThis$u(nameRE.exec),NAME$1="name";DESCRIPTORS$a&&!FUNCTION_NAME_EXISTS&&defineProperty$9(FunctionPrototype,NAME$1,{configurable:!0,get:function(){try{return regExpExec$1(nameRE,functionToString(this))[1]}catch(e){return""}}});var uncurryThis$t=functionUncurryThis,aCallable$3=aCallable$6,NATIVE_BIND=functionBindNative,bind$7=uncurryThis$t(uncurryThis$t.bind),functionBindContext=function(e,t){return aCallable$3(e),void 0===t?e:NATIVE_BIND?bind$7(e,t):function(){return e.apply(t,arguments)}},call$b=functionCall,anObject$d=anObject$j,getMethod$3=getMethod$5,iteratorClose$2=function(e,t,n){var r,a;anObject$d(e);try{if(!(r=getMethod$3(e,"return"))){if("throw"===t)throw n;return n}r=call$b(r,e)}catch(e){a=!0,r=e}if("throw"===t)throw n;if(a)throw r;return anObject$d(r),n},anObject$c=anObject$j,iteratorClose$1=iteratorClose$2,callWithSafeIterationClosing$1=function(e,t,n,r){try{return r?t(anObject$c(n)[0],n[1]):t(n)}catch(t){iteratorClose$1(e,"throw",t)}},iterators={},wellKnownSymbol$g=wellKnownSymbol$o,Iterators$4=iterators,ITERATOR$5=wellKnownSymbol$g("iterator"),ArrayPrototype$1=Array.prototype,isArrayIteratorMethod$2=function(e){return void 0!==e&&(Iterators$4.Array===e||ArrayPrototype$1[ITERATOR$5]===e)},classof$3=classof$9,getMethod$2=getMethod$5,Iterators$3=iterators,wellKnownSymbol$f=wellKnownSymbol$o,ITERATOR$4=wellKnownSymbol$f("iterator"),getIteratorMethod$3=function(e){if(null!=e)return getMethod$2(e,ITERATOR$4)||getMethod$2(e,"@@iterator")||Iterators$3[classof$3(e)]},global$r=global$U,call$a=functionCall,aCallable$2=aCallable$6,anObject$b=anObject$j,tryToString$1=tryToString$4,getIteratorMethod$2=getIteratorMethod$3,TypeError$a=global$r.TypeError,getIterator$2=function(e,t){var n=arguments.length<2?getIteratorMethod$2(e):t;if(aCallable$2(n))return anObject$b(call$a(n,e));throw TypeError$a(tryToString$1(e)+" is not iterable")},global$q=global$U,bind$6=functionBindContext,call$9=functionCall,toObject$a=toObject$e,callWithSafeIterationClosing=callWithSafeIterationClosing$1,isArrayIteratorMethod$1=isArrayIteratorMethod$2,isConstructor$1=isConstructor$4,lengthOfArrayLike$7=lengthOfArrayLike$b,createProperty$2=createProperty$5,getIterator$1=getIterator$2,getIteratorMethod$1=getIteratorMethod$3,Array$2=global$q.Array,arrayFrom=function(e){var t=toObject$a(e),n=isConstructor$1(this),r=arguments.length,a=r>1?arguments[1]:void 0,i=void 0!==a;i&&(a=bind$6(a,r>2?arguments[2]:void 0));var o,s,l,u,c,p,d=getIteratorMethod$1(t),m=0;if(!d||this==Array$2&&isArrayIteratorMethod$1(d))for(o=lengthOfArrayLike$7(t),s=n?new this(o):Array$2(o);o>m;m++)p=i?a(t[m],m):t[m],createProperty$2(s,m,p);else for(c=(u=getIterator$1(t,d)).next,s=n?new this:[];!(l=call$9(c,u)).done;m++)p=i?callWithSafeIterationClosing(u,a,[l.value,m],!0):l.value,createProperty$2(s,m,p);return s.length=m,s},wellKnownSymbol$e=wellKnownSymbol$o,ITERATOR$3=wellKnownSymbol$e("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$3]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration$2=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var n=!1;try{var r={};r[ITERATOR$3]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},$$J=_export,from=arrayFrom,checkCorrectnessOfIteration$1=checkCorrectnessOfIteration$2,INCORRECT_ITERATION=!checkCorrectnessOfIteration$1((function(e){Array.from(e)}));$$J({target:"Array",stat:!0,forced:INCORRECT_ITERATION},{from:from});var uncurryThis$s=functionUncurryThis,toIntegerOrInfinity$4=toIntegerOrInfinity$7,toString$d=toString$g,requireObjectCoercible$7=requireObjectCoercible$b,charAt$5=uncurryThis$s("".charAt),charCodeAt$1=uncurryThis$s("".charCodeAt),stringSlice$8=uncurryThis$s("".slice),createMethod$5=function(e){return function(t,n){var r,a,i=toString$d(requireObjectCoercible$7(t)),o=toIntegerOrInfinity$4(n),s=i.length;return o<0||o>=s?e?"":void 0:(r=charCodeAt$1(i,o))<55296||r>56319||o+1===s||(a=charCodeAt$1(i,o+1))<56320||a>57343?e?charAt$5(i,o):r:e?stringSlice$8(i,o,o+2):a-56320+(r-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$5(!1),charAt:createMethod$5(!0)},fails$n=fails$B,isCallable$8=isCallable$l,getPrototypeOf$2=objectGetPrototypeOf,redefine$8=redefine$b.exports,wellKnownSymbol$d=wellKnownSymbol$o,ITERATOR$2=wellKnownSymbol$d("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$2(getPrototypeOf$2(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=null==IteratorPrototype$2||fails$n((function(){var e={};return IteratorPrototype$2[ITERATOR$2].call(e)!==e}));NEW_ITERATOR_PROTOTYPE&&(IteratorPrototype$2={}),isCallable$8(IteratorPrototype$2[ITERATOR$2])||redefine$8(IteratorPrototype$2,ITERATOR$2,(function(){return this}));var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},defineProperty$8=objectDefineProperty.f,hasOwn$8=hasOwnProperty_1,wellKnownSymbol$c=wellKnownSymbol$o,TO_STRING_TAG$1=wellKnownSymbol$c("toStringTag"),setToStringTag$4=function(e,t,n){e&&!n&&(e=e.prototype),e&&!hasOwn$8(e,TO_STRING_TAG$1)&&defineProperty$8(e,TO_STRING_TAG$1,{configurable:!0,value:t})},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$3=objectCreate,createPropertyDescriptor$1=createPropertyDescriptor$5,setToStringTag$3=setToStringTag$4,Iterators$2=iterators,returnThis$1=function(){return this},createIteratorConstructor$1=function(e,t,n,r){var a=t+" Iterator";return e.prototype=create$3(IteratorPrototype$1,{next:createPropertyDescriptor$1(+!r,n)}),setToStringTag$3(e,a,!1),Iterators$2[a]=returnThis$1,e},global$p=global$U,isCallable$7=isCallable$l,String$2=global$p.String,TypeError$9=global$p.TypeError,aPossiblePrototype$1=function(e){if("object"==typeof e||isCallable$7(e))return e;throw TypeError$9("Can't set "+String$2(e)+" as a prototype")},uncurryThis$r=functionUncurryThis,anObject$a=anObject$j,aPossiblePrototype=aPossiblePrototype$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=uncurryThis$r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return anObject$a(n),aPossiblePrototype(r),t?e(n,r):n.__proto__=r,n}}():void 0),$$I=_export,call$8=functionCall,FunctionName=functionName$1,isCallable$6=isCallable$l,createIteratorConstructor=createIteratorConstructor$1,getPrototypeOf$1=objectGetPrototypeOf,setPrototypeOf$1=objectSetPrototypeOf,setToStringTag$2=setToStringTag$4,createNonEnumerableProperty$4=createNonEnumerableProperty$8,redefine$7=redefine$b.exports,wellKnownSymbol$b=wellKnownSymbol$o,Iterators$1=iterators,IteratorsCore=iteratorsCore,PROPER_FUNCTION_NAME$2=FunctionName.PROPER,CONFIGURABLE_FUNCTION_NAME=FunctionName.CONFIGURABLE,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$1=wellKnownSymbol$b("iterator"),KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},defineIterator$3=function(e,t,n,r,a,i,o){createIteratorConstructor(n,t,r);var s,l,u,c=function(e){if(e===a&&h)return h;if(!BUGGY_SAFARI_ITERATORS&&e in m)return m[e];switch(e){case KEYS:case VALUES:case ENTRIES:return function(){return new n(this,e)}}return function(){return new n(this)}},p=t+" Iterator",d=!1,m=e.prototype,f=m[ITERATOR$1]||m["@@iterator"]||a&&m[a],h=!BUGGY_SAFARI_ITERATORS&&f||c(a),y="Array"==t&&m.entries||f;if(y&&(s=getPrototypeOf$1(y.call(new e)))!==Object.prototype&&s.next&&(getPrototypeOf$1(s)!==IteratorPrototype&&(setPrototypeOf$1?setPrototypeOf$1(s,IteratorPrototype):isCallable$6(s[ITERATOR$1])||redefine$7(s,ITERATOR$1,returnThis)),setToStringTag$2(s,p,!0)),PROPER_FUNCTION_NAME$2&&a==VALUES&&f&&f.name!==VALUES&&(CONFIGURABLE_FUNCTION_NAME?createNonEnumerableProperty$4(m,"name",VALUES):(d=!0,h=function(){return call$8(f,this)})),a)if(l={values:c(VALUES),keys:i?h:c(KEYS),entries:c(ENTRIES)},o)for(u in l)(BUGGY_SAFARI_ITERATORS||d||!(u in m))&&redefine$7(m,u,l[u]);else $$I({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||d},l);return m[ITERATOR$1]!==h&&redefine$7(m,ITERATOR$1,h,{name:a}),Iterators$1[t]=h,l},charAt$4=stringMultibyte.charAt,toString$c=toString$g,InternalStateModule$4=internalState,defineIterator$2=defineIterator$3,STRING_ITERATOR="String Iterator",setInternalState$4=InternalStateModule$4.set,getInternalState$3=InternalStateModule$4.getterFor(STRING_ITERATOR);defineIterator$2(String,"String",(function(e){setInternalState$4(this,{type:STRING_ITERATOR,string:toString$c(e),index:0})}),(function(){var e,t=getInternalState$3(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=charAt$4(n,r),t.index+=e.length,{value:e,done:!1})}));var anObject$9=anObject$j,regexpFlags$1=function(){var e=anObject$9(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},fails$m=fails$B,global$o=global$U,$RegExp$2=global$o.RegExp,UNSUPPORTED_Y$3=fails$m((function(){var e=$RegExp$2("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),MISSED_STICKY$1=UNSUPPORTED_Y$3||fails$m((function(){return!$RegExp$2("a","y").sticky})),BROKEN_CARET=UNSUPPORTED_Y$3||fails$m((function(){var e=$RegExp$2("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),regexpStickyHelpers={BROKEN_CARET:BROKEN_CARET,MISSED_STICKY:MISSED_STICKY$1,UNSUPPORTED_Y:UNSUPPORTED_Y$3},fails$l=fails$B,global$n=global$U,$RegExp$1=global$n.RegExp,regexpUnsupportedDotAll=fails$l((function(){var e=$RegExp$1(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),fails$k=fails$B,global$m=global$U,$RegExp=global$m.RegExp,regexpUnsupportedNcg=fails$k((function(){var e=$RegExp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),call$7=functionCall,uncurryThis$q=functionUncurryThis,toString$b=toString$g,regexpFlags=regexpFlags$1,stickyHelpers$2=regexpStickyHelpers,shared$1=shared$5.exports,create$2=objectCreate,getInternalState$2=internalState.get,UNSUPPORTED_DOT_ALL$1=regexpUnsupportedDotAll,UNSUPPORTED_NCG$1=regexpUnsupportedNcg,nativeReplace=shared$1("native-string-replace",String.prototype.replace),nativeExec=RegExp.prototype.exec,patchedExec=nativeExec,charAt$3=uncurryThis$q("".charAt),indexOf$1=uncurryThis$q("".indexOf),replace$4=uncurryThis$q("".replace),stringSlice$7=uncurryThis$q("".slice),UPDATES_LAST_INDEX_WRONG=function(){var e=/a/,t=/b*/g;return call$7(nativeExec,e,"a"),call$7(nativeExec,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),UNSUPPORTED_Y$2=stickyHelpers$2.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y$2||UNSUPPORTED_DOT_ALL$1||UNSUPPORTED_NCG$1;PATCH&&(patchedExec=function(e){var t,n,r,a,i,o,s,l=this,u=getInternalState$2(l),c=toString$b(e),p=u.raw;if(p)return p.lastIndex=l.lastIndex,t=call$7(patchedExec,p,c),l.lastIndex=p.lastIndex,t;var d=u.groups,m=UNSUPPORTED_Y$2&&l.sticky,f=call$7(regexpFlags,l),h=l.source,y=0,b=c;if(m&&(f=replace$4(f,"y",""),-1===indexOf$1(f,"g")&&(f+="g"),b=stringSlice$7(c,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==charAt$3(c,l.lastIndex-1))&&(h="(?: "+h+")",b=" "+b,y++),n=new RegExp("^(?:"+h+")",f)),NPCG_INCLUDED&&(n=new RegExp("^"+h+"$(?!\\s)",f)),UPDATES_LAST_INDEX_WRONG&&(r=l.lastIndex),a=call$7(nativeExec,m?n:l,b),m?a?(a.input=stringSlice$7(a.input,y),a[0]=stringSlice$7(a[0],y),a.index=l.lastIndex,l.lastIndex+=a[0].length):l.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&a&&(l.lastIndex=l.global?a.index+a[0].length:r),NPCG_INCLUDED&&a&&a.length>1&&call$7(nativeReplace,a[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(a[i]=void 0)})),a&&d)for(a.groups=o=create$2(null),i=0;i<d.length;i++)o[(s=d[i])[0]]=a[s[1]];return a});var regexpExec$3=patchedExec,$$H=_export,exec$2=regexpExec$3;$$H({target:"RegExp",proto:!0,forced:/./.exec!==exec$2},{exec:exec$2});var wellKnownSymbolWrapped={},wellKnownSymbol$a=wellKnownSymbol$o;wellKnownSymbolWrapped.f=wellKnownSymbol$a;var global$l=global$U,path$1=global$l,path=path$1,hasOwn$7=hasOwnProperty_1,wrappedWellKnownSymbolModule$1=wellKnownSymbolWrapped,defineProperty$7=objectDefineProperty.f,defineWellKnownSymbol$2=function(e){var t=path.Symbol||(path.Symbol={});hasOwn$7(t,e)||defineProperty$7(t,e,{value:wrappedWellKnownSymbolModule$1.f(e)})},global$k=global$U,isArray$5=isArray$7,isConstructor=isConstructor$4,isObject$c=isObject$m,wellKnownSymbol$9=wellKnownSymbol$o,SPECIES$3=wellKnownSymbol$9("species"),Array$1=global$k.Array,arraySpeciesConstructor$1=function(e){var t;return isArray$5(e)&&(t=e.constructor,(isConstructor(t)&&(t===Array$1||isArray$5(t.prototype))||isObject$c(t)&&null===(t=t[SPECIES$3]))&&(t=void 0)),void 0===t?Array$1:t},arraySpeciesConstructor=arraySpeciesConstructor$1,arraySpeciesCreate$3=function(e,t){return new(arraySpeciesConstructor(e))(0===t?0:t)},bind$5=functionBindContext,uncurryThis$p=functionUncurryThis,IndexedObject$3=indexedObject,toObject$9=toObject$e,lengthOfArrayLike$6=lengthOfArrayLike$b,arraySpeciesCreate$2=arraySpeciesCreate$3,push$5=uncurryThis$p([].push),createMethod$4=function(e){var t=1==e,n=2==e,r=3==e,a=4==e,i=6==e,o=7==e,s=5==e||i;return function(l,u,c,p){for(var d,m,f=toObject$9(l),h=IndexedObject$3(f),y=bind$5(u,c),b=lengthOfArrayLike$6(h),g=0,v=p||arraySpeciesCreate$2,T=t?v(l,b):n||o?v(l,0):void 0;b>g;g++)if((s||g in h)&&(m=y(d=h[g],g,f),e))if(t)T[g]=m;else if(m)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:push$5(T,d)}else switch(e){case 4:return!1;case 7:push$5(T,d)}return i?-1:r||a?a:T}},arrayIteration={forEach:createMethod$4(0),map:createMethod$4(1),filter:createMethod$4(2),some:createMethod$4(3),every:createMethod$4(4),find:createMethod$4(5),findIndex:createMethod$4(6),filterReject:createMethod$4(7)},$$G=_export,global$j=global$U,getBuiltIn$1=getBuiltIn$8,apply$2=functionApply,call$6=functionCall,uncurryThis$o=functionUncurryThis,DESCRIPTORS$9=descriptors,NATIVE_SYMBOL$1=nativeSymbol,fails$j=fails$B,hasOwn$6=hasOwnProperty_1,isArray$4=isArray$7,isCallable$5=isCallable$l,isObject$b=isObject$m,isPrototypeOf$6=objectIsPrototypeOf,isSymbol$1=isSymbol$4,anObject$8=anObject$j,toObject$8=toObject$e,toIndexedObject$4=toIndexedObject$b,toPropertyKey=toPropertyKey$4,$toString$1=toString$g,createPropertyDescriptor=createPropertyDescriptor$5,nativeObjectCreate=objectCreate,objectKeys$2=objectKeys$4,getOwnPropertyNamesModule$1=objectGetOwnPropertyNames,getOwnPropertyNamesExternal=objectGetOwnPropertyNamesExternal,getOwnPropertySymbolsModule$1=objectGetOwnPropertySymbols,getOwnPropertyDescriptorModule$1=objectGetOwnPropertyDescriptor,definePropertyModule$2=objectDefineProperty,definePropertiesModule=objectDefineProperties,propertyIsEnumerableModule$1=objectPropertyIsEnumerable,arraySlice$3=arraySlice$5,redefine$6=redefine$b.exports,shared=shared$5.exports,sharedKey=sharedKey$4,hiddenKeys$1=hiddenKeys$6,uid$1=uid$4,wellKnownSymbol$8=wellKnownSymbol$o,wrappedWellKnownSymbolModule=wellKnownSymbolWrapped,defineWellKnownSymbol$1=defineWellKnownSymbol$2,setToStringTag$1=setToStringTag$4,InternalStateModule$3=internalState,$forEach$1=arrayIteration.forEach,HIDDEN=sharedKey("hidden"),SYMBOL="Symbol",PROTOTYPE="prototype",TO_PRIMITIVE=wellKnownSymbol$8("toPrimitive"),setInternalState$3=InternalStateModule$3.set,getInternalState$1=InternalStateModule$3.getterFor(SYMBOL),ObjectPrototype=Object[PROTOTYPE],$Symbol=global$j.Symbol,SymbolPrototype$1=$Symbol&&$Symbol[PROTOTYPE],TypeError$8=global$j.TypeError,QObject=global$j.QObject,$stringify=getBuiltIn$1("JSON","stringify"),nativeGetOwnPropertyDescriptor$1=getOwnPropertyDescriptorModule$1.f,nativeDefineProperty=definePropertyModule$2.f,nativeGetOwnPropertyNames=getOwnPropertyNamesExternal.f,nativePropertyIsEnumerable=propertyIsEnumerableModule$1.f,push$4=uncurryThis$o([].push),AllSymbols=shared("symbols"),ObjectPrototypeSymbols=shared("op-symbols"),StringToSymbolRegistry=shared("string-to-symbol-registry"),SymbolToStringRegistry=shared("symbol-to-string-registry"),WellKnownSymbolsStore=shared("wks"),USE_SETTER=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild,setSymbolDescriptor=DESCRIPTORS$9&&fails$j((function(){return 7!=nativeObjectCreate(nativeDefineProperty({},"a",{get:function(){return nativeDefineProperty(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=nativeGetOwnPropertyDescriptor$1(ObjectPrototype,t);r&&delete ObjectPrototype[t],nativeDefineProperty(e,t,n),r&&e!==ObjectPrototype&&nativeDefineProperty(ObjectPrototype,t,r)}:nativeDefineProperty,wrap=function(e,t){var n=AllSymbols[e]=nativeObjectCreate(SymbolPrototype$1);return setInternalState$3(n,{type:SYMBOL,tag:e,description:t}),DESCRIPTORS$9||(n.description=t),n},$defineProperty=function(e,t,n){e===ObjectPrototype&&$defineProperty(ObjectPrototypeSymbols,t,n),anObject$8(e);var r=toPropertyKey(t);return anObject$8(n),hasOwn$6(AllSymbols,r)?(n.enumerable?(hasOwn$6(e,HIDDEN)&&e[HIDDEN][r]&&(e[HIDDEN][r]=!1),n=nativeObjectCreate(n,{enumerable:createPropertyDescriptor(0,!1)})):(hasOwn$6(e,HIDDEN)||nativeDefineProperty(e,HIDDEN,createPropertyDescriptor(1,{})),e[HIDDEN][r]=!0),setSymbolDescriptor(e,r,n)):nativeDefineProperty(e,r,n)},$defineProperties=function(e,t){anObject$8(e);var n=toIndexedObject$4(t),r=objectKeys$2(n).concat($getOwnPropertySymbols(n));return $forEach$1(r,(function(t){DESCRIPTORS$9&&!call$6($propertyIsEnumerable$1,n,t)||$defineProperty(e,t,n[t])})),e},$create=function(e,t){return void 0===t?nativeObjectCreate(e):$defineProperties(nativeObjectCreate(e),t)},$propertyIsEnumerable$1=function(e){var t=toPropertyKey(e),n=call$6(nativePropertyIsEnumerable,this,t);return!(this===ObjectPrototype&&hasOwn$6(AllSymbols,t)&&!hasOwn$6(ObjectPrototypeSymbols,t))&&(!(n||!hasOwn$6(this,t)||!hasOwn$6(AllSymbols,t)||hasOwn$6(this,HIDDEN)&&this[HIDDEN][t])||n)},$getOwnPropertyDescriptor=function(e,t){var n=toIndexedObject$4(e),r=toPropertyKey(t);if(n!==ObjectPrototype||!hasOwn$6(AllSymbols,r)||hasOwn$6(ObjectPrototypeSymbols,r)){var a=nativeGetOwnPropertyDescriptor$1(n,r);return!a||!hasOwn$6(AllSymbols,r)||hasOwn$6(n,HIDDEN)&&n[HIDDEN][r]||(a.enumerable=!0),a}},$getOwnPropertyNames=function(e){var t=nativeGetOwnPropertyNames(toIndexedObject$4(e)),n=[];return $forEach$1(t,(function(e){hasOwn$6(AllSymbols,e)||hasOwn$6(hiddenKeys$1,e)||push$4(n,e)})),n},$getOwnPropertySymbols=function(e){var t=e===ObjectPrototype,n=nativeGetOwnPropertyNames(t?ObjectPrototypeSymbols:toIndexedObject$4(e)),r=[];return $forEach$1(n,(function(e){!hasOwn$6(AllSymbols,e)||t&&!hasOwn$6(ObjectPrototype,e)||push$4(r,AllSymbols[e])})),r};if(NATIVE_SYMBOL$1||($Symbol=function(){if(isPrototypeOf$6(SymbolPrototype$1,this))throw TypeError$8("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?$toString$1(arguments[0]):void 0,t=uid$1(e),n=function(e){this===ObjectPrototype&&call$6(n,ObjectPrototypeSymbols,e),hasOwn$6(this,HIDDEN)&&hasOwn$6(this[HIDDEN],t)&&(this[HIDDEN][t]=!1),setSymbolDescriptor(this,t,createPropertyDescriptor(1,e))};return DESCRIPTORS$9&&USE_SETTER&&setSymbolDescriptor(ObjectPrototype,t,{configurable:!0,set:n}),wrap(t,e)},SymbolPrototype$1=$Symbol[PROTOTYPE],redefine$6(SymbolPrototype$1,"toString",(function(){return getInternalState$1(this).tag})),redefine$6($Symbol,"withoutSetter",(function(e){return wrap(uid$1(e),e)})),propertyIsEnumerableModule$1.f=$propertyIsEnumerable$1,definePropertyModule$2.f=$defineProperty,definePropertiesModule.f=$defineProperties,getOwnPropertyDescriptorModule$1.f=$getOwnPropertyDescriptor,getOwnPropertyNamesModule$1.f=getOwnPropertyNamesExternal.f=$getOwnPropertyNames,getOwnPropertySymbolsModule$1.f=$getOwnPropertySymbols,wrappedWellKnownSymbolModule.f=function(e){return wrap(wellKnownSymbol$8(e),e)},DESCRIPTORS$9&&(nativeDefineProperty(SymbolPrototype$1,"description",{configurable:!0,get:function(){return getInternalState$1(this).description}}),redefine$6(ObjectPrototype,"propertyIsEnumerable",$propertyIsEnumerable$1,{unsafe:!0}))),$$G({global:!0,wrap:!0,forced:!NATIVE_SYMBOL$1,sham:!NATIVE_SYMBOL$1},{Symbol:$Symbol}),$forEach$1(objectKeys$2(WellKnownSymbolsStore),(function(e){defineWellKnownSymbol$1(e)})),$$G({target:SYMBOL,stat:!0,forced:!NATIVE_SYMBOL$1},{for:function(e){var t=$toString$1(e);if(hasOwn$6(StringToSymbolRegistry,t))return StringToSymbolRegistry[t];var n=$Symbol(t);return StringToSymbolRegistry[t]=n,SymbolToStringRegistry[n]=t,n},keyFor:function(e){if(!isSymbol$1(e))throw TypeError$8(e+" is not a symbol");if(hasOwn$6(SymbolToStringRegistry,e))return SymbolToStringRegistry[e]},useSetter:function(){USE_SETTER=!0},useSimple:function(){USE_SETTER=!1}}),$$G({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$1,sham:!DESCRIPTORS$9},{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor}),$$G({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$1},{getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols}),$$G({target:"Object",stat:!0,forced:fails$j((function(){getOwnPropertySymbolsModule$1.f(1)}))},{getOwnPropertySymbols:function(e){return getOwnPropertySymbolsModule$1.f(toObject$8(e))}}),$stringify){var FORCED_JSON_STRINGIFY=!NATIVE_SYMBOL$1||fails$j((function(){var e=$Symbol();return"[null]"!=$stringify([e])||"{}"!=$stringify({a:e})||"{}"!=$stringify(Object(e))}));$$G({target:"JSON",stat:!0,forced:FORCED_JSON_STRINGIFY},{stringify:function(e,t,n){var r=arraySlice$3(arguments),a=t;if((isObject$b(t)||void 0!==e)&&!isSymbol$1(e))return isArray$4(t)||(t=function(e,t){if(isCallable$5(a)&&(t=call$6(a,this,e,t)),!isSymbol$1(t))return t}),r[1]=t,apply$2($stringify,null,r)}})}if(!SymbolPrototype$1[TO_PRIMITIVE]){var valueOf=SymbolPrototype$1.valueOf;redefine$6(SymbolPrototype$1,TO_PRIMITIVE,(function(e){return call$6(valueOf,this)}))}setToStringTag$1($Symbol,SYMBOL),hiddenKeys$1[HIDDEN]=!0;var $$F=_export,DESCRIPTORS$8=descriptors,global$i=global$U,uncurryThis$n=functionUncurryThis,hasOwn$5=hasOwnProperty_1,isCallable$4=isCallable$l,isPrototypeOf$5=objectIsPrototypeOf,toString$a=toString$g,defineProperty$6=objectDefineProperty.f,copyConstructorProperties=copyConstructorProperties$2,NativeSymbol=global$i.Symbol,SymbolPrototype=NativeSymbol&&NativeSymbol.prototype;if(DESCRIPTORS$8&&isCallable$4(NativeSymbol)&&(!("description"in SymbolPrototype)||void 0!==NativeSymbol().description)){var EmptyStringDescriptionStore={},SymbolWrapper=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:toString$a(arguments[0]),t=isPrototypeOf$5(SymbolPrototype,this)?new NativeSymbol(e):void 0===e?NativeSymbol():NativeSymbol(e);return""===e&&(EmptyStringDescriptionStore[t]=!0),t};copyConstructorProperties(SymbolWrapper,NativeSymbol),SymbolWrapper.prototype=SymbolPrototype,SymbolPrototype.constructor=SymbolWrapper;var NATIVE_SYMBOL="Symbol(test)"==String(NativeSymbol("test")),symbolToString=uncurryThis$n(SymbolPrototype.toString),symbolValueOf=uncurryThis$n(SymbolPrototype.valueOf),regexp=/^Symbol\((.*)\)[^)]+$/,replace$3=uncurryThis$n("".replace),stringSlice$6=uncurryThis$n("".slice);defineProperty$6(SymbolPrototype,"description",{configurable:!0,get:function(){var e=symbolValueOf(this),t=symbolToString(e);if(hasOwn$5(EmptyStringDescriptionStore,e))return"";var n=NATIVE_SYMBOL?stringSlice$6(t,7,-1):replace$3(t,regexp,"$1");return""===n?void 0:n}}),$$F({global:!0,forced:!0},{Symbol:SymbolWrapper})}var defineWellKnownSymbol=defineWellKnownSymbol$2;defineWellKnownSymbol("iterator");var wellKnownSymbol$7=wellKnownSymbol$o,create$1=objectCreate,definePropertyModule$1=objectDefineProperty,UNSCOPABLES=wellKnownSymbol$7("unscopables"),ArrayPrototype=Array.prototype;null==ArrayPrototype[UNSCOPABLES]&&definePropertyModule$1.f(ArrayPrototype,UNSCOPABLES,{configurable:!0,value:create$1(null)});var addToUnscopables$5=function(e){ArrayPrototype[UNSCOPABLES][e]=!0},toIndexedObject$3=toIndexedObject$b,addToUnscopables$4=addToUnscopables$5,Iterators=iterators,InternalStateModule$2=internalState,defineProperty$5=objectDefineProperty.f,defineIterator$1=defineIterator$3,DESCRIPTORS$7=descriptors,ARRAY_ITERATOR="Array Iterator",setInternalState$2=InternalStateModule$2.set,getInternalState=InternalStateModule$2.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator$1(Array,"Array",(function(e,t){setInternalState$2(this,{type:ARRAY_ITERATOR,target:toIndexedObject$3(e),index:0,kind:t})}),(function(){var e=getInternalState(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),values$1=Iterators.Arguments=Iterators.Array;if(addToUnscopables$4("keys"),addToUnscopables$4("values"),addToUnscopables$4("entries"),DESCRIPTORS$7&&"values"!==values$1.name)try{defineProperty$5(values$1,"name",{value:"values"})}catch(e){}var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},documentCreateElement=documentCreateElement$2,classList=documentCreateElement("span").classList,DOMTokenListPrototype$2=classList&&classList.constructor&&classList.constructor.prototype,domTokenListPrototype=DOMTokenListPrototype$2===Object.prototype?void 0:DOMTokenListPrototype$2,global$h=global$U,DOMIterables$1=domIterables,DOMTokenListPrototype$1=domTokenListPrototype,ArrayIteratorMethods=es_array_iterator,createNonEnumerableProperty$3=createNonEnumerableProperty$8,wellKnownSymbol$6=wellKnownSymbol$o,ITERATOR=wellKnownSymbol$6("iterator"),TO_STRING_TAG=wellKnownSymbol$6("toStringTag"),ArrayValues=ArrayIteratorMethods.values,handlePrototype$1=function(e,t){if(e){if(e[ITERATOR]!==ArrayValues)try{createNonEnumerableProperty$3(e,ITERATOR,ArrayValues)}catch(t){e[ITERATOR]=ArrayValues}if(e[TO_STRING_TAG]||createNonEnumerableProperty$3(e,TO_STRING_TAG,t),DOMIterables$1[t])for(var n in ArrayIteratorMethods)if(e[n]!==ArrayIteratorMethods[n])try{createNonEnumerableProperty$3(e,n,ArrayIteratorMethods[n])}catch(t){e[n]=ArrayIteratorMethods[n]}}};for(var COLLECTION_NAME$1 in DOMIterables$1)handlePrototype$1(global$h[COLLECTION_NAME$1]&&global$h[COLLECTION_NAME$1].prototype,COLLECTION_NAME$1);handlePrototype$1(DOMTokenListPrototype$1,"DOMTokenList");var DESCRIPTORS$6=descriptors,uncurryThis$m=functionUncurryThis,call$5=functionCall,fails$i=fails$B,objectKeys$1=objectKeys$4,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,propertyIsEnumerableModule=objectPropertyIsEnumerable,toObject$7=toObject$e,IndexedObject$2=indexedObject,$assign=Object.assign,defineProperty$4=Object.defineProperty,concat$1=uncurryThis$m([].concat),objectAssign=!$assign||fails$i((function(){if(DESCRIPTORS$6&&1!==$assign({b:1},$assign(defineProperty$4({},"a",{enumerable:!0,get:function(){defineProperty$4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=$assign({},e)[n]||objectKeys$1($assign({},t)).join("")!=r}))?function(e,t){for(var n=toObject$7(e),r=arguments.length,a=1,i=getOwnPropertySymbolsModule.f,o=propertyIsEnumerableModule.f;r>a;)for(var s,l=IndexedObject$2(arguments[a++]),u=i?concat$1(objectKeys$1(l),i(l)):objectKeys$1(l),c=u.length,p=0;c>p;)s=u[p++],DESCRIPTORS$6&&!call$5(o,l,s)||(n[s]=l[s]);return n}:$assign,$$E=_export,assign$1=objectAssign;$$E({target:"Object",stat:!0,forced:Object.assign!==assign$1},{assign:assign$1});var $$D=_export,global$g=global$U,fails$h=fails$B,isArray$3=isArray$7,isObject$a=isObject$m,toObject$6=toObject$e,lengthOfArrayLike$5=lengthOfArrayLike$b,createProperty$1=createProperty$5,arraySpeciesCreate$1=arraySpeciesCreate$3,arrayMethodHasSpeciesSupport$3=arrayMethodHasSpeciesSupport$5,wellKnownSymbol$5=wellKnownSymbol$o,V8_VERSION=engineV8Version,IS_CONCAT_SPREADABLE=wellKnownSymbol$5("isConcatSpreadable"),MAX_SAFE_INTEGER$1=9007199254740991,MAXIMUM_ALLOWED_INDEX_EXCEEDED="Maximum allowed index exceeded",TypeError$7=global$g.TypeError,IS_CONCAT_SPREADABLE_SUPPORT=V8_VERSION>=51||!fails$h((function(){var e=[];return e[IS_CONCAT_SPREADABLE]=!1,e.concat()[0]!==e})),SPECIES_SUPPORT=arrayMethodHasSpeciesSupport$3("concat"),isConcatSpreadable=function(e){if(!isObject$a(e))return!1;var t=e[IS_CONCAT_SPREADABLE];return void 0!==t?!!t:isArray$3(e)},FORCED$5=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;$$D({target:"Array",proto:!0,forced:FORCED$5},{concat:function(e){var t,n,r,a,i,o=toObject$6(this),s=arraySpeciesCreate$1(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(isConcatSpreadable(i=-1===t?o:arguments[t])){if(l+(a=lengthOfArrayLike$5(i))>MAX_SAFE_INTEGER$1)throw TypeError$7(MAXIMUM_ALLOWED_INDEX_EXCEEDED);for(n=0;n<a;n++,l++)n in i&&createProperty$1(s,l,i[n])}else{if(l>=MAX_SAFE_INTEGER$1)throw TypeError$7(MAXIMUM_ALLOWED_INDEX_EXCEEDED);createProperty$1(s,l++,i)}return s.length=l,s}});var runtime={exports:{}};!function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof y?t:y,i=Object.create(a.prototype),o=new E(r||[]);return i._invoke=function(e,t,n){var r=p;return function(a,i){if(r===m)throw new Error("Generator is already running");if(r===f){if("throw"===a)throw i;return _()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=m;var l=c(e,t,n);if("normal"===l.type){if(r=n.done?f:d,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=f,n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",d="suspendedYield",m="executing",f="completed",h={};function y(){}function b(){}function g(){}var v={};v[i]=function(){return this};var T=Object.getPrototypeOf,C=T&&T(T($([])));C&&C!==n&&r.call(C,i)&&(v=C);var N=g.prototype=y.prototype=Object.create(v);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(a,i,o,s){var l=c(e[a],e,i);if("throw"!==l.type){var u=l.arg,p=u.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(p).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(i,i):i()}}function w(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,w(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var a=c(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function V(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function $(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:_}}function _(){return{value:t,done:!0}}return b.prototype=N.constructor=g,g.constructor=b,b.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(N),e},e.awrap=function(e){return{__await:e}},A(S.prototype),S.prototype[o]=function(){return this},e.AsyncIterator=S,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new S(u(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},A(N),l(N,s,"Generator"),N[i]=function(){return this},N.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=$,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(V),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return s.type="throw",s.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),V(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;V(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:$(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(runtime);var $$C=_export,$map=arrayIteration.map,arrayMethodHasSpeciesSupport$2=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport$2("map");$$C({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2},{map:function(e){return $map(this,e,arguments.length>1?arguments[1]:void 0)}});var internalMetadata={exports:{}},fails$g=fails$B,arrayBufferNonExtensible=fails$g((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),fails$f=fails$B,isObject$9=isObject$m,classof$2=classofRaw$1,ARRAY_BUFFER_NON_EXTENSIBLE=arrayBufferNonExtensible,$isExtensible=Object.isExtensible,FAILS_ON_PRIMITIVES$2=fails$f((function(){$isExtensible(1)})),objectIsExtensible=FAILS_ON_PRIMITIVES$2||ARRAY_BUFFER_NON_EXTENSIBLE?function(e){return!!isObject$9(e)&&((!ARRAY_BUFFER_NON_EXTENSIBLE||"ArrayBuffer"!=classof$2(e))&&(!$isExtensible||$isExtensible(e)))}:$isExtensible,fails$e=fails$B,freezing=!fails$e((function(){return Object.isExtensible(Object.preventExtensions({}))})),$$B=_export,uncurryThis$l=functionUncurryThis,hiddenKeys=hiddenKeys$6,isObject$8=isObject$m,hasOwn$4=hasOwnProperty_1,defineProperty$3=objectDefineProperty.f,getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertyNamesExternalModule=objectGetOwnPropertyNamesExternal,isExtensible$1=objectIsExtensible,uid=uid$4,FREEZING=freezing,REQUIRED=!1,METADATA=uid("meta"),id$1=0,setMetadata=function(e){defineProperty$3(e,METADATA,{value:{objectID:"O"+id$1++,weakData:{}}})},fastKey$1=function(e,t){if(!isObject$8(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!hasOwn$4(e,METADATA)){if(!isExtensible$1(e))return"F";if(!t)return"E";setMetadata(e)}return e[METADATA].objectID},getWeakData$1=function(e,t){if(!hasOwn$4(e,METADATA)){if(!isExtensible$1(e))return!0;if(!t)return!1;setMetadata(e)}return e[METADATA].weakData},onFreeze=function(e){return FREEZING&&REQUIRED&&isExtensible$1(e)&&!hasOwn$4(e,METADATA)&&setMetadata(e),e},enable=function(){meta.enable=function(){},REQUIRED=!0;var e=getOwnPropertyNamesModule.f,t=uncurryThis$l([].splice),n={};n[METADATA]=1,e(n).length&&(getOwnPropertyNamesModule.f=function(n){for(var r=e(n),a=0,i=r.length;a<i;a++)if(r[a]===METADATA){t(r,a,1);break}return r},$$B({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:getOwnPropertyNamesExternalModule.f}))},meta=internalMetadata.exports={enable:enable,fastKey:fastKey$1,getWeakData:getWeakData$1,onFreeze:onFreeze};hiddenKeys[METADATA]=!0;var global$f=global$U,bind$4=functionBindContext,call$4=functionCall,anObject$7=anObject$j,tryToString=tryToString$4,isArrayIteratorMethod=isArrayIteratorMethod$2,lengthOfArrayLike$4=lengthOfArrayLike$b,isPrototypeOf$4=objectIsPrototypeOf,getIterator=getIterator$2,getIteratorMethod=getIteratorMethod$3,iteratorClose=iteratorClose$2,TypeError$6=global$f.TypeError,Result=function(e,t){this.stopped=e,this.result=t},ResultPrototype=Result.prototype,iterate$3=function(e,t,n){var r,a,i,o,s,l,u,c=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),f=bind$4(t,c),h=function(e){return r&&iteratorClose(r,"normal",e),new Result(!0,e)},y=function(e){return p?(anObject$7(e),m?f(e[0],e[1],h):f(e[0],e[1])):m?f(e,h):f(e)};if(d)r=e;else{if(!(a=getIteratorMethod(e)))throw TypeError$6(tryToString(e)+" is not iterable");if(isArrayIteratorMethod(a)){for(i=0,o=lengthOfArrayLike$4(e);o>i;i++)if((s=y(e[i]))&&isPrototypeOf$4(ResultPrototype,s))return s;return new Result(!1)}r=getIterator(e,a)}for(l=r.next;!(u=call$4(l,r)).done;){try{s=y(u.value)}catch(e){iteratorClose(r,"throw",e)}if("object"==typeof s&&s&&isPrototypeOf$4(ResultPrototype,s))return s}return new Result(!1)},global$e=global$U,isPrototypeOf$3=objectIsPrototypeOf,TypeError$5=global$e.TypeError,anInstance$3=function(e,t){if(isPrototypeOf$3(t,e))return e;throw TypeError$5("Incorrect invocation")},isCallable$3=isCallable$l,isObject$7=isObject$m,setPrototypeOf=objectSetPrototypeOf,inheritIfRequired$3=function(e,t,n){var r,a;return setPrototypeOf&&isCallable$3(r=t.constructor)&&r!==n&&isObject$7(a=r.prototype)&&a!==n.prototype&&setPrototypeOf(e,a),e},$$A=_export,global$d=global$U,uncurryThis$k=functionUncurryThis,isForced$2=isForced_1,redefine$5=redefine$b.exports,InternalMetadataModule$1=internalMetadata.exports,iterate$2=iterate$3,anInstance$2=anInstance$3,isCallable$2=isCallable$l,isObject$6=isObject$m,fails$d=fails$B,checkCorrectnessOfIteration=checkCorrectnessOfIteration$2,setToStringTag=setToStringTag$4,inheritIfRequired$2=inheritIfRequired$3,collection$3=function(e,t,n){var r=-1!==e.indexOf("Map"),a=-1!==e.indexOf("Weak"),i=r?"set":"add",o=global$d[e],s=o&&o.prototype,l=o,u={},c=function(e){var t=uncurryThis$k(s[e]);redefine$5(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(a&&!isObject$6(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return a&&!isObject$6(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!isObject$6(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(isForced$2(e,!isCallable$2(o)||!(a||s.forEach&&!fails$d((function(){(new o).entries().next()})))))l=n.getConstructor(t,e,r,i),InternalMetadataModule$1.enable();else if(isForced$2(e,!0)){var p=new l,d=p[i](a?{}:-0,1)!=p,m=fails$d((function(){p.has(1)})),f=checkCorrectnessOfIteration((function(e){new o(e)})),h=!a&&fails$d((function(){for(var e=new o,t=5;t--;)e[i](t,t);return!e.has(-0)}));f||((l=t((function(e,t){anInstance$2(e,s);var n=inheritIfRequired$2(new o,e,l);return null!=t&&iterate$2(t,n[i],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=l),(m||h)&&(c("delete"),c("has"),r&&c("get")),(h||d)&&c(i),a&&s.clear&&delete s.clear}return u[e]=l,$$A({global:!0,forced:l!=o},u),setToStringTag(l,e),a||n.setStrong(l,e,r),l},redefine$4=redefine$b.exports,redefineAll$3=function(e,t,n){for(var r in t)redefine$4(e,r,t[r],n);return e},getBuiltIn=getBuiltIn$8,definePropertyModule=objectDefineProperty,wellKnownSymbol$4=wellKnownSymbol$o,DESCRIPTORS$5=descriptors,SPECIES$2=wellKnownSymbol$4("species"),setSpecies$2=function(e){var t=getBuiltIn(e),n=definePropertyModule.f;DESCRIPTORS$5&&t&&!t[SPECIES$2]&&n(t,SPECIES$2,{configurable:!0,get:function(){return this}})},defineProperty$2=objectDefineProperty.f,create=objectCreate,redefineAll$2=redefineAll$3,bind$3=functionBindContext,anInstance$1=anInstance$3,iterate$1=iterate$3,defineIterator=defineIterator$3,setSpecies$1=setSpecies$2,DESCRIPTORS$4=descriptors,fastKey=internalMetadata.exports.fastKey,InternalStateModule$1=internalState,setInternalState$1=InternalStateModule$1.set,internalStateGetterFor$1=InternalStateModule$1.getterFor,collectionStrong$2={getConstructor:function(e,t,n,r){var a=e((function(e,a){anInstance$1(e,i),setInternalState$1(e,{type:t,index:create(null),first:void 0,last:void 0,size:0}),DESCRIPTORS$4||(e.size=0),null!=a&&iterate$1(a,e[r],{that:e,AS_ENTRIES:n})})),i=a.prototype,o=internalStateGetterFor$1(t),s=function(e,t,n){var r,a,i=o(e),s=l(e,t);return s?s.value=n:(i.last=s={index:a=fastKey(t,!0),key:t,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=s),r&&(r.next=s),DESCRIPTORS$4?i.size++:e.size++,"F"!==a&&(i.index[a]=s)),e},l=function(e,t){var n,r=o(e),a=fastKey(t);if("F"!==a)return r.index[a];for(n=r.first;n;n=n.next)if(n.key==t)return n};return redefineAll$2(i,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,DESCRIPTORS$4?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=l(t,e);if(r){var a=r.next,i=r.previous;delete n.index[r.index],r.removed=!0,i&&(i.next=a),a&&(a.previous=i),n.first==r&&(n.first=a),n.last==r&&(n.last=i),DESCRIPTORS$4?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=bind$3(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!l(this,e)}}),redefineAll$2(i,n?{get:function(e){var t=l(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),DESCRIPTORS$4&&defineProperty$2(i,"size",{get:function(){return o(this).size}}),a},setStrong:function(e,t,n){var r=t+" Iterator",a=internalStateGetterFor$1(t),i=internalStateGetterFor$1(r);defineIterator(e,t,(function(e,t){setInternalState$1(this,{type:r,target:e,state:a(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),setSpecies$1(t)}},collection$2=collection$3,collectionStrong$1=collectionStrong$2;collection$2("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong$1);var fails$c=fails$B,arrayMethodIsStrict$4=function(e,t){var n=[][e];return!!n&&fails$c((function(){n.call(null,t||function(){return 1},1)}))},$forEach=arrayIteration.forEach,arrayMethodIsStrict$3=arrayMethodIsStrict$4,STRICT_METHOD$3=arrayMethodIsStrict$3("forEach"),arrayForEach=STRICT_METHOD$3?[].forEach:function(e){return $forEach(this,e,arguments.length>1?arguments[1]:void 0)},global$c=global$U,DOMIterables=domIterables,DOMTokenListPrototype=domTokenListPrototype,forEach$2=arrayForEach,createNonEnumerableProperty$2=createNonEnumerableProperty$8,handlePrototype=function(e){if(e&&e.forEach!==forEach$2)try{createNonEnumerableProperty$2(e,"forEach",forEach$2)}catch(t){e.forEach=forEach$2}};for(var COLLECTION_NAME in DOMIterables)DOMIterables[COLLECTION_NAME]&&handlePrototype(global$c[COLLECTION_NAME]&&global$c[COLLECTION_NAME].prototype);handlePrototype(DOMTokenListPrototype);var $$z=_export,$filter=arrayIteration.filter,arrayMethodHasSpeciesSupport$1=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport$1("filter");$$z({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{filter:function(e){return $filter(this,e,arguments.length>1?arguments[1]:void 0)}});var global$b=global$U,globalIsFinite=global$b.isFinite,numberIsFinite$1=Number.isFinite||function(e){return"number"==typeof e&&globalIsFinite(e)},$$y=_export,numberIsFinite=numberIsFinite$1;$$y({target:"Number",stat:!0},{isFinite:numberIsFinite});var uncurryThis$j=functionUncurryThis,thisNumberValue$2=uncurryThis$j(1..valueOf),whitespaces$2="\t\n\v\f\r \u2028\u2029\ufeff",uncurryThis$i=functionUncurryThis,requireObjectCoercible$6=requireObjectCoercible$b,toString$9=toString$g,whitespaces$1=whitespaces$2,replace$2=uncurryThis$i("".replace),whitespace="["+whitespaces$1+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$3=function(e){return function(t){var n=toString$9(requireObjectCoercible$6(t));return 1&e&&(n=replace$2(n,ltrim,"")),2&e&&(n=replace$2(n,rtrim,"")),n}},stringTrim={start:createMethod$3(1),end:createMethod$3(2),trim:createMethod$3(3)},DESCRIPTORS$3=descriptors,global$a=global$U,uncurryThis$h=functionUncurryThis,isForced$1=isForced_1,redefine$3=redefine$b.exports,hasOwn$3=hasOwnProperty_1,inheritIfRequired$1=inheritIfRequired$3,isPrototypeOf$2=objectIsPrototypeOf,isSymbol=isSymbol$4,toPrimitive=toPrimitive$2,fails$b=fails$B,getOwnPropertyNames$1=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,defineProperty$1=objectDefineProperty.f,thisNumberValue$1=thisNumberValue$2,trim$1=stringTrim.trim,NUMBER="Number",NativeNumber=global$a[NUMBER],NumberPrototype=NativeNumber.prototype,TypeError$4=global$a.TypeError,arraySlice$2=uncurryThis$h("".slice),charCodeAt=uncurryThis$h("".charCodeAt),toNumeric=function(e){var t=toPrimitive(e,"number");return"bigint"==typeof t?t:toNumber(t)},toNumber=function(e){var t,n,r,a,i,o,s,l,u=toPrimitive(e,"number");if(isSymbol(u))throw TypeError$4("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=trim$1(u),43===(t=charCodeAt(u,0))||45===t){if(88===(n=charCodeAt(u,2))||120===n)return NaN}else if(48===t){switch(charCodeAt(u,1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+u}for(o=(i=arraySlice$2(u,2)).length,s=0;s<o;s++)if((l=charCodeAt(i,s))<48||l>a)return NaN;return parseInt(i,r)}return+u};if(isForced$1(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1"))){for(var NumberWrapper=function(e){var t=arguments.length<1?0:NativeNumber(toNumeric(e)),n=this;return isPrototypeOf$2(NumberPrototype,n)&&fails$b((function(){thisNumberValue$1(n)}))?inheritIfRequired$1(Object(t),n,NumberWrapper):t},keys$2=DESCRIPTORS$3?getOwnPropertyNames$1(NativeNumber):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),j$2=0,key;keys$2.length>j$2;j$2++)hasOwn$3(NativeNumber,key=keys$2[j$2])&&!hasOwn$3(NumberWrapper,key)&&defineProperty$1(NumberWrapper,key,getOwnPropertyDescriptor$1(NativeNumber,key));NumberWrapper.prototype=NumberPrototype,NumberPrototype.constructor=NumberWrapper,redefine$3(global$a,NUMBER,NumberWrapper)}var uncurryThis$g=functionUncurryThis,PROPER_FUNCTION_NAME$1=functionName$1.PROPER,redefine$2=redefine$b.exports,anObject$6=anObject$j,isPrototypeOf$1=objectIsPrototypeOf,$toString=toString$g,fails$a=fails$B,regExpFlags$1=regexpFlags$1,TO_STRING="toString",RegExpPrototype$2=RegExp.prototype,n$ToString=RegExpPrototype$2[TO_STRING],getFlags$1=uncurryThis$g(regExpFlags$1),NOT_GENERIC=fails$a((function(){return"/a/b"!=n$ToString.call({source:"a",flags:"b"})})),INCORRECT_NAME=PROPER_FUNCTION_NAME$1&&n$ToString.name!=TO_STRING;(NOT_GENERIC||INCORRECT_NAME)&&redefine$2(RegExp.prototype,TO_STRING,(function(){var e=anObject$6(this),t=$toString(e.source),n=e.flags;return"/"+t+"/"+$toString(void 0===n&&isPrototypeOf$1(RegExpPrototype$2,e)&&!("flags"in RegExpPrototype$2)?getFlags$1(e):n)}),{unsafe:!0});var DESCRIPTORS$2=descriptors,global$9=global$U,uncurryThis$f=functionUncurryThis,isForced=isForced_1,inheritIfRequired=inheritIfRequired$3,createNonEnumerableProperty$1=createNonEnumerableProperty$8,defineProperty=objectDefineProperty.f,getOwnPropertyNames=objectGetOwnPropertyNames.f,isPrototypeOf=objectIsPrototypeOf,isRegExp$2=isRegexp,toString$8=toString$g,regExpFlags=regexpFlags$1,stickyHelpers$1=regexpStickyHelpers,redefine$1=redefine$b.exports,fails$9=fails$B,hasOwn$2=hasOwnProperty_1,enforceInternalState$1=internalState.enforce,setSpecies=setSpecies$2,wellKnownSymbol$3=wellKnownSymbol$o,UNSUPPORTED_DOT_ALL=regexpUnsupportedDotAll,UNSUPPORTED_NCG=regexpUnsupportedNcg,MATCH=wellKnownSymbol$3("match"),NativeRegExp=global$9.RegExp,RegExpPrototype$1=NativeRegExp.prototype,SyntaxError$1=global$9.SyntaxError,getFlags=uncurryThis$f(regExpFlags),exec$1=uncurryThis$f(RegExpPrototype$1.exec),charAt$2=uncurryThis$f("".charAt),replace$1=uncurryThis$f("".replace),stringIndexOf$2=uncurryThis$f("".indexOf),stringSlice$5=uncurryThis$f("".slice),IS_NCG=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,re1=/a/g,re2=/a/g,CORRECT_NEW=new NativeRegExp(re1)!==re1,MISSED_STICKY=stickyHelpers$1.MISSED_STICKY,UNSUPPORTED_Y$1=stickyHelpers$1.UNSUPPORTED_Y,BASE_FORCED=DESCRIPTORS$2&&(!CORRECT_NEW||MISSED_STICKY||UNSUPPORTED_DOT_ALL||UNSUPPORTED_NCG||fails$9((function(){return re2[MATCH]=!1,NativeRegExp(re1)!=re1||NativeRegExp(re2)==re2||"/a/i"!=NativeRegExp(re1,"i")}))),handleDotAll=function(e){for(var t,n=e.length,r=0,a="",i=!1;r<=n;r++)"\\"!==(t=charAt$2(e,r))?i||"."!==t?("["===t?i=!0:"]"===t&&(i=!1),a+=t):a+="[\\s\\S]":a+=t+charAt$2(e,++r);return a},handleNCG=function(e){for(var t,n=e.length,r=0,a="",i=[],o={},s=!1,l=!1,u=0,c="";r<=n;r++){if("\\"===(t=charAt$2(e,r)))t+=charAt$2(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:exec$1(IS_NCG,stringSlice$5(e,r+1))&&(r+=2,l=!0),a+=t,u++;continue;case">"===t&&l:if(""===c||hasOwn$2(o,c))throw new SyntaxError$1("Invalid capture group name");o[c]=!0,i[i.length]=[c,u],l=!1,c="";continue}l?c+=t:a+=t}return[a,i]};if(isForced("RegExp",BASE_FORCED)){for(var RegExpWrapper=function(e,t){var n,r,a,i,o,s,l=isPrototypeOf(RegExpPrototype$1,this),u=isRegExp$2(e),c=void 0===t,p=[],d=e;if(!l&&u&&c&&e.constructor===RegExpWrapper)return e;if((u||isPrototypeOf(RegExpPrototype$1,e))&&(e=e.source,c&&(t="flags"in d?d.flags:getFlags(d))),e=void 0===e?"":toString$8(e),t=void 0===t?"":toString$8(t),d=e,UNSUPPORTED_DOT_ALL&&"dotAll"in re1&&(r=!!t&&stringIndexOf$2(t,"s")>-1)&&(t=replace$1(t,/s/g,"")),n=t,MISSED_STICKY&&"sticky"in re1&&(a=!!t&&stringIndexOf$2(t,"y")>-1)&&UNSUPPORTED_Y$1&&(t=replace$1(t,/y/g,"")),UNSUPPORTED_NCG&&(e=(i=handleNCG(e))[0],p=i[1]),o=inheritIfRequired(NativeRegExp(e,t),l?this:RegExpPrototype$1,RegExpWrapper),(r||a||p.length)&&(s=enforceInternalState$1(o),r&&(s.dotAll=!0,s.raw=RegExpWrapper(handleDotAll(e),n)),a&&(s.sticky=!0),p.length&&(s.groups=p)),e!==d)try{createNonEnumerableProperty$1(o,"source",""===d?"(?:)":d)}catch(e){}return o},proxy=function(e){e in RegExpWrapper||defineProperty(RegExpWrapper,e,{configurable:!0,get:function(){return NativeRegExp[e]},set:function(t){NativeRegExp[e]=t}})},keys$1=getOwnPropertyNames(NativeRegExp),index=0;keys$1.length>index;)proxy(keys$1[index++]);RegExpPrototype$1.constructor=RegExpWrapper,RegExpWrapper.prototype=RegExpPrototype$1,redefine$1(global$9,"RegExp",RegExpWrapper)}setSpecies("RegExp");var collection$1=collection$3,collectionStrong=collectionStrong$2;function _typeof$$(e){return _typeof$$="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$$(e)}function _defineProperties$1P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1P(e,t,n){return t&&_defineProperties$1P(e.prototype,t),n&&_defineProperties$1P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck$1P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits$X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$Y(e,t)}function _createSuper$X(e){var t=_isNativeReflectConstruct$Y();return function(){var n,r=_getPrototypeOf$X(e);if(t){var a=_getPrototypeOf$X(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$X(this,n)}}function _possibleConstructorReturn$X(e,t){if(t&&("object"===_typeof$$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$X(e)}function _assertThisInitialized$X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct$1(e,arguments,_getPrototypeOf$X(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$Y(n,e)},_wrapNativeSuper(e)}function _construct$1(e,t,n){return _construct$1=_isNativeReflectConstruct$Y()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf$Y(a,n.prototype),a},_construct$1.apply(null,arguments)}function _isNativeReflectConstruct$Y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf$Y(e,t){return _setPrototypeOf$Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$Y(e,t)}function _getPrototypeOf$X(e){return _getPrototypeOf$X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$X(e)}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */collection$1("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong);var NoSheetWithIdError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"There's no sheet with id = ".concat(e))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NoSheetWithNameError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"There's no sheet with name '".concat(e,"'"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),SheetNameAlreadyTakenError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Sheet with name ".concat(e," already exists"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),SheetSizeLimitExceededError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Sheet size limit exceeded")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NotAFormulaError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"This is not a formula")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),InvalidAddressError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Address (row = ".concat(e.row,", col = ").concat(e.col,") is invalid"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),InvalidArgumentsError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Invalid arguments, expected ".concat(e))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),SheetsNotEqual=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Sheets ".concat(e," and ").concat(r," are not equal."))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NamedExpressionNameIsAlreadyTakenError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Name of Named Expression '".concat(e,"' is already present"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NamedExpressionNameIsInvalidError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Name of Named Expression '".concat(e,"' is invalid"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NamedExpressionDoesNotExistError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Named Expression '".concat(e,"' does not exist"))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NoOperationToUndoError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"There is no operation to undo")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NoOperationToRedoError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"There is no operation to redo")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NothingToPasteError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"There is nothing to paste")}return _createClass$1P(n)}(_wrapNativeSuper(Error));function replacer(e,t){switch(_typeof$$(t)){case"function":case"symbol":return t.toString();case"bigint":return"BigInt("+t.toString()+")";default:return t instanceof RegExp?"RegExp("+t.toString()+")":t}}var UnableToParseError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Unable to parse value: ".concat(JSON.stringify(e,replacer,4)))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ExpectedValueOfTypeError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Expected value of type: ".concat(e," for config parameter: ").concat(r))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ConfigValueEmpty=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Config parameter ".concat(e," cannot be empty."))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ConfigValueTooSmallError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Config parameter ".concat(e," should be at least ").concat(r))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ConfigValueTooBigError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Config parameter ".concat(e," should be at most ").concat(r))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ExpectedOneOfValuesError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Expected one of ".concat(e," for config parameter: ").concat(r))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),EvaluationSuspendedError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Computations are suspended")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),MissingTranslationError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Translation for ".concat(e," is missing in the translation package you're using."))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),ProtectedFunctionTranslationError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e){return _classCallCheck$1P(this,n),t.call(this,"Cannot register translation for function with id: ".concat(e))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),LanguageNotRegisteredError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Language not registered.")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),LanguageAlreadyRegisteredError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Language already registered.")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),FunctionPluginValidationError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.apply(this,arguments)}return _createClass$1P(n,null,[{key:"functionNotDeclaredInPlugin",value:function(e,t){return new n("Function with id ".concat(e," not declared in plugin ").concat(t))}},{key:"functionMethodNotFound",value:function(e,t){return new n("Function method ".concat(e," not found in plugin ").concat(t))}}]),n}(_wrapNativeSuper(Error)),ProtectedFunctionError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.apply(this,arguments)}return _createClass$1P(n,null,[{key:"cannotRegisterFunctionWithId",value:function(e){return new n("Cannot register function with id ".concat(e))}},{key:"cannotUnregisterFunctionWithId",value:function(e){return new n("Cannot unregister function with id ".concat(e))}},{key:"cannotUnregisterProtectedPlugin",value:function(){return new n("Cannot unregister protected plugin")}}]),n}(_wrapNativeSuper(Error)),SourceLocationHasArrayError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Cannot perform this operation, source location has an array inside.")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),TargetLocationHasArrayError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Cannot perform this operation, target location has an array inside.")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),NoRelativeAddressesAllowedError=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(){return _classCallCheck$1P(this,n),t.call(this,"Relative addresses not allowed in named expressions.")}return _createClass$1P(n)}(_wrapNativeSuper(Error)),AliasAlreadyExisting=function(e){_inherits$X(n,e);var t=_createSuper$X(n);function n(e,r){return _classCallCheck$1P(this,n),t.call(this,"Alias id ".concat(e," in plugin ").concat(r," already defined as a function or alias."))}return _createClass$1P(n)}(_wrapNativeSuper(Error)),uncurryThis$e=functionUncurryThis,redefine=redefine$b.exports,regexpExec$2=regexpExec$3,fails$8=fails$B,wellKnownSymbol$2=wellKnownSymbol$o,createNonEnumerableProperty=createNonEnumerableProperty$8,SPECIES$1=wellKnownSymbol$2("species"),RegExpPrototype=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(e,t,n,r){var a=wellKnownSymbol$2(e),i=!fails$8((function(){var t={};return t[a]=function(){return 7},7!=""[e](t)})),o=i&&!fails$8((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[SPECIES$1]=function(){return n},n.flags="",n[a]=/./[a]),n.exec=function(){return t=!0,null},n[a](""),!t}));if(!i||!o||n){var s=uncurryThis$e(/./[a]),l=t(a,""[e],(function(e,t,n,r,a){var o=uncurryThis$e(e),l=t.exec;return l===regexpExec$2||l===RegExpPrototype.exec?i&&!a?{done:!0,value:s(t,n,r)}:{done:!0,value:o(n,t,r)}:{done:!1}}));redefine(String.prototype,e,l[0]),redefine(RegExpPrototype,a,l[1])}r&&createNonEnumerableProperty(RegExpPrototype[a],"sham",!0)},anObject$5=anObject$j,aConstructor=aConstructor$2,wellKnownSymbol$1=wellKnownSymbol$o,SPECIES=wellKnownSymbol$1("species"),speciesConstructor$1=function(e,t){var n,r=anObject$5(e).constructor;return void 0===r||null==(n=anObject$5(r)[SPECIES])?t:aConstructor(n)},charAt$1=stringMultibyte.charAt,advanceStringIndex$2=function(e,t,n){return t+(n?charAt$1(e,t).length:1)},global$8=global$U,call$3=functionCall,anObject$4=anObject$j,isCallable$1=isCallable$l,classof$1=classofRaw$1,regexpExec$1=regexpExec$3,TypeError$3=global$8.TypeError,regexpExecAbstract=function(e,t){var n=e.exec;if(isCallable$1(n)){var r=call$3(n,e,t);return null!==r&&anObject$4(r),r}if("RegExp"===classof$1(e))return call$3(regexpExec$1,e,t);throw TypeError$3("RegExp#exec called on incompatible receiver")},apply$1=functionApply,call$2=functionCall,uncurryThis$d=functionUncurryThis,fixRegExpWellKnownSymbolLogic$1=fixRegexpWellKnownSymbolLogic,isRegExp$1=isRegexp,anObject$3=anObject$j,requireObjectCoercible$5=requireObjectCoercible$b,speciesConstructor=speciesConstructor$1,advanceStringIndex$1=advanceStringIndex$2,toLength$3=toLength$6,toString$7=toString$g,getMethod$1=getMethod$5,arraySlice$1=arraySliceSimple,callRegExpExec=regexpExecAbstract,regexpExec=regexpExec$3,stickyHelpers=regexpStickyHelpers,fails$7=fails$B,UNSUPPORTED_Y=stickyHelpers.UNSUPPORTED_Y,MAX_UINT32=4294967295,min$3=Math.min,$push=[].push,exec=uncurryThis$d(/./.exec),push$3=uncurryThis$d($push),stringSlice$4=uncurryThis$d("".slice),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails$7((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));fixRegExpWellKnownSymbolLogic$1("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=toString$7(requireObjectCoercible$5(this)),a=void 0===n?MAX_UINT32:n>>>0;if(0===a)return[];if(void 0===e)return[r];if(!isRegExp$1(e))return call$2(t,r,e,a);for(var i,o,s,l=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,p=new RegExp(e.source,u+"g");(i=call$2(regexpExec,p,r))&&!((o=p.lastIndex)>c&&(push$3(l,stringSlice$4(r,c,i.index)),i.length>1&&i.index<r.length&&apply$1($push,l,arraySlice$1(i,1)),s=i[0].length,c=o,l.length>=a));)p.lastIndex===i.index&&p.lastIndex++;return c===r.length?!s&&exec(p,"")||push$3(l,""):push$3(l,stringSlice$4(r,c)),l.length>a?arraySlice$1(l,0,a):l}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:call$2(t,this,e,n)}:t,[function(t,n){var a=requireObjectCoercible$5(this),i=null==t?void 0:getMethod$1(t,e);return i?call$2(i,t,a,n):call$2(r,toString$7(a),t,n)},function(e,a){var i=anObject$3(this),o=toString$7(e),s=n(r,i,o,a,r!==t);if(s.done)return s.value;var l=speciesConstructor(i,RegExp),u=i.unicode,c=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(UNSUPPORTED_Y?"g":"y"),p=new l(UNSUPPORTED_Y?"^(?:"+i.source+")":i,c),d=void 0===a?MAX_UINT32:a>>>0;if(0===d)return[];if(0===o.length)return null===callRegExpExec(p,o)?[o]:[];for(var m=0,f=0,h=[];f<o.length;){p.lastIndex=UNSUPPORTED_Y?0:f;var y,b=callRegExpExec(p,UNSUPPORTED_Y?stringSlice$4(o,f):o);if(null===b||(y=min$3(toLength$3(p.lastIndex+(UNSUPPORTED_Y?f:0)),o.length))===m)f=advanceStringIndex$1(o,f,u);else{if(push$3(h,stringSlice$4(o,m,f)),h.length===d)return h;for(var g=1;g<=b.length-1;g++)if(push$3(h,b[g]),h.length===d)return h;f=m=y}}return push$3(h,stringSlice$4(o,m)),h}]}),!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC,UNSUPPORTED_Y);var global$7=global$U,aCallable$1=aCallable$6,toObject$5=toObject$e,IndexedObject$1=indexedObject,lengthOfArrayLike$3=lengthOfArrayLike$b,TypeError$2=global$7.TypeError,createMethod$2=function(e){return function(t,n,r,a){aCallable$1(n);var i=toObject$5(t),o=IndexedObject$1(i),s=lengthOfArrayLike$3(i),l=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(l in o){a=o[l],l+=u;break}if(l+=u,e?l<0:s<=l)throw TypeError$2("Reduce of empty array with no initial value")}for(;e?l>=0:s>l;l+=u)l in o&&(a=n(a,o[l],l,i));return a}},arrayReduce={left:createMethod$2(!1),right:createMethod$2(!0)},classof=classofRaw$1,global$6=global$U,engineIsNode="process"==classof(global$6.process),$$x=_export,$reduce=arrayReduce.left,arrayMethodIsStrict$2=arrayMethodIsStrict$4,CHROME_VERSION=engineV8Version,IS_NODE=engineIsNode,STRICT_METHOD$2=arrayMethodIsStrict$2("reduce"),CHROME_BUG=!IS_NODE&&CHROME_VERSION>79&&CHROME_VERSION<83;$$x({target:"Array",proto:!0,forced:!STRICT_METHOD$2||CHROME_BUG},{reduce:function(e){var t=arguments.length;return $reduce(this,e,t,t>1?arguments[1]:void 0)}});var uncurryThis$c=functionUncurryThis,toObject$4=toObject$e,floor$4=Math.floor,charAt=uncurryThis$c("".charAt),replace=uncurryThis$c("".replace),stringSlice$3=uncurryThis$c("".slice),SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g,getSubstitution$1=function(e,t,n,r,a,i){var o=n+e.length,s=r.length,l=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==a&&(a=toObject$4(a),l=SUBSTITUTION_SYMBOLS),replace(i,l,(function(i,l){var u;switch(charAt(l,0)){case"$":return"$";case"&":return e;case"`":return stringSlice$3(t,0,n);case"'":return stringSlice$3(t,o);case"<":u=a[stringSlice$3(l,1,-1)];break;default:var c=+l;if(0===c)return i;if(c>s){var p=floor$4(c/10);return 0===p?i:p<=s?void 0===r[p-1]?charAt(l,1):r[p-1]+charAt(l,1):i}u=r[c-1]}return void 0===u?"":u}))},apply=functionApply,call$1=functionCall,uncurryThis$b=functionUncurryThis,fixRegExpWellKnownSymbolLogic=fixRegexpWellKnownSymbolLogic,fails$6=fails$B,anObject$2=anObject$j,isCallable=isCallable$l,toIntegerOrInfinity$3=toIntegerOrInfinity$7,toLength$2=toLength$6,toString$6=toString$g,requireObjectCoercible$4=requireObjectCoercible$b,advanceStringIndex=advanceStringIndex$2,getMethod=getMethod$5,getSubstitution=getSubstitution$1,regExpExec=regexpExecAbstract,wellKnownSymbol=wellKnownSymbol$o,REPLACE=wellKnownSymbol("replace"),max$1=Math.max,min$2=Math.min,concat=uncurryThis$b([].concat),push$2=uncurryThis$b([].push),stringIndexOf$1=uncurryThis$b("".indexOf),stringSlice$2=uncurryThis$b("".slice),maybeToString=function(e){return void 0===e?e:String(e)},REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails$6((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),ReferenceType;function _classCallCheck$1O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1O(e,t,n){return t&&_defineProperties$1O(e.prototype,t),n&&_defineProperties$1O(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}fixRegExpWellKnownSymbolLogic("replace",(function(e,t,n){var r=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function(e,n){var r=requireObjectCoercible$4(this),a=null==e?void 0:getMethod(e,REPLACE);return a?call$1(a,e,r,n):call$1(t,toString$6(r),e,n)},function(e,a){var i=anObject$2(this),o=toString$6(e);if("string"==typeof a&&-1===stringIndexOf$1(a,r)&&-1===stringIndexOf$1(a,"$<")){var s=n(t,i,o,a);if(s.done)return s.value}var l=isCallable(a);l||(a=toString$6(a));var u=i.global;if(u){var c=i.unicode;i.lastIndex=0}for(var p=[];;){var d=regExpExec(i,o);if(null===d)break;if(push$2(p,d),!u)break;""===toString$6(d[0])&&(i.lastIndex=advanceStringIndex(o,toLength$2(i.lastIndex),c))}for(var m="",f=0,h=0;h<p.length;h++){for(var y=toString$6((d=p[h])[0]),b=max$1(min$2(toIntegerOrInfinity$3(d.index),o.length),0),g=[],v=1;v<d.length;v++)push$2(g,maybeToString(d[v]));var T=d.groups;if(l){var C=concat([y],g,b,o);void 0!==T&&push$2(C,T);var N=toString$6(apply(a,void 0,C))}else N=getSubstitution(y,o,b,g,T,a);b>=f&&(m+=stringSlice$2(o,f,b)+N,f=b+y.length)}return m+stringSlice$2(o,f)}]}),!REPLACE_SUPPORTS_NAMED_GROUPS||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE),function(e){e.RELATIVE="RELATIVE",e.ABSOLUTE="ABSOLUTE"}(ReferenceType||(ReferenceType={}));var ColumnAddress=function(){function e(t,n,r){_classCallCheck$1O(this,e),this.type=t,this.col=n,this.sheet=r}return _createClass$1O(e,[{key:"isColumnAbsolute",value:function(){return this.type===ReferenceType.ABSOLUTE}},{key:"isColumnRelative",value:function(){return this.type===ReferenceType.RELATIVE}},{key:"isAbsolute",value:function(){return this.type===ReferenceType.ABSOLUTE&&void 0!==this.sheet}},{key:"moved",value:function(t,n,r){var a=void 0===this.sheet?void 0:t;return new e(this.type,this.col+n,a)}},{key:"shiftedByColumns",value:function(t){return new e(this.type,this.col+t,this.sheet)}},{key:"toSimpleColumnAddress",value:function(e){var t=absoluteSheetReference(this,e),n=this.col;return this.isColumnRelative()&&(n=e.col+this.col),simpleColumnAddress(t,n)}},{key:"shiftRelativeDimensions",value:function(t,n){var r=this.isColumnRelative()?this.col+t:this.col;return new e(this.type,r,this.sheet)}},{key:"shiftAbsoluteDimensions",value:function(t,n){var r=this.isColumnAbsolute()?this.col+t:this.col;return new e(this.type,r,this.sheet)}},{key:"withSheet",value:function(t){return new e(this.type,this.col,t)}},{key:"isInvalid",value:function(e){return this.toSimpleColumnAddress(e).col<0}},{key:"hash",value:function(e){var t=e&&void 0!==this.sheet?"#".concat(this.sheet):"";switch(this.type){case ReferenceType.RELATIVE:return"".concat(t,"#COLR").concat(this.col);case ReferenceType.ABSOLUTE:return"".concat(t,"#COLA").concat(this.col)}}},{key:"unparse",value:function(e){var t=this.toSimpleColumnAddress(e);if(!invalidSimpleColumnAddress(t)){var n=columnIndexToLabel(t.col),r=this.type===ReferenceType.ABSOLUTE?"$":"";return"".concat(r).concat(n)}}},{key:"exceedsSheetSizeLimits",value:function(e){return this.col>=e}}],[{key:"absolute",value:function(t,n){return new e(ReferenceType.ABSOLUTE,t,n)}},{key:"relative",value:function(t,n){return new e(ReferenceType.RELATIVE,t,n)}},{key:"compareByAbsoluteAddress",value:function(e){return function(t,n){return t.toSimpleColumnAddress(e).col-n.toSimpleColumnAddress(e).col}}}]),e}();function _classCallCheck$1N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1N(e,t,n){return t&&_defineProperties$1N(e.prototype,t),n&&_defineProperties$1N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var RowAddress=function(){function e(t,n,r){_classCallCheck$1N(this,e),this.type=t,this.row=n,this.sheet=r}return _createClass$1N(e,[{key:"isRowAbsolute",value:function(){return this.type===ReferenceType.ABSOLUTE}},{key:"isRowRelative",value:function(){return this.type===ReferenceType.RELATIVE}},{key:"isAbsolute",value:function(){return this.type===ReferenceType.ABSOLUTE&&void 0!==this.sheet}},{key:"moved",value:function(t,n,r){var a=void 0===this.sheet?void 0:t;return new e(this.type,this.row+r,a)}},{key:"shiftedByRows",value:function(t){return new e(this.type,this.row+t,this.sheet)}},{key:"toSimpleRowAddress",value:function(e){var t=absoluteSheetReference(this,e),n=this.row;return this.isRowRelative()&&(n=e.row+this.row),simpleRowAddress(t,n)}},{key:"shiftRelativeDimensions",value:function(t,n){var r=this.isRowRelative()?this.row+n:this.row;return new e(this.type,r,this.sheet)}},{key:"shiftAbsoluteDimensions",value:function(t,n){var r=this.isRowAbsolute()?this.row+n:this.row;return new e(this.type,r,this.sheet)}},{key:"withSheet",value:function(t){return new e(this.type,this.row,t)}},{key:"isInvalid",value:function(e){return this.toSimpleRowAddress(e).row<0}},{key:"hash",value:function(e){var t=e&&void 0!==this.sheet?"#".concat(this.sheet):"";switch(this.type){case ReferenceType.RELATIVE:return"".concat(t,"#ROWR").concat(this.row);case ReferenceType.ABSOLUTE:return"".concat(t,"#ROWA").concat(this.row)}}},{key:"unparse",value:function(e){var t=this.toSimpleRowAddress(e);if(!invalidSimpleRowAddress(t)){var n=this.type===ReferenceType.ABSOLUTE?"$":"";return"".concat(n).concat(t.row+1)}}},{key:"exceedsSheetSizeLimits",value:function(e){return this.row>=e}}],[{key:"absolute",value:function(t,n){return new e(ReferenceType.ABSOLUTE,t,n)}},{key:"relative",value:function(t,n){return new e(ReferenceType.RELATIVE,t,n)}},{key:"compareByAbsoluteAddress",value:function(e){return function(t,n){return t.toSimpleRowAddress(e).row-n.toSimpleRowAddress(e).row}}}]),e}(),CellReferenceType;function _classCallCheck$1M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1M(e,t,n){return t&&_defineProperties$1M(e.prototype,t),n&&_defineProperties$1M(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",e.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",e.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",e.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"}(CellReferenceType||(CellReferenceType={}));var CellAddress=function(){function e(t,n,r,a){_classCallCheck$1M(this,e),this.col=t,this.row=n,this.type=r,this.sheet=a}return _createClass$1M(e,[{key:"toSimpleCellAddress",value:function(e){var t=absoluteSheetReference(this,e);return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE?simpleCellAddress(t,this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?simpleCellAddress(t,e.col+this.col,this.row):this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?simpleCellAddress(t,this.col,e.row+this.row):simpleCellAddress(t,e.col+this.col,e.row+this.row)}},{key:"toColumnAddress",value:function(){var e=this.isColumnRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new ColumnAddress(e,this.col,this.sheet)}},{key:"toRowAddress",value:function(){var e=this.isRowRelative()?ReferenceType.RELATIVE:ReferenceType.ABSOLUTE;return new RowAddress(e,this.row,this.sheet)}},{key:"toSimpleColumnAddress",value:function(e){var t=absoluteSheetReference(this,e),n=this.col;return this.isColumnRelative()&&(n+=e.col),simpleColumnAddress(t,n)}},{key:"toSimpleRowAddress",value:function(e){var t=absoluteSheetReference(this,e),n=this.row;return this.isRowRelative()&&(n+=e.row),simpleRowAddress(t,n)}},{key:"isRowAbsolute",value:function(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}},{key:"isColumnAbsolute",value:function(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}},{key:"isColumnRelative",value:function(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW}},{key:"isRowRelative",value:function(){return this.type===CellReferenceType.CELL_REFERENCE_RELATIVE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL}},{key:"isAbsolute",value:function(){return this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE&&void 0!==this.sheet}},{key:"shiftedByRows",value:function(t){return new e(this.col,this.row+t,this.type,this.sheet)}},{key:"shiftedByColumns",value:function(t){return new e(this.col+t,this.row,this.type,this.sheet)}},{key:"moved",value:function(t,n,r){var a=void 0===this.sheet?void 0:t;return new e(this.col+n,this.row+r,this.type,a)}},{key:"withSheet",value:function(t){return new e(this.col,this.row,this.type,t)}},{key:"isInvalid",value:function(e){return invalidSimpleCellAddress(this.toSimpleCellAddress(e))}},{key:"shiftRelativeDimensions",value:function(t,n){return new e(this.isColumnAbsolute()?this.col:this.col+t,this.isRowAbsolute()?this.row:this.row+n,this.type,this.sheet)}},{key:"shiftAbsoluteDimensions",value:function(t,n){return new e(this.isColumnRelative()?this.col:this.col+t,this.isRowRelative()?this.row:this.row+n,this.type,this.sheet)}},{key:"hash",value:function(e){var t=e&&void 0!==this.sheet?"#".concat(this.sheet):"";switch(this.type){case CellReferenceType.CELL_REFERENCE_RELATIVE:return"".concat(t,"#").concat(this.row,"R").concat(this.col);case CellReferenceType.CELL_REFERENCE_ABSOLUTE:return"".concat(t,"#").concat(this.row,"A").concat(this.col);case CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL:return"".concat(t,"#").concat(this.row,"AC").concat(this.col);case CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW:return"".concat(t,"#").concat(this.row,"AR").concat(this.col)}}},{key:"unparse",value:function(e){var t=this.toSimpleCellAddress(e);if(!invalidSimpleCellAddress(t)){var n=columnIndexToLabel(t.col),r=this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW?"$":"",a=this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE||this.type===CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL?"$":"";return"".concat(a).concat(n).concat(r).concat(t.row+1)}}},{key:"exceedsSheetSizeLimits",value:function(e,t){return this.row>=t||this.col>=e}}],[{key:"fromColAndRow",value:function(t,n,r){var a=t.isColumnAbsolute()&&n.isRowAbsolute()?e.absolute.bind(this):t.isColumnAbsolute()?e.absoluteCol.bind(this):n.isRowAbsolute()?e.absoluteRow.bind(this):function(t,n,r){return e.relative(n,t,r)};return a(t.col,n.row,r)}},{key:"relative",value:function(t,n,r){return new e(n,t,CellReferenceType.CELL_REFERENCE_RELATIVE,r)}},{key:"absolute",value:function(t,n,r){return new e(t,n,CellReferenceType.CELL_REFERENCE_ABSOLUTE,r)}},{key:"absoluteCol",value:function(t,n,r){return new e(t,n,CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL,r)}},{key:"absoluteRow",value:function(t,n,r){return new e(t,n,CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW,r)}}]),e}();function isEmpty(e){return e&&0===e.length}function keys(e){return null==e?[]:Object.keys(e)}function values(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}function mapValues(e,t){for(var n=[],r=keys(e),a=0;a<r.length;a++){var i=r[a];n.push(t.call(null,e[i],i))}return n}function map(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t.call(null,e[r],r));return n}function flatten(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?t=t.concat(flatten(r)):t.push(r)}return t}function first$1(e){return isEmpty(e)?void 0:e[0]}function last(e){var t=e&&e.length;return t?e[t-1]:void 0}function forEach$1(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t.call(null,e[n],n);else{if(!isObject$5(e))throw Error("non exhaustive match");var r=keys(e);for(n=0;n<r.length;n++){var a=r[n],i=e[a];t.call(null,i,a)}}}function isString$1(e){return"string"==typeof e}function isUndefined$1(e){return void 0===e}function isFunction$1(e){return e instanceof Function}function drop(e,t){return void 0===t&&(t=1),e.slice(t,e.length)}function dropRight(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)}function filter(e,t){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r++){var a=e[r];t.call(null,a)&&n.push(a)}return n}function reject(e,t){return filter(e,(function(e){return!t(e)}))}function pick(e,t){for(var n=Object.keys(e),r={},a=0;a<n.length;a++){var i=n[a],o=e[i];t(o)&&(r[i]=o)}return r}function has(e,t){return!!isObject$5(e)&&e.hasOwnProperty(t)}function contains(e,t){return void 0!==find$1(e,(function(e){return e===t}))}function cloneArr(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}function cloneObj(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function find$1(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t.call(null,r))return r}}function findAll(e,t){for(var n=[],r=0;r<e.length;r++){var a=e[r];t.call(null,a)&&n.push(a)}return n}function reduce(e,t,n){for(var r=Array.isArray(e),a=r?e:values(e),i=r?[]:keys(e),o=n,s=0;s<a.length;s++)o=t.call(null,o,a[s],r?s:i[s]);return o}function compact(e){return reject(e,(function(e){return null==e}))}function uniq(e,t){void 0===t&&(t=function(e){return e});var n=[];return reduce(e,(function(e,r){var a=t(r);return contains(n,a)?e:(n.push(a),e.concat(r))}),[])}function isArray$2(e){return Array.isArray(e)}function isRegExp(e){return e instanceof RegExp}function isObject$5(e){return e instanceof Object}function every(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function difference(e,t){return reject(e,(function(e){return contains(t,e)}))}function some(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function indexOf(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function assign(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)for(var a=t[r],i=keys(a),o=0;o<i.length;o++){var s=i[o];e[s]=a[s]}return e}function assignNoOverwrite(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var a=t[r];if(!isUndefined$1(a))for(var i=keys(a),o=0;o<i.length;o++){var s=i[o];has(e,s)||(e[s]=a[s])}}return e}function defaults$4(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return assignNoOverwrite.apply(null,[{}].concat(e))}function groupBy(e,t){var n={};return forEach$1(e,(function(e){var r=t(e),a=n[r];a?a.push(e):n[r]=[e]})),n}function merge$2(e,t){for(var n=cloneObj(e),r=keys(t),a=0;a<r.length;a++){var i=r[a],o=t[i];n[i]=o}return n}function NOOP(){}function IDENTITY(e){return e}function packArray(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(void 0!==r?r:void 0)}return t}function PRINT_ERROR(e){console&&console.error&&console.error("Error: "+e)}function PRINT_WARNING(e){console&&console.warn&&console.warn("Warning: "+e)}function isES2015MapSupported(){return"function"==typeof Map}function applyMixins(e,t){t.forEach((function(t){var n=t.prototype;Object.getOwnPropertyNames(n).forEach((function(r){if("constructor"!==r){var a=Object.getOwnPropertyDescriptor(n,r);a&&(a.get||a.set)?Object.defineProperty(e.prototype,r,a):e.prototype[r]=t.prototype[r]}}))}))}function toFastProperties(e){function t(){}t.prototype=e;var n=new t;function r(){return typeof n.bar}return r(),r(),e}function peek(e){return e[e.length-1]}function timer(e){var t=(new Date).getTime(),n=e();return{time:(new Date).getTime()-t,value:n}}var regexpToAst={exports:{}};!function(e){var t,n;t="undefined"!=typeof self?self:commonjsGlobal,n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var n={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(n,"global");break;case"i":s(n,"ignoreCase");break;case"m":s(n,"multiLine");break;case"u":s(n,"unicode");break;case"y":s(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var n=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:n,atMost:n};break;case",":t=this.isDigit()?{atLeast:n,atMost:this.integerIncludingZero()}:{atLeast:n,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i("\n"),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=u;break;case"D":e=u,t=!0;break;case"s":e=p;break;case"S":e=p,t=!0;break;case"w":e=c;break;case"W":e=c,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=i("\f");break;case"n":e=i("\n");break;case"r":e=i("\r");break;case"t":e=i("\t");break;case"v":e=i("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:i(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:i(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var n=this.classAtom();if("Character"===n.type&&this.isRangeDash()){this.consumeChar("-");var r=this.classAtom();if("Character"===r.type){if(r.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:r.value})}else o(n.value,e),e.push(i("-")),o(r.value,e)}else o(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;this.consumeChar("("),"?"===this.peekChar(0)?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;var t=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:e,value:t};return e&&(n.idx=this.groupIdx),n},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===a.test(e))throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===r.test(e))throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return r.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",r=0;r<e;r++){var a=this.popChar();if(!1===n.test(a))throw Error("Expecting a HexDecimal digits");t+=a}return{type:"Character",value:parseInt(t,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,n=/[0-9a-fA-F]/,r=/[0-9]/,a=/[1-9]/;function i(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var u=[];for(t=i("0");t<=i("9");t++)u.push(t);var c=[i("_")].concat(u);for(t=i("a");t<=i("z");t++)c.push(t);for(t=i("A");t<=i("Z");t++)c.push(t);var p=[i(" "),i("\f"),i("\n"),i("\r"),i("\t"),i("\v"),i("\t"),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i(""),i("\u2028"),i("\u2029"),i(""),i(""),i(""),i("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var n=e[t];e.hasOwnProperty(t)&&(void 0!==n.type?this.visit(n):Array.isArray(n)&&n.forEach((function(e){this.visit(e)}),this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}},e.exports?e.exports=n():t.regexpToAst=n()}(regexpToAst);var regExpAstCache={},regExpParser=new regexpToAst.exports.RegExpParser;function getRegExpAst(e){var t=e.toString();if(regExpAstCache.hasOwnProperty(t))return regExpAstCache[t];var n=regExpParser.pattern(t);return regExpAstCache[t]=n,n}function clearRegExpParserCache(){regExpAstCache={}}var __extends$a=(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},extendStatics(e,t)},function(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),extendStatics,complementErrorMessage="Complement Sets are not supported for first char optimization",failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n';function getOptimizedStartCodesIndices(e,t){void 0===t&&(t=!1);try{var n=getRegExpAst(e);return firstCharOptimizedIndices(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===complementErrorMessage)t&&PRINT_WARNING(failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var r="";t&&(r="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),PRINT_ERROR(failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+regexpToAst.exports.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+r)}}return[]}function firstCharOptimizedIndices(e,t,n){switch(e.type){case"Disjunction":for(var r=0;r<e.value.length;r++)firstCharOptimizedIndices(e.value[r],t,n);break;case"Alternative":var a=e.value;for(r=0;r<a.length;r++){var i=a[r];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var o=i;switch(o.type){case"Character":addOptimizedIdxToResult(o.value,t,n);break;case"Set":if(!0===o.complement)throw Error(complementErrorMessage);forEach$1(o.value,(function(e){if("number"==typeof e)addOptimizedIdxToResult(e,t,n);else{var r=e;if(!0===n)for(var a=r.from;a<=r.to;a++)addOptimizedIdxToResult(a,t,n);else{for(a=r.from;a<=r.to&&a<minOptimizationVal;a++)addOptimizedIdxToResult(a,t,n);if(r.to>=minOptimizationVal)for(var i=r.from>=minOptimizationVal?r.from:minOptimizationVal,o=r.to,s=charCodeToOptimizedIndex(i),l=charCodeToOptimizedIndex(o),u=s;u<=l;u++)t[u]=u}}}));break;case"Group":firstCharOptimizedIndices(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}var s=void 0!==o.quantifier&&0===o.quantifier.atLeast;if("Group"===o.type&&!1===isWholeOptional(o)||"Group"!==o.type&&!1===s)break}break;default:throw Error("non exhaustive match!")}return values(t)}function addOptimizedIdxToResult(e,t,n){var r=charCodeToOptimizedIndex(e);t[r]=r,!0===n&&handleIgnoreCase(e,t)}function handleIgnoreCase(e,t){var n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){t[a=charCodeToOptimizedIndex(r.charCodeAt(0))]=a}else{var a,i=n.toLowerCase();if(i!==n)t[a=charCodeToOptimizedIndex(i.charCodeAt(0))]=a}}function findCode(e,t){return find$1(e.value,(function(e){if("number"==typeof e)return contains(t,e);var n=e;return void 0!==find$1(t,(function(e){return n.from<=e&&e<=n.to}))}))}function isWholeOptional(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(isArray$2(e.value)?every(e.value,isWholeOptional):isWholeOptional(e.value))}var CharCodeFinder=function(e){function t(t){var n=e.call(this)||this;return n.targetCharCodes=t,n.found=!1,n}return __extends$a(t,e),t.prototype.visitChildren=function(t){if(!0!==this.found){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)}},t.prototype.visitCharacter=function(e){contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===findCode(e,this.targetCharCodes)&&(this.found=!0):void 0!==findCode(e,this.targetCharCodes)&&(this.found=!0)},t}(regexpToAst.exports.BaseRegExpVisitor);function canMatchCharCode(e,t){if(t instanceof RegExp){var n=getRegExpAst(t),r=new CharCodeFinder(e);return r.visit(n),r.found}return void 0!==find$1(t,(function(t){return contains(e,t.charCodeAt(0))}))}var __extends$9=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),PATTERN="PATTERN",DEFAULT_MODE="defaultMode",MODES="modes",SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky;function analyzeTokenTypes(e,t){var n,r=(t=defaults$4(t,{useSticky:SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function(e,t){return t()}})).tracer;r("initCharCodeToOptimizedIndexMap",(function(){initCharCodeToOptimizedIndexMap()})),r("Reject Lexer.NA",(function(){n=reject(e,(function(e){return e[PATTERN]===Lexer.NA}))}));var a,i,o,s,l,u,c,p,d,m,f,h=!1;r("Transform Patterns",(function(){h=!1,a=map(n,(function(e){var n=e[PATTERN];if(isRegExp(n)){var r=n.source;return 1===r.length&&"^"!==r&&"$"!==r&&"."!==r?r:2!==r.length||"\\"!==r[0]||contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],r[1])?t.useSticky?addStickyFlag(n):addStartOfInput(n):r[1]}if(isFunction$1(n))return h=!0,{exec:n};if(has(n,"exec"))return h=!0,n;if("string"==typeof n){if(1===n.length)return n;var a=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=new RegExp(a);return t.useSticky?addStickyFlag(i):addStartOfInput(i)}throw Error("non exhaustive match")}))})),r("misc mapping",(function(){i=map(n,(function(e){return e.tokenTypeIdx})),o=map(n,(function(e){var t=e.GROUP;if(t!==Lexer.SKIPPED){if(isString$1(t))return t;if(isUndefined$1(t))return!1;throw Error("non exhaustive match")}})),s=map(n,(function(e){var t=e.LONGER_ALT;if(t)return indexOf(n,t)})),l=map(n,(function(e){return e.PUSH_MODE})),u=map(n,(function(e){return has(e,"POP_MODE")}))})),r("Line Terminator Handling",(function(){var e=getCharCodes(t.lineTerminatorCharacters);c=map(n,(function(e){return!1})),"onlyOffset"!==t.positionTracking&&(c=map(n,(function(t){return has(t,"LINE_BREAKS")?t.LINE_BREAKS:!1===checkLineBreaksIssues(t,e)?canMatchCharCode(e,t.PATTERN):void 0})))})),r("Misc Mapping #2",(function(){p=map(n,isCustomPattern),d=map(a,isShortPattern),m=reduce(n,(function(e,t){var n=t.GROUP;return isString$1(n)&&n!==Lexer.SKIPPED&&(e[n]=[]),e}),{}),f=map(a,(function(e,t){return{pattern:a[t],longerAlt:s[t],canLineTerminator:c[t],isCustom:p[t],short:d[t],group:o[t],push:l[t],pop:u[t],tokenTypeIdx:i[t],tokenType:n[t]}}))}));var y=!0,b=[];return t.safeMode||r("First Char Optimization",(function(){b=reduce(n,(function(e,n,r){if("string"==typeof n.PATTERN){var a=charCodeToOptimizedIndex(n.PATTERN.charCodeAt(0));addToMapOfArrays(e,a,f[r])}else if(isArray$2(n.START_CHARS_HINT)){var i;forEach$1(n.START_CHARS_HINT,(function(t){var n=charCodeToOptimizedIndex("string"==typeof t?t.charCodeAt(0):t);i!==n&&(i=n,addToMapOfArrays(e,n,f[r]))}))}else if(isRegExp(n.PATTERN))if(n.PATTERN.unicode)y=!1,t.ensureOptimizations&&PRINT_ERROR(failedOptimizationPrefixMsg+"\tUnable to analyze < "+n.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var o=getOptimizedStartCodesIndices(n.PATTERN,t.ensureOptimizations);isEmpty(o)&&(y=!1),forEach$1(o,(function(t){addToMapOfArrays(e,t,f[r])}))}else t.ensureOptimizations&&PRINT_ERROR(failedOptimizationPrefixMsg+"\tTokenType: <"+n.name+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),y=!1;return e}),[])})),r("ArrayPacking",(function(){b=packArray(b)})),{emptyGroups:m,patternIdxToConfig:f,charCodeToPatternIdxToConfig:b,hasCustom:h,canBeOptimized:y}}function validatePatterns(e,t){var n=[],r=findMissingPatterns(e);n=n.concat(r.errors);var a=findInvalidPatterns(r.valid),i=a.valid;return n=(n=(n=(n=(n=n.concat(a.errors)).concat(validateRegExpPattern(i))).concat(findInvalidGroupType(i))).concat(findModesThatDoNotExist(i,t))).concat(findUnreachablePatterns(i))}function validateRegExpPattern(e){var t=[],n=filter(e,(function(e){return isRegExp(e[PATTERN])}));return t=(t=(t=(t=(t=t.concat(findEndOfInputAnchor(n))).concat(findStartOfInputAnchor(n))).concat(findUnsupportedFlags(n))).concat(findDuplicatePatterns(n))).concat(findEmptyMatchRegExps(n))}function findMissingPatterns(e){var t=filter(e,(function(e){return!has(e,PATTERN)}));return{errors:map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:difference(e,t)}}function findInvalidPatterns(e){var t=filter(e,(function(e){var t=e[PATTERN];return!(isRegExp(t)||isFunction$1(t)||has(t,"exec")||isString$1(t))}));return{errors:map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:difference(e,t)}}var end_of_input=/[^\\][\$]/;function findEndOfInputAnchor(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return __extends$9(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(regexpToAst.exports.BaseRegExpVisitor);return map(filter(e,(function(e){var n=e[PATTERN];try{var r=getRegExpAst(n),a=new t;return a.visit(r),a.found}catch(e){return end_of_input.test(n.source)}})),(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function findEmptyMatchRegExps(e){return map(filter(e,(function(e){return e[PATTERN].test("")})),(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}var start_of_input=/[^\\[][\^]|^\^/;function findStartOfInputAnchor(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return __extends$9(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(regexpToAst.exports.BaseRegExpVisitor);return map(filter(e,(function(e){var n=e[PATTERN];try{var r=getRegExpAst(n),a=new t;return a.visit(r),a.found}catch(e){return start_of_input.test(n.source)}})),(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function findUnsupportedFlags(e){return map(filter(e,(function(e){var t=e[PATTERN];return t instanceof RegExp&&(t.multiline||t.global)})),(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function findDuplicatePatterns(e){var t=[],n=map(e,(function(n){return reduce(e,(function(e,r){return n.PATTERN.source!==r.PATTERN.source||contains(t,r)||r.PATTERN===Lexer.NA||(t.push(r),e.push(r)),e}),[])}));return map(filter(n=compact(n),(function(e){return e.length>1})),(function(e){var t=map(e,(function(e){return e.name}));return{message:"The same RegExp pattern ->"+first$1(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function findInvalidGroupType(e){return map(filter(e,(function(e){if(!has(e,"GROUP"))return!1;var t=e.GROUP;return t!==Lexer.SKIPPED&&t!==Lexer.NA&&!isString$1(t)})),(function(e){return{message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function findModesThatDoNotExist(e,t){return map(filter(e,(function(e){return void 0!==e.PUSH_MODE&&!contains(t,e.PUSH_MODE)})),(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function findUnreachablePatterns(e){var t=[],n=reduce(e,(function(e,t,n){var r=t.PATTERN;return r===Lexer.NA||(isString$1(r)?e.push({str:r,idx:n,tokenType:t}):isRegExp(r)&&noMetaChar(r)&&e.push({str:r.source,idx:n,tokenType:t})),e}),[]);return forEach$1(e,(function(e,r){forEach$1(n,(function(n){var a=n.str,i=n.idx,o=n.tokenType;if(r<i&&testTokenType(a,e.PATTERN)){var s="Token: ->"+o.name+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+e.name+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:s,type:LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,o]})}}))})),t}function testTokenType(e,t){if(isRegExp(t)){var n=t.exec(e);return null!==n&&0===n.index}if(isFunction$1(t))return t(e,0,[],{});if(has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}function noMetaChar(e){return void 0===find$1([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(function(t){return-1!==e.source.indexOf(t)}))}function addStartOfInput(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function addStickyFlag(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function performRuntimeChecks(e,t,n){var r=[];return has(e,DEFAULT_MODE)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+DEFAULT_MODE+"> property in its definition\n",type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),has(e,MODES)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+MODES+"> property in its definition\n",type:LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),has(e,MODES)&&has(e,DEFAULT_MODE)&&!has(e.modes,e.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a "+DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),has(e,MODES)&&forEach$1(e.modes,(function(e,t){forEach$1(e,(function(e,n){isUndefined$1(e)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+n+">\n",type:LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),r}function performWarningRuntimeChecks(e,t,n){var r=[],a=!1,i=reject(compact(flatten(mapValues(e.modes,(function(e){return e})))),(function(e){return e[PATTERN]===Lexer.NA})),o=getCharCodes(n);return t&&forEach$1(i,(function(e){var t=checkLineBreaksIssues(e,o);if(!1!==t){var n={message:buildLineBreakIssueMessage(e,t),type:t.issue,tokenType:e};r.push(n)}else has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(a=!0):canMatchCharCode(o,e.PATTERN)&&(a=!0)})),t&&!a&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r}function cloneEmptyGroups(e){var t={};return forEach$1(keys(e),(function(n){if(!isArray$2(e[n]))throw Error("non exhaustive match");t[n]=[]})),t}function isCustomPattern(e){var t=e.PATTERN;if(isRegExp(t))return!1;if(isFunction$1(t))return!0;if(has(t,"exec"))return!0;if(isString$1(t))return!1;throw Error("non exhaustive match")}function isShortPattern(e){return!(!isString$1(e)||1!==e.length)&&e.charCodeAt(0)}var LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var r=e.charCodeAt(n);if(10===r)return this.lastIndex=n+1,!0;if(13===r)return 10===e.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function checkLineBreaksIssues(e,t){if(has(e,"LINE_BREAKS"))return!1;if(isRegExp(e.PATTERN)){try{canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(isString$1(e.PATTERN))return!1;if(isCustomPattern(e))return{issue:LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function buildLineBreakIssueMessage(e,t){if(t.issue===LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function getCharCodes(e){return map(e,(function(e){return isString$1(e)&&e.length>0?e.charCodeAt(0):e}))}function addToMapOfArrays(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}var minOptimizationVal=256;function charCodeToOptimizedIndex(e){return e<minOptimizationVal?e:charCodeToOptimizedIdxMap[e]}var charCodeToOptimizedIdxMap=[];function initCharCodeToOptimizedIndexMap(){if(isEmpty(charCodeToOptimizedIdxMap)){charCodeToOptimizedIdxMap=new Array(65536);for(var e=0;e<65536;e++)charCodeToOptimizedIdxMap[e]=e>255?255+~~(e/255):e}}function tokenStructuredMatcher(e,t){var n=e.tokenTypeIdx;return n===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[n]}function tokenStructuredMatcherNoCategories(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}var tokenShortNameIdx=1,tokenIdxToClass={};function augmentTokenTypes(e){var t=expandCategories(e);assignTokenDefaultProps(t),assignCategoriesMapProp(t),assignCategoriesTokensProp(t),forEach$1(t,(function(e){e.isParent=e.categoryMatches.length>0}))}function expandCategories(e){for(var t=cloneArr(e),n=e,r=!0;r;){var a=difference(n=compact(flatten(map(n,(function(e){return e.CATEGORIES})))),t);t=t.concat(a),isEmpty(a)?r=!1:n=a}return t}function assignTokenDefaultProps(e){forEach$1(e,(function(e){hasShortKeyProperty(e)||(tokenIdxToClass[tokenShortNameIdx]=e,e.tokenTypeIdx=tokenShortNameIdx++),hasCategoriesProperty(e)&&!isArray$2(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),hasCategoriesProperty(e)||(e.CATEGORIES=[]),hasExtendingTokensTypesProperty(e)||(e.categoryMatches=[]),hasExtendingTokensTypesMapProperty(e)||(e.categoryMatchesMap={})}))}function assignCategoriesTokensProp(e){forEach$1(e,(function(e){e.categoryMatches=[],forEach$1(e.categoryMatchesMap,(function(t,n){e.categoryMatches.push(tokenIdxToClass[n].tokenTypeIdx)}))}))}function assignCategoriesMapProp(e){forEach$1(e,(function(e){singleAssignCategoriesToksMap([],e)}))}function singleAssignCategoriesToksMap(e,t){forEach$1(e,(function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0})),forEach$1(t.CATEGORIES,(function(n){var r=e.concat(t);contains(r,n)||singleAssignCategoriesToksMap(r,n)}))}function hasShortKeyProperty(e){return has(e,"tokenTypeIdx")}function hasCategoriesProperty(e){return has(e,"CATEGORIES")}function hasExtendingTokensTypesProperty(e){return has(e,"categoryMatches")}function hasExtendingTokensTypesMapProperty(e){return has(e,"categoryMatchesMap")}function isTokenType(e){return has(e,"tokenTypeIdx")}var defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,n,r,a){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+n+" characters."}},LexerDefinitionErrorType;!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(LexerDefinitionErrorType||(LexerDefinitionErrorType={}));var DEFAULT_LEXER_CONFIG={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(DEFAULT_LEXER_CONFIG);var Lexer=function(){function e(e,t){var n=this;if(void 0===t&&(t=DEFAULT_LEXER_CONFIG),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=merge$2(DEFAULT_LEXER_CONFIG,t);var r=this.config.traceInitPerf;!0===r?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof r&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",(function(){var r,a=!0;n.TRACE_INIT("Lexer Config handling",(function(){if(n.config.lineTerminatorsPattern===DEFAULT_LEXER_CONFIG.lineTerminatorsPattern)n.config.lineTerminatorsPattern=LineTerminatorOptimizedTester;else if(n.config.lineTerminatorCharacters===DEFAULT_LEXER_CONFIG.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');n.trackStartLines=/full|onlyStart/i.test(n.config.positionTracking),n.trackEndLines=/full/i.test(n.config.positionTracking),isArray$2(e)?((r={modes:{}}).modes[DEFAULT_MODE]=cloneArr(e),r[DEFAULT_MODE]=DEFAULT_MODE):(a=!1,r=cloneObj(e))})),!1===n.config.skipValidations&&(n.TRACE_INIT("performRuntimeChecks",(function(){n.lexerDefinitionErrors=n.lexerDefinitionErrors.concat(performRuntimeChecks(r,n.trackStartLines,n.config.lineTerminatorCharacters))})),n.TRACE_INIT("performWarningRuntimeChecks",(function(){n.lexerDefinitionWarning=n.lexerDefinitionWarning.concat(performWarningRuntimeChecks(r,n.trackStartLines,n.config.lineTerminatorCharacters))}))),r.modes=r.modes?r.modes:{},forEach$1(r.modes,(function(e,t){r.modes[t]=reject(e,(function(e){return isUndefined$1(e)}))}));var i=keys(r.modes);if(forEach$1(r.modes,(function(e,r){n.TRACE_INIT("Mode: <"+r+"> processing",(function(){var a;(n.modes.push(r),!1===n.config.skipValidations&&n.TRACE_INIT("validatePatterns",(function(){n.lexerDefinitionErrors=n.lexerDefinitionErrors.concat(validatePatterns(e,i))})),isEmpty(n.lexerDefinitionErrors))&&(augmentTokenTypes(e),n.TRACE_INIT("analyzeTokenTypes",(function(){a=analyzeTokenTypes(e,{lineTerminatorCharacters:n.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:n.TRACE_INIT.bind(n)})})),n.patternIdxToConfig[r]=a.patternIdxToConfig,n.charCodeToPatternIdxToConfig[r]=a.charCodeToPatternIdxToConfig,n.emptyGroups=merge$2(n.emptyGroups,a.emptyGroups),n.hasCustom=a.hasCustom||n.hasCustom,n.canModeBeOptimized[r]=a.canBeOptimized)}))})),n.defaultMode=r.defaultMode,!isEmpty(n.lexerDefinitionErrors)&&!n.config.deferDefinitionErrorsHandling){var o=map(n.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+o)}forEach$1(n.lexerDefinitionWarning,(function(e){PRINT_WARNING(e.message)})),n.TRACE_INIT("Choosing sub-methods implementations",(function(){if(SUPPORT_STICKY?(n.chopInput=IDENTITY,n.match=n.matchWithTest):(n.updateLastIndex=NOOP,n.match=n.matchWithExec),a&&(n.handleModes=NOOP),!1===n.trackStartLines&&(n.computeNewColumn=IDENTITY),!1===n.trackEndLines&&(n.updateTokenEndLineColumnLocation=NOOP),/full/i.test(n.config.positionTracking))n.createTokenInstance=n.createFullToken;else if(/onlyStart/i.test(n.config.positionTracking))n.createTokenInstance=n.createStartOnlyToken;else{if(!/onlyOffset/i.test(n.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+n.config.positionTracking+'"');n.createTokenInstance=n.createOffsetOnlyToken}n.hasCustom?(n.addToken=n.addTokenUsingPush,n.handlePayload=n.handlePayloadWithCustom):(n.addToken=n.addTokenUsingMemberAccess,n.handlePayload=n.handlePayloadNoCustom)})),n.TRACE_INIT("Failed Optimization Warnings",(function(){var e=reduce(n.canModeBeOptimized,(function(e,t,n){return!1===t&&e.push(n),e}),[]);if(t.ensureOptimizations&&!isEmpty(e))throw Error("Lexer Modes: < "+e.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')})),n.TRACE_INIT("clearRegExpParserCache",(function(){clearRegExpParserCache()})),n.TRACE_INIT("toFastProperties",(function(){toFastProperties(n)}))}))}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!isEmpty(this.lexerDefinitionErrors)){var n=map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+n)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var n,r,a,i,o,s,l,u,c,p,d,m,f,h,y=this,b=e,g=b.length,v=0,T=0,C=this.hasCustom?0:Math.floor(e.length/10),N=new Array(C),A=[],S=this.trackStartLines?1:void 0,w=this.trackStartLines?1:void 0,x=cloneEmptyGroups(this.emptyGroups),V=this.trackStartLines,E=this.config.lineTerminatorsPattern,$=0,_=[],O=[],I=[],D=[];Object.freeze(D);var R=void 0;function P(){return _}function k(e){var t=charCodeToOptimizedIndex(e),n=O[t];return void 0===n?D:n}var M,F=function(e){if(1===I.length&&void 0===e.tokenType.PUSH_MODE){var t=y.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);A.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{I.pop();var n=last(I);_=y.patternIdxToConfig[n],O=y.charCodeToPatternIdxToConfig[n],$=_.length;var r=y.canModeBeOptimized[n]&&!1===y.config.safeMode;R=O&&r?k:P}};function B(e){I.push(e),O=this.charCodeToPatternIdxToConfig[e],_=this.patternIdxToConfig[e],$=_.length,$=_.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;R=O&&t?k:P}for(B.call(this,t);v<g;){o=null;var L=b.charCodeAt(v),j=R(L),U=j.length;for(n=0;n<U;n++){var z=(M=j[n]).pattern;if(s=null,!1!==(Q=M.short)?L===Q&&(o=z):!0===M.isCustom?null!==(h=z.exec(b,v,N,x))?(o=h[0],void 0!==h.payload&&(s=h.payload)):o=null:(this.updateLastIndex(z,v),o=this.match(z,e,v)),null!==o){if(void 0!==(i=M.longerAlt)){var H=_[i],G=H.pattern;l=null,!0===H.isCustom?null!==(h=G.exec(b,v,N,x))?(a=h[0],void 0!==h.payload&&(l=h.payload)):a=null:(this.updateLastIndex(G,v),a=this.match(G,e,v)),a&&a.length>o.length&&(o=a,s=l,M=H)}break}}if(null!==o){if(u=o.length,void 0!==(c=M.group)&&(p=M.tokenTypeIdx,d=this.createTokenInstance(o,v,p,M.tokenType,S,w,u),this.handlePayload(d,s),!1===c?T=this.addToken(N,T,d):x[c].push(d)),e=this.chopInput(e,u),v+=u,w=this.computeNewColumn(w,u),!0===V&&!0===M.canLineTerminator){var W=0,q=void 0,K=void 0;E.lastIndex=0;do{!0===(q=E.test(o))&&(K=E.lastIndex-1,W++)}while(!0===q);0!==W&&(S+=W,w=u-K,this.updateTokenEndLineColumnLocation(d,c,K,W,S,w,u))}this.handleModes(M,F,B,d)}else{for(var X=v,Y=S,Z=w,J=!1;!J&&v<g;)for(b.charCodeAt(v),e=this.chopInput(e,1),v++,r=0;r<$;r++){var Q,ee=_[r];z=ee.pattern;if(!1!==(Q=ee.short)?b.charCodeAt(v)===Q&&(J=!0):!0===ee.isCustom?J=null!==z.exec(b,v,N,x):(this.updateLastIndex(z,v),J=null!==z.exec(e)),!0===J)break}m=v-X,f=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,X,m,Y,Z),A.push({offset:X,line:Y,column:Z,length:m,message:f})}}return this.hasCustom||(N.length=T),{tokens:N,groups:x,errors:A}},e.prototype.handleModes=function(e,t,n,r){if(!0===e.pop){var a=e.push;t(r),void 0!==a&&n.call(this,a)}else void 0!==e.push&&n.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,n,r,a,i,o){var s,l;void 0!==t&&(l=(s=n===o-1)?-1:0,1===r&&!0===s||(e.endLine=a+l,e.endColumn=i-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,n,r){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:r}},e.prototype.createStartOnlyToken=function(e,t,n,r,a,i){return{image:e,startOffset:t,startLine:a,startColumn:i,tokenTypeIdx:n,tokenType:r}},e.prototype.createFullToken=function(e,t,n,r,a,i,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:a,endLine:a,startColumn:i,endColumn:i+o-1,tokenTypeIdx:n,tokenType:r}},e.prototype.addToken=function(e,t,n){return 666},e.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},e.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,++t},e.prototype.handlePayload=function(e,t){},e.prototype.handlePayloadNoCustom=function(e,t){},e.prototype.handlePayloadWithCustom=function(e,t){null!==t&&(e.payload=t)},e.prototype.match=function(e,t,n){return null},e.prototype.matchWithTest=function(e,t,n){return!0===e.test(t)?t.substring(n,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var n=e.exec(t);return null!==n?n[0]:n},e.prototype.TRACE_INIT=function(e,t){if(!0===this.traceInitPerf){this.traceInitIndent++;var n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(n+"--\x3e <"+e+">");var r=timer(t),a=r.time,i=r.value,o=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(n+"<-- <"+e+"> time: "+a+"ms"),this.traceInitIndent--,i}return t()},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();function tokenLabel(e){return hasTokenLabel(e)?e.LABEL:e.name}function hasTokenLabel(e){return isString$1(e.LABEL)&&""!==e.LABEL}var PARENT="parent",CATEGORIES="categories",LABEL="label",GROUP="group",PUSH_MODE="push_mode",POP_MODE="pop_mode",LONGER_ALT="longer_alt",LINE_BREAKS="line_breaks",START_CHARS_HINT="start_chars_hint";function createToken(e){return createTokenInternal(e)}function createTokenInternal(e){var t=e.pattern,n={};if(n.name=e.name,isUndefined$1(t)||(n.PATTERN=t),has(e,PARENT))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return has(e,CATEGORIES)&&(n.CATEGORIES=e[CATEGORIES]),augmentTokenTypes([n]),has(e,LABEL)&&(n.LABEL=e[LABEL]),has(e,GROUP)&&(n.GROUP=e[GROUP]),has(e,POP_MODE)&&(n.POP_MODE=e[POP_MODE]),has(e,PUSH_MODE)&&(n.PUSH_MODE=e[PUSH_MODE]),has(e,LONGER_ALT)&&(n.LONGER_ALT=e[LONGER_ALT]),has(e,LINE_BREAKS)&&(n.LINE_BREAKS=e[LINE_BREAKS]),has(e,START_CHARS_HINT)&&(n.START_CHARS_HINT=e[START_CHARS_HINT]),n}var EOF=createToken({name:"EOF",pattern:Lexer.NA});function createTokenInstance(e,t,n,r,a,i,o,s){return{image:t,startOffset:n,endOffset:r,startLine:a,endLine:i,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function tokenMatcher(e,t){return tokenStructuredMatcher(e,t)}augmentTokenTypes([EOF]);var __extends$8=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),AbstractProduction=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),forEach$1(this.definition,(function(t){t.accept(e)}))},e}(),NonTerminal=function(e){function t(t){var n=e.call(this,[])||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(AbstractProduction),Rule=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.orgText="",assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),Flat=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.ignoreAmbiguities=!1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),Option=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),RepetitionMandatory=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),RepetitionMandatoryWithSeparator=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),Repetition=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),RepetitionWithSeparator=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),Alternation=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,n.ignoreAmbiguities=!1,n.hasPredicates=!1,assign(n,pick(t,(function(e){return void 0!==e}))),n}return __extends$8(t,e),t}(AbstractProduction),Terminal=function(){function e(e){this.idx=1,assign(this,pick(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function serializeGrammar(e){return map(e,serializeProduction)}function serializeProduction(e){function t(e){return map(e,serializeProduction)}if(e instanceof NonTerminal)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof Flat)return{type:"Flat",definition:t(e.definition)};if(e instanceof Option)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof RepetitionMandatory)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof RepetitionMandatoryWithSeparator)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:serializeProduction(new Terminal({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof RepetitionWithSeparator)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:serializeProduction(new Terminal({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Repetition)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof Alternation)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof Terminal){var n={type:"Terminal",name:e.terminalType.name,label:tokenLabel(e.terminalType),idx:e.idx},r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=isRegExp(r)?r.source:r),n}if(e instanceof Rule)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}var RestWalker=function(){function e(){}return e.prototype.walk=function(e,t){var n=this;void 0===t&&(t=[]),forEach$1(e.definition,(function(r,a){var i=drop(e.definition,a+1);if(r instanceof NonTerminal)n.walkProdRef(r,i,t);else if(r instanceof Terminal)n.walkTerminal(r,i,t);else if(r instanceof Flat)n.walkFlat(r,i,t);else if(r instanceof Option)n.walkOption(r,i,t);else if(r instanceof RepetitionMandatory)n.walkAtLeastOne(r,i,t);else if(r instanceof RepetitionMandatoryWithSeparator)n.walkAtLeastOneSep(r,i,t);else if(r instanceof RepetitionWithSeparator)n.walkManySep(r,i,t);else if(r instanceof Repetition)n.walkMany(r,i,t);else{if(!(r instanceof Alternation))throw Error("non exhaustive match");n.walkOr(r,i,t)}}))},e.prototype.walkTerminal=function(e,t,n){},e.prototype.walkProdRef=function(e,t,n){},e.prototype.walkFlat=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkOption=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkAtLeastOne=function(e,t,n){var r=[new Option({definition:e.definition})].concat(t,n);this.walk(e,r)},e.prototype.walkAtLeastOneSep=function(e,t,n){var r=restForRepetitionWithSeparator(e,t,n);this.walk(e,r)},e.prototype.walkMany=function(e,t,n){var r=[new Option({definition:e.definition})].concat(t,n);this.walk(e,r)},e.prototype.walkManySep=function(e,t,n){var r=restForRepetitionWithSeparator(e,t,n);this.walk(e,r)},e.prototype.walkOr=function(e,t,n){var r=this,a=t.concat(n);forEach$1(e.definition,(function(e){var t=new Flat({definition:[e]});r.walk(t,a)}))},e}();function restForRepetitionWithSeparator(e,t,n){return[new Option({definition:[new Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}var GAstVisitor=function(){function e(){}return e.prototype.visit=function(e){var t=e;switch(t.constructor){case NonTerminal:return this.visitNonTerminal(t);case Flat:return this.visitFlat(t);case Option:return this.visitOption(t);case RepetitionMandatory:return this.visitRepetitionMandatory(t);case RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(t);case RepetitionWithSeparator:return this.visitRepetitionWithSeparator(t);case Repetition:return this.visitRepetition(t);case Alternation:return this.visitAlternation(t);case Terminal:return this.visitTerminal(t);case Rule:return this.visitRule(t);default:throw Error("non exhaustive match")}},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}(),__extends$7=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function isSequenceProd(e){return e instanceof Flat||e instanceof Option||e instanceof Repetition||e instanceof RepetitionMandatory||e instanceof RepetitionMandatoryWithSeparator||e instanceof RepetitionWithSeparator||e instanceof Terminal||e instanceof Rule}function isOptionalProd(e,t){return void 0===t&&(t=[]),!!(e instanceof Option||e instanceof Repetition||e instanceof RepetitionWithSeparator)||(e instanceof Alternation?some(e.definition,(function(e){return isOptionalProd(e,t)})):!(e instanceof NonTerminal&&contains(t,e))&&(e instanceof AbstractProduction&&(e instanceof NonTerminal&&t.push(e),every(e.definition,(function(e){return isOptionalProd(e,t)})))))}function isBranchingProd(e){return e instanceof Alternation}function getProductionDslName(e){if(e instanceof NonTerminal)return"SUBRULE";if(e instanceof Option)return"OPTION";if(e instanceof Alternation)return"OR";if(e instanceof RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof RepetitionWithSeparator)return"MANY_SEP";if(e instanceof Repetition)return"MANY";if(e instanceof Terminal)return"CONSUME";throw Error("non exhaustive match")}var DslMethodsCollectorVisitor=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return __extends$7(t,e),t.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},t.prototype.visitTerminal=function(e){var t=e.terminalType.name+this.separator+"Terminal";has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(GAstVisitor),collectorVisitor=new DslMethodsCollectorVisitor;function collectMethods(e){collectorVisitor.reset(),e.accept(collectorVisitor);var t=collectorVisitor.dslMethods;return collectorVisitor.reset(),t}function first(e){if(e instanceof NonTerminal)return first(e.referencedRule);if(e instanceof Terminal)return firstForTerminal(e);if(isSequenceProd(e))return firstForSequence(e);if(isBranchingProd(e))return firstForBranching(e);throw Error("non exhaustive match")}function firstForSequence(e){for(var t,n=[],r=e.definition,a=0,i=r.length>a,o=!0;i&&o;)o=isOptionalProd(t=r[a]),n=n.concat(first(t)),a+=1,i=r.length>a;return uniq(n)}function firstForBranching(e){return uniq(flatten(map(e.definition,(function(e){return first(e)}))))}function firstForTerminal(e){return[e.terminalType]}var IN="_~IN~_",__extends$6=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ResyncFollowsWalker=function(e){function t(t){var n=e.call(this)||this;return n.topProd=t,n.follows={},n}return __extends$6(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,n){},t.prototype.walkProdRef=function(e,t,n){var r=buildBetweenProdsFollowPrefix(e.referencedRule,e.idx)+this.topProd.name,a=t.concat(n),i=first(new Flat({definition:a}));this.follows[r]=i},t}(RestWalker);function computeAllProdsFollows(e){var t={};return forEach$1(e,(function(e){var n=new ResyncFollowsWalker(e).startWalking();assign(t,n)})),t}function buildBetweenProdsFollowPrefix(e,t){return e.name+t+IN}var BITS_FOR_METHOD_TYPE=4,BITS_FOR_OCCURRENCE_IDX=8,BITS_FOR_ALT_IDX=8,OR_IDX=1<<BITS_FOR_OCCURRENCE_IDX,OPTION_IDX=2<<BITS_FOR_OCCURRENCE_IDX,MANY_IDX=3<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_IDX=4<<BITS_FOR_OCCURRENCE_IDX,MANY_SEP_IDX=5<<BITS_FOR_OCCURRENCE_IDX,AT_LEAST_ONE_SEP_IDX=6<<BITS_FOR_OCCURRENCE_IDX;function getKeyForAutomaticLookahead(e,t,n){return n|t|e}var BITS_START_FOR_ALT_IDX=32-BITS_FOR_ALT_IDX;function getKeyForAltIndex(e,t,n,r){var a=r+1<<BITS_START_FOR_ALT_IDX;return getKeyForAutomaticLookahead(e,t,n)|a}var __extends$5=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function setNodeLocationOnlyOffset(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset)}function setNodeLocationFull(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function addTerminalToCst(e,t,n){void 0===e.children[n]?e.children[n]=[t]:e.children[n].push(t)}function addNoneTerminalToCst(e,t,n){void 0===e.children[t]?e.children[t]=[n]:e.children[t].push(n)}var NamedDSLMethodsCollectorVisitor=function(e){function t(t){var n=e.call(this)||this;return n.result=[],n.ruleIdx=t,n}return __extends$5(t,e),t.prototype.collectNamedDSLMethod=function(e,t,n){if(!isUndefined$1(e.name)){var r=void 0;if(e instanceof Option||e instanceof Repetition||e instanceof RepetitionMandatory||e instanceof Alternation)r=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof RepetitionMandatoryWithSeparator||e instanceof RepetitionWithSeparator))throw Error("non exhaustive match");r=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var a=[r],i=getKeyForAutomaticLookahead(this.ruleIdx,n,e.idx);this.result.push({def:a,key:i,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,Option,OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,Repetition,MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,RepetitionMandatory,AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,RepetitionMandatoryWithSeparator,AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,RepetitionWithSeparator,MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,Alternation,OR_IDX);var n=e.definition.length>1;forEach$1(e.definition,(function(r,a){if(!isUndefined$1(r.name)){var i=r.definition;i=n?[new Option({definition:r.definition})]:r.definition;var o=getKeyForAltIndex(t.ruleIdx,OR_IDX,e.idx,a);t.result.push({def:i,key:o,name:r.name,orgProd:r})}}))},t}(GAstVisitor);function expandAllNestedRuleNames(e,t){var n={allRuleNames:[]};return forEach$1(e,(function(e){var r=t[e.name];n.allRuleNames.push(e.name);var a=new NamedDSLMethodsCollectorVisitor(r);e.accept(a),forEach$1(a.result,(function(t){t.def,t.key;var r=t.name;n.allRuleNames.push(e.name+r)}))})),n}var __extends$4=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),AbstractNextPossibleTokensWalker=function(e){function t(t,n){var r=e.call(this)||this;return r.topProd=t,r.path=n,r.possibleTokTypes=[],r.nextProductionName="",r.nextProductionOccurrence=0,r.found=!1,r.isAtEndOfPath=!1,r}return __extends$4(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,n){void 0===n&&(n=[]),this.found||e.prototype.walk.call(this,t,n)},t.prototype.walkProdRef=function(e,t,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var r=t.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,r)}},t.prototype.updateExpectedNext=function(){isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(RestWalker),NextAfterTokenWalker=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.path=n,r.nextTerminalName="",r.nextTerminalOccurrence=0,r.nextTerminalName=r.path.lastTok.name,r.nextTerminalOccurrence=r.path.lastTokOccurrence,r}return __extends$4(t,e),t.prototype.walkTerminal=function(e,t,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var r=t.concat(n),a=new Flat({definition:r});this.possibleTokTypes=first(a),this.found=!0}},t}(AbstractNextPossibleTokensWalker),AbstractNextTerminalAfterProductionWalker=function(e){function t(t,n){var r=e.call(this)||this;return r.topRule=t,r.occurrence=n,r.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},r}return __extends$4(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(RestWalker),NextTerminalAfterManyWalker=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),t.prototype.walkMany=function(t,n,r){if(t.idx===this.occurrence){var a=first$1(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkMany.call(this,t,n,r)},t}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterManySepWalker=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),t.prototype.walkManySep=function(t,n,r){if(t.idx===this.occurrence){var a=first$1(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkManySep.call(this,t,n,r)},t}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneWalker=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),t.prototype.walkAtLeastOne=function(t,n,r){if(t.idx===this.occurrence){var a=first$1(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOne.call(this,t,n,r)},t}(AbstractNextTerminalAfterProductionWalker),NextTerminalAfterAtLeastOneSepWalker=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$4(t,e),t.prototype.walkAtLeastOneSep=function(t,n,r){if(t.idx===this.occurrence){var a=first$1(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,n,r)},t}(AbstractNextTerminalAfterProductionWalker);function possiblePathsFrom(e,t,n){void 0===n&&(n=[]),n=cloneArr(n);var r=[],a=0;function i(i){var o=possiblePathsFrom(i.concat(drop(e,a+1)),t,n);return r.concat(o)}for(;n.length<t&&a<e.length;){var o=e[a];if(o instanceof Flat)return i(o.definition);if(o instanceof NonTerminal)return i(o.definition);if(o instanceof Option)r=i(o.definition);else{if(o instanceof RepetitionMandatory)return i(s=o.definition.concat([new Repetition({definition:o.definition})]));if(o instanceof RepetitionMandatoryWithSeparator)return i(s=[new Flat({definition:o.definition}),new Repetition({definition:[new Terminal({terminalType:o.separator})].concat(o.definition)})]);if(o instanceof RepetitionWithSeparator){var s=o.definition.concat([new Repetition({definition:[new Terminal({terminalType:o.separator})].concat(o.definition)})]);r=i(s)}else if(o instanceof Repetition){s=o.definition.concat([new Repetition({definition:o.definition})]);r=i(s)}else{if(o instanceof Alternation)return forEach$1(o.definition,(function(e){r=i(e.definition)})),r;if(!(o instanceof Terminal))throw Error("non exhaustive match");n.push(o.terminalType)}}a++}return r.push({partialPath:n,suffixDef:drop(e,a)}),r}function nextPossibleTokensAfter(e,t,n,r){var a="EXIT_NONE_TERMINAL",i=[a],o="EXIT_ALTERNATIVE",s=!1,l=t.length,u=l-r-1,c=[],p=[];for(p.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!isEmpty(p);){var d=p.pop();if(d!==o){var m=d.def,f=d.idx,h=d.ruleStack,y=d.occurrenceStack;if(!isEmpty(m)){var b=m[0];if(b===a){var g={idx:f,def:drop(m),ruleStack:dropRight(h),occurrenceStack:dropRight(y)};p.push(g)}else if(b instanceof Terminal)if(f<l-1){var v=f+1;if(n(t[v],b.terminalType)){g={idx:v,def:drop(m),ruleStack:h,occurrenceStack:y};p.push(g)}}else{if(f!==l-1)throw Error("non exhaustive match");c.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:h,occurrenceStack:y}),s=!0}else if(b instanceof NonTerminal){var T=cloneArr(h);T.push(b.nonTerminalName);var C=cloneArr(y);C.push(b.idx);g={idx:f,def:b.definition.concat(i,drop(m)),ruleStack:T,occurrenceStack:C};p.push(g)}else if(b instanceof Option){var N={idx:f,def:drop(m),ruleStack:h,occurrenceStack:y};p.push(N),p.push(o);var A={idx:f,def:b.definition.concat(drop(m)),ruleStack:h,occurrenceStack:y};p.push(A)}else if(b instanceof RepetitionMandatory){var S=new Repetition({definition:b.definition,idx:b.idx});g={idx:f,def:b.definition.concat([S],drop(m)),ruleStack:h,occurrenceStack:y};p.push(g)}else if(b instanceof RepetitionMandatoryWithSeparator){var w=new Terminal({terminalType:b.separator});S=new Repetition({definition:[w].concat(b.definition),idx:b.idx}),g={idx:f,def:b.definition.concat([S],drop(m)),ruleStack:h,occurrenceStack:y};p.push(g)}else if(b instanceof RepetitionWithSeparator){N={idx:f,def:drop(m),ruleStack:h,occurrenceStack:y};p.push(N),p.push(o);w=new Terminal({terminalType:b.separator});var x=new Repetition({definition:[w].concat(b.definition),idx:b.idx});A={idx:f,def:b.definition.concat([x],drop(m)),ruleStack:h,occurrenceStack:y};p.push(A)}else if(b instanceof Repetition){N={idx:f,def:drop(m),ruleStack:h,occurrenceStack:y};p.push(N),p.push(o);x=new Repetition({definition:b.definition,idx:b.idx}),A={idx:f,def:b.definition.concat([x],drop(m)),ruleStack:h,occurrenceStack:y};p.push(A)}else if(b instanceof Alternation)for(var V=b.definition.length-1;V>=0;V--){var E={idx:f,def:b.definition[V].definition.concat(drop(m)),ruleStack:h,occurrenceStack:y};p.push(E),p.push(o)}else if(b instanceof Flat)p.push({idx:f,def:b.definition.concat(drop(m)),ruleStack:h,occurrenceStack:y});else{if(!(b instanceof Rule))throw Error("non exhaustive match");p.push(expandTopLevelRule(b,f,h,y))}}}else s&&last(p).idx<=u&&p.pop()}return c}function expandTopLevelRule(e,t,n,r){var a=cloneArr(n);a.push(e.name);var i=cloneArr(r);return i.push(1),{idx:t,def:e.definition,ruleStack:a,occurrenceStack:i}}var __extends$3=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),PROD_TYPE;function getProdType(e){if(e instanceof Option)return PROD_TYPE.OPTION;if(e instanceof Repetition)return PROD_TYPE.REPETITION;if(e instanceof RepetitionMandatory)return PROD_TYPE.REPETITION_MANDATORY;if(e instanceof RepetitionMandatoryWithSeparator)return PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof RepetitionWithSeparator)return PROD_TYPE.REPETITION_WITH_SEPARATOR;if(e instanceof Alternation)return PROD_TYPE.ALTERNATION;throw Error("non exhaustive match")}function buildLookaheadFuncForOr(e,t,n,r,a,i){var o=getLookaheadPathsForOr(e,t,n);return i(o,r,areTokenCategoriesNotUsed(o)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher,a)}function buildLookaheadFuncForOptionalProd(e,t,n,r,a,i){var o=getLookaheadPathsForOptionalProd(e,t,a,n),s=areTokenCategoriesNotUsed(o)?tokenStructuredMatcherNoCategories:tokenStructuredMatcher;return i(o[0],s,r)}function buildAlternativesLookAheadFunc(e,t,n,r){var a=e.length,i=every(e,(function(e){return every(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var r=map(t,(function(e){return e.GATE})),i=0;i<a;i++){var o=e[i],s=o.length,l=r[i];if(void 0===l||!1!==l.call(this))e:for(var u=0;u<s;u++){for(var c=o[u],p=c.length,d=0;d<p;d++){var m=this.LA(d+1);if(!1===n(m,c[d]))continue e}return i}}};if(i&&!r){var o=reduce(map(e,(function(e){return flatten(e)})),(function(e,t,n){return forEach$1(t,(function(t){has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=n),forEach$1(t.categoryMatches,(function(t){has(e,t)||(e[t]=n)}))})),e}),[]);return function(){var e=this.LA(1);return o[e.tokenTypeIdx]}}return function(){for(var t=0;t<a;t++){var r=e[t],i=r.length;e:for(var o=0;o<i;o++){for(var s=r[o],l=s.length,u=0;u<l;u++){var c=this.LA(u+1);if(!1===n(c,s[u]))continue e}return t}}}}function buildSingleAlternativeLookaheadFunction(e,t,n){var r=every(e,(function(e){return 1===e.length})),a=e.length;if(r&&!n){var i=flatten(e);if(1===i.length&&isEmpty(i[0].categoryMatches)){var o=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}var s=reduce(i,(function(e,t,n){return e[t.tokenTypeIdx]=!0,forEach$1(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===s[e.tokenTypeIdx]}}return function(){e:for(var n=0;n<a;n++){for(var r=e[n],i=r.length,o=0;o<i;o++){var s=this.LA(o+1);if(!1===t(s,r[o]))continue e}return!0}return!1}}!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(PROD_TYPE||(PROD_TYPE={}));var RestDefinitionFinderWalker=function(e){function t(t,n,r){var a=e.call(this)||this;return a.topProd=t,a.targetOccurrence=n,a.targetProdType=r,a}return __extends$3(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,n,r){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=n.concat(r),!0)},t.prototype.walkOption=function(t,n,r){this.checkIsTarget(t,PROD_TYPE.OPTION,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkAtLeastOne=function(t,n,r){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkAtLeastOneSep=function(t,n,r){this.checkIsTarget(t,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkMany=function(t,n,r){this.checkIsTarget(t,PROD_TYPE.REPETITION,n,r)||e.prototype.walkOption.call(this,t,n,r)},t.prototype.walkManySep=function(t,n,r){this.checkIsTarget(t,PROD_TYPE.REPETITION_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},t}(RestWalker),InsideDefinitionFinderVisitor=function(e){function t(t,n,r){var a=e.call(this)||this;return a.targetOccurrence=t,a.targetProdType=n,a.targetRef=r,a.result=[],a}return __extends$3(t,e),t.prototype.checkIsTarget=function(e,t){e.idx!==this.targetOccurrence||this.targetProdType!==t||void 0!==this.targetRef&&e!==this.targetRef||(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,PROD_TYPE.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,PROD_TYPE.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,PROD_TYPE.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,PROD_TYPE.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,PROD_TYPE.ALTERNATION)},t}(GAstVisitor);function initializeArrayOfArrays(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=[];return t}function pathToHashKeys(e){for(var t=[""],n=0;n<e.length;n++){for(var r=e[n],a=[],i=0;i<t.length;i++){var o=t[i];a.push(o+"_"+r.tokenTypeIdx);for(var s=0;s<r.categoryMatches.length;s++){var l="_"+r.categoryMatches[s];a.push(o+l)}}t=a}return t}function isUniquePrefixHash(e,t,n){for(var r=0;r<e.length;r++)if(r!==n)for(var a=e[r],i=0;i<t.length;i++){if(!0===a[t[i]])return!1}return!0}function lookAheadSequenceFromAlternatives(e,t){for(var n=map(e,(function(e){return possiblePathsFrom([e],1)})),r=initializeArrayOfArrays(n.length),a=map(n,(function(e){var t={};return forEach$1(e,(function(e){forEach$1(pathToHashKeys(e.partialPath),(function(e){t[e]=!0}))})),t})),i=n,o=1;o<=t;o++){var s=i;i=initializeArrayOfArrays(s.length);for(var l=function(e){for(var n=s[e],l=0;l<n.length;l++){var u=n[l].partialPath,c=n[l].suffixDef,p=pathToHashKeys(u);if(isUniquePrefixHash(a,p,e)||isEmpty(c)||u.length===t){var d=r[e];if(!1===containsPath(d,u)){d.push(u);for(var m=0;m<p.length;m++){var f=p[m];a[e][f]=!0}}}else{var h=possiblePathsFrom(c,o+1,u);i[e]=i[e].concat(h),forEach$1(h,(function(t){forEach$1(pathToHashKeys(t.partialPath),(function(t){a[e][t]=!0}))}))}}},u=0;u<s.length;u++)l(u)}return r}function getLookaheadPathsForOr(e,t,n,r){var a=new InsideDefinitionFinderVisitor(e,PROD_TYPE.ALTERNATION,r);return t.accept(a),lookAheadSequenceFromAlternatives(a.result,n)}function getLookaheadPathsForOptionalProd(e,t,n,r){var a=new InsideDefinitionFinderVisitor(e,n);t.accept(a);var i=a.result,o=new RestDefinitionFinderWalker(t,e,n).startWalking();return lookAheadSequenceFromAlternatives([new Flat({definition:i}),new Flat({definition:o})],r)}function containsPath(e,t){e:for(var n=0;n<e.length;n++){var r=e[n];if(r.length===t.length){for(var a=0;a<r.length;a++){var i=t[a],o=r[a];if(!1===(i===o||void 0!==o.categoryMatchesMap[i.tokenTypeIdx]))continue e}return!0}}return!1}function isStrictPrefixOfPath(e,t){return e.length<t.length&&every(e,(function(e,n){var r=t[n];return e===r||r.categoryMatchesMap[e.tokenTypeIdx]}))}function areTokenCategoriesNotUsed(e){return every(e,(function(e){return every(e,(function(e){return every(e,(function(e){return isEmpty(e.categoryMatches)}))}))}))}var __extends$2=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function validateGrammar$1(e,t,n,r,a,i){var o=map(e,(function(e){return validateDuplicateProductions(e,a)})),s=map(e,(function(e){return validateNoLeftRecursion(e,e,a)})),l=[],u=[],c=[];every(s,isEmpty)&&(l=map(e,(function(e){return validateEmptyOrAlternative(e,a)})),u=map(e,(function(e){return validateAmbiguousAlternationAlternatives(e,t,r,a)})),c=validateSomeNonEmptyLookaheadPath(e,t,a));var p=checkTerminalAndNoneTerminalsNameSpace(e,n,a),d=map(n,(function(e){return validateTokenName(e,a)})),m=validateNestedRulesNames(e,a),f=validateDuplicateNestedRules(e,a),h=map(e,(function(e){return validateTooManyAlts(e,a)})),y=map(e,(function(e){return validateRuleName(e,a)})),b=map(e,(function(t){return validateRuleDoesNotAlreadyExist(t,e,i,a)}));return flatten(o.concat(d,m,f,c,s,l,u,p,h,y,b))}function validateNestedRulesNames(e,t){var n=[];return forEach$1(e,(function(e){var r=new NamedDSLMethodsCollectorVisitor("");e.accept(r);var a=map(r.result,(function(e){return e.orgProd}));n.push(map(a,(function(n){return validateNestedRuleName(e,n,t)})))})),flatten(n)}function validateDuplicateProductions(e,t){var n=new OccurrenceValidationCollector;return e.accept(n),map(values(pick(groupBy(n.allProductions,identifyProductionForDuplicates),(function(e){return e.length>1}))),(function(n){var r=first$1(n),a=t.buildDuplicateFoundError(e,n),i=getProductionDslName(r),o={message:a,type:ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:i,occurrence:r.idx},s=getExtraProductionArgument(r);return s&&(o.parameter=s),o}))}function identifyProductionForDuplicates(e){return getProductionDslName(e)+"_#_"+e.idx+"_#_"+getExtraProductionArgument(e)}function getExtraProductionArgument(e){return e instanceof Terminal?e.terminalType.name:e instanceof NonTerminal?e.nonTerminalName:""}var OccurrenceValidationCollector=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return __extends$2(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(GAstVisitor),validTermsPattern=/^[a-zA-Z_]\w*$/,validNestedRuleName=new RegExp(validTermsPattern.source.replace("^","^\\$"));function validateRuleName(e,t){var n=[],r=e.name;return r.match(validTermsPattern)||n.push({message:t.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:r}),n}function validateNestedRuleName(e,t,n){var r,a=[];return t.name.match(validNestedRuleName)||(r=n.buildInvalidNestedRuleNameError(e,t),a.push({message:r,type:ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function validateTokenName(e,t){var n=[];return e.name.match(validTermsPattern)||n.push({message:t.buildTokenNameError({tokenType:e,expectedPattern:validTermsPattern}),type:ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function validateRuleDoesNotAlreadyExist(e,t,n,r){var a=[];if(reduce(t,(function(t,n){return n.name===e.name?t+1:t}),0)>1){var i=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});a.push({message:i,type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return a}function validateRuleIsOverridden(e,t,n){var r,a=[];return contains(t,e)||(r="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+n+"<-as it is not defined in any of the super grammars ",a.push({message:r,type:ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),a}function validateNoLeftRecursion(e,t,n,r){void 0===r&&(r=[]);var a=[],i=getFirstNoneTerminal(t.definition);if(isEmpty(i))return[];var o=e.name;contains(i,e)&&a.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:ParserDefinitionErrorType.LEFT_RECURSION,ruleName:o});var s=map(difference(i,r.concat([e])),(function(t){var a=cloneArr(r);return a.push(t),validateNoLeftRecursion(e,t,n,a)}));return a.concat(flatten(s))}function getFirstNoneTerminal(e){var t=[];if(isEmpty(e))return t;var n=first$1(e);if(n instanceof NonTerminal)t.push(n.referencedRule);else if(n instanceof Flat||n instanceof Option||n instanceof RepetitionMandatory||n instanceof RepetitionMandatoryWithSeparator||n instanceof RepetitionWithSeparator||n instanceof Repetition)t=t.concat(getFirstNoneTerminal(n.definition));else if(n instanceof Alternation)t=flatten(map(n.definition,(function(e){return getFirstNoneTerminal(e.definition)})));else if(!(n instanceof Terminal))throw Error("non exhaustive match");var r=isOptionalProd(n),a=e.length>1;if(r&&a){var i=drop(e);return t.concat(getFirstNoneTerminal(i))}return t}var OrCollector=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return __extends$2(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(GAstVisitor);function validateEmptyOrAlternative(e,t){var n=new OrCollector;return e.accept(n),reduce(n.alternations,(function(n,r){var a=map(dropRight(r.definition),(function(n,a){return isEmpty(nextPossibleTokensAfter([n],[],null,1))?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:r,emptyChoiceIdx:a}),type:ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:r.idx,alternative:a+1}:null}));return n.concat(compact(a))}),[])}function validateAmbiguousAlternationAlternatives(e,t,n,r){var a=new OrCollector;e.accept(a);var i=a.alternations,o=n[e.name];return o&&(i=reject(i,(function(e){return o[getProductionDslName(e)+(0===e.idx?"":e.idx)]}))),reduce(i=reject(i,(function(e){return!0===e.ignoreAmbiguities})),(function(n,a){var i=a.idx,o=a.maxLookahead||t,s=getLookaheadPathsForOr(i,e,o,a),l=checkAlternativesAmbiguities(s,a,e,r),u=checkPrefixAlternativesAmbiguities(s,a,e,r);return n.concat(l,u)}),[])}var RepetionCollector=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return __extends$2(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(GAstVisitor);function validateTooManyAlts(e,t){var n=new OrCollector;return e.accept(n),reduce(n.alternations,(function(n,r){return r.definition.length>255&&n.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:r}),type:ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:r.idx}),n}),[])}function validateSomeNonEmptyLookaheadPath(e,t,n){var r=[];return forEach$1(e,(function(e){var a=new RepetionCollector;e.accept(a),forEach$1(a.allProductions,(function(a){var i=getProdType(a),o=a.maxLookahead||t;if(isEmpty(flatten(getLookaheadPathsForOptionalProd(a.idx,e,i,o)[0]))){var s=n.buildEmptyRepetitionError({topLevelRule:e,repetition:a});r.push({message:s,type:ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),r}function checkAlternativesAmbiguities(e,t,n,r){var a=[];return map(reduce(e,(function(n,r,i){return!0===t.definition[i].ignoreAmbiguities||forEach$1(r,(function(r){var o=[i];forEach$1(e,(function(e,n){i!==n&&containsPath(e,r)&&!0!==t.definition[n].ignoreAmbiguities&&o.push(n)})),o.length>1&&!containsPath(a,r)&&(a.push(r),n.push({alts:o,path:r}))})),n}),[]),(function(e){var a=map(e.alts,(function(e){return e+1}));return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:a,prefixPath:e.path}),type:ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:[e.alts]}}))}function checkPrefixAlternativesAmbiguities(e,t,n,r){var a=[],i=reduce(e,(function(e,t,n){var r=map(t,(function(e){return{idx:n,path:e}}));return e.concat(r)}),[]);return forEach$1(i,(function(e){if(!0!==t.definition[e.idx].ignoreAmbiguities){var o=e.idx,s=e.path,l=map(findAll(i,(function(e){return!0!==t.definition[e.idx].ignoreAmbiguities&&e.idx<o&&isStrictPrefixOfPath(e.path,s)})),(function(e){var a=[e.idx+1,o+1],i=0===t.idx?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:a,prefixPath:e.path}),type:ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:i,alternatives:a}}));a=a.concat(l)}})),a}function checkTerminalAndNoneTerminalsNameSpace(e,t,n){var r=[],a=map(t,(function(e){return e.name}));return forEach$1(e,(function(e){var t=e.name;if(contains(a,t)){var i=n.buildNamespaceConflictError(e);r.push({message:i,type:ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),r}function validateDuplicateNestedRules(e,t){var n=[];return forEach$1(e,(function(e){var r=new NamedDSLMethodsCollectorVisitor("");e.accept(r),forEach$1(values(pick(groupBy(r.result,(function(e){return e.name})),(function(e){return e.length>1}))),(function(r){var a=map(r,(function(e){return e.orgProd})),i=t.buildDuplicateNestedRuleNameError(e,a);n.push({message:i,type:ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})}))})),n}var defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,n=e.actual;return e.previous,e.ruleName,"Expecting "+(hasTokenLabel(t)?"--\x3e "+tokenLabel(t)+" <--":"token of type --\x3e "+t.name+" <--")+" but found --\x3e '"+n.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,n=e.actual;e.previous;var r=e.customUserDescription;e.ruleName;var a="Expecting: ",i="\nbut found: '"+first$1(n).image+"'";if(r)return a+r+i;var o=map(reduce(t,(function(e,t){return e.concat(t)}),[]),(function(e){return"["+map(e,(function(e){return tokenLabel(e)})).join(", ")+"]"}));return a+("one of these possible Token sequences:\n"+map(o,(function(e,t){return"  "+(t+1)+". "+e})).join("\n"))+i},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,n=e.actual,r=e.customUserDescription;e.ruleName;var a="Expecting: ",i="\nbut found: '"+first$1(n).image+"'";return r?a+r+i:a+("expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+map(t,(function(e){return"["+map(e,(function(e){return tokenLabel(e)})).join(",")+"]"})).join(" ,")+">")+i}};Object.freeze(defaultParserErrorProvider);var defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var n,r=e.name,a=first$1(t),i=a.idx,o=getProductionDslName(a),s=(n=a)instanceof Terminal?n.terminalType.name:n instanceof NonTerminal?n.nonTerminalName:"",l="->"+o+(i>0?i:"")+"<- "+(s?"with argument: ->"+s+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+r+"<-.                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return l=(l=l.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+first$1(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=map(e.prefixPath,(function(e){return tokenLabel(e)})).join(", "),n=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+n+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=map(e.prefixPath,(function(e){return tokenLabel(e)})).join(", "),n=0===e.alternation.idx?"":e.alternation.idx,r="Ambiguous Alternatives Detected: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+n+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n";return r+="See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(e){var t=getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+e.tokenType.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+(t+" --\x3e "+map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e "))+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}},__extends$1=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function resolveGrammar$1(e,t){var n=new GastRefResolverVisitor(e,t);return n.resolveRefs(),n.errors}var GastRefResolverVisitor=function(e){function t(t,n){var r=e.call(this)||this;return r.nameToTopRule=t,r.errMsgProvider=n,r.errors=[],r}return __extends$1(t,e),t.prototype.resolveRefs=function(){var e=this;forEach$1(values(this.nameToTopRule),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(GAstVisitor);function resolveGrammar(e){e=defaults$4(e,{errMsgProvider:defaultGrammarResolverErrorProvider});var t={};return forEach$1(e.rules,(function(e){t[e.name]=e})),resolveGrammar$1(t,e.errMsgProvider)}function validateGrammar(e){return validateGrammar$1((e=defaults$4(e,{errMsgProvider:defaultGrammarValidatorErrorProvider,ignoredIssues:{}})).rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)}var MISMATCHED_TOKEN_EXCEPTION="MismatchedTokenException",NO_VIABLE_ALT_EXCEPTION="NoViableAltException",EARLY_EXIT_EXCEPTION="EarlyExitException",NOT_ALL_INPUT_PARSED_EXCEPTION="NotAllInputParsedException",RECOGNITION_EXCEPTION_NAMES=[MISMATCHED_TOKEN_EXCEPTION,NO_VIABLE_ALT_EXCEPTION,EARLY_EXIT_EXCEPTION,NOT_ALL_INPUT_PARSED_EXCEPTION];function isRecognitionException(e){return contains(RECOGNITION_EXCEPTION_NAMES,e.name)}function MismatchedTokenException(e,t,n){this.name=MISMATCHED_TOKEN_EXCEPTION,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}function NoViableAltException(e,t,n){this.name=NO_VIABLE_ALT_EXCEPTION,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}function NotAllInputParsedException(e,t){this.name=NOT_ALL_INPUT_PARSED_EXCEPTION,this.message=e,this.token=t,this.resyncedTokens=[]}function EarlyExitException(e,t,n){this.name=EARLY_EXIT_EXCEPTION,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}Object.freeze(RECOGNITION_EXCEPTION_NAMES),MismatchedTokenException.prototype=Error.prototype,NoViableAltException.prototype=Error.prototype,NotAllInputParsedException.prototype=Error.prototype,EarlyExitException.prototype=Error.prototype;var EOF_FOLLOW_KEY={},IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";function InRuleRecoveryException(e){this.name=IN_RULE_RECOVERY_EXCEPTION,this.message=e}InRuleRecoveryException.prototype=Error.prototype;var Recoverable=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=has(e,"recoveryEnabled")?e.recoveryEnabled:DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=attemptInRepetitionRecovery)},e.prototype.getTokenToInsert=function(e){var t=createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,n,r){for(var a=this,i=this.findReSyncTokenType(),o=this.exportLexerState(),s=[],l=!1,u=this.LA(1),c=this.LA(1),p=function(){var e=a.LA(0),t=new MismatchedTokenException(a.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:u,previous:e,ruleName:a.getCurrRuleFullName()}),u,a.LA(0));t.resyncedTokens=dropRight(s),a.SAVE_ERROR(t)};!l;){if(this.tokenMatcher(c,r))return void p();if(n.call(this))return p(),void e.apply(this,t);this.tokenMatcher(c,i)?l=!0:(c=this.SKIP_TOKEN(),this.addToResyncTokens(c,s))}this.importLexerState(o)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,n){return!1!==n&&(void 0!==e&&void 0!==t&&(!this.tokenMatcher(this.LA(1),e)&&(!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new InRuleRecoveryException("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var n=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(isEmpty(t))return!1;var r=this.LA(1);return void 0!==find$1(t,(function(e){return n.tokenMatcher(r,e)}))},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey();return contains(this.getFollowSetFromFollowKey(t),e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),n=2;;){var r=t.tokenType;if(contains(e,r))return r;t=this.LA(n),n++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(t=map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_STACK[t]})),n=map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.RULE_OCCURRENCE_STACK[t]}))),map(t,(function(r,a){return 0===a?EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(r),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(t[a-1])}}))},e.prototype.flattenFollowSet=function(){var e=this;return flatten(map(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)})))},e.prototype.getFollowSetFromFollowKey=function(e){if(e===EOF_FOLLOW_KEY)return[EOF];var t=e.ruleName+e.idxInCallingRule+IN+e.inRule;return this.resyncFollows[t]},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],n=this.LA(1);!1===this.tokenMatcher(n,e);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,n,r,a,i,o){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return isEmpty(this.LAST_EXPLICIT_RULE_STACK)?map(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)})):map(this.LAST_EXPLICIT_RULE_STACK,(function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])}))},e}();function attemptInRepetitionRecovery(e,t,n,r,a,i,o){var s=this.getKeyForAutomaticLookahead(r,a),l=this.firstAfterRepMap[s];if(void 0===l){var u=this.getCurrRuleFullName();l=new i(this.getGAstProductions()[u],a).startWalking(),this.firstAfterRepMap[s]=l}var c=l.token,p=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===c&&(c=EOF,p=1),this.shouldInRepetitionRecoveryBeTried(c,p,o)&&this.tryInRepetitionRecovery(e,t,n,c)}var LooksAhead=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=has(e,"maxLookahead")?e.maxLookahead:DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=isES2015MapSupported()?new Map:[],isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.preComputeLookaheadFunctions=function(e){var t=this;forEach$1(e,(function(e){t.TRACE_INIT(e.name+" Rule Lookahead",(function(){var n=collectMethods(e),r=n.alternation,a=n.repetition,i=n.option,o=n.repetitionMandatory,s=n.repetitionMandatoryWithSeparator,l=n.repetitionWithSeparator;forEach$1(r,(function(n){var r=0===n.idx?"":n.idx;t.TRACE_INIT(""+getProductionDslName(n)+r,(function(){var r=buildLookaheadFuncForOr(n.idx,e,n.maxLookahead||t.maxLookahead,n.hasPredicates,t.dynamicTokensEnabled,t.lookAheadBuilderForAlternatives),a=getKeyForAutomaticLookahead(t.fullRuleNameToShort[e.name],OR_IDX,n.idx);t.setLaFuncCache(a,r)}))})),forEach$1(a,(function(n){t.computeLookaheadFunc(e,n.idx,MANY_IDX,PROD_TYPE.REPETITION,n.maxLookahead,getProductionDslName(n))})),forEach$1(i,(function(n){t.computeLookaheadFunc(e,n.idx,OPTION_IDX,PROD_TYPE.OPTION,n.maxLookahead,getProductionDslName(n))})),forEach$1(o,(function(n){t.computeLookaheadFunc(e,n.idx,AT_LEAST_ONE_IDX,PROD_TYPE.REPETITION_MANDATORY,n.maxLookahead,getProductionDslName(n))})),forEach$1(s,(function(n){t.computeLookaheadFunc(e,n.idx,AT_LEAST_ONE_SEP_IDX,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,n.maxLookahead,getProductionDslName(n))})),forEach$1(l,(function(n){t.computeLookaheadFunc(e,n.idx,MANY_SEP_IDX,PROD_TYPE.REPETITION_WITH_SEPARATOR,n.maxLookahead,getProductionDslName(n))}))}))}))},e.prototype.computeLookaheadFunc=function(e,t,n,r,a,i){var o=this;this.TRACE_INIT(""+i+(0===t?"":t),(function(){var i=buildLookaheadFuncForOptionalProd(t,e,a||o.maxLookahead,o.dynamicTokensEnabled,r,o.lookAheadBuilderForOptional),s=getKeyForAutomaticLookahead(o.fullRuleNameToShort[e.name],n,t);o.setLaFuncCache(s,i)}))},e.prototype.lookAheadBuilderForOptional=function(e,t,n){return buildSingleAlternativeLookaheadFunction(e,t,n)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,n,r){return buildAlternativesLookAheadFunc(e,t,n,r)},e.prototype.getKeyForAutomaticLookahead=function(e,t){return getKeyForAutomaticLookahead(this.getLastExplicitRuleShortName(),e,t)},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();function classNameFromInstance(e){return functionName(e.constructor)}var FUNC_NAME_REGEXP=/^\s*function\s*(\S*)\s*\(/,NAME="name",CstVisitorDefinitionError;function functionName(e){var t=e.name;return t||e.toString().match(FUNC_NAME_REGEXP)[1]}function defineNameProp(e,t){var n=Object.getOwnPropertyDescriptor(e,NAME);return!(!isUndefined$1(n)&&!n.configurable)&&(Object.defineProperty(e,NAME,{enumerable:!1,configurable:!0,writable:!1,value:t}),!0)}function defaultVisit(e,t){for(var n=keys(e),r=n.length,a=0;a<r;a++)for(var i=e[n[a]],o=i.length,s=0;s<o;s++){var l=i[s];void 0===l.tokenTypeIdx&&(void 0!==l.fullName?this[l.fullName](l.children,t):this[l.name](l.children,t))}}function createBaseSemanticVisitorConstructor(e,t){var n=function(){};return defineNameProp(n,e+"BaseSemantics"),(n.prototype={visit:function(e,t){if(isArray$2(e)&&(e=e[0]),!isUndefined$1(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=validateVisitor(this,t);if(!isEmpty(e)){var n=map(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+functionName(this.constructor)+">:\n\t"+n.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=n,n._RULE_NAMES=t,n}function createBaseVisitorConstructorWithDefaults(e,t,n){var r=function(){};defineNameProp(r,e+"BaseSemanticsWithDefaults");var a=Object.create(n.prototype);return forEach$1(t,(function(e){a[e]=defaultVisit})),(r.prototype=a).constructor=r,r}function validateVisitor(e,t){var n=validateMissingCstMethods(e,t),r=validateRedundantMethods(e,t);return n.concat(r)}function validateMissingCstMethods(e,t){return compact(map(t,(function(t){if(!isFunction$1(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+functionName(e.constructor)+" CST Visitor.",type:CstVisitorDefinitionError.MISSING_METHOD,methodName:t}})))}!function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(CstVisitorDefinitionError||(CstVisitorDefinitionError={}));var VALID_PROP_NAMES=["constructor","visit","validateVisitor"];function validateRedundantMethods(e,t){var n=[];for(var r in e)validTermsPattern.test(r)&&isFunction$1(e[r])&&!contains(VALID_PROP_NAMES,r)&&!contains(t,r)&&n.push({msg:"Redundant visitor method: <"+r+"> on "+functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+validTermsPattern.source+"/.",type:CstVisitorDefinitionError.REDUNDANT_METHOD,methodName:r});return n}var TreeBuilder=function(){function e(){}return e.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=has(e,"outputCst")?e.outputCst:DEFAULT_PARSER_CONFIG.outputCst,this.nodeLocationTracking=has(e,"nodeLocationTracking")?e.nodeLocationTracking:DEFAULT_PARSER_CONFIG.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationFull,this.setNodeLocationFromNode=setNodeLocationFull,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=setNodeLocationOnlyOffset,this.setNodeLocationFromNode=setNodeLocationOnlyOffset,this.cstPostRule=NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"');this.setNodeLocationFromToken=NOOP,this.setNodeLocationFromNode=NOOP,this.cstPostRule=NOOP,this.setInitialNodeLocation=NOOP}else this.cstInvocationStateUpdate=NOOP,this.cstFinallyStateUpdate=NOOP,this.cstPostTerminal=NOOP,this.cstPostNonTerminal=NOOP,this.cstPostRule=NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst},e.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},e.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},e.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.cstNestedInvocationStateUpdate=function(e,t){var n={name:e,fullName:this.shortRuleNameToFull[this.getLastExplicitRuleShortName()]+e,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var n={name:e,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},e.prototype.cstPostRuleFull=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset==!0?(n.endOffset=t.endOffset,n.endLine=t.endLine,n.endColumn=t.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)},e.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset==!0?n.endOffset=t.endOffset:n.startOffset=NaN},e.prototype.cstPostTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];addTerminalToCst(n,t,e),this.setNodeLocationFromToken(n.location,t)},e.prototype.cstPostNonTerminal=function(e,t){if(!0!==this.isBackTracking()){var n=this.CST_STACK[this.CST_STACK.length-1];addNoneTerminalToCst(n,t,e),this.setNodeLocationFromNode(n.location,e.location)}},e.prototype.getBaseCstVisitorConstructor=function(){if(isUndefined$1(this.baseCstVisitorConstructor)){var e=createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(isUndefined$1(this.baseCstVisitorWithDefaultsConstructor)){var e=createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var n;return void 0!==e.NAME?(n=e.NAME,this.nestedRuleInvocationStateUpdate(n,t),n):void 0},e.prototype.nestedAltBeforeClause=function(e,t,n,r){var a,i=getKeyForAltIndex(this.getLastExplicitRuleShortName(),n,t,r);return void 0!==e.NAME?(a=e.NAME,this.nestedRuleInvocationStateUpdate(a,i),{shortName:i,nestedName:a}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var n=this.CST_STACK,r=n[n.length-1];this.nestedRuleFinallyStateUpdate();var a=n[n.length-1];addNoneTerminalToCst(a,t,r),this.setNodeLocationFromNode(a.location,r.location)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}(),LexerAdapter=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):END_OF_FILE},e.prototype.LA=function(e){var t=this.currIdx+e;return t<0||this.tokVectorLength<=t?END_OF_FILE:this.tokVector[t]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}(),RecognizerApi=function(){function e(){}return e.prototype.ACTION=function(e){return e.call(this)},e.prototype.consume=function(e,t,n){return this.consumeInternal(t,e,n)},e.prototype.subrule=function(e,t,n){return this.subruleInternal(t,e,n)},e.prototype.option=function(e,t){return this.optionInternal(t,e)},e.prototype.or=function(e,t){return this.orInternal(t,e)},e.prototype.many=function(e,t){return this.manyInternal(e,t)},e.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,n){if(void 0===n&&(n=DEFAULT_RULE_CONFIG),contains(this.definedRulesNames,e)){var r={message:defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(r)}this.definedRulesNames.push(e);var a=this.defineRule(e,t,n);return this[e]=a,a},e.prototype.OVERRIDE_RULE=function(e,t,n){void 0===n&&(n=DEFAULT_RULE_CONFIG);var r=[];r=r.concat(validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,r);var a=this.defineRule(e,t,n);return this[e]=a,a},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var n=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return serializeGrammar(values(this.gastProductionsCache))},e}(),RecognizerEngine=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},has(t,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if(isArray$2(e)){if(isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(isArray$2(e))this.tokensMap=reduce(e,(function(e,t){return e[t.name]=t,e}),{});else if(has(e,"modes")&&every(flatten(values(e.modes)),isTokenType)){var n=uniq(flatten(values(e.modes)));this.tokensMap=reduce(n,(function(e,t){return e[t.name]=t,e}),{})}else{if(!isObject$5(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=cloneObj(e)}this.tokensMap.EOF=EOF;var r=every(values(e),(function(e){return isEmpty(e.categoryMatches)}));this.tokenMatcher=r?tokenStructuredMatcherNoCategories:tokenStructuredMatcher,augmentTokenTypes(values(this.tokensMap))},e.prototype.defineRule=function(e,t,n){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var r,a=has(n,"resyncEnabled")?n.resyncEnabled:DEFAULT_RULE_CONFIG.resyncEnabled,i=has(n,"recoveryValueFunc")?n.recoveryValueFunc:DEFAULT_RULE_CONFIG.recoveryValueFunc,o=this.ruleShortNameIdx<<BITS_FOR_METHOD_TYPE+BITS_FOR_OCCURRENCE_IDX;function s(e){try{if(!0===this.outputCst){t.apply(this,e);var n=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(n),n}return t.apply(this,e)}catch(e){return this.invokeRuleCatch(e,a,i)}finally{this.ruleFinallyStateUpdate()}}this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;return(r=function(t,n){return void 0===t&&(t=0),this.ruleInvocationStateUpdate(o,e,t),s.call(this,n)}).ruleName=e,r.originalGrammarAction=t,r},e.prototype.invokeRuleCatch=function(e,t,n){var r=1===this.RULE_STACK.length,a=t&&!this.isBackTracking()&&this.recoveryEnabled;if(isRecognitionException(e)){var i=e;if(a){var o,s=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(s))return i.resyncedTokens=this.reSyncTo(s),this.outputCst?((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,o):n();throw this.outputCst&&((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i.partialCstResult=o),i}if(r)return this.moveToTerminatedState(),n();throw i}throw e},e.prototype.optionInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(OPTION_IDX,t),r=this.nestedRuleBeforeClause(e,n);try{return this.optionInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.optionInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(OPTION_IDX,t);return this.optionInternalLogic(e,t,n)},e.prototype.optionInternalLogic=function(e,t,n){var r,a,i=this,o=this.getLaFuncFromCache(n);if(void 0!==e.DEF){if(r=e.DEF,void 0!==(a=e.GATE)){var s=o;o=function(){return a.call(i)&&s.call(i)}}}else r=e;if(!0===o.call(this))return r.call(this)},e.prototype.atLeastOneInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{return this.atLeastOneInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,n)},e.prototype.atLeastOneInternalLogic=function(e,t,n){var r,a,i=this,o=this.getLaFuncFromCache(n);if(void 0!==t.DEF){if(r=t.DEF,void 0!==(a=t.GATE)){var s=o;o=function(){return a.call(i)&&s.call(i)}}}else r=t;if(!0!==o.call(this))throw this.raiseEarlyExitException(e,PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var l=this.doSingleRepetition(r);!0===o.call(this)&&!0===l;)l=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],o,AT_LEAST_ONE_IDX,e,NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{this.atLeastOneSepFirstInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,n)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,n){var r=this,a=t.DEF,i=t.SEP;if(!0!==this.getLaFuncFromCache(n).call(this))throw this.raiseEarlyExitException(e,PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var o=function(){return r.tokenMatcher(r.LA(1),i)};!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,o,a,NextTerminalAfterAtLeastOneSepWalker],o,AT_LEAST_ONE_SEP_IDX,e,NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(MANY_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{return this.manyInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.manyInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(MANY_IDX,e);return this.manyInternalLogic(e,t,n)},e.prototype.manyInternalLogic=function(e,t,n){var r,a,i=this,o=this.getLaFuncFromCache(n);if(void 0!==t.DEF){if(r=t.DEF,void 0!==(a=t.GATE)){var s=o;o=function(){return a.call(i)&&s.call(i)}}}else r=t;for(var l=!0;!0===o.call(this)&&!0===l;)l=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],o,MANY_IDX,e,NextTerminalAfterManyWalker,l)},e.prototype.manySepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,e),r=this.nestedRuleBeforeClause(t,n);try{this.manySepFirstInternalLogic(e,t,n)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var n=this.getKeyForAutomaticLookahead(MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,n)},e.prototype.manySepFirstInternalLogic=function(e,t,n){var r=this,a=t.DEF,i=t.SEP;if(!0===this.getLaFuncFromCache(n).call(this)){a.call(this);for(var o=function(){return r.tokenMatcher(r.LA(1),i)};!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,o,a,NextTerminalAfterManySepWalker],o,MANY_SEP_IDX,e,NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,n,r,a){for(;n();)this.CONSUME(t),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,r,a],n,AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var n=isArray$2(e)?e:e.DEF,r=this.getKeyForAutomaticLookahead(OR_IDX,t),a=this.getLaFuncFromCache(r).call(this,n);if(void 0!==a)return n[a].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(OR_IDX,t),r=this.nestedRuleBeforeClause(e,n);try{var a=isArray$2(e)?e:e.DEF,i=this.getLaFuncFromCache(n).call(this,a);if(void 0!==i){var o=a[i],s=this.nestedAltBeforeClause(o,t,OR_IDX,i);try{return o.ALT.call(this)}finally{void 0!==s&&this.nestedRuleFinallyClause(s.shortName,s.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==r&&this.nestedRuleFinallyClause(n,r)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,n){var r;try{var a=void 0!==n?n.ARGS:void 0;return r=e.call(this,t,a),this.cstPostNonTerminal(r,void 0!==n&&void 0!==n.LABEL?n.LABEL:e.ruleName),r}catch(t){this.subruleInternalError(t,n,e.ruleName)}},e.prototype.subruleInternalError=function(e,t,n){throw isRecognitionException(e)&&void 0!==e.partialCstResult&&(this.cstPostNonTerminal(e.partialCstResult,void 0!==t&&void 0!==t.LABEL?t.LABEL:n),delete e.partialCstResult),e},e.prototype.consumeInternal=function(e,t,n){var r;try{var a=this.LA(1);!0===this.tokenMatcher(a,e)?(this.consumeToken(),r=a):this.consumeInternalError(e,a,n)}catch(n){r=this.consumeInternalRecovery(e,t,n)}return this.cstPostTerminal(void 0!==n&&void 0!==n.LABEL?n.LABEL:e.name,r),r},e.prototype.consumeInternalError=function(e,t,n){var r,a=this.LA(0);throw r=void 0!==n&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:a,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new MismatchedTokenException(r,t,a))},e.prototype.consumeInternalRecovery=function(e,t,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;var r=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,r)}catch(e){throw e.name===IN_RULE_RECOVERY_EXCEPTION?n:e}},e.prototype.saveRecogState=function(){var e=this.errors,t=cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}(),ErrorHandler=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=defaults$4(e.errorMessageProvider,DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,n){for(var r=this.getCurrRuleFullName(),a=getLookaheadPathsForOptionalProd(e,this.getGAstProductions()[r],t,this.maxLookahead)[0],i=[],o=1;o<=this.maxLookahead;o++)i.push(this.LA(o));var s=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:i,previous:this.LA(0),customUserDescription:n,ruleName:r});throw this.SAVE_ERROR(new EarlyExitException(s,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var n=this.getCurrRuleFullName(),r=getLookaheadPathsForOr(e,this.getGAstProductions()[n],this.maxLookahead),a=[],i=1;i<=this.maxLookahead;i++)a.push(this.LA(i));var o=this.LA(0),s=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:r,actual:a,previous:o,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new NoViableAltException(s,this.LA(1),o))},e}(),ContentAssist=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var n=this.gastProductionsCache[e];if(isUndefined$1(n))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return nextPossibleTokensAfter([n],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=first$1(e.ruleStack),n=this.getGAstProductions()[t];return new NextAfterTokenWalker(n,e).startWalking()},e}(),RECORDING_NULL_OBJECT={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(RECORDING_NULL_OBJECT);var HANDLE_SEPARATOR=!0,MAX_METHOD_IDX=Math.pow(2,BITS_FOR_OCCURRENCE_IDX)-1,RFT=createToken({name:"RECORDING_PHASE_TOKEN",pattern:Lexer.NA});augmentTokenTypes([RFT]);var RECORDING_PHASE_TOKEN=createTokenInstance(RFT,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(RECORDING_PHASE_TOKEN);var RECORDING_PHASE_CSTNODE={name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details",children:{}},GastRecorder=function(){function e(){}return e.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},e.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",(function(){for(var t=function(t){var n=t>0?t:"";e["CONSUME"+n]=function(e,n){return this.consumeInternalRecord(e,t,n)},e["SUBRULE"+n]=function(e,n){return this.subruleInternalRecord(e,t,n)},e["OPTION"+n]=function(e){return this.optionInternalRecord(e,t)},e["OR"+n]=function(e){return this.orInternalRecord(e,t)},e["MANY"+n]=function(e){this.manyInternalRecord(t,e)},e["MANY_SEP"+n]=function(e){this.manySepFirstInternalRecord(t,e)},e["AT_LEAST_ONE"+n]=function(e){this.atLeastOneInternalRecord(t,e)},e["AT_LEAST_ONE_SEP"+n]=function(e){this.atLeastOneSepFirstInternalRecord(t,e)}},n=0;n<10;n++)t(n);e.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},e.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},e.option=function(e,t){return this.optionInternalRecord(t,e)},e.or=function(e,t){return this.orInternalRecord(t,e)},e.many=function(e,t){this.manyInternalRecord(e,t)},e.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD}))},e.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",(function(){for(var t=0;t<10;t++){var n=t>0?t:"";delete e["CONSUME"+n],delete e["SUBRULE"+n],delete e["OPTION"+n],delete e["OR"+n],delete e["MANY"+n],delete e["MANY_SEP"+n],delete e["AT_LEAST_ONE"+n],delete e["AT_LEAST_ONE_SEP"+n]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA}))},e.prototype.ACTION_RECORD=function(e){},e.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},e.prototype.LA_RECORD=function(e){return END_OF_FILE},e.prototype.topLevelRuleRecord=function(e,t){try{var n=new Rule({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),t.call(this),this.recordingProdStack.pop(),n}catch(e){if(!0!==e.KNOWN_RECORDER_ERROR)try{e.message=e.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording'}catch(t){throw e}throw e}},e.prototype.optionInternalRecord=function(e,t){return recordProd.call(this,Option,e,t)},e.prototype.atLeastOneInternalRecord=function(e,t){recordProd.call(this,RepetitionMandatory,t,e)},e.prototype.atLeastOneSepFirstInternalRecord=function(e,t){recordProd.call(this,RepetitionMandatoryWithSeparator,t,e,HANDLE_SEPARATOR)},e.prototype.manyInternalRecord=function(e,t){recordProd.call(this,Repetition,t,e)},e.prototype.manySepFirstInternalRecord=function(e,t){recordProd.call(this,RepetitionWithSeparator,t,e,HANDLE_SEPARATOR)},e.prototype.orInternalRecord=function(e,t){return recordOrProd.call(this,e,t)},e.prototype.subruleInternalRecord=function(e,t,n){if(assertMethodIdxIsValid(t),!e||!1===has(e,"ruleName")){var r=new Error("<SUBRULE"+getIdxSuffix(t)+"> argument is invalid expecting a Parser method reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw r.KNOWN_RECORDER_ERROR=!0,r}var a=peek(this.recordingProdStack),i=e.ruleName,o=new NonTerminal({idx:t,nonTerminalName:i,referencedRule:void 0});return a.definition.push(o),this.outputCst?RECORDING_PHASE_CSTNODE:RECORDING_NULL_OBJECT},e.prototype.consumeInternalRecord=function(e,t,n){if(assertMethodIdxIsValid(t),!hasShortKeyProperty(e)){var r=new Error("<CONSUME"+getIdxSuffix(t)+"> argument is invalid expecting a TokenType reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw r.KNOWN_RECORDER_ERROR=!0,r}var a=peek(this.recordingProdStack),i=new Terminal({idx:t,terminalType:e});return a.definition.push(i),RECORDING_PHASE_TOKEN},e}();function recordProd(e,t,n,r){void 0===r&&(r=!1),assertMethodIdxIsValid(n);var a=peek(this.recordingProdStack),i=isFunction$1(t)?t:t.DEF,o=new e({definition:[],idx:n});return has(t,"NAME")&&(o.name=t.NAME),r&&(o.separator=t.SEP),has(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),a.definition.push(o),this.recordingProdStack.pop(),RECORDING_NULL_OBJECT}function recordOrProd(e,t){var n=this;assertMethodIdxIsValid(t);var r=peek(this.recordingProdStack),a=!1===isArray$2(e),i=!1===a?e:e.DEF,o=new Alternation({definition:[],idx:t,ignoreAmbiguities:a&&!0===e.IGNORE_AMBIGUITIES});has(e,"NAME")&&(o.name=e.NAME),has(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD);var s=some(i,(function(e){return isFunction$1(e.GATE)}));return o.hasPredicates=s,r.definition.push(o),forEach$1(i,(function(e){var t=new Flat({definition:[]});o.definition.push(t),has(e,"NAME")&&(t.name=e.NAME),has(e,"IGNORE_AMBIGUITIES")?t.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:has(e,"GATE")&&(t.ignoreAmbiguities=!0),n.recordingProdStack.push(t),e.ALT.call(n),n.recordingProdStack.pop()})),RECORDING_NULL_OBJECT}function getIdxSuffix(e){return 0===e?"":""+e}function assertMethodIdxIsValid(e){if(e<0||e>MAX_METHOD_IDX){var t=new Error("Invalid DSL Method idx value: <"+e+">\n\tIdx value must be a none negative value smaller than "+(MAX_METHOD_IDX+1));throw t.KNOWN_RECORDER_ERROR=!0,t}}var PerformanceTracer=function(){function e(){}return e.prototype.initPerformanceTracer=function(e){if(has(e,"traceInitPerf")){var t=e.traceInitPerf,n="number"==typeof t;this.traceInitMaxIdent=n?t:1/0,this.traceInitPerf=n?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},e.prototype.TRACE_INIT=function(e,t){if(!0===this.traceInitPerf){this.traceInitIndent++;var n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(n+"--\x3e <"+e+">");var r=timer(t),a=r.time,i=r.value,o=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(n+"<-- <"+e+"> time: "+a+"ms"),this.traceInitIndent--,i}return t()},e}(),__extends=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),END_OF_FILE=createTokenInstance(EOF,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(END_OF_FILE);var DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),ParserDefinitionErrorType;function EMPTY_ALT(e){return void 0===e&&(e=void 0),function(){return e}}!function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(ParserDefinitionErrorType||(ParserDefinitionErrorType={}));var Parser=function(){function e(e,t){void 0===t&&(t=DEFAULT_PARSER_CONFIG),this.ignoredIssues=DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var n=this;n.initErrorHandler(t),n.initLexerAdapter(),n.initLooksAhead(t),n.initRecognizerEngine(e,t),n.initRecoverable(t),n.initTreeBuilder(t),n.initContentAssist(),n.initGastRecorder(t),n.initPerformanceTracer(t),has(t,"ignoredIssues")&&t.ignoredIssues!==DEFAULT_PARSER_CONFIG.ignoredIssues&&PRINT_WARNING("The <ignoredIssues> IParserConfig property is soft-deprecated and will be removed in future versions.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead."),this.ignoredIssues=has(t,"ignoredIssues")?t.ignoredIssues:DEFAULT_PARSER_CONFIG.ignoredIssues,this.skipValidations=has(t,"skipValidations")?t.skipValidations:DEFAULT_PARSER_CONFIG.skipValidations}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t=this;this.TRACE_INIT("performSelfAnalysis",(function(){var n;t.selfAnalysisDone=!0;var r=t.className;t.TRACE_INIT("toFastProps",(function(){toFastProperties(t)})),t.TRACE_INIT("Grammar Recording",(function(){try{t.enableRecording(),forEach$1(t.definedRulesNames,(function(e){var n=t[e].originalGrammarAction,r=void 0;t.TRACE_INIT(e+" Rule",(function(){r=t.topLevelRuleRecord(e,n)})),t.gastProductionsCache[e]=r}))}finally{t.disableRecording()}}));var a=[];if(t.TRACE_INIT("Grammar Resolving",(function(){a=resolveGrammar({rules:values(t.gastProductionsCache)}),t.definitionErrors.push.apply(t.definitionErrors,a)})),t.TRACE_INIT("Grammar Validations",(function(){if(isEmpty(a)&&!1===t.skipValidations){var e=validateGrammar({rules:values(t.gastProductionsCache),maxLookahead:t.maxLookahead,tokenTypes:values(t.tokensMap),ignoredIssues:t.ignoredIssues,errMsgProvider:defaultGrammarValidatorErrorProvider,grammarName:r});t.definitionErrors.push.apply(t.definitionErrors,e)}})),isEmpty(t.definitionErrors)&&(t.recoveryEnabled&&t.TRACE_INIT("computeAllProdsFollows",(function(){var e=computeAllProdsFollows(values(t.gastProductionsCache));t.resyncFollows=e})),t.TRACE_INIT("ComputeLookaheadFunctions",(function(){t.preComputeLookaheadFunctions(values(t.gastProductionsCache))}))),t.TRACE_INIT("expandAllNestedRuleNames",(function(){var e=expandAllNestedRuleNames(values(t.gastProductionsCache),t.fullRuleNameToShort);t.allRuleNames=e.allRuleNames})),!e.DEFER_DEFINITION_ERRORS_HANDLING&&!isEmpty(t.definitionErrors))throw n=map(t.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+n.join("\n-------------------------------\n"))}))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();applyMixins(Parser,[Recoverable,LooksAhead,TreeBuilder,LexerAdapter,RecognizerEngine,RecognizerApi,ErrorHandler,ContentAssist,GastRecorder,PerformanceTracer]),function(e){function t(t,n){void 0===n&&(n=DEFAULT_PARSER_CONFIG);var r=cloneObj(n);return r.outputCst=!0,e.call(this,t,r)||this}__extends(t,e)}(Parser);var EmbeddedActionsParser=function(e){function t(t,n){void 0===n&&(n=DEFAULT_PARSER_CONFIG);var r=cloneObj(n);return r.outputCst=!1,e.call(this,t,r)||this}return __extends(t,e),t}(Parser);function _toConsumableArray$f(e){return _arrayWithoutHoles$f(e)||_iterableToArray$f(e)||_unsupportedIterableToArray$R(e)||_nonIterableSpread$f()}function _nonIterableSpread$f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$R(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$R(e,t):void 0}}function _iterableToArray$f(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$f(e){if(Array.isArray(e))return _arrayLikeToArray$R(e)}function _arrayLikeToArray$R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var RANGE_OPERATOR=":",ABSOLUTE_OPERATOR="$",ALL_WHITESPACE_REGEXP=/\s+/,ODFF_WHITESPACE_REGEXP=/[ \t\n\r]+/,AdditionOp=createToken({name:"AdditionOp",pattern:Lexer.NA}),PlusOp=createToken({name:"PlusOp",pattern:/\+/,categories:AdditionOp}),MinusOp=createToken({name:"MinusOp",pattern:/-/,categories:AdditionOp}),MultiplicationOp=createToken({name:"MultiplicationOp",pattern:Lexer.NA}),TimesOp=createToken({name:"TimesOp",pattern:/\*/,categories:MultiplicationOp}),DivOp=createToken({name:"DivOp",pattern:/\//,categories:MultiplicationOp}),PowerOp=createToken({name:"PowerOp",pattern:/\^/}),PercentOp=createToken({name:"PercentOp",pattern:/%/}),BooleanOp=createToken({name:"BooleanOp",pattern:Lexer.NA}),EqualsOp=createToken({name:"EqualsOp",pattern:/=/,categories:BooleanOp}),NotEqualOp=createToken({name:"NotEqualOp",pattern:/<>/,categories:BooleanOp}),GreaterThanOp=createToken({name:"GreaterThanOp",pattern:/>/,categories:BooleanOp}),LessThanOp=createToken({name:"LessThanOp",pattern:/</,categories:BooleanOp}),GreaterThanOrEqualOp=createToken({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:BooleanOp}),LessThanOrEqualOp=createToken({name:"LessThanOrEqualOp",pattern:/<=/,categories:BooleanOp}),ConcatenateOp=createToken({name:"ConcatenateOp",pattern:/&/}),simpleSheetName="[A-Za-z0-9_-]+",quotedSheetName="'(((?!').|'')*)'",sheetNameRegexp="(".concat(simpleSheetName,"|").concat(quotedSheetName,")!"),CellReference=createToken({name:"CellReference",pattern:new RegExp("(".concat(sheetNameRegexp,")?\\").concat(ABSOLUTE_OPERATOR,"?[A-Za-z]+\\").concat(ABSOLUTE_OPERATOR,"?[0-9]+"))}),ColumnRange=createToken({name:"ColumnRange",pattern:new RegExp("(".concat(sheetNameRegexp,")?\\").concat(ABSOLUTE_OPERATOR,"?[A-Za-z]+").concat(RANGE_OPERATOR,"(").concat(sheetNameRegexp,")?\\").concat(ABSOLUTE_OPERATOR,"?[A-Za-z]+"))}),RowRange=createToken({name:"RowRange",pattern:new RegExp("(".concat(sheetNameRegexp,")?\\").concat(ABSOLUTE_OPERATOR,"?[0-9]+").concat(RANGE_OPERATOR,"(").concat(sheetNameRegexp,")?\\").concat(ABSOLUTE_OPERATOR,"?[0-9]+"))}),RangeSeparator=createToken({name:"RangeSeparator",pattern:"".concat(RANGE_OPERATOR)}),LParen=createToken({name:"LParen",pattern:/\(/}),RParen=createToken({name:"RParen",pattern:/\)/}),ArrayLParen=createToken({name:"ArrayLParen",pattern:/{/}),ArrayRParen=createToken({name:"ArrayRParen",pattern:/}/}),ProcedureName=createToken({name:"ProcedureName",pattern:/([A-Za-z\u00C0-\u02AF][A-Za-z0-9\u00C0-\u02AF._]*)\(/}),NamedExpression=createToken({name:"NamedExpression",pattern:/[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*/}),StringLiteral=createToken({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),ErrorLiteral=createToken({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),buildLexerConfig=function(e){var t,n,r=e.translationPackage.getFunctionTranslation("OFFSET"),a=e.errorMapping,i=e.translationPackage.buildFunctionMapping(),o=createToken({name:"WhiteSpace",pattern:"standard"===e.ignoreWhiteSpace?ODFF_WHITESPACE_REGEXP:ALL_WHITESPACE_REGEXP}),s=createToken({name:"ArrayRowSep",pattern:e.arrayRowSeparator}),l=createToken({name:"ArrayColSep",pattern:e.arrayColumnSeparator});e.functionArgSeparator===e.arrayColumnSeparator?(t=l,n=[]):e.functionArgSeparator===e.arrayRowSeparator?(t=s,n=[]):n=[t=createToken({name:"ArgSeparator",pattern:e.functionArgSeparator})];var u=createToken({name:"NumberLiteral",pattern:new RegExp("(([".concat(e.decimalSeparator,"]\\d+)|(\\d+([").concat(e.decimalSeparator,"]\\d*)?))(e[+-]?\\d+)?"))}),c=createToken({name:"OffsetProcedureName",pattern:new RegExp(r,"i")}),p=[o,PlusOp,MinusOp,TimesOp,DivOp,PowerOp,EqualsOp,NotEqualOp,PercentOp,GreaterThanOrEqualOp,LessThanOrEqualOp,GreaterThanOp,LessThanOp,LParen,RParen,ArrayLParen,ArrayRParen,c,ProcedureName,RangeSeparator].concat(_toConsumableArray$f(n),[ColumnRange,RowRange,u,StringLiteral,ErrorLiteral,ConcatenateOp,BooleanOp,AdditionOp,MultiplicationOp,CellReference,NamedExpression,s,l]);return{ArgSeparator:t,NumberLiteral:u,OffsetProcedureName:c,ArrayRowSeparator:s,ArrayColSeparator:l,WhiteSpace:o,allTokens:p,errorMapping:a,functionMapping:i,decimalSeparator:e.decimalSeparator,maxColumns:e.maxColumns,maxRows:e.maxRows}};function _slicedToArray$u(e,t){return _arrayWithHoles$u(e)||_iterableToArrayLimit$u(e,t)||_unsupportedIterableToArray$Q(e,t)||_nonIterableRest$u()}function _nonIterableRest$u(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$Q(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$Q(e,t):void 0}}function _arrayLikeToArray$Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$u(e){if(Array.isArray(e))return e}var addressRegex=new RegExp("^(".concat(sheetNameRegexp,")?(\\").concat(ABSOLUTE_OPERATOR,"?)([A-Za-z]+)(\\").concat(ABSOLUTE_OPERATOR,"?)([0-9]+)$")),columnRegex=new RegExp("^(".concat(sheetNameRegexp,")?(\\").concat(ABSOLUTE_OPERATOR,"?)([A-Za-z]+)$")),rowRegex=new RegExp("^(".concat(sheetNameRegexp,")?(\\").concat(ABSOLUTE_OPERATOR,"?)([0-9]+)$")),simpleSheetNameRegex=new RegExp("^".concat(simpleSheetName,"$")),cellAddressFromString=function(e,t,n){var r=addressRegex.exec(t),a=columnLabelToIndex(r[6]),i=extractSheetNumber(r,e);if(void 0!==i){null===i&&(i=void 0);var o=Number(r[8])-1;return r[5]===ABSOLUTE_OPERATOR&&r[7]===ABSOLUTE_OPERATOR?CellAddress.absolute(a,o,i):r[5]===ABSOLUTE_OPERATOR?CellAddress.absoluteCol(a,o-n.row,i):r[7]===ABSOLUTE_OPERATOR?CellAddress.absoluteRow(a-n.col,o,i):CellAddress.relative(o-n.row,a-n.col,i)}},columnAddressFromString=function(e,t,n){var r=columnRegex.exec(t),a=extractSheetNumber(r,e);if(void 0!==a){null===a&&(a=void 0);var i=columnLabelToIndex(r[6]);return r[5]===ABSOLUTE_OPERATOR?ColumnAddress.absolute(i,a):ColumnAddress.relative(i-n.col,a)}},rowAddressFromString=function(e,t,n){var r=rowRegex.exec(t),a=extractSheetNumber(r,e);if(void 0!==a){null===a&&(a=void 0);var i=Number(r[6])-1;return r[5]===ABSOLUTE_OPERATOR?RowAddress.absolute(i,a):RowAddress.relative(i-n.row,a)}},simpleCellAddressFromString=function(e,t,n){var r=addressRegex.exec(t),a=columnLabelToIndex(r[6]),i=extractSheetNumber(r,e);if(void 0!==i){null===i&&(i=n);var o=Number(r[8])-1;return simpleCellAddress(i,a,o)}},simpleCellRangeFromString=function(e,t,n){var r=t.split(RANGE_OPERATOR);if(2===r.length){var a=_slicedToArray$u(r,2),i=a[0],o=a[1],s=simpleCellAddressFromString(e,i,n);if(void 0!==s){var l=simpleCellAddressFromString(e,o,s.sheet);if(void 0!==l&&s.sheet===l.sheet)return simpleCellRange(s,l)}}},simpleCellAddressToString=function(e,t,n){var r=columnIndexToLabel(t.col),a=sheetIndexToString(t.sheet,e);if(void 0!==a)return n!==t.sheet?"".concat(a,"!").concat(r).concat(t.row+1):"".concat(r).concat(t.row+1)},simpleCellRangeToString=function(e,t,n){var r=simpleCellAddressToString(e,t.start,n),a=simpleCellAddressToString(e,t.end,t.start.sheet);return void 0===r||void 0===a?void 0:"".concat(r).concat(RANGE_OPERATOR).concat(a)};function columnLabelToIndex(e){return 1===e.length?e.toUpperCase().charCodeAt(0)-65:e.split("").reduce((function(e,t){return 26*e+(t.toUpperCase().charCodeAt(0)-64)}),0)-1}function columnIndexToLabel(e){for(var t="";e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}function sheetIndexToString(e,t){var n=t(e);if(void 0!==n)return simpleSheetNameRegex.test(n)?n:(n=n.replace(/'/g,"''"),"'".concat(n,"'"))}function extractSheetNumber(e,t){var n,r=null!==(n=e[3])&&void 0!==n?n:e[2];return r?t(r=r.replace(/''/g,"'")):null}var $$w=_export,uncurryThis$a=functionUncurryThis,IndexedObject=indexedObject,toIndexedObject$2=toIndexedObject$b,arrayMethodIsStrict$1=arrayMethodIsStrict$4,un$Join=uncurryThis$a([].join),ES3_STRINGS=IndexedObject!=Object,STRICT_METHOD$1=arrayMethodIsStrict$1("join",",");$$w({target:"Array",proto:!0,forced:ES3_STRINGS||!STRICT_METHOD$1},{join:function(e){return un$Join(toIndexedObject$2(this),void 0===e?",":e)}});var parsingError=function(e,t){return{type:e,message:t}},ParsingErrorType,AstNodeType,RangeSheetReferenceType;!function(e){e.LexingError="LexingError",e.ParserError="ParsingError",e.StaticOffsetError="StaticOffsetError",e.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",e.RangeOffsetNotAllowed="RangeOffsetNotAllowed"}(ParsingErrorType||(ParsingErrorType={})),function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.MINUS_UNARY_OP="MINUS_UNARY_OP",e.PLUS_UNARY_OP="PLUS_UNARY_OP",e.PERCENT_OP="PERCENT_OP",e.CONCATENATE_OP="CONCATENATE_OP",e.EQUALS_OP="EQUALS_OP",e.NOT_EQUAL_OP="NOT_EQUAL_OP",e.GREATER_THAN_OP="GREATER_THAN_OP",e.LESS_THAN_OP="LESS_THAN_OP",e.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",e.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",e.PLUS_OP="PLUS_OP",e.MINUS_OP="MINUS_OP",e.TIMES_OP="TIMES_OP",e.DIV_OP="DIV_OP",e.POWER_OP="POWER_OP",e.FUNCTION_CALL="FUNCTION_CALL",e.NAMED_EXPRESSION="NAMED_EXPRESSION",e.PARENTHESIS="PARENTHESES",e.CELL_REFERENCE="CELL_REFERENCE",e.CELL_RANGE="CELL_RANGE",e.COLUMN_RANGE="COLUMN_RANGE",e.ROW_RANGE="ROW_RANGE",e.ERROR="ERROR",e.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",e.ARRAY="ARRAY"}(AstNodeType||(AstNodeType={})),function(e){e[e.RELATIVE=0]="RELATIVE",e[e.START_ABSOLUTE=1]="START_ABSOLUTE",e[e.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"}(RangeSheetReferenceType||(RangeSheetReferenceType={}));var buildEmptyArgAst=function(e){return{type:AstNodeType.EMPTY,leadingWhitespace:null==e?void 0:e.image}},buildNumberAst=function(e,t){return{type:AstNodeType.NUMBER,value:e,leadingWhitespace:null==t?void 0:t.image}},buildStringAst=function(e){var t;return{type:AstNodeType.STRING,value:e.image.slice(1,-1),leadingWhitespace:null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image}},buildCellReferenceAst=function(e,t){return{type:AstNodeType.CELL_REFERENCE,reference:e,leadingWhitespace:null==t?void 0:t.image}},buildCellRangeAst=function(e,t,n,r){return assertRangeConsistency(e,t,n),{type:AstNodeType.CELL_RANGE,start:e,end:t,sheetReferenceType:n,leadingWhitespace:r}},buildColumnRangeAst=function(e,t,n,r){return assertRangeConsistency(e,t,n),{type:AstNodeType.COLUMN_RANGE,start:e,end:t,sheetReferenceType:n,leadingWhitespace:null==r?void 0:r.image}},buildRowRangeAst=function(e,t,n,r){return assertRangeConsistency(e,t,n),{type:AstNodeType.ROW_RANGE,start:e,end:t,sheetReferenceType:n,leadingWhitespace:null==r?void 0:r.image}},buildConcatenateOpAst=function(e,t,n){return{type:AstNodeType.CONCATENATE_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildEqualsOpAst=function(e,t,n){return{type:AstNodeType.EQUALS_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildNotEqualOpAst=function(e,t,n){return{type:AstNodeType.NOT_EQUAL_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildGreaterThanOpAst=function(e,t,n){return{type:AstNodeType.GREATER_THAN_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildLessThanOpAst=function(e,t,n){return{type:AstNodeType.LESS_THAN_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildGreaterThanOrEqualOpAst=function(e,t,n){return{type:AstNodeType.GREATER_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildLessThanOrEqualOpAst=function(e,t,n){return{type:AstNodeType.LESS_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildPlusOpAst=function(e,t,n){return{type:AstNodeType.PLUS_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildMinusOpAst=function(e,t,n){return{type:AstNodeType.MINUS_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildTimesOpAst=function(e,t,n){return{type:AstNodeType.TIMES_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildDivOpAst=function(e,t,n){return{type:AstNodeType.DIV_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildPowerOpAst=function(e,t,n){return{type:AstNodeType.POWER_OP,left:e,right:t,leadingWhitespace:null==n?void 0:n.image}},buildMinusUnaryOpAst=function(e,t){return{type:AstNodeType.MINUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image}},buildPlusUnaryOpAst=function(e,t){return{type:AstNodeType.PLUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image}},buildPercentOpAst=function(e,t){return{type:AstNodeType.PERCENT_OP,value:e,leadingWhitespace:null==t?void 0:t.image}},buildProcedureAst=function(e,t,n,r){return{type:AstNodeType.FUNCTION_CALL,procedureName:e,args:t,leadingWhitespace:null==n?void 0:n.image,internalWhitespace:null==r?void 0:r.image}},buildArrayAst=function(e,t,n){return{type:AstNodeType.ARRAY,args:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==n?void 0:n.image}},buildNamedExpressionAst=function(e,t){return{type:AstNodeType.NAMED_EXPRESSION,expressionName:e,leadingWhitespace:null==t?void 0:t.image}},buildParenthesisAst=function(e,t,n){return{type:AstNodeType.PARENTHESIS,expression:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==n?void 0:n.image}},buildCellErrorAst=function(e,t){return{type:AstNodeType.ERROR,error:e,leadingWhitespace:null==t?void 0:t.image}},buildErrorWithRawInputAst=function(e,t,n){return{type:AstNodeType.ERROR_WITH_RAW_INPUT,error:t,rawInput:e,leadingWhitespace:null==n?void 0:n.image}},buildParsingErrorAst=function(){return{type:AstNodeType.ERROR,error:CellError.parsingError()}},_binaryOpTokenMap;function assertRangeConsistency(e,t,n){if(void 0!==e.sheet&&void 0===t.sheet||void 0===e.sheet&&void 0!==t.sheet)throw new Error("Start address inconsistent with end address");if(void 0===e.sheet&&n!==RangeSheetReferenceType.RELATIVE||void 0!==e.sheet&&n===RangeSheetReferenceType.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}function imageWithWhitespace(e,t){return(null!=t?t:"")+e}function _defineProperty$1(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var binaryOpTokenMap=(_binaryOpTokenMap={},_defineProperty$1(_binaryOpTokenMap,AstNodeType.PLUS_OP,"+"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.MINUS_OP,"-"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.TIMES_OP,"*"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.DIV_OP,"/"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.CONCATENATE_OP,"&"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.POWER_OP,"^"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.EQUALS_OP,"="),_defineProperty$1(_binaryOpTokenMap,AstNodeType.NOT_EQUAL_OP,"<>"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.GREATER_THAN_OP,">"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.GREATER_THAN_OR_EQUAL_OP,">="),_defineProperty$1(_binaryOpTokenMap,AstNodeType.LESS_THAN_OP,"<"),_defineProperty$1(_binaryOpTokenMap,AstNodeType.LESS_THAN_OR_EQUAL_OP,"<="),_binaryOpTokenMap);function _classCallCheck$1L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1L(e,t,n){return t&&_defineProperties$1L(e.prototype,t),n&&_defineProperties$1L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var buildCacheEntry=function(e,t,n,r){return{ast:e,relativeDependencies:t,hasVolatileFunction:n,hasStructuralChangeFunction:r}},Cache=function(){function e(t){_classCallCheck$1L(this,e),this.functionRegistry=t,this.cache=new Map}return _createClass$1L(e,[{key:"set",value:function(e,t){var n=collectDependencies(t,this.functionRegistry),r=buildCacheEntry(t,n,doesContainFunctions(t,this.functionRegistry.isFunctionVolatile),doesContainFunctions(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,r),r}},{key:"get",value:function(e){return this.cache.get(e)}},{key:"maybeSetAndThenGet",value:function(e,t){var n=this.cache.get(e);return void 0!==n?n.ast:(this.set(e,t),t)}}]),e}(),doesContainFunctions=function e(t,n){switch(t.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.CELL_REFERENCE:case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return e(t.value,n);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return e(t.left,n)||e(t.right,n);case AstNodeType.PARENTHESIS:return e(t.expression,n);case AstNodeType.FUNCTION_CALL:return!!n(t.procedureName)||t.args.some((function(t){return e(t,n)}));case AstNodeType.ARRAY:return t.args.some((function(t){return t.some((function(t){return e(t,n)}))}))}},arraySlice=arraySliceSimple,floor$3=Math.floor,mergeSort=function(e,t){var n=e.length,r=floor$3(n/2);return n<8?insertionSort(e,t):merge$1(e,mergeSort(arraySlice(e,0,r),t),mergeSort(arraySlice(e,r),t),t)},insertionSort=function(e,t){for(var n,r,a=e.length,i=1;i<a;){for(r=i,n=e[i];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==i++&&(e[r]=n)}return e},merge$1=function(e,t,n,r){for(var a=t.length,i=n.length,o=0,s=0;o<a||s<i;)e[o+s]=o<a&&s<i?r(t[o],n[s])<=0?t[o++]:n[s++]:o<a?t[o++]:n[s++];return e},arraySort=mergeSort,userAgent$2=engineUserAgent,firefox=userAgent$2.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],UA=engineUserAgent,engineIsIeOrEdge=/MSIE|Trident/.test(UA),userAgent$1=engineUserAgent,webkit=userAgent$1.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],$$v=_export,uncurryThis$9=functionUncurryThis,aCallable=aCallable$6,toObject$3=toObject$e,lengthOfArrayLike$2=lengthOfArrayLike$b,toString$5=toString$g,fails$5=fails$B,internalSort=arraySort,arrayMethodIsStrict=arrayMethodIsStrict$4,FF=engineFfVersion,IE_OR_EDGE=engineIsIeOrEdge,V8=engineV8Version,WEBKIT=engineWebkitVersion,test$1=[],un$Sort=uncurryThis$9(test$1.sort),push$1=uncurryThis$9(test$1.push),FAILS_ON_UNDEFINED=fails$5((function(){test$1.sort(void 0)})),FAILS_ON_NULL=fails$5((function(){test$1.sort(null)})),STRICT_METHOD=arrayMethodIsStrict("sort"),STABLE_SORT=!fails$5((function(){if(V8)return V8<70;if(!(FF&&FF>3)){if(IE_OR_EDGE)return!0;if(WEBKIT)return WEBKIT<603;var e,t,n,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)test$1.push({k:t+r,v:n})}for(test$1.sort((function(e,t){return t.v-e.v})),r=0;r<test$1.length;r++)t=test$1[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}})),FORCED$4=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD||!STABLE_SORT,getSortCompare=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:toString$5(t)>toString$5(n)?1:-1}};$$v({target:"Array",proto:!0,forced:FORCED$4},{sort:function(e){void 0!==e&&aCallable(e);var t=toObject$3(this);if(STABLE_SORT)return void 0===e?un$Sort(t):un$Sort(t,e);var n,r,a=[],i=lengthOfArrayLike$2(t);for(r=0;r<i;r++)r in t&&push$1(a,t[r]);for(internalSort(a,getSortCompare(e)),n=a.length,r=0;r<n;)t[r]=a[r++];for(;r<i;)delete t[r++];return t}});var isObject$4=isObject$m,floor$2=Math.floor,isIntegralNumber$1=Number.isInteger||function(e){return!isObject$4(e)&&isFinite(e)&&floor$2(e)===e},$$u=_export,isIntegralNumber=isIntegralNumber$1;$$u({target:"Number",stat:!0},{isInteger:isIntegralNumber});var hasOwn$1=hasOwnProperty_1,isDataDescriptor$1=function(e){return void 0!==e&&(hasOwn$1(e,"value")||hasOwn$1(e,"writable"))},$$t=_export,call=functionCall,isObject$3=isObject$m,anObject$1=anObject$j,isDataDescriptor=isDataDescriptor$1,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,getPrototypeOf=objectGetPrototypeOf;function get(e,t){var n,r,a=arguments.length<3?e:arguments[2];return anObject$1(e)===a?e[t]:(n=getOwnPropertyDescriptorModule.f(e,t))?isDataDescriptor(n)?n.value:void 0===n.get?void 0:call(n.get,a):isObject$3(r=getPrototypeOf(e))?get(r,t,a):void 0}$$t({target:"Reflect",stat:!0},{get:get});var $$s=_export,fails$4=fails$B,toIndexedObject$1=toIndexedObject$b,nativeGetOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,DESCRIPTORS$1=descriptors,FAILS_ON_PRIMITIVES$1=fails$4((function(){nativeGetOwnPropertyDescriptor(1)})),FORCED$3=!DESCRIPTORS$1||FAILS_ON_PRIMITIVES$1;function _defineProperties$1K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1K(e,t,n){return t&&_defineProperties$1K(e.prototype,t),n&&_defineProperties$1K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck$1K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */$$s({target:"Object",stat:!0,forced:FORCED$3,sham:!DESCRIPTORS$1},{getOwnPropertyDescriptor:function(e,t){return nativeGetOwnPropertyDescriptor(toIndexedObject$1(e),t)}});var ErrorMessage=_createClass$1K((function e(){_classCallCheck$1K(this,e)}));function _typeof$_(e){return _typeof$_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$_(e)}function _slicedToArray$t(e,t){return _arrayWithHoles$t(e)||_iterableToArrayLimit$t(e,t)||_unsupportedIterableToArray$P(e,t)||_nonIterableRest$t()}function _nonIterableRest$t(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$P(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$P(e,t):void 0}}function _arrayLikeToArray$P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$t(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$t(e){if(Array.isArray(e))return e}function _classCallCheck$1J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1J(e,t,n){return t&&_defineProperties$1J(e.prototype,t),n&&_defineProperties$1J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _get$1(){return _get$1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase$1(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},_get$1.apply(this,arguments)}function _superPropBase$1(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$W(e)););return e}function _inherits$W(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$X(e,t)}function _setPrototypeOf$X(e,t){return _setPrototypeOf$X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$X(e,t)}function _createSuper$W(e){var t=_isNativeReflectConstruct$X();return function(){var n,r=_getPrototypeOf$W(e);if(t){var a=_getPrototypeOf$W(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$W(this,n)}}function _possibleConstructorReturn$W(e,t){if(t&&("object"===_typeof$_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$W(e)}function _assertThisInitialized$W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$X(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$W(e){return _getPrototypeOf$W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$W(e)}ErrorMessage.DistinctSigns="Distinct signs.",ErrorMessage.WrongArgNumber="Wrong number of arguments.",ErrorMessage.EmptyArg="Empty function argument.",ErrorMessage.EmptyArray="Empty array not allowed.",ErrorMessage.ArrayDimensions="Array dimensions are not compatible.",ErrorMessage.NoSpaceForArrayResult="No space for array result.",ErrorMessage.ValueSmall="Value too small.",ErrorMessage.ValueLarge="Value too large.",ErrorMessage.BadCriterion="Incorrect criterion.",ErrorMessage.RangeManySheets="Range spans more than one sheet.",ErrorMessage.CellRangeExpected="Cell range expected.",ErrorMessage.WrongDimension="Wrong range dimension.",ErrorMessage.ScalarExpected="Cell range not allowed.",ErrorMessage.NumberCoercion="Value cannot be coerced to number.",ErrorMessage.NumberExpected="Number argument expected.",ErrorMessage.IntegerExpected="Value needs to be an integer.",ErrorMessage.BadMode="Mode not recognized.",ErrorMessage.DateBounds="Date outside of bounds.",ErrorMessage.OutOfSheet="Resulting reference is out of the sheet.",ErrorMessage.WrongType="Wrong type of argument.",ErrorMessage.NaN="NaN or infinite value encountered.",ErrorMessage.EqualLength="Ranges need to be of equal length.",ErrorMessage.Negative="Value cannot be negative.",ErrorMessage.NotBinary="String does not represent a binary number.",ErrorMessage.NotOctal="String does not represent an octal number.",ErrorMessage.NotHex="String does not represent a hexadecimal number.",ErrorMessage.EndStartPeriod="End period needs to be at least start period.",ErrorMessage.CellRefExpected="Cell reference expected.",ErrorMessage.EmptyRange="Empty range not allowed.",ErrorMessage.BadRef="Address is not correct.",ErrorMessage.NumberRange="Number-only range expected.",ErrorMessage.ValueNotFound="Value not found.",ErrorMessage.ValueBaseLarge="Value in base too large.",ErrorMessage.ValueBaseSmall="Value in base too small.",ErrorMessage.ValueBaseLong="Value in base too long.",ErrorMessage.NegativeLength="Length cannot be negative.",ErrorMessage.PatternNotFound="Pattern not found.",ErrorMessage.OneValue="Needs at least one value.",ErrorMessage.TwoValues="Range needs to contain at least two elements.",ErrorMessage.ThreeValues="Range needs to contain at least three elements.",ErrorMessage.IndexBounds="Index out of bounds.",ErrorMessage.IndexLarge="Index too large.",ErrorMessage.Formula="Expected formula.",ErrorMessage.NegativeCount="Count cannot be negative.",ErrorMessage.ParseError="Parsing error.",ErrorMessage.SheetRef="Sheet does not exist.",ErrorMessage.PeriodLong="Period number cannot exceed life length.",ErrorMessage.InvalidDate="Invalid date.",ErrorMessage.BitshiftLong="Result of bitshift is too long.",ErrorMessage.EmptyString="Empty-string argument not allowed.",ErrorMessage.LengthBounds="Length out of bounds.",ErrorMessage.NegativeTime="Time cannot be negative.",ErrorMessage.NoDefault="No default option.",ErrorMessage.Selector="Selector cannot exceed the number of arguments.",ErrorMessage.StartEndDate="Start date needs to be earlier than end date.",ErrorMessage.IncorrectDateTime="String does not represent correct DateTime.",ErrorMessage.CharacterCodeBounds="Character code out of bounds.",ErrorMessage.NonZero="Argument cannot be 0.",ErrorMessage.LessThanOne="Argument cannot be less than 1.",ErrorMessage.WeekendString="Incorrect weekend bitmask string.",ErrorMessage.InvalidRoman="Invalid roman numeral.",ErrorMessage.WrongOrder="Wrong order of values.",ErrorMessage.ComplexNumberExpected="Complex number expected.",ErrorMessage.ShouldBeIorJ="Should be 'i' or 'j'.",ErrorMessage.SizeMismatch="Array dimensions mismatched.",ErrorMessage.FunctionName=function(e){return"Function name ".concat(e," not recognized.")},ErrorMessage.NamedExpressionName=function(e){return"Named expression ".concat(e," not recognized.")},ErrorMessage.LicenseKey=function(e){return"License key is ".concat(e,".")};var FormulaParser=function(e){_inherits$W(n,e);var t=_createSuper$W(n);function n(e,r){var a;return _classCallCheck$1J(this,n),(a=t.call(this,e.allTokens,{outputCst:!1,maxLookahead:7})).booleanExpressionOrEmpty=a.RULE("booleanExpressionOrEmpty",(function(){return a.OR([{ALT:function(){return a.SUBRULE(a.booleanExpression)}},{ALT:EMPTY_ALT(buildEmptyArgAst())}])})),a.procedureExpression=a.RULE("procedureExpression",(function(){var e,t=a.CONSUME(ProcedureName),n=t.image.toUpperCase().slice(0,-1),r=null!==(e=a.lexerConfig.functionMapping[n])&&void 0!==e?e:n,i=[],o=a.SUBRULE(a.booleanExpressionOrEmpty);a.MANY((function(){var e,t=a.CONSUME(a.lexerConfig.ArgSeparator);o.type===AstNodeType.EMPTY&&(o.leadingWhitespace=null===(e=t.leadingWhitespace)||void 0===e?void 0:e.image),i.push(o),o=a.SUBRULE2(a.booleanExpressionOrEmpty)})),i.push(o),1===i.length&&i[0].type===AstNodeType.EMPTY&&(i.length=0);var s=a.CONSUME(RParen);return buildProcedureAst(r,i,t.leadingWhitespace,s.leadingWhitespace)})),a.namedExpressionExpression=a.RULE("namedExpressionExpression",(function(){var e=a.CONSUME(NamedExpression);return buildNamedExpressionAst(e.image,e.leadingWhitespace)})),a.offsetProcedureExpression=a.RULE("offsetProcedureExpression",(function(){var e=[];return a.CONSUME(a.lexerConfig.OffsetProcedureName),a.CONSUME(LParen),a.MANY_SEP({SEP:a.lexerConfig.ArgSeparator,DEF:function(){e.push(a.SUBRULE(a.booleanExpression))}}),a.CONSUME(RParen),a.handleOffsetHeuristic(e)})),a.columnRangeExpression=a.RULE("columnRangeExpression",(function(){var e=a.CONSUME(ColumnRange),t=_slicedToArray$t(e.image.split(":"),2),r=t[0],i=t[1],o=a.ACTION((function(){return columnAddressFromString(a.sheetMapping,r,a.formulaAddress)})),s=a.ACTION((function(){return columnAddressFromString(a.sheetMapping,i,a.formulaAddress)}));if(void 0===o||void 0===s)return buildCellErrorAst(new CellError(ErrorType.REF));if(o.exceedsSheetSizeLimits(a.lexerConfig.maxColumns)||s.exceedsSheetSizeLimits(a.lexerConfig.maxColumns))return buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace);if(void 0===o.sheet&&void 0!==s.sheet)return a.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var l=n.fixSheetIdsForRangeEnds(o,s),u=l.firstEnd,c=l.secondEnd,p=l.sheetRefType,d=a.orderColumnRangeEnds(u,c),m=d.start,f=d.end;return buildColumnRangeAst(m,f,p,e.leadingWhitespace)})),a.rowRangeExpression=a.RULE("rowRangeExpression",(function(){var e=a.CONSUME(RowRange),t=_slicedToArray$t(e.image.split(":"),2),r=t[0],i=t[1],o=a.ACTION((function(){return rowAddressFromString(a.sheetMapping,r,a.formulaAddress)})),s=a.ACTION((function(){return rowAddressFromString(a.sheetMapping,i,a.formulaAddress)}));if(void 0===o||void 0===s)return buildCellErrorAst(new CellError(ErrorType.REF));if(o.exceedsSheetSizeLimits(a.lexerConfig.maxRows)||s.exceedsSheetSizeLimits(a.lexerConfig.maxRows))return buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace);if(void 0===o.sheet&&void 0!==s.sheet)return a.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var l=n.fixSheetIdsForRangeEnds(o,s),u=l.firstEnd,c=l.secondEnd,p=l.sheetRefType,d=a.orderRowRangeEnds(u,c),m=d.start,f=d.end;return buildRowRangeAst(m,f,p,e.leadingWhitespace)})),a.cellReference=a.RULE("cellReference",(function(){var e=a.CONSUME(CellReference),t=a.ACTION((function(){return cellAddressFromString(a.sheetMapping,e.image,a.formulaAddress)}));return void 0===t?buildErrorWithRawInputAst(e.image,new CellError(ErrorType.REF),e.leadingWhitespace):t.exceedsSheetSizeLimits(a.lexerConfig.maxColumns,a.lexerConfig.maxRows)?buildErrorWithRawInputAst(e.image,new CellError(ErrorType.NAME),e.leadingWhitespace):buildCellReferenceAst(t,e.leadingWhitespace)})),a.endRangeReference=a.RULE("endRangeReference",(function(e){var t,n=a.CONSUME(CellReference),r=a.ACTION((function(){return cellAddressFromString(a.sheetMapping,e.image,a.formulaAddress)})),i=a.ACTION((function(){return cellAddressFromString(a.sheetMapping,n.image,a.formulaAddress)}));return void 0===r||void 0===i?a.ACTION((function(){return buildErrorWithRawInputAst("".concat(e.image,":").concat(n.image),new CellError(ErrorType.REF),e.leadingWhitespace)})):r.exceedsSheetSizeLimits(a.lexerConfig.maxColumns,a.lexerConfig.maxRows)||i.exceedsSheetSizeLimits(a.lexerConfig.maxColumns,a.lexerConfig.maxRows)?a.ACTION((function(){return buildErrorWithRawInputAst("".concat(e.image,":").concat(n.image),new CellError(ErrorType.NAME),e.leadingWhitespace)})):a.buildCellRange(r,i,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image)})),a.endOfRangeExpression=a.RULE("endOfRangeExpression",(function(e){return a.OR([{ALT:function(){return a.SUBRULE(a.endRangeReference,{ARGS:[e]})}},{ALT:function(){var t,n=a.SUBRULE(a.offsetProcedureExpression),r=a.ACTION((function(){return cellAddressFromString(a.sheetMapping,e.image,a.formulaAddress)}));return void 0===r?buildCellErrorAst(new CellError(ErrorType.REF)):n.type===AstNodeType.CELL_REFERENCE?a.buildCellRange(r,n.reference,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image):a.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])})),a.cellRangeExpression=a.RULE("cellRangeExpression",(function(){var e=a.CONSUME(CellReference);return a.CONSUME2(RangeSeparator),a.SUBRULE(a.endOfRangeExpression,{ARGS:[e]})})),a.endRangeWithOffsetStartReference=a.RULE("endRangeWithOffsetStartReference",(function(e){var t=a.CONSUME(CellReference),n=a.ACTION((function(){return cellAddressFromString(a.sheetMapping,t.image,a.formulaAddress)}));return void 0===n?a.ACTION((function(){return buildCellErrorAst(new CellError(ErrorType.REF))})):a.buildCellRange(e.reference,n,e.leadingWhitespace)})),a.endOfRangeWithOffsetStartExpression=a.RULE("endOfRangeWithOffsetStartExpression",(function(e){return a.OR([{ALT:function(){return a.SUBRULE(a.endRangeWithOffsetStartReference,{ARGS:[e]})}},{ALT:function(){var t=a.SUBRULE(a.offsetProcedureExpression);return t.type===AstNodeType.CELL_REFERENCE?a.buildCellRange(e.reference,t.reference,e.leadingWhitespace):a.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}])})),a.offsetExpression=a.RULE("offsetExpression",(function(){var e,t=a.SUBRULE(a.offsetProcedureExpression);return a.OPTION((function(){a.CONSUME(RangeSeparator),e=t.type===AstNodeType.CELL_RANGE?a.parsingError(ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):a.SUBRULE(a.endOfRangeWithOffsetStartExpression,{ARGS:[t]})})),void 0!==e?e:t})),a.insideArrayExpression=a.RULE("insideArrayExpression",(function(){var e=[[]];return e[e.length-1].push(a.SUBRULE(a.booleanExpression)),a.MANY((function(){a.OR([{ALT:function(){a.CONSUME(a.lexerConfig.ArrayColSeparator),e[e.length-1].push(a.SUBRULE2(a.booleanExpression))}},{ALT:function(){a.CONSUME(a.lexerConfig.ArrayRowSeparator),e.push([]),e[e.length-1].push(a.SUBRULE3(a.booleanExpression))}}])})),buildArrayAst(e)})),a.parenthesisExpression=a.RULE("parenthesisExpression",(function(){var e=a.CONSUME(LParen),t=a.SUBRULE(a.booleanExpression),n=a.CONSUME(RParen);return buildParenthesisAst(t,e.leadingWhitespace,n.leadingWhitespace)})),a.arrayExpression=a.RULE("arrayExpression",(function(){return a.OR([{ALT:function(){var e=a.CONSUME(ArrayLParen),t=a.SUBRULE(a.insideArrayExpression),n=a.CONSUME(ArrayRParen);return buildArrayAst(t.args,e.leadingWhitespace,n.leadingWhitespace)}},{ALT:function(){return a.SUBRULE(a.parenthesisExpression)}}])})),a.numericStringToNumber=function(e){var t=e.replace(a.lexerConfig.decimalSeparator,".");return Number(t)},a.positiveAtomicExpression=a.RULE("positiveAtomicExpression",(function(){var e;return a.OR(null!==(e=a.atomicExpCache)&&void 0!==e?e:a.atomicExpCache=[{ALT:function(){return a.SUBRULE(a.arrayExpression)}},{ALT:function(){return a.SUBRULE(a.cellRangeExpression)}},{ALT:function(){return a.SUBRULE(a.columnRangeExpression)}},{ALT:function(){return a.SUBRULE(a.rowRangeExpression)}},{ALT:function(){return a.SUBRULE(a.offsetExpression)}},{ALT:function(){return a.SUBRULE(a.cellReference)}},{ALT:function(){return a.SUBRULE(a.procedureExpression)}},{ALT:function(){return a.SUBRULE(a.namedExpressionExpression)}},{ALT:function(){var e=a.CONSUME(a.lexerConfig.NumberLiteral);return buildNumberAst(a.numericStringToNumber(e.image),e.leadingWhitespace)}},{ALT:function(){var e=a.CONSUME(StringLiteral);return buildStringAst(e)}},{ALT:function(){var e=a.CONSUME(ErrorLiteral),t=e.image.toUpperCase(),n=a.lexerConfig.errorMapping[t];return n?buildCellErrorAst(new CellError(n),e.leadingWhitespace):a.parsingError(ParsingErrorType.ParserError,"Unknown error literal")}}])})),a.rightUnaryOpAtomicExpression=a.RULE("rightUnaryOpAtomicExpression",(function(){var e=a.SUBRULE(a.positiveAtomicExpression),t=a.OPTION((function(){return a.CONSUME(PercentOp)}));return t?buildPercentOpAst(e,t.leadingWhitespace):e})),a.atomicExpression=a.RULE("atomicExpression",(function(){return a.OR([{ALT:function(){var e=a.CONSUME(AdditionOp),t=a.SUBRULE(a.atomicExpression);return tokenMatcher(e,PlusOp)?buildPlusUnaryOpAst(t,e.leadingWhitespace):tokenMatcher(e,MinusOp)?buildMinusUnaryOpAst(t,e.leadingWhitespace):(a.customParsingError=parsingError(ParsingErrorType.ParserError,"Mismatched token type"),a.customParsingError)}},{ALT:function(){return a.SUBRULE2(a.rightUnaryOpAtomicExpression)}}])})),a.powerExpression=a.RULE("powerExpression",(function(){var e=a.SUBRULE(a.atomicExpression);return a.MANY((function(){var t=a.CONSUME(PowerOp),n=a.SUBRULE2(a.atomicExpression);tokenMatcher(t,PowerOp)?e=buildPowerOpAst(e,n,t.leadingWhitespace):a.ACTION((function(){throw Error("Operator not supported")}))})),e})),a.multiplicationExpression=a.RULE("multiplicationExpression",(function(){var e=a.SUBRULE(a.powerExpression);return a.MANY((function(){var t=a.CONSUME(MultiplicationOp),n=a.SUBRULE2(a.powerExpression);tokenMatcher(t,TimesOp)?e=buildTimesOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,DivOp)?e=buildDivOpAst(e,n,t.leadingWhitespace):a.ACTION((function(){throw Error("Operator not supported")}))})),e})),a.additionExpression=a.RULE("additionExpression",(function(){var e=a.SUBRULE(a.multiplicationExpression);return a.MANY((function(){var t=a.CONSUME(AdditionOp),n=a.SUBRULE2(a.multiplicationExpression);tokenMatcher(t,PlusOp)?e=buildPlusOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,MinusOp)?e=buildMinusOpAst(e,n,t.leadingWhitespace):a.ACTION((function(){throw Error("Operator not supported")}))})),e})),a.concatenateExpression=a.RULE("concatenateExpression",(function(){var e=a.SUBRULE(a.additionExpression);return a.MANY((function(){var t=a.CONSUME(ConcatenateOp),n=a.SUBRULE2(a.additionExpression);e=buildConcatenateOpAst(e,n,t.leadingWhitespace)})),e})),a.booleanExpression=a.RULE("booleanExpression",(function(){var e=a.SUBRULE(a.concatenateExpression);return a.MANY((function(){var t=a.CONSUME(BooleanOp),n=a.SUBRULE2(a.concatenateExpression);tokenMatcher(t,EqualsOp)?e=buildEqualsOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,NotEqualOp)?e=buildNotEqualOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,GreaterThanOp)?e=buildGreaterThanOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,LessThanOp)?e=buildLessThanOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,GreaterThanOrEqualOp)?e=buildGreaterThanOrEqualOpAst(e,n,t.leadingWhitespace):tokenMatcher(t,LessThanOrEqualOp)?e=buildLessThanOrEqualOpAst(e,n,t.leadingWhitespace):a.ACTION((function(){throw Error("Operator not supported")}))})),e})),a.formula=a.RULE("formula",(function(){return a.CONSUME(EqualsOp),a.SUBRULE(a.booleanExpression)})),a.lexerConfig=e,a.sheetMapping=r,a.formulaAddress=simpleCellAddress(0,0,0),a.performSelfAnalysis(),a}return _createClass$1J(n,[{key:"parseFromTokens",value:function(e,t){this.input=e;var n=this.formulaWithContext(t),r=[];return this.customParsingError&&r.push(this.customParsingError),r=r.concat(this.errors.map((function(e){return{type:ParsingErrorType.ParserError,message:e.message}}))),r.length>0&&(n=buildParsingErrorAst()),{ast:n,errors:r}}},{key:"reset",value:function(){_get$1(_getPrototypeOf$W(n.prototype),"reset",this).call(this),this.customParsingError=void 0}},{key:"formulaWithContext",value:function(e){return this.formulaAddress=e,this.formula()}},{key:"buildCellRange",value:function(e,t,r){if(void 0===e.sheet&&void 0!==t.sheet)return this.parsingError(ParsingErrorType.ParserError,"Malformed range expression");var a=n.fixSheetIdsForRangeEnds(e,t),i=a.firstEnd,o=a.secondEnd,s=a.sheetRefType,l=this.orderCellRangeEnds(i,o),u=l.start,c=l.end;return buildCellRangeAst(u,c,s,r)}},{key:"orderCellRangeEnds",value:function(e,t){var r=[e,t],a=r.map((function(e){return e.toColumnAddress()})).sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),i=_slicedToArray$t(a,2),o=i[0],s=i[1],l=r.map((function(e){return e.toRowAddress()})).sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),u=_slicedToArray$t(l,2),c=u[0],p=u[1],d=r.map((function(e){return e.sheet})).sort(n.compareSheetIds.bind(this)),m=_slicedToArray$t(d,2),f=m[0],h=m[1];return{start:CellAddress.fromColAndRow(o,c,f),end:CellAddress.fromColAndRow(s,p,h)}}},{key:"orderColumnRangeEnds",value:function(e,t){var r=[e,t],a=_slicedToArray$t(r.sort(ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),2),i=a[0],o=a[1],s=r.map((function(e){return e.sheet})).sort(n.compareSheetIds.bind(this)),l=_slicedToArray$t(s,2),u=l[0],c=l[1];return{start:new ColumnAddress(i.type,i.col,u),end:new ColumnAddress(o.type,o.col,c)}}},{key:"orderRowRangeEnds",value:function(e,t){var r=[e,t],a=_slicedToArray$t(r.sort(RowAddress.compareByAbsoluteAddress(this.formulaAddress)),2),i=a[0],o=a[1],s=r.map((function(e){return e.sheet})).sort(n.compareSheetIds.bind(this)),l=_slicedToArray$t(s,2),u=l[0],c=l[1];return{start:new RowAddress(i.type,i.row,u),end:new RowAddress(o.type,o.row,c)}}},{key:"handleOffsetHeuristic",value:function(e){var t=e[0];if(t.type!==AstNodeType.CELL_REFERENCE)return this.parsingError(ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");var n,r=e[1];if(r.type===AstNodeType.NUMBER&&Number.isInteger(r.value))n=r.value;else if(r.type===AstNodeType.PLUS_UNARY_OP&&r.value.type===AstNodeType.NUMBER&&Number.isInteger(r.value.value))n=r.value.value;else{if(r.type!==AstNodeType.MINUS_UNARY_OP||r.value.type!==AstNodeType.NUMBER||!Number.isInteger(r.value.value))return this.parsingError(ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");n=-r.value.value}var a,i=e[2];if(i.type===AstNodeType.NUMBER&&Number.isInteger(i.value))a=i.value;else if(i.type===AstNodeType.PLUS_UNARY_OP&&i.value.type===AstNodeType.NUMBER&&Number.isInteger(i.value.value))a=i.value.value;else{if(i.type!==AstNodeType.MINUS_UNARY_OP||i.value.type!==AstNodeType.NUMBER||!Number.isInteger(i.value.value))return this.parsingError(ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");a=-i.value.value}var o,s=e[3];if(void 0===s)o=1;else{if(s.type!==AstNodeType.NUMBER)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");if((o=s.value)<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(o))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}var l,u=e[4];if(void 0===u)l=1;else{if(u.type!==AstNodeType.NUMBER)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");if((l=u.value)<1)return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(l))return this.parsingError(ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}var c=new CellAddress(t.reference.col+a,t.reference.row+n,t.reference.type),p=c.col,d=c.row;if(t.reference.type!==CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL||(d+=this.formulaAddress.row),t.reference.type!==CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW||(p+=this.formulaAddress.col),p<0||d<0)return buildCellErrorAst(new CellError(ErrorType.REF,ErrorMessage.OutOfSheet));if(1===l&&1===o)return buildCellReferenceAst(c);var m=new CellAddress(c.col+l-1,c.row+o-1,c.type);return buildCellRangeAst(c,m,RangeSheetReferenceType.RELATIVE)}},{key:"parsingError",value:function(e,t){return this.customParsingError=parsingError(e,t),buildParsingErrorAst()}}],[{key:"fixSheetIdsForRangeEnds",value:function(e,t){var r=n.rangeSheetReferenceType(e.sheet,t.sheet);return{firstEnd:e,secondEnd:void 0!==e.sheet&&void 0===t.sheet?t.withSheet(e.sheet):t,sheetRefType:r}}},{key:"compareSheetIds",value:function(e,t){return(e=null!=e?e:1/0)-(t=null!=t?t:1/0)}},{key:"rangeSheetReferenceType",value:function(e,t){return void 0===e?RangeSheetReferenceType.RELATIVE:void 0===t?RangeSheetReferenceType.START_ABSOLUTE:RangeSheetReferenceType.BOTH_ABSOLUTE}}]),n}(EmbeddedActionsParser),FormulaLexer=function(){function e(t){_classCallCheck$1J(this,e),this.lexerConfig=t,this.lexer=new Lexer(t.allTokens,{ensureOptimizations:!0})}return _createClass$1J(e,[{key:"tokenizeFormula",value:function(e){var t=this.lexer.tokenize(e),n=t.tokens;return n=this.trimTrailingWhitespaces(n),n=this.skipWhitespacesInsideRanges(n),n=this.skipWhitespacesBeforeArgSeparators(n),t.tokens=n,t}},{key:"skipWhitespacesInsideRanges",value:function(t){var n=this;return e.filterTokensByNeighbors(t,(function(e,t,r){return(tokenMatcher(e,CellReference)||tokenMatcher(e,RangeSeparator))&&tokenMatcher(t,n.lexerConfig.WhiteSpace)&&(tokenMatcher(r,CellReference)||tokenMatcher(r,RangeSeparator))}))}},{key:"skipWhitespacesBeforeArgSeparators",value:function(t){var n=this;return e.filterTokensByNeighbors(t,(function(e,t,r){return!tokenMatcher(e,n.lexerConfig.ArgSeparator)&&tokenMatcher(t,n.lexerConfig.WhiteSpace)&&tokenMatcher(r,n.lexerConfig.ArgSeparator)}))}},{key:"trimTrailingWhitespaces",value:function(e){return e.length>0&&tokenMatcher(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}],[{key:"filterTokensByNeighbors",value:function(e,t){if(e.length<3)return e;for(var n=0,r=[e[n++]];n<e.length-1;)t(e[n-1],e[n],e[n+1])||r.push(e[n]),++n;return r.push(e[n]),r}}]),e}();function _classCallCheck$1I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1I(e,t,n){return t&&_defineProperties$1I(e.prototype,t),n&&_defineProperties$1I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Unparser=function(){function e(t,n,r,a){_classCallCheck$1I(this,e),this.config=t,this.lexerConfig=n,this.sheetMappingFn=r,this.namedExpressions=a}return _createClass$1I(e,[{key:"unparse",value:function(e,t){return"="+this.unparseAst(e,t)}},{key:"unparseAst",value:function(e,t){var n,r,a=this;switch(e.type){case AstNodeType.EMPTY:return imageWithWhitespace("",e.leadingWhitespace);case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(e.value,this.config.decimalSeparator),e.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+e.value+'"',e.leadingWhitespace);case AstNodeType.FUNCTION_CALL:var i=e.args.map((function(e){return void 0!==e?a.unparseAst(e,t):""})).join(this.config.functionArgSeparator),o=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+i+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(o,e.leadingWhitespace);case AstNodeType.NAMED_EXPRESSION:return imageWithWhitespace((null===(n=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))||void 0===n?void 0:n.displayName)||e.expressionName,e.leadingWhitespace);case AstNodeType.CELL_REFERENCE:var s;return s=void 0!==e.reference.sheet?this.unparseSheetName(e.reference.sheet)+"!":"",imageWithWhitespace(s+=null!==(r=e.reference.unparse(t))&&void 0!==r?r:this.config.translationPackage.getErrorTranslation(ErrorType.REF),e.leadingWhitespace);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:return imageWithWhitespace(this.formatRange(e,t),e.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:var l=this.unparseAst(e.value,t);return imageWithWhitespace("+",e.leadingWhitespace)+l;case AstNodeType.MINUS_UNARY_OP:var u=this.unparseAst(e.value,t);return imageWithWhitespace("-",e.leadingWhitespace)+u;case AstNodeType.PERCENT_OP:return this.unparseAst(e.value,t)+imageWithWhitespace("%",e.leadingWhitespace);case AstNodeType.ERROR:return imageWithWhitespace(this.config.translationPackage.getErrorTranslation(e.error?e.error.type:ErrorType.ERROR),e.leadingWhitespace);case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(e.rawInput,e.leadingWhitespace);case AstNodeType.PARENTHESIS:var c="("+this.unparseAst(e.expression,t)+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(c,e.leadingWhitespace);case AstNodeType.ARRAY:var p="{"+e.args.map((function(e){return e.map((function(e){return a.unparseAst(e,t)})).join(a.config.arrayColumnSeparator)})).join(this.config.arrayRowSeparator)+imageWithWhitespace("}",e.internalWhitespace);return imageWithWhitespace(p,e.leadingWhitespace);default:var d=this.unparseAst(e.left,t),m=this.unparseAst(e.right,t);return d+imageWithWhitespace(binaryOpTokenMap[e.type],e.leadingWhitespace)+m}}},{key:"unparseSheetName",value:function(e){var t=sheetIndexToString(e,this.sheetMappingFn);if(void 0===t)throw new NoSheetWithIdError(e);return t}},{key:"formatRange",value:function(e,t){var n="",r="";void 0!==e.start.sheet&&e.sheetReferenceType!==RangeSheetReferenceType.RELATIVE&&(n=this.unparseSheetName(e.start.sheet)+"!"),void 0!==e.end.sheet&&e.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE&&(r=this.unparseSheetName(e.end.sheet)+"!");var a=e.start.unparse(t),i=e.end.unparse(t);return void 0===a||void 0===i?this.config.translationPackage.getErrorTranslation(ErrorType.REF):"".concat(n).concat(a,":").concat(r).concat(i)}}]),e}();function formatNumber(e,t){return e.toString().replace(".",t)}function _slicedToArray$s(e,t){return _arrayWithHoles$s(e)||_iterableToArrayLimit$s(e,t)||_unsupportedIterableToArray$O(e,t)||_nonIterableRest$s()}function _nonIterableRest$s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$O(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$O(e,t):void 0}}function _arrayLikeToArray$O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$s(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$s(e){if(Array.isArray(e))return e}function _classCallCheck$1H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1H(e,t,n){return t&&_defineProperties$1H(e.prototype,t),n&&_defineProperties$1H(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ParserWithCaching=function(){function e(t,n,r){_classCallCheck$1H(this,e),this.config=t,this.functionRegistry=n,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=buildLexerConfig(t),this.lexer=new FormulaLexer(this.lexerConfig),this.formulaParser=new FormulaParser(this.lexerConfig,this.sheetMapping),this.cache=new Cache(this.functionRegistry)}return _createClass$1H(e,[{key:"parse",value:function(e,t){var n=this.tokenizeFormula(e);if(n.errors.length>0){var r=n.errors.map((function(e){return{type:ParsingErrorType.LexingError,message:e.message}}));return{ast:buildParsingErrorAst(),errors:r,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}var a=this.computeHashFromTokens(n.tokens,t),i=this.cache.get(a);if(void 0!==i)++this.statsCacheUsed;else{var o=this.bindWhitespacesToTokens(n.tokens),s=this.formulaParser.parseFromTokens(o,t);if(s.errors.length>0)return Object.assign(Object.assign({},s),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});i=this.cache.set(a,s.ast)}var l=i;return{ast:l.ast,errors:[],hasVolatileFunction:l.hasVolatileFunction,hasStructuralChangeFunction:l.hasStructuralChangeFunction,dependencies:l.relativeDependencies}}},{key:"fetchCachedResultForAst",value:function(e){var t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}},{key:"fetchCachedResult",value:function(e){var t=this.cache.get(e);if(void 0===t)throw new Error("There is no AST with such key in the cache");return{ast:t.ast,errors:[],hasVolatileFunction:t.hasVolatileFunction,hasStructuralChangeFunction:t.hasStructuralChangeFunction,dependencies:t.relativeDependencies}}},{key:"computeHashFromTokens",value:function(e,t){for(var n,r="",a=0;a<e.length;){var i=e[a];if(tokenMatcher(i,CellReference)){var o=cellAddressFromString(this.sheetMapping,i.image,t);r=void 0===o?r.concat(i.image):r.concat(o.hash(!0))}else if(tokenMatcher(i,ProcedureName)){var s=i.image.toUpperCase().slice(0,-1),l=null!==(n=this.lexerConfig.functionMapping[s])&&void 0!==n?n:s;r=r.concat(l,"(")}else if(tokenMatcher(i,ColumnRange)){var u=_slicedToArray$s(i.image.split(":"),2),c=u[0],p=u[1],d=columnAddressFromString(this.sheetMapping,c,t),m=columnAddressFromString(this.sheetMapping,p,t);r=void 0===d||void 0===m?r.concat("!REF"):r.concat(d.hash(!0),":",m.hash(!0))}else if(tokenMatcher(i,RowRange)){var f=_slicedToArray$s(i.image.split(":"),2),h=f[0],y=f[1],b=rowAddressFromString(this.sheetMapping,h,t),g=rowAddressFromString(this.sheetMapping,y,t);r=void 0===b||void 0===g?r.concat("!REF"):r.concat(b.hash(!0),":",g.hash(!0))}else r=r.concat(i.image);a++}return r}},{key:"rememberNewAst",value:function(e){var t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}},{key:"computeHashFromAst",value:function(e){return"="+this.computeHashOfAstNode(e)}},{key:"computeHashOfAstNode",value:function(e){var t=this;switch(e.type){case AstNodeType.EMPTY:return e.leadingWhitespace||"";case AstNodeType.NUMBER:return imageWithWhitespace(formatNumber(e.value,this.config.decimalSeparator),e.leadingWhitespace);case AstNodeType.STRING:return imageWithWhitespace('"'+e.value+'"',e.leadingWhitespace);case AstNodeType.NAMED_EXPRESSION:return imageWithWhitespace(e.expressionName,e.leadingWhitespace);case AstNodeType.FUNCTION_CALL:var n=e.args.map((function(e){return t.computeHashOfAstNode(e)})).join(this.config.functionArgSeparator),r=e.procedureName+"("+n+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(r,e.leadingWhitespace);case AstNodeType.CELL_REFERENCE:return imageWithWhitespace(e.reference.hash(!0),e.leadingWhitespace);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:return imageWithWhitespace(e.start.hash(e.sheetReferenceType!==RangeSheetReferenceType.RELATIVE)+":"+e.end.hash(e.sheetReferenceType===RangeSheetReferenceType.BOTH_ABSOLUTE),e.leadingWhitespace);case AstNodeType.MINUS_UNARY_OP:return imageWithWhitespace("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case AstNodeType.PLUS_UNARY_OP:return imageWithWhitespace("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case AstNodeType.PERCENT_OP:return this.computeHashOfAstNode(e.value)+imageWithWhitespace("%",e.leadingWhitespace);case AstNodeType.ERROR:return imageWithWhitespace(this.config.translationPackage.getErrorTranslation(e.error?e.error.type:ErrorType.ERROR),e.leadingWhitespace);case AstNodeType.ERROR_WITH_RAW_INPUT:return imageWithWhitespace(e.rawInput,e.leadingWhitespace);case AstNodeType.ARRAY:return imageWithWhitespace("{"+e.args.map((function(e){return e.map((function(e){return t.computeHashOfAstNode(e)})).join(",")})).join(";")+imageWithWhitespace("}",e.internalWhitespace),e.leadingWhitespace);case AstNodeType.PARENTHESIS:var a="("+this.computeHashOfAstNode(e.expression)+imageWithWhitespace(")",e.internalWhitespace);return imageWithWhitespace(a,e.leadingWhitespace);default:return this.computeHashOfAstNode(e.left)+imageWithWhitespace(binaryOpTokenMap[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}},{key:"bindWhitespacesToTokens",value:function(e){var t=[],n=e[0];tokenMatcher(n,this.lexerConfig.WhiteSpace)||t.push(n);for(var r=1;r<e.length;++r){var a=e[r];if(!tokenMatcher(a,this.lexerConfig.WhiteSpace)){var i=e[r-1];tokenMatcher(i,this.lexerConfig.WhiteSpace)&&(a.leadingWhitespace=i),t.push(a)}}return t}},{key:"tokenizeFormula",value:function(e){return this.lexer.tokenizeFormula(e)}}]),e}(),collectDependenciesFn=function e(t,n,r,a){switch(t.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:return;case AstNodeType.NAMED_EXPRESSION:return void(a&&r.push(new NamedExpressionDependency(t.expressionName)));case AstNodeType.CELL_REFERENCE:return void(a&&r.push(new AddressDependency(t.reference)));case AstNodeType.CELL_RANGE:return void(a&&t.start.sheet===t.end.sheet&&r.push(new CellRangeDependency(t.start,t.end)));case AstNodeType.COLUMN_RANGE:return void(a&&t.start.sheet===t.end.sheet&&r.push(new ColumnRangeDependency(t.start,t.end)));case AstNodeType.ROW_RANGE:return void(a&&t.start.sheet===t.end.sheet&&r.push(new RowRangeDependency(t.start,t.end)));case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return void e(t.value,n,r,!0);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return e(t.left,n,r,!0),void e(t.right,n,r,!0);case AstNodeType.PARENTHESIS:return void e(t.expression,n,r,a);case AstNodeType.FUNCTION_CALL:var i=!n.doesFunctionNeedArgumentToBeComputed(t.procedureName);return void t.args.forEach((function(t){return e(t,n,r,i)}))}},collectDependencies=function(e,t){var n=new Array;return collectDependenciesFn(e,t,n,!0),n};function _classCallCheck$1G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1G(e,t,n){return t&&_defineProperties$1G(e.prototype,t),n&&_defineProperties$1G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var AddressDependency=function(){function e(t){_classCallCheck$1G(this,e),this.dependency=t}return _createClass$1G(e,[{key:"absolutize",value:function(e){return this.dependency.toSimpleCellAddress(e)}}]),e}(),CellRangeDependency=function(){function e(t,n){_classCallCheck$1G(this,e),this.start=t,this.end=n}return _createClass$1G(e,[{key:"absolutize",value:function(e){return new AbsoluteCellRange(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}}]),e}(),ColumnRangeDependency=function(){function e(t,n){_classCallCheck$1G(this,e),this.start=t,this.end=n}return _createClass$1G(e,[{key:"absolutize",value:function(e){var t=this.start.toSimpleColumnAddress(e),n=this.end.toSimpleColumnAddress(e);return new AbsoluteColumnRange(t.sheet,t.col,n.col)}}]),e}(),RowRangeDependency=function(){function e(t,n){_classCallCheck$1G(this,e),this.start=t,this.end=n}return _createClass$1G(e,[{key:"absolutize",value:function(e){var t=this.start.toSimpleRowAddress(e),n=this.end.toSimpleRowAddress(e);return new AbsoluteRowRange(t.sheet,t.row,n.row)}}]),e}(),NamedExpressionDependency=function(){function e(t){_classCallCheck$1G(this,e),this.name=t}return _createClass$1G(e,[{key:"absolutize",value:function(e){return this}}]),e}();function _classCallCheck$1F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1F(e,t,n){return t&&_defineProperties$1F(e.prototype,t),n&&_defineProperties$1F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var RowsSpan=function(){function e(t,n,r){if(_classCallCheck$1F(this,e),this.sheet=t,this.rowStart=n,this.rowEnd=r,n<0)throw Error("Starting row cant be less than 0");if(r<n)throw Error("Row span cant end before start")}return _createClass$1F(e,[{key:"numberOfRows",get:function(){return this.rowEnd-this.rowStart+1}},{key:"start",get:function(){return this.rowStart}},{key:"end",get:function(){return this.rowEnd}},{key:"rows",value:regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.rowStart;case 1:if(!(t<=this.rowEnd)){e.next=7;break}return e.next=4,t;case 4:++t,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"intersect",value:function(t){if(this.sheet!==t.sheet)throw Error("Can't intersect spans from different sheets");var n=Math.max(this.rowStart,t.rowStart),r=Math.min(this.rowEnd,t.rowEnd);return n>r?null:new e(this.sheet,n,r)}},{key:"firstRow",value:function(){return new e(this.sheet,this.rowStart,this.rowStart)}}],[{key:"fromNumberOfRows",value:function(t,n,r){return new e(t,n,n+r-1)}},{key:"fromRowStartAndEnd",value:function(t,n,r){return new e(t,n,r)}}]),e}(),ColumnsSpan=function(){function e(t,n,r){if(_classCallCheck$1F(this,e),this.sheet=t,this.columnStart=n,this.columnEnd=r,n<0)throw Error("Starting column cant be less than 0");if(r<n)throw Error("Column span cant end before start")}return _createClass$1F(e,[{key:"numberOfColumns",get:function(){return this.columnEnd-this.columnStart+1}},{key:"start",get:function(){return this.columnStart}},{key:"end",get:function(){return this.columnEnd}},{key:"columns",value:regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.columnStart;case 1:if(!(t<=this.columnEnd)){e.next=7;break}return e.next=4,t;case 4:++t,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"intersect",value:function(t){if(this.sheet!==t.sheet)throw Error("Can't intersect spans from different sheets");var n=Math.max(this.columnStart,t.columnStart),r=Math.min(this.columnEnd,t.columnEnd);return n>r?null:new e(this.sheet,n,r)}},{key:"firstColumn",value:function(){return new e(this.sheet,this.columnStart,this.columnStart)}}],[{key:"fromNumberOfColumns",value:function(t,n,r){return new e(t,n,n+r-1)}},{key:"fromColumnStartAndEnd",value:function(t,n,r){return new e(t,n,r)}}]),e}();function _inherits$V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$W(e,t)}function _setPrototypeOf$W(e,t){return _setPrototypeOf$W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$W(e,t)}function _createSuper$V(e){var t=_isNativeReflectConstruct$W();return function(){var n,r=_getPrototypeOf$V(e);if(t){var a=_getPrototypeOf$V(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$V(this,n)}}function _possibleConstructorReturn$V(e,t){if(t&&("object"===_typeof$Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$V(e)}function _assertThisInitialized$V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$W(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$V(e){return _getPrototypeOf$V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$V(e)}function _classCallCheck$1E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1E(e,t,n){return t&&_defineProperties$1E(e.prototype,t),n&&_defineProperties$1E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof$Z(e){return _typeof$Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$Z(e)}var WRONG_RANGE_SIZE="AbsoluteCellRange: Wrong range size";function isSimpleCellRange(e){return!(!e||"object"!==_typeof$Z(e)&&"function"!=typeof e)&&("start"in e&&isSimpleCellAddress(e.start)&&"end"in e&&isSimpleCellAddress(e.end))}var simpleCellRange=function(e,t){return{start:e,end:t}},AbsoluteCellRange=function(){function e(t,n){if(_classCallCheck$1E(this,e),t.sheet!==n.sheet)throw new SheetsNotEqual(t.sheet,n.sheet);this.start=simpleCellAddress(t.sheet,t.col,t.row),this.end=simpleCellAddress(n.sheet,n.col,n.row)}return _createClass$1E(e,[{key:"sheet",get:function(){return this.start.sheet}},{key:"isFinite",value:function(){return Number.isFinite(this.size())}},{key:"doesOverlap",value:function(e){return this.start.sheet==e.start.sheet&&(!(this.end.row<e.start.row||this.start.row>e.end.row)&&!(this.end.col<e.start.col||this.start.col>e.end.col))}},{key:"addressInRange",value:function(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col)}},{key:"columnInRange",value:function(e){return this.sheet===e.sheet&&(this.start.col<=e.col&&this.end.col>=e.col)}},{key:"rowInRange",value:function(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row)}},{key:"containsRange",value:function(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}},{key:"intersectionWith",value:function(t){if(this.sheet===t.start.sheet){var n=Math.max(this.start.row,t.start.row),r=Math.min(this.end.row,t.end.row),a=Math.max(this.start.col,t.start.col),i=Math.min(this.end.col,t.end.col);if(!(n>r||a>i))return new e(simpleCellAddress(this.sheet,a,n),simpleCellAddress(this.sheet,i,r))}}},{key:"includesRow",value:function(e){return this.start.row<e&&this.end.row>=e}},{key:"includesColumn",value:function(e){return this.start.col<e&&this.end.col>=e}},{key:"shiftByRows",value:function(e){this.start.row+=e,this.end.row+=e}},{key:"expandByRows",value:function(e){this.end.row+=e}},{key:"shiftByColumns",value:function(e){this.start.col+=e,this.end.col+=e}},{key:"shifted",value:function(t,n){return e.spanFrom(simpleCellAddress(this.sheet,this.start.col+t,this.start.row+n),this.width(),this.height())}},{key:"expandByColumns",value:function(e){this.end.col+=e}},{key:"moveToSheet",value:function(e){this.start.sheet=e,this.end.sheet=e}},{key:"removeSpan",value:function(e){e instanceof RowsSpan?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}},{key:"shouldBeRemoved",value:function(){return this.width()<=0||this.height()<=0}},{key:"rangeWithSameWidth",value:function(t,n){return e.spanFrom(simpleCellAddress(this.sheet,this.start.col,t),this.width(),n)}},{key:"rangeWithSameHeight",value:function(t,n){return e.spanFrom(simpleCellAddress(this.sheet,t,this.start.row),n,this.height())}},{key:"toString",value:function(){return"".concat(this.start.sheet,",").concat(this.start.col,",").concat(this.start.row,",").concat(this.end.col,",").concat(this.end.row)}},{key:"width",value:function(){return this.end.col-this.start.col+1}},{key:"height",value:function(){return this.end.row-this.start.row+1}},{key:"size",value:function(){return this.height()*this.width()}},{key:"arrayOfAddressesInRange",value:function(){for(var e=[],t=0;t<this.height();++t){e[t]=[];for(var n=0;n<this.width();++n){var r=simpleCellAddress(this.sheet,this.start.col+n,this.start.row+t);e[t].push(r)}}return e}},{key:"withStart",value:function(t){return new e(t,this.end)}},{key:"sameDimensionsAs",value:function(e){return this.width()===e.width()&&this.height()===e.height()}},{key:"sameAs",value:function(e){return equalSimpleCellAddress(this.start,e.start)&&equalSimpleCellAddress(this.end,e.end)}},{key:"addressesArrayMap",value:function(e,t){for(var n=[],r=this.start.row;r<=this.effectiveEndRow(e);){for(var a=this.start.col,i=[];a<=this.effectiveEndColumn(e);)i.push(t(simpleCellAddress(this.start.sheet,a,r))),a++;n.push(i),r++}return n}},{key:"addresses",value:function(e){for(var t=[],n=this.start.row,r=this.effectiveEndRow(e),a=this.effectiveEndColumn(e);n<=r;){for(var i=this.start.col;i<=a;)t.push(simpleCellAddress(this.start.sheet,i,n)),i++;n++}return t}},{key:"addressesWithDirection",value:regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,l,u,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=30;break}if(!(n>0)){e.next=16;break}a=this.effectiveEndRow(r);case 3:if(!(a>=this.start.row)){e.next=14;break}i=this.effectiveEndColumn(r);case 5:if(!(i>=this.start.col)){e.next=11;break}return e.next=8,simpleCellAddress(this.start.sheet,i,a);case 8:i-=1,e.next=5;break;case 11:a-=1,e.next=3;break;case 14:e.next=28;break;case 16:o=this.start.row;case 17:if(!(o<=this.effectiveEndRow(r))){e.next=28;break}s=this.effectiveEndColumn(r);case 19:if(!(s>=this.start.col)){e.next=25;break}return e.next=22,simpleCellAddress(this.start.sheet,s,o);case 22:s-=1,e.next=19;break;case 25:o+=1,e.next=17;break;case 28:e.next=57;break;case 30:if(!(n>0)){e.next=45;break}l=this.effectiveEndRow(r);case 32:if(!(l>=this.start.row)){e.next=43;break}u=this.start.col;case 34:if(!(u<=this.effectiveEndColumn(r))){e.next=40;break}return e.next=37,simpleCellAddress(this.start.sheet,u,l);case 37:u+=1,e.next=34;break;case 40:l-=1,e.next=32;break;case 43:e.next=57;break;case 45:c=this.start.row;case 46:if(!(c<=this.effectiveEndRow(r))){e.next=57;break}p=this.start.col;case 48:if(!(p<=this.effectiveEndColumn(r))){e.next=54;break}return e.next=51,simpleCellAddress(this.start.sheet,p,c);case 51:p+=1,e.next=48;break;case 54:c+=1,e.next=46;break;case 57:case"end":return e.stop()}}),e,this)}))},{key:"getAddress",value:function(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return simpleCellAddress(this.start.sheet,this.start.col+e,this.start.row+t)}},{key:"exceedsSheetSizeLimits",value:function(e,t){return this.end.col>=e||this.end.row>=t}},{key:"effectiveEndColumn",value:function(e){return this.end.col}},{key:"effectiveEndRow",value:function(e){return this.end.row}},{key:"effectiveWidth",value:function(e){return this.width()}},{key:"effectiveHeight",value:function(e){return this.height()}},{key:"removeRows",value:function(e,t){if(!(e>this.end.row)){if(t<this.start.row){var n=t-e+1;return this.shiftByRows(-n)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}},{key:"removeColumns",value:function(e,t){if(!(e>this.end.col)){if(t<this.start.col){var n=t-e+1;return this.shiftByColumns(-n)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}],[{key:"fromAst",value:function(t,n){return t.type===AstNodeType.CELL_RANGE?e.fromCellRange(t,n):t.type===AstNodeType.COLUMN_RANGE?AbsoluteColumnRange.fromColumnRange(t,n):AbsoluteRowRange.fromRowRangeAst(t,n)}},{key:"fromAstOrUndef",value:function(t,n){try{return e.fromAst(t,n)}catch(e){return}}},{key:"fromCellRange",value:function(t,n){return new e(t.start.toSimpleCellAddress(n),t.end.toSimpleCellAddress(n))}},{key:"spanFrom",value:function(t,n,r){var a=e.spanFromOrUndef(t,n,r);if(void 0===a)throw new Error(WRONG_RANGE_SIZE);return a}},{key:"spanFromOrUndef",value:function(t,n,r){if(!Number.isFinite(n)&&Number.isFinite(r)){if(0!==t.col)return;return new AbsoluteRowRange(t.sheet,t.row,t.row+r-1)}if(!Number.isFinite(r)&&Number.isFinite(n)){if(0!==t.row)return;return new AbsoluteColumnRange(t.sheet,t.col,t.col+n-1)}if(Number.isFinite(r)&&Number.isFinite(n))return new e(t,simpleCellAddress(t.sheet,t.col+n-1,t.row+r-1))}},{key:"fromCoordinates",value:function(t,n,r,a,i){return new e(simpleCellAddress(t,n,r),simpleCellAddress(t,a,i))}}]),e}(),AbsoluteColumnRange=function(e){_inherits$V(n,e);var t=_createSuper$V(n);function n(e,r,a){return _classCallCheck$1E(this,n),t.call(this,simpleCellAddress(e,r,0),simpleCellAddress(e,a,Number.POSITIVE_INFINITY))}return _createClass$1E(n,[{key:"shouldBeRemoved",value:function(){return this.width()<=0}},{key:"shiftByRows",value:function(e){}},{key:"expandByRows",value:function(e){}},{key:"shifted",value:function(e,t){return new n(this.sheet,this.start.col+e,this.end.col+e)}},{key:"rangeWithSameHeight",value:function(e,t){return new n(this.sheet,e,e+t-1)}},{key:"exceedsSheetSizeLimits",value:function(e,t){return this.end.col>=e}},{key:"effectiveEndRow",value:function(e){return this.effectiveHeight(e)-1}},{key:"effectiveHeight",value:function(e){return e.getSheetHeight(this.sheet)}},{key:"removeRows",value:function(e,t){}}],[{key:"fromColumnRange",value:function(e,t){var r=e.start.toSimpleColumnAddress(t),a=e.end.toSimpleColumnAddress(t);if(r.sheet!==a.sheet)throw new SheetsNotEqual(r.sheet,a.sheet);return new n(r.sheet,r.col,a.col)}}]),n}(AbsoluteCellRange),AbsoluteRowRange=function(e){_inherits$V(n,e);var t=_createSuper$V(n);function n(e,r,a){return _classCallCheck$1E(this,n),t.call(this,simpleCellAddress(e,0,r),simpleCellAddress(e,Number.POSITIVE_INFINITY,a))}return _createClass$1E(n,[{key:"shouldBeRemoved",value:function(){return this.height()<=0}},{key:"shiftByColumns",value:function(e){}},{key:"expandByColumns",value:function(e){}},{key:"shifted",value:function(e,t){return new n(this.sheet,this.start.row+t,this.end.row+t)}},{key:"rangeWithSameWidth",value:function(e,t){return new n(this.sheet,e,e+t-1)}},{key:"exceedsSheetSizeLimits",value:function(e,t){return this.end.row>=t}},{key:"effectiveEndColumn",value:function(e){return this.effectiveWidth(e)-1}},{key:"effectiveWidth",value:function(e){return e.getSheetWidth(this.sheet)}},{key:"removeColumns",value:function(e,t){}}],[{key:"fromRowRangeAst",value:function(e,t){var r=e.start.toSimpleRowAddress(t),a=e.end.toSimpleRowAddress(t);if(r.sheet!==a.sheet)throw new SheetsNotEqual(r.sheet,a.sheet);return new n(r.sheet,r.row,a.row)}}]),n}(AbsoluteCellRange),absolutizeDependencies=function(e,t){return e.map((function(e){return e.absolutize(t)}))},filterDependenciesOutOfScope=function(e){return e.filter((function(e){return e instanceof NamedExpressionDependency||(e instanceof AbsoluteCellRange?!(invalidSimpleCellAddress(e.start)||invalidSimpleCellAddress(e.end)):!invalidSimpleCellAddress(e))}))};function _defineProperties$1D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1D(e,t,n){return t&&_defineProperties$1D(e.prototype,t),n&&_defineProperties$1D(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck$1D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var InterpreterState=_createClass$1D((function e(t,n,r){_classCallCheck$1D(this,e),this.formulaAddress=t,this.arraysFlag=n,this.formulaVertex=r})),PROPER_FUNCTION_NAME=functionName$1.PROPER,fails$3=fails$B,whitespaces=whitespaces$2,non="",stringTrimForced=function(e){return fails$3((function(){return!!whitespaces[e]()||non[e]()!==non||PROPER_FUNCTION_NAME&&whitespaces[e].name!==e}))},$$r=_export,$trim=stringTrim.trim,forcedStringTrimMethod=stringTrimForced;$$r({target:"String",proto:!0,forced:forcedStringTrimMethod("trim")},{trim:function(){return $trim(this)}});var $$q=_export,$includes=arrayIncludes.includes,addToUnscopables$3=addToUnscopables$5;$$q({target:"Array",proto:!0},{includes:function(e){return $includes(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$3("includes");var unorm$1={exports:{}};!function(e){!function(t){for(var n=[null,0,{}],r=44032,a=4352,i=function(e,t){this.codepoint=e,this.feature=t},o={},s=[],l=0;l<=255;++l)s[l]=0;var u=[function(e,t,r){return t<60||13311<t&&t<42607?new i(t,n):e(t,r)},function(e,t,n){var r=o[t];return r||(r=e(t,n)).feature&&++s[t>>8&255]>10&&(o[t]=r),r},function(e,t,n){return n?e(t,n):new i(t,null)},function(e,t,n){var o;if(t<a||4371<=t&&t<r||55204<t)return e(t,n);if(a<=t&&t<4371){var s={},l=21*(t-a);for(o=0;o<21;++o)s[4449+o]=r+28*(o+l);return new i(t,[,,s])}var u=t-r,c=u%28,p=[];if(0!==c)p[0]=[r+u-c,4519+c];else for(p[0]=[a+Math.floor(u/588),4449+Math.floor(u%588/28)],p[2]={},o=1;o<28;++o)p[2][4519+o]=t+o;return new i(t,p)},function(e,t,r){var a=(i.udata[65280&t]||{})[t];return new i(t,a||n)}];i.fromCharCode=u.reduceRight((function(e,t){return function(n,r){return t(e,n,r)}}),null),i.isHighSurrogate=function(e){return e>=55296&&e<=56319},i.isLowSurrogate=function(e){return e>=56320&&e<=57343},i.prototype.prepFeature=function(){this.feature||(this.feature=i.fromCharCode(this.codepoint,!0).feature)},i.prototype.toString=function(){if(this.codepoint<65536)return String.fromCharCode(this.codepoint);var e=this.codepoint-65536;return String.fromCharCode(Math.floor(e/1024)+55296,e%1024+56320)},i.prototype.getDecomp=function(){return this.prepFeature(),this.feature[0]||null},i.prototype.isCompatibility=function(){return this.prepFeature(),!!this.feature[1]&&256&this.feature[1]},i.prototype.isExclude=function(){return this.prepFeature(),!!this.feature[1]&&512&this.feature[1]},i.prototype.getCanonicalClass=function(){return this.prepFeature(),this.feature[1]?255&this.feature[1]:0},i.prototype.getComposite=function(e){if(this.prepFeature(),!this.feature[2])return null;var t=this.feature[2][e.codepoint];return t?i.fromCharCode(t):null};var c=function(e){this.str=e,this.cursor=0};c.prototype.next=function(){if(this.str&&this.cursor<this.str.length){var e,t=this.str.charCodeAt(this.cursor++);return i.isHighSurrogate(t)&&this.cursor<this.str.length&&i.isLowSurrogate(e=this.str.charCodeAt(this.cursor))&&(t=1024*(t-55296)+(e-56320)+65536,++this.cursor),i.fromCharCode(t)}return this.str=null,null};var p=function(e,t){this.it=e,this.canonical=t,this.resBuf=[]};p.prototype.next=function(){if(0===this.resBuf.length){var e=this.it.next();if(!e)return null;this.resBuf=function e(t,n){var r=n.getDecomp();if(!r||t&&n.isCompatibility())return[n];for(var a=[],o=0;o<r.length;++o){var s=e(t,i.fromCharCode(r[o]));a=a.concat(s)}return a}(this.canonical,e)}return this.resBuf.shift()};var d=function(e){this.it=e,this.resBuf=[]};d.prototype.next=function(){var e;if(0===this.resBuf.length)do{var t=this.it.next();if(!t)break;e=t.getCanonicalClass();var n=this.resBuf.length;if(0!==e)for(;n>0;--n){if(this.resBuf[n-1].getCanonicalClass()<=e)break}this.resBuf.splice(n,0,t)}while(0!==e);return this.resBuf.shift()};var m=function(e){this.it=e,this.procBuf=[],this.resBuf=[],this.lastClass=null};m.prototype.next=function(){for(;0===this.resBuf.length;){var e=this.it.next();if(!e){this.resBuf=this.procBuf,this.procBuf=[];break}if(0===this.procBuf.length)this.lastClass=e.getCanonicalClass(),this.procBuf.push(e);else{var t=this.procBuf[0].getComposite(e),n=e.getCanonicalClass();t&&(this.lastClass<n||0===this.lastClass)?this.procBuf[0]=t:(0===n&&(this.resBuf=this.procBuf,this.procBuf=[]),this.lastClass=n,this.procBuf.push(e))}}return this.resBuf.shift()};var f=function(e,t){for(var n,r=function(e,t){switch(e){case"NFD":return new d(new p(new c(t),!0));case"NFKD":return new d(new p(new c(t),!1));case"NFC":return new m(new d(new p(new c(t),!0)));case"NFKC":return new m(new d(new p(new c(t),!1)))}throw e+" is invalid"}(e,t),a="";n=r.next();)a+=n.toString();return a};i.udata={0:{60:[,,{824:8814}],61:[,,{824:8800}],62:[,,{824:8815}],65:[,,{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260}],66:[,,{775:7682,803:7684,817:7686}],67:[,,{769:262,770:264,775:266,780:268,807:199}],68:[,,{775:7690,780:270,803:7692,807:7696,813:7698,817:7694}],69:[,,{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706}],70:[,,{775:7710}],71:[,,{769:500,770:284,772:7712,774:286,775:288,780:486,807:290}],72:[,,{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722}],73:[,,{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724}],74:[,,{770:308}],75:[,,{769:7728,780:488,803:7730,807:310,817:7732}],76:[,,{769:313,780:317,803:7734,807:315,813:7740,817:7738}],77:[,,{769:7742,775:7744,803:7746}],78:[,,{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752}],79:[,,{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490}],80:[,,{769:7764,775:7766}],82:[,,{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774}],83:[,,{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350}],84:[,,{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790}],85:[,,{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796}],86:[,,{771:7804,803:7806}],87:[,,{768:7808,769:7810,770:372,775:7814,776:7812,803:7816}],88:[,,{775:7818,776:7820}],89:[,,{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924}],90:[,,{769:377,770:7824,775:379,780:381,803:7826,817:7828}],97:[,,{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261}],98:[,,{775:7683,803:7685,817:7687}],99:[,,{769:263,770:265,775:267,780:269,807:231}],100:[,,{775:7691,780:271,803:7693,807:7697,813:7699,817:7695}],101:[,,{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707}],102:[,,{775:7711}],103:[,,{769:501,770:285,772:7713,774:287,775:289,780:487,807:291}],104:[,,{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830}],105:[,,{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725}],106:[,,{770:309,780:496}],107:[,,{769:7729,780:489,803:7731,807:311,817:7733}],108:[,,{769:314,780:318,803:7735,807:316,813:7741,817:7739}],109:[,,{769:7743,775:7745,803:7747}],110:[,,{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753}],111:[,,{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491}],112:[,,{769:7765,775:7767}],114:[,,{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775}],115:[,,{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351}],116:[,,{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791}],117:[,,{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797}],118:[,,{771:7805,803:7807}],119:[,,{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817}],120:[,,{775:7819,776:7821}],121:[,,{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925}],122:[,,{769:378,770:7825,775:380,780:382,803:7827,817:7829}],160:[[32],256],168:[[32,776],256,{768:8173,769:901,834:8129}],170:[[97],256],175:[[32,772],256],178:[[50],256],179:[[51],256],180:[[32,769],256],181:[[956],256],184:[[32,807],256],185:[[49],256],186:[[111],256],188:[[49,8260,52],256],189:[[49,8260,50],256],190:[[51,8260,52],256],192:[[65,768]],193:[[65,769]],194:[[65,770],,{768:7846,769:7844,771:7850,777:7848}],195:[[65,771]],196:[[65,776],,{772:478}],197:[[65,778],,{769:506}],198:[,,{769:508,772:482}],199:[[67,807],,{769:7688}],200:[[69,768]],201:[[69,769]],202:[[69,770],,{768:7872,769:7870,771:7876,777:7874}],203:[[69,776]],204:[[73,768]],205:[[73,769]],206:[[73,770]],207:[[73,776],,{769:7726}],209:[[78,771]],210:[[79,768]],211:[[79,769]],212:[[79,770],,{768:7890,769:7888,771:7894,777:7892}],213:[[79,771],,{769:7756,772:556,776:7758}],214:[[79,776],,{772:554}],216:[,,{769:510}],217:[[85,768]],218:[[85,769]],219:[[85,770]],220:[[85,776],,{768:475,769:471,772:469,780:473}],221:[[89,769]],224:[[97,768]],225:[[97,769]],226:[[97,770],,{768:7847,769:7845,771:7851,777:7849}],227:[[97,771]],228:[[97,776],,{772:479}],229:[[97,778],,{769:507}],230:[,,{769:509,772:483}],231:[[99,807],,{769:7689}],232:[[101,768]],233:[[101,769]],234:[[101,770],,{768:7873,769:7871,771:7877,777:7875}],235:[[101,776]],236:[[105,768]],237:[[105,769]],238:[[105,770]],239:[[105,776],,{769:7727}],241:[[110,771]],242:[[111,768]],243:[[111,769]],244:[[111,770],,{768:7891,769:7889,771:7895,777:7893}],245:[[111,771],,{769:7757,772:557,776:7759}],246:[[111,776],,{772:555}],248:[,,{769:511}],249:[[117,768]],250:[[117,769]],251:[[117,770]],252:[[117,776],,{768:476,769:472,772:470,780:474}],253:[[121,769]],255:[[121,776]]},256:{256:[[65,772]],257:[[97,772]],258:[[65,774],,{768:7856,769:7854,771:7860,777:7858}],259:[[97,774],,{768:7857,769:7855,771:7861,777:7859}],260:[[65,808]],261:[[97,808]],262:[[67,769]],263:[[99,769]],264:[[67,770]],265:[[99,770]],266:[[67,775]],267:[[99,775]],268:[[67,780]],269:[[99,780]],270:[[68,780]],271:[[100,780]],274:[[69,772],,{768:7700,769:7702}],275:[[101,772],,{768:7701,769:7703}],276:[[69,774]],277:[[101,774]],278:[[69,775]],279:[[101,775]],280:[[69,808]],281:[[101,808]],282:[[69,780]],283:[[101,780]],284:[[71,770]],285:[[103,770]],286:[[71,774]],287:[[103,774]],288:[[71,775]],289:[[103,775]],290:[[71,807]],291:[[103,807]],292:[[72,770]],293:[[104,770]],296:[[73,771]],297:[[105,771]],298:[[73,772]],299:[[105,772]],300:[[73,774]],301:[[105,774]],302:[[73,808]],303:[[105,808]],304:[[73,775]],306:[[73,74],256],307:[[105,106],256],308:[[74,770]],309:[[106,770]],310:[[75,807]],311:[[107,807]],313:[[76,769]],314:[[108,769]],315:[[76,807]],316:[[108,807]],317:[[76,780]],318:[[108,780]],319:[[76,183],256],320:[[108,183],256],323:[[78,769]],324:[[110,769]],325:[[78,807]],326:[[110,807]],327:[[78,780]],328:[[110,780]],329:[[700,110],256],332:[[79,772],,{768:7760,769:7762}],333:[[111,772],,{768:7761,769:7763}],334:[[79,774]],335:[[111,774]],336:[[79,779]],337:[[111,779]],340:[[82,769]],341:[[114,769]],342:[[82,807]],343:[[114,807]],344:[[82,780]],345:[[114,780]],346:[[83,769],,{775:7780}],347:[[115,769],,{775:7781}],348:[[83,770]],349:[[115,770]],350:[[83,807]],351:[[115,807]],352:[[83,780],,{775:7782}],353:[[115,780],,{775:7783}],354:[[84,807]],355:[[116,807]],356:[[84,780]],357:[[116,780]],360:[[85,771],,{769:7800}],361:[[117,771],,{769:7801}],362:[[85,772],,{776:7802}],363:[[117,772],,{776:7803}],364:[[85,774]],365:[[117,774]],366:[[85,778]],367:[[117,778]],368:[[85,779]],369:[[117,779]],370:[[85,808]],371:[[117,808]],372:[[87,770]],373:[[119,770]],374:[[89,770]],375:[[121,770]],376:[[89,776]],377:[[90,769]],378:[[122,769]],379:[[90,775]],380:[[122,775]],381:[[90,780]],382:[[122,780]],383:[[115],256,{775:7835}],416:[[79,795],,{768:7900,769:7898,771:7904,777:7902,803:7906}],417:[[111,795],,{768:7901,769:7899,771:7905,777:7903,803:7907}],431:[[85,795],,{768:7914,769:7912,771:7918,777:7916,803:7920}],432:[[117,795],,{768:7915,769:7913,771:7919,777:7917,803:7921}],439:[,,{780:494}],452:[[68,381],256],453:[[68,382],256],454:[[100,382],256],455:[[76,74],256],456:[[76,106],256],457:[[108,106],256],458:[[78,74],256],459:[[78,106],256],460:[[110,106],256],461:[[65,780]],462:[[97,780]],463:[[73,780]],464:[[105,780]],465:[[79,780]],466:[[111,780]],467:[[85,780]],468:[[117,780]],469:[[220,772]],470:[[252,772]],471:[[220,769]],472:[[252,769]],473:[[220,780]],474:[[252,780]],475:[[220,768]],476:[[252,768]],478:[[196,772]],479:[[228,772]],480:[[550,772]],481:[[551,772]],482:[[198,772]],483:[[230,772]],486:[[71,780]],487:[[103,780]],488:[[75,780]],489:[[107,780]],490:[[79,808],,{772:492}],491:[[111,808],,{772:493}],492:[[490,772]],493:[[491,772]],494:[[439,780]],495:[[658,780]],496:[[106,780]],497:[[68,90],256],498:[[68,122],256],499:[[100,122],256],500:[[71,769]],501:[[103,769]],504:[[78,768]],505:[[110,768]],506:[[197,769]],507:[[229,769]],508:[[198,769]],509:[[230,769]],510:[[216,769]],511:[[248,769]],66045:[,220]},512:{512:[[65,783]],513:[[97,783]],514:[[65,785]],515:[[97,785]],516:[[69,783]],517:[[101,783]],518:[[69,785]],519:[[101,785]],520:[[73,783]],521:[[105,783]],522:[[73,785]],523:[[105,785]],524:[[79,783]],525:[[111,783]],526:[[79,785]],527:[[111,785]],528:[[82,783]],529:[[114,783]],530:[[82,785]],531:[[114,785]],532:[[85,783]],533:[[117,783]],534:[[85,785]],535:[[117,785]],536:[[83,806]],537:[[115,806]],538:[[84,806]],539:[[116,806]],542:[[72,780]],543:[[104,780]],550:[[65,775],,{772:480}],551:[[97,775],,{772:481}],552:[[69,807],,{774:7708}],553:[[101,807],,{774:7709}],554:[[214,772]],555:[[246,772]],556:[[213,772]],557:[[245,772]],558:[[79,775],,{772:560}],559:[[111,775],,{772:561}],560:[[558,772]],561:[[559,772]],562:[[89,772]],563:[[121,772]],658:[,,{780:495}],688:[[104],256],689:[[614],256],690:[[106],256],691:[[114],256],692:[[633],256],693:[[635],256],694:[[641],256],695:[[119],256],696:[[121],256],728:[[32,774],256],729:[[32,775],256],730:[[32,778],256],731:[[32,808],256],732:[[32,771],256],733:[[32,779],256],736:[[611],256],737:[[108],256],738:[[115],256],739:[[120],256],740:[[661],256],66272:[,220]},768:{768:[,230],769:[,230],770:[,230],771:[,230],772:[,230],773:[,230],774:[,230],775:[,230],776:[,230,{769:836}],777:[,230],778:[,230],779:[,230],780:[,230],781:[,230],782:[,230],783:[,230],784:[,230],785:[,230],786:[,230],787:[,230],788:[,230],789:[,232],790:[,220],791:[,220],792:[,220],793:[,220],794:[,232],795:[,216],796:[,220],797:[,220],798:[,220],799:[,220],800:[,220],801:[,202],802:[,202],803:[,220],804:[,220],805:[,220],806:[,220],807:[,202],808:[,202],809:[,220],810:[,220],811:[,220],812:[,220],813:[,220],814:[,220],815:[,220],816:[,220],817:[,220],818:[,220],819:[,220],820:[,1],821:[,1],822:[,1],823:[,1],824:[,1],825:[,220],826:[,220],827:[,220],828:[,220],829:[,230],830:[,230],831:[,230],832:[[768],230],833:[[769],230],834:[,230],835:[[787],230],836:[[776,769],230],837:[,240],838:[,230],839:[,220],840:[,220],841:[,220],842:[,230],843:[,230],844:[,230],845:[,220],846:[,220],848:[,230],849:[,230],850:[,230],851:[,220],852:[,220],853:[,220],854:[,220],855:[,230],856:[,232],857:[,220],858:[,220],859:[,230],860:[,233],861:[,234],862:[,234],863:[,233],864:[,234],865:[,234],866:[,233],867:[,230],868:[,230],869:[,230],870:[,230],871:[,230],872:[,230],873:[,230],874:[,230],875:[,230],876:[,230],877:[,230],878:[,230],879:[,230],884:[[697]],890:[[32,837],256],894:[[59]],900:[[32,769],256],901:[[168,769]],902:[[913,769]],903:[[183]],904:[[917,769]],905:[[919,769]],906:[[921,769]],908:[[927,769]],910:[[933,769]],911:[[937,769]],912:[[970,769]],913:[,,{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124}],917:[,,{768:8136,769:904,787:7960,788:7961}],919:[,,{768:8138,769:905,787:7976,788:7977,837:8140}],921:[,,{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993}],927:[,,{768:8184,769:908,787:8008,788:8009}],929:[,,{788:8172}],933:[,,{768:8170,769:910,772:8169,774:8168,776:939,788:8025}],937:[,,{768:8186,769:911,787:8040,788:8041,837:8188}],938:[[921,776]],939:[[933,776]],940:[[945,769],,{837:8116}],941:[[949,769]],942:[[951,769],,{837:8132}],943:[[953,769]],944:[[971,769]],945:[,,{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115}],949:[,,{768:8050,769:941,787:7952,788:7953}],951:[,,{768:8052,769:942,787:7968,788:7969,834:8134,837:8131}],953:[,,{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150}],959:[,,{768:8056,769:972,787:8e3,788:8001}],961:[,,{787:8164,788:8165}],965:[,,{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166}],969:[,,{768:8060,769:974,787:8032,788:8033,834:8182,837:8179}],970:[[953,776],,{768:8146,769:912,834:8151}],971:[[965,776],,{768:8162,769:944,834:8167}],972:[[959,769]],973:[[965,769]],974:[[969,769],,{837:8180}],976:[[946],256],977:[[952],256],978:[[933],256,{769:979,776:980}],979:[[978,769]],980:[[978,776]],981:[[966],256],982:[[960],256],1008:[[954],256],1009:[[961],256],1010:[[962],256],1012:[[920],256],1013:[[949],256],1017:[[931],256],66422:[,230],66423:[,230],66424:[,230],66425:[,230],66426:[,230]},1024:{1024:[[1045,768]],1025:[[1045,776]],1027:[[1043,769]],1030:[,,{776:1031}],1031:[[1030,776]],1036:[[1050,769]],1037:[[1048,768]],1038:[[1059,774]],1040:[,,{774:1232,776:1234}],1043:[,,{769:1027}],1045:[,,{768:1024,774:1238,776:1025}],1046:[,,{774:1217,776:1244}],1047:[,,{776:1246}],1048:[,,{768:1037,772:1250,774:1049,776:1252}],1049:[[1048,774]],1050:[,,{769:1036}],1054:[,,{776:1254}],1059:[,,{772:1262,774:1038,776:1264,779:1266}],1063:[,,{776:1268}],1067:[,,{776:1272}],1069:[,,{776:1260}],1072:[,,{774:1233,776:1235}],1075:[,,{769:1107}],1077:[,,{768:1104,774:1239,776:1105}],1078:[,,{774:1218,776:1245}],1079:[,,{776:1247}],1080:[,,{768:1117,772:1251,774:1081,776:1253}],1081:[[1080,774]],1082:[,,{769:1116}],1086:[,,{776:1255}],1091:[,,{772:1263,774:1118,776:1265,779:1267}],1095:[,,{776:1269}],1099:[,,{776:1273}],1101:[,,{776:1261}],1104:[[1077,768]],1105:[[1077,776]],1107:[[1075,769]],1110:[,,{776:1111}],1111:[[1110,776]],1116:[[1082,769]],1117:[[1080,768]],1118:[[1091,774]],1140:[,,{783:1142}],1141:[,,{783:1143}],1142:[[1140,783]],1143:[[1141,783]],1155:[,230],1156:[,230],1157:[,230],1158:[,230],1159:[,230],1217:[[1046,774]],1218:[[1078,774]],1232:[[1040,774]],1233:[[1072,774]],1234:[[1040,776]],1235:[[1072,776]],1238:[[1045,774]],1239:[[1077,774]],1240:[,,{776:1242}],1241:[,,{776:1243}],1242:[[1240,776]],1243:[[1241,776]],1244:[[1046,776]],1245:[[1078,776]],1246:[[1047,776]],1247:[[1079,776]],1250:[[1048,772]],1251:[[1080,772]],1252:[[1048,776]],1253:[[1080,776]],1254:[[1054,776]],1255:[[1086,776]],1256:[,,{776:1258}],1257:[,,{776:1259}],1258:[[1256,776]],1259:[[1257,776]],1260:[[1069,776]],1261:[[1101,776]],1262:[[1059,772]],1263:[[1091,772]],1264:[[1059,776]],1265:[[1091,776]],1266:[[1059,779]],1267:[[1091,779]],1268:[[1063,776]],1269:[[1095,776]],1272:[[1067,776]],1273:[[1099,776]]},1280:{1415:[[1381,1410],256],1425:[,220],1426:[,230],1427:[,230],1428:[,230],1429:[,230],1430:[,220],1431:[,230],1432:[,230],1433:[,230],1434:[,222],1435:[,220],1436:[,230],1437:[,230],1438:[,230],1439:[,230],1440:[,230],1441:[,230],1442:[,220],1443:[,220],1444:[,220],1445:[,220],1446:[,220],1447:[,220],1448:[,230],1449:[,230],1450:[,220],1451:[,230],1452:[,230],1453:[,222],1454:[,228],1455:[,230],1456:[,10],1457:[,11],1458:[,12],1459:[,13],1460:[,14],1461:[,15],1462:[,16],1463:[,17],1464:[,18],1465:[,19],1466:[,19],1467:[,20],1468:[,21],1469:[,22],1471:[,23],1473:[,24],1474:[,25],1476:[,230],1477:[,220],1479:[,18]},1536:{1552:[,230],1553:[,230],1554:[,230],1555:[,230],1556:[,230],1557:[,230],1558:[,230],1559:[,230],1560:[,30],1561:[,31],1562:[,32],1570:[[1575,1619]],1571:[[1575,1620]],1572:[[1608,1620]],1573:[[1575,1621]],1574:[[1610,1620]],1575:[,,{1619:1570,1620:1571,1621:1573}],1608:[,,{1620:1572}],1610:[,,{1620:1574}],1611:[,27],1612:[,28],1613:[,29],1614:[,30],1615:[,31],1616:[,32],1617:[,33],1618:[,34],1619:[,230],1620:[,230],1621:[,220],1622:[,220],1623:[,230],1624:[,230],1625:[,230],1626:[,230],1627:[,230],1628:[,220],1629:[,230],1630:[,230],1631:[,220],1648:[,35],1653:[[1575,1652],256],1654:[[1608,1652],256],1655:[[1735,1652],256],1656:[[1610,1652],256],1728:[[1749,1620]],1729:[,,{1620:1730}],1730:[[1729,1620]],1746:[,,{1620:1747}],1747:[[1746,1620]],1749:[,,{1620:1728}],1750:[,230],1751:[,230],1752:[,230],1753:[,230],1754:[,230],1755:[,230],1756:[,230],1759:[,230],1760:[,230],1761:[,230],1762:[,230],1763:[,220],1764:[,230],1767:[,230],1768:[,230],1770:[,220],1771:[,230],1772:[,230],1773:[,220]},1792:{1809:[,36],1840:[,230],1841:[,220],1842:[,230],1843:[,230],1844:[,220],1845:[,230],1846:[,230],1847:[,220],1848:[,220],1849:[,220],1850:[,230],1851:[,220],1852:[,220],1853:[,230],1854:[,220],1855:[,230],1856:[,230],1857:[,230],1858:[,220],1859:[,230],1860:[,220],1861:[,230],1862:[,220],1863:[,230],1864:[,220],1865:[,230],1866:[,230],2027:[,230],2028:[,230],2029:[,230],2030:[,230],2031:[,230],2032:[,230],2033:[,230],2034:[,220],2035:[,230]},2048:{2070:[,230],2071:[,230],2072:[,230],2073:[,230],2075:[,230],2076:[,230],2077:[,230],2078:[,230],2079:[,230],2080:[,230],2081:[,230],2082:[,230],2083:[,230],2085:[,230],2086:[,230],2087:[,230],2089:[,230],2090:[,230],2091:[,230],2092:[,230],2093:[,230],2137:[,220],2138:[,220],2139:[,220],2276:[,230],2277:[,230],2278:[,220],2279:[,230],2280:[,230],2281:[,220],2282:[,230],2283:[,230],2284:[,230],2285:[,220],2286:[,220],2287:[,220],2288:[,27],2289:[,28],2290:[,29],2291:[,230],2292:[,230],2293:[,230],2294:[,220],2295:[,230],2296:[,230],2297:[,220],2298:[,220],2299:[,230],2300:[,230],2301:[,230],2302:[,230],2303:[,230]},2304:{2344:[,,{2364:2345}],2345:[[2344,2364]],2352:[,,{2364:2353}],2353:[[2352,2364]],2355:[,,{2364:2356}],2356:[[2355,2364]],2364:[,7],2381:[,9],2385:[,230],2386:[,220],2387:[,230],2388:[,230],2392:[[2325,2364],512],2393:[[2326,2364],512],2394:[[2327,2364],512],2395:[[2332,2364],512],2396:[[2337,2364],512],2397:[[2338,2364],512],2398:[[2347,2364],512],2399:[[2351,2364],512],2492:[,7],2503:[,,{2494:2507,2519:2508}],2507:[[2503,2494]],2508:[[2503,2519]],2509:[,9],2524:[[2465,2492],512],2525:[[2466,2492],512],2527:[[2479,2492],512]},2560:{2611:[[2610,2620],512],2614:[[2616,2620],512],2620:[,7],2637:[,9],2649:[[2582,2620],512],2650:[[2583,2620],512],2651:[[2588,2620],512],2654:[[2603,2620],512],2748:[,7],2765:[,9],68109:[,220],68111:[,230],68152:[,230],68153:[,1],68154:[,220],68159:[,9],68325:[,230],68326:[,220]},2816:{2876:[,7],2887:[,,{2878:2891,2902:2888,2903:2892}],2888:[[2887,2902]],2891:[[2887,2878]],2892:[[2887,2903]],2893:[,9],2908:[[2849,2876],512],2909:[[2850,2876],512],2962:[,,{3031:2964}],2964:[[2962,3031]],3014:[,,{3006:3018,3031:3020}],3015:[,,{3006:3019}],3018:[[3014,3006]],3019:[[3015,3006]],3020:[[3014,3031]],3021:[,9]},3072:{3142:[,,{3158:3144}],3144:[[3142,3158]],3149:[,9],3157:[,84],3158:[,91],3260:[,7],3263:[,,{3285:3264}],3264:[[3263,3285]],3270:[,,{3266:3274,3285:3271,3286:3272}],3271:[[3270,3285]],3272:[[3270,3286]],3274:[[3270,3266],,{3285:3275}],3275:[[3274,3285]],3277:[,9]},3328:{3398:[,,{3390:3402,3415:3404}],3399:[,,{3390:3403}],3402:[[3398,3390]],3403:[[3399,3390]],3404:[[3398,3415]],3405:[,9],3530:[,9],3545:[,,{3530:3546,3535:3548,3551:3550}],3546:[[3545,3530]],3548:[[3545,3535],,{3530:3549}],3549:[[3548,3530]],3550:[[3545,3551]]},3584:{3635:[[3661,3634],256],3640:[,103],3641:[,103],3642:[,9],3656:[,107],3657:[,107],3658:[,107],3659:[,107],3763:[[3789,3762],256],3768:[,118],3769:[,118],3784:[,122],3785:[,122],3786:[,122],3787:[,122],3804:[[3755,3737],256],3805:[[3755,3745],256]},3840:{3852:[[3851],256],3864:[,220],3865:[,220],3893:[,220],3895:[,220],3897:[,216],3907:[[3906,4023],512],3917:[[3916,4023],512],3922:[[3921,4023],512],3927:[[3926,4023],512],3932:[[3931,4023],512],3945:[[3904,4021],512],3953:[,129],3954:[,130],3955:[[3953,3954],512],3956:[,132],3957:[[3953,3956],512],3958:[[4018,3968],512],3959:[[4018,3969],256],3960:[[4019,3968],512],3961:[[4019,3969],256],3962:[,130],3963:[,130],3964:[,130],3965:[,130],3968:[,130],3969:[[3953,3968],512],3970:[,230],3971:[,230],3972:[,9],3974:[,230],3975:[,230],3987:[[3986,4023],512],3997:[[3996,4023],512],4002:[[4001,4023],512],4007:[[4006,4023],512],4012:[[4011,4023],512],4025:[[3984,4021],512],4038:[,220]},4096:{4133:[,,{4142:4134}],4134:[[4133,4142]],4151:[,7],4153:[,9],4154:[,9],4237:[,220],4348:[[4316],256],69702:[,9],69759:[,9],69785:[,,{69818:69786}],69786:[[69785,69818]],69787:[,,{69818:69788}],69788:[[69787,69818]],69797:[,,{69818:69803}],69803:[[69797,69818]],69817:[,9],69818:[,7]},4352:{69888:[,230],69889:[,230],69890:[,230],69934:[[69937,69927]],69935:[[69938,69927]],69937:[,,{69927:69934}],69938:[,,{69927:69935}],69939:[,9],69940:[,9],70003:[,7],70080:[,9]},4608:{70197:[,9],70198:[,7],70377:[,7],70378:[,9]},4864:{4957:[,230],4958:[,230],4959:[,230],70460:[,7],70471:[,,{70462:70475,70487:70476}],70475:[[70471,70462]],70476:[[70471,70487]],70477:[,9],70502:[,230],70503:[,230],70504:[,230],70505:[,230],70506:[,230],70507:[,230],70508:[,230],70512:[,230],70513:[,230],70514:[,230],70515:[,230],70516:[,230]},5120:{70841:[,,{70832:70844,70842:70843,70845:70846}],70843:[[70841,70842]],70844:[[70841,70832]],70846:[[70841,70845]],70850:[,9],70851:[,7]},5376:{71096:[,,{71087:71098}],71097:[,,{71087:71099}],71098:[[71096,71087]],71099:[[71097,71087]],71103:[,9],71104:[,7]},5632:{71231:[,9],71350:[,9],71351:[,7]},5888:{5908:[,9],5940:[,9],6098:[,9],6109:[,230]},6144:{6313:[,228]},6400:{6457:[,222],6458:[,230],6459:[,220]},6656:{6679:[,230],6680:[,220],6752:[,9],6773:[,230],6774:[,230],6775:[,230],6776:[,230],6777:[,230],6778:[,230],6779:[,230],6780:[,230],6783:[,220],6832:[,230],6833:[,230],6834:[,230],6835:[,230],6836:[,230],6837:[,220],6838:[,220],6839:[,220],6840:[,220],6841:[,220],6842:[,220],6843:[,230],6844:[,230],6845:[,220]},6912:{6917:[,,{6965:6918}],6918:[[6917,6965]],6919:[,,{6965:6920}],6920:[[6919,6965]],6921:[,,{6965:6922}],6922:[[6921,6965]],6923:[,,{6965:6924}],6924:[[6923,6965]],6925:[,,{6965:6926}],6926:[[6925,6965]],6929:[,,{6965:6930}],6930:[[6929,6965]],6964:[,7],6970:[,,{6965:6971}],6971:[[6970,6965]],6972:[,,{6965:6973}],6973:[[6972,6965]],6974:[,,{6965:6976}],6975:[,,{6965:6977}],6976:[[6974,6965]],6977:[[6975,6965]],6978:[,,{6965:6979}],6979:[[6978,6965]],6980:[,9],7019:[,230],7020:[,220],7021:[,230],7022:[,230],7023:[,230],7024:[,230],7025:[,230],7026:[,230],7027:[,230],7082:[,9],7083:[,9],7142:[,7],7154:[,9],7155:[,9]},7168:{7223:[,7],7376:[,230],7377:[,230],7378:[,230],7380:[,1],7381:[,220],7382:[,220],7383:[,220],7384:[,220],7385:[,220],7386:[,230],7387:[,230],7388:[,220],7389:[,220],7390:[,220],7391:[,220],7392:[,230],7394:[,1],7395:[,1],7396:[,1],7397:[,1],7398:[,1],7399:[,1],7400:[,1],7405:[,220],7412:[,230],7416:[,230],7417:[,230]},7424:{7468:[[65],256],7469:[[198],256],7470:[[66],256],7472:[[68],256],7473:[[69],256],7474:[[398],256],7475:[[71],256],7476:[[72],256],7477:[[73],256],7478:[[74],256],7479:[[75],256],7480:[[76],256],7481:[[77],256],7482:[[78],256],7484:[[79],256],7485:[[546],256],7486:[[80],256],7487:[[82],256],7488:[[84],256],7489:[[85],256],7490:[[87],256],7491:[[97],256],7492:[[592],256],7493:[[593],256],7494:[[7426],256],7495:[[98],256],7496:[[100],256],7497:[[101],256],7498:[[601],256],7499:[[603],256],7500:[[604],256],7501:[[103],256],7503:[[107],256],7504:[[109],256],7505:[[331],256],7506:[[111],256],7507:[[596],256],7508:[[7446],256],7509:[[7447],256],7510:[[112],256],7511:[[116],256],7512:[[117],256],7513:[[7453],256],7514:[[623],256],7515:[[118],256],7516:[[7461],256],7517:[[946],256],7518:[[947],256],7519:[[948],256],7520:[[966],256],7521:[[967],256],7522:[[105],256],7523:[[114],256],7524:[[117],256],7525:[[118],256],7526:[[946],256],7527:[[947],256],7528:[[961],256],7529:[[966],256],7530:[[967],256],7544:[[1085],256],7579:[[594],256],7580:[[99],256],7581:[[597],256],7582:[[240],256],7583:[[604],256],7584:[[102],256],7585:[[607],256],7586:[[609],256],7587:[[613],256],7588:[[616],256],7589:[[617],256],7590:[[618],256],7591:[[7547],256],7592:[[669],256],7593:[[621],256],7594:[[7557],256],7595:[[671],256],7596:[[625],256],7597:[[624],256],7598:[[626],256],7599:[[627],256],7600:[[628],256],7601:[[629],256],7602:[[632],256],7603:[[642],256],7604:[[643],256],7605:[[427],256],7606:[[649],256],7607:[[650],256],7608:[[7452],256],7609:[[651],256],7610:[[652],256],7611:[[122],256],7612:[[656],256],7613:[[657],256],7614:[[658],256],7615:[[952],256],7616:[,230],7617:[,230],7618:[,220],7619:[,230],7620:[,230],7621:[,230],7622:[,230],7623:[,230],7624:[,230],7625:[,230],7626:[,220],7627:[,230],7628:[,230],7629:[,234],7630:[,214],7631:[,220],7632:[,202],7633:[,230],7634:[,230],7635:[,230],7636:[,230],7637:[,230],7638:[,230],7639:[,230],7640:[,230],7641:[,230],7642:[,230],7643:[,230],7644:[,230],7645:[,230],7646:[,230],7647:[,230],7648:[,230],7649:[,230],7650:[,230],7651:[,230],7652:[,230],7653:[,230],7654:[,230],7655:[,230],7656:[,230],7657:[,230],7658:[,230],7659:[,230],7660:[,230],7661:[,230],7662:[,230],7663:[,230],7664:[,230],7665:[,230],7666:[,230],7667:[,230],7668:[,230],7669:[,230],7676:[,233],7677:[,220],7678:[,230],7679:[,220]},7680:{7680:[[65,805]],7681:[[97,805]],7682:[[66,775]],7683:[[98,775]],7684:[[66,803]],7685:[[98,803]],7686:[[66,817]],7687:[[98,817]],7688:[[199,769]],7689:[[231,769]],7690:[[68,775]],7691:[[100,775]],7692:[[68,803]],7693:[[100,803]],7694:[[68,817]],7695:[[100,817]],7696:[[68,807]],7697:[[100,807]],7698:[[68,813]],7699:[[100,813]],7700:[[274,768]],7701:[[275,768]],7702:[[274,769]],7703:[[275,769]],7704:[[69,813]],7705:[[101,813]],7706:[[69,816]],7707:[[101,816]],7708:[[552,774]],7709:[[553,774]],7710:[[70,775]],7711:[[102,775]],7712:[[71,772]],7713:[[103,772]],7714:[[72,775]],7715:[[104,775]],7716:[[72,803]],7717:[[104,803]],7718:[[72,776]],7719:[[104,776]],7720:[[72,807]],7721:[[104,807]],7722:[[72,814]],7723:[[104,814]],7724:[[73,816]],7725:[[105,816]],7726:[[207,769]],7727:[[239,769]],7728:[[75,769]],7729:[[107,769]],7730:[[75,803]],7731:[[107,803]],7732:[[75,817]],7733:[[107,817]],7734:[[76,803],,{772:7736}],7735:[[108,803],,{772:7737}],7736:[[7734,772]],7737:[[7735,772]],7738:[[76,817]],7739:[[108,817]],7740:[[76,813]],7741:[[108,813]],7742:[[77,769]],7743:[[109,769]],7744:[[77,775]],7745:[[109,775]],7746:[[77,803]],7747:[[109,803]],7748:[[78,775]],7749:[[110,775]],7750:[[78,803]],7751:[[110,803]],7752:[[78,817]],7753:[[110,817]],7754:[[78,813]],7755:[[110,813]],7756:[[213,769]],7757:[[245,769]],7758:[[213,776]],7759:[[245,776]],7760:[[332,768]],7761:[[333,768]],7762:[[332,769]],7763:[[333,769]],7764:[[80,769]],7765:[[112,769]],7766:[[80,775]],7767:[[112,775]],7768:[[82,775]],7769:[[114,775]],7770:[[82,803],,{772:7772}],7771:[[114,803],,{772:7773}],7772:[[7770,772]],7773:[[7771,772]],7774:[[82,817]],7775:[[114,817]],7776:[[83,775]],7777:[[115,775]],7778:[[83,803],,{775:7784}],7779:[[115,803],,{775:7785}],7780:[[346,775]],7781:[[347,775]],7782:[[352,775]],7783:[[353,775]],7784:[[7778,775]],7785:[[7779,775]],7786:[[84,775]],7787:[[116,775]],7788:[[84,803]],7789:[[116,803]],7790:[[84,817]],7791:[[116,817]],7792:[[84,813]],7793:[[116,813]],7794:[[85,804]],7795:[[117,804]],7796:[[85,816]],7797:[[117,816]],7798:[[85,813]],7799:[[117,813]],7800:[[360,769]],7801:[[361,769]],7802:[[362,776]],7803:[[363,776]],7804:[[86,771]],7805:[[118,771]],7806:[[86,803]],7807:[[118,803]],7808:[[87,768]],7809:[[119,768]],7810:[[87,769]],7811:[[119,769]],7812:[[87,776]],7813:[[119,776]],7814:[[87,775]],7815:[[119,775]],7816:[[87,803]],7817:[[119,803]],7818:[[88,775]],7819:[[120,775]],7820:[[88,776]],7821:[[120,776]],7822:[[89,775]],7823:[[121,775]],7824:[[90,770]],7825:[[122,770]],7826:[[90,803]],7827:[[122,803]],7828:[[90,817]],7829:[[122,817]],7830:[[104,817]],7831:[[116,776]],7832:[[119,778]],7833:[[121,778]],7834:[[97,702],256],7835:[[383,775]],7840:[[65,803],,{770:7852,774:7862}],7841:[[97,803],,{770:7853,774:7863}],7842:[[65,777]],7843:[[97,777]],7844:[[194,769]],7845:[[226,769]],7846:[[194,768]],7847:[[226,768]],7848:[[194,777]],7849:[[226,777]],7850:[[194,771]],7851:[[226,771]],7852:[[7840,770]],7853:[[7841,770]],7854:[[258,769]],7855:[[259,769]],7856:[[258,768]],7857:[[259,768]],7858:[[258,777]],7859:[[259,777]],7860:[[258,771]],7861:[[259,771]],7862:[[7840,774]],7863:[[7841,774]],7864:[[69,803],,{770:7878}],7865:[[101,803],,{770:7879}],7866:[[69,777]],7867:[[101,777]],7868:[[69,771]],7869:[[101,771]],7870:[[202,769]],7871:[[234,769]],7872:[[202,768]],7873:[[234,768]],7874:[[202,777]],7875:[[234,777]],7876:[[202,771]],7877:[[234,771]],7878:[[7864,770]],7879:[[7865,770]],7880:[[73,777]],7881:[[105,777]],7882:[[73,803]],7883:[[105,803]],7884:[[79,803],,{770:7896}],7885:[[111,803],,{770:7897}],7886:[[79,777]],7887:[[111,777]],7888:[[212,769]],7889:[[244,769]],7890:[[212,768]],7891:[[244,768]],7892:[[212,777]],7893:[[244,777]],7894:[[212,771]],7895:[[244,771]],7896:[[7884,770]],7897:[[7885,770]],7898:[[416,769]],7899:[[417,769]],7900:[[416,768]],7901:[[417,768]],7902:[[416,777]],7903:[[417,777]],7904:[[416,771]],7905:[[417,771]],7906:[[416,803]],7907:[[417,803]],7908:[[85,803]],7909:[[117,803]],7910:[[85,777]],7911:[[117,777]],7912:[[431,769]],7913:[[432,769]],7914:[[431,768]],7915:[[432,768]],7916:[[431,777]],7917:[[432,777]],7918:[[431,771]],7919:[[432,771]],7920:[[431,803]],7921:[[432,803]],7922:[[89,768]],7923:[[121,768]],7924:[[89,803]],7925:[[121,803]],7926:[[89,777]],7927:[[121,777]],7928:[[89,771]],7929:[[121,771]]},7936:{7936:[[945,787],,{768:7938,769:7940,834:7942,837:8064}],7937:[[945,788],,{768:7939,769:7941,834:7943,837:8065}],7938:[[7936,768],,{837:8066}],7939:[[7937,768],,{837:8067}],7940:[[7936,769],,{837:8068}],7941:[[7937,769],,{837:8069}],7942:[[7936,834],,{837:8070}],7943:[[7937,834],,{837:8071}],7944:[[913,787],,{768:7946,769:7948,834:7950,837:8072}],7945:[[913,788],,{768:7947,769:7949,834:7951,837:8073}],7946:[[7944,768],,{837:8074}],7947:[[7945,768],,{837:8075}],7948:[[7944,769],,{837:8076}],7949:[[7945,769],,{837:8077}],7950:[[7944,834],,{837:8078}],7951:[[7945,834],,{837:8079}],7952:[[949,787],,{768:7954,769:7956}],7953:[[949,788],,{768:7955,769:7957}],7954:[[7952,768]],7955:[[7953,768]],7956:[[7952,769]],7957:[[7953,769]],7960:[[917,787],,{768:7962,769:7964}],7961:[[917,788],,{768:7963,769:7965}],7962:[[7960,768]],7963:[[7961,768]],7964:[[7960,769]],7965:[[7961,769]],7968:[[951,787],,{768:7970,769:7972,834:7974,837:8080}],7969:[[951,788],,{768:7971,769:7973,834:7975,837:8081}],7970:[[7968,768],,{837:8082}],7971:[[7969,768],,{837:8083}],7972:[[7968,769],,{837:8084}],7973:[[7969,769],,{837:8085}],7974:[[7968,834],,{837:8086}],7975:[[7969,834],,{837:8087}],7976:[[919,787],,{768:7978,769:7980,834:7982,837:8088}],7977:[[919,788],,{768:7979,769:7981,834:7983,837:8089}],7978:[[7976,768],,{837:8090}],7979:[[7977,768],,{837:8091}],7980:[[7976,769],,{837:8092}],7981:[[7977,769],,{837:8093}],7982:[[7976,834],,{837:8094}],7983:[[7977,834],,{837:8095}],7984:[[953,787],,{768:7986,769:7988,834:7990}],7985:[[953,788],,{768:7987,769:7989,834:7991}],7986:[[7984,768]],7987:[[7985,768]],7988:[[7984,769]],7989:[[7985,769]],7990:[[7984,834]],7991:[[7985,834]],7992:[[921,787],,{768:7994,769:7996,834:7998}],7993:[[921,788],,{768:7995,769:7997,834:7999}],7994:[[7992,768]],7995:[[7993,768]],7996:[[7992,769]],7997:[[7993,769]],7998:[[7992,834]],7999:[[7993,834]],8e3:[[959,787],,{768:8002,769:8004}],8001:[[959,788],,{768:8003,769:8005}],8002:[[8e3,768]],8003:[[8001,768]],8004:[[8e3,769]],8005:[[8001,769]],8008:[[927,787],,{768:8010,769:8012}],8009:[[927,788],,{768:8011,769:8013}],8010:[[8008,768]],8011:[[8009,768]],8012:[[8008,769]],8013:[[8009,769]],8016:[[965,787],,{768:8018,769:8020,834:8022}],8017:[[965,788],,{768:8019,769:8021,834:8023}],8018:[[8016,768]],8019:[[8017,768]],8020:[[8016,769]],8021:[[8017,769]],8022:[[8016,834]],8023:[[8017,834]],8025:[[933,788],,{768:8027,769:8029,834:8031}],8027:[[8025,768]],8029:[[8025,769]],8031:[[8025,834]],8032:[[969,787],,{768:8034,769:8036,834:8038,837:8096}],8033:[[969,788],,{768:8035,769:8037,834:8039,837:8097}],8034:[[8032,768],,{837:8098}],8035:[[8033,768],,{837:8099}],8036:[[8032,769],,{837:8100}],8037:[[8033,769],,{837:8101}],8038:[[8032,834],,{837:8102}],8039:[[8033,834],,{837:8103}],8040:[[937,787],,{768:8042,769:8044,834:8046,837:8104}],8041:[[937,788],,{768:8043,769:8045,834:8047,837:8105}],8042:[[8040,768],,{837:8106}],8043:[[8041,768],,{837:8107}],8044:[[8040,769],,{837:8108}],8045:[[8041,769],,{837:8109}],8046:[[8040,834],,{837:8110}],8047:[[8041,834],,{837:8111}],8048:[[945,768],,{837:8114}],8049:[[940]],8050:[[949,768]],8051:[[941]],8052:[[951,768],,{837:8130}],8053:[[942]],8054:[[953,768]],8055:[[943]],8056:[[959,768]],8057:[[972]],8058:[[965,768]],8059:[[973]],8060:[[969,768],,{837:8178}],8061:[[974]],8064:[[7936,837]],8065:[[7937,837]],8066:[[7938,837]],8067:[[7939,837]],8068:[[7940,837]],8069:[[7941,837]],8070:[[7942,837]],8071:[[7943,837]],8072:[[7944,837]],8073:[[7945,837]],8074:[[7946,837]],8075:[[7947,837]],8076:[[7948,837]],8077:[[7949,837]],8078:[[7950,837]],8079:[[7951,837]],8080:[[7968,837]],8081:[[7969,837]],8082:[[7970,837]],8083:[[7971,837]],8084:[[7972,837]],8085:[[7973,837]],8086:[[7974,837]],8087:[[7975,837]],8088:[[7976,837]],8089:[[7977,837]],8090:[[7978,837]],8091:[[7979,837]],8092:[[7980,837]],8093:[[7981,837]],8094:[[7982,837]],8095:[[7983,837]],8096:[[8032,837]],8097:[[8033,837]],8098:[[8034,837]],8099:[[8035,837]],8100:[[8036,837]],8101:[[8037,837]],8102:[[8038,837]],8103:[[8039,837]],8104:[[8040,837]],8105:[[8041,837]],8106:[[8042,837]],8107:[[8043,837]],8108:[[8044,837]],8109:[[8045,837]],8110:[[8046,837]],8111:[[8047,837]],8112:[[945,774]],8113:[[945,772]],8114:[[8048,837]],8115:[[945,837]],8116:[[940,837]],8118:[[945,834],,{837:8119}],8119:[[8118,837]],8120:[[913,774]],8121:[[913,772]],8122:[[913,768]],8123:[[902]],8124:[[913,837]],8125:[[32,787],256],8126:[[953]],8127:[[32,787],256,{768:8141,769:8142,834:8143}],8128:[[32,834],256],8129:[[168,834]],8130:[[8052,837]],8131:[[951,837]],8132:[[942,837]],8134:[[951,834],,{837:8135}],8135:[[8134,837]],8136:[[917,768]],8137:[[904]],8138:[[919,768]],8139:[[905]],8140:[[919,837]],8141:[[8127,768]],8142:[[8127,769]],8143:[[8127,834]],8144:[[953,774]],8145:[[953,772]],8146:[[970,768]],8147:[[912]],8150:[[953,834]],8151:[[970,834]],8152:[[921,774]],8153:[[921,772]],8154:[[921,768]],8155:[[906]],8157:[[8190,768]],8158:[[8190,769]],8159:[[8190,834]],8160:[[965,774]],8161:[[965,772]],8162:[[971,768]],8163:[[944]],8164:[[961,787]],8165:[[961,788]],8166:[[965,834]],8167:[[971,834]],8168:[[933,774]],8169:[[933,772]],8170:[[933,768]],8171:[[910]],8172:[[929,788]],8173:[[168,768]],8174:[[901]],8175:[[96]],8178:[[8060,837]],8179:[[969,837]],8180:[[974,837]],8182:[[969,834],,{837:8183}],8183:[[8182,837]],8184:[[927,768]],8185:[[908]],8186:[[937,768]],8187:[[911]],8188:[[937,837]],8189:[[180]],8190:[[32,788],256,{768:8157,769:8158,834:8159}]},8192:{8192:[[8194]],8193:[[8195]],8194:[[32],256],8195:[[32],256],8196:[[32],256],8197:[[32],256],8198:[[32],256],8199:[[32],256],8200:[[32],256],8201:[[32],256],8202:[[32],256],8209:[[8208],256],8215:[[32,819],256],8228:[[46],256],8229:[[46,46],256],8230:[[46,46,46],256],8239:[[32],256],8243:[[8242,8242],256],8244:[[8242,8242,8242],256],8246:[[8245,8245],256],8247:[[8245,8245,8245],256],8252:[[33,33],256],8254:[[32,773],256],8263:[[63,63],256],8264:[[63,33],256],8265:[[33,63],256],8279:[[8242,8242,8242,8242],256],8287:[[32],256],8304:[[48],256],8305:[[105],256],8308:[[52],256],8309:[[53],256],8310:[[54],256],8311:[[55],256],8312:[[56],256],8313:[[57],256],8314:[[43],256],8315:[[8722],256],8316:[[61],256],8317:[[40],256],8318:[[41],256],8319:[[110],256],8320:[[48],256],8321:[[49],256],8322:[[50],256],8323:[[51],256],8324:[[52],256],8325:[[53],256],8326:[[54],256],8327:[[55],256],8328:[[56],256],8329:[[57],256],8330:[[43],256],8331:[[8722],256],8332:[[61],256],8333:[[40],256],8334:[[41],256],8336:[[97],256],8337:[[101],256],8338:[[111],256],8339:[[120],256],8340:[[601],256],8341:[[104],256],8342:[[107],256],8343:[[108],256],8344:[[109],256],8345:[[110],256],8346:[[112],256],8347:[[115],256],8348:[[116],256],8360:[[82,115],256],8400:[,230],8401:[,230],8402:[,1],8403:[,1],8404:[,230],8405:[,230],8406:[,230],8407:[,230],8408:[,1],8409:[,1],8410:[,1],8411:[,230],8412:[,230],8417:[,230],8421:[,1],8422:[,1],8423:[,230],8424:[,220],8425:[,230],8426:[,1],8427:[,1],8428:[,220],8429:[,220],8430:[,220],8431:[,220],8432:[,230]},8448:{8448:[[97,47,99],256],8449:[[97,47,115],256],8450:[[67],256],8451:[[176,67],256],8453:[[99,47,111],256],8454:[[99,47,117],256],8455:[[400],256],8457:[[176,70],256],8458:[[103],256],8459:[[72],256],8460:[[72],256],8461:[[72],256],8462:[[104],256],8463:[[295],256],8464:[[73],256],8465:[[73],256],8466:[[76],256],8467:[[108],256],8469:[[78],256],8470:[[78,111],256],8473:[[80],256],8474:[[81],256],8475:[[82],256],8476:[[82],256],8477:[[82],256],8480:[[83,77],256],8481:[[84,69,76],256],8482:[[84,77],256],8484:[[90],256],8486:[[937]],8488:[[90],256],8490:[[75]],8491:[[197]],8492:[[66],256],8493:[[67],256],8495:[[101],256],8496:[[69],256],8497:[[70],256],8499:[[77],256],8500:[[111],256],8501:[[1488],256],8502:[[1489],256],8503:[[1490],256],8504:[[1491],256],8505:[[105],256],8507:[[70,65,88],256],8508:[[960],256],8509:[[947],256],8510:[[915],256],8511:[[928],256],8512:[[8721],256],8517:[[68],256],8518:[[100],256],8519:[[101],256],8520:[[105],256],8521:[[106],256],8528:[[49,8260,55],256],8529:[[49,8260,57],256],8530:[[49,8260,49,48],256],8531:[[49,8260,51],256],8532:[[50,8260,51],256],8533:[[49,8260,53],256],8534:[[50,8260,53],256],8535:[[51,8260,53],256],8536:[[52,8260,53],256],8537:[[49,8260,54],256],8538:[[53,8260,54],256],8539:[[49,8260,56],256],8540:[[51,8260,56],256],8541:[[53,8260,56],256],8542:[[55,8260,56],256],8543:[[49,8260],256],8544:[[73],256],8545:[[73,73],256],8546:[[73,73,73],256],8547:[[73,86],256],8548:[[86],256],8549:[[86,73],256],8550:[[86,73,73],256],8551:[[86,73,73,73],256],8552:[[73,88],256],8553:[[88],256],8554:[[88,73],256],8555:[[88,73,73],256],8556:[[76],256],8557:[[67],256],8558:[[68],256],8559:[[77],256],8560:[[105],256],8561:[[105,105],256],8562:[[105,105,105],256],8563:[[105,118],256],8564:[[118],256],8565:[[118,105],256],8566:[[118,105,105],256],8567:[[118,105,105,105],256],8568:[[105,120],256],8569:[[120],256],8570:[[120,105],256],8571:[[120,105,105],256],8572:[[108],256],8573:[[99],256],8574:[[100],256],8575:[[109],256],8585:[[48,8260,51],256],8592:[,,{824:8602}],8594:[,,{824:8603}],8596:[,,{824:8622}],8602:[[8592,824]],8603:[[8594,824]],8622:[[8596,824]],8653:[[8656,824]],8654:[[8660,824]],8655:[[8658,824]],8656:[,,{824:8653}],8658:[,,{824:8655}],8660:[,,{824:8654}]},8704:{8707:[,,{824:8708}],8708:[[8707,824]],8712:[,,{824:8713}],8713:[[8712,824]],8715:[,,{824:8716}],8716:[[8715,824]],8739:[,,{824:8740}],8740:[[8739,824]],8741:[,,{824:8742}],8742:[[8741,824]],8748:[[8747,8747],256],8749:[[8747,8747,8747],256],8751:[[8750,8750],256],8752:[[8750,8750,8750],256],8764:[,,{824:8769}],8769:[[8764,824]],8771:[,,{824:8772}],8772:[[8771,824]],8773:[,,{824:8775}],8775:[[8773,824]],8776:[,,{824:8777}],8777:[[8776,824]],8781:[,,{824:8813}],8800:[[61,824]],8801:[,,{824:8802}],8802:[[8801,824]],8804:[,,{824:8816}],8805:[,,{824:8817}],8813:[[8781,824]],8814:[[60,824]],8815:[[62,824]],8816:[[8804,824]],8817:[[8805,824]],8818:[,,{824:8820}],8819:[,,{824:8821}],8820:[[8818,824]],8821:[[8819,824]],8822:[,,{824:8824}],8823:[,,{824:8825}],8824:[[8822,824]],8825:[[8823,824]],8826:[,,{824:8832}],8827:[,,{824:8833}],8828:[,,{824:8928}],8829:[,,{824:8929}],8832:[[8826,824]],8833:[[8827,824]],8834:[,,{824:8836}],8835:[,,{824:8837}],8836:[[8834,824]],8837:[[8835,824]],8838:[,,{824:8840}],8839:[,,{824:8841}],8840:[[8838,824]],8841:[[8839,824]],8849:[,,{824:8930}],8850:[,,{824:8931}],8866:[,,{824:8876}],8872:[,,{824:8877}],8873:[,,{824:8878}],8875:[,,{824:8879}],8876:[[8866,824]],8877:[[8872,824]],8878:[[8873,824]],8879:[[8875,824]],8882:[,,{824:8938}],8883:[,,{824:8939}],8884:[,,{824:8940}],8885:[,,{824:8941}],8928:[[8828,824]],8929:[[8829,824]],8930:[[8849,824]],8931:[[8850,824]],8938:[[8882,824]],8939:[[8883,824]],8940:[[8884,824]],8941:[[8885,824]]},8960:{9001:[[12296]],9002:[[12297]]},9216:{9312:[[49],256],9313:[[50],256],9314:[[51],256],9315:[[52],256],9316:[[53],256],9317:[[54],256],9318:[[55],256],9319:[[56],256],9320:[[57],256],9321:[[49,48],256],9322:[[49,49],256],9323:[[49,50],256],9324:[[49,51],256],9325:[[49,52],256],9326:[[49,53],256],9327:[[49,54],256],9328:[[49,55],256],9329:[[49,56],256],9330:[[49,57],256],9331:[[50,48],256],9332:[[40,49,41],256],9333:[[40,50,41],256],9334:[[40,51,41],256],9335:[[40,52,41],256],9336:[[40,53,41],256],9337:[[40,54,41],256],9338:[[40,55,41],256],9339:[[40,56,41],256],9340:[[40,57,41],256],9341:[[40,49,48,41],256],9342:[[40,49,49,41],256],9343:[[40,49,50,41],256],9344:[[40,49,51,41],256],9345:[[40,49,52,41],256],9346:[[40,49,53,41],256],9347:[[40,49,54,41],256],9348:[[40,49,55,41],256],9349:[[40,49,56,41],256],9350:[[40,49,57,41],256],9351:[[40,50,48,41],256],9352:[[49,46],256],9353:[[50,46],256],9354:[[51,46],256],9355:[[52,46],256],9356:[[53,46],256],9357:[[54,46],256],9358:[[55,46],256],9359:[[56,46],256],9360:[[57,46],256],9361:[[49,48,46],256],9362:[[49,49,46],256],9363:[[49,50,46],256],9364:[[49,51,46],256],9365:[[49,52,46],256],9366:[[49,53,46],256],9367:[[49,54,46],256],9368:[[49,55,46],256],9369:[[49,56,46],256],9370:[[49,57,46],256],9371:[[50,48,46],256],9372:[[40,97,41],256],9373:[[40,98,41],256],9374:[[40,99,41],256],9375:[[40,100,41],256],9376:[[40,101,41],256],9377:[[40,102,41],256],9378:[[40,103,41],256],9379:[[40,104,41],256],9380:[[40,105,41],256],9381:[[40,106,41],256],9382:[[40,107,41],256],9383:[[40,108,41],256],9384:[[40,109,41],256],9385:[[40,110,41],256],9386:[[40,111,41],256],9387:[[40,112,41],256],9388:[[40,113,41],256],9389:[[40,114,41],256],9390:[[40,115,41],256],9391:[[40,116,41],256],9392:[[40,117,41],256],9393:[[40,118,41],256],9394:[[40,119,41],256],9395:[[40,120,41],256],9396:[[40,121,41],256],9397:[[40,122,41],256],9398:[[65],256],9399:[[66],256],9400:[[67],256],9401:[[68],256],9402:[[69],256],9403:[[70],256],9404:[[71],256],9405:[[72],256],9406:[[73],256],9407:[[74],256],9408:[[75],256],9409:[[76],256],9410:[[77],256],9411:[[78],256],9412:[[79],256],9413:[[80],256],9414:[[81],256],9415:[[82],256],9416:[[83],256],9417:[[84],256],9418:[[85],256],9419:[[86],256],9420:[[87],256],9421:[[88],256],9422:[[89],256],9423:[[90],256],9424:[[97],256],9425:[[98],256],9426:[[99],256],9427:[[100],256],9428:[[101],256],9429:[[102],256],9430:[[103],256],9431:[[104],256],9432:[[105],256],9433:[[106],256],9434:[[107],256],9435:[[108],256],9436:[[109],256],9437:[[110],256],9438:[[111],256],9439:[[112],256],9440:[[113],256],9441:[[114],256],9442:[[115],256],9443:[[116],256],9444:[[117],256],9445:[[118],256],9446:[[119],256],9447:[[120],256],9448:[[121],256],9449:[[122],256],9450:[[48],256]},10752:{10764:[[8747,8747,8747,8747],256],10868:[[58,58,61],256],10869:[[61,61],256],10870:[[61,61,61],256],10972:[[10973,824],512]},11264:{11388:[[106],256],11389:[[86],256],11503:[,230],11504:[,230],11505:[,230]},11520:{11631:[[11617],256],11647:[,9],11744:[,230],11745:[,230],11746:[,230],11747:[,230],11748:[,230],11749:[,230],11750:[,230],11751:[,230],11752:[,230],11753:[,230],11754:[,230],11755:[,230],11756:[,230],11757:[,230],11758:[,230],11759:[,230],11760:[,230],11761:[,230],11762:[,230],11763:[,230],11764:[,230],11765:[,230],11766:[,230],11767:[,230],11768:[,230],11769:[,230],11770:[,230],11771:[,230],11772:[,230],11773:[,230],11774:[,230],11775:[,230]},11776:{11935:[[27597],256],12019:[[40863],256]},12032:{12032:[[19968],256],12033:[[20008],256],12034:[[20022],256],12035:[[20031],256],12036:[[20057],256],12037:[[20101],256],12038:[[20108],256],12039:[[20128],256],12040:[[20154],256],12041:[[20799],256],12042:[[20837],256],12043:[[20843],256],12044:[[20866],256],12045:[[20886],256],12046:[[20907],256],12047:[[20960],256],12048:[[20981],256],12049:[[20992],256],12050:[[21147],256],12051:[[21241],256],12052:[[21269],256],12053:[[21274],256],12054:[[21304],256],12055:[[21313],256],12056:[[21340],256],12057:[[21353],256],12058:[[21378],256],12059:[[21430],256],12060:[[21448],256],12061:[[21475],256],12062:[[22231],256],12063:[[22303],256],12064:[[22763],256],12065:[[22786],256],12066:[[22794],256],12067:[[22805],256],12068:[[22823],256],12069:[[22899],256],12070:[[23376],256],12071:[[23424],256],12072:[[23544],256],12073:[[23567],256],12074:[[23586],256],12075:[[23608],256],12076:[[23662],256],12077:[[23665],256],12078:[[24027],256],12079:[[24037],256],12080:[[24049],256],12081:[[24062],256],12082:[[24178],256],12083:[[24186],256],12084:[[24191],256],12085:[[24308],256],12086:[[24318],256],12087:[[24331],256],12088:[[24339],256],12089:[[24400],256],12090:[[24417],256],12091:[[24435],256],12092:[[24515],256],12093:[[25096],256],12094:[[25142],256],12095:[[25163],256],12096:[[25903],256],12097:[[25908],256],12098:[[25991],256],12099:[[26007],256],12100:[[26020],256],12101:[[26041],256],12102:[[26080],256],12103:[[26085],256],12104:[[26352],256],12105:[[26376],256],12106:[[26408],256],12107:[[27424],256],12108:[[27490],256],12109:[[27513],256],12110:[[27571],256],12111:[[27595],256],12112:[[27604],256],12113:[[27611],256],12114:[[27663],256],12115:[[27668],256],12116:[[27700],256],12117:[[28779],256],12118:[[29226],256],12119:[[29238],256],12120:[[29243],256],12121:[[29247],256],12122:[[29255],256],12123:[[29273],256],12124:[[29275],256],12125:[[29356],256],12126:[[29572],256],12127:[[29577],256],12128:[[29916],256],12129:[[29926],256],12130:[[29976],256],12131:[[29983],256],12132:[[29992],256],12133:[[3e4],256],12134:[[30091],256],12135:[[30098],256],12136:[[30326],256],12137:[[30333],256],12138:[[30382],256],12139:[[30399],256],12140:[[30446],256],12141:[[30683],256],12142:[[30690],256],12143:[[30707],256],12144:[[31034],256],12145:[[31160],256],12146:[[31166],256],12147:[[31348],256],12148:[[31435],256],12149:[[31481],256],12150:[[31859],256],12151:[[31992],256],12152:[[32566],256],12153:[[32593],256],12154:[[32650],256],12155:[[32701],256],12156:[[32769],256],12157:[[32780],256],12158:[[32786],256],12159:[[32819],256],12160:[[32895],256],12161:[[32905],256],12162:[[33251],256],12163:[[33258],256],12164:[[33267],256],12165:[[33276],256],12166:[[33292],256],12167:[[33307],256],12168:[[33311],256],12169:[[33390],256],12170:[[33394],256],12171:[[33400],256],12172:[[34381],256],12173:[[34411],256],12174:[[34880],256],12175:[[34892],256],12176:[[34915],256],12177:[[35198],256],12178:[[35211],256],12179:[[35282],256],12180:[[35328],256],12181:[[35895],256],12182:[[35910],256],12183:[[35925],256],12184:[[35960],256],12185:[[35997],256],12186:[[36196],256],12187:[[36208],256],12188:[[36275],256],12189:[[36523],256],12190:[[36554],256],12191:[[36763],256],12192:[[36784],256],12193:[[36789],256],12194:[[37009],256],12195:[[37193],256],12196:[[37318],256],12197:[[37324],256],12198:[[37329],256],12199:[[38263],256],12200:[[38272],256],12201:[[38428],256],12202:[[38582],256],12203:[[38585],256],12204:[[38632],256],12205:[[38737],256],12206:[[38750],256],12207:[[38754],256],12208:[[38761],256],12209:[[38859],256],12210:[[38893],256],12211:[[38899],256],12212:[[38913],256],12213:[[39080],256],12214:[[39131],256],12215:[[39135],256],12216:[[39318],256],12217:[[39321],256],12218:[[39340],256],12219:[[39592],256],12220:[[39640],256],12221:[[39647],256],12222:[[39717],256],12223:[[39727],256],12224:[[39730],256],12225:[[39740],256],12226:[[39770],256],12227:[[40165],256],12228:[[40565],256],12229:[[40575],256],12230:[[40613],256],12231:[[40635],256],12232:[[40643],256],12233:[[40653],256],12234:[[40657],256],12235:[[40697],256],12236:[[40701],256],12237:[[40718],256],12238:[[40723],256],12239:[[40736],256],12240:[[40763],256],12241:[[40778],256],12242:[[40786],256],12243:[[40845],256],12244:[[40860],256],12245:[[40864],256]},12288:{12288:[[32],256],12330:[,218],12331:[,228],12332:[,232],12333:[,222],12334:[,224],12335:[,224],12342:[[12306],256],12344:[[21313],256],12345:[[21316],256],12346:[[21317],256],12358:[,,{12441:12436}],12363:[,,{12441:12364}],12364:[[12363,12441]],12365:[,,{12441:12366}],12366:[[12365,12441]],12367:[,,{12441:12368}],12368:[[12367,12441]],12369:[,,{12441:12370}],12370:[[12369,12441]],12371:[,,{12441:12372}],12372:[[12371,12441]],12373:[,,{12441:12374}],12374:[[12373,12441]],12375:[,,{12441:12376}],12376:[[12375,12441]],12377:[,,{12441:12378}],12378:[[12377,12441]],12379:[,,{12441:12380}],12380:[[12379,12441]],12381:[,,{12441:12382}],12382:[[12381,12441]],12383:[,,{12441:12384}],12384:[[12383,12441]],12385:[,,{12441:12386}],12386:[[12385,12441]],12388:[,,{12441:12389}],12389:[[12388,12441]],12390:[,,{12441:12391}],12391:[[12390,12441]],12392:[,,{12441:12393}],12393:[[12392,12441]],12399:[,,{12441:12400,12442:12401}],12400:[[12399,12441]],12401:[[12399,12442]],12402:[,,{12441:12403,12442:12404}],12403:[[12402,12441]],12404:[[12402,12442]],12405:[,,{12441:12406,12442:12407}],12406:[[12405,12441]],12407:[[12405,12442]],12408:[,,{12441:12409,12442:12410}],12409:[[12408,12441]],12410:[[12408,12442]],12411:[,,{12441:12412,12442:12413}],12412:[[12411,12441]],12413:[[12411,12442]],12436:[[12358,12441]],12441:[,8],12442:[,8],12443:[[32,12441],256],12444:[[32,12442],256],12445:[,,{12441:12446}],12446:[[12445,12441]],12447:[[12424,12426],256],12454:[,,{12441:12532}],12459:[,,{12441:12460}],12460:[[12459,12441]],12461:[,,{12441:12462}],12462:[[12461,12441]],12463:[,,{12441:12464}],12464:[[12463,12441]],12465:[,,{12441:12466}],12466:[[12465,12441]],12467:[,,{12441:12468}],12468:[[12467,12441]],12469:[,,{12441:12470}],12470:[[12469,12441]],12471:[,,{12441:12472}],12472:[[12471,12441]],12473:[,,{12441:12474}],12474:[[12473,12441]],12475:[,,{12441:12476}],12476:[[12475,12441]],12477:[,,{12441:12478}],12478:[[12477,12441]],12479:[,,{12441:12480}],12480:[[12479,12441]],12481:[,,{12441:12482}],12482:[[12481,12441]],12484:[,,{12441:12485}],12485:[[12484,12441]],12486:[,,{12441:12487}],12487:[[12486,12441]],12488:[,,{12441:12489}],12489:[[12488,12441]],12495:[,,{12441:12496,12442:12497}],12496:[[12495,12441]],12497:[[12495,12442]],12498:[,,{12441:12499,12442:12500}],12499:[[12498,12441]],12500:[[12498,12442]],12501:[,,{12441:12502,12442:12503}],12502:[[12501,12441]],12503:[[12501,12442]],12504:[,,{12441:12505,12442:12506}],12505:[[12504,12441]],12506:[[12504,12442]],12507:[,,{12441:12508,12442:12509}],12508:[[12507,12441]],12509:[[12507,12442]],12527:[,,{12441:12535}],12528:[,,{12441:12536}],12529:[,,{12441:12537}],12530:[,,{12441:12538}],12532:[[12454,12441]],12535:[[12527,12441]],12536:[[12528,12441]],12537:[[12529,12441]],12538:[[12530,12441]],12541:[,,{12441:12542}],12542:[[12541,12441]],12543:[[12467,12488],256]},12544:{12593:[[4352],256],12594:[[4353],256],12595:[[4522],256],12596:[[4354],256],12597:[[4524],256],12598:[[4525],256],12599:[[4355],256],12600:[[4356],256],12601:[[4357],256],12602:[[4528],256],12603:[[4529],256],12604:[[4530],256],12605:[[4531],256],12606:[[4532],256],12607:[[4533],256],12608:[[4378],256],12609:[[4358],256],12610:[[4359],256],12611:[[4360],256],12612:[[4385],256],12613:[[4361],256],12614:[[4362],256],12615:[[4363],256],12616:[[4364],256],12617:[[4365],256],12618:[[4366],256],12619:[[4367],256],12620:[[4368],256],12621:[[4369],256],12622:[[4370],256],12623:[[4449],256],12624:[[4450],256],12625:[[4451],256],12626:[[4452],256],12627:[[4453],256],12628:[[4454],256],12629:[[4455],256],12630:[[4456],256],12631:[[4457],256],12632:[[4458],256],12633:[[4459],256],12634:[[4460],256],12635:[[4461],256],12636:[[4462],256],12637:[[4463],256],12638:[[4464],256],12639:[[4465],256],12640:[[4466],256],12641:[[4467],256],12642:[[4468],256],12643:[[4469],256],12644:[[4448],256],12645:[[4372],256],12646:[[4373],256],12647:[[4551],256],12648:[[4552],256],12649:[[4556],256],12650:[[4558],256],12651:[[4563],256],12652:[[4567],256],12653:[[4569],256],12654:[[4380],256],12655:[[4573],256],12656:[[4575],256],12657:[[4381],256],12658:[[4382],256],12659:[[4384],256],12660:[[4386],256],12661:[[4387],256],12662:[[4391],256],12663:[[4393],256],12664:[[4395],256],12665:[[4396],256],12666:[[4397],256],12667:[[4398],256],12668:[[4399],256],12669:[[4402],256],12670:[[4406],256],12671:[[4416],256],12672:[[4423],256],12673:[[4428],256],12674:[[4593],256],12675:[[4594],256],12676:[[4439],256],12677:[[4440],256],12678:[[4441],256],12679:[[4484],256],12680:[[4485],256],12681:[[4488],256],12682:[[4497],256],12683:[[4498],256],12684:[[4500],256],12685:[[4510],256],12686:[[4513],256],12690:[[19968],256],12691:[[20108],256],12692:[[19977],256],12693:[[22235],256],12694:[[19978],256],12695:[[20013],256],12696:[[19979],256],12697:[[30002],256],12698:[[20057],256],12699:[[19993],256],12700:[[19969],256],12701:[[22825],256],12702:[[22320],256],12703:[[20154],256]},12800:{12800:[[40,4352,41],256],12801:[[40,4354,41],256],12802:[[40,4355,41],256],12803:[[40,4357,41],256],12804:[[40,4358,41],256],12805:[[40,4359,41],256],12806:[[40,4361,41],256],12807:[[40,4363,41],256],12808:[[40,4364,41],256],12809:[[40,4366,41],256],12810:[[40,4367,41],256],12811:[[40,4368,41],256],12812:[[40,4369,41],256],12813:[[40,4370,41],256],12814:[[40,4352,4449,41],256],12815:[[40,4354,4449,41],256],12816:[[40,4355,4449,41],256],12817:[[40,4357,4449,41],256],12818:[[40,4358,4449,41],256],12819:[[40,4359,4449,41],256],12820:[[40,4361,4449,41],256],12821:[[40,4363,4449,41],256],12822:[[40,4364,4449,41],256],12823:[[40,4366,4449,41],256],12824:[[40,4367,4449,41],256],12825:[[40,4368,4449,41],256],12826:[[40,4369,4449,41],256],12827:[[40,4370,4449,41],256],12828:[[40,4364,4462,41],256],12829:[[40,4363,4457,4364,4453,4523,41],256],12830:[[40,4363,4457,4370,4462,41],256],12832:[[40,19968,41],256],12833:[[40,20108,41],256],12834:[[40,19977,41],256],12835:[[40,22235,41],256],12836:[[40,20116,41],256],12837:[[40,20845,41],256],12838:[[40,19971,41],256],12839:[[40,20843,41],256],12840:[[40,20061,41],256],12841:[[40,21313,41],256],12842:[[40,26376,41],256],12843:[[40,28779,41],256],12844:[[40,27700,41],256],12845:[[40,26408,41],256],12846:[[40,37329,41],256],12847:[[40,22303,41],256],12848:[[40,26085,41],256],12849:[[40,26666,41],256],12850:[[40,26377,41],256],12851:[[40,31038,41],256],12852:[[40,21517,41],256],12853:[[40,29305,41],256],12854:[[40,36001,41],256],12855:[[40,31069,41],256],12856:[[40,21172,41],256],12857:[[40,20195,41],256],12858:[[40,21628,41],256],12859:[[40,23398,41],256],12860:[[40,30435,41],256],12861:[[40,20225,41],256],12862:[[40,36039,41],256],12863:[[40,21332,41],256],12864:[[40,31085,41],256],12865:[[40,20241,41],256],12866:[[40,33258,41],256],12867:[[40,33267,41],256],12868:[[21839],256],12869:[[24188],256],12870:[[25991],256],12871:[[31631],256],12880:[[80,84,69],256],12881:[[50,49],256],12882:[[50,50],256],12883:[[50,51],256],12884:[[50,52],256],12885:[[50,53],256],12886:[[50,54],256],12887:[[50,55],256],12888:[[50,56],256],12889:[[50,57],256],12890:[[51,48],256],12891:[[51,49],256],12892:[[51,50],256],12893:[[51,51],256],12894:[[51,52],256],12895:[[51,53],256],12896:[[4352],256],12897:[[4354],256],12898:[[4355],256],12899:[[4357],256],12900:[[4358],256],12901:[[4359],256],12902:[[4361],256],12903:[[4363],256],12904:[[4364],256],12905:[[4366],256],12906:[[4367],256],12907:[[4368],256],12908:[[4369],256],12909:[[4370],256],12910:[[4352,4449],256],12911:[[4354,4449],256],12912:[[4355,4449],256],12913:[[4357,4449],256],12914:[[4358,4449],256],12915:[[4359,4449],256],12916:[[4361,4449],256],12917:[[4363,4449],256],12918:[[4364,4449],256],12919:[[4366,4449],256],12920:[[4367,4449],256],12921:[[4368,4449],256],12922:[[4369,4449],256],12923:[[4370,4449],256],12924:[[4366,4449,4535,4352,4457],256],12925:[[4364,4462,4363,4468],256],12926:[[4363,4462],256],12928:[[19968],256],12929:[[20108],256],12930:[[19977],256],12931:[[22235],256],12932:[[20116],256],12933:[[20845],256],12934:[[19971],256],12935:[[20843],256],12936:[[20061],256],12937:[[21313],256],12938:[[26376],256],12939:[[28779],256],12940:[[27700],256],12941:[[26408],256],12942:[[37329],256],12943:[[22303],256],12944:[[26085],256],12945:[[26666],256],12946:[[26377],256],12947:[[31038],256],12948:[[21517],256],12949:[[29305],256],12950:[[36001],256],12951:[[31069],256],12952:[[21172],256],12953:[[31192],256],12954:[[30007],256],12955:[[22899],256],12956:[[36969],256],12957:[[20778],256],12958:[[21360],256],12959:[[27880],256],12960:[[38917],256],12961:[[20241],256],12962:[[20889],256],12963:[[27491],256],12964:[[19978],256],12965:[[20013],256],12966:[[19979],256],12967:[[24038],256],12968:[[21491],256],12969:[[21307],256],12970:[[23447],256],12971:[[23398],256],12972:[[30435],256],12973:[[20225],256],12974:[[36039],256],12975:[[21332],256],12976:[[22812],256],12977:[[51,54],256],12978:[[51,55],256],12979:[[51,56],256],12980:[[51,57],256],12981:[[52,48],256],12982:[[52,49],256],12983:[[52,50],256],12984:[[52,51],256],12985:[[52,52],256],12986:[[52,53],256],12987:[[52,54],256],12988:[[52,55],256],12989:[[52,56],256],12990:[[52,57],256],12991:[[53,48],256],12992:[[49,26376],256],12993:[[50,26376],256],12994:[[51,26376],256],12995:[[52,26376],256],12996:[[53,26376],256],12997:[[54,26376],256],12998:[[55,26376],256],12999:[[56,26376],256],13e3:[[57,26376],256],13001:[[49,48,26376],256],13002:[[49,49,26376],256],13003:[[49,50,26376],256],13004:[[72,103],256],13005:[[101,114,103],256],13006:[[101,86],256],13007:[[76,84,68],256],13008:[[12450],256],13009:[[12452],256],13010:[[12454],256],13011:[[12456],256],13012:[[12458],256],13013:[[12459],256],13014:[[12461],256],13015:[[12463],256],13016:[[12465],256],13017:[[12467],256],13018:[[12469],256],13019:[[12471],256],13020:[[12473],256],13021:[[12475],256],13022:[[12477],256],13023:[[12479],256],13024:[[12481],256],13025:[[12484],256],13026:[[12486],256],13027:[[12488],256],13028:[[12490],256],13029:[[12491],256],13030:[[12492],256],13031:[[12493],256],13032:[[12494],256],13033:[[12495],256],13034:[[12498],256],13035:[[12501],256],13036:[[12504],256],13037:[[12507],256],13038:[[12510],256],13039:[[12511],256],13040:[[12512],256],13041:[[12513],256],13042:[[12514],256],13043:[[12516],256],13044:[[12518],256],13045:[[12520],256],13046:[[12521],256],13047:[[12522],256],13048:[[12523],256],13049:[[12524],256],13050:[[12525],256],13051:[[12527],256],13052:[[12528],256],13053:[[12529],256],13054:[[12530],256]},13056:{13056:[[12450,12497,12540,12488],256],13057:[[12450,12523,12501,12449],256],13058:[[12450,12531,12506,12450],256],13059:[[12450,12540,12523],256],13060:[[12452,12491,12531,12464],256],13061:[[12452,12531,12481],256],13062:[[12454,12457,12531],256],13063:[[12456,12473,12463,12540,12489],256],13064:[[12456,12540,12459,12540],256],13065:[[12458,12531,12473],256],13066:[[12458,12540,12512],256],13067:[[12459,12452,12522],256],13068:[[12459,12521,12483,12488],256],13069:[[12459,12525,12522,12540],256],13070:[[12460,12525,12531],256],13071:[[12460,12531,12510],256],13072:[[12462,12460],256],13073:[[12462,12491,12540],256],13074:[[12461,12517,12522,12540],256],13075:[[12462,12523,12480,12540],256],13076:[[12461,12525],256],13077:[[12461,12525,12464,12521,12512],256],13078:[[12461,12525,12513,12540,12488,12523],256],13079:[[12461,12525,12527,12483,12488],256],13080:[[12464,12521,12512],256],13081:[[12464,12521,12512,12488,12531],256],13082:[[12463,12523,12476,12452,12525],256],13083:[[12463,12525,12540,12493],256],13084:[[12465,12540,12473],256],13085:[[12467,12523,12490],256],13086:[[12467,12540,12509],256],13087:[[12469,12452,12463,12523],256],13088:[[12469,12531,12481,12540,12512],256],13089:[[12471,12522,12531,12464],256],13090:[[12475,12531,12481],256],13091:[[12475,12531,12488],256],13092:[[12480,12540,12473],256],13093:[[12487,12471],256],13094:[[12489,12523],256],13095:[[12488,12531],256],13096:[[12490,12494],256],13097:[[12494,12483,12488],256],13098:[[12495,12452,12484],256],13099:[[12497,12540,12475,12531,12488],256],13100:[[12497,12540,12484],256],13101:[[12496,12540,12524,12523],256],13102:[[12500,12450,12473,12488,12523],256],13103:[[12500,12463,12523],256],13104:[[12500,12467],256],13105:[[12499,12523],256],13106:[[12501,12449,12521,12483,12489],256],13107:[[12501,12451,12540,12488],256],13108:[[12502,12483,12471,12455,12523],256],13109:[[12501,12521,12531],256],13110:[[12504,12463,12479,12540,12523],256],13111:[[12506,12477],256],13112:[[12506,12491,12498],256],13113:[[12504,12523,12484],256],13114:[[12506,12531,12473],256],13115:[[12506,12540,12472],256],13116:[[12505,12540,12479],256],13117:[[12509,12452,12531,12488],256],13118:[[12508,12523,12488],256],13119:[[12507,12531],256],13120:[[12509,12531,12489],256],13121:[[12507,12540,12523],256],13122:[[12507,12540,12531],256],13123:[[12510,12452,12463,12525],256],13124:[[12510,12452,12523],256],13125:[[12510,12483,12495],256],13126:[[12510,12523,12463],256],13127:[[12510,12531,12471,12519,12531],256],13128:[[12511,12463,12525,12531],256],13129:[[12511,12522],256],13130:[[12511,12522,12496,12540,12523],256],13131:[[12513,12460],256],13132:[[12513,12460,12488,12531],256],13133:[[12513,12540,12488,12523],256],13134:[[12516,12540,12489],256],13135:[[12516,12540,12523],256],13136:[[12518,12450,12531],256],13137:[[12522,12483,12488,12523],256],13138:[[12522,12521],256],13139:[[12523,12500,12540],256],13140:[[12523,12540,12502,12523],256],13141:[[12524,12512],256],13142:[[12524,12531,12488,12466,12531],256],13143:[[12527,12483,12488],256],13144:[[48,28857],256],13145:[[49,28857],256],13146:[[50,28857],256],13147:[[51,28857],256],13148:[[52,28857],256],13149:[[53,28857],256],13150:[[54,28857],256],13151:[[55,28857],256],13152:[[56,28857],256],13153:[[57,28857],256],13154:[[49,48,28857],256],13155:[[49,49,28857],256],13156:[[49,50,28857],256],13157:[[49,51,28857],256],13158:[[49,52,28857],256],13159:[[49,53,28857],256],13160:[[49,54,28857],256],13161:[[49,55,28857],256],13162:[[49,56,28857],256],13163:[[49,57,28857],256],13164:[[50,48,28857],256],13165:[[50,49,28857],256],13166:[[50,50,28857],256],13167:[[50,51,28857],256],13168:[[50,52,28857],256],13169:[[104,80,97],256],13170:[[100,97],256],13171:[[65,85],256],13172:[[98,97,114],256],13173:[[111,86],256],13174:[[112,99],256],13175:[[100,109],256],13176:[[100,109,178],256],13177:[[100,109,179],256],13178:[[73,85],256],13179:[[24179,25104],256],13180:[[26157,21644],256],13181:[[22823,27491],256],13182:[[26126,27835],256],13183:[[26666,24335,20250,31038],256],13184:[[112,65],256],13185:[[110,65],256],13186:[[956,65],256],13187:[[109,65],256],13188:[[107,65],256],13189:[[75,66],256],13190:[[77,66],256],13191:[[71,66],256],13192:[[99,97,108],256],13193:[[107,99,97,108],256],13194:[[112,70],256],13195:[[110,70],256],13196:[[956,70],256],13197:[[956,103],256],13198:[[109,103],256],13199:[[107,103],256],13200:[[72,122],256],13201:[[107,72,122],256],13202:[[77,72,122],256],13203:[[71,72,122],256],13204:[[84,72,122],256],13205:[[956,8467],256],13206:[[109,8467],256],13207:[[100,8467],256],13208:[[107,8467],256],13209:[[102,109],256],13210:[[110,109],256],13211:[[956,109],256],13212:[[109,109],256],13213:[[99,109],256],13214:[[107,109],256],13215:[[109,109,178],256],13216:[[99,109,178],256],13217:[[109,178],256],13218:[[107,109,178],256],13219:[[109,109,179],256],13220:[[99,109,179],256],13221:[[109,179],256],13222:[[107,109,179],256],13223:[[109,8725,115],256],13224:[[109,8725,115,178],256],13225:[[80,97],256],13226:[[107,80,97],256],13227:[[77,80,97],256],13228:[[71,80,97],256],13229:[[114,97,100],256],13230:[[114,97,100,8725,115],256],13231:[[114,97,100,8725,115,178],256],13232:[[112,115],256],13233:[[110,115],256],13234:[[956,115],256],13235:[[109,115],256],13236:[[112,86],256],13237:[[110,86],256],13238:[[956,86],256],13239:[[109,86],256],13240:[[107,86],256],13241:[[77,86],256],13242:[[112,87],256],13243:[[110,87],256],13244:[[956,87],256],13245:[[109,87],256],13246:[[107,87],256],13247:[[77,87],256],13248:[[107,937],256],13249:[[77,937],256],13250:[[97,46,109,46],256],13251:[[66,113],256],13252:[[99,99],256],13253:[[99,100],256],13254:[[67,8725,107,103],256],13255:[[67,111,46],256],13256:[[100,66],256],13257:[[71,121],256],13258:[[104,97],256],13259:[[72,80],256],13260:[[105,110],256],13261:[[75,75],256],13262:[[75,77],256],13263:[[107,116],256],13264:[[108,109],256],13265:[[108,110],256],13266:[[108,111,103],256],13267:[[108,120],256],13268:[[109,98],256],13269:[[109,105,108],256],13270:[[109,111,108],256],13271:[[80,72],256],13272:[[112,46,109,46],256],13273:[[80,80,77],256],13274:[[80,82],256],13275:[[115,114],256],13276:[[83,118],256],13277:[[87,98],256],13278:[[86,8725,109],256],13279:[[65,8725,109],256],13280:[[49,26085],256],13281:[[50,26085],256],13282:[[51,26085],256],13283:[[52,26085],256],13284:[[53,26085],256],13285:[[54,26085],256],13286:[[55,26085],256],13287:[[56,26085],256],13288:[[57,26085],256],13289:[[49,48,26085],256],13290:[[49,49,26085],256],13291:[[49,50,26085],256],13292:[[49,51,26085],256],13293:[[49,52,26085],256],13294:[[49,53,26085],256],13295:[[49,54,26085],256],13296:[[49,55,26085],256],13297:[[49,56,26085],256],13298:[[49,57,26085],256],13299:[[50,48,26085],256],13300:[[50,49,26085],256],13301:[[50,50,26085],256],13302:[[50,51,26085],256],13303:[[50,52,26085],256],13304:[[50,53,26085],256],13305:[[50,54,26085],256],13306:[[50,55,26085],256],13307:[[50,56,26085],256],13308:[[50,57,26085],256],13309:[[51,48,26085],256],13310:[[51,49,26085],256],13311:[[103,97,108],256]},27136:{92912:[,1],92913:[,1],92914:[,1],92915:[,1],92916:[,1]},27392:{92976:[,230],92977:[,230],92978:[,230],92979:[,230],92980:[,230],92981:[,230],92982:[,230]},42496:{42607:[,230],42612:[,230],42613:[,230],42614:[,230],42615:[,230],42616:[,230],42617:[,230],42618:[,230],42619:[,230],42620:[,230],42621:[,230],42652:[[1098],256],42653:[[1100],256],42655:[,230],42736:[,230],42737:[,230]},42752:{42864:[[42863],256],43e3:[[294],256],43001:[[339],256]},43008:{43014:[,9],43204:[,9],43232:[,230],43233:[,230],43234:[,230],43235:[,230],43236:[,230],43237:[,230],43238:[,230],43239:[,230],43240:[,230],43241:[,230],43242:[,230],43243:[,230],43244:[,230],43245:[,230],43246:[,230],43247:[,230],43248:[,230],43249:[,230]},43264:{43307:[,220],43308:[,220],43309:[,220],43347:[,9],43443:[,7],43456:[,9]},43520:{43696:[,230],43698:[,230],43699:[,230],43700:[,220],43703:[,230],43704:[,230],43710:[,230],43711:[,230],43713:[,230],43766:[,9]},43776:{43868:[[42791],256],43869:[[43831],256],43870:[[619],256],43871:[[43858],256],44013:[,9]},48128:{113822:[,1]},53504:{119134:[[119127,119141],512],119135:[[119128,119141],512],119136:[[119135,119150],512],119137:[[119135,119151],512],119138:[[119135,119152],512],119139:[[119135,119153],512],119140:[[119135,119154],512],119141:[,216],119142:[,216],119143:[,1],119144:[,1],119145:[,1],119149:[,226],119150:[,216],119151:[,216],119152:[,216],119153:[,216],119154:[,216],119163:[,220],119164:[,220],119165:[,220],119166:[,220],119167:[,220],119168:[,220],119169:[,220],119170:[,220],119173:[,230],119174:[,230],119175:[,230],119176:[,230],119177:[,230],119178:[,220],119179:[,220],119210:[,230],119211:[,230],119212:[,230],119213:[,230],119227:[[119225,119141],512],119228:[[119226,119141],512],119229:[[119227,119150],512],119230:[[119228,119150],512],119231:[[119227,119151],512],119232:[[119228,119151],512]},53760:{119362:[,230],119363:[,230],119364:[,230]},54272:{119808:[[65],256],119809:[[66],256],119810:[[67],256],119811:[[68],256],119812:[[69],256],119813:[[70],256],119814:[[71],256],119815:[[72],256],119816:[[73],256],119817:[[74],256],119818:[[75],256],119819:[[76],256],119820:[[77],256],119821:[[78],256],119822:[[79],256],119823:[[80],256],119824:[[81],256],119825:[[82],256],119826:[[83],256],119827:[[84],256],119828:[[85],256],119829:[[86],256],119830:[[87],256],119831:[[88],256],119832:[[89],256],119833:[[90],256],119834:[[97],256],119835:[[98],256],119836:[[99],256],119837:[[100],256],119838:[[101],256],119839:[[102],256],119840:[[103],256],119841:[[104],256],119842:[[105],256],119843:[[106],256],119844:[[107],256],119845:[[108],256],119846:[[109],256],119847:[[110],256],119848:[[111],256],119849:[[112],256],119850:[[113],256],119851:[[114],256],119852:[[115],256],119853:[[116],256],119854:[[117],256],119855:[[118],256],119856:[[119],256],119857:[[120],256],119858:[[121],256],119859:[[122],256],119860:[[65],256],119861:[[66],256],119862:[[67],256],119863:[[68],256],119864:[[69],256],119865:[[70],256],119866:[[71],256],119867:[[72],256],119868:[[73],256],119869:[[74],256],119870:[[75],256],119871:[[76],256],119872:[[77],256],119873:[[78],256],119874:[[79],256],119875:[[80],256],119876:[[81],256],119877:[[82],256],119878:[[83],256],119879:[[84],256],119880:[[85],256],119881:[[86],256],119882:[[87],256],119883:[[88],256],119884:[[89],256],119885:[[90],256],119886:[[97],256],119887:[[98],256],119888:[[99],256],119889:[[100],256],119890:[[101],256],119891:[[102],256],119892:[[103],256],119894:[[105],256],119895:[[106],256],119896:[[107],256],119897:[[108],256],119898:[[109],256],119899:[[110],256],119900:[[111],256],119901:[[112],256],119902:[[113],256],119903:[[114],256],119904:[[115],256],119905:[[116],256],119906:[[117],256],119907:[[118],256],119908:[[119],256],119909:[[120],256],119910:[[121],256],119911:[[122],256],119912:[[65],256],119913:[[66],256],119914:[[67],256],119915:[[68],256],119916:[[69],256],119917:[[70],256],119918:[[71],256],119919:[[72],256],119920:[[73],256],119921:[[74],256],119922:[[75],256],119923:[[76],256],119924:[[77],256],119925:[[78],256],119926:[[79],256],119927:[[80],256],119928:[[81],256],119929:[[82],256],119930:[[83],256],119931:[[84],256],119932:[[85],256],119933:[[86],256],119934:[[87],256],119935:[[88],256],119936:[[89],256],119937:[[90],256],119938:[[97],256],119939:[[98],256],119940:[[99],256],119941:[[100],256],119942:[[101],256],119943:[[102],256],119944:[[103],256],119945:[[104],256],119946:[[105],256],119947:[[106],256],119948:[[107],256],119949:[[108],256],119950:[[109],256],119951:[[110],256],119952:[[111],256],119953:[[112],256],119954:[[113],256],119955:[[114],256],119956:[[115],256],119957:[[116],256],119958:[[117],256],119959:[[118],256],119960:[[119],256],119961:[[120],256],119962:[[121],256],119963:[[122],256],119964:[[65],256],119966:[[67],256],119967:[[68],256],119970:[[71],256],119973:[[74],256],119974:[[75],256],119977:[[78],256],119978:[[79],256],119979:[[80],256],119980:[[81],256],119982:[[83],256],119983:[[84],256],119984:[[85],256],119985:[[86],256],119986:[[87],256],119987:[[88],256],119988:[[89],256],119989:[[90],256],119990:[[97],256],119991:[[98],256],119992:[[99],256],119993:[[100],256],119995:[[102],256],119997:[[104],256],119998:[[105],256],119999:[[106],256],12e4:[[107],256],120001:[[108],256],120002:[[109],256],120003:[[110],256],120005:[[112],256],120006:[[113],256],120007:[[114],256],120008:[[115],256],120009:[[116],256],120010:[[117],256],120011:[[118],256],120012:[[119],256],120013:[[120],256],120014:[[121],256],120015:[[122],256],120016:[[65],256],120017:[[66],256],120018:[[67],256],120019:[[68],256],120020:[[69],256],120021:[[70],256],120022:[[71],256],120023:[[72],256],120024:[[73],256],120025:[[74],256],120026:[[75],256],120027:[[76],256],120028:[[77],256],120029:[[78],256],120030:[[79],256],120031:[[80],256],120032:[[81],256],120033:[[82],256],120034:[[83],256],120035:[[84],256],120036:[[85],256],120037:[[86],256],120038:[[87],256],120039:[[88],256],120040:[[89],256],120041:[[90],256],120042:[[97],256],120043:[[98],256],120044:[[99],256],120045:[[100],256],120046:[[101],256],120047:[[102],256],120048:[[103],256],120049:[[104],256],120050:[[105],256],120051:[[106],256],120052:[[107],256],120053:[[108],256],120054:[[109],256],120055:[[110],256],120056:[[111],256],120057:[[112],256],120058:[[113],256],120059:[[114],256],120060:[[115],256],120061:[[116],256],120062:[[117],256],120063:[[118],256]},54528:{120064:[[119],256],120065:[[120],256],120066:[[121],256],120067:[[122],256],120068:[[65],256],120069:[[66],256],120071:[[68],256],120072:[[69],256],120073:[[70],256],120074:[[71],256],120077:[[74],256],120078:[[75],256],120079:[[76],256],120080:[[77],256],120081:[[78],256],120082:[[79],256],120083:[[80],256],120084:[[81],256],120086:[[83],256],120087:[[84],256],120088:[[85],256],120089:[[86],256],120090:[[87],256],120091:[[88],256],120092:[[89],256],120094:[[97],256],120095:[[98],256],120096:[[99],256],120097:[[100],256],120098:[[101],256],120099:[[102],256],120100:[[103],256],120101:[[104],256],120102:[[105],256],120103:[[106],256],120104:[[107],256],120105:[[108],256],120106:[[109],256],120107:[[110],256],120108:[[111],256],120109:[[112],256],120110:[[113],256],120111:[[114],256],120112:[[115],256],120113:[[116],256],120114:[[117],256],120115:[[118],256],120116:[[119],256],120117:[[120],256],120118:[[121],256],120119:[[122],256],120120:[[65],256],120121:[[66],256],120123:[[68],256],120124:[[69],256],120125:[[70],256],120126:[[71],256],120128:[[73],256],120129:[[74],256],120130:[[75],256],120131:[[76],256],120132:[[77],256],120134:[[79],256],120138:[[83],256],120139:[[84],256],120140:[[85],256],120141:[[86],256],120142:[[87],256],120143:[[88],256],120144:[[89],256],120146:[[97],256],120147:[[98],256],120148:[[99],256],120149:[[100],256],120150:[[101],256],120151:[[102],256],120152:[[103],256],120153:[[104],256],120154:[[105],256],120155:[[106],256],120156:[[107],256],120157:[[108],256],120158:[[109],256],120159:[[110],256],120160:[[111],256],120161:[[112],256],120162:[[113],256],120163:[[114],256],120164:[[115],256],120165:[[116],256],120166:[[117],256],120167:[[118],256],120168:[[119],256],120169:[[120],256],120170:[[121],256],120171:[[122],256],120172:[[65],256],120173:[[66],256],120174:[[67],256],120175:[[68],256],120176:[[69],256],120177:[[70],256],120178:[[71],256],120179:[[72],256],120180:[[73],256],120181:[[74],256],120182:[[75],256],120183:[[76],256],120184:[[77],256],120185:[[78],256],120186:[[79],256],120187:[[80],256],120188:[[81],256],120189:[[82],256],120190:[[83],256],120191:[[84],256],120192:[[85],256],120193:[[86],256],120194:[[87],256],120195:[[88],256],120196:[[89],256],120197:[[90],256],120198:[[97],256],120199:[[98],256],120200:[[99],256],120201:[[100],256],120202:[[101],256],120203:[[102],256],120204:[[103],256],120205:[[104],256],120206:[[105],256],120207:[[106],256],120208:[[107],256],120209:[[108],256],120210:[[109],256],120211:[[110],256],120212:[[111],256],120213:[[112],256],120214:[[113],256],120215:[[114],256],120216:[[115],256],120217:[[116],256],120218:[[117],256],120219:[[118],256],120220:[[119],256],120221:[[120],256],120222:[[121],256],120223:[[122],256],120224:[[65],256],120225:[[66],256],120226:[[67],256],120227:[[68],256],120228:[[69],256],120229:[[70],256],120230:[[71],256],120231:[[72],256],120232:[[73],256],120233:[[74],256],120234:[[75],256],120235:[[76],256],120236:[[77],256],120237:[[78],256],120238:[[79],256],120239:[[80],256],120240:[[81],256],120241:[[82],256],120242:[[83],256],120243:[[84],256],120244:[[85],256],120245:[[86],256],120246:[[87],256],120247:[[88],256],120248:[[89],256],120249:[[90],256],120250:[[97],256],120251:[[98],256],120252:[[99],256],120253:[[100],256],120254:[[101],256],120255:[[102],256],120256:[[103],256],120257:[[104],256],120258:[[105],256],120259:[[106],256],120260:[[107],256],120261:[[108],256],120262:[[109],256],120263:[[110],256],120264:[[111],256],120265:[[112],256],120266:[[113],256],120267:[[114],256],120268:[[115],256],120269:[[116],256],120270:[[117],256],120271:[[118],256],120272:[[119],256],120273:[[120],256],120274:[[121],256],120275:[[122],256],120276:[[65],256],120277:[[66],256],120278:[[67],256],120279:[[68],256],120280:[[69],256],120281:[[70],256],120282:[[71],256],120283:[[72],256],120284:[[73],256],120285:[[74],256],120286:[[75],256],120287:[[76],256],120288:[[77],256],120289:[[78],256],120290:[[79],256],120291:[[80],256],120292:[[81],256],120293:[[82],256],120294:[[83],256],120295:[[84],256],120296:[[85],256],120297:[[86],256],120298:[[87],256],120299:[[88],256],120300:[[89],256],120301:[[90],256],120302:[[97],256],120303:[[98],256],120304:[[99],256],120305:[[100],256],120306:[[101],256],120307:[[102],256],120308:[[103],256],120309:[[104],256],120310:[[105],256],120311:[[106],256],120312:[[107],256],120313:[[108],256],120314:[[109],256],120315:[[110],256],120316:[[111],256],120317:[[112],256],120318:[[113],256],120319:[[114],256]},54784:{120320:[[115],256],120321:[[116],256],120322:[[117],256],120323:[[118],256],120324:[[119],256],120325:[[120],256],120326:[[121],256],120327:[[122],256],120328:[[65],256],120329:[[66],256],120330:[[67],256],120331:[[68],256],120332:[[69],256],120333:[[70],256],120334:[[71],256],120335:[[72],256],120336:[[73],256],120337:[[74],256],120338:[[75],256],120339:[[76],256],120340:[[77],256],120341:[[78],256],120342:[[79],256],120343:[[80],256],120344:[[81],256],120345:[[82],256],120346:[[83],256],120347:[[84],256],120348:[[85],256],120349:[[86],256],120350:[[87],256],120351:[[88],256],120352:[[89],256],120353:[[90],256],120354:[[97],256],120355:[[98],256],120356:[[99],256],120357:[[100],256],120358:[[101],256],120359:[[102],256],120360:[[103],256],120361:[[104],256],120362:[[105],256],120363:[[106],256],120364:[[107],256],120365:[[108],256],120366:[[109],256],120367:[[110],256],120368:[[111],256],120369:[[112],256],120370:[[113],256],120371:[[114],256],120372:[[115],256],120373:[[116],256],120374:[[117],256],120375:[[118],256],120376:[[119],256],120377:[[120],256],120378:[[121],256],120379:[[122],256],120380:[[65],256],120381:[[66],256],120382:[[67],256],120383:[[68],256],120384:[[69],256],120385:[[70],256],120386:[[71],256],120387:[[72],256],120388:[[73],256],120389:[[74],256],120390:[[75],256],120391:[[76],256],120392:[[77],256],120393:[[78],256],120394:[[79],256],120395:[[80],256],120396:[[81],256],120397:[[82],256],120398:[[83],256],120399:[[84],256],120400:[[85],256],120401:[[86],256],120402:[[87],256],120403:[[88],256],120404:[[89],256],120405:[[90],256],120406:[[97],256],120407:[[98],256],120408:[[99],256],120409:[[100],256],120410:[[101],256],120411:[[102],256],120412:[[103],256],120413:[[104],256],120414:[[105],256],120415:[[106],256],120416:[[107],256],120417:[[108],256],120418:[[109],256],120419:[[110],256],120420:[[111],256],120421:[[112],256],120422:[[113],256],120423:[[114],256],120424:[[115],256],120425:[[116],256],120426:[[117],256],120427:[[118],256],120428:[[119],256],120429:[[120],256],120430:[[121],256],120431:[[122],256],120432:[[65],256],120433:[[66],256],120434:[[67],256],120435:[[68],256],120436:[[69],256],120437:[[70],256],120438:[[71],256],120439:[[72],256],120440:[[73],256],120441:[[74],256],120442:[[75],256],120443:[[76],256],120444:[[77],256],120445:[[78],256],120446:[[79],256],120447:[[80],256],120448:[[81],256],120449:[[82],256],120450:[[83],256],120451:[[84],256],120452:[[85],256],120453:[[86],256],120454:[[87],256],120455:[[88],256],120456:[[89],256],120457:[[90],256],120458:[[97],256],120459:[[98],256],120460:[[99],256],120461:[[100],256],120462:[[101],256],120463:[[102],256],120464:[[103],256],120465:[[104],256],120466:[[105],256],120467:[[106],256],120468:[[107],256],120469:[[108],256],120470:[[109],256],120471:[[110],256],120472:[[111],256],120473:[[112],256],120474:[[113],256],120475:[[114],256],120476:[[115],256],120477:[[116],256],120478:[[117],256],120479:[[118],256],120480:[[119],256],120481:[[120],256],120482:[[121],256],120483:[[122],256],120484:[[305],256],120485:[[567],256],120488:[[913],256],120489:[[914],256],120490:[[915],256],120491:[[916],256],120492:[[917],256],120493:[[918],256],120494:[[919],256],120495:[[920],256],120496:[[921],256],120497:[[922],256],120498:[[923],256],120499:[[924],256],120500:[[925],256],120501:[[926],256],120502:[[927],256],120503:[[928],256],120504:[[929],256],120505:[[1012],256],120506:[[931],256],120507:[[932],256],120508:[[933],256],120509:[[934],256],120510:[[935],256],120511:[[936],256],120512:[[937],256],120513:[[8711],256],120514:[[945],256],120515:[[946],256],120516:[[947],256],120517:[[948],256],120518:[[949],256],120519:[[950],256],120520:[[951],256],120521:[[952],256],120522:[[953],256],120523:[[954],256],120524:[[955],256],120525:[[956],256],120526:[[957],256],120527:[[958],256],120528:[[959],256],120529:[[960],256],120530:[[961],256],120531:[[962],256],120532:[[963],256],120533:[[964],256],120534:[[965],256],120535:[[966],256],120536:[[967],256],120537:[[968],256],120538:[[969],256],120539:[[8706],256],120540:[[1013],256],120541:[[977],256],120542:[[1008],256],120543:[[981],256],120544:[[1009],256],120545:[[982],256],120546:[[913],256],120547:[[914],256],120548:[[915],256],120549:[[916],256],120550:[[917],256],120551:[[918],256],120552:[[919],256],120553:[[920],256],120554:[[921],256],120555:[[922],256],120556:[[923],256],120557:[[924],256],120558:[[925],256],120559:[[926],256],120560:[[927],256],120561:[[928],256],120562:[[929],256],120563:[[1012],256],120564:[[931],256],120565:[[932],256],120566:[[933],256],120567:[[934],256],120568:[[935],256],120569:[[936],256],120570:[[937],256],120571:[[8711],256],120572:[[945],256],120573:[[946],256],120574:[[947],256],120575:[[948],256]},55040:{120576:[[949],256],120577:[[950],256],120578:[[951],256],120579:[[952],256],120580:[[953],256],120581:[[954],256],120582:[[955],256],120583:[[956],256],120584:[[957],256],120585:[[958],256],120586:[[959],256],120587:[[960],256],120588:[[961],256],120589:[[962],256],120590:[[963],256],120591:[[964],256],120592:[[965],256],120593:[[966],256],120594:[[967],256],120595:[[968],256],120596:[[969],256],120597:[[8706],256],120598:[[1013],256],120599:[[977],256],120600:[[1008],256],120601:[[981],256],120602:[[1009],256],120603:[[982],256],120604:[[913],256],120605:[[914],256],120606:[[915],256],120607:[[916],256],120608:[[917],256],120609:[[918],256],120610:[[919],256],120611:[[920],256],120612:[[921],256],120613:[[922],256],120614:[[923],256],120615:[[924],256],120616:[[925],256],120617:[[926],256],120618:[[927],256],120619:[[928],256],120620:[[929],256],120621:[[1012],256],120622:[[931],256],120623:[[932],256],120624:[[933],256],120625:[[934],256],120626:[[935],256],120627:[[936],256],120628:[[937],256],120629:[[8711],256],120630:[[945],256],120631:[[946],256],120632:[[947],256],120633:[[948],256],120634:[[949],256],120635:[[950],256],120636:[[951],256],120637:[[952],256],120638:[[953],256],120639:[[954],256],120640:[[955],256],120641:[[956],256],120642:[[957],256],120643:[[958],256],120644:[[959],256],120645:[[960],256],120646:[[961],256],120647:[[962],256],120648:[[963],256],120649:[[964],256],120650:[[965],256],120651:[[966],256],120652:[[967],256],120653:[[968],256],120654:[[969],256],120655:[[8706],256],120656:[[1013],256],120657:[[977],256],120658:[[1008],256],120659:[[981],256],120660:[[1009],256],120661:[[982],256],120662:[[913],256],120663:[[914],256],120664:[[915],256],120665:[[916],256],120666:[[917],256],120667:[[918],256],120668:[[919],256],120669:[[920],256],120670:[[921],256],120671:[[922],256],120672:[[923],256],120673:[[924],256],120674:[[925],256],120675:[[926],256],120676:[[927],256],120677:[[928],256],120678:[[929],256],120679:[[1012],256],120680:[[931],256],120681:[[932],256],120682:[[933],256],120683:[[934],256],120684:[[935],256],120685:[[936],256],120686:[[937],256],120687:[[8711],256],120688:[[945],256],120689:[[946],256],120690:[[947],256],120691:[[948],256],120692:[[949],256],120693:[[950],256],120694:[[951],256],120695:[[952],256],120696:[[953],256],120697:[[954],256],120698:[[955],256],120699:[[956],256],120700:[[957],256],120701:[[958],256],120702:[[959],256],120703:[[960],256],120704:[[961],256],120705:[[962],256],120706:[[963],256],120707:[[964],256],120708:[[965],256],120709:[[966],256],120710:[[967],256],120711:[[968],256],120712:[[969],256],120713:[[8706],256],120714:[[1013],256],120715:[[977],256],120716:[[1008],256],120717:[[981],256],120718:[[1009],256],120719:[[982],256],120720:[[913],256],120721:[[914],256],120722:[[915],256],120723:[[916],256],120724:[[917],256],120725:[[918],256],120726:[[919],256],120727:[[920],256],120728:[[921],256],120729:[[922],256],120730:[[923],256],120731:[[924],256],120732:[[925],256],120733:[[926],256],120734:[[927],256],120735:[[928],256],120736:[[929],256],120737:[[1012],256],120738:[[931],256],120739:[[932],256],120740:[[933],256],120741:[[934],256],120742:[[935],256],120743:[[936],256],120744:[[937],256],120745:[[8711],256],120746:[[945],256],120747:[[946],256],120748:[[947],256],120749:[[948],256],120750:[[949],256],120751:[[950],256],120752:[[951],256],120753:[[952],256],120754:[[953],256],120755:[[954],256],120756:[[955],256],120757:[[956],256],120758:[[957],256],120759:[[958],256],120760:[[959],256],120761:[[960],256],120762:[[961],256],120763:[[962],256],120764:[[963],256],120765:[[964],256],120766:[[965],256],120767:[[966],256],120768:[[967],256],120769:[[968],256],120770:[[969],256],120771:[[8706],256],120772:[[1013],256],120773:[[977],256],120774:[[1008],256],120775:[[981],256],120776:[[1009],256],120777:[[982],256],120778:[[988],256],120779:[[989],256],120782:[[48],256],120783:[[49],256],120784:[[50],256],120785:[[51],256],120786:[[52],256],120787:[[53],256],120788:[[54],256],120789:[[55],256],120790:[[56],256],120791:[[57],256],120792:[[48],256],120793:[[49],256],120794:[[50],256],120795:[[51],256],120796:[[52],256],120797:[[53],256],120798:[[54],256],120799:[[55],256],120800:[[56],256],120801:[[57],256],120802:[[48],256],120803:[[49],256],120804:[[50],256],120805:[[51],256],120806:[[52],256],120807:[[53],256],120808:[[54],256],120809:[[55],256],120810:[[56],256],120811:[[57],256],120812:[[48],256],120813:[[49],256],120814:[[50],256],120815:[[51],256],120816:[[52],256],120817:[[53],256],120818:[[54],256],120819:[[55],256],120820:[[56],256],120821:[[57],256],120822:[[48],256],120823:[[49],256],120824:[[50],256],120825:[[51],256],120826:[[52],256],120827:[[53],256],120828:[[54],256],120829:[[55],256],120830:[[56],256],120831:[[57],256]},59392:{125136:[,220],125137:[,220],125138:[,220],125139:[,220],125140:[,220],125141:[,220],125142:[,220]},60928:{126464:[[1575],256],126465:[[1576],256],126466:[[1580],256],126467:[[1583],256],126469:[[1608],256],126470:[[1586],256],126471:[[1581],256],126472:[[1591],256],126473:[[1610],256],126474:[[1603],256],126475:[[1604],256],126476:[[1605],256],126477:[[1606],256],126478:[[1587],256],126479:[[1593],256],126480:[[1601],256],126481:[[1589],256],126482:[[1602],256],126483:[[1585],256],126484:[[1588],256],126485:[[1578],256],126486:[[1579],256],126487:[[1582],256],126488:[[1584],256],126489:[[1590],256],126490:[[1592],256],126491:[[1594],256],126492:[[1646],256],126493:[[1722],256],126494:[[1697],256],126495:[[1647],256],126497:[[1576],256],126498:[[1580],256],126500:[[1607],256],126503:[[1581],256],126505:[[1610],256],126506:[[1603],256],126507:[[1604],256],126508:[[1605],256],126509:[[1606],256],126510:[[1587],256],126511:[[1593],256],126512:[[1601],256],126513:[[1589],256],126514:[[1602],256],126516:[[1588],256],126517:[[1578],256],126518:[[1579],256],126519:[[1582],256],126521:[[1590],256],126523:[[1594],256],126530:[[1580],256],126535:[[1581],256],126537:[[1610],256],126539:[[1604],256],126541:[[1606],256],126542:[[1587],256],126543:[[1593],256],126545:[[1589],256],126546:[[1602],256],126548:[[1588],256],126551:[[1582],256],126553:[[1590],256],126555:[[1594],256],126557:[[1722],256],126559:[[1647],256],126561:[[1576],256],126562:[[1580],256],126564:[[1607],256],126567:[[1581],256],126568:[[1591],256],126569:[[1610],256],126570:[[1603],256],126572:[[1605],256],126573:[[1606],256],126574:[[1587],256],126575:[[1593],256],126576:[[1601],256],126577:[[1589],256],126578:[[1602],256],126580:[[1588],256],126581:[[1578],256],126582:[[1579],256],126583:[[1582],256],126585:[[1590],256],126586:[[1592],256],126587:[[1594],256],126588:[[1646],256],126590:[[1697],256],126592:[[1575],256],126593:[[1576],256],126594:[[1580],256],126595:[[1583],256],126596:[[1607],256],126597:[[1608],256],126598:[[1586],256],126599:[[1581],256],126600:[[1591],256],126601:[[1610],256],126603:[[1604],256],126604:[[1605],256],126605:[[1606],256],126606:[[1587],256],126607:[[1593],256],126608:[[1601],256],126609:[[1589],256],126610:[[1602],256],126611:[[1585],256],126612:[[1588],256],126613:[[1578],256],126614:[[1579],256],126615:[[1582],256],126616:[[1584],256],126617:[[1590],256],126618:[[1592],256],126619:[[1594],256],126625:[[1576],256],126626:[[1580],256],126627:[[1583],256],126629:[[1608],256],126630:[[1586],256],126631:[[1581],256],126632:[[1591],256],126633:[[1610],256],126635:[[1604],256],126636:[[1605],256],126637:[[1606],256],126638:[[1587],256],126639:[[1593],256],126640:[[1601],256],126641:[[1589],256],126642:[[1602],256],126643:[[1585],256],126644:[[1588],256],126645:[[1578],256],126646:[[1579],256],126647:[[1582],256],126648:[[1584],256],126649:[[1590],256],126650:[[1592],256],126651:[[1594],256]},61696:{127232:[[48,46],256],127233:[[48,44],256],127234:[[49,44],256],127235:[[50,44],256],127236:[[51,44],256],127237:[[52,44],256],127238:[[53,44],256],127239:[[54,44],256],127240:[[55,44],256],127241:[[56,44],256],127242:[[57,44],256],127248:[[40,65,41],256],127249:[[40,66,41],256],127250:[[40,67,41],256],127251:[[40,68,41],256],127252:[[40,69,41],256],127253:[[40,70,41],256],127254:[[40,71,41],256],127255:[[40,72,41],256],127256:[[40,73,41],256],127257:[[40,74,41],256],127258:[[40,75,41],256],127259:[[40,76,41],256],127260:[[40,77,41],256],127261:[[40,78,41],256],127262:[[40,79,41],256],127263:[[40,80,41],256],127264:[[40,81,41],256],127265:[[40,82,41],256],127266:[[40,83,41],256],127267:[[40,84,41],256],127268:[[40,85,41],256],127269:[[40,86,41],256],127270:[[40,87,41],256],127271:[[40,88,41],256],127272:[[40,89,41],256],127273:[[40,90,41],256],127274:[[12308,83,12309],256],127275:[[67],256],127276:[[82],256],127277:[[67,68],256],127278:[[87,90],256],127280:[[65],256],127281:[[66],256],127282:[[67],256],127283:[[68],256],127284:[[69],256],127285:[[70],256],127286:[[71],256],127287:[[72],256],127288:[[73],256],127289:[[74],256],127290:[[75],256],127291:[[76],256],127292:[[77],256],127293:[[78],256],127294:[[79],256],127295:[[80],256],127296:[[81],256],127297:[[82],256],127298:[[83],256],127299:[[84],256],127300:[[85],256],127301:[[86],256],127302:[[87],256],127303:[[88],256],127304:[[89],256],127305:[[90],256],127306:[[72,86],256],127307:[[77,86],256],127308:[[83,68],256],127309:[[83,83],256],127310:[[80,80,86],256],127311:[[87,67],256],127338:[[77,67],256],127339:[[77,68],256],127376:[[68,74],256]},61952:{127488:[[12411,12363],256],127489:[[12467,12467],256],127490:[[12469],256],127504:[[25163],256],127505:[[23383],256],127506:[[21452],256],127507:[[12487],256],127508:[[20108],256],127509:[[22810],256],127510:[[35299],256],127511:[[22825],256],127512:[[20132],256],127513:[[26144],256],127514:[[28961],256],127515:[[26009],256],127516:[[21069],256],127517:[[24460],256],127518:[[20877],256],127519:[[26032],256],127520:[[21021],256],127521:[[32066],256],127522:[[29983],256],127523:[[36009],256],127524:[[22768],256],127525:[[21561],256],127526:[[28436],256],127527:[[25237],256],127528:[[25429],256],127529:[[19968],256],127530:[[19977],256],127531:[[36938],256],127532:[[24038],256],127533:[[20013],256],127534:[[21491],256],127535:[[25351],256],127536:[[36208],256],127537:[[25171],256],127538:[[31105],256],127539:[[31354],256],127540:[[21512],256],127541:[[28288],256],127542:[[26377],256],127543:[[26376],256],127544:[[30003],256],127545:[[21106],256],127546:[[21942],256],127552:[[12308,26412,12309],256],127553:[[12308,19977,12309],256],127554:[[12308,20108,12309],256],127555:[[12308,23433,12309],256],127556:[[12308,28857,12309],256],127557:[[12308,25171,12309],256],127558:[[12308,30423,12309],256],127559:[[12308,21213,12309],256],127560:[[12308,25943,12309],256],127568:[[24471],256],127569:[[21487],256]},63488:{194560:[[20029]],194561:[[20024]],194562:[[20033]],194563:[[131362]],194564:[[20320]],194565:[[20398]],194566:[[20411]],194567:[[20482]],194568:[[20602]],194569:[[20633]],194570:[[20711]],194571:[[20687]],194572:[[13470]],194573:[[132666]],194574:[[20813]],194575:[[20820]],194576:[[20836]],194577:[[20855]],194578:[[132380]],194579:[[13497]],194580:[[20839]],194581:[[20877]],194582:[[132427]],194583:[[20887]],194584:[[20900]],194585:[[20172]],194586:[[20908]],194587:[[20917]],194588:[[168415]],194589:[[20981]],194590:[[20995]],194591:[[13535]],194592:[[21051]],194593:[[21062]],194594:[[21106]],194595:[[21111]],194596:[[13589]],194597:[[21191]],194598:[[21193]],194599:[[21220]],194600:[[21242]],194601:[[21253]],194602:[[21254]],194603:[[21271]],194604:[[21321]],194605:[[21329]],194606:[[21338]],194607:[[21363]],194608:[[21373]],194609:[[21375]],194610:[[21375]],194611:[[21375]],194612:[[133676]],194613:[[28784]],194614:[[21450]],194615:[[21471]],194616:[[133987]],194617:[[21483]],194618:[[21489]],194619:[[21510]],194620:[[21662]],194621:[[21560]],194622:[[21576]],194623:[[21608]],194624:[[21666]],194625:[[21750]],194626:[[21776]],194627:[[21843]],194628:[[21859]],194629:[[21892]],194630:[[21892]],194631:[[21913]],194632:[[21931]],194633:[[21939]],194634:[[21954]],194635:[[22294]],194636:[[22022]],194637:[[22295]],194638:[[22097]],194639:[[22132]],194640:[[20999]],194641:[[22766]],194642:[[22478]],194643:[[22516]],194644:[[22541]],194645:[[22411]],194646:[[22578]],194647:[[22577]],194648:[[22700]],194649:[[136420]],194650:[[22770]],194651:[[22775]],194652:[[22790]],194653:[[22810]],194654:[[22818]],194655:[[22882]],194656:[[136872]],194657:[[136938]],194658:[[23020]],194659:[[23067]],194660:[[23079]],194661:[[23e3]],194662:[[23142]],194663:[[14062]],194664:[[14076]],194665:[[23304]],194666:[[23358]],194667:[[23358]],194668:[[137672]],194669:[[23491]],194670:[[23512]],194671:[[23527]],194672:[[23539]],194673:[[138008]],194674:[[23551]],194675:[[23558]],194676:[[24403]],194677:[[23586]],194678:[[14209]],194679:[[23648]],194680:[[23662]],194681:[[23744]],194682:[[23693]],194683:[[138724]],194684:[[23875]],194685:[[138726]],194686:[[23918]],194687:[[23915]],194688:[[23932]],194689:[[24033]],194690:[[24034]],194691:[[14383]],194692:[[24061]],194693:[[24104]],194694:[[24125]],194695:[[24169]],194696:[[14434]],194697:[[139651]],194698:[[14460]],194699:[[24240]],194700:[[24243]],194701:[[24246]],194702:[[24266]],194703:[[172946]],194704:[[24318]],194705:[[140081]],194706:[[140081]],194707:[[33281]],194708:[[24354]],194709:[[24354]],194710:[[14535]],194711:[[144056]],194712:[[156122]],194713:[[24418]],194714:[[24427]],194715:[[14563]],194716:[[24474]],194717:[[24525]],194718:[[24535]],194719:[[24569]],194720:[[24705]],194721:[[14650]],194722:[[14620]],194723:[[24724]],194724:[[141012]],194725:[[24775]],194726:[[24904]],194727:[[24908]],194728:[[24910]],194729:[[24908]],194730:[[24954]],194731:[[24974]],194732:[[25010]],194733:[[24996]],194734:[[25007]],194735:[[25054]],194736:[[25074]],194737:[[25078]],194738:[[25104]],194739:[[25115]],194740:[[25181]],194741:[[25265]],194742:[[25300]],194743:[[25424]],194744:[[142092]],194745:[[25405]],194746:[[25340]],194747:[[25448]],194748:[[25475]],194749:[[25572]],194750:[[142321]],194751:[[25634]],194752:[[25541]],194753:[[25513]],194754:[[14894]],194755:[[25705]],194756:[[25726]],194757:[[25757]],194758:[[25719]],194759:[[14956]],194760:[[25935]],194761:[[25964]],194762:[[143370]],194763:[[26083]],194764:[[26360]],194765:[[26185]],194766:[[15129]],194767:[[26257]],194768:[[15112]],194769:[[15076]],194770:[[20882]],194771:[[20885]],194772:[[26368]],194773:[[26268]],194774:[[32941]],194775:[[17369]],194776:[[26391]],194777:[[26395]],194778:[[26401]],194779:[[26462]],194780:[[26451]],194781:[[144323]],194782:[[15177]],194783:[[26618]],194784:[[26501]],194785:[[26706]],194786:[[26757]],194787:[[144493]],194788:[[26766]],194789:[[26655]],194790:[[26900]],194791:[[15261]],194792:[[26946]],194793:[[27043]],194794:[[27114]],194795:[[27304]],194796:[[145059]],194797:[[27355]],194798:[[15384]],194799:[[27425]],194800:[[145575]],194801:[[27476]],194802:[[15438]],194803:[[27506]],194804:[[27551]],194805:[[27578]],194806:[[27579]],194807:[[146061]],194808:[[138507]],194809:[[146170]],194810:[[27726]],194811:[[146620]],194812:[[27839]],194813:[[27853]],194814:[[27751]],194815:[[27926]]},63744:{63744:[[35912]],63745:[[26356]],63746:[[36554]],63747:[[36040]],63748:[[28369]],63749:[[20018]],63750:[[21477]],63751:[[40860]],63752:[[40860]],63753:[[22865]],63754:[[37329]],63755:[[21895]],63756:[[22856]],63757:[[25078]],63758:[[30313]],63759:[[32645]],63760:[[34367]],63761:[[34746]],63762:[[35064]],63763:[[37007]],63764:[[27138]],63765:[[27931]],63766:[[28889]],63767:[[29662]],63768:[[33853]],63769:[[37226]],63770:[[39409]],63771:[[20098]],63772:[[21365]],63773:[[27396]],63774:[[29211]],63775:[[34349]],63776:[[40478]],63777:[[23888]],63778:[[28651]],63779:[[34253]],63780:[[35172]],63781:[[25289]],63782:[[33240]],63783:[[34847]],63784:[[24266]],63785:[[26391]],63786:[[28010]],63787:[[29436]],63788:[[37070]],63789:[[20358]],63790:[[20919]],63791:[[21214]],63792:[[25796]],63793:[[27347]],63794:[[29200]],63795:[[30439]],63796:[[32769]],63797:[[34310]],63798:[[34396]],63799:[[36335]],63800:[[38706]],63801:[[39791]],63802:[[40442]],63803:[[30860]],63804:[[31103]],63805:[[32160]],63806:[[33737]],63807:[[37636]],63808:[[40575]],63809:[[35542]],63810:[[22751]],63811:[[24324]],63812:[[31840]],63813:[[32894]],63814:[[29282]],63815:[[30922]],63816:[[36034]],63817:[[38647]],63818:[[22744]],63819:[[23650]],63820:[[27155]],63821:[[28122]],63822:[[28431]],63823:[[32047]],63824:[[32311]],63825:[[38475]],63826:[[21202]],63827:[[32907]],63828:[[20956]],63829:[[20940]],63830:[[31260]],63831:[[32190]],63832:[[33777]],63833:[[38517]],63834:[[35712]],63835:[[25295]],63836:[[27138]],63837:[[35582]],63838:[[20025]],63839:[[23527]],63840:[[24594]],63841:[[29575]],63842:[[30064]],63843:[[21271]],63844:[[30971]],63845:[[20415]],63846:[[24489]],63847:[[19981]],63848:[[27852]],63849:[[25976]],63850:[[32034]],63851:[[21443]],63852:[[22622]],63853:[[30465]],63854:[[33865]],63855:[[35498]],63856:[[27578]],63857:[[36784]],63858:[[27784]],63859:[[25342]],63860:[[33509]],63861:[[25504]],63862:[[30053]],63863:[[20142]],63864:[[20841]],63865:[[20937]],63866:[[26753]],63867:[[31975]],63868:[[33391]],63869:[[35538]],63870:[[37327]],63871:[[21237]],63872:[[21570]],63873:[[22899]],63874:[[24300]],63875:[[26053]],63876:[[28670]],63877:[[31018]],63878:[[38317]],63879:[[39530]],63880:[[40599]],63881:[[40654]],63882:[[21147]],63883:[[26310]],63884:[[27511]],63885:[[36706]],63886:[[24180]],63887:[[24976]],63888:[[25088]],63889:[[25754]],63890:[[28451]],63891:[[29001]],63892:[[29833]],63893:[[31178]],63894:[[32244]],63895:[[32879]],63896:[[36646]],63897:[[34030]],63898:[[36899]],63899:[[37706]],63900:[[21015]],63901:[[21155]],63902:[[21693]],63903:[[28872]],63904:[[35010]],63905:[[35498]],63906:[[24265]],63907:[[24565]],63908:[[25467]],63909:[[27566]],63910:[[31806]],63911:[[29557]],63912:[[20196]],63913:[[22265]],63914:[[23527]],63915:[[23994]],63916:[[24604]],63917:[[29618]],63918:[[29801]],63919:[[32666]],63920:[[32838]],63921:[[37428]],63922:[[38646]],63923:[[38728]],63924:[[38936]],63925:[[20363]],63926:[[31150]],63927:[[37300]],63928:[[38584]],63929:[[24801]],63930:[[20102]],63931:[[20698]],63932:[[23534]],63933:[[23615]],63934:[[26009]],63935:[[27138]],63936:[[29134]],63937:[[30274]],63938:[[34044]],63939:[[36988]],63940:[[40845]],63941:[[26248]],63942:[[38446]],63943:[[21129]],63944:[[26491]],63945:[[26611]],63946:[[27969]],63947:[[28316]],63948:[[29705]],63949:[[30041]],63950:[[30827]],63951:[[32016]],63952:[[39006]],63953:[[20845]],63954:[[25134]],63955:[[38520]],63956:[[20523]],63957:[[23833]],63958:[[28138]],63959:[[36650]],63960:[[24459]],63961:[[24900]],63962:[[26647]],63963:[[29575]],63964:[[38534]],63965:[[21033]],63966:[[21519]],63967:[[23653]],63968:[[26131]],63969:[[26446]],63970:[[26792]],63971:[[27877]],63972:[[29702]],63973:[[30178]],63974:[[32633]],63975:[[35023]],63976:[[35041]],63977:[[37324]],63978:[[38626]],63979:[[21311]],63980:[[28346]],63981:[[21533]],63982:[[29136]],63983:[[29848]],63984:[[34298]],63985:[[38563]],63986:[[40023]],63987:[[40607]],63988:[[26519]],63989:[[28107]],63990:[[33256]],63991:[[31435]],63992:[[31520]],63993:[[31890]],63994:[[29376]],63995:[[28825]],63996:[[35672]],63997:[[20160]],63998:[[33590]],63999:[[21050]],194816:[[27966]],194817:[[28023]],194818:[[27969]],194819:[[28009]],194820:[[28024]],194821:[[28037]],194822:[[146718]],194823:[[27956]],194824:[[28207]],194825:[[28270]],194826:[[15667]],194827:[[28363]],194828:[[28359]],194829:[[147153]],194830:[[28153]],194831:[[28526]],194832:[[147294]],194833:[[147342]],194834:[[28614]],194835:[[28729]],194836:[[28702]],194837:[[28699]],194838:[[15766]],194839:[[28746]],194840:[[28797]],194841:[[28791]],194842:[[28845]],194843:[[132389]],194844:[[28997]],194845:[[148067]],194846:[[29084]],194847:[[148395]],194848:[[29224]],194849:[[29237]],194850:[[29264]],194851:[[149e3]],194852:[[29312]],194853:[[29333]],194854:[[149301]],194855:[[149524]],194856:[[29562]],194857:[[29579]],194858:[[16044]],194859:[[29605]],194860:[[16056]],194861:[[16056]],194862:[[29767]],194863:[[29788]],194864:[[29809]],194865:[[29829]],194866:[[29898]],194867:[[16155]],194868:[[29988]],194869:[[150582]],194870:[[30014]],194871:[[150674]],194872:[[30064]],194873:[[139679]],194874:[[30224]],194875:[[151457]],194876:[[151480]],194877:[[151620]],194878:[[16380]],194879:[[16392]],194880:[[30452]],194881:[[151795]],194882:[[151794]],194883:[[151833]],194884:[[151859]],194885:[[30494]],194886:[[30495]],194887:[[30495]],194888:[[30538]],194889:[[16441]],194890:[[30603]],194891:[[16454]],194892:[[16534]],194893:[[152605]],194894:[[30798]],194895:[[30860]],194896:[[30924]],194897:[[16611]],194898:[[153126]],194899:[[31062]],194900:[[153242]],194901:[[153285]],194902:[[31119]],194903:[[31211]],194904:[[16687]],194905:[[31296]],194906:[[31306]],194907:[[31311]],194908:[[153980]],194909:[[154279]],194910:[[154279]],194911:[[31470]],194912:[[16898]],194913:[[154539]],194914:[[31686]],194915:[[31689]],194916:[[16935]],194917:[[154752]],194918:[[31954]],194919:[[17056]],194920:[[31976]],194921:[[31971]],194922:[[32e3]],194923:[[155526]],194924:[[32099]],194925:[[17153]],194926:[[32199]],194927:[[32258]],194928:[[32325]],194929:[[17204]],194930:[[156200]],194931:[[156231]],194932:[[17241]],194933:[[156377]],194934:[[32634]],194935:[[156478]],194936:[[32661]],194937:[[32762]],194938:[[32773]],194939:[[156890]],194940:[[156963]],194941:[[32864]],194942:[[157096]],194943:[[32880]],194944:[[144223]],194945:[[17365]],194946:[[32946]],194947:[[33027]],194948:[[17419]],194949:[[33086]],194950:[[23221]],194951:[[157607]],194952:[[157621]],194953:[[144275]],194954:[[144284]],194955:[[33281]],194956:[[33284]],194957:[[36766]],194958:[[17515]],194959:[[33425]],194960:[[33419]],194961:[[33437]],194962:[[21171]],194963:[[33457]],194964:[[33459]],194965:[[33469]],194966:[[33510]],194967:[[158524]],194968:[[33509]],194969:[[33565]],194970:[[33635]],194971:[[33709]],194972:[[33571]],194973:[[33725]],194974:[[33767]],194975:[[33879]],194976:[[33619]],194977:[[33738]],194978:[[33740]],194979:[[33756]],194980:[[158774]],194981:[[159083]],194982:[[158933]],194983:[[17707]],194984:[[34033]],194985:[[34035]],194986:[[34070]],194987:[[160714]],194988:[[34148]],194989:[[159532]],194990:[[17757]],194991:[[17761]],194992:[[159665]],194993:[[159954]],194994:[[17771]],194995:[[34384]],194996:[[34396]],194997:[[34407]],194998:[[34409]],194999:[[34473]],195e3:[[34440]],195001:[[34574]],195002:[[34530]],195003:[[34681]],195004:[[34600]],195005:[[34667]],195006:[[34694]],195007:[[17879]],195008:[[34785]],195009:[[34817]],195010:[[17913]],195011:[[34912]],195012:[[34915]],195013:[[161383]],195014:[[35031]],195015:[[35038]],195016:[[17973]],195017:[[35066]],195018:[[13499]],195019:[[161966]],195020:[[162150]],195021:[[18110]],195022:[[18119]],195023:[[35488]],195024:[[35565]],195025:[[35722]],195026:[[35925]],195027:[[162984]],195028:[[36011]],195029:[[36033]],195030:[[36123]],195031:[[36215]],195032:[[163631]],195033:[[133124]],195034:[[36299]],195035:[[36284]],195036:[[36336]],195037:[[133342]],195038:[[36564]],195039:[[36664]],195040:[[165330]],195041:[[165357]],195042:[[37012]],195043:[[37105]],195044:[[37137]],195045:[[165678]],195046:[[37147]],195047:[[37432]],195048:[[37591]],195049:[[37592]],195050:[[37500]],195051:[[37881]],195052:[[37909]],195053:[[166906]],195054:[[38283]],195055:[[18837]],195056:[[38327]],195057:[[167287]],195058:[[18918]],195059:[[38595]],195060:[[23986]],195061:[[38691]],195062:[[168261]],195063:[[168474]],195064:[[19054]],195065:[[19062]],195066:[[38880]],195067:[[168970]],195068:[[19122]],195069:[[169110]],195070:[[38923]],195071:[[38923]]},64e3:{64e3:[[20999]],64001:[[24230]],64002:[[25299]],64003:[[31958]],64004:[[23429]],64005:[[27934]],64006:[[26292]],64007:[[36667]],64008:[[34892]],64009:[[38477]],64010:[[35211]],64011:[[24275]],64012:[[20800]],64013:[[21952]],64016:[[22618]],64018:[[26228]],64021:[[20958]],64022:[[29482]],64023:[[30410]],64024:[[31036]],64025:[[31070]],64026:[[31077]],64027:[[31119]],64028:[[38742]],64029:[[31934]],64030:[[32701]],64032:[[34322]],64034:[[35576]],64037:[[36920]],64038:[[37117]],64042:[[39151]],64043:[[39164]],64044:[[39208]],64045:[[40372]],64046:[[37086]],64047:[[38583]],64048:[[20398]],64049:[[20711]],64050:[[20813]],64051:[[21193]],64052:[[21220]],64053:[[21329]],64054:[[21917]],64055:[[22022]],64056:[[22120]],64057:[[22592]],64058:[[22696]],64059:[[23652]],64060:[[23662]],64061:[[24724]],64062:[[24936]],64063:[[24974]],64064:[[25074]],64065:[[25935]],64066:[[26082]],64067:[[26257]],64068:[[26757]],64069:[[28023]],64070:[[28186]],64071:[[28450]],64072:[[29038]],64073:[[29227]],64074:[[29730]],64075:[[30865]],64076:[[31038]],64077:[[31049]],64078:[[31048]],64079:[[31056]],64080:[[31062]],64081:[[31069]],64082:[[31117]],64083:[[31118]],64084:[[31296]],64085:[[31361]],64086:[[31680]],64087:[[32244]],64088:[[32265]],64089:[[32321]],64090:[[32626]],64091:[[32773]],64092:[[33261]],64093:[[33401]],64094:[[33401]],64095:[[33879]],64096:[[35088]],64097:[[35222]],64098:[[35585]],64099:[[35641]],64100:[[36051]],64101:[[36104]],64102:[[36790]],64103:[[36920]],64104:[[38627]],64105:[[38911]],64106:[[38971]],64107:[[24693]],64108:[[148206]],64109:[[33304]],64112:[[20006]],64113:[[20917]],64114:[[20840]],64115:[[20352]],64116:[[20805]],64117:[[20864]],64118:[[21191]],64119:[[21242]],64120:[[21917]],64121:[[21845]],64122:[[21913]],64123:[[21986]],64124:[[22618]],64125:[[22707]],64126:[[22852]],64127:[[22868]],64128:[[23138]],64129:[[23336]],64130:[[24274]],64131:[[24281]],64132:[[24425]],64133:[[24493]],64134:[[24792]],64135:[[24910]],64136:[[24840]],64137:[[24974]],64138:[[24928]],64139:[[25074]],64140:[[25140]],64141:[[25540]],64142:[[25628]],64143:[[25682]],64144:[[25942]],64145:[[26228]],64146:[[26391]],64147:[[26395]],64148:[[26454]],64149:[[27513]],64150:[[27578]],64151:[[27969]],64152:[[28379]],64153:[[28363]],64154:[[28450]],64155:[[28702]],64156:[[29038]],64157:[[30631]],64158:[[29237]],64159:[[29359]],64160:[[29482]],64161:[[29809]],64162:[[29958]],64163:[[30011]],64164:[[30237]],64165:[[30239]],64166:[[30410]],64167:[[30427]],64168:[[30452]],64169:[[30538]],64170:[[30528]],64171:[[30924]],64172:[[31409]],64173:[[31680]],64174:[[31867]],64175:[[32091]],64176:[[32244]],64177:[[32574]],64178:[[32773]],64179:[[33618]],64180:[[33775]],64181:[[34681]],64182:[[35137]],64183:[[35206]],64184:[[35222]],64185:[[35519]],64186:[[35576]],64187:[[35531]],64188:[[35585]],64189:[[35582]],64190:[[35565]],64191:[[35641]],64192:[[35722]],64193:[[36104]],64194:[[36664]],64195:[[36978]],64196:[[37273]],64197:[[37494]],64198:[[38524]],64199:[[38627]],64200:[[38742]],64201:[[38875]],64202:[[38911]],64203:[[38923]],64204:[[38971]],64205:[[39698]],64206:[[40860]],64207:[[141386]],64208:[[141380]],64209:[[144341]],64210:[[15261]],64211:[[16408]],64212:[[16441]],64213:[[152137]],64214:[[154832]],64215:[[163539]],64216:[[40771]],64217:[[40846]],195072:[[38953]],195073:[[169398]],195074:[[39138]],195075:[[19251]],195076:[[39209]],195077:[[39335]],195078:[[39362]],195079:[[39422]],195080:[[19406]],195081:[[170800]],195082:[[39698]],195083:[[4e4]],195084:[[40189]],195085:[[19662]],195086:[[19693]],195087:[[40295]],195088:[[172238]],195089:[[19704]],195090:[[172293]],195091:[[172558]],195092:[[172689]],195093:[[40635]],195094:[[19798]],195095:[[40697]],195096:[[40702]],195097:[[40709]],195098:[[40719]],195099:[[40726]],195100:[[40763]],195101:[[173568]]},64256:{64256:[[102,102],256],64257:[[102,105],256],64258:[[102,108],256],64259:[[102,102,105],256],64260:[[102,102,108],256],64261:[[383,116],256],64262:[[115,116],256],64275:[[1396,1398],256],64276:[[1396,1381],256],64277:[[1396,1387],256],64278:[[1406,1398],256],64279:[[1396,1389],256],64285:[[1497,1460],512],64286:[,26],64287:[[1522,1463],512],64288:[[1506],256],64289:[[1488],256],64290:[[1491],256],64291:[[1492],256],64292:[[1499],256],64293:[[1500],256],64294:[[1501],256],64295:[[1512],256],64296:[[1514],256],64297:[[43],256],64298:[[1513,1473],512],64299:[[1513,1474],512],64300:[[64329,1473],512],64301:[[64329,1474],512],64302:[[1488,1463],512],64303:[[1488,1464],512],64304:[[1488,1468],512],64305:[[1489,1468],512],64306:[[1490,1468],512],64307:[[1491,1468],512],64308:[[1492,1468],512],64309:[[1493,1468],512],64310:[[1494,1468],512],64312:[[1496,1468],512],64313:[[1497,1468],512],64314:[[1498,1468],512],64315:[[1499,1468],512],64316:[[1500,1468],512],64318:[[1502,1468],512],64320:[[1504,1468],512],64321:[[1505,1468],512],64323:[[1507,1468],512],64324:[[1508,1468],512],64326:[[1510,1468],512],64327:[[1511,1468],512],64328:[[1512,1468],512],64329:[[1513,1468],512],64330:[[1514,1468],512],64331:[[1493,1465],512],64332:[[1489,1471],512],64333:[[1499,1471],512],64334:[[1508,1471],512],64335:[[1488,1500],256],64336:[[1649],256],64337:[[1649],256],64338:[[1659],256],64339:[[1659],256],64340:[[1659],256],64341:[[1659],256],64342:[[1662],256],64343:[[1662],256],64344:[[1662],256],64345:[[1662],256],64346:[[1664],256],64347:[[1664],256],64348:[[1664],256],64349:[[1664],256],64350:[[1658],256],64351:[[1658],256],64352:[[1658],256],64353:[[1658],256],64354:[[1663],256],64355:[[1663],256],64356:[[1663],256],64357:[[1663],256],64358:[[1657],256],64359:[[1657],256],64360:[[1657],256],64361:[[1657],256],64362:[[1700],256],64363:[[1700],256],64364:[[1700],256],64365:[[1700],256],64366:[[1702],256],64367:[[1702],256],64368:[[1702],256],64369:[[1702],256],64370:[[1668],256],64371:[[1668],256],64372:[[1668],256],64373:[[1668],256],64374:[[1667],256],64375:[[1667],256],64376:[[1667],256],64377:[[1667],256],64378:[[1670],256],64379:[[1670],256],64380:[[1670],256],64381:[[1670],256],64382:[[1671],256],64383:[[1671],256],64384:[[1671],256],64385:[[1671],256],64386:[[1677],256],64387:[[1677],256],64388:[[1676],256],64389:[[1676],256],64390:[[1678],256],64391:[[1678],256],64392:[[1672],256],64393:[[1672],256],64394:[[1688],256],64395:[[1688],256],64396:[[1681],256],64397:[[1681],256],64398:[[1705],256],64399:[[1705],256],64400:[[1705],256],64401:[[1705],256],64402:[[1711],256],64403:[[1711],256],64404:[[1711],256],64405:[[1711],256],64406:[[1715],256],64407:[[1715],256],64408:[[1715],256],64409:[[1715],256],64410:[[1713],256],64411:[[1713],256],64412:[[1713],256],64413:[[1713],256],64414:[[1722],256],64415:[[1722],256],64416:[[1723],256],64417:[[1723],256],64418:[[1723],256],64419:[[1723],256],64420:[[1728],256],64421:[[1728],256],64422:[[1729],256],64423:[[1729],256],64424:[[1729],256],64425:[[1729],256],64426:[[1726],256],64427:[[1726],256],64428:[[1726],256],64429:[[1726],256],64430:[[1746],256],64431:[[1746],256],64432:[[1747],256],64433:[[1747],256],64467:[[1709],256],64468:[[1709],256],64469:[[1709],256],64470:[[1709],256],64471:[[1735],256],64472:[[1735],256],64473:[[1734],256],64474:[[1734],256],64475:[[1736],256],64476:[[1736],256],64477:[[1655],256],64478:[[1739],256],64479:[[1739],256],64480:[[1733],256],64481:[[1733],256],64482:[[1737],256],64483:[[1737],256],64484:[[1744],256],64485:[[1744],256],64486:[[1744],256],64487:[[1744],256],64488:[[1609],256],64489:[[1609],256],64490:[[1574,1575],256],64491:[[1574,1575],256],64492:[[1574,1749],256],64493:[[1574,1749],256],64494:[[1574,1608],256],64495:[[1574,1608],256],64496:[[1574,1735],256],64497:[[1574,1735],256],64498:[[1574,1734],256],64499:[[1574,1734],256],64500:[[1574,1736],256],64501:[[1574,1736],256],64502:[[1574,1744],256],64503:[[1574,1744],256],64504:[[1574,1744],256],64505:[[1574,1609],256],64506:[[1574,1609],256],64507:[[1574,1609],256],64508:[[1740],256],64509:[[1740],256],64510:[[1740],256],64511:[[1740],256]},64512:{64512:[[1574,1580],256],64513:[[1574,1581],256],64514:[[1574,1605],256],64515:[[1574,1609],256],64516:[[1574,1610],256],64517:[[1576,1580],256],64518:[[1576,1581],256],64519:[[1576,1582],256],64520:[[1576,1605],256],64521:[[1576,1609],256],64522:[[1576,1610],256],64523:[[1578,1580],256],64524:[[1578,1581],256],64525:[[1578,1582],256],64526:[[1578,1605],256],64527:[[1578,1609],256],64528:[[1578,1610],256],64529:[[1579,1580],256],64530:[[1579,1605],256],64531:[[1579,1609],256],64532:[[1579,1610],256],64533:[[1580,1581],256],64534:[[1580,1605],256],64535:[[1581,1580],256],64536:[[1581,1605],256],64537:[[1582,1580],256],64538:[[1582,1581],256],64539:[[1582,1605],256],64540:[[1587,1580],256],64541:[[1587,1581],256],64542:[[1587,1582],256],64543:[[1587,1605],256],64544:[[1589,1581],256],64545:[[1589,1605],256],64546:[[1590,1580],256],64547:[[1590,1581],256],64548:[[1590,1582],256],64549:[[1590,1605],256],64550:[[1591,1581],256],64551:[[1591,1605],256],64552:[[1592,1605],256],64553:[[1593,1580],256],64554:[[1593,1605],256],64555:[[1594,1580],256],64556:[[1594,1605],256],64557:[[1601,1580],256],64558:[[1601,1581],256],64559:[[1601,1582],256],64560:[[1601,1605],256],64561:[[1601,1609],256],64562:[[1601,1610],256],64563:[[1602,1581],256],64564:[[1602,1605],256],64565:[[1602,1609],256],64566:[[1602,1610],256],64567:[[1603,1575],256],64568:[[1603,1580],256],64569:[[1603,1581],256],64570:[[1603,1582],256],64571:[[1603,1604],256],64572:[[1603,1605],256],64573:[[1603,1609],256],64574:[[1603,1610],256],64575:[[1604,1580],256],64576:[[1604,1581],256],64577:[[1604,1582],256],64578:[[1604,1605],256],64579:[[1604,1609],256],64580:[[1604,1610],256],64581:[[1605,1580],256],64582:[[1605,1581],256],64583:[[1605,1582],256],64584:[[1605,1605],256],64585:[[1605,1609],256],64586:[[1605,1610],256],64587:[[1606,1580],256],64588:[[1606,1581],256],64589:[[1606,1582],256],64590:[[1606,1605],256],64591:[[1606,1609],256],64592:[[1606,1610],256],64593:[[1607,1580],256],64594:[[1607,1605],256],64595:[[1607,1609],256],64596:[[1607,1610],256],64597:[[1610,1580],256],64598:[[1610,1581],256],64599:[[1610,1582],256],64600:[[1610,1605],256],64601:[[1610,1609],256],64602:[[1610,1610],256],64603:[[1584,1648],256],64604:[[1585,1648],256],64605:[[1609,1648],256],64606:[[32,1612,1617],256],64607:[[32,1613,1617],256],64608:[[32,1614,1617],256],64609:[[32,1615,1617],256],64610:[[32,1616,1617],256],64611:[[32,1617,1648],256],64612:[[1574,1585],256],64613:[[1574,1586],256],64614:[[1574,1605],256],64615:[[1574,1606],256],64616:[[1574,1609],256],64617:[[1574,1610],256],64618:[[1576,1585],256],64619:[[1576,1586],256],64620:[[1576,1605],256],64621:[[1576,1606],256],64622:[[1576,1609],256],64623:[[1576,1610],256],64624:[[1578,1585],256],64625:[[1578,1586],256],64626:[[1578,1605],256],64627:[[1578,1606],256],64628:[[1578,1609],256],64629:[[1578,1610],256],64630:[[1579,1585],256],64631:[[1579,1586],256],64632:[[1579,1605],256],64633:[[1579,1606],256],64634:[[1579,1609],256],64635:[[1579,1610],256],64636:[[1601,1609],256],64637:[[1601,1610],256],64638:[[1602,1609],256],64639:[[1602,1610],256],64640:[[1603,1575],256],64641:[[1603,1604],256],64642:[[1603,1605],256],64643:[[1603,1609],256],64644:[[1603,1610],256],64645:[[1604,1605],256],64646:[[1604,1609],256],64647:[[1604,1610],256],64648:[[1605,1575],256],64649:[[1605,1605],256],64650:[[1606,1585],256],64651:[[1606,1586],256],64652:[[1606,1605],256],64653:[[1606,1606],256],64654:[[1606,1609],256],64655:[[1606,1610],256],64656:[[1609,1648],256],64657:[[1610,1585],256],64658:[[1610,1586],256],64659:[[1610,1605],256],64660:[[1610,1606],256],64661:[[1610,1609],256],64662:[[1610,1610],256],64663:[[1574,1580],256],64664:[[1574,1581],256],64665:[[1574,1582],256],64666:[[1574,1605],256],64667:[[1574,1607],256],64668:[[1576,1580],256],64669:[[1576,1581],256],64670:[[1576,1582],256],64671:[[1576,1605],256],64672:[[1576,1607],256],64673:[[1578,1580],256],64674:[[1578,1581],256],64675:[[1578,1582],256],64676:[[1578,1605],256],64677:[[1578,1607],256],64678:[[1579,1605],256],64679:[[1580,1581],256],64680:[[1580,1605],256],64681:[[1581,1580],256],64682:[[1581,1605],256],64683:[[1582,1580],256],64684:[[1582,1605],256],64685:[[1587,1580],256],64686:[[1587,1581],256],64687:[[1587,1582],256],64688:[[1587,1605],256],64689:[[1589,1581],256],64690:[[1589,1582],256],64691:[[1589,1605],256],64692:[[1590,1580],256],64693:[[1590,1581],256],64694:[[1590,1582],256],64695:[[1590,1605],256],64696:[[1591,1581],256],64697:[[1592,1605],256],64698:[[1593,1580],256],64699:[[1593,1605],256],64700:[[1594,1580],256],64701:[[1594,1605],256],64702:[[1601,1580],256],64703:[[1601,1581],256],64704:[[1601,1582],256],64705:[[1601,1605],256],64706:[[1602,1581],256],64707:[[1602,1605],256],64708:[[1603,1580],256],64709:[[1603,1581],256],64710:[[1603,1582],256],64711:[[1603,1604],256],64712:[[1603,1605],256],64713:[[1604,1580],256],64714:[[1604,1581],256],64715:[[1604,1582],256],64716:[[1604,1605],256],64717:[[1604,1607],256],64718:[[1605,1580],256],64719:[[1605,1581],256],64720:[[1605,1582],256],64721:[[1605,1605],256],64722:[[1606,1580],256],64723:[[1606,1581],256],64724:[[1606,1582],256],64725:[[1606,1605],256],64726:[[1606,1607],256],64727:[[1607,1580],256],64728:[[1607,1605],256],64729:[[1607,1648],256],64730:[[1610,1580],256],64731:[[1610,1581],256],64732:[[1610,1582],256],64733:[[1610,1605],256],64734:[[1610,1607],256],64735:[[1574,1605],256],64736:[[1574,1607],256],64737:[[1576,1605],256],64738:[[1576,1607],256],64739:[[1578,1605],256],64740:[[1578,1607],256],64741:[[1579,1605],256],64742:[[1579,1607],256],64743:[[1587,1605],256],64744:[[1587,1607],256],64745:[[1588,1605],256],64746:[[1588,1607],256],64747:[[1603,1604],256],64748:[[1603,1605],256],64749:[[1604,1605],256],64750:[[1606,1605],256],64751:[[1606,1607],256],64752:[[1610,1605],256],64753:[[1610,1607],256],64754:[[1600,1614,1617],256],64755:[[1600,1615,1617],256],64756:[[1600,1616,1617],256],64757:[[1591,1609],256],64758:[[1591,1610],256],64759:[[1593,1609],256],64760:[[1593,1610],256],64761:[[1594,1609],256],64762:[[1594,1610],256],64763:[[1587,1609],256],64764:[[1587,1610],256],64765:[[1588,1609],256],64766:[[1588,1610],256],64767:[[1581,1609],256]},64768:{64768:[[1581,1610],256],64769:[[1580,1609],256],64770:[[1580,1610],256],64771:[[1582,1609],256],64772:[[1582,1610],256],64773:[[1589,1609],256],64774:[[1589,1610],256],64775:[[1590,1609],256],64776:[[1590,1610],256],64777:[[1588,1580],256],64778:[[1588,1581],256],64779:[[1588,1582],256],64780:[[1588,1605],256],64781:[[1588,1585],256],64782:[[1587,1585],256],64783:[[1589,1585],256],64784:[[1590,1585],256],64785:[[1591,1609],256],64786:[[1591,1610],256],64787:[[1593,1609],256],64788:[[1593,1610],256],64789:[[1594,1609],256],64790:[[1594,1610],256],64791:[[1587,1609],256],64792:[[1587,1610],256],64793:[[1588,1609],256],64794:[[1588,1610],256],64795:[[1581,1609],256],64796:[[1581,1610],256],64797:[[1580,1609],256],64798:[[1580,1610],256],64799:[[1582,1609],256],64800:[[1582,1610],256],64801:[[1589,1609],256],64802:[[1589,1610],256],64803:[[1590,1609],256],64804:[[1590,1610],256],64805:[[1588,1580],256],64806:[[1588,1581],256],64807:[[1588,1582],256],64808:[[1588,1605],256],64809:[[1588,1585],256],64810:[[1587,1585],256],64811:[[1589,1585],256],64812:[[1590,1585],256],64813:[[1588,1580],256],64814:[[1588,1581],256],64815:[[1588,1582],256],64816:[[1588,1605],256],64817:[[1587,1607],256],64818:[[1588,1607],256],64819:[[1591,1605],256],64820:[[1587,1580],256],64821:[[1587,1581],256],64822:[[1587,1582],256],64823:[[1588,1580],256],64824:[[1588,1581],256],64825:[[1588,1582],256],64826:[[1591,1605],256],64827:[[1592,1605],256],64828:[[1575,1611],256],64829:[[1575,1611],256],64848:[[1578,1580,1605],256],64849:[[1578,1581,1580],256],64850:[[1578,1581,1580],256],64851:[[1578,1581,1605],256],64852:[[1578,1582,1605],256],64853:[[1578,1605,1580],256],64854:[[1578,1605,1581],256],64855:[[1578,1605,1582],256],64856:[[1580,1605,1581],256],64857:[[1580,1605,1581],256],64858:[[1581,1605,1610],256],64859:[[1581,1605,1609],256],64860:[[1587,1581,1580],256],64861:[[1587,1580,1581],256],64862:[[1587,1580,1609],256],64863:[[1587,1605,1581],256],64864:[[1587,1605,1581],256],64865:[[1587,1605,1580],256],64866:[[1587,1605,1605],256],64867:[[1587,1605,1605],256],64868:[[1589,1581,1581],256],64869:[[1589,1581,1581],256],64870:[[1589,1605,1605],256],64871:[[1588,1581,1605],256],64872:[[1588,1581,1605],256],64873:[[1588,1580,1610],256],64874:[[1588,1605,1582],256],64875:[[1588,1605,1582],256],64876:[[1588,1605,1605],256],64877:[[1588,1605,1605],256],64878:[[1590,1581,1609],256],64879:[[1590,1582,1605],256],64880:[[1590,1582,1605],256],64881:[[1591,1605,1581],256],64882:[[1591,1605,1581],256],64883:[[1591,1605,1605],256],64884:[[1591,1605,1610],256],64885:[[1593,1580,1605],256],64886:[[1593,1605,1605],256],64887:[[1593,1605,1605],256],64888:[[1593,1605,1609],256],64889:[[1594,1605,1605],256],64890:[[1594,1605,1610],256],64891:[[1594,1605,1609],256],64892:[[1601,1582,1605],256],64893:[[1601,1582,1605],256],64894:[[1602,1605,1581],256],64895:[[1602,1605,1605],256],64896:[[1604,1581,1605],256],64897:[[1604,1581,1610],256],64898:[[1604,1581,1609],256],64899:[[1604,1580,1580],256],64900:[[1604,1580,1580],256],64901:[[1604,1582,1605],256],64902:[[1604,1582,1605],256],64903:[[1604,1605,1581],256],64904:[[1604,1605,1581],256],64905:[[1605,1581,1580],256],64906:[[1605,1581,1605],256],64907:[[1605,1581,1610],256],64908:[[1605,1580,1581],256],64909:[[1605,1580,1605],256],64910:[[1605,1582,1580],256],64911:[[1605,1582,1605],256],64914:[[1605,1580,1582],256],64915:[[1607,1605,1580],256],64916:[[1607,1605,1605],256],64917:[[1606,1581,1605],256],64918:[[1606,1581,1609],256],64919:[[1606,1580,1605],256],64920:[[1606,1580,1605],256],64921:[[1606,1580,1609],256],64922:[[1606,1605,1610],256],64923:[[1606,1605,1609],256],64924:[[1610,1605,1605],256],64925:[[1610,1605,1605],256],64926:[[1576,1582,1610],256],64927:[[1578,1580,1610],256],64928:[[1578,1580,1609],256],64929:[[1578,1582,1610],256],64930:[[1578,1582,1609],256],64931:[[1578,1605,1610],256],64932:[[1578,1605,1609],256],64933:[[1580,1605,1610],256],64934:[[1580,1581,1609],256],64935:[[1580,1605,1609],256],64936:[[1587,1582,1609],256],64937:[[1589,1581,1610],256],64938:[[1588,1581,1610],256],64939:[[1590,1581,1610],256],64940:[[1604,1580,1610],256],64941:[[1604,1605,1610],256],64942:[[1610,1581,1610],256],64943:[[1610,1580,1610],256],64944:[[1610,1605,1610],256],64945:[[1605,1605,1610],256],64946:[[1602,1605,1610],256],64947:[[1606,1581,1610],256],64948:[[1602,1605,1581],256],64949:[[1604,1581,1605],256],64950:[[1593,1605,1610],256],64951:[[1603,1605,1610],256],64952:[[1606,1580,1581],256],64953:[[1605,1582,1610],256],64954:[[1604,1580,1605],256],64955:[[1603,1605,1605],256],64956:[[1604,1580,1605],256],64957:[[1606,1580,1581],256],64958:[[1580,1581,1610],256],64959:[[1581,1580,1610],256],64960:[[1605,1580,1610],256],64961:[[1601,1605,1610],256],64962:[[1576,1581,1610],256],64963:[[1603,1605,1605],256],64964:[[1593,1580,1605],256],64965:[[1589,1605,1605],256],64966:[[1587,1582,1610],256],64967:[[1606,1580,1610],256],65008:[[1589,1604,1746],256],65009:[[1602,1604,1746],256],65010:[[1575,1604,1604,1607],256],65011:[[1575,1603,1576,1585],256],65012:[[1605,1581,1605,1583],256],65013:[[1589,1604,1593,1605],256],65014:[[1585,1587,1608,1604],256],65015:[[1593,1604,1610,1607],256],65016:[[1608,1587,1604,1605],256],65017:[[1589,1604,1609],256],65018:[[1589,1604,1609,32,1575,1604,1604,1607,32,1593,1604,1610,1607,32,1608,1587,1604,1605],256],65019:[[1580,1604,32,1580,1604,1575,1604,1607],256],65020:[[1585,1740,1575,1604],256]},65024:{65040:[[44],256],65041:[[12289],256],65042:[[12290],256],65043:[[58],256],65044:[[59],256],65045:[[33],256],65046:[[63],256],65047:[[12310],256],65048:[[12311],256],65049:[[8230],256],65056:[,230],65057:[,230],65058:[,230],65059:[,230],65060:[,230],65061:[,230],65062:[,230],65063:[,220],65064:[,220],65065:[,220],65066:[,220],65067:[,220],65068:[,220],65069:[,220],65072:[[8229],256],65073:[[8212],256],65074:[[8211],256],65075:[[95],256],65076:[[95],256],65077:[[40],256],65078:[[41],256],65079:[[123],256],65080:[[125],256],65081:[[12308],256],65082:[[12309],256],65083:[[12304],256],65084:[[12305],256],65085:[[12298],256],65086:[[12299],256],65087:[[12296],256],65088:[[12297],256],65089:[[12300],256],65090:[[12301],256],65091:[[12302],256],65092:[[12303],256],65095:[[91],256],65096:[[93],256],65097:[[8254],256],65098:[[8254],256],65099:[[8254],256],65100:[[8254],256],65101:[[95],256],65102:[[95],256],65103:[[95],256],65104:[[44],256],65105:[[12289],256],65106:[[46],256],65108:[[59],256],65109:[[58],256],65110:[[63],256],65111:[[33],256],65112:[[8212],256],65113:[[40],256],65114:[[41],256],65115:[[123],256],65116:[[125],256],65117:[[12308],256],65118:[[12309],256],65119:[[35],256],65120:[[38],256],65121:[[42],256],65122:[[43],256],65123:[[45],256],65124:[[60],256],65125:[[62],256],65126:[[61],256],65128:[[92],256],65129:[[36],256],65130:[[37],256],65131:[[64],256],65136:[[32,1611],256],65137:[[1600,1611],256],65138:[[32,1612],256],65140:[[32,1613],256],65142:[[32,1614],256],65143:[[1600,1614],256],65144:[[32,1615],256],65145:[[1600,1615],256],65146:[[32,1616],256],65147:[[1600,1616],256],65148:[[32,1617],256],65149:[[1600,1617],256],65150:[[32,1618],256],65151:[[1600,1618],256],65152:[[1569],256],65153:[[1570],256],65154:[[1570],256],65155:[[1571],256],65156:[[1571],256],65157:[[1572],256],65158:[[1572],256],65159:[[1573],256],65160:[[1573],256],65161:[[1574],256],65162:[[1574],256],65163:[[1574],256],65164:[[1574],256],65165:[[1575],256],65166:[[1575],256],65167:[[1576],256],65168:[[1576],256],65169:[[1576],256],65170:[[1576],256],65171:[[1577],256],65172:[[1577],256],65173:[[1578],256],65174:[[1578],256],65175:[[1578],256],65176:[[1578],256],65177:[[1579],256],65178:[[1579],256],65179:[[1579],256],65180:[[1579],256],65181:[[1580],256],65182:[[1580],256],65183:[[1580],256],65184:[[1580],256],65185:[[1581],256],65186:[[1581],256],65187:[[1581],256],65188:[[1581],256],65189:[[1582],256],65190:[[1582],256],65191:[[1582],256],65192:[[1582],256],65193:[[1583],256],65194:[[1583],256],65195:[[1584],256],65196:[[1584],256],65197:[[1585],256],65198:[[1585],256],65199:[[1586],256],65200:[[1586],256],65201:[[1587],256],65202:[[1587],256],65203:[[1587],256],65204:[[1587],256],65205:[[1588],256],65206:[[1588],256],65207:[[1588],256],65208:[[1588],256],65209:[[1589],256],65210:[[1589],256],65211:[[1589],256],65212:[[1589],256],65213:[[1590],256],65214:[[1590],256],65215:[[1590],256],65216:[[1590],256],65217:[[1591],256],65218:[[1591],256],65219:[[1591],256],65220:[[1591],256],65221:[[1592],256],65222:[[1592],256],65223:[[1592],256],65224:[[1592],256],65225:[[1593],256],65226:[[1593],256],65227:[[1593],256],65228:[[1593],256],65229:[[1594],256],65230:[[1594],256],65231:[[1594],256],65232:[[1594],256],65233:[[1601],256],65234:[[1601],256],65235:[[1601],256],65236:[[1601],256],65237:[[1602],256],65238:[[1602],256],65239:[[1602],256],65240:[[1602],256],65241:[[1603],256],65242:[[1603],256],65243:[[1603],256],65244:[[1603],256],65245:[[1604],256],65246:[[1604],256],65247:[[1604],256],65248:[[1604],256],65249:[[1605],256],65250:[[1605],256],65251:[[1605],256],65252:[[1605],256],65253:[[1606],256],65254:[[1606],256],65255:[[1606],256],65256:[[1606],256],65257:[[1607],256],65258:[[1607],256],65259:[[1607],256],65260:[[1607],256],65261:[[1608],256],65262:[[1608],256],65263:[[1609],256],65264:[[1609],256],65265:[[1610],256],65266:[[1610],256],65267:[[1610],256],65268:[[1610],256],65269:[[1604,1570],256],65270:[[1604,1570],256],65271:[[1604,1571],256],65272:[[1604,1571],256],65273:[[1604,1573],256],65274:[[1604,1573],256],65275:[[1604,1575],256],65276:[[1604,1575],256]},65280:{65281:[[33],256],65282:[[34],256],65283:[[35],256],65284:[[36],256],65285:[[37],256],65286:[[38],256],65287:[[39],256],65288:[[40],256],65289:[[41],256],65290:[[42],256],65291:[[43],256],65292:[[44],256],65293:[[45],256],65294:[[46],256],65295:[[47],256],65296:[[48],256],65297:[[49],256],65298:[[50],256],65299:[[51],256],65300:[[52],256],65301:[[53],256],65302:[[54],256],65303:[[55],256],65304:[[56],256],65305:[[57],256],65306:[[58],256],65307:[[59],256],65308:[[60],256],65309:[[61],256],65310:[[62],256],65311:[[63],256],65312:[[64],256],65313:[[65],256],65314:[[66],256],65315:[[67],256],65316:[[68],256],65317:[[69],256],65318:[[70],256],65319:[[71],256],65320:[[72],256],65321:[[73],256],65322:[[74],256],65323:[[75],256],65324:[[76],256],65325:[[77],256],65326:[[78],256],65327:[[79],256],65328:[[80],256],65329:[[81],256],65330:[[82],256],65331:[[83],256],65332:[[84],256],65333:[[85],256],65334:[[86],256],65335:[[87],256],65336:[[88],256],65337:[[89],256],65338:[[90],256],65339:[[91],256],65340:[[92],256],65341:[[93],256],65342:[[94],256],65343:[[95],256],65344:[[96],256],65345:[[97],256],65346:[[98],256],65347:[[99],256],65348:[[100],256],65349:[[101],256],65350:[[102],256],65351:[[103],256],65352:[[104],256],65353:[[105],256],65354:[[106],256],65355:[[107],256],65356:[[108],256],65357:[[109],256],65358:[[110],256],65359:[[111],256],65360:[[112],256],65361:[[113],256],65362:[[114],256],65363:[[115],256],65364:[[116],256],65365:[[117],256],65366:[[118],256],65367:[[119],256],65368:[[120],256],65369:[[121],256],65370:[[122],256],65371:[[123],256],65372:[[124],256],65373:[[125],256],65374:[[126],256],65375:[[10629],256],65376:[[10630],256],65377:[[12290],256],65378:[[12300],256],65379:[[12301],256],65380:[[12289],256],65381:[[12539],256],65382:[[12530],256],65383:[[12449],256],65384:[[12451],256],65385:[[12453],256],65386:[[12455],256],65387:[[12457],256],65388:[[12515],256],65389:[[12517],256],65390:[[12519],256],65391:[[12483],256],65392:[[12540],256],65393:[[12450],256],65394:[[12452],256],65395:[[12454],256],65396:[[12456],256],65397:[[12458],256],65398:[[12459],256],65399:[[12461],256],65400:[[12463],256],65401:[[12465],256],65402:[[12467],256],65403:[[12469],256],65404:[[12471],256],65405:[[12473],256],65406:[[12475],256],65407:[[12477],256],65408:[[12479],256],65409:[[12481],256],65410:[[12484],256],65411:[[12486],256],65412:[[12488],256],65413:[[12490],256],65414:[[12491],256],65415:[[12492],256],65416:[[12493],256],65417:[[12494],256],65418:[[12495],256],65419:[[12498],256],65420:[[12501],256],65421:[[12504],256],65422:[[12507],256],65423:[[12510],256],65424:[[12511],256],65425:[[12512],256],65426:[[12513],256],65427:[[12514],256],65428:[[12516],256],65429:[[12518],256],65430:[[12520],256],65431:[[12521],256],65432:[[12522],256],65433:[[12523],256],65434:[[12524],256],65435:[[12525],256],65436:[[12527],256],65437:[[12531],256],65438:[[12441],256],65439:[[12442],256],65440:[[12644],256],65441:[[12593],256],65442:[[12594],256],65443:[[12595],256],65444:[[12596],256],65445:[[12597],256],65446:[[12598],256],65447:[[12599],256],65448:[[12600],256],65449:[[12601],256],65450:[[12602],256],65451:[[12603],256],65452:[[12604],256],65453:[[12605],256],65454:[[12606],256],65455:[[12607],256],65456:[[12608],256],65457:[[12609],256],65458:[[12610],256],65459:[[12611],256],65460:[[12612],256],65461:[[12613],256],65462:[[12614],256],65463:[[12615],256],65464:[[12616],256],65465:[[12617],256],65466:[[12618],256],65467:[[12619],256],65468:[[12620],256],65469:[[12621],256],65470:[[12622],256],65474:[[12623],256],65475:[[12624],256],65476:[[12625],256],65477:[[12626],256],65478:[[12627],256],65479:[[12628],256],65482:[[12629],256],65483:[[12630],256],65484:[[12631],256],65485:[[12632],256],65486:[[12633],256],65487:[[12634],256],65490:[[12635],256],65491:[[12636],256],65492:[[12637],256],65493:[[12638],256],65494:[[12639],256],65495:[[12640],256],65498:[[12641],256],65499:[[12642],256],65500:[[12643],256],65504:[[162],256],65505:[[163],256],65506:[[172],256],65507:[[175],256],65508:[[166],256],65509:[[165],256],65510:[[8361],256],65512:[[9474],256],65513:[[8592],256],65514:[[8593],256],65515:[[8594],256],65516:[[8595],256],65517:[[9632],256],65518:[[9675],256]}};var h={nfc:function(e){return f("NFC",e)},nfd:function(e){return f("NFD",e)},nfkc:function(e){return f("NFKC",e)},nfkd:function(e){return f("NFKD",e)}};e.exports=h,h.shimApplied=!1,String.prototype.normalize||(Object.defineProperty(String.prototype,"normalize",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=""+this,t=void 0===arguments[0]?"NFC":arguments[0];if(null==this)throw new TypeError("Cannot call method on "+Object.prototype.toString.call(this));if("NFC"===t)return h.nfc(e);if("NFD"===t)return h.nfd(e);if("NFKC"===t)return h.nfkc(e);if("NFKD"===t)return h.nfkd(e);throw new RangeError("Invalid normalization form: "+t)}}),h.shimApplied=!0)}()}(unorm$1);var unorm=unorm$1.exports;
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function collatorFromConfig(e){var t=e.caseSensitive?e.accentSensitive?"variant":"case":e.accentSensitive?"accent":"base",n=e.caseFirst,r=e.ignorePunctuation;return new Intl.Collator(e.localeLang,{sensitivity:t,caseFirst:n,ignorePunctuation:r})}function _typeof$Y(e){return _typeof$Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$Y(e)}function _inherits$U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$V(e,t)}function _setPrototypeOf$V(e,t){return _setPrototypeOf$V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$V(e,t)}function _createSuper$U(e){var t=_isNativeReflectConstruct$V();return function(){var n,r=_getPrototypeOf$U(e);if(t){var a=_getPrototypeOf$U(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$U(this,n)}}function _possibleConstructorReturn$U(e,t){if(t&&("object"===_typeof$Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$U(e)}function _assertThisInitialized$U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$V(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$U(e){return _getPrototypeOf$U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$U(e)}function _classCallCheck$1C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1C(e,t,n){return t&&_defineProperties$1C(e.prototype,t),n&&_defineProperties$1C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var EmptyValue=Symbol("Empty value");function getRawValue(e){return e instanceof RichNumber?e.val:e}var RichNumber=function(){function e(t,n){_classCallCheck$1C(this,e),this.val=t,this.format=n}return _createClass$1C(e,[{key:"fromNumber",value:function(e){return new this.constructor(e)}}]),e}();function cloneNumber(e,t){if("number"==typeof e)return t;var n=e.fromNumber(t);return n.format=e.format,n}var DateNumber=function(e){_inherits$U(n,e);var t=_createSuper$U(n);function n(){return _classCallCheck$1C(this,n),t.apply(this,arguments)}return _createClass$1C(n,[{key:"getDetailedType",value:function(){return NumberType.NUMBER_DATE}}]),n}(RichNumber),CurrencyNumber=function(e){_inherits$U(n,e);var t=_createSuper$U(n);function n(){return _classCallCheck$1C(this,n),t.apply(this,arguments)}return _createClass$1C(n,[{key:"getDetailedType",value:function(){return NumberType.NUMBER_CURRENCY}}]),n}(RichNumber),TimeNumber=function(e){_inherits$U(n,e);var t=_createSuper$U(n);function n(){return _classCallCheck$1C(this,n),t.apply(this,arguments)}return _createClass$1C(n,[{key:"getDetailedType",value:function(){return NumberType.NUMBER_TIME}}]),n}(RichNumber),DateTimeNumber=function(e){_inherits$U(n,e);var t=_createSuper$U(n);function n(){return _classCallCheck$1C(this,n),t.apply(this,arguments)}return _createClass$1C(n,[{key:"getDetailedType",value:function(){return NumberType.NUMBER_DATETIME}}]),n}(RichNumber),PercentNumber=function(e){_inherits$U(n,e);var t=_createSuper$U(n);function n(){return _classCallCheck$1C(this,n),t.apply(this,arguments)}return _createClass$1C(n,[{key:"getDetailedType",value:function(){return NumberType.NUMBER_PERCENT}}]),n}(RichNumber),NumberType;function isExtendedNumber(e){return"number"==typeof e||e instanceof RichNumber}function getTypeOfExtendedNumber(e){return e instanceof RichNumber?e.getDetailedType():NumberType.NUMBER_RAW}function getFormatOfExtendedNumber(e){return e instanceof RichNumber?e.format:void 0}function getTypeFormatOfExtendedNumber(e){return e instanceof RichNumber?{type:e.getDetailedType(),format:e.format}:{type:NumberType.NUMBER_RAW}}function _slicedToArray$r(e,t){return _arrayWithHoles$r(e)||_iterableToArrayLimit$r(e,t)||_unsupportedIterableToArray$N(e,t)||_nonIterableRest$r()}function _nonIterableRest$r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$r(e){if(Array.isArray(e))return e}function _toConsumableArray$e(e){return _arrayWithoutHoles$e(e)||_iterableToArray$e(e)||_unsupportedIterableToArray$N(e)||_nonIterableSpread$e()}function _nonIterableSpread$e(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$e(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$e(e){if(Array.isArray(e))return _arrayLikeToArray$N(e)}function _createForOfIteratorHelper$D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$N(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$N(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$N(e,t):void 0}}function _arrayLikeToArray$N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1B(e,t,n){return t&&_defineProperties$1B(e.prototype,t),n&&_defineProperties$1B(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.NUMBER_RAW="NUMBER_RAW",e.NUMBER_DATE="NUMBER_DATE",e.NUMBER_TIME="NUMBER_TIME",e.NUMBER_DATETIME="NUMBER_DATETIME",e.NUMBER_CURRENCY="NUMBER_CURRENCY",e.NUMBER_PERCENT="NUMBER_PERCENT"}(NumberType||(NumberType={}));var COMPLEX_NUMBER_SYMBOL="i",complexParsingRegexp=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/,ArithmeticHelper=function(){function e(t,n,r){var a=this;_classCallCheck$1B(this,e),this.config=t,this.dateTimeHelper=n,this.numberLiteralsHelper=r,this.lt=function(e,t){return a.compare(e,t)<0},this.leq=function(e,t){return a.compare(e,t)<=0},this.gt=function(e,t){return a.compare(e,t)>0},this.geq=function(e,t){return a.compare(e,t)>=0},this.eq=function(e,t){return 0===a.compare(e,t)},this.neq=function(e,t){return 0!==a.compare(e,t)},this.pow=function(e,t){return Math.pow(getRawValue(e),getRawValue(t))},this.addWithEpsilonRaw=function(e,t){var n=e+t;return Math.abs(n)<a.actualEps*Math.abs(e)?0:n},this.addWithEpsilon=function(e,t){var n=inferExtendedNumberTypeAdditive(e,t);return a.ExtendedNumberFactory(a.addWithEpsilonRaw(getRawValue(e),getRawValue(t)),n)},this.unaryMinus=function(e){return cloneNumber(e,-getRawValue(e))},this.unaryPlus=function(e){return e},this.unaryPercent=function(e){return new PercentNumber(getRawValue(e)/100)},this.concat=function(e,t){return e.concat(t)},this.nonstrictadd=function(e,t){return e instanceof CellError?e:t instanceof CellError?t:"number"==typeof e?"number"==typeof t?a.addWithEpsilonRaw(e,t):e:"number"==typeof t?t:0},this.subtract=function(e,t){var n=inferExtendedNumberTypeAdditive(e,t),r=getRawValue(e),i=r-getRawValue(t);return Math.abs(i)<a.actualEps*Math.abs(r)&&(i=0),a.ExtendedNumberFactory(i,n)},this.divide=function(e,t){var n=getRawValue(e),r=getRawValue(t);if(0===r)return new CellError(ErrorType.DIV_BY_ZERO);var i=inferExtendedNumberTypeMultiplicative(e,t);return a.ExtendedNumberFactory(n/r,i)},this.multiply=function(e,t){var n=inferExtendedNumberTypeMultiplicative(e,t);return a.ExtendedNumberFactory(getRawValue(e)*getRawValue(t),n)},this.manyToExactComplex=function(e){var t,n=[],r=_createForOfIteratorHelper$D(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i instanceof CellError)return i;if(isExtendedNumber(i)||"string"==typeof i){var o=a.coerceScalarToComplex(i);o instanceof CellError||n.push(o)}}}catch(e){r.e(e)}finally{r.f()}return n},this.coerceNumbersExactRanges=function(e){return a.manyToNumbers(e,a.manyToExactNumbers)},this.coerceNumbersCoerceRangesDropNulls=function(e){return a.manyToNumbers(e,a.manyToCoercedNumbersDropNulls)},this.manyToExactNumbers=function(e){var t,n=[],r=_createForOfIteratorHelper$D(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a instanceof CellError)return a;isExtendedNumber(a)&&n.push(getRawValue(a))}}catch(e){r.e(e)}finally{r.f()}return n},this.manyToOnlyNumbersDropNulls=function(e){var t,n=[],r=_createForOfIteratorHelper$D(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a instanceof CellError)return a;if(isExtendedNumber(a))n.push(getRawValue(a));else if(a!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}}catch(e){r.e(e)}finally{r.f()}return n},this.manyToCoercedNumbersDropNulls=function(e){var t,n=[],r=_createForOfIteratorHelper$D(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i instanceof CellError)return i;if(i!==EmptyValue){var o=a.coerceScalarToNumberOrError(i);isExtendedNumber(o)&&n.push(getRawValue(o))}}}catch(e){r.e(e)}finally{r.f()}return n},this.collator=collatorFromConfig(t),this.actualEps=t.smartRounding?t.precisionEpsilon:0}return _createClass$1B(e,[{key:"eqMatcherFunction",value:function(e){var t=this,n=this.buildRegex(e);return function(e){return"string"==typeof e&&n.test(t.normalizeString(e))}}},{key:"neqMatcherFunction",value:function(e){var t=this,n=this.buildRegex(e);return function(e){return!("string"==typeof e&&n.test(t.normalizeString(e)))}}},{key:"searchString",value:function(e,t){var n,r=this.buildRegex(e,!1).exec(t);return null!==(n=null==r?void 0:r.index)&&void 0!==n?n:-1}},{key:"requiresRegex",value:function(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(var t=0;t<e.length;t++){var n=e.charAt(t);if(isWildcard(n)||this.config.useRegularExpressions&&needsEscape(n))return!0}return!1}},{key:"floatCmp",value:function(e,t){var n=getRawValue(e),r=getRawValue(t),a=1+this.actualEps;return r>=0&&n*a>=r&&n<=r*a||r<=0&&n*a<=r&&n>=r*a?0:n>r?1:-1}},{key:"coerceScalarToNumberOrError",value:function(e){var t;return e instanceof CellError?e:null!==(t=this.coerceToMaybeNumber(e))&&void 0!==t?t:new CellError(ErrorType.VALUE,ErrorMessage.NumberCoercion)}},{key:"coerceToMaybeNumber",value:function(e){var t;return null!==(t=this.coerceNonDateScalarToMaybeNumber(e))&&void 0!==t?t:"string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):void 0}},{key:"coerceNonDateScalarToMaybeNumber",value:function(e){return e===EmptyValue?0:"string"==typeof e?""===e?0:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim()):isExtendedNumber(e)?e:"boolean"==typeof e?Number(e):void 0}},{key:"coerceComplexExactRanges",value:function(e){var t,n=[],r=_createForOfIteratorHelper$D(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a instanceof SimpleRangeValue)n.push(a);else if(a!==EmptyValue){var i=this.coerceScalarToComplex(a);if(i instanceof CellError)return i;n.push(i)}}}catch(e){r.e(e)}finally{r.f()}for(var o=[],s=0,l=n;s<l.length;s++){var u=l[s];if(u instanceof SimpleRangeValue){var c=this.manyToExactComplex(u.valuesFromTopLeftCorner());if(c instanceof CellError)return c;o.push.apply(o,_toConsumableArray$e(c))}else o.push(u)}return o}},{key:"coerceScalarToComplex",value:function(e){return e instanceof CellError?e:e===EmptyValue?[0,0]:isExtendedNumber(e)?[getRawValue(e),0]:"string"==typeof e?this.coerceStringToComplex(e):new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected)}},{key:"ExtendedNumberFactory",value:function(e,t){var n=t.type,r=t.format;switch(n){case NumberType.NUMBER_RAW:return e;case NumberType.NUMBER_CURRENCY:return new CurrencyNumber(e,null!=r?r:this.config.currencySymbol[0]);case NumberType.NUMBER_DATE:return new DateNumber(e,r);case NumberType.NUMBER_DATETIME:return new DateTimeNumber(e,r);case NumberType.NUMBER_TIME:return new TimeNumber(e,r);case NumberType.NUMBER_PERCENT:return new PercentNumber(e,r)}}},{key:"buildRegex",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=this.normalizeString(e);var r=this.config.useWildcards,a=this.config.useRegularExpressions;if(a)try{RegExp(e)}catch(e){a=!1,r=!1}return t=a?escapeNoCharacters(e,this.config.caseSensitive):r?escapeNonWildcards(e,this.config.caseSensitive):escapeAllCharacters(e,this.config.caseSensitive),this.config.matchWholeCell&&n?RegExp("^("+t+")$"):RegExp(t)}},{key:"normalizeString",value:function(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=_normalizeString(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}},{key:"compare",value:function(e,t){if("string"==typeof e||"string"==typeof t){var n="string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):e,r="string"==typeof t?this.dateTimeHelper.dateStringToDateNumber(t):t;if(isExtendedNumber(n)&&isExtendedNumber(r))return this.floatCmp(n,r)}return e===EmptyValue?e=coerceEmptyToValue(t):t===EmptyValue&&(t=coerceEmptyToValue(e)),"string"==typeof e&&"string"==typeof t?this.stringCmp(e,t):"boolean"==typeof e&&"boolean"==typeof t?numberCmp(coerceBooleanToNumber(e),coerceBooleanToNumber(t)):isExtendedNumber(e)&&isExtendedNumber(t)?this.floatCmp(e,t):e===EmptyValue&&t===EmptyValue?0:numberCmp(CellValueTypeOrd(getCellValueType(e)),CellValueTypeOrd(getCellValueType(t)))}},{key:"stringCmp",value:function(e,t){return this.collator.compare(e,t)}},{key:"manyToNumbers",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper$D(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i instanceof SimpleRangeValue)r.push(i);else{var o=getRawValue(this.coerceScalarToNumberOrError(i));if(o instanceof CellError)return o;r.push(o)}}}catch(e){a.e(e)}finally{a.f()}for(var s=[],l=0,u=r;l<u.length;l++){var c=u[l];if(c instanceof SimpleRangeValue){var p=t(c.valuesFromTopLeftCorner());if(p instanceof CellError)return p;s.push.apply(s,_toConsumableArray$e(p))}else s.push(c)}return s}},{key:"coerceStringToComplex",value:function(e){var t,n,r=complexParsingRegexp.exec(e);return null===r?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):(t=void 0!==r[6]?"-"===r[1]?[0,-1]:[0,1]:this.parseComplexToken(r[1]+r[3],r[5]))instanceof CellError||void 0===r[8]?t:(n=void 0!==r[14]?"-"===r[9]?[0,-1]:[0,1]:this.parseComplexToken(r[9]+r[11],r[13]))instanceof CellError?n:""!==r[5]||""===r[13]?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):"+"===r[8]?[t[0]+n[0],t[1]+n[1]]:[t[0]-n[0],t[1]-n[1]]}},{key:"parseComplexToken",value:function(e,t){var n=getRawValue(this.coerceNonDateScalarToMaybeNumber(e));return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.ComplexNumberExpected):""===t?[n,0]:[0,n]}}]),e}();function coerceComplexToString(e,t){var n=_slicedToArray$r(e,2),r=n[0],a=n[1];if(!isFinite(r)||!isFinite(a))return new CellError(ErrorType.NUM,ErrorMessage.NaN);if(t=null!=t?t:COMPLEX_NUMBER_SYMBOL,0===a)return"".concat(r);var i="".concat(-1===a||1===a?"":Math.abs(a)).concat(t);return 0===r?"".concat(a<0?"-":"").concat(i):"".concat(r).concat(a<0?"-":"+").concat(i)}function coerceToRange(e){return e instanceof SimpleRangeValue?e:SimpleRangeValue.fromScalar(e)}function coerceBooleanToNumber(e){return Number(e)}function coerceEmptyToValue(e){return"string"==typeof e?"":isExtendedNumber(e)?0:"boolean"!=typeof e&&EmptyValue}function coerceScalarToBoolean(e){if(e instanceof CellError||"boolean"==typeof e)return e;if(e===EmptyValue)return!1;if(isExtendedNumber(e))return 0!==getRawValue(e);var t=e.toUpperCase();return"TRUE"===t||"FALSE"!==t&&(""!==t&&void 0)}function coerceScalarToString(e){return e instanceof CellError||"string"==typeof e?e:e===EmptyValue?"":isExtendedNumber(e)?getRawValue(e).toString():e?"TRUE":"FALSE"}function zeroIfEmpty(e){return e===EmptyValue?0:e}function numberCmp(e,t){var n=getRawValue(e),r=getRawValue(t);return n>r?1:n<r?-1:0}function isNumberOverflow(e){return isNaN(e)||e===1/0||e===-1/0}function fixNegativeZero(e){return 0===e?0:e}function isWildcard(e){return["*","?"].includes(e)}var escapedCharacters=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"],ArgumentTypes;function needsEscape(e){return escapedCharacters.includes(e)}function escapeNonWildcards(e,t){for(var n="",r=0;r<e.length;r++){var a=e.charAt(r);if("~"===a){if(r==e.length-1){n+="~";continue}var i=e.charAt(r+1);isWildcard(i)||needsEscape(i)?(n+="\\"+i,r++):(n+=i,r++)}else isWildcard(a)?n+="."+a:needsEscape(a)?n+="\\"+a:n+=t?a:a.toLowerCase()}return n}function escapeAllCharacters(e,t){for(var n="",r=0;r<e.length;r++){var a=e.charAt(r);isWildcard(a)||needsEscape(a)?n+="\\"+a:n+=t?a:a.toLowerCase()}return n}function escapeNoCharacters(e,t){for(var n="",r=0;r<e.length;r++){var a=e.charAt(r);isWildcard(a)||needsEscape(a)?n+=a:n+=t?a:a.toLowerCase()}return n}function inferExtendedNumberTypeAdditive(e,t){var n=getTypeFormatOfExtendedNumber(e),r=n.type,a=n.format,i=getTypeFormatOfExtendedNumber(t),o=i.type,s=i.format;if(r===NumberType.NUMBER_RAW)return{type:o,format:s};if(o===NumberType.NUMBER_RAW)return{type:r,format:a};if(!(r!==NumberType.NUMBER_DATETIME&&r!==NumberType.NUMBER_DATE||o!==NumberType.NUMBER_DATETIME&&o!==NumberType.NUMBER_DATE))return{type:NumberType.NUMBER_RAW};if(r===NumberType.NUMBER_TIME){if(o===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:s+" "+a};if(o===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:s}}if(o===NumberType.NUMBER_TIME){if(r===NumberType.NUMBER_DATE)return{type:NumberType.NUMBER_DATETIME,format:a+" "+s};if(r===NumberType.NUMBER_DATETIME)return{type:NumberType.NUMBER_DATETIME,format:a}}return{type:r,format:a}}function inferExtendedNumberTypeMultiplicative(e,t){var n=getTypeFormatOfExtendedNumber(e),r=n.type,a=n.format,i=getTypeFormatOfExtendedNumber(t),o=i.type,s=i.format;return r===NumberType.NUMBER_PERCENT&&(r=NumberType.NUMBER_RAW,a=void 0),o===NumberType.NUMBER_PERCENT&&(o=NumberType.NUMBER_RAW,s=void 0),r===NumberType.NUMBER_RAW?{type:o,format:s}:o===NumberType.NUMBER_RAW?{type:r,format:a}:{type:NumberType.NUMBER_RAW}}function forceNormalizeString(e){return _normalizeString(e.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")}function coerceRangeToScalar(e,t){var n;if(e.isAdHoc())return null===(n=e.data[0])||void 0===n?void 0:n[0];var r=e.range;if(t.formulaAddress.sheet===r.sheet)if(1===r.width()){var a=t.formulaAddress.row-r.start.row;if(a>=0&&a<r.height())return e.data[a][0]}else if(1===r.height()){var i=t.formulaAddress.col-r.start.col;if(i>=0&&i<r.width())return e.data[0][i]}}function _normalizeString(e,t){return"function"==typeof e.normalize?e.normalize(t.toUpperCase()):unorm[t](e)}function _createForOfIteratorHelper$C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$M(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray$q(e,t){return _arrayWithHoles$q(e)||_iterableToArrayLimit$q(e,t)||_unsupportedIterableToArray$M(e,t)||_nonIterableRest$q()}function _nonIterableRest$q(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$q(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$q(e){if(Array.isArray(e))return e}function _toConsumableArray$d(e){return _arrayWithoutHoles$d(e)||_iterableToArray$d(e)||_unsupportedIterableToArray$M(e)||_nonIterableSpread$d()}function _nonIterableSpread$d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$M(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$M(e,t):void 0}}function _iterableToArray$d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$d(e){if(Array.isArray(e))return _arrayLikeToArray$M(e)}function _arrayLikeToArray$M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1A(e,t,n){return t&&_defineProperties$1A(e.prototype,t),n&&_defineProperties$1A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.BOOLEAN="BOOLEAN",e.SCALAR="SCALAR",e.NOERROR="NOERROR",e.RANGE="RANGE",e.INTEGER="INTEGER",e.COMPLEX="COMPLEX",e.ANY="ANY"}(ArgumentTypes||(ArgumentTypes={}));var FunctionPlugin=function(){function e(t){var n=this;_classCallCheck$1A(this,e),this.coerceScalarToNumberOrError=function(e){return n.arithmeticHelper.coerceScalarToNumberOrError(e)},this.runFunction=function(e,t,r,a){var i,o,s,l,u,c,p=r.parameters;if(c=r.expandRanges?n.listOfScalarValues(e,t):e.map((function(e){return[n.evaluateAst(e,t),!1]})),void 0===r.repeatLastArgs&&p.length<c.length)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(void 0!==r.repeatLastArgs&&p.length<c.length&&(c.length-p.length)%r.repeatLastArgs!=0)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);for(p=_toConsumableArray$d(p);p.length<c.length;){var d;(d=p).push.apply(d,_toConsumableArray$d(p.slice(p.length-r.repeatLastArgs)))}var m=1,f=1;if(!r.vectorizationForbidden&&t.arraysFlag)for(var h=0;h<c.length;h++){var y=_slicedToArray$q(c[h],1)[0];y instanceof SimpleRangeValue&&p[h].argumentType!==ArgumentTypes.RANGE&&p[h].argumentType!==ArgumentTypes.ANY&&(f=Math.max(f,y.height()),m=Math.max(m,y.width()))}for(var b=c.length;b<p.length;b++)if(void 0===(null===(i=p[b])||void 0===i?void 0:i.defaultValue)&&!(null===(o=p[b])||void 0===o?void 0:o.optionalArg))return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);for(var g=[],v=0;v<f;v++){for(var T=[],C=0;C<m;C++){for(var N=void 0,A=[],S=0;S<p.length;S++){var w=_slicedToArray$q(null!==(s=c[S])&&void 0!==s?s:[void 0,void 0],2),x=w[0],V=w[1];x instanceof SimpleRangeValue&&p[S].argumentType!==ArgumentTypes.RANGE&&p[S].argumentType!==ArgumentTypes.ANY&&!r.vectorizationForbidden&&t.arraysFlag&&(x=null===(l=x.data[1!==x.height()?v:0])||void 0===l?void 0:l[1!==x.width()?C:0]);var E=null!=x?x:null===(u=p[S])||void 0===u?void 0:u.defaultValue;if(void 0===E)A.push(void 0);else{var $=void 0!==x?n.coerceToType(E,p[S],t):E;void 0!==$?($ instanceof CellError&&p[S].argumentType!==ArgumentTypes.SCALAR&&(N=null!=N?N:$),A.push($)):V||(N=null!=N?N:new CellError(ErrorType.VALUE,ErrorMessage.WrongType))}}var _=null!=N?N:n.returnNumberWrapper(a.apply(void 0,A),r.returnNumberType);if(1===f&&1===m)return _;if(_ instanceof SimpleRangeValue)throw"Function returning array cannot be vectorized.";T.push(_)}g.push(T)}return SimpleRangeValue.onlyValues(g)},this.runFunctionWithReferenceArgument=function(e,t,r,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return new CellError(ErrorType.NA,ErrorMessage.CellRefExpected)};if(0===e.length)return n.returnNumberWrapper(a(),r.returnNumberType);if(e.length>1)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);for(var s,l=e[0];l.type===AstNodeType.PARENTHESIS;)l=l.expression;if(l.type===AstNodeType.CELL_REFERENCE)s=l.reference.toSimpleCellAddress(t.formulaAddress);else if(l.type===AstNodeType.CELL_RANGE||l.type===AstNodeType.COLUMN_RANGE||l.type===AstNodeType.ROW_RANGE)try{s=AbsoluteCellRange.fromAst(l,t.formulaAddress).start}catch(e){return new CellError(ErrorType.REF,ErrorMessage.CellRefExpected)}return void 0!==s?n.returnNumberWrapper(i(s),r.returnNumberType):n.runFunction(e,t,r,o)},this.interpreter=t,this.dependencyGraph=t.dependencyGraph,this.columnSearch=t.columnSearch,this.config=t.config,this.serialization=t.serialization,this.arraySizePredictor=t.arraySizePredictor,this.dateTimeHelper=t.dateTimeHelper,this.arithmeticHelper=t.arithmeticHelper}return _createClass$1A(e,[{key:"evaluateAst",value:function(e,t){return this.interpreter.evaluateAst(e,t)}},{key:"arraySizeForAst",value:function(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}},{key:"listOfScalarValues",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper$C(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=this.evaluateAst(i,t);if(o instanceof SimpleRangeValue){var s,l=_createForOfIteratorHelper$C(o.valuesFromTopLeftCorner());try{for(l.s();!(s=l.n()).done;){var u=s.value;r.push([u,!0])}}catch(e){l.e(e)}finally{l.f()}}else r.push([o,!1])}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"coerceToType",value:function(e,t,n){var r;if(e instanceof SimpleRangeValue)switch(t.argumentType){case ArgumentTypes.RANGE:case ArgumentTypes.ANY:r=e;break;default:var a=coerceRangeToScalar(e,n);if(void 0===a)return;e=a}if(!(e instanceof SimpleRangeValue))switch(t.argumentType){case ArgumentTypes.INTEGER:case ArgumentTypes.NUMBER:var i=this.coerceScalarToNumberOrError(e);if(!isExtendedNumber(i)){r=i;break}var o=getRawValue(i);if(void 0!==t.maxValue&&o>t.maxValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(void 0!==t.minValue&&o<t.minValue)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(void 0!==t.lessThan&&o>=t.lessThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueLarge);if(void 0!==t.greaterThan&&o<=t.greaterThan)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);if(t.argumentType===ArgumentTypes.INTEGER&&!Number.isInteger(o))return new CellError(ErrorType.NUM,ErrorMessage.IntegerExpected);r=i;break;case ArgumentTypes.STRING:r=coerceScalarToString(e);break;case ArgumentTypes.BOOLEAN:r=coerceScalarToBoolean(e);break;case ArgumentTypes.SCALAR:case ArgumentTypes.NOERROR:case ArgumentTypes.ANY:r=e;break;case ArgumentTypes.RANGE:if(e instanceof CellError)return e;r=coerceToRange(e);break;case ArgumentTypes.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex(getRawValue(e))}return t.passSubtype||void 0===r?r:getRawValue(r)}},{key:"metadata",value:function(e){var t=this.constructor.implementedFunctions[e];if(void 0!==t)return t;throw new Error("No metadata for function ".concat(e,"."))}},{key:"returnNumberWrapper",value:function(e,t,n){return void 0!==t&&isExtendedNumber(e)?this.arithmeticHelper.ExtendedNumberFactory(getRawValue(e),{type:t,format:n}):e}}]),e}();function _toConsumableArray$c(e){return _arrayWithoutHoles$c(e)||_iterableToArray$c(e)||_unsupportedIterableToArray$L(e)||_nonIterableSpread$c()}function _nonIterableSpread$c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$c(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$c(e){if(Array.isArray(e))return _arrayLikeToArray$L(e)}function _createForOfIteratorHelper$B(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$L(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$L(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$L(e,t):void 0}}function _arrayLikeToArray$L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1z(e,t,n){return t&&_defineProperties$1z(e.prototype,t),n&&_defineProperties$1z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ArraySize=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(_classCallCheck$1z(this,e),this.width=t,this.height=n,this.isRef=r,t<=0||n<=0)throw Error("Incorrect array size")}return _createClass$1z(e,[{key:"isScalar",value:function(){return this.width<=1&&this.height<=1||this.isRef}}],[{key:"fromArray",value:function(t){return new e(t.length>0?t[0].length:0,t.length)}},{key:"error",value:function(){return new e(1,1,!0)}},{key:"scalar",value:function(){return new e(1,1,!1)}}]),e}();function arraySizeForBinaryOp(e,t){return new ArraySize(Math.max(e.width,t.width),Math.max(e.height,t.height))}function arraySizeForUnaryOp(e){return new ArraySize(e.width,e.height)}var ArraySizePredictor=function(){function e(t,n){_classCallCheck$1z(this,e),this.config=t,this.functionRegistry=n}return _createClass$1z(e,[{key:"checkArraySize",value:function(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}},{key:"checkArraySizeForAst",value:function(e,t){var n=this;switch(e.type){case AstNodeType.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:case AstNodeType.CELL_RANGE:var r=AbsoluteCellRange.fromAstOrUndef(e,t.formulaAddress);return void 0===r?ArraySize.error():new ArraySize(r.width(),r.height(),!0);case AstNodeType.ARRAY:var a,i=[],o=[],s=_createForOfIteratorHelper$B(e.args);try{for(s.s();!(a=s.n()).done;){var l=a.value.map((function(e){return n.checkArraySizeForAst(e,t)})),u=Math.min.apply(Math,_toConsumableArray$c(l.map((function(e){return e.height})))),c=l.reduce((function(e,t){return e+t.width}),0);i.push(u),o.push(c)}}catch(e){s.e(e)}finally{s.f()}var p=i.reduce((function(e,t){return e+t}),0),d=Math.min.apply(Math,o);return new ArraySize(d,p);case AstNodeType.STRING:case AstNodeType.NUMBER:return ArraySize.scalar();case AstNodeType.CELL_REFERENCE:return new ArraySize(1,1,!0);case AstNodeType.DIV_OP:case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.PLUS_OP:case AstNodeType.POWER_OP:case AstNodeType.TIMES_OP:var m=this.checkArraySizeForAst(e.left,t),f=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(m.height>1||m.width>1||f.height>1||f.width>1)?ArraySize.error():arraySizeForBinaryOp(m,f);case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.PERCENT_OP:var h=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(h.height>1||h.width>1)?ArraySize.error():arraySizeForUnaryOp(h);case AstNodeType.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case AstNodeType.EMPTY:default:return ArraySize.error()}}},{key:"checkArraySizeForFunction",value:function(e,t){var n=this,r=this.functionRegistry.getMetadata(e.procedureName),a=this.functionRegistry.getArraySizeFunction(e.procedureName);if(void 0!==a)return a(e,t);var i=e.args.map((function(e){var a;return n.checkArraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))}));if(void 0===r||r.expandRanges||!t.arraysFlag||r.vectorizationForbidden||void 0===r.parameters)return new ArraySize(1,1);var o=_toConsumableArray$c(r.parameters);if(void 0===r.repeatLastArgs&&o.length<i.length)return ArraySize.error();if(void 0!==r.repeatLastArgs&&o.length<i.length&&(i.length-o.length)%r.repeatLastArgs!=0)return ArraySize.error();for(;o.length<i.length;)o.push.apply(o,_toConsumableArray$c(o.slice(o.length-r.repeatLastArgs)));for(var s=1,l=1,u=0;u<i.length;u++)o[u].argumentType!==ArgumentTypes.RANGE&&o[u].argumentType!==ArgumentTypes.ANY&&(l=Math.max(l,i[u].height),s=Math.max(s,i[u].width));return new ArraySize(s,l)}}]),e}();function _createForOfIteratorHelper$A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$K(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$K(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$K(e,t):void 0}}function _arrayLikeToArray$K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1y(e,t,n){return t&&_defineProperties$1y(e.prototype,t),n&&_defineProperties$1y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var SimpleRangeValue=function(){function e(t,n,r,a){_classCallCheck$1y(this,e),this._data=t,this.range=n,this.dependencyGraph=r,this._hasOnlyNumbers=a,this.size=void 0===t?new ArraySize(n.effectiveWidth(r),n.effectiveHeight(r)):new ArraySize(t[0].length,t.length)}return _createClass$1y(e,[{key:"data",get:function(){return this.ensureThatComputed(),this._data}},{key:"isAdHoc",value:function(){return void 0===this.range}},{key:"width",value:function(){return this.size.width}},{key:"height",value:function(){return this.size.height}},{key:"valuesFromTopLeftCorner",value:function(){this.ensureThatComputed();for(var e=[],t=0;t<this._data.length;t++)for(var n=0;n<this._data[0].length;n++)e.push(this._data[t][n]);return e}},{key:"effectiveAddressesFromData",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.data.length)){e.next=13;break}r=this.data[n],a=0;case 4:if(!(a<r.length)){e.next=10;break}return e.next=7,simpleCellAddress(t.sheet,t.col+a,t.row+n);case 7:++a,e.next=4;break;case 10:++n,e.next=1;break;case 13:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromTopLeftCorner",value:regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.ensureThatComputed(),n=0;case 2:if(!(n<this.size.height)){e.next=13;break}r=0;case 4:if(!(r<this.size.width)){e.next=10;break}return e.next=7,[this._data[n][r],simpleCellAddress(t.sheet,t.col+r,t.row+n)];case 7:++r,e.next=4;break;case 10:++n,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)}))},{key:"iterateValuesFromTopLeftCorner",value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.valuesFromTopLeftCorner(),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"numberOfElements",value:function(){return this.size.width*this.size.height}},{key:"hasOnlyNumbers",value:function(){if(void 0===this._hasOnlyNumbers){this._hasOnlyNumbers=!0;var e,t=_createForOfIteratorHelper$A(this.data);try{for(t.s();!(e=t.n()).done;){var n,r=_createForOfIteratorHelper$A(e.value);try{for(r.s();!(n=r.n()).done;){if("number"!=typeof n.value)return this._hasOnlyNumbers=!1,!1}}catch(e){r.e(e)}finally{r.f()}}}catch(e){t.e(e)}finally{t.f()}}return this._hasOnlyNumbers}},{key:"rawNumbers",value:function(){return this._data}},{key:"rawData",value:function(){var e;return this.ensureThatComputed(),null!==(e=this._data)&&void 0!==e?e:[]}},{key:"sameDimensionsAs",value:function(e){return this.width()===e.width()&&this.height()===e.height()}},{key:"ensureThatComputed",value:function(){var t=this;void 0===this._data&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,(function(n){var r=t.dependencyGraph.getCellValue(n);return r instanceof e?(t._hasOnlyNumbers=!1,new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):(isExtendedNumber(r)||(t._hasOnlyNumbers=!1),r)})))}}],[{key:"fromRange",value:function(t,n,r){return new e(t,n,r,!0)}},{key:"onlyNumbers",value:function(t){return new e(t,void 0,void 0,!0)}},{key:"onlyValues",value:function(t){return new e(t,void 0,void 0,void 0)}},{key:"onlyRange",value:function(t,n){return new e(void 0,t,n,void 0)}},{key:"fromScalar",value:function(t){return new e([[t]],void 0,void 0,void 0)}}]),e}();function _createForOfIteratorHelper$z(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$J(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$J(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$J(e,t):void 0}}function _arrayLikeToArray$J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1x(e,t,n){return t&&_defineProperties$1x(e.prototype,t),n&&_defineProperties$1x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ContentChanges=function(){function e(){_classCallCheck$1x(this,e),this.changes=new Map}return _createClass$1x(e,[{key:"addAll",value:function(e){var t,n=_createForOfIteratorHelper$z(e.changes.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.add(r.address,r)}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"addChange",value:function(e,t,n){this.addInterpreterValue(e,t,n)}},{key:"exportChanges",value:function(e){var t=[];return this.changes.forEach((function(n){var r=e.exportChange(n);Array.isArray(r)?t=t.concat(r):t.push(r)})),t}},{key:"getChanges",value:function(){return Array.from(this.changes.values())}},{key:"isEmpty",value:function(){return 0===this.changes.size}},{key:"add",value:function(e,t){var n=t.value;if(n instanceof SimpleRangeValue){var r,a=_createForOfIteratorHelper$z(n.effectiveAddressesFromData(e));try{for(a.s();!(r=a.n()).done;){var i=r.value;this.changes.delete("".concat(i.sheet,",").concat(i.col,",").concat(i.row))}}catch(e){a.e(e)}finally{a.f()}}this.changes.set(addressKey(e),t)}},{key:"addInterpreterValue",value:function(e,t,n){this.add(t,{address:t,value:e,oldValue:n})}}],[{key:"empty",value:function(){return new e}}]),e}(),StatType;
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function _classCallCheck$1w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1w(e,t,n){return t&&_defineProperties$1w(e.prototype,t),n&&_defineProperties$1w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",e.PARSER="PARSER",e.GRAPH_BUILD="GRAPH_BUILD",e.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",e.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",e.TOP_SORT="TOP_SORT",e.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",e.EVALUATION="EVALUATION",e.VLOOKUP="VLOOKUP",e.TRANSFORM_ASTS="TRANSFORM_ASTS",e.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",e.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",e.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",e.ADJUSTING_RANGES="ADJUSTING_RANGES",e.ADJUSTING_GRAPH="ADJUSTING_GRAPH",e.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",e.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"}(StatType||(StatType={}));var Statistics=function(){function e(){_classCallCheck$1w(this,e),this.stats=new Map([[StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0],[StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}return _createClass$1w(e,[{key:"incrementCriterionFunctionFullCacheUsed",value:function(){var e,t=(null!==(e=this.stats.get(StatType.CRITERION_FUNCTION_FULL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,t)}},{key:"incrementCriterionFunctionPartialCacheUsed",value:function(){var e,t=(null!==(e=this.stats.get(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}},{key:"reset",value:function(){this.stats.clear(),this.startTimes.clear(),this.stats.set(StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}},{key:"start",value:function(e){if(this.startTimes.get(e))throw Error("Statistics ".concat(e," already started"));this.startTimes.set(e,Date.now())}},{key:"end",value:function(e){var t,n=Date.now(),r=this.startTimes.get(e);if(!r)throw Error("Statistics ".concat(e," not started"));var a=null!==(t=this.stats.get(e))&&void 0!==t?t:0;a+=n-r,this.stats.set(e,a),this.startTimes.delete(e)}},{key:"measure",value:function(e,t){this.start(e);var n=t();return this.end(e),n}},{key:"snapshot",value:function(){return new Map(this.stats)}}]),e}();function _typeof$X(e){return _typeof$X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$X(e)}function _classCallCheck$1v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1v(e,t,n){return t&&_defineProperties$1v(e.prototype,t),n&&_defineProperties$1v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$U(e,t)}function _setPrototypeOf$U(e,t){return _setPrototypeOf$U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$U(e,t)}function _createSuper$T(e){var t=_isNativeReflectConstruct$U();return function(){var n,r=_getPrototypeOf$T(e);if(t){var a=_getPrototypeOf$T(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$T(this,n)}}function _possibleConstructorReturn$T(e,t){if(t&&("object"===_typeof$X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$T(e)}function _assertThisInitialized$T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$U(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$T(e){return _getPrototypeOf$T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$T(e)}var EmptyStatistics=function(e){_inherits$T(n,e);var t=_createSuper$T(n);function n(){return _classCallCheck$1v(this,n),t.apply(this,arguments)}return _createClass$1v(n,[{key:"incrementCriterionFunctionFullCacheUsed",value:function(){}},{key:"incrementCriterionFunctionPartialCacheUsed",value:function(){}},{key:"start",value:function(e){}},{key:"end",value:function(e){}}]),n}(Statistics),toObject$2=toObject$e,toAbsoluteIndex$2=toAbsoluteIndex$6,lengthOfArrayLike$1=lengthOfArrayLike$b,arrayFill=function(e){for(var t=toObject$2(this),n=lengthOfArrayLike$1(t),r=arguments.length,a=toAbsoluteIndex$2(r>1?arguments[1]:void 0,n),i=r>2?arguments[2]:void 0,o=void 0===i?n:toAbsoluteIndex$2(i,n);o>a;)t[a++]=e;return t},$$p=_export,fill=arrayFill,addToUnscopables$2=addToUnscopables$5;function _slicedToArray$p(e,t){return _arrayWithHoles$p(e)||_iterableToArrayLimit$p(e,t)||_unsupportedIterableToArray$I(e,t)||_nonIterableRest$p()}function _nonIterableRest$p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$p(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$p(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$I(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$I(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$I(e,t):void 0}}function _arrayLikeToArray$I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1u(e,t,n){return t&&_defineProperties$1u(e.prototype,t),n&&_defineProperties$1u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}$$p({target:"Array",proto:!0},{fill:fill}),addToUnscopables$2("fill");var AddressMapping=function(){function e(t){_classCallCheck$1u(this,e),this.policy=t,this.mapping=new Map}return _createClass$1u(e,[{key:"getCell",value:function(e){var t=this.mapping.get(e.sheet);if(void 0===t)throw new NoSheetWithIdError(e.sheet);return t.getCell(e)}},{key:"fetchCell",value:function(e){var t=this.mapping.get(e.sheet);if(void 0===t)throw new NoSheetWithIdError(e.sheet);var n=t.getCell(e);if(!n)throw Error("Vertex for address missing in AddressMapping");return n}},{key:"strategyFor",value:function(e){var t=this.mapping.get(e);if(void 0===t)throw new NoSheetWithIdError(e);return t}},{key:"addSheet",value:function(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}},{key:"autoAddSheet",value:function(e,t,n){var r=n.height,a=n.width,i=n.fill,o=this.policy.call(i);this.addSheet(e,new o(a,r))}},{key:"getCellValue",value:function(e){var t=this.getCell(e);return void 0===t?EmptyValue:t instanceof ArrayVertex?t.getArrayCellValue(e):t.getCellValue()}},{key:"getRawValue",value:function(e){var t=this.getCell(e);return t instanceof ValueCellVertex?t.getValues().rawValue:t instanceof ArrayVertex?t.getArrayCellRawValue(e):null}},{key:"setCell",value:function(e,t){var n=this.mapping.get(e.sheet);if(!n)throw Error("Sheet not initialized");n.setCell(e,t)}},{key:"moveCell",value:function(e,t){var n=this.mapping.get(e.sheet);if(!n)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(n.has(t))throw new Error("Cannot move cell. Destination already occupied.");var r=n.getCell(e);if(void 0===r)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,r),this.removeCell(e)}},{key:"removeCell",value:function(e){var t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}},{key:"has",value:function(e){var t=this.mapping.get(e.sheet);return void 0!==t&&t.has(e)}},{key:"getHeight",value:function(e){var t=this.mapping.get(e);if(void 0===t)throw new NoSheetWithIdError(e);return t.getHeight()}},{key:"getWidth",value:function(e){var t=this.mapping.get(e);if(!t)throw new NoSheetWithIdError(e);return t.getWidth()}},{key:"addRows",value:function(e,t,n){var r=this.mapping.get(e);if(void 0===r)throw new NoSheetWithIdError(e);r.addRows(t,n)}},{key:"removeRows",value:function(e){var t=this.mapping.get(e.sheet);if(void 0===t)throw new NoSheetWithIdError(e.sheet);t.removeRows(e)}},{key:"removeSheet",value:function(e){this.mapping.delete(e)}},{key:"addColumns",value:function(e,t,n){var r=this.mapping.get(e);if(void 0===r)throw new NoSheetWithIdError(e);r.addColumns(t,n)}},{key:"removeColumns",value:function(e){var t=this.mapping.get(e.sheet);if(void 0===t)throw new NoSheetWithIdError(e.sheet);t.removeColumns(e)}},{key:"verticesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.mapping.get(t.sheet).verticesFromRowsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"verticesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.mapping.get(t.sheet).verticesFromColumnsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.mapping.get(t.sheet).entriesFromRowsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.mapping.get(t.sheet).entriesFromColumnsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"entries",value:regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$y(this.mapping.entries()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=8;break}return r=_slicedToArray$p(n.value,2),a=r[0],i=r[1],e.delegateYield(i.getEntries(a),"t0",6);case 6:e.next=3;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),t.e(e.t1);case 13:return e.prev=13,t.f(),e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[1,10,13,16]])}))},{key:"sheetEntries",value:regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.mapping.get(t))){e.next=5;break}return e.delegateYield(n.getEntries(t),"t0",3);case 3:e.next=6;break;case 5:throw new NoSheetWithIdError(t);case 6:case"end":return e.stop()}}),e,this)}))}]),e}();function _slicedToArray$o(e,t){return _arrayWithHoles$o(e)||_iterableToArrayLimit$o(e,t)||_unsupportedIterableToArray$H(e,t)||_nonIterableRest$o()}function _nonIterableRest$o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$o(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$o(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$H(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$H(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$H(e,t):void 0}}function _arrayLikeToArray$H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1t(e,t,n){return t&&_defineProperties$1t(e.prototype,t),n&&_defineProperties$1t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ArrayMapping=function(){function e(){_classCallCheck$1t(this,e),this.arrayMapping=new Map}return _createClass$1t(e,[{key:"getArray",value:function(e){var t=this.getArrayByCorner(e.start);if(null==t?void 0:t.getRange().sameAs(e))return t}},{key:"getArrayByCorner",value:function(e){return this.arrayMapping.get(addressKey(e))}},{key:"setArray",value:function(e,t){this.arrayMapping.set(addressKey(e.start),t)}},{key:"removeArray",value:function(e){"string"==typeof e?this.arrayMapping.delete(e):this.arrayMapping.delete(addressKey(e.start))}},{key:"count",value:function(){return this.arrayMapping.size}},{key:"arraysInRows",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$x(this.arrayMapping.entries()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=10;break}if(a=_slicedToArray$o(r.value,2),i=a[0],!(o=a[1]).spansThroughSheetRows(t.sheet,t.rowStart,t.rowEnd)){e.next=8;break}return e.next=8,[i,o];case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))},{key:"arraysInCols",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$x(this.arrayMapping.entries()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=10;break}if(a=_slicedToArray$o(r.value,2),i=a[0],!(o=a[1]).spansThroughSheetColumn(t.sheet,t.columnStart,t.columnEnd)){e.next=8;break}return e.next=8,[i,o];case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))},{key:"isFormulaArrayInRow",value:function(e,t){var n,r=_createForOfIteratorHelper$x(this.arrayMapping.values());try{for(r.s();!(n=r.n()).done;){if(n.value.spansThroughSheetRows(e,t))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"isFormulaArrayInAllRows",value:function(e){var t,n=!0,r=_createForOfIteratorHelper$x(e.rows());try{for(r.s();!(t=r.n()).done;){var a=t.value;this.isFormulaArrayInRow(e.sheet,a)||(n=!1)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"isFormulaArrayInColumn",value:function(e,t){var n,r=_createForOfIteratorHelper$x(this.arrayMapping.values());try{for(r.s();!(n=r.n()).done;){if(n.value.spansThroughSheetColumn(e,t))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"isFormulaArrayInAllColumns",value:function(e){var t,n=!0,r=_createForOfIteratorHelper$x(e.columns());try{for(r.s();!(t=r.n()).done;){var a=t.value;this.isFormulaArrayInColumn(e.sheet,a)||(n=!1)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"isFormulaArrayInRange",value:function(e){var t,n=_createForOfIteratorHelper$x(this.arrayMapping.values());try{for(n.s();!(t=n.n()).done;){if(t.value.getRange().doesOverlap(e))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"isFormulaArrayAtAddress",value:function(e){var t,n=_createForOfIteratorHelper$x(this.arrayMapping.values());try{for(n.s();!(t=n.n()).done;){if(t.value.getRange().addressInRange(e))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"moveArrayVerticesAfterRowByRows",value:function(e,t,n){this.updateArrayVerticesInSheet(e,(function(e,r){var a=r.getRange();return t<=a.start.row?[a.shifted(0,n),r]:void 0}))}},{key:"moveArrayVerticesAfterColumnByColumns",value:function(e,t,n){this.updateArrayVerticesInSheet(e,(function(e,r){var a=r.getRange();return t<=a.start.col?[a.shifted(n,0),r]:void 0}))}},{key:"updateArrayVerticesInSheet",value:function(e,t){var n,r=this,a=Array(),i=_createForOfIteratorHelper$x(this.arrayMapping.entries());try{for(i.s();!(n=i.n()).done;){var o=_slicedToArray$o(n.value,2),s=o[0],l=o[1];if(l.sheet===e){var u=t(s,l);void 0!==u&&(this.removeArray(s),a.push(u))}}}catch(e){i.e(e)}finally{i.f()}a.forEach((function(e){var t=_slicedToArray$o(e,2),n=t[0],a=t[1];r.setArray(n,a)}))}}]),e}(),$$o=_export,global$5=global$U,toAbsoluteIndex$1=toAbsoluteIndex$6,toIntegerOrInfinity$2=toIntegerOrInfinity$7,lengthOfArrayLike=lengthOfArrayLike$b,toObject$1=toObject$e,arraySpeciesCreate=arraySpeciesCreate$3,createProperty=createProperty$5,arrayMethodHasSpeciesSupport=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("splice"),TypeError$1=global$5.TypeError,max=Math.max,min$1=Math.min,MAX_SAFE_INTEGER=9007199254740991,MAXIMUM_ALLOWED_LENGTH_EXCEEDED="Maximum allowed length exceeded";function _createForOfIteratorHelper$w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$G(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _toConsumableArray$b(e){return _arrayWithoutHoles$b(e)||_iterableToArray$b(e)||_unsupportedIterableToArray$G(e)||_nonIterableSpread$b()}function _nonIterableSpread$b(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$G(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$G(e,t):void 0}}function _iterableToArray$b(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$b(e){if(Array.isArray(e))return _arrayLikeToArray$G(e)}function _arrayLikeToArray$G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1s(e,t,n){return t&&_defineProperties$1s(e.prototype,t),n&&_defineProperties$1s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}$$o({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{splice:function(e,t){var n,r,a,i,o,s,l=toObject$1(this),u=lengthOfArrayLike(l),c=toAbsoluteIndex$1(e,u),p=arguments.length;if(0===p?n=r=0:1===p?(n=0,r=u-c):(n=p-2,r=min$1(max(toIntegerOrInfinity$2(t),0),u-c)),u+n-r>MAX_SAFE_INTEGER)throw TypeError$1(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);for(a=arraySpeciesCreate(l,r),i=0;i<r;i++)(o=c+i)in l&&createProperty(a,i,l[o]);if(a.length=r,n<r){for(i=c;i<u-r;i++)s=i+n,(o=i+r)in l?l[s]=l[o]:delete l[s];for(i=u;i>u-r+n;i--)delete l[i-1]}else if(n>r)for(i=u-r;i>c;i--)s=i+n-1,(o=i+r-1)in l?l[s]=l[o]:delete l[s];for(i=0;i<n;i++)l[i+c]=arguments[i+2];return l.length=u-r+n,a}});var NotComputedArray=function(){function e(t){_classCallCheck$1s(this,e),this.size=t}return _createClass$1s(e,[{key:"width",value:function(){return this.size.width}},{key:"height",value:function(){return this.size.height}},{key:"get",value:function(e,t){throw Error("Array not computed yet.")}},{key:"simpleRangeValue",value:function(){throw Error("Array not computed yet.")}}]),e}(),ArrayValue=function(){function e(t){_classCallCheck$1s(this,e),this.size=new ArraySize(t.length>0?t[0].length:0,t.length),this.array=t}return _createClass$1s(e,[{key:"simpleRangeValue",value:function(){return SimpleRangeValue.onlyValues(this.array)}},{key:"addRows",value:function(e,t){var n;(n=this.array).splice.apply(n,[e,0].concat(_toConsumableArray$b(this.nullArrays(t,this.width())))),this.size.height+=t}},{key:"addColumns",value:function(e,t){for(var n=0;n<this.height();n++){var r;(r=this.array[n]).splice.apply(r,[e,0].concat(_toConsumableArray$b(new Array(t).fill(EmptyValue))))}this.size.width+=t}},{key:"removeRows",value:function(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");var n=t-e+1;this.array.splice(e,n),this.size.height-=n}},{key:"removeColumns",value:function(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");var n,r=t-e+1,a=_createForOfIteratorHelper$w(this.array);try{for(a.s();!(n=a.n()).done;){n.value.splice(e,r)}}catch(e){a.e(e)}finally{a.f()}this.size.width-=r}},{key:"nullArrays",value:function(e,t){for(var n=[],r=0;r<e;++r)n.push(new Array(t).fill(EmptyValue));return n}},{key:"get",value:function(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}},{key:"set",value:function(e,t,n){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=n}},{key:"width",value:function(){return this.size.width}},{key:"height",value:function(){return this.size.height}},{key:"raw",value:function(){return this.array}},{key:"resize",value:function(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height)throw"Resizing to smaller array";if(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width)throw"Resizing to smaller array"}},{key:"outOfBound",value:function(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}],[{key:"fromInterpreterValue",value:function(t){return new e(t instanceof SimpleRangeValue?t.data:[[t]])}}]),e}(),ErroredArray=function(){function e(t,n){_classCallCheck$1s(this,e),this.error=t,this.size=n}return _createClass$1s(e,[{key:"get",value:function(e,t){return this.error}},{key:"width",value:function(){return this.size.width}},{key:"height",value:function(){return this.size.height}},{key:"simpleRangeValue",value:function(){return this.error}}]),e}();function _typeof$W(e){return _typeof$W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$W(e)}function _inherits$S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$T(e,t)}function _setPrototypeOf$T(e,t){return _setPrototypeOf$T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$T(e,t)}function _createSuper$S(e){var t=_isNativeReflectConstruct$T();return function(){var n,r=_getPrototypeOf$S(e);if(t){var a=_getPrototypeOf$S(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$S(this,n)}}function _possibleConstructorReturn$S(e,t){if(t&&("object"===_typeof$W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$S(e)}function _assertThisInitialized$S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$S(e){return _getPrototypeOf$S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$S(e)}function _slicedToArray$n(e,t){return _arrayWithHoles$n(e)||_iterableToArrayLimit$n(e,t)||_unsupportedIterableToArray$F(e,t)||_nonIterableRest$n()}function _nonIterableRest$n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$F(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$F(e,t):void 0}}function _arrayLikeToArray$F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$n(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$n(e){if(Array.isArray(e))return e}function _classCallCheck$1r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1r(e,t,n){return t&&_defineProperties$1r(e.prototype,t),n&&_defineProperties$1r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var FormulaVertex=function(){function e(t,n,r){_classCallCheck$1r(this,e),this.formula=t,this.cellAddress=n,this.version=r}return _createClass$1r(e,[{key:"width",get:function(){return 1}},{key:"height",get:function(){return 1}},{key:"getFormula",value:function(e){return this.ensureRecentData(e),this.formula}},{key:"ensureRecentData",value:function(e){if(this.version!=e.version()){var t=_slicedToArray$n(e.applyTransformations(this.formula,this.cellAddress,this.version),3),n=t[0],r=t[1],a=t[2];this.formula=n,this.cellAddress=r,this.version=a}}},{key:"getAddress",value:function(e){return this.ensureRecentData(e),this.cellAddress}}],[{key:"fromAst",value:function(e,t,n,r){return n.isScalar()?new FormulaCellVertex(e,t,r):new ArrayVertex(e,t,n,r)}}]),e}(),ArrayVertex=function(e){_inherits$S(n,e);var t=_createSuper$S(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return _classCallCheck$1r(this,n),i=t.call(this,e,r,o),a.isRef?i.array=new ErroredArray(new CellError(ErrorType.REF,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()):i.array=new NotComputedArray(a),i}return _createClass$1r(n,[{key:"width",get:function(){return this.array.width()}},{key:"height",get:function(){return this.array.height()}},{key:"sheet",get:function(){return this.cellAddress.sheet}},{key:"leftCorner",get:function(){return this.cellAddress}},{key:"setCellValue",value:function(e){if(e instanceof CellError)return this.setErrorValue(e),e;var t=ArrayValue.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}},{key:"getCellValue",value:function(){if(this.array instanceof NotComputedArray)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}},{key:"valueOrUndef",value:function(){if(!(this.array instanceof NotComputedArray))return this.array.simpleRangeValue()}},{key:"getArrayCellValue",value:function(e){var t=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;try{return this.array.get(t,n)}catch(e){return new CellError(ErrorType.REF)}}},{key:"getArrayCellRawValue",value:function(e){var t=this.getArrayCellValue(e);return t instanceof CellError||t===EmptyValue?void 0:getRawValue(t)}},{key:"setArrayCellValue",value:function(e,t){var n=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;this.array instanceof ArrayValue&&this.array.set(n,r,t)}},{key:"setNoSpace",value:function(){return this.array=new ErroredArray(new CellError(ErrorType.SPILL,ErrorMessage.NoSpaceForArrayResult),ArraySize.error()),this.getCellValue()}},{key:"getRange",value:function(){return AbsoluteCellRange.spanFrom(this.cellAddress,this.width,this.height)}},{key:"getRangeOrUndef",value:function(){return AbsoluteCellRange.spanFromOrUndef(this.cellAddress,this.width,this.height)}},{key:"setAddress",value:function(e){this.cellAddress=e}},{key:"setFormula",value:function(e){this.formula=e}},{key:"spansThroughSheetRows",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return this.cellAddress.sheet===e&&this.cellAddress.row<=n&&t<this.cellAddress.row+this.height}},{key:"spansThroughSheetColumn",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return this.cellAddress.sheet===e&&this.cellAddress.col<=n&&t<this.cellAddress.col+this.width}},{key:"isComputed",value:function(){return!(this.array instanceof NotComputedArray)}},{key:"columnsFromArray",value:function(){return ColumnsSpan.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}},{key:"rowsFromArray",value:function(){return RowsSpan.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}},{key:"ensureRecentData",value:function(e){}},{key:"isLeftCorner",value:function(e){return equalSimpleCellAddress(this.cellAddress,e)}},{key:"setErrorValue",value:function(e){this.array=new ErroredArray(e,this.array.size)}}]),n}(FormulaVertex),FormulaCellVertex=function(e){_inherits$S(n,e);var t=_createSuper$S(n);function n(e,r,a){return _classCallCheck$1r(this,n),t.call(this,e,r,a)}return _createClass$1r(n,[{key:"valueOrUndef",value:function(){return this.cachedCellValue}},{key:"setCellValue",value:function(e){return this.cachedCellValue=e,this.cachedCellValue}},{key:"getCellValue",value:function(){if(void 0!==this.cachedCellValue)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}},{key:"isComputed",value:function(){return void 0!==this.cachedCellValue}}]),n}(FormulaVertex);function _classCallCheck$1q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1q(e,t,n){return t&&_defineProperties$1q(e.prototype,t),n&&_defineProperties$1q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var RangeVertex=function(){function e(t){_classCallCheck$1q(this,e),this.range=t,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}return _createClass$1q(e,[{key:"start",get:function(){return this.range.start}},{key:"end",get:function(){return this.range.end}},{key:"sheet",get:function(){return this.range.start.sheet}},{key:"getFunctionValue",value:function(e){return this.functionCache.get(e)}},{key:"setFunctionValue",value:function(e,t){this.functionCache.set(e,t)}},{key:"getCriterionFunctionValue",value:function(e,t){var n;return null===(n=this.getCriterionFunctionValues(e).get(t))||void 0===n?void 0:n[0]}},{key:"getCriterionFunctionValues",value:function(e){var t;return null!==(t=this.criterionFunctionCache.get(e))&&void 0!==t?t:new Map}},{key:"setCriterionFunctionValues",value:function(e,t){this.criterionFunctionCache.set(e,t)}},{key:"addDependentCacheRange",value:function(e){e!==this&&this.dependentCacheRanges.add(e)}},{key:"clearCache",value:function(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach((function(e){return e.criterionFunctionCache.clear()})),this.dependentCacheRanges.clear()}},{key:"getStart",value:function(){return this.start}},{key:"getEnd",value:function(){return this.end}}]),e}(),collectAddressesDependentToRange=function(e,t,n,r,a){if(t instanceof RangeVertex){var i=t.range.intersectionWith(n);return void 0!==i?Array.from(i.addresses(a)):[]}var o,s;return t instanceof FormulaVertex?(o=t.getFormula(r),s=t.getAddress(r),collectDependencies(o,e).filter((function(e){return e instanceof AddressDependency})).map((function(e){return e.dependency.toSimpleCellAddress(s)})).filter((function(e){return n.addressInRange(e)}))):[]},$$n=_export,uncurryThis$8=functionUncurryThis,isArray$1=isArray$7,un$Reverse=uncurryThis$8([].reverse),test=[1,2],NodeVisitStatus;function _createForOfIteratorHelper$v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$E(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$E(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$E(e,t):void 0}}function _arrayLikeToArray$E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1p(e,t,n){return t&&_defineProperties$1p(e.prototype,t),n&&_defineProperties$1p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */$$n({target:"Array",proto:!0,forced:String(test)===String(test.reverse())},{reverse:function(){return isArray$1(this)&&(this.length=this.length),un$Reverse(this)}}),function(e){e[e.ON_STACK=0]="ON_STACK",e[e.PROCESSED=1]="PROCESSED",e[e.POPPED=2]="POPPED"}(NodeVisitStatus||(NodeVisitStatus={}));var Graph=function(){function e(t){_classCallCheck$1p(this,e),this.dependencyQuery=t,this.nodes=new Set,this.specialNodes=new Set,this.specialNodesStructuralChanges=new Set,this.specialNodesRecentlyChanged=new Set,this.infiniteRanges=new Set,this.edges=new Map}return _createClass$1p(e,[{key:"addNode",value:function(e){this.nodes.add(e),this.edges.has(e)||this.edges.set(e,new Set)}},{key:"addEdge",value:function(e,t){if(!this.nodes.has(e))throw new Error("Unknown node ".concat(e));if(!this.nodes.has(t))throw new Error("Unknown node ".concat(t));this.edges.get(e).add(t)}},{key:"removeEdge",value:function(e,t){if(!this.existsEdge(e,t))throw new Error("Edge does not exist");this.edges.get(e).delete(t)}},{key:"softRemoveEdge",value:function(e,t){var n;null===(n=this.edges.get(e))||void 0===n||n.delete(t)}},{key:"removeIncomingEdges",value:function(e){this.edges.forEach((function(t){t.delete(e)}))}},{key:"adjacentNodes",value:function(e){return this.edges.get(e)}},{key:"adjacentNodesCount",value:function(e){return this.adjacentNodes(e).size}},{key:"hasNode",value:function(e){return this.nodes.has(e)}},{key:"nodesCount",value:function(){return this.nodes.size}},{key:"edgesCount",value:function(){var e=0;return this.edges.forEach((function(t){return e+=t.size})),e}},{key:"removeNode",value:function(e){var t,n=_createForOfIteratorHelper$v(this.adjacentNodes(e).values());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.markNodeAsSpecialRecentlyChanged(r)}}catch(e){n.e(e)}finally{n.f()}return this.edges.delete(e),this.nodes.delete(e),this.specialNodes.delete(e),this.specialNodesRecentlyChanged.delete(e),this.specialNodesStructuralChanges.delete(e),this.infiniteRanges.delete(e),this.removeDependencies(e)}},{key:"markNodeAsSpecial",value:function(e){this.specialNodes.add(e)}},{key:"markNodeAsSpecialRecentlyChanged",value:function(e){this.nodes.has(e)&&this.specialNodesRecentlyChanged.add(e)}},{key:"markNodeAsChangingWithStructure",value:function(e){this.specialNodesStructuralChanges.add(e)}},{key:"clearSpecialNodesRecentlyChanged",value:function(){this.specialNodesRecentlyChanged.clear()}},{key:"markNodeAsInfiniteRange",value:function(e){this.infiniteRanges.add(e)}},{key:"existsEdge",value:function(e,t){var n,r;return null!==(r=null===(n=this.edges.get(e))||void 0===n?void 0:n.has(t))&&void 0!==r&&r}},{key:"topSortWithScc",value:function(){return this.getTopSortedWithSccSubgraphFrom(Array.from(this.nodes),(function(){return!0}),(function(){}))}},{key:"getTopSortedWithSccSubgraphFrom",value:function(e,t,n){var r=this,a=new Map,i=new Map,o=new Map,s=new Set,l=new Map,u=[],c=0,p=new Set;e.reverse(),e.forEach((function(e){if(void 0===l.get(e)){var t=[e],n=[];l.set(e,NodeVisitStatus.ON_STACK);for(var d=function(){var e=t[t.length-1];switch(l.get(e)){case NodeVisitStatus.ON_STACK:a.set(e,c),i.set(e,c),n.push(e),c++,r.adjacentNodes(e).forEach((function(n){void 0===a.get(n)&&(t.push(n),o.set(n,e),l.set(n,NodeVisitStatus.ON_STACK))})),l.set(e,NodeVisitStatus.PROCESSED);break;case NodeVisitStatus.PROCESSED:var d;if(d=a.get(e),r.adjacentNodes(e).forEach((function(t){s.has(t)||(d=o.get(t)===e?Math.min(d,i.get(t)):Math.min(d,a.get(t)))})),i.set(e,d),d===a.get(e)){var m=[];do{m.push(n[n.length-1]),n.pop()}while(m[m.length-1]!==e);m.forEach((function(e){s.add(e)})),u.push.apply(u,m),m.length>1&&m.forEach((function(e){p.add(e)}))}t.pop(),l.set(e,NodeVisitStatus.POPPED);break;case NodeVisitStatus.POPPED:t.pop()}};t.length>0;)d()}}));var d=new Set(e),m=[],f=[];return u.reverse(),u.forEach((function(e){p.has(e)||r.adjacentNodes(e).has(e)?(f.push(e),n(e),r.adjacentNodes(e).forEach((function(e){return d.add(e)}))):(m.push(e),d.has(e)&&t(e)&&r.adjacentNodes(e).forEach((function(e){return d.add(e)})))})),{sorted:m,cycled:f}}},{key:"getDependencies",value:function(e){var t=[];return this.edges.forEach((function(n,r){n.has(e)&&t.push(r)})),t}},{key:"removeDependencies",value:function(e){var t,n=this.dependencyQuery(e),r=_createForOfIteratorHelper$v(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.softRemoveEdge(a,e)}}catch(e){r.e(e)}finally{r.f()}return n}}]),e}();function _slicedToArray$m(e,t){return _arrayWithHoles$m(e)||_iterableToArrayLimit$m(e,t)||_unsupportedIterableToArray$D(e,t)||_nonIterableRest$m()}function _nonIterableRest$m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$m(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$m(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$D(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$D(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$D(e,t):void 0}}function _arrayLikeToArray$D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1o(e,t,n){return t&&_defineProperties$1o(e.prototype,t),n&&_defineProperties$1o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var RangeMapping=function(){function e(){_classCallCheck$1o(this,e),this.rangeMapping=new Map}return _createClass$1o(e,[{key:"getMappingSize",value:function(e){var t,n;return null!==(n=null===(t=this.rangeMapping.get(e))||void 0===t?void 0:t.size)&&void 0!==n?n:0}},{key:"setRange",value:function(e){var t=this.rangeMapping.get(e.getStart().sheet);void 0===t&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));var n=keyFromAddresses(e.getStart(),e.getEnd());t.set(n,e)}},{key:"removeRange",value:function(e){var t=e.getStart().sheet,n=this.rangeMapping.get(t);if(void 0!==n){var r=keyFromAddresses(e.getStart(),e.getEnd());n.delete(r),0===n.size&&this.rangeMapping.delete(t)}}},{key:"getRange",value:function(e,t){var n=this.rangeMapping.get(e.sheet),r=keyFromAddresses(e,t);return null==n?void 0:n.get(r)}},{key:"fetchRange",value:function(e,t){var n=this.getRange(e,t);if(!n)throw Error("Range does not exist");return n}},{key:"truncateRanges",value:function(e,t){var n,r=Array(),a=Array(),i=Array(),o=e.sheet,s=_createForOfIteratorHelper$u(this.entriesFromSheet(e.sheet));try{for(s.s();!(n=s.n()).done;){var l=_slicedToArray$m(n.value,2),u=l[0],c=l[1],p=c.range;e.start<=t(c.range.end)&&(p.removeSpan(e),p.shouldBeRemoved()?(this.removeByKey(o,u),r.push(c)):a.push([u,c]),i.push(c))}}catch(e){s.e(e)}finally{s.f()}var d=[];a.sort((function(e,n){return compareBy(e[1],n[1],t)}));for(var m=0,f=a;m<f.length;m++){var h=_slicedToArray$m(f[m],2),y=h[0],b=h[1],g=keyFromRange(b.range);if(g!==y){var v=this.getByKey(o,g);this.removeByKey(o,y),void 0!==v&&b!=v?d.push([v,b]):this.setRange(b)}}return{verticesToRemove:r,verticesToMerge:d,verticesWithChangedSize:i}}},{key:"moveAllRangesInSheetAfterRowByRows",value:function(e,t,n){return this.updateVerticesFromSheet(e,(function(e,r){return t<=r.start.row?(r.range.shiftByRows(n),{changedSize:!1,vertex:r}):t>r.start.row&&t<=r.end.row?(r.range.expandByRows(n),{changedSize:!0,vertex:r}):void 0}))}},{key:"moveAllRangesInSheetAfterColumnByColumns",value:function(e,t,n){return this.updateVerticesFromSheet(e,(function(e,r){return t<=r.start.col?(r.range.shiftByColumns(n),{changedSize:!1,vertex:r}):t>r.start.col&&t<=r.end.col?(r.range.expandByColumns(n),{changedSize:!0,vertex:r}):void 0}))}},{key:"moveRangesInsideSourceRange",value:function(e,t,n,r){this.updateVerticesFromSheet(e.sheet,(function(a,i){return e.containsRange(i.range)?(i.range.shiftByColumns(t),i.range.shiftByRows(n),i.range.moveToSheet(r),{changedSize:!1,vertex:i}):void 0}))}},{key:"removeRangesInSheet",value:function(e){if(this.rangeMapping.has(e)){var t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}},{key:"rangesInSheet",value:regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.rangeMapping.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.delegateYield(n.values(),"t0",4);case 4:case"end":return e.stop()}}),e,this)}))},{key:"rangeVerticesContainedInRange",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$u(this.rangesInSheet(t.sheet)),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=10;break}if(a=r.value,!t.containsRange(a.range)){e.next=8;break}return e.next=8,a;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))},{key:"findSmallerRange",value:function(e){if(e.height()>1&&Number.isFinite(e.height())){var t=simpleCellAddress(e.end.sheet,e.end.col,e.end.row-1),n=this.getRange(e.start,t);if(void 0!==n)return{smallerRangeVertex:n,restRange:new AbsoluteCellRange(simpleCellAddress(e.start.sheet,e.start.col,e.end.row),e.end)}}return{restRange:e}}},{key:"entriesFromSheet",value:regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.rangeMapping.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.delegateYield(n.entries(),"t0",4);case 4:case"end":return e.stop()}}),e,this)}))},{key:"removeByKey",value:function(e,t){this.rangeMapping.get(e).delete(t)}},{key:"getByKey",value:function(e,t){var n;return null===(n=this.rangeMapping.get(e))||void 0===n?void 0:n.get(t)}},{key:"updateVerticesFromSheet",value:function(e,t){var n,r=this,a=Array(),i=_createForOfIteratorHelper$u(this.entriesFromSheet(e));try{for(i.s();!(n=i.n()).done;){var o=_slicedToArray$m(n.value,2),s=o[0],l=t(s,o[1]);void 0!==l&&(this.removeByKey(e,s),a.push(l))}}catch(e){i.e(e)}finally{i.f()}return a.forEach((function(e){r.setRange(e.vertex)})),{verticesWithChangedSize:a.filter((function(e){return e.changedSize})).map((function(e){return e.vertex}))}}}]),e}();function keyFromAddresses(e,t){return"".concat(e.col,",").concat(e.row,",").concat(t.col,",").concat(t.row)}function keyFromRange(e){return keyFromAddresses(e.start,e.end)}var compareBy=function(e,t,n){var r=n(e.range.start),a=n(e.range.start);return r===a?n(e.range.end)-n(t.range.end):r-a},$$m=_export,toObject=toObject$e,nativeKeys=objectKeys$4,fails$2=fails$B,FAILS_ON_PRIMITIVES=fails$2((function(){nativeKeys(1)}));$$m({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES},{keys:function(e){return nativeKeys(toObject(e))}});var DESCRIPTORS=descriptors,uncurryThis$7=functionUncurryThis,objectKeys=objectKeys$4,toIndexedObject=toIndexedObject$b,$propertyIsEnumerable=objectPropertyIsEnumerable.f,propertyIsEnumerable=uncurryThis$7($propertyIsEnumerable),push=uncurryThis$7([].push),createMethod$1=function(e){return function(t){for(var n,r=toIndexedObject(t),a=objectKeys(r),i=a.length,o=0,s=[];i>o;)n=a[o++],DESCRIPTORS&&!propertyIsEnumerable(r,n)||push(s,e?[n,r[n]]:r[n]);return s}},objectToArray={entries:createMethod$1(!0),values:createMethod$1(!1)},$$l=_export,$values=objectToArray.values;function _createForOfIteratorHelper$t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$C(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$C(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$C(e,t):void 0}}function _arrayLikeToArray$C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1n(e,t,n){return t&&_defineProperties$1n(e.prototype,t),n&&_defineProperties$1n(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}$$l({target:"Object",stat:!0},{values:function(e){return $values(e)}});var TranslationPackage=function(){function e(t,n,r){_classCallCheck$1n(this,e),this.functions=t,this.errors=n,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}return _createClass$1n(e,[{key:"extendFunctions",value:function(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}},{key:"buildFunctionMapping",value:function(){var e=this;return Object.keys(this.functions).reduce((function(t,n){return t[e.functions[n]]=n,t}),{})}},{key:"buildErrorMapping",value:function(){var e=this;return Object.keys(this.errors).reduce((function(t,n){return t[e.errors[n]]=n,t}),{})}},{key:"isFunctionTranslated",value:function(e){return void 0!==this.functions[e]}},{key:"getFunctionTranslations",value:function(e){var t,n=[],r=_createForOfIteratorHelper$t(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.isFunctionTranslated(a)&&n.push(this.functions[a])}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getFunctionTranslation",value:function(e){var t=this.functions[e];if(void 0===t)throw new MissingTranslationError("functions.".concat(e));return t}},{key:"getMaybeFunctionTranslation",value:function(e){return this.functions[e]}},{key:"getErrorTranslation",value:function(e){if(e===ErrorType.LIC)return"#".concat(ErrorType.LIC,"!");var t=this.errors[e];if(void 0===t)throw new MissingTranslationError("errors.".concat(e));return t}},{key:"getUITranslation",value:function(e){var t=this.ui[e];if(void 0===t)throw new MissingTranslationError("ui.".concat(e));return t}},{key:"checkUI",value:function(){for(var e=0,t=Object.values(UIElement);e<t.length;e++){var n=t[e];if(!(n in this.ui))throw new MissingTranslationError("ui.".concat(n))}}},{key:"checkErrors",value:function(){for(var e=0,t=Object.values(ErrorType);e<t.length;e++){var n=t[e];if(!(n in this.errors)&&n!==ErrorType.LIC)throw new MissingTranslationError("errors.".concat(n))}}},{key:"checkFunctionTranslations",value:function(e){var t,n=new Set(Object.getOwnPropertyNames(e)),r=_createForOfIteratorHelper$t(Object.getOwnPropertyNames(this._protectedTranslations));try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n.has(a))throw new ProtectedFunctionTranslationError(a)}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),UIElement;function buildTranslationPackage(e){return new TranslationPackage(Object.assign({},e.functions),Object.assign({},e.errors),Object.assign({},e.ui))}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function _createForOfIteratorHelper$s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$B(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$B(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$B(e,t):void 0}}function _arrayLikeToArray$B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1m(e,t,n){return t&&_defineProperties$1m(e.prototype,t),n&&_defineProperties$1m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function canonicalize(e){return e.toLowerCase()}!function(e){e.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"}(UIElement||(UIElement={}));var Sheet=function(){function e(t,n){_classCallCheck$1m(this,e),this.id=t,this.displayName=n}return _createClass$1m(e,[{key:"canonicalName",get:function(){return canonicalize(this.displayName)}}]),e}(),SheetMapping=function(){function e(t){var n=this;_classCallCheck$1m(this,e),this.languages=t,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=function(e){var t=n.mappingFromCanonicalName.get(canonicalize(e));if(void 0===t)throw new NoSheetWithNameError(e);return t.id},this.get=function(e){var t;return null===(t=n.mappingFromCanonicalName.get(canonicalize(e)))||void 0===t?void 0:t.id},this.fetchDisplayName=function(e){return n.fetchSheetById(e).displayName},this.sheetNamePrefix=t.getUITranslation(UIElement.NEW_SHEET_PREFIX)}return _createClass$1m(e,[{key:"addSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(this.sheetNamePrefix).concat(this.lastSheetId+2),t=canonicalize(e);if(this.mappingFromCanonicalName.has(t))throw new SheetNameAlreadyTakenError(e);this.lastSheetId++;var n=new Sheet(this.lastSheetId,e);return this.store(n),n.id}},{key:"removeSheet",value:function(e){var t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}},{key:"getDisplayName",value:function(e){var t;return null===(t=this.mappingFromId.get(e))||void 0===t?void 0:t.displayName}},{key:"displayNames",value:regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$s(this.mappingFromCanonicalName.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.displayName;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"numberOfSheets",value:function(){return this.mappingFromCanonicalName.size}},{key:"hasSheetWithId",value:function(e){return this.mappingFromId.has(e)}},{key:"hasSheetWithName",value:function(e){return this.mappingFromCanonicalName.has(canonicalize(e))}},{key:"renameSheet",value:function(e,t){var n=this.fetchSheetById(e),r=n.displayName;if(r!==t){var a=this.mappingFromCanonicalName.get(canonicalize(t));if(void 0!==a&&a.id!==n.id)throw new SheetNameAlreadyTakenError(t);var i=n.canonicalName;return this.mappingFromCanonicalName.delete(i),n.displayName=t,this.store(n),r}}},{key:"sheetNames",value:function(){return Array.from(this.mappingFromId.values()).map((function(e){return e.displayName}))}},{key:"store",value:function(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}},{key:"fetchSheetById",value:function(e){var t=this.mappingFromId.get(e);if(void 0===t)throw new NoSheetWithIdError(e);return t}}]),e}();function _construct(e,t,n){return _construct=_isNativeReflectConstruct$S()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf$S(a,n.prototype),a},_construct.apply(null,arguments)}function _isNativeReflectConstruct$S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _setPrototypeOf$S(e,t){return _setPrototypeOf$S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$S(e,t)}function _toConsumableArray$a(e){return _arrayWithoutHoles$a(e)||_iterableToArray$a(e)||_unsupportedIterableToArray$A(e)||_nonIterableSpread$a()}function _nonIterableSpread$a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$a(e){if(Array.isArray(e))return _arrayLikeToArray$A(e)}function _createForOfIteratorHelper$r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$A(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray$l(e,t){return _arrayWithHoles$l(e)||_iterableToArrayLimit$l(e,t)||_unsupportedIterableToArray$A(e,t)||_nonIterableRest$l()}function _nonIterableRest$l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$A(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$A(e,t):void 0}}function _arrayLikeToArray$A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$l(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$l(e){if(Array.isArray(e))return e}function _classCallCheck$1l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1l(e,t,n){return t&&_defineProperties$1l(e.prototype,t),n&&_defineProperties$1l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var DependencyGraph=function(){function e(t,n,r,a,i,o,s,l){var u=this;_classCallCheck$1l(this,e),this.addressMapping=t,this.rangeMapping=n,this.sheetMapping=r,this.arrayMapping=a,this.stats=i,this.lazilyTransformingAstService=o,this.functionRegistry=s,this.namedExpressions=l,this.changes=ContentChanges.empty(),this.dependencyQueryAddresses=function(e){if(e instanceof RangeVertex)return u.rangeDependencyQuery(e).map((function(e){var t=_slicedToArray$l(e,2),n=t[0];return t[1],n}));var t=u.formulaDependencyQuery(e);if(void 0!==t){var n=_slicedToArray$l(t,2),r=n[0];return n[1].map((function(e){return e instanceof NamedExpressionDependency?u.namedExpressions.namedExpressionOrPlaceholder(e.name,r.sheet).address:isSimpleCellAddress(e)?e:simpleCellRange(e.start,e.end)}))}return[]},this.dependencyQueryVertices=function(e){if(e instanceof RangeVertex)return u.rangeDependencyQuery(e).map((function(e){var t=_slicedToArray$l(e,2);return t[0],t[1]}));var t=u.formulaDependencyQuery(e);if(void 0!==t){var n=_slicedToArray$l(t,2),r=n[0];return n[1].map((function(e){if(e instanceof AbsoluteCellRange)return u.rangeMapping.fetchRange(e.start,e.end);if(e instanceof NamedExpressionDependency){var t=u.namedExpressions.namedExpressionOrPlaceholder(e.name,r.sheet);return u.addressMapping.fetchCell(t.address)}return u.addressMapping.fetchCell(e)}))}return[]},this.rangeDependencyQuery=function(e){var t,n=[],r=u.rangeMapping.findSmallerRange(e.range),a=r.smallerRangeVertex,i=r.restRange;void 0!==a&&u.graph.adjacentNodes(a).has(e)?(t=i,n.push([new AbsoluteCellRange(a.start,a.end),a])):t=e.range;var o,s=_createForOfIteratorHelper$r(t.addresses(u));try{for(s.s();!(o=s.n()).done;){var l=o.value,c=u.addressMapping.getCell(l);c instanceof EmptyCellVertex&&(c.address=l),void 0!==c&&n.push([l,c])}}catch(e){s.e(e)}finally{s.f()}return n},this.formulaDependencyQuery=function(e){var t,n;if(e instanceof FormulaVertex){n=e.getAddress(u.lazilyTransformingAstService),t=e.getFormula(u.lazilyTransformingAstService);var r=collectDependencies(t,u.functionRegistry);return[n,absolutizeDependencies(r,n)]}},this.graph=new Graph(this.dependencyQueryVertices)}return _createClass$1l(e,[{key:"setFormulaToCell",value:function(e,t,n,r,a,i){var o=FormulaVertex.fromAst(t,e,r,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(o),this.processCellDependencies(n,o),this.graph.markNodeAsSpecialRecentlyChanged(o),a&&this.markAsVolatile(o),i&&this.markAsDependentOnStructureChange(o),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}},{key:"setParsingErrorToCell",value:function(e,t){var n=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(n,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsSpecialRecentlyChanged(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}},{key:"setValueToCell",value:function(e,t){var n=this.shrinkPossibleArrayAndGetCell(e);if(n instanceof ArrayVertex&&this.arrayMapping.removeArray(n.getRange()),n instanceof ValueCellVertex){n.getValues().rawValue!==t.rawValue&&(n.setValues(t),this.graph.markNodeAsSpecialRecentlyChanged(n))}else{var r=new ValueCellVertex(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(n,r),this.addressMapping.setCell(e,r),this.graph.markNodeAsSpecialRecentlyChanged(r)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}},{key:"setCellEmpty",value:function(e){var t=this.shrinkPossibleArrayAndGetCell(e);if(void 0===t)return ContentChanges.empty();if(this.graph.adjacentNodes(t).size>0){var n=new EmptyCellVertex(e);this.exchangeGraphNode(t,n),0===this.graph.adjacentNodesCount(n)?(this.removeVertex(n),this.addressMapping.removeCell(e)):(this.graph.markNodeAsSpecialRecentlyChanged(n),this.addressMapping.setCell(e,n))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}},{key:"ensureThatVertexIsNonArrayCellVertex",value:function(e){if(e instanceof ArrayVertex)throw new Error("Illegal operation")}},{key:"clearRecentlyChangedVertices",value:function(){this.graph.clearSpecialNodesRecentlyChanged()}},{key:"verticesToRecompute",value:function(){return new Set([].concat(_toConsumableArray$a(this.graph.specialNodesRecentlyChanged),_toConsumableArray$a(this.volatileVertices())))}},{key:"processCellDependencies",value:function(e,t){var n=this;e.forEach((function(e){if(e instanceof AbsoluteCellRange){var r=e,a=n.getRange(r.start,r.end);void 0===a&&(a=new RangeVertex(r),n.rangeMapping.setRange(a)),n.graph.addNode(a),r.isFinite()||n.graph.markNodeAsInfiniteRange(a);var i=n.rangeMapping.findSmallerRange(r),o=i.smallerRangeVertex,s=i.restRange;if(void 0!==o){if(n.graph.addEdge(o,a),a.bruteForce){a.bruteForce=!1;var l,u=_createForOfIteratorHelper$r(r.addresses(n));try{for(u.s();!(l=u.n()).done;){var c=l.value;n.graph.removeEdge(n.fetchCell(c),a)}}catch(e){u.e(e)}finally{u.f()}}}else a.bruteForce=!0;var p=n.arrayMapping.getArray(s);if(void 0!==p)n.graph.addEdge(p,a);else{var d,m=_createForOfIteratorHelper$r(s.addresses(n));try{for(m.s();!(d=m.n()).done;){var f=d.value;n.graph.addEdge(n.fetchCellOrCreateEmpty(f),a)}}catch(e){m.e(e)}finally{m.f()}}n.graph.addEdge(a,t),r.isFinite()&&n.correctInfiniteRangesDependenciesByRangeVertex(a)}else if(e instanceof NamedExpressionDependency){var h=t.getAddress(n.lazilyTransformingAstService).sheet,y=n.fetchNamedExpressionVertex(e.name,h);n.graph.addEdge(y,t)}else n.graph.addEdge(n.fetchCellOrCreateEmpty(e),t)}))}},{key:"fetchNamedExpressionVertex",value:function(e,t){var n=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(n.address)}},{key:"exchangeNode",value:function(e,t){var n=this.fetchCellOrCreateEmpty(e),r=this.fetchCellOrCreateEmpty(t);this.addressMapping.removeCell(e),this.exchangeGraphNode(n,r)}},{key:"correctInfiniteRangesDependency",value:function(e){var t,n=void 0,r=_createForOfIteratorHelper$r(this.graph.infiniteRanges);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.range.addressInRange(e)&&(n=null!=n?n:this.fetchCellOrCreateEmpty(e),this.graph.addEdge(n,a))}}catch(e){r.e(e)}finally{r.f()}}},{key:"fetchCellOrCreateEmpty",value:function(e){var t=this.addressMapping.getCell(e);return void 0===t&&(t=new EmptyCellVertex(e),this.graph.addNode(t),this.addressMapping.setCell(e,t)),t}},{key:"removeRows",value:function(e){var t=this;this.stats.measure(StatType.ADJUSTING_GRAPH,(function(){var n,r=_createForOfIteratorHelper$r(t.addressMapping.entriesFromRowsSpan(e));try{for(r.s();!(n=r.n()).done;){var a,i=_slicedToArray$l(n.value,2),o=i[0],s=i[1],l=_createForOfIteratorHelper$r(t.graph.adjacentNodes(s));try{for(l.s();!(a=l.n()).done;){var u=a.value;t.graph.markNodeAsSpecialRecentlyChanged(u)}}catch(e){l.e(e)}finally{l.f()}if(s instanceof ArrayVertex){if(!s.isLeftCorner(o))continue;t.shrinkArrayToCorner(s),t.arrayMapping.removeArray(s.getRange())}t.removeVertex(s)}}catch(e){r.e(e)}finally{r.f()}})),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,(function(){t.addressMapping.removeRows(e)}));var n=this.stats.measure(StatType.ADJUSTING_RANGES,(function(){var n=t.truncateRanges(e,(function(e){return e.row}));return t.getArrayVerticesRelatedToRanges(n)}));return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,(function(){t.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)})),this.addStructuralNodesToChangeSet(),{affectedArrays:n,contentChanges:this.getAndClearContentChanges()}}},{key:"removeSheet",value:function(e){var t,n=this,r=new Set,a=_createForOfIteratorHelper$r(this.addressMapping.sheetEntries(e));try{for(a.s();!(t=a.n()).done;){var i=_slicedToArray$l(t.value,2),o=i[0],s=i[1];if(s instanceof ArrayVertex){if(r.has(s))continue;r.add(s)}var l,u=_createForOfIteratorHelper$r(this.graph.adjacentNodes(s));try{for(u.s();!(l=u.n()).done;){var c=l.value;this.graph.markNodeAsSpecialRecentlyChanged(c)}}catch(e){u.e(e)}finally{u.f()}this.removeVertex(s),this.addressMapping.removeCell(o)}}catch(e){a.e(e)}finally{a.f()}this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,(function(){var e,t=_createForOfIteratorHelper$r(r.values());try{for(t.s();!(e=t.n()).done;){var a=e.value;n.arrayMapping.removeArray(a.getRange())}}catch(e){t.e(e)}finally{t.f()}})),this.stats.measure(StatType.ADJUSTING_RANGES,(function(){var t,r=_createForOfIteratorHelper$r(n.rangeMapping.removeRangesInSheet(e));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.removeVertex(a)}}catch(e){r.e(e)}finally{r.f()}n.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,(function(){n.addressMapping.removeSheet(e)}))})),this.addStructuralNodesToChangeSet()}},{key:"clearSheet",value:function(e){var t,n=new Set,r=_createForOfIteratorHelper$r(this.addressMapping.sheetEntries(e));try{for(r.s();!(t=r.n()).done;){var a=_slicedToArray$l(t.value,2),i=a[0],o=a[1];o instanceof ArrayVertex?n.add(o):this.setCellEmpty(i)}}catch(e){r.e(e)}finally{r.f()}var s,l=_createForOfIteratorHelper$r(n.values());try{for(l.s();!(s=l.n()).done;){var u=s.value;this.setArrayEmpty(u)}}catch(e){l.e(e)}finally{l.f()}this.addStructuralNodesToChangeSet()}},{key:"removeColumns",value:function(e){var t=this;this.stats.measure(StatType.ADJUSTING_GRAPH,(function(){var n,r=_createForOfIteratorHelper$r(t.addressMapping.entriesFromColumnsSpan(e));try{for(r.s();!(n=r.n()).done;){var a,i=_slicedToArray$l(n.value,2),o=i[0],s=i[1],l=_createForOfIteratorHelper$r(t.graph.adjacentNodes(s));try{for(l.s();!(a=l.n()).done;){var u=a.value;t.graph.markNodeAsSpecialRecentlyChanged(u)}}catch(e){l.e(e)}finally{l.f()}if(s instanceof ArrayVertex){if(!s.isLeftCorner(o))continue;t.shrinkArrayToCorner(s),t.arrayMapping.removeArray(s.getRange())}t.removeVertex(s)}}catch(e){r.e(e)}finally{r.f()}})),this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,(function(){t.addressMapping.removeColumns(e)}));var n=this.stats.measure(StatType.ADJUSTING_RANGES,(function(){var n=t.truncateRanges(e,(function(e){return e.col}));return t.getArrayVerticesRelatedToRanges(n)}));return this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,(function(){return t.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns)})),this.addStructuralNodesToChangeSet(),{affectedArrays:n,contentChanges:this.getAndClearContentChanges()}}},{key:"addRows",value:function(e){var t=this;this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,(function(){t.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)}));var n=this.stats.measure(StatType.ADJUSTING_RANGES,(function(){var n=t.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return t.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),t.getArrayVerticesRelatedToRanges(n.verticesWithChangedSize)}));this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,(function(){t.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)}));var r,a=_createForOfIteratorHelper$r(this.addressMapping.verticesFromRowsSpan(e));try{for(a.s();!(r=a.n()).done;){var i=r.value;this.graph.markNodeAsSpecialRecentlyChanged(i)}}catch(e){a.e(e)}finally{a.f()}return this.addStructuralNodesToChangeSet(),{affectedArrays:n}}},{key:"addColumns",value:function(e){var t=this;this.stats.measure(StatType.ADJUSTING_ADDRESS_MAPPING,(function(){t.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)}));var n=this.stats.measure(StatType.ADJUSTING_RANGES,(function(){var n=t.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return t.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),t.getArrayVerticesRelatedToRanges(n.verticesWithChangedSize)}));this.stats.measure(StatType.ADJUSTING_ARRAY_MAPPING,(function(){return t.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns)}));var r,a=_createForOfIteratorHelper$r(this.addressMapping.verticesFromColumnsSpan(e));try{for(a.s();!(r=a.n()).done;){var i=r.value;this.graph.markNodeAsSpecialRecentlyChanged(i)}}catch(e){a.e(e)}finally{a.f()}return this.addStructuralNodesToChangeSet(),{affectedArrays:n,contentChanges:this.getAndClearContentChanges()}}},{key:"ensureNoArrayInRange",value:function(e){if(this.arrayMapping.isFormulaArrayInRange(e))throw Error("It is not possible to move / replace cells with array")}},{key:"isThereSpaceForArray",value:function(e){var t=e.getRangeOrUndef();if(void 0===t)return!1;var n,r=_createForOfIteratorHelper$r(t.addresses(this));try{for(r.s();!(n=r.n()).done;){var a=n.value,i=this.addressMapping.getCell(a);if(void 0!==i&&!(i instanceof EmptyCellVertex)&&i!==e)return!1}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"moveCells",value:function(e,t,n,r){var a,i=_createForOfIteratorHelper$r(e.addressesWithDirection(t,n,this));try{for(i.s();!(a=i.n()).done;){var o=a.value,s=simpleCellAddress(r,o.col+t,o.row+n),l=this.addressMapping.getCell(o),u=this.addressMapping.getCell(s);if(this.addressMapping.removeCell(o),void 0!==l){this.graph.markNodeAsSpecialRecentlyChanged(l),this.addressMapping.setCell(s,l);var c,p=void 0,d=_createForOfIteratorHelper$r(this.graph.adjacentNodes(l));try{for(d.s();!(c=d.n()).done;){var m=c.value;m instanceof RangeVertex&&!e.containsRange(m.range)&&(p=null!=p?p:this.fetchCellOrCreateEmpty(o),this.graph.addEdge(p,m),this.graph.removeEdge(l,m))}}catch(e){d.e(e)}finally{d.f()}p&&(this.graph.markNodeAsSpecialRecentlyChanged(p),this.addressMapping.setCell(o,p))}if(void 0!==u){void 0===l&&this.addressMapping.removeCell(s);var f,h=_createForOfIteratorHelper$r(this.graph.adjacentNodes(u));try{for(h.s();!(f=h.n()).done;){var y=f.value;l=null!=l?l:this.fetchCellOrCreateEmpty(s),this.graph.addEdge(l,y),this.graph.markNodeAsSpecialRecentlyChanged(l)}}catch(e){h.e(e)}finally{h.f()}this.removeVertex(u)}}}catch(e){i.e(e)}finally{i.f()}var b,g=_createForOfIteratorHelper$r(this.rangeMapping.rangeVerticesContainedInRange(e));try{for(g.s();!(b=g.n()).done;){var v,T=b.value,C=_createForOfIteratorHelper$r(this.graph.adjacentNodes(T));try{for(C.s();!(v=C.n()).done;){var N=v.value;if(N instanceof RangeVertex&&!e.containsRange(N.range)){this.graph.removeEdge(T,N);var A,S=_createForOfIteratorHelper$r(T.range.addresses(this));try{for(S.s();!(A=S.n()).done;){var w=A.value,x=this.fetchCellOrCreateEmpty(w);this.graph.addEdge(x,N),this.addressMapping.setCell(w,x),this.graph.markNodeAsSpecialRecentlyChanged(x)}}catch(e){S.e(e)}finally{S.f()}}}}catch(e){C.e(e)}finally{C.f()}}}catch(e){g.e(e)}finally{g.f()}this.rangeMapping.moveRangesInsideSourceRange(e,t,n,r)}},{key:"setArrayEmpty",value:function(e){var t,n=AbsoluteCellRange.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e),a=_createForOfIteratorHelper$r(n.addresses(this));try{for(a.s();!(t=a.n()).done;){var i=t.value;this.addressMapping.removeCell(i)}}catch(e){a.e(e)}finally{a.f()}var o,s=_createForOfIteratorHelper$r(r.values());try{for(s.s();!(o=s.n()).done;){var l,u=o.value,c=collectAddressesDependentToRange(this.functionRegistry,u,e.getRange(),this.lazilyTransformingAstService,this),p=_createForOfIteratorHelper$r(c);try{for(p.s();!(l=p.n()).done;){var d=l.value,m=this.fetchCellOrCreateEmpty(d);this.graph.addEdge(m,u)}}catch(e){p.e(e)}finally{p.f()}c.length>0&&this.graph.markNodeAsSpecialRecentlyChanged(u)}}catch(e){s.e(e)}finally{s.f()}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}},{key:"addVertex",value:function(e,t){this.graph.addNode(t),this.addressMapping.setCell(e,t)}},{key:"addArrayVertex",value:function(e,t){this.graph.addNode(t),this.setAddressMappingForArrayVertex(t,e)}},{key:"arrayFormulaNodes",value:regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$r(this.graph.nodes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=10;break}if(!((r=n.value)instanceof ArrayVertex)){e.next=8;break}return e.next=8,r;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))},{key:"entriesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.addressMapping.entriesFromRowsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.addressMapping.entriesFromColumnsSpan(t),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"existsVertex",value:function(e){return this.addressMapping.has(e)}},{key:"fetchCell",value:function(e){return this.addressMapping.fetchCell(e)}},{key:"getCell",value:function(e){return this.addressMapping.getCell(e)}},{key:"getCellValue",value:function(e){return this.addressMapping.getCellValue(e)}},{key:"getRawValue",value:function(e){return this.addressMapping.getRawValue(e)}},{key:"getScalarValue",value:function(e){var t=this.addressMapping.getCellValue(e);return t instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected):t}},{key:"existsEdge",value:function(e,t){return this.graph.existsEdge(e,t)}},{key:"getSheetId",value:function(e){return this.sheetMapping.fetch(e)}},{key:"getSheetHeight",value:function(e){return this.addressMapping.getHeight(e)}},{key:"getSheetWidth",value:function(e){return this.addressMapping.getWidth(e)}},{key:"getArray",value:function(e){return this.arrayMapping.getArray(e)}},{key:"setArray",value:function(e,t){this.arrayMapping.setArray(e,t)}},{key:"getRange",value:function(e,t){return this.rangeMapping.getRange(e,t)}},{key:"topSortWithScc",value:function(){return this.graph.topSortWithScc()}},{key:"markAsVolatile",value:function(e){this.graph.markNodeAsSpecial(e)}},{key:"markAsDependentOnStructureChange",value:function(e){this.graph.markNodeAsChangingWithStructure(e)}},{key:"forceApplyPostponedTransformations",value:function(){var e,t=_createForOfIteratorHelper$r(this.graph.nodes.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n instanceof FormulaCellVertex&&n.ensureRecentData(this.lazilyTransformingAstService)}}catch(e){t.e(e)}finally{t.f()}}},{key:"volatileVertices",value:function(){return this.graph.specialNodes}},{key:"getArrayVerticesRelatedToRanges",value:function(e){var t=this,n=e.map((function(e){return t.graph.hasNode(e)?Array.from(t.graph.adjacentNodes(e)).filter((function(e){return e instanceof ArrayVertex})):[]}));return _construct(Set,_toConsumableArray$a(n))}},{key:"rawValuesFromRange",value:regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$r(t.addresses(this)),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}if(a=r.value,(i=this.getScalarValue(a))===EmptyValue){e.next=9;break}return e.next=9,[getRawValue(i),a];case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])}))},{key:"entriesFromRange",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$r(t.addresses(this)),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return a=r.value,e.next=7,[a,this.getCell(a)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"exchangeGraphNode",value:function(e,t){var n=this;this.graph.addNode(t);var r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach((function(e){n.graph.hasNode(e)&&n.graph.addEdge(t,e)}))}},{key:"exchangeOrAddGraphNode",value:function(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNode(t)}},{key:"computeListOfValuesInRange",value:function(e){var t,n=[],r=_createForOfIteratorHelper$r(e.addresses(this));try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.getScalarValue(a);n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"shrinkArrayToCorner",value:function(e){this.cleanAddressMappingUnderArray(e);var t,n=_createForOfIteratorHelper$r(this.adjacentArrayVertices(e));try{for(n.s();!(t=n.n()).done;){var r=t.value,a=void 0;a=r instanceof FormulaVertex?this.formulaDirectDependenciesToArray(r,e):this.rangeDirectDependenciesToArray(r,e);var i,o=!1,s=_createForOfIteratorHelper$r(a);try{for(s.s();!(i=s.n()).done;){var l=_slicedToArray$l(i.value,2),u=l[0],c=l[1];e.isLeftCorner(u)&&(o=!0),this.graph.addEdge(c,r),this.graph.markNodeAsSpecialRecentlyChanged(c)}}catch(e){s.e(e)}finally{s.f()}o||this.graph.removeEdge(e,r)}}catch(e){n.e(e)}finally{n.f()}this.graph.markNodeAsSpecialRecentlyChanged(e)}},{key:"isArrayInternalCell",value:function(e){var t=this.getCell(e);return t instanceof ArrayVertex&&!t.isLeftCorner(e)}},{key:"getAndClearContentChanges",value:function(){var e=this.changes;return this.changes=ContentChanges.empty(),e}},{key:"getAdjacentNodesAddresses",value:function(e){var t=this,n=this.graph.adjacentNodes(e),r=[];return n.forEach((function(e){var n=e;n instanceof RangeVertex?r.push(simpleCellRange(n.start,n.end)):r.push(n.getAddress(t.lazilyTransformingAstService))})),r}},{key:"correctInfiniteRangesDependenciesByRangeVertex",value:function(e){var t,n=_createForOfIteratorHelper$r(this.graph.infiniteRanges);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r,i=e.range.intersectionWith(a.range);if(void 0!==i){var o,s=_createForOfIteratorHelper$r(i.addresses(this));try{for(s.s();!(o=s.n()).done;){var l=o.value;this.graph.addEdge(this.fetchCellOrCreateEmpty(l),r)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"cleanAddressMappingUnderArray",value:function(e){var t,n=_createForOfIteratorHelper$r(e.getRange().addresses(this));try{for(n.s();!(t=n.n()).done;){var r=t.value,a=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new CellError(ErrorType.REF),r,a):(this.addressMapping.removeCell(r),this.changes.addChange(EmptyValue,r,a)):this.changes.addChange(EmptyValue,r,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"formulaDirectDependenciesToArray",value:regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,l,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!==(r=this.formulaDependencyQuery(t))&&void 0!==r?r:[],i=_slicedToArray$l(a,2),void 0!==(o=i[1])){e.next=3;break}return e.abrupt("return");case 3:s=_createForOfIteratorHelper$r(o),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=16;break}if(!((u=l.value)instanceof NamedExpressionDependency||u instanceof AbsoluteCellRange)){e.next=10;break}return e.abrupt("continue",14);case 10:if(!n.getRange().addressInRange(u)){e.next=14;break}return c=this.fetchCellOrCreateEmpty(u),e.next=14,[u,c];case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),s.e(e.t0);case 21:return e.prev=21,s.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[4,18,21,24]])}))},{key:"rangeDirectDependenciesToArray",value:regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.rangeMapping.findSmallerRange(t.range),a=r.restRange,i=_createForOfIteratorHelper$r(a.addresses(this)),e.prev=2,i.s();case 4:if((o=i.n()).done){e.next=12;break}if(s=o.value,!n.getRange().addressInRange(s)){e.next=10;break}return l=this.fetchCellOrCreateEmpty(s),e.next=10,[s,l];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])}))},{key:"adjacentArrayVertices",value:regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.graph.adjacentNodes(t),r=_createForOfIteratorHelper$r(n),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=11;break}if(!((i=a.value)instanceof FormulaVertex||i instanceof RangeVertex)){e.next=9;break}return e.next=9,i;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))},{key:"addStructuralNodesToChangeSet",value:function(){var e,t=_createForOfIteratorHelper$r(this.graph.specialNodesStructuralChanges);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.graph.markNodeAsSpecialRecentlyChanged(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"fixRangesWhenAddingRows",value:function(e,t,n){for(var r=0,a=Array.from(this.rangeMapping.rangesInSheet(e));r<a.length;r++){var i=a[r];if(i.range.includesRow(t+n))if(i.bruteForce){var o,s=_createForOfIteratorHelper$r(i.range.rangeWithSameWidth(t,n).addresses(this));try{for(s.s();!(o=s.n()).done;){var l=o.value;this.graph.addEdge(this.fetchCellOrCreateEmpty(l),i)}}catch(e){s.e(e)}finally{s.f()}}else{var u=i,c=this.rangeMapping.findSmallerRange(u.range);if(void 0!==c.smallerRangeVertex)continue;for(;void 0===c.smallerRangeVertex;){var p=new RangeVertex(AbsoluteCellRange.spanFrom(u.range.start,u.range.width(),u.range.height()-1));this.rangeMapping.setRange(p),this.graph.addNode(p);var d=new AbsoluteCellRange(simpleCellAddress(u.range.start.sheet,u.range.start.col,u.range.end.row),u.range.end);this.addAllFromRange(d,u),this.graph.addEdge(p,u),u=p,c=this.rangeMapping.findSmallerRange(u.range)}this.graph.addEdge(c.smallerRangeVertex,u),this.addAllFromRange(c.restRange,u),this.graph.removeEdge(c.smallerRangeVertex,i)}}}},{key:"addAllFromRange",value:function(e,t){var n,r=_createForOfIteratorHelper$r(e.addresses(this));try{for(r.s();!(n=r.n()).done;){var a=n.value;this.graph.addEdge(this.fetchCellOrCreateEmpty(a),t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"fixRangesWhenAddingColumns",value:function(e,t,n){var r,a=_createForOfIteratorHelper$r(this.rangeMapping.rangesInSheet(e));try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.range.includesColumn(t+n)){var o,s=_createForOfIteratorHelper$r((i.bruteForce?i.range.rangeWithSameHeight(t,n):AbsoluteCellRange.spanFrom(simpleCellAddress(e,t,i.range.end.row),n,1)).addresses(this));try{for(s.s();!(o=s.n()).done;){var l=o.value;this.graph.addEdge(this.fetchCellOrCreateEmpty(l),i)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){a.e(e)}finally{a.f()}}},{key:"exchangeOrAddFormulaVertex",value:function(e){var t=e.getAddress(this.lazilyTransformingAstService),n=AbsoluteCellRange.spanFrom(t,e.width,e.height),r=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof ArrayVertex&&this.setArray(n,e),this.exchangeOrAddGraphNode(r,e),this.addressMapping.setCell(t,e),e instanceof ArrayVertex){if(!this.isThereSpaceForArray(e))return;var a,i=_createForOfIteratorHelper$r(n.addresses(this));try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!e.isLeftCorner(o)){var s=this.getCell(o);this.exchangeOrAddGraphNode(s,e)}}}catch(e){i.e(e)}finally{i.f()}}var l,u=_createForOfIteratorHelper$r(n.addresses(this));try{for(u.s();!(l=u.n()).done;){var c=l.value;this.addressMapping.setCell(c,e)}}catch(e){u.e(e)}finally{u.f()}}},{key:"setAddressMappingForArrayVertex",value:function(e,t){if(this.addressMapping.setCell(t,e),e instanceof ArrayVertex){var n=AbsoluteCellRange.spanFromOrUndef(t,e.width,e.height);if(void 0!==n&&(this.setArray(n,e),this.isThereSpaceForArray(e))){var r,a=_createForOfIteratorHelper$r(n.addresses(this));try{for(a.s();!(r=a.n()).done;){var i=r.value;this.addressMapping.setCell(i,e)}}catch(e){a.e(e)}finally{a.f()}}}}},{key:"truncateRanges",value:function(e,t){var n,r=this.rangeMapping.truncateRanges(e,t),a=r.verticesToRemove,i=r.verticesToMerge,o=r.verticesWithChangedSize,s=_createForOfIteratorHelper$r(i);try{for(s.s();!(n=s.n()).done;){var l=_slicedToArray$l(n.value,2),u=l[0],c=l[1];this.mergeRangeVertices(u,c)}}catch(e){s.e(e)}finally{s.f()}var p,d=_createForOfIteratorHelper$r(a);try{for(d.s();!(p=d.n()).done;){var m=p.value;this.removeVertexAndCleanupDependencies(m)}}catch(e){d.e(e)}finally{d.f()}return o}},{key:"fixArraysAfterAddingRow",value:function(e,t,n){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,n),!(t<=0)){var r,a=_createForOfIteratorHelper$r(this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(e,t-1,t-1)));try{for(a.s();!(r=a.n()).done;)for(var i=_slicedToArray$l(r.value,2)[1],o=i.getRange(),s=o.start.col;s<=o.end.col;++s)for(var l=t;l<=o.end.row;++l){var u=simpleCellAddress(e,s,l),c=simpleCellAddress(e,s,l+n),p=i.getArrayCellValue(u);this.addressMapping.moveCell(c,u),this.changes.addChange(EmptyValue,c,p)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"fixArraysAfterRemovingRows",value:function(e,t,n){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-n),!(t<=0)){var r,a=_createForOfIteratorHelper$r(this.arrayMapping.arraysInRows(RowsSpan.fromRowStartAndEnd(e,t-1,t-1)));try{for(a.s();!(r=a.n()).done;){var i=_slicedToArray$l(r.value,2)[1];if(this.isThereSpaceForArray(i)){var o,s=_createForOfIteratorHelper$r(i.getRange().addresses(this));try{for(s.s();!(o=s.n()).done;){var l=o.value;this.addressMapping.setCell(l,i)}}catch(e){s.e(e)}finally{s.f()}}else this.setNoSpaceIfArray(i)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"fixArraysAfterAddingColumn",value:function(e,t,n){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,n),!(t<=0)){var r,a=_createForOfIteratorHelper$r(this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1)));try{for(a.s();!(r=a.n()).done;)for(var i=_slicedToArray$l(r.value,2)[1],o=i.getRange(),s=o.start.row;s<=o.end.row;++s)for(var l=t;l<=o.end.col;++l){var u=simpleCellAddress(e,l,s),c=simpleCellAddress(e,l+n,s),p=i.getArrayCellValue(u);this.addressMapping.moveCell(c,u),this.changes.addChange(EmptyValue,c,p)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"fixArraysAfterRemovingColumns",value:function(e,t,n){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-n),!(t<=0)){var r,a=_createForOfIteratorHelper$r(this.arrayMapping.arraysInCols(ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1)));try{for(a.s();!(r=a.n()).done;){var i=_slicedToArray$l(r.value,2)[1];if(this.isThereSpaceForArray(i)){var o,s=_createForOfIteratorHelper$r(i.getRange().addresses(this));try{for(s.s();!(o=s.n()).done;){var l=o.value;this.addressMapping.setCell(l,i)}}catch(e){s.e(e)}finally{s.f()}}else this.setNoSpaceIfArray(i)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"shrinkPossibleArrayAndGetCell",value:function(e){var t=this.getCell(e);return t instanceof ArrayVertex?(this.setNoSpaceIfArray(t),this.getCell(e)):t}},{key:"setNoSpaceIfArray",value:function(e){e instanceof ArrayVertex&&(this.shrinkArrayToCorner(e),e.setNoSpace())}},{key:"removeVertex",value:function(e){this.removeVertexAndCleanupDependencies(e),e instanceof RangeVertex&&this.rangeMapping.removeRange(e)}},{key:"mergeRangeVertices",value:function(e,t){var n=this,r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.softRemoveEdge(e,t),r.forEach((function(t){n.graph.hasNode(t)&&n.graph.addEdge(e,t)}))}},{key:"removeVertexAndCleanupDependencies",value:function(e){for(var t=new Set(this.graph.removeNode(e));t.size>0;){var n=t.values().next().value;t.delete(n),this.graph.hasNode(n)&&0===this.graph.adjacentNodesCount(n)&&((n instanceof RangeVertex||n instanceof EmptyCellVertex)&&this.graph.removeNode(n).forEach((function(e){return t.add(e)})),n instanceof RangeVertex?this.rangeMapping.removeRange(n):n instanceof EmptyCellVertex&&this.addressMapping.removeCell(n.address))}}}],[{key:"buildEmpty",value:function(t,n,r,a,i){return new e(new AddressMapping(n.chooseAddressMappingPolicy),new RangeMapping,new SheetMapping(n.translationPackage),new ArrayMapping,i,t,r,a)}}]),e}();function _classCallCheck$1k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1k(e,t,n){return t&&_defineProperties$1k(e.prototype,t),n&&_defineProperties$1k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var EmptyCellVertex=function(){function e(t){_classCallCheck$1k(this,e),this.address=t}return _createClass$1k(e,[{key:"getCellValue",value:function(){return EmptyValue}}]),e}();function _classCallCheck$1j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1j(e,t,n){return t&&_defineProperties$1j(e.prototype,t),n&&_defineProperties$1j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var ValueCellVertex=function(){function e(t,n){_classCallCheck$1j(this,e),this.parsedValue=t,this.rawValue=n}return _createClass$1j(e,[{key:"getValues",value:function(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}},{key:"setValues",value:function(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}},{key:"getCellValue",value:function(){return this.parsedValue}},{key:"setCellValue",value:function(e){throw"SetCellValue is deprecated for ValueCellVertex"}}]),e}();function _classCallCheck$1i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1i(e,t,n){return t&&_defineProperties$1i(e.prototype,t),n&&_defineProperties$1i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ParsingErrorVertex=function(){function e(t,n){_classCallCheck$1i(this,e),this.errors=t,this.rawInput=n}return _createClass$1i(e,[{key:"getCellValue",value:function(){return CellError.parsingError()}},{key:"getFormula",value:function(){return this.rawInput}}]),e}();function _slicedToArray$k(e,t){return _arrayWithHoles$k(e)||_iterableToArrayLimit$k(e,t)||_unsupportedIterableToArray$z(e,t)||_nonIterableRest$k()}function _nonIterableRest$k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$k(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$k(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$z(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$z(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$z(e,t):void 0}}function _arrayLikeToArray$z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1h(e,t,n){return t&&_defineProperties$1h(e.prototype,t),n&&_defineProperties$1h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var SparseStrategy=function(){function e(t,n){_classCallCheck$1h(this,e),this.width=t,this.height=n,this.mapping=new Map}return _createClass$1h(e,[{key:"getCell",value:function(e){var t;return null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row)}},{key:"setCell",value:function(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);var n=this.mapping.get(e.col);n||(n=new Map,this.mapping.set(e.col,n)),n.set(e.row,t)}},{key:"has",value:function(e){var t;return!!(null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row))}},{key:"getHeight",value:function(){return this.height}},{key:"getWidth",value:function(){return this.width}},{key:"removeCell",value:function(e){var t;null===(t=this.mapping.get(e.col))||void 0===t||t.delete(e.row)}},{key:"addRows",value:function(e,t){this.mapping.forEach((function(n){var r=new Map;n.forEach((function(a,i){i>=e&&(r.set(i+t,a),n.delete(i))})),r.forEach((function(e,t){n.set(t,e)}))})),this.height+=t}},{key:"addColumns",value:function(e,t){var n=this,r=new Map;this.mapping.forEach((function(a,i){i>=e&&(r.set(i+t,a),n.mapping.delete(i))})),r.forEach((function(e,t){n.mapping.set(t,e)})),this.width+=t}},{key:"removeRows",value:function(e){this.mapping.forEach((function(t){var n=new Map;t.forEach((function(r,a){a>=e.rowStart&&(t.delete(a),a>e.rowEnd&&n.set(a-e.numberOfRows,r))})),n.forEach((function(e,n){t.set(n,e)}))}));var t=Math.min(this.height-1,e.rowEnd),n=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-n)}},{key:"removeColumns",value:function(e){var t=this,n=new Map;this.mapping.forEach((function(r,a){a>=e.columnStart&&(t.mapping.delete(a),a>e.columnEnd&&n.set(a-e.numberOfColumns,r))})),n.forEach((function(e,n){t.mapping.set(n,e)}));var r=Math.min(this.width-1,e.columnEnd),a=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-a)}},{key:"getEntries",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l,u,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(this.mapping),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=24;break}a=_slicedToArray$k(r.value,2),i=a[0],o=a[1],s=_createForOfIteratorHelper$q(o),e.prev=6,s.s();case 8:if((l=s.n()).done){e.next=14;break}return u=_slicedToArray$k(l.value,2),c=u[0],p=u[1],e.next=12,[simpleCellAddress(t,i,c),p];case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),s.e(e.t0);case 19:return e.prev=19,s.f(),e.finish(19);case 22:e.next=3;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(1),n.e(e.t1);case 29:return e.prev=29,n.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[1,26,29,32],[6,16,19,22]])}))},{key:"verticesFromColumn",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.mapping.get(t))){e.next=3;break}return e.abrupt("return");case 3:r=_createForOfIteratorHelper$q(n),e.prev=4,r.s();case 6:if((a=r.n()).done){e.next=12;break}return i=_slicedToArray$k(a.value,2),o=i[1],e.next=10,o;case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))},{key:"verticesFromRow",value:regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(this.mapping.values()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}if(a=r.value,void 0===(i=a.get(t))){e.next=9;break}return e.next=9,i;case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])}))},{key:"verticesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(t.columns()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=27;break}if(a=r.value,void 0!==(i=this.mapping.get(a))){e.next=8;break}return e.abrupt("continue",25);case 8:o=_createForOfIteratorHelper$q(i),e.prev=9,o.s();case 11:if((s=o.n()).done){e.next=17;break}return l=_slicedToArray$k(s.value,2),u=l[1],e.next=15,u;case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:e.next=3;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(1),n.e(e.t1);case 32:return e.prev=32,n.f(),e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[1,29,32,35],[9,19,22,25]])}))},{key:"verticesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(this.mapping.values()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=26;break}a=r.value,i=_createForOfIteratorHelper$q(t.rows()),e.prev=6,i.s();case 8:if((o=i.n()).done){e.next=16;break}if(s=o.value,void 0===(l=a.get(s))){e.next=14;break}return e.next=14,l;case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),i.e(e.t0);case 21:return e.prev=21,i.f(),e.finish(21);case 24:e.next=3;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(1),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[1,28,31,34],[6,18,21,24]])}))},{key:"entriesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(this.mapping.entries()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=26;break}a=_slicedToArray$k(r.value,2),i=a[0],o=a[1],s=_createForOfIteratorHelper$q(t.rows()),e.prev=6,s.s();case 8:if((l=s.n()).done){e.next=16;break}if(u=l.value,void 0===(c=o.get(u))){e.next=14;break}return e.next=14,[simpleCellAddress(t.sheet,i,u),c];case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),s.e(e.t0);case 21:return e.prev=21,s.f(),e.finish(21);case 24:e.next=3;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(1),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[1,28,31,34],[6,18,21,24]])}))},{key:"entriesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper$q(t.columns()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=26;break}if(a=r.value,void 0===(i=this.mapping.get(a))){e.next=24;break}o=_createForOfIteratorHelper$q(i.entries()),e.prev=8,o.s();case 10:if((s=o.n()).done){e.next=16;break}return l=_slicedToArray$k(s.value,2),u=l[0],c=l[1],e.next=14,[simpleCellAddress(t.sheet,a,u),c];case 14:e.next=10;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(8),o.e(e.t0);case 21:return e.prev=21,o.f(),e.finish(21);case 24:e.next=3;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(1),n.e(e.t1);case 31:return e.prev=31,n.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[1,28,31,34],[8,18,21,24]])}))},{key:"vertices",value:regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$q(this.mapping),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=25;break}r=_slicedToArray$k(n.value,2),a=r[1],i=_createForOfIteratorHelper$q(a),e.prev=6,i.s();case 8:if((o=i.n()).done){e.next=15;break}if(s=_slicedToArray$k(o.value,2),void 0===(l=s[1])){e.next=13;break}return e.next=13,l;case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:e.next=3;break;case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(1),t.e(e.t1);case 30:return e.prev=30,t.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[1,27,30,33],[6,17,20,23]])}))}]),e}();function _toConsumableArray$9(e){return _arrayWithoutHoles$9(e)||_iterableToArray$9(e)||_unsupportedIterableToArray$y(e)||_nonIterableSpread$9()}function _nonIterableSpread$9(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$y(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$y(e,t):void 0}}function _iterableToArray$9(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$9(e){if(Array.isArray(e))return _arrayLikeToArray$y(e)}function _arrayLikeToArray$y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1g(e,t,n){return t&&_defineProperties$1g(e.prototype,t),n&&_defineProperties$1g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var DenseStrategy=function(){function e(t,n){_classCallCheck$1g(this,e),this.width=t,this.height=n,this.mapping=new Array(n);for(var r=0;r<n;r++)this.mapping[r]=new Array(t)}return _createClass$1g(e,[{key:"getCell",value:function(e){return this.getCellVertex(e.col,e.row)}},{key:"setCell",value:function(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1),this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}},{key:"has",value:function(e){var t=this.mapping[e.row];return!!t&&!!t[e.col]}},{key:"getHeight",value:function(){return this.height}},{key:"getWidth",value:function(){return this.width}},{key:"removeCell",value:function(e){void 0!==this.mapping[e.row]&&delete this.mapping[e.row][e.col]}},{key:"addRows",value:function(e,t){for(var n,r=[],a=0;a<t;a++)r.push(new Array(this.width));(n=this.mapping).splice.apply(n,[e,0].concat(r)),this.height+=t}},{key:"addColumns",value:function(e,t){for(var n=0;n<this.height;n++){var r;(r=this.mapping[n]).splice.apply(r,[e,0].concat(_toConsumableArray$9(new Array(t))))}this.width+=t}},{key:"removeRows",value:function(e){this.mapping.splice(e.rowStart,e.numberOfRows);var t=Math.min(this.height-1,e.rowEnd),n=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-n)}},{key:"removeColumns",value:function(e){for(var t=0;t<this.height;t++)this.mapping[t].splice(e.columnStart,e.numberOfColumns);var n=Math.min(this.width-1,e.columnEnd),r=Math.max(0,n-e.columnStart+1);this.width=Math.max(0,this.width-r)}},{key:"getEntries",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.height)){e.next=14;break}r=0;case 3:if(!(r<this.width)){e.next=11;break}if(!(a=this.getCellVertex(r,n))){e.next=8;break}return e.next=8,[simpleCellAddress(t,r,n),a];case 8:++r,e.next=3;break;case 11:++n,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"verticesFromColumn",value:regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.height)){e.next=9;break}if(!(r=this.getCellVertex(t,n))){e.next=6;break}return e.next=6,r;case 6:++n,e.next=1;break;case 9:case"end":return e.stop()}}),e,this)}))},{key:"verticesFromRow",value:regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.width)){e.next=9;break}if(!(r=this.getCellVertex(n,t))){e.next=6;break}return e.next=6,r;case 6:++n,e.next=1;break;case 9:case"end":return e.stop()}}),e,this)}))},{key:"verticesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.columnStart;case 1:if(!(n<=t.columnEnd)){e.next=14;break}r=0;case 3:if(!(r<this.height)){e.next=11;break}if(!(a=this.getCellVertex(n,r))){e.next=8;break}return e.next=8,a;case 8:++r,e.next=3;break;case 11:++n,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"verticesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.width)){e.next=14;break}r=t.rowStart;case 3:if(!(r<=t.rowEnd)){e.next=11;break}if(!(a=this.getCellVertex(n,r))){e.next=8;break}return e.next=8,a;case 8:++r,e.next=3;break;case 11:++n,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromRowsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.width)){e.next=14;break}r=t.rowStart;case 3:if(!(r<=t.rowEnd)){e.next=11;break}if(!(a=this.getCellVertex(n,r))){e.next=8;break}return e.next=8,[simpleCellAddress(t.sheet,n,r),a];case 8:++r,e.next=3;break;case 11:++n,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"entriesFromColumnsSpan",value:regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.height)){e.next=14;break}r=t.columnStart;case 3:if(!(r<=t.columnEnd)){e.next=11;break}if(!(a=this.getCellVertex(r,n))){e.next=8;break}return e.next=8,[simpleCellAddress(t.sheet,r,n),a];case 8:++r,e.next=3;break;case 11:++n,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"vertices",value:regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.height)){e.next=14;break}n=0;case 3:if(!(n<this.width)){e.next=11;break}if(!(r=this.getCellVertex(n,t))){e.next=8;break}return e.next=8,r;case 8:++n,e.next=3;break;case 11:++t,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"getCellVertex",value:function(e,t){var n;return null===(n=this.mapping[t])||void 0===n?void 0:n[e]}}]),e}(),ErrorType,CellType;function _typeof$V(e){return _typeof$V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$V(e)}function _classCallCheck$1f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1f(e,t,n){return t&&_defineProperties$1f(e.prototype,t),n&&_defineProperties$1f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.DIV_BY_ZERO="DIV_BY_ZERO",e.NAME="NAME",e.VALUE="VALUE",e.NUM="NUM",e.NA="NA",e.CYCLE="CYCLE",e.REF="REF",e.SPILL="SPILL",e.LIC="LIC",e.ERROR="ERROR"}(ErrorType||(ErrorType={})),function(e){e.FORMULA="FORMULA",e.VALUE="VALUE",e.ARRAY="ARRAY",e.EMPTY="EMPTY",e.ARRAYFORMULA="ARRAYFORMULA"}(CellType||(CellType={}));var getCellType=function(e,t){return e instanceof ArrayVertex?e.isLeftCorner(t)?CellType.ARRAYFORMULA:CellType.ARRAY:e instanceof FormulaCellVertex||e instanceof ParsingErrorVertex?CellType.FORMULA:e instanceof ValueCellVertex?CellType.VALUE:CellType.EMPTY},CellValueNoNumber,CellValueJustNumber;!function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.ERROR="ERROR"}(CellValueNoNumber||(CellValueNoNumber={})),function(e){e.NUMBER="NUMBER"}(CellValueJustNumber||(CellValueJustNumber={}));var CellValueType=Object.assign(Object.assign({},CellValueNoNumber),CellValueJustNumber),CellValueDetailedType=Object.assign(Object.assign({},CellValueNoNumber),NumberType),CellValueTypeOrd=function(e){switch(e){case CellValueType.EMPTY:return 0;case CellValueType.NUMBER:return 1;case CellValueType.STRING:return 2;case CellValueType.BOOLEAN:return 3;case CellValueType.ERROR:return 4}throw new Error("Cell value not computed")},getCellValueType=function(e){if(e===EmptyValue)return CellValueType.EMPTY;if(e instanceof CellError||e instanceof SimpleRangeValue)return CellValueType.ERROR;if("string"==typeof e)return CellValueType.STRING;if(isExtendedNumber(e))return CellValueType.NUMBER;if("boolean"==typeof e)return CellValueType.BOOLEAN;throw new Error("Cell value not computed")},getCellValueDetailedType=function(e){return isExtendedNumber(e)?getTypeOfExtendedNumber(e):getCellValueType(e)},getCellValueFormat=function(e){return isExtendedNumber(e)?getFormatOfExtendedNumber(e):void 0},CellError=function(){function e(t,n,r){_classCallCheck$1f(this,e),this.type=t,this.message=n,this.root=r}return _createClass$1f(e,[{key:"attachRootVertex",value:function(t){return void 0===this.root?new e(this.type,this.message,t):this}}],[{key:"parsingError",value:function(){return new e(ErrorType.ERROR,ErrorMessage.ParseError)}}]),e}(),simpleRowAddress=function(e,t){return{sheet:e,row:t}},invalidSimpleRowAddress=function(e){return e.row<0},simpleColumnAddress=function(e,t){return{sheet:e,col:t}},invalidSimpleColumnAddress=function(e){return e.col<0},simpleCellAddress=function(e,t,n){return{sheet:e,col:t,row:n}},invalidSimpleCellAddress=function(e){return e.col<0||e.row<0},movedSimpleCellAddress=function(e,t,n,r){return simpleCellAddress(t,e.col+n,e.row+r)},addressKey=function(e){return"".concat(e.sheet,",").concat(e.row,",").concat(e.col)};function isSimpleCellAddress(e){return!(!e||"object"!==_typeof$V(e)&&"function"!=typeof e)&&("col"in e&&"number"==typeof e.col&&"row"in e&&"number"==typeof e.row&&"sheet"in e&&"number"==typeof e.sheet)}var absoluteSheetReference=function(e,t){var n;return null!==(n=e.sheet)&&void 0!==n?n:t.sheet},equalSimpleCellAddress=function(e,t){return e.sheet===t.sheet&&e.col===t.col&&e.row===t.row};function _classCallCheck$1e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1e(e,t,n){return t&&_defineProperties$1e(e.prototype,t),n&&_defineProperties$1e(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var DetailedCellError=function(){function e(t,n,r){var a;_classCallCheck$1e(this,e),this.value=n,this.address=r,this.type=t.type,this.message=null!==(a=t.message)&&void 0!==a?a:""}return _createClass$1e(e,[{key:"toString",value:function(){return this.value}},{key:"valueOf",value:function(){return this.value}}]),e}(),uncurryThis$6=functionUncurryThis,redefineAll$1=redefineAll$3,getWeakData=internalMetadata.exports.getWeakData,anObject=anObject$j,isObject$2=isObject$m,anInstance=anInstance$3,iterate=iterate$3,ArrayIterationModule=arrayIteration,hasOwn=hasOwnProperty_1,InternalStateModule=internalState,setInternalState=InternalStateModule.set,internalStateGetterFor=InternalStateModule.getterFor,find=ArrayIterationModule.find,findIndex=ArrayIterationModule.findIndex,splice=uncurryThis$6([].splice),id=0,uncaughtFrozenStore=function(e){return e.frozen||(e.frozen=new UncaughtFrozenStore)},UncaughtFrozenStore=function(){this.entries=[]},findUncaughtFrozen=function(e,t){return find(e.entries,(function(e){return e[0]===t}))};UncaughtFrozenStore.prototype={get:function(e){var t=findUncaughtFrozen(this,e);if(t)return t[1]},has:function(e){return!!findUncaughtFrozen(this,e)},set:function(e,t){var n=findUncaughtFrozen(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=findIndex(this.entries,(function(t){return t[0]===e}));return~t&&splice(this.entries,t,1),!!~t}};var collectionWeak$1={getConstructor:function(e,t,n,r){var a=e((function(e,a){anInstance(e,i),setInternalState(e,{type:t,id:id++,frozen:void 0}),null!=a&&iterate(a,e[r],{that:e,AS_ENTRIES:n})})),i=a.prototype,o=internalStateGetterFor(t),s=function(e,t,n){var r=o(e),a=getWeakData(anObject(t),!0);return!0===a?uncaughtFrozenStore(r).set(t,n):a[r.id]=n,e};return redefineAll$1(i,{delete:function(e){var t=o(this);if(!isObject$2(e))return!1;var n=getWeakData(e);return!0===n?uncaughtFrozenStore(t).delete(e):n&&hasOwn(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!isObject$2(e))return!1;var n=getWeakData(e);return!0===n?uncaughtFrozenStore(t).has(e):n&&hasOwn(n,t.id)}}),redefineAll$1(i,n?{get:function(e){var t=o(this);if(isObject$2(e)){var n=getWeakData(e);return!0===n?uncaughtFrozenStore(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),a}},global$4=global$U,uncurryThis$5=functionUncurryThis,redefineAll=redefineAll$3,InternalMetadataModule=internalMetadata.exports,collection=collection$3,collectionWeak=collectionWeak$1,isObject$1=isObject$m,isExtensible=objectIsExtensible,enforceInternalState=internalState.enforce,NATIVE_WEAK_MAP=nativeWeakMap,IS_IE11=!global$4.ActiveXObject&&"ActiveXObject"in global$4,InternalWeakMap,wrapper=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},$WeakMap=collection("WeakMap",wrapper,collectionWeak);if(NATIVE_WEAK_MAP&&IS_IE11){InternalWeakMap=collectionWeak.getConstructor(wrapper,"WeakMap",!0),InternalMetadataModule.enable();var WeakMapPrototype=$WeakMap.prototype,nativeDelete=uncurryThis$5(WeakMapPrototype.delete),nativeHas=uncurryThis$5(WeakMapPrototype.has),nativeGet=uncurryThis$5(WeakMapPrototype.get),nativeSet=uncurryThis$5(WeakMapPrototype.set);redefineAll(WeakMapPrototype,{delete:function(e){if(isObject$1(e)&&!isExtensible(e)){var t=enforceInternalState(this);return t.frozen||(t.frozen=new InternalWeakMap),nativeDelete(this,e)||t.frozen.delete(e)}return nativeDelete(this,e)},has:function(e){if(isObject$1(e)&&!isExtensible(e)){var t=enforceInternalState(this);return t.frozen||(t.frozen=new InternalWeakMap),nativeHas(this,e)||t.frozen.has(e)}return nativeHas(this,e)},get:function(e){if(isObject$1(e)&&!isExtensible(e)){var t=enforceInternalState(this);return t.frozen||(t.frozen=new InternalWeakMap),nativeHas(this,e)?nativeGet(this,e):t.frozen.get(e)}return nativeGet(this,e)},set:function(e,t){if(isObject$1(e)&&!isExtensible(e)){var n=enforceInternalState(this);n.frozen||(n.frozen=new InternalWeakMap),nativeHas(this,e)?nativeSet(this,e,t):n.frozen.set(e,t)}else nativeSet(this,e,t);return this}})}var $$k=_export,uncurryThis$4=functionUncurryThis,notARegExp$1=notARegexp,requireObjectCoercible$3=requireObjectCoercible$b,toString$4=toString$g,correctIsRegExpLogic$1=correctIsRegexpLogic,stringIndexOf=uncurryThis$4("".indexOf);function _createForOfIteratorHelper$p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$x(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$x(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$x(e,t):void 0}}function _arrayLikeToArray$x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _typeof$U(e){return _typeof$U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$U(e)}function configValueFromParam(e,t,n){if(void 0===e)return Config.defaultConfig[n];if("string"==typeof t){if(_typeof$U(e)===t)return e;throw new ExpectedValueOfTypeError(t,n)}if(t.includes(e))return e;throw new ExpectedOneOfValuesError(t.map((function(e){return"'".concat(e,"'")})).join(" "),n)}function validateNumberToBeAtLeast(e,t,n){if(e<n)throw new ConfigValueTooSmallError(t,n)}function validateNumberToBeAtMost(e,t,n){if(e>n)throw new ConfigValueTooBigError(t,n)}function configValueFromParamCheck(e,t,n,r){if(t(e))return e;if(void 0===e)return Config.defaultConfig[r];throw new ExpectedValueOfTypeError(n,r)}function configCheckIfParametersNotInConflict(){for(var e=new Map,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){var n=e.get(t.value)||[];n.push(t.name),e.set(t.value,n)}));var a,i=[],o=_createForOfIteratorHelper$p(e.values());try{for(o.s();!(a=o.n()).done;){var s=a.value;s.length>1&&i.push(s)}}catch(e){o.e(e)}finally{o.f()}if(i.length>0){i.forEach((function(e){return e.sort()}));var l=i.map((function(e){return"[".concat(e,"]")})).join("; ");throw new Error("Config initialization failed. Parameters in conflict: ".concat(l))}}function validateArgToType(e,t,n){if(_typeof$U(e)!==t)throw new ExpectedValueOfTypeError(t,n)}$$k({target:"String",proto:!0,forced:!correctIsRegExpLogic$1("includes")},{includes:function(e){return!!~stringIndexOf(toString$4(requireObjectCoercible$3(this)),toString$4(notARegExp$1(e)),arguments.length>1?arguments[1]:void 0)}});var $$j=_export,uncurryThis$3=functionUncurryThis,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,toLength$1=toLength$6,toString$3=toString$g,notARegExp=notARegexp,requireObjectCoercible$2=requireObjectCoercible$b,correctIsRegExpLogic=correctIsRegexpLogic,un$EndsWith=uncurryThis$3("".endsWith),slice=uncurryThis$3("".slice),min=Math.min,CORRECT_IS_REGEXP_LOGIC=correctIsRegExpLogic("endsWith"),MDN_POLYFILL_BUG=!CORRECT_IS_REGEXP_LOGIC&&!!function(){var e=getOwnPropertyDescriptor(String.prototype,"endsWith");return e&&!e.writable}();
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */
function defaultParseToDateTime(e,t,n){var r=(e=e.replace(/\s\s+/g," ").trim().toLowerCase()).substring(e.length-2);"am"===r||"pm"===r?e=e.substring(0,e.length-2).trim():"a"===(r=e.substring(e.length-1))||"p"===r?e=e.substring(0,e.length-1).trim():r=void 0;var a=e.split(/[ /.-]/g);a.length>=2&&a[a.length-2].includes(":")&&(a[a.length-2]=a[a.length-2]+"."+a[a.length-1],a.pop());var i=a[a.length-1].split(":");if(void 0!==r&&i.push(r),1===a.length)return defaultParseToTime(i,n);if(1===i.length)return defaultParseToDate(a,t);var o=defaultParseToDate(a.slice(0,a.length-1),t),s=defaultParseToTime(i,n);return void 0===o||void 0===s?void 0:Object.assign(Object.assign({},o),s)}$$j({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{endsWith:function(e){var t=toString$3(requireObjectCoercible$2(this));notARegExp(e);var n=arguments.length>1?arguments[1]:void 0,r=t.length,a=void 0===n?r:min(toLength$1(n),r),i=toString$3(e);return un$EndsWith?un$EndsWith(t,i,a):slice(t,a-i.length,a)===i}});var secondsExtendedRegexp=/^ss\.(s+|0+)$/;function defaultParseToTime(e,t){if(void 0!==t){(t=t.toLowerCase()).endsWith("am/pm")?t=t.substring(0,t.length-5).trim():t.endsWith("a/p")&&(t=t.substring(0,t.length-3).trim());var n=t.split(":"),r=void 0;"am"===e[e.length-1]||"a"===e[e.length-1]?(r=!1,e.pop()):"pm"!==e[e.length-1]&&"p"!==e[e.length-1]||(r=!0,e.pop());var a=0;if(n.length>=1&&secondsExtendedRegexp.test(n[n.length-1])&&(a=n[n.length-1].length-3,n[n.length-1]="ss"),e.length===n.length){var i=n.indexOf("hh"),o=n.indexOf("mm"),s=n.indexOf("ss"),l=-1!==i?e[i]:"0";if(/^\d+$/.test(l)){var u=Number(l);if(void 0!==r){if(u<0||u>12)return;u%=12,r&&(u+=12)}var c=-1!==o?e[o]:"0";if(/^\d+$/.test(c)){var p=Number(c),d=-1!==s?e[s]:"0";if(/^\d+(\.\d+)?$/.test(d)){var m=Number(d);return{hours:u,minutes:p,seconds:m=Math.round(m*Math.pow(10,a))/Math.pow(10,a)}}}}}}}function defaultParseToDate(e,t){if(void 0!==t){var n=t.toLowerCase().split(/[ /.-]/g);if(e.length===n.length){var r=n.indexOf("mm"),a=n.indexOf("dd"),i=n.indexOf("yyyy"),o=n.indexOf("yy");if(r in e&&a in e&&(i in e||o in e)&&(!(i in e)||!(o in e))){var s;if(i in e){var l=e[i];if(!/^\d+$/.test(l))return;if((s=Number(l))<1e3||s>9999)return}else{var u=e[o];if(!/^\d+$/.test(u))return;if((s=Number(u))<0||s>99)return}var c=e[r];if(/^\d+$/.test(c)){var p=Number(c),d=e[a];if(/^\d+$/.test(d))return{year:s,month:p,day:Number(d)}}}}}}function _createForOfIteratorHelper$o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$w(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$w(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$w(e,t):void 0}}function _arrayLikeToArray$w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1d(e,t,n){return t&&_defineProperties$1d(e.prototype,t),n&&_defineProperties$1d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof$T(e){return _typeof$T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$T(e)}var numDays=[31,28,31,30,31,30,31,31,30,31,30,31],prefSumDays=[0,31,59,90,120,151,181,212,243,273,304,334];function instanceOfSimpleDate(e){return!(!e||"object"!==_typeof$T(e)&&"function"!=typeof e)&&("year"in e&&"number"==typeof e.year&&"month"in e&&"number"==typeof e.month&&"day"in e&&"number"==typeof e.day)}function instanceOfSimpleTime(e){return!(!e||"object"!==_typeof$T(e)&&"function"!=typeof e)&&("hours"in e&&"number"==typeof e.hours&&"minutes"in e&&"number"==typeof e.minutes&&"seconds"in e&&"number"==typeof e.seconds)}var maxDate={year:9999,month:12,day:31},DateTimeHelper=function(){function e(t){_classCallCheck$1d(this,e),this.config=t,this.minDateAboluteValue=this.dateToNumberFromZero(t.nullDate),this.maxDateValue=this.dateToNumber(maxDate),this.leapYear1900=t.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=t.parseDateTime}return _createClass$1d(e,[{key:"getWithinBounds",value:function(e){return e<=this.maxDateValue&&e>=0?e:void 0}},{key:"dateStringToDateNumber",value:function(e){var t=this.parseDateTimeFromConfigFormats(e),n=t.dateTime,r=t.dateFormat,a=void 0===r?"":r,i=t.timeFormat,o=void 0===i?"":i;if(void 0!==n)return instanceOfSimpleTime(n)?instanceOfSimpleDate(n)?new DateTimeNumber(timeToNumber(n)+this.dateToNumber(n),a+" "+o):new TimeNumber(timeToNumber(n),o):instanceOfSimpleDate(n)?new DateNumber(this.dateToNumber(n),a):0}},{key:"parseDateTimeFromConfigFormats",value:function(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}},{key:"getNullYear",value:function(){return this.config.nullYear}},{key:"getEpochYearZero",value:function(){return this.epochYearZero}},{key:"isValidDate",value:function(e){return!(isNaN(e.year)||isNaN(e.month)||isNaN(e.day))&&(e.day===Math.round(e.day)&&e.month===Math.round(e.month)&&e.year===Math.round(e.year)&&(!(e.year<1582)&&(!(e.month<1||e.month>12)&&(!(e.day<1)&&(this.isLeapYear(e.year)&&2===e.month?e.day<=29:e.day<=numDays[e.month-1])))))}},{key:"dateToNumber",value:function(e){return this.dateToNumberFromZero(e)-this.minDateAboluteValue}},{key:"relativeNumberToAbsoluteNumber",value:function(e){return e+this.minDateAboluteValue-(this.leapYear1900?1:0)}},{key:"numberToSimpleDate",value:function(e){var t=Math.floor(e)+this.minDateAboluteValue,n=Math.floor(t/365.2425);this.dateToNumberFromZero({year:n+1,month:1,day:1})<=t?n++:this.dateToNumberFromZero({year:n-1,month:1,day:1})>t&&n--;var r=t-this.dateToNumberFromZero({year:n,month:1,day:1}),a=dayToMonth(r-(this.isLeapYear(n)&&r>=59?1:0));return{year:n,month:a+1,day:r-prefSumDays[a]-(this.isLeapYear(n)&&a>1?1:0)+1}}},{key:"numberToSimpleDateTime",value:function(e){return Object.assign(Object.assign({},this.numberToSimpleDate(Math.floor(e))),numberToSimpleTime(e%1))}},{key:"leapYearsCount",value:function(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}},{key:"daysInMonth",value:function(e,t){return this.isLeapYear(e)&&2===t?29:numDays[t-1]}},{key:"endOfMonth",value:function(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}},{key:"toBasisUS",value:function(e,t){return 31===e.day&&(e.day=30),30===e.day&&31===t.day&&(t.day=30),2===e.month&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,2===t.month&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}},{key:"yearLengthForBasis",value:function(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}},{key:"parseSingleFormat",value:function(e,t,n){var r=this.parseDateTime(e,t,n);if(!instanceOfSimpleDate(r)||(r.year>=0&&r.year<100&&(r.year<this.getNullYear()?r.year+=2e3:r.year+=1900),this.isValidDate(r)))return r}},{key:"parseDateTimeFromFormats",value:function(e,t,n){var r,a=0===t.length?[void 0]:t,i=0===n.length?[void 0]:n,o=_createForOfIteratorHelper$o(a);try{for(o.s();!(r=o.n()).done;){var s,l=r.value,u=_createForOfIteratorHelper$o(i);try{for(u.s();!(s=u.n()).done;){var c=s.value,p=this.parseSingleFormat(e,l,c);if(void 0!==p)return{dateTime:p,timeFormat:c,dateFormat:l}}}catch(e){u.e(e)}finally{u.f()}}}catch(e){o.e(e)}finally{o.f()}return{}}},{key:"countLeapDays",value:function(e){return e.month>2||2===e.month&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}},{key:"dateToNumberFromZero",value:function(e){return 365*e.year+prefSumDays[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}},{key:"isLeapYear",value:function(e){return!(e%4)&&(!!(e%100)||(!(e%400)||1900===e&&this.config.leapYear1900))}}]),e}();function dayToMonth(e){var t=0;return prefSumDays[t+6]<=e&&(t+=6),prefSumDays[t+3]<=e&&(t+=3),prefSumDays[t+2]<=e?t+=2:prefSumDays[t+1]<=e&&(t+=1),t}function offsetMonth(e,t){var n=12*e.year+e.month-1+t;return{year:Math.floor(n/12),month:n%12+1,day:e.day}}function truncateDayInMonth(e){return{year:e.year,month:e.month,day:Math.min(e.day,numDays[e.month-1])}}function roundToNearestSecond(e){return Math.round(3600*e*24)/86400}function numberToSimpleTime(e){e=Math.round(24*e*60*60*1e5)/864e7,e*=24;var t=Math.floor(e);e-=t,e*=60;var n=Math.floor(e);return e-=n,e*=60,{hours:t,minutes:n,seconds:Math.round(1e5*e)/1e5}}function timeToNumber(e){return((e.seconds/60+e.minutes)/60+e.hours)/24}function toBasisEU(e){return{year:e.year,month:e.month,day:Math.min(30,e.day)}}function _classCallCheck$1c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1c(e,t,n){return t&&_defineProperties$1c(e.prototype,t),n&&_defineProperties$1c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var AlwaysDense=function(){function e(){_classCallCheck$1c(this,e)}return _createClass$1c(e,[{key:"call",value:function(){return DenseStrategy}}]),e}(),global$3=global$U,toIntegerOrInfinity$1=toIntegerOrInfinity$7,toString$2=toString$g,requireObjectCoercible$1=requireObjectCoercible$b,RangeError$3=global$3.RangeError,stringRepeat=function(e){var t=toString$2(requireObjectCoercible$1(this)),n="",r=toIntegerOrInfinity$1(e);if(r<0||r==1/0)throw RangeError$3("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},$$i=_export,global$2=global$U,uncurryThis$2=functionUncurryThis,toIntegerOrInfinity=toIntegerOrInfinity$7,thisNumberValue=thisNumberValue$2,$repeat$1=stringRepeat,fails$1=fails$B,RangeError$2=global$2.RangeError,String$1=global$2.String,floor$1=Math.floor,repeat$2=uncurryThis$2($repeat$1),stringSlice$1=uncurryThis$2("".slice),un$ToFixed=uncurryThis$2(1..toFixed),pow=function(e,t,n){return 0===t?n:t%2==1?pow(e,t-1,n*e):pow(e*e,t/2,n)},log$5=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t},multiply=function(e,t,n){for(var r=-1,a=n;++r<6;)a+=t*e[r],e[r]=a%1e7,a=floor$1(a/1e7)},divide=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=floor$1(r/t),r=r%t*1e7},dataToString=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=String$1(e[t]);n=""===n?r:n+repeat$2("0",7-r.length)+r}return n},FORCED$2=fails$1((function(){return"0.000"!==un$ToFixed(8e-5,3)||"1"!==un$ToFixed(.9,0)||"1.25"!==un$ToFixed(1.255,2)||"1000000000000000128"!==un$ToFixed(0xde0b6b3a7640080,0)}))||!fails$1((function(){un$ToFixed({})}));$$i({target:"Number",proto:!0,forced:FORCED$2},{toFixed:function(e){var t,n,r,a,i=thisNumberValue(this),o=toIntegerOrInfinity(e),s=[0,0,0,0,0,0],l="",u="0";if(o<0||o>20)throw RangeError$2("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String$1(i);if(i<0&&(l="-",i=-i),i>1e-21)if(n=(t=log$5(i*pow(2,69,1))-69)<0?i*pow(2,-t,1):i/pow(2,t,1),n*=4503599627370496,(t=52-t)>0){for(multiply(s,0,n),r=o;r>=7;)multiply(s,1e7,0),r-=7;for(multiply(s,pow(10,r,1),0),r=t-1;r>=23;)divide(s,1<<23),r-=23;divide(s,1<<r),multiply(s,1,1),divide(s,2),u=dataToString(s)}else multiply(s,0,n),multiply(s,1<<-t,0),u=dataToString(s)+repeat$2("0",o);return u=o>0?l+((a=u.length)<=o?"0."+repeat$2("0",o-a)+u:stringSlice$1(u,0,a-o)+"."+stringSlice$1(u,a-o)):l+u}});
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */
var dateFormatRegex=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,numberFormatRegex=/(\\.|[#0]+(\.[#0]*)?)/g,TokenType,FormatExpressionType;function formatToken(e,t){return{type:e,value:t}}function matchDateFormat(e){dateFormatRegex.lastIndex=0;var t,n=[];do{null!==(t=dateFormatRegex.exec(e))&&n.push(t)}while(t);return n}function matchNumberFormat(e){numberFormatRegex.lastIndex=0;var t=numberFormatRegex.exec(e);return null!==t?[t]:[]}function createTokens(e,t){for(var n=[],r=0,a=0;a<e.length;++a){var i=e[a];if(i.index!==r){var o=t.substr(r,i.index-r);n.push(formatToken(TokenType.FREE_TEXT,o))}i[0].startsWith("\\")?n.push(formatToken(TokenType.FREE_TEXT,i[0])):n.push(formatToken(TokenType.FORMAT,i[0])),r=i.index+i[0].length}var s=e[e.length-1];if(s.index+s[0].length<t.length){var l=t.substr(s.index+s[0].length,t.length);n.push(formatToken(TokenType.FREE_TEXT,l))}return n}function parseForDateTimeFormat(e){var t=matchDateFormat(e);return t.every((function(e){return isEscapeToken(e)}))?void 0:{type:FormatExpressionType.DATE,tokens:createTokens(t,e)}}function parseForNumberFormat(e){var t=matchNumberFormat(e);return t.every((function(e){return isEscapeToken(e)}))?void 0:{type:FormatExpressionType.NUMBER,tokens:createTokens(t,e)}}function isEscapeToken(e){return e[0].startsWith("\\")}function _slicedToArray$j(e,t){return _arrayWithHoles$j(e)||_iterableToArrayLimit$j(e,t)||_unsupportedIterableToArray$v(e,t)||_nonIterableRest$j()}function _nonIterableRest$j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$j(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$j(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$v(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$v(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$v(e,t):void 0}}function _arrayLikeToArray$v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function format(e,t,n,r){var a=n.stringifyDateTime(r.numberToSimpleDateTime(e),t);if(void 0!==a)return a;var i=n.stringifyDuration(numberToSimpleTime(e),t);if(void 0!==i)return i;var o=parseForNumberFormat(t);return void 0!==o?numberFormat(o.tokens,e):t}function padLeft(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function padRight(e,t){for(var n=e+"";n.length<t;)n+="0";return n}function countChars(e,t){return e.split(t).length-1}function numberFormat(e,t){for(var n="",r=0;r<e.length;++r){var a=e[r];if(a.type!==TokenType.FREE_TEXT){var i=a.value.split("."),o=i[0],s=i[1]||"",l=i[1]?".":"",u=Number(t.toFixed(s.length)).toString().split("."),c=u[0]||"",p=u[1]||"";if(o.length>c.length)c=padLeft(c,countChars(o.substr(0,o.length-c.length),"0")+c.length);n+=c+l+(p=padRight(p,countChars(s.substr(p.length,s.length-p.length),"0")+p.length))}else n+=a.value}return n}function defaultStringifyDuration(e,t){var n=parseForDateTimeFormat(t);if(void 0!==n){var r,a="",i=_createForOfIteratorHelper$n(n.tokens);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.type!==TokenType.FREE_TEXT)if(secondsExtendedRegexp.test(o.value)){var s=o.value.length-3;a+=(e.seconds<10?"0":"")+Math.round(e.seconds*Math.pow(10,s))/Math.pow(10,s)}else switch(o.value.toLowerCase()){case"h":case"hh":a+=padLeft(e.hours,o.value.length),e.hours=0;break;case"[hh]":a+=padLeft(e.hours,o.value.length-2),e.hours=0;break;case"m":case"mm":a+=padLeft(e.minutes,o.value.length),e.minutes=0;break;case"[mm]":a+=padLeft(e.minutes+60*e.hours,o.value.length-2),e.minutes=0,e.hours=0;break;case"s":case"ss":a+=padLeft(e.seconds,o.value.length);break;default:return}else a+=o.value}}catch(e){i.e(e)}finally{i.f()}return a}}function defaultStringifyDateTime(e,t){var n=parseForDateTimeFormat(t);if(void 0!==n){for(var r=n.tokens,a="",i=!1,o=r.some((function(e){return e.type===TokenType.FORMAT&&("a/p"===e.value||"A/P"===e.value||"am/pm"===e.value||"AM/PM"===e.value)})),s=0;s<r.length;s++){var l=r[s];if(l.type!==TokenType.FREE_TEXT)if(secondsExtendedRegexp.test(l.value)){var u=l.value.length-3;a+=(e.seconds<10?"0":"")+Math.round(e.seconds*Math.pow(10,u))/Math.pow(10,u)}else switch(l.value.toLowerCase()){case"h":case"hh":i=!0,a+=padLeft(o?(e.hours+11)%12+1:e.hours,l.value.length);break;case"d":case"dd":a+=padLeft(e.day,l.value.length);break;case"s":case"ss":a+=padLeft(Math.round(e.seconds),l.value.length);break;case"m":case"mm":s+1<r.length&&r[s+1].value.startsWith(":")&&(i=!0),a+=padLeft(i?e.minutes:e.month,l.value.length),i=!0;break;case"yy":a+=padLeft(e.year%100,l.value.length);break;case"yyyy":a+=e.year;break;case"am/pm":case"a/p":var c=_slicedToArray$j(l.value.split("/"),2),p=c[0],d=c[1];a+=e.hours<12?p:d;break;default:return}else a+=l.value}return a}}!function(e){e.FORMAT="FORMAT",e.FREE_TEXT="FREE_TEXT"}(TokenType||(TokenType={})),function(e){e.DATE="DATE",e.NUMBER="NUMBER",e.STRING="STRING"}(FormatExpressionType||(FormatExpressionType={}));var $$h=_export,codeAt=stringMultibyte.codeAt;$$h({target:"String",proto:!0},{codePointAt:function(e){return codeAt(this,e)}});var uncurryThis$1=functionUncurryThis,toLength=toLength$6,toString$1=toString$g,$repeat=stringRepeat,requireObjectCoercible=requireObjectCoercible$b,repeat$1=uncurryThis$1($repeat),stringSlice=uncurryThis$1("".slice),ceil$1=Math.ceil,createMethod=function(e){return function(t,n,r){var a,i,o=toString$1(requireObjectCoercible(t)),s=toLength(n),l=o.length,u=void 0===r?" ":toString$1(r);return s<=l||""==u?o:((i=repeat$1(u,ceil$1((a=s-l)/u.length))).length>a&&(i=stringSlice(i,0,a)),e?o+i:i+o)}},stringPad={start:createMethod(!1),end:createMethod(!0)},userAgent=engineUserAgent,stringPadWebkitBug=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(userAgent),$$g=_export,$padStart=stringPad.start,WEBKIT_BUG=stringPadWebkitBug;function _slicedToArray$i(e,t){return _arrayWithHoles$i(e)||_iterableToArrayLimit$i(e,t)||_unsupportedIterableToArray$u(e,t)||_nonIterableRest$i()}function _nonIterableRest$i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$u(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$u(e,t):void 0}}function _arrayLikeToArray$u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$i(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$i(e){if(Array.isArray(e))return e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */$$g({target:"String",proto:!0,forced:WEBKIT_BUG},{padStart:function(e){return $padStart(this,e,arguments.length>1?arguments[1]:void 0)}});var _rl="length",_hd=function(e){return parseInt(e,16)},_pi=function(e){return parseInt(e,10)},_nm=function(e){return(e+"").replace(/\-/g,"")},_ss=function(e,t,n){return e.substr(t,n)},_cp=function(e){return e.codePointAt(0)-65};function extractTime(e){return 25===_nm(e)[_rl]?_hd(_ss(_nm(e),_hd("12"),_cp("F")))/(_hd(_ss(_nm(e),_cp("C"),_cp("Y")>>4))||1+(~~![][_rl]<<3)):0}function checkKeySchema(e){if((e=(e+"").replace(/\-/g,""))[_rl]!==_cp("Z"))return!1;var t=0;return[[0,_cp("G")+1],[_cp("H"),_cp("H")-1],[_cp("G")+_cp("H"),_cp("G")]].reduce((function(n,r,a){var i=_slicedToArray$i(r,2),o=i[0],s=i[1];return n|=(_pi("".concat(_pi(_hd(_ss.apply(void 0,[e].concat([t+o-(0===a?0:2),s+(a?2:0)])))+(_hd(_ss.apply(void 0,[e].concat([t+o+s,2])))+[]).padStart(2,"0"))))%97||2)>>1,t+=2,n}),_cp("A"))===[]+1>>1}function _slicedToArray$h(e,t){return _arrayWithHoles$h(e)||_iterableToArrayLimit$h(e,t)||_unsupportedIterableToArray$t(e,t)||_nonIterableRest$h()}function _nonIterableRest$h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$t(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$t(e,t):void 0}}function _arrayLikeToArray$t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$h(e){if(Array.isArray(e))return e}var consoleMessages={invalid:function(){return"The license key for HyperFormula is invalid."},expired:function(e){var t=e.keyValidityDate;return"The license key for HyperFormula expired"+" on ".concat(t,", and is not valid for the installed version.")},missing:function(){return"The license key for HyperFormula is missing."}},_notified=!1,CellContent;function checkLicenseKeyValidity(e){var t={template:"missing",vars:{}};if("gpl-v3"===e||"internal-use-in-handsontable"===e)t.template="valid";else if("string"==typeof e&&checkKeySchema(e)){var n=_slicedToArray$h("14/04/2022".split("/"),3),r=n[0],a=n[1],i=n[2],o=Math.floor(new Date("".concat(a,"/").concat(r,"/").concat(i)).getTime()/864e5),s=extractTime(e);t.vars.keyValidityDate=formatDate(new Date(864e5*(s+1))),t.template=o>s?"expired":"valid"}else""!==e&&(t.template="invalid");return _notified||"valid"===t.template||(console.warn(consoleMessages[t.template](t.vars)),_notified=!0),t.template}function formatDate(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],n=e.getDate(),r=e.getFullYear();return"".concat(t," ").concat(n,", ").concat(r)}function _createForOfIteratorHelper$m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray$g(e,t){return _arrayWithHoles$g(e)||_iterableToArrayLimit$g(e,t)||_unsupportedIterableToArray$s(e,t)||_nonIterableRest$g()}function _nonIterableRest$g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$s(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$s(e,t):void 0}}function _arrayLikeToArray$s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$g(e){if(Array.isArray(e))return e}function _defineProperties$1b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1b(e,t,n){return t&&_defineProperties$1b(e.prototype,t),n&&_defineProperties$1b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck$1b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function isFormula(e){return e.startsWith("=")}function isBoolean(e){var t=e.toLowerCase();return"true"===t||"false"===t}function isError(e,t){var n=e.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(n)&&Object.prototype.hasOwnProperty.call(t,n)}!function(e){var t=_createClass$1b((function e(t){_classCallCheck$1b(this,e),this.value=t,this.value=cloneNumber(this.value,fixNegativeZero(getRawValue(this.value)))}));e.Number=t;var n=_createClass$1b((function e(t){_classCallCheck$1b(this,e),this.value=t}));e.String=n;var r=_createClass$1b((function e(t){_classCallCheck$1b(this,e),this.value=t}));e.Boolean=r;var a=function(){function e(){_classCallCheck$1b(this,e)}return _createClass$1b(e,null,[{key:"getSingletonInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();e.Empty=a;var i=_createClass$1b((function e(t){_classCallCheck$1b(this,e),this.formula=t}));e.Formula=i;var o=_createClass$1b((function e(t,n){_classCallCheck$1b(this,e),this.value=new CellError(t,n)}));e.Error=o}(CellContent||(CellContent={}));var CellContentParser=function(){function e(t,n,r){_classCallCheck$1b(this,e),this.config=t,this.dateHelper=n,this.numberLiteralsHelper=r}return _createClass$1b(e,[{key:"parse",value:function(e){if(null==e)return CellContent.Empty.getSingletonInstance();if("number"==typeof e)return isNumberOverflow(e)?new CellContent.Error(ErrorType.NUM,ErrorMessage.ValueLarge):new CellContent.Number(e);if("boolean"==typeof e)return new CellContent.Boolean(e);if(e instanceof Date){var t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()})+timeToNumber({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3});return t<0?new CellContent.Error(ErrorType.NUM,ErrorMessage.DateBounds):t%1==0?new CellContent.Number(new DateNumber(t,"Date()")):t<1?new CellContent.Number(new TimeNumber(t,"Date()")):new CellContent.Number(new DateTimeNumber(t,"Date()"))}if("string"==typeof e){if(isBoolean(e))return new CellContent.Boolean("true"===e.toLowerCase());if(isFormula(e))return new CellContent.Formula(e);if(isError(e,this.config.errorMapping))return new CellContent.Error(this.config.errorMapping[e.toUpperCase()]);var n,r=e.trim(),a=0;if(r.endsWith("%"))a=1,r=r.slice(0,r.length-1);else{var i=this.currencyMatcher(r);if(void 0!==i){a=2;var o=_slicedToArray$g(i,2);n=o[0],r=o[1]}}var s,l=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(void 0!==l)return s=1===a?new PercentNumber(l/100):2===a?new CurrencyNumber(l,n):l,new CellContent.Number(s);var u=this.dateHelper.dateStringToDateNumber(r);return void 0!==u?new CellContent.Number(u):new CellContent.String(e.startsWith("'")?e.slice(1):e)}throw new UnableToParseError(e)}},{key:"currencyMatcher",value:function(e){var t,n=_createForOfIteratorHelper$m(this.config.currencySymbol);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.startsWith(r))return[r,e.slice(r.length)];if(e.endsWith(r))return[r,e.slice(0,e.length-r.length)]}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),ClipboardOperationType,ClipboardCellType;function _classCallCheck$1a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1a(e,t,n){return t&&_defineProperties$1a(e.prototype,t),n&&_defineProperties$1a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e[e.COPY=0]="COPY",e[e.CUT=1]="CUT"}(ClipboardOperationType||(ClipboardOperationType={})),function(e){e[e.VALUE=0]="VALUE",e[e.EMPTY=1]="EMPTY",e[e.FORMULA=2]="FORMULA",e[e.PARSING_ERROR=3]="PARSING_ERROR"}(ClipboardCellType||(ClipboardCellType={}));var Clipboard=function(){function e(t,n,r,a,i){_classCallCheck$1a(this,e),this.sourceLeftCorner=t,this.width=n,this.height=r,this.type=a,this.content=i}return _createClass$1a(e,[{key:"getContent",value:regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.content){e.next=4;break}return e.abrupt("return");case 4:n=0;case 5:if(!(n<this.height)){e.next=16;break}r=0;case 7:if(!(r<this.width)){e.next=13;break}return e.next=10,[simpleCellAddress(t.sheet,t.col+r,t.row+n),this.content[n][r]];case 10:++r,e.next=7;break;case 13:++n,e.next=5;break;case 16:case"end":return e.stop()}}),e,this)}))}]),e}(),ClipboardOperations=function(){function e(t,n,r){_classCallCheck$1a(this,e),this.dependencyGraph=n,this.operations=r,this.maxRows=t.maxRows,this.maxColumns=t.maxColumns}return _createClass$1a(e,[{key:"cut",value:function(e,t,n){this.clipboard=new Clipboard(e,t,n,ClipboardOperationType.CUT)}},{key:"copy",value:function(e,t,n){for(var r=[],a=0;a<n;++a){r[a]=[];for(var i=0;i<t;++i){var o=this.operations.getClipboardCell(simpleCellAddress(e.sheet,e.col+i,e.row+a));r[a].push(o)}}this.clipboard=new Clipboard(e,t,n,ClipboardOperationType.COPY,r)}},{key:"abortCut",value:function(){this.clipboard&&this.clipboard.type===ClipboardOperationType.CUT&&this.clear()}},{key:"clear",value:function(){this.clipboard=void 0}},{key:"ensureItIsPossibleToCopyPaste",value:function(e){if(void 0!==this.clipboard){if(invalidSimpleCellAddress(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new InvalidArgumentsError("a valid target address.");var t=AbsoluteCellRange.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}}},{key:"isCutClipboard",value:function(){return void 0!==this.clipboard&&this.clipboard.type===ClipboardOperationType.CUT}},{key:"isCopyClipboard",value:function(){return void 0!==this.clipboard&&this.clipboard.type===ClipboardOperationType.COPY}}]),e}();function _classCallCheck$19(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$19(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$19(e,t,n){return t&&_defineProperties$19(e.prototype,t),n&&_defineProperties$19(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var InternalNamedExpression=function(){function e(t,n,r,a){_classCallCheck$19(this,e),this.displayName=t,this.address=n,this.added=r,this.options=a}return _createClass$19(e,[{key:"normalizeExpressionName",value:function(){return this.displayName.toLowerCase()}},{key:"copy",value:function(){return new e(this.displayName,this.address,this.added,this.options)}}]),e}(),WorkbookStore=function(){function e(){_classCallCheck$19(this,e),this.mapping=new Map}return _createClass$19(e,[{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"isNameAvailable",value:function(e){var t=this.normalizeExpressionName(e),n=this.mapping.get(t);return!(n&&n.added)}},{key:"add",value:function(e){this.mapping.set(e.normalizeExpressionName(),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"getExisting",value:function(e){var t=this.mapping.get(this.normalizeExpressionName(e));return t&&t.added?t:void 0}},{key:"remove",value:function(e){var t=this.normalizeExpressionName(e),n=this.mapping.get(t);n&&(n.added=!1)}},{key:"getAllNamedExpressions",value:function(){return Array.from(this.mapping.values()).filter((function(e){return e.added}))}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}}]),e}(),WorksheetStore=function(){function e(){_classCallCheck$19(this,e),this.mapping=new Map}return _createClass$19(e,[{key:"add",value:function(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}},{key:"get",value:function(e){return this.mapping.get(this.normalizeExpressionName(e))}},{key:"has",value:function(e){return this.mapping.has(this.normalizeExpressionName(e))}},{key:"getAllNamedExpressions",value:function(){return Array.from(this.mapping.values()).filter((function(e){return e.added}))}},{key:"isNameAvailable",value:function(e){var t=this.normalizeExpressionName(e);return!this.mapping.has(t)}},{key:"remove",value:function(e){var t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}},{key:"normalizeExpressionName",value:function(e){return e.toLowerCase()}}]),e}(),NamedExpressions=function(){function e(){_classCallCheck$19(this,e),this.nextNamedExpressionRow=0,this.workbookStore=new WorkbookStore,this.worksheetStores=new Map,this.addressCache=new Map}return _createClass$19(e,[{key:"isNameAvailable",value:function(e,t){var n,r;return void 0===t?this.workbookStore.isNameAvailable(e):null===(r=null===(n=this.worksheetStore(t))||void 0===n?void 0:n.isNameAvailable(e))||void 0===r||r}},{key:"namedExpressionInAddress",value:function(e){var t=this.addressCache.get(e);return t&&t.added?t:void 0}},{key:"namedExpressionForScope",value:function(e,t){var n;return void 0===t?this.workbookStore.getExisting(e):null===(n=this.worksheetStore(t))||void 0===n?void 0:n.get(e)}},{key:"nearestNamedExpression",value:function(e,t){var n,r;return null!==(r=null===(n=this.worksheetStore(t))||void 0===n?void 0:n.get(e))&&void 0!==r?r:this.workbookStore.getExisting(e)}},{key:"isExpressionInScope",value:function(e,t){var n,r;return null!==(r=null===(n=this.worksheetStore(t))||void 0===n?void 0:n.has(e))&&void 0!==r&&r}},{key:"isNameValid",value:function(e){return!/^[A-Za-z]+[0-9]+$/.test(e)&&/^[A-Za-z\u00C0-\u02AF_][A-Za-z0-9\u00C0-\u02AF._]*$/.test(e)}},{key:"addNamedExpression",value:function(e,t,n){var r=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t),a=r.get(e);return void 0!==a?(a.added=!0,a.displayName=e,a.options=n):(a=new InternalNamedExpression(e,this.nextAddress(),!0,n),r.add(a)),this.addressCache.set(a.address.row,a),a}},{key:"restoreNamedExpression",value:function(e,t){var n=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,n.add(e),this.addressCache.set(e.address.row,e),e}},{key:"namedExpressionOrPlaceholder",value:function(e,t){var n;return null!==(n=this.worksheetStoreOrCreate(t).get(e))&&void 0!==n?n:this.workbookNamedExpressionOrPlaceholder(e)}},{key:"workbookNamedExpressionOrPlaceholder",value:function(e){var t=this.workbookStore.get(e);return void 0===t&&(t=new InternalNamedExpression(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}},{key:"remove",value:function(e,t){var n,r=null==(n=void 0===t?this.workbookStore:this.worksheetStore(t))?void 0:n.get(e);if(void 0===n||void 0===r||!r.added)throw"Named expression does not exist";n.remove(e),n instanceof WorksheetStore&&0===n.mapping.size&&this.worksheetStores.delete(t),this.addressCache.delete(r.address.row)}},{key:"getAllNamedExpressionsNamesInScope",value:function(e){return this.getAllNamedExpressions().filter((function(t){return t.scope===e})).map((function(e){return e.expression.displayName}))}},{key:"getAllNamedExpressionsNames",value:function(){return this.getAllNamedExpressions().map((function(e){return e.expression.displayName}))}},{key:"getAllNamedExpressions",value:function(){var e=[];return this.workbookStore.getAllNamedExpressions().forEach((function(t){e.push({expression:t,scope:void 0})})),this.worksheetStores.forEach((function(t,n){t.getAllNamedExpressions().forEach((function(t){e.push({expression:t,scope:n})}))})),e}},{key:"getAllNamedExpressionsForScope",value:function(e){var t,n;return void 0===e?this.workbookStore.getAllNamedExpressions():null!==(n=null===(t=this.worksheetStores.get(e))||void 0===t?void 0:t.getAllNamedExpressions())&&void 0!==n?n:[]}},{key:"worksheetStoreOrCreate",value:function(e){var t=this.worksheetStores.get(e);return t||(t=new WorksheetStore,this.worksheetStores.set(e,t)),t}},{key:"worksheetStore",value:function(e){return this.worksheetStores.get(e)}},{key:"nextAddress",value:function(){return simpleCellAddress(e.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}]),e}();NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;var doesContainRelativeReferences=function e(t){switch(t.type){case AstNodeType.EMPTY:case AstNodeType.NUMBER:case AstNodeType.STRING:case AstNodeType.ERROR:case AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case AstNodeType.CELL_REFERENCE:return!t.reference.isAbsolute();case AstNodeType.CELL_RANGE:case AstNodeType.COLUMN_RANGE:case AstNodeType.ROW_RANGE:return!t.start.isAbsolute();case AstNodeType.NAMED_EXPRESSION:return!1;case AstNodeType.PERCENT_OP:case AstNodeType.PLUS_UNARY_OP:case AstNodeType.MINUS_UNARY_OP:return e(t.value);case AstNodeType.CONCATENATE_OP:case AstNodeType.EQUALS_OP:case AstNodeType.NOT_EQUAL_OP:case AstNodeType.LESS_THAN_OP:case AstNodeType.GREATER_THAN_OP:case AstNodeType.LESS_THAN_OR_EQUAL_OP:case AstNodeType.GREATER_THAN_OR_EQUAL_OP:case AstNodeType.MINUS_OP:case AstNodeType.PLUS_OP:case AstNodeType.TIMES_OP:case AstNodeType.DIV_OP:case AstNodeType.POWER_OP:return e(t.left)||e(t.right);case AstNodeType.PARENTHESIS:return e(t.expression);case AstNodeType.FUNCTION_CALL:return t.args.some((function(t){return e(t)}));case AstNodeType.ARRAY:return t.args.some((function(t){return t.some((function(t){return e(t)}))}))}};function _slicedToArray$f(e,t){return _arrayWithHoles$f(e)||_iterableToArrayLimit$f(e,t)||_unsupportedIterableToArray$r(e,t)||_nonIterableRest$f()}function _nonIterableRest$f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$f(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$f(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$r(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$r(e,t):void 0}}function _arrayLikeToArray$r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$18(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$18(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$18(e,t,n){return t&&_defineProperties$18(e.prototype,t),n&&_defineProperties$18(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Transformer=function(){function e(){_classCallCheck$18(this,e)}return _createClass$18(e,[{key:"performEagerTransformations",value:function(e,t){var n,r=_createForOfIteratorHelper$l(e.arrayFormulaNodes());try{for(r.s();!(n=r.n()).done;){var a=n.value,i=_slicedToArray$f(this.transformSingleAst(a.getFormula(e.lazilyTransformingAstService),a.getAddress(e.lazilyTransformingAstService)),2),o=i[0],s=i[1],l=t.rememberNewAst(o);a.setFormula(l),a.setAddress(s)}}catch(e){r.e(e)}finally{r.f()}}},{key:"transformSingleAst",value:function(e,t){return[this.transformAst(e,t),this.fixNodeAddress(t)]}},{key:"transformAst",value:function(e,t){var n=this;switch(e.type){case AstNodeType.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case AstNodeType.CELL_RANGE:return this.transformCellRangeAst(e,t);case AstNodeType.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case AstNodeType.ROW_RANGE:return this.transformRowRangeAst(e,t);case AstNodeType.EMPTY:case AstNodeType.ERROR:case AstNodeType.NUMBER:case AstNodeType.NAMED_EXPRESSION:case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.STRING:return e;case AstNodeType.PERCENT_OP:case AstNodeType.MINUS_UNARY_OP:case AstNodeType.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case AstNodeType.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map((function(e){return n.transformAst(e,t)}))});case AstNodeType.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case AstNodeType.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map((function(e){return e.map((function(e){return n.transformAst(e,t)}))}))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}},{key:"transformCellReferenceAst",value:function(e,t){var n=this.transformCellAddress(e.reference,t);return n instanceof CellAddress?Object.assign(Object.assign({},e),{reference:n}):n===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}},{key:"transformCellRangeAst",value:function(e,t){var n=this.transformCellRange(e.start,e.end,t);return Array.isArray(n)?Object.assign(Object.assign({},e),{start:n[0],end:n[1]}):n===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}},{key:"transformColumnRangeAst",value:function(e,t){var n=this.transformColumnRange(e.start,e.end,t);return Array.isArray(n)?Object.assign(Object.assign({},e),{start:n[0],end:n[1]}):n===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}},{key:"transformRowRangeAst",value:function(e,t){var n=this.transformRowRange(e.start,e.end,t);return Array.isArray(n)?Object.assign(Object.assign({},e),{start:n[0],end:n[1]}):n===ErrorType.REF?buildCellErrorAst(new CellError(ErrorType.REF)):e}}]),e}();function _typeof$S(e){return _typeof$S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$S(e)}function _classCallCheck$17(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$17(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$17(e,t,n){return t&&_defineProperties$17(e.prototype,t),n&&_defineProperties$17(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$R(e,t)}function _setPrototypeOf$R(e,t){return _setPrototypeOf$R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$R(e,t)}function _createSuper$R(e){var t=_isNativeReflectConstruct$R();return function(){var n,r=_getPrototypeOf$R(e);if(t){var a=_getPrototypeOf$R(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$R(this,n)}}function _possibleConstructorReturn$R(e,t){if(t&&("object"===_typeof$S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$R(e)}function _assertThisInitialized$R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$R(e){return _getPrototypeOf$R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$R(e)}var AddColumnsTransformer=function(e){_inherits$R(n,e);var t=_createSuper$R(n);function n(e){var r;return _classCallCheck$17(this,n),(r=t.call(this)).columnsSpan=e,r}return _createClass$17(n,[{key:"sheet",get:function(){return this.columnsSpan.sheet}},{key:"isIrreversible",value:function(){return!1}},{key:"transformRowRangeAst",value:function(e,t){return e}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){throw Error("Not implemented")}},{key:"transformColumnRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformCellAddress",value:function(e,t){var n=absoluteSheetReference(e,t);if(n!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;var r=e.toSimpleColumnAddress(t);return n===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet?this.columnsSpan.columnStart<=r.col&&e.shiftedByColumns(this.columnsSpan.numberOfColumns):t.sheet===this.columnsSpan.sheet&&n!==this.columnsSpan.sheet?!e.isColumnAbsolute()&&(!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns)):e.isColumnAbsolute()?!(e.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(this.columnsSpan.numberOfColumns):e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart&&e.shiftedByColumns(this.columnsSpan.numberOfColumns)}},{key:"fixNodeAddress",value:function(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}},{key:"transformRange",value:function(e,t,n){var r=this.transformCellAddress(e,n),a=this.transformCellAddress(t,n);return r===ErrorType.REF||a===ErrorType.REF?ErrorType.REF:!(!r&&!a)&&[r||e,a||t]}}]),n}(Transformer);function _typeof$R(e){return _typeof$R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$R(e)}function _classCallCheck$16(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$16(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$16(e,t,n){return t&&_defineProperties$16(e.prototype,t),n&&_defineProperties$16(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$Q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$Q(e,t)}function _setPrototypeOf$Q(e,t){return _setPrototypeOf$Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$Q(e,t)}function _createSuper$Q(e){var t=_isNativeReflectConstruct$Q();return function(){var n,r=_getPrototypeOf$Q(e);if(t){var a=_getPrototypeOf$Q(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$Q(this,n)}}function _possibleConstructorReturn$Q(e,t){if(t&&("object"===_typeof$R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$Q(e)}function _assertThisInitialized$Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$Q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$Q(e){return _getPrototypeOf$Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$Q(e)}var AddRowsTransformer=function(e){_inherits$Q(n,e);var t=_createSuper$Q(n);function n(e){var r;return _classCallCheck$16(this,n),(r=t.call(this)).rowsSpan=e,r}return _createClass$16(n,[{key:"sheet",get:function(){return this.rowsSpan.sheet}},{key:"isIrreversible",value:function(){return!1}},{key:"transformColumnRangeAst",value:function(e,t){return e}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformColumnRange",value:function(e,t,n){throw Error("Not implemented")}},{key:"transformCellAddress",value:function(e,t){var n=absoluteSheetReference(e,t);if(n!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;var r=e.toSimpleRowAddress(t);return n===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=r.row&&e.shiftedByRows(this.rowsSpan.numberOfRows):t.sheet===this.rowsSpan.sheet&&n!==this.rowsSpan.sheet?!e.isRowAbsolute()&&(!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows)):e.isRowAbsolute()?!(e.row<this.rowsSpan.rowStart)&&e.shiftedByRows(this.rowsSpan.numberOfRows):r.row<this.rowsSpan.rowStart?!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart&&e.shiftedByRows(this.rowsSpan.numberOfRows)}},{key:"fixNodeAddress",value:function(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}},{key:"transformRange",value:function(e,t,n){var r=this.transformCellAddress(e,n),a=this.transformCellAddress(t,n);return r===ErrorType.REF||a===ErrorType.REF?ErrorType.REF:!(!r&&!a)&&[r||e,a||t]}}]),n}(Transformer);function _typeof$Q(e){return _typeof$Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$Q(e)}function _classCallCheck$15(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$15(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$15(e,t,n){return t&&_defineProperties$15(e.prototype,t),n&&_defineProperties$15(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$P(e,t)}function _setPrototypeOf$P(e,t){return _setPrototypeOf$P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$P(e,t)}function _createSuper$P(e){var t=_isNativeReflectConstruct$P();return function(){var n,r=_getPrototypeOf$P(e);if(t){var a=_getPrototypeOf$P(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$P(this,n)}}function _possibleConstructorReturn$P(e,t){if(t&&("object"===_typeof$Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$P(e)}function _assertThisInitialized$P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$P(e){return _getPrototypeOf$P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$P(e)}var CleanOutOfScopeDependenciesTransformer=function(e){_inherits$P(n,e);var t=_createSuper$P(n);function n(e){var r;return _classCallCheck$15(this,n),(r=t.call(this)).sheet=e,r}return _createClass$15(n,[{key:"isIrreversible",value:function(){return!0}},{key:"fixNodeAddress",value:function(e){return e}},{key:"transformCellAddress",value:function(e,t){return!!e.isInvalid(t)&&ErrorType.REF}},{key:"transformCellRange",value:function(e,t,n){return!(!e.isInvalid(n)&&!t.isInvalid(n))&&ErrorType.REF}},{key:"transformColumnRange",value:function(e,t,n){return!(!e.isInvalid(n)&&!t.isInvalid(n))&&ErrorType.REF}},{key:"transformRowRange",value:function(e,t,n){return!(!e.isInvalid(n)&&!t.isInvalid(n))&&ErrorType.REF}}]),n}(Transformer);function _typeof$P(e){return _typeof$P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$P(e)}function _classCallCheck$14(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$14(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$14(e,t,n){return t&&_defineProperties$14(e.prototype,t),n&&_defineProperties$14(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$O(e,t)}function _setPrototypeOf$O(e,t){return _setPrototypeOf$O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$O(e,t)}function _createSuper$O(e){var t=_isNativeReflectConstruct$O();return function(){var n,r=_getPrototypeOf$O(e);if(t){var a=_getPrototypeOf$O(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$O(this,n)}}function _possibleConstructorReturn$O(e,t){if(t&&("object"===_typeof$P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$O(e)}function _assertThisInitialized$O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$O(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$O(e){return _getPrototypeOf$O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$O(e)}var MoveCellsTransformer=function(e){_inherits$O(n,e);var t=_createSuper$O(n);function n(e,r,a,i){var o;return _classCallCheck$14(this,n),(o=t.call(this)).sourceRange=e,o.toRight=r,o.toBottom=a,o.toSheet=i,o.dependentFormulaTransformer=new DependentFormulaTransformer(e,r,a,i),o}return _createClass$14(n,[{key:"sheet",get:function(){return this.sourceRange.sheet}},{key:"isIrreversible",value:function(){return!0}},{key:"transformSingleAst",value:function(e,t){return this.sourceRange.addressInRange(t)?[this.transformAst(e,t),this.fixNodeAddress(t)]:this.dependentFormulaTransformer.transformSingleAst(e,t)}},{key:"fixNodeAddress",value:function(e){return simpleCellAddress(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}},{key:"transformCellAddress",value:function(e,t){return this.transformAddress(e,t)}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformColumnRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformAddress",value:function(e,t){var n=this.sourceRange;if(e instanceof CellAddress){var r=e.toSimpleCellAddress(t);if(n.addressInRange(r))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}},{key:"transformRange",value:function(e,t,n){var r=this.sourceRange;if(e instanceof CellAddress&&t instanceof CellAddress){var a=e.toSimpleCellAddress(n),i=t.toSimpleCellAddress(n);if(r.addressInRange(a)&&r.addressInRange(i))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}]),n}(Transformer),DependentFormulaTransformer=function(e){_inherits$O(n,e);var t=_createSuper$O(n);function n(e,r,a,i){var o;return _classCallCheck$14(this,n),(o=t.call(this)).sourceRange=e,o.toRight=r,o.toBottom=a,o.toSheet=i,o}return _createClass$14(n,[{key:"sheet",get:function(){return this.sourceRange.sheet}},{key:"isIrreversible",value:function(){return!0}},{key:"fixNodeAddress",value:function(e){return e}},{key:"transformCellAddress",value:function(e,t){return!!this.shouldMove(e,t)&&e.moved(this.toSheet,this.toRight,this.toBottom)}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformColumnRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"shouldMove",value:function(e,t){return e instanceof CellAddress?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof RowAddress?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}},{key:"transformRange",value:function(e,t,n){var r=this.transformCellAddress(e,n),a=this.transformCellAddress(t,n);return!(!r||!a)&&[r,a]}}]),n}(Transformer);function _typeof$O(e){return _typeof$O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$O(e)}function _classCallCheck$13(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$13(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$13(e,t,n){return t&&_defineProperties$13(e.prototype,t),n&&_defineProperties$13(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$N(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$N(e,t)}function _setPrototypeOf$N(e,t){return _setPrototypeOf$N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$N(e,t)}function _createSuper$N(e){var t=_isNativeReflectConstruct$N();return function(){var n,r=_getPrototypeOf$N(e);if(t){var a=_getPrototypeOf$N(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$N(this,n)}}function _possibleConstructorReturn$N(e,t){if(t&&("object"===_typeof$O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$N(e)}function _assertThisInitialized$N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$N(e){return _getPrototypeOf$N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$N(e)}var RemoveColumnsTransformer=function(e){_inherits$N(n,e);var t=_createSuper$N(n);function n(e){var r;return _classCallCheck$13(this,n),(r=t.call(this)).columnsSpan=e,r}return _createClass$13(n,[{key:"sheet",get:function(){return this.columnsSpan.sheet}},{key:"isIrreversible",value:function(){return!0}},{key:"transformRowRangeAst",value:function(e,t){return e}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){throw Error("Not implemented")}},{key:"transformColumnRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformCellAddress",value:function(e,t){var n=absoluteSheetReference(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==n)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===n){var r=e.toSimpleColumnAddress(t);if(r.col<this.columnsSpan.columnStart)return!1;if(r.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==n){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===n)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{var a=e.toSimpleColumnAddress(t);if(a.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(a.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return ErrorType.REF}},{key:"fixNodeAddress",value:function(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}},{key:"transformRange",value:function(e,t,n){var r=absoluteSheetReference(e,n),a=e,i=t;if(this.columnsSpan.sheet===r){var o=e.toSimpleColumnAddress(n),s=t.toSimpleColumnAddress(n);if(this.columnsSpan.columnStart<=o.col&&this.columnsSpan.columnEnd>=s.col)return ErrorType.REF;o.col>=this.columnsSpan.columnStart&&o.col<=this.columnsSpan.columnEnd&&(a=e.shiftedByColumns(this.columnsSpan.columnEnd-o.col+1)),s.col>=this.columnsSpan.columnStart&&s.col<=this.columnsSpan.columnEnd&&(i=t.shiftedByColumns(-(s.col-this.columnsSpan.columnStart+1)))}var l=this.transformCellAddress(a,n),u=this.transformCellAddress(i,n);if(!1===l&&!1===u)return[a,i];if(l===ErrorType.REF||u===ErrorType.REF)throw Error("Cannot happen");return[l||a,u||i]}}]),n}(Transformer);function _typeof$N(e){return _typeof$N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$N(e)}function _classCallCheck$12(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$12(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$12(e,t,n){return t&&_defineProperties$12(e.prototype,t),n&&_defineProperties$12(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$M(e,t)}function _setPrototypeOf$M(e,t){return _setPrototypeOf$M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$M(e,t)}function _createSuper$M(e){var t=_isNativeReflectConstruct$M();return function(){var n,r=_getPrototypeOf$M(e);if(t){var a=_getPrototypeOf$M(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$M(this,n)}}function _possibleConstructorReturn$M(e,t){if(t&&("object"===_typeof$N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$M(e)}function _assertThisInitialized$M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$M(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$M(e){return _getPrototypeOf$M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$M(e)}var RemoveRowsTransformer=function(e){_inherits$M(n,e);var t=_createSuper$M(n);function n(e){var r;return _classCallCheck$12(this,n),(r=t.call(this)).rowsSpan=e,r}return _createClass$12(n,[{key:"sheet",get:function(){return this.rowsSpan.sheet}},{key:"isIrreversible",value:function(){return!0}},{key:"transformColumnRangeAst",value:function(e,t){return e}},{key:"transformCellAddress",value:function(e,t){var n=absoluteSheetReference(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==n)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===n){var r=e.toSimpleRowAddress(t);if(r.row<this.rowsSpan.rowStart)return!1;if(r.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==n){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===n)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{var a=e.toSimpleRowAddress(t);if(a.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(a.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return ErrorType.REF}},{key:"transformCellRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformRowRange",value:function(e,t,n){return this.transformRange(e,t,n)}},{key:"transformColumnRange",value:function(e,t,n){throw Error("Not implemented")}},{key:"fixNodeAddress",value:function(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}},{key:"transformRange",value:function(e,t,n){var r=absoluteSheetReference(e,n),a=e,i=t;if(this.rowsSpan.sheet===r){var o=e.toSimpleRowAddress(n),s=t.toSimpleRowAddress(n);if(this.rowsSpan.rowStart<=o.row&&this.rowsSpan.rowEnd>=s.row)return ErrorType.REF;o.row>=this.rowsSpan.rowStart&&o.row<=this.rowsSpan.rowEnd&&(a=e.shiftedByRows(this.rowsSpan.rowEnd-o.row+1)),s.row>=this.rowsSpan.rowStart&&s.row<=this.rowsSpan.rowEnd&&(i=t.shiftedByRows(-(s.row-this.rowsSpan.rowStart+1)))}var l=this.transformCellAddress(a,n),u=this.transformCellAddress(i,n);return!1===l&&!1===u?[a,i]:l===ErrorType.REF||u===ErrorType.REF?ErrorType.REF:[l||a,u||i]}}]),n}(Transformer);function _typeof$M(e){return _typeof$M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$M(e)}function _slicedToArray$e(e,t){return _arrayWithHoles$e(e)||_iterableToArrayLimit$e(e,t)||_unsupportedIterableToArray$q(e,t)||_nonIterableRest$e()}function _nonIterableRest$e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$e(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$e(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$q(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$q(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$q(e,t):void 0}}function _arrayLikeToArray$q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$11(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$11(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$11(e,t,n){return t&&_defineProperties$11(e.prototype,t),n&&_defineProperties$11(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$L(e,t)}function _setPrototypeOf$L(e,t){return _setPrototypeOf$L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$L(e,t)}function _createSuper$L(e){var t=_isNativeReflectConstruct$L();return function(){var n,r=_getPrototypeOf$L(e);if(t){var a=_getPrototypeOf$L(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$L(this,n)}}function _possibleConstructorReturn$L(e,t){if(t&&("object"===_typeof$M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$L(e)}function _assertThisInitialized$L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$L(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$L(e){return _getPrototypeOf$L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$L(e)}var RemoveSheetTransformer=function(e){_inherits$L(n,e);var t=_createSuper$L(n);function n(e){var r;return _classCallCheck$11(this,n),(r=t.call(this)).sheet=e,r}return _createClass$11(n,[{key:"isIrreversible",value:function(){return!0}},{key:"performEagerTransformations",value:function(e,t){var n,r=_createForOfIteratorHelper$k(e.arrayFormulaNodes());try{for(r.s();!(n=r.n()).done;){var a=n.value,i=_slicedToArray$e(this.transformSingleAst(a.getFormula(e.lazilyTransformingAstService),a.getAddress(e.lazilyTransformingAstService)),1)[0];a.setFormula(i)}}catch(e){r.e(e)}finally{r.f()}}},{key:"fixNodeAddress",value:function(e){return e}},{key:"transformCellAddress",value:function(e,t){return this.transformAddress(e)}},{key:"transformCellRange",value:function(e,t,n){return this.transformAddress(e)}},{key:"transformColumnRange",value:function(e,t,n){return this.transformAddress(e)}},{key:"transformRowRange",value:function(e,t,n){return this.transformAddress(e)}},{key:"transformAddress",value:function(e){return e.sheet===this.sheet&&ErrorType.REF}}]),n}(Transformer);
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function validateAsSheet(e){if(!Array.isArray(e))throw new InvalidArgumentsError("an array of arrays.");for(var t=0;t<e.length;t++)if(!Array.isArray(e[t]))throw new InvalidArgumentsError("an array of arrays.")}function findBoundaries(e){for(var t=0,n=0,r=0,a=0;a<e.length;a++){for(var i=0,o=0;o<e[a].length;o++){var s=e[a][o];null!=s&&(i=o+1,++r)}t=Math.max(t,i),i>0&&(n=a+1)}var l=t*n;return{height:n,width:t,fill:0===l?0:r/l}}function _toConsumableArray$8(e){return _arrayWithoutHoles$8(e)||_iterableToArray$8(e)||_unsupportedIterableToArray$p(e)||_nonIterableSpread$8()}function _nonIterableSpread$8(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$8(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$8(e){if(Array.isArray(e))return _arrayLikeToArray$p(e)}function _slicedToArray$d(e,t){return _arrayWithHoles$d(e)||_iterableToArrayLimit$d(e,t)||_unsupportedIterableToArray$p(e,t)||_nonIterableRest$d()}function _nonIterableRest$d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$d(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$d(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$j(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$p(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$p(e,t):void 0}}function _arrayLikeToArray$p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$10(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$10(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$10(e,t,n){return t&&_defineProperties$10(e.prototype,t),n&&_defineProperties$10(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var RemoveRowsCommand=function(){function e(t,n){_classCallCheck$10(this,e),this.sheet=t,this.indexes=n}return _createClass$10(e,[{key:"normalizedIndexes",value:function(){return normalizeRemovedIndexes(this.indexes)}},{key:"rowsSpans",value:function(){var e=this;return this.normalizedIndexes().map((function(t){return RowsSpan.fromNumberOfRows(e.sheet,t[0],t[1])}))}}]),e}(),AddRowsCommand=function(){function e(t,n){_classCallCheck$10(this,e),this.sheet=t,this.indexes=n}return _createClass$10(e,[{key:"normalizedIndexes",value:function(){return normalizeAddedIndexes(this.indexes)}},{key:"rowsSpans",value:function(){var e=this;return this.normalizedIndexes().map((function(t){return RowsSpan.fromNumberOfRows(e.sheet,t[0],t[1])}))}}]),e}(),AddColumnsCommand=function(){function e(t,n){_classCallCheck$10(this,e),this.sheet=t,this.indexes=n}return _createClass$10(e,[{key:"normalizedIndexes",value:function(){return normalizeAddedIndexes(this.indexes)}},{key:"columnsSpans",value:function(){var e=this;return this.normalizedIndexes().map((function(t){return ColumnsSpan.fromNumberOfColumns(e.sheet,t[0],t[1])}))}}]),e}(),RemoveColumnsCommand=function(){function e(t,n){_classCallCheck$10(this,e),this.sheet=t,this.indexes=n}return _createClass$10(e,[{key:"normalizedIndexes",value:function(){return normalizeRemovedIndexes(this.indexes)}},{key:"columnsSpans",value:function(){var e=this;return this.normalizedIndexes().map((function(t){return ColumnsSpan.fromNumberOfColumns(e.sheet,t[0],t[1])}))}}]),e}(),Operations=function(){function e(t,n,r,a,i,o,s,l,u){_classCallCheck$10(this,e),this.dependencyGraph=n,this.columnSearch=r,this.cellContentParser=a,this.parser=i,this.stats=o,this.lazilyTransformingAstService=s,this.namedExpressions=l,this.arraySizePredictor=u,this.changes=ContentChanges.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=t.maxColumns,this.maxRows=t.maxRows}return _createClass$10(e,[{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}},{key:"addressMapping",get:function(){return this.dependencyGraph.addressMapping}},{key:"removeRows",value:function(e){var t,n=[],r=_createForOfIteratorHelper$j(e.rowsSpans());try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.doRemoveRows(a);i&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"addRows",value:function(e){var t,n=_createForOfIteratorHelper$j(e.rowsSpans());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.doAddRows(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"addColumns",value:function(e){var t,n=_createForOfIteratorHelper$j(e.columnsSpans());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.doAddColumns(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"removeColumns",value:function(e){var t,n=[],r=_createForOfIteratorHelper$j(e.columnsSpans());try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.doRemoveColumns(a);i&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"removeSheet",value:function(e){var t,n=this;this.dependencyGraph.removeSheet(e),this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var r=new RemoveSheetTransformer(e);r.performEagerTransformations(n.dependencyGraph,n.parser),t=n.lazilyTransformingAstService.addTransformation(r)})),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);var r=this.namedExpressions.getAllNamedExpressionsForScope(e).map((function(t){return n.removeNamedExpression(t.normalizeExpressionName(),e)}));return{version:t,scopedNamedExpressions:r}}},{key:"removeSheetByName",value:function(e){var t=this.sheetMapping.fetch(e);return this.removeSheet(t)}},{key:"clearSheet",value:function(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}},{key:"addSheet",value:function(e){var t=this.sheetMapping.addSheet(e),n=[];return this.dependencyGraph.addressMapping.autoAddSheet(t,n,findBoundaries(n)),this.sheetMapping.fetchDisplayName(t)}},{key:"renameSheet",value:function(e,t){return this.sheetMapping.renameSheet(e,t)}},{key:"moveRows",value:function(e,t,n,r){var a=RowsSpan.fromNumberOfRows(e,r,n);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(a),r<t&&(t+=n);var i=simpleCellAddress(e,0,t),o=simpleCellAddress(e,0,r);this.moveCells(i,Number.POSITIVE_INFINITY,n,o);var s=RowsSpan.fromNumberOfRows(e,t,n);return this.doRemoveRows(s),this.lazilyTransformingAstService.commitCombinedMode()}},{key:"moveColumns",value:function(e,t,n,r){var a=ColumnsSpan.fromNumberOfColumns(e,r,n);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(a),r<t&&(t+=n);var i=simpleCellAddress(e,t,0),o=simpleCellAddress(e,r,0);this.moveCells(i,n,Number.POSITIVE_INFINITY,o);var s=ColumnsSpan.fromNumberOfColumns(e,t,n);return this.doRemoveColumns(s),this.lazilyTransformingAstService.commitCombinedMode()}},{key:"moveCells",value:function(e,t,n,r){var a=this;this.ensureItIsPossibleToMoveCells(e,t,n,r);var i=AbsoluteCellRange.spanFrom(e,t,n),o=AbsoluteCellRange.spanFrom(r,t,n),s=r.col-e.col,l=r.row-e.row,u=r.sheet,c=this.getRangeClipboardCells(o),p=this.dependencyGraph.rawValuesFromRange(o);this.columnSearch.removeValues(p);var d,m=this.dependencyGraph.rawValuesFromRange(i);this.columnSearch.moveValues(m,s,l,u),this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var e=new MoveCellsTransformer(i,s,l,u);e.performEagerTransformations(a.dependencyGraph,a.parser),d=a.lazilyTransformingAstService.addTransformation(e)})),this.dependencyGraph.moveCells(i,s,l,u);var f=this.updateNamedExpressionsForMovedCells(e,t,n,r);return{version:d,overwrittenCellsData:c,addedGlobalNamedExpressions:f}}},{key:"setRowOrder",value:function(e,t){var n,r=this,a=[],i=[],o=_createForOfIteratorHelper$j(t);try{var s=function(){var t=_slicedToArray$d(n.value,2),o=t[0],s=t[1];if(o!==s){var l=AbsoluteCellRange.spanFrom({sheet:e,col:0,row:o},1/0,1),u=r.getRangeClipboardCells(l);i=i.concat(u),a.push(u.map((function(e){var t=_slicedToArray$d(e,2),n=t[0],r=n.sheet,a=n.col,i=t[1];return[{sheet:r,col:a,row:s},i]})))}};for(o.s();!(n=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return a.forEach((function(t){return r.restoreClipboardCells(e,t.values())})),i}},{key:"setColumnOrder",value:function(e,t){var n,r=this,a=[],i=[],o=_createForOfIteratorHelper$j(t);try{var s=function(){var t=_slicedToArray$d(n.value,2),o=t[0],s=t[1];if(o!==s){var l=AbsoluteCellRange.spanFrom({sheet:e,col:o,row:0},1,1/0),u=r.getRangeClipboardCells(l);i=i.concat(u),a.push(u.map((function(e){var t=_slicedToArray$d(e,2),n=t[0],r=n.sheet,a=(n.col,n.row),i=t[1];return[{sheet:r,col:s,row:a},i]})))}};for(o.s();!(n=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return a.forEach((function(t){return r.restoreClipboardCells(e,t.values())})),i}},{key:"addNamedExpression",value:function(e,t,n,r){var a=this.namedExpressions.addNamedExpression(e,n,r);this.storeNamedExpressionInCell(a.address,t),this.adjustNamedExpressionEdges(a,e,n)}},{key:"restoreNamedExpression",value:function(e,t,n){var r=e.displayName;this.restoreCell(e.address,t);var a=this.namedExpressions.restoreNamedExpression(e,n);this.adjustNamedExpressionEdges(a,r,n)}},{key:"changeNamedExpressionExpression",value:function(e,t,n,r){var a=this.namedExpressions.namedExpressionForScope(e,n);if(!a)throw new NamedExpressionDoesNotExistError(e);var i=a.copy();a.options=r;var o=this.getClipboardCell(a.address);return this.storeNamedExpressionInCell(a.address,t),[i,o]}},{key:"removeNamedExpression",value:function(e,t){var n=this.namedExpressions.namedExpressionForScope(e,t);if(!n)throw new NamedExpressionDoesNotExistError(e);this.namedExpressions.remove(n.displayName,t);var r=this.getClipboardCell(n.address);if(void 0!==t){var a=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(n.address,a.address)}else this.dependencyGraph.setCellEmpty(n.address);return[n,r]}},{key:"ensureItIsPossibleToMoveCells",value:function(e,t,n,r){if(invalidSimpleCellAddress(e)||!(isPositiveInteger$1(t)&&isPositiveInteger$1(n)||isRowOrColumnRange(e,t,n))||invalidSimpleCellAddress(r)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(r.sheet))throw new InvalidArgumentsError("a valid range of cells to move.");var a=AbsoluteCellRange.spanFrom(e,t,n),i=AbsoluteCellRange.spanFrom(r,t,n);if(i.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(a))throw new SourceLocationHasArrayError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new TargetLocationHasArrayError}},{key:"restoreClipboardCells",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper$j(t);try{for(a.s();!(n=a.n()).done;){var i=_slicedToArray$d(n.value,2),o=i[0],s=i[1];if(this.restoreCell(o,s),s.type===ClipboardCellType.FORMULA){var l=this.parser.fetchCachedResult(s.hash).dependencies;r.push.apply(r,_toConsumableArray$8(this.updateNamedExpressionsForTargetAddress(e,o,l)))}}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"restoreCell",value:function(e,t){switch(t.type){case ClipboardCellType.VALUE:this.setValueToCell(t,e);break;case ClipboardCellType.FORMULA:this.setFormulaToCellFromCache(t.hash,e);break;case ClipboardCellType.EMPTY:this.setCellEmpty(e);break;case ClipboardCellType.PARSING_ERROR:this.setParsingErrorToCell(t.rawInput,t.errors,e)}}},{key:"getOldContent",value:function(e){var t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof EmptyCellVertex)return[e,{type:ClipboardCellType.EMPTY}];if(t instanceof ValueCellVertex)return[e,Object.assign({type:ClipboardCellType.VALUE},t.getValues())];if(t instanceof FormulaVertex)return[t.getAddress(this.lazilyTransformingAstService),{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof ParsingErrorVertex)return[e,{type:ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}},{key:"getClipboardCell",value:function(e){var t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof EmptyCellVertex)return{type:ClipboardCellType.EMPTY};if(t instanceof ValueCellVertex)return Object.assign({type:ClipboardCellType.VALUE},t.getValues());if(t instanceof ArrayVertex){var n=t.getArrayCellValue(e);return n===EmptyValue?{type:ClipboardCellType.EMPTY}:{type:ClipboardCellType.VALUE,parsedValue:n,rawValue:t.getArrayCellRawValue(e)}}if(t instanceof FormulaCellVertex)return{type:ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof ParsingErrorVertex)return{type:ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors};throw Error("Trying to copy unsupported type")}},{key:"getSheetClipboardCells",value:function(e){for(var t=this.dependencyGraph.getSheetHeight(e),n=this.dependencyGraph.getSheetWidth(e),r=new Array(t),a=0;a<t;a++){r[a]=new Array(n);for(var i=0;i<n;i++){var o=simpleCellAddress(e,i,a);r[a][i]=this.getClipboardCell(o)}}return r}},{key:"getRangeClipboardCells",value:function(e){var t,n=[],r=_createForOfIteratorHelper$j(e.addresses(this.dependencyGraph));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push([a,this.getClipboardCell(a)])}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"setCellContent",value:function(e,t){var n=this.cellContentParser.parse(t),r=this.getOldContent(e);if(n instanceof CellContent.Formula){var a=this.parser.parse(n.formula,e),i=a.ast,o=a.errors;if(o.length>0)this.setParsingErrorToCell(n.formula,o,e);else{var s=this.arraySizePredictor.checkArraySize(i,e);this.setFormulaToCell(e,s,a)}}else n instanceof CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:n.value,rawValue:t},e);return r}},{key:"setSheetContent",value:function(e,t){this.clearSheet(e);for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){var a=simpleCellAddress(e,r,n);this.setCellContent(a,t[n][r])}}},{key:"setParsingErrorToCell",value:function(e,t,n){var r=this.dependencyGraph.getCellValue(n),a=new ParsingErrorVertex(t,e),i=this.dependencyGraph.setParsingErrorToCell(n,a);this.columnSearch.remove(getRawValue(r),n),this.columnSearch.applyChanges(i.getChanges()),this.changes.addAll(i),this.changes.addChange(a.getCellValue(),n)}},{key:"setFormulaToCell",value:function(e,t,n){var r=n.ast,a=n.hasVolatileFunction,i=n.hasStructuralChangeFunction,o=n.dependencies,s=this.dependencyGraph.getCellValue(e),l=this.dependencyGraph.setFormulaToCell(e,r,absolutizeDependencies(o,e),t,a,i);this.columnSearch.remove(getRawValue(s),e),this.columnSearch.applyChanges(l.getChanges()),this.changes.addAll(l)}},{key:"setValueToCell",value:function(e,t){var n=this.dependencyGraph.getCellValue(t),r=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change(getRawValue(n),getRawValue(e.parsedValue),t),this.columnSearch.applyChanges(r.getChanges().filter((function(e){return!equalSimpleCellAddress(e.address,t)}))),this.changes.addAll(r),this.changes.addChange(e.parsedValue,t)}},{key:"setCellEmpty",value:function(e){if(!this.dependencyGraph.isArrayInternalCell(e)){var t=this.dependencyGraph.getCellValue(e),n=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove(getRawValue(t),e),this.columnSearch.applyChanges(n.getChanges()),this.changes.addAll(n),this.changes.addChange(EmptyValue,e)}}},{key:"setFormulaToCellFromCache",value:function(e,t){var n=this.parser.fetchCachedResult(e),r=n.ast,a=n.hasVolatileFunction,i=n.hasStructuralChangeFunction,o=n.dependencies,s=absolutizeDependencies(o,t),l=_slicedToArray$d(new CleanOutOfScopeDependenciesTransformer(t.sheet).transformSingleAst(r,t),1)[0];this.parser.rememberNewAst(l);var u=filterDependenciesOutOfScope(s),c=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,l,u,c,a,i)}},{key:"rowEffectivelyNotInSheet",value:function(e,t){return e>=this.dependencyGraph.addressMapping.getHeight(t)}},{key:"getAndClearContentChanges",value:function(){var e=this.changes;return this.changes=ContentChanges.empty(),e}},{key:"forceApplyPostponedTransformations",value:function(){this.dependencyGraph.forceApplyPostponedTransformations()}},{key:"doRemoveRows",value:function(e){var t=this;if(!this.rowEffectivelyNotInSheet(e.rowStart,e.sheet)){var n,r=[],a=_createForOfIteratorHelper$j(this.dependencyGraph.entriesFromRowsSpan(e));try{for(a.s();!(n=a.n()).done;){var i=_slicedToArray$d(n.value,1)[0];r.push({address:i,cellType:this.getClipboardCell(i)})}}catch(e){a.e(e)}finally{a.f()}var o,s=this.dependencyGraph.removeRows(e),l=s.affectedArrays,u=s.contentChanges;return this.columnSearch.applyChanges(u.getChanges()),this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var n=new RemoveRowsTransformer(e);n.performEagerTransformations(t.dependencyGraph,t.parser),o=t.lazilyTransformingAstService.addTransformation(n)})),this.rewriteAffectedArrays(l),{version:o,removedCells:r,rowFrom:e.rowStart,rowCount:e.numberOfRows}}}},{key:"doRemoveColumns",value:function(e){var t=this;if(!this.columnEffectivelyNotInSheet(e.columnStart,e.sheet)){var n,r=[],a=_createForOfIteratorHelper$j(this.dependencyGraph.entriesFromColumnsSpan(e));try{for(a.s();!(n=a.n()).done;){var i=_slicedToArray$d(n.value,1)[0];r.push({address:i,cellType:this.getClipboardCell(i)})}}catch(e){a.e(e)}finally{a.f()}var o,s=this.dependencyGraph.removeColumns(e),l=s.affectedArrays,u=s.contentChanges;return this.columnSearch.applyChanges(u.getChanges()),this.columnSearch.removeColumns(e),this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var n=new RemoveColumnsTransformer(e);n.performEagerTransformations(t.dependencyGraph,t.parser),o=t.lazilyTransformingAstService.addTransformation(n)})),this.rewriteAffectedArrays(l),{version:o,removedCells:r,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}}},{key:"doAddRows",value:function(e){var t=this;if(!this.rowEffectivelyNotInSheet(e.rowStart,e.sheet)){var n=this.dependencyGraph.addRows(e).affectedArrays;this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var n=new AddRowsTransformer(e);n.performEagerTransformations(t.dependencyGraph,t.parser),t.lazilyTransformingAstService.addTransformation(n)})),this.rewriteAffectedArrays(n)}}},{key:"rewriteAffectedArrays",value:function(e){var t,n=_createForOfIteratorHelper$j(e.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!r.array.size.isRef){var a=r.getFormula(this.lazilyTransformingAstService),i=r.getAddress(this.lazilyTransformingAstService),o=this.parser.computeHashFromAst(a);this.setFormulaToCellFromCache(o,i)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"doAddColumns",value:function(e){var t=this;if(!this.columnEffectivelyNotInSheet(e.columnStart,e.sheet)){var n=this.dependencyGraph.addColumns(e),r=n.affectedArrays,a=n.contentChanges;this.columnSearch.addColumns(e),this.columnSearch.applyChanges(a.getChanges()),this.stats.measure(StatType.TRANSFORM_ASTS,(function(){var n=new AddColumnsTransformer(e);n.performEagerTransformations(t.dependencyGraph,t.parser),t.lazilyTransformingAstService.addTransformation(n)})),this.rewriteAffectedArrays(r)}}},{key:"columnEffectivelyNotInSheet",value:function(e,t){return e>=this.dependencyGraph.addressMapping.getWidth(t)}},{key:"adjustNamedExpressionEdges",value:function(e,t,n){if(void 0!==n){var r,a=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),o=this.dependencyGraph.fetchCellOrCreateEmpty(i.address),s=_createForOfIteratorHelper$j(this.dependencyGraph.graph.adjacentNodes(o));try{for(s.s();!(r=s.n()).done;){var l=r.value;if(l instanceof FormulaCellVertex&&l.getAddress(this.lazilyTransformingAstService).sheet===n){var u,c=l.getFormula(this.lazilyTransformingAstService),p=l.getAddress(this.lazilyTransformingAstService),d=this.parser.fetchCachedResultForAst(c).dependencies,m=_createForOfIteratorHelper$j(absolutizeDependencies(d,p));try{for(m.s();!(u=m.n()).done;){var f=u.value;f instanceof NamedExpressionDependency&&f.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(o,l),this.dependencyGraph.graph.addEdge(a,l))}}catch(e){m.e(e)}finally{m.f()}}}}catch(e){s.e(e)}finally{s.f()}}}},{key:"storeNamedExpressionInCell",value:function(e,t){var n=this.cellContentParser.parse(t);if(n instanceof CellContent.Formula){var r=this.parser.parse(n.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(r.ast))throw new NoRelativeAddressesAllowedError;var a=r.ast,i=r.hasVolatileFunction,o=r.hasStructuralChangeFunction,s=r.dependencies;this.dependencyGraph.setFormulaToCell(e,a,absolutizeDependencies(s,e),ArraySize.scalar(),i,o)}else n instanceof CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:n.value,rawValue:t},e)}},{key:"updateNamedExpressionsForMovedCells",value:function(e,t,n,r){if(e.sheet===r.sheet)return[];var a,i=[],o=_createForOfIteratorHelper$j(AbsoluteCellRange.spanFrom(r,t,n).addresses(this.dependencyGraph));try{for(o.s();!(a=o.n()).done;){var s=a.value,l=this.addressMapping.fetchCell(s);if(l instanceof FormulaCellVertex&&s.sheet!==e.sheet){var u=l.getFormula(this.lazilyTransformingAstService),c=this.parser.fetchCachedResultForAst(u).dependencies;i.push.apply(i,_toConsumableArray$8(this.updateNamedExpressionsForTargetAddress(e.sheet,s,c)))}}}catch(e){o.e(e)}finally{o.f()}return i}},{key:"updateNamedExpressionsForTargetAddress",value:function(e,t,n){if(e===t.sheet)return[];var r,a=[],i=this.addressMapping.fetchCell(t),o=_createForOfIteratorHelper$j(absolutizeDependencies(n,t));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s instanceof NamedExpressionDependency){var l=s.name,u=this.dependencyGraph.fetchNamedExpressionVertex(l,e),c=this.namedExpressions.isExpressionInScope(l,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(l,t.sheet):this.copyOrFetchGlobalNamedExpressionVertex(l,u,a);c!==u&&(this.dependencyGraph.graph.softRemoveEdge(u,i),this.dependencyGraph.graph.addEdge(c,i))}}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"allocateNamedExpressionAddressSpace",value:function(){this.dependencyGraph.addressMapping.addSheet(-1,new SparseStrategy(0,0))}},{key:"copyOrFetchGlobalNamedExpressionVertex",value:function(e,t,n){var r=this.namedExpressions.namedExpressionForScope(e);if(void 0===r)if(r=this.namedExpressions.addNamedExpression(e),n.push(r.normalizeExpressionName()),t instanceof FormulaCellVertex){var a=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),i=a.ast,o=a.hasVolatileFunction,s=a.hasStructuralChangeFunction,l=a.dependencies;this.dependencyGraph.setFormulaToCell(r.address,i,absolutizeDependencies(l,r.address),ArraySize.scalar(),o,s)}else t instanceof EmptyCellVertex?this.setCellEmpty(r.address):t instanceof ValueCellVertex&&this.setValueToCell(t.getValues(),r.address);return this.dependencyGraph.fetchCellOrCreateEmpty(r.address)}}]),e}();function normalizeRemovedIndexes(e){if(e.length<=1)return e;for(var t=_toConsumableArray$8(e).sort((function(e,t){return _slicedToArray$d(e,1)[0]-_slicedToArray$d(t,1)[0]})),n=t.reduce((function(e,t){var n=_slicedToArray$d(t,2),r=n[0],a=n[1],i=e[e.length-1],o=i[0]+i[1];return r<=o?i[1]+=Math.max(0,a-(o-r)):e.push([r,a]),e}),[t[0]]),r=0,a=0;a<n.length;++a)n[a][0]-=r,r+=n[a][1];return n}function normalizeAddedIndexes(e){if(e.length<=1)return e;for(var t=_toConsumableArray$8(e).sort((function(e,t){return _slicedToArray$d(e,1)[0]-_slicedToArray$d(t,1)[0]})),n=t.reduce((function(e,t){var n=_slicedToArray$d(t,2),r=n[0],a=n[1],i=e[e.length-1];return r===i[0]?i[1]=Math.max(i[1],a):e.push([r,a]),e}),[t[0]]),r=0,a=0;a<n.length;++a)n[a][0]+=r,r+=n[a][1];return n}function isPositiveInteger$1(e){return Number.isInteger(e)&&e>0}function isRowOrColumnRange(e,t,n){return 0===e.row&&isPositiveInteger$1(t)&&n===Number.POSITIVE_INFINITY||0===e.col&&isPositiveInteger$1(n)&&t===Number.POSITIVE_INFINITY}function _typeof$L(e){return _typeof$L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$L(e)}function _slicedToArray$c(e,t){return _arrayWithHoles$c(e)||_iterableToArrayLimit$c(e,t)||_unsupportedIterableToArray$o(e,t)||_nonIterableRest$c()}function _nonIterableRest$c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$c(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$c(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$o(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$o(e,t):void 0}}function _arrayLikeToArray$o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _inherits$K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$K(e,t)}function _setPrototypeOf$K(e,t){return _setPrototypeOf$K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$K(e,t)}function _createSuper$K(e){var t=_isNativeReflectConstruct$K();return function(){var n,r=_getPrototypeOf$K(e);if(t){var a=_getPrototypeOf$K(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$K(this,n)}}function _possibleConstructorReturn$K(e,t){if(t&&("object"===_typeof$L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$K(e)}function _assertThisInitialized$K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$K(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$K(e){return _getPrototypeOf$K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$K(e)}function _defineProperties$$(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$$(e,t,n){return t&&_defineProperties$$(e.prototype,t),n&&_defineProperties$$(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck$$(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var BaseUndoEntry=_createClass$$((function e(){_classCallCheck$$(this,e)})),RemoveRowsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r){var a;return _classCallCheck$$(this,n),(a=t.call(this)).command=e,a.rowsRemovals=r,a}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoRemoveRows(this)}},{key:"doRedo",value:function(e){e.redoRemoveRows(this)}}]),n}(BaseUndoEntry),MoveCellsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i,o,s,l){var u;return _classCallCheck$$(this,n),(u=t.call(this)).sourceLeftCorner=e,u.width=r,u.height=a,u.destinationLeftCorner=i,u.overwrittenCellsData=o,u.addedGlobalNamedExpressions=s,u.version=l,u}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoMoveCells(this)}},{key:"doRedo",value:function(e){e.redoMoveCells(this)}}]),n}(BaseUndoEntry),AddRowsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e){var r;return _classCallCheck$$(this,n),(r=t.call(this)).command=e,r}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoAddRows(this)}},{key:"doRedo",value:function(e){e.redoAddRows(this)}}]),n}(BaseUndoEntry),SetRowOrderUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a){var i;return _classCallCheck$$(this,n),(i=t.call(this)).sheetId=e,i.rowMapping=r,i.oldContent=a,i}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoSetRowOrder(this)}},{key:"doRedo",value:function(e){e.redoSetRowOrder(this)}}]),n}(BaseUndoEntry),SetColumnOrderUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a){var i;return _classCallCheck$$(this,n),(i=t.call(this)).sheetId=e,i.columnMapping=r,i.oldContent=a,i}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoSetColumnOrder(this)}},{key:"doRedo",value:function(e){e.redoSetColumnOrder(this)}}]),n}(BaseUndoEntry),SetSheetContentUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a){var i;return _classCallCheck$$(this,n),(i=t.call(this)).sheetId=e,i.oldSheetContent=r,i.newSheetContent=a,i}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoSetSheetContent(this)}},{key:"doRedo",value:function(e){e.redoSetSheetContent(this)}}]),n}(BaseUndoEntry),MoveRowsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i,o){var s;return _classCallCheck$$(this,n),(s=t.call(this)).sheet=e,s.startRow=r,s.numberOfRows=a,s.targetRow=i,s.version=o,s.undoStart=s.startRow<s.targetRow?s.targetRow-s.numberOfRows:s.targetRow,s.undoEnd=s.startRow>s.targetRow?s.startRow+s.numberOfRows:s.startRow,s}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoMoveRows(this)}},{key:"doRedo",value:function(e){e.redoMoveRows(this)}}]),n}(BaseUndoEntry),MoveColumnsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i,o){var s;return _classCallCheck$$(this,n),(s=t.call(this)).sheet=e,s.startColumn=r,s.numberOfColumns=a,s.targetColumn=i,s.version=o,s.undoStart=s.startColumn<s.targetColumn?s.targetColumn-s.numberOfColumns:s.targetColumn,s.undoEnd=s.startColumn>s.targetColumn?s.startColumn+s.numberOfColumns:s.startColumn,s}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoMoveColumns(this)}},{key:"doRedo",value:function(e){e.redoMoveColumns(this)}}]),n}(BaseUndoEntry),AddColumnsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e){var r;return _classCallCheck$$(this,n),(r=t.call(this)).command=e,r}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoAddColumns(this)}},{key:"doRedo",value:function(e){e.redoAddColumns(this)}}]),n}(BaseUndoEntry),RemoveColumnsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r){var a;return _classCallCheck$$(this,n),(a=t.call(this)).command=e,a.columnsRemovals=r,a}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoRemoveColumns(this)}},{key:"doRedo",value:function(e){e.redoRemoveColumns(this)}}]),n}(BaseUndoEntry),AddSheetUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e){var r;return _classCallCheck$$(this,n),(r=t.call(this)).sheetName=e,r}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoAddSheet(this)}},{key:"doRedo",value:function(e){e.redoAddSheet(this)}}]),n}(BaseUndoEntry),RemoveSheetUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i,o){var s;return _classCallCheck$$(this,n),(s=t.call(this)).sheetName=e,s.sheetId=r,s.oldSheetContent=a,s.scopedNamedExpressions=i,s.version=o,s}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoRemoveSheet(this)}},{key:"doRedo",value:function(e){e.redoRemoveSheet(this)}}]),n}(BaseUndoEntry),RenameSheetUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a){var i;return _classCallCheck$$(this,n),(i=t.call(this)).sheetId=e,i.oldName=r,i.newName=a,i}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoRenameSheet(this)}},{key:"doRedo",value:function(e){e.redoRenameSheet(this)}}]),n}(BaseUndoEntry),ClearSheetUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r){var a;return _classCallCheck$$(this,n),(a=t.call(this)).sheetId=e,a.oldSheetContent=r,a}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoClearSheet(this)}},{key:"doRedo",value:function(e){e.redoClearSheet(this)}}]),n}(BaseUndoEntry),SetCellContentsUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e){var r;return _classCallCheck$$(this,n),(r=t.call(this)).cellContents=e,r}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoSetCellContents(this)}},{key:"doRedo",value:function(e){e.redoSetCellContents(this)}}]),n}(BaseUndoEntry),PasteUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i){var o;return _classCallCheck$$(this,n),(o=t.call(this)).targetLeftCorner=e,o.oldContent=r,o.newContent=a,o.addedGlobalNamedExpressions=i,o}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoPaste(this)}},{key:"doRedo",value:function(e){e.redoPaste(this)}}]),n}(BaseUndoEntry),AddNamedExpressionUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i){var o;return _classCallCheck$$(this,n),(o=t.call(this)).name=e,o.newContent=r,o.scope=a,o.options=i,o}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoAddNamedExpression(this)}},{key:"doRedo",value:function(e){e.redoAddNamedExpression(this)}}]),n}(BaseUndoEntry),RemoveNamedExpressionUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a){var i;return _classCallCheck$$(this,n),(i=t.call(this)).namedExpression=e,i.content=r,i.scope=a,i}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoRemoveNamedExpression(this)}},{key:"doRedo",value:function(e){e.redoRemoveNamedExpression(this)}}]),n}(BaseUndoEntry),ChangeNamedExpressionUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(e,r,a,i,o){var s;return _classCallCheck$$(this,n),(s=t.call(this)).namedExpression=e,s.newContent=r,s.oldContent=a,s.scope=i,s.options=o,s}return _createClass$$(n,[{key:"doUndo",value:function(e){e.undoChangeNamedExpression(this)}},{key:"doRedo",value:function(e){e.redoChangeNamedExpression(this)}}]),n}(BaseUndoEntry),BatchUndoEntry=function(e){_inherits$K(n,e);var t=_createSuper$K(n);function n(){var e;return _classCallCheck$$(this,n),(e=t.apply(this,arguments)).operations=[],e}return _createClass$$(n,[{key:"add",value:function(e){this.operations.push(e)}},{key:"reversedOperations",value:regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.operations.length-1;case 1:if(!(t>=0)){e.next=7;break}return e.next=4,this.operations[t];case 4:t--,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"doUndo",value:function(e){e.undoBatch(this)}},{key:"doRedo",value:function(e){e.redoBatch(this)}}]),n}(BaseUndoEntry),UndoRedo=function(){function e(t,n){_classCallCheck$$(this,e),this.operations=n,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=t.undoLimit}return _createClass$$(e,[{key:"saveOperation",value:function(e){void 0!==this.batchUndoEntry?this.batchUndoEntry.add(e):this.addUndoEntry(e)}},{key:"beginBatchMode",value:function(){this.batchUndoEntry=new BatchUndoEntry}},{key:"commitBatchMode",value:function(){if(void 0===this.batchUndoEntry)throw"Batch mode wasn't started";this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}},{key:"storeDataForVersion",value:function(e,t,n){this.oldData.has(e)||this.oldData.set(e,[]),this.oldData.get(e).push([t,n])}},{key:"clearRedoStack",value:function(){this.redoStack=[]}},{key:"clearUndoStack",value:function(){this.undoStack=[]}},{key:"isUndoStackEmpty",value:function(){return 0===this.undoStack.length}},{key:"isRedoStackEmpty",value:function(){return 0===this.redoStack.length}},{key:"undo",value:function(){var e=this.undoStack.pop();if(!e)throw"Attempted to undo without operation on stack";this.undoEntry(e),this.redoStack.push(e)}},{key:"undoBatch",value:function(e){var t,n=_createForOfIteratorHelper$i(e.reversedOperations());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.undoEntry(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"undoRemoveRows",value:function(e){this.operations.forceApplyPostponedTransformations();for(var t=e.command.sheet,n=e.rowsRemovals,r=n.length-1;r>=0;--r){var a=n[r];this.operations.addRows(new AddRowsCommand(t,[[a.rowFrom,a.rowCount]]));var i,o=_createForOfIteratorHelper$i(a.removedCells);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.address,u=s.cellType;this.operations.restoreCell(l,u)}}catch(e){o.e(e)}finally{o.f()}this.restoreOldDataFromVersion(a.version-1)}}},{key:"undoRemoveColumns",value:function(e){this.operations.forceApplyPostponedTransformations();for(var t=e.command.sheet,n=e.columnsRemovals,r=n.length-1;r>=0;--r){var a=n[r];this.operations.addColumns(new AddColumnsCommand(t,[[a.columnFrom,a.columnCount]]));var i,o=_createForOfIteratorHelper$i(a.removedCells);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.address,u=s.cellType;this.operations.restoreCell(l,u)}}catch(e){o.e(e)}finally{o.f()}this.restoreOldDataFromVersion(a.version-1)}}},{key:"undoAddRows",value:function(e){for(var t=e.command.rowsSpans(),n=t.length-1;n>=0;--n){var r=t[n];this.operations.removeRows(new RemoveRowsCommand(e.command.sheet,[[r.rowStart,r.numberOfRows]]))}}},{key:"undoAddColumns",value:function(e){for(var t=e.command.columnsSpans(),n=t.length-1;n>=0;--n){var r=t[n];this.operations.removeColumns(new RemoveColumnsCommand(e.command.sheet,[[r.columnStart,r.numberOfColumns]]))}}},{key:"undoSetCellContents",value:function(e){var t,n=_createForOfIteratorHelper$i(e.cellContents);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.address,i=_slicedToArray$c(r.oldContent,2),o=i[0],s=i[1];equalSimpleCellAddress(a,o)||this.operations.setCellEmpty(a),this.operations.restoreCell(o,s)}}catch(e){n.e(e)}finally{n.f()}}},{key:"undoPaste",value:function(e){this.restoreOperationOldContent(e.oldContent);var t,n=_createForOfIteratorHelper$i(e.addedGlobalNamedExpressions);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.operations.removeNamedExpression(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"undoMoveRows",value:function(e){var t=e.sheet;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}},{key:"undoMoveColumns",value:function(e){var t=e.sheet;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}},{key:"undoMoveCells",value:function(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);var t,n=_createForOfIteratorHelper$i(e.addedGlobalNamedExpressions);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.operations.removeNamedExpression(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"undoAddSheet",value:function(e){var t=e.sheetName;this.operations.removeSheetByName(t)}},{key:"undoRemoveSheet",value:function(e){this.operations.forceApplyPostponedTransformations();var t=e.oldSheetContent,n=e.sheetId;this.operations.addSheet(e.sheetName);for(var r=0;r<t.length;r++)for(var a=t[r],i=0;i<a.length;i++){var o=a[i],s=simpleCellAddress(n,i,r);this.operations.restoreCell(s,o)}var l,u=_createForOfIteratorHelper$i(e.scopedNamedExpressions);try{for(u.s();!(l=u.n()).done;){var c=_slicedToArray$c(l.value,2),p=c[0],d=c[1];this.operations.restoreNamedExpression(p,d,n)}}catch(e){u.e(e)}finally{u.f()}this.restoreOldDataFromVersion(e.version-1)}},{key:"undoRenameSheet",value:function(e){this.operations.renameSheet(e.sheetId,e.oldName)}},{key:"undoClearSheet",value:function(e){for(var t=e.oldSheetContent,n=e.sheetId,r=0;r<t.length;r++)for(var a=t[r],i=0;i<a.length;i++){var o=a[i],s=simpleCellAddress(n,i,r);this.operations.restoreCell(s,o)}}},{key:"undoSetSheetContent",value:function(e){var t=e.oldSheetContent,n=e.sheetId;this.operations.clearSheet(n);for(var r=0;r<t.length;r++)for(var a=t[r],i=0;i<a.length;i++){var o=a[i],s=simpleCellAddress(n,i,r);this.operations.restoreCell(s,o)}}},{key:"undoAddNamedExpression",value:function(e){this.operations.removeNamedExpression(e.name,e.scope)}},{key:"undoRemoveNamedExpression",value:function(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}},{key:"undoChangeNamedExpression",value:function(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}},{key:"undoSetRowOrder",value:function(e){this.restoreOperationOldContent(e.oldContent)}},{key:"undoSetColumnOrder",value:function(e){this.restoreOperationOldContent(e.oldContent)}},{key:"redo",value:function(){var e=this.redoStack.pop();if(!e)throw"Attempted to redo without operation on stack";this.redoEntry(e),this.undoStack.push(e)}},{key:"redoBatch",value:function(e){var t,n=_createForOfIteratorHelper$i(e.operations);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.redoEntry(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"redoRemoveRows",value:function(e){this.operations.removeRows(e.command)}},{key:"redoMoveCells",value:function(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}},{key:"redoRemoveColumns",value:function(e){this.operations.removeColumns(e.command)}},{key:"redoPaste",value:function(e){for(var t=e.targetLeftCorner,n=e.newContent,r=n.length,a=n[0].length,i=0;i<r;++i)for(var o=0;o<a;++o){var s=simpleCellAddress(t.sheet,t.col+o,t.row+i);this.operations.restoreCell(s,n[i][o])}}},{key:"redoSetCellContents",value:function(e){var t,n=_createForOfIteratorHelper$i(e.cellContents);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.operations.setCellContent(r.address,r.newContent)}}catch(e){n.e(e)}finally{n.f()}}},{key:"redoAddRows",value:function(e){this.operations.addRows(e.command)}},{key:"redoAddColumns",value:function(e){this.operations.addColumns(e.command)}},{key:"redoRemoveSheet",value:function(e){this.operations.removeSheetByName(e.sheetName)}},{key:"redoAddSheet",value:function(e){this.operations.addSheet(e.sheetName)}},{key:"redoRenameSheet",value:function(e){this.operations.renameSheet(e.sheetId,e.newName)}},{key:"redoMoveRows",value:function(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}},{key:"redoMoveColumns",value:function(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}},{key:"redoClearSheet",value:function(e){this.operations.clearSheet(e.sheetId)}},{key:"redoSetSheetContent",value:function(e){var t=e.sheetId,n=e.newSheetContent;this.operations.setSheetContent(t,n)}},{key:"redoAddNamedExpression",value:function(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}},{key:"redoRemoveNamedExpression",value:function(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}},{key:"redoChangeNamedExpression",value:function(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}},{key:"redoSetRowOrder",value:function(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}},{key:"redoSetColumnOrder",value:function(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}},{key:"addUndoEntry",value:function(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}},{key:"undoEntry",value:function(e){e.doUndo(this)}},{key:"restoreOperationOldContent",value:function(e){var t,n=_createForOfIteratorHelper$i(e);try{for(n.s();!(t=n.n()).done;){var r=_slicedToArray$c(t.value,2),a=r[0],i=r[1];this.operations.restoreCell(a,i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"redoEntry",value:function(e){e.doRedo(this)}},{key:"restoreOldDataFromVersion",value:function(e){var t,n=_createForOfIteratorHelper$i(this.oldData.get(e)||[]);try{for(n.s();!(t=n.n()).done;){var r=_slicedToArray$c(t.value,2),a=r[0],i=r[1];this.operations.setFormulaToCellFromCache(i,a)}}catch(e){n.e(e)}finally{n.f()}}}]),e}();function _slicedToArray$b(e,t){return _arrayWithHoles$b(e)||_iterableToArrayLimit$b(e,t)||_unsupportedIterableToArray$n(e,t)||_nonIterableRest$b()}function _nonIterableRest$b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$b(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$b(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$n(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$n(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$n(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$n(e,t):void 0}}function _arrayLikeToArray$n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$_(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$_(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$_(e,t,n){return t&&_defineProperties$_(e.prototype,t),n&&_defineProperties$_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var CrudOperations=function(){function e(t,n,r,a,i,o,s,l,u,c){_classCallCheck$_(this,e),this.operations=n,this.undoRedo=r,this.clipboardOperations=a,this.dependencyGraph=i,this.columnSearch=o,this.parser=s,this.cellContentParser=l,this.lazilyTransformingAstService=u,this.namedExpressions=c,this.maxRows=t.maxRows,this.maxColumns=t.maxColumns}return _createClass$_(e,[{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}},{key:"addRows",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=new AddRowsCommand(e,n);this.ensureItIsPossibleToAddRows.apply(this,[e].concat(n)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(a),this.undoRedo.saveOperation(new AddRowsUndoEntry(a))}},{key:"removeRows",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=new RemoveRowsCommand(e,n);this.ensureItIsPossibleToRemoveRows.apply(this,[e].concat(n)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var i=this.operations.removeRows(a);this.undoRedo.saveOperation(new RemoveRowsUndoEntry(a,i))}},{key:"addColumns",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=new AddColumnsCommand(e,n);this.ensureItIsPossibleToAddColumns.apply(this,[e].concat(n)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(a),this.undoRedo.saveOperation(new AddColumnsUndoEntry(a))}},{key:"removeColumns",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=new RemoveColumnsCommand(e,n);this.ensureItIsPossibleToRemoveColumns.apply(this,[e].concat(n)),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var i=this.operations.removeColumns(a);this.undoRedo.saveOperation(new RemoveColumnsUndoEntry(a,i))}},{key:"moveCells",value:function(e,t,n,r){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var a=this.operations.moveCells(e,t,n,r),i=a.version,o=a.overwrittenCellsData,s=a.addedGlobalNamedExpressions;this.undoRedo.saveOperation(new MoveCellsUndoEntry(e,t,n,r,o,s,i))}},{key:"moveRows",value:function(e,t,n,r){this.ensureItIsPossibleToMoveRows(e,t,n,r),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var a=this.operations.moveRows(e,t,n,r);this.undoRedo.saveOperation(new MoveRowsUndoEntry(e,t,n,r,a))}},{key:"moveColumns",value:function(e,t,n,r){this.ensureItIsPossibleToMoveColumns(e,t,n,r),this.undoRedo.clearRedoStack();var a=this.operations.moveColumns(e,t,n,r);this.undoRedo.saveOperation(new MoveColumnsUndoEntry(e,t,n,r,a))}},{key:"cut",value:function(e,t,n){this.clipboardOperations.cut(e,t,n)}},{key:"ensureItIsPossibleToCopy",value:function(e,t,n){if(!isPositiveInteger(t))throw new InvalidArgumentsError("width to be positive integer.");if(!isPositiveInteger(n))throw new InvalidArgumentsError("height to be positive integer.")}},{key:"copy",value:function(e,t,n){this.ensureItIsPossibleToCopy(e,t,n),this.clipboardOperations.copy(e,t,n)}},{key:"paste",value:function(e){var t=this.clipboardOperations.clipboard;if(void 0===t)throw new NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);var n=AbsoluteCellRange.spanFrom(e,t.width,t.height),r=this.operations.getRangeClipboardCells(n);this.undoRedo.clearRedoStack();var a=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new PasteUndoEntry(e,r,t.content,a))}}},{key:"beginUndoRedoBatchMode",value:function(){this.undoRedo.beginBatchMode()}},{key:"commitUndoRedoBatchMode",value:function(){this.undoRedo.commitBatchMode()}},{key:"isClipboardEmpty",value:function(){return void 0===this.clipboardOperations.clipboard}},{key:"clearClipboard",value:function(){this.clipboardOperations.clear()}},{key:"addSheet",value:function(e){void 0!==e&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();var t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new AddSheetUndoEntry(t)),t}},{key:"removeSheet",value:function(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var t=this.sheetMapping.fetchDisplayName(e),n=this.operations.getSheetClipboardCells(e),r=this.operations.removeSheet(e),a=r.version,i=r.scopedNamedExpressions;this.undoRedo.saveOperation(new RemoveSheetUndoEntry(t,e,n,i,a))}},{key:"renameSheet",value:function(e,t){this.ensureItIsPossibleToRenameSheet(e,t);var n=this.operations.renameSheet(e,t);return void 0!==n&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new RenameSheetUndoEntry(e,n,t))),n}},{key:"clearSheet",value:function(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new ClearSheetUndoEntry(e,t))}},{key:"setCellContents",value:function(e,t){if(t instanceof Array){for(var n=0;n<t.length;n++)if(!(t[n]instanceof Array))throw new InvalidArgumentsError("an array of arrays or a raw cell value.")}else t=[[t]];this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();for(var r=[],a=0;a<t.length;a++)for(var i=0;i<t[a].length;i++){var o={sheet:e.sheet,row:e.row+a,col:e.col+i},s=t[a][i];this.clipboardOperations.abortCut();var l=this.operations.setCellContent(o,s);r.push({address:o,newContent:s,oldContent:l})}this.undoRedo.saveOperation(new SetCellContentsUndoEntry(r))}},{key:"setSheetContent",value:function(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),validateAsSheet(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var n=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new SetSheetContentUndoEntry(e,n,t))}},{key:"setRowOrder",value:function(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var n=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new SetRowOrderUndoEntry(e,t,n))}},{key:"validateSwapRowIndexes",value:function(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"row")}},{key:"testColumnOrderForArrays",value:function(e,t){var n,r=_createForOfIteratorHelper$h(t);try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray$b(n.value,2),i=a[0];if(i!==a[1]){var o=AbsoluteCellRange.spanFrom({sheet:e,col:i,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new SourceLocationHasArrayError}}}catch(e){r.e(e)}finally{r.f()}}},{key:"setColumnOrder",value:function(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();var n=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new SetColumnOrderUndoEntry(e,t,n))}},{key:"validateSwapColumnIndexes",value:function(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"column")}},{key:"testRowOrderForArrays",value:function(e,t){var n,r=_createForOfIteratorHelper$h(t);try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray$b(n.value,2),i=a[0];if(i!==a[1]){var o=AbsoluteCellRange.spanFrom({sheet:e,col:0,row:i},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new SourceLocationHasArrayError}}}catch(e){r.e(e)}finally{r.f()}}},{key:"mappingFromOrder",value:function(e,t,n){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);var r="row"===n?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==r)throw new InvalidArgumentsError("number of ".concat(n,"s provided to be sheet ").concat("row"===n?"height":"width","."));for(var a=[],i=0;i<r;i++)t[i]!==i&&a.push([i,t[i]]);return a}},{key:"undo",value:function(){if(this.undoRedo.isUndoStackEmpty())throw new NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}},{key:"redo",value:function(){if(this.undoRedo.isRedoStackEmpty())throw new NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}},{key:"addNamedExpression",value:function(e,t,n,r){this.ensureItIsPossibleToAddNamedExpression(e,t,n),this.operations.addNamedExpression(e,t,n,r),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new AddNamedExpressionUndoEntry(e,t,n,r))}},{key:"changeNamedExpressionExpression",value:function(e,t,n,r){this.ensureItIsPossibleToChangeNamedExpression(e,n,t);var a=_slicedToArray$b(this.operations.changeNamedExpressionExpression(e,n,t,r),2),i=a[0],o=a[1];this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new ChangeNamedExpressionUndoEntry(i,n,o,t,r))}},{key:"removeNamedExpression",value:function(e,t){this.ensureScopeIdIsValid(t);var n=_slicedToArray$b(this.operations.removeNamedExpression(e,t),2),r=n[0],a=n[1];return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new RemoveNamedExpressionUndoEntry(r,a,t)),r}},{key:"ensureItIsPossibleToAddNamedExpression",value:function(e,t,n){this.ensureScopeIdIsValid(n),this.ensureNamedExpressionNameIsValid(e,n),this.ensureNamedExpressionIsValid(t)}},{key:"ensureItIsPossibleToChangeNamedExpression",value:function(e,t,n){if(this.ensureScopeIdIsValid(n),void 0===this.namedExpressions.namedExpressionForScope(e,n))throw new NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(t)}},{key:"isItPossibleToRemoveNamedExpression",value:function(e,t){if(this.ensureScopeIdIsValid(t),void 0===this.namedExpressions.namedExpressionForScope(e,t))throw new NamedExpressionDoesNotExistError(e)}},{key:"ensureItIsPossibleToAddRows",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);for(var t=this.dependencyGraph.getSheetHeight(e),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var i=r.map((function(e){return e[1]})).reduce((function(e,t){return e+t}),0);if(t+i>this.maxRows)throw new SheetSizeLimitExceededError;for(var o=0,s=r;o<s.length;o++){var l=_slicedToArray$b(s[o],2),u=l[0],c=l[1];if(!isNonnegativeInteger(u)||!isPositiveInteger(c))throw new InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.")}}},{key:"ensureItIsPossibleToRemoveRows",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=_slicedToArray$b(i[a],2),s=o[0],l=o[1],u=s+l-1;if(!isNonnegativeInteger(s)||!isNonnegativeInteger(u))throw new InvalidArgumentsError("starting and ending row to be nonnegative.");if(u<s)throw new InvalidArgumentsError("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}}},{key:"ensureItIsPossibleToAddColumns",value:function(e){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);for(var t=this.dependencyGraph.getSheetWidth(e),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var i=r.map((function(e){return e[1]})).reduce((function(e,t){return e+t}),0);if(t+i>this.maxColumns)throw new SheetSizeLimitExceededError;for(var o=0,s=r;o<s.length;o++){var l=_slicedToArray$b(s[o],2),u=l[0],c=l[1];if(!isNonnegativeInteger(u)||!isPositiveInteger(c))throw new InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.")}}},{key:"ensureItIsPossibleToRemoveColumns",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=_slicedToArray$b(i[a],2),s=o[0],l=o[1],u=s+l-1;if(!isNonnegativeInteger(s)||!isNonnegativeInteger(u))throw new InvalidArgumentsError("starting and ending column to be nonnegative.");if(u<s)throw new InvalidArgumentsError("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}}},{key:"ensureItIsPossibleToMoveRows",value:function(e,t,n,r){this.ensureItIsPossibleToAddRows(e,[r,n]);var a=simpleCellAddress(e,0,t),i=simpleCellAddress(e,0,r);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(a)||invalidSimpleCellAddress(i)||!isPositiveInteger(n)||r<=t+n&&r>=t)throw new InvalidArgumentsError("a valid range of rows to move.");var o=this.dependencyGraph.getSheetWidth(e),s=AbsoluteCellRange.spanFrom(a,o,n);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(s))throw new SourceLocationHasArrayError;if(r>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(RowsSpan.fromNumberOfRows(e,r-1,2)))throw new TargetLocationHasArrayError}},{key:"ensureItIsPossibleToMoveColumns",value:function(e,t,n,r){this.ensureItIsPossibleToAddColumns(e,[r,n]);var a=simpleCellAddress(e,t,0),i=simpleCellAddress(e,r,0);if(!this.sheetMapping.hasSheetWithId(e)||invalidSimpleCellAddress(a)||invalidSimpleCellAddress(i)||!isPositiveInteger(n)||r<=t+n&&r>=t)throw new InvalidArgumentsError("a valid range of columns to move.");var o=this.dependencyGraph.getSheetHeight(e),s=AbsoluteCellRange.spanFrom(a,n,o);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(s))throw new SourceLocationHasArrayError;if(r>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(ColumnsSpan.fromNumberOfColumns(e,r-1,2)))throw new TargetLocationHasArrayError}},{key:"ensureItIsPossibleToAddSheet",value:function(e){if(this.sheetMapping.hasSheetWithName(e))throw new SheetNameAlreadyTakenError(e)}},{key:"ensureItIsPossibleToRenameSheet",value:function(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e);var n=this.sheetMapping.get(t);if(void 0!==n&&n!==e)throw new SheetNameAlreadyTakenError(t)}},{key:"ensureItIsPossibleToChangeContent",value:function(e){if(invalidSimpleCellAddress(e))throw new InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new NoSheetWithIdError(e.sheet)}},{key:"ensureItIsPossibleToChangeCellContents",value:function(e,t){var n=findBoundaries(t),r=AbsoluteCellRange.spanFrom(e,n.width,n.height);this.ensureRangeInSizeLimits(r);var a,i=_createForOfIteratorHelper$h(r.addresses(this.dependencyGraph));try{for(i.s();!(a=i.n()).done;){var o=a.value;this.ensureItIsPossibleToChangeContent(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"ensureItIsPossibleToChangeSheetContents",value:function(e,t){var n=findBoundaries(t),r=AbsoluteCellRange.spanFrom(simpleCellAddress(e,0,0),n.width,n.height);this.ensureRangeInSizeLimits(r)}},{key:"ensureRangeInSizeLimits",value:function(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new SheetSizeLimitExceededError}},{key:"isThereSomethingToUndo",value:function(){return!this.undoRedo.isUndoStackEmpty()}},{key:"isThereSomethingToRedo",value:function(){return!this.undoRedo.isRedoStackEmpty()}},{key:"getAndClearContentChanges",value:function(){return this.operations.getAndClearContentChanges()}},{key:"ensureScopeIdIsValid",value:function(e){if(void 0!==e&&!this.sheetMapping.hasSheetWithId(e))throw new NoSheetWithIdError(e)}},{key:"validateRowOrColumnMapping",value:function(e,t,n){for(var r="row"===n?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),a=t.map((function(e){var t=_slicedToArray$b(e,2),n=t[0];return t[1],n})).sort((function(e,t){return e-t})),i=t.map((function(e){var t=_slicedToArray$b(e,2);return t[0],t[1]})).sort((function(e,t){return e-t})),o=0;o<a.length;o++){if(!isNonnegativeInteger(a[o])||a[o]>=r)throw new InvalidArgumentsError("".concat(n," numbers to be nonnegative integers and less than sheet ").concat("row"===n?"height":"width","."));if(a[o]===a[o+1])throw new InvalidArgumentsError("source ".concat(n," numbers to be unique."));if(a[o]!==i[o])throw new InvalidArgumentsError("target ".concat(n," numbers to be permutation of source ").concat(n," numbers."))}}},{key:"ensureNamedExpressionNameIsValid",value:function(e,t){if(!this.namedExpressions.isNameValid(e))throw new NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new NamedExpressionNameIsAlreadyTakenError(e)}},{key:"ensureNamedExpressionIsValid",value:function(e){var t=this.cellContentParser.parse(e);if(t instanceof CellContent.Formula){var n=this.parser.parse(t.formula,simpleCellAddress(-1,0,0));if(doesContainRelativeReferences(n.ast))throw new NoRelativeAddressesAllowedError}}}]),e}();function isPositiveInteger(e){return Number.isInteger(e)&&e>0}function isNonnegativeInteger(e){return Number.isInteger(e)&&e>=0}function _createForOfIteratorHelper$g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$m(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$m(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$m(e,t):void 0}}function _arrayLikeToArray$m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$Z(e,t,n){return t&&_defineProperties$Z(e.prototype,t),n&&_defineProperties$Z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Evaluator=function(){function e(t,n,r,a,i,o){_classCallCheck$Z(this,e),this.config=t,this.stats=n,this.interpreter=r,this.lazilyTransformingAstService=a,this.dependencyGraph=i,this.columnSearch=o}return _createClass$Z(e,[{key:"run",value:function(){var e=this;this.stats.start(StatType.TOP_SORT);var t=this.dependencyGraph.topSortWithScc(),n=t.sorted,r=t.cycled;this.stats.end(StatType.TOP_SORT),this.stats.measure(StatType.EVALUATION,(function(){e.recomputeFormulas(r,n)}))}},{key:"partialRun",value:function(e){var t=this,n=ContentChanges.empty();return this.stats.measure(StatType.EVALUATION,(function(){t.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,(function(e){if(e instanceof FormulaVertex){var r=e.isComputed()?e.getCellValue():void 0,a=t.recomputeFormulaVertexValue(e);if(a!==r){var i=e.getAddress(t.lazilyTransformingAstService);return n.addChange(a,i),t.columnSearch.change(getRawValue(r),getRawValue(a),i),!0}return!1}return!(e instanceof RangeVertex)||(e.clearCache(),!0)}),(function(e){if(e instanceof RangeVertex)e.clearCache();else if(e instanceof FormulaVertex){var r=e.getAddress(t.lazilyTransformingAstService);t.columnSearch.remove(getRawValue(e.valueOrUndef()),r);var a=new CellError(ErrorType.CYCLE,void 0,e);e.setCellValue(a),n.addChange(a,r)}}))})),n}},{key:"runAndForget",value:function(e,t,n){var r,a=this,i=[],o=_createForOfIteratorHelper$g(absolutizeDependencies(n,t));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s instanceof AbsoluteCellRange){var l=s;if(void 0===this.dependencyGraph.getRange(l.start,l.end)){var u=new RangeVertex(l);this.dependencyGraph.rangeMapping.setRange(u),i.push(u)}}}}catch(e){o.e(e)}finally{o.f()}var c=this.evaluateAstToCellValue(e,new InterpreterState(t,this.config.useArrayArithmetic));return i.forEach((function(e){a.dependencyGraph.rangeMapping.removeRange(e)})),c}},{key:"recomputeFormulas",value:function(e,t){var n=this;e.forEach((function(e){e instanceof FormulaVertex&&e.setCellValue(new CellError(ErrorType.CYCLE,void 0,e))})),t.forEach((function(e){if(e instanceof FormulaVertex){var t=n.recomputeFormulaVertexValue(e),r=e.getAddress(n.lazilyTransformingAstService);n.columnSearch.add(getRawValue(t),r)}else e instanceof RangeVertex&&e.clearCache()}))}},{key:"recomputeFormulaVertexValue",value:function(e){var t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof ArrayVertex&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();var n=e.getFormula(this.lazilyTransformingAstService),r=this.evaluateAstToCellValue(n,new InterpreterState(t,this.config.useArrayArithmetic,e));return e.setCellValue(r)}},{key:"evaluateAstToCellValue",value:function(e,t){var n=this.interpreter.evaluateAst(e,t);return n instanceof SimpleRangeValue?n:n===EmptyValue&&this.config.evaluateNullToZero?0:n}}]),e}(),log$4=Math.log,LOG10E=Math.LOG10E,mathLog10=Math.log10||function(e){return log$4(e)*LOG10E},$$f=_export,log10=mathLog10;function _slicedToArray$a(e,t){return _arrayWithHoles$a(e)||_iterableToArrayLimit$a(e,t)||_unsupportedIterableToArray$l(e,t)||_nonIterableRest$a()}function _nonIterableRest$a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$a(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$a(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$l(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$l(e,t):void 0}}function _arrayLikeToArray$l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$Y(e,t,n){return t&&_defineProperties$Y(e.prototype,t),n&&_defineProperties$Y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}$$f({target:"Math",stat:!0},{log10:log10});var ExportedCellChange=function(){function e(t,n){_classCallCheck$Y(this,e),this.address=t,this.newValue=n}return _createClass$Y(e,[{key:"col",get:function(){return this.address.col}},{key:"row",get:function(){return this.address.row}},{key:"sheet",get:function(){return this.address.sheet}},{key:"value",get:function(){return this.newValue}}]),e}(),ExportedNamedExpressionChange=_createClass$Y((function e(t,n){_classCallCheck$Y(this,e),this.name=t,this.newValue=n})),Exporter=function(){function e(t,n,r,a){_classCallCheck$Y(this,e),this.config=t,this.namedExpressions=n,this.sheetIndexMapping=r,this.lazilyTransformingService=a}return _createClass$Y(e,[{key:"exportChange",value:function(e){var t=e.value,n=e.address;if(n.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS){var r=this.namedExpressions.namedExpressionInAddress(n.row);if(!r)throw new Error("Missing named expression");return new ExportedNamedExpressionChange(r.displayName,this.exportScalarOrRange(t))}if(t instanceof SimpleRangeValue){var a,i=[],o=_createForOfIteratorHelper$f(t.entriesFromTopLeftCorner(n));try{for(o.s();!(a=o.n()).done;){var s=_slicedToArray$a(a.value,2),l=s[0],u=s[1];i.push(new ExportedCellChange(u,this.exportValue(l)))}}catch(e){o.e(e)}finally{o.f()}return i}return new ExportedCellChange(n,this.exportValue(t))}},{key:"exportValue",value:function(e){return e instanceof SimpleRangeValue?this.detailedError(new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)):this.config.smartRounding&&isExtendedNumber(e)?this.cellValueRounding(getRawValue(e)):e instanceof CellError?this.detailedError(e):e===EmptyValue?null:getRawValue(e)}},{key:"exportScalarOrRange",value:function(e){var t=this;return e instanceof SimpleRangeValue?e.rawData().map((function(e){return e.map((function(e){return t.exportValue(e)}))})):this.exportValue(e)}},{key:"detailedError",value:function(e){var t,n,r=void 0,a=null===(t=e.root)||void 0===t?void 0:t.getAddress(this.lazilyTransformingService);return void 0!==a&&(r=a.sheet===NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS?null===(n=this.namedExpressions.namedExpressionInAddress(a.row))||void 0===n?void 0:n.displayName:simpleCellAddressToString(this.sheetIndexMapping,a,-1)),new DetailedCellError(e,this.config.translationPackage.getErrorTranslation(e.type),r)}},{key:"cellValueRounding",value:function(e){if(0===e)return e;var t=Math.floor(Math.log10(Math.abs(e))),n=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*n)/n:Math.round(e*n)/n}}]),e}();function _classCallCheck$X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$X(e,t,n){return t&&_defineProperties$X(e.prototype,t),n&&_defineProperties$X(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var GraphBuilder=function(){function e(t,n,r,a,i,o){_classCallCheck$X(this,e),this.dependencyGraph=t,this.columnSearch=n,this.parser=r,this.cellContentParser=a,this.stats=i,this.arraySizePredictor=o,this.buildStrategy=new SimpleStrategy(t,n,r,i,a,o)}return _createClass$X(e,[{key:"buildGraph",value:function(e,t){var n=this,r=t.measure(StatType.COLLECT_DEPENDENCIES,(function(){return n.buildStrategy.run(e)}));this.dependencyGraph.getAndClearContentChanges(),t.measure(StatType.PROCESS_DEPENDENCIES,(function(){return n.processDependencies(r)}))}},{key:"processDependencies",value:function(e){var t=this;e.forEach((function(e,n){t.dependencyGraph.processCellDependencies(e,n)}))}}]),e}(),SimpleStrategy=function(){function e(t,n,r,a,i,o){_classCallCheck$X(this,e),this.dependencyGraph=t,this.columnIndex=n,this.parser=r,this.stats=a,this.cellContentParser=i,this.arraySizePredictor=o}return _createClass$X(e,[{key:"run",value:function(e){var t=this,n=new Map;for(var r in e)for(var a=this.dependencyGraph.getSheetId(r),i=e[r],o=0;o<i.length;++o)for(var s=i[o],l=function(e){var r=s[e],i=simpleCellAddress(a,e,o),l=t.cellContentParser.parse(r);if(l instanceof CellContent.Formula){var u=t.stats.measure(StatType.PARSER,(function(){return t.parser.parse(l.formula,i)}));if(u.errors.length>0){t.shrinkArrayIfNeeded(i);var c=new ParsingErrorVertex(u.errors,l.formula);t.dependencyGraph.addVertex(i,c)}else{t.shrinkArrayIfNeeded(i);var p=t.arraySizePredictor.checkArraySize(u.ast,i);if(p.isScalar()){var d=new FormulaCellVertex(u.ast,i,0);n.set(d,absolutizeDependencies(u.dependencies,i)),t.dependencyGraph.addVertex(i,d),u.hasVolatileFunction&&t.dependencyGraph.markAsVolatile(d),u.hasStructuralChangeFunction&&t.dependencyGraph.markAsDependentOnStructureChange(d)}else{var m=new ArrayVertex(u.ast,i,new ArraySize(p.width,p.height));n.set(m,absolutizeDependencies(u.dependencies,i)),t.dependencyGraph.addArrayVertex(i,m)}}}else if(l instanceof CellContent.Empty);else{t.shrinkArrayIfNeeded(i);var f=new ValueCellVertex(l.value,r);t.columnIndex.add(getRawValue(l.value),i),t.dependencyGraph.addVertex(i,f)}},u=0;u<s.length;++u)l(u);return n}},{key:"shrinkArrayIfNeeded",value:function(e){var t=this.dependencyGraph.getCell(e);t instanceof ArrayVertex&&this.dependencyGraph.shrinkArrayToCorner(t)}}]),e}(),$$e=_export,$find=arrayIteration.find,addToUnscopables$1=addToUnscopables$5,FIND="find",SKIPS_HOLES$1=!0;function _typeof$K(e){return _typeof$K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$K(e)}function _classCallCheck$W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$W(e,t,n){return t&&_defineProperties$W(e.prototype,t),n&&_defineProperties$W(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$J(e,t)}function _setPrototypeOf$J(e,t){return _setPrototypeOf$J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$J(e,t)}function _createSuper$J(e){var t=_isNativeReflectConstruct$J();return function(){var n,r=_getPrototypeOf$J(e);if(t){var a=_getPrototypeOf$J(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$J(this,n)}}function _possibleConstructorReturn$J(e,t){if(t&&("object"===_typeof$K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$J(e)}function _assertThisInitialized$J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$J(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$J(e){return _getPrototypeOf$J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$J(e)}FIND in[]&&Array(1)[FIND]((function(){SKIPS_HOLES$1=!1})),$$e({target:"Array",proto:!0,forced:SKIPS_HOLES$1},{find:function(e){return $find(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$1(FIND);var LICENSE_STATUS_MAP=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]),VersionPlugin=function(e){_inherits$J(n,e);var t=_createSuper$J(n);function n(){return _classCallCheck$W(this,n),t.apply(this,arguments)}return _createClass$W(n,[{key:"version",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("VERSION"),(function(){var e,t=n.config,r=t.licenseKeyValidityState,a=t.licenseKey;return LICENSE_STATUS_MAP.has(a)?e=LICENSE_STATUS_MAP.get(a):LICENSE_STATUS_MAP.has(r)?e=LICENSE_STATUS_MAP.get(r):"valid"===r&&(e=a.slice(-5)),"HyperFormula v".concat(HyperFormula.version,", ").concat(e)}))}}]),n}(FunctionPlugin);function _toConsumableArray$7(e){return _arrayWithoutHoles$7(e)||_iterableToArray$7(e)||_unsupportedIterableToArray$k(e)||_nonIterableSpread$7()}function _nonIterableSpread$7(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$7(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$7(e){if(Array.isArray(e))return _arrayLikeToArray$k(e)}function _slicedToArray$9(e,t){return _arrayWithHoles$9(e)||_iterableToArrayLimit$9(e,t)||_unsupportedIterableToArray$k(e,t)||_nonIterableRest$9()}function _nonIterableRest$9(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$9(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$9(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$k(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$k(e,t):void 0}}function _arrayLikeToArray$k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$V(e,t,n){return t&&_defineProperties$V(e.prototype,t),n&&_defineProperties$V(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function validateAndReturnMetadataFromName(e,t){var n,r=t.implementedFunctions[e],a=null===(n=t.aliases)||void 0===n?void 0:n[e];if(void 0!==a){if(void 0!==r)throw new AliasAlreadyExisting(e,t.name);r=t.implementedFunctions[a]}if(void 0===r)throw FunctionPluginValidationError.functionNotDeclaredInPlugin(e,t.name);return r}VersionPlugin.implementedFunctions={VERSION:{method:"version",parameters:[]}};var FunctionRegistry=function(){function e(t){var n=this;if(_classCallCheck$V(this,e),this.config=t,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=function(e){return n.functionsWhichDoesNotNeedArgumentsToBeComputed.has(e)},this.isFunctionVolatile=function(e){return n.volatileFunctions.has(e)},this.isArrayFunction=function(e){return n.arrayFunctions.has(e)},this.isFunctionDependentOnSheetStructureChange=function(e){return n.structuralChangeFunctions.has(e)},t.functionPlugins.length>0){this.instancePlugins=new Map;var r,a=_createForOfIteratorHelper$e(t.functionPlugins);try{for(a.s();!(r=a.n()).done;){var i=r.value;e.loadPluginFunctions(i,this.instancePlugins)}}catch(e){a.e(e)}finally{a.f()}}else this.instancePlugins=new Map(e.plugins);var o,s=_createForOfIteratorHelper$e(e.protectedFunctions());try{for(s.s();!(o=s.n()).done;){var l=_slicedToArray$9(o.value,2),u=l[0],c=l[1];e.loadFunctionUnprotected(c,u,this.instancePlugins)}}catch(e){s.e(e)}finally{s.f()}var p,d=_createForOfIteratorHelper$e(this.instancePlugins.entries());try{for(d.s();!(p=d.n()).done;){var m=_slicedToArray$9(p.value,2),f=m[0],h=m[1];this.categorizeFunction(f,validateAndReturnMetadataFromName(f,h))}}catch(e){d.e(e)}finally{d.f()}}return _createClass$V(e,[{key:"initializePlugins",value:function(e){var t,n=this,r=[],a=_createForOfIteratorHelper$e(this.instancePlugins.entries());try{var i=function(){var a=_slicedToArray$9(t.value,2),i=a[0],o=a[1],s=r.find((function(e){return e instanceof o}));void 0===s&&(s=new o(e),r.push(s));var l=validateAndReturnMetadataFromName(i,o),u=l.method;n.functions.set(i,[u,s]);var c=l.arraySizeMethod;void 0!==c&&n.arraySizeFunctions.set(i,[c,s])};for(a.s();!(t=a.n()).done;)i()}catch(e){a.e(e)}finally{a.f()}}},{key:"getFunctionPlugin",value:function(t){if(!e.functionIsProtected(t))return this.instancePlugins.get(t)}},{key:"getFunction",value:function(e){var t=this.functions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){var n=_slicedToArray$9(t,2),r=n[0],a=n[1];return function(e,t){return a[r](e,t)}}}},{key:"getArraySizeFunction",value:function(e){var t=this.arraySizeFunctions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){var n=_slicedToArray$9(t,2),r=n[0],a=n[1];return function(e,t){return a[r](e,t)}}}},{key:"getMetadata",value:function(e){return this.functionsMetadata.get(e)}},{key:"getPlugins",value:function(){var t,n=new Set,r=_createForOfIteratorHelper$e(this.instancePlugins);try{for(r.s();!(t=r.n()).done;){var a=_slicedToArray$9(t.value,2),i=a[0],o=a[1];e.functionIsProtected(i)||n.add(o)}}catch(e){r.e(e)}finally{r.f()}return Array.from(n)}},{key:"getRegisteredFunctionIds",value:function(){return Array.from(this.functions.keys())}},{key:"categorizeFunction",value:function(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.arrayFunction&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}],[{key:"registerFunctionPlugin",value:function(e,t){this.loadPluginFunctions(e,this.plugins),void 0!==t&&this.loadTranslations(t)}},{key:"registerFunction",value:function(e,t,n){this.loadPluginFunction(t,e,this.plugins),void 0!==n&&this.loadTranslations(n)}},{key:"unregisterFunction",value:function(e){if(this.functionIsProtected(e))throw ProtectedFunctionError.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}},{key:"unregisterFunctionPlugin",value:function(e){var t,n=_createForOfIteratorHelper$e(this.protectedPlugins());try{for(n.s();!(t=n.n()).done;){if(t.value===e)throw ProtectedFunctionError.cannotUnregisterProtectedPlugin()}}catch(e){n.e(e)}finally{n.f()}var r,a=_createForOfIteratorHelper$e(this.plugins.entries());try{for(a.s();!(r=a.n()).done;){var i=_slicedToArray$9(r.value,2),o=i[0];i[1]===e&&this.plugins.delete(o)}}catch(e){a.e(e)}finally{a.f()}}},{key:"unregisterAll",value:function(){this.plugins.clear()}},{key:"getRegisteredFunctionIds",value:function(){return[].concat(_toConsumableArray$7(Array.from(this.plugins.keys())),_toConsumableArray$7(Array.from(this._protectedPlugins.keys())))}},{key:"getPlugins",value:function(){return Array.from(new Set(this.plugins.values()).values())}},{key:"getFunctionPlugin",value:function(e){return this.functionIsProtected(e)?void 0:this.plugins.get(e)}},{key:"functionIsProtected",value:function(e){return this._protectedPlugins.has(e)}},{key:"loadTranslations",value:function(e){var t=new Set(HyperFormula.getRegisteredLanguagesCodes());Object.keys(e).forEach((function(n){t.has(n)&&HyperFormula.getLanguage(n).extendFunctions(e[n])}))}},{key:"loadPluginFunctions",value:function(e,t){var n=this;Object.keys(e.implementedFunctions).forEach((function(r){n.loadPluginFunction(e,r,t)})),void 0!==e.aliases&&Object.keys(e.aliases).forEach((function(r){n.loadPluginFunction(e,r,t)}))}},{key:"loadPluginFunction",value:function(e,t,n){if(this.functionIsProtected(t))throw ProtectedFunctionError.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,n)}},{key:"loadFunctionUnprotected",value:function(e,t,n){var r=validateAndReturnMetadataFromName(t,e).method;if(!Object.prototype.hasOwnProperty.call(e.prototype,r))throw FunctionPluginValidationError.functionMethodNotFound(r,e.name);n.set(t,e)}},{key:"protectedFunctions",value:regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$e(this._protectedPlugins),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=10;break}if(r=_slicedToArray$9(n.value,2),a=r[0],void 0===(i=r[1])){e.next=8;break}return e.next=8,[a,i];case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))},{key:"protectedPlugins",value:regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper$e(this._protectedPlugins),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=10;break}if(r=_slicedToArray$9(n.value,2),void 0===(a=r[1])){e.next=8;break}return e.next=8,a;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))}]),e}(),CriterionType;function _classCallCheck$U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$U(e,t,n){return t&&_defineProperties$U(e.prototype,t),n&&_defineProperties$U(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}FunctionRegistry.plugins=new Map,FunctionRegistry._protectedPlugins=new Map([["VERSION",VersionPlugin],["OFFSET",void 0]]),function(e){e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",e.NOT_EQUAL="NOT_EQUAL",e.EQUAL="EQUAL"}(CriterionType||(CriterionType={}));var buildCriterion=function(e,t){return{operator:e,value:t}},CriterionBuilder=function(){function e(t){var n,r,a,i;_classCallCheck$U(this,e),this.trueString=null!==(r=null===(n=t.translationPackage.getMaybeFunctionTranslation("TRUE"))||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:"true",this.falseString=null!==(i=null===(a=t.translationPackage.getMaybeFunctionTranslation("FALSE"))||void 0===a?void 0:a.toLowerCase())&&void 0!==i?i:"false"}return _createClass$U(e,[{key:"fromCellValue",value:function(e,t){if("string"==typeof e||"boolean"==typeof e||"number"==typeof e){var n=this.parseCriterion(e,t);if(void 0!==n)return{raw:e,lambda:buildCriterionLambda(n,t)}}}},{key:"parseCriterion",value:function(e,t){if("number"==typeof e||"boolean"==typeof e)return buildCriterion(CriterionType.EQUAL,e);if("string"==typeof e){var n,r,a=ANY_CRITERION_REGEX.exec(e);a?(r=StrToCriterionType(a[1]),n=a[2]):(r=CriterionType.EQUAL,n=e);var i=t.coerceToMaybeNumber(n),o=n.toLowerCase()===this.trueString||n.toLowerCase()!==this.falseString&&void 0;if(void 0===r)return;if(""===n)return buildCriterion(r,null);if(void 0!==i)return buildCriterion(r,getRawValue(i));if(r===CriterionType.EQUAL||r===CriterionType.NOT_EQUAL)return buildCriterion(r,null!=o?o:n)}}}]),e}(),ANY_CRITERION_REGEX=/([<>=]+)(.*)/;function StrToCriterionType(e){switch(e){case">":return CriterionType.GREATER_THAN;case">=":return CriterionType.GREATER_THAN_OR_EQUAL;case"<":return CriterionType.LESS_THAN;case"<=":return CriterionType.LESS_THAN_OR_EQUAL;case"<>":return CriterionType.NOT_EQUAL;case"=":return CriterionType.EQUAL;default:return}}var buildCriterionLambda=function(e,t){switch(e.operator){case CriterionType.GREATER_THAN:return"number"==typeof e.value?function(n){return"number"==typeof n&&t.floatCmp(n,e.value)>0}:function(e){return!1};case CriterionType.GREATER_THAN_OR_EQUAL:return"number"==typeof e.value?function(n){return"number"==typeof n&&t.floatCmp(n,e.value)>=0}:function(e){return!1};case CriterionType.LESS_THAN:return"number"==typeof e.value?function(n){return"number"==typeof n&&t.floatCmp(n,e.value)<0}:function(e){return!1};case CriterionType.LESS_THAN_OR_EQUAL:return"number"==typeof e.value?function(n){return"number"==typeof n&&t.floatCmp(n,e.value)<=0}:function(e){return!1};case CriterionType.EQUAL:return"number"==typeof e.value?function(n){if("number"==typeof n)return 0===t.floatCmp(n,e.value);if("string"==typeof n){if(""===n)return!1;var r=t.coerceToMaybeNumber(n);return void 0!==r&&0===t.floatCmp(r,e.value)}return!1}:"string"==typeof e.value?t.eqMatcherFunction(e.value):"boolean"==typeof e.value?function(t){return"boolean"==typeof t&&t===e.value}:function(e){return e===EmptyValue};case CriterionType.NOT_EQUAL:return"number"==typeof e.value?function(n){if("number"==typeof n)return 0!==t.floatCmp(n,e.value);if("string"==typeof n){if(""===n)return!0;var r=t.coerceToMaybeNumber(n);return void 0===r||0!==t.floatCmp(r,e.value)}return!0}:"string"==typeof e.value?t.neqMatcherFunction(e.value):"boolean"==typeof e.value?function(t){return"boolean"!=typeof t||t!==e.value}:function(e){return e!==EmptyValue}}};function _toConsumableArray$6(e){return _arrayWithoutHoles$6(e)||_iterableToArray$6(e)||_unsupportedIterableToArray$j(e)||_nonIterableSpread$6()}function _nonIterableSpread$6(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$6(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$6(e){if(Array.isArray(e))return _arrayLikeToArray$j(e)}function _createForOfIteratorHelper$d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$j(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray$8(e,t){return _arrayWithHoles$8(e)||_iterableToArrayLimit$8(e,t)||_unsupportedIterableToArray$j(e,t)||_nonIterableRest$8()}function _nonIterableRest$8(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$j(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$j(e,t):void 0}}function _arrayLikeToArray$j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$8(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$8(e){if(Array.isArray(e))return e}function _classCallCheck$T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$T(e,t,n){return t&&_defineProperties$T(e.prototype,t),n&&_defineProperties$T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Interpreter=function(){function e(t,n,r,a,i,o,s,l,u,c){var p=this;_classCallCheck$T(this,e),this.config=t,this.dependencyGraph=n,this.columnSearch=r,this.stats=a,this.arithmeticHelper=i,this.functionRegistry=o,this.namedExpressions=s,this.serialization=l,this.arraySizePredictor=u,this.dateTimeHelper=c,this.equalOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.eq,e,t)},this.notEqualOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.neq,e,t)},this.greaterThanOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.gt,e,t)},this.lessThanOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.lt,e,t)},this.greaterThanOrEqualOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.geq,e,t)},this.lessThanOrEqualOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.leq,e,t)},this.concatOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.concat,coerceScalarToString(e),coerceScalarToString(t))},this.plusOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.addWithEpsilon,p.arithmeticHelper.coerceScalarToNumberOrError(e),p.arithmeticHelper.coerceScalarToNumberOrError(t))},this.minusOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.subtract,p.arithmeticHelper.coerceScalarToNumberOrError(e),p.arithmeticHelper.coerceScalarToNumberOrError(t))},this.timesOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.multiply,p.arithmeticHelper.coerceScalarToNumberOrError(e),p.arithmeticHelper.coerceScalarToNumberOrError(t))},this.powerOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.pow,p.arithmeticHelper.coerceScalarToNumberOrError(e),p.arithmeticHelper.coerceScalarToNumberOrError(t))},this.divOp=function(e,t){return binaryErrorWrapper(p.arithmeticHelper.divide,p.arithmeticHelper.coerceScalarToNumberOrError(e),p.arithmeticHelper.coerceScalarToNumberOrError(t))},this.unaryMinusOp=function(e){return unaryErrorWrapper(p.arithmeticHelper.unaryMinus,p.arithmeticHelper.coerceScalarToNumberOrError(e))},this.percentOp=function(e){return unaryErrorWrapper(p.arithmeticHelper.unaryPercent,p.arithmeticHelper.coerceScalarToNumberOrError(e))},this.unaryPlusOp=function(e){return p.arithmeticHelper.unaryPlus(e)},this.functionRegistry.initializePlugins(this),this.criterionBuilder=new CriterionBuilder(t)}return _createClass$T(e,[{key:"evaluateAst",value:function(e,t){var n=this.evaluateAstWithoutPostprocessing(e,t);if(isExtendedNumber(n)){if(isNumberOverflow(getRawValue(n)))return new CellError(ErrorType.NUM,ErrorMessage.NaN);n=cloneNumber(n,fixNegativeZero(getRawValue(n)))}if(n instanceof SimpleRangeValue&&1===n.height()&&1===n.width()){var r=_slicedToArray$8(n.data,1);n=_slicedToArray$8(r[0],1)[0]}return wrapperForRootVertex(n,t.formulaVertex)}},{key:"evaluateAstWithoutPostprocessing",value:function(e,t){switch(e.type){case AstNodeType.EMPTY:return EmptyValue;case AstNodeType.CELL_REFERENCE:var n=e.reference.toSimpleCellAddress(t.formulaAddress);return invalidSimpleCellAddress(n)?new CellError(ErrorType.REF,ErrorMessage.BadRef):this.dependencyGraph.getCellValue(n);case AstNodeType.NUMBER:case AstNodeType.STRING:return e.value;case AstNodeType.CONCATENATE_OP:var r=this.evaluateAst(e.left,t),a=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,a,t);case AstNodeType.EQUALS_OP:var i=this.evaluateAst(e.left,t),o=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,i,o,t);case AstNodeType.NOT_EQUAL_OP:var s=this.evaluateAst(e.left,t),l=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,s,l,t);case AstNodeType.GREATER_THAN_OP:var u=this.evaluateAst(e.left,t),c=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,u,c,t);case AstNodeType.LESS_THAN_OP:var p=this.evaluateAst(e.left,t),d=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,p,d,t);case AstNodeType.GREATER_THAN_OR_EQUAL_OP:var m=this.evaluateAst(e.left,t),f=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,m,f,t);case AstNodeType.LESS_THAN_OR_EQUAL_OP:var h=this.evaluateAst(e.left,t),y=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,h,y,t);case AstNodeType.PLUS_OP:var b=this.evaluateAst(e.left,t),g=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,b,g,t);case AstNodeType.MINUS_OP:var v=this.evaluateAst(e.left,t),T=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,v,T,t);case AstNodeType.TIMES_OP:var C=this.evaluateAst(e.left,t),N=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,C,N,t);case AstNodeType.POWER_OP:var A=this.evaluateAst(e.left,t),S=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,A,S,t);case AstNodeType.DIV_OP:var w=this.evaluateAst(e.left,t),x=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,w,x,t);case AstNodeType.PLUS_UNARY_OP:var V=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,V,t);case AstNodeType.MINUS_UNARY_OP:var E=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,E,t);case AstNodeType.PERCENT_OP:var $=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,$,t);case AstNodeType.FUNCTION_CALL:if("valid"!==this.config.licenseKeyValidityState&&!FunctionRegistry.functionIsProtected(e.procedureName))return new CellError(ErrorType.LIC,ErrorMessage.LicenseKey(this.config.licenseKeyValidityState));var _=this.functionRegistry.getFunction(e.procedureName);return void 0!==_?_(e,new InterpreterState(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new CellError(ErrorType.NAME,ErrorMessage.FunctionName(e.procedureName));case AstNodeType.NAMED_EXPRESSION:var O=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return O?this.dependencyGraph.getCellValue(O.address):new CellError(ErrorType.NAME,ErrorMessage.NamedExpressionName(e.expressionName));case AstNodeType.CELL_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);var I=AbsoluteCellRange.fromCellRange(e,t.formulaAddress),D=this.dependencyGraph.getArray(I);if(D){var R=D.array;if(R instanceof NotComputedArray)throw new Error("Array should be already computed");if(R instanceof CellError)return R;if(R instanceof ArrayValue)return SimpleRangeValue.fromRange(R.raw(),I,this.dependencyGraph);throw new Error("Unknown array")}return SimpleRangeValue.onlyRange(I,this.dependencyGraph);case AstNodeType.COLUMN_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);var P=AbsoluteColumnRange.fromColumnRange(e,t.formulaAddress);return SimpleRangeValue.onlyRange(P,this.dependencyGraph);case AstNodeType.ROW_RANGE:if(!this.rangeSpansOneSheet(e))return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);var k=AbsoluteRowRange.fromRowRangeAst(e,t.formulaAddress);return SimpleRangeValue.onlyRange(k,this.dependencyGraph);case AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,t);case AstNodeType.ARRAY:var M,F=void 0,B=[],L=_createForOfIteratorHelper$d(e.args);try{for(L.s();!(M=L.n()).done;){var j,U=M.value,z=void 0,H=[],G=_createForOfIteratorHelper$d(U);try{for(G.s();!(j=G.n()).done;){var W=j.value,q=coerceToRange(this.evaluateAst(W,t)),K=q.height();if(void 0===z)z=K,H.push.apply(H,_toConsumableArray$6(q.data));else{if(z!==K)return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch);for(var X=0;X<K;X++){var Y;(Y=H[X]).push.apply(Y,_toConsumableArray$6(q.data[X]))}}}}catch(e){G.e(e)}finally{G.f()}var Z=H[0].length;if(void 0===F)F=Z,B.push.apply(B,H);else{if(F!==Z)return new CellError(ErrorType.REF,ErrorMessage.SizeMismatch);B.push.apply(B,H)}}}catch(e){L.e(e)}finally{L.f()}return SimpleRangeValue.onlyValues(B);case AstNodeType.ERROR_WITH_RAW_INPUT:case AstNodeType.ERROR:return e.error}}},{key:"rangeSpansOneSheet",value:function(e){return e.start.sheet===e.end.sheet}},{key:"unaryRangeWrapper",value:function(e,t,n){var r;if(t instanceof SimpleRangeValue&&!n.arraysFlag&&(t=null!==(r=coerceRangeToScalar(t,n))&&void 0!==r?r:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),t instanceof CellError)return t;if(t instanceof SimpleRangeValue){var a=t.data.map((function(t){return t.map(e)}));return SimpleRangeValue.onlyValues(a)}return e(t)}},{key:"binaryRangeWrapper",value:function(e,t,n,r){var a,i;if(t instanceof SimpleRangeValue&&!r.arraysFlag&&(t=null!==(a=coerceRangeToScalar(t,r))&&void 0!==a?a:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),t instanceof CellError)return t;if(n instanceof SimpleRangeValue&&!r.arraysFlag&&(n=null!==(i=coerceRangeToScalar(n,r))&&void 0!==i?i:new CellError(ErrorType.VALUE,ErrorMessage.ScalarExpected)),n instanceof CellError)return n;if(t instanceof SimpleRangeValue||n instanceof SimpleRangeValue){if(!(t instanceof SimpleRangeValue)){if(n.isAdHoc()){for(var o=n.data,s=0;s<o.length;s++)for(var l=0;l<o[0].length;l++)o[s][l]=e(t,o[s][l]);return SimpleRangeValue.onlyValues(o)}t=SimpleRangeValue.fromScalar(t)}if(!(n instanceof SimpleRangeValue)){if(t.isAdHoc()){for(var u=t.data,c=0;c<u.length;c++)for(var p=0;p<u[0].length;p++)u[c][p]=e(u[c][p],n);return SimpleRangeValue.onlyValues(u)}n=SimpleRangeValue.fromScalar(n)}if(t.width()===n.width()&&t.height()===n.height()){if(t.isAdHoc()){for(var d=t.data,m=n.data,f=0;f<d.length;f++)for(var h=0;h<d[0].length;h++)d[f][h]=e(d[f][h],m[f][h]);return SimpleRangeValue.onlyValues(d)}if(n.isAdHoc()){for(var y=t.data,b=n.data,g=0;g<y.length;g++)for(var v=0;v<y[0].length;v++)b[g][v]=e(y[g][v],b[g][v]);return SimpleRangeValue.onlyValues(b)}}for(var T=Math.max(t.width(),n.width()),C=Math.max(t.height(),n.height()),N=Array(C),A=0;A<C;A++)N[A]=Array(T);for(var S=0;S<C;S++)for(var w=1!==t.height()?S:0,x=1!==n.height()?S:0,V=0;V<T;V++){var E=1!==t.width()?V:0,$=1!==n.width()?V:0;w<t.height()&&x<n.height()&&E<t.width()&&$<n.width()?N[S][V]=e(t.data[w][E],n.data[x][$]):N[S][V]=new CellError(ErrorType.NA)}return SimpleRangeValue.onlyValues(N)}return e(t,n)}}]),e}();function unaryErrorWrapper(e,t){return t instanceof CellError?t:e(t)}function binaryErrorWrapper(e,t,n){return t instanceof CellError?t:n instanceof CellError?n:e(t,n)}function wrapperForRootVertex(e,t){return e instanceof CellError&&void 0!==t?e.attachRootVertex(t):e}function _slicedToArray$7(e,t){return _arrayWithHoles$7(e)||_iterableToArrayLimit$7(e,t)||_unsupportedIterableToArray$i(e,t)||_nonIterableRest$7()}function _nonIterableRest$7(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$i(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$i(e,t):void 0}}function _arrayLikeToArray$i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$7(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$7(e){if(Array.isArray(e))return e}function _classCallCheck$S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$S(e,t,n){return t&&_defineProperties$S(e.prototype,t),n&&_defineProperties$S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var CombinedTransformer=function(){function e(t){_classCallCheck$S(this,e),this.sheet=t,this.transformations=[]}return _createClass$S(e,[{key:"add",value:function(e){this.transformations.push(e)}},{key:"performEagerTransformations",value:function(e,t){this.transformations.forEach((function(n){return n.performEagerTransformations(e,t)}))}},{key:"transformSingleAst",value:function(e,t){var n=e,r=t;return this.transformations.forEach((function(e){var t=_slicedToArray$7(e.transformSingleAst(n,r),2);n=t[0],r=t[1]})),[n,r]}},{key:"isIrreversible",value:function(){return!0}}]),e}();function _slicedToArray$6(e,t){return _arrayWithHoles$6(e)||_iterableToArrayLimit$6(e,t)||_unsupportedIterableToArray$h(e,t)||_nonIterableRest$6()}function _nonIterableRest$6(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$h(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$h(e,t):void 0}}function _arrayLikeToArray$h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$6(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$6(e){if(Array.isArray(e))return e}function _classCallCheck$R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$R(e,t,n){return t&&_defineProperties$R(e.prototype,t),n&&_defineProperties$R(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var LazilyTransformingAstService=function(){function e(t){_classCallCheck$R(this,e),this.stats=t,this.transformations=[]}return _createClass$R(e,[{key:"version",value:function(){return this.transformations.length}},{key:"addTransformation",value:function(e){return void 0!==this.combinedTransformer?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}},{key:"beginCombinedMode",value:function(e){this.combinedTransformer=new CombinedTransformer(e)}},{key:"commitCombinedMode",value:function(){if(void 0===this.combinedTransformer)throw"Combined mode wasn't started";return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}},{key:"applyTransformations",value:function(e,t,n){this.stats.start(StatType.TRANSFORM_ASTS_POSTPONED);for(var r=n;r<this.transformations.length;r++){var a=this.transformations[r];a.isIrreversible()&&(this.undoRedo.storeDataForVersion(r,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));var i=_slicedToArray$6(a.transformSingleAst(e,t),2);e=i[0],t=i[1]}var o=this.parser.rememberNewAst(e);return this.stats.end(StatType.TRANSFORM_ASTS_POSTPONED),[o,t,this.transformations.length]}},{key:"getTransformationsFrom",value:regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t;case 1:if(!(r<this.transformations.length)){e.next=9;break}if(a=this.transformations[r],n&&!n(a)){e.next=6;break}return e.next=6,a;case 6:r++,e.next=1;break;case 9:case"end":return e.stop()}}),e,this)}))}]),e}(),$$d=_export,$findIndex=arrayIteration.findIndex,addToUnscopables=addToUnscopables$5,FIND_INDEX="findIndex",SKIPS_HOLES=!0;function _typeof$J(e){return _typeof$J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$J(e)}function rangeLowerBound(e,t,n,r){var a;a="col"===r?e.effectiveEndColumn(n):e.effectiveEndRow(n);var i,o=e.start[r],s=lowerBound$2(i="row"===r?function(t){return getRawValue(n.getCellValue(simpleCellAddress(e.sheet,e.start.col,t)))}:function(t){return getRawValue(n.getCellValue(simpleCellAddress(e.sheet,t,e.start.row)))},t,o,a);return _typeof$J(i(s))!==_typeof$J(t)?-1:s-o}function lowerBound$2(e,t,n,r){for(;n<=r;){var a=Math.floor((n+r)/2),i=compare(t,e(a));if(i>0)n=a+1;else if(i<0)r=a-1;else{if(n==a)return a;r=a}}return r}function compare(e,t){return _typeof$J(e)===_typeof$J(t)?e===EmptyValue?0:e<t?-1:e>t?1:0:e===EmptyValue?-1:t===EmptyValue?1:t instanceof CellError||"number"==typeof e&&"string"==typeof t||"number"==typeof e&&"boolean"==typeof t?-1:"string"==typeof e&&"number"==typeof t?1:"string"==typeof e&&"boolean"==typeof t?-1:1}function _classCallCheck$Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$Q(e,t,n){return t&&_defineProperties$Q(e.prototype,t),n&&_defineProperties$Q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}FIND_INDEX in[]&&Array(1)[FIND_INDEX]((function(){SKIPS_HOLES=!1})),$$d({target:"Array",proto:!0,forced:SKIPS_HOLES},{findIndex:function(e){return $findIndex(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables(FIND_INDEX);var AdvancedFind=function(){function e(t){_classCallCheck$Q(this,e),this.dependencyGraph=t}return _createClass$Q(e,[{key:"advancedFind",value:function(e,t){var n,r=t.range;n=void 0===r?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(r);for(var a=0;a<n.length;a++)if(e(getRawValue(n[a])))return a;return-1}}]),e}();function _typeof$I(e){return _typeof$I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$I(e)}function _classCallCheck$P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$P(e,t,n){return t&&_defineProperties$P(e.prototype,t),n&&_defineProperties$P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$I(e,t)}function _setPrototypeOf$I(e,t){return _setPrototypeOf$I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$I(e,t)}function _createSuper$I(e){var t=_isNativeReflectConstruct$I();return function(){var n,r=_getPrototypeOf$I(e);if(t){var a=_getPrototypeOf$I(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$I(this,n)}}function _possibleConstructorReturn$I(e,t){if(t&&("object"===_typeof$I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$I(e)}function _assertThisInitialized$I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$I(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$I(e){return _getPrototypeOf$I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$I(e)}var ColumnBinarySearch=function(e){_inherits$I(n,e);var t=_createSuper$I(n);function n(e,r){var a;return _classCallCheck$P(this,n),(a=t.call(this,e)).dependencyGraph=e,a.config=r,a}return _createClass$P(n,[{key:"add",value:function(e,t){}},{key:"remove",value:function(e,t){}},{key:"change",value:function(e,t,n){}},{key:"applyChanges",value:function(e){}},{key:"addColumns",value:function(e){}},{key:"removeColumns",value:function(e){}},{key:"removeSheet",value:function(e){}},{key:"moveValues",value:function(e,t,n,r){}},{key:"removeValues",value:function(e){}},{key:"find",value:function(e,t,n){"string"==typeof e&&(e=forceNormalizeString(e));var r=t.range;return void 0===r?t.valuesFromTopLeftCorner().map(getRawValue).map((function(e){return"string"==typeof e?forceNormalizeString(e):e})).indexOf(e):n?rangeLowerBound(r,e,this.dependencyGraph,"row"):this.dependencyGraph.computeListOfValuesInRange(r).findIndex((function(t){return(t="string"==typeof(t=getRawValue(t))?forceNormalizeString(t):t)===e}))}}]),n}(AdvancedFind);function _toConsumableArray$5(e){return _arrayWithoutHoles$5(e)||_iterableToArray$5(e)||_unsupportedIterableToArray$g(e)||_nonIterableSpread$5()}function _nonIterableSpread$5(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$5(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$5(e){if(Array.isArray(e))return _arrayLikeToArray$g(e)}function _slicedToArray$5(e,t){return _arrayWithHoles$5(e)||_iterableToArrayLimit$5(e,t)||_unsupportedIterableToArray$g(e,t)||_nonIterableRest$5()}function _nonIterableRest$5(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$5(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$5(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$g(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$g(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$g(e,t):void 0}}function _arrayLikeToArray$g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$O(e,t,n){return t&&_defineProperties$O(e.prototype,t),n&&_defineProperties$O(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ColumnIndex=function(){function e(t,n,r){_classCallCheck$O(this,e),this.dependencyGraph=t,this.config=n,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new ColumnBinarySearch(t,n)}return _createClass$O(e,[{key:"add",value:function(e,t){if(!(e===EmptyValue||e instanceof CellError))if(e instanceof SimpleRangeValue){var n,r=_createForOfIteratorHelper$c(e.entriesFromTopLeftCorner(t));try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray$5(n.value,2),i=a[0],o=a[1];this.addSingleCellValue(getRawValue(i),o)}}catch(e){r.e(e)}finally{r.f()}}else this.addSingleCellValue(e,t)}},{key:"remove",value:function(e,t){if(void 0!==e)if(e instanceof SimpleRangeValue){var n,r=_createForOfIteratorHelper$c(e.entriesFromTopLeftCorner(t));try{for(r.s();!(n=r.n()).done;){var a=_slicedToArray$5(n.value,2),i=a[0],o=a[1];this.removeSingleValue(getRawValue(i),o)}}catch(e){r.e(e)}finally{r.f()}}else this.removeSingleValue(e,t)}},{key:"change",value:function(e,t,n){e!==t&&(this.remove(e,n),this.add(t,n))}},{key:"applyChanges",value:function(e){var t,n=_createForOfIteratorHelper$c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;void 0!==r.oldValue&&this.change(getRawValue(r.oldValue),getRawValue(r.value),r.address)}}catch(e){n.e(e)}finally{n.f()}}},{key:"moveValues",value:function(e,t,n,r){var a,i=_createForOfIteratorHelper$c(e);try{for(i.s();!(a=i.n()).done;){var o=_slicedToArray$5(a.value,2),s=o[0],l=o[1],u=movedSimpleCellAddress(l,r,t,n);this.remove(s,l),this.add(s,u)}}catch(e){i.e(e)}finally{i.f()}}},{key:"removeValues",value:function(e){var t,n=_createForOfIteratorHelper$c(e);try{for(n.s();!(t=n.n()).done;){var r=_slicedToArray$5(t.value,2),a=r[0],i=r[1];this.remove(a,i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"find",value:function(e,t,n){var r=t.range;if(void 0===r)return this.binarySearchStrategy.find(e,t,n);this.ensureRecentData(r.sheet,r.start.col,e);var a=this.getColumnMap(r.sheet,r.start.col);if(!a)return-1;"string"==typeof e&&(e=forceNormalizeString(e));var i=a.get(e);if(!i)return this.binarySearchStrategy.find(e,t,n);var o=upperBound(i.index,r.start.row),s=i.index[o];return s<=r.end.row?s-r.start.row:this.binarySearchStrategy.find(e,t,n)}},{key:"advancedFind",value:function(e,t){return this.binarySearchStrategy.advancedFind(e,t)}},{key:"addColumns",value:function(e){var t=this.index.get(e.sheet);t&&t.splice.apply(t,[e.columnStart,0].concat(_toConsumableArray$5(Array(e.numberOfColumns))))}},{key:"removeColumns",value:function(e){var t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}},{key:"removeSheet",value:function(e){this.index.delete(e)}},{key:"getColumnMap",value:function(e,t){this.index.has(e)||this.index.set(e,[]);var n=this.index.get(e),r=n[t];return r||(r=new Map,n[t]=r),r}},{key:"getValueIndex",value:function(e,t,n){var r=this.getColumnMap(e,t),a=this.getColumnMap(e,t).get(n);return a||(a={version:this.transformingService.version(),index:[]},r.set(n,a)),a}},{key:"ensureRecentData",value:function(e,t,n){var r=this.getValueIndex(e,t,n),a=this.transformingService.version();if(r.version!==a){var i,o=this.transformingService.getTransformationsFrom(r.version,(function(t){return t.sheet===e&&(t instanceof AddRowsTransformer||t instanceof RemoveRowsTransformer)})),s=_createForOfIteratorHelper$c(o);try{for(s.s();!(i=s.n()).done;){var l=i.value;l instanceof AddRowsTransformer?this.addRows(t,l.rowsSpan,n):l instanceof RemoveRowsTransformer&&this.removeRows(t,l.rowsSpan,n)}}catch(e){s.e(e)}finally{s.f()}r.version=a}}},{key:"addSingleCellValue",value:function(e,t){var n=this;this.stats.measure(StatType.BUILD_COLUMN_INDEX,(function(){n.ensureRecentData(t.sheet,t.col,e),"string"==typeof e&&(e=forceNormalizeString(e));var r=n.getValueIndex(t.sheet,t.col,e);n.addValue(r,t.row)}))}},{key:"removeSingleValue",value:function(e,t){var n=this;this.stats.measure(StatType.BUILD_COLUMN_INDEX,(function(){n.ensureRecentData(t.sheet,t.col,e);var r=n.getColumnMap(t.sheet,t.col);"string"==typeof e&&(e=forceNormalizeString(e));var a=r.get(e);if(a){var i=upperBound(a.index,t.row);a.index.splice(i,1),0===a.index.length&&r.delete(e),0===r.size&&delete n.index.get(t.sheet)[t.col]}}))}},{key:"addRows",value:function(e,t,n){var r=this.getValueIndex(t.sheet,e,n);this.shiftRows(r,t.rowStart,t.numberOfRows)}},{key:"removeRows",value:function(e,t,n){var r=this.getValueIndex(t.sheet,e,n);this.removeRowsFromValues(r,t),this.shiftRows(r,t.rowEnd+1,-t.numberOfRows)}},{key:"addValue",value:function(e,t){var n=lowerBound$1(e.index,t);e.index[n]!==t&&(n===e.index.length-1?e.index.push(t):e.index.splice(n+1,0,t))}},{key:"removeRowsFromValues",value:function(e,t){var n=upperBound(e.index,t.rowStart),r=lowerBound$1(e.index,t.rowEnd);e.index[n]<=t.rowEnd&&e.index.splice(n,r-n+1)}},{key:"shiftRows",value:function(e,t,n){for(var r=upperBound(e.index,t);r<e.index.length;++r)e.index[r]+=n}}]),e}();function upperBound(e,t){for(var n=0,r=e.length-1;n<=r;){var a=Math.floor((n+r)/2);if(t>e[a])n=a+1;else{if(!(t<e[a]))return a;r=a-1}}return n}function lowerBound$1(e,t){for(var n=0,r=e.length-1;n<=r;){var a=Math.floor((n+r)/2);if(t>e[a])n=a+1;else{if(!(t<e[a]))return a;r=a-1}}return r}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function buildColumnSearchStrategy(e,t,n){return t.useColumnIndex?new ColumnIndex(e,t,n):new ColumnBinarySearch(e,t)}function _classCallCheck$N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$N(e,t,n){return t&&_defineProperties$N(e.prototype,t),n&&_defineProperties$N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */var NumberLiteralHelper=function(){function e(t){_classCallCheck$N(this,e),this.config=t;var n="."===this.config.thousandSeparator?"\\".concat(this.config.thousandSeparator):this.config.thousandSeparator,r="."===this.config.decimalSeparator?"\\".concat(this.config.decimalSeparator):this.config.decimalSeparator;this.numberPattern=new RegExp("^([+-]?((".concat(r,"\\d+)|(\\d+(").concat(n,"\\d{3,})*(").concat(r,"\\d*)?)))(e[+-]?\\d+)?$")),this.allThousandSeparatorsRegex=new RegExp("".concat(n),"g")}return _createClass$N(e,[{key:"numericStringToMaybeNumber",value:function(e){if(this.numberPattern.test(e)){var t=this.numericStringToNumber(e);if(isNaN(t))return;return t}}},{key:"numericStringToNumber",value:function(e){var t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}]),e}();function _createForOfIteratorHelper$b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$f(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$f(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$f(e,t):void 0}}function _arrayLikeToArray$f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$M(e,t,n){return t&&_defineProperties$M(e.prototype,t),n&&_defineProperties$M(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Serialization=function(){function e(t,n,r){_classCallCheck$M(this,e),this.dependencyGraph=t,this.unparser=n,this.exporter=r}return _createClass$M(e,[{key:"getCellFormula",value:function(e,t){var n=this.dependencyGraph.getCell(e);if(n instanceof FormulaCellVertex){var r=n.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=null!=t?t:e,this.unparser.unparse(r,t)}if(n instanceof ArrayVertex){var a=n.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(a.row!==e.row||a.col!==e.col||a.sheet!==e.sheet)return;t=null!=t?t:e;var i=n.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(void 0!==i)return this.unparser.unparse(i,t)}else if(n instanceof ParsingErrorVertex)return n.getFormula()}},{key:"getCellSerialized",value:function(e,t){var n;return null!==(n=this.getCellFormula(e,t))&&void 0!==n?n:this.getRawValue(e)}},{key:"getCellValue",value:function(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}},{key:"getRawValue",value:function(e){return this.dependencyGraph.getRawValue(e)}},{key:"getSheetValues",value:function(e){var t=this;return this.genericSheetGetter(e,(function(e){return t.getCellValue(e)}))}},{key:"getSheetFormulas",value:function(e){var t=this;return this.genericSheetGetter(e,(function(e){return t.getCellFormula(e)}))}},{key:"genericSheetGetter",value:function(e,t){for(var n=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),a=new Array(n),i=0;i<n;i++){a[i]=new Array(r);for(var o=0;o<r;o++){var s=simpleCellAddress(e,o,i);a[i][o]=t(s)}for(var l=r-1;l>=0&&(null===a[i][l]||void 0===a[i][l]);l--)a[i].pop()}for(var u=n-1;u>=0&&0===a[u].length;u--)a.pop();return a}},{key:"genericAllSheetsGetter",value:function(e){var t,n={},r=_createForOfIteratorHelper$b(this.dependencyGraph.sheetMapping.displayNames());try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.dependencyGraph.sheetMapping.fetch(a);n[a]=e(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getSheetSerialized",value:function(e){var t=this;return this.genericSheetGetter(e,(function(e){return t.getCellSerialized(e)}))}},{key:"getAllSheetsValues",value:function(){var e=this;return this.genericAllSheetsGetter((function(t){return e.getSheetValues(t)}))}},{key:"getAllSheetsFormulas",value:function(){var e=this;return this.genericAllSheetsGetter((function(t){return e.getSheetFormulas(t)}))}},{key:"getAllSheetsSerialized",value:function(){var e=this;return this.genericAllSheetsGetter((function(t){return e.getSheetSerialized(t)}))}},{key:"getAllNamedExpressionsSerialized",value:function(){var e,t=this,n=[],r=0,a=_createForOfIteratorHelper$b(this.dependencyGraph.sheetMapping.displayNames());try{for(a.s();!(e=a.n()).done;){var i=e.value,o=this.dependencyGraph.sheetMapping.fetch(i);n[o]=r,r++}}catch(e){a.e(e)}finally{a.f()}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map((function(e){return{name:e.expression.displayName,expression:t.getCellSerialized(e.expression.address),scope:void 0!==e.scope?n[e.scope]:void 0,options:e.expression.options}}))}},{key:"withNewConfig",value:function(t,n){var r=new Unparser(t,buildLexerConfig(t),this.dependencyGraph.sheetMapping.fetchDisplayName,n);return new e(this.dependencyGraph,r,this.exporter)}}]),e}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck$L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$L(e,t,n){return t&&_defineProperties$L(e.prototype,t),n&&_defineProperties$L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var BuildEngineFactory=function(){function e(){_classCallCheck$L(this,e)}return _createClass$L(e,null,[{key:"buildFromSheets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new Config(t);return this.buildEngine(r,e,n)}},{key:"buildFromSheet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new Config(t),a=r.translationPackage.getUITranslation(UIElement.NEW_SHEET_PREFIX)+"1";return this.buildEngine(r,_defineProperty({},a,e),n)}},{key:"buildEmpty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.buildEngine(new Config(e),{},t)}},{key:"rebuildWithConfig",value:function(e,t,n,r){return this.buildEngine(e,t,n,r)}},{key:"buildEngine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.useStats?new Statistics:new EmptyStatistics;r.start(StatType.BUILD_ENGINE_TOTAL);var a=new NamedExpressions,i=new FunctionRegistry(e),o=new LazilyTransformingAstService(r),s=DependencyGraph.buildEmpty(o,e,i,a,r),l=buildColumnSearchStrategy(s,e,r),u=s.sheetMapping,c=s.addressMapping;for(var p in t)if(Object.prototype.hasOwnProperty.call(t,p)){var d=t[p];validateAsSheet(d);var m=findBoundaries(d);if(m.height>e.maxRows||m.width>e.maxColumns)throw new SheetSizeLimitExceededError;var f=u.addSheet(p);c.autoAddSheet(f,d,m)}var h=new ParserWithCaching(e,i,u.get);o.parser=h;var y=new Unparser(e,buildLexerConfig(e),u.fetchDisplayName,a),b=new DateTimeHelper(e),g=new NumberLiteralHelper(e),v=new ArithmeticHelper(e,b,g),T=new CellContentParser(e,b,g),C=new ArraySizePredictor(e,i),N=new Operations(e,s,l,T,h,r,o,a,C),A=new UndoRedo(e,N);o.undoRedo=A;var S=new ClipboardOperations(e,s,N),w=new CrudOperations(e,N,A,S,s,l,h,T,o,a);n.forEach((function(e){w.ensureItIsPossibleToAddNamedExpression(e.name,e.expression,e.scope),w.operations.addNamedExpression(e.name,e.expression,e.scope,e.options)}));var x=new Exporter(e,a,u.fetchDisplayName,o),V=new Serialization(s,y,x),E=new Interpreter(e,s,l,r,v,i,a,V,C,b);r.measure(StatType.GRAPH_BUILD,(function(){new GraphBuilder(s,l,h,T,r,C).buildGraph(t,r)}));var $=new Evaluator(e,r,E,o,s,l);return $.run(),r.end(StatType.BUILD_ENGINE_TOTAL),{config:e,stats:r,dependencyGraph:s,columnSearch:l,parser:h,unparser:y,cellContentParser:T,evaluator:$,lazilyTransformingAstService:o,crudOperations:w,exporter:x,namedExpressions:a,serialization:V,functionRegistry:i}}}]),e}(),$$c=_export,$entries=objectToArray.entries;function _slicedToArray$4(e,t){return _arrayWithHoles$4(e)||_iterableToArrayLimit$4(e,t)||_unsupportedIterableToArray$e(e,t)||_nonIterableRest$4()}function _nonIterableRest$4(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$e(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$e(e,t):void 0}}function _arrayLikeToArray$e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$4(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$4(e){if(Array.isArray(e))return e}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function objectDestroy(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=_slicedToArray$4(n[t],2),a=r[0],i=r[1];i instanceof Function?e[a]=postMortem(i):delete e[a]}}function postMortem(e){return function(){throw new Error('The "'.concat(e,'" method cannot be called because this HyperFormula instance has been destroyed'))}}$$c({target:"Object",stat:!0},{entries:function(e){return $entries(e)}});var tinyEmitter={exports:{}};function E$4(){}E$4.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function a(){r.off(e,a),t.apply(n,arguments)}return a._=t,this.on(e,a,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,a=n.length;r<a;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],a=[];if(r&&t)for(var i=0,o=r.length;i<o;i++)r[i].fn!==t&&r[i].fn._!==t&&a.push(r[i]);return a.length?n[e]=a:delete n[e],this}},tinyEmitter.exports=E$4;var TinyEmitter=tinyEmitter.exports.TinyEmitter=E$4,Events;function _typeof$H(e){return _typeof$H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$H(e)}function _classCallCheck$K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$K(e,t,n){return t&&_defineProperties$K(e.prototype,t),n&&_defineProperties$K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$H(e)););return e}function _inherits$H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$H(e,t)}function _setPrototypeOf$H(e,t){return _setPrototypeOf$H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$H(e,t)}function _createSuper$H(e){var t=_isNativeReflectConstruct$H();return function(){var n,r=_getPrototypeOf$H(e);if(t){var a=_getPrototypeOf$H(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$H(this,n)}}function _possibleConstructorReturn$H(e,t){if(t&&("object"===_typeof$H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$H(e)}function _assertThisInitialized$H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$H(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$H(e){return _getPrototypeOf$H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$H(e)}!function(e){e.SheetAdded="sheetAdded",e.SheetRemoved="sheetRemoved",e.SheetRenamed="sheetRenamed",e.NamedExpressionAdded="namedExpressionAdded",e.NamedExpressionRemoved="namedExpressionRemoved",e.ValuesUpdated="valuesUpdated",e.EvaluationSuspended="evaluationSuspended",e.EvaluationResumed="evaluationResumed"}(Events||(Events={}));var Emitter=function(e){_inherits$H(n,e);var t=_createSuper$H(n);function n(){return _classCallCheck$K(this,n),t.apply(this,arguments)}return _createClass$K(n,[{key:"emit",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return(t=_get(_getPrototypeOf$H(n.prototype),"emit",this)).call.apply(t,[this,e].concat(a)),this}}]),n}(TinyEmitter);function _toConsumableArray$4(e){return _arrayWithoutHoles$4(e)||_iterableToArray$4(e)||_unsupportedIterableToArray$d(e)||_nonIterableSpread$4()}function _nonIterableSpread$4(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$4(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$4(e){if(Array.isArray(e))return _arrayLikeToArray$d(e)}function _createForOfIteratorHelper$a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$d(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$d(e,t):void 0}}function _arrayLikeToArray$d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$J(e,t,n){return t&&_defineProperties$J(e.prototype,t),n&&_defineProperties$J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var HyperFormula=function(){function e(t,n,r,a,i,o,s,l,u,c,p,d,m,f){_classCallCheck$J(this,e),this._config=t,this._stats=n,this._dependencyGraph=r,this._columnSearch=a,this._parser=i,this._unparser=o,this._cellContentParser=s,this._evaluator=l,this._lazilyTransformingAstService=u,this._crudOperations=c,this._exporter=p,this._namedExpressions=d,this._serialization=m,this._functionRegistry=f,this._emitter=new Emitter,this._evaluationSuspended=!1}return _createClass$J(e,[{key:"graph",get:function(){return this.dependencyGraph.graph}},{key:"rangeMapping",get:function(){return this.dependencyGraph.rangeMapping}},{key:"arrayMapping",get:function(){return this.dependencyGraph.arrayMapping}},{key:"sheetMapping",get:function(){return this.dependencyGraph.sheetMapping}},{key:"addressMapping",get:function(){return this.dependencyGraph.addressMapping}},{key:"dependencyGraph",get:function(){return this._dependencyGraph}},{key:"evaluator",get:function(){return this._evaluator}},{key:"columnSearch",get:function(){return this._columnSearch}},{key:"lazilyTransformingAstService",get:function(){return this._lazilyTransformingAstService}},{key:"licenseKeyValidityState",get:function(){return this._config.licenseKeyValidityState}},{key:"getCellValue",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}},{key:"getCellFormula",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}},{key:"getCellSerialized",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}},{key:"getSheetValues",value:function(e){return validateArgToType(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}},{key:"getSheetFormulas",value:function(e){return validateArgToType(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}},{key:"getSheetSerialized",value:function(e){return validateArgToType(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}},{key:"getAllSheetsDimensions",value:function(){var e=this;return this._serialization.genericAllSheetsGetter((function(t){return e.getSheetDimensions(t)}))}},{key:"getSheetDimensions",value:function(e){return validateArgToType(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}},{key:"getAllSheetsValues",value:function(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}},{key:"getAllSheetsFormulas",value:function(){return this._serialization.getAllSheetsFormulas()}},{key:"getAllSheetsSerialized",value:function(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}},{key:"updateConfig",value:function(e){var t=this._config.mergeConfig(e),n=this._config.mergeConfig({language:e.language}),r=this._serialization.withNewConfig(n,this._namedExpressions).getAllSheetsSerialized(),a=this._serialization.getAllNamedExpressionsSerialized(),i=BuildEngineFactory.rebuildWithConfig(t,r,a,this._stats);this._config=i.config,this._stats=i.stats,this._dependencyGraph=i.dependencyGraph,this._columnSearch=i.columnSearch,this._parser=i.parser,this._unparser=i.unparser,this._cellContentParser=i.cellContentParser,this._evaluator=i.evaluator,this._lazilyTransformingAstService=i.lazilyTransformingAstService,this._crudOperations=i.crudOperations,this._exporter=i.exporter,this._namedExpressions=i.namedExpressions,this._serialization=i.serialization,this._functionRegistry=i.functionRegistry}},{key:"getConfig",value:function(){return this._config.getConfig()}},{key:"rebuildAndRecalculate",value:function(){this.updateConfig({})}},{key:"getStats",value:function(){return this._stats.snapshot()}},{key:"undo",value:function(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}},{key:"redo",value:function(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isThereSomethingToUndo",value:function(){return this._crudOperations.isThereSomethingToUndo()}},{key:"isThereSomethingToRedo",value:function(){return this._crudOperations.isThereSomethingToRedo()}},{key:"isItPossibleToSetCellContents",value:function(e){var t;if(isSimpleCellAddress(e))t=new AbsoluteCellRange(e,e);else{if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange","address");t=new AbsoluteCellRange(e.start,e.end)}try{this._crudOperations.ensureRangeInSizeLimits(t);var n,r=_createForOfIteratorHelper$a(t.addresses(this._dependencyGraph));try{for(r.s();!(n=r.n()).done;){var a=n.value;this._crudOperations.ensureItIsPossibleToChangeContent(a)}}catch(e){r.e(e)}finally{r.f()}}catch(e){return!1}return!0}},{key:"setCellContents",value:function(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}},{key:"swapRowIndexes",value:function(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToSwapRowIndexes",value:function(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch(e){return!1}}},{key:"setRowOrder",value:function(e,t){validateArgToType(e,"number","sheetId");var n=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,n)}},{key:"isItPossibleToSetRowOrder",value:function(e,t){validateArgToType(e,"number","sheetId");try{var n=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,n),this._crudOperations.testRowOrderForArrays(e,n),!0}catch(e){return!1}}},{key:"swapColumnIndexes",value:function(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToSwapColumnIndexes",value:function(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch(e){return!1}}},{key:"setColumnOrder",value:function(e,t){validateArgToType(e,"number","sheetId");var n=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,n)}},{key:"isItPossibleToSetColumnOrder",value:function(e,t){validateArgToType(e,"number","sheetId");try{var n=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,n),this._crudOperations.testColumnOrderForArrays(e,n),!0}catch(e){return!1}}},{key:"isItPossibleToAddRows",value:function(e){validateArgToType(e,"number","sheetId");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=normalizeAddedIndexes(n);try{var i;return(i=this._crudOperations).ensureItIsPossibleToAddRows.apply(i,[e].concat(_toConsumableArray$4(a))),!0}catch(e){return!1}}},{key:"addRows",value:function(e){var t;validateArgToType(e,"number","sheetId");for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=this._crudOperations).addRows.apply(t,[e].concat(r)),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToRemoveRows",value:function(e){validateArgToType(e,"number","sheetId");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=normalizeRemovedIndexes(n);try{var i;return(i=this._crudOperations).ensureItIsPossibleToRemoveRows.apply(i,[e].concat(_toConsumableArray$4(a))),!0}catch(e){return!1}}},{key:"removeRows",value:function(e){var t;validateArgToType(e,"number","sheetId");for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=this._crudOperations).removeRows.apply(t,[e].concat(r)),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToAddColumns",value:function(e){validateArgToType(e,"number","sheetId");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=normalizeAddedIndexes(n);try{var i;return(i=this._crudOperations).ensureItIsPossibleToAddColumns.apply(i,[e].concat(_toConsumableArray$4(a))),!0}catch(e){return!1}}},{key:"addColumns",value:function(e){var t;validateArgToType(e,"number","sheetId");for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=this._crudOperations).addColumns.apply(t,[e].concat(r)),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToRemoveColumns",value:function(e){validateArgToType(e,"number","sheetId");for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=normalizeRemovedIndexes(n);try{var i;return(i=this._crudOperations).ensureItIsPossibleToRemoveColumns.apply(i,[e].concat(_toConsumableArray$4(a))),!0}catch(e){return!1}}},{key:"removeColumns",value:function(e){var t;validateArgToType(e,"number","sheetId");for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=this._crudOperations).removeColumns.apply(t,[e].concat(r)),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToMoveCells",value:function(e,t){if(!isSimpleCellAddress(t))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");try{var n=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(n.start,n.width(),n.height(),t),!0}catch(e){return!1}}},{key:"moveCells",value:function(e,t){if(!isSimpleCellAddress(t))throw new ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");var n=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.moveCells(n.start,n.width(),n.height(),t),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToMoveRows",value:function(e,t,n,r){validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startRow"),validateArgToType(n,"number","numberOfRows"),validateArgToType(r,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,n,r),!0}catch(e){return!1}}},{key:"moveRows",value:function(e,t,n,r){return validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startRow"),validateArgToType(n,"number","numberOfRows"),validateArgToType(r,"number","targetRow"),this._crudOperations.moveRows(e,t,n,r),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToMoveColumns",value:function(e,t,n,r){validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startColumn"),validateArgToType(n,"number","numberOfColumns"),validateArgToType(r,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,n,r),!0}catch(e){return!1}}},{key:"moveColumns",value:function(e,t,n,r){return validateArgToType(e,"number","sheetId"),validateArgToType(t,"number","startColumn"),validateArgToType(n,"number","numberOfColumns"),validateArgToType(r,"number","targetColumn"),this._crudOperations.moveColumns(e,t,n,r),this.recomputeIfDependencyGraphNeedsIt()}},{key:"copy",value:function(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");var t=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}},{key:"cut",value:function(e){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");var t=new AbsoluteCellRange(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}},{key:"paste",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isClipboardEmpty",value:function(){return this._crudOperations.isClipboardEmpty()}},{key:"clearClipboard",value:function(){this._crudOperations.clearClipboard()}},{key:"clearRedoStack",value:function(){this._crudOperations.undoRedo.clearRedoStack()}},{key:"clearUndoStack",value:function(){this._crudOperations.undoRedo.clearUndoStack()}},{key:"getRangeValues",value:function(e){var t=this;if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((function(e){return e.map((function(e){return t.getCellValue(e)}))}))}},{key:"getRangeFormulas",value:function(e){var t=this;if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((function(e){return e.map((function(e){return t.getCellFormula(e)}))}))}},{key:"getRangeSerialized",value:function(e){var t=this;if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");return new AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((function(e){return e.map((function(e){return t.getCellSerialized(e)}))}))}},{key:"getFillRangeData",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","source");if(!isSimpleCellRange(t))throw new ExpectedValueOfTypeError("SimpleCellRange","target");var a=new AbsoluteCellRange(e.start,e.end),i=new AbsoluteCellRange(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),i.arrayOfAddressesInRange().map((function(i){return i.map((function(i){var o=((i.row-(r?t:e).start.row)%a.height()+a.height())%a.height()+e.start.row,s=((i.col-(r?t:e).start.col)%a.width()+a.width())%a.width()+e.start.col;return n._serialization.getCellSerialized({row:o,col:s,sheet:a.sheet},i)}))}))}},{key:"isItPossibleToAddSheet",value:function(e){validateArgToType(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch(e){return!1}}},{key:"addSheet",value:function(e){void 0!==e&&validateArgToType(e,"string","sheetName");var t=this._crudOperations.addSheet(e);return this._emitter.emit(Events.SheetAdded,t),t}},{key:"isItPossibleToRemoveSheet",value:function(e){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}},{key:"removeSheet",value:function(e){validateArgToType(e,"number","sheetId");var t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);var n=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.SheetRemoved,t,n),n}},{key:"isItPossibleToClearSheet",value:function(e){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}},{key:"clearSheet",value:function(e){return validateArgToType(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToReplaceSheetContent",value:function(e,t){validateArgToType(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch(e){return!1}}},{key:"setSheetContent",value:function(e,t){return validateArgToType(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}},{key:"simpleCellAddressFromString",value:function(e,t){return validateArgToType(e,"string","cellAddress"),validateArgToType(t,"number","sheetId"),simpleCellAddressFromString(this.sheetMapping.get,e,t)}},{key:"simpleCellRangeFromString",value:function(e,t){return validateArgToType(e,"string","cellRange"),validateArgToType(t,"number","sheetId"),simpleCellRangeFromString(this.sheetMapping.get,e,t)}},{key:"simpleCellAddressToString",value:function(e,t){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return validateArgToType(t,"number","sheetId"),simpleCellAddressToString(this.sheetMapping.fetchDisplayName,e,t)}},{key:"simpleCellRangeToString",value:function(e,t){if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellRange","cellRange");return validateArgToType(t,"number","sheetId"),simpleCellRangeToString(this.sheetMapping.fetchDisplayName,e,t)}},{key:"getCellDependents",value:function(e){var t;if(isSimpleCellAddress(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}},{key:"getCellPrecedents",value:function(e){var t;if(isSimpleCellAddress(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!isSimpleCellRange(e))throw new ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.dependencyQueryAddresses(t)}},{key:"getSheetName",value:function(e){return validateArgToType(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}},{key:"getSheetNames",value:function(){return this.sheetMapping.sheetNames()}},{key:"getSheetId",value:function(e){return validateArgToType(e,"string","sheetName"),this.sheetMapping.get(e)}},{key:"doesSheetExist",value:function(e){return validateArgToType(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}},{key:"getCellType",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");var t=this.dependencyGraph.getCell(e);return getCellType(t,e)}},{key:"doesCellHaveSimpleValue",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===CellType.VALUE}},{key:"doesCellHaveFormula",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");var t=this.getCellType(e);return t===CellType.FORMULA||t===CellType.ARRAYFORMULA}},{key:"isCellEmpty",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===CellType.EMPTY}},{key:"isCellPartOfArray",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");var t=this.getCellType(e);return t===CellType.ARRAY||t===CellType.ARRAYFORMULA}},{key:"getCellValueType",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();var t=this.dependencyGraph.getCellValue(e);return getCellValueType(t)}},{key:"getCellValueDetailedType",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();var t=this.dependencyGraph.getCellValue(e);return getCellValueDetailedType(t)}},{key:"getCellValueFormat",value:function(e){if(!isSimpleCellAddress(e))throw new ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();var t=this.dependencyGraph.getCellValue(e);return getCellValueFormat(t)}},{key:"countSheets",value:function(){return this.sheetMapping.numberOfSheets()}},{key:"isItPossibleToRenameSheet",value:function(e,t){validateArgToType(e,"number","sheetId"),validateArgToType(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch(e){return!1}}},{key:"renameSheet",value:function(e,t){validateArgToType(e,"number","sheetId"),validateArgToType(t,"string","newName");var n=this._crudOperations.renameSheet(e,t);void 0!==n&&this._emitter.emit(Events.SheetRenamed,n,t)}},{key:"batch",value:function(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(e){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),e}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}},{key:"suspendEvaluation",value:function(){this._evaluationSuspended=!0,this._emitter.emit(Events.EvaluationSuspended)}},{key:"resumeEvaluation",value:function(){this._evaluationSuspended=!1;var e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.EvaluationResumed,e),e}},{key:"isEvaluationSuspended",value:function(){return this._evaluationSuspended}},{key:"isItPossibleToAddNamedExpression",value:function(e,t,n){validateArgToType(e,"string","expressionName"),void 0!==n&&validateArgToType(n,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,n),!0}catch(e){return!1}}},{key:"addNamedExpression",value:function(e,t,n,r){validateArgToType(e,"string","expressionName"),void 0!==n&&validateArgToType(n,"number","scope"),this._crudOperations.addNamedExpression(e,t,n,r);var a=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionAdded,e,a),a}},{key:"getNamedExpressionValue",value:function(e,t){validateArgToType(e,"string","expressionName"),void 0!==t&&validateArgToType(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);var n=this._namedExpressions.namedExpressionForScope(e,t);return n?this._serialization.getCellValue(n.address):void 0}},{key:"getNamedExpressionFormula",value:function(e,t){validateArgToType(e,"string","expressionName"),void 0!==t&&validateArgToType(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);var n=this._namedExpressions.namedExpressionForScope(e,t);return void 0===n?void 0:this._serialization.getCellFormula(n.address)}},{key:"getNamedExpression",value:function(e,t){validateArgToType(e,"string","expressionName"),void 0!==t&&validateArgToType(t,"number","scope");var n=this._namedExpressions.namedExpressionForScope(e,t);if(void 0!==n)return{name:e,scope:t,expression:this._serialization.getCellFormula(n.address),options:n.options}}},{key:"isItPossibleToChangeNamedExpression",value:function(e,t,n){validateArgToType(e,"string","expressionName"),void 0!==n&&validateArgToType(n,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,n),!0}catch(e){return!1}}},{key:"changeNamedExpression",value:function(e,t,n,r){return validateArgToType(e,"string","expressionName"),void 0!==n&&validateArgToType(n,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,n,t,r),this.recomputeIfDependencyGraphNeedsIt()}},{key:"isItPossibleToRemoveNamedExpression",value:function(e,t){validateArgToType(e,"string","expressionName"),void 0!==t&&validateArgToType(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch(e){return!1}}},{key:"removeNamedExpression",value:function(e,t){validateArgToType(e,"string","expressionName"),void 0!==t&&validateArgToType(t,"number","scope");var n=this._crudOperations.removeNamedExpression(e,t);if(n){var r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(Events.NamedExpressionRemoved,n.displayName,r),r}return[]}},{key:"listNamedExpressions",value:function(e){return void 0!==e&&validateArgToType(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}},{key:"getAllNamedExpressionsSerialized",value:function(){return this._serialization.getAllNamedExpressionsSerialized()}},{key:"normalizeFormula",value:function(e){validateArgToType(e,"string","formulaString");var t=this.extractTemporaryFormula(e),n=t.ast,r=t.address;if(void 0===n)throw new NotAFormulaError;return this._unparser.unparse(n,r)}},{key:"calculateFormula",value:function(e,t){validateArgToType(e,"string","formulaString"),validateArgToType(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);var n=this.extractTemporaryFormula(e,t),r=n.ast,a=n.address,i=n.dependencies;if(void 0===r)throw new NotAFormulaError;var o=this.evaluator.runAndForget(r,a,i);return this._exporter.exportScalarOrRange(o)}},{key:"validateFormula",value:function(e){validateArgToType(e,"string","formulaString");var t=this.extractTemporaryFormula(e).ast;return void 0!==t&&!(t.type===AstNodeType.ERROR&&!t.error)}},{key:"getRegisteredFunctionNames",value:function(){return e.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}},{key:"getFunctionPlugin",value:function(e){return validateArgToType(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}},{key:"getAllFunctionPlugins",value:function(){return this._functionRegistry.getPlugins()}},{key:"numberToDateTime",value:function(e){return validateArgToType(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}},{key:"numberToDate",value:function(e){return validateArgToType(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}},{key:"numberToTime",value:function(e){return validateArgToType(e,"number","val"),numberToSimpleTime(e)}},{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"destroy",value:function(){objectDestroy(this)}},{key:"ensureEvaluationIsNotSuspended",value:function(){if(this._evaluationSuspended)throw new EvaluationSuspendedError}},{key:"extractTemporaryFormula",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this._cellContentParser.parse(e),r={sheet:t,col:0,row:0};if(!(n instanceof CellContent.Formula))return{address:r,dependencies:[]};var a=this._parser.parse(n.formula,r),i=a.ast,o=a.errors,s=a.dependencies;return o.length>0?{address:r,dependencies:[]}:{ast:i,address:r,dependencies:s}}},{key:"recomputeIfDependencyGraphNeedsIt",value:function(){if(this._evaluationSuspended)return[];var e=this._crudOperations.getAndClearContentChanges(),t=Array.from(this.dependencyGraph.verticesToRecompute());this.dependencyGraph.clearRecentlyChangedVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));var n=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(Events.ValuesUpdated,n),n}}],[{key:"defaultConfig",get:function(){return getDefaultConfig()}},{key:"buildFromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.buildFromEngineState(BuildEngineFactory.buildFromSheet(e,t,n))}},{key:"buildFromSheets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.buildFromEngineState(BuildEngineFactory.buildFromSheets(e,t,n))}},{key:"buildEmpty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.buildFromEngineState(BuildEngineFactory.buildEmpty(e,t))}},{key:"getLanguage",value:function(e){validateArgToType(e,"string","languageCode");var t=this.registeredLanguages.get(e);if(void 0===t)throw new LanguageNotRegisteredError;return t}},{key:"registerLanguage",value:function(e,t){if(validateArgToType(e,"string","languageCode"),this.registeredLanguages.has(e))throw new LanguageAlreadyRegisteredError;this.registeredLanguages.set(e,buildTranslationPackage(t))}},{key:"unregisterLanguage",value:function(e){if(validateArgToType(e,"string","languageCode"),!this.registeredLanguages.has(e))throw new LanguageNotRegisteredError;this.registeredLanguages.delete(e)}},{key:"getRegisteredLanguagesCodes",value:function(){return Array.from(this.registeredLanguages.keys())}},{key:"registerFunctionPlugin",value:function(e,t){FunctionRegistry.registerFunctionPlugin(e,t)}},{key:"unregisterFunctionPlugin",value:function(e){FunctionRegistry.unregisterFunctionPlugin(e)}},{key:"registerFunction",value:function(e,t,n){validateArgToType(e,"string","functionId"),FunctionRegistry.registerFunction(e,t,n)}},{key:"unregisterFunction",value:function(e){validateArgToType(e,"string","functionId"),FunctionRegistry.unregisterFunction(e)}},{key:"unregisterAllFunctions",value:function(){FunctionRegistry.unregisterAll()}},{key:"getRegisteredFunctionNames",value:function(e){validateArgToType(e,"string","code");var t=FunctionRegistry.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}},{key:"getFunctionPlugin",value:function(e){return validateArgToType(e,"string","functionId"),FunctionRegistry.getFunctionPlugin(e)}},{key:"getAllFunctionPlugins",value:function(){return FunctionRegistry.getPlugins()}},{key:"buildFromEngineState",value:function(t){return new e(t.config,t.stats,t.dependencyGraph,t.columnSearch,t.parser,t.unparser,t.cellContentParser,t.evaluator,t.lazilyTransformingAstService,t.crudOperations,t.exporter,t.namedExpressions,t.serialization,t.functionRegistry)}}]),e}();function _toConsumableArray$3(e){return _arrayWithoutHoles$3(e)||_iterableToArray$3(e)||_unsupportedIterableToArray$c(e)||_nonIterableSpread$3()}function _nonIterableSpread$3(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$c(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$c(e,t):void 0}}function _iterableToArray$3(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$3(e){if(Array.isArray(e))return _arrayLikeToArray$c(e)}function _arrayLikeToArray$c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$I(e,t,n){return t&&_defineProperties$I(e.prototype,t),n&&_defineProperties$I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}HyperFormula.version="2.0.0",HyperFormula.buildDate="14/04/2022 09:14:09",HyperFormula.releaseDate="14/04/2022",HyperFormula.languages={},HyperFormula.registeredLanguages=new Map;var privatePool=new WeakMap,Config=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_classCallCheck$I(this,e);var r=t.accentSensitive,a=t.binarySearchThreshold,i=t.caseSensitive,o=t.caseFirst,s=t.chooseAddressMappingPolicy,l=t.currencySymbol,u=t.dateFormats,c=t.decimalSeparator,p=t.evaluateNullToZero,d=t.functionArgSeparator,m=t.functionPlugins,f=t.ignorePunctuation,h=t.leapYear1900,y=t.localeLang,b=t.language,g=t.ignoreWhiteSpace,v=t.licenseKey,T=t.matchWholeCell,C=t.arrayColumnSeparator,N=t.arrayRowSeparator,A=t.maxRows,S=t.maxColumns,w=t.nullYear,x=t.nullDate,V=t.parseDateTime,E=t.precisionEpsilon,$=t.precisionRounding,_=t.stringifyDateTime,O=t.stringifyDuration,I=t.smartRounding,D=t.timeFormats,R=t.thousandSeparator,P=t.useArrayArithmetic,k=t.useStats,M=t.undoLimit,F=t.useColumnIndex,B=t.useRegularExpressions,L=t.useWildcards;n&&e.warnDeprecatedOptions(t),this.useArrayArithmetic=configValueFromParam(P,"boolean","useArrayArithmetic"),this.accentSensitive=configValueFromParam(r,"boolean","accentSensitive"),this.caseSensitive=configValueFromParam(i,"boolean","caseSensitive"),this.caseFirst=configValueFromParam(o,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=configValueFromParam(f,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=null!=s?s:e.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=_toConsumableArray$3(configValueFromParamCheck(u,Array.isArray,"array","dateFormats")),this.timeFormats=_toConsumableArray$3(configValueFromParamCheck(D,Array.isArray,"array","timeFormats")),this.functionArgSeparator=configValueFromParam(d,"string","functionArgSeparator"),this.decimalSeparator=configValueFromParam(c,[".",","],"decimalSeparator"),this.language=configValueFromParam(b,"string","language"),this.ignoreWhiteSpace=configValueFromParam(g,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=configValueFromParam(v,"string","licenseKey"),this.thousandSeparator=configValueFromParam(R,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=configValueFromParam(C,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=configValueFromParam(N,[";","|"],"arrayRowSeparator"),this.localeLang=configValueFromParam(y,"string","localeLang"),this.functionPlugins=_toConsumableArray$3(null!=m?m:e.defaultConfig.functionPlugins),this.smartRounding=configValueFromParam(I,"boolean","smartRounding"),this.evaluateNullToZero=configValueFromParam(p,"boolean","evaluateNullToZero"),this.nullYear=configValueFromParam(w,"number","nullYear"),validateNumberToBeAtLeast(this.nullYear,"nullYear",0),validateNumberToBeAtMost(this.nullYear,"nullYear",100),this.precisionRounding=configValueFromParam($,"number","precisionRounding"),validateNumberToBeAtLeast(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=configValueFromParam(E,"number","precisionEpsilon"),validateNumberToBeAtLeast(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=configValueFromParam(F,"boolean","useColumnIndex"),this.useStats=configValueFromParam(k,"boolean","useStats"),this.binarySearchThreshold=null!=a?a:e.defaultConfig.binarySearchThreshold,this.parseDateTime=configValueFromParam(V,"function","parseDateTime"),this.stringifyDateTime=configValueFromParam(_,"function","stringifyDateTime"),this.stringifyDuration=configValueFromParam(O,"function","stringifyDuration"),this.translationPackage=HyperFormula.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=configValueFromParamCheck(x,instanceOfSimpleDate,"IDate","nullDate"),this.leapYear1900=configValueFromParam(h,"boolean","leapYear1900"),this.undoLimit=configValueFromParam(M,"number","undoLimit"),this.useRegularExpressions=configValueFromParam(B,"boolean","useRegularExpressions"),this.useWildcards=configValueFromParam(L,"boolean","useWildcards"),this.matchWholeCell=configValueFromParam(T,"boolean","matchWholeCell"),validateNumberToBeAtLeast(this.undoLimit,"undoLimit",0),this.maxRows=configValueFromParam(A,"number","maxRows"),validateNumberToBeAtLeast(this.maxRows,"maxRows",1),this.maxColumns=configValueFromParam(S,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(l),validateNumberToBeAtLeast(this.maxColumns,"maxColumns",1),privatePool.set(this,{licenseKeyValidityState:checkLicenseKeyValidity(this.licenseKey)}),configCheckIfParametersNotInConflict({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),configCheckIfParametersNotInConflict({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}return _createClass$I(e,[{key:"setupCurrencySymbol",value:function(e){var t=_toConsumableArray$3(configValueFromParamCheck(e,Array.isArray,"array","currencySymbol"));return t.forEach((function(e){if("string"!=typeof e)throw new ExpectedValueOfTypeError("string[]","currencySymbol");if(""===e)throw new ConfigValueEmpty("currencySymbol")})),t}},{key:"licenseKeyValidityState",get:function(){return privatePool.get(this).licenseKeyValidityState}},{key:"getConfig",value:function(){return getFullConfigFromPartial(this)}},{key:"mergeConfig",value:function(t){var n=Object.assign({},this.getConfig(),t);return e.warnDeprecatedOptions(t),new e(n,!1)}}],[{key:"warnDeprecatedOptions",value:function(t){e.warnDeprecatedIfUsed(t.binarySearchThreshold,"binarySearchThreshold","1.1")}},{key:"warnDeprecatedIfUsed",value:function(e,t,n,r){void 0!==e&&(void 0===r?console.warn("".concat(t," option is deprecated since ").concat(n)):console.warn("".concat(t," option is deprecated since ").concat(n,", please use ").concat(r)))}}]),e}();function getFullConfigFromPartial(e){var t,n={};for(var r in Config.defaultConfig){var a=null!==(t=e[r])&&void 0!==t?t:Config.defaultConfig[r];Array.isArray(a)?n[r]=_toConsumableArray$3(a):n[r]=a}return n}function getDefaultConfig(){return getFullConfigFromPartial({})}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */Config.defaultConfig={accentSensitive:!1,binarySearchThreshold:20,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",chooseAddressMappingPolicy:new AlwaysDense,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:defaultParseToDateTime,precisionEpsilon:1e-13,precisionRounding:14,smartRounding:!0,stringifyDateTime:defaultStringifyDateTime,stringifyDuration:defaultStringifyDuration,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1};var dictionary={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}};function _typeof$G(e){return _typeof$G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$G(e)}function _toConsumableArray$2(e){return _arrayWithoutHoles$2(e)||_iterableToArray$2(e)||_unsupportedIterableToArray$b(e)||_nonIterableSpread$2()}function _nonIterableSpread$2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$2(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$2(e){if(Array.isArray(e))return _arrayLikeToArray$b(e)}function _createForOfIteratorHelper$9(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$b(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$b(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$b(e,t):void 0}}function _arrayLikeToArray$b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$H(e,t,n){return t&&_defineProperties$H(e.prototype,t),n&&_defineProperties$H(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$G(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$G(e,t)}function _setPrototypeOf$G(e,t){return _setPrototypeOf$G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$G(e,t)}function _createSuper$G(e){var t=_isNativeReflectConstruct$G();return function(){var n,r=_getPrototypeOf$G(e);if(t){var a=_getPrototypeOf$G(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$G(this,n)}}function _possibleConstructorReturn$G(e,t){if(t&&("object"===_typeof$G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$G(e)}function _assertThisInitialized$G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$G(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$G(e){return _getPrototypeOf$G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$G(e)}var ArrayPlugin=function(e){_inherits$G(n,e);var t=_createSuper$G(n);function n(){return _classCallCheck$H(this,n),t.apply(this,arguments)}return _createClass$H(n,[{key:"arrayformula",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),(function(e){return e}))}},{key:"arrayformulaArraySize",value:function(e,t){var n=this;if(1!==e.args.length)return ArraySize.error();var r=this.metadata("ARRAYFORMULA"),a=e.args.map((function(e){var a;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))}));return a[0]}},{key:"arrayconstrain",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),(function(e,t,n){t=Math.min(t,e.height()),n=Math.min(n,e.width());for(var r=e.data,a=[],i=0;i<t;i++)a.push(r[i].slice(0,n));return SimpleRangeValue.onlyValues(a)}))}},{key:"arrayconstrainArraySize",value:function(e,t){var n=this;if(3!==e.args.length)return ArraySize.error();var r=this.metadata("ARRAY_CONSTRAIN"),a=e.args.map((function(e){var a;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))})),i=a[0],o=i.height,s=i.width;return e.args[1].type===AstNodeType.NUMBER&&(o=Math.min(o,e.args[1].value)),e.args[2].type===AstNodeType.NUMBER&&(s=Math.min(s,e.args[2].value)),o<1||s<1||!Number.isInteger(o)||!Number.isInteger(s)?ArraySize.error():new ArraySize(s,o)}},{key:"filter",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if(e.width()!==o.width()||e.height()!==o.height())return new CellError(ErrorType.NA,ErrorMessage.EqualLength)}if(e.width()>1&&e.height()>1)return new CellError(ErrorType.NA,ErrorMessage.WrongDimension);for(var s=e.data,l=[],u=0;u<e.height();u++){for(var c=[],p=0;p<e.width();p++){var d,m=!0,f=_createForOfIteratorHelper$9(n);try{for(f.s();!(d=f.n()).done;){var h=d.value,y=coerceScalarToBoolean(h.data[u][p]);if(!0!==y){m=!1;break}}}catch(e){f.e(e)}finally{f.f()}m&&c.push(s[u][p])}c.length>0&&l.push(c)}return l.length>0?SimpleRangeValue.onlyValues(l):new CellError(ErrorType.NA,ErrorMessage.EmptyRange)}))}},{key:"filterArraySize",value:function(e,t){var n=this;if(e.args.length<=1)return ArraySize.error();var r=this.metadata("FILTER"),a=e.args.map((function(e){var a;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))})),i=Math.max.apply(Math,_toConsumableArray$2(a.map((function(e){return e.width})))),o=Math.max.apply(Math,_toConsumableArray$2(a.map((function(e){return e.height}))));return new ArraySize(i,o)}}]),n}(FunctionPlugin);function _typeof$F(e){return _typeof$F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$F(e)}function _classCallCheck$G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$G(e,t,n){return t&&_defineProperties$G(e.prototype,t),n&&_defineProperties$G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$F(e,t)}function _setPrototypeOf$F(e,t){return _setPrototypeOf$F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$F(e,t)}function _createSuper$F(e){var t=_isNativeReflectConstruct$F();return function(){var n,r=_getPrototypeOf$F(e);if(t){var a=_getPrototypeOf$F(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$F(this,n)}}function _possibleConstructorReturn$F(e,t){if(t&&("object"===_typeof$F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$F(e)}function _assertThisInitialized$F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$F(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$F(e){return _getPrototypeOf$F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$F(e)}ArrayPlugin.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",arraySizeMethod:"arrayformulaArraySize",arrayFunction:!0,parameters:[{argumentType:ArgumentTypes.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",arraySizeMethod:"arrayconstrainArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",arraySizeMethod:"filterArraySize",arrayFunction:!0,parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}],repeatLastArgs:1}};var AbsPlugin=function(e){_inherits$F(n,e);var t=_createSuper$F(n);function n(){return _classCallCheck$G(this,n),t.apply(this,arguments)}return _createClass$G(n,[{key:"abs",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}]),n}(FunctionPlugin);function _typeof$E(e){return _typeof$E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$E(e)}function _classCallCheck$F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$F(e,t,n){return t&&_defineProperties$F(e.prototype,t),n&&_defineProperties$F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$E(e,t)}function _setPrototypeOf$E(e,t){return _setPrototypeOf$E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$E(e,t)}function _createSuper$E(e){var t=_isNativeReflectConstruct$E();return function(){var n,r=_getPrototypeOf$E(e);if(t){var a=_getPrototypeOf$E(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$E(this,n)}}function _possibleConstructorReturn$E(e,t){if(t&&("object"===_typeof$E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$E(e)}function _assertThisInitialized$E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$E(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$E(e){return _getPrototypeOf$E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$E(e)}AbsPlugin.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var MAX_48BIT_INTEGER=0xffffffffffff,SHIFT_MIN_POSITIONS=-53,SHIFT_MAX_POSITIONS=53,BitShiftPlugin=function(e){_inherits$E(n,e);var t=_createSuper$E(n);function n(){return _classCallCheck$F(this,n),t.apply(this,arguments)}return _createClass$F(n,[{key:"bitlshift",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),shiftLeft)}},{key:"bitrshift",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),shiftRight)}}]),n}(FunctionPlugin);function shiftLeft(e,t){return t<0?shiftRight(e,-t):validate(e*Math.pow(2,t))}function shiftRight(e,t){return t<0?shiftLeft(e,-t):validate(Math.floor(e/Math.pow(2,t)))}function validate(e){return e>MAX_48BIT_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.BitshiftLong):e}function _typeof$D(e){return _typeof$D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$D(e)}function _classCallCheck$E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$E(e,t,n){return t&&_defineProperties$E(e.prototype,t),n&&_defineProperties$E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$D(e,t)}function _setPrototypeOf$D(e,t){return _setPrototypeOf$D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$D(e,t)}function _createSuper$D(e){var t=_isNativeReflectConstruct$D();return function(){var n,r=_getPrototypeOf$D(e);if(t){var a=_getPrototypeOf$D(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$D(this,n)}}function _possibleConstructorReturn$D(e,t){if(t&&("object"===_typeof$D(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$D(e)}function _assertThisInitialized$D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$D(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$D(e){return _getPrototypeOf$D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$D(e)}BitShiftPlugin.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:SHIFT_MIN_POSITIONS,maxValue:SHIFT_MAX_POSITIONS}]}};var BitwiseLogicOperationsPlugin=function(e){_inherits$D(n,e);var t=_createSuper$D(n);function n(){return _classCallCheck$E(this,n),t.apply(this,arguments)}return _createClass$E(n,[{key:"bitand",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),(function(e,t){return e&t}))}},{key:"bitor",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),(function(e,t){return e|t}))}},{key:"bitxor",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),(function(e,t){return e^t}))}}]),n}(FunctionPlugin);function _typeof$C(e){return _typeof$C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$C(e)}function _classCallCheck$D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$D(e,t,n){return t&&_defineProperties$D(e.prototype,t),n&&_defineProperties$D(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$C(e,t)}function _setPrototypeOf$C(e,t){return _setPrototypeOf$C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$C(e,t)}function _createSuper$C(e){var t=_isNativeReflectConstruct$C();return function(){var n,r=_getPrototypeOf$C(e);if(t){var a=_getPrototypeOf$C(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$C(this,n)}}function _possibleConstructorReturn$C(e,t){if(t&&("object"===_typeof$C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$C(e)}function _assertThisInitialized$C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$C(e){return _getPrototypeOf$C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$C(e)}BitwiseLogicOperationsPlugin.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0}]}};var BooleanPlugin=function(e){_inherits$C(n,e);var t=_createSuper$C(n);function n(){return _classCallCheck$D(this,n),t.apply(this,arguments)}return _createClass$D(n,[{key:"literalTrue",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),(function(){return!0}))}},{key:"literalFalse",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),(function(){return!1}))}},{key:"conditionalIf",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IF"),(function(e,t,n){return e?t:n}))}},{key:"and",value:function(e,t){return this.runFunction(e.args,t,this.metadata("AND"),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!e}))}))}},{key:"or",value:function(e,t){return this.runFunction(e.args,t,this.metadata("OR"),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((function(e){return e}))}))}},{key:"not",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),(function(e){return!e}))}},{key:"xor",value:function(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),(function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){t&&e++})),e%2==1}))}},{key:"switch",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SWITCH"),(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var i=r.length,o=0;o+1<i;o+=2)if(!(r[o]instanceof CellError)&&n.arithmeticHelper.eq(e,r[o]))return r[o+1];return o<i?r[o]:new CellError(ErrorType.NA,ErrorMessage.NoDefault)}))}},{key:"iferror",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),(function(e,t){return e instanceof CellError?t:e}))}},{key:"ifna",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),(function(e,t){return e instanceof CellError&&e.type===ErrorType.NA?t:e}))}},{key:"choose",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),(function(e){return e>(arguments.length<=1?0:arguments.length-1)?new CellError(ErrorType.NUM,ErrorMessage.Selector):e-1+1<1||arguments.length<=e-1+1?void 0:arguments[e-1+1]}))}}]),n}(FunctionPlugin);BooleanPlugin.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:ArgumentTypes.BOOLEAN},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,defaultValue:!1,passSubtype:!0}]},AND:{method:"and",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:ArgumentTypes.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:ArgumentTypes.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:ArgumentTypes.SCALAR,passSubtype:!0},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.SCALAR,passSubtype:!0}],repeatLastArgs:1}};var $$b=_export,ceil=Math.ceil,floor=Math.floor;$$b({target:"Math",stat:!0},{trunc:function(e){return(e>0?floor:ceil)(e)}});var $$a=_export,global$1=global$U,uncurryThis=functionUncurryThis,toAbsoluteIndex=toAbsoluteIndex$6,RangeError$1=global$1.RangeError,fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint,join=uncurryThis([].join),INCORRECT_LENGTH=!!$fromCodePoint&&1!=$fromCodePoint.length;function _typeof$B(e){return _typeof$B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$B(e)}function _classCallCheck$C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$C(e,t,n){return t&&_defineProperties$C(e.prototype,t),n&&_defineProperties$C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$B(e,t)}function _setPrototypeOf$B(e,t){return _setPrototypeOf$B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$B(e,t)}function _createSuper$B(e){var t=_isNativeReflectConstruct$B();return function(){var n,r=_getPrototypeOf$B(e);if(t){var a=_getPrototypeOf$B(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$B(this,n)}}function _possibleConstructorReturn$B(e,t){if(t&&("object"===_typeof$B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$B(e)}function _assertThisInitialized$B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$B(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$B(e){return _getPrototypeOf$B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$B(e)}$$a({target:"String",stat:!0,forced:INCORRECT_LENGTH},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],toAbsoluteIndex(t,1114111)!==t)throw RangeError$1(t+" is not a valid code point");n[a]=t<65536?fromCharCode(t):fromCharCode(55296+((t-=65536)>>10),t%1024+56320)}return join(n,"")}});var CharPlugin=function(e){_inherits$B(n,e);var t=_createSuper$B(n);function n(){return _classCallCheck$C(this,n),t.apply(this,arguments)}return _createClass$C(n,[{key:"char",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),(function(e){return e<1||e>=256?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCharCode(Math.trunc(e))}))}},{key:"unichar",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),(function(e){return e<1||e>=1114112?new CellError(ErrorType.VALUE,ErrorMessage.CharacterCodeBounds):String.fromCodePoint(Math.trunc(e))}))}}]),n}(FunctionPlugin);function _typeof$A(e){return _typeof$A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$A(e)}function _classCallCheck$B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$B(e,t,n){return t&&_defineProperties$B(e.prototype,t),n&&_defineProperties$B(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$A(e,t)}function _setPrototypeOf$A(e,t){return _setPrototypeOf$A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$A(e,t)}function _createSuper$A(e){var t=_isNativeReflectConstruct$A();return function(){var n,r=_getPrototypeOf$A(e);if(t){var a=_getPrototypeOf$A(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$A(this,n)}}function _possibleConstructorReturn$A(e,t){if(t&&("object"===_typeof$A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$A(e)}function _assertThisInitialized$A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$A(e){return _getPrototypeOf$A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$A(e)}CharPlugin.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:ArgumentTypes.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var CodePlugin=function(e){_inherits$A(n,e);var t=_createSuper$A(n);function n(){return _classCallCheck$B(this,n),t.apply(this,arguments)}return _createClass$B(n,[{key:"code",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),(function(e){return 0===e.length?new CellError(ErrorType.VALUE,ErrorMessage.EmptyString):e.charCodeAt(0)}))}},{key:"unicode",value:function(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),(function(e){var t;return null!==(t=e.codePointAt(0))&&void 0!==t?t:new CellError(ErrorType.VALUE,ErrorMessage.EmptyString)}))}}]),n}(FunctionPlugin);function _typeof$z(e){return _typeof$z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$z(e)}function _classCallCheck$A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$A(e,t,n){return t&&_defineProperties$A(e.prototype,t),n&&_defineProperties$A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$z(e,t)}function _setPrototypeOf$z(e,t){return _setPrototypeOf$z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$z(e,t)}function _createSuper$z(e){var t=_isNativeReflectConstruct$z();return function(){var n,r=_getPrototypeOf$z(e);if(t){var a=_getPrototypeOf$z(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$z(this,n)}}function _possibleConstructorReturn$z(e,t){if(t&&("object"===_typeof$z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$z(e)}function _assertThisInitialized$z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$z(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$z(e){return _getPrototypeOf$z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$z(e)}CodePlugin.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:ArgumentTypes.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:ArgumentTypes.STRING}]}};var CountBlankPlugin=function(e){_inherits$z(n,e);var t=_createSuper$z(n);function n(){return _classCallCheck$A(this,n),t.apply(this,arguments)}return _createClass$A(n,[{key:"countblank",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),(function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){t===EmptyValue&&e++})),e}))}}]),n}(FunctionPlugin);function _typeof$y(e){return _typeof$y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$y(e)}function _classCallCheck$z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$z(e,t,n){return t&&_defineProperties$z(e.prototype,t),n&&_defineProperties$z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$y(e,t)}function _setPrototypeOf$y(e,t){return _setPrototypeOf$y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$y(e,t)}function _createSuper$y(e){var t=_isNativeReflectConstruct$y();return function(){var n,r=_getPrototypeOf$y(e);if(t){var a=_getPrototypeOf$y(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$y(this,n)}}function _possibleConstructorReturn$y(e,t){if(t&&("object"===_typeof$y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$y(e)}function _assertThisInitialized$y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$y(e){return _getPrototypeOf$y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$y(e)}CountBlankPlugin.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}};var CountUniquePlugin=function(e){_inherits$y(n,e);var t=_createSuper$y(n);function n(){return _classCallCheck$z(this,n),t.apply(this,arguments)}return _createClass$z(n,[{key:"countunique",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),(function(){for(var e=new Set,t=new Set,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];s instanceof CellError?t.add(s.type):""!==s&&e.add(s)}return e.size+t.size}))}}]),n}(FunctionPlugin);function _typeof$x(e){return _typeof$x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$x(e)}function _toConsumableArray$1(e){return _arrayWithoutHoles$1(e)||_iterableToArray$1(e)||_unsupportedIterableToArray$a(e)||_nonIterableSpread$1()}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$1(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles$1(e){if(Array.isArray(e))return _arrayLikeToArray$a(e)}function _createForOfIteratorHelper$8(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray$3(e,t){return _arrayWithHoles$3(e)||_iterableToArrayLimit$3(e,t)||_unsupportedIterableToArray$a(e,t)||_nonIterableRest$3()}function _nonIterableRest$3(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$a(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$a(e,t):void 0}}function _arrayLikeToArray$a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$3(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$3(e){if(Array.isArray(e))return e}function _classCallCheck$y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$y(e,t,n){return t&&_defineProperties$y(e.prototype,t),n&&_defineProperties$y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$x(e,t)}function _setPrototypeOf$x(e,t){return _setPrototypeOf$x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$x(e,t)}function _createSuper$x(e){var t=_isNativeReflectConstruct$x();return function(){var n,r=_getPrototypeOf$x(e);if(t){var a=_getPrototypeOf$x(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$x(this,n)}}function _possibleConstructorReturn$x(e,t){if(t&&("object"===_typeof$x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$x(e)}function _assertThisInitialized$x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$x(e){return _getPrototypeOf$x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$x(e)}CountUniquePlugin.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:ArgumentTypes.SCALAR}],repeatLastArgs:1,expandRanges:!0}};var DateTimePlugin=function(e){_inherits$x(n,e);var t=_createSuper$x(n);function n(){var e;return _classCallCheck$y(this,n),(e=t.apply(this,arguments)).isoweeknumCore=function(t){var n=Math.floor(e.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),r=e.dateTimeHelper.numberToSimpleDate(t),a=e.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),i=e.dateTimeHelper.relativeNumberToAbsoluteNumber(a),o=i+((4-i)%7+7)%7,s=Math.floor((n-1)/7)-Math.floor((o-1)/7)+1;return 0===s?e.isoweeknumCore(t-7)+1:s},e.days360Core=function(t,n,r){var a,i,o=e.dateTimeHelper.numberToSimpleDate(t),s=e.dateTimeHelper.numberToSimpleDate(n);if(r)a=toBasisEU(o),i=toBasisEU(s);else{var l=_slicedToArray$3(e.dateTimeHelper.toBasisUS(o,s),2);a=l[0],i=l[1]}return 360*(i.year-a.year)+30*(i.month-a.month)+i.day-a.day},e}return _createClass$y(n,[{key:"date",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("DATE"),(function(e,t,r){var a=Math.trunc(r),i=Math.trunc(t),o=Math.trunc(e);o<n.dateTimeHelper.getEpochYearZero()&&(o+=n.dateTimeHelper.getEpochYearZero());var s=Math.floor((i-1)/12),l={year:o+=s,month:i-=12*s,day:1};if(n.dateTimeHelper.isValidDate(l)){var u=n.dateTimeHelper.dateToNumber(l)+(a-1);return void 0===(u=n.dateTimeHelper.getWithinBounds(u))?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):u}return new CellError(ErrorType.VALUE,ErrorMessage.InvalidDate)}))}},{key:"time",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),(function(e,t,n){var r=timeToNumber({hours:Math.trunc(e),minutes:Math.trunc(t),seconds:Math.trunc(n)});return r<0?new CellError(ErrorType.NUM,ErrorMessage.NegativeTime):r%1}))}},{key:"eomonth",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("EOMONTH"),(function(e,t){var r=n.dateTimeHelper.numberToSimpleDate(e),a=n.dateTimeHelper.dateToNumber(n.dateTimeHelper.endOfMonth(offsetMonth(r,t)));return void 0===(a=n.dateTimeHelper.getWithinBounds(a))?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):a}))}},{key:"day",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("DAY"),(function(e){return n.dateTimeHelper.numberToSimpleDate(e).day}))}},{key:"days",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),(function(e,t){return Math.trunc(e)-Math.trunc(t)}))}},{key:"month",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MONTH"),(function(e){return n.dateTimeHelper.numberToSimpleDate(e).month}))}},{key:"year",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("YEAR"),(function(e){return n.dateTimeHelper.numberToSimpleDate(e).year}))}},{key:"hour",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),(function(e){return numberToSimpleTime(roundToNearestSecond(e)%1).hours}))}},{key:"minute",value:function(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),(function(e){return numberToSimpleTime(roundToNearestSecond(e)%1).minutes}))}},{key:"second",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),(function(e){return numberToSimpleTime(roundToNearestSecond(e)%1).seconds}))}},{key:"text",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TEXT"),(function(e,t){return format(e,t,n.config,n.dateTimeHelper)}))}},{key:"weekday",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("WEEKDAY"),(function(e,t){var r=Math.floor(n.dateTimeHelper.relativeNumberToAbsoluteNumber(e));if(3===t)return(r-1)%7;var a=weekdayOffsets.get(t);return void 0===a?new CellError(ErrorType.NUM,ErrorMessage.BadMode):(r-a)%7+1}))}},{key:"weeknum",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("WEEKNUM"),(function(e,t){var r=Math.floor(n.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),a=n.dateTimeHelper.numberToSimpleDate(e),i=n.dateTimeHelper.dateToNumber({year:a.year,month:1,day:1}),o=n.dateTimeHelper.relativeNumberToAbsoluteNumber(i);if(21===t)return n.isoweeknumCore(e);var s=weekdayOffsets.get(t);return void 0===s?new CellError(ErrorType.NUM,ErrorMessage.BadMode):Math.floor((r-s)/7)-Math.floor((o-s)/7)+1}))}},{key:"isoweeknum",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}},{key:"datevalue",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("DATEVALUE"),(function(e){var t=n.dateTimeHelper.parseDateTimeFromConfigFormats(e).dateTime;return void 0===t?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):instanceOfSimpleDate(t)?(instanceOfSimpleTime(t)?Math.trunc(timeToNumber(t)):0)+n.dateTimeHelper.dateToNumber(t):0}))}},{key:"timevalue",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),(function(e){var t=n.dateTimeHelper.dateStringToDateNumber(e);return void 0===t?new CellError(ErrorType.VALUE,ErrorMessage.IncorrectDateTime):getRawValue(t)%1}))}},{key:"now",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("NOW"),(function(){var e=new Date(Date.now());return timeToNumber({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()})+n.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})}))}},{key:"today",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TODAY"),(function(){var e=new Date(Date.now());return n.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})}))}},{key:"edate",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("EDATE"),(function(e,t){var r=truncateDayInMonth(offsetMonth(n.dateTimeHelper.numberToSimpleDate(e),t)),a=n.dateTimeHelper.dateToNumber(r);return void 0===(a=n.dateTimeHelper.getWithinBounds(a))?new CellError(ErrorType.NUM,ErrorMessage.DateBounds):a}))}},{key:"datedif",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("DATEDIF"),(function(e,t,r){if(e>t)return new CellError(ErrorType.NUM,ErrorMessage.StartEndDate);if("D"===r)return Math.floor(t)-Math.floor(e);var a=n.dateTimeHelper.numberToSimpleDate(e),i=n.dateTimeHelper.numberToSimpleDate(t);switch(r){case"M":return 12*(i.year-a.year)+(i.month-a.month)-(i.day<a.day?1:0);case"YM":return(i.month-a.month+12-(i.day<a.day?1:0))%12;case"Y":return i.month>a.month||i.month===a.month&&i.day>=a.day?i.year-a.year:i.year-a.year-1;case"MD":if(i.day>=a.day)return i.day-a.day;var o=1===i.month?12:i.month-1,s=1===i.month?i.year-1:i.year;return n.dateTimeHelper.daysInMonth(s,o)+i.day-a.day;case"YD":return i.month>a.month||i.month===a.month&&i.day>=a.day?Math.floor(t)-n.dateTimeHelper.dateToNumber({year:i.year,month:a.month,day:a.day}):Math.floor(t)-Math.floor(e)-365*(i.year-a.year-1)-n.dateTimeHelper.leapYearsCount(i.year-1)+n.dateTimeHelper.leapYearsCount(a.year);default:return new CellError(ErrorType.NUM,ErrorMessage.BadMode)}}))}},{key:"days360",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}},{key:"yearfrac",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("YEARFRAC"),(function(e,t,r){if((e=Math.trunc(e))>(t=Math.trunc(t))){var a=[t,e];e=a[0],t=a[1]}switch(r){case 0:return n.days360Core(e,t,!1)/360;case 1:return(t-e)/n.dateTimeHelper.yearLengthForBasis(n.dateTimeHelper.numberToSimpleDate(e),n.dateTimeHelper.numberToSimpleDate(t));case 2:return(t-e)/360;case 3:return(t-e)/365;case 4:return n.days360Core(e,t,!0)/360}throw new Error("Should not be reachable.")}))}},{key:"interval",value:function(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),(function(e){var t=(e=Math.trunc(e))%60,n=(e=Math.trunc(e/60))%60,r=(e=Math.trunc(e/60))%24,a=(e=Math.trunc(e/24))%30,i=(e=Math.trunc(e/30))%12,o=Math.trunc(e/12);return"P"+(o>0?o+"Y":"")+(i>0?i+"M":"")+(a>0?a+"D":"")+"T"+(r>0?r+"H":"")+(n>0?n+"M":"")+(t>0?t+"S":"")}))}},{key:"networkdays",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),(function(e,t,r){return n.networkdayscore(e,t,1,r)}))}},{key:"networkdaysintl",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),(function(e,t,r,a){return n.networkdayscore(e,t,r,a)}))}},{key:"workday",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("WORKDAY"),(function(e,t,r){return n.workdaycore(e,t,1,r)}))}},{key:"workdayintl",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),(function(e,t,r,a){return n.workdaycore(e,t,r,a)}))}},{key:"networkdayscore",value:function(e,t,n,r){var a=1;if((e=Math.trunc(e))>(t=Math.trunc(t))){var i=[t,e];e=i[0],t=i[1],a=-1}var o=computeWeekendPattern(n);if(o instanceof CellError)return o;var s=this.simpleRangeToFilteredHolidays(o,r);return s instanceof CellError?s:a*this.countWorkdays(e,t,o,s)}},{key:"workdaycore",value:function(e,t,n,r){e=Math.trunc(e),t=Math.trunc(t);var a=computeWeekendPattern(n);if(a instanceof CellError)return a;var i=this.simpleRangeToFilteredHolidays(a,r);if(i instanceof CellError)return i;if(t>0){for(var o=1;this.countWorkdays(e+1,e+o,a,i)<t;)o*=2;for(var s=1;s+1<o;){var l=Math.trunc((s+o)/2);this.countWorkdays(e+1,e+l,a,i)<t?s=l:o=l}return e+o}if(t<0){t*=-1;for(var u=1;this.countWorkdays(e-u,e-1,a,i)<t;)u*=2;for(var c=1;c+1<u;){var p=Math.trunc((c+u)/2);this.countWorkdays(e-p,e-1,a,i)<t?c=p:u=p}return e-u}return e}},{key:"countWorkdays",value:function(e,t,n,r){for(var a=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),i=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),o=0,s=0;s<7;s++)"0"===n.charAt(s)&&(o+=Math.floor((a+6-s)/7),o-=Math.floor((i-1+6-s)/7));return o-=lowerBound(t+1,r)-lowerBound(e,r)}},{key:"simpleRangeToFilteredHolidays",value:function(e,t){var n,r,a=this,i=null!==(n=null==t?void 0:t.valuesFromTopLeftCorner())&&void 0!==n?n:[],o=_createForOfIteratorHelper$8(i);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s instanceof CellError)return s}}catch(e){o.e(e)}finally{o.f()}var l,u=[],c=_createForOfIteratorHelper$8(i);try{for(c.s();!(l=c.n()).done;){var p=l.value;if(p!==EmptyValue){if(!isExtendedNumber(p))return new CellError(ErrorType.VALUE,ErrorMessage.WrongType);u.push(Math.trunc(getRawValue(p)))}}}catch(e){c.e(e)}finally{c.f()}return _toConsumableArray$1(new Set(u)).sort((function(e,t){return e-t})).filter((function(t){var n=(a.dateTimeHelper.relativeNumberToAbsoluteNumber(t)-1)%7;return"0"===e.charAt(n)}))}}]),n}(FunctionPlugin);function lowerBound(e,t){if(0===t.length)return 0;if(e<=t[0])return 0;if(t[t.length-1]<e)return t.length;for(var n=0,r=t.length-1;n+1<r;){var a=Math.floor((r+n)/2);t[a]>=e?r=a:n=a}return r}function computeWeekendPattern(e){var t;return"number"!=typeof e&&"string"!=typeof e?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):"string"==typeof e?7===e.length&&/^(0|1)*$/.test(e)&&"1111111"!==e?e:new CellError(ErrorType.NUM,ErrorMessage.WeekendString):null!==(t=workdayPatterns.get(e))&&void 0!==t?t:new CellError(ErrorType.NUM,ErrorMessage.BadMode)}DateTimePlugin.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:ArgumentTypes.STRING}],returnNumberType:NumberType.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:ArgumentTypes.STRING}],returnNumberType:NumberType.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:NumberType.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NOERROR,defaultValue:1},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NOERROR,defaultValue:1},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]}};var weekdayOffsets=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),workdayPatterns=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]]);function _typeof$w(e){return _typeof$w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$w(e)}function _classCallCheck$x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$x(e,t,n){return t&&_defineProperties$x(e.prototype,t),n&&_defineProperties$x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$w(e,t)}function _setPrototypeOf$w(e,t){return _setPrototypeOf$w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$w(e,t)}function _createSuper$w(e){var t=_isNativeReflectConstruct$w();return function(){var n,r=_getPrototypeOf$w(e);if(t){var a=_getPrototypeOf$w(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$w(this,n)}}function _possibleConstructorReturn$w(e,t){if(t&&("object"===_typeof$w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$w(e)}function _assertThisInitialized$w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$w(e){return _getPrototypeOf$w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$w(e)}var DegreesPlugin=function(e){_inherits$w(n,e);var t=_createSuper$w(n);function n(){return _classCallCheck$x(this,n),t.apply(this,arguments)}return _createClass$x(n,[{key:"degrees",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),(function(e){return e*(180/Math.PI)}))}}]),n}(FunctionPlugin);function _typeof$v(e){return _typeof$v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$v(e)}function _classCallCheck$w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$w(e,t,n){return t&&_defineProperties$w(e.prototype,t),n&&_defineProperties$w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$v(e,t)}function _setPrototypeOf$v(e,t){return _setPrototypeOf$v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$v(e,t)}function _createSuper$v(e){var t=_isNativeReflectConstruct$v();return function(){var n,r=_getPrototypeOf$v(e);if(t){var a=_getPrototypeOf$v(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$v(this,n)}}function _possibleConstructorReturn$v(e,t){if(t&&("object"===_typeof$v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$v(e)}function _assertThisInitialized$v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$v(e){return _getPrototypeOf$v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$v(e)}DegreesPlugin.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var DeltaPlugin=function(e){_inherits$v(n,e);var t=_createSuper$v(n);function n(){return _classCallCheck$w(this,n),t.apply(this,arguments)}return _createClass$w(n,[{key:"delta",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),(function(e,t){return e===t?1:0}))}}]),n}(FunctionPlugin);function _typeof$u(e){return _typeof$u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$u(e)}function _classCallCheck$v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$v(e,t,n){return t&&_defineProperties$v(e.prototype,t),n&&_defineProperties$v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$u(e,t)}function _setPrototypeOf$u(e,t){return _setPrototypeOf$u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$u(e,t)}function _createSuper$u(e){var t=_isNativeReflectConstruct$u();return function(){var n,r=_getPrototypeOf$u(e);if(t){var a=_getPrototypeOf$u(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$u(this,n)}}function _possibleConstructorReturn$u(e,t){if(t&&("object"===_typeof$u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$u(e)}function _assertThisInitialized$u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$u(e){return _getPrototypeOf$u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$u(e)}DeltaPlugin.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]}};var ExpPlugin=function(e){_inherits$u(n,e);var t=_createSuper$u(n);function n(){return _classCallCheck$v(this,n),t.apply(this,arguments)}return _createClass$v(n,[{key:"exp",value:function(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}]),n}(FunctionPlugin);function _typeof$t(e){return _typeof$t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$t(e)}function _createForOfIteratorHelper$7(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$9(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$9(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$9(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$9(e,t):void 0}}function _arrayLikeToArray$9(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$u(e,t,n){return t&&_defineProperties$u(e.prototype,t),n&&_defineProperties$u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$t(e,t)}function _setPrototypeOf$t(e,t){return _setPrototypeOf$t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$t(e,t)}function _createSuper$t(e){var t=_isNativeReflectConstruct$t();return function(){var n,r=_getPrototypeOf$t(e);if(t){var a=_getPrototypeOf$t(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$t(this,n)}}function _possibleConstructorReturn$t(e,t){if(t&&("object"===_typeof$t(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$t(e)}function _assertThisInitialized$t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$t(e){return _getPrototypeOf$t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$t(e)}ExpPlugin.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var FinancialPlugin=function(e){_inherits$t(n,e);var t=_createSuper$t(n);function n(){return _classCallCheck$u(this,n),t.apply(this,arguments)}return _createClass$u(n,[{key:"pmt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),pmtCore)}},{key:"ipmt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),ipmtCore)}},{key:"ppmt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),ppmtCore)}},{key:"fv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FV"),fvCore)}},{key:"cumipmt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),(function(e,t,n,r,a,i){if(r>a)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);for(var o=0,s=r;s<=a;s++)o+=ipmtCore(e,s,t,n,0,i);return o}))}},{key:"cumprinc",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),(function(e,t,n,r,a,i){if(r>a)return new CellError(ErrorType.NUM,ErrorMessage.EndStartPeriod);for(var o=0,s=r;s<=a;s++)o+=ppmtCore(e,s,t,n,0,i);return o}))}},{key:"db",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DB"),(function(e,t,n,r,a){if(12===a&&r>n||r>n+1)return new CellError(ErrorType.NUM,ErrorMessage.PeriodLong);if(t>=e)return 0;var i=Math.round(1e3*(1-Math.pow(t/e,1/n)))/1e3,o=e*i*a/12;if(1===r)return o;for(var s=o,l=0;l<r-2;l++)s+=(e-s)*i;return r===n+1?(e-s)*i*(12-a)/12:(e-s)*i}))}},{key:"ddb",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),(function(e,t,n,r,a){if(r>n)return new CellError(ErrorType.NUM);var i,o=a/n;o>=1?(o=1,i=1===r?e:0):i=e*Math.pow(1-o,r-1);var s=e*Math.pow(1-o,r);return Math.max(i-Math.max(t,s),0)}))}},{key:"dollarde",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),(function(e,t){if(t<1)return new CellError(ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+10*(e-Math.trunc(e))/t}))}},{key:"dollarfr",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),(function(e,t){if(t<1)return new CellError(ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+(e-Math.trunc(e))*t/10}))}},{key:"effect",value:function(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),(function(e,t){return t=Math.trunc(t),Math.pow(1+e/t,t)-1}))}},{key:"ispmt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),(function(e,t,n,r){return 0===n?new CellError(ErrorType.DIV_BY_ZERO):r*e*(t/n-1)}))}},{key:"nominal",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),(function(e,t){return t=Math.trunc(t),(Math.pow(e+1,1/t)-1)*t}))}},{key:"nper",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),(function(e,t,n,r,a){return 0===e?0===t?new CellError(ErrorType.DIV_BY_ZERO):(-n-r)/t:(a&&(t*=1+e),Math.log((t-r*e)/(n*e+t))/Math.log(1+e))}))}},{key:"rate",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),(function(e,t,n,r,a,i){if(i<=-1)return new CellError(ErrorType.VALUE);var o=1e-7,s=i;a=a?1:0;for(var l=0;l<50;l++){if(s<=-1)return new CellError(ErrorType.NUM);var u=void 0;if(Math.abs(s)<o)u=n*(1+e*s)+t*(1+s*a)*e+r;else{var c=Math.pow(1+s,e);u=n*c+t*(1/s+a)*(c-1)+r}if(Math.abs(u)<o)return s;var p=void 0;if(Math.abs(s)<o)p=n*e+t*a*e;else{var d=Math.pow(1+s,e),m=e*Math.pow(1+s,e-1);p=n*m+t*(1/s+a)*m+t*(-1/(s*s))*(d-1)}s-=u/p}return new CellError(ErrorType.NUM)}))}},{key:"pv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PV"),(function(e,t,n,r,a){return a=a?1:0,-1===e?new CellError(0===t?ErrorType.NUM:ErrorType.DIV_BY_ZERO):0===e?-n*t-r:((1-Math.pow(1+e,t))*n*(1+e*a)/e-r)/Math.pow(1+e,t)}))}},{key:"rri",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),(function(e,t,n){return 0===t||n<0&&t>0||n>0&&t<0?new CellError(ErrorType.NUM):Math.pow(n/t,1/e)-1}))}},{key:"sln",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),(function(e,t,n){return 0===n?new CellError(ErrorType.DIV_BY_ZERO):(e-t)/n}))}},{key:"syd",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),(function(e,t,n,r){return r>n?new CellError(ErrorType.NUM):(e-t)*(n-r+1)*2/(n*(n+1))}))}},{key:"tbilleq",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TBILLEQ"),(function(e,t,r){if((e=Math.round(e))>=(t=Math.round(t)))return new CellError(ErrorType.NUM);var a=n.dateTimeHelper.numberToSimpleDate(e),i=n.dateTimeHelper.numberToSimpleDate(t);if(i.year>a.year+1||i.year===a.year+1&&(i.month>a.month||i.month===a.month&&i.day>a.day))return new CellError(ErrorType.NUM);var o=360-r*(t-e);return 0===o?0:o<0?new CellError(ErrorType.NUM):365*r/o}))}},{key:"tbillprice",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),(function(e,t,r){if((e=Math.round(e))>=(t=Math.round(t)))return new CellError(ErrorType.NUM);var a=n.dateTimeHelper.numberToSimpleDate(e),i=n.dateTimeHelper.numberToSimpleDate(t);if(i.year>a.year+1||i.year===a.year+1&&(i.month>a.month||i.month===a.month&&i.day>a.day))return new CellError(ErrorType.NUM);var o=360-r*(t-e);return 0===o?0:o<0?new CellError(ErrorType.NUM):100*(1-r*(t-e)/360)}))}},{key:"tbillyield",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),(function(e,t,r){if((e=Math.round(e))>=(t=Math.round(t)))return new CellError(ErrorType.NUM);var a=n.dateTimeHelper.numberToSimpleDate(e),i=n.dateTimeHelper.numberToSimpleDate(t);return i.year>a.year+1||i.year===a.year+1&&(i.month>a.month||i.month===a.month&&i.day>a.day)?new CellError(ErrorType.NUM):360*(100-r)/(r*(t-e))}))}},{key:"fvschedule",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),(function(e,t){var n,r=t.valuesFromTopLeftCorner(),a=_createForOfIteratorHelper$7(r);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i instanceof CellError)return i}}catch(e){a.e(e)}finally{a.f()}var o,s=_createForOfIteratorHelper$7(r);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(isExtendedNumber(l))e*=1+getRawValue(l);else if(l!==EmptyValue)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}}catch(e){s.e(e)}finally{s.f()}return e}))}},{key:"npv",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("NPV"),(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var i=n.arithmeticHelper.coerceNumbersExactRanges(r);return i instanceof CellError?i:npvCore(e,i)}))}},{key:"mirr",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MIRR"),(function(e,t,r){var a=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(a instanceof CellError)return a;var i,o=!1,s=!1,l=[],u=[],c=_createForOfIteratorHelper$7(a);try{for(c.s();!(i=c.n()).done;){var p=i.value;p>0?(o=!0,l.push(p),u.push(0)):p<0?(s=!0,u.push(p),l.push(0)):(u.push(0),l.push(0))}}catch(e){c.e(e)}finally{c.f()}if(!o||!s)return new CellError(ErrorType.DIV_BY_ZERO);var d=a.length,m=npvCore(r,l);if(m instanceof CellError)return m;var f=npvCore(t,u);return f instanceof CellError?f:Math.pow(-m*Math.pow(1+r,d)/f/(1+t),1/(d-1))-1}))}},{key:"pduration",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),(function(e,t,n){return(Math.log(n)-Math.log(t))/Math.log(1+e)}))}},{key:"xnpv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),(function(e,t,n){var r,a=t.valuesFromTopLeftCorner(),i=_createForOfIteratorHelper$7(a);try{for(i.s();!(r=i.n()).done;){if("number"!=typeof r.value)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}}catch(e){i.e(e)}finally{i.f()}var o,s=a,l=n.valuesFromTopLeftCorner(),u=_createForOfIteratorHelper$7(l);try{for(u.s();!(o=u.n()).done;){if("number"!=typeof o.value)return new CellError(ErrorType.VALUE,ErrorMessage.NumberExpected)}}catch(e){u.e(e)}finally{u.f()}var c=l;if(c.length!==s.length)return new CellError(ErrorType.NUM,ErrorMessage.EqualLength);var p=c.length,d=0;if(c[0]<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);for(var m=0;m<p;m++){if(c[m]=Math.floor(c[m]),c[m]<c[0])return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);d+=s[m]/Math.pow(1+e,(c[m]-c[0])/365)}return d}))}}]),n}(FunctionPlugin);function pmtCore(e,t,n,r,a){if(0===e)return(-n-r)/t;var i=Math.pow(1+e,t);return(r*e+n*e*i)*(a?1/(1+e):1)/(1-i)}function ipmtCore(e,t,n,r,a,i){var o=pmtCore(e,n,r,a,i);return 1===t?e*(i?0:-r):e*(i?fvCore(e,t-2,o,r,i)-o:fvCore(e,t-1,o,r,i))}function fvCore(e,t,n,r,a){if(0===e)return-r-n*t;var i=Math.pow(1+e,t);return n*(a?1+e:1)*(1-i)/e-r*i}function ppmtCore(e,t,n,r,a,i){return pmtCore(e,n,r,a,i)-ipmtCore(e,t,n,r,a,i)}function npvCore(e,t){for(var n=0,r=t.length-1;r>=0;r--){if(n+=t[r],-1===e){if(0===n)continue;return new CellError(ErrorType.DIV_BY_ZERO)}n/=1+e}return n}function _typeof$s(e){return _typeof$s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$s(e)}function _classCallCheck$t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$t(e,t,n){return t&&_defineProperties$t(e.prototype,t),n&&_defineProperties$t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$s(e,t)}function _setPrototypeOf$s(e,t){return _setPrototypeOf$s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$s(e,t)}function _createSuper$s(e){var t=_isNativeReflectConstruct$s();return function(){var n,r=_getPrototypeOf$s(e);if(t){var a=_getPrototypeOf$s(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$s(this,n)}}function _possibleConstructorReturn$s(e,t){if(t&&("object"===_typeof$s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$s(e)}function _assertThisInitialized$s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$s(e){return _getPrototypeOf$s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$s(e)}FinancialPlugin.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:0,maxValue:1}],returnNumberType:NumberType.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:NumberType.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.INTEGER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:NumberType.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}],returnNumberType:NumberType.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}],returnNumberType:NumberType.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:.1}],returnNumberType:NumberType.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}],returnNumberType:NumberType.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE}],returnNumberType:NumberType.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1,returnNumberType:NumberType.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],returnNumberType:NumberType.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:-1},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]}};var FormulaTextPlugin=function(e){_inherits$s(n,e);var t=_createSuper$s(n);function n(){return _classCallCheck$t(this,n),t.apply(this,arguments)}return _createClass$t(n,[{key:"formulatext",value:function(e,t){var n=this;return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),(function(){return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber)}),(function(e){var t;return null!==(t=n.serialization.getCellFormula(e))&&void 0!==t?t:new CellError(ErrorType.NA,ErrorMessage.Formula)}))}}]),n}(FunctionPlugin);function _typeof$r(e){return _typeof$r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$r(e)}function _classCallCheck$s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$s(e,t,n){return t&&_defineProperties$s(e.prototype,t),n&&_defineProperties$s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$r(e,t)}function _setPrototypeOf$r(e,t){return _setPrototypeOf$r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$r(e,t)}function _createSuper$r(e){var t=_isNativeReflectConstruct$r();return function(){var n,r=_getPrototypeOf$r(e);if(t){var a=_getPrototypeOf$r(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$r(this,n)}}function _possibleConstructorReturn$r(e,t){if(t&&("object"===_typeof$r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$r(e)}function _assertThisInitialized$r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$r(e){return _getPrototypeOf$r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$r(e)}FormulaTextPlugin.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}};var InformationPlugin=function(e){_inherits$r(n,e);var t=_createSuper$r(n);function n(){return _classCallCheck$s(this,n),t.apply(this,arguments)}return _createClass$s(n,[{key:"isbinary",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),(function(e){return/^[01]{1,10}$/.test(e)}))}},{key:"iserr",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),(function(e){return e instanceof CellError&&e.type!==ErrorType.NA}))}},{key:"iserror",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),(function(e){return e instanceof CellError}))}},{key:"isformula",value:function(e,t){var n=this;return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),(function(){return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber)}),(function(e){return n.dependencyGraph.addressMapping.getCell(e)instanceof FormulaVertex}))}},{key:"isblank",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),(function(e){return e===EmptyValue}))}},{key:"isna",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),(function(e){return e instanceof CellError&&e.type==ErrorType.NA}))}},{key:"isnumber",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),isExtendedNumber)}},{key:"islogical",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),(function(e){return"boolean"==typeof e}))}},{key:"isref",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),(function(e){return e instanceof CellError&&(e.type==ErrorType.REF||e.type==ErrorType.CYCLE)}))}},{key:"istext",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),(function(e){return"string"==typeof e}))}},{key:"isnontext",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),(function(e){return!("string"==typeof e)}))}},{key:"column",value:function(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),(function(){return t.formulaAddress.col+1}),(function(e){return e.col+1}))}},{key:"columns",value:function(e,t){if(1!==e.args.length)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(e.args.some((function(e){return e.type===AstNodeType.EMPTY})))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);for(var n=e.args[0];n.type===AstNodeType.PARENTHESIS;)n=n.expression;if(n.type===AstNodeType.CELL_RANGE||n.type===AstNodeType.COLUMN_RANGE)return n.end.col-n.start.col+1;if(n.type===AstNodeType.CELL_REFERENCE)return 1;if(n.type===AstNodeType.ROW_RANGE)return this.config.maxColumns;var r=this.evaluateAst(n,t);return r instanceof SimpleRangeValue?r.width():r instanceof CellError?r:1}},{key:"row",value:function(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),(function(){return t.formulaAddress.row+1}),(function(e){return e.row+1}))}},{key:"rows",value:function(e,t){if(1!==e.args.length)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);if(e.args.some((function(e){return e.type===AstNodeType.EMPTY})))return new CellError(ErrorType.NUM,ErrorMessage.EmptyArg);for(var n=e.args[0];n.type===AstNodeType.PARENTHESIS;)n=n.expression;if(n.type===AstNodeType.CELL_RANGE||n.type===AstNodeType.ROW_RANGE)return n.end.row-n.start.row+1;if(n.type===AstNodeType.CELL_REFERENCE)return 1;if(n.type===AstNodeType.COLUMN_RANGE)return this.config.maxRows;var r=this.evaluateAst(n,t);return r instanceof SimpleRangeValue?r.height():r instanceof CellError?r:1}},{key:"index",value:function(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),(function(e,t,n){var r,a,i,o,s,l;return n<1||t<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):n>e.width()||t>e.height()?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):null!==(l=null!==(i=null===(a=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r[t-1])||void 0===a?void 0:a[n-1])&&void 0!==i?i:null===(s=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o[0])||void 0===s?void 0:s[0])&&void 0!==l?l:new CellError(ErrorType.VALUE,ErrorMessage.CellRangeExpected)}))}},{key:"na",value:function(e,t){return new CellError(ErrorType.NA)}},{key:"sheet",value:function(e,t){var n=this;return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),(function(){return t.formulaAddress.sheet+1}),(function(e){return e.sheet+1}),(function(e){var t=n.dependencyGraph.sheetMapping.get(e);return void 0!==t?t+1:new CellError(ErrorType.NA,ErrorMessage.SheetRef)}))}},{key:"sheets",value:function(e,t){var n=this;return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),(function(){return n.dependencyGraph.sheetMapping.numberOfSheets()}),(function(){return 1}),(function(){return new CellError(ErrorType.VALUE,ErrorMessage.CellRefExpected)}))}}]),n}(FunctionPlugin);function _typeof$q(e){return _typeof$q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$q(e)}function _classCallCheck$r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$r(e,t,n){return t&&_defineProperties$r(e.prototype,t),n&&_defineProperties$r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$q(e,t)}function _setPrototypeOf$q(e,t){return _setPrototypeOf$q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$q(e,t)}function _createSuper$q(e){var t=_isNativeReflectConstruct$q();return function(){var n,r=_getPrototypeOf$q(e);if(t){var a=_getPrototypeOf$q(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$q(this,n)}}function _possibleConstructorReturn$q(e,t){if(t&&("object"===_typeof$q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$q(e)}function _assertThisInitialized$q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$q(e){return _getPrototypeOf$q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$q(e)}InformationPlugin.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:ArgumentTypes.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:ArgumentTypes.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:ArgumentTypes.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:ArgumentTypes.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:ArgumentTypes.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:ArgumentTypes.NOERROR,optional:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:ArgumentTypes.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:ArgumentTypes.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}};var IsEvenPlugin=function(e){_inherits$q(n,e);var t=_createSuper$q(n);function n(){return _classCallCheck$r(this,n),t.apply(this,arguments)}return _createClass$r(n,[{key:"iseven",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),(function(e){return e%2==0}))}}]),n}(FunctionPlugin);function _typeof$p(e){return _typeof$p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$p(e)}function _classCallCheck$q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$q(e,t,n){return t&&_defineProperties$q(e.prototype,t),n&&_defineProperties$q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$p(e,t)}function _setPrototypeOf$p(e,t){return _setPrototypeOf$p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$p(e,t)}function _createSuper$p(e){var t=_isNativeReflectConstruct$p();return function(){var n,r=_getPrototypeOf$p(e);if(t){var a=_getPrototypeOf$p(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$p(this,n)}}function _possibleConstructorReturn$p(e,t){if(t&&("object"===_typeof$p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$p(e)}function _assertThisInitialized$p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$p(e){return _getPrototypeOf$p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$p(e)}IsEvenPlugin.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var IsOddPlugin=function(e){_inherits$p(n,e);var t=_createSuper$p(n);function n(){return _classCallCheck$q(this,n),t.apply(this,arguments)}return _createClass$q(n,[{key:"isodd",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),(function(e){return e%2==1}))}}]),n}(FunctionPlugin);function _typeof$o(e){return _typeof$o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$o(e)}function _classCallCheck$p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$p(e,t,n){return t&&_defineProperties$p(e.prototype,t),n&&_defineProperties$p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$o(e,t)}function _setPrototypeOf$o(e,t){return _setPrototypeOf$o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$o(e,t)}function _createSuper$o(e){var t=_isNativeReflectConstruct$o();return function(){var n,r=_getPrototypeOf$o(e);if(t){var a=_getPrototypeOf$o(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$o(this,n)}}function _possibleConstructorReturn$o(e,t){if(t&&("object"===_typeof$o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$o(e)}function _assertThisInitialized$o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$o(e){return _getPrototypeOf$o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$o(e)}IsOddPlugin.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var LogarithmPlugin=function(e){_inherits$o(n,e);var t=_createSuper$o(n);function n(){return _classCallCheck$p(this,n),t.apply(this,arguments)}return _createClass$p(n,[{key:"log10",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}},{key:"log",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),(function(e,t){return Math.log(e)/Math.log(t)}))}},{key:"ln",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}]),n}(FunctionPlugin);function _typeof$n(e){return _typeof$n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$n(e)}function _classCallCheck$o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$o(e,t,n){return t&&_defineProperties$o(e.prototype,t),n&&_defineProperties$o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$n(e,t)}function _setPrototypeOf$n(e,t){return _setPrototypeOf$n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$n(e,t)}function _createSuper$n(e){var t=_isNativeReflectConstruct$n();return function(){var n,r=_getPrototypeOf$n(e);if(t){var a=_getPrototypeOf$n(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$n(this,n)}}function _possibleConstructorReturn$n(e,t){if(t&&("object"===_typeof$n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$n(e)}function _assertThisInitialized$n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$n(e){return _getPrototypeOf$n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$n(e)}LogarithmPlugin.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:ArgumentTypes.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var PI=parseFloat(Math.PI.toFixed(14)),MathConstantsPlugin=function(e){_inherits$n(n,e);var t=_createSuper$n(n);function n(){return _classCallCheck$o(this,n),t.apply(this,arguments)}return _createClass$o(n,[{key:"pi",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PI"),(function(){return PI}))}},{key:"sqrtpi",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),(function(e){return Math.sqrt(PI*e)}))}}]),n}(FunctionPlugin);function _typeof$m(e){return _typeof$m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$m(e)}function _slicedToArray$2(e,t){return _arrayWithHoles$2(e)||_iterableToArrayLimit$2(e,t)||_unsupportedIterableToArray$8(e,t)||_nonIterableRest$2()}function _nonIterableRest$2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$8(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$8(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$8(e,t):void 0}}function _arrayLikeToArray$8(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit$2(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$2(e){if(Array.isArray(e))return e}function _classCallCheck$n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$n(e,t,n){return t&&_defineProperties$n(e.prototype,t),n&&_defineProperties$n(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$m(e,t)}function _setPrototypeOf$m(e,t){return _setPrototypeOf$m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$m(e,t)}function _createSuper$m(e){var t=_isNativeReflectConstruct$m();return function(){var n,r=_getPrototypeOf$m(e);if(t){var a=_getPrototypeOf$m(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$m(this,n)}}function _possibleConstructorReturn$m(e,t){if(t&&("object"===_typeof$m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$m(e)}function _assertThisInitialized$m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$m(e){return _getPrototypeOf$m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$m(e)}function arraySizeForMultiplication(e,t){return new ArraySize(t.width,e.height)}function arraySizeForPoolFunction(e,t,n){return new ArraySize(1+(e.width-t)/n,1+(e.height-t)/n)}MathConstantsPlugin.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0}]}};var MatrixPlugin=function(e){_inherits$m(n,e);var t=_createSuper$m(n);function n(){return _classCallCheck$n(this,n),t.apply(this,arguments)}return _createClass$n(n,[{key:"mmult",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MMULT"),(function(e,t){if(!e.hasOnlyNumbers()||!t.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);if(t.height()!==e.width())return new CellError(ErrorType.VALUE,ErrorMessage.ArrayDimensions);var r=arraySizeForMultiplication(e.size,t.size),a=n.createKernel((function(e,t,n){for(var r=0,a=0;a<n;++a)r+=e[this.thread.y][a]*t[a][this.thread.x];return r}),r)(e.rawNumbers(),t.rawNumbers(),e.width());return SimpleRangeValue.onlyNumbers(a)}))}},{key:"mmultArraySize",value:function(e,t){var n=this;if(2!==e.args.length)return ArraySize.error();var r=this.metadata("MMULT"),a=e.args.map((function(e){var a;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))})),i=_slicedToArray$2(a,2);return arraySizeForMultiplication(i[0],i[1])}},{key:"maxpool",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MAXPOOL"),(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!e.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);var a=arraySizeForPoolFunction(e.size,t,r),i=n.createKernel((function(e,t,n){for(var r=this.thread.x*n,a=this.thread.y*n,i=e[a][r],o=0;o<t;o++)for(var s=0;s<t;s++)i=Math.max(i,e[a+o][r+s]);return i}),a)(e.rawNumbers(),t,r);return SimpleRangeValue.onlyNumbers(i)}))}},{key:"medianpool",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!e.hasOnlyNumbers())return new CellError(ErrorType.VALUE,ErrorMessage.NumberRange);var a=arraySizeForPoolFunction(e.size,t,r),i=n.createKernel((function(e,t,n){for(var r=this.thread.x*n,a=this.thread.y*n,i=e[a][r],o=0;o<t;o++)for(var s=0;s<t;s++)i=Math.max(i,e[a+o][r+s]);for(var l=e[a][r],u=0;u<t;u++)for(var c=0;c<t;c++)l=Math.min(l,e[a+u][r+c]);for(var p=t*t,d=l,m=i,f=42,h=0;h<32;h++){for(var y=(d+m)/2,b=0,g=0;g<t;g++)for(var v=0;v<t;v++)e[a+g][r+v]>y&&b++;if(t%2==0){if(b===p/2){f=y;break}b>p/2?d=y:m=y}else{if(b===(p-1)/2){f=y;break}b>(p-1)/2?d=y:m=y}}return f}),a)(e.rawNumbers(),t,r);return SimpleRangeValue.onlyNumbers(i)}))}},{key:"maxpoolArraySize",value:function(e,t){var n=this;if(e.args.length<2||e.args.length>3)return ArraySize.error();var r,a=this.metadata("MAXPOOL"),i=e.args.map((function(e){var r;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(r=null==a?void 0:a.arrayFunction)&&void 0!==r&&r))})),o=i[0],s=e.args[1],l=r=s.type===AstNodeType.NUMBER?s.value:1;if(3===e.args.length){var u=e.args[2];l=u.type===AstNodeType.NUMBER?u.value:1}return r>o.width||r>o.height||l>r||(o.width-r)%l!=0||(o.height-r)%l!=0?ArraySize.error():arraySizeForPoolFunction(o,r,l)}},{key:"medianpoolArraySize",value:function(e,t){return this.maxpoolArraySize(e,t)}},{key:"transpose",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),(function(e){for(var t=e.rawData(),n=e.size,r=[],a=0;a<n.width;++a){r[a]=[];for(var i=0;i<n.height;++i)r[a][i]=t[i][a]}return SimpleRangeValue.onlyValues(r)}))}},{key:"transposeArraySize",value:function(e,t){var n=this;if(1!==e.args.length)return ArraySize.error();var r=this.metadata("MMULT"),a=e.args.map((function(e){var a;return n.arraySizeForAst(e,new InterpreterState(t.formulaAddress,t.arraysFlag||null!==(a=null==r?void 0:r.arrayFunction)&&void 0!==a&&a))})),i=_slicedToArray$2(a,1)[0];return new ArraySize(i.height,i.width)}},{key:"createKernel",value:function(e,t){return function(){for(var n=[],r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];for(var o=0;o<t.height;++o){n.push([]);for(var s=0;s<t.width;++s)n[o][s]=e.apply({thread:{x:s,y:o}},a)}return n}}}]),n}(FunctionPlugin);function _typeof$l(e){return _typeof$l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$l(e)}function _classCallCheck$m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$m(e,t,n){return t&&_defineProperties$m(e.prototype,t),n&&_defineProperties$m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$l(e,t)}function _setPrototypeOf$l(e,t){return _setPrototypeOf$l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$l(e,t)}function _createSuper$l(e){var t=_isNativeReflectConstruct$l();return function(){var n,r=_getPrototypeOf$l(e);if(t){var a=_getPrototypeOf$l(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$l(this,n)}}function _possibleConstructorReturn$l(e,t){if(t&&("object"===_typeof$l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$l(e)}function _assertThisInitialized$l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$l(e){return _getPrototypeOf$l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$l(e)}MatrixPlugin.implementedFunctions={MMULT:{method:"mmult",arraySizeMethod:"mmultArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",arraySizeMethod:"transposeArraySize",parameters:[{argumentType:ArgumentTypes.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",arraySizeMethod:"maxpoolArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",arraySizeMethod:"medianpoolArraySize",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}};var MedianPlugin=function(e){_inherits$l(n,e);var t=_createSuper$l(n);function n(){return _classCallCheck$m(this,n),t.apply(this,arguments)}return _createClass$m(n,[{key:"median",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MEDIAN"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);return a instanceof CellError?a:0===a.length?new CellError(ErrorType.NUM,ErrorMessage.OneValue):(a.sort((function(e,t){return e-t})),a.length%2==0?(a[a.length/2-1]+a[a.length/2])/2:a[Math.floor(a.length/2)])}))}},{key:"large",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("LARGE"),(function(e,t){var r=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof CellError?r:(r.sort((function(e,t){return e-t})),(t=Math.trunc(t))>r.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):r[r.length-t])}))}},{key:"small",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SMALL"),(function(e,t){var r=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof CellError?r:(r.sort((function(e,t){return e-t})),(t=Math.trunc(t))>r.length?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):r[t-1])}))}}]),n}(FunctionPlugin);function _typeof$k(e){return _typeof$k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$k(e)}function _classCallCheck$l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$l(e,t,n){return t&&_defineProperties$l(e.prototype,t),n&&_defineProperties$l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$k(e,t)}function _setPrototypeOf$k(e,t){return _setPrototypeOf$k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$k(e,t)}function _createSuper$k(e){var t=_isNativeReflectConstruct$k();return function(){var n,r=_getPrototypeOf$k(e);if(t){var a=_getPrototypeOf$k(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$k(this,n)}}function _possibleConstructorReturn$k(e,t){if(t&&("object"===_typeof$k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$k(e)}function _assertThisInitialized$k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$k(e){return _getPrototypeOf$k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$k(e)}MedianPlugin.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,minValue:1}]}};var ModuloPlugin=function(e){_inherits$k(n,e);var t=_createSuper$k(n);function n(){return _classCallCheck$l(this,n),t.apply(this,arguments)}return _createClass$l(n,[{key:"mod",value:function(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),(function(e,t){return 0===t?new CellError(ErrorType.DIV_BY_ZERO):e%t}))}}]),n}(FunctionPlugin);function _typeof$j(e){return _typeof$j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$j(e)}function _createForOfIteratorHelper$6(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$7(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$7(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$7(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$7(e,t):void 0}}function _arrayLikeToArray$7(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _inherits$j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$j(e,t)}function _setPrototypeOf$j(e,t){return _setPrototypeOf$j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$j(e,t)}function _createSuper$j(e){var t=_isNativeReflectConstruct$j();return function(){var n,r=_getPrototypeOf$j(e);if(t){var a=_getPrototypeOf$j(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$j(this,n)}}function _possibleConstructorReturn$j(e,t){if(t&&("object"===_typeof$j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$j(e)}function _assertThisInitialized$j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$j(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$j(e){return _getPrototypeOf$j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$j(e)}function _classCallCheck$k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$k(e,t,n){return t&&_defineProperties$k(e.prototype,t),n&&_defineProperties$k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function zeroForInfinite(e){return isExtendedNumber(e)&&!Number.isFinite(getRawValue(e))?0:e}ModuloPlugin.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]}};var MomentsAggregate=function(){function e(t,n,r){_classCallCheck$k(this,e),this.sumsq=t,this.sum=n,this.count=r}return _createClass$k(e,[{key:"compose",value:function(t){return new e(this.sumsq+t.sumsq,this.sum+t.sum,this.count+t.count)}},{key:"averageValue",value:function(){return this.count>0?this.sum/this.count:void 0}},{key:"varSValue",value:function(){return this.count>1?(this.sumsq-this.sum*this.sum/this.count)/(this.count-1):void 0}},{key:"varPValue",value:function(){return this.count>0?(this.sumsq-this.sum*this.sum/this.count)/this.count:void 0}}],[{key:"single",value:function(t){return new e(t*t,t,1)}}]),e}();MomentsAggregate.empty=new MomentsAggregate(0,0,0);var NumericAggregationPlugin=function(e){_inherits$j(n,e);var t=_createSuper$j(n);function n(){var e;return _classCallCheck$k(this,n),(e=t.apply(this,arguments)).addWithEpsilonRaw=function(t,n){return e.arithmeticHelper.addWithEpsilonRaw(t,n)},e}return _createClass$k(n,[{key:"sum",value:function(e,t){return this.doSum(e.args,t)}},{key:"sumsq",value:function(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,(function(e){return Math.pow(getRawValue(e),2)}),strictlyNumbers)}},{key:"max",value:function(e,t){return this.doMax(e.args,t)}},{key:"maxa",value:function(e,t){return zeroForInfinite(this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",(function(e,t){return Math.max(e,t)}),getRawValue,numbersBooleans))}},{key:"min",value:function(e,t){return this.doMin(e.args,t)}},{key:"mina",value:function(e,t){return zeroForInfinite(this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",(function(e,t){return Math.min(e,t)}),getRawValue,numbersBooleans))}},{key:"count",value:function(e,t){return this.doCount(e.args,t)}},{key:"counta",value:function(e,t){return this.doCounta(e.args,t)}},{key:"average",value:function(e,t){return this.doAverage(e.args,t)}},{key:"averagea",value:function(e,t){var n,r=this.reduce(e.args,t,MomentsAggregate.empty,"_AGGREGATE_A",(function(e,t){return e.compose(t)}),(function(e){return MomentsAggregate.single(getRawValue(e))}),numbersBooleans);return r instanceof CellError?r:null!==(n=r.averageValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"vars",value:function(e,t){return this.doVarS(e.args,t)}},{key:"varp",value:function(e,t){return this.doVarP(e.args,t)}},{key:"vara",value:function(e,t){var n,r=this.reduceAggregateA(e.args,t);return r instanceof CellError?r:null!==(n=r.varSValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"varpa",value:function(e,t){var n,r=this.reduceAggregateA(e.args,t);return r instanceof CellError?r:null!==(n=r.varPValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"stdevs",value:function(e,t){return this.doStdevS(e.args,t)}},{key:"stdevp",value:function(e,t){return this.doStdevP(e.args,t)}},{key:"stdeva",value:function(e,t){var n=this.reduceAggregateA(e.args,t);if(n instanceof CellError)return n;var r=n.varSValue();return void 0===r?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(r)}},{key:"stdevpa",value:function(e,t){var n=this.reduceAggregateA(e.args,t);if(n instanceof CellError)return n;var r=n.varPValue();return void 0===r?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(r)}},{key:"product",value:function(e,t){return this.doProduct(e.args,t)}},{key:"subtotal",value:function(e,t){if(e.args.length<2)return new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber);var n=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:ArgumentTypes.NUMBER},t),r=e.args.slice(1);switch(n){case 1:case 101:return this.doAverage(r,t);case 2:case 102:return this.doCount(r,t);case 3:case 103:return this.doCounta(r,t);case 4:case 104:return this.doMax(r,t);case 5:case 105:return this.doMin(r,t);case 6:case 106:return this.doProduct(r,t);case 7:case 107:return this.doStdevS(r,t);case 8:case 108:return this.doStdevP(r,t);case 9:case 109:return this.doSum(r,t);case 10:case 110:return this.doVarS(r,t);case 11:case 111:return this.doVarP(r,t);default:return new CellError(ErrorType.VALUE,ErrorMessage.BadMode)}}},{key:"reduceAggregate",value:function(e,t){return this.reduce(e,t,MomentsAggregate.empty,"_AGGREGATE",(function(e,t){return e.compose(t)}),(function(e){return MomentsAggregate.single(getRawValue(e))}),strictlyNumbers)}},{key:"reduceAggregateA",value:function(e,t){return this.reduce(e,t,MomentsAggregate.empty,"_AGGREGATE_A",(function(e,t){return e.compose(t)}),(function(e){return MomentsAggregate.single(getRawValue(e))}),numbersBooleans)}},{key:"doAverage",value:function(e,t){var n,r=this.reduceAggregate(e,t);return r instanceof CellError?r:null!==(n=r.averageValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"doVarS",value:function(e,t){var n,r=this.reduceAggregate(e,t);return r instanceof CellError?r:null!==(n=r.varSValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"doVarP",value:function(e,t){var n,r=this.reduceAggregate(e,t);return r instanceof CellError?r:null!==(n=r.varPValue())&&void 0!==n?n:new CellError(ErrorType.DIV_BY_ZERO)}},{key:"doStdevS",value:function(e,t){var n=this.reduceAggregate(e,t);if(n instanceof CellError)return n;var r=n.varSValue();return void 0===r?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(r)}},{key:"doStdevP",value:function(e,t){var n=this.reduceAggregate(e,t);if(n instanceof CellError)return n;var r=n.varPValue();return void 0===r?new CellError(ErrorType.DIV_BY_ZERO):Math.sqrt(r)}},{key:"doCount",value:function(e,t){return this.reduce(e,t,0,"COUNT",(function(e,t){return e+t}),getRawValue,(function(e){return isExtendedNumber(e)?1:0}))}},{key:"doCounta",value:function(e,t){return this.reduce(e,t,0,"COUNTA",(function(e,t){return e+t}),getRawValue,(function(e){return e===EmptyValue?0:1}))}},{key:"doMax",value:function(e,t){return zeroForInfinite(this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",(function(e,t){return Math.max(e,t)}),getRawValue,strictlyNumbers))}},{key:"doMin",value:function(e,t){return zeroForInfinite(this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",(function(e,t){return Math.min(e,t)}),getRawValue,strictlyNumbers))}},{key:"doSum",value:function(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,getRawValue,strictlyNumbers)}},{key:"doProduct",value:function(e,t){return this.reduce(e,t,1,"PRODUCT",(function(e,t){return e*t}),getRawValue,strictlyNumbers)}},{key:"reduce",value:function(e,t,n,r,a,i,o){var s=this;return e.length<1?new CellError(ErrorType.NA,ErrorMessage.WrongArgNumber):e.reduce((function(e,l){if(e instanceof CellError)return e;if(l.type===AstNodeType.CELL_RANGE||l.type===AstNodeType.COLUMN_RANGE||l.type===AstNodeType.ROW_RANGE){var u=s.evaluateRange(l,t,n,r,a,i,o);return u instanceof CellError?u:a(u,e)}var c;if((c=s.evaluateAst(l,t))instanceof SimpleRangeValue){var p=Array.from(c.valuesFromTopLeftCorner()).map(o).filter((function(e){return void 0!==e}));return p.map((function(e){return e instanceof CellError?e:i(e)})).reduce((function(e,t){return e instanceof CellError?e:t instanceof CellError?t:a(e,t)}),e)}if(l.type===AstNodeType.CELL_REFERENCE){if(void 0===(c=o(c)))return e}else if(c=s.coerceScalarToNumberOrError(c),void 0===(c=o(c)))return e;return c instanceof CellError?c:a(e,i(c))}),n)}},{key:"evaluateRange",value:function(e,t,n,r,a,i,o){var s;try{s=AbsoluteCellRange.fromAst(e,t.formulaAddress)}catch(e){if(e instanceof SheetsNotEqual)return new CellError(ErrorType.REF,ErrorMessage.RangeManySheets);throw e}var l=s.start,u=s.end,c=this.dependencyGraph.getRange(l,u);if(void 0===c)throw new Error("Range does not exists in graph");var p=c.getFunctionValue(r);void 0===p&&(p=this.getRangeValues(r,s,i,o).reduce((function(e,t){return e instanceof CellError?e:t instanceof CellError?t:a(e,t)}),n),c.setFunctionValue(r,p));return p}},{key:"getRangeValues",value:function(e,t,n,r){var a,i=[],o=this.dependencyGraph.rangeMapping.findSmallerRange(t),s=o.smallerRangeVertex,l=o.restRange,u=this.dependencyGraph.getRange(t.start,t.end);if(void 0!==s&&this.dependencyGraph.existsEdge(s,u)){var c=s.getFunctionValue(e);if(void 0!==c)i.push(c);else{var p,d=_createForOfIteratorHelper$6(s.range.addresses(this.dependencyGraph));try{for(d.s();!(p=d.n()).done;){var m=p.value,f=r(this.dependencyGraph.getScalarValue(m));f instanceof CellError?i.push(f):void 0!==f&&i.push(n(f))}}catch(e){d.e(e)}finally{d.f()}}a=l}else a=t;var h,y=_createForOfIteratorHelper$6(a.addresses(this.dependencyGraph));try{for(y.s();!(h=y.n()).done;){var b=h.value,g=r(this.dependencyGraph.getScalarValue(b));g instanceof CellError?i.push(g):void 0!==g&&i.push(n(g))}}catch(e){y.e(e)}finally{y.f()}return i}}]),n}(FunctionPlugin);function strictlyNumbers(e){return isExtendedNumber(e)||e instanceof CellError?e:void 0}function numbersBooleans(e){return"boolean"==typeof e?coerceBooleanToNumber(e):isExtendedNumber(e)||e instanceof CellError?e:"string"==typeof e?0:void 0}function _typeof$i(e){return _typeof$i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$i(e)}function _classCallCheck$j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$j(e,t,n){return t&&_defineProperties$j(e.prototype,t),n&&_defineProperties$j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$i(e,t)}function _setPrototypeOf$i(e,t){return _setPrototypeOf$i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$i(e,t)}function _createSuper$i(e){var t=_isNativeReflectConstruct$i();return function(){var n,r=_getPrototypeOf$i(e);if(t){var a=_getPrototypeOf$i(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$i(this,n)}}function _possibleConstructorReturn$i(e,t){if(t&&("object"===_typeof$i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$i(e)}function _assertThisInitialized$i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$i(e){return _getPrototypeOf$i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$i(e)}NumericAggregationPlugin.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1}},NumericAggregationPlugin.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"};var PowerPlugin=function(e){_inherits$i(n,e);var t=_createSuper$i(n);function n(){return _classCallCheck$j(this,n),t.apply(this,arguments)}return _createClass$j(n,[{key:"power",value:function(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}]),n}(FunctionPlugin);function _typeof$h(e){return _typeof$h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$h(e)}function _classCallCheck$i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$i(e,t,n){return t&&_defineProperties$i(e.prototype,t),n&&_defineProperties$i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$h(e,t)}function _setPrototypeOf$h(e,t){return _setPrototypeOf$h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$h(e,t)}function _createSuper$h(e){var t=_isNativeReflectConstruct$h();return function(){var n,r=_getPrototypeOf$h(e);if(t){var a=_getPrototypeOf$h(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$h(this,n)}}function _possibleConstructorReturn$h(e,t){if(t&&("object"===_typeof$h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$h(e)}function _assertThisInitialized$h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$h(e){return _getPrototypeOf$h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$h(e)}PowerPlugin.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]}};var RadiansPlugin=function(e){_inherits$h(n,e);var t=_createSuper$h(n);function n(){return _classCallCheck$i(this,n),t.apply(this,arguments)}return _createClass$i(n,[{key:"radians",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),(function(e){return e*(Math.PI/180)}))}}]),n}(FunctionPlugin);function _typeof$g(e){return _typeof$g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$g(e)}function _classCallCheck$h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$h(e,t,n){return t&&_defineProperties$h(e.prototype,t),n&&_defineProperties$h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$g(e,t)}function _setPrototypeOf$g(e,t){return _setPrototypeOf$g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$g(e,t)}function _createSuper$g(e){var t=_isNativeReflectConstruct$g();return function(){var n,r=_getPrototypeOf$g(e);if(t){var a=_getPrototypeOf$g(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$g(this,n)}}function _possibleConstructorReturn$g(e,t){if(t&&("object"===_typeof$g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$g(e)}function _assertThisInitialized$g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$g(e){return _getPrototypeOf$g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$g(e)}RadiansPlugin.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var MAX_LENGTH=10,DECIMAL_NUMBER_OF_BITS=255,MIN_BASE=2,MAX_BASE=36,ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",RadixConversionPlugin=function(e){_inherits$g(n,e);var t=_createSuper$g(n);function n(){return _classCallCheck$h(this,n),t.apply(this,arguments)}return _createClass$h(n,[{key:"dec2bin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),(function(e,t){return decimalToBaseWithExactPadding(e,2,t)}))}},{key:"dec2oct",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),(function(e,t){return decimalToBaseWithExactPadding(e,8,t)}))}},{key:"dec2hex",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),(function(e,t){return decimalToBaseWithExactPadding(e,16,t)}))}},{key:"bin2dec",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),(function(e){var t=coerceStringToBase(e,2,MAX_LENGTH);return void 0===t?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):twoComplementToDecimal(t,2)}))}},{key:"bin2oct",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),(function(e,t){var n=coerceStringToBase(e,2,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(n,2),8,t)}))}},{key:"bin2hex",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),(function(e,t){var n=coerceStringToBase(e,2,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotBinary):decimalToBaseWithExactPadding(twoComplementToDecimal(n,2),16,t)}))}},{key:"oct2dec",value:function(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),(function(e){var t=coerceStringToBase(e,8,MAX_LENGTH);return void 0===t?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):twoComplementToDecimal(t,8)}))}},{key:"oct2bin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),(function(e,t){var n=coerceStringToBase(e,8,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(n,8),2,t)}))}},{key:"oct2hex",value:function(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),(function(e,t){var n=coerceStringToBase(e,8,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotOctal):decimalToBaseWithExactPadding(twoComplementToDecimal(n,8),16,t)}))}},{key:"hex2dec",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),(function(e){var t=coerceStringToBase(e,16,MAX_LENGTH);return void 0===t?new CellError(ErrorType.NUM,ErrorMessage.NotHex):twoComplementToDecimal(t,16)}))}},{key:"hex2bin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),(function(e,t){var n=coerceStringToBase(e,16,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(n,16),2,t)}))}},{key:"hex2oct",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),(function(e,t){var n=coerceStringToBase(e,16,MAX_LENGTH);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotHex):decimalToBaseWithExactPadding(twoComplementToDecimal(n,16),8,t)}))}},{key:"base",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),decimalToBaseWithMinimumPadding)}},{key:"decimal",value:function(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),(function(e,t){var n=coerceStringToBase(e,t,DECIMAL_NUMBER_OF_BITS);return void 0===n?new CellError(ErrorType.NUM,ErrorMessage.NotHex):parseInt(n,t)}))}}]),n}(FunctionPlugin);function coerceStringToBase(e,t,n){var r=ALPHABET.substr(0,t),a=new RegExp("^[".concat(r,"]+$"));if(!(e.length>n)&&a.test(e))return e}function decimalToBaseWithExactPadding(e,t,n){if(e>maxValFromBase(t))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLarge);if(e<minValFromBase(t))return new CellError(ErrorType.NUM,ErrorMessage.ValueBaseSmall);var r=decimalToRadixComplement(e,t);return void 0===n||e<0?r:r.length>n?new CellError(ErrorType.NUM,ErrorMessage.ValueBaseLong):padLeft(r,n)}function minValFromBase(e){return-Math.pow(e,MAX_LENGTH)/2}function maxValFromBase(e){return-minValFromBase(e)-1}function decimalToBaseWithMinimumPadding(e,t,n){var r=decimalToRadixComplement(e,t);return void 0!==n&&n>r.length?padLeft(r,n):r}function decimalToRadixComplement(e,t){return(e+(e<0?Math.pow(t,MAX_LENGTH):0)).toString(t).toUpperCase()}function twoComplementToDecimal(e,t){var n=parseInt(e,t),r=Math.pow(t,MAX_LENGTH);return n>=r/2?n-r:n}function _typeof$f(e){return _typeof$f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$f(e)}function _classCallCheck$g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$g(e,t,n){return t&&_defineProperties$g(e.prototype,t),n&&_defineProperties$g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$f(e,t)}function _setPrototypeOf$f(e,t){return _setPrototypeOf$f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$f(e,t)}function _createSuper$f(e){var t=_isNativeReflectConstruct$f();return function(){var n,r=_getPrototypeOf$f(e);if(t){var a=_getPrototypeOf$f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$f(this,n)}}function _possibleConstructorReturn$f(e,t){if(t&&("object"===_typeof$f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$f(e)}function _assertThisInitialized$f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$f(e){return _getPrototypeOf$f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$f(e)}RadixConversionPlugin.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:ArgumentTypes.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:MAX_LENGTH}]},DECIMAL:{method:"decimal",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE}]},BASE:{method:"base",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:MIN_BASE,maxValue:MAX_BASE},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0,minValue:0,maxValue:DECIMAL_NUMBER_OF_BITS}]}};var RandomPlugin=function(e){_inherits$f(n,e);var t=_createSuper$f(n);function n(){return _classCallCheck$g(this,n),t.apply(this,arguments)}return _createClass$g(n,[{key:"rand",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}},{key:"randbetween",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),(function(e,t){return t<e?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):((e=Math.ceil(e))===(t=Math.floor(t)+1)&&(t+=1),e+Math.floor(Math.random()*(t-e)))}))}}]),n}(FunctionPlugin);function _typeof$e(e){return _typeof$e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$e(e)}function _classCallCheck$f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$f(e,t,n){return t&&_defineProperties$f(e.prototype,t),n&&_defineProperties$f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$e(e,t)}function _setPrototypeOf$e(e,t){return _setPrototypeOf$e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$e(e,t)}function _createSuper$e(e){var t=_isNativeReflectConstruct$e();return function(){var n,r=_getPrototypeOf$e(e);if(t){var a=_getPrototypeOf$e(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$e(this,n)}}function _possibleConstructorReturn$e(e,t){if(t&&("object"===_typeof$e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$e(e)}function _assertThisInitialized$e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$e(e){return _getPrototypeOf$e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$e(e)}function findNextOddNumber(e){var t=Math.ceil(e);return t%2==1?t:t+1}function findNextEvenNumber(e){var t=Math.ceil(e);return t%2==0?t:t+1}RandomPlugin.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}],isVolatile:!0}};var RoundingPlugin=function(e){_inherits$e(n,e);var t=_createSuper$e(n);function n(){return _classCallCheck$f(this,n),t.apply(this,arguments)}return _createClass$f(n,[{key:"roundup",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(function(e,t){var n=Math.pow(10,t);return e<0?-Math.ceil(-e*n)/n:Math.ceil(e*n)/n}))}},{key:"rounddown",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),(function(e,t){var n=Math.pow(10,t);return e<0?-Math.floor(-e*n)/n:Math.floor(e*n)/n}))}},{key:"round",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),(function(e,t){var n=Math.pow(10,t);return e<0?-Math.round(-e*n)/n:Math.round(e*n)/n}))}},{key:"intFunc",value:function(e,t){return this.runFunction(e.args,t,this.metadata("INT"),(function(e){return e<0?-Math.floor(-e):Math.floor(e)}))}},{key:"even",value:function(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),(function(e){return e<0?-findNextEvenNumber(-e):findNextEvenNumber(e)}))}},{key:"odd",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),(function(e){return e<0?-findNextOddNumber(-e):findNextOddNumber(e)}))}},{key:"ceilingmath",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),(function(e,t,n){return 0===t||0===e?0:(t=Math.abs(t),1===n&&e<0&&(t=-t),Math.ceil(e/t)*t)}))}},{key:"ceiling",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),(function(e,t){return 0===e?0:0===t?new CellError(ErrorType.DIV_BY_ZERO):e>0&&t<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.ceil(e/t)*t}))}},{key:"ceilingprecise",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),(function(e,t){return 0===t||0===e?0:(t=Math.abs(t),Math.ceil(e/t)*t)}))}},{key:"floormath",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),(function(e,t,n){return 0===t||0===e?0:(t=Math.abs(t),1===n&&e<0&&(t*=-1),Math.floor(e/t)*t)}))}},{key:"floor",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),(function(e,t){return 0===e?0:0===t?new CellError(ErrorType.DIV_BY_ZERO):e>0&&t<0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.floor(e/t)*t}))}},{key:"floorprecise",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),(function(e,t){return 0===t||0===e?0:(t=Math.abs(t),Math.floor(e/t)*t)}))}}]),n}(FunctionPlugin);function _typeof$d(e){return _typeof$d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$d(e)}function _classCallCheck$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$e(e,t,n){return t&&_defineProperties$e(e.prototype,t),n&&_defineProperties$e(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$d(e,t)}function _setPrototypeOf$d(e,t){return _setPrototypeOf$d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$d(e,t)}function _createSuper$d(e){var t=_isNativeReflectConstruct$d();return function(){var n,r=_getPrototypeOf$d(e);if(t){var a=_getPrototypeOf$d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$d(this,n)}}function _possibleConstructorReturn$d(e,t){if(t&&("object"===_typeof$d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$d(e)}function _assertThisInitialized$d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$d(e){return _getPrototypeOf$d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$d(e)}RoundingPlugin.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1},{argumentType:ArgumentTypes.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]}},RoundingPlugin.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"};var SqrtPlugin=function(e){_inherits$d(n,e);var t=_createSuper$d(n);function n(){return _classCallCheck$e(this,n),t.apply(this,arguments)}return _createClass$e(n,[{key:"sqrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}]),n}(FunctionPlugin);SqrtPlugin.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var _marked$1=regeneratorRuntime.mark(empty);
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */function empty(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),_marked$1)}function split(e){var t=e[Symbol.iterator](),n=t.next(),r=n.done,a=n.value;return r?{rest:empty()}:{value:a,rest:t}}var _marked=regeneratorRuntime.mark(getRangeValues),_marked2=regeneratorRuntime.mark(ifFilter);function _slicedToArray$1(e,t){return _arrayWithHoles$1(e)||_iterableToArrayLimit$1(e,t)||_unsupportedIterableToArray$6(e,t)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit$1(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles$1(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper$5(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$6(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$6(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$6(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$6(e,t):void 0}}function _arrayLikeToArray$6(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$d(e,t,n){return t&&_defineProperties$d(e.prototype,t),n&&_defineProperties$d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var findSmallerRangeForMany=function(e,t,n){if(n.end.row>n.start.row){var r=simpleCellAddress(n.end.sheet,n.end.col,n.end.row-1),a=e.getRange(n.start,r);if(void 0!==a)return{smallerRangeVertex:a,restValuesRange:n.withStart(simpleCellAddress(n.start.sheet,n.start.col,n.end.row)),restConditionRanges:t.map((function(e){return e.withStart(simpleCellAddress(e.start.sheet,e.start.col,e.end.row))}))}}return{restValuesRange:n,restConditionRanges:t}},CriterionFunctionCompute=function(){function e(t,n,r,a,i){_classCallCheck$d(this,e),this.interpreter=t,this.cacheKey=n,this.reduceInitialValue=r,this.composeFunction=a,this.mapFunction=i,this.dependencyGraph=this.interpreter.dependencyGraph}return _createClass$d(e,[{key:"compute",value:function(e,t){var n,r=this,a=_createForOfIteratorHelper$5(t);try{for(a.s();!(n=a.n()).done;){if(!n.value.conditionRange.sameDimensionsAs(e))return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength)}}catch(e){a.e(e)}finally{a.f()}var i=this.tryToGetRangeVertexForRangeValue(e),o=t.map((function(e){return r.tryToGetRangeVertexForRangeValue(e.conditionRange)}));if(i&&o.every((function(e){return void 0!==e}))){var s=t.map((function(e){return e.criterionPackage.raw})).join(","),l=this.findAlreadyComputedValueInCache(i,this.cacheKey(t),s);if(void 0!==l)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),l;var u=this.buildNewCriterionCache(this.cacheKey(t),t.map((function(e){return e.conditionRange.range})),e.range);return u.has(s)||u.set(s,[this.evaluateRangeValue(e,t),t.map((function(e){return e.criterionPackage.lambda}))]),i.setCriterionFunctionValues(this.cacheKey(t),u),o.forEach((function(e){void 0!==e&&e.addDependentCacheRange(i)})),u.get(s)[0]}return this.evaluateRangeValue(e,t)}},{key:"tryToGetRangeVertexForRangeValue",value:function(e){var t=e.range;return void 0===t?void 0:this.dependencyGraph.getRange(t.start,t.end)}},{key:"reduceFunction",value:function(e){var t,n=this.reduceInitialValue,r=_createForOfIteratorHelper$5(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n=this.composeFunction(n,a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"findAlreadyComputedValueInCache",value:function(e,t,n){return e.getCriterionFunctionValue(t,n)}},{key:"evaluateRangeValue",value:function(e,t){var n=t.map((function(e){return e.criterionPackage.lambda})),r=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),a=ifFilter(n,t.map((function(e){return e.conditionRange.iterateValuesFromTopLeftCorner()})),r);return this.reduceFunction(a)}},{key:"buildNewCriterionCache",value:function(e,t,n){var r,a=this,i=this.dependencyGraph.getRange(n.start,n.end),o=findSmallerRangeForMany(this.dependencyGraph,t,n),s=o.smallerRangeVertex,l=o.restConditionRanges,u=o.restValuesRange;r=void 0!==s&&this.dependencyGraph.existsEdge(s,i)?s.getCriterionFunctionValues(e):new Map;var c=new Map;return r.forEach((function(e,t){var n=_slicedToArray$1(e,2),r=n[0],i=n[1],o=ifFilter(i,l.map((function(e){return getRangeValues(a.dependencyGraph,e)})),Array.from(getRangeValues(a.dependencyGraph,u)).map(a.mapFunction)[Symbol.iterator]()),s=a.composeFunction(r,a.reduceFunction(o));a.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),c.set(t,[s,i])})),c}}]),e}(),Condition=_createClass$d((function e(t,n){_classCallCheck$d(this,e),this.conditionRange=t,this.criterionPackage=n}));function getRangeValues(e,t){var n,r,a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=_createForOfIteratorHelper$5(t.addresses(e)),i.prev=1,n.s();case 3:if((r=n.n()).done){i.next=9;break}return a=r.value,i.next=7,getRawValue(e.getScalarValue(a));case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),n.e(i.t0);case 14:return i.prev=14,n.f(),i.finish(14);case 17:case"end":return i.stop()}}),_marked,null,[[1,11,14,17]])}function ifFilter(e,t,n){var r,a,i,o;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=_createForOfIteratorHelper$5(n),s.prev=1,r.s();case 3:if((a=r.n()).done){s.next=15;break}if(i=a.value,(o=t.map((function(e){return split(e)}))).every((function(e){return Object.prototype.hasOwnProperty.call(e,"value")}))){s.next=8;break}return s.abrupt("return");case 8:if(!zip(o.map((function(e){return e.value})),e).every((function(e){var t=_slicedToArray$1(e,2),n=t[0];return(0,t[1])(n)}))){s.next=12;break}return s.next=12,i;case 12:t=o.map((function(e){return e.rest}));case 13:s.next=3;break;case 15:s.next=20;break;case 17:s.prev=17,s.t0=s.catch(1),r.e(s.t0);case 20:return s.prev=20,r.f(),s.finish(20);case 23:case"end":return s.stop()}}),_marked2,null,[[1,17,20,23]])}function zip(e,t){for(var n=[],r=0;r<Math.min(e.length,t.length);r++)n.push([e[r],t[r]]);return n}function _typeof$c(e){return _typeof$c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$c(e)}function _inherits$c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$c(e,t)}function _setPrototypeOf$c(e,t){return _setPrototypeOf$c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$c(e,t)}function _createSuper$c(e){var t=_isNativeReflectConstruct$c();return function(){var n,r=_getPrototypeOf$c(e);if(t){var a=_getPrototypeOf$c(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$c(this,n)}}function _possibleConstructorReturn$c(e,t){if(t&&("object"===_typeof$c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$c(e)}function _assertThisInitialized$c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$c(e){return _getPrototypeOf$c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$c(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray$5(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$5(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$5(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray$5(e)}function _arrayLikeToArray$5(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$c(e,t,n){return t&&_defineProperties$c(e.prototype,t),n&&_defineProperties$c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var AverageResult=function(){function e(t,n){_classCallCheck$c(this,e),this.sum=t,this.count=n}return _createClass$c(e,[{key:"compose",value:function(t){return new e(this.sum+t.sum,this.count+t.count)}},{key:"averageValue",value:function(){return this.count>0?this.sum/this.count:void 0}}],[{key:"single",value:function(t){return new e(t,1)}}]),e}();function sumifCacheKey(e){var t=e.map((function(e){return"".concat(e.conditionRange.range.sheet,",").concat(e.conditionRange.range.start.col,",").concat(e.conditionRange.range.start.row)}));return["SUMIF"].concat(_toConsumableArray(t)).join(",")}function averageifCacheKey(e){var t=e.map((function(e){return"".concat(e.conditionRange.range.sheet,",").concat(e.conditionRange.range.start.col,",").concat(e.conditionRange.range.start.row)}));return["AVERAGEIF"].concat(_toConsumableArray(t)).join(",")}function countifsCacheKey(e){var t=e.map((function(e){return"".concat(e.conditionRange.range.sheet,",").concat(e.conditionRange.range.start.col,",").concat(e.conditionRange.range.start.row)}));return["COUNTIFS"].concat(_toConsumableArray(t)).join(",")}AverageResult.empty=new AverageResult(0,0);var SumifPlugin=function(e){_inherits$c(n,e);var t=_createSuper$c(n);function n(){return _classCallCheck$c(this,n),t.apply(this,arguments)}return _createClass$c(n,[{key:"sumif",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SUMIF"),(function(e,t,r){var a=n.interpreter.criterionBuilder.fromCellValue(t,n.arithmeticHelper);return void 0===a?new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion):(r=null!=r?r:e,new CriterionFunctionCompute(n.interpreter,sumifCacheKey,0,(function(e,t){return n.arithmeticHelper.nonstrictadd(e,t)}),(function(e){return getRawValue(e)})).compute(r,[new Condition(e,a)]))}))}},{key:"sumifs",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SUMIFS"),(function(e){for(var t=[],r=0;r<(arguments.length<=1?0:arguments.length-1);r+=2){var a=r+1<1||arguments.length<=r+1?void 0:arguments[r+1],i=n.interpreter.criterionBuilder.fromCellValue(r+1+1<1||arguments.length<=r+1+1?void 0:arguments[r+1+1],n.arithmeticHelper);if(void 0===i)return new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion);t.push(new Condition(a,i))}return new CriterionFunctionCompute(n.interpreter,sumifCacheKey,0,(function(e,t){return n.arithmeticHelper.nonstrictadd(e,t)}),(function(e){return getRawValue(e)})).compute(e,t)}))}},{key:"averageif",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("AVERAGEIF"),(function(e,t,r){var a=n.interpreter.criterionBuilder.fromCellValue(t,n.arithmeticHelper);if(void 0===a)return new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion);r=null!=r?r:e;var i=new CriterionFunctionCompute(n.interpreter,averageifCacheKey,AverageResult.empty,(function(e,t){return e.compose(t)}),(function(e){return isExtendedNumber(e)?AverageResult.single(getRawValue(e)):AverageResult.empty})).compute(r,[new Condition(e,a)]);return i instanceof CellError?i:i.averageValue()||new CellError(ErrorType.DIV_BY_ZERO)}))}},{key:"countif",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("COUNTIF"),(function(e,t){var r=n.interpreter.criterionBuilder.fromCellValue(t,n.arithmeticHelper);return void 0===r?new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion):new CriterionFunctionCompute(n.interpreter,(function(){return"COUNTIF"}),0,(function(e,t){return e+t}),(function(){return 1})).compute(e,[new Condition(e,r)])}))}},{key:"countifs",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("COUNTIFS"),(function(){for(var e=[],t=0;t<arguments.length;t+=2){var r=t<0||arguments.length<=t?void 0:arguments[t],a=n.interpreter.criterionBuilder.fromCellValue(t+1<0||arguments.length<=t+1?void 0:arguments[t+1],n.arithmeticHelper);if(void 0===a)return new CellError(ErrorType.VALUE,ErrorMessage.BadCriterion);e.push(new Condition(r,a))}return new CriterionFunctionCompute(n.interpreter,countifsCacheKey,0,(function(e,t){return e+t}),(function(){return 1})).compute(e[0].conditionRange,e)}))}}]),n}(FunctionPlugin);function _typeof$b(e){return _typeof$b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$b(e)}function _createForOfIteratorHelper$4(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$4(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$4(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$b(e,t,n){return t&&_defineProperties$b(e.prototype,t),n&&_defineProperties$b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$b(e,t)}function _setPrototypeOf$b(e,t){return _setPrototypeOf$b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$b(e,t)}function _createSuper$b(e){var t=_isNativeReflectConstruct$b();return function(){var n,r=_getPrototypeOf$b(e);if(t){var a=_getPrototypeOf$b(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$b(this,n)}}function _possibleConstructorReturn$b(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$b(e)}function _assertThisInitialized$b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$b(e){return _getPrototypeOf$b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$b(e)}SumifPlugin.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NOERROR}],repeatLastArgs:2}};var SumprodPlugin=function(e){_inherits$b(n,e);var t=_createSuper$b(n);function n(){return _classCallCheck$b(this,n),t.apply(this,arguments)}return _createClass$b(n,[{key:"sumproduct",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var a=t[0].width(),i=t[0].height(),o=0,s=t;o<s.length;o++){var l=s[o];if(l.width()!==a||l.height()!==i)return new CellError(ErrorType.VALUE,ErrorMessage.EqualLength)}for(var u=0,c=t.map((function(e){return e.iterateValuesFromTopLeftCorner()})),p=0;p<a*i;p++){var d,m=1,f=_createForOfIteratorHelper$4(c);try{for(f.s();!(d=f.n()).done;){var h=d.value,y=h.next().value;if(y instanceof CellError)return y;var b=n.coerceScalarToNumberOrError(y);isExtendedNumber(b)?m*=getRawValue(b):m=0}}catch(e){f.e(e)}finally{f.f()}u+=m}return u}))}}]),n}(FunctionPlugin);SumprodPlugin.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:ArgumentTypes.RANGE}],repeatLastArgs:1}};var $$9=_export,repeat=stringRepeat;function _typeof$a(e){return _typeof$a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$a(e)}function _classCallCheck$a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$a(e,t,n){return t&&_defineProperties$a(e.prototype,t),n&&_defineProperties$a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$a(e,t)}function _setPrototypeOf$a(e,t){return _setPrototypeOf$a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$a(e,t)}function _createSuper$a(e){var t=_isNativeReflectConstruct$a();return function(){var n,r=_getPrototypeOf$a(e);if(t){var a=_getPrototypeOf$a(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$a(this,n)}}function _possibleConstructorReturn$a(e,t){if(t&&("object"===_typeof$a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$a(e)}function _assertThisInitialized$a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$a(e){return _getPrototypeOf$a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$a(e)}$$9({target:"String",proto:!0},{repeat:repeat});var TextPlugin=function(e){_inherits$a(n,e);var t=_createSuper$a(n);function n(){return _classCallCheck$a(this,n),t.apply(this,arguments)}return _createClass$a(n,[{key:"concatenate",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),(function(){var e;return(e="").concat.apply(e,arguments)}))}},{key:"split",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),(function(e,t){var n=e.split(" ");return t>=n.length||t<0?new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds):n[t]}))}},{key:"len",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),(function(e){return e.length}))}},{key:"lower",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),(function(e){return e.toLowerCase()}))}},{key:"trim",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),(function(e){return e.replace(/^ +| +$/g,"").replace(/ +/g," ")}))}},{key:"proper",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),(function(e){return e.replace(/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+/g,(function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}))}))}},{key:"clean",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),(function(e){return e.replace(/[\u0000-\u001F]/g,"")}))}},{key:"exact",value:function(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),(function(e,t){return e===t}))}},{key:"rept",value:function(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),(function(e,t){return t<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeCount):e.repeat(t)}))}},{key:"right",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),(function(e,t){return t<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):0===t?"":e.slice(-t)}))}},{key:"left",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),(function(e,t){return t<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):e.slice(0,t)}))}},{key:"mid",value:function(e,t){return this.runFunction(e.args,t,this.metadata("MID"),(function(e,t,n){return t<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):n<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):e.substring(t-1,t+n-1)}))}},{key:"replace",value:function(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),(function(e,t,n,r){return t<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):n<0?new CellError(ErrorType.VALUE,ErrorMessage.NegativeLength):e.substring(0,t-1)+r+e.substring(t+n-1)}))}},{key:"search",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SEARCH"),(function(e,t,r){if(r<1||r>t.length)return new CellError(ErrorType.VALUE,ErrorMessage.LengthBounds);var a,i=t.substring(r-1).toLowerCase();return a=n.arithmeticHelper.requiresRegex(e)?n.arithmeticHelper.searchString(e,i):i.indexOf(e.toLowerCase()),(a+=r)>0?a:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)}))}},{key:"substitute",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),(function(e,t,n,r){var a,i=new RegExp(t,"g");if(void 0===r)return e.replace(i,n);if(r<1)return new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne);for(var o=0;null!==(a=i.exec(e));)if(r===++o)return e.substring(0,a.index)+n+e.substring(i.lastIndex);return e}))}},{key:"find",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),(function(e,t,n){if(n<1||n>t.length)return new CellError(ErrorType.VALUE,ErrorMessage.IndexBounds);var r=t.substring(n-1).indexOf(e)+n;return r>0?r:new CellError(ErrorType.VALUE,ErrorMessage.PatternNotFound)}))}},{key:"t",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T"),(function(e){return e instanceof CellError||"string"==typeof e?e:""}))}},{key:"upper",value:function(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),(function(e){return e.toUpperCase()}))}}]),n}(FunctionPlugin);TextPlugin.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:ArgumentTypes.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:ArgumentTypes.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:ArgumentTypes.STRING}]},MID:{method:"mid",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:ArgumentTypes.STRING}]},T:{method:"t",parameters:[{argumentType:ArgumentTypes.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:ArgumentTypes.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:ArgumentTypes.STRING}]},REPT:{method:"rept",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.STRING},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:ArgumentTypes.STRING}]}};var $expm1=Math.expm1,exp$3=Math.exp,mathExpm1=!$expm1||$expm1(10)>22025.465794806718||$expm1(10)<22025.465794806718||-2e-17!=$expm1(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:exp$3(e)-1}:$expm1,$$8=_export,fails=fails$B,expm1$2=mathExpm1,abs$2=Math.abs,exp$2=Math.exp,E$3=Math.E,FORCED$1=fails((function(){return-2e-17!=Math.sinh(-2e-17)}));$$8({target:"Math",stat:!0,forced:FORCED$1},{sinh:function(e){return abs$2(e=+e)<1?(expm1$2(e)-expm1$2(-e))/2:(exp$2(e-1)-exp$2(-e-1))*(E$3/2)}});var $$7=_export,$asinh=Math.asinh,log$3=Math.log,sqrt$1=Math.sqrt;function asinh(e){return isFinite(e=+e)&&0!=e?e<0?-asinh(-e):log$3(e+sqrt$1(e*e+1)):e}$$7({target:"Math",stat:!0,forced:!($asinh&&1/$asinh(0)>0)},{asinh:asinh});var $$6=_export,expm1$1=mathExpm1,$cosh=Math.cosh,abs$1=Math.abs,E$2=Math.E;$$6({target:"Math",stat:!0,forced:!$cosh||$cosh(710)===1/0},{cosh:function(e){var t=expm1$1(abs$1(e)-1)+1;return(t+1/(t*E$2*E$2))*(E$2/2)}});var log$2=Math.log,mathLog1p=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:log$2(1+e)},$$5=_export,log1p=mathLog1p,$acosh=Math.acosh,log$1=Math.log,sqrt=Math.sqrt,LN2=Math.LN2,FORCED=!$acosh||710!=Math.floor($acosh(Number.MAX_VALUE))||$acosh(1/0)!=1/0;$$5({target:"Math",stat:!0,forced:FORCED},{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?log$1(e)+LN2:log1p(e-1+sqrt(e-1)*sqrt(e+1))}});var $$4=_export,expm1=mathExpm1,exp$1=Math.exp;$$4({target:"Math",stat:!0},{tanh:function(e){var t=expm1(e=+e),n=expm1(-e);return t==1/0?1:n==1/0?-1:(t-n)/(exp$1(e)+exp$1(-e))}});var $$3=_export,$atanh=Math.atanh,log=Math.log;function _typeof$9(e){return _typeof$9="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$9(e)}function _classCallCheck$9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$9(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$9(e,t,n){return t&&_defineProperties$9(e.prototype,t),n&&_defineProperties$9(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$9(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$9(e,t)}function _setPrototypeOf$9(e,t){return _setPrototypeOf$9=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$9(e,t)}function _createSuper$9(e){var t=_isNativeReflectConstruct$9();return function(){var n,r=_getPrototypeOf$9(e);if(t){var a=_getPrototypeOf$9(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$9(this,n)}}function _possibleConstructorReturn$9(e,t){if(t&&("object"===_typeof$9(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$9(e)}function _assertThisInitialized$9(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$9(e){return _getPrototypeOf$9=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$9(e)}$$3({target:"Math",stat:!0,forced:!($atanh&&1/$atanh(-0)<0)},{atanh:function(e){return 0==(e=+e)?e:log((1+e)/(1-e))/2}});var TrigonometryPlugin=function(e){_inherits$9(n,e);var t=_createSuper$9(n);function n(){return _classCallCheck$9(this,n),t.apply(this,arguments)}return _createClass$9(n,[{key:"acos",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}},{key:"asin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}},{key:"cos",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}},{key:"sin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}},{key:"tan",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}},{key:"atan",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}},{key:"atan2",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),(function(e,t){return 0===e&&0===t?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(t,e)}))}},{key:"cot",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COT"),(function(e){return 0===e?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tan(e)}))}},{key:"acot",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),(function(e){return 0===e?PI/2:Math.atan(1/e)}))}},{key:"sec",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),(function(e){return 1/Math.cos(e)}))}},{key:"csc",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),(function(e){return 0===e?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sin(e)}))}},{key:"sinh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}},{key:"asinh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}},{key:"cosh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}},{key:"acosh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}},{key:"tanh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}},{key:"atanh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}},{key:"coth",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),(function(e){return 0===e?new CellError(ErrorType.DIV_BY_ZERO):1/Math.tanh(e)}))}},{key:"acoth",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),(function(e){return 0===e?new CellError(ErrorType.NUM,ErrorMessage.NonZero):Math.atanh(1/e)}))}},{key:"sech",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),(function(e){return 1/Math.cosh(e)}))}},{key:"csch",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),(function(e){return 0===e?new CellError(ErrorType.DIV_BY_ZERO):1/Math.sinh(e)}))}}]),n}(FunctionPlugin);function _typeof$8(e){return _typeof$8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$8(e)}function _classCallCheck$8(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$8(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$8(e,t,n){return t&&_defineProperties$8(e.prototype,t),n&&_defineProperties$8(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$8(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$8(e,t)}function _setPrototypeOf$8(e,t){return _setPrototypeOf$8=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$8(e,t)}function _createSuper$8(e){var t=_isNativeReflectConstruct$8();return function(){var n,r=_getPrototypeOf$8(e);if(t){var a=_getPrototypeOf$8(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$8(this,n)}}function _possibleConstructorReturn$8(e,t){if(t&&("object"===_typeof$8(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$8(e)}function _assertThisInitialized$8(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$8(e){return _getPrototypeOf$8=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$8(e)}TrigonometryPlugin.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:ArgumentTypes.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:ArgumentTypes.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:ArgumentTypes.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:ArgumentTypes.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:ArgumentTypes.NUMBER}]}};var RowSearchStrategy=function(e){_inherits$8(n,e);var t=_createSuper$8(n);function n(e,r){var a;return _classCallCheck$8(this,n),(a=t.call(this,r)).config=e,a.dependencyGraph=r,a}return _createClass$8(n,[{key:"find",value:function(e,t,n){"string"==typeof e&&(e=forceNormalizeString(e));var r=t.range;return void 0===r?t.valuesFromTopLeftCorner().map(getRawValue).indexOf(e):n?rangeLowerBound(r,e,this.dependencyGraph,"col"):this.dependencyGraph.computeListOfValuesInRange(r).findIndex((function(t){return(t="string"==typeof(t=getRawValue(t))?forceNormalizeString(t):t)===e}))}}]),n}(AdvancedFind);function _typeof$7(e){return _typeof$7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$7(e)}function _classCallCheck$7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$7(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$7(e,t,n){return t&&_defineProperties$7(e.prototype,t),n&&_defineProperties$7(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$7(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$7(e,t)}function _setPrototypeOf$7(e,t){return _setPrototypeOf$7=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$7(e,t)}function _createSuper$7(e){var t=_isNativeReflectConstruct$7();return function(){var n,r=_getPrototypeOf$7(e);if(t){var a=_getPrototypeOf$7(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$7(this,n)}}function _possibleConstructorReturn$7(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$7(e)}function _assertThisInitialized$7(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$7(e){return _getPrototypeOf$7=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$7(e)}var LookupPlugin=function(e){_inherits$7(n,e);var t=_createSuper$7(n);function n(){var e;return _classCallCheck$7(this,n),(e=t.apply(this,arguments)).rowSearch=new RowSearchStrategy(e.config,e.dependencyGraph),e}return _createClass$7(n,[{key:"vlookup",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("VLOOKUP"),(function(e,t,r,a){var i=t.range;return void 0===i?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):r<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):r>i.width()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):n.doVlookup(zeroIfEmpty(e),t,r-1,a)}))}},{key:"hlookup",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("HLOOKUP"),(function(e,t,r,a){var i=t.range;return void 0===i?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):r<1?new CellError(ErrorType.VALUE,ErrorMessage.LessThanOne):r>i.height()?new CellError(ErrorType.REF,ErrorMessage.IndexLarge):n.doHlookup(zeroIfEmpty(e),t,r-1,a)}))}},{key:"match",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("MATCH"),(function(e,t,r){return n.doMatch(zeroIfEmpty(e),t,r)}))}},{key:"searchInRange",value:function(e,t,n,r){return!n&&"string"==typeof e&&this.arithmeticHelper.requiresRegex(e)?r.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t):r.find(e,t,n)}},{key:"doVlookup",value:function(e,t,n,r){this.dependencyGraph.stats.start(StatType.VLOOKUP);var a,i=t.range;a=void 0===i?SimpleRangeValue.onlyValues(t.data.map((function(e){return[e[0]]}))):SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(i.start,1,i.height()),this.dependencyGraph);var o,s=this.searchInRange(e,a,r,this.columnSearch);if(this.dependencyGraph.stats.end(StatType.VLOOKUP),-1===s)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);if(void 0===i)o=t.data[s][n];else{var l=simpleCellAddress(i.sheet,i.start.col+n,i.start.row+s);o=this.dependencyGraph.getCellValue(l)}return o instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):o}},{key:"doHlookup",value:function(e,t,n,r){var a,i=t.range;a=void 0===i?SimpleRangeValue.onlyValues([t.data[0]]):SimpleRangeValue.onlyRange(AbsoluteCellRange.spanFrom(i.start,i.width(),1),this.dependencyGraph);var o,s=this.searchInRange(e,a,r,this.rowSearch);if(-1===s)return new CellError(ErrorType.NA,ErrorMessage.ValueNotFound);if(void 0===i)o=t.data[n][s];else{var l=simpleCellAddress(i.sheet,i.start.col+s,i.start.row+n);o=this.dependencyGraph.getCellValue(l)}return o instanceof SimpleRangeValue?new CellError(ErrorType.VALUE,ErrorMessage.WrongType):o}},{key:"doMatch",value:function(e,t,n){if(t.width()>1&&t.height()>1)return new CellError(ErrorType.NA);if(1===t.width()){var r=this.columnSearch.find(e,t,0!==n);return-1===r?new CellError(ErrorType.NA,ErrorMessage.ValueNotFound):r+1}var a=this.rowSearch.find(e,t,0!==n);return-1===a?new CellError(ErrorType.NA,ErrorMessage.ValueNotFound):a+1}}]),n}(FunctionPlugin);function _typeof$6(e){return _typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$6(e)}function _classCallCheck$6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$6(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$6(e,t,n){return t&&_defineProperties$6(e.prototype,t),n&&_defineProperties$6(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$6(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$6(e,t)}function _setPrototypeOf$6(e,t){return _setPrototypeOf$6=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$6(e,t)}function _createSuper$6(e){var t=_isNativeReflectConstruct$6();return function(){var n,r=_getPrototypeOf$6(e);if(t){var a=_getPrototypeOf$6(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$6(this,n)}}function _possibleConstructorReturn$6(e,t){if(t&&("object"===_typeof$6(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$6(e)}function _assertThisInitialized$6(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$6(e){return _getPrototypeOf$6=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$6(e)}LookupPlugin.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN,defaultValue:!0}]},MATCH:{method:"match",parameters:[{argumentType:ArgumentTypes.NOERROR},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]}};var RomanPlugin=function(e){_inherits$6(n,e);var t=_createSuper$6(n);function n(){return _classCallCheck$6(this,n),t.apply(this,arguments)}return _createClass$6(n,[{key:"roman",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("ROMAN"),(function(e,t){return e=Math.trunc(e),!1===t?t=4:!0===t&&(t=0),(t=getRawValue(n.coerceScalarToNumberOrError(t)))instanceof CellError?t:(t=Math.trunc(t))<0?new CellError(ErrorType.VALUE,ErrorMessage.ValueSmall):t>4?new CellError(ErrorType.VALUE,ErrorMessage.ValueLarge):romanMode(e,t)}))}},{key:"arabic",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),(function(e){var t=!1;if((e=e.trim().toUpperCase()).startsWith("-")&&(t=!0,""===(e=e.slice(1))))return new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman);var n={input:e,acc:0};return eatToken(n,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),eatToken(n,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),eatToken(n,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),eatToken(n,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),eatToken(n,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),eatToken(n,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),eatToken(n,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),eatToken(n,{token:"IX",val:9}),eatToken(n,{token:"V",val:5},{token:"IV",val:4}),eatToken(n,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),""!==n.input?new CellError(ErrorType.VALUE,ErrorMessage.InvalidRoman):t?-n.acc:n.acc}))}}]),n}(FunctionPlugin);function eatToken(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if(e.input.startsWith(o.token)){e.input=e.input.slice(o.token.length),e.acc+=o.val;break}}}function romanMode(e,t){var n={val:e%1e3,acc:"M".repeat(Math.floor(e/1e3))};return 4===t&&(absorb(n,"IM",999,1e3),absorb(n,"ID",499,500)),t>=3&&(absorb(n,"VM",995,1e3),absorb(n,"VD",495,500)),t>=2&&(absorb(n,"XM",990,1e3),absorb(n,"XD",490,500)),t>=1&&(absorb(n,"LM",950,1e3),absorb(n,"LD",450,500)),absorb(n,"CM",900,1e3),absorb(n,"CD",400,500),absorb(n,"D",500,900),n.acc+="C".repeat(Math.floor(n.val/100)),n.val%=100,t>=2&&(absorb(n,"IC",99,100),absorb(n,"IL",49,50)),t>=1&&(absorb(n,"VC",95,100),absorb(n,"VL",45,50)),absorb(n,"XC",90,100),absorb(n,"XL",40,50),absorb(n,"L",50,90),n.acc+="X".repeat(Math.floor(n.val/10)),n.val%=10,absorb(n,"IX",9,10),absorb(n,"IV",4,5),absorb(n,"V",5,9),n.acc+="I".repeat(n.val),n.acc}function absorb(e,t,n,r){e.val>=n&&e.val<r&&(e.val-=n,e.acc+=t)}function _typeof$5(e){return _typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$5(e)}function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$5(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$5(e,t,n){return t&&_defineProperties$5(e.prototype,t),n&&_defineProperties$5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$5(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$5(e,t)}function _setPrototypeOf$5(e,t){return _setPrototypeOf$5=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$5(e,t)}function _createSuper$5(e){var t=_isNativeReflectConstruct$5();return function(){var n,r=_getPrototypeOf$5(e);if(t){var a=_getPrototypeOf$5(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$5(this,n)}}function _possibleConstructorReturn$5(e,t){if(t&&("object"===_typeof$5(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$5(e)}function _assertThisInitialized$5(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$5(e){return _getPrototypeOf$5=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$5(e)}RomanPlugin.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:1,lessThan:4e3},{argumentType:ArgumentTypes.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:ArgumentTypes.STRING}]}};var SimpleArithmerticPlugin=function(e){_inherits$5(n,e);var t=_createSuper$5(n);function n(){return _classCallCheck$5(this,n),t.apply(this,arguments)}return _createClass$5(n,[{key:"add",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}},{key:"concat",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}},{key:"divide",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}},{key:"eq",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}},{key:"gt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}},{key:"gte",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}},{key:"lt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}},{key:"lte",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}},{key:"minus",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}},{key:"multiply",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}},{key:"ne",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}},{key:"pow",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}},{key:"uminus",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}},{key:"upercent",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}},{key:"uplus",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}]),n}(FunctionPlugin);SimpleArithmerticPlugin.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:ArgumentTypes.STRING,passSubtype:!0},{argumentType:ArgumentTypes.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:ArgumentTypes.NOERROR,passSubtype:!0},{argumentType:ArgumentTypes.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0},{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:ArgumentTypes.NUMBER,passSubtype:!0}]}};
/**
   * @license
   bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

   Apache License
   Version 2.0, January 2004
   http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

   "License" shall mean the terms and conditions for use, reproduction,
   and distribution as defined by Sections 1 through 9 of this document.

   "Licensor" shall mean the copyright owner or entity authorized by
   the copyright owner that is granting the License.

   "Legal Entity" shall mean the union of the acting entity and all
   other entities that control, are controlled by, or are under common
   control with that entity. For the purposes of this definition,
   "control" means (i) the power, direct or indirect, to cause the
   direction or management of such entity, whether by contract or
   otherwise, or (ii) ownership of fifty percent (50%) or more of the
   outstanding shares, or (iii) beneficial ownership of such entity.

   "You" (or "Your") shall mean an individual or Legal Entity
   exercising permissions granted by this License.

   "Source" form shall mean the preferred form for making modifications,
   including but not limited to software source code, documentation
   source, and configuration files.

   "Object" form shall mean any form resulting from mechanical
   transformation or translation of a Source form, including but
   not limited to compiled object code, generated documentation,
   and conversions to other media types.

   "Work" shall mean the work of authorship, whether in Source or
   Object form, made available under the License, as indicated by a
   copyright notice that is included in or attached to the work
   (an example is provided in the Appendix below).

   "Derivative Works" shall mean any work, whether in Source or Object
   form, that is based on (or derived from) the Work and for which the
   editorial revisions, annotations, elaborations, or other modifications
   represent, as a whole, an original work of authorship. For the purposes
   of this License, Derivative Works shall not include works that remain
   separable from, or merely link (or bind by name) to the interfaces of,
   the Work and Derivative Works thereof.

   "Contribution" shall mean any work of authorship, including
   the original version of the Work and any modifications or additions
   to that Work or Derivative Works thereof, that is intentionally
   submitted to Licensor for inclusion in the Work by the copyright owner
   or by an individual or Legal Entity authorized to submit on behalf of
   the copyright owner. For the purposes of this definition, "submitted"
   means any form of electronic, verbal, or written communication sent
   to the Licensor or its representatives, including but not limited to
   communication on electronic mailing lists, source code control systems,
   and issue tracking systems that are managed by, or on behalf of, the
   Licensor for the purpose of discussing and improving the Work, but
   excluding communication that is conspicuously marked or otherwise
   designated in writing by the copyright owner as "Not a Contribution."

   "Contributor" shall mean Licensor and any individual or Legal Entity
   on behalf of whom a Contribution has been received by Licensor and
   subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
   this License, each Contributor hereby grants to You a perpetual,
   worldwide, non-exclusive, no-charge, royalty-free, irrevocable
   copyright license to reproduce, prepare Derivative Works of,
   publicly display, publicly perform, sublicense, and distribute the
   Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
   this License, each Contributor hereby grants to You a perpetual,
   worldwide, non-exclusive, no-charge, royalty-free, irrevocable
   (except as stated in this section) patent license to make, have made,
   use, offer to sell, sell, import, and otherwise transfer the Work,
   where such license applies only to those patent claims licensable
   by such Contributor that are necessarily infringed by their
   Contribution(s) alone or by combination of their Contribution(s)
   with the Work to which such Contribution(s) was submitted. If You
   institute patent litigation against any entity (including a
   cross-claim or counterclaim in a lawsuit) alleging that the Work
   or a Contribution incorporated within the Work constitutes direct
   or contributory patent infringement, then any patent licenses
   granted to You under this License for that Work shall terminate
   as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
   Work or Derivative Works thereof in any medium, with or without
   modifications, and in Source or Object form, provided that You
   meet the following conditions:

   (a) You must give any other recipients of the Work or
   Derivative Works a copy of this License; and

   (b) You must cause any modified files to carry prominent notices
   stating that You changed the files; and

   (c) You must retain, in the Source form of any Derivative Works
   that You distribute, all copyright, patent, trademark, and
   attribution notices from the Source form of the Work,
   excluding those notices that do not pertain to any part of
   the Derivative Works; and

   (d) If the Work includes a "NOTICE" text file as part of its
   distribution, then any Derivative Works that You distribute must
   include a readable copy of the attribution notices contained
   within such NOTICE file, excluding those notices that do not
   pertain to any part of the Derivative Works, in at least one
   of the following places: within a NOTICE text file distributed
   as part of the Derivative Works; within the Source form or
   documentation, if provided along with the Derivative Works; or,
   within a display generated by the Derivative Works, if and
   wherever such third-party notices normally appear. The contents
   of the NOTICE file are for informational purposes only and
   do not modify the License. You may add Your own attribution
   notices within Derivative Works that You distribute, alongside
   or as an addendum to the NOTICE text from the Work, provided
   that such additional attribution notices cannot be construed
   as modifying the License.

   You may add Your own copyright statement to Your modifications and
   may provide additional or different license terms and conditions
   for use, reproduction, or distribution of Your modifications, or
   for any such Derivative Works as a whole, provided Your use,
   reproduction, and distribution of the Work otherwise complies with
   the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
   names, trademarks, service marks, or product names of the Licensor,
   except as required for reasonable and customary use in describing the
   origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
   agreed to in writing, Licensor provides the Work (and each
   Contributor provides its Contributions) on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
   implied, including, without limitation, any warranties or conditions
   of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
   PARTICULAR PURPOSE. You are solely responsible for determining the
   appropriateness of using or redistributing the Work and assume any
   risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
   whether in tort (including negligence), contract, or otherwise,
   unless required by applicable law (such as deliberate and grossly
   negligent acts) or agreed to in writing, shall any Contributor be
   liable to You for damages, including any direct, indirect, special,
   incidental, or consequential damages of any character arising as a
   result of this License or out of the use or inability to use the
   Work (including but not limited to damages for loss of goodwill,
   work stoppage, computer failure or malfunction, or any and all
   other commercial damages or losses), even if such Contributor
   has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
   the Work or Derivative Works thereof, You may choose to offer,
   and charge a fee for, acceptance of support, warranty, indemnity,
   or other liability obligations and/or rights consistent with this
   License. However, in accepting such obligations, You may act only
   on Your own behalf and on Your sole responsibility, not on behalf
   of any other Contributor, and only if You agree to indemnify,
   defend, and hold each Contributor harmless for any liability
   incurred by, or claims asserted against, such Contributor by reason
   of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

   To apply the Apache License to your work, attach the following
   boilerplate notice, with the fields enclosed by brackets "{}"
   replaced with your own identifying information. (Don't include
   the brackets!)  The text should be enclosed in the appropriate
   comment syntax for the file format. We also recommend that a
   file or class name and description of purpose be included on the
   same "printed page" as the copyright notice for easier
   identification within third-party archives.

   Copyright (C) 2013-present   SheetJS LLC

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   */
var M$2=Math;function _horner(e,t){for(var n=0,r=0;n<e.length;++n)r=t*r+e[n];return r}function _bessel_iter(e,t,n,r,a){if(0===t)return n;if(1===t)return r;for(var i=2/e,o=r,s=1;s<t;++s)o=r*s*i+a*n,n=r,r=o;return o}function _bessel_wrap(e,t,n,r,a){return function(n,i){if(r){if(0===n)return 1==r?-1/0:1/0;if(n<0)return NaN}return 0===i?e(n):1===i?t(n):i<0?NaN:_bessel_iter(n,i|=0,e(n),t(n),a)}}var besselj=function(){var e=.636619772,t=[57568490574,-13362590354,651619640.7,-11214424.18,77392.33017,-184.9052456].reverse(),n=[57568490411,1029532985,9494680.718,59272.64853,267.8532712,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34935152e-8].reverse();function i(i){var o=0,s=0,l=0,u=i*i;if(i<8)o=(s=_horner(t,u))/(l=_horner(n,u));else{var c=i-.785398164;s=_horner(r,u=64/u),l=_horner(a,u),o=M$2.sqrt(e/i)*(M$2.cos(c)*s-M$2.sin(c)*l*8/i)}return o}var o=[72362614232,-7895059235,242396853.1,-2972611.439,15704.4826,-30.16036606].reverse(),s=[144725228442,2300535178,18583304.74,99447.43394,376.9991397,1].reverse(),l=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),u=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();function c(t){var n=0,r=0,a=0,i=t*t,c=M$2.abs(t)-2.356194491;return Math.abs(t)<8?n=(r=t*_horner(o,i))/(a=_horner(s,i)):(r=_horner(l,i=64/i),a=_horner(u,i),n=M$2.sqrt(e/M$2.abs(t))*(M$2.cos(c)*r-M$2.sin(c)*a*8/M$2.abs(t)),t<0&&(n=-n)),n}return function e(t,n){if(n=Math.round(n),!isFinite(t))return isNaN(t)?t:0;if(n<0)return(n%2?-1:1)*e(t,-n);if(t<0)return(n%2?-1:1)*e(-t,n);if(0===n)return i(t);if(1===n)return c(t);if(0===t)return 0;var r=0;if(t>n)r=_bessel_iter(t,n,i(t),c(t),-1);else{for(var a=!1,o=0,s=0,l=1,u=0,p=2/t,d=2*M$2.floor((n+M$2.floor(M$2.sqrt(40*n)))/2);d>0;d--)u=d*p*l-o,o=l,l=u,M$2.abs(l)>1e10&&(l*=1e-10,o*=1e-10,r*=1e-10,s*=1e-10),a&&(s+=l),a=!a,d==n&&(r=o);r/=s=2*s-l}return r}}(),bessely=function(){var e=.636619772,t=[-2957821389,7062834065,-512359803.6,10879881.29,-86327.92757,228.4622733].reverse(),n=[40076544269,745249964.8,7189466.438,47447.2647,226.1030244,1].reverse(),r=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34945152e-8].reverse();var i=[-4900604943e3,127527439e4,-51534381390,734926455.1,-4237922.726,8511.937935].reverse(),o=[249958057e5,424441966400,3733650367,22459040.02,102042.605,354.9632885,1].reverse(),s=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();return _bessel_wrap((function(i){var o=0,s=0,l=0,u=i*i,c=i-.785398164;return i<8?o=(s=_horner(t,u))/(l=_horner(n,u))+e*besselj(i,0)*M$2.log(i):(s=_horner(r,u=64/u),l=_horner(a,u),o=M$2.sqrt(e/i)*(M$2.sin(c)*s+M$2.cos(c)*l*8/i)),o}),(function(t){var n=0,r=0,a=0,u=t*t,c=t-2.356194491;return t<8?n=(r=t*_horner(i,u))/(a=_horner(o,u))+e*(besselj(t,1)*M$2.log(t)-1/t):(r=_horner(s,u=64/u),a=_horner(l,u),n=M$2.sqrt(e/t)*(M$2.sin(c)*r+M$2.cos(c)*a*8/t)),n}),"BESSELY",1,-1)}(),besseli=(b0_a=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),b0_b=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse(),b1_a=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),b1_b=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse(),function e(t,n){if(0===(n=Math.round(n)))return function(e){return e<=3.75?_horner(b0_a,e*e/14.0625):M$2.exp(M$2.abs(e))/M$2.sqrt(M$2.abs(e))*_horner(b0_b,3.75/M$2.abs(e))}(t);if(1===n)return function(e){return e<3.75?e*_horner(b1_a,e*e/14.0625):(e<0?-1:1)*M$2.exp(M$2.abs(e))/M$2.sqrt(M$2.abs(e))*_horner(b1_b,3.75/M$2.abs(e))}(t);if(n<0)return NaN;if(0===M$2.abs(t))return 0;if(t==1/0)return 1/0;var r,a=0,i=2/M$2.abs(t),o=0,s=1,l=0;for(r=2*M$2.round((n+M$2.round(M$2.sqrt(40*n)))/2);r>0;r--)l=r*i*s+o,o=s,s=l,M$2.abs(s)>1e10&&(s*=1e-10,o*=1e-10,a*=1e-10),r==n&&(a=o);return a*=e(t,0)/s,t<0&&n%2?-a:a}),b0_a,b0_b,b1_a,b1_b,besselk=function(){var e=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),t=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();var n=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),r=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();return _bessel_wrap((function(n){return n<=2?-M$2.log(n/2)*besseli(n,0)+_horner(e,n*n/4):M$2.exp(-n)/M$2.sqrt(n)*_horner(t,2/n)}),(function(e){return e<=2?M$2.log(e/2)*besseli(e,1)+1/e*_horner(n,e*e/4):M$2.exp(-e)/M$2.sqrt(e)*_horner(r,2/e)}),"BESSELK",2,1)}();
/**
   * @license
   Copyright (c) 2013 jStat

   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated documentation files (the "Software"), to deal
   in the Software without restriction, including without limitation the rights
   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the Software is
   furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included in
   all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   THE SOFTWARE.
   */
function erf(e){var t,n,r,a,i=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],o=i.length-1,s=!1,l=0,u=0;if(0===e)return 0;for(e<0&&(e=-e,s=!0),n=4*(t=2/(2+e))-2;o>0;o--)r=l,l=n*l-u+i[o],u=r;return a=t*Math.exp(-e*e+.5*(i[0]+n*l)-u),s?a-1:1-a}function erfc(e){return 1-erf(e)}function erfcinv(e){var t,n,r,a,i=0;if(e>=2)return-100;if(e<=0)return 100;for(a=e<1?e:2-e,t=-.70711*((2.30753+.27061*(r=Math.sqrt(-2*Math.log(a/2))))/(1+r*(.99229+.04481*r))-r);i<2;i++)t+=(n=erfc(t)-a)/(1.1283791670955126*Math.exp(-t*t)-t*n);return e<1?t:-t}var exponential={pdf:function(e,t){return e<0?0:t*Math.exp(-t*e)},cdf:function(e,t){return e<0?0:1-Math.exp(-t*e)}};function gammafn(e){var t,n,r,a,i=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],o=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],s=!1,l=0,u=0,c=0,p=e;if(e>171.6243769536076)return 1/0;if(p<=0){if(!(a=p%1))return 1/0;s=(1&p?-1:1)*Math.PI/Math.sin(Math.PI*a),p=1-p}for(r=p,n=p<1?p++:(p-=l=(0|p)-1)-1,t=0;t<8;++t)c=(c+i[t])*n,u=u*n+o[t];if(a=c/u+1,r<p)a/=r;else if(r>p)for(t=0;t<l;++t)a*=p,p++;return s&&(a=s/a),a}var gamma={pdf:function(e,t,n){return e<0?0:0===e&&1===t?1/n:Math.exp((t-1)*Math.log(e)-e/n-gammaln(t)-t*Math.log(n))},cdf:function(e,t,n){return e<0?0:lowRegGamma(t,e/n)},inv:function(e,t,n){return gammapinv(e,t)*n}};function gammaln(e){var t,n,r,a=0,i=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],o=1.000000000190015;for(r=(n=t=e)+5.5,r-=(t+.5)*Math.log(r);a<6;a++)o+=i[a]/++n;return Math.log(2.5066282746310007*o/t)-r}function lowRegGamma(e,t){var n,r=gammaln(e),a=e,i=1/e,o=i,s=t+1-e,l=1/1e-30,u=1/s,c=u,p=1,d=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17);if(t<0||e<=0)return NaN;if(t<e+1){for(;p<=d;p++)i+=o*=t/++a;return i*Math.exp(-t+e*Math.log(t)-r)}for(;p<=d;p++)c*=(u=1/(u=(n=-p*(p-e))*u+(s+=2)))*(l=s+n/l);return 1-c*Math.exp(-t+e*Math.log(t)-r)}function gammapinv(e,t){var n,r,a,i,o,s,l=0,u=t-1,c=gammaln(t);if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(e<=0)return 0;for(t>1?(o=Math.log(u),s=Math.exp(u*(o-1)-c),i=e<.5?e:1-e,n=(2.30753+.27061*(r=Math.sqrt(-2*Math.log(i))))/(1+r*(.99229+.04481*r))-r,e<.5&&(n=-n),n=Math.max(.001,t*Math.pow(1-1/(9*t)-n/(3*Math.sqrt(t)),3))):n=e<(r=1-t*(.253+.12*t))?Math.pow(e/r,1/t):1-Math.log(1-(e-r)/(1-r));l<12;l++){if(n<=0)return 0;if((n-=r=(a=(lowRegGamma(t,n)-e)/(r=t>1?s*Math.exp(-(n-u)+u*(Math.log(n)-o)):Math.exp(-n+u*Math.log(n)-c)))/(1-.5*Math.min(1,a*((t-1)/n-1))))<=0&&(n=.5*(n+r)),Math.abs(r)<1e-8*n)break}return n}var normal={pdf:function(e,t,n){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(n)-Math.pow(e-t,2)/(2*n*n))},cdf:function(e,t,n){return.5*(1+erf((e-t)/Math.sqrt(2*n*n)))},inv:function(e,t,n){return-1.4142135623730951*n*erfcinv(2*e)+t}},beta={pdf:function(e,t,n){return e>1||e<0?0:1==t&&1==n?1:t<512&&n<512?Math.pow(e,t-1)*Math.pow(1-e,n-1)/betafn(t,n):Math.exp((t-1)*Math.log(e)+(n-1)*Math.log(1-e)-betaln(t,n))},cdf:function(e,t,n){return e>1||e<0?+(e>1):ibeta(e,t,n)},inv:function(e,t,n){return ibetainv(e,t,n)}};function betafn(e,t){if(!(e<=0||t<=0))return e+t>170?Math.exp(betaln(e,t)):gammafn(e)*gammafn(t)/gammafn(e+t)}function betaln(e,t){return gammaln(e)+gammaln(t)-gammaln(e+t)}function ibetainv(e,t,n){var r,a,i,o,s,l,u,c,p,d,m=t-1,f=n-1,h=0;if(e<=0)return 0;if(e>=1)return 1;for(t>=1&&n>=1?(i=e<.5?e:1-e,l=(2.30753+.27061*(o=Math.sqrt(-2*Math.log(i))))/(1+o*(.99229+.04481*o))-o,e<.5&&(l=-l),u=(l*l-3)/6,c=2/(1/(2*t-1)+1/(2*n-1)),p=l*Math.sqrt(u+c)/c-(1/(2*n-1)-1/(2*t-1))*(u+5/6-2/(3*c)),l=t/(t+n*Math.exp(2*p))):(r=Math.log(t/(t+n)),a=Math.log(n/(t+n)),l=e<(o=Math.exp(t*r)/t)/(p=o+(s=Math.exp(n*a)/n))?Math.pow(t*p*e,1/t):1-Math.pow(n*p*(1-e),1/n)),d=-gammaln(t)-gammaln(n)+gammaln(t+n);h<10;h++){if(0===l||1===l)return l;if((l-=o=(s=(ibeta(l,t,n)-e)/(o=Math.exp(m*Math.log(l)+f*Math.log(1-l)+d)))/(1-.5*Math.min(1,s*(m/l-f/(1-l)))))<=0&&(l=.5*(l+o)),l>=1&&(l=.5*(l+o+1)),Math.abs(o)<1e-8*l&&h>0)break}return l}function ibeta(e,t,n){var r=0===e||1===e?0:Math.exp(gammaln(t+n)-gammaln(t)-gammaln(n)+t*Math.log(e)+n*Math.log(1-e));return!(e<0||e>1)&&(e<(t+1)/(t+n+2)?r*betacf(e,t,n)/t:1-r*betacf(1-e,n,t)/n)}function betacf(e,t,n){var r,a,i,o,s=1e-30,l=1,u=t+n,c=t+1,p=t-1,d=1,m=1-u*e/c;for(Math.abs(m)<s&&(m=s),o=m=1/m;l<=100&&(m=1+(a=l*(n-l)*e/((p+(r=2*l))*(t+r)))*m,Math.abs(m)<s&&(m=s),d=1+a/d,Math.abs(d)<s&&(d=s),o*=(m=1/m)*d,m=1+(a=-(t+l)*(u+l)*e/((t+r)*(c+r)))*m,Math.abs(m)<s&&(m=s),d=1+a/d,Math.abs(d)<s&&(d=s),o*=i=(m=1/m)*d,!(Math.abs(i-1)<3e-7));l++);return o}var binomial={pdf:function(e,t,n){return 0===n||1===n?t*n===e?1:0:combination(t,e)*Math.pow(n,e)*Math.pow(1-n,t-e)},cdf:function(e,t,n){var r,a=1e-10;if(e<0)return 0;if(e>=t)return 1;if(n<0||n>1||t<=0)return NaN;var i=n,o=(e=Math.floor(e))+1,s=t-e,l=o+s,u=Math.exp(gammaln(l)-gammaln(s)-gammaln(o)+o*Math.log(i)+s*Math.log(1-i));return r=i<(o+1)/(l+2)?u*betinc(i,o,s,a):1-u*betinc(1-i,s,o,a),Math.round(1/a*(1-r))/(1/a)}};function betinc(e,t,n,r){for(var a,i=0,o=1,s=1,l=1,u=0,c=0;Math.abs((s-c)/s)>r;)c=s,o=l+(a=-(t+u)*(t+n+u)*e/(t+2*u)/(t+2*u+1))*o,s=(i=s+a*i)+(a=(u+=1)*(n-u)*e/(t+2*u-1)/(t+2*u))*s,i/=l=o+a*l,o/=l,s/=l,l=1;return s/t}function combination(e,t){return e>170||t>170?Math.exp(combinationln(e,t)):factorial(e)/factorial(t)/factorial(e-t)}function combinationln(e,t){return factorialln(e)-factorialln(t)-factorialln(e-t)}function factorialln(e){return e<0?NaN:gammaln(e+1)}function factorial(e){return e<0?NaN:gammafn(e+1)}var chisquare={pdf:function(e,t){return e<0?0:0===e&&2===t?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-gammaln(t/2))},cdf:function(e,t){return e<0?0:lowRegGamma(t/2,e/2)},inv:function(e,t){return 2*gammapinv(e,.5*t)}},centralF={pdf:function(e,t,n){var r;return e<0?0:t<=2?0===e&&t<2?1/0:0===e&&2===t?1:1/betafn(t/2,n/2)*Math.pow(t/n,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/n*e,-(t+n)/2):(r=t*e/(n+e*t),t*(n/(n+e*t))/2*binomial.pdf((t-2)/2,(t+n-2)/2,r))},cdf:function(e,t,n){return e<0?0:ibeta(t*e/(t*e+n),t/2,n/2)},inv:function(e,t,n){return n/(t*(1/ibetainv(e,t/2,n/2)-1))}},weibull={pdf:function(e,t,n){return e<0||t<0||n<0?0:n/t*Math.pow(e/t,n-1)*Math.exp(-Math.pow(e/t,n))},cdf:function(e,t,n){return e<0?0:1-Math.exp(-Math.pow(e/t,n))}},poisson={pdf:function(e,t){return t<0||e%1!=0||e<0?0:Math.pow(t,e)*Math.exp(-t)/factorial(e)},cdf:function(e,t){var n=0;if(e<0)return 0;for(var r=0;n<=e;n++)r+=poisson.pdf(n,t);return r}},hypgeom={pdf:function(e,t,n,r){if(e<0||e<n-(t-r))return 0;if(e>r||e>n)return 0;if(2*n>t)return 2*r>t?hypgeom.pdf(t-n-r+e,t,t-n,t-r):hypgeom.pdf(r-e,t,t-n,r);if(2*r>t)return hypgeom.pdf(n-e,t,n,t-r);if(n<r)return hypgeom.pdf(e,t,r,n);for(var a=1,i=0,o=0;o<e;o++){for(;a>1&&i<r;)a*=1-n/(t-i),i++;a*=(r-o)*(n-o)/((o+1)*(t-n-r+o+1))}for(;i<r;i++)a*=1-n/(t-i);return Math.min(1,Math.max(0,a))},cdf:function e(t,n,r,a){if(t<0||t<r-(n-a))return 0;if(t>=a||t>=r)return 1;if(2*r>n)return 2*a>n?e(n-r-a+t,n,n-r,n-a):1-hypgeom.cdf(a-t-1,n,n-r,a);if(2*a>n)return 1-hypgeom.cdf(r-t-1,n,r,n-a);if(r<a)return hypgeom.cdf(t,n,a,r);for(var i=1,o=1,s=0,l=0;l<t;l++){for(;i>1&&s<a;){var u=1-r/(n-s);o*=u,i*=u,s++}i+=o*=(a-l)*(r-l)/((l+1)*(n-r-a+l+1))}for(;s<a;s++)i*=1-r/(n-s);return Math.min(1,Math.max(0,i))}},studentt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*betafn(.5,t/2))*Math.pow(1+e*e/t,-(t+1)/2)},cdf:function(e,t){var n=t/2;return ibeta((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),n,n)},inv:function(e,t){var n=ibetainv(2*Math.min(e,1-e),.5*t,.5);return n=Math.sqrt(t*(1-n)/n),e>.5?n:-n}},lognormal={pdf:function(e,t,n){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(n)-Math.pow(Math.log(e)-t,2)/(2*n*n))},cdf:function(e,t,n){return e<0?0:.5+.5*erf((Math.log(e)-t)/Math.sqrt(2*n*n))},inv:function(e,t,n){return Math.exp(-1.4142135623730951*n*erfcinv(2*e)+t)}},negbin={pdf:function(e,t,n){return e===e>>>0&&(e<0?0:combination(e+t-1,t-1)*Math.pow(1-n,e)*Math.pow(n,t))},cdf:function(e,t,n){var r=0,a=0;if(e<0)return 0;for(;a<=e;a++)r+=negbin.pdf(a,t,n);return r}};function sum(e){for(var t=0,n=e.length;--n>=0;)t+=e[n];return t}function mean(e){return sum(e)/e.length}function sumsqerr(e){for(var t,n=mean(e),r=0,a=e.length;--a>=0;)r+=(t=e[a]-n)*t;return r}function variance(e,t){return sumsqerr(e)/(e.length-(t?1:0))}function stdev(e,t){return Math.sqrt(variance(e,t))}function normalci(){var e,t=[].slice.call(arguments),n=new Array(2);return e=4===t.length?Math.abs(normal.inv(t[1]/2,0,1)*t[2]/Math.sqrt(t[3])):Math.abs(normal.inv(t[1]/2,0,1)*stdev(t[2])/Math.sqrt(t[2].length)),n[0]=t[0]-e,n[1]=t[0]+e,n}function tci(){var e,t=[].slice.call(arguments),n=new Array(2);return e=4===t.length?Math.abs(studentt.inv(t[1]/2,t[3]-1)*t[2]/Math.sqrt(t[3])):Math.abs(studentt.inv(t[1]/2,t[2].length-1)*stdev(t[2],!0)/Math.sqrt(t[2].length)),n[0]=t[0]-e,n[1]=t[0]+e,n}function product(e){for(var t=1,n=e.length;--n>=0;)t*=e[n];return t}function geomean(e){return Math.pow(product(e),1/e.length)}function covariance(e,t){var n,r=mean(e),a=mean(t),i=e.length,o=new Array(i);for(n=0;n<i;n++)o[n]=(e[n]-r)*(t[n]-a);return sum(o)/(i-1)}function corrcoeff(e,t){return covariance(e,t)/stdev(e,1)/stdev(t,1)}function _typeof$4(e){return _typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$4(e)}function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$4(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$4(e,t,n){return t&&_defineProperties$4(e.prototype,t),n&&_defineProperties$4(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$4(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$4(e,t)}function _setPrototypeOf$4(e,t){return _setPrototypeOf$4=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$4(e,t)}function _createSuper$4(e){var t=_isNativeReflectConstruct$4();return function(){var n,r=_getPrototypeOf$4(e);if(t){var a=_getPrototypeOf$4(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$4(this,n)}}function _possibleConstructorReturn$4(e,t){if(t&&("object"===_typeof$4(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$4(e)}function _assertThisInitialized$4(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$4(e){return _getPrototypeOf$4=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$4(e)}var StatisticalPlugin=function(e){_inherits$4(n,e);var t=_createSuper$4(n);function n(){return _classCallCheck$4(this,n),t.apply(this,arguments)}return _createClass$4(n,[{key:"erf",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),(function(e,t){return void 0===t?erf(e):erf(t)-erf(e)}))}},{key:"erfc",value:function(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),erfc)}},{key:"expondist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),(function(e,t,n){return n?exponential.cdf(e,t):exponential.pdf(e,t)}))}},{key:"fisher",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),(function(e){return Math.log((1+e)/(1-e))/2}))}},{key:"fisherinv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),(function(e){return 1-2/(Math.exp(2*e)+1)}))}},{key:"gamma",value:function(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),gammafn)}},{key:"gammadist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),(function(e,t,n,r){return r?gamma.cdf(e,t,n):gamma.pdf(e,t,n)}))}},{key:"gammaln",value:function(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),gammaln)}},{key:"gammainv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),gamma.inv)}},{key:"gauss",value:function(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),(function(e){return normal.cdf(e,0,1)-.5}))}},{key:"betadist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),(function(e,t,n,r,a,i){return e<=a?new CellError(ErrorType.NUM,ErrorMessage.ValueSmall):e>=i?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(e=(e-a)/(i-a),r?beta.cdf(e,t,n):beta.pdf(e,t,n))}))}},{key:"betainv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),(function(e,t,n,r,a){return r>=a?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):beta.inv(e,t,n)*(a-r)+r}))}},{key:"binomialdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),(function(e,t,n,r){return e>t?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):(e=Math.trunc(e),t=Math.trunc(t),r?binomial.cdf(e,t,n):binomial.pdf(e,t,n))}))}},{key:"binomialinv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),(function(e,t,n){for(var r=-1,a=e=Math.trunc(e);a>r+1;){var i=Math.trunc((r+a)/2);binomial.cdf(i,e,t)>=n?a=i:r=i}return a}))}},{key:"besselifn",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),(function(e,t){return besseli(e,Math.trunc(t))}))}},{key:"besseljfn",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),(function(e,t){return besselj(e,Math.trunc(t))}))}},{key:"besselkfn",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),(function(e,t){return besselk(e,Math.trunc(t))}))}},{key:"besselyfn",value:function(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),(function(e,t){return bessely(e,Math.trunc(t))}))}},{key:"chisqdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),(function(e,t,n){return t=Math.trunc(t),n?chisquare.cdf(e,t):chisquare.pdf(e,t)}))}},{key:"chisqdistrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),(function(e,t){return 1-chisquare.cdf(e,Math.trunc(t))}))}},{key:"chisqinv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),(function(e,t){return chisquare.inv(e,Math.trunc(t))}))}},{key:"chisqinvrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),(function(e,t){return chisquare.inv(1-e,Math.trunc(t))}))}},{key:"fdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),(function(e,t,n,r){return t=Math.trunc(t),n=Math.trunc(n),r?centralF.cdf(e,t,n):centralF.pdf(e,t,n)}))}},{key:"fdistrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),(function(e,t,n){return 1-centralF.cdf(e,Math.trunc(t),Math.trunc(n))}))}},{key:"finv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),(function(e,t,n){return centralF.inv(e,Math.trunc(t),Math.trunc(n))}))}},{key:"finvrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),(function(e,t,n){return centralF.inv(1-e,Math.trunc(t),Math.trunc(n))}))}},{key:"weibulldist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),(function(e,t,n,r){return r?weibull.cdf(e,n,t):weibull.pdf(e,n,t)}))}},{key:"poissondist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),(function(e,t,n){return e=Math.trunc(e),n?poisson.cdf(e,t):poisson.pdf(e,t)}))}},{key:"hypgeomdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),(function(e,t,n,r,a){return e>t||e>n||t>r||n>r||e+r<n+t?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):(e=Math.trunc(e),t=Math.trunc(t),n=Math.trunc(n),r=Math.trunc(r),a?hypgeom.cdf(e,r,n,t):hypgeom.pdf(e,r,n,t))}))}},{key:"tdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),(function(e,t,n){return t=Math.trunc(t),n?studentt.cdf(e,t):studentt.pdf(e,t)}))}},{key:"tdist2t",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),(function(e,t){return 2*(1-studentt.cdf(e,Math.trunc(t)))}))}},{key:"tdistrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),(function(e,t){return 1-studentt.cdf(e,Math.trunc(t))}))}},{key:"tdistold",value:function(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),(function(e,t,n){return n*(1-studentt.cdf(e,Math.trunc(t)))}))}},{key:"tinv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),(function(e,t){return studentt.inv(e,Math.trunc(t))}))}},{key:"tinv2t",value:function(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),(function(e,t){return studentt.inv(1-e/2,Math.trunc(t))}))}},{key:"lognormdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),(function(e,t,n,r){return r?lognormal.cdf(e,t,n):lognormal.pdf(e,t,n)}))}},{key:"lognorminv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),(function(e,t,n){return lognormal.inv(e,t,n)}))}},{key:"normdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),(function(e,t,n,r){return r?normal.cdf(e,t,n):normal.pdf(e,t,n)}))}},{key:"norminv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),(function(e,t,n){return normal.inv(e,t,n)}))}},{key:"normsdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),(function(e,t){return t?normal.cdf(e,0,1):normal.pdf(e,0,1)}))}},{key:"normsinv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),(function(e){return normal.inv(e,0,1)}))}},{key:"phi",value:function(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),(function(e){return normal.pdf(e,0,1)}))}},{key:"negbinomdist",value:function(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),(function(e,t,n,r){return e=Math.trunc(e),t=Math.trunc(t),r?negbin.cdf(e,t,n):negbin.pdf(e,t,n)}))}},{key:"confidencenorm",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),(function(e,t,n){return normalci(1,e,t,Math.trunc(n))[1]-1}))}},{key:"confidencet",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),(function(e,t,n){return 1===(n=Math.trunc(n))?new CellError(ErrorType.DIV_BY_ZERO):tci(1,e,t,n)[1]-1}))}},{key:"standardize",value:function(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),(function(e,t,n){return(e-t)/n}))}}]),n}(FunctionPlugin);StatisticalPlugin.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:ArgumentTypes.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:0},{argumentType:ArgumentTypes.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10},{argumentType:ArgumentTypes.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,maxValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:ArgumentTypes.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:1},{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:1},{argumentType:ArgumentTypes.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:ArgumentTypes.NUMBER,greaterThan:0,lessThan:1},{argumentType:ArgumentTypes.NUMBER,greaterThan:0},{argumentType:ArgumentTypes.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,greaterThan:0}]}},StatisticalPlugin.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"};var $$2=_export;function _typeof$3(e){return _typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$3(e)}function _createForOfIteratorHelper$3(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$3(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$3(e,t,n){return t&&_defineProperties$3(e.prototype,t),n&&_defineProperties$3(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$3(e,t)}function _setPrototypeOf$3(e,t){return _setPrototypeOf$3=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$3(e,t)}function _createSuper$3(e){var t=_isNativeReflectConstruct$3();return function(){var n,r=_getPrototypeOf$3(e);if(t){var a=_getPrototypeOf$3(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$3(this,n)}}function _possibleConstructorReturn$3(e,t){if(t&&("object"===_typeof$3(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$3(e)}function _assertThisInitialized$3(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$3(e){return _getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$3(e)}$$2({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var MathPlugin=function(e){_inherits$3(n,e);var t=_createSuper$3(n);function n(){return _classCallCheck$3(this,n),t.apply(this,arguments)}return _createClass$3(n,[{key:"fact",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),(function(e){e=Math.trunc(e);for(var t=1,n=1;n<=e;n++)t*=n;return t}))}},{key:"factdouble",value:function(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),(function(e){for(var t=1,n=e=Math.trunc(e);n>=1;n-=2)t*=n;return t}))}},{key:"combin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),(function(e,t){return t>e?new CellError(ErrorType.NUM,ErrorMessage.WrongOrder):_combin(e=Math.trunc(e),t=Math.trunc(t))}))}},{key:"combina",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),(function(e,t){return(e=Math.trunc(e))+(t=Math.trunc(t))-1>=1030?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):0===e&&0===t?1:_combin(e+t-1,t)}))}},{key:"gcd",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("GCD"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(t);if(a instanceof CellError)return a;var i,o=0,s=_createForOfIteratorHelper$3(a);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(l<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);o=binaryGCD(o,Math.trunc(l))}}catch(e){s.e(e)}finally{s.f()}return o>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o}))}},{key:"lcm",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("LCM"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(t);if(a instanceof CellError)return a;var i,o=1,s=_createForOfIteratorHelper$3(a);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(l<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);o=binaryLCM(o,Math.trunc(l))}}catch(e){s.e(e)}finally{s.f()}return o>Number.MAX_SAFE_INTEGER?new CellError(ErrorType.NUM,ErrorMessage.ValueLarge):o}))}},{key:"mround",value:function(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),(function(e,t){return 0===t?0:e>0&&t<0||e<0&&t>0?new CellError(ErrorType.NUM,ErrorMessage.DistinctSigns):Math.round(e/t)*t}))}},{key:"multinomial",value:function(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),(function(){for(var e=0,t=1,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];if(s<0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall);s=Math.trunc(s);for(var l=1;l<=s;l++)t*=(e+l)/l;e+=s}return Math.round(t)}))}},{key:"quotient",value:function(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),(function(e,t){return 0===t?new CellError(ErrorType.DIV_BY_ZERO):Math.trunc(e/t)}))}},{key:"seriessum",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SERIESSUM"),(function(e,t,r,a){var i=n.arithmeticHelper.manyToOnlyNumbersDropNulls(a.valuesFromTopLeftCorner());if(i instanceof CellError)return i;var o=0;i.reverse();var s,l=_createForOfIteratorHelper$3(i);try{for(l.s();!(s=l.n()).done;){var u=s.value;o*=Math.pow(e,r),o+=u}}catch(e){l.e(e)}finally{l.f()}return o*Math.pow(e,t)}))}},{key:"sign",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),(function(e){return e>0?1:e<0?-1:0}))}},{key:"sumx2my2",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),(function(e,t){var n=e.valuesFromTopLeftCorner(),r=t.valuesFromTopLeftCorner();if(n.length!==r.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);for(var a=n.length,i=0,o=0;o<a;o++){var s=n[o],l=r[o];if(s instanceof CellError)return s;if(l instanceof CellError)return l;"number"==typeof s&&"number"==typeof l&&(i+=Math.pow(s,2)-Math.pow(l,2))}return i}))}},{key:"sumx2py2",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),(function(e,t){var n=e.valuesFromTopLeftCorner(),r=t.valuesFromTopLeftCorner();if(n.length!==r.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);for(var a=n.length,i=0,o=0;o<a;o++){var s=n[o],l=r[o];if(s instanceof CellError)return s;if(l instanceof CellError)return l;"number"==typeof s&&"number"==typeof l&&(i+=Math.pow(s,2)+Math.pow(l,2))}return i}))}},{key:"sumxmy2",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),(function(e,t){var n=e.valuesFromTopLeftCorner(),r=t.valuesFromTopLeftCorner();if(n.length!==r.length)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);for(var a=n.length,i=0,o=0;o<a;o++){var s=n[o],l=r[o];if(s instanceof CellError)return s;if(l instanceof CellError)return l;"number"==typeof s&&"number"==typeof l&&(i+=Math.pow(s-l,2))}return i}))}}]),n}(FunctionPlugin);function _combin(e,t){2*t>e&&(t=e-t);for(var n=1,r=1;r<=t;r++)n*=(e-t+r)/r;return Math.round(n)}function binaryGCD(e,t){if(e<t){var n=[t,e];e=n[0],t=n[1]}for(;t>0;){var r=[t,e%t];e=r[0],t=r[1]}return e}function binaryLCM(e,t){return 0===e||0===t?0:e*(t/binaryGCD(e,t))}function _typeof$2(e){return _typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$2(e)}function _createForOfIteratorHelper$2(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$2(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$2(e,t,n){return t&&_defineProperties$2(e.prototype,t),n&&_defineProperties$2(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$2(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$2(e,t)}function _setPrototypeOf$2(e,t){return _setPrototypeOf$2=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$2(e,t)}function _createSuper$2(e){var t=_isNativeReflectConstruct$2();return function(){var n,r=_getPrototypeOf$2(e);if(t){var a=_getPrototypeOf$2(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$2(this,n)}}function _possibleConstructorReturn$2(e,t){if(t&&("object"===_typeof$2(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$2(e)}function _assertThisInitialized$2(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$2(e){return _getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$2(e)}MathPlugin.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0,lessThan:1030},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:ArgumentTypes.NUMBER,minValue:0},{argumentType:ArgumentTypes.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:ArgumentTypes.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:ArgumentTypes.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]}};var ComplexPlugin=function(e){_inherits$2(n,e);var t=_createSuper$2(n);function n(){return _classCallCheck$2(this,n),t.apply(this,arguments)}return _createClass$2(n,[{key:"complex",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),(function(e,t,n){return"i"!==n&&"j"!==n?new CellError(ErrorType.VALUE,ErrorMessage.ShouldBeIorJ):coerceComplexToString([e,t],n)}))}},{key:"imabs",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),abs)}},{key:"imaginary",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),(function(e){var t=_slicedToArray(e,2);return t[0],t[1]}))}},{key:"imreal",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),(function(e){var t=_slicedToArray(e,2),n=t[0];return t[1],n}))}},{key:"imargument",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return 0===n&&0===r?new CellError(ErrorType.DIV_BY_ZERO):Math.atan2(r,n)}))}},{key:"imconjugate",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),(function(e){var t=_slicedToArray(e,2);return coerceComplexToString([t[0],-t[1]])}))}},{key:"imcos",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),(function(e){return coerceComplexToString(cos(e))}))}},{key:"imcosh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),(function(e){return coerceComplexToString(cosh(e))}))}},{key:"imcot",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),(function(e){return coerceComplexToString(div(cos(e),sin(e)))}))}},{key:"imcsc",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),(function(e){return coerceComplexToString(div([1,0],sin(e)))}))}},{key:"imcsch",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),(function(e){return coerceComplexToString(div([1,0],sinh(e)))}))}},{key:"imsec",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),(function(e){return coerceComplexToString(div([1,0],cos(e)))}))}},{key:"imsech",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),(function(e){return coerceComplexToString(div([1,0],cosh(e)))}))}},{key:"imsin",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),(function(e){return coerceComplexToString(sin(e))}))}},{key:"imsinh",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),(function(e){return coerceComplexToString(sinh(e))}))}},{key:"imtan",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),(function(e){return coerceComplexToString(div(sin(e),cos(e)))}))}},{key:"imdiv",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),(function(e,t){return coerceComplexToString(div(e,t))}))}},{key:"improduct",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceComplexExactRanges(t);if(a instanceof CellError)return a;var i,o=[1,0],s=_createForOfIteratorHelper$2(a);try{for(s.s();!(i=s.n()).done;){var l=i.value;o=mul(o,l)}}catch(e){s.e(e)}finally{s.f()}return coerceComplexToString(o)}))}},{key:"imsum",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("IMSUM"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceComplexExactRanges(t);if(a instanceof CellError)return a;var i,o=[0,0],s=_createForOfIteratorHelper$2(a);try{for(s.s();!(i=s.n()).done;){var l=i.value;o=add(o,l)}}catch(e){s.e(e)}finally{s.f()}return coerceComplexToString(o)}))}},{key:"imsub",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),(function(e,t){return coerceComplexToString(sub(e,t))}))}},{key:"imexp",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),(function(e){return coerceComplexToString(exp(e))}))}},{key:"imln",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),(function(e){return coerceComplexToString(ln$1(e))}))}},{key:"imlog10",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),(function(e){var t=_slicedToArray(ln$1(e),2),n=t[0],r=t[1],a=Math.log(10);return coerceComplexToString([n/a,r/a])}))}},{key:"imlog2",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),(function(e){var t=_slicedToArray(ln$1(e),2),n=t[0],r=t[1],a=Math.log(2);return coerceComplexToString([n/a,r/a])}))}},{key:"impower",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),(function(e,t){return coerceComplexToString(power(e,t))}))}},{key:"imsqrt",value:function(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),(function(e){return coerceComplexToString(power(e,.5))}))}}]),n}(FunctionPlugin);function add(e,t){var n=_slicedToArray(e,2),r=n[0],a=n[1],i=_slicedToArray(t,2);return[r+i[0],a+i[1]]}function sub(e,t){var n=_slicedToArray(e,2),r=n[0],a=n[1],i=_slicedToArray(t,2);return[r-i[0],a-i[1]]}function mul(e,t){var n=_slicedToArray(e,2),r=n[0],a=n[1],i=_slicedToArray(t,2),o=i[0],s=i[1];return[r*o-a*s,r*s+o*a]}function div(e,t){var n=_slicedToArray(e,2),r=n[0],a=n[1],i=_slicedToArray(t,2),o=i[0],s=i[1],l=Math.pow(o,2)+Math.pow(s,2),u=_slicedToArray(mul([r,a],[o,-s]),2);return[u[0]/l,u[1]/l]}function cos(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.cos(n)*Math.cosh(r),-Math.sin(n)*Math.sinh(r)]}function cosh(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.cosh(n)*Math.cos(r),Math.sinh(n)*Math.sin(r)]}function sin(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.sin(n)*Math.cosh(r),Math.cos(n)*Math.sinh(r)]}function sinh(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.sinh(n)*Math.cos(r),Math.cosh(n)*Math.sin(r)]}function exp(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.exp(n)*Math.cos(r),Math.exp(n)*Math.sin(r)]}function abs(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return Math.sqrt(n*n+r*r)}function ln$1(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return[Math.log(abs([n,r])),Math.atan2(r,n)]}function power(e,t){var n=_slicedToArray(ln$1(e),2);return exp([t*n[0],t*n[1]])}function _typeof$1(e){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(e)}function _createForOfIteratorHelper$1(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1(e,t,n){return t&&_defineProperties$1(e.prototype,t),n&&_defineProperties$1(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$1(e,t)}function _setPrototypeOf$1(e,t){return _setPrototypeOf$1=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf$1(e,t)}function _createSuper$1(e){var t=_isNativeReflectConstruct$1();return function(){var n,r=_getPrototypeOf$1(e);if(t){var a=_getPrototypeOf$1(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn$1(this,n)}}function _possibleConstructorReturn$1(e,t){if(t&&("object"===_typeof$1(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(e)}function _assertThisInitialized$1(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf$1(e){return _getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf$1(e)}ComplexPlugin.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:ArgumentTypes.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:ArgumentTypes.COMPLEX},{argumentType:ArgumentTypes.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:ArgumentTypes.COMPLEX}]}};var StatisticalAggregationPlugin=function(e){_inherits$1(n,e);var t=_createSuper$1(n);function n(){return _classCallCheck$1(this,n),t.apply(this,arguments)}return _createClass$1(n,[{key:"avedev",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("AVEDEV"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);if(a instanceof CellError)return a;if(0===a.length)return new CellError(ErrorType.DIV_BY_ZERO);var i=mean(a);return a.reduce((function(e,t){return e+Math.abs(t-i)}),0)/a.length}))}},{key:"devsq",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("DEVSQ"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);return a instanceof CellError?a:0===a.length?0:sumsqerr(a)}))}},{key:"geomean",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("GEOMEAN"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);if(a instanceof CellError)return a;if(0===a.length)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);var i,o=_createForOfIteratorHelper$1(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(s<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall)}}catch(e){o.e(e)}finally{o.f()}return geomean(a)}))}},{key:"harmean",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("HARMEAN"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);if(a instanceof CellError)return a;if(0===a.length)return new CellError(ErrorType.NUM,ErrorMessage.OneValue);var i,o=_createForOfIteratorHelper$1(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(s<=0)return new CellError(ErrorType.NUM,ErrorMessage.ValueSmall)}}catch(e){o.e(e)}finally{o.f()}return a.length/a.reduce((function(e,t){return e+1/t}),0)}))}},{key:"correl",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);return n instanceof CellError?n:n[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):corrcoeff(n[0],n[1])}))}},{key:"rsq",value:function(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);return n instanceof CellError?n:n[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):Math.pow(corrcoeff(n[0],n[1]),2)}))}},{key:"covariancep",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);if(n instanceof CellError)return n;var r=n[0].length;return r<1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.OneValue):1===r?0:covariance(n[0],n[1])*(r-1)/r}))}},{key:"covariances",value:function(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);return n instanceof CellError?n:n[0].length<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(n[0],n[1])}))}},{key:"ztest",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("Z.TEST"),(function(e,t,r){var a=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(a instanceof CellError)return a;var i=a.length;if(void 0===r){if(i<2)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);r=stdev(a,!0)}return i<1?new CellError(ErrorType.NA,ErrorMessage.OneValue):0===r?new CellError(ErrorType.DIV_BY_ZERO):1-normal.cdf((mean(a)-t)/(r/Math.sqrt(i)),0,1)}))}},{key:"ftest",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("F.TEST"),(function(e,t){var r=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),a=n.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(r instanceof CellError)return r;if(a instanceof CellError)return a;if(r.length<=1||a.length<=1)return new CellError(ErrorType.DIV_BY_ZERO);var i=variance(r,!0),o=variance(a,!0);if(0===i||0===o)return new CellError(ErrorType.DIV_BY_ZERO);var s=i/o,l=centralF.cdf(s,r.length-1,a.length-1);return 2*Math.min(l,1-l)}))}},{key:"steyx",value:function(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);if(n instanceof CellError)return n;var r=n[0].length;return r<=2?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues):Math.sqrt((sumsqerr(n[0])-Math.pow(covariance(n[0],n[1])*(r-1),2)/sumsqerr(n[1]))/(r-2))}))}},{key:"slope",value:function(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),(function(e,t){if(e.numberOfElements()!==t.numberOfElements())return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var n=parseTwoArrays(e,t);if(n instanceof CellError)return n;var r=n[0].length;return r<=1?new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues):covariance(n[0],n[1])*(r-1)/sumsqerr(n[1])}))}},{key:"chisqtest",value:function(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),(function(e,t){var n=e.height(),r=e.width();if(t.height()!==n||t.width()!==r)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);var a=parseTwoArrays(e,t);if(a instanceof CellError)return a;if(a[0].length<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);for(var i=0,o=0;o<a[0].length;o++){if(0===a[1][o])return new CellError(ErrorType.DIV_BY_ZERO);i+=Math.pow(a[0][o]-a[1][o],2)/a[1][o]}return i<0?new CellError(ErrorType.NUM,ErrorMessage.NaN):1-chisquare.cdf(i,n>1&&r>1?(n-1)*(r-1):n*r-1)}))}},{key:"ttest",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("T.TEST"),(function(e,t,r,a){var i=n.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),o=n.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(i instanceof CellError)return i;if(o instanceof CellError)return o;var s=i.length,l=o.length;if(1===a){if(l!==s)return new CellError(ErrorType.NA,ErrorMessage.EqualLength);if(s<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);for(var u=Array(s),c=0;c<s;c++)u[c]=i[c]-o[c];var p=stdev(u,!0);if(0===p)return new CellError(ErrorType.DIV_BY_ZERO);var d=Math.abs(Math.sqrt(s)*mean(u)/p);return r*(1-studentt.cdf(d,s-1))}if(2===a){if(s<=1||l<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);var m=(sumsqerr(i)+sumsqerr(o))/(s+l-2);if(0===m)return new CellError(ErrorType.DIV_BY_ZERO);var f=Math.abs((mean(i)-mean(o))/Math.sqrt(m*(1/s+1/l)));return r*(1-studentt.cdf(f,s+l-2))}if(s<=1||l<=1)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.TwoValues);var h=variance(i,!0),y=variance(o,!0);if(0===h&&0===y)return new CellError(ErrorType.DIV_BY_ZERO);var b=Math.abs((mean(i)-mean(o))/Math.sqrt(h/s+y/l)),g=Math.pow(h/s+y/l,2)/(Math.pow(h/s,2)/(s-1)+Math.pow(y/l,2)/(l-1));return r*(1-studentt.cdf(b,g))}))}},{key:"skew",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SKEW"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);if(a instanceof CellError)return a;var i=a.length;if(i<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);var o=mean(a),s=stdev(a,!0);return 0===s?new CellError(ErrorType.DIV_BY_ZERO):a.reduce((function(e,t){return e+Math.pow((t-o)/s,3)}),0)*i/(i-1)/(i-2)}))}},{key:"skewp",value:function(e,t){var n=this;return this.runFunction(e.args,t,this.metadata("SKEW.P"),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=n.arithmeticHelper.coerceNumbersExactRanges(t);if(a instanceof CellError)return a;var i=a.length;if(i<3)return new CellError(ErrorType.DIV_BY_ZERO,ErrorMessage.ThreeValues);var o=mean(a),s=stdev(a,!1);return 0===s?new CellError(ErrorType.DIV_BY_ZERO):a.reduce((function(e,t){return e+Math.pow((t-o)/s,3)}),0)/i}))}}]),n}(FunctionPlugin);function parseTwoArrays(e,t){for(var n,r,a=e.iterateValuesFromTopLeftCorner(),i=t.iterateValuesFromTopLeftCorner(),o=[],s=[];n=a.next(),r=i.next(),!n.done&&!r.done;){var l=n.value,u=r.value;if(l instanceof CellError)return l;if(u instanceof CellError)return u;isExtendedNumber(l)&&isExtendedNumber(u)&&(o.push(getRawValue(l)),s.push(getRawValue(u)))}return[o,s]}
/**
   * @license
   * Copyright (c) 2021 Handsoncode. All rights reserved.
   */StatisticalAggregationPlugin.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.NUMBER},{argumentType:ArgumentTypes.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.RANGE},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:2},{argumentType:ArgumentTypes.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:ArgumentTypes.ANY}],repeatLastArgs:1}},StatisticalAggregationPlugin.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"};var plugins=Object.freeze({__proto__:null,ArrayPlugin:ArrayPlugin,AbsPlugin:AbsPlugin,BitShiftPlugin:BitShiftPlugin,BitwiseLogicOperationsPlugin:BitwiseLogicOperationsPlugin,BooleanPlugin:BooleanPlugin,CharPlugin:CharPlugin,CodePlugin:CodePlugin,CountBlankPlugin:CountBlankPlugin,CountUniquePlugin:CountUniquePlugin,DateTimePlugin:DateTimePlugin,DegreesPlugin:DegreesPlugin,DeltaPlugin:DeltaPlugin,ExpPlugin:ExpPlugin,FinancialPlugin:FinancialPlugin,FormulaTextPlugin:FormulaTextPlugin,InformationPlugin:InformationPlugin,IsEvenPlugin:IsEvenPlugin,IsOddPlugin:IsOddPlugin,LogarithmPlugin:LogarithmPlugin,MathConstantsPlugin:MathConstantsPlugin,MatrixPlugin:MatrixPlugin,MedianPlugin:MedianPlugin,ModuloPlugin:ModuloPlugin,NumericAggregationPlugin:NumericAggregationPlugin,PowerPlugin:PowerPlugin,RadiansPlugin:RadiansPlugin,RadixConversionPlugin:RadixConversionPlugin,RandomPlugin:RandomPlugin,RoundingPlugin:RoundingPlugin,SqrtPlugin:SqrtPlugin,SumifPlugin:SumifPlugin,SumprodPlugin:SumprodPlugin,TextPlugin:TextPlugin,TrigonometryPlugin:TrigonometryPlugin,LookupPlugin:LookupPlugin,RomanPlugin:RomanPlugin,SimpleArithmerticPlugin:SimpleArithmerticPlugin,StatisticalPlugin:StatisticalPlugin,MathPlugin:MathPlugin,ComplexPlugin:ComplexPlugin,StatisticalAggregationPlugin:StatisticalAggregationPlugin});function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}var HyperFormulaNS=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n)}(HyperFormula);HyperFormulaNS.HyperFormula=HyperFormula,HyperFormulaNS.ErrorType=ErrorType,HyperFormulaNS.CellType=CellType,HyperFormulaNS.CellValueType=CellValueType,HyperFormulaNS.CellValueDetailedType=CellValueDetailedType,HyperFormulaNS.DetailedCellError=DetailedCellError,HyperFormulaNS.ExportedCellChange=ExportedCellChange,HyperFormulaNS.ExportedNamedExpressionChange=ExportedNamedExpressionChange,HyperFormulaNS.ConfigValueTooBigError=ConfigValueTooBigError,HyperFormulaNS.ConfigValueTooSmallError=ConfigValueTooSmallError,HyperFormulaNS.EvaluationSuspendedError=EvaluationSuspendedError,HyperFormulaNS.ExpectedOneOfValuesError=ExpectedOneOfValuesError,HyperFormulaNS.ExpectedValueOfTypeError=ExpectedValueOfTypeError,HyperFormulaNS.FunctionPlugin=FunctionPlugin,HyperFormulaNS.FunctionPluginValidationError=FunctionPluginValidationError,HyperFormulaNS.InvalidAddressError=InvalidAddressError,HyperFormulaNS.InvalidArgumentsError=InvalidArgumentsError,HyperFormulaNS.LanguageNotRegisteredError=LanguageNotRegisteredError,HyperFormulaNS.LanguageAlreadyRegisteredError=LanguageAlreadyRegisteredError,HyperFormulaNS.MissingTranslationError=MissingTranslationError,HyperFormulaNS.NamedExpressionDoesNotExistError=NamedExpressionDoesNotExistError,HyperFormulaNS.NamedExpressionNameIsAlreadyTakenError=NamedExpressionNameIsAlreadyTakenError,HyperFormulaNS.NamedExpressionNameIsInvalidError=NamedExpressionNameIsInvalidError,HyperFormulaNS.NoOperationToRedoError=NoOperationToRedoError,HyperFormulaNS.NoOperationToUndoError=NoOperationToUndoError,HyperFormulaNS.NoRelativeAddressesAllowedError=NoRelativeAddressesAllowedError,HyperFormulaNS.NoSheetWithIdError=NoSheetWithIdError,HyperFormulaNS.NoSheetWithNameError=NoSheetWithNameError,HyperFormulaNS.NotAFormulaError=NotAFormulaError,HyperFormulaNS.NothingToPasteError=NothingToPasteError,HyperFormulaNS.ProtectedFunctionTranslationError=ProtectedFunctionTranslationError,HyperFormulaNS.SheetNameAlreadyTakenError=SheetNameAlreadyTakenError,HyperFormulaNS.SheetSizeLimitExceededError=SheetSizeLimitExceededError,HyperFormulaNS.SourceLocationHasArrayError=SourceLocationHasArrayError,HyperFormulaNS.TargetLocationHasArrayError=TargetLocationHasArrayError,HyperFormulaNS.UnableToParseError=UnableToParseError;var defaultLanguage=Config.defaultConfig.language;HyperFormula.registerLanguage(defaultLanguage,dictionary),HyperFormula.languages[dictionary.langCode]=dictionary;var _iterator=_createForOfIteratorHelper(Object.getOwnPropertyNames(plugins)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var pluginName=_step.value;pluginName.startsWith("_")||HyperFormula.registerFunctionPlugin(plugins[pluginName])}}catch(e){_iterator.e(e)}finally{_iterator.f()}class Spreadsheet extends BlockComponent{static componentType="spreadsheet";static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},e.minNumRows={createComponentOfType:"number",createStateVariable:"minNumRows",defaultValue:4,public:!0,forRenderer:!0},e.minNumColumns={createComponentOfType:"number",createStateVariable:"minNumColumns",defaultValue:4,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize"},e.columnHeaders={createComponentOfType:"boolean",createStateVariable:"columnHeaders",defaultValue:!0,public:!0,forRenderer:!0},e.rowHeaders={createComponentOfType:"boolean",createStateVariable:"rowHeaders",defaultValue:!0,public:!0,forRenderer:!0},e.fixedRowsTop={createComponentOfType:"integer",createStateVariable:"fixedRowsTop",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},e.fixedColumnsLeft={createComponentOfType:"integer",createStateVariable:"fixedColumnsLeft",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},e.hiddenColumns={createComponentOfType:"numberList",createStateVariable:"hiddenColumns",defaultValue:[],public:!0,forRenderer:!0},e.hiddenRows={createComponentOfType:"numberList",createStateVariable:"hiddenRows",defaultValue:[],public:!0,forRenderer:!0},e}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]},{group:"rows",componentTypes:["row"]},{group:"columns",componentTypes:["column"]},{group:"cellBlocks",componentTypes:["cellBlock"]},{group:"dataFrames",componentTypes:["dataFrame"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.cellNameToRowCol={additionalStateVariablesDefined:["cellNamesByRowCol"],returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childGroups:["cells","rows","columns","cellBlocks"],variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:e,componentInfoObjects:t}){let n=determineCellMapping({cellRelatedChildren:e.cellRelatedChildren,componentInfoObjects:t});return{setValue:{cellNameToRowCol:n.cellNameToRowCol,cellNamesByRowCol:n.cellNamesByRowCol}}}},e.numRows={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["numRows"]}}),definition({dependencyValues:e}){let t=e.minNumRows;return Number.isFinite(t)||(t=4),t=Math.max(t,e.cellNamesByRowCol.length),e.dataFrameChild.length>0&&(t=Math.max(t,e.dataFrameChild[0].stateValues.numRows)),{setValue:{numRows:t}}}},e.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["numColumns"]}}),definition({dependencyValues:e}){let t=e.minNumColumns;Number.isFinite(t)||(t=4);for(let n of e.cellNamesByRowCol)n&&(t=Math.max(t,n.length));return e.dataFrameChild.length>0&&(t=Math.max(t,e.dataFrameChild[0].stateValues.numColumns)),{setValue:{numColumns:t}}}},e.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},forRenderer:!0,returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},numRows:{dependencyType:"stateVariable",variableName:"numRows"}}),definition({dependencyValues:e}){if(null===e.heightAttr){let t;return t=Number.isFinite(e.numRows)&&e.numRows>=0?40+23*e.numRows:132,{setValue:{height:{size:t,isAbsolute:!0}}}}return{setValue:{height:e.heightAttr.stateValues.componentSize}}}},e.cells={public:!0,shadowingInstructions:{createComponentOfType:"cell",returnWrappingComponents:e=>"cell"===e?[]:"row"===e?[["row"]]:"column"===e?[["column"]]:[["row"],["cellBlock"]]},forRenderer:!0,isArray:!0,entryPrefixes:["cell","row","column","range"],nDimensions:2,defaultValueByArrayKey:()=>"",hasEssential:!0,shadowVariable:!0,stateVariablesDeterminingDependencies:["cellNamesByRowCol"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnEntryDimensions:e=>"range"===e?2:1,getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("cell"===e){let e,r,a=/^([a-zA-Z]+)([1-9]\d*)$/,i=t.match(a);if(i)r=i[1],e=i[2];else{let n=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(i=t.match(n),!i)return[];e=i[1],r=i[2]}let o=normalizeIndex(e),s=normalizeIndex(r);return o>=0&&s>=0&&(!n||o<n[0]&&s<n[1])?[String(o)+","+String(s)]:[]}if("row"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return[String(e)+",0"];if(!(e<n[0]))return[];let r=[],a=String(e)+",";for(let e=0;e<n[1];e++)r.push(a+e);return r}if("column"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return["0,"+String(e)];if(!(e<n[1]))return[];let r=[],a=","+String(e);for(let e=0;e<n[0];e++)r.push(e+a);return r}{let e,r,a,i,o=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,s=t.match(o);if(s)r=normalizeIndex(s[1]),e=normalizeIndex(s[2]),i=normalizeIndex(s[3]),a=normalizeIndex(s[4]);else{let n=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(s=t.match(n),!s)return[];e=normalizeIndex(s[1]),r=normalizeIndex(s[2]),a=normalizeIndex(s[3]),i=normalizeIndex(s[4])}if(!(e>=0&&a>=0&&r>=0&&i>=0))return[];if(!n)return[String(e)+","+String(r)];let l=Math.min(Math.min(e,a),n[0]-1),u=Math.min(Math.max(e,a),n[0]-1),c=Math.min(Math.min(r,i),n[1]-1),p=Math.min(Math.max(r,i),n[1]-1),d=[];for(let e=l;e<=u;e++){let t=[],n=String(e)+",";for(let e=c;e<=p;e++)t.push(n+e);d.push(t)}return d}},arrayVarNameFromArrayKey:e=>"cell("+e.split(",").map((e=>Number(e)+1)).join(",")+")",arrayVarNameFromPropIndex(e,t){if("row"===t.slice(0,3)){return`cell(${t.slice(3)},${e})`}if("column"===t.slice(0,6)){return`cell(${e},${t.slice(6)})`}return null},returnArrayDependenciesByKey({stateValues:e,arrayKeys:t}){let n={},r=e.cellNamesByRowCol;for(let e of t){let[t,a]=e.split(",");r[t]&&r[t][a]&&(n[e]={cellText:{dependencyType:"stateVariable",componentName:r[t][a],variableName:"text",variablesOptional:!0}})}return{dependenciesByKey:n,globalDependencies:{dataFrameChild:{dependencyType:"child",childGroups:["dataFrames"],variableNames:["dataFrame","numRows","numColumns"]}}}},arrayDefinitionByKey({dependencyValuesByKey:e,globalDependencyValues:t,arrayKeys:n}){let r,a,i={},o={},s=null;t.dataFrameChild.length>0&&(s=t.dataFrameChild[0],r=s.stateValues.numRows,a=s.stateValues.numColumns);for(let t of n){let[n,l]=t.split(",");void 0!==e[t].cellText?i[t]=e[t].cellText:n<r&&l<a?i[t]=s.stateValues.dataFrame.data[n][l]:o[t]=!0}let l={};return Object.keys(i).length>0&&(l.setValue={cells:i}),Object.keys(o).length>0&&(l.useEssentialOrDefaultValue={cells:o}),l},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:t}){let n=[];for(let r in e.cells)if(void 0!==t[r].cellText)n.push({setDependency:t[r].cellText,desiredValue:e.cells[r]});else{let t=e.cells[r];n.push({setEssentialValue:"cells",value:{[r]:null===t?"":String(t)}})}return{success:!0,instructions:n}}},e.evaluatedCells={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"cell",returnWrappingComponents:e=>"evaluatedCell"===e?[]:"evaluatedRow"===e?[["row"]]:"evaluatedColumn"===e?[["column"]]:[["row"],["cellBlock"]]},entryPrefixes:["evaluatedCell","evaluatedRow","evaluatedColumn","evaluatedRange"],nDimensions:2,stateVariablesDeterminingDependencies:["cellNamesByRowCol"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnEntryDimensions:e=>"range"===e?2:1,getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("evaluatedCell"===e){let e,r,a=/^([a-zA-Z]+)([1-9]\d*)$/,i=t.match(a);if(i)r=i[1],e=i[2];else{let n=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(i=t.match(n),!i)return[];e=i[1],r=i[2]}let o=normalizeIndex(e),s=normalizeIndex(r);return o>=0&&s>=0&&(!n||o<n[0]&&s<n[1])?[String(o)+","+String(s)]:[]}if("evaluatedRow"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return[String(e)+",0"];if(!(e<n[0]))return[];let r=[],a=String(e)+",";for(let e=0;e<n[1];e++)r.push(a+e);return r}if("evaluatedColumn"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return["0,"+String(e)];if(!(e<n[1]))return[];let r=[],a=","+String(e);for(let e=0;e<n[0];e++)r.push(e+a);return r}{let e,r,a,i,o=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,s=t.match(o);if(s)r=normalizeIndex(s[1]),e=normalizeIndex(s[2]),i=normalizeIndex(s[3]),a=normalizeIndex(s[4]);else{let n=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(s=t.match(n),!s)return[];e=normalizeIndex(s[1]),r=normalizeIndex(s[2]),a=normalizeIndex(s[3]),i=normalizeIndex(s[4])}if(!(e>=0&&a>=0&&r>=0&&i>=0))return[];if(!n)return[String(e)+","+String(r)];let l=Math.min(Math.min(e,a),n[0]-1),u=Math.min(Math.max(e,a),n[0]-1),c=Math.min(Math.min(r,i),n[1]-1),p=Math.min(Math.max(r,i),n[1]-1),d=[];for(let e=l;e<=u;e++){let t=[],n=String(e)+",";for(let e=c;e<=p;e++)t.push(n+e);d.push(t)}return d}},arrayVarNameFromArrayKey:e=>"evaluatedCell("+e.split(",").map((e=>Number(e)+1)).join(",")+")",arrayVarNameFromPropIndex(e,t){if("evaluatedRow"===t.slice(0,12)){return`evaluatedCell(${t.slice(12)},${e})`}if("evaluatedColumn"===t.slice(0,15)){return`evaluatedCell(${e},${t.slice(15)})`}return null},returnArrayDependenciesByKey:()=>({globalDependencies:{cells:{dependencyType:"stateVariable",variableName:"cells"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t=HyperFormula.buildFromArray(e.cells,{licenseKey:"gpl-v3"}).getSheetValues(0),n={};for(let e in t){let r=t[e];for(let t in r)n[[e,t]]=r[t]}return{setValue:{evaluatedCells:n}}}},e.pointsInCells={isArray:!0,nDimensions:2,public:!0,shadowingInstructions:{createComponentOfType:"point"},entryPrefixes:["pointsInCell","pointsInRow","pointsInColumn","pointsInRange"],returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numRows,e.numColumns],returnEntryDimensions:e=>"pointsInRange"===e?2:1,getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("pointsInCell"===e){let e,r,a=/^([a-zA-Z]+)([1-9]\d*)$/,i=t.match(a);if(i)r=i[1],e=i[2];else{let n=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(i=t.match(n),!i)return[];e=i[1],r=i[2]}let o=normalizeIndex(e),s=normalizeIndex(r);return o>=0&&s>=0&&(!n||o<n[0]&&s<n[1])?[String(o)+","+String(s)]:[]}if("pointsInRow"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return[String(e),",0"];if(!(e>=0&&e<n[0]))return[];let r=[],a=String(e)+",";for(let e=0;e<n[1];e++)r.push(a+e);return r}if("pointsInColumn"===e){let e=normalizeIndex(t);if(!(e>=0))return[];if(!n)return["0,"+String(e)];if(!(e<n[1]))return[];let r=[],a=","+String(e);for(let e=0;e<n[0];e++)r.push(e+a);return r}{let e,r,a,i,o=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,s=t.match(o);if(s)r=normalizeIndex(s[1]),e=normalizeIndex(s[2]),i=normalizeIndex(s[3]),a=normalizeIndex(s[4]);else{let n=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(s=t.match(n),!s)return[];e=normalizeIndex(s[1]),r=normalizeIndex(s[2]),a=normalizeIndex(s[3]),i=normalizeIndex(s[4])}if(!(e>=0&&a>=0&&r>=0&&i>=0))return[];if(!n)return[String(e)+","+String(r)];let l=Math.min(Math.min(e,a),n[0]-1),u=Math.min(Math.max(e,a),n[0]-1),c=Math.min(Math.min(r,i),n[1]-1),p=Math.min(Math.max(r,i),n[1]-1),d=[];for(let e=l;e<=u;e++){let t=[],n=String(e)+",";for(let e=c;e<=p;e++)t.push(n+e);d.push(t)}return d}},arrayVarNameFromArrayKey:e=>"pointsInCell("+e.split(",").map((e=>Number(e)+1)).join(",")+")",arrayVarNameFromPropIndex(e,t){if("pointsInRow"===t.slice(0,11)){return`pointsInCell(${t.slice(11)},${e})`}if("pointsInColumn"===t.slice(0,14)){return`pointsInCell(${e},${t.slice(14)})`}return null},returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e){let e=n.split(",").map((e=>Number(e)+1)).join(",");t[n]={cellText:{dependencyType:"stateVariable",variableName:`evaluatedCell(${e})`,variablesOptional:!0}}}return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t,a=e[r].cellText;if(a){try{t=me$3.fromAst(textToAst$1.convert(a))}catch(e){n[r]=null;continue}!Array.isArray(t.tree)||"tuple"!==t.tree[0]&&"vector"!==t.tree[0]?n[r]=null:n[r]=t}else n[r]=null}return{setValue:{pointsInCells:n}}}},e}async onChange({changes:e,source:t,actionId:n}){if("edit"===t){let t={};for(let n of e){let[e,r,a,i]=n;t[[e,r]]=null===i?"":i}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"cells",value:t}],actionId:n,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:t}})}this.coreFunctions.resolveAction({actionId:n})}actions={onChange:this.onChange.bind(this)}}function determineCellMapping({cellRelatedChildren:e,rowOffset:t=0,colOffset:n=0,cellNameToRowCol:r={},cellNamesByRowCol:a=[],componentInfoObjects:i}){var o=t,s=n,l=n,u=t,c=n,p=t,d=n;for(let m of e)if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cell"})){let e=m,i=normalizeIndex(e.stateValues.rowNum),u=normalizeIndex(e.stateValues.colNum);void 0===i?(i=o,void 0===u?u=l:u+=n):(i+=t,void 0===u?u=s:u+=n),addCellToMapping({cell:e,rowIndex:i,colIndex:u,cellNameToRowCol:r,cellNamesByRowCol:a}),p=Math.max(i,p),d=Math.max(u,d),o=i,s=u,l=u+1}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"row"})){let e=m,i=normalizeIndex(e.stateValues.rowNum);void 0===i?i=u:i+=t;let c=e.stateValues.prescribedCellsWithColNum,f=n;for(let e of c){let t=normalizeIndex(e.stateValues.colNum);void 0===t?t=f:t+=n,addCellToMapping({cell:e,rowIndex:i,colIndex:t,cellNameToRowCol:r,cellNamesByRowCol:a}),f=t+1,p=Math.max(i,p),d=Math.max(t,d)}u=i+1,o=i+1,l=s=n}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"column"})){let e=m,i=normalizeIndex(e.stateValues.colNum);void 0===i?i=c:i+=n;let u=e.stateValues.prescribedCellsWithRowNum,f=t;for(let e of u){let n=normalizeIndex(e.stateValues.rowNum);void 0===n?n=f:n+=t,addCellToMapping({cell:e,rowIndex:n,colIndex:i,cellNameToRowCol:r,cellNamesByRowCol:a}),f=n+1,p=Math.max(n,p),d=Math.max(i,d)}c=i+1,o=t,l=s=i+1}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cellBlock"})){let e=m,u=normalizeIndex(e.stateValues.rowNum),c=normalizeIndex(e.stateValues.colNum);void 0===u?(u=o,void 0===c?c=l:c+=n):(u+=t,void 0===c?c=s:c+=n);let f=determineCellMapping({cellRelatedChildren:e.stateValues.prescribedCellsRowsColumnsBlocks,rowOffset:u,colOffset:c,cellNameToRowCol:r,cellNamesByRowCol:a,componentInfoObjects:i});p=Math.max(f.maxRowIndex,p),d=Math.max(f.maxColIndex,d),o=u,s=c,l=f.maxColIndex+1}return{maxRowIndex:p,maxColIndex:d,cellNameToRowCol:r,cellNamesByRowCol:a}}function addCellToMapping({cell:e,rowIndex:t,colIndex:n,cellNameToRowCol:r,cellNamesByRowCol:a}){if(r[e.componentName]=[t,n],void 0===a[t]&&(a[t]=[]),void 0!==a[t][n]){console.warn(`Cell is overwriting previous cell at rowNum=${t+1}, colNum=${n+1}`),r[a[t][n]]=null}a[t][n]=e.componentName}class DiscreteSimulationResultList extends BlockComponent{static componentType="DiscreteSimulationResultList";static rendererType="spreadsheet";static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},e.minNumRows={createComponentOfType:"number",createStateVariable:"minNumRows",defaultValue:1,public:!0,forRenderer:!0},e.minNumColumns={createComponentOfType:"number",createStateVariable:"minNumColumns",defaultValue:1,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize"},e.columnHeaders={createComponentOfType:"boolean",createStateVariable:"columnHeaders",defaultValue:!0,public:!0,forRenderer:!0},e.rowHeaders={createComponentOfType:"boolean",createStateVariable:"rowHeaders",defaultValue:!0,public:!0,forRenderer:!0},e.fixedRowsTop={createComponentOfType:"integer",createStateVariable:"fixedRowsTop",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},e.fixedColumnsLeft={createComponentOfType:"integer",createStateVariable:"fixedColumnsLeft",defaultValue:0,clamp:[0,1/0],public:!0,forRenderer:!0},e.hiddenColumns={createComponentOfType:"numberList",createStateVariable:"hiddenColumns",defaultValue:[],public:!0,forRenderer:!0},e.hiddenRows={createComponentOfType:"numberList",createStateVariable:"hiddenRows",defaultValue:[],public:!0,forRenderer:!0},e.allIterates={createComponentOfType:"mathList",createStateVariable:"allIterates",defaultValue:[]},e.headerRow={createComponentOfType:"textList",createStateVariable:"headerRow",defaultValue:null},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.cells={forRenderer:!0,shadowVariable:!0,returnDependencies:()=>({allIterates:{dependencyType:"stateVariable",variableName:"allIterates"},headerRow:{dependencyType:"stateVariable",variableName:"headerRow"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition({dependencyValues:e,usedDefault:t}){let n=[],r=1,a=!1;if(e.allIterates.length>0&&Array.isArray(e.allIterates[0].tree)&&["vector","tuple"].includes(e.allIterates[0].tree[0])&&(r=e.allIterates[0].tree.length-1,a=!0),e.headerRow){let t=[],a=Math.min(e.headerRow.length,r+1);for(let n=0;n<a;n++)t.push(e.headerRow[n]);n.push(t)}for(let[i,o]of e.allIterates.entries()){let s=[i.toString()];for(let n=0;n<r;n++){let r=o;a&&(r=r.get_component(n));let i=roundForDisplay({value:r,dependencyValues:e,usedDefault:t});try{s.push(i.toString())}catch(e){s.push("")}}n.push(s)}return{setValue:{cells:n}}}},e.numRows={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cells:{dependencyType:"stateVariable",variableName:"cells"}}),definition({dependencyValues:e}){let t=e.minNumRows;return Number.isFinite(t)||(t=4),t=Math.max(t,e.cells.length),{setValue:{numRows:t}}}},e.numColumns={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cells:{dependencyType:"stateVariable",variableName:"cells"}}),definition({dependencyValues:e}){let t=e.minNumColumns;Number.isFinite(t)||(t=4);for(let n of e.cells)n&&(t=Math.max(t,n.length));return{setValue:{numColumns:t}}}},e.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},forRenderer:!0,returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},numRows:{dependencyType:"stateVariable",variableName:"numRows"}}),definition({dependencyValues:e}){if(null===e.heightAttr){let t;return t=Number.isFinite(e.numRows)&&e.numRows>=0?50+20*e.numRows:130,{setValue:{height:{size:t,isAbsolute:!0}}}}return{setValue:{height:e.heightAttr.stateValues.componentSize}}}},e}async onChange({changes:e,source:t,actionId:n}){if("loadData"!==t){let t={};for(let n of e){let[e,r,a,i]=n;t[[e,r]]=null===i?"":i}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"cells",value:t}],actionId:n,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:t}})}this.coreFunctions.resolveAction({actionId:n})}actions={onChange:this.onChange.bind(this)}}class DiscreteSimulationResultPolyline extends GraphicalComponent{static componentType="discreteSimulationResultPolyline";static rendererType="polyline";actions={movePolyline:this.movePolyline.bind(this),finalizePolylinePosition:this.finalizePolylinePosition.bind(this)};static createAttributesObject(){let e=super.createAttributesObject();return e.draggable={createComponentOfType:"boolean",createStateVariable:"draggable",defaultValue:!0,public:!0,forRenderer:!0},e.allIterates={createComponentOfType:"mathList",createStateVariable:"allIterates",defaultValue:[]},e.seriesNumber={createComponentOfType:"number",createStateVariable:"seriesNumber",defaultValue:null},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t=e.selectedStyle.lineWidthWord;return e.selectedStyle.lineStyleWord&&(t&&(t+=" "),t+=e.selectedStyle.lineStyleWord),t&&(t+=" "),t+=e.selectedStyle.lineColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" polyline"}}}},e.nVertices={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}),definition:function({dependencyValues:e}){return{setValue:{nVertices:e.allIterates.length}}}},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies:()=>({}),definition:function({dependencyValues:e}){return{setValue:{nDimensions:2}}}},e.vertices={public:!0,shadowingInstructions:{createComponentOfType:"math",returnWrappingComponents:e=>"vertexX"===e?[]:[["point",{componentType:"mathList",isAttribute:"xs"}]]},isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:t,arraySize:n}){if("vertexX"===e){let e=t.split("_").map((e=>Number(e)-1));return 2===e.length&&e.every(((e,t)=>Number.isInteger(e)&&e>=0))?n?e.every(((e,t)=>e<n[t]))?[String(e)]:[]:[String(e)]:[]}{let e=Number(t)-1;return Number.isInteger(e)&&e>=0?n?e<n[0]?Array.from(Array(n[1]),((t,n)=>e+","+n)):[]:[e+",0"]:[]}},arrayVarNameFromPropIndex(e,t){if("vertices"===t)return"vertex"+e;if("vertex"===t.slice(0,6)){let n=Number(t.slice(6));if(Number.isInteger(n)&&n>0)return`vertexX${n}_${e}`}return null},getAllArrayKeys(e,t=!0,n){function r(e){if(1===e.length)return Array.from(Array(e[0]),((e,t)=>String(t)));{let n=e[0],a=r(e.slice(1)),i=[];for(let e=0;e<n;e++)t?i.push(...a.map((t=>e+","+t))):i.push(a.map((t=>e+","+t)));return i}}if(n){if(0!==n.length&&e){let t=[...e];return t[0]=n[0],r(t)}return[]}return e&&0!==e.length?r(e):[]},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize:({dependencyValues:e})=>[e.nVertices,2],returnArrayDependenciesByKey:()=>({globalDependencies:{seriesNumber:{dependencyType:"stateVariable",variableName:"seriesNumber"},allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}}),arrayDefinitionByKey({globalDependencyValues:e,arraySize:t}){let n={};for(let r=0;r<t[0];r++){n[`${r},0`]=me$3.fromAst(r);let t=e.allIterates[r];null!==e.seriesNumber&&(t=t.get_component(e.seriesNumber-1)),n[`${r},1`]=t}return{setValue:{vertices:n}}}},e.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize:({dependencyValues:e})=>[e.nVertices],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(n)+1)}};return{dependenciesByKey:t}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t){let t=e[r].vertex.map((e=>e.evaluate_to_constant()));t.every((e=>Number.isFinite(e)))||(t=Array(t.length).fill(NaN)),n[r]=t}return{setValue:{numericalVertices:n}}}},e.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalVertices:{dependencyType:"stateVariable",variableName:"numericalVertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e}){let t,n,r=e.nDimensions,a=e.nVertices,i=e.numericalVertices,o=[],s=i[0][0],l=i[0][1];for(let e=1;e<a;e++)if(t=s,n=l,s=i[e][0],l=i[e][1],Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(l)){let e=(s-t)/xscale,r=(l-n)/yscale,a=e*e+r*r;0===a?o.push(null):o.push([e,r,a])}else o.push(null);return{setValue:{nearestPoint:function({variables:e,scales:t}){let n=t[0],s=t[1];if(2!==r||0===a)return{};let l,u,c=1/0,p={},d=e.x1?.evaluate_to_constant(),m=e.x2?.evaluate_to_constant(),f=i[0][0],h=i[0][1];for(let e=1;e<a;e++){l=f,u=h,f=i[e][0],h=i[e][1];let t=o[e-1];if(null===t)continue;let r,[a,y,b]=t,g=((d-l)/n*a+(m-u)/s*y)/b;r=g<=0?{x1:l,x2:u}:g>=1?{x1:f,x2:h}:{x1:l+g*a*n,x2:u+g*y*s};let v=Math.pow((d-r.x1)/n,2)+Math.pow((m-r.x2)/s,2);v<c&&(c=v,p=r)}return void 0!==e.x3&&Object.keys(p).length>0&&(p.x3=0),p}}}}},e}async movePolyline({pointCoords:e,transient:t,sourceInformation:n,actionId:r}){let a={};for(let t in e)a[t+",0"]=me$3.fromAst(e[t][0]),a[t+",1"]=me$3.fromAst(e[t][1]);return t?await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:a,sourceInformation:n}],transient:!0,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:a,sourceInformation:n}],actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:e}}})}async finalizePolylinePosition(){return await this.actions.movePolyline({pointCoords:await this.stateValues.numericalVertices,transient:!1})}}class Cell extends BaseComponent{static componentType="cell";static rendererType="cell";static renderChildren=!0;static includeBlankStringChildren=!0;static primaryStateVariableForDefinition="text";static createAttributesObject(){let e=super.createAttributesObject();return e.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},e.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},e.colSpan={createComponentOfType:"integer",createStateVariable:"colSpan",defaultValue:1,public:!0,forRenderer:!0},e.halign={createComponentOfType:"text"},e.bottom={createComponentOfType:"text"},e.right={createComponentOfType:"text"},e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.halign={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"left",returnDependencies:()=>({halignAttr:{dependencyType:"attributeComponent",attributeName:"halign",variableNames:["value"]},parentHalign:{dependencyType:"parentStateVariable",variableName:"halign"},tabularHalign:{dependencyType:"ancestor",componentType:"tabular",variableNames:["halign"]}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.halignAttr){let t=e.halignAttr.stateValues.value;return["left","center","right","justify"].includes(t)||(t="left"),{setValue:{halign:t}}}return!t.parentHalign&&e.parentHalign?{setValue:{halign:e.parentHalign}}:!t.tabularHalign&&e.tabularHalign?{setValue:{halign:e.tabularHalign.stateValues.halign}}:{useEssentialOrDefaultValue:{halign:!0}}}},e.bottom={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"none",returnDependencies:()=>({bottomAttr:{dependencyType:"attributeComponent",attributeName:"bottom",variableNames:["value"]},parentBottom:{dependencyType:"parentStateVariable",variableName:"bottom"},tabularBottom:{dependencyType:"ancestor",componentType:"tabular",variableNames:["bottom"]}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.bottomAttr){let t=e.bottomAttr.stateValues.value;return["none","minor","medium","major"].includes(t)||(t="none"),{setValue:{bottom:t}}}return!t.parentBottom&&e.parentBottom?{setValue:{bottom:e.parentBottom}}:!t.tabularBottom&&e.tabularBottom?{setValue:{bottom:e.tabularBottom.stateValues.bottom}}:{useEssentialOrDefaultValue:{bottom:!0}}}},e.right={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,hasEssential:!0,defaultValue:"none",returnDependencies:()=>({rightAttr:{dependencyType:"attributeComponent",attributeName:"right",variableNames:["value"]},tabularRight:{dependencyType:"ancestor",componentType:"tabular",variableNames:["right"]}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.rightAttr){let t=e.rightAttr.stateValues.value;return["none","minor","medium","major"].includes(t)||(t="none"),{setValue:{right:t}}}return!t.tabularRight&&e.tabularRight?{setValue:{right:e.tabularRight.stateValues.right}}:{useEssentialOrDefaultValue:{right:!0}}}},e.inHeader={public:!0,shadowingInstructions:{createComponentOfType:"booloean"},forRenderer:!0,defaultValue:!1,returnDependencies:()=>({parentHeader:{dependencyType:"parentStateVariable",variableName:"header"}}),definition:({dependencyValues:e})=>({setValue:{inHeader:!0===e.parentHeader}})},e.onlyMathChild={returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"]},otherChildren:{dependencyType:"child",childGroups:["anything"]}}),definition:({dependencyValues:e})=>({setValue:{onlyMathChild:1===e.mathChild.length&&0===e.otherChildren.length}})},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({children:{dependencyType:"child",childGroups:["maths","anything"],variableNames:["text"],variablesOptional:!0},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition({dependencyValues:e}){if(0===e.children.length)return{useEssentialOrDefaultValue:{text:{defaultValue:e.prefill}}};let t="";for(let n of e.children)"object"==typeof n?n.stateValues.text&&(t+=n.stateValues.text):t+=n.toString();return{setValue:{text:t}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>0===t.children.length?{success:!0,instructions:[{setEssentialValue:"text",value:null===e.text?"":String(e.text)}]}:1===t.children.length?"object"==typeof t.children[0]&&void 0===t.children[0].stateValues.text?{success:!1}:{success:!0,instructions:[{setDependency:"children",desiredValue:e.text,childIndex:0,variableIndex:0}]}:{success:!1}},e.math={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["onlyMathChild"],returnDependencies:({stateValues:e})=>e.onlyMathChild?{mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]}}:{text:{dependencyType:"stateVariable",variableName:"text"}},definition({dependencyValues:e}){if(e.mathChild)return{setValue:{math:e.mathChild[0].stateValues.value}};{let t;try{t=me$3.fromAst(textToAst$1.convert(e.text))}catch(e){t=me$3.fromAst("")}return{setValue:{math:t}}}},async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,workspace:r}){if(t.mathChild)return{success:!0,instructions:[{setDependency:"mathChild",desiredValue:e.math,childIndex:0,variableIndex:0}]};return{success:!0,instructions:[{setDependency:"text",desiredValue:(await preprocessMathInverseDefinition({desiredValue:e.math,stateValues:n,variableName:"math",workspace:r})).desiredValue.toString()}]}}},e.number={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({math:{dependencyType:"stateVariable",variableName:"math"}}),definition({dependencyValues:e}){let t=e.math.evaluate_to_constant();return Number.isFinite(t)||(t=NaN),{setValue:{number:t}}},inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"math",desiredValue:me$3.fromAst(e.number)}]})},e}static adapters=["text","math","number"]}class Row extends BaseComponent{static componentType="row";static rendererType="row";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},e.header={createComponentOfType:"boolean",createStateVariable:"header",defaultValue:!1,public:!0,forRenderer:!0},e.halign={createComponentOfType:"text"},e.valign={createComponentOfType:"text"},e.left={createComponentOfType:"text"},e.bottom={createComponentOfType:"text"},e}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.halign={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"left",hasEssential:!0,returnDependencies:()=>({halignAttr:{dependencyType:"attributeComponent",attributeName:"halign",variableNames:["value"]},parentHalign:{dependencyType:"parentStateVariable",variableName:"halign"}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.halignAttr){let t=e.halignAttr.stateValues.value;return["left","center","right","justify"].includes(t)||(t="left"),{setValue:{halign:t}}}return null===e.parentHalign||t.parentHalign?{useEssentialOrDefaultValue:{halign:!0}}:{setValue:{halign:e.parentHalign}}}},e.valign={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"middle",hasEssential:!0,returnDependencies:()=>({valignAttr:{dependencyType:"attributeComponent",attributeName:"valign",variableNames:["value"]},parentValign:{dependencyType:"parentStateVariable",variableName:"valign"}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.valignAttr){let t=e.valignAttr.stateValues.value;return["top","middle","bottom"].includes(t)||(t="middle"),{setValue:{valign:t}}}return null===e.parentValign||t.parentValign?{useEssentialOrDefaultValue:{valign:!0}}:{setValue:{valign:e.parentValign}}}},e.left={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"none",hasEssential:!0,returnDependencies:()=>({leftAttr:{dependencyType:"attributeComponent",attributeName:"left",variableNames:["value"]},parentLeft:{dependencyType:"parentStateVariable",variableName:"left"}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.leftAttr){let t=e.leftAttr.stateValues.value;return["none","minor","medium","major"].includes(t)||(t="none"),{setValue:{left:t}}}return null===e.parentLeft||t.parentLeft?{useEssentialOrDefaultValue:{left:!0}}:{setValue:{left:e.parentLeft}}}},e.bottom={public:!0,shadowingInstructions:{createComponentOfType:"text"},defaultValue:"none",hasEssential:!0,returnDependencies:()=>({bottomAttr:{dependencyType:"attributeComponent",attributeName:"bottom",variableNames:["value"]},parentBottom:{dependencyType:"parentStateVariable",variableName:"bottom"}}),definition({dependencyValues:e,usedDefault:t}){if(null!==e.bottomAttr){let t=e.bottomAttr.stateValues.value;return["none","minor","medium","major"].includes(t)||(t="none"),{setValue:{bottom:t}}}return null===e.parentBottom||t.parentBottom?{useEssentialOrDefaultValue:{bottom:!0}}:{setValue:{bottom:e.parentBottom}}}},e.prescribedCellsWithColNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childGroups:["cells"],variableNames:["colNum"]}}),definition:({dependencyValues:e})=>({setValue:{prescribedCellsWithColNum:e.cellChildren}})},e}}class Column extends BaseComponent{static componentType="column";static rendererType="container";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},e}static returnChildGroups(){return[{group:"cells",componentTypes:["cell"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.prescribedCellsWithRowNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childGroups:["cells"],variableNames:["rowNum"]}}),definition:({dependencyValues:e})=>({setValue:{prescribedCellsWithRowNum:e.cellChildren}})},e}}class CellBlock extends BaseComponent{static componentType="cellBlock";static rendererType="container";static createAttributesObject(){let e=super.createAttributesObject();return e.rowNum={createComponentOfType:"text",createStateVariable:"rowNum",defaultValue:null,public:!0},e.colNum={createComponentOfType:"text",createStateVariable:"colNum",defaultValue:null,public:!0},e}static returnChildGroups(){return[{group:"children",componentTypes:["cell","row","column","cellblock"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.prescribedCellsRowsColumnsBlocks={returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childGroups:["children"],variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({setValue:{prescribedCellsRowsColumnsBlocks:e.cellRelatedChildren}})},e}}class Tabular extends BlockComponent{static componentType="tabular";static rendererType="tabular";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:100,isAbsolute:!1},public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:null,public:!0,forRenderer:!0},e.halign={createComponentOfType:"text",createStateVariable:"halign",defaultValue:"left",public:!0,validValues:["left","center","right","justify"]},e.valign={createComponentOfType:"text",createStateVariable:"valign",defaultValue:"middle",public:!0,validValues:["top","middle","bottom"]},e.top={createComponentOfType:"text",createStateVariable:"top",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"],forRenderer:!0},e.left={createComponentOfType:"text",createStateVariable:"left",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},e.bottom={createComponentOfType:"text",createStateVariable:"bottom",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},e.right={createComponentOfType:"text",createStateVariable:"right",defaultValue:"none",public:!0,validValues:["none","minor","medium","major"]},e}static returnChildGroups(){return[{group:"rows",componentTypes:["row"]}]}static returnStateVariableDefinitions(){return super.returnStateVariableDefinitions()}}class Table extends BlockComponent{static componentType="table";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.suppressTableNameInTitle={createComponentOfType:"boolean",createStateVariable:"suppressTableNameInTitle",defaultValue:!1,forRenderer:!0},e.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!0,forRenderer:!0},e}static returnChildGroups(){return[{group:"titles",componentTypes:["title"]},{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.tableEnumeration={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],additionalStateVariablesDefined:[{variableName:"tableName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies({stateValues:e}){let t={};return e.number&&(t.tableCounter={dependencyType:"counter",counterName:"table"}),t},definition({dependencyValues:e}){if(void 0===e.tableCounter)return{setValue:{tableEnumeration:null,tableName:"Table"}};let t=String(e.tableCounter);return{setValue:{tableEnumeration:t,tableName:"Table "+t}}}},e.titleChildName={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition({dependencyValues:e}){let t=null;return e.titleChild.length>0&&(t=e.titleChild[0].componentName),{setValue:{titleChildName:t}}}},e.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]}}),definition({dependencyValues:e}){let t=null;return e.titleChild.length>0&&(t=e.titleChild[0].stateValues.text),{setValue:{title:t}}}},e}}class Figure extends BlockComponent{static componentType="figure";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.suppressFigureNameInCaption={createComponentOfType:"boolean",createStateVariable:"suppressFigureNameInCaption",defaultValue:!1,forRenderer:!0},e.number={createComponentOfType:"boolean",createStateVariable:"number",defaultValue:!0,forRenderer:!0},e}static returnChildGroups(){return[{group:"captions",componentTypes:["caption"]},{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.figureEnumeration={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,stateVariablesDeterminingDependencies:["number"],additionalStateVariablesDefined:[{variableName:"figureName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies({stateValues:e}){let t={};return e.number&&(t.figureCounter={dependencyType:"counter",counterName:"figure"}),t},definition({dependencyValues:e}){if(void 0===e.figureCounter)return{setValue:{figureEnumeration:null,figureName:"Figure"}};let t=String(e.figureCounter);return{setValue:{figureEnumeration:t,figureName:"Figure "+t}}}},e.captionChildName={forRenderer:!0,returnDependencies:()=>({captionChild:{dependencyType:"child",childGroups:["captions"]}}),definition({dependencyValues:e}){let t=null;return e.captionChild.length>0&&(t=e.captionChild[0].componentName),{setValue:{captionChildName:t}}}},e.caption={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({captionChild:{dependencyType:"child",childGroups:["captions"],variableNames:["text"]}}),definition({dependencyValues:e}){let t=null;return e.captionChild.length>0&&(t=e.captionChild[0].stateValues.text),{setValue:{caption:t}}}},e}}class VariantNames extends BaseComponent{static componentType="variantNames";static rendererType=void 0;static stateVariableForAttributeValue="variantNames";static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nVariants={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition:function({dependencyValues:e}){return{setValue:{nVariants:e.stringChildren.length}}}},e.variantNames={public:!0,shadowingInstructions:{createComponentOfType:"variantName"},isArray:!0,entryPrefixes:["variantName"],returnArraySizeDependencies:()=>({nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),returnArraySize:({dependencyValues:e})=>[e.nVariants],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"],childIndices:[n]}};return{dependenciesByKey:t}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)1===e[r].stringChild.length&&(n[r]=e[r].stringChild[0].toLowerCase().substring(0,1e3));return{setValue:{variantNames:n}}}},e}}class Seeds extends InlineComponent{static componentType="seeds";static rendererType=void 0;static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=e.reduce((function(e,t){return"string"==typeof t?[...e,...t.split(/\s+/).filter((e=>e))]:[...e,t]}),[]);return{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nSeeds={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({stringChildren:{dependencyType:"child",childGroups:["strings"]}}),definition:function({dependencyValues:e}){return{setValue:{nSeeds:e.stringChildren.length}}}},e.seeds={public:!0,shadowingInstructions:{createComponentOfType:"seed"},isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize:({dependencyValues:e})=>[e.nSeeds],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"],childIndices:[n]}};return{dependenciesByKey:t}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)1===e[r].stringChild.length&&(n[r]=e[r].stringChild[0]);return{setValue:{seeds:n}}}},e}}class VariantControl extends BaseComponent{static componentType="variantControl";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.nVariants={createPrimitiveOfType:"integer",createStateVariable:"nVariants",defaultValue:100,clamp:[1,999],public:!0},e.uniqueVariants={createPrimitiveOfType:"boolean",createStateVariable:"uniqueVariants",defaultValue:!1,public:!0},e.variantIndicesToIgnore={createComponentOfType:"numberListFromString",createStateVariable:"variantIndicesToIgnorePreliminary",defaultValue:[]},e.variantNames={createComponentOfType:"variantNames"},e.seeds={createComponentOfType:"seeds"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nVariantsSpecified={returnDependencies:({sharedParameters:e})=>({uniqueVariants:{dependencyType:"stateVariable",variableName:"uniqueVariants"},numberOfVariantsFromSharedParameters:{dependencyType:"value",value:e.numberOfVariantsPreIgnore},nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),definition:function({dependencyValues:e}){let t=e.nVariants;return t<1&&(t=1),e.uniqueVariants&&(void 0!==e.numberOfVariantsFromSharedParameters?t=e.numberOfVariantsFromSharedParameters:console.log("Restricting to unique variants was not successful")),{setValue:{nVariantsSpecified:t}}}},e.variantIndicesToIgnore={returnDependencies:()=>({variantIndicesToIgnorePreliminary:{dependencyType:"stateVariable",variableName:"variantIndicesToIgnorePreliminary"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}),definition({dependencyValues:e}){let t=e.variantIndicesToIgnorePreliminary.filter((t=>Number.isInteger(t)&&t>=1&&t<=e.nVariantsSpecified)).sort(((e,t)=>e-t));return{setValue:{variantIndicesToIgnore:t}}}},e.nSeeds={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({seedsAttr:{dependencyType:"attributeComponent",attributeName:"seeds",variableNames:["nSeeds"]}}),definition:function({dependencyValues:e}){return null!==e.seedsAttr?{setValue:{nSeeds:e.seedsAttr.stateValues.nSeeds}}:{setValue:{nSeeds:0}}}},e.seeds={public:!0,shadowingInstructions:{createComponentOfType:"seed"},isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize:({dependencyValues:e})=>[e.nSeeds],returnArrayDependenciesByKey({arrayKeys:e}){let t={};for(let n of e)t[n]={seedsAttr:{dependencyType:"attributeComponent",attributeName:"seeds",variableNames:["seed"+(Number(n)+1)]}};return{dependenciesByKey:t}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:t}){let n={};for(let r of t)null!==e[r].seedsAttr&&(n[r]=e[r].seedsAttr.stateValues["seed"+(Number(r)+1)]);return{setValue:{seeds:n}}}},e.originalVariantNames={returnDependencies:()=>({variantNamesAttr:{dependencyType:"attributeComponent",attributeName:"variantNames",variableNames:["variantNames"]}}),definition:function({dependencyValues:e}){let t=[];return null!==e.variantNamesAttr&&(t=e.variantNamesAttr.stateValues.variantNames),{setValue:{originalVariantNames:t}}}},e.variantNames={public:!0,shadowingInstructions:{createComponentOfType:"variantName"},isArray:!0,entryPrefixes:["variantName"],returnArraySizeDependencies:()=>({nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}),returnArraySize:({dependencyValues:e})=>[e.nVariantsSpecified],returnArrayDependenciesByKey:({arrayKeys:e})=>({globalDependencies:{originalVariantNames:{dependencyType:"stateVariable",variableName:"originalVariantNames"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}}),arrayDefinitionByKey:function({globalDependencyValues:e,arrayKeys:t}){let n,r=[...e.originalVariantNames],a=r.length,i=a;for(;a<e.nVariantsSpecified;){for(a++,i++,n=indexToLowercaseLetters(i);e.originalVariantNames.includes(n);)i++,n=indexToLowercaseLetters(i);r.push(n)}return{setValue:{variantNames:r}}}},e.selectedVariantIndex={public:!0,shadowingInstructions:{createComponentOfType:"number"},immutable:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:({sharedParameters:e})=>({variantsObject:{dependencyType:"variants"},originalVariantNames:{dependencyType:"stateVariable",variableName:"originalVariantNames"},variantNames:{dependencyType:"stateVariable",variableName:"variantNames"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"},variantIndicesToIgnore:{dependencyType:"stateVariable",variableName:"variantIndicesToIgnore"},variantRng:{dependencyType:"value",value:e.variantRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(void 0!==e.variantsObject&&void 0!==e.variantsObject.desiredVariantIndex){let t=Number(e.variantsObject.desiredVariantIndex);if(Number.isFinite(t)){Number.isInteger(t)||(console.warn("Variant index "+e.variantsObject.desiredVariantIndex+" must be an integer"),t=Math.round(t));let n=(t-1)%e.nVariantsSpecified;n<0&&(n+=e.nVariantsSpecified);let r=n+1;return{setEssentialValue:{selectedVariantIndex:r},setValue:{selectedVariantIndex:r}}}return console.warn("Variant index "+e.variantsObject.desiredVariantIndex+" must be a number"),{setEssentialValue:{selectedVariantIndex:!0},setValue:{selectedVariantIndex:1}}}let t;if(e.variantRng){let n=e.variantRng(),r=e.nVariantsSpecified,a=e.variantIndicesToIgnore;if(a.length>0&&(a=a.filter((e=>Number.isInteger(e)&&e>=1&&e<=r)).sort(((e,t)=>e-t)),r-=a.length),t=Math.floor(n*r)+1,a.length>0)for(let e of a){if(!(t>=e))break;t++}}else{t=1;let n=e.variantIndicesToIgnore;if(n.length>0){n=n.filter((e=>Number.isInteger(e)&&e>=1&&e<=nVariants)).sort(((e,t)=>e-t));for(let e of n){if(!(t>=e))break;t++}}}return{setEssentialValue:{selectedVariantIndex:t},setValue:{selectedVariantIndex:t}}}},e.selectedVariantName={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({variantNames:{dependencyType:"stateVariable",variableName:"variantNames"},selectedVariantIndex:{dependencyType:"stateVariable",variableName:"selectedVariantIndex"}}),definition:function({dependencyValues:e}){return{setValue:{selectedVariantName:e.variantNames[e.selectedVariantIndex-1]}}}},e.selectedSeed={returnDependencies:()=>({selectedVariantIndex:{dependencyType:"stateVariable",variableName:"selectedVariantIndex"},seeds:{dependencyType:"stateVariable",variableName:"seeds"}}),definition:function({dependencyValues:e}){if(e.selectedVariantIndex<=e.seeds.length)return{setValue:{selectedSeed:e.seeds[e.selectedVariantIndex-1]}};let t,n=e.seeds.length,r=n;for(;n<e.selectedVariantIndex;)for(n++,r++,t=r.toString();e.seeds.includes(t);)r++,t=r.toString();return{setValue:{selectedSeed:t}}}},e.variantRng={returnDependencies:({sharedParameters:e})=>({selectedSeed:{dependencyType:"stateVariable",variableName:"selectedSeed"},rngClass:{dependencyType:"value",value:e.rngClass,doNotProxy:!0}}),definition:({dependencyValues:e})=>({setValue:{variantRng:new e.rngClass(e.selectedSeed)}})},e}}function indexToLowercaseLetters(e){return numberToLetters(e,!0)}class SelectFromSequence extends Sequence{static componentType="selectFromSequence";static assignNamesToReplacements=!0;static createsVariants=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},e.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},e.sortResults={createComponentOfType:"boolean",createStateVariable:"sortResults",defaultValue:!1,public:!0},e.excludeCombinations={createComponentOfType:"_componentListOfListsWithSelectableType"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();e.excludedCombinations={returnDependencies:()=>({excludeCombinations:{dependencyType:"attributeComponent",attributeName:"excludeCombinations",variableNames:["lists"]}}),definition:function({dependencyValues:e}){return null!==e.excludeCombinations?{setValue:{excludedCombinations:e.excludeCombinations.stateValues.lists}}:{setValue:{excludedCombinations:[]}}}},e.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){return{setValue:{variants:e.variants}}}},e.selectedValues={immutable:!0,hasEssential:!0,shadowVariable:!0,additionalStateVariablesDefined:[{variableName:"selectedIndices",hasEssential:!0,shadowVariable:!0,immutable:!0}],returnDependencies:({sharedParameters:e})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},excludedCombinations:{dependencyType:"stateVariable",variableName:"excludedCombinations"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"},sortResults:{dependencyType:"stateVariable",variableName:"sortResults"},variants:{dependencyType:"stateVariable",variableName:"variants"},variantRng:{dependencyType:"value",value:e.variantRng,doNotProxy:!0}}),definition:makeSelection},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition:({dependencyValues:e,componentName:t})=>({setValue:{generatedVariantInfo:{indices:e.selectedIndices,meta:{createdBy:t}}}})};let t=e.readyToExpandWhenResolved.returnDependencies;return e.readyToExpandWhenResolved.returnDependencies=function(){let e=t();return e.selectedValues={dependencyType:"stateVariable",variableName:"selectedValues"},e},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n}){let r=await e.stateValues.type;"letters"===r&&(r="text");let a=e.attributes.newNamespace?.primitive,i={};for(let t of["fixed","displayDigits","displaySmallAsZero","displayDecimals","padZeros"])t in e.attributes&&(i[t]=e.attributes[t]);let o={};Object.keys(i).length>0&&(o=convertAttributesForComponentType({attributes:i,componentType:r,componentInfoObjects:t,compositeCreatesNewNamespace:a,flags:n}));let s=[];for(let t of await e.stateValues.selectedValues)s.push({componentType:r,attributes:o,state:{value:t,fixed:!0}});return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:s,parentName:e.componentName,parentCreatesNewNamespace:a,componentInfoObjects:t}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:e}){let t=1,n=!1,r=e.attributes.type.primitive,a=e.attributes.numberToSelect?.component;if(a){if("integer"!==a.componentType||1!==a.children?.length||"string"!=typeof a.children[0])return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't constant number."),{success:!1};if(t=Number(a.children[0]),!(Number.isInteger(t)&&t>=0))return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't a non-negative integer."),{success:!1}}let i=e.attributes.withReplacement?.component;if(i){if("boolean"!==i.componentType)return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};if(1===i.children?.length&&"string"==typeof i.children[0])n="true"===i.children[0].toLowerCase();else{if(void 0!==i.children&&0!==i.children.length||"boolean"!=typeof i.state?.value)return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};n=i.state.value}}let o={from:null,to:null,step:null,length:null},s=e.attributes.from?.component;if(s){let e=s.children[0];if(1!==e.children?.length||"string"!=typeof e.children[0])return console.log("cannot determine unique variants of selectFromSequence as from isn't a constant."),{success:!1};{let t;if("number"===r){if(t=Number(e.children[0]),!Number.isFinite(t))return console.log("cannot determine unique variants of selectFromSequence of number type as from isn't a number."),{success:!1}}else if("letters"===r){if(t=lettersToNumber$1(e.children[0]),!Number.isFinite(t))return console.log("cannot determine unique variants of selectFromSequence of letters type as from isn't a combination of letters."),{success:!1}}else{let n=getFromText({functionSymbols:["f","g"]});try{t=n(e.children[0])}catch(e){return console.log("cannot determine unique variants of selectFromSequence of math type as from isn't a valid math expression."),{success:!1}}}o.from=t}}let l=e.attributes.to?.component;if(l){let e=l.children[0];if(1!==e.children?.length||"string"!=typeof e.children[0])return console.log("cannot determine unique variants of selectFromSequence as to isn't a constant."),{success:!1};{let t;if("number"===r){if(t=Number(e.children[0]),!Number.isFinite(t))return console.log("cannot determine unique variants of selectFromSequence of number type as to isn't a number."),{success:!1}}else if("letters"===r){if(t=lettersToNumber$1(e.children[0]),!Number.isFinite(t))return console.log("cannot determine unique variants of selectFromSequence of letters type as to isn't a combination of letters."),{success:!1}}else{let n=getFromText({functionSymbols:["f","g"]});try{t=n(e.children[0])}catch(e){return console.log("cannot determine unique variants of selectFromSequence of math type as to isn't a valid math expression."),{success:!1}}}o.to=t}}let u=e.attributes.step?.component;if(u){if(1!==u.children?.length||"string"!=typeof u.children[0])return console.log("cannot determine unique variants of selectFromSequence as step isn't a constant."),{success:!1};{let e;if("number"===r){if(e=Number(u.children[0]),!Number.isFinite(e))return console.log("cannot determine unique variants of selectFromSequence of number type as step isn't a number."),{success:!1}}else if("letters"===r){if(e=Number(u.children[0]),!Number.isInteger(e))return console.log("cannot determine unique variants of selectFromSequence of letters type as step isn't an integer."),{success:!1}}else{let t=getFromText({functionSymbols:["f","g"]});try{e=t(u.children[0])}catch(e){return console.log("cannot determine unique variants of selectFromSequence of math type as step isn't a valid math expression."),{success:!1}}}o.step=e}}let c=e.attributes.length?.component;if(c){if(1!==c.children?.length||"string"!=typeof c.children[0])return console.log("cannot determine unique variants of selectFromSequence as length isn't a constant."),{success:!1};{let e=Number(c.children[0]);if(!Number.isInteger(e))return console.log("cannot determine unique variants of selectFromSequence as length isn't an integer."),{success:!1};o.length=e}}if(e.attributes.excludeCombinations)return console.log("have not implemented unique variants of a selectFromSequence with excludeCombinations"),{success:!0};let p=[],d=e.attributes.exclude?.component;if(d){if("math"===r&&console.log("have not implemented unique variants of a selectFromSequence of type math with exclude"),!d.children.every((e=>1===e.children.length&&"string"==typeof e.children[0])))return console.log("have not implemented unique variants of a selectFromSequence with non-constant exclude"),{success:!0};if(p="letters"===r?d.children.map((e=>lettersToNumber$1(e.children[0]))):d.children.map((e=>Number(e.children[0]))),!p.every(Number.isFinite))return console.log("have not implemented unique variants of a selectFromSequence with non-constant exclude"),{success:!0}}o=calculateSequenceParameters(o);let m=o.length,f=[];if(p.length>0&&"math"!==r){p.sort(((e,t)=>e-t)),p=p.filter(((e,t,n)=>e!=n[t-1]));for(let e of p){if(e<o.from)continue;let t=(e-o.from)/o.step;if(t>o.length-1+1e-10)break;Math.abs(t-Math.round(t))<1e-10&&(m--,f.push(t))}}if(m<=0)return{success:!1};let h,y={excludeIndices:f,nOptions:m,numberToSelect:t,withReplacement:n};if(e.variants.uniqueVariantData=y,n||1===t)h=Math.pow(m,t);else{h=m;for(let e=m-1;e>m-t;e--)h*=e}return e.variants.numberOfVariants=h,{success:!0,numberOfVariants:h}}static getUniqueVariant({serializedComponent:e,variantIndex:t}){let n=e.variants?.numberOfVariants;if(void 0===n)return{success:!1};if(!Number.isInteger(t)||t<1||t>n)return{success:!1};let r=e.variants.uniqueVariantData,a=r.excludeIndices,i=r.nOptions,o=r.numberToSelect,s=r.withReplacement,l=function(e){let t=e;for(let e of a)t>=e&&t++;return t};if(1===o)return{success:!0,desiredVariant:{indices:[l(t-1)+1]}};let u=enumerateSelectionCombinations({numberOfIndices:o,numberOfOptions:i,maxNumber:t,withReplacement:s})[t-1].map(l).map((e=>e+1));return{success:!0,desiredVariant:{indices:u}}}}function makeSelection({dependencyValues:e}){if(e.numberToSelect<1)return{setEssentialValue:{selectedValues:[],selectedIndices:[]},setValue:{selectedValues:[],selectedIndices:[]}};let t=1;if(e.withReplacement||(t=e.numberToSelect),t>e.length)throw Error("Cannot select "+t+" values from a sequence of length "+e.length);if(e.variants&&void 0!==e.variants.desiredVariant){let t=e.variants.desiredVariant.indices;if(void 0!==t){if(t.length!==e.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(t=t.map(Number),!t.every(Number.isInteger))throw Error("All indices specified for select must be integers");let n=e.length;t=t.map((e=>((e-1)%n+n)%n+1));let r=[];for(let n of t){let t=returnSequenceValueForIndex({index:n-1,from:e.from,step:e.step,length:e.length,exclude:e.exclude,type:e.type,lowercase:e.lowercase});if(null===t)throw Error("Specified index of selectfromsequence that was excluded");r.push(t)}if(checkForExcludedCombination({type:e.type,excludedCombinations:e.excludedCombinations,values:r}))throw Error("Specified indices of selectfromsequence that was an excluded combination");return{setEssentialValue:{selectedValues:r,selectedIndices:t},setValue:{selectedValues:r,selectedIndices:t}}}}let n,r,a=e.excludedCombinations.length;if(0===a){let a=selectValuesAndIndices({stateValues:e,numberUniqueRequired:t,numberToSelect:e.numberToSelect,withReplacement:e.withReplacement,rng:e.variantRng});n=a.selectedValues,r=a.selectedIndices}else{let i=e.length-e.exclude.length;if(e.withReplacement)i=Math.pow(i,e.numberToSelect);else{let t=i;for(let n=1;n<e.numberToSelect;n++)i*=t-n}if(a>.7*i){let t=0;for(let n=0;n<e.length;n++)null!==returnSequenceValueForIndex({index:n,from:e.from,step:e.step,length:e.length,exclude:e.exclude,type:e.type})&&t++;if(e.withReplacement)t=Math.pow(t,e.numberToSelect);else{let n=t;for(let r=1;r<e.numberToSelect;r++)t*=n-r}if(a>.7*t)throw Error("Excluded over 70% of combinations in selectFromSequence")}let o=!1;for(let a=0;a<200;a++){let a=selectValuesAndIndices({stateValues:e,numberUniqueRequired:t,numberToSelect:e.numberToSelect,withReplacement:e.withReplacement,rng:e.variantRng});if(n=a.selectedValues,r=a.selectedIndices,!checkForExcludedCombination({type:e.type,excludedCombinations:e.excludedCombinations,values:n})){o=!0;break}}if(!o)throw Error("By extremely unlikely fluke, couldn't select combination of random values")}if(e.sortResults){let t=[];for(let[e,a]of n.entries())t.push({value:a,index:r[e]});"number"===e.type?t.sort(((e,t)=>e.value-t.value)):"letters"===e.type&&t.sort(((e,t)=>lettersToNumber$1(e.value)-lettersToNumber$1(t.value))),n=t.map((e=>e.value)),r=t.map((e=>e.index))}return{setEssentialValue:{selectedValues:n,selectedIndices:r},setValue:{selectedValues:n,selectedIndices:r}}}function selectValuesAndIndices({stateValues:e,numberUniqueRequired:t=1,numberToSelect:n=1,withReplacement:r=!1,rng:a}){let i=[],o=[];if(e.exclude.length+t<.5*e.length){for(let t=0;t<n;t++){let t,n,s=!1;for(let i=0;i<100;i++){let i=a();if(n=Math.floor(i*e.length)+1,(r||!o.includes(n))&&(t=returnSequenceValueForIndex({index:n-1,from:e.from,step:e.step,exclude:e.exclude,type:e.type,lowercase:e.lowercase}),null!==t)){s=!0;break}}if(!s)throw Error("By extremely unlikely fluke, couldn't select random value");i.push(t),o.push(n)}return{selectedValues:i,selectedIndices:o}}let s=returnSequenceValues(e,!0),l=s.length;if(t>l)throw Error("Cannot select "+t+" unique values from sequence of length "+l);if(1===t){for(let e=0;e<n;e++){let e=a(),t=Math.floor(e*l);o.push(s[t].originalIndex+1),i.push(s[t].value)}return{selectedValues:i,selectedIndices:o}}for(let e=s.length-1;e>0;e--){const t=a(),n=Math.floor(t*(e+1));[s[e],s[n]]=[s[n],s[e]]}let u=s.slice(0,n);return i=u.map((e=>e.value)),o=u.map((e=>e.originalIndex+1)),{selectedValues:i,selectedIndices:o}}function checkForExcludedCombination({type:e,excludedCombinations:t,values:n}){return"math"===e?t.some((e=>e.every(((e,t)=>e.equals(n[t]))))):"number"===e?t.some((e=>e.every(((e,t)=>Math.abs(e-n[t])<=1e-14*Math.max(Math.abs(e),Math.abs(n[t])))))):t.some((e=>e.every(((e,t)=>e===n[t]))))}class Select extends CompositeComponent{static componentType="select";static assignNamesToReplacements=!0;static createsVariants=!0;static includeBlankStringChildren=!0;static removeBlankStringChildrenPostSugar=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},e.withReplacement={createComponentOfType:"boolean",createStateVariable:"withReplacement",defaultValue:!1,public:!0},e.type={createPrimitiveOfType:"string"},e.addLevelToAssignNames={createPrimitiveOfType:"boolean",createStateVariable:"addLevelToAssignNames",defaultValue:!1},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t,componentInfoObjects:n}){if(!e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro)))return{success:!1};let r;r=t.type?t.type:"math",["math","text","number","boolean"].includes(r)||(console.warn(`Invalid type ${r}`),r="math");let a=returnGroupIntoComponentTypeSeparatedBySpaces({componentType:r,forceComponentType:!0})({matchedChildren:e,componentInfoObjects:n});if(a.success){return{success:!0,newChildren:a.newChildren.map((e=>({componentType:"option",children:[e]}))),newAttributes:{addLevelToAssignNames:{primitive:!0}}}}return{success:!1}}}),e}static returnChildGroups(){return[{group:"options",componentTypes:["option"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){return{setValue:{variants:e.variants}}}},e.currentVariantName={returnDependencies:({sharedParameters:e})=>({variantName:{dependencyType:"value",value:e.variantName}}),definition:({dependencyValues:e})=>({setValue:{currentVariantName:e.variantName}})},e.allPossibleVariants={returnDependencies:({sharedParameters:e})=>({allPossibleVariants:{dependencyType:"value",value:e.allPossibleVariants}}),definition:({dependencyValues:e})=>({setValue:{allPossibleVariants:e.allPossibleVariants}})},e.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childGroups:["options"],variableNames:["selectForVariantNames","selectWeight"]}}),definition:({dependencyValues:e})=>({setValue:{optionChildren:e.optionChildren,nOptions:e.optionChildren.length}})},e.availableVariants={returnDependencies:()=>({optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},allPossibleVariants:{dependencyType:"stateVariable",variableName:"allPossibleVariants"}}),definition:function({dependencyValues:e}){let t={};for(let[n,r]of e.optionChildren.entries())for(let e of r.stateValues.selectForVariantNames){let r=e.toLowerCase();void 0===t[r]&&(t[r]=[]),t[r].push(n+1)}for(let n in t)if(t[n].length!==e.numberToSelect)throw Error("Invalid variant name for select.  Variant name "+n+" appears in "+t[n].length+" options but number to select is "+numberToSelect);if(Object.keys(t).length>0){for(let n of e.allPossibleVariants)if(!(n in t))throw Error("Some variants are specified for select but no options are specified for possible variant name: "+n);for(let n in t)if(!e.allPossibleVariants.includes(n))throw Error("Variant name "+n+" that is specified for select is not a possible variant name.")}return{setValue:{availableVariants:t}}}},e.selectedIndices={immutable:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:({sharedParameters:e})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},currentVariantName:{dependencyType:"stateVariable",variableName:"currentVariantName"},variants:{dependencyType:"stateVariable",variableName:"variants"},availableVariants:{dependencyType:"stateVariable",variableName:"availableVariants"},variantRng:{dependencyType:"value",value:e.variantRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(!(e.numberToSelect>=1)||0===e.nOptions)return{setEssentialValue:{selectedIndices:[]},setValue:{selectedIndices:[]}};if(e.variants&&void 0!==e.variants.desiredVariant){let t=e.variants.desiredVariant.indices;if(void 0!==t){if(t.length!==e.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(t=t.map(Number),!t.every(Number.isInteger))throw Error("All indices specified for select must be integers");let n=e.nOptions;return t=t.map((e=>((e-1)%n+n)%n+1)),{setEssentialValue:{selectedIndices:t},setValue:{selectedIndices:t}}}}let t=e.availableVariants[e.currentVariantName];if(void 0!==t){if(e.numberToSelect>1){t=[...t];for(let n=e.numberToSelect-1;n>0;n--){const r=e.variantRng(),a=Math.floor(r*(n+1));[t[n],t[a]]=[t[a],t[n]]}}return{setEssentialValue:{selectedIndices:t},setValue:{selectedIndices:t}}}let n=[],r=1;if(e.withReplacement||(r=e.numberToSelect),r>e.nOptions)throw Error("Cannot select "+r+" components from only "+e.nOptions);let a=e.optionChildren.map((e=>e.stateValues.selectWeight)),i=a.reduce(((e,t)=>e+t));a=a.map((e=>e/i));let o=a.reduce(((e,t,n)=>[...e,t+(e[n-1]||0)]),[]),s=[...Array(o.length).keys()].map((e=>e+1));for(let t=0;t<e.numberToSelect;t++){let r=e.variantRng(),l=-1,u=o.length-1;for(;l<u-1;){let e=Math.floor((l+u)/2);o[e]>r?u=e:l=e}let c=s[u];n.push(c),!e.withReplacement&&t<e.numberToSelect-1&&(a.splice(u,1),s.splice(u,1),i=a.reduce(((e,t)=>e+t)),a=a.map((e=>e/i)),o=a.reduce(((e,t,n)=>[...e,t+(e[n-1]||0)]),[]))}return{setEssentialValue:{selectedIndices:n},setValue:{selectedIndices:n}}}},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={providePreviousValuesInDefinition:!0,returnDependencies:({componentInfoObjects:e})=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t,previousValues:n}){let r={indices:e.selectedIndices,meta:{createdBy:t}},a=r.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?a.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&a.push(...t.stateValues.generatedVariantInfo.subvariants);for(let[e,t]of a.entries())if(!t.subvariants&&n.generatedVariantInfo){let t=n.generatedVariantInfo.subvariants;t[e].subvariants&&(a[e]=Object.assign({},a[e]),a[e].subvariants=t[e].subvariants)}return{setValue:{generatedVariantInfo:r}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e}static async createSerializedReplacements({component:e,components:t,componentInfoObjects:n}){let r=[],a=await e.stateValues.optionChildren;for(let n of await e.stateValues.selectedIndices){let e=a[n-1].componentName,i=t[e],o=deepClone(await i.stateValues.serializedChildren),s={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},i.doenetAttributes),children:o,originalName:e};i.attributes.newNamespace&&(s.attributes={newNamespace:{primitive:!0}}),r.push(s)}let i=gatherVariantComponents({serializedComponents:r,componentInfoObjects:n});if(e.variants&&void 0!==e.variants.desiredVariant){let t=e.variants.desiredVariant;if(void 0!==t&&void 0!==t.subvariants)for(let e in t.subvariants){let n=t.subvariants[e],r=i[e];if(void 0===r)break;r.variants.desiredVariant=n}}let o=e.attributes.newNamespace?.primitive,s=e.doenetAttributes.assignNames;s&&await e.stateValues.addLevelToAssignNames&&(s=s.map((e=>[e])));for(let e of r)!e.attributes?.newNamespace?.primitive&&e.children&&markToCreateAllUniqueNames(e.children);let l=[];for(let[t,a]of r.entries()){let r=processAssignNames({assignNames:s,serializedComponents:[a],parentName:e.componentName,parentCreatesNewNamespace:o,componentInfoObjects:n,indOffset:t});l.push(r.serializedComponents[0])}return{replacements:l}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){let n=e.variants?.numberOfVariants;if(void 0!==n)return{success:!0,numberOfVariants:n};let r=1,a=!1,i=e.attributes.numberToSelect?.component;if(i){if("integer"!==i.componentType||1!==i.children?.length||"string"!=typeof i.children[0])return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't constant number."),{success:!1};if(r=Number(i.children[0]),!(Number.isInteger(r)&&r>=0))return console.log("cannot determine unique variants of selectFromSequence as numberToSelect isn't a non-negative integer."),{success:!1}}let o=e.attributes.withReplacement?.component;if(o){if("boolean"!==o.componentType)return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};if(1===o.children?.length&&"string"==typeof o.children[0])a="true"===o.children[0].toLowerCase();else{if(void 0!==o.children&&0!==o.children.length||"boolean"!=typeof o.state?.value)return console.log("cannot determine unique variants of selectFromSequence as withReplacement isn't constant boolean."),{success:!1};a=o.state.value}}for(let t of e.children)if(t.attributes?.selectWeight||t.attributes?.selectForVariantNames)return console.log("Unique variants for select disabled if have an option with selectWeight or selectForVariantNames specified"),{success:!1};void 0===e.variants&&(e.variants={});let s=gatherVariantComponents({serializedComponents:e.children,componentInfoObjects:t});e.variants.descendantVariantComponents=s;let l=[];for(let e of s){let n=t.allComponentClasses[e.componentType].determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t});if(!n.success)return{success:!1};l.push(n.numberOfVariants)}let u={numberOfVariantsByChild:l,numberToSelect:r,withReplacement:a};if(0===l.length)n=1;else if(a||1===r){let e=l.reduce(((e,t)=>e+t));n=Math.pow(e,r)}else{let e=l.length;if(r>e)return{success:!1};let t=l[0],a=l.slice(1).every((e=>e===t));if(a){let a=e;for(let t=e-1;t>e-r;t--)a*=t;n=a*Math.pow(t,r)}else n=countOptions(l,r)}return e.variants.numberOfVariants=n,e.variants.uniqueVariants=!0,e.variants.uniqueVariantData=u,{success:!0,numberOfVariants:n}}static getUniqueVariant({serializedComponent:e,variantIndex:t,componentInfoObjects:n}){let r=e.variants?.numberOfVariants;if(void 0===r)return{success:!1};if(!Number.isInteger(t)||t<1||t>r)return{success:!1};let a,i=e.variants.uniqueVariantData,o=i.numberOfVariantsByChild,s=i.numberToSelect,l=i.withReplacement,u=e.children.length,c=e.children;if(0===o.length)return{success:!0,desiredVariant:{indices:[]}};a=1===s?[...Array(u).keys()].map((e=>[e])):enumerateSelectionCombinations({numberOfIndices:s,numberOfOptions:u,withReplacement:l});let p,d,m=a.length,f=a.map((e=>({combination:e,numberOfPossibilities:e.reduce(((e,t)=>e*o[t]),1)}))),h=[...Array(m).keys()],y=0,b=h.length,g=t-1;for(;b>0;){let e=h.map((e=>f[e])).reduce(((e,t)=>Math.min(e,t.numberOfPossibilities)),1/0),t=e-y;if(g<t*b){p=h[g%b],d=y+Math.floor(g/b)+1;break}y+=t,g-=t*b,h=h.filter((e=>f[e].numberOfPossibilities>y)),b=h.length}let v=a[p],T=enumerateCombinations({numberOfOptionsByIndex:v.map((e=>o[e])),maxNumber:d})[d-1].map((e=>e+1)),C=[],N=!1;for(let[e,t]of v.entries())if(o[t]>1){let r=c[t],a=n.allComponentClasses[r.componentType].getUniqueVariant({serializedComponent:r,variantIndex:T[e],componentInfoObjects:n});if(!a.success)return{success:!1};C.push(a.desiredVariant),N=!0}else C.push({});let A={indices:v.map((e=>e+1))};return N&&(A.subvariants=C),{success:!0,desiredVariant:A}}}let countOptions=function(e,t){if(0===t)return 0;if(1===t)return e.reduce(((e,t)=>e+t));let n=0;for(let r in e){let a=e[r],i=[...e];i.splice(r,1),n+=a*countOptions(i,t-1)}return n};class AnimateFromSequence extends BaseComponent{constructor(e){super(e),this.advanceAnimation=this.advanceAnimation.bind(this)}static componentType="animateFromSequence";static rendererType=void 0;static acceptTarget=!0;static createAttributesObject(){let e=super.createAttributesObject(),t=returnStandardSequenceAttributes();return Object.assign(e,t),e.prop={createPrimitiveOfType:"string"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.animationOn={createComponentOfType:"boolean",createStateVariable:"animationOn",defaultValue:!1,public:!0,triggerActionOnChange:"changedAnimationOn"},e.animationMode={createComponentOfType:"text",createStateVariable:"animationMode",defaultValue:"increase",validValues:["increase","decrease","increase once","decrease once","oscillate"],toLowerCase:!0,public:!0},e.animationInterval={createComponentOfType:"number",createStateVariable:"animationInterval",defaultValue:1e3,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions(),t=returnStandardSequenceStateVariableDefinitions();return Object.assign(e,t),e.possibleValues={additionalStateVariablesDefined:["numberValues"],returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition({dependencyValues:e}){let t=returnSequenceValues(e);return{setValue:{possibleValues:t,numberValues:t.length}}}},e.selectedIndex={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{selectedIndex:!0}}),inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>({success:!0,instructions:[{setEssentialValue:"selectedIndex",value:me$3.math.mod(e.selectedIndex-1,await t.numberValues)+1}]})},e.value={public:!0,shadowingInstructions:{hasVariableComponentType:!0},returnDependencies:()=>({possibleValues:{dependencyType:"stateVariable",variableName:"possibleValues"},selectedIndex:{dependencyType:"stateVariable",variableName:"selectedIndex"},type:{dependencyType:"stateVariable",variableName:"type"}}),definition:({dependencyValues:e})=>({setValue:{value:e.possibleValues[e.selectedIndex-1]},setCreateComponentOfType:{value:e.type}}),async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){if("number"===t.type){let r=e.value;if(r instanceof me$3.class&&(r=r.evaluate_to_constant()),!Number.isFinite(r))return{success:!1};let a=-1,i=t.possibleValues.length-1;for(;a<i-1;){let e=Math.floor((a+i)/2);await n.step*(t.possibleValues[e]-r)>0?i=e:a=e}let o=i;return-1!==a&&Math.abs(r-t.possibleValues[a])<Math.abs(r-t.possibleValues[i])&&(o=a),{success:!0,instructions:[{setDependency:"selectedIndex",desiredValue:o+1}]}}{let e=stateVariablesToUpdate.value,n=t.possibleValues.indexOf(e);return-1===n?{success:!1}:{success:!0,instructions:[{setDependency:"selectedIndex",desiredValue:n+1}]}}}},e.currentAnimationDirection={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,returnDependencies:()=>({animationMode:{dependencyType:"stateVariable",variableName:"animationMode"}}),definition:({dependencyValues:e})=>({useEssentialOrDefaultValue:{currentAnimationDirection:{get defaultValue(){return"decrease"===e.animationMode.substring(0,8)?"decrease":"increase"}}}}),inverseDefinition({desiredStateVariableValues:e}){let t=e.currentAnimationDirection.toLowerCase();return["increase","decrease"].includes(t)||(t="increase"),{success:!0,instructions:[{setEssentialValue:"currentAnimationDirection",value:t}]}}},e.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:e})=>({setValue:{target:e.target}})},e.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){let t=null;return e.targetComponent&&(t=e.targetComponent),{setValue:{targetComponent:t}}}},e.propName={returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{setValue:{propName:e.propName}}}},e.targetIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:e,componentInfoObjects:t}){let n={};return null!==e.targetComponent&&(t.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})?n.targets={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,componentIndex:e.componentIndex}:null!==e.componentIndex&&1!==e.componentIndex||(n.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),n},definition({dependencyValues:e}){let t=null;return e.targets&&(t=e.targets,Array.isArray(t)||(t=[t])),{setValue:{targetIdentities:t}}}},e.targets={stateVariablesDeterminingDependencies:["targetIdentities","propName","propIndex"],returnDependencies:function({stateValues:e}){let t={targetIdentities:{dependencyType:"stateVariable",variableName:"targetIdentities"}};if(null!==e.targetIdentities)for(let[n,r]of e.targetIdentities.entries()){let a;a=e.propName?{dependencyType:"stateVariable",componentName:r.componentName,variableName:e.propName,returnAsComponentObject:!0,variablesOptional:!0,propIndex:e.propIndex,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}:{dependencyType:"stateVariable",componentName:r.componentName,variableName:"value",returnAsComponentObject:!0,variablesOptional:!0},t["target"+n]=a}return t},definition({dependencyValues:e}){let t=null;if(null!==e.targetIdentities){t=[];for(let n in e.targetIdentities)e["target"+n]&&t.push(e["target"+n])}return{setValue:{targets:t}}}},e.valueToIndex={returnDependencies:()=>({possibleValues:{dependencyType:"stateVariable",variableName:"possibleValues"}}),definition:function({dependencyValues:e}){let t={};for(let[n,r]of e.possibleValues.entries())t[r]=n;return{setValue:{valueToIndex:t}}}},e}async changedAnimationOn({stateValues:e,previousValues:t,actionId:n}){let r=[];if(e.animationOn)if(t.animationOn)this.coreFunctions.resolveAction({actionId:n});else{let e=await this.stateValues.currentAnimationDirection,t=await this.stateValues.animationMode,a=await this.stateValues.numberValues,i=await this.stateValues.selectedIndex,o=await this.findIndexFromTarget();"increase"===e?o===a&&("increase once"===t?o=1:"oscillate"===t&&(e="decrease",r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:e}))):"decrease"===e&&1===o&&("decrease once"===t?o=a:"oscillate"===t&&(e="increase",r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:e}))),o!==i&&r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedIndex",value:o});let s=await this.getUpdateInstructionsToSetTargetsToValue((await this.stateValues.possibleValues)[me$3.math.mod(o-1,a)]);r.push(...s),await this.coreFunctions.performUpdate({updateInstructions:r,actionId:n,event:{verb:"played",object:{componentName:this.componentName,componentType:this.componentType},context:{startIndex:o,animationDirection:e,animationMode:t}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName}),this.animationId=nanoid(),await this.coreFunctions.requestAnimationFrame({action:{actionName:"advanceAnimation",componentName:this.componentName},delay:await this.stateValues.animationInterval,animationId:this.animationId,actionArgs:{previousAnimationId:this.animationId}})}else t.animationOn?(await this.coreFunctions.cancelAnimationFrame(this.animationId),this.canceledAnimationId=this.animationId,await this.coreFunctions.triggerChainedActions({componentName:this.componentName}),this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType},context:{endIndex:await this.stateValues.selectedIndex}})):this.coreFunctions.resolveAction({actionId:n})}async findIndexFromTarget(){let e=await this.stateValues.targets,t=await this.stateValues.selectedIndex;if(null===e)return t;let n,r=e[0];if(r?.stateValues&&(n=Object.keys(r.stateValues)[0]),!n)return t;let a=r.stateValues[n],i=await this.stateValues.type;if("number"===i&&a instanceof me$3.class&&(a=a.evaluate_to_constant(),!Number.isFinite(a)))return t;let o=(await this.stateValues.valueToIndex)[a];if(void 0!==o)return o+1;if("number"!==i)return t;let s=await this.stateValues.possibleValues,l=function(e=0,t=s.length-1){if(t<=e+1)return a>s[e]?t:e;let n=Math.round((t+e)/2);return a>s[n]?l(n,t):l(e,n)},u=l();if(0!==u){let e=s[u-1],t=s[u];Math.abs(a-e)<Math.abs(a-t)&&u--}return u+1}async advanceAnimation({previousAnimationId:e,actionId:t}){if(e===this.canceledAnimationId)return void this.coreFunctions.resolveAction({actionId:t});let n,r,a=!0,i=await this.stateValues.animationMode,o=await this.findIndexFromTarget();"decrease"===await this.stateValues.currentAnimationDirection?(n=o-1,n<=1&&("decrease once"===i?a=!1:"oscillate"===i&&(r="increase"))):(n=o+1,n>=await this.stateValues.numberValues&&("increase once"===i?a=!1:"oscillate"===i&&(r="decrease")));let s=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedIndex",value:n}],l=await this.getUpdateInstructionsToSetTargetsToValue((await this.stateValues.possibleValues)[me$3.math.mod(n-1,await this.stateValues.numberValues)]);s.push(...l),a||s.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!1}),r&&s.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"currentAnimationDirection",value:r}),await this.coreFunctions.performUpdate({updateInstructions:s,actionId:t}),a&&(this.animationId=nanoid(),await this.coreFunctions.requestAnimationFrame({action:{actionName:"advanceAnimation",componentName:this.componentName},delay:await this.stateValues.animationInterval,animationId:this.animationId,actionArgs:{previousAnimationId:this.animationId}}))}startAnimation({actionId:e}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!0}],actionId:e})}stopAnimation({actionId:e}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!1}],actionId:e})}async toggleAnimation({actionId:e}){this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"animationOn",value:!await this.stateValues.animationOn}],actionId:e})}actions={changedAnimationOn:this.changedAnimationOn.bind(this),advanceAnimation:this.advanceAnimation.bind(this),startAnimation:this.startAnimation.bind(this),stopAnimation:this.stopAnimation.bind(this),toggleAnimation:this.toggleAnimation.bind(this)};async getUpdateInstructionsToSetTargetsToValue(e){let t=await this.stateValues.targets;if(null==t)return[];let n=[];for(let r of t){let t=Object.keys(r.stateValues)[0];void 0!==t?n.push({updateType:"updateValue",componentName:r.componentName,stateVariable:t,value:e}):await this.stateValues.propName?console.warn(`Cannot animate prop="${await this.stateValues.propName}" of ${await this.stateValues.target} as could not find prop ${await this.stateValues.propName} on a component of type ${r.componentType}`):console.warn(`Cannot animate ${await this.stateValues.target} as could not find a value state variable on a component of type ${r.componentType}`)}return n}}class Evaluate extends MathComponent{static componentType="evaluate";static rendererType="math";static createAttributesObject(){let e=super.createAttributesObject();return e.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},e.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},e.function={createComponentOfType:"function"},e.input={createComponentOfType:"mathList"},e.unordered={createComponentOfType:"boolean",createStateVariable:"unordered",defaultValue:!1,public:!0},e}static returnChildGroups(){return[]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.codePre,delete e.expressionWithCodes,delete e.mathChildrenFunctionSymbols,delete e.codesAdjacentToStrings,delete e.mathChildrenByVectorComponent,delete e.mathChildrenWithCanBeModified,delete e.unordered,e.canBeModified={returnDependencies:()=>({}),definition:()=>({setValue:{canBeModified:!1}})},e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displayDigits"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDigitsAttr?{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}}:e.functionAttr&&!t.functionAttr?{setValue:{displayDigits:e.functionAttr.stateValues.displayDigits}}:{useEssentialOrDefaultValue:{displayDigits:!0}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},defaultValue:10,hasEssential:!0,returnDependencies:()=>({displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displayDecimals"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displayDecimalsAttr?{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}}:e.functionAttr&&!t.functionAttr?{setValue:{displayDecimals:e.functionAttr.stateValues.displayDecimals}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},defaultValue:0,hasEssential:!0,returnDependencies:()=>({displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["displaySmallAsZero"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.displaySmallAsZeroAttr?{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}}:e.functionAttr&&!t.functionAttr?{setValue:{displaySmallAsZero:e.functionAttr.stateValues.displaySmallAsZero}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},defaultValue:!1,hasEssential:!0,returnDependencies:()=>({padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["padZeros"]}}),definition:({dependencyValues:e,usedDefault:t})=>null!==e.padZerosAttr?{setValue:{padZeros:e.padZerosAttr.stateValues.value}}:e.functionAttr&&!t.functionAttr?{setValue:{padZeros:e.functionAttr.stateValues.padZeros}}:{useEssentialOrDefaultValue:{padZeros:!0}}},e.unnormalizedValue={public:!0,shadowingInstructions:{createComponentOfType:"math"},returnDependencies:()=>({inputAttr:{dependencyType:"attributeComponent",attributeName:"input",variableNames:["nComponents","maths"]},functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","numericalfs","symbolic","nInputs","nOutputs"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}}),definition({dependencyValues:e}){if(!e.functionAttr||!e.inputAttr)return{setValue:{unnormalizedValue:me$3.fromAst("")}};let t=e.inputAttr.stateValues.maths;if(1===t.length){let e=t[0].tree;Array.isArray(e)&&["vector","tuple"].includes(e[0])&&(t=e.slice(1).map((e=>me$3.fromAst(e))))}if(t.length!==e.functionAttr.stateValues.nInputs)return{setValue:{unnormalizedValue:me$3.fromAst("")}};let n,r=[],a=e.functionAttr,i=a.stateValues.nOutputs;if(e.forceNumeric||!a.stateValues.symbolic&&!e.forceSymbolic){let e=t.map((e=>e.evaluate_to_constant())).map((e=>null===e?NaN:e));for(let t=0;t<i;t++)r.push(a.stateValues.numericalfs[t](...e))}else for(let e=0;e<i;e++)r.push(a.stateValues.symbolicfs[e](...t).tree);return n=1===i?me$3.fromAst(r[0]):me$3.fromAst(["vector",...r]),{setValue:{unnormalizedValue:n}}}},e}}function sampleFromRandomNumbers({type:e,numberOfSamples:t,standardDeviation:n,mean:r,to:a,from:i,step:o,nDiscreteValues:s,rng:l}){if("gaussian"===e){if(!(n>=0&&Number.isFinite(r))){let e="Invalid mean ("+r+") or standard deviation ("+n+") for a gaussian random variable.";return console.warn(e),Array(t).fill(NaN)}let e=[];for(let a=0;a<t;a++){let t=0,a=0;for(;0===t;)t=l();for(;0===a;)a=l();let i=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a);e.push(r+n*i)}return e}if("uniform"===e){let e=[],n=a-i;for(let r=0;r<t;r++)e.push(i+l()*n);return e}{let e=[];if(s>0)for(let n=0;n<t;n++){let t=Math.floor(l()*s);e.push(i+o*t)}return e}}class SampleRandomNumbers extends CompositeComponent{static componentType="sampleRandomNumbers";static assignNamesToReplacements=!0;static createsVariants=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.numberOfSamples={createComponentOfType:"number",createStateVariable:"numberOfSamples",defaultValue:1,public:!0},e.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:"uniform",public:!0,toLowerCase:!0,validValues:["uniform","discreteuniform","gaussian"]},e.mean={createComponentOfType:"number",createStateVariable:"specifiedMean",defaultValue:0},e.standardDeviation={createComponentOfType:"number",createStateVariable:"specifiedStandardDeviation",defaultValue:1},e.variance={createComponentOfType:"number",createStateVariable:"specifiedVariance",defaultValue:1},e.from={createComponentOfType:"number",createStateVariable:"specifiedFrom",defaultValue:null},e.to={createComponentOfType:"number",createStateVariable:"specifiedTo",defaultValue:null},e.step={createComponentOfType:"number",createStateVariable:"specifiedStep",defaultValue:1},e.displayDigits={leaveRaw:!0},e.displayDecimals={leaveRaw:!0},e.displaySmallAsZero={leaveRaw:!0},e.padZeros={leaveRaw:!0},e.variantDeterminesSeed={createComponentOfType:"boolean",createStateVariable:"variantDeterminesSeed",defaultValue:!1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.step={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"}}),definition({dependencyValues:e}){let t;return t="discreteuniform"===e.type?e.specifiedStep:null,{setValue:{step:t}}}},e.from={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:[{variableName:"to",public:!0,shadowingInstructions:{createComponentOfType:"number"}},{variableName:"nDiscreteValues"}],returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},step:{dependencyType:"stateVariable",variableName:"step"}}),definition({dependencyValues:e}){if(!["discreteuniform","uniform"].includes(e.type))return{setValue:{from:null,to:null,nDiscreteValues:null}};let t=e.step,n=e.specifiedFrom,r=e.specifiedTo,a=null;if(null===r)null===n&&(n=0),"uniform"===e.type?r=n+1:(r=n+t,a=2);else if(null===n)if("uniform"===e.type)n=0;else{let e=0;a=Math.floor((r-e)/t+1),a<1?(a=0,n=null):n=r-(a-1)*t}else"discreteuniform"===e.type&&(a=Math.floor((r-n)/t+1),a<1?a=0:r=n+(a-1)*t);return{setValue:{from:n,to:r,nDiscreteValues:a}}}},e.mean={stateVariablesDeterminingDependencies:["type"],public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({stateValues:e}){let t={type:{dependencyType:"stateVariable",variableName:"type"}};return"gaussian"===e.type?t.specifiedMean={dependencyType:"stateVariable",variableName:"specifiedMean"}:(t.from={dependencyType:"stateVariable",variableName:"from"},t.to={dependencyType:"stateVariable",variableName:"to"}),t},definition({dependencyValues:e}){let t;return t="gaussian"===e.type?e.specifiedMean:(e.from+e.to)/2,{setValue:{mean:t}}}},e.variance={stateVariablesDeterminingDependencies:["type"],public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies({stateValues:e}){let t={type:{dependencyType:"stateVariable",variableName:"type"}};return"gaussian"===e.type?(t.specifiedVariance={dependencyType:"stateVariable",variableName:"specifiedVariance"},t.specifiedStandardDeviation={dependencyType:"stateVariable",variableName:"specifiedStandardDeviation"}):(t.from={dependencyType:"stateVariable",variableName:"from"},t.to={dependencyType:"stateVariable",variableName:"to"},"discreteuniform"===e.type&&(t.step={dependencyType:"stateVariable",variableName:"step"},t.nDiscreteValues={dependencyType:"stateVariable",variableName:"nDiscreteValues"})),t},definition({dependencyValues:e,usedDefault:t}){let n;return n="gaussian"===e.type?t.specifiedVariance&&!t.specifiedStandardDeviation?e.specifiedStandardDeviation**2:e.specifiedVariance:"discreteuniform"===e.type?(e.nDiscreteValues**2-1)*e.step**2/12:(e.to-e.from)**2/12,{setValue:{variance:n}}}},e.standardDeviation={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({variance:{dependencyType:"stateVariable",variableName:"variance"}}),definition:({dependencyValues:e})=>({setValue:{standardDeviation:Math.sqrt(e.variance)}})},e.sampledValues={shadowVariable:!0,hasEssential:!0,stateVariablesDeterminingDependencies:["variantDeterminesSeed"],returnDependencies({stateValues:e,sharedParameters:t}){let n={numberOfSamples:{dependencyType:"stateVariable",variableName:"numberOfSamples"},type:{dependencyType:"stateVariable",variableName:"type"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},nDiscreteValues:{dependencyType:"stateVariable",variableName:"nDiscreteValues"},mean:{dependencyType:"stateVariable",variableName:"mean"},standardDeviation:{dependencyType:"stateVariable",variableName:"standardDeviation"}};return e.variantDeterminesSeed?n.rng={dependencyType:"value",value:t.variantRng,doNotProxy:!0}:n.rng={dependencyType:"value",value:t.rngWithDateSeed,doNotProxy:!0},n},definition({dependencyValues:e}){if(e.numberOfSamples<1)return{setEssentialValue:{sampledValues:[]},setValue:{sampledValues:[]}};let t=sampleFromRandomNumbers(e);return{setEssentialValue:{sampledValues:t},setValue:{sampledValues:t}}},inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"sampledValues",value:e.sampledValues}]})},e.readyToExpandWhenResolved={returnDependencies:()=>({sampledValues:{dependencyType:"stateVariable",variableName:"sampledValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e})=>({variantSeed:{dependencyType:"value",value:e.variantSeed}}),definition:({dependencyValues:e,componentName:t})=>({setValue:{generatedVariantInfo:{seed:e.variantSeed,meta:{createdBy:t}}}})},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,startNum:n=0,flags:r}){let a=e.attributes.newNamespace?.primitive,i={};for(let t of["displayDigits","displaySmallAsZero","displayDecimals","padZeros"])t in e.attributes&&(i[t]=e.attributes[t]);let o=[];for(let s of(await e.stateValues.sampledValues).slice(n)){let e={};Object.keys(i).length>0&&(e=convertAttributesForComponentType({attributes:i,componentType:"number",componentInfoObjects:t,compositeCreatesNewNamespace:a,flags:r})),o.push({componentType:"number",attributes:e,state:{value:s}})}return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:o,parentName:e.componentName,parentCreatesNewNamespace:a,indOffset:n,componentInfoObjects:t}).serializedComponents}}static async calculateReplacementChanges({component:e,componentInfoObjects:t,flags:n}){let r=[],a=await e.stateValues.sampledValues;if(a.length<e.replacements.length){let t=e.replacements.length-a.length;if(t!==e.replacementsToWithhold){let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:t};r.push(e)}}else{if(e.replacementsToWithhold>0){let e={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};r.push(e)}if(a.length>e.replacements.length){let a=await this.createSerializedReplacements({component:e,componentInfoObjects:t,startNum:e.replacements.length,flags:n}),i={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:e.replacements.length,numberReplacementsToReplace:0,serializedReplacements:a.replacements,assignNamesOffset:e.replacements.length};r.push(i)}}let i=Math.min(e.replacements.length,a.length);for(let t=0;t<i;t++){let n={changeType:"updateStateVariables",component:e.replacements[t],stateChanges:{value:a[t]}};r.push(n)}return r}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n});let r=t.variantRng().toString().slice(2,8)+ +new Date;t.rngWithDateSeed=new t.rngClass(r)}static determineNumberOfUniqueVariants({serializedComponent:e,componentInfoObjects:t}){return{success:!1}}async resample({actionId:e}){let t=sampleFromRandomNumbers({type:await this.stateValues.type,numberOfSamples:await this.stateValues.numberOfSamples,standardDeviation:await this.stateValues.standardDeviation,mean:await this.stateValues.mean,to:await this.stateValues.to,from:await this.stateValues.from,step:await this.stateValues.step,nDiscreteValues:await this.stateValues.nDiscreteValues,rng:await this.stateValues.variantDeterminesSeed?this.sharedParameters.variantRng:this.sharedParameters.rngWithDateSeed});return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"sampledValues",value:t}],actionId:e})}actions={resample:this.resample.bind(this)}}class SelectRandomNumbers extends SampleRandomNumbers{static componentType="selectRandomNumbers";static createsVariants=!0;static createAttributesObject(){let e=super.createAttributesObject();return delete e.numberOfSamples,e.assignNamesSkip={createPrimitiveOfType:"number"},e.numberToSelect={createComponentOfType:"integer",createStateVariable:"numberToSelect",defaultValue:1,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){return{setValue:{variants:e.variants}}}},e.step.immutable=!0,e.from.immutable=!0,e.from.additionalStateVariablesDefined[0].immutable=!0,e.from.additionalStateVariablesDefined[1].immutable=!0,e.mean.immutable=!0,e.variance.immutable=!0,e.standardDeviation.immutable=!0,delete e.sampledValues,e.selectedValues={immutable:!0,hasEssential:!0,shadowVariable:!0,returnDependencies:({sharedParameters:e})=>({numberOfSamples:{dependencyType:"stateVariable",variableName:"numberToSelect"},type:{dependencyType:"stateVariable",variableName:"type"},from:{dependencyType:"stateVariable",variableName:"from"},to:{dependencyType:"stateVariable",variableName:"to"},step:{dependencyType:"stateVariable",variableName:"step"},nDiscreteValues:{dependencyType:"stateVariable",variableName:"nDiscreteValues"},mean:{dependencyType:"stateVariable",variableName:"mean"},standardDeviation:{dependencyType:"stateVariable",variableName:"standardDeviation"},variants:{dependencyType:"stateVariable",variableName:"variants"},rng:{dependencyType:"value",value:e.variantRng,doNotProxy:!0}}),definition({dependencyValues:e}){if(e.numberOfSamples<1)return{setEssentialValue:{selectedValues:[]},setValue:{selectedValues:[]}};if(e.variants&&e.variants.desiredVariant){let t=e.variants.desiredVariant.values;if(t){if(t.length!==e.numberOfSamples)throw Error("Number of values specified for selectRandomNumber must match number to select");return{setEssentialValue:{selectedValues:t},setValue:{selectedValues:t}}}}let t=sampleFromRandomNumbers(e);return{setEssentialValue:{selectedValues:t},setValue:{selectedValues:t}}}},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:()=>({selectedValues:{dependencyType:"stateVariable",variableName:"selectedValues"}}),definition:({dependencyValues:e,componentName:t})=>({setValue:{generatedVariantInfo:{values:e.selectedValues,meta:{createdBy:t}}}})},e.readyToExpandWhenResolved={returnDependencies:()=>({selectedValues:{dependencyType:"stateVariable",variableName:"selectedValues"}}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n}){let r=e.attributes.newNamespace?.primitive,a={};for(let t of["displayDigits","displaySmallAsZero","displayDecimals","padZeros"])t in e.attributes&&(a[t]=e.attributes[t]);let i=[];for(let o of await e.stateValues.selectedValues){let e={};Object.keys(a).length>0&&(e=convertAttributesForComponentType({attributes:a,componentType:"number",componentInfoObjects:t,compositeCreatesNewNamespace:r,flags:n})),i.push({componentType:"number",attributes:e,state:{value:o}})}return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:i,parentName:e.componentName,parentCreatesNewNamespace:r,componentInfoObjects:t}).serializedComponents}}}delete SelectRandomNumbers.stateVariableToEvaluateAfterReplacements,delete SelectRandomNumbers.calculateReplacementChanges;class Substitute extends CompositeComponent{static componentType="substitute";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"math",toLowerCase:!0,validValues:["math","text"],public:!0},e.match={createComponentOfType:"_componentWithSelectableType",createStateVariable:"match",defaultValue:null},e.replacement={createComponentOfType:"_componentWithSelectableType",createStateVariable:"replacement",defaultValue:null},e.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.displayDigits={createComponentOfType:"integer"},e.displayDecimals={createComponentOfType:"integer"},e.displaySmallAsZero={createComponentOfType:"number",valueForTrue:1e-14,valueForFalse:0},e.padZeros={createComponentOfType:"boolean"},e.matchWholeWord={createComponentOfType:"boolean",createStateVariable:"matchWholeWord",defaultValue:!1,public:!0},e.matchCase={createComponentOfType:"boolean",createStateVariable:"matchCase",defaultValue:!1,public:!0},e.preserveCase={createComponentOfType:"boolean",createStateVariable:"preserveCase",defaultValue:!1,public:!0},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){let n=t.type;return["math","text"].includes(n)||(n="math"),{success:!0,newChildren:[{componentType:n,children:e}]}}}),e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displayDigits"],variablesOptional:!0}}),definition:({dependencyValues:e,usedDefault:t})=>"math"!==e.type?{setValue:{displayDigits:null}}:null===e.displayDigitsAttr||t.displayDigitsAttr?null!==e.displayDecimalsAttr&&!t.displayDecimalsAttr||1!==e.child.length||t.child[0]&&t.child[0].displayDigits?{useEssentialOrDefaultValue:{displayDigits:!0}}:{setValue:{displayDigits:e.child[0].stateValues.displayDigits}}:{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displayDecimals"],variablesOptional:!0}}),definition:({dependencyValues:e,usedDefault:t})=>"math"!==e.type?{setValue:{displayDecimals:null}}:null===e.displayDecimalsAttr||t.displayDecimalsAttr?1!==e.child.length||t.child[0]&&t.child[0].displayDecimals?{useEssentialOrDefaultValue:{displayDecimals:!0}}:{setValue:{displayDecimals:e.child[0].stateValues.displayDecimals}}:{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["displaySmallAsZero"],variablesOptional:!0}}),definition:({dependencyValues:e,usedDefault:t})=>"math"!==e.type?{setValue:{displaySmallAsZero:null}}:null===e.displaySmallAsZeroAttr||t.displaySmallAsZeroAttr?1!==e.child.length||t.child[0]&&t.child[0].displaySmallAsZero?{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}:{setValue:{displaySmallAsZero:e.child[0].stateValues.displaySmallAsZero}}:{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]},child:{dependencyType:"child",childGroups:["anything"],variableNames:["padZeros"],variablesOptional:!0}}),definition:({dependencyValues:e,usedDefault:t})=>"math"!==e.type?{setValue:{padZeros:null}}:null===e.padZerosAttr||t.padZerosAttr?1!==e.child.length||t.child[0]&&t.child[0].padZeros?{useEssentialOrDefaultValue:{padZeros:!0}}:{setValue:{padZeros:e.child[0].stateValues.padZeros}}:{setValue:{padZeros:e.padZerosAttr.stateValues.value}}},e.originalValue={returnDependencies:()=>({child:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition:({dependencyValues:e})=>e.child.length>0?{setValue:{originalValue:e.child[0].stateValues.value}}:{setValue:{originalValue:null}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.child.length>0?{success:!0,instructions:[{setDependency:"child",desiredValue:e.originalValue,childIndex:0,variableIndex:0}]}:{success:!1}},e.value={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},originalValue:{dependencyType:"stateVariable",variableName:"originalValue"},match:{dependencyType:"stateVariable",variableName:"match"},replacement:{dependencyType:"stateVariable",variableName:"replacement"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},matchWholeWord:{dependencyType:"stateVariable",variableName:"matchWholeWord"},matchCase:{dependencyType:"stateVariable",variableName:"matchCase"},preserveCase:{dependencyType:"stateVariable",variableName:"preserveCase"}}),definition({dependencyValues:e}){if(null===e.originalValue)return{setValue:{value:null}};if(null===e.match||null===e.replacement)return{setValue:{value:e.originalValue}};if("text"===e.type){let t,n=e.originalValue,r="g";e.matchCase||(r="gi"),t=e.matchWholeWord?new RegExp("\\b"+escapeRegExp(e.match)+"\\b",r):new RegExp(escapeRegExp(e.match),r);let a=e.replacement;if(e.preserveCase){let e=returnPreserveCaseReplacer(a);n=n.replace(t,e)}else n=n.replace(t,a);return{setValue:{value:n}}}{let t=e.originalValue.subscripts_to_strings();return t=t.substitute({[e.match.subscripts_to_strings().tree]:e.replacement.subscripts_to_strings()}),t=t.strings_to_subscripts(),t=normalizeMathExpression({value:t,simplify:e.simplify}),{setValue:{value:t}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){if("text"===t.type){let n,r,a=e.value,i="g";t.matchCase||(i="gi");let o=t.match,s=t.replacement;if(t.matchWholeWord)if(n=new RegExp("\\b"+escapeRegExp(o)+"\\b",i),t.matchCase&&t.preserveCase){let e=returnPreserveCaseReplacer(s);r=new RegExp("\\b"+escapeRegExp(e(o))+"\\b",i)}else r=new RegExp("\\b"+escapeRegExp(s)+"\\b",i);else if(n=new RegExp(escapeRegExp(o),i),t.matchCase&&t.preserveCase){let e=returnPreserveCaseReplacer(s);r=new RegExp(escapeRegExp(e(o)),i)}else r=new RegExp(escapeRegExp(s),i);return-1!==t.originalValue.search(r)||-1!==a.search(n)?{success:!1}:(a=a.replace(r,o),{success:!0,instructions:[{setDependency:"originalValue",desiredValue:a}]})}{let n=e.value.subscripts_to_strings(),r=t.match.subscripts_to_strings(),a=t.replacement.subscripts_to_strings();return"string"!=typeof r.tree||"string"!=typeof a.tree||(t.originalValue.variables(!0).includes(a.tree)||n.variables().includes(r.tree))?{success:!1}:(n=n.substitute({[a.tree]:r}),n=n.strings_to_subscripts(),{success:!0,instructions:[{setDependency:"originalValue",desiredValue:n}]})}}},e.readyToExpandWhenResolved={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n}){let r=e.attributes.newNamespace?.primitive,a=await e.stateValues.type,i={componentType:a,state:{value:await e.stateValues.value},downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:"value"}]}};if("math"===a){let t={},n={displayDigits:"integer",displayDecimals:"integer",displaySmallAsZero:"number",padZeros:"boolean"};for(let r in n){let a={componentType:n[r],downstreamDependencies:{[e.componentName]:[{compositeName:e.componentName,dependencyType:"referenceShadow",propVariable:r}]}};t[r]={component:a}}i.attributes=t}return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:[i],parentName:e.componentName,parentCreatesNewNamespace:r,componentInfoObjects:t}).serializedComponents}}}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function returnPreserveCaseReplacer(e){return function(t){return t.toUpperCase()===t?e.toUpperCase():t.toLowerCase()===t?e.toLowerCase():t[0].match(/[a-z]/)?e[0].toLowerCase()+e.substring(1):t[0].match(/[A-Z]/)?e[0].toUpperCase()+e.substring(1):e}}class PeriodicSet extends MathComponent{static componentType="periodicSet";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.minIndex={createComponentOfType:"integer",createStateVariable:"minIndex",defaultValue:-1/0,public:!0},e.maxIndex={createComponentOfType:"integer",createStateVariable:"maxIndex",defaultValue:1/0,public:!0},e.offsets={createComponentOfType:"mathList",createStateVariable:"offsets",defaultValue:null,public:!0},e.period={createComponentOfType:"math",createStateVariable:"period",defaultValue:null,public:!0},e.minIndexAsList={createComponentOfType:"integer",createStateVariable:"minIndexAsList",defaultValue:-1,public:!0},e.maxIndexAsList={createComponentOfType:"integer",createStateVariable:"maxIndexAsList",defaultValue:1,public:!0},e}static returnChildGroups(){return[]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.codePre,delete e.expressionWithCodes,delete e.mathChildrenFunctionSymbols,delete e.codesAdjacentToStrings,delete e.mathChildrenByVectorComponent,delete e.mathChildrenWithCanBeModified,delete e.unordered,e.canBeModified={returnDependencies:()=>({}),definition:()=>({setValue:{canBeModified:!1}})},e.displayDigits={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:10,returnDependencies:()=>({mathListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDigits"},numberListParentDisplayDigits:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDigits"},mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDigitsAttr:{dependencyType:"attributeComponent",attributeName:"displayDigits",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplayDigits){if(!t.mathListParentDisplayDigits)return{setValue:{displayDigits:e.mathListParentDisplayDigits}};r=!0,n=e.mathListParentDisplayDigits}if(null!==e.numberListParentDisplayDigits){if(!t.numberListParentDisplayDigits)return{setValue:{displayDigits:e.numberListParentDisplayDigits}};r=!0,n=e.numberListParentDisplayDigits}if(!(null!==e.numberListParentDisplayDecimals&&!t.numberListParentDisplayDecimals||null!==e.mathListParentDisplayDecimals&&!t.mathListParentDisplayDecimals)&&null!==e.displayDigitsAttr){if(!t.displayDigitsAttr)return{setValue:{displayDigits:e.displayDigitsAttr.stateValues.value}};r=!0,n=e.displayDigitsAttr.stateValues.value}return r?{useEssentialOrDefaultValue:{displayDigits:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDigits:!0}}}},e.displayDecimals={public:!0,shadowingInstructions:{createComponentOfType:"integer"},hasEssential:!0,defaultValue:null,returnDependencies:()=>({mathListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displayDecimals"},numberListParentDisplayDecimals:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displayDecimals"},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplayDecimals){if(!t.mathListParentDisplayDecimals)return{setValue:{displayDecimals:e.mathListParentDisplayDecimals}};r=!0,n=e.mathListParentDisplayDecimals}if(null!==e.numberListParentDisplayDecimals){if(!t.numberListParentDisplayDecimals)return{setValue:{displayDecimals:e.numberListParentDisplayDecimals}};r=!0,n=e.numberListParentDisplayDecimals}if(null!==e.displayDecimalsAttr){if(!t.displayDecimalsAttr)return{setValue:{displayDecimals:e.displayDecimalsAttr.stateValues.value}};r=!0,n=e.displayDecimalsAttr.stateValues.value}return r?{useEssentialOrDefaultValue:{displayDecimals:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displayDecimals:!0}}}},e.displaySmallAsZero={public:!0,shadowingInstructions:{createComponentOfType:"number"},hasEssential:!0,defaultValue:0,returnDependencies:()=>({mathListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"displaySmallAsZero"},numberListParentDisplaySmallAsZero:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"displaySmallAsZero"},displaySmallAsZeroAttr:{dependencyType:"attributeComponent",attributeName:"displaySmallAsZero",variableNames:["value"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentDisplaySmallAsZero){if(!t.mathListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.mathListParentDisplaySmallAsZero}};r=!0,n=e.mathListParentDisplaySmallAsZero}if(null!==e.numberListParentDisplaySmallAsZero){if(!t.numberListParentDisplaySmallAsZero)return{setValue:{displaySmallAsZero:e.numberListParentDisplaySmallAsZero}};r=!0,n=e.numberListParentDisplaySmallAsZero}if(null!==e.displaySmallAsZeroAttr){if(!t.displaySmallAsZeroAttr)return{setValue:{displaySmallAsZero:e.displaySmallAsZeroAttr.stateValues.value}};r=!0,n=e.displaySmallAsZeroAttr.stateValues.value}return r?{useEssentialOrDefaultValue:{displaySmallAsZero:{defaultValue:n}}}:{useEssentialOrDefaultValue:{displaySmallAsZero:!0}}}},e.padZeros={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},hasEssential:!0,defaultValue:!1,returnDependencies:()=>({mathListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"mathList",variableName:"padZeros"},numberListParentPadZeros:{dependencyType:"parentStateVariable",parentComponentType:"numberList",variableName:"padZeros"},padZerosAttr:{dependencyType:"attributeComponent",attributeName:"padZeros",variableNames:["value"]},displayDecimalsAttr:{dependencyType:"attributeComponent",attributeName:"displayDecimals",variableNames:["value"]}}),definition({dependencyValues:e,usedDefault:t}){let n,r=!1;if(null!==e.mathListParentPadZeros){if(!t.mathListParentPadZeros)return{setValue:{padZeros:e.mathListParentPadZeros}};r=!0,n=e.mathListParentPadZeros}if(null!==e.numberListParentPadZeros){if(!t.numberListParentPadZeros)return{setValue:{padZeros:e.numberListParentPadZeros}};r=!0,n=e.numberListParentPadZeros}if(null!==e.padZerosAttr){if(!t.padZerosAttr)return{setValue:{padZeros:e.padZerosAttr.stateValues.value}};r=!0,n=e.padZerosAttr.stateValues.value}return r?{useEssentialOrDefaultValue:{padZeros:{defaultValue:n}}}:{useEssentialOrDefaultValue:{padZeros:!0}}}},e.nOffsets={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({offsets:{dependencyType:"stateVariable",variableName:"offsets"}}),definition({dependencyValues:e}){let t=0;return null!==e.offsets&&(t=e.offsets.length),{setValue:{nOffsets:t}}}},e.unnormalizedValue={returnDependencies:()=>({offsets:{dependencyType:"stateVariable",variableName:"offsets"},period:{dependencyType:"stateVariable",variableName:"period"},minIndex:{dependencyType:"stateVariable",variableName:"minIndex"},maxIndex:{dependencyType:"stateVariable",variableName:"maxIndex"}}),definition({dependencyValues:e}){if(null===e.offsets||0===e.offsets.length||1===e.offsets.length&&""===e.offsets[0].tree||null===e.period||""===e.period.tree)return{setValue:{unnormalizedValue:me$3.fromAst("")}};let t=[],n=e.period.tree,r=e.minIndex,a=e.maxIndex;for(let i of e.offsets)t.push(["tuple",i.tree,n,r,a]);return{setValue:{unnormalizedValue:me$3.fromAst(["periodic_set",...t])}}}},e.redundantOffsets={additionalStateVariablesDefined:["uniqueOffsets"],public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({nOffsets:{dependencyType:"stateVariable",variableName:"nOffsets"},offsets:{dependencyType:"stateVariable",variableName:"offsets"},period:{dependencyType:"stateVariable",variableName:"period"}}),definition({dependencyValues:e}){let t=!1,n=[];if(null!==e.period){let r=e.period.evaluate_to_constant();if(null!==r)for(let a=0;a<e.nOffsets;a++){let i=!0;for(let n=0;n<a;n++){let o=e.offsets[a].subtract(e.offsets[n]).evaluate_to_constant();if(null!==o&&Math.abs(o%r)<1e-10*r){t=!0,i=!1;break}}i&&n.push(e.offsets[a])}}return{setValue:{redundantOffsets:t,uniqueOffsets:n}}}},e.asList={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({uniqueOffsets:{dependencyType:"stateVariable",variableName:"uniqueOffsets"},period:{dependencyType:"stateVariable",variableName:"period"},minIndexAsList:{dependencyType:"stateVariable",variableName:"minIndexAsList"},maxIndexAsList:{dependencyType:"stateVariable",variableName:"maxIndexAsList"}}),definition({dependencyValues:e}){let t=[];if(null!==e.period){let n=e.period.evaluate_to_constant();if(null!==n){let r=e.period.simplify(),a=!0,i=[];for(let t of e.uniqueOffsets){let e=t.evaluate_to_constant();if(null===e){a=!1;break}{let a=t.subtract(r.multiply(Math.floor(e/n))).simplify(),o=a.evaluate_to_constant();i.push({num:o,offset:a})}}if(a){t.push(me$3.fromAst(["ldots"])),i.sort(((e,t)=>e.num-t.num));let n=-1,a=1;Number.isFinite(e.minIndexAsList)&&(n=e.minIndexAsList),Number.isFinite(e.maxIndexAsList)&&(a=e.maxIndexAsList);for(let e=n;e<=a;e++)for(let n of i)t.push(n.offset.add(r.multiply(e)).simplify());t.push(me$3.fromAst(["ldots"]))}}}return{setValue:{asList:t}}}},e}}class Image extends BlockComponent{static componentType="image";static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:null,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:null,public:!0,forRenderer:!0},e.description={createComponentOfType:"text",createStateVariable:"description",defaultValue:null,public:!0,forRenderer:!0},e.source={createComponentOfType:"text",createStateVariable:"source",required:!0,public:!0,forRenderer:!0},e.asFileName={createComponentOfType:"text",createStateVariable:"asFileName",defaultValue:null,public:!0,forRenderer:!0},e.mimeType={createComponentOfType:"text",createStateVariable:"mimeType",defaultValue:null,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.cid={forRenderer:!0,returnDependencies:()=>({source:{dependencyType:"stateVariable",variableName:"source"}}),definition:function({dependencyValues:e}){if(!e.source||"doenet:"!==e.source.substring(0,7).toLowerCase())return{setValue:{cid:null}};let t=null,n=e.source.match(/[:&]cid=([^&]+)/i);return n&&(t=n[1]),{setValue:{cid:t}}}},e}}class Video extends BlockComponent{static componentType="video";static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize"},e.height={createComponentOfType:"_componentSize"},e.aspectRatio={createComponentOfType:"number"},e.youtube={createComponentOfType:"text",createStateVariable:"youtube",defaultValue:null,public:!0,forRenderer:!0},e.source={createComponentOfType:"text",createStateVariable:"source",defaultValue:null,public:!0,forRenderer:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.width={defaultValue:{size:720,isAbsolute:!0},public:!0,hasEssential:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},forRenderer:!0,additionalStateVariablesDefined:[{variableName:"height",shadowingInstructions:{createComponentOfType:"_componentSize"},defaultValue:{size:405,isAbsolute:!0},public:!0,forRenderer:!0,hasEssential:!0},{variableName:"aspectRatio",shadowingInstructions:{createComponentOfType:"number"},defaultValue:16/9,public:!0,forRenderer:!0,hasEssential:!0}],returnDependencies:()=>({widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},aspectRatioAttr:{dependencyType:"attributeComponent",attributeName:"aspectRatio",variableNames:["value"]}}),definition:({dependencyValues:e})=>{if(console.log("dependencyValues",e),e.widthAttr){let t=e.widthAttr.stateValues.componentSize;if(!t.isAbsolute)throw Error("Have not implemented relative width for video");if(e.heightAttr){let n=e.heightAttr.stateValues.componentSize;if(!n.isAbsolute)throw Error("Have not implemented relative height for video");return{setValue:{width:t,height:n,aspectRatio:t.size/n.size}}}if(e.aspectRatioAttr){let n=e.aspectRatioAttr.stateValues.value;return{setValue:{width:t,height:{isAbsolute:!0,size:t.size/n},aspectRatio:n}}}return{setValue:{width:t,height:{isAbsolute:!0,size:t.size/(16/9)}},useEssentialOrDefaultValue:{aspectRatio:!0}}}if(e.heightAttr){let t=e.heightAttr.stateValues.componentSize;if(!t.isAbsolute)throw Error("Have not implemented relative height for video");if(e.aspectRatioAttr){let n=e.aspectRatioAttr.stateValues.value;return{setValue:{width:{isAbsolute:!0,size:t.size*n},height:t,aspectRatio:n}}}return{setValue:{width:{isAbsolute:!0,size:t.size*(16/9)},height:t},useEssentialOrDefaultValue:{aspectRatio:!0}}}if(e.aspectRatioAttr){let t=e.aspectRatioAttr.stateValues.value;return{setValue:{aspectRatio:t,height:{isAbsolute:!0,size:720/t}},useEssentialOrDefaultValue:{width:!0}}}return{useEssentialOrDefaultValue:{width:!0,height:!0,aspectRatio:!0}}}},e}actions={recordVideoStarted:this.recordVideoStarted.bind(this),recordVideoWatched:this.recordVideoWatched.bind(this),recordVideoPaused:this.recordVideoPaused.bind(this),recordVideoSkipped:this.recordVideoSkipped.bind(this),recordVideoCompleted:this.recordVideoCompleted.bind(this)};recordVideoStarted({beginTime:e,duration:t,rate:n}){this.coreFunctions.requestRecordEvent({verb:"played",object:{componentName:this.componentName,componentType:this.componentType,duration:t},context:{startingPoint:e,rate:n}})}recordVideoWatched({beginTime:e,endTime:t,duration:n,rates:r}){this.coreFunctions.requestRecordEvent({verb:"watched",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:e,endingPoint:t,rates:r}})}recordVideoPaused({endTime:e,duration:t}){this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType,duration:t},context:{endingPoint:e}})}recordVideoSkipped({beginTime:e,endTime:t,duration:n}){this.coreFunctions.requestRecordEvent({verb:"skipped",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:e,endingPoint:t}})}recordVideoCompleted({duration:e}){this.coreFunctions.requestRecordEvent({verb:"completed",object:{componentName:this.componentName,componentType:this.componentType,duration:e}})}}class Embed extends BlockComponent{static componentType="embed";static createAttributesObject(){let e=super.createAttributesObject();return e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:500,isAbsolute:!0},public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:500,isAbsolute:!0},public:!0,forRenderer:!0},e.geogebra={createComponentOfType:"text",createStateVariable:"geogebra",defaultValue:null,public:!0,forRenderer:!0},e.encodedGeogebraContent={createComponentOfType:"text",createStateVariable:"encodedGeogebraContent",defaultValue:null,public:!0,forRenderer:!0},e.fromMathInsight={createComponentOfType:"text",createStateVariable:"fromMathInsight",defaultValue:null,public:!0,forRenderer:!0},e}}class Hint extends BlockComponent{static componentType="hint";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"titles",componentTypes:["title"]},{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.showHints={forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},showHintsFlag:{dependencyType:"flag",flagName:"showHints"}}),definition:({dependencyValues:e})=>({setValue:{showHints:e.showHintsFlag&&!e.hide}})},e.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{open:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"open",value:e.open}]})},e.titleDefinedByChildren={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"]}}),definition:({dependencyValues:e})=>({setValue:{titleDefinedByChildren:e.titleChild.length>0}})},e.title={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childGroups:["titles"],variableNames:["text"]}}),definition:({dependencyValues:e})=>0===e.titleChild.length?{setValue:{title:"Hint"}}:{setValue:{title:e.titleChild[0].stateValues.text}}},e}async revealHint({actionId:e}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],actionId:e,event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}async closeHint({actionId:e}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],actionId:e,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealHint:this.revealHint.bind(this),closeHint:this.closeHint.bind(this)}}class Solution extends BlockComponent{static componentType="solution";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.hide={createComponentOfType:"boolean"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){return{success:!0,newChildren:[{componentType:"_solutionContainer",children:e}]}}}),e}static returnChildGroups(){return[{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.hide={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({hideAttr:{dependencyType:"attributeComponent",attributeName:"hide",variableNames:["value"]},displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition:({dependencyValues:e})=>"none"===e.displayMode?{setValue:{hide:!0}}:null!==e.hideAttr?{setValue:{hide:e.hideAttr.stateValues.value}}:{useEssentialOrDefaultValue:{hide:!0}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>"none"===t.displayMode?{success:!1}:null!==t.hideAttr?{success:!0,instructions:[{setDependency:"hideAttr",desiredValue:e.hide,variableIndex:0}]}:{success:!0,instructions:[{setSetVariable:"hide",value:e.hide}]}},e.open={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,defaultValue:!1,hasEssential:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition:({dependencyValues:e})=>"displayed"===e.displayMode?{setValue:{open:!0}}:"none"===e.displayMode?{setValue:{open:!1}}:{useEssentialOrDefaultValue:{open:!0}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>"displayed"===t.displayMode||"none"===t.displayMode?{success:!1}:{success:!0,instructions:[{setEssentialValue:"open",value:e.open}]}},e.canBeClosed={forRenderer:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition:({dependencyValues:e})=>"button"===e.displayMode?{setValue:{canBeClosed:!0}}:{setValue:{canBeClosed:!1}}},e.message={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,defaultValue:"",hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{message:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"message",value:e.message}]})},e}async revealSolution({actionId:e}){let t,{allowView:n,message:r,scoredComponent:a}=await this.coreFunctions.recordSolutionView(),i=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:n},{updateType:"updateValue",componentName:this.componentName,stateVariable:"message",value:r}];return n&&(i.push({updateType:"updateValue",componentName:a,stateVariable:"viewedSolution",value:!0}),t={verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}),await this.coreFunctions.performUpdate({updateInstructions:i,actionId:e,event:t,overrideReadOnly:!0})}async closeSolution({actionId:e}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],actionId:e,event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealSolution:this.revealSolution.bind(this),closeSolution:this.closeSolution.bind(this)};static includeBlankStringChildren=!0}class IntComma extends Text{static componentType="intcomma";static rendererType="text";static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:e,oldName:"value",newName:"originalValue"}),e.value={public:!0,shadowingInstructions:{createComponentOfType:this.componentType},returnDependencies:()=>({originalValue:{dependencyType:"stateVariable",variableName:"originalValue"}}),definition:function({dependencyValues:e}){let t=e.originalValue,n=/^(-?\d+)(\d{3})/,r=t.match(n);for(;null!==r;)t=t.replace(n,"$1,$2"),r=t.match(n);return{setValue:{value:t}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({setValue:{text:e.value}})},e}}const e$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");var t$1=function(e){let t=(e=e||"_")+"-";for(let e=0;e<7;e++)t+=e$1[Math.floor(Math.random()*e$1.length)];return t};let r$1={"!":"","?":"",'"':'"',"'":"","-":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",I:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""},a$1={};Object.keys(r$1).forEach((function(e){r$1[e].split("").forEach((function(t){a$1[t]=e}))}));var n$1=e=>{let t=e.split("");return t.forEach(((e,n)=>{a$1[e]&&(t[n]=a$1[e])})),t.join("")};const i$1=/([A-Z]\.)+[A-Z]?,?$/,o$1=/^[A-Z]\.,?$/,s$1=/[A-Z]{2,}('s|,)?$/,l$1=/([a-z]\.)+[a-z]\.?$/;var u$1=function(e){return!0===i$1.test(e)||!0===l$1.test(e)||!0===o$1.test(e)||!0===s$1.test(e)};const c$2=n$1,h$1=u$1,d$1=/[a-z\u00C0-\u00FF] ?\/ ?[a-z\u00C0-\u00FF]/,g$1=function(e){let t=e=(e=(e=e||"").toLowerCase()).trim();return e=c$2(e),!0===d$1.test(e)&&(e=e.replace(/\/.*/,"")),e=(e=(e=(e=(e=(e=(e=e.replace(/^[#@]/,"")).replace(/[,;.!?]+$/,"")).replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'")).replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"')).replace(/\u2026/g,"...")).replace(/\u2013/g,"-")).replace(/([aeiou][ktrp])in$/,"$1ing"),!0===/^(re|un)-?[^aeiou]./.test(e)&&(e=e.replace("-","")),h$1(e)&&(e=e.replace(/\./g,"")),!1===/^[:;]/.test(e)&&(e=(e=(e=e.replace(/\.{3,}$/g,"")).replace(/[",\.!:;\?\)]+$/g,"")).replace(/^['"\(]+/g,"")),""===(e=(e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")).trim())&&(e=t),e.replace(/([0-9]),([0-9])/g,"$1$2")},p$1=function(e){return(e=e.replace(/[']s$/,"")).replace(/s[']$/,"s")},m$1=/^[ \n\t\.\[\](){}:,!\-?;\/&*^%+=~\|\u0022\uFF02\u0027\u201C\u201F\u201B\u201E\u2E42\u201A\u2035\u2036\u2037\u301D\u0060\u301F]+/,f$1=/[ \n\t\.'\[\](){}:,!\-?;\/&*@^#+=~\|\u0022\uFF02\u201D\u00B4\u301E]+$/,b$1=/\//,y$1=/[']/,v$1=/^[a-z]\.([a-z]\.)+/i,w$1=/^[-+\.][0-9]/,k$1=/^'[0-9]{2}/;var A$1=e=>{let t=e,n="",r="";""===(e=(e=e.replace(m$1,(t=>(n=t,"-"!==n&&"+"!==n&&"."!==n||!w$1.test(e)?"'"===n&&k$1.test(e)?(n="",t):"":(n="",t))))).replace(f$1,(a=>(r=a,y$1.test(a)&&/[sn][']$/.test(t)&&!1===y$1.test(n)?(r=r.replace(y$1,""),"'"):!0===v$1.test(e)?(r=r.replace(/\./,""),"."):""))))&&(t=t.replace(/ *$/,(e=>(r=e||"",""))),e=t,n="");let a=g$1(e);const i={text:e,clean:a,reduced:p$1(a),pre:n,post:r};return b$1.test(e)&&e.split(b$1).forEach((e=>{i.alias=i.alias||{},i.alias[e.trim()]=!0})),i},D$1={};!function(e){const t=/^[A-Z][a-z'\u00C0-\u00FF]/,n=/^[A-Z]+s?$/;e.toUpperCase=function(){return this.text=this.text.toUpperCase(),this},e.toLowerCase=function(){return this.text=this.text.toLowerCase(),this},e.toTitleCase=function(){return this.text=this.text.replace(/^ *[a-z\u00C0-\u00FF]/,(e=>e.toUpperCase())),this},e.isUpperCase=function(){return n.test(this.text)},e.isTitleCase=function(){return t.test(this.text)},e.titleCase=e.isTitleCase}(D$1);var $$1={};!function(e){const t=/(\u0022|\uFF02|\u0027|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\u00AB|\u2039|\u2035|\u2036|\u2037|\u301D|\u0060|\u301F)/,n=/(\u0022|\uFF02|\u0027|\u201D|\u2019|\u201D|\u2019|\u201D|\u201D|\u2019|\u00BB|\u203A|\u2032|\u2033|\u2034|\u301E|\u00B4|\u301E)/;e.hasPost=function(e){return-1!==this.post.indexOf(e)},e.hasPre=function(e){return-1!==this.pre.indexOf(e)},e.hasQuote=function(){return t.test(this.pre)||n.test(this.post)},e.hasQuotation=e.hasQuote,e.hasComma=function(){return this.hasPost(",")},e.hasPeriod=function(){return!0===this.hasPost(".")&&!1===this.hasPost("...")},e.hasExclamation=function(){return this.hasPost("!")},e.hasQuestionMark=function(){return this.hasPost("?")||this.hasPost("")},e.hasEllipses=function(){return this.hasPost("..")||this.hasPost("")||this.hasPre("..")||this.hasPre("")},e.hasSemicolon=function(){return this.hasPost(";")},e.hasSlash=function(){return/\//.test(this.text)},e.hasHyphen=function(){const e=/^(-||)$/;return e.test(this.post)||e.test(this.pre)},e.hasDash=function(){const e=/ (-||) /;return e.test(this.post)||e.test(this.pre)},e.hasContraction=function(){return Boolean(this.implicit)},e.addPunctuation=function(e){return","!==e&&";"!==e||(this.post=this.post.replace(e,"")),this.post=e+this.post,this}}($$1);var P$1={};const E$1=function(e,t,n=3){if(e===t)return 1;if(e.length<n||t.length<n)return 0;const r=function(e,t){let n=e.length,r=t.length;if(0===n)return r;if(0===r)return n;let a=(r>n?r:n)+1;if(Math.abs(n-r)>(a||100))return a||100;let i,o,s,l,u,c,p=[];for(let e=0;e<a;e++)p[e]=[e],p[e].length=a;for(let e=0;e<a;e++)p[0][e]=e;for(let a=1;a<=n;++a)for(o=e[a-1],i=1;i<=r;++i){if(a===i&&p[a][i]>4)return n;s=t[i-1],l=o===s?0:1,u=p[a-1][i]+1,(c=p[a][i-1]+1)<u&&(u=c),(c=p[a-1][i-1]+l)<u&&(u=c);let r=a>1&&i>1&&o===t[i-2]&&e[a-2]===s&&(c=p[a-2][i-2]+l)<u;p[a][i]=r?c:u}return p[n][r]}(e,t);let a=Math.max(e.length,t.length);return 1-(0===a?0:r/a)};let H$1=function(){};H$1=function(e,t,n,r){let a=function(e,t,n,r){if(t.id===e.id)return!0;if(!0===t.anything)return!0;if(!0===t.start&&0!==n)return!1;if(!0===t.end&&n!==r-1)return!1;if(void 0!==t.word){if(null!==e.implicit&&e.implicit===t.word)return!0;if(void 0!==e.alias&&e.alias.hasOwnProperty(t.word))return!0;if(!0===t.soft&&t.word===e.root)return!0;if(void 0!==t.fuzzy){let n=E$1(t.word,e.reduced);if(n>t.fuzzy)return!0;if(!0===t.soft&&(n=E$1(t.word,e.root),n>t.fuzzy))return!0}return t.word===e.clean||t.word===e.text||t.word===e.reduced}return void 0!==t.tag?!0===e.tags[t.tag]:void 0!==t.method?"function"==typeof e[t.method]&&!0===e[t.method]():void 0!==t.regex?t.regex.test(e.clean):void 0!==t.fastOr?!(!e.implicit||!0!==t.fastOr.hasOwnProperty(e.implicit))||t.fastOr.hasOwnProperty(e.reduced)||t.fastOr.hasOwnProperty(e.text):void 0!==t.choices&&("and"===t.operator?t.choices.every((t=>H$1(e,t,n,r))):t.choices.some((t=>H$1(e,t,n,r))))}(e,t,n,r);return!0===t.negative?!a:a};const j$1=H$1,N$1=u$1,x$1={};P$1.doesMatch=function(e,t,n){return j$1(this,e,t,n)},P$1.isAcronym=function(){return N$1(this.text)},P$1.isImplicit=function(){return""===this.text&&Boolean(this.implicit)},P$1.isKnown=function(){return Object.keys(this.tags).some((e=>!0!==x$1[e]))},P$1.setRoot=function(e){let t=e.transforms,n=this.implicit||this.clean;if(this.tags.Plural&&(n=t.toSingular(n,e)),this.tags.Verb&&!this.tags.Negative&&!this.tags.Infinitive){let r=null;this.tags.PastTense?r="PastTense":this.tags.Gerund?r="Gerund":this.tags.PresentTense?r="PresentTense":this.tags.Participle?r="Participle":this.tags.Actor&&(r="Actor"),n=t.toInfinitive(n,e,r)}this.root=n};var F$1={};const C$1=n$1,B$1=/[\s-]/,G$1=/^[A-Z-]+$/;F$1.textOut=function(e,t,n){e=e||{};let r=this.text,a=this.pre,i=this.post;return!0===e.reduced&&(r=this.reduced||""),!0===e.root&&(r=this.root||""),!0===e.implicit&&this.implicit&&(r=this.implicit||""),!0===e.normal&&(r=this.clean||this.text||""),!0===e.root&&(r=this.root||this.reduced||""),!0===e.unicode&&(r=C$1(r)),!0===e.titlecase&&(this.tags.ProperNoun&&!this.titleCase()||(this.tags.Acronym?r=r.toUpperCase():G$1.test(r)&&!this.tags.Acronym&&(r=r.toLowerCase()))),!0===e.lowercase&&(r=r.toLowerCase()),!0===e.acronyms&&this.tags.Acronym&&(r=r.replace(/\./g,"")),!0!==e.whitespace&&!0!==e.root||(a="",i=" ",!1!==B$1.test(this.post)&&!e.last||this.implicit||(i="")),!0!==e.punctuation||e.root||(!0===this.hasPost(".")?i="."+i:!0===this.hasPost("?")?i="?"+i:!0===this.hasPost("!")?i="!"+i:!0===this.hasPost(",")?i=","+i:!0===this.hasEllipses()&&(i="..."+i)),!0!==t&&(a=""),!0!==n&&(i=""),!0===e.abbreviations&&this.tags.Abbreviation&&(i=i.replace(/^\./,"")),a+r+i};var z$1={};const I$1={Auxiliary:1,Possessive:1},O$1=function(e,t){let n=Object.keys(e.tags);const r=t.tags;return n=n.sort(((e,t)=>I$1[t]||!r[t]?-1:r[t]?r[e]?r[e].lineage.length>r[t].lineage.length?1:r[e].isA.length>r[t].isA.length?-1:0:0:1)),n},T$2={text:!0,tags:!0,implicit:!0,whitespace:!0,clean:!1,id:!1,index:!1,offset:!1,bestTag:!1};z$1.json=function(e,t){e=e||{};let n={};return(e=Object.assign({},T$2,e)).text&&(n.text=this.text),e.normal&&(n.normal=this.clean),e.tags&&(n.tags=Object.keys(this.tags)),e.clean&&(n.clean=this.clean),(e.id||e.offset)&&(n.id=this.id),e.implicit&&null!==this.implicit&&(n.implicit=this.implicit),e.whitespace&&(n.pre=this.pre,n.post=this.post),e.bestTag&&(n.bestTag=O$1(this,t)[0]),n};var V$1=Object.assign({},D$1,$$1,P$1,F$1,z$1),M$1={},J$1={};function L$1(){return"undefined"!=typeof window&&window.document}const S$1=function(e,t){for(e=e.toString();e.length<t;)e+=" ";return e};J$1.logTag=function(e,t,n){if(L$1())return void console.log("%c"+S$1(e.clean,3)+"  + "+t+" ","color: #6accb2;");let r="[33m"+S$1(e.clean,15)+"[0m + [32m"+t+"[0m ";n&&(r=S$1(r,35)+" "+n),console.log(r)},J$1.logUntag=function(e,t,n){if(L$1())return void console.log("%c"+S$1(e.clean,3)+"  - "+t+" ","color: #AB5850;");let r="[33m"+S$1(e.clean,3)+" [31m - #"+t+"[0m ";n&&(r=S$1(r,35)+" "+n),console.log(r)},J$1.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},J$1.titleCase=e=>e.charAt(0).toUpperCase()+e.substr(1);const _$1=J$1,K$1=function(e,t,n,r){let a=r.tags;if(""===t||"."===t||"-"===t)return;if("#"===t[0]&&(t=t.replace(/^#/,"")),t=_$1.titleCase(t),!0===e.tags[t])return;const i=r.isVerbose();!0===i&&_$1.logTag(e,t,n),e.tags[t]=!0,!0===a.hasOwnProperty(t)&&(a[t].isA.forEach((t=>{e.tags[t]=!0,!0===i&&_$1.logTag(e," "+t)})),e.unTag(a[t].notA,"",r))},q$1=J$1,W$1=/^[a-z]/,R$1=function(e,t,n,r){const a=r.isVerbose();if("*"===t)return e.tags={},e;var i;t=t.replace(/^#/,""),!0===W$1.test(t)&&(t=(i=t).charAt(0).toUpperCase()+i.substr(1)),!0===e.tags[t]&&(delete e.tags[t],!0===a&&q$1.logUntag(e,t,n));const o=r.tags;if(o[t]){let n=o[t].lineage;for(let t=0;t<n.length;t++)!0===e.tags[n[t]]&&(delete e.tags[n[t]],!0===a&&q$1.logUntag(e," - "+n[t]))}return e},U$1=function(e,t,n){const r=n.tags;if("#"===t[0]&&(t=t.replace(/^#/,"")),void 0===r[t])return!0;let a=r[t].notA||[];for(let t=0;t<a.length;t++)if(!0===e.tags[a[t]])return!1;return void 0===r[t].isA||U$1(e,r[t].isA,n)},Q$1=function(e,t,n,r){if("string"!=typeof t)for(let a=0;a<t.length;a++)K$1(e,t[a],n,r);else K$1(e,t,n,r)},Z$1=function(e,t,n,r){if("string"!=typeof t&&t)for(let a=0;a<t.length;a++)R$1(e,t[a],n,r);else R$1(e,t,n,r)},X$1=U$1;M$1.tag=function(e,t,n){return Q$1(this,e,t,n),this},M$1.tagSafe=function(e,t,n){return X$1(this,e,n)&&Q$1(this,e,t,n),this},M$1.unTag=function(e,t,n){return Z$1(this,e,t,n),this},M$1.canBe=function(e,t){return X$1(this,e,t)};const Y$1=t$1,ee$1=A$1,te$1=V$1,re$1=M$1;class ae$1{constructor(e=""){e=String(e);let t=ee$1(e);this.text=t.text||"",this.clean=t.clean,this.reduced=t.reduced,this.root=null,this.implicit=null,this.pre=t.pre||"",this.post=t.post||"",this.tags={},this.prev=null,this.next=null,this.id=Y$1(t.clean),this.isA="Term",t.alias&&(this.alias=t.alias)}set(e){let t=ee$1(e);return this.text=t.text,this.clean=t.clean,this.reduced=t.reduced,this.root=null,this.implicit=null,this}}ae$1.prototype.clone=function(){let e=new ae$1(this.text);return e.pre=this.pre,e.post=this.post,e.clean=this.clean,e.reduced=this.reduced,e.root=this.root,e.implicit=this.implicit,e.tags=Object.assign({},this.tags),e},Object.assign(ae$1.prototype,te$1),Object.assign(ae$1.prototype,re$1);var ne$1=ae$1,ie$1={terms:function(e){if(0===this.length)return[];if(this.cache.terms)return void 0!==e?this.cache.terms[e]:this.cache.terms;let t=[this.pool.get(this.start)];for(let n=0;n<this.length-1;n+=1){let r=t[t.length-1].next;if(null===r){console.error("Compromise error: Linked list broken in phrase '"+this.start+"'");break}let a=this.pool.get(r);if(t.push(a),void 0!==e&&e===n)return t[e]}return void 0===e&&(this.cache.terms=t),void 0!==e?t[e]:t},clone:function(e){if(e){let e=this.buildFrom(this.start,this.length);return e.cache=this.cache,e}let t=this.terms().map((e=>e.clone()));return t.forEach(((e,n)=>{this.pool.add(e),t[n+1]&&(e.next=t[n+1].id),t[n-1]&&(e.prev=t[n-1].id)})),this.buildFrom(t[0].id,t.length)},lastTerm:function(){let e=this.terms();return e[e.length-1]},hasId:function(e){if(0===this.length||!e)return!1;if(this.start===e)return!0;if(this.cache.terms){let t=this.cache.terms;for(let n=0;n<t.length;n++)if(t[n].id===e)return!0;return!1}let t=this.start;for(let n=0;n<this.length-1;n+=1){let n=this.pool.get(t);if(void 0===n)return console.error(`Compromise error: Linked list broken. Missing term '${t}' in phrase '${this.start}'\n`),!1;if(n.next===e)return!0;t=n.next}return!1},wordCount:function(){return this.terms().filter((e=>""!==e.text)).length},fullSentence:function(){let e=this.terms(0);for(;e.prev;)e=this.pool.get(e.prev);let t=e.id,n=1;for(;e.next;)e=this.pool.get(e.next),n+=1;return this.buildFrom(t,n)}},oe$1={text:function(e={},t,n){"string"==typeof e&&(e="normal"===e?{whitespace:!0,unicode:!0,lowercase:!0,punctuation:!0,acronyms:!0,abbreviations:!0,implicit:!0,normal:!0}:"clean"===e?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,normal:!0}:"reduced"===e?{punctuation:!1,titlecase:!1,lowercase:!0,whitespace:!0,unicode:!0,implicit:!0,reduced:!0}:"implicit"===e?{punctuation:!0,implicit:!0,whitespace:!0,trim:!0}:"root"===e?{titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,root:!0}:{});let r=this.terms(),a=!1;r[0]&&null===r[0].prev&&null===r[r.length-1].next&&(a=!0);let i=r.reduce(((i,o,s)=>{if(0===s&&""===o.text&&null!==o.implicit&&!e.implicit)return i;e.last=n&&s===r.length-1;let l=!0,u=!0;return!1===a&&(0===s&&t&&(l=!1),s===r.length-1&&n&&(u=!1)),i+o.textOut(e,l,u)}),"");return!0===a&&n&&(i=i.replace(/ +$/,"")),!0===e.trim&&(i=i.trim()),i}},se$1={trim:function(){let e=this.terms();if(e.length>0){e[0].pre=e[0].pre.replace(/^\s+/,"");let t=e[e.length-1];t.post=t.post.replace(/\s+$/,"")}return this}},le$1={};const ue$1=/[.?!]\s*$/,ce$1=function(e,t){t[0].pre=e[0].pre;let n=e[e.length-1],r=t[t.length-1];r.post=function(e,t){return ue$1.test(t)?t+e.match(/\s*$/):e}(n.post,r.post),n.post="",""===n.post&&(n.post+=" ")},he$1=/ /,de$1=function(e,t,n){let r=e.terms(),a=t.terms();ce$1(r,a),function(e,t,n){let r=e[e.length-1],a=t[t.length-1],i=r.next;r.next=t[0].id,a.next=i,i&&(n.get(i).prev=a.id);let o=e[0].id;o&&(t[0].prev=o)}(r,a,e.pool);let i=[e],o=e.start,s=[n];return s=s.concat(n.parents()),s.forEach((e=>{let t=e.list.filter((e=>e.hasId(o)));i=i.concat(t)})),i=function(e){return e.filter(((t,n)=>e.indexOf(t)===n))}(i),i.forEach((e=>{e.length+=t.length})),e.cache={},e},ge$1=function(e,t,n){const r=e.start;let a=t.terms();!function(e){let t=e[e.length-1];!1===he$1.test(t.post)&&(t.post+=" ")}(a),function(e,t,n){let r=n[n.length-1];r.next=e.start;let a=e.pool,i=a.get(e.start);i.prev&&(a.get(i.prev).next=t.start),n[0].prev=e.terms(0).prev,e.terms(0).prev=r.id}(e,t,a);let i=[e],o=[n];return o=o.concat(n.parents()),o.forEach((e=>{let n=e.list.filter((e=>e.hasId(r)||e.hasId(t.start)));i=i.concat(n)})),i=function(e){return e.filter(((t,n)=>e.indexOf(t)===n))}(i),i.forEach((e=>{e.length+=t.length,e.start===r&&(e.start=t.start),e.cache={}})),e},pe$1=function(e,t){let n=t.pool(),r=e.terms(),a=n.get(r[0].prev)||{},i=n.get(r[r.length-1].next)||{};r[0].implicit&&a.implicit&&(a.set(a.implicit),a.post+=" "),function(e,t,n,r){let a=e.parents();a.push(e),a.forEach((e=>{let a=e.list.find((e=>e.hasId(t)));a&&(a.length-=n,a.start===t&&(a.start=r.id),a.cache={})})),e.list=e.list.filter((e=>!(!e.start||!e.length)))}(t,e.start,e.length,i),a&&(a.next=i.id),i&&(i.prev=a.id)};le$1.append=function(e,t){return de$1(this,e,t),this},le$1.prepend=function(e,t){return ge$1(this,e,t),this},le$1.delete=function(e){return pe$1(this,e),this},le$1.replace=function(e,t){let n=this.length;de$1(this,e,t);let r=this.buildFrom(this.start,this.length);r.length=n,pe$1(r,t)},le$1.splitOn=function(e){let t=this.terms(),n={before:null,match:null,after:null},r=t.findIndex((t=>t.id===e.start));if(-1===r)return n;let a=t.slice(0,r);a.length>0&&(n.before=this.buildFrom(a[0].id,a.length));let i=t.slice(r,r+e.length);i.length>0&&(n.match=this.buildFrom(i[0].id,i.length));let o=t.slice(r+e.length,t.length);return o.length>0&&(n.after=this.buildFrom(o[0].id,o.length,this.pool)),n};var me$2={json:function(e={},t){let n={};return e.text&&(n.text=this.text()),e.normal&&(n.normal=this.text("normal")),e.clean&&(n.clean=this.text("clean")),e.reduced&&(n.reduced=this.text("reduced")),e.implicit&&(n.implicit=this.text("implicit")),e.root&&(n.root=this.text("root")),e.trim&&(n.text&&(n.text=n.text.trim()),n.normal&&(n.normal=n.normal.trim()),n.reduced&&(n.reduced=n.reduced.trim())),e.terms&&(!0===e.terms&&(e.terms={}),n.terms=this.terms().map((n=>n.json(e.terms,t)))),n}},fe$1={lookAhead:function(e){e||(e=".*");let t=this.pool,n=[];const r=function(e){let a=t.get(e);a&&(n.push(a),a.prev&&r(a.next))};let a=this.terms(),i=a[a.length-1];return r(i.next),0===n.length?[]:this.buildFrom(n[0].id,n.length).match(e)},lookBehind:function(e){e||(e=".*");let t=this.pool,n=[];const r=function(e){let a=t.get(e);a&&(n.push(a),a.prev&&r(a.prev))};let a=t.get(this.start);return r(a.prev),0===n.length?[]:this.buildFrom(n[n.length-1].id,n.length).match(e)}},be$1=Object.assign({},ie$1,oe$1,se$1,le$1,me$2,fe$1),ye$1={},ve$1,we$1=function(e,t){if(0===t.length)return!0;for(let e=0;e<t.length;e+=1){let n=t[e];if(!0!==n.optional&&!0!==n.negative&&!0===n.start&&e>0)return!0;if(!0===n.anything&&!0===n.negative)return!0}return!1},ke$1={};(ve$1=ke$1).getGreedy=function(e,t){let n=Object.assign({},e.regs[e.r],{start:!1,end:!1}),r=e.t;for(;e.t<e.terms.length;e.t+=1){if(t&&e.terms[e.t].doesMatch(t,e.start_i+e.t,e.phrase_length))return e.t;let a=e.t-r+1;if(void 0!==n.max&&a===n.max)return e.t;if(!1===e.terms[e.t].doesMatch(n,e.start_i+e.t,e.phrase_length))return void 0!==n.min&&a<n.min?null:e.t}return e.t},ve$1.greedyTo=function(e,t){let n=e.t;if(!t)return e.terms.length;for(;n<e.terms.length;n+=1)if(!0===e.terms[n].doesMatch(t,e.start_i+n,e.phrase_length))return n;return null},ve$1.isEndGreedy=function(e,t){if(!0===e.end&&!0===e.greedy&&t.start_i+t.t<t.phrase_length-1){let n=Object.assign({},e,{end:!1});if(!0===t.terms[t.t].doesMatch(n,t.start_i+t.t,t.phrase_length))return!0}return!1},ve$1.doOrBlock=function(e,t=0){let n=e.regs[e.r],r=!1;for(let a=0;a<n.choices.length;a+=1){let i=n.choices[a];if(r=i.every(((n,r)=>{let a=0,i=e.t+r+t+a;if(void 0===e.terms[i])return!1;let o=e.terms[i].doesMatch(n,i+e.start_i,e.phrase_length);if(!0===o&&!0===n.greedy)for(let t=1;t<e.terms.length;t+=1){let r=e.terms[i+t];if(r){if(!0!==r.doesMatch(n,e.start_i+t,e.phrase_length))break;a+=1}}return t+=a,o})),r){t+=i.length;break}}return r&&!0===n.greedy?ve$1.doOrBlock(e,t):t},ve$1.doAndBlock=function(e){let t=0;return!0===e.regs[e.r].choices.every((n=>{let r=n.every(((t,n)=>{let r=e.t+n;return void 0!==e.terms[r]&&e.terms[r].doesMatch(t,r,e.phrase_length)}));return!0===r&&n.length>t&&(t=n.length),r}))&&t},ve$1.getGroup=function(e,t,n){if(e.groups[e.groupId])return e.groups[e.groupId];const r=e.terms[t].id;return e.groups[e.groupId]={group:String(n),start:r,length:0},e.groups[e.groupId]};const Ae$1=t$1,De=ke$1;var $e$1=function(e,t,n,r){let a={t:0,terms:e,r:0,regs:t,groups:{},start_i:n,phrase_length:r,hasGroup:!1,groupId:null,previousGroup:null};for(;a.r<t.length;a.r+=1){let e=t[a.r];if(a.hasGroup="string"==typeof e.named||"number"==typeof e.named,!0===a.hasGroup){const n=t[a.r-1];n&&n.named===e.named&&a.previousGroup?a.groupId=a.previousGroup:(a.groupId=Ae$1(e.named),a.previousGroup=a.groupId)}if(!a.terms[a.t]){if(!1===t.slice(a.r).some((e=>!e.optional)))break;return null}if(!0===e.anything&&!0===e.greedy){let n=De.greedyTo(a,t[a.r+1]);if(null===n||0===n)return null;if(void 0!==e.min&&n-a.t<e.min)return null;if(void 0!==e.max&&n-a.t>e.max){a.t=a.t+e.max;continue}!0===a.hasGroup&&(De.getGroup(a,a.t,e.named).length=n-a.t),a.t=n;continue}if(void 0!==e.choices&&"or"===e.operator){let t=De.doOrBlock(a);if(t){if(!0===e.negative)return null;!0===a.hasGroup&&(De.getGroup(a,a.t,e.named).length+=t),a.t+=t;continue}if(!e.optional)return null}if(void 0!==e.choices&&"and"===e.operator){let t=De.doAndBlock(a);if(t){if(!0===e.negative)return null;!0===a.hasGroup&&(De.getGroup(a,a.t,e.named).length+=t),a.t+=t;continue}if(!e.optional)return null}let n=a.terms[a.t],i=n.doesMatch(e,a.start_i+a.t,a.phrase_length);if(!0===e.anything||!0===i||De.isEndGreedy(e,a)){let i=a.t;if(e.optional&&t[a.r+1]&&e.negative)continue;if(e.optional&&t[a.r+1]){let r=n.doesMatch(t[a.r+1],a.start_i+a.t,a.phrase_length);if(e.negative||r){let e=a.terms[a.t+1];e&&e.doesMatch(t[a.r+1],a.start_i+a.t,a.phrase_length)||(a.r+=1)}}if(a.t+=1,!0===e.end&&a.t!==a.terms.length&&!0!==e.greedy)return null;if(!0===e.greedy){if(a.t=De.getGreedy(a,t[a.r+1]),null===a.t)return null;if(e.min&&e.min>a.t)return null;if(!0===e.end&&a.start_i+a.t!==r)return null}if(!0===a.hasGroup){const t=De.getGroup(a,i,e.named);a.t>1&&e.greedy?t.length+=a.t-i:t.length++}}else{if(e.negative){let t=Object.assign({},e);if(t.negative=!1,!0===a.terms[a.t].doesMatch(t,a.start_i+a.t,a.phrase_length))return null}if(!0!==e.optional){if(a.terms[a.t].isImplicit()&&t[a.r-1]&&a.terms[a.t+1]){if(a.terms[a.t-1]&&a.terms[a.t-1].implicit===t[a.r-1].word)return null;if(a.terms[a.t+1].doesMatch(e,a.start_i+a.t,a.phrase_length)){a.t+=2;continue}}return null}}}return{match:a.terms.slice(0,a.t),groups:a.groups}},Pe$1=function(e,t,n){if(!n||0===n.length)return n;if(t.some((e=>e.end))){let t=e[e.length-1];n=n.filter((({match:e})=>-1!==e.indexOf(t)))}return n};const Ee$1=/(?:^|\s)([\!\[\^]*(?:<[^<]*>)?\/.*?[^\\\/]\/[\?\]\+\*\$~]*)(?:\s|$)/,He=/([\!\[\^]*(?:<[^<]*>)?\([^\)]+[^\\\)]\)[\?\]\+\*\$~]*)(?:\s|$)/,je$1=/ /g,Ne$1=e=>/^[\!\[\^]*(<[^<]*>)?\//.test(e)&&/\/[\?\]\+\*\$~]*$/.test(e),xe$1=function(e){return(e=e.map((e=>e.trim()))).filter((e=>e))};var Fe$1=function(e){let t=e.split(Ee$1),n=[];t.forEach((e=>{Ne$1(e)?n.push(e):n=n.concat(e.split(He))})),n=xe$1(n);let r=[];return n.forEach((e=>{(e=>/^[\!\[\^]*(<[^<]*>)?\(/.test(e)&&/\)[\?\]\+\*\$~]*$/.test(e))(e)||Ne$1(e)?r.push(e):r=r.concat(e.split(je$1))})),r=xe$1(r),r};const Ce$1=/\{([0-9]+,?[0-9]*)\}/,Be=/&&/,Ge=new RegExp(/^<\s*?(\S+)\s*?>/),ze$1=function(e){return e[e.length-1]},Ie=function(e){return e[0]},Oe$1=function(e){return e.substr(1)},Te=function(e){return e.substr(0,e.length-1)},Ve$1=function(e){return e=Oe$1(e),Te(e)},Me$1=function(e){let t={};for(let n=0;n<2;n+=1){if("$"===ze$1(e)&&(t.end=!0,e=Te(e)),"^"===Ie(e)&&(t.start=!0,e=Oe$1(e)),("["===Ie(e)||"]"===ze$1(e))&&(t.named=!0,"["===Ie(e)?t.groupType="]"===ze$1(e)?"single":"start":t.groupType="end",e=(e=e.replace(/^\[/,"")).replace(/\]$/,""),"<"===Ie(e))){const n=Ge.exec(e);n.length>=2&&(t.named=n[1],e=e.replace(n[0],""))}if("+"===ze$1(e)&&(t.greedy=!0,e=Te(e)),"*"!==e&&"*"===ze$1(e)&&"\\*"!==e&&(t.greedy=!0,e=Te(e)),"?"===ze$1(e)&&(t.optional=!0,e=Te(e)),"!"===Ie(e)&&(t.negative=!0,e=Oe$1(e)),"("===Ie(e)&&")"===ze$1(e)){Be.test(e)?(t.choices=e.split(Be),t.operator="and"):(t.choices=e.split("|"),t.operator="or"),t.choices[0]=Oe$1(t.choices[0]);let n=t.choices.length-1;t.choices[n]=Te(t.choices[n]),t.choices=t.choices.map((e=>e.trim())),t.choices=t.choices.filter((e=>e)),t.choices=t.choices.map((e=>e.split(/ /g).map(Me$1))),e=""}if("/"===Ie(e)&&"/"===ze$1(e))return e=Ve$1(e),t.regex=new RegExp(e),t;if("~"===Ie(e)&&"~"===ze$1(e))return e=Ve$1(e),t.soft=!0,t.word=e,t}return!0===Ce$1.test(e)&&(e=e.replace(Ce$1,((e,n)=>{let r=n.split(/,/g);return 1===r.length?(t.min=Number(r[0]),t.max=Number(r[0])):(t.min=Number(r[0]),t.max=Number(r[1]||999)),t.greedy=!0,t.optional=!0,""}))),"#"===Ie(e)?(t.tag=Oe$1(e),t.tag=(n=t.tag).charAt(0).toUpperCase()+n.substr(1),t):"@"===Ie(e)?(t.method=Oe$1(e),t):"."===e?(t.anything=!0,t):"*"===e?(t.anything=!0,t.greedy=!0,t.optional=!0,t):(e&&(e=(e=e.replace("\\*","*")).replace("\\.","."),t.word=e.toLowerCase()),t);var n},Je=Fe$1,Le=Me$1,Se=function(e,t={}){return e.filter((e=>e.groupType)).length>0&&(e=function(e){let t,n=!1,r=-1;for(let a=0;a<e.length;a++){const i=e[a];"single"!==i.groupType||!0!==i.named?("start"===i.groupType&&(n=!0,"string"==typeof i.named||"number"==typeof i.named?t=i.named:(r+=1,t=r)),n&&(i.named=t),"end"===i.groupType&&(n=!1)):(r+=1,i.named=r)}return e}(e)),t.fuzzy||(e=function(e){return e.map((e=>{if(void 0!==e.choices&&!0===e.choices.every((e=>{if(1!==e.length)return!1;let t=e[0];return void 0!==t.word&&!0!==t.negative&&!0!==t.optional&&!0!==t.method}))){let t={};e.choices.forEach((e=>{t[e[0].word]=!0})),e.fastOr=t,delete e.choices}return e}))}(e)),e};var _e=function(e,t={}){if(null==e||""===e)return[];if("object"==typeof e){if(function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)){if(0===e.length||!e[0])return[];if("object"==typeof e[0])return e;if("string"==typeof e[0])return function(e){return[{choices:e.map((e=>[{word:e}])),operator:"or"}]}(e)}return e&&"Doc"===e.isA?function(e){if(!e||!e.list||!e.list[0])return[];let t=[];return e.list.forEach((e=>{let n=[];e.terms().forEach((e=>{n.push(e.id)})),t.push(n)})),[{idBlocks:t}]}(e):[]}"number"==typeof e&&(e=String(e));let n=Je(e);return n=n.map((e=>Le(e))),n=Se(n,t),n=function(e,t){return!0===t.fuzzy&&(t.fuzzy=.85),"number"==typeof t.fuzzy&&(e=e.map((e=>(t.fuzzy>0&&e.word&&(e.fuzzy=t.fuzzy),e.choices&&e.choices.forEach((e=>{e.forEach((e=>{e.fuzzy=t.fuzzy}))})),e)))),e}(n,t),n};const Ke=we$1,qe=$e$1,We=Pe$1,Re=_e,Ue=function(e,t){let n=[],r=t[0].idBlocks;for(let t=0;t<e.length;t+=1)r.forEach((r=>{0!==r.length&&r.every(((n,r)=>e[t+r].id===n))&&(n.push({match:e.slice(t,t+r.length)}),t+=r.length-1)}));return n};var Qe=function(e,t,n=!1){if("string"==typeof t&&(t=Re(t)),!0===Ke(e,t))return[];const r=t.filter((e=>!0!==e.optional&&!0!==e.negative)).length;let a=e.terms(),i=[];if(t[0].idBlocks){let e=Ue(a,t);if(e&&e.length>0)return We(a,t,e)}if(!0===t[0].start){let e=qe(a,t,0,a.length);return e&&e.match&&e.match.length>0&&(e.match=e.match.filter((e=>e)),i.push(e)),We(a,t,i)}for(let e=0;e<a.length&&!(e+r>a.length);e+=1){let r=qe(a.slice(e),t,e,a.length);if(r&&r.match&&r.match.length>0&&(e+=r.match.length-1,r.match=r.match.filter((e=>e)),i.push(r),!0===n))return We(a,t,i)}return We(a,t,i)};const Ze=Qe,Xe=Qe,Ye=function(e,t){let n={};Ze(e,t).forEach((({match:e})=>{e.forEach((e=>{n[e.id]=!0}))}));let r=e.terms(),a=[],i=[];return r.forEach((e=>{!0!==n[e.id]?i.push(e):i.length>0&&(a.push(i),i=[])})),i.length>0&&a.push(i),a};ye$1.match=function(e,t=!1){let n=Xe(this,e,t);return n=n.map((({match:e,groups:t})=>{let n=this.buildFrom(e[0].id,e.length,t);return n.cache.terms=e,n})),n},ye$1.has=function(e){return Xe(this,e,!0).length>0},ye$1.not=function(e){let t=Ye(this,e);return t=t.map((e=>this.buildFrom(e[0].id,e.length))),t},ye$1.canBe=function(e,t){let n=[],r=this.terms(),a=!1;for(let i=0;i<r.length;i+=1){let o=r[i].canBe(e,t);!0===o&&(!0===a?n[n.length-1].push(r[i]):n.push([r[i]]),a=o)}return n=n.filter((e=>e.length>0)).map((e=>this.buildFrom(e[0].id,e.length))),n};const et=be$1,tt=ye$1;class rt{constructor(e,t,n){this.start=e,this.length=t,this.isA="Phrase",Object.defineProperty(this,"pool",{enumerable:!1,writable:!0,value:n}),Object.defineProperty(this,"cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"groups",{enumerable:!1,writable:!0,value:{}})}}rt.prototype.buildFrom=function(e,t,n){let r=new rt(e,t,this.pool);return n&&Object.keys(n).length>0?r.groups=n:r.groups=this.groups,r},Object.assign(rt.prototype,tt),Object.assign(rt.prototype,et);const at={term:"terms"};Object.keys(at).forEach((e=>rt.prototype[e]=rt.prototype[at[e]]));var nt=rt;class it{constructor(e={}){Object.defineProperty(this,"words",{enumerable:!1,value:e})}add(e){return this.words[e.id]=e,this}get(e){return this.words[e]}remove(e){delete this.words[e]}merge(e){return Object.assign(this.words,e.words),this}stats(){return{words:Object.keys(this.words).length}}}it.prototype.clone=function(){let e=Object.keys(this.words).reduce(((e,t)=>{let n=this.words[t].clone();return e[n.id]=n,e}),{});return new it(e)};var ot=it,st=e=>{e.forEach(((t,n)=>{n>0&&(t.prev=e[n-1].id),e[n+1]&&(t.next=e[n+1].id)}))};const lt=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,ut=/\S/,ct=/[ .][A-Z]\.? *$/i,ht=/(?:\u2026|\.{2,}) *$/,dt=/((?:\r?\n|\r)+)/,gt=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,pt=/^\s+/,mt=function(e,t,n,r){if(r.hasLetter=function(e,t){return t||gt.test(e)}(t,r.hasLetter),!r.hasLetter)return!1;if(function(e,t){return-1!==t.indexOf(".")&&ct.test(e)}(e,t))return!1;if(function(e,t){return-1!==t.indexOf(".")&&ht.test(e)}(e,t))return!1;let a=e.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,"").split(" "),i=a[a.length-1].toLowerCase();return!n.hasOwnProperty(i)};var ft=function(e,t){let n=t.cache.abbreviations;e=e||"";let r=[],a=[];if(!(e=String(e))||"string"!=typeof e||!1===ut.test(e))return r;let i=function(e){let t=[],n=e.split(dt);for(let e=0;e<n.length;e++){let r=n[e].split(lt);for(let e=0;e<r.length;e++)t.push(r[e])}return t}(e=e.replace(""," "));for(let e=0;e<i.length;e++){let t=i[e];if(void 0!==t&&""!==t){if(!1===ut.test(t)){if(a[a.length-1]){a[a.length-1]+=t;continue}if(i[e+1]){i[e+1]=t+i[e+1];continue}}a.push(t)}}let o=a[0]||"";const s={hasLetter:!1};for(let e=0;e<a.length;e++){let t=a[e];a[e+1]&&!1===mt(t,o,n,s)?(o=a[e+1]||"",a[e+1]=t+o):t&&t.length>0&&(r.push(t),o=a[e+1]||"",s.hasLetter=!1),a[e]=""}if(0===r.length)return[e];for(let e=1;e<r.length;e+=1){let t=r[e].match(pt);null!==t&&(r[e-1]+=t[0],r[e]=r[e].replace(pt,""))}return r};const bt=/\S/,yt=/^[!?.]+$/,vt=/(\S+)/,wt=/[a-z] ?\/ ?[a-z]*$/;let kt=[".","?","!",":",";","-","","","--","...","(",")","[","]",'"',"'","`"];kt=kt.reduce(((e,t)=>(e[t]=!0,e)),{});const At=function(e){return!0!==/^(re|un|micro|macro|trans|bi|mono|over)-?[^aeiou]./.test(e)&&(!0!==/^([a-z\u00C0-\u00FF/]+)(-||)(like|ish|less|able)/i.test(e)&&(!0===/^([a-z\u00C0-\u00FF`"'/]+)(-||)([a-z0-9\u00C0-\u00FF].*)/i.test(e)||!0===/^([0-9]{1,4})(-||)([a-z\u00C0-\u00FF`"'/-]+$)/i.test(e)))},Dt=function(e){let t=[];const n=e.split(/[-]/);let r="-",a=e.match(/[-]/);a&&a[0]&&(r=a);for(let e=0;e<n.length;e++)e===n.length-1?t.push(n[e]):t.push(n[e]+r);return t},$t=ne$1,Pt=nt,Et=ot,Ht=st,jt=ft,Nt=function(e){let t=[],n=[];if("number"==typeof(e=e||"")&&(e=String(e)),function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e))return e;const r=e.split(vt);for(let e=0;e<r.length;e++)!0!==At(r[e])?n.push(r[e]):n=n.concat(Dt(r[e]));let a="";for(let e=0;e<n.length;e++){let r=n[e];!0===bt.test(r)&&!1===kt.hasOwnProperty(r)&&!1===yt.test(r)?(t.length>0?(t[t.length-1]+=a,t.push(r)):t.push(a+r),a=""):a+=r}return a&&(0===t.length&&(t[0]=""),t[t.length-1]+=a),t=function(e){for(let t=1;t<e.length-1;t++)wt.test(e[t])&&(e[t-1]+=e[t]+e[t+1],e[t]=null,e[t+1]=null);return e}(t),t=function(e){const t=/^[0-9]{1,4}(:[0-9][0-9])?([a-z]{1,2})? ?(-||) ?$/,n=/^[0-9]{1,4}([a-z]{1,2})? ?$/;for(let r=0;r<e.length-1;r+=1)e[r+1]&&t.test(e[r])&&n.test(e[r+1])&&(e[r]=e[r]+e[r+1],e[r+1]=null);return e}(t),t=t.filter((e=>e)),t};var xt=function(e="",t,n){let r=null;return"string"!=typeof e&&("number"==typeof e?e=String(e):function(e){return"[object Array]"===Object.prototype.toString.call(e)}(e)&&(r=e)),r=r||jt(e,t),r=r.map((e=>Nt(e))),n=n||new Et,r.map((e=>{e=e.map((e=>{let t=new $t(e);return n.add(t),t})),Ht(e);let t=new Pt(e[0].id,e.length,n);return t.cache.terms=e,t}))};const Ft=ne$1,Ct=nt,Bt=ot,Gt=st;var zt=function(e,t){let n=new Bt;return e.map(((e,r)=>{let a=e.terms.map(((a,i)=>{let o=new Ft(a.text);return o.pre=void 0!==a.pre?a.pre:"",void 0===a.post&&(a.post=" ",i>=e.terms.length-1&&(a.post=". ",r>=e.terms.length-1&&(a.post="."))),o.post=void 0!==a.post?a.post:" ",a.tags&&a.tags.forEach((e=>o.tag(e,"",t))),n.add(o),o}));return Gt(a),new Ct(a[0].id,a.length,n)}))};const It=["Person","Place","Organization"],Ot=["Noun","Verb","Adjective","Adverb","Value","QuestionWord"],Tt={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adverb:"cyan"},Vt=function(e){return Object.keys(e).forEach((t=>{e[t].color?e[t].color=e[t].color:Tt[t]?e[t].color=Tt[t]:e[t].isA.some((n=>!!Tt[n]&&(e[t].color=Tt[n],!0)))})),e},Mt=function(e){return Object.keys(e).forEach((t=>{let n=e[t],r=n.isA.length;for(let t=0;t<r;t++){let r=n.isA[t];e[r]&&(n.isA=n.isA.concat(e[r].isA))}n.isA=function(e){return e.filter(((e,t,n)=>n.indexOf(e)===t))}(n.isA)})),e},Jt=function(e){let t=Object.keys(e);return t.forEach((n=>{let r=e[n];r.notA=r.notA||[],r.isA.forEach((t=>{if(e[t]&&e[t].notA){let n="string"==typeof e[t].notA?[e[t].isA]:e[t].notA||[];r.notA=r.notA.concat(n)}}));for(let a=0;a<t.length;a++){const i=t[a];-1!==e[i].notA.indexOf(n)&&r.notA.push(i)}r.notA=function(e){return e.filter(((e,t,n)=>n.indexOf(e)===t))}(r.notA)})),e},Lt=function(e){let t=Object.keys(e);return t.forEach((n=>{let r=e[n];r.lineage=[];for(let a=0;a<t.length;a++)-1!==e[t[a]].isA.indexOf(n)&&r.lineage.push(t[a])})),e};var St=function(e){return e=function(e){return Object.keys(e).forEach((t=>{let n=e[t];n.isA=n.isA||[],"string"==typeof n.isA&&(n.isA=[n.isA]),n.notA=n.notA||[],"string"==typeof n.notA&&(n.notA=[n.notA])})),e}(e),e=Mt(e),e=Jt(e),e=Vt(e),Lt(e)};const _t={Noun:{notA:["Verb","Adjective","Adverb"]},Singular:{isA:"Noun",notA:"Plural"},ProperNoun:{isA:"Noun"},Person:{isA:["ProperNoun","Singular"],notA:["Place","Organization","Date"]},FirstName:{isA:"Person"},MaleName:{isA:"FirstName",notA:["FemaleName","LastName"]},FemaleName:{isA:"FirstName",notA:["MaleName","LastName"]},LastName:{isA:"Person",notA:["FirstName"]},NickName:{isA:"Person",notA:["FirstName","LastName"]},Honorific:{isA:"Noun",notA:["FirstName","LastName","Value"]},Place:{isA:"Singular",notA:["Person","Organization"]},Country:{isA:["Place","ProperNoun"],notA:["City"]},City:{isA:["Place","ProperNoun"],notA:["Country"]},Region:{isA:["Place","ProperNoun"]},Address:{isA:"Place"},Organization:{isA:["Singular","ProperNoun"],notA:["Person","Place"]},SportsTeam:{isA:"Organization"},School:{isA:"Organization"},Company:{isA:"Organization"},Plural:{isA:"Noun",notA:["Singular"]},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun",notA:It},Actor:{isA:"Noun",notA:It},Activity:{isA:"Noun",notA:["Person","Place"]},Unit:{isA:"Noun",notA:It},Demonym:{isA:["Noun","ProperNoun"],notA:It},Possessive:{isA:"Noun"}},Kt={Verb:{notA:["Noun","Adjective","Adverb","Value","Expression"]},PresentTense:{isA:"Verb",notA:["PastTense","FutureTense"]},Infinitive:{isA:"PresentTense",notA:["PastTense","Gerund"]},Imperative:{isA:"Infinitive"},Gerund:{isA:"PresentTense",notA:["PastTense","Copula","FutureTense"]},PastTense:{isA:"Verb",notA:["FutureTense"]},FutureTense:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb",notA:["Infinitive"]},PerfectTense:{isA:"Verb",notA:"Gerund"},Pluperfect:{isA:"Verb"},Participle:{isA:"PastTense"},PhrasalVerb:{isA:"Verb"},Particle:{isA:"PhrasalVerb"},Auxiliary:{notA:["Noun","Adjective","Value"]}},qt={Value:{notA:["Verb","Adjective","Adverb"]},Ordinal:{isA:"Value",notA:["Cardinal"]},Cardinal:{isA:"Value",notA:["Ordinal"]},Fraction:{isA:"Value",notA:["Noun"]},RomanNumeral:{isA:"Cardinal",notA:["Ordinal","TextValue"]},TextValue:{isA:"Value",notA:["NumericValue"]},NumericValue:{isA:"Value",notA:["TextValue"]},Money:{isA:"Cardinal"},Percent:{isA:"Value"}},Wt={Adjective:{notA:["Noun","Verb","Adverb","Value"]},Comparable:{isA:["Adjective"]},Comparative:{isA:["Adjective"]},Superlative:{isA:["Adjective"],notA:["Comparative"]},NumberRange:{},Adverb:{notA:["Noun","Verb","Adjective","Value"]},Date:{notA:["Verb","Adverb","Preposition","Adjective"]},Month:{isA:["Date","Singular"],notA:["Year","WeekDay","Time"]},WeekDay:{isA:["Date","Noun"]},Timezone:{isA:["Date","Noun"],notA:["Adjective","ProperNoun"]},Time:{isA:["Date"],notA:["AtMention"]},Determiner:{notA:Ot},Conjunction:{notA:Ot},Preposition:{notA:Ot},QuestionWord:{notA:["Determiner"]},Currency:{isA:["Noun"]},Expression:{notA:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{notA:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email"]},PhoneNumber:{notA:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{isA:["Noun"],notA:["HashTag","Verb","Adjective","Value","Email"]},Emoji:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Email:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{notA:["Plural","RomanNumeral"]},Negative:{notA:["Noun","Adjective","Value"]},Condition:{notA:["Verb","Adjective","Noun","Value"]}},Rt=St,Ut=function(e,t){Object.keys(e).forEach((n=>{t[n]=e[n]}))};var Qt=(()=>{let e={};return Ut(_t,e),Ut(Kt,e),Ut(qt,e),Ut(Wt,e),e=Rt(e),e})();const Zt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",Xt=Zt.split("").reduce((function(e,t,n){return e[t]=n,e}),{});var Yt=function(e){if(void 0!==Xt[e])return Xt[e];let t=0,n=1,r=36,a=1;for(;n<e.length;t+=r,n++,r*=36);for(let n=e.length-1;n>=0;n--,a*=36){let r=e.charCodeAt(n)-48;r>10&&(r-=7),t+=r*a}return t};const er=function(e,t,n){const r=Yt(t);return r<e.symCount?e.syms[r]:n+r+1-e.symCount};var tr=function(e){const t={nodes:e.split(";"),syms:[],symCount:0};return e.match(":")&&function(e){const t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let n=0;n<e.nodes.length;n++){const r=t.exec(e.nodes[n]);if(!r){e.symCount=n;break}e.syms[Yt(r[1])]=Yt(r[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)}(t),function(e){const t=[],n=(r,a)=>{let i=e.nodes[r];"!"===i[0]&&(t.push(a),i=i.slice(1));const o=i.split(/([A-Z0-9,]+)/g);for(let i=0;i<o.length;i+=2){const s=o[i],l=o[i+1];if(!s)continue;const u=a+s;if(","===l||void 0===l){t.push(u);continue}const c=er(e,l,r);n(c,u)}};return n(0,""),t}(t)};const rr={Comparative:"truebetter",Superlative:"trueearlier",PresentTense:"trueis,sounds",Value:"truea few",Noun:"truea5b4c2f1here,ie,lit,m0no doubt,pd,tce;a,d;t,y;a,ca,o0;l,rp;a,l;d,l,rc",Copula:"truea1is,w0;as,ere;m,re",PastTense:"truebe3came,d2had,lied,meant,sa2taken,w0;as,e0;nt,re;id;en,gan",Condition:"trueif,lest,unless",Preposition:"true'o,-,aLbIcHdGexcept,fFiDmidQnotwithstandiRoBpSqua,sAt6u3vi2w0;/o,hereNith0;!in,oR;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oJ;ans,ince,o that;',f0n2ut;!f;f,n0;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;sides,tween;ri6;',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut",Gerund:"trueaccord0be0develop0go0result0stain0;ing",Negative:"truen0;ever,o0;!n,t",QuestionWord:"truehow3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Plural:"truerecords",Conjunction:"true&,aFbBcuz,how9in caEno8o7p5supposing,t2v1wh0yet;eth9ile;ers4s;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh",Abbreviation:"truea0Jb0Gc0Ad08e05f02g01h00iYjWkanVlTmNnKoJpFque,rDs8t6u5v2w0;is0r,y0B;!c;a,b,e1i0ol,s,t;tro,vo;r,t;niv,safa,t;ce,e0;l,mp,nn,x;ask,e2fc,gt,i1q,r,s,t,u0;pt,rg;r,tu;c,nJp0;!t;b,d,e0;pGs,v;a,d,ennNhd,l,p,r1s0vt;!eud;ef,o0;b,f,n;ct,kla,nt;e0ov;b0e;!r;a4d,essrs,i1lle,me,r7s0t;!tr;n1s0;c,ter;!n;!j,r,sc;at,it,lb,ng,t0;!d;!s;an,d,r,u0;l,n;a,da,e,n0;c,f;on,wy;a,en,ov;e1ig,l0m,r,t,y;!a;b,m;a,g,ng,s1tc,x0;!p;p,q,t;ak,e0ist,r;c,f,pt,t;a3ca,l,m2o0pl,res,yn;!l0m1nn,rp;!o;dr;!l0pt;!if;a,c,l1r0;ig,os;!dg,vd;d4l3p2r1ss0tty,ug,ve;n,t;c,iz;prox,r,t;!ta;!j,m,v",Pronoun:"true'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!'s",Singular:"true0:16;1:13;2:19;a16b0Tc0Kd0De0Af05g00hWiVjel0kitty,lTmPnOoNpHquestionGrEs9t6u4w3;ay,om03;nc10s 3;doll0Lst0N; rex,a4h3ic,ragedy,v show;ere,i2;l0x return;i6ky,omeoNt3uper bowl,yst15;ep4ri2u3;de0Yff;faTmoT;st1ze;al0i2o3;om,se;! mark;a7i1la6r4u3;dQrpoI;e3ie0Hobl0V;roga00ss releaG;te,y1;rt,te0N;bjWceJthers,verview;othi2umb1;a5ee08o3;del,m3nopo0rni2th1;!my;n,yf0;i3unch;ne;ci2nsect;ead start,o3uman right;l0me4u3;se;! run;adf0entlem6irl02laci1od,rand4u3;l0y; slam,fa3mo3;th1;an;a6ella,ly,ol0r4un3;di2;ee market,iWo3;nti1sP;mi0th1;conomy,gg,ner7ven4x3;ampTecu9;i2t;ad8e5inn1o3ragonf0ude;cumentGg3i0l0or;gy;ath,t3;ec3;tive;!dy;a9eili2h7i5o3redit card;ttage,u3;ri1sin;ty,vil w3;ar;andeli1ocol3;ate;n3rF;ary;aCel0lesJo8r5u3;n3tterf0;ti2;eakfa4o3;!th1;st;dy,tt5y3;!fri3;end;le;nki2r3;ri1;er;d5l0noma0u3;nt;ly; homin5verti3;si2;ng;em",FemaleName:"true0:J3;1:J7;2:IG;3:IF;4:IX;5:IK;6:JO;7:H0;8:JG;9:JK;A:HN;B:HY;C:IT;D:IP;E:JD;F:HC;G:I0;aGRbFLcDPdCYeBOfB4gADh9Ti9Gj8Gk7Gl60m49n3No3Jp37qu36r2Ds16t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof2;e3Uf2la,ra;h3iKlIna,ynH;ab,ep;da,ma;da,h3iHra;nab;aKeJi0Fol5BuIvH;etAonDO;i0na;le0sen2;el,gm3Jn,rGJs8W;aoHme0nyi;m62yAE;aMendDYhiDFiH;dele8lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;cIktoriBMlAole7viH;anC3enJ0;kF9tor2;da,lA9nus,rHs0;a,nHoniH4;a,iFQ;leHnesH4;nIHrH;i1y;g8rHxH5;su5te;aYeUhRiNoLrIuHy3;i,la;acIZiHu0L;c2na,sH;hBPta;nHr0H;iBNya;aJffaEOnHs6;a,gtiH;ng;!nFQra;aIeHomasi0;a,l9Po8Ares1;l2ndolwethu;g9Go88rIssH;!a,ie;eHi,ri9;sa,za;bPlNmLnJrIs6tHwa0;ia0um;a63yn;iHya;a,ka,s6;arB6e3iHmEDra;!ka;a,iH;a,t6;at6it6;a0Fcarlet3We0BhXiTkye,neza0oRtNuIyH;bIBlvi1;e,ha,mayIEni7sIzH;an3MetAie,y;anHi9;!a,e,nH;aDe;aJeH;fHl5GphH;an4;cHZr5;b2fiA8m0OnHphi1;d3ia,ja,ya;er3lJmon1nIobh8PtH;a,i;dy;lEPv2;aMeIirHo0risF7y5;a,lDK;ba,e0i5lJrH;iHrDOyl;!d8Hfa;ia,lDX;hd,iMki3nJrIu0w0yH;la,ma,na;i,le8on,ron;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye81vH;da,inj;e0ife;en1i0ma;anA5bNd3Nh1RiBkMlLmJndIrHs6vannaD;aDi0;ra,y;aHi3;nt6ra;lDKma,ome;ee0in8Ru3;in1ri0;a05e00hYiVoIuH;by,thDH;bScRghQl2KnPsJwIxH;anAXie,y;an,e0;aIeHie,lE; merBLann9ll1marDBt7;!lHnn1;iHyn;e,nH;a,d9K;da,i,na;ayy8D;hel62io;bDKer7yn;a,cIkHmas,n9Fta,ya;ki,o;helGki;ea,iannGDoH;da,n1K;an0bJem9Agi0iInHta,y0;a88ee;han83na;a,eH;cEAkaD;bi0chIe,i0mo0nHquEKvCy0;di,ia;aEIelHiB;!e,le;een4ia0;aNeMhKipaluk,oJrHute66;iHudenCQ;scil3LyamvaB;lly,rt2;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r5t3;ige,m0TnKo5rvaDGtIulH;a,etAin1;ricHsy,tBY;a,e,ia;do3i06;ctav2dIfCZis6lHphCZumC3yunbileg;a,ga,iv2;eHvAC;l2tA;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aDeCma;ll1mi;aNcLhariBOkKlaJna,sHta,vi;anHha;ur;!y;a,iDTki;hoGk9VolH;a,eDJ;!mh;hir,lHna,risFsreC;!a,lBT;asuLdKh2i6CnJomi9rgEPtHzanin zah3;aHhal4;li1s6;cy,etA;a,e8iEV;nngu30;a09ckenz4e01iMoJrignayani,uriDDyH;a,rH;a,lNna,tG;bi0i3llBInH;a,iH;ca,ka,qD3;a,cTkaSlNmi,nLrItzi,yH;ar;aIiam,lH;anEO;!l,nB;dy,eHh,n4;nhGrva;aKdJiCPlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5EgNi,lKrH;edi79iIjem,on,yH;em,l;em,sF;an4iHliF;nHsCE;a,da;!an,han;b0DcASd0Be,g09ha,i08ja,l06n04rLsoum60tKuIv82x9IyHz4;a,bell,ra,soB9;de,rH;a,eC;h8Fild1t4;a,cYgUiKjor4l7Sn4s6tJwa,yH;!aHbe6Wja8lAE;m,nBH;a,ha,in1;!aJbCBeIja,lEna,sHt64;!a,ol,sa;!l1H;! Jh,mInH;!a,e,n1;!awit,i;aliAHcJeduarBfernIjHlui5Y;o6Ful2;anB;ecil2la3;arJeIie,oHr44ueriA;!t;!ry;et42i37;el4Ui76y;dHon,ue5;akran7y;ak,en,iHk,lo3O;a,ka,nB;a,re,s4te;daHg4;!l3A;alEd4elHge,isDBon0;ei8in1yn;el,le;a0Ne0CiYoQuLyH;d2la,nH;!a,dIeBGnHsCL;!a,eBF;a,sCJ;aCWcJel0PiFlIna,pHz;e,i7;a,u,wa;iHy;a0Se,ja,l2JnB;is,l1SrJttIuHvel4;el5is1;e,ie;aKeIi9na,rH;a86i9;lHn1t7;ei;!in1;aSbb9CdRepa,lMnJsIv2zH;!a,be5LetAz4;a,etA;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lHy;iHy;aA0e;!aH;!n5F;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx4y5;iHt4;c2t2;e2LlCG;la,nHra;a,ie,o3;a,or1;a,gh,laH;!ni;!h,nH;a,d3e,n5P;cOdon97iNkes6mi9Ana,rMtJurIvHxmi,y5;ern1in2;a,e54ie,yn;as6iIoH;nya,ya;fa,s6;a,isF;a,la;ey,ie,y;a04eZhXiOlAKoNrJyH;lHra;a,ee,ie;istHy6D;a,en,iIyH;!na;!e,n59;nul,ri,urtnB0;aOerNlAZmJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stC;!na,ra;aHei3ongordzol;dij1w5;el7QiKjsi,lJnIrH;a,i,ri;d3na,za;ey,i,lBDs4y;ra,s6;bi7cAJdiat7IeB2iRlQmPnyakuma19rNss6KtKvi7yH;!e,lH;a,eH;e,i8L;a6DeIhHi4NlEri0y;ar6Ber6Bie,leCrB2y;!lyn8Gri0;a,en,iHl5Soli0yn;!ma,n3VsF;a5il1;ei8Ei,l4;a,tl6L;a07eYiVoNuH;anLdKliHst63;a8HeHsF;!n8tH;!a,te;e5Ji3Jy;a,i7;!anNcelEd6RelGhan7RlLni,sIva0yH;a,ce;eHie;fHlEph5U;a,in1;eHie;en,n1;!a,e,n41;lHng;!i1ClH;!i1B;anMle0nJrIsH;i8Csi8C;i,ri;!a,elGif2CnH;a,etAiHy;!e,f2A;a,e8EiInH;a,e8DiH;e,n1;cMd1mi,nIque4Xsmin3Ovie3y8zH;min9;a9eIiH;ce,e,n1s;!lHsFt0F;e,le;inIk4lEquelH;in1yn;da,ta;lRmPnOo0rNsIvaHzaro;!a0lu,na;aJiIlaHob84;!n9N;do3;!belHdo3;!a,e,l39;a77en1i0ma;a,di3es,gr6Yji;a8elBogH;en1;a,e8iHo0se;a0na;aSeOiJoHusFyacin2B;da,ll4rten23snH;a,i9Q;lImaH;ri;aIdHlaI;a,egard;ry;ath1CiJlInriet7rmi8sH;sa,t1B;en2Sga,mi;di;bi2Dil8IlNnMrJsItHwa,yl8Iz7H;i5St4;n5Yti;iHmo51ri52;etH;!te;aDnaD;a,ey,l4;a03eXiSlQoOrKunJwH;enHyne1Q;!dolE;ay,el;acIetHiselB;a,chC;e,ieH;!la;ld1AogooH;sh;adys,enHor2yn2H;a,da,na;aKgi,lIna,ov89selHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald3Pi,m3Ctru8B;etAi4W;a,eHna;s26vieve;ma;bIil,le,mHrnet,yG;al5Ni5;i5FrielH;a,l1;aVeSiRloOoz2rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0O;n1s61;!ca;!rH;a,encH;e,ia;en,o0;lIn0rnH;!anB;ec2ic2;jr,n7rKtHy9;emIiHma,ouma7;ha,ma,n;eh;ah,iBrah,za0;cr4Nd0Ne0Mi0Lk7l04mWn4YrTsNtMuLvH;aJelIiH;!e,ta;in0Gyn;!ngel2S;geni1la,ni45;h5Sta;mLperanKtH;eIhHrel5;er;l30r9;za;a,eralB;iHma,nest2Jyn;cHka,n;a,ka;a,eMiJmH;aHie,y;!li8;lHn1;ee,iHy;a,e,ja;lHrald;da,y;aWeUiNlMma,no3oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c2da,f,nMsJzaH;!betHve7;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a;!in1na;leCs6;vi;eIiHna,wi0;e,th;l,n;aYeMh2iLjeneKoHul30;lor5Tminiq4In3FrHtt4;a,eCis,la,othHthy;ea,y;ba;an0AnaDon8x4ya;anQbPde,eOiMja,lJmetr2nHsir5K;a,iH;ce,se;a,iIla,orHphi8;es,is;a,l6D;dHrdH;re;!d5Cna;!b2HoraDra;a,d3nH;!a,e;hl2i0l0HmNnLphn1rIvi1XyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,etAiH;!ca,el1Cka,z;arHia;is;a0Se0Oh05i03lVoKrIynH;di,th2;istHy05;al,i0;lPnMrIurH;tn1E;aJd2NiHn2Nri8;!nH;a,e,n1;!l1X;cepci59n4sH;tanHuelo;ce,za;eHleC;en,tA;aJeoIotH;il51;!pat3;ir9rJudH;etAiH;a,ne;a,e,iH;ce,sZ;a3er3ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Ren,iHy;!an1e,n1;deJlseIrH;!i9yl;a,y;li8;nMrH;isKlImH;ai8;a,eHotA;n1tA;!sa;d3elGtH;al,elG;cIlH;esAi44;el2ilH;e,ia,y;itlZlYmilXndWrOsMtHy5;aKeJhHri0;erHleCrEy;in1;ri0;li0ri0;a33sH;a32ie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,o7y;ne,y;na,sF;a0Hi0H;a,e,l1;is7l4;in,yn;a0Ie02iZlXoUrH;andSeQiJoIyH;an0nn;nwEok9;an3DdgLg0XtH;n2XtH;!aInH;ey,i,y;ny;etH;!t9;an0e,nH;da,na;i9y;bbi9glarIlo05nH;i7n4;ka;ancHossom,ythe;a,he;an17lja0nHsm3I;i7tH;ou;aUcky,linTni7rPssOtJulaDvH;!erlH;ey,y;hJsy,tH;e,iHy9;e,na;!anH;ie,y;!ie;nHt6yl;adIiH;ce;etAi8;ay,da;!triH;ce,z;rbJyaH;rmH;aa;a3ie,o3ra;a2Sb2Md23g1Zi1Qj5l16m0Xn09oi,r04sUtTuPvOwa,yIzH;ra,u0;aKes6gJlIseH;!l;in;un;!nH;a,na;a,i2Ir2J;drJgus1RrIsteH;ja;el2;a,ey,i,y;aahua,he0;hIi2Gja,mi7s2DtrH;id;aMlIraqHt21;at;eIi9yH;!n;e,iHy;gh;!nH;ti;iJleIo6pi7;ta;en,n1tA;aHelG;!n1J;a00dje5eYgUiSjQnJohito,toHya;inetAnH;el5ia;!aKeIiHmJ;e,ka;!mHtA;ar4;!belIliFmU;sa;!le;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tA;te;! JbImHstasiNya;ar2;el;cla3jul2pau5;aLberKeliJiHy;e,l2naH;!ta;a,ja;!ly;hGiIl2nB;da;a,ra;le;aWba,ePiMlKma,thJyH;a,c2sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c2is6jaKksaKna,sJxH;aHia;!nd3;ia,saH;nd3;ra;ia;i0nIyH;ah,na;a,is,naDoud;la;c6da,leCmNnLsH;haDlH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lEsH;on;yn;!lH;i8yn;ne;aKbIiHrL;!gaK;ey,i9y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Actor:"trueaJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJecretary,oldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt",Honorific:"truea01bYcQdPeOfiJgIhon,jr,king,lHmCoffic00p7queen,r3s0taoiseach,vice6;e1fc,gt,ir,r,u0;ltRpt,rg;cond liInBrgeaJ;abbi,e0;ar1p9s,v0;!erend; admirX;astOhd,r0vt;esideDi1of0;!essM;me mini4nce0;!ss;a3essrs,i2lle,me,r1s0;!tr;!s;stK;gistrate,j,r6yF;i3lb,t;en,ov;eld mar3rst l0;ady,i0;eutena0;nt;shG;sq,xcellency;et,oct6r,utchess;apt6hance4mdr,o0pl;lonel,m2ngress0unci3;m0wom0;an;dr,mand5;ll0;or;!ain;ldg,rig0;!adi0;er;d0sst,tty,yatullah;j,m0v;!ir0;al",SportsTeam:"true0:1A;1:1H;2:1G;a1Eb16c0Td0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Bm01newToQpJqueens parkIreal salt lake,sAt5utah jazz,vancouver whitecaps,w3yW;ashington 3est ham0Rh10;natio1Oredski2wizar0W;ampa bay 6e5o3;ronto 3ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasC;buccanee0ra0K;a7eattle 5heffield0Kporting kansas0Wt3;. louis 3oke0V;c1Frams;marine0s3;eah15ounG;cramento Rn 3;antonio spu0diego 3francisco gJjose earthquak1;char08paA; ran07;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat1steele0;il3oenix su2;adelphia 3li1;eagl1philNunE;dr1;akland 3klahoma city thunder,rlando magic;athle0Mrai3;de0; 3castle01;england 7orleans 6york 3;city fc,g4je0FknXme0Fred bul0Yy3;anke1;ian0D;pelica2sain0C;patrio0Brevolut3;ion;anchester Be9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Fvi3;kings;imberwolv1wi2;rewe0uc0K;dolphi2heat,marli2;mphis grizz3ts;li1;cXu08;a4eicesterVos angeles 3;clippe0dodDla9; galaxy,ke0;ansas city 3nE;chiefs,roya0E; pace0polis colU;astr06dynamo,rockeTtexa2;olden state warrio0reen bay pac3;ke0;.c.Aallas 7e3i05od5;nver 5troit 3;lio2pisto2ti3;ge0;broncZnuggeM;cowbo4maver3;ic00;ys; uQ;arCelKh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki1;brow2cavalie0india2;bengaWre3;ds;arlotte horAicago 3;b4cubs,fire,wh3;iteB;ea0ulR;diff3olina panthe0; c3;ity;altimore 9lackburn rove0oston 5rooklyn 3uffalo bilN;ne3;ts;cel4red3; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 3;brav1falco2h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls",Uncountable:"true0:1J;a1Qb1Ic19d16e0Zf0Tg0Mh0Hi0Dj0Cknowled1Pl07mXnWoVpRrMsBt6vi5w1;a3ea0Ai2oo1;d,l;ldlife,ne;rmth,t0;neg16ol0Btae;e4h3oothpaste,r1una;affSou1;ble,sers,t;ermod1Lund0;a,nnis;a9cene09eri0Wh8il7kittl0Wnow,o6p4t2u1;g0Znshi0P;ati1Ke1;am,el;ace1De1;ci0Red;ap,cc0;k,v0;eep,ingl0O;d0Cfe17l1nd,tish;m10t;a4e2ic1;e,ke0L;c1laxa0Hsearch;ogni0Grea0G;bi0Hin;aOe3hys17last8o1ress03;l1rk,w0;it15y9;a11trY;bstetr13il,xygen;ational securi0Vews;a8e6ilk,o3u1;mps,s1;ic;n1o0G;ey,o1;gamy;a1chan0V;sl03t;chine1il,themat0T; learn09ry;aught0e3i2ogi0Qu1;ck,g0G;ce,ghtn06ngui0OteratL;a1isK;th0;ewel8usti0J;ce,mp1nformaStself;a1ortan0H;ti1;en0F;a4isto3o1;ck1mework,n1spitali09;ey;ry;ir,libut,ppiB;ene4o2r1um,ymna0B;aAound;l1ssip;d,f; 1t08;editOpo1;ol;i5lour,o2urnit1;ure;od,rgive1uri0wl;ne1;ss;c7sh;conomZduca6lectr5n3quip4thZvery1;body,o1thF;ne;joy1tertain1;ment;iciNonU;tiG;ar2iabet1raugh2;es;ts;a8elcius,h4ivPl3o1urrency;al,ld w1nfusiBttB;ar;assMoth3;aos,e1;e2w1;ing;se;r5sh;a5eef,i2lood,owls,read,utt0;er;lliar2s1;on;ds;g1ss;ga1;ge;c6dvi5ero3ir2mnes1rt,thlet8;ty;craft;b5d1naut5;ynam4;ce;id,ou1;st1;ics",Infinitive:"true0:6S;1:76;2:5C;3:74;4:73;5:67;6:6F;7:6Y;8:6Q;9:72;A:70;B:5X;C:6X;D:6L;E:77;F:5B;a6Kb66c57d4De3Xf3Jg3Dh37i2Uj2Sk2Ql2Hm26n23o1Yp1Jr0Rs06tYuTvOwHyG;awn,e31ield;aJe1Zhist6iIoGre6D;nd0rG;k,ry;pe,sh,th0;lk,nHrGsh,tDve;n,raE;d0t;aJiHoG;te,w;eGsC;!w;l6Jry;nHpGr4se;gra4Pli41;dGi9lo5Zpub3Q;erGo;mi5Cw1I;aMeLhKig5SoJrHuGwi7;ne,rn;aGe0Mi5Uu7y;de,in,nsf0p,v5J;r2ZuD;ank,reatB;nd,st;ke pa53lk,rg1Qs9;aZcWeVhTi4Dkip,lSmRnee3Lo52pQtJuGwitD;bmCck,ff0gge7ppHrGspe5;ge,pri1rou4Zvi3;ly,o36;aLeKoJrHuG;dy,mb6;aFeGi3;ngthBss,tD;p,re;m,p;in,ke,r0Qy;la58oil,rink6;e1Zi6o3J;am,ip;a2iv0oG;ck,rtBut;arDem,le5n1r3tt6;aHo2rG;atDew;le,re;il,ve;a05eIisk,oHuG;in,le,sh;am,ll;a01cZdu8fYgXje5lUmTnt,pQquPsKtJvGwa5V;eGiew,o36;al,l,rG;se,t;aFi2u44;eJi7oItG;!o2rG;i5uc20;l3rt;mb6nt,r3;e7i2;air,eHlGo43r0K;a8y;at;aFemb0i3Zo3;aHeGi3y;a1nt;te,x;a5Dr0J;act1Yer,le5u1;a13ei3k5PoGyc6;gni2Cnci6rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlOoMrIuG;b21ll,mp,rGsh;cha1s4Q;ai1eIiEoG;cGdu8greAhibCmi1te7vi2W;eAlaim;di5pa2ss,veE;iEp,rtr46sGur;e,t;aHead,uG;g,n4;n,y;ck,le;fo34mCsi7;ck,iErt4Mss,u1;bJccur,ff0pera9utweIverGwe;co47lap,ta22u1wG;helm;igh;ser3taF;eHotG;e,i8;ed,gle5;aMeLiIoHuG;ltip3Grd0;nit13ve;nHrr12sreprG;eseE;d,g6us;asu2lt,n0Nr4;intaFna4rHtG;ch,t0;ch,kGry;et;aMeLiJoGu1C;aHck,oGve;k,sB;d,n;ft,g35ke,mCnk,st2YveG;!n;a2Fc0Et;b0Nck,uG;gh,nD;iGno34;ck,ll,ss;am,oFuG;d4mp;gno2mQnGss3H;cOdica9flu0MhNsKtIvG;eGol3;nt,st;erGrodu8;a5fe2;i7tG;aGru5;ll;abCibC;lu1Fr1D;agi24pG;lemeEo22ro3;aKeIi2oHuG;nt,rry;n02pe,st;aGlp;d,t;nd6ppBrm,te;aKloAove1PrIuG;arGeAi15;ant39d;aGip,ow,umb6;b,sp;in,th0ze;aReaQiOlMoJrHuncG;ti3J;acGeshB;tu2;cus,lHrG;ce,eca7m,s30;d,l24;a1ZoG;at,od,w;gu2lGni1Xt,x;e,l;r,tu2;il,stBvG;or;a15cho,le5mSnPstNvalua9xG;a0AcLerKi7pGte19;a18eHi2laFoGreA;rt,se;ct,riG;en8;ci1t;el,han4;abGima9;li1J;ab6couXdHfor8ga4han8j03riDsu2t0vG;isi2Vy;!u2;body,er4pG;hasiGow0;ze;a07eUiLoKrHuG;mp;aHeAiG;ft;g,in;d4ubt;ff0p,re5sHvG;iZor8;aKcHliGmiApl1Btingui14;ke;oGuA;uGv0;ra4;gr1YppG;ear,ro3;cOeNfLliv0ma0Fny,pKsHterG;mi0G;cribe,er3iHtrG;oy;gn,re;a0Be0Ai5osC;eGi0By;at,ct;m,pB;iIlHrG;ea1;a2i06;de;ma4n8rGte;e,kB;a0Ae09h06i9l04oJrG;aHeGoAu0Hy;a9dC;ck,ve;llZmSnHok,py,uGv0;gh,nt;cePdu5fMsKtIvG;eGin8;rt,y;aFin0VrG;a7ibu9ol;iGtitu9;d0st;iHoGroE;rm;gu2rm;rn;biLfoKmaJpG;a2laF;in;re;nd;rt;ne;ap1e5;aGip,o1;im,w;aHeG;at,ck,w;llen4n4r4se;a1nt0;ll,ncIrGt0u1;eGry;!en;el;aSePloOoMrIuG;lGry;ly;igHuG;sh;htB;en;a7mb,o7rrGth0un8;ow;ck;ar,lHnefCtrG;ay;ie3ong;ng,se;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waC;acIeHra5;ct;m0Fnd;h,k;k,sG;eIiHocia9uG;me;gn,st;mb6rt;le;chHgGri3;ue;!i3;eaJlIroG;aDve;ch;aud,y;l,r;noun8sw0tG;icipa9;ce;lHt0;er;e4ow;ee;rd;aRdIju7mCoR;it;st;!reA;ss;cJhie3knowled4tiva9;te;ge;ve;eIouEu1;se;nt;pt;on",Unit:"true0:19;a14b12c0Od0Ne0Lf0Gg0Ch09in0Hjoule0k02l00mNnMoLpIqHsqCt7volts,w6y4z321;g,s;c,f,n;b,e2;a0Nb,d0Dears old,o1;tt0H;att0b;able4b3d,e2on1sp;!ne0;a2r0D;!l,sp;spo04; ft,uare 1;c0Id0Hf3i0Fkilo0Jm1ya0E;e0Mil1;e0li0H;eet0o0D;t,uart0;ascals,e2i1ou0Pt;c0Mnt0;rcent,t02;hms,uYz;an0JewtT;/s,b,e9g,i3l,m2p1,;h,s;!;!/h,cro5l1;e1li08;! pFs1;! 1;anEpD;g06s0B;gQter1;! 2s1;! 1;per second;b,i00m,u1x;men0x0;b,elvin0g,ilo2m1nR;!/h,ph,;byZgXmeter1;! p2s1;! p1;er1; hour;e1g,r0z;ct1rtz0;aXogQ;al2b,igAra1;in0m0;!l1;on0;a4emtPl2t1;,; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!,;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s",Organization:"true0:46;a3Ab2Qc2Ad21e1Xf1Tg1Lh1Gi1Dj19k17l13m0Sn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0Xou1w0X;gov,tu2S;a3e1orld trade organizati41;lls fargo,st1;fie22inghou16;l1rner br3D;-m11gree31l street journ25m11;an halNeriz3Wisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Rps;es35i1;lev2Xted natio2Uv; mobi2Kaco bePd bMeAgi frida9h3im horto2Tmz,o1witt2W;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen33daily ma2Xguess w2holli0rolling st1Ms1w2;mashing pumpki2Ouprem0;ho;ea1lack eyed pe3Fyrds;ch bo1tl0;ys;l2s1;co,la m12;efoni07us;a6e4ieme2Gnp,o2pice gir5ta1ubaru;rbucks,to2N;ny,undgard1;en;a2Rx pisto1;ls;few25insbu26msu1X;.e.m.,adiohead,b6e3oyal 1yan2X;b1dutch she4;ank;/max,aders dige1Ed 1vl32;bu1c1Uhot chili peppe2Klobst28;ll;c,s;ant2Vizno2F;an5bs,e3fiz24hilip morrBi2r1;emier27octer & gamb1Rudenti14;nk floyd,zza hut;psi28tro1uge08;br2Qchina,n2Q; 2ason1Xda2G;ld navy,pec,range juli2xf1;am;us;a9b8e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0K;l,s;c,st1Etflix,w1; 1sweek;kids on the block,york08;a,c;nd1Us2t1;ional aca2Fo,we0Q;a,cYd0O;aAcdonald9e5i3lb,o1tv,yspace;b1Nnsanto,ody blu0t1;ley crue,or0O;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;'s,s;c's milk,tt13z1Y;'ore09a3e1g,ittle caesa1Ktd;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1K;art;iffy lu0Lo3pmorgan1sa;! cha1;se;hnson & johns1Sy d1R;bm,hop,n1tv;c,g,te1;l,rpol; & m,asbro,ewlett-packaTi3o1sbc,yundai;me dep1n1J;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Iu1;cci,ns n ros0;ldman sachs,o1;dye1g0B;ar;axo smith kliZencore;electr0Im1;oto0V;a3bi,da,edex,i1leetwood mac,oGrito-l0A;at,nancial1restoV; tim0;cebook,nnie mae;b06sa,u3xxon1; m1m1;ob0H;!rosceptics;aiml0Ae5isney,o3u1;nkin donuts,po0Wran dur1;an;j,w j1;on0;a,f leppa3ll,p2r spiegZstiny's chi1;ld;eche mode,t;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra05;al;!ca c5l4m1o0Ast05;ca2p1;aq;st;dplMgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Hy;dbury,pital o1rl's jr;ne;aGbc,eCfAl6mw,ni,o2p,r1;exiteeWos;ei3mbardiJston 1;glo1pizza;be;ng;ack & deckFo2ue c1;roX;ckbuster video,omingda1;le; g1g1;oodriN;cht3e ge0n & jer2rkshire hathaw1;ay;ryH;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bXcSdidRerosmith,ig,lLmFnheuser-busEol,ppleAr7s3t&t,v2y1;er;is,on;hland2s1;n,ociated F; o1;il;by4g2m1;co;os; compu2bee1;'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c",Demonym:"true0:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an",Possessive:"trueanyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne",Currency:"true$,aud,bScQdLeurKfJgbp,hkd,iIjpy,kGlEp8r7s3usd,x2y1z0,,,,,,,,,,,;lotyS;en,uanR;af,of;h0t5;e0il5;k0q0;elM;iel,oubleLp,upeeL;e2ound st0;er0;lingI;n0soH;ceGn0;ies,y;e0i8;i,mpi7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s",City:"true0:73;1:61;2:6G;3:5U;4:5R;a68b54c4Id4Ae46f3Yg3Jh38i2Zj2Uk2Dl22m1Kn19o16p0Uq0Sr0Ls01tPuOvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3J;greb,nzib5G;ang2e5okoha3Uunfu;katerin3Jrev0;a5n0O;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1K;hi5Zkl3C;l63xford;aw;a6ern2i5ladivost5Molgogr6K;en3lni6R;lenc6Dncouv2Yr3ughn;lan bat1Drumqi,trecht;aDbilisi,eCheBi9o8r7u5;l21n63r5;in,ku;ipoli,ondh62;kyo,m34ron1QulouS;an5jua3l2Zmisoa6Era3;j4Xshui; hag65ssaloni2L;gucigal28hr0l av1W;briz,i6llinn,mpe5Ang5rtu,shk2X;i2Msh0;an,chu1n0p2Iyu0;aEeDh8kopje,owe1It7u5ydney;ra5zh51;ba0Jt;aten is59ockholm,rasbou6Auttga31;an8e6i5;jiazhua1llo1m60y0;f54n5;ya1zh4L;gh3Ot4U;att4Ao1Yv49;cramen18int DlBn5o paulo,ppo3Wrajevo; 7aa,t5;a 5ia3Io domin3I;a3fe,m1O;antonCdie3Gfrancisco,j5ped3Ssalv8;o5u0;se;em,v5z2B;ad0I;lou59peters29;aAe9i7o5;me,sar5t5A;io;ga,o5yadh;! de janei3I;cife,ykjavik;b4Uip4lei2Mnc2Swalpindi;ingdao,u5;ez2i0Q;aEeDhCiBo8r7u6yong5;ya1;eb5Aya1;ag54etor53;rt5zn0; 5la4Fo;au prin0Nelizabe29sa05;ls3Srae5Ctts2B;iladelph4Ynom pe1Doenix;r26tah tik3I;ler00naji,r4Pt5;na,r36;ak47des0Lm1Rr6s5ttawa;a3Ylo;an,d07;a8ew6i5ovosibir1Oyc;ng2Hs; 5cast39;del27orlea46taip16york;g8iro4Xn5pl2Zshv36v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0Y;aFeCi9o6u5;mb2Cni28sc40;gadishu,nt6s5;c17ul;evideo,re31;ami,l6n18s5;kolc,sissauga;an,waukee;cca,d5lbour2Pmph41;an,ell5i3;in,n;cau,drAkass2Tl9n8r5shh4A;aca6ib5rakesh,se2N;or;i1Ty;a4EchEdal12i47;mo;id;aCeiAi8o6u5vRy2;anLckn0Rdhia3;n5s angel28;d2g bea1O;brev2De3Kma5nz,sb2verpo2A;!ss29;c5pzig;est0C; p6g5ho2Yn0Gusan27;os;az,la35;aHharFiClaipeBo9rak0Hu7y5;iv,o5;to;ala lump4n5;mi1sh0;be,hi0Llka2Zpavog4si5wlo2;ce;da;ev,n5rkuk;gSsha5;sa;k5toum;iv;bIdu3llakuric0Tmpa3Gn6ohsiu1ra5un1Lwaguc0T;c0Sj;d5o,p4;ah1Vy;a7e6i5ohannesZ;l1Xn0;dd37rusalem;ip4k5;ar2J;bad0mph1QnBrkutYs8ta01z5zm7;m6tapala5;pa;ir;fah0l6tanb5;ul;am2Zi2I;che2d5;ianap2Lo21;aBe8o5yder2W; chi mi6ms,nolulu,u5;st2;nh;f6lsin5rakli2;ki;ei;ifa,lifax,m7n5rb1Dva3;gAnov5oi;er;bu2Wilt2;aFdanEenDhCiPlasgBo9raz,u5;a5jr21;dal6ng5yaquil;zh1H;aja2Lupe;ld coa18then5;bu2P;ow;ent;e0Toa;sk;lw7n5za;dhi5gt1C;nag0S;ay;aisal26es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Nl paso;in5mont2;bur5;gh;aAe8ha0Visp4o7resd0Ju5;b5esseldorf,rb0shanbe;ai,l0G;ha,nggu0rtmu11;hradRl5troit;hi;donghHe5k08li0masc1Xr es sala1HugavpiY;gu,je2;aKebu,hAo5raio03uriti1P;lo7n6penhag0Ar5;do1Nk;akLst0V;gVm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;n5ttogr12;digarh,g5;ch8sha,zh06;i9lga8mayenJn6pe town,r5;acCdiff;ber18c5;un;ry;ro;aUeMhJirmingh0ToIr9u5;chareRdapeRenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil0Mtisla7zzav5;il5;le;va;goZst2;op6ubaneshw5;ar;al;iBl9ng8r5;g6l5n;in;en;aluru,hazi;fa5grade,o horizonte;st;ji1rut;ghd0BkGnAot9r7s6yan n4;ur;el,r07;celo3ranquil09;na;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a04b01cc00ddis abaZgartaYhmedWizawl,lQmNnHqaZrEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a6chora5kaNtwerp;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 8buquerq7e5giers,maty;ppo,xandr5;ia;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Country:"true0:39;1:2M;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om3DpZqat1KrXsKtCu6v4wal3yemTz2;a25imbabwe;es,lis and futu2Y;a2enezue32ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2Y;k.,s.2; 28a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Ys and caic1U; and 2-2;toba1K;go,kel0Znga;iw2Wji2nz2S;ki2U;aCcotl1eBi8lov7o5pa2Cri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Rriname;lomon1Wmal0uth 2;afr2JkLsud2P;ak0en0;erra leoEn2;gapo1Xt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele25luc0mart20;epublic of ir0Dom2Duss0w2;an26;a3eHhilippinTitcairn1Lo2uerto riM;l1rtugE;ki2Cl3nama,pua new0Ura2;gu6;au,esti2;ne;aAe8i6or2;folk1Hth3w2;ay; k2ern mariana1C;or0N;caragua,ger2ue;!ia;p2ther19w zeal1;al;mib0u2;ru;a6exi5icro0Ao2yanm05;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagasc00l6r4urit3yot2;te;an0i15;shall0Wtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed01;a5e4i2uxembourg;b2echtenste11thu1F;er0ya;ban0Hsotho;os,tv0;azakh1Ee3iriba03o2uwait,yrgyz1E;rWsovo;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an",Region:"true0:2M;1:2S;2:2J;a2Pb2Cc1Yd1Tes1Sf1Qg1Kh1Gi1Bj17k12l0Zm0On07o05pZqWrTsKtFuCv9w5y3zacatec2T;akut0o0Du3;cat2k07;a4est 3isconsin,yomi1L;bengal,vi6;rwick2Ashington3;! dc;er4i3;rgin0;acruz,mont;dmurt0t3;ah,tar3; 2Ka0W;a5e4laxca1Qripu1Wu3;scaDva;langa1nnessee,x2E;bas0Um3smNtar24;aulip2Cil nadu;a8i6o4taf10u3ylh1E;ffYrr03s19;me1Bno1Puth 3;cVdU;ber0c3kkim,naloa;hu2ily;n4skatchew2xo3;ny; luis potosi,ta catari1;a3hode9;j3ngp06;asth2shahi;ingh24u3;e3intana roo;bec,en5reta0Q;ara7e5rince edward3unjab; i3;sl0A;i,nnsylv3rnambu0A;an0;!na;axa0Xdisha,h3klaho1Zntar3reg6ss0Ax0F;io;aIeDo5u3;evo le3nav0V;on;r3tt16va scot0;f8mandy,th3; 3ampton15;c5d4yo3;rk13;ako1M;aroli1;olk;bras1Lva0Bw3; 4foundland3;! and labrador;brunswick,hamp0Wjers3mexiRyork state;ey;galOyarit;a9eghala0Mi5o3;nta1r3;dov0elos;ch5dlanCn4ss3zor11;issippi,ouri;as geraOneso18;ig2oac2;dhy12harasht0Gine,ni4r3ssachusetts;anhao,i el,ylF;p3toba;ur;anca0Ie3incoln0IouisH;e3iR;ds;a5e4h3omi;aka06ul1;ntucky,ra01;bardino,lmyk0ns0Qr3;achay,el0nata0X;alis5har3iangxi;kh3;and;co;daho,llino6n3owa;d4gush3;et0;ia1;is;a5ert4i3un2;dalFm0D;fordZ;mpYrya1waii;ansu,eorg0lou7oa,u3;an4erre3izhou,jarat;ro;ajuato,gdo3;ng;cesterS;lori3uji2;da;sex;ageTe6o4uran3;go;rs3;et;lawaLrbyK;aEeaDh8o3rimea ,umbr0;ahui6l5nnectic4rsi3ventry;ca;ut;i02orado;la;e4hattisgarh,i3uvash0;apQhuahua;chn4rke3;ss0;ya;ra;lFm3;bridge6peche;a8ihar,r7u3;ck3ryat0;ingham3;shi3;re;emen,itish columb0;h0ja cal7lk6s3v6;hkorto3que;st2;an;ar0;iforn0;ia;dygea,guascalientes,lAndhr8r4ss3;am;izo1kans4un3;achal 6;as;na;a 3;pradesh;a5ber4t3;ai;ta;ba4s3;ka;ma",Place:"truea0Eb0Bc04d03e02f00gVhUiRjfk,kOlMmJneGoFpBque,rd,s9t6u5v4w1y0;akutOyz;ake isFis1y0;!o;!c;a,ostok,t;laanbaatar,p02safa,t;ahiti,e1he 0;bronx,hamptons;nn,x;a0fo,oho,t,under7yd;khalNsk;a2e1h0itcairn;l,x;k,nnN;!cif04;kla,nt,rd;b1w eng0;land;!r;a1co,i0t,uc;dNnn;gadZlibu,nhattZ;a0gw,hr;s,x;an1osrae,rasnoyar0ul;sk;!s;a1cn,da,nd0st;ianRochina;!x;arlem,kg,nd,oHwy;a3re0;at 0enwich;brita0lakH;in;!y village;co,l0ra;!a;urope,vergladC;ak,en,fw,ist,own4xb;al5dg,gk,h2l1o0rA;lo,nn;!t;a1ina0uuk;town;morro,tham;!if;cn,e1kk,l0rooklyn;vd;l air,verly hills;frica,lta,m7n3r2sia,tl1ve,zor0;es;!ant2;ct1iz;adyr,tarct0;ic0; oce0;an;ericas,s",MaleName:"true0:E4;1:D5;2:DN;3:AX;4:D1;5:CF;6:B5;7:CV;8:C7;9:DJ;A:DK;B:A5;C:C1;aCNbBKcAId9Ge8Mf84g7Hh6Ti6Dj5Dk51l4Cm34n2So2Mp2Equ2Cr1Ls11t0Eu0Dv07wTxSyIzD;aDor0;cDh9Skaria,n5V;hEkD;!aCL;ar5VeCK;aLoFuD;sDu2JvBX;if,uf;nFsEusD;ouf,sD;ef;aDg;s,tD;an,h0;hli,nBLssX;avi3ho4;aMeKiFoDyaC1;jcie8Blfgang,odrow,utD;!er;lDnst1;bFey,frD0lD;aBCiD;am,e,s;e9Eur;i,nde6sD;!l8t1;de,lErrAyD;l1ne;lDt3;aA9y;aGiDladimir,ojte7Y;cEha0kt68nceDrgAIva0;!nt;e3Ut66;lentDnA4;in4X;ghBUlyss5Bnax,sm0;aXeShOiMoHrFuEyD;!l3ro7s1;n9r5B;avAVeDist0oy,um0;ntANv5Yy;bGdFmDny;!as,mDoharu;aCSie,y;!d;iBy;mDt5;!my,othy;adFeoEia8FomD;!as;!do8O;!de5;dGrD;en9KrD;an9JeDy;ll,n9I;!dy;dgh,ha,iDnn3req,tsu4S;cB4ka;aTcotRePhLiJoHpenc3tDur1Uylve9Jzym1;anFeDua8C;f0phBSvDwa8B;e61ie;!islaw,l8;lom1nBEuD;leyma7ta;dDlBm1yabonga;!dhart7An8;aFeD;lDrm0;d1t1;h7Tne,qu0Zun,wn,y7;aDbasti0k29l4Qrg4Nth,ymoAT;m5n;!tD;!ie,y;lEmDnti2Dq5Aul;!ke5LmCu4;ik,vato7W;aXeTheA9iPoHuEyD;an,ou;b7MdEf5pe7RssD;!elBY;ol3Ey;an,bJc66dIel,geHh0landBPmGnFry,sEyD;!ce;coe,s;!aAGnC;an,eo;l46r;e5Ng3n8olfo,ri79;bCeB7;cDl8;ar6Pc6OhEkDo;!ey,ie,y;a99ie;gEid,ubAx,yDza;an1InY;gA8iD;naA4s;ch70fa4lHmGndFpha4sEul,wi2HyD;an,mo82;h7Vm5;alBDol2Uy;iATon;f,ph;ent2inD;cy,t1;aIeGhilFier72ol,rD;aka16eD;m,st1;!ip,lip;dALrcy,tD;ar,e3Gr1X;b4Kdra7Ft4ZulD;!o17;ctav3Fi3liv3mAFndrej,rHsEtDum9wA;is,to;aEc9k9m0vD;al5Z;ma;i,l53vL;aLeJiFoDu3A;aDel,j5l0ma0r3K;h,m;cEg4i49kD;!au,h7Uola;holBkDolB;!olB;al,d,il,ls1vD;il8Y;hom,thD;anDy;!a4i4;aZeWiMoHuEyD;l2Jr1;hamEr6XstaD;fa,p5C;ed,mH;di0We,hamFis2FntEsDussa;es,he;e,y;ad,ed,mD;ad,ed;cIgu4hai,kGlFnEtchD;!e6;a8Aik;house,o0Bt1;ae5YeA4olD;aj;ah,hDk8;aEeD;al,l;el,l;hElv2rD;le,ri6v2;di,met;ay0ck,hTjd,ks2DlRmadWnQrKs1tFuricExD;!imilian9Nwe6;e,io;eGhEiBtDus,yB;!eo,hew,ia;eDis;us,w;j,o;cHio,kGlFqu7Dsha6tDv2;iDy;!m,n;in,on;!el,oPus;!el9IoOus;iGu4;achDcolm,ik;ai,y;amEdi,eDmoud;sh;adDm5T;ou;aXeQiOlo3EoKuEyD;le,nd1;cGiFkDth3uk;aDe;!s;gi,s,z;as,iaD;no;g0nn7SrenFuDv8Jwe6;!iD;e,s;!zo;am,oD;n4r;a8Cevi,la5JnIoGst3thaFvD;eDi;nte;bo;!nD;!a6Sel;!ny;mFnErDur5Hwr5H;ry,s;ce,d1;ar,o5A;aLeGhaled,iDrist5Iu4Vy6X;er0p,rD;by,k,ollD;os;en0iGnDrmit,v44;!dEnDt5Z;e1Ay;a6ri59;r,th;cp3j5m66na73rEsp9them,uD;ri;im,l;a02eUiSoGuD;an,lDst2;en,iD;an,en,o,us;aNeLhnKkubBnIrGsD;eEhDi8Bue;!ua;!ph;dDge;an,i,on;!aDny;h,s,th5I;!ath5Hie,nC;!l,sDy;ph;o,qu2;an,mD;!mC;d,ffIrFsD;sDus;!e;a6BemEmai7oDry;me,ni0Y;i7Ty;!e60rD;ey,y;cKdAkImHrFsEvi3yD;!dAs1;on,p3;ed,od,rDv56;e5Nod;al,es4Xis1;a,e,oDub;b,v;k,ob,quD;es;aWbQchiPgNkeMlija,nuLonut,rJsFtDv0;ai,suD;ki;aEha0i7DmaDsac;el,il;ac,iaD;h,s;a,vinDw2;!g;k,nngu5S;!r;nacDor;io;ka;ai,rahD;im;aPeJoIuDyd9;be2KgGmber4WsD;eyEsD;a2e2;in,n;h,o;m3ra3Gsse2wa4B;aHctGitGnrErD;be2Dm0;iDy;!q11;or;th;bMlLmza,nKo,rFsEyD;a4JdA;an,s0;lGo50rFuDv8;hi4Gki,tD;a,o;is1y;an,ey;k,s;!im;ib;aVeRiPlenOoLrHuD;ilEsD;!tavo;herme,lerD;mo;aFegDov3;!g,orD;io,y;dy,h5Wnt;nzaErD;an,d1;lo;!n;lbe5Ano,oD;rg3Hvan5A;ne,oFrD;aDry;ld,rd5H;ffr8rge;brElArDv2;la28r3Sth,y;e3EielD;!i5;aTePiNlLorr0NrD;anFedDitz;!dCeDri2B;ri2A;cFkD;!ie,lD;in,yn;esLisD;!co,z36;etch3oD;yd;d4lDnn,onn;ip;deriFliEng,rnD;an06;pe,x;co;bi0di,hd;ar04dZfrYit0lSmKnHo2rFsteb0th0uge7vDymAzra;an,eD;ns,re36;gi,i0DnDrol,v2w2;est4Pie;oEriqDzo;ue;ch;aJerIiEmD;aIe2Z;lErD;!h0;!iD;o,s;s1y;nu4;be0Cd1iGliFmEt1viDwood;n,s;er,o;ot1Ys;!as,j4NsD;ha;a2en;!dCg9mGoEuEwD;a2Din;arD;do;o0Wu0W;l,nD;est;a01eRiOoHrGuFwEylD;an,l0;ay7ight;a7dl8nc0st2;ag0ew;minGnEri0ugDvydBy2D;!lB;!a2MnDov0;e6ie,y;go,iDykB;cDk;!k;armuEeDll1on,rk;go;id;anKj0lbeJmetri5nHon,rGsFvEwDxt3;ay7ey;en,in;hawn,mo0B;ek,ri0I;is,nDv3;is,y;rt;!dD;re;an,lNmLnKrGvD;e,iD;! lucDd;as,ca;en,iFne6rDyl;eDin,yl;l3Bn;n,o,us;!e,i4ny;iDon;an,en,on;e,lB;as;a09e07hYiar0lNoIrGuEyrD;il,us;rtD;!is;aDistob0U;ig;dy,lGnErD;ey,neli5y;or,rD;ad;by,e,in,l2t1;aIeFiDyK;fDnt;fo0Ft1;meEt5velaD;nd;nt;rFuEyD;!t1;de;enD;ce;aIeGrisEuD;ck;!tD;i0oph3;st3;er;d,rDs;b4leD;s,y;cDdric,s9;il;lGmer1rD;ey,lEro6y;ll;!os,t1;eb,v2;a07eZiVlaUoRrEuDyr1;ddy,rtK;aLeGiFuEyD;an,ce,on;ce,no;an,ce;nEtD;!t;dEtD;!on;an,on;dEndD;en,on;!foDl8y;rd;bErDyd;is;!by;i7ke;bFlEshD;al;al,lC;ek;nHrDshoi;at,nEtD;!r1C;aDie;rd14;!edict,iEjam2nC;ie,y;to;kaMlazs,nHrD;n8rDt;eDy;tt;ey;dDeE;ar,iD;le;ar17b0Vd0Rf0Pgust2hm0Mi0Jja0Il04m00nSputsiRrIsaHuFveEyDziz;a0kh0;ry;gust5st2;us;hi;aKchJiIjun,maHnFon,tDy0;hDu09;ur;av,oD;ld;an,nd0H;!el,ki;ie;ta;aq;as,dIgel0CtD;hoGoD;i7nD;!i09y;ne;ny;er,reDy;!as,i,s,w;iFmaDos;nu4r;el;ne,r,t;an,bePdAeJfHi,lGonFphXt1vD;aNin;on;so,zo;an,en;onTrD;edU;c,jaGksandFssaGxD;!andD;er,ru;ar,er;ndD;ro;rtN;ni;dAm9;ar;en;ad,eD;d,t;in;onD;so;aEi,olfDri0vik;!o;mDn;!a;dHeGraEuD;!bakr,lfazl;hDm;am;!l;allIelFoulaye,ulD;!lDrF;ah,o;! rD;ahm0;an;ah;av,on",LastName:"true0:9F;1:9V;2:9H;3:9X;4:9N;5:8J;6:9K;7:A0;8:9E;9:88;A:6E;B:77;C:6J;a9Ub8Lc7Kd6Xe6Rf6Dg5Vh58i54j4Pk45l3Nm2Rn2Eo26p1Nquispe,r17s0Ft05vVwOxNyGzD;aytsADhD;aDou,u;ng,o;aGeun7ZiDoshiA9un;!lD;diDmaz;rim,z;maDng;da,guc97mo6UsDzaB;aBhiA7;iao,u;aHeGiEoDright,u;jc8Sng;lDmm0nkl0sniewsB;liA1s3;b0iss,lt0;a5Rgn0lDng,tanabe;k0sh;aHeGiEoDukA;lk5roby5;dAllalDnogr2Zr0Zss0val37;ba,obos;lasEsel7N;lGn dFrg8EsEzD;qu7;ily9Oqu7silj9O;en b35ijk,yk;enzue95verde;aLeix1JhHi4j6ka3IoGrFsui,uD;om4ZrD;c4n0un1;an,embl8TynisB;dor95lst31m2rr9th;at5Mi7LoD;mErD;are6Ylaci64;ps3s0Y;hirAkah8Dnaka;a00chWeThPiNmKoItFuEvDzabo;en8Aobod34;ar7bot2lliv4zuB;aEein0oD;i67j3Lyan8V;l6rm0;kol5lovy5re6Psa,to,uD;ng,sa;iDy5Z;rn5tD;!h;l5YmDngh,rbu;mo6Do6J;aFeDimizu;hu,vchD;en7Cuk;la,r17;gu8mDoh,pulve8Trra4R;jDyD;on5;evi6Filtz,miDneid0roed0ulz,warz;dEtD;!z;!t;ar42h6ito,lFnDr2saBto,v2;ch7d0AtDz;a4Pe,os;as,ihAm3Zo0Q;aOeNiKoGuEyD;a66oo,u;bio,iz,sD;so,u;bEc7Bdrigue57g03j73mDosevelt,ssi,ta7Nux,w3Z;a4Be0O;ertsDins3;!on;bei0LcEes,vDzzo;as,e8;ci,hards3;ag4es,it0ut0y9;dFmEnDsmu7Zv5F;tan1;ir7os;ic,u;aSeLhJiGoErDut6;asad,if5Zochazk1W;lishc24pDrti62u55we66;e2Tov48;cEe09nD;as,to;as60hl0;aDillips;k,m,n5K;de3AetIna,rGtD;ersErovDtersC;!a,ic;en,on;eDic,ry,ss3;i8ra,tz,z;ers;h71k,rk0tEvD;ic,l3T;el,t2O;bJconnor,g2ClGnei5PrEzD;demir,turk;ella3MtDwe5N;ega,iz;iDof6GsC;vDyn1F;ei8;aPri1;aLeJguy1iFoDune44ym4;rodahl,vDwak;ak3Uik5otn56;eEkolDlsCx3;ic,ov6X;ls1miD;!n1;ils3mD;co42ec;gy,kaEray4varD;ro;jiDmu8shiD;ma;aXcVeQiPoIuD;lGnFrDssoli5T;atDpUr68;i,ov2;oz,te4B;d0l0;h4lIo0HrEsDza0Z;er,s;aFeEiDoz5r3Ete4B;!n6F;au,i8no,t4M;!l9;i2Rl0;crac5Ohhail5kke3Qll0;hmeGij0j2ElFndErci0ssiDyer19;!er;e3Bo2Z;n0Io;dAti;cartDlaughl6;hy;dMe6Dgnu5Ei0jer34kLmJnci59rFtEyD;er,r;ei,ic,su1N;iEkAqu9roqu6tinD;ez,s;a54c,nD;!o;a52mD;ad5;e5Oin1;rig4Ns1;aSeMiIoGuEyD;!nch;k2nDo;d,gu;mbarDpe2Rvr2;di;!nDu,yana1R;coln,dD;bDholm;erg;bed5TfeGhtFitn0kaEn6rDw2G;oy;!j;in1on1;bvDvD;re;iDmmy,rsCu,voie;ne,t11;aTennedy,h4iSlQnez46oJrGuEvar4woD;k,n;cerDmar58znets5;a,o2G;aDem0i2Zyeziu;sni3PvD;ch3U;bay4Frh0Jsk0TvaFwalDzl5;czDsB;yk;cFlD;!cDen3Q;huk;!ev2ic,s;e6uiveD;rt;eff0l2mu8nnun1;hn,lloe,minsBrEstra31to,ur,yDzl5;a,s0;j0GlsC;aMenLha2Pim0QoEuD;ng,r2;e2JhFnErge2Ju2NvD;anA;es,ss3;anEnsD;en,on,t3;nesDsC;en,s1;ki26s1;cGkob3RnsDrv06;en,sD;enDon;!s;ks3obs1;brahimAglesi3Ake4Ll0CnoZoneFshikEto,vanoD;u,v4A;awa;scu;aPeIitchcock,jaltal6oFrist46uD;!aDb0gh9ynh;m4ng;a23dz2fEjga2Sk,rDx3B;ak0Yvat;er,fm3B;iGmingw3NnErD;nand7re8;dDriks1;ers3;kkiEnD;on1;la,n1;dz2g1lvoLmJnsCqIrr0SsFuEyD;as36es;g1ng;anEhiD;mo0Q;i,ov08;ue;alaD;in1;rs1;aMeorgLheorghe,iJjonIoGrEuDw3;o,staf2Utierr7zm4;ayDg2iffitUub0;li1G;lub3Rme0JnD;calv9zale0I;aj,i;l,mDordaL;en7;iev3B;gnJlGmaFnd2No,rDs2Nuthi0;cDza;ia;ge;eaElD;agh0i,o;no;e,on;ab0erMiIjeldsted,lor9oGrFuD;cDent9ji3F;hs;an1Wiedm4;ntaDrt6st0urni0;na;lipEsD;ch0;ovD;!ic;hatAnandeVrD;arDei8;a,i;ov2;dHinste6riksCsDva0D;cob2ZpDtra2X;inoDosiM;za;en,s3;er,is3wards;aUeMiKjurhuJoHrisco0YuEvorakD;!oQ;arte,boEmitru,rDt2U;and,ic;is;g4he0Hmingu7n2Ord19tD;to;us;aDmitr29ssanayake;s,z; GbnaFlEmirDrvis1Lvi,w4;!ov2;gado,ic;th;bo0groot,jo03lEsilDvri9;va;a cruz,e3uD;ca;hl,mcevsBnErw6t2EviD;d5es,s;ieDku1S;ls1;ki;a05e00hNiobMlarkLoFrD;ivDuz;elli;h1lGntFop0rDs26x;byn,reD;a,ia;i,rer0O;em4liD;ns;!e;anu;aLeIiu,oGriDuJwe;stD;eDiaD;ns1;i,ng,uFwDy;!dhury;!n,onEuD;ng;!g;kEnDtterjee,v7;!d,g;ma,raboD;rty;bGl09ng2rD;eghetEnD;a,y;ti;an,ota0M;cer9lder3mpbeIrFstDvadi08;iDro;llo;doEt0uDvalho;so;so,zo;ll;es;a09eXhUiSlNoGrFyD;rne,tyD;qi;ank5iem,ooks,yant;gdan5nFruya,su,uchEyHziD;c,n5;ard;darDik;enD;ko;ov;aEondD;al;nEzD;ev2;co;ancRshwD;as;a01oDuiy4;umDwmD;ik;ckNethov1gu,ktLnJrD;gGisFnD;ascoDds1;ni;ha;er,mD;ann;gtDit7nett;ss3;asD;hi;er,ham;b2ch,ez,hMiley,kk0nHrDu0;bEnDua;es,i0;ieDosa;ri;dDik;a8yopadhyD;ay;ra;er;k,ng;ic;cosZdYguilXkhtXlSnJrGsl4yD;aEd6;in;la;aEsl4;an;ujo,ya;dFgelD;ovD;!a;ersGov,reD;aDjL;ss1;en;en,on,s3;on;eksejGiyGmeiFvD;ar7es;ez;da;ev;ar;ams;ta",WeekDay:"truefri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"trueaBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il",Date:"trueago,t2week0yesterd4; e0e0;nd;mr2o0;d0morrow;ay;!w",FirstName:"trueaLblair,cHdevGgabrieFhinaEjCk9l8m4nelly,quinn,re3s0;h0umit;ay,e0iloh;a,lby;g6ne;a1el0ina,org5;!okuh9;naia,r0;ion,lo;ashawn,uca;asCe1ir0rE;an;lsAnyat2rry;am0ess6ie,ude;ie,m5;ta;le;an,on;as2h0;arl0eyenne;ie;ey,sidy;lex2ndr1ubr0;ey;a,ea;is",Person:"trueashton kutchTbScNdLeJgastOhHinez,jFkEleDmCnettKoBp9r4s3t2v0;a0irgin maH;lentino rossi,n go3;aylor,heresa may,iger woods,yra banks;addam hussain,carlett johanssKlobodan milosevic,uC;ay romano,e3o1ush limbau0;gh;d stewart,nald0;inho,o;ese witherspoFilly;a0ipJ;lmIris hiltD;prah winfrFra;essiaen,itt romnEubarek;bron james,e;anye west,iefer sutherland,obe bryant;aime,effers8k rowli0;ng;alle ber0itlBulk hogan;ry;ff0meril lagasse,zekiel;ie;a0enzel washingt2ick wolf;lt1nte;ar1lint0;on;dinal wols1son0;! palm2;ey;arack obama,rock;er",Verb:"trueawak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en",PhrasalVerb:"true0:7L;1:79;2:7X;3:7N;4:72;5:80;6:7P;7:6V;8:78;9:7J;A:6W;B:5Z;C:7S;D:7K;a81b6Lc5Rd5Me5Lf4Kg41h3Kiron0j3Gk3Bl2Vm2Jn2Ho2Fp1Wquiet7Ar1Js0CtSuQvacuum 1wHyammer9zE;eroBip FonE;e0k0;by,up;aLeHhGiForErit5G;d 1k33;mp0n2Vpe0r7s7;eel Dip 85;aFiEn2J;gh 09rd0;n Dr E;d2in,o5J;it 61k7lk6rm 6Csh 7Nt6Qv51;rge9sE;e AherB;aTeRhPiLoJrGuEype 69;ckBrn E;d2in,o3Sup;aFiEot0y 2I;ckle6Rp 7T;ck6Qde Y;ne6Pp Es4O;d2o73up;ck GdFe Egh6Bme0p o0Gre0;aw3ba4d2in,up;e 61y 1;by,o7D;ink Erow 6D;ba4ov8up;aEe 5Zll53;m 1r X;ck9ke Flk E;ov8u54;aEba4d2in,o3Cup;ba4ft8p59w3;a0Jc0Ie0Ch08i05l01m00nZoYpTquare StKuIwE;earGiE;ngFtch E;aw3ba4o77; by;ck Eit 1m 1ss0;in,up;aJe0WiIoGrEuc3G;aigh1WiE;ke 6Gn3A;p Erm1Z;by,in,o6T;n3Br 1tc3T;c3Amp0nd Er6Zve6y 1;ba4d2up;d2o6Pup;ar37eHiGlFrEur9;ing9uc7;a3Fit 5B;l13n 1;e5Sll0;be2Wrt0;ap 4Sow D;ash 5Foke0;eep FiEow A;c3Wp 1;in,oE;ff,v8;gn 4XngFt Ez7;d2o5up; al54le0;aGoEu4T;ot Eut0w 6D;aw3ba4f3Go67;c2PdeBk58ve6;e Ill1And HtE; Etl4H;d2in,o5upE;!on;aw3ba4d2in,o27up;o5Mto;al51out0rap51;il6v7;aPeMiLoHuE;b 4Ule0n Estl7;aEba4d2in5Jo3Ut39u3S;c26w3;ll Got FuE;g2Tnd6;a27f30o5;arCin,o5;ng 53p6;aEel6inBnt0;c5Dd E;o31u0I;c24t0;aSeRiPlNoLrIsyc2HuE;ll Gt E;aEba4d2in,o1Ot3Gup;p3Lw3;ap3Kd2in,o5t3Eup;attle9ess FiHoE;p 1;ah1Oon;iEp 5Hr3Yur4Jwer 5H;nt0;ay4DuE;gBmp A;ck Eg0le9n Ap4A;o2Yup;el 4KncilB;c42ir 3Un0ss GtFy E;ba4o54; d2c24;aw3ba4o18;pEw3X;e3Wt D;arrow46erd0oE;d6te45;aMeJiIoGuE;ddl7lE;l 3I;c1Dp 1uth6ve E;al3Nd2in,o5up;ss0x 1;asur7lFss E;a1Gup;t A;ke Fn ArEs1Px0;k Ary6;do,o48up;aRePiKoEuck0;aIc3Hg HoEse0;k Ese3F;aft8ba4d2forw2Jin46ov8uE;nd8p;in,o0M;d A;e HghtGnFsEv1V;ten 4M;e 1k 1; 1e37;arCd2;av1Jt 37velE; o3U;c7p 1sh Etch9ugh6y20;in3Uo5;eFick6nock E;d2o3Q;eEyB;l 2Pp E;aw3ba4d2fTin,o07to,up;aGoFuE;ic7mpB;ke31t35;c3Azz 1;aQeLiIoFuE;nker32rry 1s0W;lEneBrse2X;d Ee 1;ba4d2fast,o01up;de Ft E;ba4on,up;aw3o5;aElp0;d Gl 2Ar Et 1;fEof;rom;in,oTu1H;c02m 1nFve Ez25;it,to;d Eg 2FkerG;d2in,o5;aTeMive Kloss 22oGrFunE; f0N;in3How 2B; Eof 21;aFb1Dit,oErCt0Pu18;ff,n,v8;bo5ft8hKw3;aw3ba4d2in,oEup,w3;ff,n,ut;aJek0t E;aFb17d2oErCup;ff,n,ut,v8;cFhEl1XrCt,w3;ead;ross;r 1;d aFnE;g 1;bo5;a08e01iSlOoKrGuE;cEel 1;k 1;eFighten Eown9y 1;aw3o2S;eEshe1N; 1z7;lGol E;aEwi1G;bo5rC;d Alow 1;aFeEip0;sh0;g Ake0mErE;e 2R;gLlJnHrFsEzzle0;h 2P;e Em 1;aw3ba4up;d0isE;h 1;e El 19;aw3fJ;ht ba4ure0;eJnFsE;s 1;cGd E;fEo25;or;e D;dVl 1;cIll Erm0t0W;ap04bGd2in,oFtE;hrough;ff,ut,v8;a4ehi20;e 0L;at0dge0nd 0Ky7;oHrE;aFess Aop E;aw3bUin,o1E;g9w9; 0Dubl7;aXhUlean AoHrEut 10;ack9eep Eoss D;by,d2oEup;n,ut;me HoFuntE; o1Q;k 1l E;d2o1I;aKbJforHin,oGtFuE;nd8;ogeth8;ut,v8;th,wE;ard;a4y;pErCw3;art;eEipB;ck Der E;on,up;lKncel0rHsGtch FveB; in;o19up;h Dt6;ry FvE;e Y;aw3o15;l Em05;aEba4d2o13up;rCw3;a0Ke0Bl04oVrJuE;bblGcklWil02lk AndlWrn 08st FtEy 13zz6;t D;in,o5up;e E;ov8;anOeaMiFush E;o0Oup;ghIng E;aFba4d2forEin,o5up;th;bo5lErCw3;ong;teE;n 1;k E;d2in,o5up;ch0;arLgKil An7oHssGttlFunce Ex D;aw3ba4;e A; arC;k Dt 1;e 1;d2up; d2;d 1;aJeed0oEurt0;cGw E;aw3ba4d2o5up;ck;k E;in,oL;ck0nk0st6; oKaHef 1nd E;d2ov8up;er;up;r0t E;d2in,oEup;ff,ut;ff,nE;to;ck Kil0nGrgFsE;h D;ain9e D;g Dk9; on;in,o5; o5;aw3d2o5up;ay;cNdJsk Guction6; oE;ff;arCo5;ouE;nd;d E;d2oEup;ff,n;own;t E;o5up;ut",Modal:"truec5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ay,ight,ust;an,o0;uld",Adjective:"true0:7P;1:84;2:83;3:8A;4:7W;5:5S;6:4N;7:4O;8:58;9:6I;A:81;a6Wb6Gc63d5Je54f4Hg49h3Wi39j37k36l2Vm2Ln2Bo1Wp1Dquack,r12s0Ft07uMvJwByear5;arp0eFholeEiDoB;man5oBu6P;d6Rzy;despr7Ls5S;!sa7;eClBste2A;co1Nl o4W;!k5;aCiBola4M;b89ce versa,ol5H;ca3gabo6Gnilla;ltUnHpCrb5Msu4tterB;!mo7G; Eb1SpDsBti1M;ca7etBide dKtairs;!ti2;er,i3U;f36to da1;aLbeco75convin29deIeHfair,ivers4knGprecedVrEsCwB;iel3Nritt6A;i1XuB;pervis0spec3Y;eBu5;cognHgul6Tl6T;own;ndi2v64xpect0;cid0rB;!grou5ZsB;iz0tood;b7pp0Dssu6UuthorB;iz0;i26ra;aGeEhDi6AoCrB;i1oubl0us3M;geth8p,rp6Vuc67;ough4Wril33;en60l32mpBrr2X;o6Ati2;boo,lBn;ent0;aWcVeThSiQmug,nobbi3LoOpNqueami3LtFuBymb6H;bDi gener5DpBrpri6D;erBre0N;! dup8b,i2C;du0seq52;anda77eGiFrBunni2y3F;aightCiB;ki2p0; fBfB;or5K;ll,r5S;aBreotyp0;dfa6Cmi2;a55ec2Gir1Hlend6Cot on; call0le,mb8phist1XrBu0Vvi48;d6Ary;gnifica3nB;ce51g7;am2Re8ocki2ut;cBda1em5lfi32ni1Wpa6Jre6;o1Er42;at5Gient28reec5G;cr0me;aJeEiCoB;bu60tt51uQy4;ghtBv4;!-2Bf9;ar,bel,condi1du6Dfres5AlEpublic42sCtard0vB;ea26;is4CoB;lu1na3;aQe1Cuc4A;b5TciBllyi2;al,st;aOeLicayu6lac5Ropuli5QrCuB;bl5Jmp0n51;eGiDoB;!b07fu5RmiBp8;ne3si2;mCor,sBva1;ti6;a53e;ci5MmB;a0EiB;er,um;ac20rBti1;feAma2XpleBv38;xi2;rBst;allelDtB;-tiBi4;me;!ed;bLffJkIld fashion0nHpGrg1Eth8utFvB;al,erB;!all,niCt,wB;eiBrouB;ght;do0Ter,g2Qsi4B;en,posi1; boa5Og2Oli6;!ay; gua5MbBli6;eat;eDsB;cBer0Eole1;e6u3O;d2Xse;aJeIiHoBua4X;nFrCtB;ab7;thB;!eB;rn;chala3descri58stop;ght5;arby,cessa44ighbor5xt;k0usia1A;aIeGiDoBultip7;bi7derBl0Vnth5ot,st;a1n;nBx0;dblo0RiaBor;tu37;ande3Qdi4NnaBre;ci2;cBgenta,in,j01keshift,le,mmoth,ny,sculi6;ab33ho;aKeFiCoBu15;uti14vi2;mCteraB;l,te;it0;ftEgBth4;al,eCitiB;ma1;nda3K;!-0C;ngu3Zst,tt8;ap1Xind5no0A;agg0uB;niMstifi0veni7;de4gno4Klleg4mQnEpso 20rB;a1rB;eleBita0J;va3; KaJbr0corIdGfluenQiQnFsEtCviB;go0Fti2;aAen3SoxB;ic3B;a6i2Vul0D;a1er,oce3;iCoB;or;reA;deq3Qppr33;fBsitu,vitro;ro3;mFpB;arDerfeAoBrop8;li1rtB;a3ed;ti4;eBi0S;d2Vn3C;aIeFiDoBumdr3I;ne36ok0rrBs08ur5;if2Z;ghfalut1QspB;an2X;aClB;liYpf9;li2;lEnDrB;d04roB;wi2;dy;f,low0;ainf9ener2Oiga24lHoGraDuB;ilBng ho;ty;cCtB;ef9is;ef9;ne,od;ea2Iob4;aTeNinMlKoFrB;a1VeDoz1MustB;raB;ti2;e2Gq10tf9;oDrB; keeps,eBm8tuna1;g03ign;liB;sh;aBue3;g31tte1P;al,i1;dFmCrB;ti7;a7ini6;ne;le; up;bl0i3l27r Cux,voB;ri1uri1;oBreac1E;ff;aLfficie3lKmHnFreAthere4veExB;aAcess,pe1QtraCuB;be2Nl0E;!va1E;n,ryday; BcouraEti0O;rou1sui1;erCiB;ne3;gi2;abo23dMe17i1;g8sB;t,ygB;oi2;er;aReJiDoBrea14ue;mina3ne,ubB;le,tf9;dact1Bfficu1OsCvB;er1K;creDeas0gruntl0hone1FordCtB;a3ressM;er5;et; HadpGfFgene1PliDrang0spe1PtCvoB;ut;ail0ermin0;be1Mca1ghB;tf9;ia3;an;facto;i5magBngeroUs0G;ed,i2;ly;ertaMhief,ivil,oDrB;aBowd0u0G;mp0vZz0;loImGnCrrBve0P;eAu1I;cre1fu0LgrDsCtB;empo0Dra0E;ta3;ue3;mer08pleB;te,x;ni4ss4;in;aNeIizarHlFoCrB;and new,isk,okN;gCna fiUttom,urgeoB;is;us;ank,indB;!i2;re;autif9hiDloCnBst,yoD;eUt;v0w;nd;ul;ckCnkru0WrrB;en;!wards; priori,b0Mc0Jd09fra08g04h03lYmWntiquVppSrMsIttracti06utheHvEwB;aCkB;wa0T;ke,re;ant garCerB;age;de;ntU;leep,piDsuDtonB;isB;hi2;ri2;ab,bitEroDtiB;fiB;ci4;ga3;raB;ry;are3etiNrB;oprB;ia1;at0;aJuB;si2;arEcohCeBiIl,oof;rt;olB;ic;mi2;ead;ainDgressiConiB;zi2;ve;st;id; IeGuFvB;aCerB;se;nc0;ed;lt;pt,qB;ua1;hoc,infinitB;um;cuCtu4u1;al;ra1;erLlKoIruHsCuB;nda3;e3oCtraA;ct;lu1rbi2;ng;te;pt;aBve;rd;aze,e;ra3;nt",Comparable:"true0:41;1:4I;2:45;3:2Y;4:4B;5:3X;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Jm1Dn17o15p0Vqu0Tr0KsTtMuIvFw7y6za13;ell27ou4;aBe9hi1Yi7r6;o4y;ck0Ode,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sK;m,y;a7e6ulgar;nge5rda2xi4;g9in,st;g0n6pco3Mse5;like0t6;i1r6;ue;aAen9hi8i7ough,r6;anqu2Oen1ue;dy,g3Sme0ny,r09;ck,n,rs2P;d40se;ll,me,rt,s6wd45;te5;aVcarUeThRiQkin0FlMmKoHpGqua1FtAu7w6;eet,ift;b7dd13per0Gr6;e,re2H;sta2Ft3;aAe9iff,r7u6;pXr1;a6ict,o4;ig3Fn0U;a1ep,rn;le,rk;e22i3Fright0;ci28ft,l7o6re,ur;n,thi4;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g35m6;!y;ek,nd3D;ck,l0mp3;a6iTort,rill,y;dy,ll0Xrp;cu0Rve0Rxy;ce,ed,y;d,fe,int0l1Vv14;aBe9i8o6ude;mantic,o1Isy,u6;gh,nd;ch,pe,tzy;a6d,mo0H;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aEhoDi1QlCoBr8u6;ny,r6;e,p3;egna2ic7o6;fouYud;ey,k0;li04or,te1B;ain,easa2;ny;in5le;dd,f6i0ld,ranQ;fi10;aAe8i7o6;b3isy,rm15sy;ce,mb3;a6w;r,t;ive,rr01;aAe8ild,o7u6;nda19te;ist,o1;a6ek,llX;n,s0ty;d,tuQ;aBeAi9o6ucky;f0Un7o1Du6ve0w17y0T;d,sy;e0g;g1Tke0tt3ve0;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti4;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b3id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te5;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t3uiY;u1y;aIeeb3iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get5mG;my;erce8n6rm;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi4;gey,lm8r6;e5i4;ful;!i4;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i4;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd",TextOrdinal:"truebGeDf9hundredHmGnin7qu6s4t0zeroH;enGh1rFwe0;lfFn9;ir0ousandE;d,t4;e0ixt9;cond,ptAvent8xtA;adr9int9;et0th;e6ie8;i2o0;r0urt3;tie5;ft1rst;ight0lev1;e0h,ie2;en1;illion0;th",Cardinal:"truebHeEf8hundred,mHnineAone,qu6s4t0zero;en,h2rGw0;e0o;lve,n8;irt9ousandEree;e0ix5;pt1ven4xt1;adr0int0;illion;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illion0;!s",Expression:"truea02b01dXeVfuck,gShLlImHnGoDpBshAtsk,u7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la",Adverb:"truea08by 06d02eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,well,ye0;p,s; to,wards5;h1iny bit,o0wiO;o,t6ward;en,us;eldom,o0uch;!me1rt0; of;hYtimes,w09;a1e0;alT;ndomSthN;ar excellDer0oint blank; Nhaps;f3n0;ce0ly;! 0;ag02moW; courIten;ewKo0; longEt 0;onIwithstanding;aybe,eanwhiAore0;!ovB;! aboU;deed,steV;en0;ce;or2u0;lArther0;!moJ; 0ev3;examp0good,suH;le;n1v0;er; mas0ough;se;e0irect1; 1finite0;ly;ju8trop;far,n0;ow; DbroCd nauseam,gBl6ny3part,s2t 0w4;be6l0mo6wor6;arge,ea5; soon,ide;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori",Determiner:"trueaBboth,d9e6few,l4mu8neiDown,plenty,s3th2various,wh0;at0ich0;evC;at,e4is,ose;everal,ome;a,e0;!ast,s;a1i6l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er"},ar=function(e){const t=e.split("|").reduce(((e,t)=>{const n=t.split("");return e[n[0]]=n[1],e}),{}),n={};return Object.keys(t).forEach((function(e){const r=tr(t[e]);"true"===e&&(e=!0);for(let t=0;t<r.length;t++){const a=r[t];!0===n.hasOwnProperty(a)?!1===Array.isArray(n[a])?n[a]=[n[a],e]:n[a].push(e):n[a]=e}})),n};let nr={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",her:["Possessive","Pronoun"],his:["Possessive","Pronoun"],their:["Possessive","Pronoun"],themselves:["Possessive","Pronoun"],your:["Possessive","Pronoun"],our:["Possessive","Pronoun"],my:["Possessive","Pronoun"],its:["Possessive","Pronoun"]};const ir={Unit:(e,t)=>{e[t]=["Abbreviation","Unit"]},Cardinal:(e,t)=>{e[t]=["TextValue","Cardinal"]},TextOrdinal:(e,t)=>{e[t]=["Ordinal","TextValue"],e[t+"s"]=["TextValue","Fraction"]},Singular:(e,t,n)=>{e[t]="Singular";let r=n.transforms.toPlural(t,n);e[r]=e[r]||"Plural"},Infinitive:(e,t,n)=>{e[t]="Infinitive";let r=n.transforms.conjugate(t,n),a=Object.keys(r);for(let t=0;t<a.length;t++){let n=r[a[t]];e[n]=e[n]||a[t]}},Comparable:(e,t,n)=>{e[t]="Comparable";let r=n.transforms.adjectives(t),a=Object.keys(r);for(let t=0;t<a.length;t++){let n=r[a[t]];e[n]=e[n]||a[t]}},PhrasalVerb:(e,t,n)=>{e[t]=["PhrasalVerb","Infinitive"];let r=t.split(" "),a=n.transforms.conjugate(r[0],n),i=Object.keys(a);for(let t=0;t<i.length;t++){let o=a[i[t]]+" "+r[1];e[o]=e[o]||["PhrasalVerb",i[t]],n.hasCompound[a[i[t]]]=!0}},Demonym:(e,t,n)=>{e[t]="Demonym";let r=n.transforms.toPlural(t,n);e[r]=e[r]||["Demonym","Plural"]}},or=function(e,t,n){Object.keys(e).forEach((r=>{let a=e[r];"Abbreviation"!==a&&"Unit"!==a||(n.cache.abbreviations[r]=!0);let i=r.split(" ");i.length>1&&(n.hasCompound[i[0]]=!0),void 0===ir[a]?void 0!==t[r]?("string"==typeof t[r]&&(t[r]=[t[r]]),"string"==typeof a?t[r].push(a):t[r]=t[r].concat(a)):t[r]=a:ir[a](t,r,n)}))};var sr={buildOut:function(e){let t=Object.assign({},nr);return Object.keys(rr).forEach((n=>{let r=ar(rr[n]);Object.keys(r).forEach((e=>{r[e]=n})),or(r,t,e)})),t},addWords:or},lr=function(e){let t=e.irregulars.nouns,n=Object.keys(t);for(let r=0;r<n.length;r++){const a=n[r];e.words[a]="Singular",e.words[t[a]]="Plural"}let r=e.irregulars.verbs,a=Object.keys(r);for(let t=0;t<a.length;t++){const n=a[t];e.words[n]=e.words[n]||"Infinitive";let i=e.transforms.conjugate(n,e);i=Object.assign(i,r[n]),Object.keys(i).forEach((t=>{e.words[i[t]]=e.words[i[t]]||t,"Participle"===e.words[i[t]]&&(e.words[i[t]]=t)}))}};const ur={g:"Gerund",prt:"Participle",perf:"PerfectTense",pst:"PastTense",fut:"FuturePerfect",pres:"PresentTense",pluperf:"Pluperfect",a:"Actor"};let cr={act:{a:"_or"},ache:{pst:"ached",g:"aching"},age:{g:"ageing",pst:"aged",pres:"ages"},aim:{a:"_er",g:"_ing",pst:"_ed"},arise:{prt:"_n",pst:"arose"},babysit:{a:"_ter",pst:"babysat"},ban:{a:"",g:"_ning",pst:"_ned"},be:{a:"",g:"am",prt:"been",pst:"was",pres:"is"},beat:{a:"_er",g:"_ing",prt:"_en"},become:{prt:"_"},begin:{g:"_ning",prt:"begun",pst:"began"},being:{g:"are",pst:"were",pres:"are"},bend:{prt:"bent"},bet:{a:"_ter",prt:"_"},bind:{pst:"bound"},bite:{g:"biting",prt:"bitten",pst:"bit"},bleed:{pst:"bled",prt:"bled"},blow:{prt:"_n",pst:"blew"},boil:{a:"_er"},brake:{prt:"broken"},break:{pst:"broke"},breed:{pst:"bred"},bring:{pst:"brought",prt:"brought"},broadcast:{pst:"_"},budget:{pst:"_ed"},build:{pst:"built",prt:"built"},burn:{prt:"_ed"},burst:{prt:"_"},buy:{pst:"bought",prt:"bought"},can:{a:"",fut:"_",g:"",pst:"could",perf:"could",pluperf:"could",pres:"_"},catch:{pst:"caught"},choose:{g:"choosing",prt:"chosen",pst:"chose"},cling:{prt:"clung"},come:{prt:"_",pst:"came",g:"coming"},compete:{a:"competitor",g:"competing",pst:"_d"},cost:{pst:"_"},creep:{prt:"crept"},cut:{prt:"_"},deal:{pst:"_t",prt:"_t"},develop:{a:"_er",g:"_ing",pst:"_ed"},die:{g:"dying",pst:"_d"},dig:{g:"_ging",pst:"dug",prt:"dug"},dive:{prt:"_d"},do:{pst:"did",pres:"_es"},draw:{prt:"_n",pst:"drew"},dream:{prt:"_t"},drink:{prt:"drunk",pst:"drank"},drive:{g:"driving",prt:"_n",pst:"drove"},drop:{g:"_ping",pst:"_ped"},eat:{a:"_er",g:"_ing",prt:"_en",pst:"ate"},edit:{pst:"_ed",g:"_ing"},egg:{pst:"_ed"},fall:{prt:"_en",pst:"fell"},feed:{prt:"fed",pst:"fed"},feel:{a:"_er",pst:"felt"},fight:{pst:"fought",prt:"fought"},find:{pst:"found"},flee:{g:"_ing",prt:"fled"},fling:{prt:"flung"},fly:{prt:"flown",pst:"flew"},forbid:{pst:"forbade"},forget:{g:"_ing",prt:"forgotten",pst:"forgot"},forgive:{g:"forgiving",prt:"_n",pst:"forgave"},free:{a:"",g:"_ing"},freeze:{g:"freezing",prt:"frozen",pst:"froze"},get:{pst:"got",prt:"gotten"},give:{g:"giving",prt:"_n",pst:"gave"},go:{prt:"_ne",pst:"went",pres:"goes"},grow:{prt:"_n"},guide:{pst:"_d"},hang:{pst:"hung",prt:"hung"},have:{g:"having",pst:"had",prt:"had",pres:"has"},hear:{pst:"_d",prt:"_d"},hide:{prt:"hidden",pst:"hid"},hit:{prt:"_"},hold:{pst:"held",prt:"held"},hurt:{pst:"_",prt:"_"},ice:{g:"icing",pst:"_d"},imply:{pst:"implied",pres:"implies"},is:{a:"",g:"being",pst:"was",pres:"_"},keep:{prt:"kept"},kneel:{prt:"knelt"},know:{prt:"_n"},lay:{pst:"laid",prt:"laid"},lead:{pst:"led",prt:"led"},leap:{prt:"_t"},leave:{pst:"left",prt:"left"},lend:{prt:"lent"},lie:{g:"lying",pst:"lay"},light:{pst:"lit",prt:"lit"},log:{g:"_ging",pst:"_ged"},loose:{prt:"lost"},lose:{g:"losing",pst:"lost"},make:{pst:"made",prt:"made"},mean:{pst:"_t",prt:"_t"},meet:{a:"_er",g:"_ing",pst:"met",prt:"met"},miss:{pres:"_"},name:{g:"naming"},patrol:{g:"_ling",pst:"_led"},pay:{pst:"paid",prt:"paid"},prove:{prt:"_n"},puke:{g:"puking"},put:{prt:"_"},quit:{prt:"_"},read:{pst:"_",prt:"_"},ride:{prt:"ridden"},reside:{pst:"_d"},ring:{pst:"rang",prt:"rung"},rise:{fut:"will have _n",g:"rising",prt:"_n",pst:"rose",pluperf:"had _n"},rub:{g:"_bing",pst:"_bed"},run:{g:"_ning",prt:"_",pst:"ran"},say:{pst:"said",prt:"said",pres:"_s"},seat:{pst:"sat",prt:"sat"},see:{g:"_ing",prt:"_n",pst:"saw"},seek:{prt:"sought"},sell:{pst:"sold",prt:"sold"},send:{prt:"sent"},set:{prt:"_"},sew:{prt:"_n"},shake:{prt:"_n"},shave:{prt:"_d"},shed:{g:"_ding",pst:"_",pres:"_s"},shine:{pst:"shone",prt:"shone"},shoot:{pst:"shot",prt:"shot"},show:{pst:"_ed"},shut:{prt:"_"},sing:{prt:"sung",pst:"sang"},sink:{pst:"sank",pluperf:"had sunk"},sit:{pst:"sat"},ski:{pst:"_ied"},slay:{prt:"slain"},sleep:{prt:"slept"},slide:{pst:"slid",prt:"slid"},smash:{pres:"_es"},sneak:{prt:"snuck"},speak:{fut:"will have spoken",prt:"spoken",pst:"spoke",perf:"have spoken",pluperf:"had spoken"},speed:{prt:"sped"},spend:{prt:"spent"},spill:{prt:"_ed",pst:"spilt"},spin:{g:"_ning",pst:"spun",prt:"spun"},spit:{prt:"spat"},split:{prt:"_"},spread:{pst:"_"},spring:{prt:"sprung"},stand:{pst:"stood"},steal:{a:"_er",pst:"stole"},stick:{pst:"stuck"},sting:{pst:"stung"},stink:{pst:"stunk",prt:"stunk"},stream:{a:"_er"},strew:{prt:"_n"},strike:{g:"striking",pst:"struck"},suit:{a:"_er",g:"_ing",pst:"_ed"},sware:{prt:"sworn"},swear:{pst:"swore"},sweep:{prt:"swept"},swim:{g:"_ming",pst:"swam"},swing:{pst:"swung"},take:{fut:"will have _n",pst:"took",perf:"have _n",pluperf:"had _n"},teach:{pst:"taught",pres:"_es"},tear:{pst:"tore"},tell:{pst:"told"},think:{pst:"thought"},thrive:{prt:"_d"},tie:{g:"tying",pst:"_d"},undergo:{prt:"_ne"},understand:{pst:"understood"},upset:{prt:"_"},wait:{a:"_er",g:"_ing",pst:"_ed"},wake:{pst:"woke"},wear:{pst:"wore"},weave:{prt:"woven"},wed:{pst:"wed"},weep:{prt:"wept"},win:{g:"_ning",pst:"won"},wind:{prt:"wound"},withdraw:{pst:"withdrew"},wring:{prt:"wrung"},write:{g:"writing",prt:"written",pst:"wrote"}},hr=Object.keys(cr);for(let e=0;e<hr.length;e++){const t=hr[e];let n={};Object.keys(cr[t]).forEach((e=>{let r=cr[t][e];r=r.replace("_",t),n[ur[e]]=r})),cr[t]=n}var dr=cr;const gr={b:[{reg:/([^aeiou][aeiou])b$/i,repl:{pr:"$1bs",pa:"$1bbed",gr:"$1bbing"}}],d:[{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/([^aeiou][ou])d$/i,repl:{pr:"$1ds",pa:"$1dded",gr:"$1dding"}}],e:[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(t|sh?)(ake)$/i,repl:{pr:"$1$2s",pa:"$1ook",gr:"$1aking",ar:"$1$2r"}},{reg:/w(ake)$/i,repl:{pr:"w$1s",pa:"woke",gr:"waking",ar:"w$1r"}},{reg:/m(ake)$/i,repl:{pr:"m$1s",pa:"made",gr:"making",ar:"m$1r"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}}],g:[{reg:/([^aeiou][aou])g$/i,repl:{pr:"$1gs",pa:"$1gged",gr:"$1gging"}}],h:[{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}}],k:[{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}}],m:[{reg:/([^aeiou][aeiou])m$/i,repl:{pr:"$1ms",pa:"$1mmed",gr:"$1mming"}}],n:[{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],p:[{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/([^aeiou][aeiou])p$/i,repl:{pr:"$1ps",pa:"$1pped",gr:"$1pping"}},{reg:/([aeiu])p$/i,repl:{pr:"$1ps",pa:"$1p",gr:"$1pping"}}],r:[{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],s:[{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}],t:[{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])t$/i,repl:{pr:"$1ts",pa:"$1t",gr:"$1tting"}},{reg:/([^aeiou][aeiou])t$/i,repl:{pr:"$1ts",pa:"$1tted",gr:"$1tting"}}],w:[{reg:/(.llow)$/i,repl:{pr:"$1s",pa:"$1ed"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}}],y:[{reg:/(i|f|rr)y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}}],z:[{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},pr={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},mr=function(e,t){let n={},r=Object.keys(t.repl);for(let a=0;a<r.length;a+=1){let i=r[a];n[pr[i]]=e.replace(t.reg,t.repl[i])}return n},fr=/[bcdfghjklmnpqrstvwxz]y$/,br=function(e=""){let t=e[e.length-1];if(!0===gr.hasOwnProperty(t))for(let n=0;n<gr[t].length;n+=1)if(!0===gr[t][n].reg.test(e))return mr(e,gr[t][n]);return{}},yr={Gerund:e=>"e"===e.charAt(e.length-1)?e.replace(/e$/,"ing"):e+"ing",PresentTense:e=>"s"===e.charAt(e.length-1)?e+"es":!0===fr.test(e)?e.slice(0,-1)+"ies":e+"s",PastTense:e=>"e"===e.charAt(e.length-1)?e+"d":"ed"===e.substr(-2)?e:!0===fr.test(e)?e.slice(0,-1)+"ied":e+"ed"};var vr=function(e="",t){let n={};return t&&t.irregulars&&!0===t.irregulars.verbs.hasOwnProperty(e)&&(n=Object.assign({},t.irregulars.verbs[e])),n=Object.assign({},br(e),n),void 0===n.Gerund&&(n.Gerund=yr.Gerund(e)),void 0===n.PastTense&&(n.PastTense=yr.PastTense(e)),void 0===n.PresentTense&&(n.PresentTense=yr.PresentTense(e)),n};const wr=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],kr=[/ary$/],Ar={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},Dr=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}],$r=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],Pr=[/ary$/,/ous$/],Er={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},Hr=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}],jr={toSuperlative:function(e){if(Ar.hasOwnProperty(e))return Ar[e];for(let t=0;t<Dr.length;t++)if(Dr[t].reg.test(e))return e.replace(Dr[t].reg,Dr[t].repl);for(let t=0;t<kr.length;t++)if(!0===kr[t].test(e))return null;for(let t=0;t<wr.length;t++)if(!0===wr[t].test(e))return"e"===e.charAt(e.length-1)?e+"st":e+"est";return e+"est"},toComparative:function(e){if(Er.hasOwnProperty(e))return Er[e];for(let t=0;t<Hr.length;t++)if(!0===Hr[t].reg.test(e))return e.replace(Hr[t].reg,Hr[t].repl);for(let t=0;t<Pr.length;t++)if(!0===Pr[t].test(e))return null;for(let t=0;t<$r.length;t++)if(!0===$r[t].test(e))return e+"er";return!0===/e$/.test(e)?e+"r":e+"er"}};var Nr=function(e){let t={},n=jr.toSuperlative(e);n&&(t.Superlative=n);let r=jr.toComparative(e);return r&&(t.Comparative=r),t};const xr={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/([ti])a$/i,"$1a"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},Fr=/(x|ch|sh|s|z)$/;var Cr=function(e="",t){let n=t.irregulars.nouns;if(n.hasOwnProperty(e))return n[e];let r=function(e){let t=e[e.length-1];if(!0===xr.hasOwnProperty(t))for(let n=0;n<xr[t].length;n+=1){let r=xr[t][n][0];if(!0===r.test(e))return e.replace(r,xr[t][n][1])}return null}(e);return null!==r?r:Fr.test(e)?e+"es":e+"s"};const Br=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(eas)es$/i,"$1e"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]];var Gr=function(e,t){let n=t.irregulars.nouns,r=(a=n,Object.keys(a).reduce(((e,t)=>(e[a[t]]=t,e)),{}));var a;if(r.hasOwnProperty(e))return r[e];for(let t=0;t<Br.length;t++)if(!0===Br[t][0].test(e))return e.replace(Br[t][0],Br[t][1]);return e},zr={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/(..)(p|d|t|g){2}ing$/i,to:"$1$2"},{reg:/(ll|ss|zz)ing$/i,to:"$1"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea[dklnrtv])ing$/i,to:"$1"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(z)ing$/i,to:"$1e"},{reg:/(a[gdkvtc])ing$/i,to:"$1e"},{reg:/(u[rtcbn])ing$/i,to:"$1e"},{reg:/([^o]o[bdknprv])ing$/i,to:"$1e"},{reg:/([tbckg]l)ing$/i,to:"$1e"},{reg:/(c|s)ing$/i,to:"$1e"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/ea(rn|l|m)ed$/i,to:"ea$1"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(dd)ed$/i,to:"$1"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([aeiou][^aeiou])ed$/i,to:"$1e"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]};let Ir={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"]};Ir=Object.keys(Ir).reduce(((e,t)=>(Ir[t].forEach((n=>e[n]=t)),e)),{});const Or=zr,Tr=Ir,Vr=Qt,Mr=sr,Jr=lr,Lr=St,Sr={nouns:{addendum:"addenda",alga:"algae",alumna:"alumnae",alumnus:"alumni",analysis:"analyses",antenna:"antennae",appendix:"appendices",avocado:"avocados",axis:"axes",bacillus:"bacilli",barracks:"barracks",beau:"beaux",bus:"buses",cactus:"cacti",chateau:"chateaux",child:"children",circus:"circuses",clothes:"clothes",corpus:"corpora",criterion:"criteria",curriculum:"curricula",database:"databases",deer:"deer",diagnosis:"diagnoses",echo:"echoes",embargo:"embargoes",epoch:"epochs",foot:"feet",formula:"formulae",fungus:"fungi",genus:"genera",goose:"geese",halo:"halos",hippopotamus:"hippopotami",index:"indices",larva:"larvae",leaf:"leaves",libretto:"libretti",loaf:"loaves",man:"men",matrix:"matrices",memorandum:"memoranda",modulus:"moduli",mosquito:"mosquitoes",mouse:"mice",nebula:"nebulae",nucleus:"nuclei",octopus:"octopi",opus:"opera",ovum:"ova",ox:"oxen",parenthesis:"parentheses",person:"people",phenomenon:"phenomena",prognosis:"prognoses",quiz:"quizzes",radius:"radii",referendum:"referenda",rodeo:"rodeos",sex:"sexes",shoe:"shoes",sombrero:"sombreros",stimulus:"stimuli",stomach:"stomachs",syllabus:"syllabi",synopsis:"synopses",tableau:"tableaux",thesis:"theses",thief:"thieves",tooth:"teeth",tornado:"tornados",tuxedo:"tuxedos",vertebra:"vertebrae"},verbs:dr},_r={conjugate:vr,adjectives:Nr,toPlural:Cr,toSingular:Gr,toInfinitive:function(e,t,n){if(!e)return"";if(!0===t.words.hasOwnProperty(e)){let n=t.irregulars.verbs,r=Object.keys(n);for(let t=0;t<r.length;t++){let a=Object.keys(n[r[t]]);for(let i=0;i<a.length;i++)if(e===n[r[t]][a[i]])return r[t]}}if((n=n||function(e){let t=e.substr(e.length-3);if(!0===Tr.hasOwnProperty(t))return Tr[t];let n=e.substr(e.length-2);return!0===Tr.hasOwnProperty(n)?Tr[n]:"s"===e.substr(e.length-1)?"PresentTense":null}(e))&&Or[n])for(let t=0;t<Or[n].length;t++){const r=Or[n][t];if(!0===r.reg.test(e))return e.replace(r.reg,r.to)}return e}};let Kr=!1;class qr{constructor(){Object.defineProperty(this,"words",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"hasCompound",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"irregulars",{enumerable:!1,value:Sr,writable:!0}),Object.defineProperty(this,"tags",{enumerable:!1,value:Object.assign({},Vr),writable:!0}),Object.defineProperty(this,"transforms",{enumerable:!1,value:_r,writable:!0}),Object.defineProperty(this,"taggers",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"cache",{enumerable:!1,value:{abbreviations:{}}}),this.words=Mr.buildOut(this),Jr(this)}verbose(e){return Kr=e,this}isVerbose(){return Kr}addWords(e){let t={};Object.keys(e).forEach((n=>{let r=e[n];n=n.toLowerCase().trim(),t[n]=r})),Mr.addWords(t,this.words,this)}addConjugations(e){return Object.assign(this.irregulars.verbs,e),this}addPlurals(e){return Object.assign(this.irregulars.nouns,e),this}addTags(e){return e=Object.assign({},e),this.tags=Object.assign(this.tags,e),this.tags=Lr(this.tags),this}postProcess(e){return this.taggers.push(e),this}stats(){return{words:Object.keys(this.words).length,plurals:Object.keys(this.irregulars.nouns).length,conjugations:Object.keys(this.irregulars.verbs).length,compounds:Object.keys(this.hasCompound).length,postProcessors:this.taggers.length}}}const Wr=function(e){return JSON.parse(JSON.stringify(e))};qr.prototype.clone=function(){let e=new qr;return e.words=Object.assign({},this.words),e.hasCompound=Object.assign({},this.hasCompound),e.irregulars=Wr(this.irregulars),e.tags=Wr(this.tags),e.transforms=this.transforms,e.taggers=this.taggers,e};var Rr=qr,Ur={};!function(e){e.all=function(){return this.parents()[0]||this},e.parent=function(){return this.from?this.from:this},e.parents=function(e){let t=[];const n=function(e){e.from&&(t.push(e.from),n(e.from))};return n(this),t=t.reverse(),"number"==typeof e?t[e]:t},e.clone=function(e){let t=this.list.map((t=>t.clone(e)));return this.buildFrom(t)},e.wordCount=function(){return this.list.reduce(((e,t)=>e+t.wordCount()),0)},e.wordcount=e.wordCount}(Ur);var Qr={};!function(e){e.first=function(e){return void 0===e?this.get(0):this.slice(0,e)},e.last=function(e){if(void 0===e)return this.get(this.list.length-1);let t=this.list.length;return this.slice(t-e,t)},e.slice=function(e,t){let n=this.list.slice(e,t);return this.buildFrom(n)},e.eq=function(e){let t=this.list[e];return void 0===t?this.buildFrom([]):this.buildFrom([t])},e.get=e.eq,e.firstTerms=function(){return this.match("^.")},e.firstTerm=e.firstTerms,e.lastTerms=function(){return this.match(".$")},e.lastTerm=e.lastTerms,e.termList=function(e){let t=[];for(let n=0;n<this.list.length;n++){let r=this.list[n].terms();for(let n=0;n<r.length;n++)if(t.push(r[n]),void 0!==e&&void 0!==t[e])return t[e]}return t},e.groups=function(e){return void 0===e?function(e){let t={};const n={};for(let t=0;t<e.list.length;t++){const r=e.list[t],a=Object.keys(r.groups).map((e=>r.groups[e]));for(let e=0;e<a.length;e++){const{group:t,start:i,length:o}=a[e];n[t]||(n[t]=[]),n[t].push(r.buildFrom(i,o))}}const r=Object.keys(n);for(let a=0;a<r.length;a++){const i=r[a];t[i]=e.buildFrom(n[i])}return t}(this):("number"==typeof e&&(e=String(e)),function(e,t){const n=[];for(let r=0;r<e.list.length;r++){const a=e.list[r];let i=Object.keys(a.groups);i=i.filter((e=>a.groups[e].group===t)),i.forEach((e=>{n.push(a.buildFrom(a.groups[e].start,a.groups[e].length))}))}return e.buildFrom(n)}(this,e)||this.buildFrom([]))},e.group=e.groups,e.sentences=function(e){let t=[];return this.list.forEach((e=>{t.push(e.fullSentence())})),"number"==typeof e?this.buildFrom([t[e]]):this.buildFrom(t)},e.sentence=e.sentences}(Qr);var Zr={},Xr=function(e,t){if(e._cache&&!0===e._cache.set){let{words:n,tags:r}=function(e){let t=[],n=[];return e.forEach((e=>{!0!==e.optional&&!0!==e.negative&&(void 0!==e.tag&&t.push(e.tag),void 0!==e.word&&n.push(e.word))})),{tags:t,words:n}}(t);for(let t=0;t<n.length;t++)if(void 0===e._cache.words[n[t]])return!1;for(let t=0;t<r.length;t++)if(void 0===e._cache.tags[r[t]])return!1}return!0};!function(e){const t=_e,n=Xr;e.match=function(e,r={}){"string"!=typeof r&&"number"!=typeof r&&null!==r||(r={group:r});let a=t(e,r);if(0===a.length)return this.buildFrom([]);if(!1===n(this,a))return this.buildFrom([]);let i=this.list.reduce(((e,t)=>e.concat(t.match(a))),[]);return void 0!==r.group&&null!==r.group&&""!==r.group?this.buildFrom(i).groups(r.group):this.buildFrom(i)},e.not=function(e,r={}){let a=t(e,r);if(0===a.length||!1===n(this,a))return this;let i=this.list.reduce(((e,t)=>e.concat(t.not(a))),[]);return this.buildFrom(i)},e.matchOne=function(e,r={}){let a=t(e,r);if(!1===n(this,a))return this.buildFrom([]);for(let e=0;e<this.list.length;e++){let t=this.list[e].match(a,!0);return this.buildFrom(t)}return this.buildFrom([])},e.if=function(e,r={}){let a=t(e,r);if(!1===n(this,a))return this.buildFrom([]);let i=this.list.filter((e=>!0===e.has(a)));return this.buildFrom(i)},e.ifNo=function(e,n={}){let r=t(e,n),a=this.list.filter((e=>!1===e.has(r)));return this.buildFrom(a)},e.has=function(e,r={}){let a=t(e,r);return!1!==n(this,a)&&this.list.some((e=>!0===e.has(a)))},e.lookAhead=function(e,n={}){e||(e=".*");let r=t(e,n),a=[];return this.list.forEach((e=>{a=a.concat(e.lookAhead(r))})),a=a.filter((e=>e)),this.buildFrom(a)},e.lookAfter=e.lookAhead,e.lookBehind=function(e,n={}){e||(e=".*");let r=t(e,n),a=[];return this.list.forEach((e=>{a=a.concat(e.lookBehind(r))})),a=a.filter((e=>e)),this.buildFrom(a)},e.lookBefore=e.lookBehind,e.before=function(e,n={}){let r=t(e,n),a=this.if(r).list.map((e=>{let t=e.terms().map((e=>e.id)),n=e.match(r)[0],a=t.indexOf(n.start);return 0===a||-1===a?null:e.buildFrom(e.start,a)}));return a=a.filter((e=>null!==e)),this.buildFrom(a)},e.after=function(e,n={}){let r=t(e,n),a=this.if(r).list.map((e=>{let t=e.terms(),n=t.map((e=>e.id)),a=e.match(r)[0],i=n.indexOf(a.start);if(-1===i||!t[i+a.length])return null;let o=t[i+a.length].id,s=e.length-i-a.length;return e.buildFrom(o,s)}));return a=a.filter((e=>null!==e)),this.buildFrom(a)},e.hasAfter=function(e,t={}){return this.filter((n=>n.lookAfter(e,t).found))},e.hasBefore=function(e,t={}){return this.filter((n=>n.lookBefore(e,t).found))}}(Zr);var Yr={};const ea=function(e,t,n,r){let a=[];"string"==typeof e&&(a=e.split(" ")),t.list.forEach((i=>{let o=i.terms();!0===n&&(o=o.filter((n=>n.canBe(e,t.world)))),o.forEach(((n,i)=>{a.length>1?a[i]&&"."!==a[i]&&n.tag(a[i],r,t.world):n.tag(e,r,t.world)}))}))};Yr.tag=function(e,t){return e?(ea(e,this,!1,t),this):this},Yr.tagSafe=function(e,t){return e?(ea(e,this,!0,t),this):this},Yr.unTag=function(e,t){return this.list.forEach((n=>{n.terms().forEach((n=>n.unTag(e,t,this.world)))})),this},Yr.canBe=function(e){if(!e)return this;let t=this.world,n=this.list.reduce(((n,r)=>n.concat(r.canBe(e,t))),[]);return this.buildFrom(n)};var ta={map:function(e){if(!e)return this;let t=this.list.map(((t,n)=>{let r=this.buildFrom([t]);r.from=null;let a=e(r,n);return a&&a.list&&a.list[0]?a.list[0]:a}));return t=t.filter((e=>e)),0===t.length?this.buildFrom(t):"object"!=typeof t[0]||"Phrase"!==t[0].isA?t:this.buildFrom(t)},forEach:function(e,t){return e?(this.list.forEach(((n,r)=>{let a=this.buildFrom([n]);!0===t&&(a.from=null),e(a,r)})),this):this},filter:function(e){if(!e)return this;let t=this.list.filter(((t,n)=>{let r=this.buildFrom([t]);return r.from=null,e(r,n)}));return this.buildFrom(t)},find:function(e){if(!e)return this;let t=this.list.find(((t,n)=>{let r=this.buildFrom([t]);return r.from=null,e(r,n)}));return t?this.buildFrom([t]):void 0},some:function(e){return e?this.list.some(((t,n)=>{let r=this.buildFrom([t]);return r.from=null,e(r,n)})):this},random:function(e){if(!this.found)return this;let t=Math.floor(Math.random()*this.list.length);if(void 0===e){let e=[this.list[t]];return this.buildFrom(e)}return t+e>this.length&&(t=this.length-e,t=t<0?0:t),this.slice(t,t+e)}},ra={},aa=function(e,t,n){let r=function(e,t=[]){let n={};return e.forEach(((e,r)=>{let a=!0;void 0!==t[r]&&(a=t[r]);let i=function(e){return e.split(/[ -]/g)}(e=(e=(e||"").toLowerCase()).replace(/[,;.!?]+$/,"")).map((e=>e.trim()));n[i[0]]=n[i[0]]||{},1===i.length?n[i[0]].value=a:(n[i[0]].more=n[i[0]].more||[],n[i[0]].more.push({rest:i.slice(1),value:a}))})),n}(e,t),a=[];for(let e=0;e<n.list.length;e++){const t=n.list[e];let i=t.terms().map((e=>e.reduced));for(let e=0;e<i.length;e++)void 0!==r[i[e]]&&(void 0!==r[i[e]].more&&r[i[e]].more.forEach((n=>{void 0!==i[e+n.rest.length]&&!0===n.rest.every(((t,n)=>t===i[e+n+1]))&&a.push({id:t.terms()[e].id,value:n.value,length:n.rest.length+1})})),void 0!==r[i[e]].value&&a.push({id:t.terms()[e].id,value:r[i[e]].value,length:1}))}return a};!function(e){const t=aa;e.lookup=function(e){let n=[],r=(a=e)&&"[object Object]"===Object.prototype.toString.call(a);var a;!0===r&&(e=Object.keys(e).map((t=>(n.push(e[t]),t)))),"string"==typeof e&&(e=[e]),!0!==this._cache.set&&this.cache();let i=t(e,n,this),o=this.list[0];if(!0===r){let e={};return i.forEach((t=>{e[t.value]=e[t.value]||[],e[t.value].push(o.buildFrom(t.id,t.length))})),Object.keys(e).forEach((t=>{e[t]=this.buildFrom(e[t])})),e}return i=i.map((e=>o.buildFrom(e.id,e.length))),this.buildFrom(i)},e.lookUp=e.lookup}(ra);var na={cache:function(e){e=e||{};let t={},n={};return this._cache.words=t,this._cache.tags=n,this._cache.set=!0,this.list.forEach(((r,a)=>{r.cache=r.cache||{},r.terms().forEach((r=>{t[r.reduced]&&!t.hasOwnProperty(r.reduced)||(t[r.reduced]=t[r.reduced]||[],t[r.reduced].push(a),Object.keys(r.tags).forEach((e=>{n[e]=n[e]||[],n[e].push(a)})),e.root&&(r.setRoot(this.world),t[r.root]=[a]))}))})),this},uncache:function(){return this._cache={},this.list.forEach((e=>{e.cache={}})),this.parents().forEach((e=>{e._cache={},e.list.forEach((e=>{e.cache={}}))})),this}},ia={};const oa=xt;ia.replaceWith=function(e,t={}){return e?(!0===t&&(t={keepTags:!0}),!1===t&&(t={keepTags:!1}),t=t||{},this.uncache(),this.list.forEach((n=>{let r,a=e;if("function"==typeof e&&(a=e(n)),a&&"object"==typeof a&&"Doc"===a.isA)r=a.list,this.pool().merge(a.pool());else{if("string"!=typeof a)return;{!1!==t.keepCase&&n.terms(0).isTitleCase()&&(a=(i=a).charAt(0).toUpperCase()+i.substr(1)),r=oa(a,this.world,this.pool());let e=this.buildFrom(r);e.tagger(),r=e.list}}var i;if(!0===t.keepTags){let e=n.json({terms:{tags:!0}}).terms;r[0].terms().forEach(((t,n)=>{e[n]&&t.tagSafe(e[n].tags,"keptTag",this.world)}))}n.replace(r[0],this)})),this):this.delete()},ia.replace=function(e,t,n){return void 0===t?this.replaceWith(e,n):(this.match(e).replaceWith(t,n),this)};var sa={};!function(e){const t=xt,n=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},r=function(e,n){let r=t(e,n.world)[0],a=n.buildFrom([r]);return a.tagger(),n.list=a.list,n};e.append=function(e=""){return e?this.found?(this.uncache(),this.list.forEach((r=>{let a;n(e)&&"Doc"===e.isA?a=e.list[0].clone():"string"==typeof e&&(a=t(e,this.world,this.pool())[0]),this.buildFrom([a]).tagger(),r.append(a,this)})),this):r(e,this):this},e.insertAfter=e.append,e.insertAt=e.append,e.prepend=function(e){return e?this.found?(this.uncache(),this.list.forEach((r=>{let a;n(e)&&"Doc"===e.isA?a=e.list[0].clone():"string"==typeof e&&(a=t(e,this.world,this.pool())[0]),this.buildFrom([a]).tagger(),r.prepend(a,this)})),this):r(e,this):this},e.insertBefore=e.prepend,e.concat=function(){this.uncache();let e=this.list.slice(0);for(let n=0;n<arguments.length;n++){let r=arguments[n];if("string"==typeof r){let n=t(r,this.world);e=e.concat(n)}else"Doc"===r.isA?e=e.concat(r.list):"Phrase"===r.isA&&e.push(r)}return this.buildFrom(e)},e.delete=function(e){this.uncache();let t=this;return e&&(t=this.match(e)),t.list.forEach((e=>e.delete(this))),this},e.remove=e.delete}(sa);var la={};const ua={clean:!0,reduced:!0,root:!0};la.text=function(e){e=e||{};let t=!1;0===this.parents().length&&(t=!0),("root"===e||"object"==typeof e&&e.root)&&this.list.forEach((e=>{e.terms().forEach((e=>{null===e.root&&e.setRoot(this.world)}))}));let n=this.list.reduce(((n,r,a)=>{const i=!t&&0===a,o=!t&&a===this.list.length-1;return n+r.text(e,i,o)}),"");return!0!==ua[e]&&!0!==e.reduced&&!0!==e.clean&&!0!==e.root||(n=n.trim()),n};var ca={},ha=function(e,t,n){let r=function(e){let t=0,n=0,r={};return e.termList().forEach((e=>{r[e.id]={index:n,start:t+e.pre.length,length:e.text.length},t+=e.pre.length+e.text.length+e.post.length,n+=1})),r}(e.all());(n.terms.index||n.index)&&t.forEach((e=>{e.terms.forEach((e=>{e.index=r[e.id].index})),e.index=e.terms[0].index})),(n.terms.offset||n.offset)&&t.forEach((e=>{e.terms.forEach((e=>{e.offset=r[e.id]||{}})),e.offset={index:e.terms[0].offset.index,start:e.terms[0].offset.start-e.text.indexOf(e.terms[0].text),length:e.text.length}}))};!function(e){const t=ha,n={text:!0,terms:!0,trim:!0};e.json=function(e={}){if("number"==typeof e&&this.list[e])return this.list[e].json(n);!0===(e=function(e){return(e=Object.assign({},n,e)).unique&&(e.reduced=!0),e.offset&&(e.text=!0,e.terms&&!0!==e.terms||(e.terms={}),e.terms.offset=!0),(e.index||e.terms.index)&&(e.terms=!0===e.terms?{}:e.terms,e.terms.id=!0),e}(e)).root&&this.list.forEach((e=>{e.terms().forEach((e=>{null===e.root&&e.setRoot(this.world)}))}));let r=this.list.map((t=>t.json(e,this.world)));if((e.terms.offset||e.offset||e.terms.index||e.index)&&t(this,r,e),e.frequency||e.freq||e.count){let e={};this.list.forEach((t=>{let n=t.text("reduced");e[n]=e[n]||0,e[n]+=1})),this.list.forEach(((t,n)=>{r[n].count=e[t.text("reduced")]}))}if(e.unique){let e={};r=r.filter((t=>!0!==e[t.reduced]&&(e[t.reduced]=!0,!0)))}return r},e.data=e.json}(ca);var da={},ga={exports:{}};!function(e){const t="[0m",n=function(e,t){for(e=e.toString();e.length<t;)e+=" ";return e},r={green:"#7f9c6c",red:"#914045",blue:"#6699cc",magenta:"#6D5685",cyan:"#2D85A8",yellow:"#e6d7b3",black:"#303b50"},a={green:function(e){return"[32m"+e+t},red:function(e){return"[31m"+e+t},blue:function(e){return"[34m"+e+t},magenta:function(e){return"[35m"+e+t},cyan:function(e){return"[36m"+e+t},yellow:function(e){return"[33m"+e+t},black:function(e){return"[30m"+e+t}};ga.exports=function(e){return"undefined"!=typeof window&&window.document?(function(e){let t=e.world.tags;e.list.forEach((e=>{console.log('\n%c"'+e.text()+'"',"color: #e6d7b3;"),e.terms().forEach((e=>{let a=Object.keys(e.tags),i=e.text||"-";e.implicit&&(i="["+e.implicit+"]");let o="'"+i+"'";o=n(o,8);let s=a.find((e=>t[e]&&t[e].color)),l="steelblue";t[s]&&(l=t[s].color,l=r[l]),console.log(`   ${o}  -  %c${a.join(", ")}`,`color: ${l||"steelblue"};`)}))}))}(e),e):(console.log(a.blue("=====")),e.list.forEach((t=>{console.log(a.blue("  -----")),t.terms().forEach((t=>{let r=Object.keys(t.tags),i=t.text||"-";t.implicit&&(i="["+t.implicit+"]"),i=a.yellow(i);let o="'"+i+"'";o=n(o,18);let s=a.blue("   ")+o+"  - "+function(e,t){return(e=e.map((e=>{if(!t.tags.hasOwnProperty(e))return e;const n=t.tags[e].color||"blue";return a[n](e)}))).join(", ")}(r,e.world);console.log(s)}))})),console.log(""),e)}}();const pa=ga.exports,ma=function(e){let t=e.json({text:!1,terms:!1,reduced:!0}),n={};t.forEach((e=>{n[e.reduced]||(e.count=0,n[e.reduced]=e),n[e.reduced].count+=1}));let r=Object.keys(n).map((e=>n[e]));return r.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),r};da.debug=function(){return pa(this),this},da.out=function(e){if("text"===e)return this.text();if("normal"===e)return this.text("normal");if("json"===e)return this.json();if("offset"===e||"offsets"===e)return this.json({offset:!0});if("array"===e)return this.json({terms:!1}).map((e=>e.text)).filter((e=>e));if("freq"===e||"frequency"===e)return ma(this);if("terms"===e){let e=[];return this.json({text:!1,terms:{text:!0}}).forEach((t=>{let n=t.terms.map((e=>e.text));n=n.filter((e=>e)),e=e.concat(n)})),e}return"tags"===e?this.list.map((e=>e.terms().reduce(((e,t)=>(e[t.clean||t.implicit]=Object.keys(t.tags),e)),{}))):"debug"===e?(pa(this),this):this.text()};var fa={};const ba={alpha:(e,t)=>{let n=e.text("clean"),r=t.text("clean");return n<r?-1:n>r?1:0},length:(e,t)=>{let n=e.text().trim().length,r=t.text().trim().length;return n<r?1:n>r?-1:0},wordCount:(e,t)=>{let n=e.wordCount(),r=t.wordCount();return n<r?1:n>r?-1:0}};ba.alphabetical=ba.alpha,ba.wordcount=ba.wordCount;const ya={index:!0,sequence:!0,seq:!0,sequential:!0,chron:!0,chronological:!0};fa.sort=function(e){return"freq"===(e=e||"alpha")||"frequency"===e||"topk"===e?function(e){let t={};const n={case:!0,punctuation:!1,whitespace:!0,unicode:!0};return e.list.forEach((e=>{let r=e.text(n);t[r]=t[r]||0,t[r]+=1})),e.list.sort(((e,r)=>{let a=t[e.text(n)],i=t[r.text(n)];return a<i?1:a>i?-1:0})),e}(this):ya.hasOwnProperty(e)?function(e){let t={};return e.json({terms:{offset:!0}}).forEach((e=>{t[e.terms[0].id]=e.terms[0].offset.start})),e.list=e.list.sort(((e,n)=>t[e.start]>t[n.start]?1:t[e.start]<t[n.start]?-1:0)),e}(this):"function"==typeof(e=ba[e]||e)?(this.list=this.list.sort(e),this):this},fa.reverse=function(){let e=[].concat(this.list);return e=e.reverse(),this.buildFrom(e)},fa.unique=function(){let e=[].concat(this.list),t={};return e=e.filter((e=>{let n=e.text("reduced").trim()||e.text("implicit").trim();return!0!==t.hasOwnProperty(n)&&(t[n]=!0,!0)})),this.buildFrom(e)};var va={};const wa=n$1,ka=/[\[\]{}:,\-;\/*\^%=~|]/g,Aa=/['"]+/g,Da={whitespace:function(e){let t=e.list.map((e=>e.terms()));t.forEach(((e,n)=>{e.forEach(((r,a)=>{!0!==r.hasDash()?(r.pre=r.pre.replace(/\s/g,""),r.post=r.post.replace(/\s/g,""),(e.length-1!==a||t[n+1])&&(r.implicit&&!0===Boolean(r.text)||!0!==r.hasHyphen()&&(r.post+=" "))):r.post=" - "}))}))},punctuation:function(e){e.forEach((e=>{!0===e.hasHyphen()&&(e.post=" "),e.pre=e.pre.replace(ka,""),e.post=e.post.replace(ka,""),e.post=e.post.replace(/\.\.\./,""),!0===/!/.test(e.post)&&(e.post=e.post.replace(/!/g,""),e.post="!"+e.post),!0===/\?/.test(e.post)&&(e.post=e.post.replace(/[\?!]*/,""),e.post="?"+e.post)}))},unicode:function(e){e.forEach((e=>{!0!==e.isImplicit()&&(e.text=wa(e.text))}))},quotations:function(e){e.forEach((e=>{e.post=e.post.replace(Aa,""),e.pre=e.pre.replace(Aa,"")}))},adverbs:function(e){e.match("#Adverb").not("(not|nary|seldom|never|barely|almost|basically|so)").remove()},abbreviations:function(e){e.list.forEach((e=>{let t=e.terms();t.forEach(((e,n)=>{!0===e.tags.Abbreviation&&t[n+1]&&(e.post=e.post.replace(/^\./,""))}))}))}},$a={whitespace:!0,unicode:!0,punctuation:!0,emoji:!0,acronyms:!0,abbreviations:!0,case:!1,contractions:!1,parentheses:!1,quotations:!1,adverbs:!1,possessives:!1,verbs:!1,nouns:!1,honorifics:!1},Pa={light:{},medium:{case:!0,contractions:!0,parentheses:!0,quotations:!0,adverbs:!0}};Pa.heavy=Object.assign({},Pa.medium,{possessives:!0,verbs:!0,nouns:!0,honorifics:!0}),va.normalize=function(e){"string"==typeof(e=e||{})&&(e=Pa[e]||{}),e=Object.assign({},$a,e),this.uncache();let t=this.termList();return e.case&&this.toLowerCase(),e.whitespace&&Da.whitespace(this),e.unicode&&Da.unicode(t),e.punctuation&&Da.punctuation(t),e.emoji&&this.remove("(#Emoji|#Emoticon)"),e.acronyms&&this.acronyms().strip(),e.abbreviations&&Da.abbreviations(this),(e.contraction||e.contractions)&&this.contractions().expand(),e.parentheses&&this.parentheses().unwrap(),(e.quotations||e.quotes)&&Da.quotations(t),e.adverbs&&Da.adverbs(this),(e.possessive||e.possessives)&&this.possessives().strip(),e.verbs&&this.verbs().toInfinitive(),(e.nouns||e.plurals)&&this.nouns().toSingular(),e.honorifics&&this.remove("#Honorific"),this};var Ea={};!function(e){const t=_e;e.splitOn=function(e){if(!e)return this.parent().splitOn(this);let n=t(e),r=[];return this.list.forEach((e=>{let t=e.match(n);if(0===t.length)return void r.push(e);let a=e;t.forEach((e=>{let t=a.splitOn(e);t.before&&r.push(t.before),t.match&&r.push(t.match),a=t.after})),a&&r.push(a)})),this.buildFrom(r)},e.splitAfter=function(e){if(!e)return this.parent().splitAfter(this);let n=t(e),r=[];return this.list.forEach((e=>{let t=e.match(n);if(0===t.length)return void r.push(e);let a=e;t.forEach((e=>{let t=a.splitOn(e);t.before&&t.match?(t.before.length+=t.match.length,r.push(t.before)):t.match&&r.push(t.match),a=t.after})),a&&r.push(a)})),this.buildFrom(r)},e.split=e.splitAfter,e.splitBefore=function(e){if(!e)return this.parent().splitBefore(this);let n=t(e),r=[];return this.list.forEach((e=>{let t=e.match(n);if(0===t.length)return void r.push(e);let a=e;t.forEach((e=>{let t=a.splitOn(e);t.before&&r.push(t.before),t.match&&t.after&&(t.match.length+=t.after.length),a=t.match})),a&&r.push(a)})),this.buildFrom(r)},e.segment=function(e,t){e=e||{},t=t||{text:!0};let n=this,r=Object.keys(e);return r.forEach((e=>{n=n.splitOn(e)})),n.list.forEach((t=>{for(let n=0;n<r.length;n+=1)if(t.has(r[n]))return void(t.segment=e[r[n]])})),n.list.map((e=>{let n=e.json(t);return n.segment=e.segment||null,n}))}}(Ea);var Ha={};const ja=function(e,t){let n=e.world;return e.list.forEach((e=>{e.terms().forEach((e=>e[t](n)))})),e};Ha.toLowerCase=function(){return ja(this,"toLowerCase")},Ha.toUpperCase=function(){return ja(this,"toUpperCase")},Ha.toTitleCase=function(){return ja(this,"toTitleCase")},Ha.toCamelCase=function(){return this.list.forEach((e=>{let t=e.terms();t.forEach(((e,n)=>{0!==n&&e.toTitleCase(),n!==t.length-1&&(e.post="")}))})),this};var Na={};!function(e){e.pre=function(e,t){return void 0===e?this.list[0].terms(0).pre:(this.list.forEach((n=>{let r=n.terms(0);!0===t?r.pre+=e:r.pre=e})),this)},e.post=function(e,t){return void 0===e?this.list.map((e=>{let t=e.terms();return t[t.length-1].post})):(this.list.forEach((n=>{let r=n.terms(),a=r[r.length-1];!0===t?a.post+=e:a.post=e})),this)},e.trim=function(){return this.list=this.list.map((e=>e.trim())),this},e.hyphenate=function(){return this.list.forEach((e=>{let t=e.terms();t.forEach(((e,n)=>{0!==n&&(e.pre=""),t[n+1]&&(e.post="-")}))})),this},e.dehyphenate=function(){const e=/(-||)/;return this.list.forEach((t=>{t.terms().forEach((t=>{e.test(t.post)&&(t.post=" ")}))})),this},e.deHyphenate=e.dehyphenate,e.toQuotations=function(e,t){return e=e||'"',t=t||'"',this.list.forEach((n=>{let r=n.terms();r[0].pre=e+r[0].pre;let a=r[r.length-1];a.post=t+a.post})),this},e.toQuotation=e.toQuotations,e.toParentheses=function(e,t){return e=e||"(",t=t||")",this.list.forEach((n=>{let r=n.terms();r[0].pre=e+r[0].pre;let a=r[r.length-1];a.post=t+a.post})),this}}(Na);var xa={join:function(e){this.uncache();let t=this.list[0],n=t.length,r={};for(let n=1;n<this.list.length;n++){const a=this.list[n];r[a.start]=!0;let i=t.lastTerm();e&&(i.post+=e),i.next=a.start,a.terms(0).prev=i.id,t.length+=a.length,t.cache={}}let a=t.length-n;return this.parents().forEach((e=>{e.list.forEach((e=>{let n=e.terms();for(let r=0;r<n.length;r++)if(n[r].id===t.start){e.length+=a;break}e.cache={}})),e.list=e.list.filter((e=>!0!==r[e.start]))})),this.buildFrom([t])}},Fa={};const Ca=/[,\)"';:\-\.]/,Ba=function(e,t){if(!e.found)return;let n=e.termList();for(let e=0;e<n.length-1;e++){const t=n[e];if(Ca.test(t.post))return}n.forEach((e=>{e.implicit=e.clean})),n[0].text+=t,n.slice(1).forEach((e=>{e.text=""}));for(let e=0;e<n.length-1;e++){const t=n[e];t.post=t.post.replace(/ /,"")}};Fa.contract=function(){let e=this.not("@hasContraction"),t=e.match("(we|they|you) are");return Ba(t,"'re"),t=e.match("(he|she|they|it|we|you) will"),Ba(t,"'ll"),t=e.match("(he|she|they|it|we) is"),Ba(t,"'s"),t=e.match("#Person is"),Ba(t,"'s"),t=e.match("#Person would"),Ba(t,"'d"),t=e.match("(is|was|had|would|should|could|do|does|have|has|can) not"),Ba(t,"n't"),t=e.match("(i|we|they) have"),Ba(t,"'ve"),t=e.match("(would|should|could) have"),Ba(t,"'ve"),t=e.match("i am"),Ba(t,"'m"),t=e.match("going to"),this};var Ga=Object.assign({},Ur,Qr,Zr,Yr,ta,ra,na,ia,sa,la,ca,da,fa,va,Ea,Ha,Na,xa,Fa);let za={};[["terms","."],["hyphenated","@hasHyphen ."],["adjectives","#Adjective"],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["adverbs","#Adverb"],["pronouns","#Pronoun"],["conjunctions","#Conjunction"],["prepositions","#Preposition"]].forEach((e=>{za[e[0]]=function(t){let n=this.match(e[1]);return"number"==typeof t&&(n=n.get(t)),n}})),za.emojis=za.emoji,za.atmentions=za.atMentions,za.words=za.terms,za.phoneNumbers=function(e){let t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),"number"==typeof e&&(t=t.get(e)),t},za.money=function(e){let t=this.match("#Money #Currency?");return"number"==typeof e&&(t=t.get(e)),t},za.places=function(e){let t=this.match("(#City && @hasComma) (#Region|#Country)"),n=this.not(t).splitAfter("@hasComma");return n=n.concat(t),n.sort("index"),n=n.match("#Place+"),"number"==typeof e&&(n=n.get(e)),n},za.organizations=function(e){let t=this.clauses();return t=t.match("#Organization+"),"number"==typeof e&&(t=t.get(e)),t},za.entities=function(e){let t=this.clauses(),n=t.people();return n=n.concat(t.places()),n=n.concat(t.organizations()),n=n.not(["someone","man","woman","mother","brother","sister","father"]),n.sort("sequence"),"number"==typeof e&&(n=n.get(e)),n},za.things=za.entities,za.topics=za.entities;var Ia=za;const Oa=/^(under|over)-?.{3}/,Ta=function(e,t,n){let r=n.words,a=e[t].reduced+" "+e[t+1].reduced;return void 0!==r[a]&&!0===r.hasOwnProperty(a)?(e[t].tag(r[a],"lexicon-two",n),e[t+1].tag(r[a],"lexicon-two",n),1):t+2<e.length&&(a+=" "+e[t+2].reduced,void 0!==r[a]&&!0===r.hasOwnProperty(a))?(e[t].tag(r[a],"lexicon-three",n),e[t+1].tag(r[a],"lexicon-three",n),e[t+2].tag(r[a],"lexicon-three",n),2):t+3<e.length&&(a+=" "+e[t+3].reduced,void 0!==r[a]&&!0===r.hasOwnProperty(a))?(e[t].tag(r[a],"lexicon-four",n),e[t+1].tag(r[a],"lexicon-four",n),e[t+2].tag(r[a],"lexicon-four",n),e[t+3].tag(r[a],"lexicon-four",n),3):0};var Va=function(e,t){let n=t.words,r=t.hasCompound;for(let a=0;a<e.length;a+=1){let i=e[a].clean;if(!0===r[i]&&a+1<e.length){let n=Ta(e,a,t);if(n>0){a+=n;continue}}if(void 0===n[i]||!0!==n.hasOwnProperty(i))if(i===e[a].reduced||!0!==n.hasOwnProperty(e[a].reduced)){if(!0===Oa.test(i)){let r=i.replace(/^(under|over)-?/,"");!0===n.hasOwnProperty(r)&&e[a].tag(n[r],"noprefix-lexicon",t)}}else e[a].tag(n[e[a].reduced],"lexicon",t);else e[a].tag(n[i],"lexicon",t)}return e};const Ma=/[\'`]$/,Ja=/^(m|k|cm|km|m)\/(s|h|hr)$/,La=[[/^[\w\.]+@[\w\.]+\.[a-z]{2,3}$/,"Email"],[/^#[a-z0-9_\u00C0-\u00FF]{2,}$/,"HashTag"],[/^@1?[0-9](am|pm)$/i,"Time"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time"],[/^@\w{2,}$/,"AtMention"],[/^(https?:\/\/|www\.)+\w+\.[a-z]{2,3}/,"Url"],[/^[a-z0-9./].+\.(com|net|gov|org|ly|edu|info|biz|dev|ru|jp|de|in|uk|br|io|ai)/,"Url"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time"],[/^[PMCE]ST$/,"Time"],[/^utc ?[+-]?[0-9]+?$/,"Time"],[/^[a-z0-9]*? o\'?clock$/,"Time"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}\/[0-9]{1,2}\/[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date"],[/^gmt[+-][0-9][0-9]?$/i,"Timezone"],[/^utc[+-][0-9][0-9]?$/i,"Timezone"],[/^ma?c\'.*/,"LastName"],[/^o\'[drlkn].*/,"LastName"],[/^ma?cd[aeiou]/,"LastName"],[/^(lol)+[sz]$/,"Expression"],[/^woo+a*?h?$/,"Expression"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^[-+]?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6][-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(k|m|b|bn)?\+?$/,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]\+?$/,["Money","Value"]],[/^[-+]?[\$]?[0-9]([0-9,.])+?(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"]],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"]],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"]],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"]],[/^[0-9.]{1,3}[a-z]{0,2}[-][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"]],[/^[0-9][0-9]?(:[0-9][0-9])?(am|pm)? ?[-] ?[0-9][0-9]?(:[0-9][0-9])?(am|pm)?$/,["Time","NumberRange"]],[/^[0-9.]+([a-z]{1,4})$/,"Value"]],Sa=/^[IVXLCDM]{2,}$/,_a=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,Ka="Adjective",qa="Infinitive",Wa="PresentTense",Ra="Singular",Ua="PastTense",Qa="Expression",Za="Adjective",Xa="Infinitive",Ya="PresentTense",en="Singular",tn="PastTense",rn="Adverb",an="Plural",nn="Verb",on="LastName",sn={a:[[/.[aeiou]na$/,"Noun"],[/.[oau][wvl]ska$/,"LastName"],[/.[^aeiou]ica$/,Ra],[/^([hyj]a)+$/,Qa]],c:[[/.[^aeiou]ic$/,Ka]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,Ua],[/.[aeo]{2}[bdgmnprvz]ed$/,Ua],[/.[aeiou][sg]hed$/,Ua],[/.[aeiou]red$/,Ua],[/.[aeiou]r?ried$/,Ua],[/.[bcdgtr]led$/,Ua],[/.[aoui]f?led$/,Ua],[/.[iao]sed$/,Ua],[/[aeiou]n?[cs]ed$/,Ua],[/[aeiou][rl]?[mnf]ed$/,Ua],[/[aeiou][ns]?c?ked$/,Ua],[/[aeiou][nl]?ged$/,Ua],[/.[tdbwxz]ed$/,Ua],[/[^aeiou][aeiou][tvx]ed$/,Ua],[/.[cdlmnprstv]ied$/,Ua],[/[^aeiou]ard$/,Ra],[/[aeiou][^aeiou]id$/,Ka],[/.[vrl]id$/,Ka]],e:[[/.[lnr]ize$/,qa],[/.[^aeiou]ise$/,qa],[/.[aeiou]te$/,qa],[/.[^aeiou][ai]ble$/,Ka],[/.[^aeiou]eable$/,Ka],[/.[ts]ive$/,Ka],[/[a-z]-like$/,Ka]],h:[[/.[^aeiouf]ish$/,Ka],[/.v[iy]ch$/,"LastName"],[/^ug?h+$/,Qa],[/^uh[ -]?oh$/,Qa],[/[a-z]-ish$/,Ka]],i:[[/.[oau][wvl]ski$/,"LastName"]],k:[[/^(k){2}$/,Qa]],l:[[/.[gl]ial$/,Ka],[/.[^aeiou]ful$/,Ka],[/.[nrtumcd]al$/,Ka],[/.[^aeiou][ei]al$/,Ka]],m:[[/.[^aeiou]ium$/,Ra],[/[^aeiou]ism$/,Ra],[/^h*u*m+$/,Qa],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,Ka],[/[^aeiou]ician$/,"Actor"],[/[aeiou][ktrp]in$/,"Gerund"]],o:[[/^no+$/,Qa],[/^(yo)+$/,Qa],[/^woo+[pt]?$/,Qa]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,Ra],[/[^i]fer$/,qa],[/.[^aeiou][ao]pher$/,"Actor"],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,Ka],[/[aeiou].*ist$/,Ka],[/^[a-z]et$/,"Verb"]],s:[[/.[^aeiou]ises$/,Wa],[/.[rln]ates$/,Wa],[/.[^z]ens$/,"Verb"],[/.[lstrn]us$/,Ra],[/.[aeiou]sks$/,Wa],[/.[aeiou]kes$/,Wa],[/[aeiou][^aeiou]is$/,Ra],[/[a-z]\'s$/,"Noun"],[/^yes+$/,Qa]],v:[[/.[^aeiou][ai][kln]ov$/,"LastName"]],y:[[/.[cts]hy$/,Ka],[/.[st]ty$/,Ka],[/.[gk]y$/,Ka],[/.[tnl]ary$/,Ka],[/.[oe]ry$/,Ra],[/[rdntkbhs]ly$/,"Adverb"],[/...lly$/,"Adverb"],[/[bszmp]{2}y$/,Ka],[/.(gg|bb|zz)ly$/,Ka],[/.[ai]my$/,Ka],[/[ea]{2}zy$/,Ka],[/.[^aeiou]ity$/,Ra]]},ln=[null,null,{ea:en,ia:"Noun",ic:Za,ly:rn,"'n":nn,"'t":nn},{oed:tn,ued:tn,xed:tn," so":rn,"'ll":"Modal","'re":"Copula",azy:Za,eer:"Noun",end:nn,ped:tn,ffy:Za,ify:Xa,ing:"Gerund",ize:Xa,lar:Za,mum:Za,nes:Ya,nny:Za,oid:Za,ous:Za,que:Za,rol:en,sis:en,zes:Ya},{amed:tn,aped:tn,ched:tn,lked:tn,nded:tn,cted:tn,dged:tn,akis:on,cede:Xa,chuk:on,czyk:on,ects:Ya,ends:nn,enko:on,ette:en,fies:Ya,fore:rn,gate:Xa,gone:Za,ices:an,ints:an,ines:an,ions:an,less:rn,llen:Za,made:Za,nsen:on,oses:Ya,ould:"Modal",some:Za,sson:on,tage:Xa,teen:"Value",tion:en,tive:Za,tors:"Noun",vice:en},{tized:tn,urned:tn,eased:tn,ances:an,bound:Za,ettes:an,fully:rn,ishes:Ya,ities:an,marek:on,nssen:on,ology:"Noun",ports:an,rough:Za,tches:Ya,tieth:"Ordinal",tures:an,wards:rn,where:rn},{auskas:on,keeper:"Actor",logist:"Actor",teenth:"Value"},{opoulos:on,borough:"Place",sdottir:on}],un=/^(\u00a9|\u00ae|[\u2319-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/,cn={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"<3":!0,"</3":!0,"<\\3":!0},hn={lexicon:Va,punctuation:function(e,t,n){let r=e[t];if(Ma.test(r.text)&&!Ma.test(r.pre)&&!Ma.test(r.post)&&r.clean.length>2){let e=r.clean[r.clean.length-2];if("s"===e)return void r.tag(["Possessive","Noun"],"end-tick",n);"n"===e&&r.tag(["Gerund"],"chillin",n)}Ja.test(r.text)&&r.tag("Unit","per-sec",n)},regex:function(e,t){let n=e.text;for(let r=0;r<La.length;r+=1)if(!0===La[r][0].test(n)){e.tagSafe(La[r][1],"prefix #"+r,t);break}e.text.length>=2&&Sa.test(n)&&_a.test(n)&&e.tag("RomanNumeral","xvii",t)},suffix:function(e,t){!function(e,t){const n=e.clean.length;let r=7;n<=r&&(r=n-1);for(let a=r;a>1;a-=1){let r=e.clean.substr(n-a,n);if(!0===ln[r.length].hasOwnProperty(r)){let n=ln[r.length][r];e.tagSafe(n,"suffix -"+r,t);break}}}(e,t),function(e,t){let n=e.clean,r=n[n.length-1];if(!0===sn.hasOwnProperty(r)){let a=sn[r];for(let i=0;i<a.length;i+=1)if(!0===a[i][0].test(n)){e.tagSafe(a[i][1],`endReg ${r} #${i}`,t);break}}}(e,t)},emoji:(e,t)=>{let n=e.pre+e.text+e.post;var r;n=n.trim(),n=n.replace(/[.!?,]$/,""),!0===(e=>!(":"!==e.charAt(0)||null===e.match(/:.?$/)||e.match(" ")||e.length>35))(n)&&(e.tag("Emoji","comma-emoji",t),e.text=n,e.pre=e.pre.replace(":",""),e.post=e.post.replace(":","")),e.text.match(un)&&(e.tag("Emoji","unicode-emoji",t),e.text=n),!0===(r=(r=n).replace(/^[:;]/,":"),cn.hasOwnProperty(r))&&(e.tag("Emoticon","emoticon-emoji",t),e.text=n)}};var dn=function(e,t){let n=e.world;hn.lexicon(t,n);for(let e=0;e<t.length;e+=1){let r=t[e];hn.punctuation(t,e,n),hn.regex(r,n),hn.suffix(r,n),hn.emoji(r,n)}return e};const gn={beforeThisWord:{there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},afterThisWord:{i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},beforeThisPos:{Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",Pluperfect:"Noun",PerfectTense:"Verb"},afterThisPos:{Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"}},pn=Object.keys(gn.afterThisPos),mn=Object.keys(gn.beforeThisPos);var fn=function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n];if(!0===r.isKnown())continue;let a=e[n-1];if(a){if(!0===gn.afterThisWord.hasOwnProperty(a.clean)){let e=gn.afterThisWord[a.clean];r.tag(e,"after-"+a.clean,t);continue}let e=pn.find((e=>a.tags[e]));if(void 0!==e){let n=gn.afterThisPos[e];r.tag(n,"after-"+e,t);continue}}let i=e[n+1];if(i){if(!0===gn.beforeThisWord.hasOwnProperty(i.clean)){let e=gn.beforeThisWord[i.clean];r.tag(e,"before-"+i.clean,t);continue}let e=mn.find((e=>i.tags[e]));if(void 0!==e){let n=gn.beforeThisPos[e];r.tag(n,"before-"+e,t);continue}}}};const bn=/^[A-Z][a-z'\u00C0-\u00FF]/,yn=/[0-9]/;var vn=function(e){let t=e.world;e.list.forEach((e=>{let n=e.terms();for(let e=1;e<n.length;e++){const r=n[e];!0===bn.test(r.text)&&!1===yn.test(r.text)&&void 0===r.tags.Date&&r.tag("ProperNoun","titlecase-noun",t)}}))};const wn=/^(re|un)-?[a-z\u00C0-\u00FF]/,kn=/^(re|un)-?/;var An=function(e,t){let n=t.words;e.forEach((e=>{if(!0!==e.isKnown()&&!0===wn.test(e.clean)){let r=e.clean.replace(kn,"");r&&r.length>3&&void 0!==n[r]&&!0===n.hasOwnProperty(r)&&e.tag(n[r],"stem-"+r,t)}}))};const Dn=["Uncountable","Pronoun","Place","Value","Person","Month","WeekDay","Holiday"],$n={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/s[aeiou]+ns$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/is$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i]},Pn=[/ss$/,/sis$/,/[^aeiou][uo]s$/,/'s$/],En=[/i$/,/ae$/];var Hn=function(e,t){if(e.tags.Noun&&!e.tags.Acronym){let n=e.clean;if(e.tags.Singular||e.tags.Plural)return;if(n.length<=3)return void e.tag("Singular","short-singular",t);if(Dn.find((t=>e.tags[t])))return;if($n.isPlural.find((e=>e.test(n))))return void e.tag("Plural","plural-rules",t);if($n.isSingular.find((e=>e.test(n))))return void e.tag("Singular","singular-rules",t);if(!0===/s$/.test(n)){if(Pn.find((e=>e.test(n))))return;return void e.tag("Plural","plural-fallback",t)}if(En.find((e=>e.test(n))))return;e.tag("Singular","singular-fallback",t)}};let jn=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce((function(e,t){return e[t]="Noun",e}),{});const Nn=function(e){return!(!e.tags.Noun||e.tags.Pronoun||e.tags.Comma||e.tags.Possessive||!(e.tags.Organization||e.tags.Acronym||e.tags.Place||e.titleCase()))},xn=/^[A-Z]('s|,)?$/,Fn=/([A-Z]\.){2}[A-Z]?/i,Cn={I:!0,A:!0},Bn={neighbours:fn,case:vn,stem:An,plural:Hn,organizations:function(e,t){for(let n=0;n<e.length;n+=1){let r=e[n];if(void 0!==jn[r.clean]&&!0===jn.hasOwnProperty(r.clean)){let a=e[n-1];if(void 0!==a&&!0===Nn(a)){a.tagSafe("Organization","org-word-1",t),r.tagSafe("Organization","org-word-2",t);continue}let i=e[n+1];if(void 0!==i&&"of"===i.clean&&e[n+2]&&Nn(e[n+2])){r.tagSafe("Organization","org-of-word-1",t),i.tagSafe("Organization","org-of-word-2",t),e[n+2].tagSafe("Organization","org-of-word-3",t);continue}}}},acronyms:function(e,t){e.forEach((e=>{!0!==e.tags.RomanNumeral&&(!0===Fn.test(e.text)&&e.tag("Acronym","period-acronym",t),e.isUpperCase()&&function(e,t){let n=e.reduced;return!!e.tags.Acronym||!t.words[n]&&!(n.length>5)&&e.isAcronym()}(e,t)?(e.tag("Acronym","acronym-step",t),e.tag("Noun","acronym-infer",t)):!Cn.hasOwnProperty(e.text)&&xn.test(e.text)&&(e.tag("Acronym","one-letter-acronym",t),e.tag("Noun","one-letter-infer",t)),e.tags.Organization&&e.text.length<=3&&e.tag("Acronym","acronym-org",t),e.tags.Organization&&e.isUpperCase()&&e.text.length<=6&&e.tag("Acronym","acronym-org-case",t))}))}};var Gn=function(e,t){let n=e.world;return Bn.neighbours(t,n),Bn.case(e),Bn.stem(t,n),t.forEach((t=>{!1===t.isKnown()&&t.tag("Noun","noun-fallback",e.world)})),Bn.organizations(t,n),Bn.acronyms(t,n),t.forEach((t=>{Bn.plural(t,e.world)})),e};const zn=/n't$/,In={"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],dont:["do","not"],dun:["do","not"]},On=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z]{1,2})$/i,Tn={ll:"will",ve:"have",re:"are",m:"am","n't":"not"},Vn={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],ive:["i","have"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],howd:["how","did"],whatd:["what","did"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]},Mn=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]s$/i,Jn={that:!0,there:!0},Ln={here:!0,there:!0,everywhere:!0},Sn=/[a-z\u00C0-\u00FF]'d$/,_n={how:!0,what:!0},Kn=/^([0-9.]{1,3}[a-z]{0,2}) ?[-] ?([0-9]{1,3}[a-z]{0,2})$/i,qn=/^([0-9][0-9]?(:[0-9][0-9])?(am|pm)?) ?[-] ?([0-9][0-9]?(:[0-9][0-9])?(am|pm)?)$/i,Wn=/^(l|c|d|j|m|n|qu|s|t)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z\u00C0-\u00FF]+)$/i,Rn={l:"le",c:"ce",d:"de",j:"je",m:"me",n:"ne",qu:"que",s:"se",t:"tu"},Un=Va,Qn=xt,Zn=function(e,t){return!0===In.hasOwnProperty(e.clean)?In[e.clean]:"ain't"===e.clean||"aint"===e.clean?function(e,t){let n=t.terms(),r=n.indexOf(e),a=n.slice(0,r).find((e=>e.tags.Noun));return a&&a.tags.Plural?["are","not"]:["is","not"]}(e,t):!0===zn.test(e.clean)?[e.clean.replace(zn,""),"not"]:null},Xn=function(e){let t=e.text.match(On);return null===t?null:Tn.hasOwnProperty(t[2])?[t[1],Tn[t[2]]]:null},Yn=function(e){return Vn.hasOwnProperty(e.clean)?Vn[e.clean]:null},ei=function(e,t,n){let r=e.text.match(Mn);if(null!==r){if(!0===((e,t)=>{if(e.tags.Possessive)return!0;if(e.tags.Pronoun||e.tags.QuestionWord)return!1;if(Jn.hasOwnProperty(e.reduced))return!1;let n=t.get(e.next);if(!n)return!0;if(n.tags.Verb)return!!n.tags.Infinitive||!!n.tags.PresentTense;if(n.tags.Noun)return!0!==Ln.hasOwnProperty(n.reduced);let r=t.get(n.next);return!(!r||!r.tags.Noun||r.tags.Pronoun)||(n.tags.Adjective||n.tags.Adverb||n.tags.Verb,!1)})(e,t.pool))return e.tag("#Possessive","isPossessive",n),null;if(null!==r)return((e,t)=>{let n=t.terms(),r=n.indexOf(e);return n.slice(r+1,r+3).find((e=>e.tags.PastTense))})(e,t)?[r[1],"has"]:[r[1],"is"]}return null},ti=function(e,t){if(Sn.test(e.clean)){let n=e.clean.replace(/'d$/,""),r=t.terms(),a=r.indexOf(e),i=r.slice(a+1,a+4);for(let e=0;e<i.length;e++){let t=i[e];if(t.tags.Verb)return t.tags.PastTense?[n,"had"]:!0===_n[n]?[n,"did"]:[n,"would"]}return[n,"would"]}return null},ri=function(e){if(!0===e.tags.PhoneNumber)return null;let t=e.text.match(Kn);return null!==t?[t[1],"to",t[2]]:(t=e.text.match(qn),null!==t?[t[1],"to",t[4]]:null)},ai=function(e){let t=e.text.match(Wn);if(null===t||!1===Rn.hasOwnProperty(t[1]))return null;let n=[Rn[t[1]],t[2]];return n[0]&&n[1]?n:null},ni=/^[0-9]+$/,ii=/^[0-9]+(st|nd|rd|th)$/,oi=/^[0-9:]+(am|pm)?$/,si=function(e,t){let n=Qn(e.join(" "),t.world,t.pool())[0],r=n.terms();Un(r,t.world);let a=r[0];return ii.test(a.text)&&r[2]?(r[0].tag("Ordinal","ord-range",t.world),r[2].tag("Ordinal","ord-range",t.world)):ni.test(a.text)&&r[2]?(r[0].tag("Cardinal","num-range",t.world),r[2].tag("Cardinal","num-range",t.world)):oi.test(a.text)&&r[1]&&r[2]&&(r[0].tag("Time","time-range",t.world),r[1].tag("Date","time-range",t.world),r[2].tag("Time","time-range",t.world)),r.forEach((e=>{e.implicit=e.text,e.text="",e.clean="",e.pre="",e.post="",0===Object.keys(e.tags).length&&(e.tags.Noun=!0)})),n};var li=function(e){let t=e.world;return e.list.forEach((n=>{let r=n.terms();for(let a=0;a<r.length;a+=1){let i=r[a],o=Zn(i,n);if(o=o||Xn(i),o=o||Yn(i),o=o||ei(i,n,t),o=o||ti(i,n),o=o||ri(i),o=o||ai(i),null!==o){let t=si(o,e);!0===n.has("#NumberRange")&&e.buildFrom([t]).tag("NumberRange"),t.terms(0).text=i.text,n.buildFrom(i.id,1,e.pool()).replace(t,e,!0)}}})),e};const ui=function(e,t){let n=e._cache.tags[t]||[];return n=n.map((t=>e.list[t])),e.buildFrom(n)};var ci=function(e){let t=ui(e,"Infinitive");return t.found&&(t=t.ifNo("@hasQuestionMark"),t=t.ifNo("(i|we|they)"),t.not("will be").match("[#Infinitive] (#Determiner|#Possessive) #Noun").notIf("(our|their)").match("#Infinitive").tag("Imperative","shut-the"),t.match("^[#Infinitive] #Adverb?$",0).tag("Imperative","go-fast"),t.match("[(do && #Infinitive)] not? #Verb",0).tag("Imperative","do-not"),t.match("[#Infinitive] (it|some) (#Comparative|#Preposition|please|now|again)",0).tag("Imperative","do-it")),t=function(e,t){let n=e._cache.words.like||[];return n=n.map((t=>e.list[t])),e.buildFrom(n)}(e),t.match("#Adverb like").notIf("(really|generally|typically|usually|sometimes|often|just) [like]").tag("Adverb","adverb-like"),t=ui(e,"Adjective"),t.match("#Determiner #Adjective$").notIf("(#Comparative|#Superlative)").terms(1).tag("Noun","the-adj-1"),t=ui(e,"FirstName"),t.match("#FirstName (#Noun|@titleCase)").ifNo("^#Possessive").ifNo("(#Pronoun|#Plural)").ifNo("@hasComma .").lastTerm().tag("#LastName","firstname-noun"),t=ui(e,"Value"),t=t.match("#Value #PresentTense").ifNo("#Copula"),t.found&&(!0===t.has("(one|1)")?t.terms(1).tag("Singular","one-presentTense"):t.terms(1).tag("Plural","value-presentTense")),e.match("^(well|so|okay)").tag("Expression","well-"),e.match("#Value [of a second]",0).unTag("Value","of-a-second"),e.match("#Value [seconds]",0).unTag("Value","30-seconds").tag(["Unit","Plural"]),t=ui(e,"Gerund"),t.match("(be|been) (#Adverb|not)+? #Gerund").not("#Verb$").tag("Auxiliary","be-walking"),e.match("(try|use|attempt|build|make) #Verb").ifNo("(@hasComma|#Negative|#PhrasalVerb|#Copula|will|be)").lastTerm().tag("#Noun","do-verb"),t=ui(e,"Possessive"),t=t.match("#Possessive [#Infinitive]",0),t.lookBehind("(let|made|make|force|ask)").found||t.tag("Noun","her-match"),e},hi=function(e){let t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;return Object.keys(t)},di=[{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"u r",tag:"Pronoun Copula",reason:"u r"},{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"#Noun #Actor",tag:"Actor",reason:"thing-doer"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Copula just [like]",group:0,tag:"Preposition",reason:"like-preposition"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"^how",tag:"QuestionWord",reason:"how-question"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"^which",tag:"QuestionWord",reason:"which-question"},{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"}],gi={adverbAdjective:["dark","bright","flat","light","soft","pale","dead","dim","faux","little","wee","sheer","most","near","good","extra","all"],personDate:["april","june","may","jan","august","eve"],personMonth:["january","april","may","june","jan","sep"],personAdjective:["misty","rusty","dusty","rich","randy","young"],personVerb:["pat","wade","ollie","will","rob","buck","bob","mark","jack"],personPlace:["darwin","hamilton","paris","alexandria","houston","kobe","santiago","salvador","sydney","victoria"],personNoun:["art","baker","berg","bill","brown","charity","chin","christian","cliff","daisy","dawn","dick","dolly","faith","franco","gene","green","hall","hill","holly","hope","jean","jewel","joy","kelvin","king","kitty","lane","lily","melody","mercedes","miles","olive","penny","ray","reed","robin","rod","rose","sky","summer","trinity","van","viola","violet","wang","white"]};const pi=`(${gi.personDate.join("|")})`;var mi=[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"this [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"next [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"last [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"[(march|may)] the? #Value",group:0,tag:"Month",reason:"march-5th"},{match:"#Value of? [(march|may)]",group:0,tag:"Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:`in [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`during [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`on [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:`by [${pi}]`,group:0,tag:"Date",reason:"by-june"},{match:`after [${pi}]`,group:0,tag:"Date",reason:"after-june"},{match:`#Date [${pi}]`,group:0,tag:"Date",reason:"in-june"},{match:pi+" #Value",tag:"Date",reason:"june-5th"},{match:pi+" #Date",tag:"Date",reason:"june-5th"},{match:pi+" #ProperNoun",tag:"Person",reason:"june-smith",safe:!0},{match:pi+" #Acronym? (#ProperNoun && !#Month)",tag:"Person",reason:"june-smith-jr"},{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}];const fi=`(${gi.personAdjective.join("|")})`;var bi=[{match:"[all] #Determiner? #Noun",group:0,tag:"Adjective",reason:"all-noun"},{match:`#Adverb [${fi}]`,group:0,tag:"Adjective",reason:"really-rich"},{match:fi+" #Person",tag:"Person",reason:"randy-smith"},{match:fi+" #Acronym? #ProperNoun",tag:"Person",reason:"rusty-smith"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"(a|an) [#Gerund]",group:0,tag:"Adjective",reason:"a|an"},{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(it|he|she|everything|something) #Adverb? was #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"it-was-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,tag:"Infinitive",reason:"shut-the"},{match:"the [said] #Noun",group:0,tag:"Adjective",reason:"the-said-card"},{match:"#Noun (that|which|whose) [#PastTense && !#Copula] #Noun",group:0,tag:"Adjective",reason:"that-past-noun"}],yi=[{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"(#Verb && !#Modal) (all|every|each|most|some|no) [#PresentTense]",group:0,tag:"Noun",reason:"all-presentTense"},{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adj-presentTense"},{match:"^#Adjective [#PresentTense]",group:0,tag:"Noun",reason:"start adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",reason:"many-poses"},{match:"#Adverb #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"very-big-dream"},{match:"#Adjective [#Infinitive] #Noun",group:0,tag:"Noun",reason:"good-wait-staff"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adorable-little-store"},{match:"#Preposition #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"of-basic-training"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",reason:"early-warning"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"higher-costs"},{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"(his|her|its) [#Adjective]",group:0,tag:"Noun",reason:"his-fine"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"more #Noun",tag:"Noun",reason:"more-noun"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",reason:"noun-list"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Noun",reason:"bit-2"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner #Adverb [#Infinitive]",group:0,tag:"Noun",reason:"the-reason"},{match:"(the|this|those|these) #Adjective [#Verb]",group:0,tag:"Noun",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)",group:0,tag:"Noun",reason:"the-adj-2"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner [#Infinitive] #Noun",group:0,tag:"Noun",reason:"determiner7"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"#Determiner [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",reason:"noun-of-noun"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"#Possessive [#Gerund]",group:0,tag:"Noun",reason:"her-polling"},{match:"(his|her|its) [#PresentTense]",group:0,tag:"Noun",reason:"its-polling"},{match:"(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun",group:0,tag:"Noun",reason:"technical-noun"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(the|those|these|a|an) #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"det-inf"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense]",group:0,tag:"Noun",reason:"det-pres"},{match:"(the|those|these|a|an) #Adjective? [#PastTense]",group:0,tag:"Noun",reason:"det-past"},{match:"(this|that) [#Gerund]",group:0,tag:"Noun",reason:"this-gerund"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(#Noun && @hasHyphen) #Verb",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"[#Verb] than",group:0,tag:"Noun",reason:"correction"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Noun [#Infinitive] (#Preposition|#Noun)",group:0,tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Copula [#Infinitive] #Noun",group:0,tag:"Noun",reason:"is-pres-noun"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"#Gerund #Adjective to [#Infinitive]",group:0,tag:"Noun",reason:"running-to"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"co #Noun",tag:"Actor",reason:"co-noun"},{match:"to #PresentTense #Noun [#PresentTense] #Preposition",group:0,tag:"Noun",reason:"gas-exchange"},{match:"a #Noun+ or #Adverb+? [#Verb]",group:0,tag:"Noun",reason:"noun-or-noun"},{match:"[#Gerund] system",group:0,tag:"Noun",reason:"operating-system"},{match:"#PastTense (until|as|through|without) [#PresentTense]",group:0,tag:"Noun",reason:"waited-until-release"},{match:"#Gerund like #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"like-hot-cakes"},{match:"some #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"some-reason"},{match:"for some [#PresentTense]",group:0,tag:"Noun",reason:"for-some-reason"},{match:"(same|some|the|that|a) kind of [#PresentTense]",group:0,tag:"Noun",reason:"some-kind-of"},{match:"(same|some|the|that|a) type of [#PresentTense]",group:0,tag:"Noun",reason:"some-type-of"},{match:"#Gerund #Adjective #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"doing-better-for-x"},{match:"(get|got|have|had) #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"got-better-aim"},{match:"#Pronoun #Infinitive [#Gerund] #PresentTense",group:0,tag:"Noun",reason:"tipping-sucks"}],vi=[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"(#Verb && !#Modal) [like]",group:0,tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"(#PresentTense && !#Copula) [(hard|quick|long|bright|slow|fast|backwards|forwards)]",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:`[(${gi.adverbAdjective.join("|")})] #Adjective`,group:0,tag:"Adverb",reason:"dark-green"},{match:"#Adverb [#Adverb]$",group:0,tag:"Adjective",reason:"kinda-sparkly"},{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"},{match:"[super] #Adjective #Noun",group:0,tag:"Adverb",reason:"super-strong"}],wi=[{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"(#Value|a) [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"a #Value",tag:"Value",reason:"a-value"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"(hundred|thousand|million|billion|trillion|quadrillion)+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"!once [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"}];const ki=`(${gi.personVerb.join("|")})`;var Ai=[{match:"[#Adjective] #Possessive #Noun",group:0,tag:"Verb",reason:"gerund-his-noun"},{match:"[#Adjective] (us|you)",group:0,tag:"Gerund",reason:"loving-you"},{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Gerund",reason:"slowly-adj"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"do (simply|just|really|not)+ [(#Adjective|like)]",group:0,tag:"Verb",reason:"do-simply-like"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"(this|that) [#Plural]",group:0,tag:"PresentTense",reason:"this-verbs"},{match:"[#Copula (#Adverb|not)+?] (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"#Adverb+? [(#Modal|did)+ (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|will|have|had)] (not|#Adverb)+? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? be (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"(#Modal|had|has) (#Adverb|not)+? been (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-foo"},{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"#PhrasalVerb [#PhrasalVerb]",group:0,tag:"Particle",reason:"phrasal-particle"},{match:"(lived|went|crept|go) [on] for",group:0,tag:"PhrasalVerb",reason:"went-on"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"},{match:"[will #Adverb? not? #Adverb? be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|to|toward)",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"will [#Adjective]",group:0,tag:"Verb",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [#Adjective] to #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"[#PresentTense] (are|were|was) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:`#Modal [${ki}]`,group:0,tag:"Verb",reason:"would-mark"},{match:`#Adverb [${ki}]`,group:0,tag:"Verb",reason:"really-mark"},{match:"(to|#Modal) [mark]",group:0,tag:"PresentTense",reason:"to-mark"},{match:"^[#Infinitive] (is|was)",group:0,tag:"Noun",reason:"checkmate-is"},{match:ki+" #Person",tag:"Person",reason:"rob-smith"},{match:ki+" #Acronym #ProperNoun",tag:"Person",reason:"rob-a-smith"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"},{match:"(become|fall|grow) #Adverb? [#PastTense]",group:0,tag:"Adjective",reason:"overly-weakened"},{match:"(a|an) #Adverb [#Participle] #Noun",group:0,tag:"Adjective",reason:"completely-beaten"},{match:"whose [#PresentTense] #Copula",group:0,tag:"Noun",reason:"whos-name-was"},{match:"#PhrasalVerb #PhrasalVerb #Preposition [#PresentTense]",group:0,tag:"Noun",reason:"given-up-on-x"}],Di=[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)",tag:"Region",reason:"foo-district"},{match:"(district|region|province|municipality|territory|burough|state) of #ProperNoun",tag:"Region",reason:"district-of-Foo"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"}];const $i=gi,Pi=`(${$i.personNoun.join("|")})`,Ei=`(${$i.personMonth.join("|")})`;var Hi=[{match:"[(1st|2nd|first|second)] #Honorific",group:0,tag:"Honorific",reason:"ordinal-honorific"},{match:"[(private|general|major|corporal|lord|lady|secretary|premier)] #Honorific? #Person",group:0,tag:"Honorific",reason:"ambg-honorifics"},{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(lady|queen|sister) #ProperNoun",tag:"FemaleName",reason:"lady-titlecase",safe:!0},{match:"(king|pope|father) #ProperNoun",tag:"MaleName",reason:"pope-titlecase",safe:!0},{match:"[(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill)] #LastName",group:0,tag:"FirstName",reason:"maybe-lastname"},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"NickName",reason:"first-noun-last"},{match:"#Possessive [#FirstName]",group:0,tag:"Person",reason:"possessive-name"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-latname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Honorific #Person",tag:"Person",reason:"honorific-person"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",reason:"saint-foo"},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)",tag:"Person",reason:"bill-green"},{match:Pi+" #Person",tag:"Person",reason:"ray-smith",safe:!0},{match:Pi+" #Acronym? #ProperNoun",tag:"Person",reason:"ray-a-smith",safe:!0},{match:`#Infinitive #Determiner? #Adjective? #Noun? (to|for) [${Ei}]`,group:0,tag:"Person",reason:"ambig-person"},{match:`#Infinitive [${Ei}]`,group:0,tag:"Person",reason:"infinitive-person"},{match:`[${Ei}] #Modal`,group:0,tag:"Person",reason:"ambig-modal"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:`#Modal [${Ei}]`,group:0,tag:"Person",reason:"modal-ambig"},{match:`#Copula [${Ei}]`,group:0,tag:"Person",reason:"is-may"},{match:`[${Ei}] #Copula`,group:0,tag:"Person",reason:"may-is"},{match:`that [${Ei}]`,group:0,tag:"Person",reason:"that-month"},{match:`with [${Ei}]`,group:0,tag:"Person",reason:"with-month"},{match:`for [${Ei}]`,group:0,tag:"Person",reason:"for-month"},{match:`this [${Ei}]`,group:0,tag:"Month",reason:"this-may"},{match:`next [${Ei}]`,group:0,tag:"Month",reason:"next-may"},{match:`last [${Ei}]`,group:0,tag:"Month",reason:"last-may"},{match:`#Date [${Ei}]`,group:0,tag:"Month",reason:"date-may"},{match:`[${Ei}] the? #Value`,group:0,tag:"Month",reason:"may-5th"},{match:`#Value of [${Ei}]`,group:0,tag:"Month",reason:"5th-of-may"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",reason:"title-de-title",safe:!0},{match:"#Singular #Acronym #LastName",tag:"#Person",reason:"title-acro-noun",safe:!0},{match:"#FirstName (#Noun && #ProperNoun) #ProperNoun?",tag:"Person",reason:"firstname-titlecase"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von) #Person]",group:0,tag:"LastName",reason:"de-firstname"},{match:`[(${$i.personPlace.join("|")})] (#ProperNoun && !#Place)`,group:0,tag:"FirstName",reason:"place-firstname"}];const ji=_e,Ni=hi;let xi=[];xi=xi.concat(di),xi=xi.concat(mi),xi=xi.concat(bi),xi=xi.concat(yi),xi=xi.concat(vi),xi=xi.concat(wi),xi=xi.concat(Ai),xi=xi.concat(Di),xi=xi.concat([{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"}]),xi=xi.concat(Hi);let Fi=[];xi.forEach((e=>{e.reg=ji(e.match);let t=function(e){let t=[];if(1===e.reg.filter((e=>void 0!==e.fastOr)).length){let n=e.reg.findIndex((e=>void 0!==e.fastOr));Object.keys(e.reg[n].fastOr).forEach((r=>{let a=Object.assign({},e);a.reg=a.reg.slice(0),a.reg[n]=Object.assign({},a.reg[n]),a.reg[n].word=r,delete a.reg[n].operator,delete a.reg[n].fastOr,t.push(a)}))}return t}(e);t.length>0?Fi=Fi.concat(t):Fi.push(e)})),Fi.forEach((e=>(e.required=function(e){let t=[],n=[];return e.forEach((e=>{!0!==e.optional&&!0!==e.negative&&(void 0!==e.tag&&t.push(e.tag),void 0!==e.word&&n.push(e.word))})),{tags:Ni(t),words:Ni(n)}}(e.reg),e)));const Ci=Fi,Bi=hi,Gi=ci,zi=function(e){Ci.forEach((t=>{let n=[];t.required.words.forEach((t=>{n.push(e._cache.words[t]||[])})),t.required.tags.forEach((t=>{n.push(e._cache.tags[t]||[])}));let r=function(e){if(0===e.length)return[];let t={};e.forEach((e=>{e=Bi(e);for(let n=0;n<e.length;n++)t[e[n]]=t[e[n]]||0,t[e[n]]+=1}));let n=Object.keys(t);return n=n.filter((n=>t[n]===e.length)),n=n.map((e=>Number(e))),n}(n);if(0===r.length)return;let a=r.map((t=>e.list[t])),i=e.buildFrom(a).match(t.reg,t.group);i.found&&(!0===t.safe?i.tagSafe(t.tag,t.reason):i.tag(t.tag,t.reason))}))},Ii=dn,Oi=Gn,Ti=li,Vi=function(e){return zi(e),Gi(e),e};var Mi=function(e){let t=e.termList();return e=Ii(e,t),e=Oi(e,t),(e=Ti(e)).cache(),(e=Vi(e)).uncache(),e.world.taggers.forEach((t=>{t(e)})),e},Ji=function(e){class t extends e{stripPeriods(){return this.termList().forEach((e=>{!0===e.tags.Abbreviation&&e.next&&(e.post=e.post.replace(/^\./,""));let t=e.text.replace(/\./,"");e.set(t)})),this}addPeriods(){return this.termList().forEach((e=>{e.post=e.post.replace(/^\./,""),e.post="."+e.post})),this}}return t.prototype.unwrap=t.prototype.stripPeriods,e.prototype.abbreviations=function(e){let n=this.match("#Abbreviation");return"number"==typeof e&&(n=n.get(e)),new t(n.list,this,this.world)},e};const Li=/\./;var Si=function(e){class t extends e{stripPeriods(){return this.termList().forEach((e=>{let t=e.text.replace(/\./g,"");e.set(t)})),this}addPeriods(){return this.termList().forEach((e=>{let t=e.text.replace(/\./g,"");t=t.split("").join("."),!1===Li.test(e.post)&&(t+="."),e.set(t)})),this}}return t.prototype.unwrap=t.prototype.stripPeriods,t.prototype.strip=t.prototype.stripPeriods,e.prototype.acronyms=function(e){let n=this.match("#Acronym");return"number"==typeof e&&(n=n.get(e)),new t(n.list,this,this.world)},e},_i=function(e){return e.prototype.clauses=function(t){let n=this.if("@hasComma").notIf("@hasComma @hasComma").notIf("@hasComma . .? (and|or) .").notIf("(#City && @hasComma) #Country").notIf("(#WeekDay && @hasComma) #Date").notIf("(#Date && @hasComma) #Year").notIf("@hasComma (too|also)$").match("@hasComma"),r=this.splitAfter(n),a=r.quotations();r=r.splitOn(a);let i=r.parentheses();r=r.splitOn(i);let o=r.if("#Copula #Adjective #Conjunction (#Pronoun|#Determiner) #Verb").match("#Conjunction");r=r.splitBefore(o);let s=r.if("if .{2,9} then .").match("then");r=r.splitBefore(s),r=r.splitBefore("as well as ."),r=r.splitBefore("such as ."),r=r.splitBefore("in addition to ."),r=r.splitAfter("@hasSemicolon"),r=r.splitAfter("@hasDash");let l=r.filter((e=>e.wordCount()>5&&e.match("#Verb+").length>=2));if(l.found){let e=l.splitAfter("#Noun .* #Verb .* #Noun+");r=r.splitOn(e.eq(0))}return"number"==typeof t&&(r=r.get(t)),new e(r.list,this,this.world)},e},Ki=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.contracted=null}expand(){return this.list.forEach((e=>{let t=e.terms(),n=t[0].isTitleCase();t.forEach(((e,n)=>{e.set(e.implicit||e.text),e.implicit=void 0,n<t.length-1&&""===e.post&&(e.post+=" ")})),n&&t[0].toTitleCase()})),this}}return e.prototype.contractions=function(e){let n=this.match("@hasContraction+");return"number"==typeof e&&(n=n.get(e)),new t(n.list,this,this.world)},e.prototype.expanded=e.prototype.isExpanded,e.prototype.contracted=e.prototype.isContracted,e},qi=function(e){const t=function(e){let t=e.splitAfter("@hasComma").splitOn("(and|or) not?").not("(and|or) not?"),n=e.match("[.] (and|or)",0);return{things:t,conjunction:e.match("(and|or) not?"),beforeLast:n,hasOxford:n.has("@hasComma")}};class n extends e{conjunctions(){return this.match("(and|or)")}parts(){return this.splitAfter("@hasComma").splitOn("(and|or) not?")}items(){return t(this).things}add(e){return this.forEach((n=>{let r=t(n).beforeLast;r.append(e),r.termList(0).addPunctuation(",")})),this}remove(e){return this.items().if(e).remove()}hasOxfordComma(){return this.filter((e=>t(e).hasOxford))}addOxfordComma(){let e=this.items(),t=e.eq(e.length-2);return t.found&&!1===t.has("@hasComma")&&t.post(", "),this}removeOxfordComma(){let e=this.items(),t=e.eq(e.length-2);return t.found&&!0===t.has("@hasComma")&&t.post(" "),this}}return n.prototype.things=n.prototype.items,e.prototype.lists=function(e){let t=this.if("@hasComma+ .? (and|or) not? ."),r=t.match("(#Noun|#Adjective|#Determiner|#Article)+ #Conjunction not? (#Article|#Determiner)? #Adjective? #Noun+").if("#Noun"),a=t.match("(#Adjective|#Adverb)+ #Conjunction not? #Adverb? #Adjective+"),i=t.match("(#Verb|#Adverb)+ #Conjunction not? #Adverb? #Verb+"),o=r.concat(a);return o=o.concat(i),o=o.if("@hasComma"),"number"==typeof e&&(o=t.get(e)),new n(o.list,this,this.world)},e};const Wi={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},Ri={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},Ui=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i],Qi={isSingular:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],isPlural:[/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/men$/i,/.tia$/i,/(m|l)ice$/i]},Zi=/s$/,Xi={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"},Yi=function(e){return!0===e.has("#Plural")||!0!==e.has("(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)")},eo=function(e){if(e.has("#Person")||e.has("#Place"))return"";if(e.has("#Plural"))return"the";let t=e.text("normal").trim();if(Wi.hasOwnProperty(t))return Wi[t];let n=t.substr(0,1);if(e.has("^@isAcronym")&&Ri.hasOwnProperty(n))return"an";for(let e=0;e<Ui.length;e++)if(Ui[e].test(t))return"a";return/^[aeiou]/i.test(t)?"an":"a"},to=function(e){return!Qi.isSingular.find((t=>t.test(e)))&&(!0===Zi.test(e)||!!Qi.isPlural.find((t=>t.test(e)))||null)},ro=function(e){let t=e.text("text").trim();return Xi.hasOwnProperty(t)?(e.replaceWith(Xi[t],!0),void e.tag("Possessive","toPossessive")):/s$/.test(t)?(t+="'",e.replaceWith(t,!0),void e.tag("Possessive","toPossessive")):(t+="'s",e.replaceWith(t,!0),void e.tag("Possessive","toPossessive"))},ao=function(e){let t={main:e};if(e.has("#Noun (of|by|for) .")){let n=e.splitAfter("[#Noun+]",0);t.main=n.eq(0),t.post=n.eq(1)}return t},no={json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0];r.article=eo(t),n.push(r)})),null!==t?n[t]:n},adjectives:function(){let e=this.lookAhead("^(that|who|which)? (was|is|will)? be? #Adverb? #Adjective+");return e=e.concat(this.lookBehind("#Adjective+ #Adverb?$")),e=e.match("#Adjective"),e.sort("index")},isPlural:function(){return this.if("#Plural")},hasPlural:function(){return this.filter((e=>Yi(e)))},toPlural:function(e){let t=this.world.transforms.toPlural;return this.forEach((n=>{if(n.has("#Plural")||!1===Yi(n))return;let r=ao(n).main,a=r.text("reduced");if((r.has("#Singular")||!0!==to(a))&&(a=t(a,this.world),r.replace(a).tag("#Plural"),e)){let e=r.lookBefore("(an|a) #Adjective?$").not("#Adjective");!0===e.found&&e.remove()}})),this},toSingular:function(e){let t=this.world.transforms.toSingular;return this.forEach((n=>{if(n.has("^#Singular+$")||!1===Yi(n))return;let r=ao(n).main,a=r.text("reduced");if((r.has("#Plural")||!0===to(a))&&(a=t(a,this.world),r.replace(a).tag("#Singular"),e)){let e=n,t=n.lookBefore("#Adjective");t.found&&(e=t);let r=eo(e);e.insertBefore(r)}})),this},toPossessive:function(){return this.forEach((e=>{ro(e)})),this}};var io=function(e){class t extends e{}return Object.assign(t.prototype,no),e.prototype.nouns=function(e,n={}){let r=this.match("(#City && @hasComma) (#Region|#Country)"),a=this.not(r).splitAfter("@hasComma");a=a.concat(r);let i=a.quotations();return i.found&&(a=a.splitOn(i.eq(0))),a=a.match("#Noun+ (of|by)? the? #Noun+?"),!0!==n.keep_anaphora&&(a=a.not("#Pronoun"),a=a.not("(there|these)"),a=a.not("(#Month|#WeekDay)"),a=a.not("(my|our|your|their|her|his)")),a=a.not("(of|for|by|the)$"),"number"==typeof e&&(a=a.get(e)),new t(a.list,this,this.world)},e};const oo=/\(/,so=/\)/;var lo=function(e){class t extends e{unwrap(){return this.list.forEach((e=>{let t=e.terms(0);t.pre=t.pre.replace(oo,"");let n=e.lastTerm();n.post=n.post.replace(so,"")})),this}}return e.prototype.parentheses=function(e){let n=[];return this.list.forEach((e=>{let t=e.terms();for(let r=0;r<t.length;r+=1){const a=t[r];if(oo.test(a.pre))for(let i=r;i<t.length;i+=1)if(so.test(t[i].post)){let t=i-r+1;n.push(e.buildFrom(a.id,t)),r=i;break}}})),"number"==typeof e?(n=n[e]?[n[e]]:[],new t(n,this,this.world)):new t(n,this,this.world)},e},uo=function(e){class t extends e{constructor(e,t,n){super(e,t,n),this.contracted=null}strip(){return this.list.forEach((e=>{e.terms().forEach((e=>{let t=e.text.replace(/'s$/,"");e.set(t||e.text)}))})),this}}return e.prototype.possessives=function(e){let n=this.match("#Noun+? #Possessive");return"number"==typeof e&&(n=n.get(e)),new t(n.list,this,this.world)},e};const co={'"':'"',"":"","'":"'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","`":"","":""},ho=RegExp("("+Object.keys(co).join("|")+")");var go=function(e){class t extends e{unwrap(){return this}}return e.prototype.quotations=function(e){let n=[];return this.list.forEach((e=>{let t=e.terms();for(let r=0;r<t.length;r+=1){const a=t[r];if(ho.test(a.pre)){let i=(a.pre.match(ho)||[])[0],o=co[i];for(let i=r;i<t.length;i+=1)if(-1!==t[i].post.indexOf(o)){let t=i-r+1;n.push(e.buildFrom(a.id,t)),r=i;break}}}})),"number"==typeof e?(n=n[e]?[n[e]]:[],new t(n,this,this.world)):new t(n,this,this.world)},e.prototype.quotes=e.prototype.quotations,e},po=function(e,t){let n=e.verb,r=n.text("reduced");if(n.has("#Infinitive"))return r;let a=null;return n.has("#PastTense")?a="PastTense":n.has("#Gerund")?a="Gerund":n.has("#PresentTense")?a="PresentTense":n.has("#Participle")?a="Participle":n.has("#Actor")&&(a="Actor"),t.transforms.toInfinitive(r,t,a)},mo=function(e){let t=e.verb;if(t.has("(are|were|does)")||e.auxiliary.has("(are|were|does)"))return!0;let n=function(e){return e.lookBehind("#Noun+").last()}(t);return!n.has("(he|she|many|both)")&&(!!n.has("(we|they|you|i)")||!n.has("#Person")&&(!!n.has("#Plural")||!n.has("#Singular")&&!t.has("(is|am|do|was)")&&!(e.auxiliary.has("(is|am|do|was)")&&!e.negative.found)&&null))};const fo=po,bo=mo;var yo=function(e){let t=e.lookBehind(),n=t.nouns(null,{keep_anaphora:!0}).last();return n.found||(n=t.match("(that|this|each)").last(),n=n.tag("#Noun").nouns()),n};const vo=yo,wo=mo,ko=po,Ao=e=>{let t=!1,n=wo(e),r=e.negative.found;e.verb.lookBehind("i (#Adverb|#Verb)?$").found&&(t=!0);let a={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return n&&(a.PastTense="were",a.PresentTense="are",a.Infinitive="are"),!0===t&&(a.PastTense="was",a.PresentTense="am",a.Infinitive="am"),r&&(a.PastTense+=" not",a.PresentTense+=" not",a.FutureTense="will not be",a.Infinitive+=" not",a.PerfectTense="not "+a.PerfectTense,a.Pluperfect="not "+a.Pluperfect,a.Gerund="not "+a.Gerund),a},Do=function(e){let t=e.verb.text();return{PastTense:t+" have",PresentTense:t,FutureTense:t,Infinitive:t}},$o=mo;var Po=function(e,t){let n=e.verb;if(n.has("#Copula")||"be"===n.out("normal")&&e.auxiliary.has("will"))return Ao(e);if(e.auxiliary.has("are")&&n.has("#Gerund")){let n=e.original.clone(),r=n.clone().replace("are","were"),a=n.clone().replace("are","will be"),i=ko(e,t);return{PastTense:r.text(),PresentTense:n.text(),FutureTense:a.text(),Infinitive:i}}if(n.has("#Modal"))return Do(e);let r=ko(e,t);if(!r)return{};let a=t.transforms.conjugate(r,t);a.Infinitive=r;let i=$o(e);!0===i&&(a.PresentTense=a.Infinitive);let o=e.verb.termList(0).hasHyphen();if(e.particle.found){let t=e.particle.text(),n=!0===o?"-":" ";Object.keys(a).forEach((e=>a[e]+=n+t))}const s=e.negative.found;return a.FutureTense=a.FutureTense||"will "+a.Infinitive,s&&(a.PastTense="did not "+a.Infinitive,a.FutureTense="will not "+a.Infinitive,i?(a.PresentTense="do not "+a.Infinitive,a.Infinitive="do not "+a.Infinitive):(a.PresentTense="does not "+a.Infinitive,a.Infinitive="does not "+a.Infinitive),a.Gerund="not "+a.Gerund),a};const Eo=Po;var Ho={useParticiple:function(e){return!!e.auxiliary.has("(could|should|would|may|can|must)")||!!e.auxiliary.has("am .+? being")||!!e.auxiliary.has("had .+? been")},toParticiple:function(e,t){if(e.auxiliary.has("(have|had)")&&e.verb.has("#Participle"))return;let n=Eo(e,t),r=n.Participle||n.PastTense;r&&e.verb.replaceWith(r,!1),e.auxiliary.has("am .+? being")&&(e.auxiliary.remove("am"),e.auxiliary.replace("being","have been")),e.auxiliary.has("have")||e.auxiliary.append("have"),e.verb.tag("Participle","toParticiple"),e.auxiliary.replace("can","could"),e.auxiliary.replace("be have","have been"),e.auxiliary.replace("not have","have not"),e.auxiliary.tag("Auxiliary")}};const jo=function(e,t){let n=e.verb;if(!e.negative.found){if(e.auxiliary.found)return e.auxiliary.eq(0).append("not"),void(e.auxiliary.has("#Modal have not")&&e.auxiliary.replace("have not","not have"));if(n.has("(#Copula|will|has|had|do)"))n.append("not");else{if(n.has("#PastTense")){let r=fo(e,t);return n.replaceWith(r,!0),void n.prepend("did not")}if(n.has("#PresentTense")){let r=fo(e,t);return n.replaceWith(r,!0),void(bo(e)?n.prepend("do not"):n.prepend("does not"))}if(n.has("#Gerund")){let r=fo(e,t);return n.replaceWith(r,!0),void n.prepend("not")}bo(e)?n.prepend("does not"):n.prepend("do not")}}},No=function(e){let t={adverb:e.match("#Adverb+"),negative:e.match("#Negative"),auxiliary:e.match("#Auxiliary+").not("(#Negative|#Adverb)"),particle:e.match("#Particle"),verb:e.match("#Verb+").not("(#Adverb|#Negative|#Auxiliary|#Particle)"),original:e,subject:vo(e)};if(t.verb.has("(#PresentTense|#PastTense|#Infinitive) #Gerund$")&&(t.verb=t.verb.not("#Gerund$")),!t.verb.found)return Object.keys(t).forEach((e=>{t[e]=t[e].not(".")})),t.verb=e,t;if(t.adverb&&t.adverb.found){let n=t.adverb.text("reduced")+"$";e.has(n)&&(t.adverbAfter=!0)}return t},xo=mo,Fo=yo,Co=Po,{toParticiple:Bo,useParticiple:Go}=Ho,zo=function(e){return e.auxiliary.remove("(will|are|am|being)"),e.auxiliary.remove("(did|does)"),e.auxiliary.remove("(had|has|have)"),e.particle.remove(),e.negative.remove(),e},Io={json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0],a=No(t);r.parts={},Object.keys(a).forEach((e=>{a[e]&&"Doc"===a[e].isA?r.parts[e]=a[e].text("normal"):r.parts[e]=a[e]})),r.isNegative=t.has("#Negative"),r.conjugations=Co(a,this.world),n.push(r)})),null!==t?n[t]:n},adverbs:function(){let e=[];this.forEach((t=>{let n=No(t).adverb;n.found&&(e=e.concat(n.list))}));let t=this.lookBehind("#Adverb+$");return t.found&&(e=t.list.concat(e)),t=this.lookAhead("^#Adverb+"),t.found&&(e=e.concat(t.list)),this.buildFrom(e)},isPlural:function(){let e=[];return this.forEach((t=>{let n=No(t);!0===xo(n,this.world)&&e.push(t.list[0])})),this.buildFrom(e)},isSingular:function(){let e=[];return this.forEach((t=>{let n=No(t);!1===xo(n,this.world)&&e.push(t.list[0])})),this.buildFrom(e)},conjugate:function(){let e=[];return this.forEach((t=>{let n=No(t),r=Co(n,this.world);e.push(r)})),e},toPastTense:function(){return this.forEach((e=>{let t=No(e);if(Go(t))return void Bo(t,this.world);if(e.has("#Imperative"))return;if(e.has("be")&&e.lookBehind("to$").found)return;if(t.verb.has("#Gerund")&&t.auxiliary.has("(is|will|was)"))return void e.replace("is","was");let n=Co(t,this.world).PastTense;n&&(t=zo(t),t.verb.replaceWith(n,!1),t.auxiliary.remove("(do|did|will)"))})),this},toPresentTense:function(){return this.forEach((e=>{if(e.has("#Imperative"))return;let t=No(e),n=Co(t,this.world),r=n.PresentTense;if(e.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(r=n.Infinitive),r){if(t.auxiliary.has("(have|had) been"))return t.auxiliary.replace("(have|had) been","am being"),void(n.Particle&&(r=n.Particle||n.PastTense));t.verb.replaceWith(r,!1),t.verb.tag("PresentTense"),t=zo(t),t.auxiliary.remove("#Modal"),t.auxiliary.remove("(do|did|will)")}})),this},toFutureTense:function(){return this.forEach((e=>{let t=No(e);if(Go(t))return;if(e.has("#Imperative"))return;let n=Co(t,this.world).FutureTense;n&&(t=zo(t),t.auxiliary.remove("#Modal"),t.verb.replaceWith(n,!1),t.verb.tag("FutureTense"),t.auxiliary.remove("(do|did|will)"))})),this},toInfinitive:function(){return this.forEach((e=>{let t=No(e),n=Co(t,this.world).Infinitive;n&&(e.replaceWith(n,!1),e.tag("Infinitive"))})),this},toGerund:function(){return this.forEach((e=>{let t=No(e),n=Co(t,this.world).Gerund;n&&(e.replaceWith(n,!1),e.tag("Gerund"))})),this},toParticiple:function(){return this.forEach((e=>{let t=No(e),n=!t.auxiliary.found;Bo(t,this.world),n&&(t.verb.prepend(t.auxiliary.text()),t.auxiliary.remove())})),this},isNegative:function(){return this.if("#Negative")},isPositive:function(){return this.ifNo("#Negative")},isImperative:function(){return this.if("#Imperative")},toNegative:function(){return this.list.forEach((e=>{let t=this.buildFrom([e]),n=No(t);jo(n,t.world)})),this},toPositive:function(){let e=this.match("do not #Verb");return e.found&&e.remove("do not"),this.remove("#Negative")},subject:function(){let e=[];return this.forEach((t=>{let n=Fo(t);n.list[0]&&e.push(n.list[0])})),this.buildFrom(e)}},Oo=Ia,To=[Ji,Si,_i,Ki,qi,io,lo,uo,go,function(e){class t extends e{}return Object.assign(t.prototype,Io),t.prototype.negate=t.prototype.toNegative,e.prototype.verbs=function(e){let n=this.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+");n=n.not("^#Adverb+"),n=n.not("#Adverb+$");let r=n.match("(#Adverb && @hasComma) #Adverb"),a=n.not(r).splitAfter("@hasComma");return a=a.concat(r),a.sort("index"),a=a.if("#Verb"),a.has("(is|was)$")&&(a=a.splitBefore("(is|was)$")),a.has("#PresentTense #Adverb #PresentTense")&&(a=a.splitBefore("#Adverb #PresentTense")),"number"==typeof e&&(a=a.get(e)),new t(a.list,this,this.world)},e},function(e){class t extends e{}return e.prototype.people=function(e){let n=this.splitAfter("@hasComma");return n=n.match("#Person+"),"number"==typeof e&&(n=n.get(e)),new t(n.list,this,this.world)},e}],Vo={misc:Ga,selections:Ia},Mo=Mi,Jo=xt,Lo=function(e){return Object.keys(Oo).forEach((t=>e.prototype[t]=Oo[t])),To.forEach((t=>t(e))),e};class So{constructor(e,t,n){this.list=e,Object.defineProperty(this,"from",{enumerable:!1,value:t,writable:!0}),void 0===n&&void 0!==t&&(n=t.world),Object.defineProperty(this,"world",{enumerable:!1,value:n,writable:!0}),Object.defineProperty(this,"_cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"found",{get:()=>this.list.length>0}),Object.defineProperty(this,"length",{get:()=>this.list.length}),Object.defineProperty(this,"isA",{get:()=>"Doc"})}tagger(){return Mo(this)}pool(){return this.list.length>0?this.list[0].pool:this.all().list[0].pool}}So.prototype.buildFrom=function(e){return e=e.map((e=>e.clone(!0))),new So(e,this,this.world)},So.prototype.fromText=function(e){let t=Jo(e,this.world,this.pool());return this.buildFrom(t)},Object.assign(So.prototype,Vo.misc),Object.assign(So.prototype,Vo.selections),Lo(So);const _o={untag:"unTag",and:"match",notIf:"ifNo",only:"if",onlyIf:"if"};Object.keys(_o).forEach((e=>So.prototype[e]=So.prototype[_o[e]]));const Ko=Va,qo=xt,Wo=zt,Ro=So,Uo=nt,Qo=ne$1,Zo=ot,Xo=function(e){let t=e.termList();return Ko(t,e.world),e.world.taggers.forEach((t=>{t(e)})),e},Yo=_e;var es=function e(t){let n=t;const r=function(e="",t){t&&n.addWords(t);let r=qo(e,n),a=new Ro(r,null,n);return a.tagger(),a};return r.tokenize=function(e="",t){let r=n;t&&(r=r.clone(),r.words={},r.addWords(t));let a=qo(e,r),i=new Ro(a,null,r);return(t||i.world.taggers.length>0)&&Xo(i),i},r.extend=function(e){return e(Ro,n,this,Uo,Qo,Zo),this},r.fromJSON=function(e){let t=Wo(e,n);return new Ro(t,null,n)},r.clone=function(){return e(n.clone())},r.verbose=function(e=!0){return n.verbose(e),this},r.world=function(){return n},r.parseMatch=function(e,t){return Yo(e,t)},r.version="13.11.4",r.import=r.load,r.plugin=r.extend,r}(new Rr),e=function(e,t){let n=e.match("#Value+? #Money+ #Currency+ (and #Money+ #Currency+)+?");return e.match("#Money").forEach((e=>{e.lookAfter("#Currency").found||(n=n.concat(e))})),"number"==typeof t&&(n=n.get(t)),n};const n="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty";var t=function(e,t){let r=e.match("#Value+");if(r.has("#NumericValue #NumericValue")&&(r.has("#Value @hasComma #Value")?r.splitAfter("@hasComma"):r.has("#NumericValue #Fraction")?r.splitAfter("#NumericValue #Fraction"):r=r.splitAfter("#NumericValue")),r.has("#Value #Value #Value")&&!r.has("#Multiple")&&r.has("("+n+") #Cardinal #Cardinal")&&(r=r.splitAfter("("+n+") #Cardinal")),r.has("#Value #Value")){r.has("#NumericValue #NumericValue")&&(r=r.splitOn("#Year")),r.has("("+n+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&&(r=r.splitAfter("("+n+")"));let e=r.match("#Cardinal #Cardinal");if(e.found&&!r.has("(point|decimal|#Fraction)")&&!e.has("#Cardinal (#Multiple|point|decimal)")){let t=r.has(`(one|two|three|four|five|six|seven|eight|nine) (${n})`),a=e.has("("+n+") #Cardinal"),i=e.has("#Multiple #Value");t||a||i||e.terms().forEach((e=>{r=r.splitOn(e)}))}r.match("#Ordinal #Ordinal").match("#TextValue").found&&!r.has("#Multiple")&&(r.has("("+n+") #Ordinal")||(r=r.splitAfter("#Ordinal"))),r.has("#Ordinal #Cardinal")&&(r=r.splitBefore("#Cardinal+")),r.has("#TextValue #NumericValue")&&!r.has("("+n+"|#Multiple)")&&(r=r.splitBefore("#NumericValue+"))}return r.has("#NumberRange")&&(r=r.splitAfter("#NumberRange")),"number"==typeof t&&(r=r.get(t)),r},r=function(e,t){let n=e.match("#Fraction+");return n=n.filter((e=>!e.lookBehind("#Value and$").found)),"number"==typeof t&&(n=n.eq(t)),n},a=function(e,t){let n=e.match("#Percent+");return n=n.concat(e.match("[#Cardinal] percent",0)),"number"==typeof t&&(n=n.eq(t)),n},i={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}};const s=i,o=i,u=e=>{const t=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}];for(let n=0;n<t.length;n++)if(!0===t[n].reg.test(e))return{amount:t[n].mult,str:e.replace(t[n].reg,"")};return{amount:1,str:e}},l=i,m=(e,t)=>{if(s.ones.hasOwnProperty(e)){if(t.ones||t.teens)return!1}else if(s.teens.hasOwnProperty(e)){if(t.ones||t.teens||t.tens)return!1}else if(s.tens.hasOwnProperty(e)&&(t.ones||t.teens||t.tens))return!1;return!0},c$1=function(e){let t="0.";for(let n=0;n<e.length;n++){let r=e[n];if(!0===o.ones.hasOwnProperty(r))t+=o.ones[r];else if(!0===o.teens.hasOwnProperty(r))t+=o.teens[r];else if(!0===o.tens.hasOwnProperty(r))t+=o.tens[r];else{if(!0!==/^[0-9]$/.test(r))return 0;t+=r}}return parseFloat(t)},h=e=>(e=(e=(e=(e=(e=(e=(e=e.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$]/,"")).replace(/[%$]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),f=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,d={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},y=e=>Object.keys(e).reduce(((t,n)=>t+e[n]),0);var p=function(e){if(!0===d.hasOwnProperty(e))return d[e];if("a"===e||"an"===e)return 1;const t=u(e);let n=null,r={},a=0,i=!1;const o=(e=t.str).split(/[ -]/);for(let e=0;e<o.length;e++){let s=o[e];if(s=h(s),!s||"and"===s)continue;if("-"===s||"negative"===s){i=!0;continue}if("-"===s.charAt(0)&&(i=!0,s=s.substr(1)),"point"===s)return a+=y(r),a+=c$1(o.slice(e+1,o.length)),a*=t.amount,a;const u=s.match(f);if(u){const e=parseFloat(u[1].replace(/[, ]/g,"")),t=parseFloat(u[2].replace(/[, ]/g,""));t&&(a+=e/t||0)}else{if(l.tens.hasOwnProperty(s)&&r.ones&&1===Object.keys(r).length&&(a=100*r.ones,r={}),!1===m(s,r))return null;if(/^[0-9\.]+$/.test(s))r.ones=parseFloat(s);else if(!0===l.ones.hasOwnProperty(s))r.ones=l.ones[s];else if(!0===l.teens.hasOwnProperty(s))r.teens=l.teens[s];else if(!0===l.tens.hasOwnProperty(s))r.tens=l.tens[s];else if(!0===l.multiples.hasOwnProperty(s)){let t=l.multiples[s];if(t===n)return null;if(100===t&&void 0!==o[e+1]){const n=o[e+1];l.multiples[n]&&(t*=l.multiples[n],e+=1)}null===n||t<n?(a+=(y(r)||1)*t,n=t,r={}):(a+=y(r),n=t,a=(a||1)*t,r={})}}}return a+=y(r),a*=t.amount,a*=i?-1:1,0===a&&0===Object.keys(r).length?null:a};const b=/s$/,g=p,x=function(e){let t=e.text("reduced");return g(t)};let $={half:2,halve:2,quarter:4};var v=function(e){let t=function(e){let t=e.text("reduced");return $.hasOwnProperty(t)?{numerator:1,denominator:$[t]}:null}(e=e.clone())||function(e){let t=e.text("reduced").match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return t&&t[1]&&t[0]?{numerator:Number(t[1]),denominator:Number(t[2])}:null}(e)||function(e){let t=e.match("[<num>#Value+] out of every? [<den>#Value+]");if(!0!==t.found)return null;let{num:n,den:r}=t.groups();return n&&r?(n=x(n),r=x(r),"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null):null}(e)||function(e){let t=e.match("[<num>(#Cardinal|a)+] [<dem>#Fraction+]");if(!0!==t.found)return null;let{num:n,dem:r}=t.groups();n=n.has("a")?1:x(n);let a=r.text("reduced");return b.test(a)&&(a=a.replace(b,""),r.replaceWith(a)),r=$.hasOwnProperty(a)?$[a]:x(r),"number"==typeof n&&"number"==typeof r?{numerator:n,denominator:r}:null}(e)||function(e){let t=e.match("^#Ordinal$");return!0!==t.found?null:e.lookAhead("^of .")?{numerator:1,denominator:x(t)}:null}(e)||null;return null!==t&&t.numerator&&t.denominator&&(t.decimal=t.numerator/t.denominator,t.decimal=(e=>{let t=Math.round(1e3*e)/1e3;return 0===t&&0!==e?e:t})(t.decimal)),t};const w=p,k=v;var C=function(e){let t=e.text("reduced"),n=/[0-9],[0-9]/.test(e.text("text")),r=function(e,t,n){let r=(e=e.replace(/,/g,"")).split(/^([^0-9]*)([0-9.,]*)([^0-9]*)$/);if(r&&r[2]&&t.terms().length<2){let t=parseFloat(r[2]||e);"number"!=typeof t&&(t=null);let n=r[3]||"";return"st"!==n&&"nd"!==n&&"rd"!==n&&"th"!==n||(n=""),"m"!==n&&"M"!==n||(t*=1e6,n=""),"k"!==n&&"k"!==n||(t*=1e3,n=""),{prefix:r[1]||"",num:t,suffix:n}}return null}(t,e);if(null!==r)return r.hasComma=n,r;let a=e.match("#Fraction #Fraction+$");a=!1===a.found?e.match("^#Fraction$"):a;let i=null;a.found&&(i=k(a),t=(e=(e=e.not(a)).not("and$")).text("reduced"));let o=0;return t&&(o=w(t)||0),i&&i.decimal&&(o+=i.decimal),{hasComma:n,prefix:"",num:o,suffix:""}},O=function(e){if(e<1e6)return String(e);let t;return t="number"==typeof e?e.toFixed(0):e,-1===t.indexOf("e+")?t:t.replace(".","").split("e+").reduce((function(e,t){return e+Array(t-e.length+2).join(0)}))};const V=O,F=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],M=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],E=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],N=function(e){let t=[];if(e>100)return t;for(let n=0;n<F.length;n++)e>=F[n][1]&&(e-=F[n][1],t.push(F[n][0]));return M[e]&&t.push(M[e]),t};var P=function(e){if(0===e||"0"===e)return"zero";e>1e21&&(e=V(e));let t=[];e<0&&(t.push("minus"),e=Math.abs(e));let n=function(e){let t=e,n=[];return E.forEach((r=>{if(e>=r[0]){let e=Math.floor(t/r[0]);t-=e*r[0],e&&n.push({unit:r[1],count:e})}})),n}(e);for(let e=0;e<n.length;e++){let r=n[e].unit;"one"===r&&(r="",t.length>1&&t.push("and")),t=t.concat(N(n[e].count)),t.push(r)}return t=t.concat((e=>{const t=["zero","one","two","three","four","five","six","seven","eight","nine"];let n=[],r=V(e).match(/\.([0-9]+)/);if(!r||!r[0])return n;n.push("point");let a=r[0].split("");for(let e=0;e<a.length;e++)n.push(t[a[e]]);return n})(e)),t=t.filter((e=>e)),0===t.length&&(t[0]=""),t.join(" ")};const z=O,A=P,j={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"};var q=e=>{let t=A(e).split(" "),n=t[t.length-1];return j.hasOwnProperty(n)?t[t.length-1]=j[n]:t[t.length-1]=n.replace(/y$/,"i")+"th",t.join(" ")},S={prefixes:{"":"cents",$:"dollars","":"pounds","":"yen","":"euros","":"coln","":"baht","":"kip","":"won","":"rupees","":"ruble","":"liras"},suffixes:{"%":"percent",s:"seconds",cm:"centimetres",km:"kilometres"}};const T$1=O,R=P,L=function(e){if(!e&&0!==e)return null;let t=e%100;if(t>10&&t<20)return String(e)+"th";const n={0:"th",1:"st",2:"nd",3:"rd"};let r=z(e),a=r.slice(r.length-1,r.length);return r+=n[a]?n[a]:"th",r},W=q,B=S.prefixes,D=S.suffixes,U={usd:!0,eur:!0,jpy:!0,gbp:!0,cad:!0,aud:!0,chf:!0,cny:!0,hkd:!0,nzd:!0,kr:!0,rub:!0},K=function(e){return B.hasOwnProperty(e.prefix)&&(e.suffix+=B[e.prefix],e.prefix=""),D.hasOwnProperty(e.suffix)&&(e.suffix=D[e.suffix]),U.hasOwnProperty(e.suffix)&&(e.suffix=e.suffix.toUpperCase()),e.suffix&&(e.suffix=" "+e.suffix),e};var Y=function(e,t,n){let r=String(e.num);return t?(e=K(e),n?(r=W(r),`${e.prefix||""}${r}${e.suffix||""}`):(r=R(r),`${e.prefix||""}${r}${e.suffix||""}`)):n?(r=L(r),`${(e=K(e)).prefix||""}${r}${e.suffix||""}`):(!0===e.hasComma&&(r=e.num.toLocaleString()),r=T$1(r),`${e.prefix||""}${r}${e.suffix||""}`)};const G=C,H=function(e,t,n){if(!1===e)return;let r=t.lookAhead("^(#Unit|#Noun)");r.has("(#Address|#Money|#Percent)")||t.has("#Ordinal")||(1===n.num?r.nouns().toSingular():r.has("#Singular")&&r.nouns().toPlural())},I=Y,Q=p;let Z={json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0],a=G(t);r.prefix=a.prefix,r.number=a.num,r.suffix=a.suffix,r.cardinal=I(a,!1,!1),r.ordinal=I(a,!1,!0),r.textCardinal=I(a,!0,!1),r.textOrdinal=I(a,!0,!0),n.push(r)})),null!==t?n[t]:n},units:function(){let e=this.lookAhead("(#Unit|#Noun)+");return e=e.splitAfter("@hasComma").first(),e=e.not("#Pronoun"),e.first()},isOrdinal:function(){return this.if("#Ordinal")},isCardinal:function(){return this.if("#Cardinal")},toNumber:function(){return this.forEach((e=>{let t=G(e);if(null===t.num)return;let n=I(t,!1,e.has("#Ordinal"));e.replaceWith(n,!0),e.tag("NumericValue")})),this},toLocaleString:function(){return this.forEach((e=>{let t=G(e);if(null===t.num)return;t.num=t.num.toLocaleString();let n=I(t,!1,e.has("#Ordinal"));e.replaceWith(n,!0)})),this},toText:function(){return this.forEach((e=>{let t=G(e);if(null===t.num)return;let n=I(t,!0,e.has("#Ordinal"));e.replaceWith(n,!0),e.tag("TextValue")})),this},toCardinal:function(e){return this.if("#Ordinal").forEach((t=>{let n=G(t);if(null===n.num)return;let r=I(n,t.has("#TextValue"),!1);if(t.has("#NumberRange")){let e=t.termList()[0];e.text&&""===e.post&&(e.post=" ")}t.replaceWith(r,!0),t.tag("Cardinal"),H(e,t,n)})),this},toOrdinal:function(){return this.if("#Cardinal").forEach((e=>{let t=G(e);if(null===t.num)return;let n=I(t,e.has("#TextValue"),!0);if(e.has("#NumberRange")){let t=e.termList()[0];t.text&&""===t.post&&(t.post=" ")}e.replaceWith(n,!0),e.tag("Ordinal");let r=this.lookAhead("^#Plural");r.found&&r.nouns().toSingular()})),this},isEqual:function(e){return this.filter((t=>G(t).num===e))},greaterThan:function(e){return this.filter((t=>G(t).num>e))},lessThan:function(e){return this.filter((t=>G(t).num<e))},between:function(e,t){return this.filter((n=>{let r=G(n).num;return r>e&&r<t}))},set:function(e,t){return void 0===e||("string"==typeof e&&(e=Q(e)),this.forEach((n=>{let r=G(n);if(r.num=e,null===r.num)return;let a=I(r,n.has("#TextValue"),n.has("#Ordinal"));(n=n.not("#Currency")).replaceWith(a,!0),H(t,n,r)}))),this},add:function(e,t){return e?("string"==typeof e&&(e=Q(e)),this.forEach((n=>{let r=G(n);if(null===r.num)return;r.num+=e;let a=I(r,n.has("#TextValue"),n.has("#Ordinal"));(n=n.not("#Currency")).replaceWith(a,!0),H(t,n,r)})),this):this},subtract:function(e,t){return this.add(-1*e,t)},increment:function(e){return this.add(1,e),this},decrement:function(e){return this.add(-1,e),this},romanNumerals:function(e){let t=this.match("#RomanNumeral").numbers();return"number"==typeof e&&(t=t.get(e)),t},normalize:function(){const e={"%":!0};return this.forEach((t=>{let n=G(t);if(null!==n.num&&n.suffix&&!0!==e[n.suffix]){let e=n.prefix||"";t=t.replaceWith(e+n.num+" "+n.suffix)}})),this},get:function(e){let t=[];return this.forEach((e=>{t.push(G(e).num)})),void 0!==e?t[e]||null:t||null}};Z.toNice=Z.toLocaleString,Z.isBetween=Z.between,Z.minus=Z.subtract,Z.plus=Z.add,Z.equals=Z.isEqual;var J=Z;const X=C,_=function(e){let t=X(e).num;return"number"==typeof t?t/100:null};var ee={get:function(e){let t=[];return this.forEach((e=>{let n=_(e);null!==n&&t.push(n)})),void 0!==e?t[e]||null:t||null},json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0],a=_(t);if(r.number=a,null!==a){let e=100*a;r.textNumber=`${e} percent`,r.cardinal=`${e}%`}n.push(r)})),null!==t?n[t]||{}:n},toFraction:function(){return this.forEach((e=>{let t=_(e);if(null!==t){t*=100,t=Math.round(100*t)/100;let n=`${t}/100`;this.replace(e,n)}})),this}},ne=[{dem:"american",name:"dollar",iso:"usd",sub:"cent",sym:["$","US$","U$"]},{name:"euro",iso:"eur",sub:"cent",sym:[""]},{dem:"british",name:"pound",iso:"gbp",sub:"penny",alias:{sterling:!0},sym:[""]},{name:"renminbi",iso:"cny",plural:"yun",alias:{yuan:!0},sym:[""]},{dem:"japanese",name:"yen",iso:"jpy",sub:"sen",sym:["","",""]},{dem:"swedish",name:"krona",iso:"sek",sub:"re",alias:{ore:!0,kronor:!0},sym:["kr"]},{dem:"estonian",name:"kroon",iso:"eek",sub:"sent",sym:["kr"]},{dem:"norwegian",name:"krone",iso:"nok",sub:"re",sym:["kr"]},{dem:"icelandic",name:"krna",iso:"isk",sym:["kr"]},{dem:"danish",name:"krone",iso:"dkk",sub:"re",sym:["kr."]},{dem:"zambian",name:"kwacha",iso:"zmw",sub:"ngwee",sym:["K"]},{dem:"malawian",name:"kwacha",iso:"mwk",sub:"tambala",sym:["K"]},{dem:"greek",name:"drachma",iso:"grd",sub:"leptn",sym:[".",".",""]},{dem:"eastern caribbean",name:"dollar",iso:"xcd",sub:"cent",sym:["$"]},{dem:"finnish",name:"markka",iso:"fim",sub:"penni",sym:["mk"]},{dem:"polish",name:"zoty",iso:"pln",sub:"grosz",sym:["z"]},{dem:"slovenian",name:"tolar",iso:"sit",sub:"stotin",sym:[]},{dem:"australian",name:"dollar",iso:"aud",sub:"cent",sym:["$","A$","AU$"]},{dem:"deutsche",name:"mark",iso:"dem",sub:"pfennig",sym:["DM"]},{dem:"thai",name:"baht",iso:"thb",sub:"satang",sym:[""]},{dem:"canadian",name:"dollar",iso:"cad",sub:"cent",sym:["$","Can$","C$","CA$","CAD"]},{dem:"mexican",name:"peso",iso:"mxn",sub:"centavo",sym:["$","Mex$"]},{dem:"spanish",name:"peseta",iso:"esp",sub:"cntimo",sym:["Pta"]},{dem:"new zealand",name:"dollar",iso:"nzd",sub:"cent",sym:["$","NZ$"]},{dem:"chilean",name:"peso",iso:"clp",sub:"centavo",sym:["Cifro","$"]},{dem:"nigerian",name:"naira",iso:"ngn",sub:"kobo",sym:[""]},{dem:"austrian",name:"schilling",iso:"ats",sub:"groschen",sym:["S","S"]},{dem:"guatemalan",name:"quetzal",iso:"gtq",sub:"centavo",sym:["Q"]},{dem:"philippine",name:"peso",iso:"php",sub:"sentimo",sym:[""]},{dem:"hungarian",name:"forint",iso:"huf",sym:["Ft"]},{dem:"russian",name:"ruble",iso:"rub",sub:"kopeyka",sym:["","","."]},{dem:"kuwaiti",name:"dinar",iso:"kwd",sub:"fils",sym:[".","KD"]},{dem:"israeli",name:"new shekel",iso:"ils",sub:"agora",sym:[""]},{dem:"latvian",name:"lats",iso:"lvl",sub:"santms",sym:["Ls"]},{dem:"kazakhstani",name:"tenge",iso:"kzt",sub:"tyn",sym:[""]},{dem:"iraqi",name:"dinar",iso:"iqd",sub:"fils",sym:["."]},{dem:"bahamian",name:"dollar",iso:"bsd",sub:"cent",sym:["$","B$"]},{dem:"seychellois",name:"rupee",iso:"scr",sub:"cent",sym:["SCR","SR"]},{dem:"albanian",name:"lek",iso:"all",sub:"qindark",sym:["L"]},{dem:"bulgarian",name:"lev",iso:"bgn",sub:"stotinka",sym:["."]},{dem:"irish",name:"pound",iso:"iep",sym:["","IR"]},{name:"cfp franc",iso:"xpf",sym:["f"]},{dem:"south african",name:"rand",iso:"zar",sub:"cent",sym:["R"]},{dem:"south korean",name:"won",iso:"krw",sub:"jeon",plural:"won",sym:[""]},{dem:"north korean",name:"won",iso:"kpw",sub:"chon",plural:"won",sym:[""]},{dem:"portuguese",name:"escudo",iso:"pte",sub:"centavo",sym:[]},{dem:"ghanaian",name:"cedi",iso:"ghs",sub:"pesewa",sym:["GH"]},{dem:"hong kong",name:"dollar",iso:"hkd",sub:"",sym:["$"]},{dem:"new taiwan",name:"dollar",iso:"twd",sub:"dime",sym:["NT$"]},{dem:"east german",name:"mark",iso:"ddm",sub:"pfennig",sym:["M"]},{dem:"namibian",name:"dollar",iso:"nad",sub:"cent",sym:["$"]},{dem:"malaysian",name:"ringgit",iso:"myr",sub:"sen",sym:["RM"]},{dem:"swiss",name:"franc",iso:"chf",sym:["Rp."]},{dem:"panamanian",name:"balboa",iso:"pab",sub:"centsimo",sym:["B/."]},{dem:"indonesian",name:"rupiah",iso:"idr",sub:"sen",sym:["Rp"]},{dem:"brunei",name:"dollar",iso:"bnd",sub:"sen",sym:["$","B$"]},{dem:"venezuelan",name:"bolvar",iso:"vef",sub:"cntimo",sym:["Bs.F","Bs."]},{dem:"macedonian",name:"denar",iso:"mkd",sub:"deni",sym:["den"]},{dem:"mauritanian",name:"ouguiya",iso:"mru",sub:"khoums",sym:["UM"]},{dem:"argentine",name:"peso",iso:"ars",sub:"centavo",sym:["$"]},{dem:"libyan",name:"dinar",iso:"lyd",sub:"dirham",sym:["LD","."]},{dem:"jordanian",name:"dinar",iso:"jod",sub:"dirham",sym:["."]},{dem:"french",name:"franc",iso:"frf",sub:"centime",sym:["F","Fr","FF",""]},{dem:"syrian",name:"pound",iso:"syp",sub:"piastre",sym:["LS","S"]},{dem:"belize",name:"dollar",iso:"bzd",sub:"cent",sym:["$"]},{dem:"saudi",name:"riyal",iso:"sar",sub:"halalah",sym:["SAR","."," "]},{dem:"surinamese",name:"dollar",iso:"srd",sub:"cent",sym:["$"]},{dem:"singapore",name:"dollar",iso:"sgd",sub:"cent",sym:["S$","$"]},{dem:"nepalese",name:"rupee",iso:"npr",sub:"paisa",sym:[" ","Re"]},{dem:"nicaraguan",name:"crdoba",iso:"nio",sub:"centavo",sym:["C$"]},{dem:"bangladeshi",name:"taka",iso:"bdt",sub:"poysha",sym:[""]},{dem:"indian",name:"rupee",iso:"inr",sub:"paisa",sym:[""]},{dem:"maldivian",name:"rufiyaa",iso:"mvr",sub:"laari",sym:["Rf","MRf","MVR",". "]},{dem:"sri lankan",name:"rupee",iso:"lkr",sub:"cents",sym:["Rs","",""]},{dem:"bhutanese",name:"ngultrum",iso:"btn",sub:"chhertum",sym:["Nu."]},{dem:"turkish",name:"lira",iso:"try",sub:"kuru",sym:["YTL"]},{dem:"serbian",name:"dinar",iso:"rsd",sub:"para",sym:["din",""]},{dem:"bosnia and herzegovina",name:"convertible mark",iso:"bam",sub:"fening",sym:["KM"]},{dem:"botswana",name:"pula",iso:"bwp",sub:"thebe",sym:["p"]},{dem:"swazi",name:"lilangeni",iso:"szl",sub:"cent",sym:["L","E"]},{dem:"lithuanian",name:"litas",iso:"ltl",sub:"centas",sym:["Lt","ct"]},{dem:"mauritian",name:"rupee",iso:"mur",sub:"cent",sym:[""]},{dem:"pakistani",name:"rupee",iso:"pkr",sub:"paisa",sym:[""]},{dem:"maltese",name:"lira",iso:"mtl",sub:"cent",sym:["","Lm"]},{dem:"cypriot",name:"pound",iso:"cyp",sub:"cent",sym:[""]},{dem:"moldovan",name:"leu",iso:"mdl",sym:["l"]},{dem:"croatian",name:"kuna",iso:"hrk",sub:"lipa",sym:["kn"]},{dem:"afghan",name:"afghani",iso:"afn",sub:"pul",sym:["","Af","Afs"]},{dem:"ecuadorian",name:"sucre",iso:"ecs",sub:"centavo",sym:["S/."]},{dem:"sierra leonean",name:"leone",iso:"sll",sub:"cent",sym:["Le"]}];const te=ne,re=C,ae={};let ie={};te.forEach((e=>{e.sym.forEach((t=>{ae[t]=ae[t]||e.iso})),ae[e.iso]=ae[e.iso]||e.iso,e.sub&&(ie[e.sub]=!0)}));let se=`(${Object.keys(ie).join("|")})`;const oe=Y,ue=function(e){let t=0,n=e.match(`and #Money+ ${se}`);if(n.found){e=e.not(n);let r=re(n.match("#Value+"));r&&r.num&&(t=r.num/100)}let r=re(e),a=r.num||0;a+=t;let i=((o=r).suffix&&ae.hasOwnProperty(o.suffix)?te.find((e=>e.iso===ae[o.suffix])):o.prefix&&ae.hasOwnProperty(o.prefix)?te.find((e=>e.iso===ae[o.prefix])):null)||function(e){let t=e.match("#Currency+");t.nouns().toSingular();let n=t.text("reduced");return te.find((e=>(n===`${e.dem} ${e.name}`||n===e.iso||n===e.sub||n===e.name||!(!e.alias||!0!==e.alias[n]))&&e))}(e)||{};var o;let s="";return i&&i.sym&&(s=i.sym[0],a&&e.has(`${se}`)&&(a/=100)),{num:a,iso:i.iso,demonym:i.dem,currency:i.name,plural:i.plural,symbol:s}},le=function(e=""){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))};var me$1={get:function(e){let t=[];return this.forEach((e=>{t.push(ue(e))})),void 0!==e?t[e]||null:t||null},currency:function(e){let t=[];return this.forEach((e=>{let n=ue(e);n&&t.push(n)})),"number"==typeof e?t[e]||null:t||null},json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0],a=ue(t);if(r.number=a.num,a.iso&&(r.iso=a.iso.toUpperCase(),r.symbol=a.symbol,r.currency=le(a.demonym)+" "+le(a.currency)),r.textFmt=oe(a,!0,!1),a.currency){let e=a.currency;1!==a.num&&(e=a.plural||e+"s"),r.textFmt+=" "+e}n.push(r)})),null!==t?n[t]||{}:n}},ce={};const he=P,fe=q;ce.toText=function(e){if(!e.numerator||!e.denominator)return"";let t=he(e.numerator),n=fe(e.denominator);return 2===e.denominator&&(n="half"),t&&n?(1!==e.numerator&&(n+="s"),`${t} ${n}`):""},ce.textCardinal=function(e){return e.numerator&&e.denominator?`${he(e.numerator)} out of ${he(e.denominator)}`:""},ce.toDecimal=function(e){return e.decimal};const de=v,ye=ce,pe={get:function(e){let t=[];return this.forEach((e=>{t.push(de(e))})),void 0!==e?t[e]||null:t||null},toDecimal(){return this.forEach((e=>{let t=de(e);if(t){let n=ye.toDecimal(t);e.replaceWith(String(n),!0),e.tag("NumericValue"),e.unTag("Fraction")}})),this},json:function(e){let t=null;"number"==typeof e&&(t=e,e=null),e=e||{text:!0,normal:!0,trim:!0,terms:!0};let n=[];return this.forEach((t=>{let r=t.json(e)[0],a=de(t)||{},i=ye.toDecimal(a);r.numerator=a.numerator,r.denominator=a.denominator,r.number=i,r.textOrdinal=ye.toText(a),r.textCardinal=ye.textCardinal(a),n.push(r)})),null!==t?n[t]||{}:n},normalize:function(){return this.forEach((e=>{let t=de(e);if(t&&"number"==typeof t.numerator&&"number"==typeof t.denominator){let n=`${t.numerator}/${t.denominator}`;this.replace(e,n)}})),this},toText:function(e){let t=[];return this.forEach((e=>{let t=de(e)||{},n=ye.toText(t);e.replaceWith(n,!0),e.tag("Fraction")})),void 0!==e?t[e]:t},toPercentage:function(){return this.forEach((e=>{let t=de(e);if(t.decimal||0===t.decimal){let n=100*t.decimal;n=Math.round(100*n)/100,this.replace(e,`${n}%`)}})),this}};pe.toNumber=pe.toDecimal;var be=pe;const ge=function(e){return e.match("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("#Multiple","fraction-tagger"),e.match("[(half|quarter)] of? (a|an)",0).tag("Fraction","millionth"),e.match("#Adverb [half]",0).tag("Fraction","nearly-half"),e.match("[half] the",0).tag("Fraction","half-the"),e.match("#Value (halves|halfs|quarters)").tag("Fraction","two-halves"),e.match("a #Ordinal").tag("Fraction","a-quarter"),e.match("(#Fraction && /s$/)").lookBefore("#Cardinal+$").tag("Fraction"),e.match("[#Cardinal+ #Ordinal] of .",0).tag("Fraction","ordinal-of"),e.match("[(#NumericValue && #Ordinal)] of .",0).tag("Fraction","num-ordinal-of"),e.match("(a|one) #Cardinal?+ #Ordinal").tag("Fraction","a-ordinal"),e.match("#Cardinal+ out? of every? #Cardinal").tag("Fraction","fraction-tagger"),e},xe=function(e){const t="money-tagger";e.match("#Money and #Money #Currency?").tag("Money","money-and-money"),e.match("#Money").not("#TextValue").match("/\\.[0-9]{3}$/").unTag("#Money","three-decimal money"),e.ifNo("#Value").match("#Currency #Verb").unTag("Currency","no-currency"),e.match("#Value #Currency [and] #Value (cents|ore|centavos|sens)",0).tag("Money",t);let n=e.match("[<num>#Value] [<currency>(mark|rand|won|rub|ore)]");return n.group("num").tag("Money",t),n.group("currency").tag("Currency",t),e};var $e=function(e){(e=xe(e)).match("the [/[0-9]+s$/]").tag("#Plural","number-tag"),e.match("half a? #Value").tag("Value","half-a-value"),e.match("#Value [and a (half|quarter)]",0).tag(["TextValue","#Fraction"],"value-and-a-half"),(e=ge(e)).match("#Cardinal and #Fraction #Fraction").tag("Value","number-tag")};const ve={mark:!0,sucre:!0,leone:!0,afghani:!0,rand:!0,try:!0,mop:!0,won:!0,all:!0,rub:!0,eek:!0,sit:!0,bam:!0,npr:!0,leu:!0};let we={kronor:"Currency"};ne.forEach((e=>{e.iso&&!ve[e.iso]&&(we[e.iso]=["Acronym","Currency"]);let t=e.name;if(t&&!ve[t]&&(we[t]="Currency",we[t+"s"]="Currency"),e.dem){let n=e.dem;we[`${n} ${t}`]="Currency",we[`${n} ${t}s`]="Currency"}e.sub&&(we[e.sub]="Currency")}));const ke=e,Ce=t,Oe=r,Ve=a,Fe=J,Me=ee,Ee=me$1,Ne=be,Pe=$e,ze={Fraction:{isA:["Value"]},Multiple:{isA:"Value"}},Ae=we;var je=function(e,t){t.addWords(Ae),t.addTags(ze),t.postProcess(Pe);class n extends e{}Object.assign(n.prototype,Fe);class r extends n{}Object.assign(r.prototype,Ee);class a extends n{}Object.assign(a.prototype,Ne);class i extends n{}Object.assign(i.prototype,Me);const o={numbers:function(e){let t=Ce(this,e);return new n(t.list,this,this.world)},percentages:function(e){let t=Ve(this,e);return new i(t.list,this,this.world)},fractions:function(e){let t=Oe(this,e);return new a(t.list,this,this.world)},money:function(e){let t=ke(this,e);return new r(t.list,this,this.world)}};return o.values=o.numbers,o.percents=o.percentages,Object.assign(e.prototype,o),e};es.extend(je);class Pluralize extends Text{static componentType="pluralize";static rendererType="text";static createAttributesObject(){let e=super.createAttributesObject();return e.pluralForm={createComponentOfType:"text",createStateVariable:"pluralForm",defaultValue:null,public:!0},e.basedOnNumber={createComponentOfType:"number",createStateVariable:"basedOnNumber",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:e,oldName:"value",newName:"valuePrePluralize"}),e.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({valuePrePluralize:{dependencyType:"stateVariable",variableName:"valuePrePluralize"},pluralForm:{dependencyType:"stateVariable",variableName:"pluralForm"},basedOnNumber:{dependencyType:"stateVariable",variableName:"basedOnNumber"}}),definition:function({dependencyValues:e}){let t,n=es(e.valuePrePluralize),r=n.values().toNumber().all().terms().json();if(0===r.length)return{setValue:{value:e.valuePrePluralize}};if(null!==e.basedOnNumber&&(t=numberDesignatesPlural(e.basedOnNumber)),1===r.length)return void 0===t&&(t=!0),t?null!==e.pluralForm?{setValue:{value:e.pluralForm}}:{setValue:{value:n.nouns().toPlural().all().out("text")}}:{setValue:{value:e.valuePrePluralize}};if(void 0===t){let e=[],a=[],i=n.nouns().json();for(let[t,n]of r.entries()){let r=i[e.length];n.terms[0].tags.includes("Value")&&a.push(t),void 0!==r&&r.text===n.text&&e.push(t)}t=[];let o=n.values().numbers().json(),s=-1;for(let n of e){for(;Number(a[s+1])<Number(n);)s++;o[s]&&numberDesignatesPlural(Number(o[s].normal))?t.push(!0):t.push(!1)}}if(!1===t)return{setValue:{value:e.valuePrePluralize}};let a=es(e.valuePrePluralize);if(null!==e.pluralForm)for(let[r,i]of n.nouns().data().entries())!0!==t&&!0!==t[r]||a.replace(i.text,e.pluralForm);else{let e=n.nouns().json().length;for(let n=0;n<e;n++)!0!==t&&!0!==t[n]||a.nouns(n).toPlural().all()}return{setValue:{value:a.out("text")}}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({setValue:{text:e.value}})},e}}function numberDesignatesPlural(e){return 1!==e}class Feedback extends BlockComponent{static componentType="feedback";static renderChildren=!0;static primaryStateVariableForDefinition="feedbackText";static createAttributesObject(){let e=super.createAttributesObject();return delete e.hide,e.condition={createComponentOfType:"boolean"},e.updateWithTarget={createPrimitiveOfType:"string"},e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.updateWithTarget={returnDependencies:()=>({updateWithTargetAttr:{dependencyType:"attributePrimitive",attributeName:"updateWithTarget"}}),definition:({dependencyValues:e})=>({setValue:{updateWithTarget:e.updateWithTargetAttr}})},e.updateWithTargetComponentNames={chainActionOnActionOfStateVariableTargets:{triggeredAction:"updateHide"},stateVariablesDeterminingDependencies:["updateWithTarget"],returnDependencies:({stateValues:e})=>e.updateWithTarget?{updateWithTargetComponentName:{dependencyType:"expandTargetName",target:e.updateWithTarget}}:{},definition:({dependencyValues:e})=>e.updateWithTargetComponentName?{setValue:{updateWithTargetComponentNames:[e.updateWithTargetComponentName]}}:{setValue:{updateWithTargetComponentNames:[]}}},e.hideWhenUpdated={returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]},showFeedback:{dependencyType:"flag",flagName:"showFeedback"}}),definition:function({dependencyValues:e}){let t;return t=null!==e.condition&&!(e.showFeedback&&e.condition.stateValues.value),{setValue:{hideWhenUpdated:t}}}},e.hide={forRenderer:!0,defaultValue:!0,hasEssential:!0,stateVariablesDeterminingDependencies:["updateWithTarget"],returnDependencies:({stateValues:e})=>e.updateWithTarget?{}:{condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]},showFeedback:{dependencyType:"flag",flagName:"showFeedback"}},definition:function({dependencyValues:e}){if(!("condition"in e))return{useEssentialOrDefaultValue:{hide:!0}};let t;return t=null!==e.condition&&!(e.showFeedback&&e.condition.stateValues.value),{setValue:{hide:t}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>"condition"in t?{success:!1}:{success:!0,instructions:[{setEssentialValue:"hide",value:e.hide}]}},e.feedbackText={forRenderer:!0,defaultValue:null,hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{feedbackText:!0}})},e}async updateHide({actionId:e}){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"hide",value:await this.stateValues.hideWhenUpdated}];return await this.coreFunctions.performUpdate({updateInstructions:t,actionId:e})}actions={updateHide:this.updateHide.bind(this)}}class CollaborateGroups extends BaseComponent{static componentType="collaborateGroups";static rendererType=void 0;static stateVariableForAttributeValue="collaborateGroups";static returnChildLogic(e){let t=super.returnChildLogic(e),n=t.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0}),r=breakStringsAndOthersIntoComponentsByStringCommas(),a=t.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,logicToWaitOnSugar:["atLeastZeroPoints"],replacementFunction:r});return t.newOperator({name:"pointsXorSugar",operator:"xor",propositions:[a,n],setAsBase:!0}),t}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.collaborateGroups={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["xs","coords","nDimensions"]}}),definition:function({dependencyValues:e}){let t={};for(let n of e.pointChildren)if(2!==n.stateValues.nDimensions)console.warn(`invalid collaborate group: ${n.stateValues.coords.toString()}`);else{let e=n.stateValues.xs[0].evaluate_to_constant(),r=n.stateValues.xs[1].evaluate_to_constant();Number.isInteger(e)&&e>0&&Number.isInteger(r)&&r>0?(void 0===t[e]&&(t[e]=[]),t[e].push(r)):console.warn(`invalid collaborate group: ${n.stateValues.coords.toString()}`)}return{setValue:{collaborateGroups:{groups:t,matchGroup:function({groupNumber:e,numberOfGroups:n}={}){if(n>1){let r=t[n];return void 0!==r&&r.includes(e)}return!0}}}}}},e}}class CollaborateGroupSetup extends BaseComponent{static componentType="collaborateGroupSetup";static returnChildLogic(e){let t=super.returnChildLogic(e);return t.newLeaf({name:"atMostOnePossibleNumberOfGroups",componentType:"possibleNumberOfGroups",comparison:"atMost",number:1,setAsBase:!0}),t}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.possibleNumberOfGroups={returnDependencies:()=>({pngChild:{dependencyType:"child",childLogicName:"atMostOnePossibleNumberOfGroups",variableNames:["numbers"]}}),definition:function({dependencyValues:e}){return 0===e.pngChild.length?{setValue:{possibleNumberOfGroups:[1]}}:{setValue:{possibleNumberOfGroups:e.pngChild[0].stateValues.numbers}}}},e}}class ConsiderAsResponses extends BlockComponent{static componentType="considerAsResponses";static rendererType=void 0;static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.childrenWithNValues={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["nValues"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({setValue:{childrenWithNValues:e.children}})},e.childrenAsResponses={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["anything"],variableNames:["value","values","componentType"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({setValue:{childrenAsResponses:e.children}})},e}}class Case extends Template{static componentType="case";static createAttributesObject(){let e=super.createAttributesObject();return e.condition={createComponentOfType:"boolean"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.conditionSatisfied={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({condition:{dependencyType:"attributeComponent",attributeName:"condition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let t;return t=null===e.condition||e.condition.stateValues.value,{setValue:{conditionSatisfied:t}}}},e}static createSerializedReplacements({component:e,componentInfoObjects:t}){return e.stateValues.conditionSatisfied?super.createSerializedReplacements({component:e,componentInfoObjects:t}):{replacements:[]}}}var dist={},formats={};Object.defineProperty(formats,"__esModule",{value:!0}),formats.FORMATS=formats.FORMAT_PLAIN=formats.FORMAT_HTML=void 0;var FORMAT_HTML="html";formats.FORMAT_HTML=FORMAT_HTML;var FORMAT_PLAIN="plain";formats.FORMAT_PLAIN=FORMAT_PLAIN;var FORMATS=[FORMAT_HTML,FORMAT_PLAIN];formats.FORMATS=FORMATS;var units={};Object.defineProperty(units,"__esModule",{value:!0}),units.UNITS=units.UNIT_PARAGRAPH=units.UNIT_PARAGRAPHS=units.UNIT_SENTENCE=units.UNIT_SENTENCES=units.UNIT_WORD=units.UNIT_WORDS=void 0;var UNIT_WORDS="words";units.UNIT_WORDS=UNIT_WORDS;var UNIT_WORD="word";units.UNIT_WORD=UNIT_WORD;var UNIT_SENTENCES="sentences";units.UNIT_SENTENCES=UNIT_SENTENCES;var UNIT_SENTENCE="sentence";units.UNIT_SENTENCE=UNIT_SENTENCE;var UNIT_PARAGRAPHS="paragraphs";units.UNIT_PARAGRAPHS=UNIT_PARAGRAPHS;var UNIT_PARAGRAPH="paragraph";units.UNIT_PARAGRAPH=UNIT_PARAGRAPH;var UNITS=[UNIT_WORDS,UNIT_WORD,UNIT_SENTENCES,UNIT_SENTENCE,UNIT_PARAGRAPHS,UNIT_PARAGRAPH];units.UNITS=UNITS;var words={};Object.defineProperty(words,"__esModule",{value:!0}),words.WORDS=void 0;var WORDS=["ad","adipisicing","aliqua","aliquip","amet","anim","aute","cillum","commodo","consectetur","consequat","culpa","cupidatat","deserunt","do","dolor","dolore","duis","ea","eiusmod","elit","enim","esse","est","et","eu","ex","excepteur","exercitation","fugiat","id","in","incididunt","ipsum","irure","labore","laboris","laborum","Lorem","magna","minim","mollit","nisi","non","nostrud","nulla","occaecat","officia","pariatur","proident","qui","quis","reprehenderit","sint","sit","sunt","tempor","ullamco","ut","velit","veniam","voluptate"];words.WORDS=WORDS;var LoremIpsum={},lineEndings={};Object.defineProperty(lineEndings,"__esModule",{value:!0}),lineEndings.LINE_ENDINGS=void 0;var LINE_ENDINGS={POSIX:"\n",WIN32:"\r\n"};lineEndings.LINE_ENDINGS=LINE_ENDINGS;var generator={},util={},capitalize={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(e){var t=e.trim();return t.charAt(0).toUpperCase()+t.slice(1)};e.default=t}(capitalize);var isNode={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){return!!e.exports};t.default=n}(isNode,isNode.exports);var isReactNative={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(){var e=!1;try{e="ReactNative"===navigator.product}catch(t){e=!1}return e};e.default=t}(isReactNative);var isWindows={},platforms={};Object.defineProperty(platforms,"__esModule",{value:!0}),platforms.SUPPORTED_PLATFORMS=void 0;var SUPPORTED_PLATFORMS={DARWIN:"darwin",LINUX:"linux",WIN32:"win32"};platforms.SUPPORTED_PLATFORMS=SUPPORTED_PLATFORMS,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=platforms,n=function(){var e=!1;try{e=browser$1.platform===t.SUPPORTED_PLATFORMS.WIN32}catch(t){e=!1}return e};e.default=n}(isWindows);var makeArrayOfLength={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Array.apply(null,Array(e)).map((function(e,t){return t}))};e.default=t}(makeArrayOfLength);var makeArrayOfStrings={},hasRequiredMakeArrayOfStrings,hasRequiredUtil;function requireMakeArrayOfStrings(){return hasRequiredMakeArrayOfStrings||(hasRequiredMakeArrayOfStrings=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=requireUtil(),n=function(e,n){return(0,t.makeArrayOfLength)(e).map((function(){return n()}))};e.default=n}(makeArrayOfStrings)),makeArrayOfStrings}function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"capitalize",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"isNode",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"isReactNative",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"isWindows",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"makeArrayOfLength",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"makeArrayOfStrings",{enumerable:!0,get:function(){return o.default}});var t=s(capitalize),n=s(isNode.exports),r=s(isReactNative),a=s(isWindows),i=s(makeArrayOfLength),o=s(requireMakeArrayOfStrings());function s(e){return e&&e.__esModule?e:{default:e}}}(util)),util}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=words,n=requireUtil();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.sentencesPerParagraph,o=void 0===a?{max:7,min:3}:a,s=n.wordsPerSentence,l=void 0===s?{max:15,min:5}:s,u=n.random;n.seed;var c=n.words,p=void 0===c?t.WORDS:c;if(r(this,e),i(this,"sentencesPerParagraph",void 0),i(this,"wordsPerSentence",void 0),i(this,"random",void 0),i(this,"words",void 0),o.min>o.max)throw new Error("Minimum number of sentences per paragraph (".concat(o.min,") cannot exceed maximum (").concat(o.max,")."));if(l.min>l.max)throw new Error("Minimum number of words per sentence (".concat(l.min,") cannot exceed maximum (").concat(l.max,")."));this.sentencesPerParagraph=o,this.words=p,this.wordsPerSentence=l,this.random=u||Math.random}var o,s,l;return o=e,s=[{key:"generateRandomInteger",value:function(e,t){return Math.floor(this.random()*(t-e+1)+e)}},{key:"generateRandomWords",value:function(e){var t=this,r=this.wordsPerSentence,a=r.min,i=r.max,o=e||this.generateRandomInteger(a,i);return(0,n.makeArrayOfLength)(o).reduce((function(e,n){return"".concat(t.pluckRandomWord()," ").concat(e)}),"").trim()}},{key:"generateRandomSentence",value:function(e){return"".concat((0,n.capitalize)(this.generateRandomWords(e)),".")}},{key:"generateRandomParagraph",value:function(e){var t=this,r=this.sentencesPerParagraph,a=r.min,i=r.max,o=e||this.generateRandomInteger(a,i);return(0,n.makeArrayOfLength)(o).reduce((function(e,n){return"".concat(t.generateRandomSentence()," ").concat(e)}),"").trim()}},{key:"pluckRandomWord",value:function(){var e=this.words.length-1,t=this.generateRandomInteger(0,e);return this.words[t]}}],s&&a(o.prototype,s),l&&a(o,l),e}(),s=o;e.default=s}(generator),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t,n=formats,r=lineEndings,a=(t=generator)&&t.__esModule?t:{default:t},i=requireUtil();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.FORMAT_PLAIN,i=arguments.length>2?arguments[2]:void 0;if(o(this,e),this.format=r,this.suffix=i,l(this,"generator",void 0),-1===n.FORMATS.indexOf(r.toLowerCase()))throw new Error("".concat(r," is an invalid format. Please use ").concat(n.FORMATS.join(" or "),"."));this.generator=new a.default(t)}var t,u,c;return t=e,(u=[{key:"getLineEnding",value:function(){return this.suffix?this.suffix:!(0,i.isReactNative)()&&(0,i.isNode)()&&(0,i.isWindows)()?r.LINE_ENDINGS.WIN32:r.LINE_ENDINGS.POSIX}},{key:"formatString",value:function(e){return this.format===n.FORMAT_HTML?"<p>".concat(e,"</p>"):e}},{key:"formatStrings",value:function(e){var t=this;return e.map((function(e){return t.formatString(e)}))}},{key:"generateWords",value:function(e){return this.formatString(this.generator.generateRandomWords(e))}},{key:"generateSentences",value:function(e){return this.formatString(this.generator.generateRandomParagraph(e))}},{key:"generateParagraphs",value:function(e){var t=this.generator.generateRandomParagraph.bind(this.generator);return this.formatStrings((0,i.makeArrayOfStrings)(e,t)).join(this.getLineEnding())}}])&&s(t.prototype,u),c&&s(t,c),e}(),c=u;e.default=c}(LoremIpsum),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"LoremIpsum",{enumerable:!0,get:function(){return i.default}}),e.loremIpsum=void 0;var t,n=formats,r=units,a=words,i=(t=LoremIpsum)&&t.__esModule?t:{default:t};e.loremIpsum=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.count,o=void 0===t?1:t,s=e.format,l=void 0===s?n.FORMAT_PLAIN:s,u=e.paragraphLowerBound,c=void 0===u?3:u,p=e.paragraphUpperBound,d=void 0===p?7:p,m=e.random,f=e.sentenceLowerBound,h=void 0===f?5:f,y=e.sentenceUpperBound,b=void 0===y?15:y,g=e.units,v=void 0===g?r.UNIT_SENTENCES:g,T=e.words,C=void 0===T?a.WORDS:T,N=e.suffix,A=void 0===N?"":N,S={random:m,sentencesPerParagraph:{max:d,min:c},words:C,wordsPerSentence:{max:b,min:h}},w=new i.default(S,l,A);switch(v){case r.UNIT_PARAGRAPHS:case r.UNIT_PARAGRAPH:return w.generateParagraphs(o);case r.UNIT_SENTENCES:case r.UNIT_SENTENCE:return w.generateSentences(o);case r.UNIT_WORDS:case r.UNIT_WORD:return w.generateWords(o);default:return""}}}(dist);class Lorem extends CompositeComponent{static componentType="lorem";static assignNamesToReplacements=!0;static createsVariants=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.minSentencesPerParagraph={createComponentOfType:"number",createStateVariable:"minSentencesPerParagraph",defaultValue:4,public:!0},e.maxSentencesPerParagraph={createComponentOfType:"number",createStateVariable:"maxSentencesPerParagraph",defaultValue:8,public:!0},e.minWordsPerSentence={createComponentOfType:"number",createStateVariable:"minWordsPerSentence",defaultValue:4,public:!0},e.maxWordsPerSentence={createComponentOfType:"number",createStateVariable:"maxWordsPerSentence",defaultValue:8,public:!0},e.generateWords={createComponentOfType:"number",createStateVariable:"generateWords",defaultValue:null},e.generateSentences={createComponentOfType:"number",createStateVariable:"generateSentences",defaultValue:null},e.generateParagraphs={createComponentOfType:"number",createStateVariable:"generateParagraphs",defaultValue:null},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.readyToExpandWhenResolved={returnDependencies:()=>({minSentencesPerParagraph:{dependencyType:"stateVariable",variableName:"minSentencesPerParagraph"},maxSentencesPerParagraph:{dependencyType:"stateVariable",variableName:"maxSentencesPerParagraph"},minWordsPerSentence:{dependencyType:"stateVariable",variableName:"minWordsPerSentence"},maxWordsPerSentence:{dependencyType:"stateVariable",variableName:"maxWordsPerSentence"},generateWords:{dependencyType:"stateVariable",variableName:"generateWords"},generateSentences:{dependencyType:"stateVariable",variableName:"generateSentences"},generateParagraphs:{dependencyType:"stateVariable",variableName:"generateParagraphs"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed}}),definition:({dependencyValues:e,componentName:t})=>({setValue:{generatedVariantInfo:{seed:e.variantSeed,meta:{createdBy:t}}}})},e}static async createSerializedReplacements({component:e,componentInfoObjects:t}){const n=new dist.LoremIpsum({sentencesPerParagraph:{max:await e.stateValues.maxSentencesPerParagraph,min:await e.stateValues.minSentencesPerParagraph},wordsPerSentence:{max:await e.stateValues.maxWordsPerSentence,min:await e.stateValues.minWordsPerSentence},random:e.sharedParameters.variantRng});let r=[];if(null!==await e.stateValues.generateParagraphs){let t=await e.stateValues.generateParagraphs;if(Number.isInteger(t)&&t>0){r=n.generateParagraphs(t).split("\n").map((e=>({componentType:"p",children:[e]})))}}else if(null!==await e.stateValues.generateSentences){let t=await e.stateValues.generateSentences;if(Number.isInteger(t)&&t>0){let e=n.generateSentences(t).split(". ");for(let t of e.slice(0,e.length-1))r.push({componentType:"text",children:[t+"."]}),r.push(" ");r.push({componentType:"text",children:[e[e.length-1]]})}}else if(null!==await e.stateValues.generateWords){let t=await e.stateValues.generateWords;if(Number.isInteger(t)&&t>0){let e=n.generateWords(t).split(" ").map((e=>({componentType:"text",children:[e]})));r.push(e[0]);for(let t of e.slice(1))r.push(" "),r.push(t)}}let a=e.attributes.newNamespace?.primitive;return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:r,parentName:e.componentName,parentCreatesNewNamespace:a,componentInfoObjects:t}).serializedComponents}}static async calculateReplacementChanges({component:e,componentInfoObjects:t}){let n=await this.createSerializedReplacements({component:e,componentInfoObjects:t});return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:n.replacements}]}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}}class UpdateValue extends InlineComponent{static componentType="updateValue";static acceptTarget=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"update value",public:!0,forRenderer:!0},e.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"math",toLowerCase:!0,validValues:["math","number","boolean","text"]},e.prop={createPrimitiveOfType:"string"},e.newValue={createComponentOfType:"_componentWithSelectableType"},e.componentIndex={createComponentOfType:"number",createStateVariable:"componentIndex",defaultValue:null,public:!0},e.propIndex={createComponentOfType:"number",createStateVariable:"propIndex",defaultValue:null,public:!0},e.triggerWhen={createComponentOfType:"boolean",createStateVariable:"triggerWhen",defaultValue:!1,triggerActionOnChange:"updateValueIfTriggerNewlyTrue"},e.triggerWithTargets={createPrimitiveOfType:"string"},e.simplify={createComponentOfType:"text",createStateVariable:"simplify",defaultValue:"none",public:!0,toLowerCase:!0,valueTransformations:{true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();e.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:e})=>({setValue:{target:e.target}})},e.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){let t=null;return e.targetComponent&&(t=e.targetComponent),{setValue:{targetComponent:t}}}},e.propName={returnDependencies:()=>({propName:{dependencyType:"attributePrimitive",attributeName:"prop"}}),definition:function({dependencyValues:e}){return{setValue:{propName:e.propName}}}},e.targetIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:e,componentInfoObjects:t}){let n={};return null!==e.targetComponent&&(t.isCompositeComponent({componentType:e.targetComponent.componentType,includeNonStandard:!1})?n.targets={dependencyType:"replacement",compositeName:e.targetComponent.componentName,recursive:!0,componentIndex:e.componentIndex}:null!==e.componentIndex&&1!==e.componentIndex||(n.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),n},definition({dependencyValues:e}){let t=null;return e.targets&&(t=e.targets,Array.isArray(t)||(t=[t])),{setValue:{targetIdentities:t}}}},e.targets={stateVariablesDeterminingDependencies:["targetIdentities","propName","propIndex"],returnDependencies:function({stateValues:e}){let t={targetIdentities:{dependencyType:"stateVariable",variableName:"targetIdentities"}};if(null!==e.targetIdentities)for(let[n,r]of e.targetIdentities.entries()){let a;a=e.propName?{dependencyType:"stateVariable",componentName:r.componentName,variableName:e.propName,returnAsComponentObject:!0,variablesOptional:!0,propIndex:e.propIndex,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}:{dependencyType:"componentIdentity",componentName:r.componentName},t["target"+n]=a}return t},definition({dependencyValues:e}){let t=null;if(null!==e.targetIdentities){t=[];for(let n in e.targetIdentities)e["target"+n]&&t.push(e["target"+n])}return{setValue:{targets:t}}}},e.newValue={returnDependencies:()=>({newValueAttr:{dependencyType:"attributeComponent",attributeName:"newValue",variableNames:["value"]},type:{dependencyType:"stateVariable",variableName:"type"},simplify:{dependencyType:"stateVariable",variableName:"simplify"}}),definition:function({dependencyValues:e}){if(null===e.newValueAttr)return{setValue:{newValue:null}};let t=e.newValueAttr.stateValues.value;return"math"===e.type&&(t=normalizeMathExpression({value:t,simplify:e.simplify})),{setValue:{newValue:t}}}},e.insideTriggerSet={returnDependencies:()=>({parentTriggerSet:{dependencyType:"parentStateVariable",parentComponentType:"triggerSet",variableName:"updateValueAndActionsToTrigger"}}),definition:({dependencyValues:e})=>({setValue:{insideTriggerSet:null!==e.parentTriggerSet}})},e.triggerWithTargets={returnDependencies:()=>({triggerWithTargets:{dependencyType:"attributePrimitive",attributeName:"triggerWithTargets"},triggerWhen:{dependencyType:"attributeComponent",attributeName:"triggerWhen"},insideTriggerSet:{dependencyType:"stateVariable",variableName:"insideTriggerSet"}}),definition:({dependencyValues:e})=>e.triggerWhen||e.insideTriggerSet||null===e.triggerWithTargets?{setValue:{triggerWithTargets:null}}:{setValue:{triggerWithTargets:e.triggerWithTargets.split(/\s+/).filter((e=>e))}}},e.triggerWithTargetComponentNames={chainActionOnActionOfStateVariableTargets:{triggeredAction:"updateValue"},stateVariablesDeterminingDependencies:["triggerWithTargets"],returnDependencies({stateValues:e}){let t={};if(e.triggerWithTargets)for(let[n,r]of e.triggerWithTargets.entries())t[`triggerWithTargetComponentName${n}`]={dependencyType:"expandTargetName",target:r};return t},definition({dependencyValues:e}){let t=[],n=Object.keys(e).length-1;for(let r=0;r<n;r++)t.push(e[`triggerWithTargetComponentName${r}`]);return{setValue:{triggerWithTargetComponentNames:t}}},markStale:()=>({updateActionChaining:!0})};let t=e.hidden.returnDependencies,n=e.hidden.definition;return e.hidden.returnDependencies=function(e){let n=t(e);return n.triggerWhen={dependencyType:"attributeComponent",attributeName:"triggerWhen"},n.triggerWithTargets={dependencyType:"stateVariable",variableName:"triggerWithTargets"},n.insideTriggerSet={dependencyType:"stateVariable",variableName:"insideTriggerSet"},n},e.hidden.definition=function(e){return e.dependencyValues.triggerWhen||e.dependencyValues.triggerWithTargets||e.dependencyValues.insideTriggerSet?{setValue:{hidden:!0}}:n(e)},e}async updateValue({actionId:e}){let t=await this.stateValues.targets,n=await this.stateValues.newValue;if(null===t||null===n)return;let r=[];for(let e of t){let t="value";e.stateValues&&(t=Object.keys(e.stateValues)[0],void 0===t)?console.warn(`Cannot update prop="${await this.stateValues.propName}" of ${await this.stateValues.target} as could not find prop ${await this.stateValues.propName} on a component of type ${e.componentType}`):r.push({updateType:"updateValue",componentName:e.componentName,stateVariable:t,value:n})}return await this.coreFunctions.performUpdate({updateInstructions:r,actionId:e,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:n,responseText:n.toString()}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}async updateValueIfTriggerNewlyTrue({stateValues:e,previousValues:t,actionId:n}){if(await e.triggerWhen&&!1===t.triggerWhen&&!await this.stateValues.insideTriggerSet)return await this.updateValue({actionId:n});this.coreFunctions.resolveAction({actionId:n})}actions={updateValue:this.updateValue.bind(this),updateValueIfTriggerNewlyTrue:this.updateValueIfTriggerNewlyTrue.bind(this)}}class CallAction extends InlineComponent{static componentType="callAction";static acceptTarget=!0;static keepChildrenSerialized({serializedComponent:e}){return void 0===e.children?[]:Object.keys(e.children)}static createAttributesObject(){let e=super.createAttributesObject();return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"call action",public:!0,forRenderer:!0},e.actionName={createComponentOfType:"text",createStateVariable:"actionName",defaultValue:null,public:!0},e.triggerWhen={createComponentOfType:"boolean",createStateVariable:"triggerWhen",defaultValue:!1,triggerActionOnChange:"callActionIfTriggerNewlyTrue"},e.triggerWithTargets={createPrimitiveOfType:"string"},e.numbers={createComponentOfType:"numberList"},e.number={createComponentOfType:"number"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();e.target={returnDependencies:()=>({target:{dependencyType:"doenetAttribute",attributeName:"target"}}),definition:({dependencyValues:e})=>({setValue:{target:e.target}})},e.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){let t=null;return e.targetComponent&&(t=e.targetComponent),{setValue:{targetComponent:t}}}},e.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition({dependencyValues:e}){let t=null;return e.targetComponent&&(t=e.targetComponent.componentName),{setValue:{targetName:t}}}},e.insideTriggerSet={returnDependencies:()=>({parentTriggerSet:{dependencyType:"parentStateVariable",parentComponentType:"triggerSet",variableName:"updateValueAndActionsToTrigger"}}),definition:({dependencyValues:e})=>({setValue:{insideTriggerSet:null!==e.parentTriggerSet}})},e.triggerWithTargets={returnDependencies:()=>({triggerWithTargets:{dependencyType:"attributePrimitive",attributeName:"triggerWithTargets"},triggerWhen:{dependencyType:"attributeComponent",attributeName:"triggerWhen"},insideTriggerSet:{dependencyType:"stateVariable",variableName:"insideTriggerSet"}}),definition:({dependencyValues:e})=>e.triggerWhen||e.insideTriggerSet||null===e.triggerWithTargets?{setValue:{triggerWithTargets:null}}:{setValue:{triggerWithTargets:e.triggerWithTargets.split(/\s+/).filter((e=>e))}}},e.triggerWithTargetComponentNames={chainActionOnActionOfStateVariableTargets:{triggeredAction:"callAction"},stateVariablesDeterminingDependencies:["triggerWithTargets"],returnDependencies({stateValues:e}){let t={};if(e.triggerWithTargets)for(let[n,r]of e.triggerWithTargets.entries())t[`triggerWithTargetComponentName${n}`]={dependencyType:"expandTargetName",target:r};return t},definition({dependencyValues:e}){let t=[],n=Object.keys(e).length-1;for(let r=0;r<n;r++)t.push(e[`triggerWithTargetComponentName${r}`]);return{setValue:{triggerWithTargetComponentNames:t}}},markStale:()=>({updateActionChaining:!0})};let t=e.hidden.returnDependencies,n=e.hidden.definition;return e.hidden.returnDependencies=function(e){let n=t(e);return n.triggerWhen={dependencyType:"attributeComponent",attributeName:"triggerWhen"},n.triggerWithTargets={dependencyType:"stateVariable",variableName:"triggerWithTargets"},n.insideTriggerSet={dependencyType:"stateVariable",variableName:"insideTriggerSet"},n},e.hidden.definition=function(e){return e.dependencyValues.triggerWhen||e.dependencyValues.triggerWithTargets||e.dependencyValues.insideTriggerSet?{setValue:{hidden:!0}}:n(e)},e}async callAction({actionId:e}){let t=await this.stateValues.targetName,n=await this.stateValues.actionName;if(null!==t&&null!==n){let r={};this.serializedChildren.length>0&&(r.serializedComponents=deepClone(this.serializedChildren)),this.attributes.number&&(r.number=await this.attributes.number.component.stateValues.value),this.attributes.numbers&&(r.numbers=await this.attributes.numbers.component.stateValues.numbers),e&&(r.actionId=e),await this.coreFunctions.performAction({componentName:t,actionName:n,args:r,event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType}}}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}else this.coreFunctions.resolveAction({actionId:e})}async callActionIfTriggerNewlyTrue({stateValues:e,previousValues:t,actionId:n}){if(e.triggerWhen&&!1===t.triggerWhen&&!await this.stateValues.insideTriggerSet)return await this.callAction({actionId:n});this.coreFunctions.resolveAction({actionId:n})}actions={callAction:this.callAction.bind(this),callActionIfTriggerNewlyTrue:this.callActionIfTriggerNewlyTrue.bind(this)}}class triggerSet extends InlineComponent{static componentType="triggerSet";static createAttributesObject(){let e=super.createAttributesObject();return e.label={createComponentOfType:"text",createStateVariable:"label",defaultValue:"update value",public:!0,forRenderer:!0},e.triggerWhen={createComponentOfType:"boolean",createStateVariable:"triggerWhen",defaultValue:!1,triggerActionOnChange:"triggerActionsIfTriggerNewlyTrue"},e.triggerWithTargets={createPrimitiveOfType:"string"},e}static returnChildGroups(){return[{group:"updateValuesCallActions",componentTypes:["updateValue","callAction"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();e.updateValueAndActionsToTrigger={returnDependencies:()=>({updateValueAndCallActionChildren:{dependencyType:"child",childGroups:["updateValuesCallActions"]}}),definition:({dependencyValues:e})=>({setValue:{updateValueAndActionsToTrigger:e.updateValueAndCallActionChildren}})},e.triggerWithTargets={returnDependencies:()=>({triggerWithTargets:{dependencyType:"attributePrimitive",attributeName:"triggerWithTargets"},triggerWhen:{dependencyType:"attributeComponent",attributeName:"triggerWhen"}}),definition:({dependencyValues:e})=>e.triggerWhen||null===e.triggerWithTargets?{setValue:{triggerWithTargets:null}}:{setValue:{triggerWithTargets:e.triggerWithTargets.split(/\s+/).filter((e=>e))}}},e.triggerWithTargetComponentNames={chainActionOnActionOfStateVariableTargets:{triggeredAction:"triggerActions"},stateVariablesDeterminingDependencies:["triggerWithTargets"],returnDependencies({stateValues:e}){let t={};if(e.triggerWithTargets)for(let[n,r]of e.triggerWithTargets.entries())t[`triggerWithTargetComponentName${n}`]={dependencyType:"expandTargetName",target:r};return t},definition({dependencyValues:e}){let t=[],n=Object.keys(e).length-1;for(let r=0;r<n;r++)t.push(e[`triggerWithTargetComponentName${r}`]);return{setValue:{triggerWithTargetComponentNames:t}}},markStale:()=>({updateActionChaining:!0})};let t=e.hidden.returnDependencies,n=e.hidden.definition;return e.hidden.returnDependencies=function(e){let n=t(e);return n.triggerWhen={dependencyType:"attributeComponent",attributeName:"triggerWhen"},n.triggerWithTargets={dependencyType:"stateVariable",variableName:"triggerWithTargets"},n},e.hidden.definition=function(e){return e.dependencyValues.triggerWhen||e.dependencyValues.triggerWithTargets?{setValue:{hidden:!0}}:n(e)},e}async triggerActions({actionId:e}){for(let e of await this.stateValues.updateValueAndActionsToTrigger)this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"updateValue"})?await this.coreFunctions.performAction({componentName:e.componentName,actionName:"updateValue"}):this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"callAction"})&&await this.coreFunctions.performAction({componentName:e.componentName,actionName:"callAction"});return this.coreFunctions.resolveAction({actionId:e}),await this.coreFunctions.triggerChainedActions({componentName:this.componentName})}async triggerActionsIfTriggerNewlyTrue({stateValues:e,previousValues:t,actionId:n}){if(e.triggerWhen&&!1===t.triggerWhen)return await this.triggerActions({actionId:n});this.coreFunctions.resolveAction({actionId:n})}actions={triggerActions:this.triggerActions.bind(this),triggerActionsIfTriggerNewlyTrue:this.triggerActionsIfTriggerNewlyTrue.bind(this)}}class FunctionIterates extends InlineComponent{static componentType="functionIterates";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.nIterates={createComponentOfType:"integer",createStateVariable:"nIterates",defaultValue:0,public:!0},e.forceSymbolic={createComponentOfType:"boolean",createStateVariable:"forceSymbolic",defaultValue:!1,public:!0},e.forceNumeric={createComponentOfType:"boolean",createStateVariable:"forceNumeric",defaultValue:!1,public:!0},e.initialValue={createComponentOfType:"math",createStateVariable:"initialValue",defaultValue:me$3.fromAst("")},e.function={createComponentOfType:"function"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["nInputs","nOutputs"]}}),definition:({dependencyValues:e})=>e.functionAttr?e.functionAttr.stateValues.nInputs!==e.functionAttr.stateValues.nOutputs?(console.warn("Function iterates are possible only if the number of inputs is equal to the number of outputs"),{setValue:{nDimensions:0}}):{setValue:{nDimensions:e.functionAttr.stateValues.nInputs}}:{setValue:{nDimensions:0}}},e.allIterates={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["symbolicfs","numericalfs","symbolic"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition({dependencyValues:e}){let t=[],n=e.functionAttr,r=e.initialValue,a=!e.forceNumeric&&(n.stateValues.symbolic||e.forceSymbolic),i=e.nIterates;if(!n||0===e.nDimensions||!(1===e.nDimensions||Array.isArray(r.tree)&&["vector","tuple"].includes(r.tree[0])&&r.tree.length===e.nDimensions+1))return t=Array(i).fill(me$3.fromAst("")),{setValue:{allIterates:t}};if(a)if(1===e.nDimensions){let e=n.stateValues.symbolicfs[0],a=r;for(let n=0;n<i;n++)a=e(a),t.push(a)}else{let a=n.stateValues.symbolicfs,o=r.tree.slice(1);for(let n=0;n<i;n++){let n=[];for(let t=0;t<e.nDimensions;t++)n.push(a[t](...o).tree);t.push(me$3.fromAst(["vector",...n])),o=n}}else if(1===e.nDimensions){let e=n.stateValues.numericalfs[0],a=r.evaluate_to_constant();if(null===a)t=Array(i).fill(me$3.fromAst(""));else for(let n=0;n<i;n++)a=e(a),t.push(me$3.fromAst(a))}else{let a=n.stateValues.numericalfs,o=r.tree.slice(1).map((e=>me$3.fromAst(e).evaluate_to_constant())).map((e=>null==e?NaN:e));for(let n=0;n<i;n++){let n=[];for(let t=0;t<e.nDimensions;t++)n.push(a[t](...o));t.push(me$3.fromAst(["vector",...n])),o=n}}return{setValue:{allIterates:t}}}},e.allIteratesWithInitial={public:!0,shadowingInstructions:{createComponentOfType:"mathList"},returnDependencies:()=>({initialValue:{dependencyType:"stateVariable",variableName:"initialValue"},allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}),definition:({dependencyValues:e})=>({setValue:{allIteratesWithInitial:[e.initialValue,...e.allIterates]}})},e.iterates={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"math"},entryPrefixes:["iterate"],returnArraySizeDependencies:()=>({nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),returnArraySize:({dependencyValues:e})=>[e.nIterates],returnArrayDependenciesByKey:()=>({globalDependencies:{allIterates:{dependencyType:"stateVariable",variableName:"allIterates"}}}),arrayDefinitionByKey({globalDependencyValues:e,arraySize:t}){let n={};for(let r=0;r<t[0];r++)n[r]=e.allIterates[r];return{setValue:{iterates:n}}}},e.finalIterate={public:!0,shadowingInstructions:{createComponentOfType:"math"},stateVariablesDeterminingDependencies:["nIterates"],returnDependencies:({stateValues:e})=>!Number.isFinite(e.nIterates)||e.nIterates<0?{}:e.nIterates>0?{finalIterate:{dependencyType:"stateVariable",variableName:`iterate${e.nIterates}`}}:{finalIterate:{dependencyType:"stateVariable",variableName:"initialValue"}},definition:({dependencyValues:e})=>({setValue:{finalIterate:e.finalIterate}})},e}}class Module extends Template{static componentType="module";static renderedDefault=!0;static acceptAnyAttribute=!0;static createAttributesObject(){let e=super.createAttributesObject();return delete e.styleNumber,e}}class CustomAttribute extends CompositeComponent{static componentType="customAttribute";static assignNamesToReplacements=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.componentType={createPrimitiveOfType:"string"},e.attribute={createPrimitiveOfType:"string"},e.defaultValue={leaveRaw:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.componentNameForAttributes={returnDependencies:()=>({parentVariableContainingName:{dependencyType:"parentStateVariable",variableName:"componentNameForAttributes"}}),definition:({dependencyValues:e})=>({setValue:{componentNameForAttributes:e.parentVariableContainingName}})},e.attributeName={returnDependencies:()=>({attribute:{dependencyType:"attributePrimitive",attributeName:"attribute"}}),definition:({dependencyValues:e})=>({setValue:{attributeName:e.attribute}})},e.readyToExpandWhenResolved={stateVariablesDeterminingDependencies:["componentNameForAttributes"],returnDependencies:({stateValues:e})=>({componentIdentity:{dependencyType:"componentIdentity",componentName:e.componentNameForAttributes}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e}static async createSerializedReplacements({component:e,components:t,workspace:n,componentInfoObjects:r,flags:a}){let i=e.attributes.newNamespace?.primitive,o=r.componentTypeLowerCaseMapping[e.attributes.componentType.primitive.toLowerCase()];if(!r.allComponentClasses[o])return console.warn(`Could not find component type ${o}`),{replacements:[]};let s=t[await e.stateValues.componentNameForAttributes],l={};for(let e in s.attributes)l[e.toLowerCase()]=e;let u=await e.stateValues.attributeName,c=l[u.toLowerCase()],p=s.attributes[c];if(void 0===p){if(void 0===e.attributes.defaultValue)return console.warn("Cannot create component from attribute if neither attribute nor default value specified"),{replacements:[]};p=e.attributes.defaultValue}let d=s.constructor,m=Object.keys(d.createAttributesObject()).map((e=>e.toLowerCase()));if(m.push("name","target","assignnames"),m.includes(u.toLowerCase()))return console.warn(`Cannot add attribute ${u} of a ${d.componentType} as it already exists in ${d.componentType} class`),{replacements:[]};let f=componentFromAttribute({attrObj:{createComponentOfType:o},value:p,componentInfoObjects:r}).component;if(f.children&&(applyMacros(f.children,r),i))for(let e of f.children)if("copy"===e.componentType){let t=e.doenetAttributes.target;/[a-zA-Z_]/.test(t[0])&&(e.doenetAttributes.target="../"+t)}return applySugar({serializedComponents:[f],isAttributeComponent:!0,componentInfoObjects:r}),setTNamesToAbsolute([f]),{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:[f],parentName:e.componentName,parentCreatesNewNamespace:i,componentInfoObjects:r}).serializedComponents}}}class Setup extends CompositeComponent{static componentType="setup";static returnChildGroups(){return[{group:"styleDefinitions",componentTypes:["styleDefinitions"]},{group:"feedbackDefinitions",componentTypes:["feedbackDefinitions"]},{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.componentNameForAttributes={returnDependencies:()=>({sourceCompositeIdentity:{dependencyType:"sourceCompositeIdentity"}}),definition({dependencyValues:e}){let t=null;return e.sourceCompositeIdentity&&(t=e.sourceCompositeIdentity.componentName),{setValue:{componentNameForAttributes:t}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e}}class Footnote extends InlineComponent{static componentType="footnote";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text?t+=n.stateValues.text:t+=" ";return{setValue:{text:t}}}},e.footnoteTag={public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0,returnDependencies:()=>({footnoteCounter:{dependencyType:"counter",counterName:"footnote"}}),definition:({dependencyValues:e})=>({setValue:{footnoteTag:String(e.footnoteCounter)}})},e}}class Caption extends BlockComponent{static componentType="caption";static rendererType="container";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlinesBlocks",componentTypes:["_inline","_block"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlinesBlocks"],variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="";for(let n of e.inlineChildren)"object"!=typeof n?t+=n.toString():"string"==typeof n.stateValues.text?t+=n.stateValues.text:t+=" ";return{setValue:{text:t}}}},e}}class Endpoint extends Point{static componentType="endpoint";static rendererType="point";static createAttributesObject(){let e=super.createAttributesObject();return e.open={createComponentOfType:"boolean",createStateVariable:"open",defaultValue:!1,public:!0,forRenderer:!0},e.switchable={createComponentOfType:"boolean",createStateVariable:"switchable",defaultValue:!1,public:!0,forRenderer:!0},e}async switchPoint({actionId:e}){if(await this.stateValues.switchable)return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!await this.stateValues.open}],actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{open:!await this.stateValues.open}}});this.coreFunctions.resolveAction({actionId:e})}}class Sort extends CompositeComponent{static componentType="sort";static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static assignNamesToReplacements=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.sortVectorsBy={createComponentOfType:"text",createStateVariable:"sortVectorsBy",defaultValue:"displacement",public:!0,toLowerCase:!0,validValues:["displacement","tail"]},e.sortByComponent={createComponentOfType:"integer",createStateVariable:"sortByComponent",defaultValue:"1",public:!0},e}static returnChildGroups(){return[{group:"mathNumbers",componentTypes:["number","math","numberList","mathList","point","vector"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.componentNamesForValues={returnDependencies:()=>({children:{dependencyType:"child",childGroups:["mathNumbers"],variableNames:["componentNamesInList"],variablesOptional:!0}}),definition({dependencyValues:e}){let t=[];for(let n of e.children)n.stateValues.componentNamesInList?t.push(...n.stateValues.componentNamesInList):t.push(n.componentName);return{setValue:{componentNamesForValues:t}}}},e.sortedValues={stateVariablesDeterminingDependencies:["componentNamesForValues","sortByComponent"],returnDependencies({stateValues:e}){let t={sortVectorsBy:{dependencyType:"stateVariable",variableName:"sortVectorsBy"},sortByComponent:{dependencyType:"stateVariable",variableName:"sortByComponent"}};for(let[n,r]of e.componentNamesForValues.entries())t[`component${n}`]={dependencyType:"multipleStateVariables",componentName:r,variableNames:["value",`x${e.sortByComponent}`,`tailX${e.sortByComponent}`],variablesOptional:!0};return t},definition({dependencyValues:e,componentInfoObjects:t}){let n=[];for(let r in e){if("component"!==r.substring(0,9))continue;let a=e[r];if(t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"number"}))n.push({componentName:a.componentName,numericalValue:a.stateValues.value});else if(t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"math"})){let e=a.stateValues.value.evaluate_to_constant();null===e&&(e=NaN),n.push({componentName:a.componentName,numericalValue:e})}else if(t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"point"})){let t=a.stateValues[`x${e.sortByComponent}`],r=NaN;t&&(r=t.evaluate_to_constant(),null===r&&(r=NaN)),n.push({componentName:a.componentName,numericalValue:r})}else if(t.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"vector"})){let t=NaN,r=a.stateValues[`x${e.sortByComponent}`];r="displacement"===e.sortVectorsBy?a.stateValues[`x${e.sortByComponent}`]:a.stateValues[`tailX${e.sortByComponent}`],r&&(t=r.evaluate_to_constant(),null===t&&(t=NaN)),n.push({componentName:a.componentName,numericalValue:t})}}return n.sort(((e,t)=>e.numericalValue-t.numericalValue)),{setValue:{sortedValues:n}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({sortedValues:{dependencyType:"stateVariable",variableName:"sortedValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,components:t,componentInfoObjects:n,workspace:r}){let a=[],i=[];for(let n of await e.stateValues.sortedValues){let e;if(void 0===n.listInd)e=t[n.componentName];else{e=t[n.componentName].activeChildren[n.listInd]}e&&(i.push(e.componentName),a.push(await e.serialize()))}r.uniqueIdentifiersUsed=[],a=postProcessCopy({serializedComponents:a,componentName:e.componentName,uniqueIdentifiersUsed:r.uniqueIdentifiersUsed});let o=processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:a,parentName:e.componentName,parentCreatesNewNamespace:await e.stateValues.newNamespace,componentInfoObjects:n});return r.componentsCopied=i,{replacements:o.serializedComponents}}static async calculateReplacementChanges({component:e,components:t,componentInfoObjects:n,workspace:r}){let a=[];for(let n of await e.stateValues.sortedValues){let e;if(void 0===n.listInd)e=t[n.componentName];else{e=t[n.componentName].activeChildren[n.listInd]}e&&a.push(e.componentName)}if(a.length==r.componentsCopied.length&&r.componentsCopied.every(((e,t)=>e===a[t])))return[];let i=(await this.createSerializedReplacements({component:e,components:t,componentInfoObjects:n,workspace:r})).replacements;return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:i}]}}class SolveEquations extends InlineComponent{static componentType="solveEquations";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.variables={createComponentOfType:"variables"},e.nDiscretizationPoints={createComponentOfType:"number",createStateVariable:"nDiscretizationPoints",defaultValue:100,public:!0},e.minVar={createComponentOfType:"number",createStateVariable:"minVar",defaultValue:null},e.maxVar={createComponentOfType:"number",createStateVariable:"maxVar",defaultValue:null},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){return e.every((e=>"string"==typeof e||e.doenetAttributes&&e.doenetAttributes.createdFromMacro))?1===e.length&&"string"!=typeof e[0]?{success:!1}:{success:!0,newChildren:[{componentType:"math",children:e}]}:{success:!1}}}),e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]},{group:"strings",componentTypes:["string"]}]}static returnStateVariableDefinitions({numerics:e}){let t=super.returnStateVariableDefinitions({numerics:e});return t.variables={isArray:!0,public:!0,shadowingInstructions:{createComponentOfType:"variable"},entryPrefixes:["variable"],returnArraySizeDependencies:()=>({}),returnArraySize:({dependencyValues:e})=>[1],returnArrayDependenciesByKey:({arrayKeys:e})=>({globalDependencies:{variablesAttr:{dependencyType:"attributeComponent",attributeName:"variables",variableNames:["variables"]}}}),arrayDefinitionByKey({globalDependencyValues:e,arraySize:t,arrayKeys:n,usedDefault:r}){let a=[];return null!==e.variablesAttr&&(a=e.variablesAttr.stateValues.variables),{setValue:{variables:returnNVariables(t[0],a)}}}},t.variable={isAlias:!0,targetVariableName:"variable1"},t.allSolutions={returnDependencies:()=>({mathChild:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},variables:{dependencyType:"stateVariable",variableName:"variables"},minVar:{dependencyType:"stateVariable",variableName:"minVar"},maxVar:{dependencyType:"stateVariable",variableName:"maxVar"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"}}),definition({dependencyValues:t}){if(0===t.mathChild.length)return{setValue:{allSolutions:[]}};let n=t.mathChild[0].stateValues.value;if(!Array.isArray(n.tree)||3!==n.tree.length||"="!==n.tree[0])return{setValue:{allSolutions:[]}};let r=t.minVar,a=t.maxVar,i=[],o=t.variables[0].subscripts_to_strings().tree,s=me$3.fromAst(["+",n.tree[1],["-",n.tree[2]]]).subscripts_to_strings(),l=s.f(),u=e=>l({[o]:e}),c=function(e){try{return u(e)}catch(e){return NaN}};if(Number.isFinite(r)||(r=-10),Number.isFinite(a)||(a=10),r>a)return{setValue:{allSolutions:[]}};let p=[r,a],d=[r];for(let e=0;e<p.length-1;e++){let n=p[e],r=p[e+1],a=t.nDiscretizationPoints,i=(r-n)/a;for(let e=1;e<a;e++)d.push(n+e*i);d.push(r)}let m=2*d[0]-d[1],f=2*d[d.length-1]-d[d.length-2];d=[m,...d,f];let h=d.map((function(e){try{return u(e)}catch(t){let n=(e=>normalizeMathExpression({value:s.substitute({[o]:e}).strings_to_subscripts(),simplify:!0,expand:!0}).evaluate_to_constant())(e);return null!==n?n:NaN}})),y=d[0],b=h[0];for(let e=0;e<d.length;e++){let t=d[e],n=h[e];if(!Number.isFinite(n)||!Number.isFinite(b)){let r,a;if(Number.isFinite(n)?(r=t,a=y):Number.isFinite(b)&&(r=y,a=t),void 0!==r){for(;;){let e=(r+a)/2;if(e===r||e===a)break;Number.isFinite(c(e))?r=e:a=e}[t,y].includes(r)||(d.splice(e,0,r),h.splice(e,0,c(r)))}}y=t,b=n}i=[],y=d[0],b=h[0],0===b&&i.push(y);for(let t=1;t<d.length;t++){let n=d[t],r=h[t];if(0===r){let a=!1;if(t<d.length-1){let o=d[t+1],s=h[t+1],l=y,u=b;if(b*s>0)for(let t=0;t<10;t++)if(y=.1*y+.9*n,o=.1*o+.9*n,b=c(y),s=c(o),b*s<0){b*u<0?(i.push(e.fzero(c,[l,y])),i.push(n)):(i.includes(n)||i.push(n),n=o,r=s),a=!0;break}}a||i.includes(n)||i.push(n)}else if(r*b<0)i.push(e.fzero(c,[y,n]));else if(0!==b&&t<d.length-1){let a=d[t+1];if((b-r)*(h[t+1]-r)>0&&(r>0&&b>r||r<0&&b<r)){let t;t=b>r?c:e=>-c(e);let o=e.fminbr(t,[y,a],void 0,1e-10);if(o.success){let t=o.x,a=c(t);a*b<0?(i.push(e.fzero(c,[y,t])),n=t,r=a):0===a&&i.push(t)}}}y=n,b=r}i=i.filter((e=>e>=r&&e<=a));let g=i.map((e=>me$3.fromAst(e)));return{setValue:{allSolutions:g}}}},t.numberSolutions={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({allSolutions:{dependencyType:"stateVariable",variableName:"allSolutions"}}),definition:({dependencyValues:e})=>({setValue:{numberSolutions:e.allSolutions.length}})},t.solutions={public:!0,shadowingInstructions:{createComponentOfType:"math"},isArray:!0,entryPrefixes:["solution"],returnArraySizeDependencies:()=>({numberSolutions:{dependencyType:"stateVariable",variableName:"numberSolutions"}}),returnArraySize:({dependencyValues:e})=>[e.numberSolutions],returnArrayDependenciesByKey:()=>({globalDependencies:{allSolutions:{dependencyType:"stateVariable",variableName:"allSolutions"}}}),arrayDefinitionByKey({globalDependencyValues:e}){let t={};for(let n=0;n<e.__array_size[0];n++)t[n]=e.allSolutions[n];return{setValue:{solutions:t}}}},t}}class SolutionContainer extends Template{static componentType="_solutionContainer";static stateVariableToEvaluateAfterReplacements="open";static createAttributesObject(){let e=super.createAttributesObject();return delete e.rendered,e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.rendered={returnDependencies:()=>({parentOpen:{dependencyType:"parentStateVariable",variableName:"open"}}),markStale:()=>({updateReplacements:!0}),definition:({dependencyValues:e})=>({setValue:{rendered:Boolean(e.parentOpen)}})},e}static async calculateReplacementChanges({component:e,componentInfoObjects:t}){if(await e.stateValues.rendered&&0===e.replacements.length){return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:0,serializedReplacements:(await this.createSerializedReplacements({component:e,componentInfoObjects:t})).replacements}]}return[]}}class SubsetOfRealsInput extends BlockComponent{static componentType="subsetOfRealsInput";actions={addPoint:this.addPoint.bind(this),deletePoint:this.deletePoint.bind(this),movePoint:this.movePoint.bind(this),togglePoint:this.togglePoint.bind(this),toggleInterval:this.toggleInterval.bind(this),clear:this.clear.bind(this),setToR:this.setToR.bind(this)};static variableForPlainMacro="subsetValue";static createAttributesObject(){let e=super.createAttributesObject();return e.xmin={createComponentOfType:"number",createStateVariable:"xmin",defaultValue:-10,public:!0,forRenderer:!0},e.xmax={createComponentOfType:"number",createStateVariable:"xmax",defaultValue:10,public:!0,forRenderer:!0},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:800,public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:300,public:!0,forRenderer:!0},e.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},e.dx={createComponentOfType:"number",createStateVariable:"dx",defaultValue:.5,public:!0},e.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:me$3.fromAst("x")},e.format={createComponentOfType:"text",createStateVariable:"format",defaultValue:"text",public:!0},e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e.bindValueTo={createComponentOfType:"subsetOfReals"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.subsetValue={public:!0,shadowingInstructions:{createComponentOfType:"subsetOfReals"},hasEssential:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["subsetValue"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"},variable:{dependencyType:"stateVariable",variableName:"variable"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{setValue:{subsetValue:e.bindValueTo.stateValues.subsetValue}}:{useEssentialOrDefaultValue:{subsetValue:{get defaultValue(){return parseValueIntoSubset({inputString:e.prefill,format:e.format,variable:e.variable})}}}}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.subsetValue,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"subsetValue",value:e.subsetValue}]}},e.pointsFromSubset={additionalStateVariablesDefined:["intervalsFromSubset"],returnDependencies:()=>({subsetValue:{dependencyType:"stateVariable",variableName:"subsetValue"}}),definition({dependencyValues:e}){function t(e,t){let n=[],r=[];if(e.points&&(n=e.points),e.intervals&&(r=e.intervals),t.points){let e=n.map((e=>e.value));for(let r of t.points){let t=e.indexOf(r.value);-1===t?n.push(r):n[t].inSubset||=r.inSubset}}return t.intervals&&r.push(...t.intervals),{points:n,intervals:r}}let{points:n,intervals:r}=function e(n){if(null===n||n.isEmpty())return{};if(n instanceof theModule.Union){let r=[],a=[];for(let i of n.subsets){let n=e(i);({points:r,intervals:a}=t({points:r,intervals:a},n))}return{points:r,intervals:a}}if(n instanceof theModule.RealLine)return{intervals:[[-1/0,1/0]]};if(n instanceof theModule.Singleton)return{points:[{value:n.element,inSubset:!0}]};if(n instanceof theModule.OpenInterval){let e=[[n.left,n.right]],t=[];return Number.isFinite(n.left)&&t.push({value:n.left,inSubset:!1}),Number.isFinite(n.right)&&t.push({value:n.right,inSubset:!1}),{intervals:e,points:t}}return{}}(e.subsetValue),a=n||[],i=r||[];return a.sort(((e,t)=>e.value-t.value)),i.sort(((e,t)=>e[0]-t[0])),{setValue:{pointsFromSubset:a,intervalsFromSubset:i}}}},e.additionalPoints={defaultValue:[],hasEssential:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{additionalPoints:!0}}),inverseDefinition:({desiredStateVariableValues:e})=>e.additionalPoints.every(Number.isFinite)?{success:!0,instructions:[{setEssentialValue:"additionalPoints",value:[...e.additionalPoints].sort(((e,t)=>e-t))}]}:{success:!1}},e.points={additionalStateVariablesDefined:[{variableName:"intervals",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({pointsFromSubset:{dependencyType:"stateVariable",variableName:"pointsFromSubset"},intervalsFromSubset:{dependencyType:"stateVariable",variableName:"intervalsFromSubset"},additionalPoints:{dependencyType:"stateVariable",variableName:"additionalPoints"}}),definition({dependencyValues:e}){let t=[...e.pointsFromSubset],n=[...e.intervalsFromSubset],r=[...e.additionalPoints].sort(((e,t)=>e-t)),a=[],i=[],o=0,s=1/0,l=0;r.length>0&&(s=r[0]);let u=n[0],c=-1/0;t.push({value:1/0,inSubset:!1});for(let e of t){let t=!1;for(u&&u[0]<e.value&&(t=!0);s<e.value;)s!==c&&(a.push({value:s,inSubset:t,isAdditional:!0,additionalPointInd:l}),i.push({left:c,right:s,inSubset:t}),c=s),l++,s=r[l],void 0===s&&(s=1/0);a.push(e),i.push({left:c,right:e.value,inSubset:t}),c=e.value,t&&(o++,u=n[o])}return a=a.slice(0,a.length-1),{setValue:{points:a,intervals:i}}}},e}async addPoint({value:e,actionId:t}){let n=await this.stateValues.dx,r=Math.round(Math.max(await this.stateValues.xmin,Math.min(await this.stateValues.xmax,e))/n)*n,a=[...await this.stateValues.pointsFromSubset],i=[...await this.stateValues.intervalsFromSubset],o=[...await this.stateValues.additionalPoints];if(!o.includes(r)){let e=a.map((e=>e.value));if(!e.includes(r)){let e=!1;for(let t of i)if(t[0]<r&&t[1]>r){e=!0;break}if(e)return o.push(r),await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:o}],actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{addedPoint:r,intervalsFromSubset:i,pointsFromSubset:a,additionalPoints:o}}});{a.push({value:r,inSubset:!0});let e=await this.createUpdateInstructions({intervalsFromSubset:i,pointsFromSubset:a,modifiedAdditionalPoints:!1,additionalPoints:o});return await this.coreFunctions.performUpdate({updateInstructions:e,actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{addedPoint:r,intervalsFromSubset:i,pointsFromSubset:a,additionalPoints:o}}})}}}this.coreFunctions.resolveAction({actionId:t})}async deletePoint({pointInd:e,actionId:t}){let n=await this.stateValues.points[e],r=[...await this.stateValues.additionalPoints],a=[...await this.stateValues.pointsFromSubset],i=[...await this.stateValues.intervalsFromSubset];if(n.isAdditional)return r.splice(n.additionalPointInd,1),await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:r}],actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{deletedPoint:n.value,intervalsFromSubset:i,pointsFromSubset:a,additionalPoints:r}}});{let o=!1,s=a.map((e=>e.value)).indexOf(n.value),l=i.map((e=>e[1])).indexOf(n.value),u=i.map((e=>e[0])).indexOf(n.value);if(-1!==l)if(-1!==u)i[l]=[i[l][0],i[u][1]],i.splice(u,1),a.splice(s,1);else{let t=(await this.stateValues.points)[e-1];if(t&&t.isAdditional)i[l]=[i[l][0],t.value],r.splice(n.additionalPointInd,1),o=!0,a.splice(s,1,t);else if(i.splice(l,1),a.splice(s,1),t&&!t.inSubset){let e=i.map((e=>e[1])).indexOf(t.value);-1===e&&(r.push(t.value),o=!0)}}else if(-1!==u){let t=(await this.stateValues.points)[e+1];if(t&&t.isAdditional)i[u]=[t.value,i[u][1]],r.splice(n.additionalPointInd,1),o=!0,a.splice(s,1,t);else if(i.splice(u,1),a.splice(s,1),t&&!t.inSubset){let e=i.map((e=>e[0])).indexOf(t.value);-1===e&&(r.push(t.value),o=!0)}}else a.splice(s,1);let c=await this.createUpdateInstructions({intervalsFromSubset:i,pointsFromSubset:a,modifiedAdditionalPoints:o,additionalPoints:r});return await this.coreFunctions.performUpdate({updateInstructions:c,actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{deletedPoint:n.value,intervalsFromSubset:i,pointsFromSubset:a,additionalPoints:r}}})}}async createUpdateInstructions({intervalsFromSubset:e,pointsFromSubset:t,modifiedAdditionalPoints:n,additionalPoints:r}){let a,i=await this.stateValues.dx,o=e=>Math.round(e/i)*i,s=[];for(let t of e)s.push(new theModule.OpenInterval(o(t[0]),o(t[1])));for(let e of t)e.inSubset&&s.push(new theModule.Singleton(o(e.value)));a=0===s.length?new theModule.EmptySet:1===s.length?s[0]:new theModule.Union(s);let l=[{componentName:this.componentName,updateType:"updateValue",stateVariable:"subsetValue",value:a}];return n&&l.push({componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:r.map(o)}),l}async movePoint({pointInd:e,value:t,transient:n,actionId:r}){let a=await this.stateValues.dx,i=Math.round(Math.max(await this.stateValues.xmin,Math.min(await this.stateValues.xmax,t))/a)*a,o=await this.stateValues.points,s=o[e],l=o[e-1];l&&(i=Math.max(i,l.value+a));let u=o[e+1];u&&(i=Math.min(i,u.value-a));let c=[...await this.stateValues.additionalPoints],p=[...await this.stateValues.pointsFromSubset],d=[...await this.stateValues.intervalsFromSubset];if(s.isAdditional)return c[s.additionalPointInd]=i,n?await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:c}],transient:!0,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"additionalPoints",value:c}],actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{movedPoint:i,intervalsFromSubset:d,pointsFromSubset:p,additionalPoints:c}}});{let e=p.map((e=>e.value)).indexOf(s.value),t=d.map((e=>e[1])).indexOf(s.value),a=d.map((e=>e[0])).indexOf(s.value);p[e]={value:i,inSubset:p[e].inSubset},-1!==t&&(d[t]=[d[t][0],i]),-1!==a&&(d[a]=[i,d[a][1]]);let o=await this.createUpdateInstructions({intervalsFromSubset:d,pointsFromSubset:p,modifiedAdditionalPoints:!1});return n?await this.coreFunctions.performUpdate({updateInstructions:o,transient:!0,actionId:r}):await this.coreFunctions.performUpdate({updateInstructions:o,actionId:r,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{movedPoint:i,intervalsFromSubset:d,pointsFromSubset:p,additionalPoints:c}}})}}async togglePoint({pointInd:e,actionId:t}){let n=(await this.stateValues.points)[e],r=[...await this.stateValues.pointsFromSubset],a=[...await this.stateValues.intervalsFromSubset],i=[...await this.stateValues.additionalPoints],o=!1;if(n.isAdditional)if(i.splice(n.additionalPointInd,1),o=!0,n.inSubset){for(let[e,t]of a.entries())if(t[0]<n.value&&t[1]>n.value){let r=[[t[0],n.value],[n.value,t[1]]];a.splice(e,1,...r);break}}else r.push({value:n.value,inSubset:!0});else{let e=r.map((e=>e.value)).indexOf(n.value),t=a.map((e=>e[1])).indexOf(n.value),s=a.map((e=>e[0])).indexOf(n.value);-1!==t?-1!==s?(a[t]=[a[t][0],a[s][1]],a.splice(s,1),r.splice(e,1),i.push(n.value),o=!0):r[e]={value:n.value,inSubset:!n.inSubset}:-1!==s?r[e]={value:n.value,inSubset:!n.inSubset}:(r.splice(e,1),i.push(n.value),o=!0)}let s=await this.createUpdateInstructions({intervalsFromSubset:a,pointsFromSubset:r,modifiedAdditionalPoints:o,additionalPoints:i});return await this.coreFunctions.performUpdate({updateInstructions:s,actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{toggledPoint:n.value,intervalsFromSubset:a,pointsFromSubset:r,additionalPoints:i}}})}async toggleInterval({intervalInd:e,actionId:t}){let n=(await this.stateValues.intervals)[e],r=await this.stateValues.points,a=r[e-1],i=r[e],o=[...await this.stateValues.pointsFromSubset],s=[...await this.stateValues.intervalsFromSubset],l=[...await this.stateValues.additionalPoints],u=!1;if(n.inSubset){let e,t;for(let[r,a]of s.entries())if(a[0]<=n.left&&a[1]>=n.right){t=a,e=r;break}if(n.left===t[0])if(n.right===t[1]){if(s.splice(e,1),a&&!a.inSubset){let e=s.map((e=>e[1])).indexOf(a.value);if(-1===e){let e=o.map((e=>e.value)).indexOf(a.value);o.splice(e,1),l.push(a.value),u=!0}}if(i&&!i.inSubset){let e=s.map((e=>e[0])).indexOf(i.value);if(-1===e){let e=o.map((e=>e.value)).indexOf(i.value);o.splice(e,1),l.push(i.value),u=!0}}}else{if(s[e]=[n.right,t[1]],a&&!a.inSubset){let e=s.map((e=>e[1])).indexOf(a.value);if(-1===e){let e=o.map((e=>e.value)).indexOf(a.value);o.splice(e,1),l.push(a.value),u=!0}}o.push({value:i.value,inSubset:!0}),l.splice(i.additionalPointInd,1),u=!0}else if(n.right===t[1]){if(s[e]=[t[0],n.left],i&&!i.inSubset){let e=s.map((e=>e[0])).indexOf(i.value);if(-1===e){let e=o.map((e=>e.value)).indexOf(i.value);o.splice(e,1),l.push(i.value),u=!0}}o.push({value:a.value,inSubset:!0}),l.splice(a.additionalPointInd,1),u=!0}else{let r=[[t[0],n.left],[n.right,t[1]]];s.splice(e,1,...r),o.push({value:a.value,inSubset:!0}),o.push({value:i.value,inSubset:!0}),l.splice(i.additionalPointInd,1),l.splice(a.additionalPointInd,1),u=!0}}else{let e=s.map((e=>e[1])).indexOf(n.left),t=s.map((e=>e[0])).indexOf(n.right);if(-1===e)-1===t?(s.push([n.left,n.right]),i&&i.isAdditional&&(l.splice(i.additionalPointInd,1),u=!0),a&&a.isAdditional&&(l.splice(a.additionalPointInd,1),u=!0)):(i.inSubset?(s[t]=[n.left,s[t][1]],l.push(i.value),u=!0):s.push([n.left,n.right]),a&&a.isAdditional&&(l.splice(a.additionalPointInd,1),u=!0));else if(-1===t)a.inSubset?(s[e]=[s[e][0],n.right],l.push(a.value),u=!0):s.push([n.left,n.right]),i&&i.isAdditional&&(l.splice(i.additionalPointInd,1),u=!0);else if(a.inSubset)if(i.inSubset){let n=[s[e][0],s[t][1]];s.splice(e,2,n),l.push(a.value),l.push(i.value),u=!0}else s[e]=[s[e][0],n.right],l.push(a.value),u=!0;else i.inSubset?(s[t]=[n.left,s[t][1]],l.push(i.value),u=!0):s.push([n.left,n.right])}let c=await this.createUpdateInstructions({intervalsFromSubset:s,pointsFromSubset:o,modifiedAdditionalPoints:u,additionalPoints:l});return await this.coreFunctions.performUpdate({updateInstructions:c,actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{toggledInterval:[n.left,n.right],intervalsFromSubset:s,pointsFromSubset:o,additionalPoints:l}}})}async clear({actionId:e}){let t=await this.createUpdateInstructions({intervalsFromSubset:[],pointsFromSubset:[],modifiedAdditionalPoints:!0,additionalPoints:[]});return await this.coreFunctions.performUpdate({updateInstructions:t,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{cleared:!0,intervalsFromSubset:[],pointsFromSubset:[],additionalPoints:[]}}})}async setToR({actionId:e}){let t=await this.createUpdateInstructions({intervalsFromSubset:[[-1/0,1/0]],pointsFromSubset:[],modifiedAdditionalPoints:!0,additionalPoints:[]});return await this.coreFunctions.performUpdate({updateInstructions:t,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{setToR:!0,intervalsFromSubset:[[-1/0,1/0]],pointsFromSubset:[],additionalPoints:[]}}})}}function parseValueIntoSubset({inputString:e,format:t,variable:n}){if(!e)return new theModule.EmptySet;let r;if("latex"===t)try{r=me$3.fromLatex(e)}catch(t){return console.warn(`Invalid latex for subsetOfRealsInput: ${e}`),new theModule.EmptySet}else if("text"===t)try{r=me$3.fromText(e)}catch(t){return console.warn(`Invalid text for subsetOfRealsInput: ${e}`),new theModule.EmptySet}return buildSubsetFromMathExpression(r,n)}class SubsetOfReals extends MathComponent{static componentType="subsetOfReals";static rendererType="math";static primaryStateVariableForDefinition="subsetValue";static createAttributesObject(){let e=super.createAttributesObject();return e.createIntervals.defaultValue=!0,e.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:me$3.fromAst("x")},e.displayMode={createComponentOfType:"text",createStateVariable:"displayMode",defaultValue:"intervals",public:!0,toLowerCase:!0,validValues:["intervals","inequalities"]},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return renameStateVariable({stateVariableDefinitions:e,oldName:"unnormalizedValue",newName:"unnormalizedValuePreliminary"}),e.value.shadowingInstructions.createComponentOfType="math",e.haveSingleSubsetChild={returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"]}}),definition:({dependencyValues:e,componentInfoObjects:t})=>({setValue:{haveSingleSubsetChild:1===e.mathChildren.length&&1===e.mathChildren.filter((e=>t.isInheritedComponentType({inheritedComponentType:e.componentType,baseComponentType:"subsetOfReals"}))).length}})},e.subsetValue={stateVariablesDeterminingDependencies:["haveSingleSubsetChild"],returnDependencies({stateValues:e}){let t={haveSingleSubsetChild:{dependencyType:"stateVariable",variableName:"haveSingleSubsetChild"}};return e.haveSingleSubsetChild?t.subsetChild={dependencyType:"child",childGroups:["maths"],variableNames:["subsetValue"]}:(t.unnormalizedValuePreliminary={dependencyType:"stateVariable",variableName:"unnormalizedValuePreliminary"},t.variable={dependencyType:"stateVariable",variableName:"variable"}),t},definition({dependencyValues:e}){let t;return t=e.haveSingleSubsetChild?e.subsetChild[0].stateValues.subsetValue:buildSubsetFromMathExpression(e.unnormalizedValuePreliminary,e.variable),{setValue:{subsetValue:t}}},async inverseDefinition({desiredStateVariableValues:e,dependencyValues:t,stateValues:n}){if(t.haveSingleSubsetChild)return{success:!0,instructions:[{setDependency:"subsetChild",desiredValue:e.subsetValue,childIndex:0,variableIndex:0}]};return{success:!0,instructions:[{setDependency:"unnormalizedValuePreliminary",desiredValue:mathExpressionFromSubsetValue({subsetValue:e.subsetValue,variable:t.variable,displayMode:await n.displayMode})}]}}},e.unnormalizedValue={returnDependencies:()=>({subsetValue:{dependencyType:"stateVariable",variableName:"subsetValue"},displayMode:{dependencyType:"stateVariable",variableName:"displayMode"},variable:{dependencyType:"stateVariable",variableName:"variable"}}),definition:({dependencyValues:e})=>({setValue:{unnormalizedValue:mathExpressionFromSubsetValue(e)}}),inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>({success:!0,instructions:[{setDependency:"subsetValue",desiredValue:buildSubsetFromMathExpression(e.unnormalizedValue,t.variable)}]})},e}}function mathExpressionFromSubsetValue({subsetValue:e,variable:t,displayMode:n="intervals"}){function r(e){return null===e?"":"intervals"===n?e.closedInterval?["interval",["tuple",e.left,e.right],["tuple",!0,!0]]:e.openClosedInterval?["interval",["tuple",e.left,e.right],["tuple",!1,!0]]:e.closedOpenInterval?["interval",["tuple",e.left,e.right],["tuple",!0,!1]]:e.toMathExpression().tree:e.closedInterval?["lts",["tuple",e.left,t,e.right],["tuple",!1,!1]]:e.openClosedInterval?e.left===-1/0?["le",t,e.right]:["lts",["tuple",e.left,t,e.right],["tuple",!0,!1]]:e.closedOpenInterval?e.right===1/0?["ge",t,e.left]:["lts",["tuple",e.left,t,e.right],["tuple",!1,!0]]:e instanceof theModule.OpenInterval?e.left===-1/0?["<",t,e.right]:e.right===1/0?[">",t,e.left]:["lts",["tuple",e.left,t,e.right],["tuple",!0,!0]]:e instanceof theModule.Singleton?["=",t,e.element]:e.isEmpty()?["in",t,""]:e instanceof theModule.RealLine?["in",t,"R"]:null}let a;if(e instanceof theModule.Union){let t=e.subsets.filter((e=>e instanceof theModule.Singleton)),i=e.subsets.filter((e=>e instanceof theModule.OpenInterval));for(let e=0;e<t.length;e++){let n=t[e].element;for(let r=0;r<i.length;r++){let a=i[r];n===a.left?(a.openClosedInterval?(a.closedInterval=!0,delete a.openClosedInterval):(a={left:a.left,right:a.right,closedOpenInterval:!0},i.splice(r,1,a)),t.splice(e,1),e--):n===a.right&&(a.closedOpenInterval?(a.closedInterval=!0,delete a.closedOpenInterval):(a={left:a.left,right:a.right,openClosedInterval:!0},i.splice(r,1,a)),t.splice(e,1),e--)}}let o=[...i,...t].sort(((e,t)=>(void 0===e.left?e.element:e.left)-(void 0===t.left?t.element:t.left))).map((e=>r(e)));a=o.length>1?"intervals"===n?me$3.fromAst(["union",...o]):me$3.fromAst(["or",...o]):me$3.fromAst(o[0])}else a=me$3.fromAst(r(e));return a}class Split extends CompositeComponent{static componentType="split";static assignNamesToReplacements=!0;static stateVariableToEvaluateAfterReplacements="readyToExpandWhenResolved";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.type={createPrimitiveOfType:"string",createStateVariable:"type",defaultPrimitiveValue:"text",toLowerCase:!0,validValues:["text"]},e.splitBy={createComponentOfType:"text",createStateVariable:"splitBy",defaultValue:"letter",toLowerCase:!0,validValues:["letter","word","comma"]},e}static returnSugarInstructions(){let e=[];return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){let n=t.type;return["text"].includes(n)||(n="text"),{success:!0,newChildren:[{componentType:n,children:e}]}}}),e}static returnChildGroups(){return[{group:"anything",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.originalValue={returnDependencies:()=>({child:{dependencyType:"child",childGroups:["anything"],variableNames:["value"]}}),definition:({dependencyValues:e})=>e.child.length>0?{setValue:{originalValue:e.child[0].stateValues.value}}:{setValue:{originalValue:null}},inverseDefinition:({desiredStateVariableValues:e,dependencyValues:t})=>t.child.length>0?{success:!0,instructions:[{setDependency:"child",desiredValue:e.originalValue,childIndex:0,variableIndex:0}]}:{success:!1}},e.splitValues={returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},originalValue:{dependencyType:"stateVariable",variableName:"originalValue"},splitBy:{dependencyType:"stateVariable",variableName:"splitBy"}}),definition({dependencyValues:e}){if(null===e.originalValue)return{setValue:{splitValues:[]}};let t=[];return t="letter"===e.splitBy?[...e.originalValue]:"word"===e.splitBy?e.originalValue.split(/\s+/):"comma"===e.splitBy?e.originalValue.split(/\s*,\s*/):[e.originalValue],{setValue:{splitValues:t}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({splitValues:{dependencyType:"stateVariable",variableName:"splitValues"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{setValue:{readyToExpandWhenResolved:!0}}}},e}static async createSerializedReplacements({component:e,componentInfoObjects:t}){let n=e.attributes.newNamespace?.primitive,r={componentType:"textList",state:{textsShadow:await e.stateValues.splitValues},downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:e.componentName,propVariable:"splitValues"}]}};return{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:[r],parentName:e.componentName,parentCreatesNewNamespace:n,componentInfoObjects:t}).serializedComponents}}}class BestFitLine extends Line{static componentType="bestFitLine";static rendererType="line";static createAttributesObject(){let e=super.createAttributesObject();return delete e.draggable,delete e.equation,delete e.through,delete e.slope,e.points={createComponentOfType:"_pointListComponent"},e}static returnSugarInstructions(){return[]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.draggable={shadowingInstructions:{createComponentOfType:"boolean"},public:!0,forRenderer:!0,returnDependencies:()=>({}),definition:()=>({setValue:{draggable:!1}})},e.nDimensions={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({}),definition:()=>({setValue:{nDimensions:2}})},delete e.nPointsPrescribed,delete e.basedOnSlope,delete e.dForSlope,delete e.essentialPoint1x,delete e.essentialPoint1y,delete e.equationIdentity,delete e.equation.stateVariablesDeterminingDependencies,e.equation.returnDependencies=()=>({points:{dependencyType:"attributeComponent",attributeName:"points",variableNames:["points","nDimensions"]},variables:{dependencyType:"stateVariable",variableName:"variables"}}),e.equation.definition=function({dependencyValues:e}){if(!e.points||e.points.stateValues.nDimensions<2||e.points.stateValues.points.length<1){let e=me$3.fromAst("");return{setValue:{equation:e,coeff0:e,coeffvar1:e,coeffvar2:e}}}let t=[],n=[];for(let r of e.points.stateValues.points){let e=r.slice(0,2).map((e=>e&&e.evaluate_to_constant()));e.every(Number.isFinite)&&(t.push([1,e[0]]),n.push([e[1]]))}if(0===t.length){let e=me$3.fromAst("");return{setValue:{equation:e,coeff0:e,coeffvar1:e,coeffvar2:e}}}t=me$3.math.matrix(t),n=me$3.math.matrix(n);let r=me$3.math.transpose(t),a=me$3.math.multiply(r,n),i=me$3.math.multiply(r,t),o=me$3.math.lusolve(i,a),s=me$3.fromAst(me$3.math.subset(o,me$3.math.index(0,0))),l=me$3.fromAst(me$3.math.subset(o,me$3.math.index(1,0))),u=me$3.fromAst(-1),c=e.variables,p=me$3.fromAst(["+",["*","a","x"],"c"]).substitute({a:l,c:s,x:c[0],y:c[1]}).simplify();return{setValue:{equation:me$3.fromAst(["=","y","r"]).substitute({r:p}),coeff0:s,coeffvar1:l,coeffvar2:u}}},delete e.equation.inverseDefinition,delete e.points.stateVariablesDeterminingDependencies,e.points.returnArrayDependenciesByKey=function(){return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},e}}class RegionBetweenCurveXAxis extends GraphicalComponent{static componentType="regionBetweenCurveXAxis";static createAttributesObject(){let e=super.createAttributesObject();return e.boundaryValues={createComponentOfType:"numberList",createStateVariable:"boundaryValues",defaultValue:[0,1],forRenderer:!0,public:!0},e.function={createComponentOfType:"function"},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.styleDescription={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let t;return t="none"===e.selectedStyle.fillColor?e.selectedStyle.lineColorWord:e.selectedStyle.fillColorWord,{setValue:{styleDescription:t}}}},e.styleDescriptionWithNoun={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({styleDescription:{dependencyType:"stateVariable",variableName:"styleDescription"}}),definition:function({dependencyValues:e}){return{setValue:{styleDescriptionWithNoun:e.styleDescription+" region"}}}},e.function={additionalStateVariablesDefined:[{variableName:"haveFunction",forRenderer:!0},{variableName:"fDefinition",forRenderer:!0}],returnDependencies:()=>({functionAttr:{dependencyType:"attributeComponent",attributeName:"function",variableNames:["numericalfs","nInputs","nOutputs","fDefinition"]}}),definition:({dependencyValues:e})=>null===e.functionAttr||1!==e.functionAttr.stateValues.nInputs||1!==e.functionAttr.stateValues.nOutputs?{setValue:{function:()=>NaN,haveFunction:!1,fDefinition:{}}}:{setValue:{function:e.functionAttr.stateValues.numericalfs[0],haveFunction:!0,fDefinition:e.functionAttr.stateValues.fDefinition}}},e}}class RegionHalfPlane extends GraphicalComponent{static componentType="regionHalfPlane";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.horizontal={createComponentOfType:"boolean",createStateVariable:"horizontal",defaultValue:!0,public:!0},e.boundaryValue={createComponentOfType:"number",createStateVariable:"boundaryValue",defaultValue:0,public:!0},e.greaterThan={createComponentOfType:"boolean",createStateVariable:"greaterThan",defaultValue:!0,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.nearestPoint={returnDependencies:()=>({horizontal:{dependencyType:"stateVariable",variableName:"horizontal"},boundaryValue:{dependencyType:"stateVariable",variableName:"boundaryValue"},greaterThan:{dependencyType:"stateVariable",variableName:"greaterThan"}}),definition({dependencyValues:e}){let t=e.boundaryValue;return{setValue:{nearestPoint:function({variables:n,scales:r}){if(!Number.isFinite(t))return{};if(e.horizontal){if(e.greaterThan){if(n.x1<t){let e=Object.assign({},n);return e.x1=t,e}return{}}if(n.x1>t){let e=Object.assign({},n);return e.x1=t,e}return{}}if(e.greaterThan){if(n.x2<t){let e=Object.assign({},n);return e.x2=t,e}return{}}if(n.x2>t){let e=Object.assign({},n);return e.x2=t,e}return{}}}}}},e}}class CodeEditor extends BlockComponent{static componentType="codeEditor";static variableForPlainMacro="value";static renderChildren=!0;static get stateVariablesShadowedForReference(){return["value"]}static createAttributesObject(){let e=super.createAttributesObject();return e.prefill={createComponentOfType:"text",createStateVariable:"prefill",defaultValue:"",public:!0},e.bindValueTo={createComponentOfType:"text"},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:600,isAbsolute:!0},forRenderer:!0,public:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:400,isAbsolute:!0},forRenderer:!0,public:!0},e.viewerRatio={createComponentOfType:"number",createStateVariable:"viewerRatio",defaultValue:.5,forRenderer:!0,public:!0},e.showResults={createComponentOfType:"boolean",createStateVariable:"showResults",defaultValue:!1,forRenderer:!0,public:!0},e.renderedName={createPrimitiveOfType:"string"},e.staticName={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){if(e.length>0)return{success:!1};let n={componentType:"codeViewer",children:[{componentType:"renderDoenetML"}]},r=[n];if(t.renderedName&&(n.attributes={renderedName:{primitive:t.renderedName}},n.children[0].props={name:t.renderedName}),t.staticName){let e={componentType:"codeViewer",attributes:{hide:{component:{componentType:"boolean",state:{value:!0}}}},children:[{componentType:"renderDoenetML",props:{name:t.staticName}}]};r.push(e)}return{success:!0,newChildren:r}}}),e}static returnChildGroups(){return[{group:"codeViewers",componentTypes:["codeViewer"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.viewerHeight={returnDependencies:()=>({height:{dependencyType:"stateVariable",variableName:"height"},viewerRatio:{dependencyType:"stateVariable",variableName:"viewerRatio"}}),definition:function({dependencyValues:e}){if(!e.height.isAbsolute)throw Error("Codeeditor relative height not implemented");return{setValue:{viewerHeight:{size:e.height.size*e.viewerRatio,isAbsolute:!0}}}}},e.value={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({bindValueTo:{dependencyType:"attributeComponent",attributeName:"bindValueTo",variableNames:["value"]},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueTo?{setValue:{value:e.bindValueTo.stateValues.value}}:{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:e.prefill}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:t}){return t.bindValueTo?{success:!0,instructions:[{setDependency:"bindValueTo",desiredValue:e.value,variableIndex:0}]}:{success:!0,instructions:[{setEssentialValue:"value",value:e.value}]}}},e.immediateValue={public:!0,shadowingInstructions:{createComponentOfType:"text"},hasEssential:!0,forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:t,justUpdatedForNewComponent:n}){return t.value&&!n?{setValue:{immediateValue:e.value},makeEssential:{immediateValue:!0}}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:t,shadowedVariable:n}){let r=[{setEssentialValue:"immediateValue",value:e.immediateValue}];return t||n||r.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:r}}},e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{setValue:{text:e.value}}}},e.componentType={returnDependencies:()=>({}),definition:()=>({setValue:{componentType:"text"}})},e}updateImmediateValue({text:e,actionId:t}){if(!this.stateValues.disabled)return this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:e}],actionId:t});this.coreFunctions.resolveAction({actionId:t})}updateValue({actionId:e}){if(!this.stateValues.disabled&&this.stateValues.immediateValue!==this.stateValues.value){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],n={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue}};return this.stateValues.answerAncestor&&(n.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.performUpdate({updateInstructions:t,actionId:e,event:n}).then((()=>{this.coreFunctions.triggerChainedActions({componentName:this.componentName}),this.attributes.staticName&&2===this.definingChildren.length&&"codeViewer"===this.definingChildren[1].componentType&&this.coreFunctions.performAction({componentName:this.definingChildren[1].componentName,actionName:"updateComponents"})}))}this.coreFunctions.resolveAction({actionId:e})}async updateComponents(){1===this.definingChildren.length&&"codeViewer"===this.definingChildren[0].componentType&&await this.coreFunctions.performAction({componentName:this.definingChildren[0].componentName,actionName:"updateComponents"})}actions={updateImmediateValue:this.updateImmediateValue.bind(this),updateValue:this.updateValue.bind(this),updateComponents:this.updateComponents.bind(this)}}class CodeViewer extends BlockComponent{static componentType="codeViewer";static renderChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.codeSource={createPrimitiveOfType:"string",createStateVariable:"rawCodeSource",defaultValue:null},e.width={createComponentOfType:"_componentSize"},e.height={createComponentOfType:"_componentSize"},e.hasCodeEditorParent={createComponentOfType:"boolean"},e.renderedName={createPrimitiveOfType:"string"},e}static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e,componentAttributes:t}){if(e.length>0)return{success:!1};let n={componentType:"renderDoenetML"};return t.codeSource&&(n.attributes={codeSource:{primitive:t.codeSource}}),t.renderedName&&(n.props={name:t.renderedName}),{success:!0,newChildren:[n]}}}),e}static returnChildGroups(){return[{group:"children",componentTypes:["_base"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.hasCodeEditorParent={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({codeEditorParent:{dependencyType:"parentIdentity",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:e}){return e.codeEditorParent?{setValue:{hasCodeEditorParent:!0}}:{setValue:{hasCodeEditorParent:!1}}}},e.width={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,forRenderer:!0,defaultValue:{size:600,isAbsolute:!0},returnDependencies:()=>({widthAttr:{dependencyType:"attributeComponent",attributeName:"width",variableNames:["componentSize"]},parentWidth:{dependencyType:"parentStateVariable",variableName:"width",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:e}){return e.widthAttr?{setValue:{width:e.widthAttr.stateValues.componentSize}}:e.parentWidth?{setValue:{width:e.parentWidth}}:{useEssentialOrDefaultValue:{width:!0}}}},e.height={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,forRenderer:!0,defaultValue:{size:400,isAbsolute:!0},returnDependencies:()=>({heightAttr:{dependencyType:"attributeComponent",attributeName:"height",variableNames:["componentSize"]},parentViewerHeight:{dependencyType:"parentStateVariable",variableName:"viewerHeight",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:e}){return e.heightAttr?{setValue:{height:e.heightAttr.stateValues.componentSize}}:e.parentViewerHeight?{setValue:{height:e.parentViewerHeight}}:{useEssentialOrDefaultValue:{height:!0}}}},e.codeSourceComponentName={stateVariablesDeterminingDependencies:["rawCodeSource"],returnDependencies:({stateValues:e})=>e.rawCodeSource?{codeSourceComponentName:{dependencyType:"expandTargetName",target:e.rawCodeSource}}:{},definition:({dependencyValues:e})=>({setValue:{codeSourceComponentName:e.codeSourceComponentName}})},e.codeSource={returnDependencies:()=>({codeSourceComponentName:{dependencyType:"stateVariable",variableName:"codeSourceComponentName"},codeEditorParent:{dependencyType:"parentIdentity",parentComponentType:"codeEditor"}}),definition:function({dependencyValues:e}){return e.codeSourceComponentName?{setValue:{codeSource:e.codeSourceComponentName}}:e.codeEditorParent?{setValue:{codeSource:e.codeEditorParent.componentName}}:{setValue:{codeSource:null}}}},e}async updateComponents(){1===this.definingChildren.length&&"renderDoenetML"===this.definingChildren[0].componentType&&await this.coreFunctions.performAction({componentName:this.definingChildren[0].componentName,actionName:"updateComponents"})}actions={updateComponents:this.updateComponents.bind(this)}}class RenderDoenetML extends CompositeComponent{static componentType="renderDoenetML";static assignNamesToReplacements=!0;static createsVariants=!0;static stateVariableToEvaluateAfterReplacements="triggerUpdates";static createAttributesObject(){let e=super.createAttributesObject();return e.assignNamesSkip={createPrimitiveOfType:"number"},e.codeSource={createPrimitiveOfType:"string",createStateVariable:"rawCodeSource",defaultValue:null},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.codeSourceComponentName={stateVariablesDeterminingDependencies:["rawCodeSource"],returnDependencies:({stateValues:e})=>e.rawCodeSource?{codeSourceComponentName:{dependencyType:"expandTargetName",target:e.rawCodeSource}}:{},definition:({dependencyValues:e})=>({setValue:{codeSourceComponentName:e.codeSourceComponentName}})},e.codeSource={returnDependencies:()=>({codeSourceComponentName:{dependencyType:"stateVariable",variableName:"codeSourceComponentName"},parentCodeSource:{dependencyType:"parentStateVariable",parentComponentType:"codeViewer",variableName:"codeSource"}}),definition:function({dependencyValues:e}){return e.codeSourceComponentName?{setValue:{codeSource:e.codeSourceComponentName}}:e.parentCodeSource?{setValue:{codeSource:e.parentCodeSource}}:{setValue:{codeSource:null}}}},e.doenetML={stateVariablesDeterminingDependencies:["codeSource"],returnDependencies:({stateValues:e})=>({doenetML:{dependencyType:"stateVariable",componentName:e.codeSource,variableName:"text",variablesOptional:!0}}),definition({dependencyValues:e}){let t="";return e.doenetML&&(t=e.doenetML,"string"!=typeof t&&(t="")),{setValue:{doenetML:t}}}},e.readyToExpandWhenResolved={returnDependencies:()=>({doenetML:{dependencyType:"stateVariable",variableName:"doenetML"}}),definition:()=>({setValue:{readyToExpandWhenResolved:!0}})},e.triggerUpdates={defaultValue:!0,hasEssential:!0,returnDependencies:()=>({}),markStale:()=>({updateReplacements:!0}),definition:()=>({useEssentialOrDefaultValue:{triggerUpdates:{}}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"triggerUpdates",value:e.triggerUpdates}]})},e.isVariantComponent={returnDependencies:()=>({}),definition:()=>({setValue:{isVariantComponent:!0}})},e.generatedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:t})=>({variantSeed:{dependencyType:"value",value:e.variantSeed},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(t.componentTypesCreatingVariants),variableNames:["isVariantComponent","generatedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfEncounteredComposites:!0}}),definition({dependencyValues:e,componentName:t}){let n={seed:e.variantSeed,meta:{createdBy:t}},r=n.subvariants=[];for(let t of e.variantDescendants)t.stateValues.isVariantComponent?r.push(t.stateValues.generatedVariantInfo):t.stateValues.generatedVariantInfo&&r.push(...t.stateValues.generatedVariantInfo.subvariants);return{setValue:{generatedVariantInfo:n}}}},e}static async createSerializedReplacements({component:e,componentInfoObjects:t,flags:n,workspace:r}){let a=[],i=(await e.stateValues.doenetML).trim();r.previousDoenetML=i;try{a=(await expandDoenetMLsToFullSerializedComponents({cids:[],doenetMLs:[i],componentInfoObjects:t,flags:n})).fullSerializedComponents[0]}catch(e){return console.warn("error in user entered doenetML"),console.warn(e.message),{replacements:[]}}let o=e.componentName.split("/").map((e=>({namespace:e,componentCounts:{},namesUsed:{}})));return createComponentNames({serializedComponents:a,componentInfoObjects:t,namespaceStack:o}),restrictTNamesToNamespace({components:a,namespace:`${e.componentName}/`}),{replacements:processAssignNames({assignNames:e.doenetAttributes.assignNames,serializedComponents:a,parentName:e.componentName,parentCreatesNewNamespace:!0,componentInfoObjects:t,originalNamesAreConsistent:!0}).serializedComponents}}static async calculateReplacementChanges({component:e,componentChanges:t,componentInfoObjects:n,flags:r,workspace:a}){let i=(await e.stateValues.doenetML).trim();if(a.previousDoenetML===i)return[];a.previousDoenetML=i;let o=(await this.createSerializedReplacements({component:e,componentInfoObjects:n,flags:r,workspace:a})).replacements;return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:e.replacements.length,serializedReplacements:o}]}static async setUpVariant({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n}){setUpVariantSeedAndRng({serializedComponent:e,sharedParameters:t,descendantVariantComponents:n})}async updateComponents({actionId:e}){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"triggerUpdates",value:!0}];await this.coreFunctions.performUpdate({updateInstructions:t,actionId:e})}actions={updateComponents:this.updateComponents.bind(this)}}class HasSameFactoring extends BooleanComponent{static componentType="hasSameFactoring";static rendererType="boolean";static createAttributesObject(){let e=super.createAttributesObject();return e.variable={createComponentOfType:"variable",createStateVariable:"variable",defaultValue:me$3.fromAst("x")},e.restrictDivision={createComponentOfType:"boolean",createStateVariable:"restrictDivision",defaultValue:!1},e.monomialFactorMustMatch={createComponentOfType:"boolean",createStateVariable:"monomialFactorMustMatch",defaultValue:!1},e.allowOnlySignDifferences={createComponentOfType:"boolean",createStateVariable:"allowOnlySignDifferences",defaultValue:!1},e}static returnChildGroups(){return[{group:"maths",componentTypes:["math"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return delete e.parsedExpression,delete e.mathChildrenByCode,e.value={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childGroups:["maths"],variableNames:["value"]},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},variable:{dependencyType:"stateVariable",variableName:"variable"},restrictDivision:{dependencyType:"stateVariable",variableName:"restrictDivision"},monomialFactorMustMatch:{dependencyType:"stateVariable",variableName:"monomialFactorMustMatch"},allowOnlySignDifferences:{dependencyType:"stateVariable",variableName:"allowOnlySignDifferences"}}),definition:function({dependencyValues:e}){if(2!==e.mathChildren.length)return{setValue:{value:!1}};let t=e.mathChildren[0].stateValues.value,n=e.mathChildren[1].stateValues.value;if(1!==checkEquality({object1:t,object2:n,isUnordered:!1,partialMatches:!1,symbolicEquality:!1,allowedErrorInNumbers:e.allowedErrorInNumbers,includeErrorInNumberExponents:e.includeErrorInNumberExponents,allowedErrorIsAbsolute:e.allowedErrorIsAbsolute,nSignErrorsMatched:e.nSignErrorsMatched}).fraction_equal)return{setValue:{value:!1}};if(Array.isArray(t.tree)&&"-"===t.tree[0]&&(t=me$3.fromAst(t.tree[1])),Array.isArray(n.tree)&&"-"===n.tree[0]&&(n=me$3.fromAst(n.tree[1])),e.restrictDivision||e.monomialFactorMustMatch||e.allowOnlySignDifferences||(Array.isArray(t.tree)&&"/"===t.tree[0]&&0===me$3.fromAst(t.tree[2]).variables().length&&(t=me$3.fromAst(t.tree[1]),Array.isArray(t.tree)&&"-"===t.tree[0]&&(t=me$3.fromAst(t.tree[1]))),Array.isArray(n.tree)&&"/"===n.tree[0]&&0===me$3.fromAst(n.tree[2]).variables().length&&(n=me$3.fromAst(n.tree[1]),Array.isArray(n.tree)&&"-"===n.tree[0]&&(n=me$3.fromAst(n.tree[1])))),t=me$3.fromAst(expandPositiveIntegerPowers(t.tree)),n=me$3.fromAst(expandPositiveIntegerPowers(n.tree)),!Array.isArray(t.tree)||"*"!==t.tree[0])return Array.isArray(n.tree)&&"*"===n.tree[0]?{setValue:{value:!1}}:{setValue:{value:!0}};if(!Array.isArray(n.tree)||"*"!==n.tree[0])return{setValue:{value:!1}};if(e.monomialFactorMustMatch||e.allowOnlySignDifferences){let e=findMonomialFromFactors(t.tree.slice(1)),r=findMonomialFromFactors(n.tree.slice(1));if(!e.equals(r)){let t=me$3.fromAst(["-",r.tree]);if(!e.equals(t))return{setValue:{value:!1}}}}if(e.allowOnlySignDifferences){let r=normalizeFactorSigns(t),a=normalizeFactorSigns(n);return{setValue:{value:r.equalsViaSyntax(a,{allowed_error_in_numbers:e.allowedErrorInNumbers,include_error_in_number_exponents:e.includeErrorInNumberExponents,allowed_error_is_absolute:e.allowedErrorIsAbsolute})}}}let r=t.tree.slice(1).filter((e=>me$3.fromAst(e).variables().length>0)),a=n.tree.slice(1).filter((e=>me$3.fromAst(e).variables().length>0));if(r.length!==a.length)return{setValue:{value:!1}};let i=0,o=0,s=0,l=0,u=e.variable.subscripts_to_strings().tree;for(let e of r){let t=me$3.fromAst(e).subscripts_to_strings().derivative(u).derivative(u).simplify();if(0===t.tree)o++;else{if(0!==t.variables().length)return{setValue:{value:!1}};i++}}for(let e of a){let t=me$3.fromAst(e).subscripts_to_strings().derivative(u).derivative(u).simplify();if(0===t.tree)l++;else{if(0!==t.variables().length)return{setValue:{value:!1}};s++}}return{setValue:{value:o===l&&i===s}}}},e}}function expandPositiveIntegerPowers(e){if(!Array.isArray(e))return e;if("^"===e[0]){let t=e[1],n=e[2];Number.isInteger(n)&&n>0&&(e=["*",...Array(n).fill(t)])}if("*"===e[0]){let t=e;e=["*"];for(let n of t.slice(1))if(Array.isArray(n)&&"^"===n[0]){let t=n[1],r=n[2];Number.isInteger(r)&&r>0?e.push(...Array(r).fill(t)):e.push(n)}else e.push(n)}return e}function findMonomialFromFactors(e){let t,n=[],r=!1;for(let t of e)if("string"==typeof t||0===me$3.fromAst(t).variables().length){if(!r){if(n.length>0)return me$3.fromAst("");r=!0}n.push(t)}else r=!1;return t=0===n.length?1:1===n.length?n[0]:["*",...n],me$3.fromAst(t)}function normalizeFactorSigns(e){let t=e.simplify().tree;if("-"===t[0]&&(t=t[1]),"*"!==t[0])return me$3.fromAst(t).simplify();let n=["*"];for(let e of t.slice(1))if("number"==typeof e)e<0?n.push(-e):n.push(e);else if(Array.isArray(e))if("-"===e[0])n.push(e[1]);else if("+"===e[0]){let t=!1,r=e[1];if("number"==typeof r)r<0&&(t=!0);else if(Array.isArray(r))if("-"===r[0])t=!0;else if("*"===r[0]){let e=r[1];"number"==typeof e?e<0&&(t=!0):Array.isArray(e)&&"-"===e[0]&&(t=!0)}t?n.push(me$3.fromAst(["-",e]).simplify().tree):n.push(e)}else n.push(e);else n.push(e);return me$3.fromAst(n).simplify()}class OrbitalDiagramInput extends BlockComponent{static componentType="orbitalDiagramInput";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.prefill={createComponentOfType:"orbitalDiagram",createStateVariable:"prefill",defaultValue:[]},e.prefillLabel={createComponentOfType:"textList",createStateVariable:"prefillLabel",defaultValue:[]},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={defaultValue:[{orbitalText:"",boxes:[]}],hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},returnDependencies:()=>({prefill:{dependencyType:"stateVariable",variableName:"prefill"},prefillLabel:{dependencyType:"stateVariable",variableName:"prefillLabel"}}),definition:function({dependencyValues:e}){return{useEssentialOrDefaultValue:{value:{get defaultValue(){return function(){if(e.prefill?.length>0){let t=JSON.parse(JSON.stringify(e.prefill));for(let[n,r]of t.entries())e.prefillLabel[n]&&(r.orbitalText=e.prefillLabel[n]);return t}return[{orbitalText:"",boxes:[]}]}()}}}}},inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setEssentialValue:"value",value:e.value}]})},e.rows={public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({setValue:{rows:[...e.value].reverse()}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"value",desiredValue:[...e.rows].reverse()}]})},e.numRows={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({rows:{dependencyType:"stateVariable",variableName:"rows"}}),definition:function({dependencyValues:e}){return{setValue:{numRows:e.rows.length}}}},e.selectedRowIndex={defaultValue:0,hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({}),definition:function(){return{useEssentialOrDefaultValue:{selectedRowIndex:!0}}},async inverseDefinition({desiredStateVariableValues:e,stateValues:t}){let n=await t.numRows,r=e.selectedRowIndex;return r=Number.isFinite(r)?Math.min(n,Math.max(0,Math.round(r))):0,{success:!0,instructions:[{setEssentialValue:"selectedRowIndex",value:r}]}}},e.selectedBoxIndex={defaultValue:0,hasEssential:!0,forRenderer:!0,public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({}),definition:function(){return{useEssentialOrDefaultValue:{selectedBoxIndex:!0}}},async inverseDefinition({desiredStateVariableValues:e}){let t=e.selectedBoxIndex;return t=Number.isFinite(t)?Math.max(0,Math.round(t)):0,{success:!0,instructions:[{setEssentialValue:"selectedBoxIndex",value:t}]}}},e}async addRow({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t));t.length<20&&(n=[{orbitalText:"",boxes:[]},...t]);let r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];return-1!==await this.stateValues.selectedRowIndex-1&&r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:0}),-1!==await this.stateValues.selectedBoxIndex-1&&r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}),await this.coreFunctions.performUpdate({updateInstructions:r,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async removeRow({actionId:e}){let t=await this.stateValues.rows,n=await this.stateValues.selectedRowIndex-1,r=JSON.parse(JSON.stringify(t));if(t.length>1){let e=t.length-1-n;-1===n&&(e=0),r.splice(e,1)}return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:r},{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:0},{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}],actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:r}}})}async addBox({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t)),r=await this.stateValues.selectedRowIndex-1,a=t.length-r-1;-1===r&&(a=0),n[a].boxes.length<17&&n[a].boxes.push("");let i=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];if(-1!==r){let e=0;i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:e})}return await this.coreFunctions.performUpdate({updateInstructions:i,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async removeBox({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t)),r=await this.stateValues.selectedRowIndex-1,a=t.length-r-1;-1===r&&(a=0);let i=await this.stateValues.selectedBoxIndex-1,o=i;-1===i&&(o=n[a].boxes.length-1),n[a].boxes.splice(o,1);let s=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];return-1!==i&&s.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:0}),await this.coreFunctions.performUpdate({updateInstructions:s,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async addUpArrow({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t)),r=await this.stateValues.selectedRowIndex-1,a=t.length-r-1;-1===r&&(a=0);let i=await this.stateValues.selectedBoxIndex-1,o=i;-1===i&&(o=n[a].boxes.length-1),n[a].boxes.length>0&&n[a].boxes[o].length<3&&(n[a].boxes[o]=n[a].boxes[o]+"U");let s=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];return await this.coreFunctions.performUpdate({updateInstructions:s,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async addDownArrow({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t)),r=await this.stateValues.selectedRowIndex-1,a=t.length-r-1;-1===r&&(a=0);let i=await this.stateValues.selectedBoxIndex-1,o=i;-1===i&&(o=n[a].boxes.length-1),n[a].boxes.length>0&&n[a].boxes[o].length<3&&(n[a].boxes[o]=n[a].boxes[o]+"D");let s=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];return await this.coreFunctions.performUpdate({updateInstructions:s,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async removeArrow({actionId:e}){let t=await this.stateValues.rows,n=JSON.parse(JSON.stringify(t)),r=await this.stateValues.selectedRowIndex-1,a=t.length-r-1;-1===r&&(a=0);let i=await this.stateValues.selectedBoxIndex-1,o=i;-1===i&&(o=n[a].boxes.length-1),n[a].boxes.length>0&&n[a].boxes[o].length>0&&(n[a].boxes[o]=n[a].boxes[o].slice(0,-1));let s=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:n}];return await this.coreFunctions.performUpdate({updateInstructions:s,actionId:e,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:n}}})}async updateRowText({newValue:e,actionId:t}){let n=await this.stateValues.rows,r=JSON.parse(JSON.stringify(n)),a=await this.stateValues.selectedRowIndex-1,i=n.length-a-1;-1===a&&(i=0),r[i].orbitalText=e;let o=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"rows",value:r}];return await this.coreFunctions.performUpdate({updateInstructions:o,actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{rows:r}}})}async selectRow({index:e,actionId:t}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedRowIndex",value:e}],actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{selectedRowIndex:e}}})}async selectBox({index:e,actionId:t}){return await this.coreFunctions.performUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"selectedBoxIndex",value:e}],actionId:t,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{selectedBoxIndex:e}}})}actions={addRow:this.addRow.bind(this),removeRow:this.removeRow.bind(this),addBox:this.addBox.bind(this),removeBox:this.removeBox.bind(this),addUpArrow:this.addUpArrow.bind(this),addDownArrow:this.addDownArrow.bind(this),removeArrow:this.removeArrow.bind(this),updateRowText:this.updateRowText.bind(this),selectRow:this.selectRow.bind(this),selectBox:this.selectBox.bind(this)}}class OrbitalDiagram extends BaseComponent{static componentType="orbitalDiagram";static variableForPlainMacro="value";static createAttributesObject(){let e=super.createAttributesObject();return e.labels={createComponentOfType:"textList",createStateVariable:"labels",defaultValue:[]},e}static returnSugarInstructions(){return[{replacementFunction:function({matchedChildren:e}){return 1===e.length&&"string"!=typeof e[0]?{success:!1}:{success:!0,newChildren:[{componentType:"tupleList",children:e}]}}}]}static returnChildGroups(){return[{group:"tupleLists",componentTypes:["tupleList"]},{group:"orbitalDiagrams",componentTypes:["orbitalDiagram"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.value={defaultValue:[{orbitalText:"",boxes:[]}],public:!0,shadowingInstructions:{createComponentOfType:"orbitalDiagram"},forRenderer:!0,returnDependencies:()=>({orbitalDiagramChildren:{dependencyType:"child",childGroups:["orbitalDiagrams"],variableNames:["value"]},tupleListChildren:{dependencyType:"child",childGroups:["tupleLists"],variableNames:["maths"]},labels:{dependencyType:"stateVariable",variableName:"labels"}}),definition:function({dependencyValues:e}){return{setValue:{value:function(){function t(e){if("u"===e||"U"===e)return"U";if("d"===e||"D"===e)return"D";if("e"===e||"E"===e)return"";if(Array.isArray(e)&&"*"===e[0]){let t="";for(let n of e.slice(1))if("u"===n||"U"===n)t+="U";else{if("d"!==n&&"D"!==n)return"";t+="D"}return t}return""}if(1===e.orbitalDiagramChildren.length)return e.orbitalDiagramChildren[0].stateValues.value;let n=[];if(e.tupleListChildren[0]?.stateValues.maths.length>0){let r=e.tupleListChildren[0].stateValues.maths;for(let[a,i]of r.entries()){let r="";e.labels[a]&&(r=e.labels[a]);let o=[];if(Array.isArray(i.tree)&&"tuple"===i.tree[0])for(let e of i.tree.slice(1))o.push(t(e));else o.push(t(i.tree));n.push({orbitalText:r,boxes:o})}return n}return[{orbitalText:"",boxes:[]}]}()}}}},e}}class DataFrame extends BaseComponent{static componentType="dataFrame";static rendererType=void 0;static createAttributesObject(){let e=super.createAttributesObject();return e.source={createComponentOfType:"text",createStateVariable:"source",required:!0,public:!0,forRenderer:!0},e.hasHeader={createComponentOfType:"boolean",createStateVariable:"hasHeader",defaultValue:!0,public:!0},e.columnTypes={createComponentOfType:"textList",createStateVariable:"columnTypesPrelim",defaultValue:[]},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.cid={forRenderer:!0,returnDependencies:()=>({source:{dependencyType:"stateVariable",variableName:"source"}}),definition:function({dependencyValues:e}){if(!e.source||"doenet:"!==e.source.substring(0,7).toLowerCase())return{setValue:{cid:null}};let t=null,n=e.source.match(/[:&]cid=([^&]+)/i);return n&&(t=n[1]),{setValue:{cid:t}}}},e.dataFrame={stateVariablesDeterminingDependencies:["cid","source"],additionalStateVariablesDefined:[{variableName:"numRows",public:!0,shadowingInstructions:{createComponentOfType:"integer"}},{variableName:"numColumns",public:!0,shadowingInstructions:{createComponentOfType:"integer"}},{variableName:"columnTypes",public:!0,shadowingInstructions:{createComponentOfType:"textList"}},{variableName:"columnNames",public:!0,shadowingInstructions:{createComponentOfType:"textList"}}],returnDependencies:({stateValues:e})=>({fileContents:{dependencyType:"file",cid:e.cid,uri:e.source,fileType:"csv"},hasHeader:{dependencyType:"stateVariable",variableName:"hasHeader"},columnTypesPrelim:{dependencyType:"stateVariable",variableName:"columnTypesPrelim"}}),definition:function({dependencyValues:e,componentName:t}){let n=[],r=[],a=e.fileContents.trim().split("\n").map((e=>e.trim().split(",").map((e=>e.trim())))),i=a[0]?.length,o=!1;for(let e of a.slice(1))if(e.length!==i){o=!0;break}if(o)return console.warn(`Data has invalid shape.  Rows has inconsistent lengths. Found in componentName :${t}`),{setValue:{dataFrame:null,numRows:u,numColumns:i,columnTypes:n,columnNames:r}};let s={},l=[];if(e.hasHeader?(s.columnNames=a[0].map((e=>(['"',"'"].includes(e[0])&&e[e.length-1]===e[0]&&(e=e.substring(1,e.length-1)),e))),l=a.slice(1)):(s.columnNames=[...Array(i).keys()].map((e=>`col${e+1}`)),l=a),[...new Set(s.columnNames)].length<s.columnNames)return console.warn(`Data has duplicate column names.  Found in componentName :${t}`),{setValue:{dataFrame:null,numRows:u,numColumns:i,columnTypes:n,columnNames:r}};if(s.columnNames.includes(""))return console.warn(`Data is missing a column name.  Found in componentName :${t}`),{setValue:{dataFrame:null,numRows:u,numColumns:i,columnTypes:n,columnNames:r}};let u=l.length;s.shape=[u,i];for(let t=0;t<i;t++){let r=e.columnTypesPrelim[t]?.toLowerCase();if(["number","string"].includes(r)||(r="auto"),"auto"===r){let e=!1;for(let n=0;n<u;n++){let r=l[n][t];if(""!==r){let t=Number(r);if(!Number.isFinite(t)){e=!0;break}}}r=e?"string":"number"}if("number"===r)for(let e=0;e<u;e++){let n=l[e][t];l[e][t]=""===n?null:Number(l[e][t])}else for(let e=0;e<u;e++){let n=l[e][t];['"',"'"].includes(n[0])&&n[n.length-1]===n[0]&&(n=n.substring(1,n.length-1)),l[e][t]=n}n.push(r)}return s.data=l,s.columnTypes=n,{setValue:{dataFrame:s,numRows:u,numColumns:i,columnTypes:n,columnNames:s.columnNames}}}},e.means={public:!0,shadowingInstructions:{createComponentOfType:"number"},isArray:!0,entryPrefixes:["mean"],returnArraySizeDependencies:()=>({numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize:({dependencyValues:e})=>[e.numColumns],returnArrayDependenciesByKey:()=>({globalDependencies:{dataFrame:{dependencyType:"stateVariable",variableName:"dataFrame"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},columnTypes:{dependencyType:"stateVariable",variableName:"columnTypes"}}}),arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:t}){let n={};for(let r of t){let t=0,a=0;if("number"===e.columnTypes[r]){for(let n=0;n<e.numRows;n++){let i=e.dataFrame.data[n][r];null!==i&&(t+=i,a++)}t/=a}else t=NaN;n[r]=t}return{setValue:{means:n}}}},e}}class SummaryStatistics extends BlockComponent{static componentType="summaryStatistics";static acceptTarget=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.column={createComponentOfType:"text",createStateVariable:"desiredColumn",defaultValue:null},e.statisticsToDisplay={createComponentOfType:"textList",createStateVariable:"statisticsToDisplayPrelim",defaultValue:["default"]},e.byCategoryColumn={createComponentOfType:"text",createStateVariable:"byCategoryColumn",defaultValue:null,public:!0},e.displayDigits={createComponentOfType:"integer",createStateVariable:"displayDigits",defaultValue:10,public:!0},e.displaySmallAsZero={createComponentOfType:"number",createStateVariable:"displaySmallAsZero",valueForTrue:1e-14,valueForFalse:0,defaultValue:0,public:!0},e.displayDecimals={createComponentOfType:"integer",createStateVariable:"displayDecimals",defaultValue:null,public:!0},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.statisticsToDisplay={public:!0,shadowingInstructions:{createComponentOfType:"textList"},returnDependencies:()=>({statisticsToDisplayPrelim:{dependencyType:"stateVariable",variableName:"statisticsToDisplayPrelim"}}),definition:function({dependencyValues:e}){let t=["mean","stdev","variance","stderr","count","minimum","quartile1","median","quartile3","maximum","range","sum"],n=[],r=e.statisticsToDisplayPrelim.map((e=>e.toLowerCase()));if(r.includes("default"))n=["mean","stdev","count","minimum","quartile1","median","quartile3","maximum"];else if(r.includes("all"))n=[...t];else for(let e of t)r.includes(e)&&n.push(e);return{setValue:{statisticsToDisplay:n}}}},e.dataColumn={additionalStateVariablesDefined:[{variableName:"columnName",public:!0,shadowingInstructions:{createComponentOfType:"text"},forRenderer:!0}],returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent",variableNames:["dataFrame"],variablesOptional:!0},desiredColumn:{dependencyType:"stateVariable",variableName:"desiredColumn"}}),definition({dependencyValues:e}){let t=null,n=null;if(e.targetComponent?.stateValues.dataFrame){let r=e.targetComponent.stateValues.dataFrame,a=r.columnNames.indexOf(e.desiredColumn);if(-1!==a){n=e.desiredColumn,t=[];for(let e of r.data)null!==e[a]&&t.push(e[a])}}return{setValue:{dataColumn:t,columnName:n}}}},e.count={public:!0,shadowingInstructions:{createComponentOfType:"integer"},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=e.dataColumn.length),{setValue:{count:t}}}},e.sum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=e.dataColumn.reduce(((e,t)=>e+t))),{setValue:{sum:t}}}},e.mean={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return null!==e.dataColumn&&(t=me$3.math.mean(e.dataColumn)),{setValue:{mean:t}}}},e.stdev={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=me$3.math.std(e.dataColumn)),{setValue:{stdev:t}}}},e.variance={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=me$3.math.var(e.dataColumn)),{setValue:{variance:t}}}},e.stderr={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({stdev:{dependencyType:"stateVariable",variableName:"stdev"},count:{dependencyType:"stateVariable",variableName:"count"}}),definition({dependencyValues:e}){let t=null;return null!==e.stdev&&(t=e.stdev/Math.sqrt(e.count)),{setValue:{stderr:t}}}},e.minimum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=Math.min(...e.dataColumn)),{setValue:{minimum:t}}}},e.maximum={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=Math.max(...e.dataColumn)),{setValue:{maximum:t}}}},e.median={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=me$3.math.median(e.dataColumn)),{setValue:{median:t}}}},e.quartile1={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=me$3.math.quantileSeq(e.dataColumn,.25)),{setValue:{quartile1:t}}}},e.quartile3={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({dataColumn:{dependencyType:"stateVariable",variableName:"dataColumn"}}),definition({dependencyValues:e}){let t=null;return e.dataColumn&&(t=me$3.math.quantileSeq(e.dataColumn,.75)),{setValue:{quartile3:t}}}},e.range={public:!0,shadowingInstructions:{createComponentOfType:"number",attributeComponentsToShadow:["displayDigits","displayDecimals","displaySmallAsZero"]},returnDependencies:()=>({minimum:{dependencyType:"stateVariable",variableName:"minimum"},maximum:{dependencyType:"stateVariable",variableName:"maximum"}}),definition({dependencyValues:e}){let t=null;return null!==e.minimum&&(t=e.maximum-e.minimum),{setValue:{range:t}}}},e.summaryStatistics={forRenderer:!0,stateVariablesDeterminingDependencies:["statisticsToDisplay"],returnDependencies({stateValues:e}){let t={displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}};return e.statisticsToDisplay.includes("mean")&&(t.mean={dependencyType:"stateVariable",variableName:"mean"}),e.statisticsToDisplay.includes("stdev")&&(t.stdev={dependencyType:"stateVariable",variableName:"stdev"}),e.statisticsToDisplay.includes("variance")&&(t.variance={dependencyType:"stateVariable",variableName:"variance"}),e.statisticsToDisplay.includes("stderr")&&(t.stderr={dependencyType:"stateVariable",variableName:"stderr"}),e.statisticsToDisplay.includes("count")&&(t.count={dependencyType:"stateVariable",variableName:"count"}),e.statisticsToDisplay.includes("minimum")&&(t.minimum={dependencyType:"stateVariable",variableName:"minimum"}),e.statisticsToDisplay.includes("quartile1")&&(t.quartile1={dependencyType:"stateVariable",variableName:"quartile1"}),e.statisticsToDisplay.includes("median")&&(t.median={dependencyType:"stateVariable",variableName:"median"}),e.statisticsToDisplay.includes("quartile3")&&(t.quartile3={dependencyType:"stateVariable",variableName:"quartile3"}),e.statisticsToDisplay.includes("maximum")&&(t.maximum={dependencyType:"stateVariable",variableName:"maximum"}),e.statisticsToDisplay.includes("range")&&(t.range={dependencyType:"stateVariable",variableName:"range"}),e.statisticsToDisplay.includes("sum")&&(t.sum={dependencyType:"stateVariable",variableName:"sum"}),t},definition({dependencyValues:e,usedDefault:t}){let n={};return void 0!==e.mean&&(n.mean=roundForDisplay({value:e.mean,dependencyValues:e,usedDefault:t})),void 0!==e.stdev&&(n.stdev=roundForDisplay({value:e.stdev,dependencyValues:e,usedDefault:t})),void 0!==e.variance&&(n.variance=roundForDisplay({value:e.variance,dependencyValues:e,usedDefault:t})),void 0!==e.stderr&&(n.stderr=roundForDisplay({value:e.stderr,dependencyValues:e,usedDefault:t})),void 0!==e.count&&(n.count=roundForDisplay({value:e.count,dependencyValues:e,usedDefault:t})),void 0!==e.minimum&&(n.minimum=roundForDisplay({value:e.minimum,dependencyValues:e,usedDefault:t})),void 0!==e.quartile1&&(n.quartile1=roundForDisplay({value:e.quartile1,dependencyValues:e,usedDefault:t})),void 0!==e.median&&(n.median=roundForDisplay({value:e.median,dependencyValues:e,usedDefault:t})),void 0!==e.quartile3&&(n.quartile3=roundForDisplay({value:e.quartile3,dependencyValues:e,usedDefault:t})),void 0!==e.maximum&&(n.maximum=roundForDisplay({value:e.maximum,dependencyValues:e,usedDefault:t})),void 0!==e.range&&(n.range=roundForDisplay({value:e.range,dependencyValues:e,usedDefault:t})),void 0!==e.sum&&(n.sum=roundForDisplay({value:e.sum,dependencyValues:e,usedDefault:t})),{setValue:{summaryStatistics:n}}}},e}}class Chart extends BlockComponent{static componentType="chart";static acceptTarget=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.type={createComponentOfType:"text",createStateVariable:"type",defaultValue:"histogram",toLowerCase:!0,validValues:["histogram","dotplot","frequencytable","box","bar"],forRenderer:!0},e.column={createComponentOfType:"text",createStateVariable:"desiredColumn",defaultValue:null},e.xmin={createComponentOfType:"number",createStateVariable:"xminPrelim",defaultValue:-10},e.xmax={createComponentOfType:"number",createStateVariable:"xmaxPrelim",defaultValue:10},e.ymin={createComponentOfType:"number",createStateVariable:"yminPrelim",defaultValue:-10},e.ymax={createComponentOfType:"number",createStateVariable:"ymaxPrelim",defaultValue:10},e.width={createComponentOfType:"_componentSize",createStateVariable:"width",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},e.height={createComponentOfType:"_componentSize",createStateVariable:"height",defaultValue:{size:300,isAbsolute:!0},public:!0,forRenderer:!0},e.identicalAxisScales={createComponentOfType:"boolean",createStateVariable:"identicalAxisScales",defaultValue:!1,public:!0,forRenderer:!0},e.displayXAxis={createComponentOfType:"boolean",createStateVariable:"displayXAxis",defaultValue:!0,public:!0,forRenderer:!0},e.displayYAxis={createComponentOfType:"boolean",createStateVariable:"displayYAxis",defaultValue:!0,public:!0,forRenderer:!0},e.displayXAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayXAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},e.displayYAxisTickLabels={createComponentOfType:"boolean",createStateVariable:"displayYAxisTickLabels",defaultValue:!0,public:!0,forRenderer:!0},e.xlabel={createComponentOfType:"text",createStateVariable:"xlabel",defaultValue:"",public:!0,forRenderer:!0},e.xlabelPosition={createComponentOfType:"text",createStateVariable:"xlabelPosition",defaultValue:"right",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["right","left"]},e.ylabel={createComponentOfType:"text",createStateVariable:"ylabel",defaultValue:"",public:!0,forRenderer:!0},e.ylabelPosition={createComponentOfType:"text",createStateVariable:"ylabelPosition",defaultValue:"top",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["top","bottom"]},e.ylabelAlignment={createComponentOfType:"text",createStateVariable:"ylabelAlignment",defaultValue:"left",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["left","right"]},e}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.dataFrame={forRenderer:!0,returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent",variableNames:["dataFrame"],variablesOptional:!0}}),definition({dependencyValues:e}){console.log("definition of dataFrame",e);let t=null;return e.targetComponent?.stateValues.dataFrame&&(t=e.targetComponent.stateValues.dataFrame),{setValue:{dataFrame:t}}}},e.columnName={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"colInd",forRenderer:!0}],returnDependencies:()=>({desiredColumn:{dependencyType:"stateVariable",variableName:"desiredColumn"},dataFrame:{dependencyType:"stateVariable",variableName:"dataFrame"}}),definition({dependencyValues:e}){let t=null,n=null;return e.dataFrame&&(n=e.dataFrame.columnNames.indexOf(e.desiredColumn),-1!==n?t=e.desiredColumn:n=null),{setValue:{columnName:t,colInd:n}}}},e.xmin={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},xminPrelim:{dependencyType:"stateVariable",variableName:"xminPrelim"}};return e.identicalAxisScales&&(t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.width={dependencyType:"stateVariable",variableName:"width"},t.height={dependencyType:"stateVariable",variableName:"height"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales)return{setValue:{xmin:e.xminPrelim}};if(!t.xminPrelim)return{setValue:{xmin:e.xminPrelim}};let n=!t.xmaxPrelim,r=!t.yminPrelim,a=!t.ymaxPrelim;if(r&&a){let t=e.width.size/e.height.size,r=(e.ymaxPrelim-e.yminPrelim)*t;return n?{setValue:{xmin:e.xmaxPrelim-r}}:{setValue:{xmin:-r/2}}}return n?{setValue:{xmin:e.xmaxPrelim-20}}:{setValue:{xmin:-10}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xminPrelim",desiredValue:e.xmin}]}},e.xmax={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},xmaxPrelim:{dependencyType:"stateVariable",variableName:"xmaxPrelim"}};return e.identicalAxisScales&&(t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.width={dependencyType:"stateVariable",variableName:"width"},t.height={dependencyType:"stateVariable",variableName:"height"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales)return{setValue:{xmax:e.xmaxPrelim}};let n=!t.xminPrelim,r=!t.xmaxPrelim,a=!t.yminPrelim,i=!t.ymaxPrelim,o=a&&i,s=n&&r,l=e.xminPrelim;if(o){let t=e.width.size/e.height.size,a=(e.ymaxPrelim-e.yminPrelim)*t;if(s){let t=e.xmaxPrelim-l;return{setValue:{xmax:l+Math.max(t,a)}}}return n?{setValue:{xmax:l+a}}:r?{setValue:{xmax:e.xmaxPrelim}}:{setValue:{xmax:a/2}}}return r?{setValue:{xmax:e.xmaxPrelim}}:n?{setValue:{xmax:l+20}}:{setValue:{xmax:10}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"xmaxPrelim",desiredValue:e.xmax}]}},e.ymin={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},yminPrelim:{dependencyType:"stateVariable",variableName:"yminPrelim"}};return e.identicalAxisScales&&(t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.ymaxPrelim={dependencyType:"stateVariable",variableName:"ymaxPrelim"},t.width={dependencyType:"stateVariable",variableName:"width"},t.height={dependencyType:"stateVariable",variableName:"height"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales)return{setValue:{ymin:e.yminPrelim}};if(!t.yminPrelim)return{setValue:{ymin:e.yminPrelim}};let n=!t.ymaxPrelim,r=!t.xminPrelim,a=!t.xmaxPrelim,i=r&&a,o=e.width.size/e.height.size;if(i){let t=(e.xmaxPrelim-e.xminPrelim)/o;return n?{setValue:{ymin:e.ymaxPrelim-t}}:{setValue:{ymin:-t/2}}}return n?{setValue:{ymin:e.ymaxPrelim-20/o}}:{setValue:{ymin:-10/o}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"yminPrelim",desiredValue:e.ymin}]}},e.ymax={stateVariablesDeterminingDependencies:["identicalAxisScales"],defaultValue:-10,public:!0,shadowingInstructions:{createComponentOfType:"number"},forRenderer:!0,returnDependencies({stateValues:e}){let t={identicalAxisScales:{dependencyType:"stateVariable",variableName:"identicalAxisScales"},ymaxPrelim:{dependencyType:"stateVariable",variableName:"ymaxPrelim"}};return e.identicalAxisScales&&(t.xminPrelim={dependencyType:"stateVariable",variableName:"xminPrelim"},t.yminPrelim={dependencyType:"stateVariable",variableName:"yminPrelim"},t.xmaxPrelim={dependencyType:"stateVariable",variableName:"xmaxPrelim"},t.width={dependencyType:"stateVariable",variableName:"width"},t.height={dependencyType:"stateVariable",variableName:"height"}),t},definition({dependencyValues:e,usedDefault:t}){if(!e.identicalAxisScales)return{setValue:{ymax:e.ymaxPrelim}};let n=!t.xminPrelim,r=!t.xmaxPrelim,a=!t.yminPrelim,i=!t.ymaxPrelim,o=a&&i,s=n&&r,l=e.yminPrelim,u=e.width.size/e.height.size;if(s){let t=(e.xmaxPrelim-e.xminPrelim)/u;if(o){let n=e.ymaxPrelim-l;return{setValue:{ymax:l+Math.max(n,t)}}}return a?{setValue:{ymax:l+t}}:i?{setValue:{ymax:e.ymaxPrelim}}:{setValue:{ymax:t/2}}}return i?{setValue:{ymax:e.ymaxPrelim}}:a?{setValue:{ymax:l+20/u}}:{setValue:{ymax:10/u}}},inverseDefinition:async({desiredStateVariableValues:e,stateValues:t})=>await t.fixAxes?{success:!1}:{success:!0,instructions:[{setDependency:"ymaxPrelim",desiredValue:e.ymax}]}},e.xscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({xmin:{dependencyType:"stateVariable",variableName:"xmin"},xmax:{dependencyType:"stateVariable",variableName:"xmax"}}),definition:({dependencyValues:e})=>({setValue:{xscale:e.xmax-e.xmin}})},e.yscale={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({ymin:{dependencyType:"stateVariable",variableName:"ymin"},ymax:{dependencyType:"stateVariable",variableName:"ymax"}}),definition:({dependencyValues:e})=>({setValue:{yscale:e.ymax-e.ymin}})},e}async changeAxisLimits({xmin:e,xmax:t,ymin:n,ymax:r,actionId:a}){let i=[];return void 0!==e&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmin",value:e}),void 0!==t&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"xmax",value:t}),void 0!==n&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymin",value:n}),void 0!==r&&i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"ymax",value:r}),await this.coreFunctions.performUpdate({updateInstructions:i,actionId:a,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{xmin:e,xmax:t,ymin:n,ymax:r}}})}actions={changeAxisLimits:this.changeAxisLimits.bind(this)}}class Legend extends GraphicalComponent{static componentType="legend";static createAttributesObject(){let e=super.createAttributesObject();return e.position={createComponentOfType:"text",createStateVariable:"position",defaultValue:"upperright",public:!0,forRenderer:!0,toLowerCase:!0,validValues:["upperright","upperleft","lowerright","lowerleft"]},e.displayClosedSwatches={createComponentOfType:"boolean",createStateVariable:"displayClosedSwatches",defaultValue:!1,public:!0},e}static returnChildGroups(){return[{group:"labels",componentTypes:["label"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.legendElements={forRenderer:!0,returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["graphicalDescendants"]},labelChildren:{dependencyType:"child",childGroups:["labels"],variableNames:["value","hasLatex","forTargetComponentName"]},displayClosedSwatches:{dependencyType:"stateVariable",variableName:"displayClosedSwatches"}}),definition({dependencyValues:e,componentInfoObjects:t}){let n=[];if(e.graphAncestor){let r=[],a=[],i=[],o=[...e.graphAncestor.stateValues.graphicalDescendants],s=o.map((e=>e.componentName)),l=[],u={};for(let n of e.labelChildren){let c={value:n.stateValues.value,hasLatex:n.stateValues.hasLatex};if(n.stateValues.forTargetComponentName){u[n.stateValues.forTargetComponentName]=c;let l=s.indexOf(n.stateValues.forTargetComponentName);if(-1!==l){let n=o[l];t.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"point"})?r.push(n.stateValues.styleNumber):e.displayClosedSwatches&&t.allComponentClasses[n.componentType].representsClosedPath?a.push(n.stateValues.styleNumber):"legend"!==n.componentType&&i.push(n.stateValues.styleNumber)}}l.push({labelInfo:c,forTarget:n.stateValues.forTargetComponentName})}for(let c of l){let l;if(c.forTarget){let e=s.indexOf(c.forTarget);-1!==e&&(l=o[e],o.splice(e,1),s.splice(e,1))}else for(let n=0;n<o.length;n++){let s=o[n];if(!(s.componentName in u))if(t.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"point"})){if(!r.includes(s.stateValues.styleNumber)){l=s;break}}else if(e.displayClosedSwatches&&t.allComponentClasses[s.componentType].representsClosedPath){if(!a.includes(s.stateValues.styleNumber)){l=s;break}}else if("legend"!==s.componentType&&!i.includes(s.stateValues.styleNumber)){l=s;break}}if(l){let o=l.stateValues.selectedStyle,s=l.stateValues.styleNumber;t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"point"})?(r.push(s),n.push({swatchType:"marker",markerStyle:o.markerStyle,markerColor:o.markerColor,markerSize:o.markerSize,lineOpacity:o.lineOpacity,label:c.labelInfo})):e.displayClosedSwatches&&t.allComponentClasses[l.componentType].representsClosedPath?(a.push(s),n.push({swatchType:"rectangle",lineStyle:o.lineStyle,lineColor:o.lineColor,lineWidth:o.lineWidth,lineOpacity:o.lineOpacity,fillColor:o.fillColor,fillOpacity:o.fillOpacity,label:c.labelInfo})):(i.push(s),n.push({swatchType:"line",lineStyle:o.lineStyle,lineColor:o.lineColor,lineWidth:o.lineWidth,lineOpacity:o.lineOpacity,label:c.labelInfo}))}}}return{setValue:{legendElements:n}}}},e.graphLimits={forRenderer:!0,returnDependencies:()=>({graphAncestor:{dependencyType:"ancestor",componentType:"graph",variableNames:["xmin","xmax","ymin","ymax"]}}),definition:({dependencyValues:e})=>e.graphAncestor?{setValue:{graphLimits:e.graphAncestor.stateValues}}:{setValue:{graphLimits:null}}},e}}class Label extends InlineComponent{static componentType="label";static renderChildren=!0;static rendererType="container";static includeBlankStringChildren=!0;static createAttributesObject(){let e=super.createAttributesObject();return e.forTarget={createPrimitiveOfType:"string",createStateVariable:"forTarget",defaultValue:null,public:!0},e}static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"latex",public:!0,shadowingInstructions:{createComponentOfType:"text"}},{variableName:"hasLatex",public:!0,shadowingInstructions:{createComponentOfType:"boolean"}},{variableName:"value",public:!0,forRenderer:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text","latex"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="",n="",r="",a=!1;for(let i of e.inlineChildren)if("object"!=typeof i){let e=i.toString();t+=e,n+=e,r+=e}else"string"==typeof i.stateValues.latex?(t+=i.stateValues.latex,n+=i.stateValues.latex,r+="\\("+i.stateValues.latex+"\\)",a=!0):"string"==typeof i.stateValues.text&&(t+=i.stateValues.text,n+=i.stateValues.text,r+=i.stateValues.text);return{setValue:{text:t,latex:n,hasLatex:a,value:r}}}},e.forTargetComponentName={stateVariablesDeterminingDependencies:["forTarget"],returnDependencies:({stateValues:e})=>({forTargetComponentName:{dependencyType:"expandTargetName",target:e.forTarget}}),definition:({dependencyValues:e})=>({setValue:{forTargetComponentName:e.forTargetComponentName}})},e}}const unitConversions={"":1,px:1,pixel:1,pixels:1,"%":1,em:100,in:96,inch:96,inches:96,pt:1.333333333333,mm:3.7795296,millimeter:3.7795296,millimeters:3.7795296,cm:37.795296,centimeter:37.795296,centimeters:37.795296};class ComponentSize extends InlineComponent{static componentType="_componentSize";static rendererType="text";static primaryStateVariableForDefinition="componentSize";static stateVariableForAttributeValue="componentSize";static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({childrenRegex:/..+/,replacementFunction:function({matchedChildren:e}){let t=e[e.length-1];if("string"==typeof t){let n=/([a-zA-z]+|%)$/,r=t.trim(),a=r.match(n);if(a){let t=a[1];if(t in unitConversions){let n=r.slice(0,a.index),i=e.slice(0,e.length-1);return n.length>0&&i.push(n),{success:!0,newChildren:[{componentType:"number",children:i},t]}}}}return{success:!0,newChildren:[{componentType:"number",children:e}]}}}),e}static returnChildGroups(){return[{group:"strings",componentTypes:["string"]},{group:"numbers",componentTypes:["number"]},{group:"componentSizes",componentTypes:["_componentSize"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.componentSize={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},hasEssential:!0,returnDependencies:()=>({componentSizeChild:{dependencyType:"child",childGroups:["componentSizes"],variableNames:["componentSize"]},numberChild:{dependencyType:"child",childGroups:["numbers"],variableNames:["value"]},stringChild:{dependencyType:"child",childGroups:["strings"],variableNames:["value"]},parentDefaultAbsoluteSize:{dependencyType:"parentStateVariable",variableName:"defaultAbsoluteSize"}}),definition({dependencyValues:e}){let t=void 0!==e.parentDefaultAbsoluteSize&&e.parentDefaultAbsoluteSize;if(0===e.stringChild.length)return 0===e.numberChild.length?0===e.componentSizeChild.length?{useEssentialOrDefaultValue:{componentSize:{defaultValue:{size:100,isAbsolute:t}}}}:{setValue:{componentSize:e.componentSizeChild[0].stateValues.componentSize}}:{setValue:{componentSize:{size:e.numberChild[0].stateValues.value,isAbsolute:!0}}};{let t,n;if(e.numberChild.length>0)t=e.numberChild[0].stateValues.value,n=e.stringChild[0].trim();else{let r=e.stringChild[0].trim().match(/^(-?[\d.]+)\s*(.*)$/);if(null===r)return{setValue:{componentSize:null}};t=r[1],n=r[2].trim()}if(t=Number(t),!Number.isFinite(t))return{setValue:{componentSize:null}};let r=!("%"===n||"em"===n),a=unitConversions[n];return void 0===a&&(a=1),{setValue:{componentSize:{size:a*t,isAbsolute:r}}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){if(0===t.stringChild.length)return 0===t.numberChild.length?0===t.componentSizeChild.length?{success:!0,instructions:[{setEssentialValue:"componentSize",value:e.componentSize}]}:{success:!0,instructions:[{setDependency:"componentSizeChild",desiredValue:e.componentSize,childIndex:0,variableIndex:0}]}:e.componentSize.isAbsolute?{success:!0,instructions:[{setDependency:"numberChild",desiredValue:e.componentSize.size,childIndex:0,variableIndex:0}]}:{success:!1};if(t.numberChild.length>0){let n=t.stringChild[0].trim(),r=!("%"===n||"em"===n);if(e.componentSize.isAbsolute!==r)return{success:!1};let a=unitConversions[n];return void 0===a&&(a=1),{success:!0,instructions:[{setDependency:"numberChild",desiredValue:e.componentSize.size/a,childIndex:0,variableIndex:0}]}}{let t=e.componentSize.size;return e.componentSize.isAbsolute?t+="px":t+="%",{success:!0,instructions:[{setDependency:"stringChild",desiredValue:t,childIndex:0,variableIndex:0}]}}}},e.number={public:!0,shadowingInstructions:{createComponentOfType:"number"},returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:e}){let t=null;return e.componentSize&&(t=e.componentSize.size),{setValue:{number:t}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:t}){if(!t.componentSize)return{success:!1};return{success:!0,instructions:[{setDependency:"componentSize",desiredValue:{size:e.number,isAbsolute:t.componentSize.isAbsolute}}]}}},e.math=mathStateVariableFromNumberStateVariable({numberVariableName:"number",mathVariableName:"math",isPublic:!0}),e.isAbsolute={public:!0,shadowingInstructions:{createComponentOfType:"boolean"},returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:e}){let t=null;return e.componentSize&&(t=e.componentSize.isAbsolute),{setValue:{isAbsolute:t}}}},e.text={forRenderer:!0,returnDependencies:()=>({componentSize:{dependencyType:"stateVariable",variableName:"componentSize"}}),definition({dependencyValues:e}){let t="";return e.componentSize&&(t=e.componentSize.size,e.componentSize.isAbsolute?t+="px":t+="%"),{setValue:{text:t}}}},e}static adapters=["number","math"]}class ComponentSizeList extends BaseComponent{static componentType="_componentSizeList";static rendererType="asList";static renderChildren=!0;static stateVariableForAttributeValue="componentSizes";static returnSugarInstructions(){let e=super.returnSugarInstructions();return e.push({replacementFunction:function({matchedChildren:e}){let t=[],n=[],r=function(){n.length>0&&(t.push({componentType:"_componentSize",children:n}),n=[])};for(let t of e)if("string"==typeof t){let e=t.split(/\s+/);0===e[0].length&&(r(),e=e.slice(1));for(let[t,a]of e.entries())a.length>0?(n.push(a),t<e.length-1&&r()):r()}else n.push(t);return r(),{success:!0,newChildren:t}}}),e}static returnChildGroups(){return[{group:"componentSizes",componentTypes:["_componentSize"]},{group:"componentSizeLists",componentTypes:["_componentSizeList"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.overrideChildHide={returnDependencies:()=>({}),definition:()=>({setValue:{overrideChildHide:!0}})},e.nComponents={public:!0,shadowingInstructions:{createComponentOfType:"number"},additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({componentSizeListChildren:{dependencyType:"child",childGroups:["componentSizeLists"],variableNames:["nComponents"]},componentSizeAndComponentSizeListChildren:{dependencyType:"child",childGroups:["componentSizes","componentSizeLists"],skipComponentNames:!0}}),definition:function({dependencyValues:e,componentInfoObjects:t}){let n=0,r=[],a=0;for(let[i,o]of e.componentSizeAndComponentSizeListChildren.entries())if(t.isInheritedComponentType({inheritedComponentType:o.componentType,baseComponentType:"_componentSizeList"})){let t=e.componentSizeListChildren[a];a++;for(let e=0;e<t.stateValues.nComponents;e++)r[n+e]=[i,e];n+=t.stateValues.nComponents}else r[n]=[i,0],n+=1;return{setValue:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},e.componentSizes={public:!0,shadowingInstructions:{createComponentOfType:"_componentSize"},isArray:!0,entryPrefixes:["componentSize"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize:({dependencyValues:e})=>[e.nComponents],returnArrayDependenciesByKey({arrayKeys:e,stateValues:t}){let n={};for(let r of e){let e=[],a="1";t.childIndexByArrayKey[r]&&(e=[t.childIndexByArrayKey[r][0]],a=t.childIndexByArrayKey[r][1]+1),n[r]={componentSizeAndComponentSizeListChildren:{dependencyType:"child",childGroups:["componentSizes","componentSizeLists"],variableNames:["componentSize","componentSize"+a],variablesOptional:!0,childIndices:e}}}return{globalDependencies:{childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}},dependenciesByKey:n}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n,componentInfoObjects:r}){let a={};for(let i of n){let n=t[i].componentSizeAndComponentSizeListChildren[0];if(n)if(r.isInheritedComponentType({inheritedComponentType:n.componentType,baseComponentType:"_componentSizeList"})){let t=e.childIndexByArrayKey[i][1]+1;a[i]=n.stateValues["componentSize"+t]}else a[i]=n.stateValues.componentSize}return{setValue:{componentSizes:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:t,dependencyValuesByKey:n,dependencyNamesByKey:r,arraySize:a,componentInfoObjects:i}){let o=[];for(let t in e.componentSizes){if(!n[t])continue;let a=n[t].componentSizeAndComponentSizeListChildren[0];a&&(i.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_componentSizeList"})?o.push({setDependency:r[t].componentSizeAndComponentSizeListChildren,desiredValue:e.componentSizes[t],childIndex:0,variableIndex:1}):o.push({setDependency:r[t].componentSizeAndComponentSizeListChildren,desiredValue:e.componentSizes[t],childIndex:0,variableIndex:0}))}return{success:!0,instructions:o}}},e.nValues={isAlias:!0,targetVariableName:"nComponents"},e.values={isAlias:!0,targetVariableName:"componentSizes"},e}}var ComponentSize$1=Object.freeze({__proto__:null,ComponentSize:ComponentSize,ComponentSizeList:ComponentSizeList});class TextOrLatexFromInline extends InlineComponent{static componentType="_textOrLatexFromInline";static renderChildren=!0;static includeBlankStringChildren=!0;static returnChildGroups(){return[{group:"inlines",componentTypes:["_inline"]}]}static returnStateVariableDefinitions(){let e=super.returnStateVariableDefinitions();return e.text={public:!0,shadowingInstructions:{createComponentOfType:"text"},additionalStateVariablesDefined:[{variableName:"latex",public:!0,shadowingInstructions:{createComponentOfType:"text"}},{variableName:"isLatex",public:!0,shadowingInstructions:{createComponentOfType:"boolean"}},{variableName:"value",public:!0,shadowingInstructions:{createComponentOfType:"text"}}],returnDependencies:()=>({inlineChildren:{dependencyType:"child",childGroups:["inlines"],variableNames:["text","latex"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let t="",n="",r=0,a=0;for(let i of e.inlineChildren)if("object"!=typeof i){let e=i.toString();t+=e,n+=e,a++}else"string"==typeof i.stateValues.latex?(t+=i.stateValues.latex,n+=i.stateValues.latex,r++):"string"==typeof i.stateValues.text&&(t+=i.stateValues.text,n+=i.stateValues.text,a++);let i=r>0&&0===a;return{setValue:{text:t,latex:n,isLatex:i,value:i?n:t}}}},e}}const componentTypeArray=[...Object.values(Aliases),...Object.values(MMeMen),...Object.values(MdMdnMrow),...Object.values(BooleanOperators),...Object.values(BooleanOperatorsOfMath),...Object.values(MathOperators),...Object.values(FunctionOperators),...Object.values(TextOperatorsOfMath),...Object.values(Extrema$1),...Object.values(ParagraphMarkup),...Object.values(SingleCharacterComponents),...Object.values(Sectioning),...Object.values(Lists),...Object.values(DynamicalSystems),...Object.values(Chemistry),...Object.values(FeedbackDefinitions$1),...Object.values(StyleDefinitions$1),...Object.values(SideBySide$1),...Object.values(ComponentWithSelectableType$1),...Object.values(Indexing),...Object.values(Divisions),...Object.values(Verbatim),...Object.values(Paginator$1),...Object.values(MatrixInput$1),Document,Text,TextList$1,TextList,P$2,BooleanComponent,BooleanList,MathComponent,MathList,TupleList,NumberList,NumberListFromString,Copy,Extract,Collect,Ref,Point,Coords,Line,LineSegment,Ray,Polyline,Polygon,Triangle,Rectangle,Circle,Parabola,Curve,BezierControls,ControlVectors,Vector,Angle,Answer,Award,When,MathInput,Textinput,BooleanInput,Choiceinput,Choice,NumberComponent,Integer,Graph$1,Variables,Variable,Function$2,Template,Option$1,Sequence,Slider,Spreadsheet,DiscreteSimulationResultList,DiscreteSimulationResultPolyline,Cell,Row,Column,CellBlock,Tabular,Table,Figure,Markers,panel,Map$1,Sources,Constraints,ConstrainToGrid,ConstrainToGraph,AttractToGrid,ConstrainTo,AttractTo,ConstraintUnion,AttractToConstraint,Intersection,ConstrainToAngles,AttractToAngles,ConditionalContent,AsList,Seeds,VariantNames,VariantControl,SelectFromSequence,Select,Group,AnimateFromSequence,Evaluate,SelectRandomNumbers,SampleRandomNumbers,Substitute,PeriodicSet,Image,Video,Embed,Hint,Solution,IntComma,Pluralize,Feedback,CollaborateGroups,CollaborateGroupSetup,ConsiderAsResponses,Case,Lorem,UpdateValue,CallAction,triggerSet,FunctionIterates,Module,CustomAttribute,Setup,Footnote,Caption,Endpoint,Sort,SolveEquations,SolutionContainer,SubsetOfRealsInput,SubsetOfReals,Split,BestFitLine,RegionBetweenCurveXAxis,RegionHalfPlane,CodeEditor,CodeViewer,RenderDoenetML,HasSameFactoring,OrbitalDiagramInput,OrbitalDiagram,DataFrame,SummaryStatistics,Chart,Legend,Label,BaseComponent,InlineComponent,BlockComponent,GraphicalComponent,ConstraintComponent,Input,CompositeComponent,PointListComponent,LineListComponent,VectorListComponent,AngleListComponent,BooleanOperator,BooleanBaseOperatorOfMath,MathOperator,MathOperatorOneInput,FunctionOperator,...Object.values(ComponentSize$1),SectioningComponent,InlineRenderInlineChildren,TextOrInline,TextOrLatexFromInline,SingleCharacter];function allComponentClasses(){const e={},t=new Set;for(let n of componentTypeArray){let r=n.componentType;if(void 0===r)throw Error("Cannot create component as componentType is undefined for class "+n);let a=r.toLowerCase();if(t.has(a))throw Error("component type "+r+" defined in two classes");e[r]=n,t.add(a)}return e}function componentTypesCreatingVariants(){const e={},t=new Set;for(let n of componentTypeArray)if(n.createsVariants){let r=n.componentType;if(void 0===r)throw Error("Cannot create component as componentType is undefined for class "+n);let a=r.toLowerCase();if(t.has(a))throw Error("component type "+r+" defined in two classes");e[r]=n,t.add(a)}return e}function createComponentInfoObjects(){let e=allComponentClasses(),t=componentTypesCreatingVariants(),n={};for(let t in e)n[t.toLowerCase()]=t;let r={};for(let t in e)Object.defineProperty(r,t,{get:function(){let n=e[t].returnStateVariableInfo();return delete r[t],r[t]=n}.bind(this),configurable:!0});let a={};for(let t in e)Object.defineProperty(a,t,{get:function(){let n=e[t].returnStateVariableInfo({onlyPublic:!0});return delete a[t],a[t]=n}.bind(this),configurable:!0});function i({inheritedComponentType:t,baseComponentType:n}){if(t===n)return!0;if("string"===t)return"_base"===n||"_inline"===n;if("string"===n)return!1;let r=e[n];return!!r&&r.isPrototypeOf(e[t])}return{allComponentClasses:e,componentTypesCreatingVariants:t,componentTypeLowerCaseMapping:n,isInheritedComponentType:i,isCompositeComponent:function({componentType:t,includeNonStandard:n=!0}){let r=e[t];return!!r&&(i({inheritedComponentType:t,baseComponentType:"_composite"})&&(n||!r.treatAsComponentForRecursiveReplacements))},stateVariableInfo:r,publicStateVariableInfo:a}}function idbReady(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function promisifyRequest(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function createStore(e,t){const n=idbReady().then((()=>{const n=indexedDB.open(e);return n.onupgradeneeded=()=>n.result.createObjectStore(t),promisifyRequest(n)}));return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function set(e,t,n=defaultGetStore()){return n("readwrite",(n=>(n.put(t,e),promisifyRequest(n.transaction))))}const toastType=Object.freeze({ERROR:{timeout:-1,background:"rgba(193, 41, 46, 1)",gradientEnd:"rgba()"},ALERT:{timeout:-1,background:"rgba(255, 230, 0, 1)"},ACTION:{timeout:-1,background:"rgba()"},INFO:{timeout:3e3,background:"rgba(26, 90, 153,1)"},SUCCESS:{timeout:3e3,background:"rgba(41, 193, 67,  1)"},CONFIRMATION:{timeout:5e3,background:"rgba(26,90,153,1)"}});var axios$3={exports:{}},axios$2={exports:{}},bind$2=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},bind$1=bind$2,toString=Object.prototype.toString,kindOf=(cache=Object.create(null),function(e){var t=toString.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())}),cache;function kindOfTest(e){return e=e.toLowerCase(),function(t){return kindOf(t)===e}}function isArray(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("object"!==kindOf(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isFormData(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString.call(e)===t||isFunction(e.toString)&&e.toString()===t)}var isURLSearchParams=kindOfTest("URLSearchParams");function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}function merge(){var e={};function t(t,n){isPlainObject(e[n])&&isPlainObject(t)?e[n]=merge(e[n],t):isPlainObject(t)?e[n]=merge({},t):isArray(t)?e[n]=t.slice():e[n]=t}for(var n=0,r=arguments.length;n<r;n++)forEach(arguments[n],t);return e}function extend(e,t,n){return forEach(t,(function(t,r){e[r]=n&&"function"==typeof t?bind$1(t,n):t})),e}function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function inherits(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)}function toFlatObject(e,t,n){var r,a,i,o={};t=t||{};do{for(a=(r=Object.getOwnPropertyNames(e)).length;a-- >0;)o[i=r[a]]||(t[i]=e[i],o[i]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t}function endsWith(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n}function toArray(e){if(!e)return null;var t=e.length;if(isUndefined(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n}var isTypedArray=(TypedArray="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return TypedArray&&e instanceof TypedArray}),TypedArray,utils$9={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,isTypedArray:isTypedArray,isFileList:isFileList},utils$8=utils$9;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$1=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(utils$8.isURLSearchParams(t))r=t.toString();else{var a=[];utils$8.forEach(t,(function(e,t){null!=e&&(utils$8.isArray(e)?t+="[]":e=[e],utils$8.forEach(e,(function(e){utils$8.isDate(e)?e=e.toISOString():utils$8.isObject(e)&&(e=JSON.stringify(e)),a.push(encode(t)+"="+encode(e))})))})),r=a.join("&")}if(r){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},utils$7=utils$9;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$1.prototype.forEach=function(e){utils$7.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager$1,utils$6=utils$9,normalizeHeaderName$1=function(e,t){utils$6.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},AxiosError_1,hasRequiredAxiosError;function requireAxiosError(){if(hasRequiredAxiosError)return AxiosError_1;hasRequiredAxiosError=1;var e=utils$9;function t(e,t,n,r,a){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a)}e.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n=t.prototype,r={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){r[e]={value:e}})),Object.defineProperties(t,r),Object.defineProperty(n,"isAxiosError",{value:!0}),t.from=function(r,a,i,o,s,l){var u=Object.create(n);return e.toFlatObject(r,u,(function(e){return e!==Error.prototype})),t.call(u,r.message,a,i,o,s),u.name=r.name,l&&Object.assign(u,l),u},AxiosError_1=t}var transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},toFormData_1,hasRequiredToFormData,settle,hasRequiredSettle,cookies,hasRequiredCookies;function requireToFormData(){if(hasRequiredToFormData)return toFormData_1;hasRequiredToFormData=1;var e=utils$9;return toFormData_1=function(t,n){n=n||new FormData;var r=[];function a(t){return null===t?"":e.isDate(t)?t.toISOString():e.isArrayBuffer(t)||e.isTypedArray(t)?"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}return function t(i,o){if(e.isPlainObject(i)||e.isArray(i)){if(-1!==r.indexOf(i))throw Error("Circular reference detected in "+o);r.push(i),e.forEach(i,(function(r,i){if(!e.isUndefined(r)){var s,l=o?o+"."+i:i;if(r&&!o&&"object"==typeof r)if(e.endsWith(i,"{}"))r=JSON.stringify(r);else if(e.endsWith(i,"[]")&&(s=e.toArray(r)))return void s.forEach((function(t){!e.isUndefined(t)&&n.append(l,a(t))}));t(r,l)}})),r.pop()}else n.append(o,a(i))}(t),n},toFormData_1}function requireSettle(){if(hasRequiredSettle)return settle;hasRequiredSettle=1;var e=requireAxiosError();return settle=function(t,n,r){var a=r.config.validateStatus;r.status&&a&&!a(r.status)?n(new e("Request failed with status code "+r.status,[e.ERR_BAD_REQUEST,e.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):t(r)},settle}function requireCookies(){if(hasRequiredCookies)return cookies;hasRequiredCookies=1;var e=utils$9;return cookies=e.isStandardBrowserEnv()?{write:function(t,n,r,a,i,o){var s=[];s.push(t+"="+encodeURIComponent(n)),e.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),e.isString(a)&&s.push("path="+a),e.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},cookies}var isAbsoluteURL$1=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t},parseHeaders,hasRequiredParseHeaders,isURLSameOrigin,hasRequiredIsURLSameOrigin,CanceledError_1,hasRequiredCanceledError,parseProtocol,hasRequiredParseProtocol,xhr,hasRequiredXhr,_null,hasRequired_null;function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders;hasRequiredParseHeaders=1;var e=utils$9,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders=function(n){var r,a,i,o={};return n?(e.forEach(n.split("\n"),(function(n){if(i=n.indexOf(":"),r=e.trim(n.substr(0,i)).toLowerCase(),a=e.trim(n.substr(i+1)),r){if(o[r]&&t.indexOf(r)>=0)return;o[r]="set-cookie"===r?(o[r]?o[r]:[]).concat([a]):o[r]?o[r]+", "+a:a}})),o):o},parseHeaders}function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin;hasRequiredIsURLSameOrigin=1;var e=utils$9;return isURLSameOrigin=e.isStandardBrowserEnv()?function(){var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function a(e){var t=e;return n&&(r.setAttribute("href",t),t=r.href),r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=a(window.location.href),function(n){var r=e.isString(n)?a(n):n;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}}function requireCanceledError(){if(hasRequiredCanceledError)return CanceledError_1;hasRequiredCanceledError=1;var e=requireAxiosError();function t(t){e.call(this,null==t?"canceled":t,e.ERR_CANCELED),this.name="CanceledError"}return utils$9.inherits(t,e,{__CANCEL__:!0}),CanceledError_1=t}function requireParseProtocol(){return hasRequiredParseProtocol||(hasRequiredParseProtocol=1,parseProtocol=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}),parseProtocol}function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var e=utils$9,t=requireSettle(),n=requireCookies(),r=buildURL$1,a=buildFullPath$1,i=requireParseHeaders(),o=requireIsURLSameOrigin(),s=transitional,l=requireAxiosError(),u=requireCanceledError(),c=requireParseProtocol();return xhr=function(p){return new Promise((function(d,m){var f,h=p.data,y=p.headers,b=p.responseType;function g(){p.cancelToken&&p.cancelToken.unsubscribe(f),p.signal&&p.signal.removeEventListener("abort",f)}e.isFormData(h)&&e.isStandardBrowserEnv()&&delete y["Content-Type"];var v=new XMLHttpRequest;if(p.auth){var T=p.auth.username||"",C=p.auth.password?unescape(encodeURIComponent(p.auth.password)):"";y.Authorization="Basic "+btoa(T+":"+C)}var N=a(p.baseURL,p.url);function A(){if(v){var e="getAllResponseHeaders"in v?i(v.getAllResponseHeaders()):null,n={data:b&&"text"!==b&&"json"!==b?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:e,config:p,request:v};t((function(e){d(e),g()}),(function(e){m(e),g()}),n),v=null}}if(v.open(p.method.toUpperCase(),r(N,p.params,p.paramsSerializer),!0),v.timeout=p.timeout,"onloadend"in v?v.onloadend=A:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(A)},v.onabort=function(){v&&(m(new l("Request aborted",l.ECONNABORTED,p,v)),v=null)},v.onerror=function(){m(new l("Network Error",l.ERR_NETWORK,p,v,v)),v=null},v.ontimeout=function(){var e=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded",t=p.transitional||s;p.timeoutErrorMessage&&(e=p.timeoutErrorMessage),m(new l(e,t.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,p,v)),v=null},e.isStandardBrowserEnv()){var S=(p.withCredentials||o(N))&&p.xsrfCookieName?n.read(p.xsrfCookieName):void 0;S&&(y[p.xsrfHeaderName]=S)}"setRequestHeader"in v&&e.forEach(y,(function(e,t){void 0===h&&"content-type"===t.toLowerCase()?delete y[t]:v.setRequestHeader(t,e)})),e.isUndefined(p.withCredentials)||(v.withCredentials=!!p.withCredentials),b&&"json"!==b&&(v.responseType=p.responseType),"function"==typeof p.onDownloadProgress&&v.addEventListener("progress",p.onDownloadProgress),"function"==typeof p.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",p.onUploadProgress),(p.cancelToken||p.signal)&&(f=function(e){v&&(m(!e||e&&e.type?new u:e),v.abort(),v=null)},p.cancelToken&&p.cancelToken.subscribe(f),p.signal&&(p.signal.aborted?f():p.signal.addEventListener("abort",f))),h||(h=null);var w=c(N);w&&-1===["http","https","file"].indexOf(w)?m(new l("Unsupported protocol "+w+":",l.ERR_BAD_REQUEST,p)):v.send(h)}))},xhr}function require_null(){return hasRequired_null?_null:(hasRequired_null=1,_null=null)}var utils$5=utils$9,normalizeHeaderName=normalizeHeaderName$1,AxiosError$1=requireAxiosError(),transitionalDefaults=transitional,toFormData=requireToFormData(),DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils$5.isUndefined(e)&&utils$5.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||void 0!==browser$1&&"[object process]"===Object.prototype.toString.call(browser$1))&&(e=requireXhr()),e}function stringifySafely(e,t,n){if(utils$5.isString(e))try{return(t||JSON.parse)(e),utils$5.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}var defaults$3={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function(e,t){if(normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$5.isFormData(e)||utils$5.isArrayBuffer(e)||utils$5.isBuffer(e)||utils$5.isStream(e)||utils$5.isFile(e)||utils$5.isBlob(e))return e;if(utils$5.isArrayBufferView(e))return e.buffer;if(utils$5.isURLSearchParams(e))return setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=utils$5.isObject(e),a=t&&t["Content-Type"];if((n=utils$5.isFileList(e))||r&&"multipart/form-data"===a){var i=this.env&&this.env.FormData;return toFormData(n?{"files[]":e}:e,i&&new i)}return r||"application/json"===a?(setContentTypeIfUnset(t,"application/json"),stringifySafely(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$3.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||r&&utils$5.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw AxiosError$1.from(e,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:require_null()},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$5.forEach(["delete","get","head"],(function(e){defaults$3.headers[e]={}})),utils$5.forEach(["post","put","patch"],(function(e){defaults$3.headers[e]=utils$5.merge(DEFAULT_CONTENT_TYPE)}));var defaults_1=defaults$3,utils$4=utils$9,defaults$2=defaults_1,transformData$1=function(e,t,n){var r=this||defaults$2;return utils$4.forEach(n,(function(n){e=n.call(r,e,t)})),e},isCancel$1,hasRequiredIsCancel;function requireIsCancel(){return hasRequiredIsCancel?isCancel$1:(hasRequiredIsCancel=1,isCancel$1=function(e){return!(!e||!e.__CANCEL__)})}var utils$3=utils$9,transformData=transformData$1,isCancel=requireIsCancel(),defaults$1=defaults_1,CanceledError=requireCanceledError();function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError}var dispatchRequest$1=function(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=transformData.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$3.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$3.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults$1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},utils$2=utils$9,mergeConfig$2=function(e,t){t=t||{};var n={};function r(e,t){return utils$2.isPlainObject(e)&&utils$2.isPlainObject(t)?utils$2.merge(e,t):utils$2.isPlainObject(t)?utils$2.merge({},t):utils$2.isArray(t)?t.slice():t}function a(n){return utils$2.isUndefined(t[n])?utils$2.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function i(e){if(!utils$2.isUndefined(t[e]))return r(void 0,t[e])}function o(n){return utils$2.isUndefined(t[n])?utils$2.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function s(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s};return utils$2.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=l[e]||a,r=t(e);utils$2.isUndefined(r)&&t!==s||(n[e]=r)})),n},data,hasRequiredData;function requireData(){return hasRequiredData?data:(hasRequiredData=1,data={version:"0.27.2"})}var VERSION=requireData().version,AxiosError=requireAxiosError(),validators$1={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){validators$1[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var deprecatedWarnings={};function assertOptions(e,t,n){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),a=r.length;a-- >0;){var i=r[a],o=t[i];if(o){var s=e[i],l=void 0===s||o(s,i,e);if(!0!==l)throw new AxiosError("option "+i+" must be "+l,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new AxiosError("Unknown option "+i,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,n){function r(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,a,i){if(!1===e)throw new AxiosError(r(a," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[a]&&(deprecatedWarnings[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}};var validator$1={assertOptions:assertOptions,validators:validators$1},utils$1=utils$9,buildURL=buildURL$1,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,buildFullPath=buildFullPath$1,validator=validator$1,validators=validator.validators;function Axios$1(e){this.defaults=e,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=mergeConfig$1(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var r=[],a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!a){var s=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(o),i=Promise.resolve(t);s.length;)i=i.then(s.shift(),s.shift());return i}for(var l=t;r.length;){var u=r.shift(),c=r.shift();try{l=u(l)}catch(e){c(e);break}}try{i=dispatchRequest(l)}catch(e){return Promise.reject(e)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},Axios$1.prototype.getUri=function(e){e=mergeConfig$1(this.defaults,e);var t=buildFullPath(e.baseURL,e.url);return buildURL(t,e.params,e.paramsSerializer)},utils$1.forEach(["delete","get","head","options"],(function(e){Axios$1.prototype[e]=function(t,n){return this.request(mergeConfig$1(n||{},{method:e,url:t,data:(n||{}).data}))}})),utils$1.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,a){return this.request(mergeConfig$1(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Axios$1.prototype[e]=t(),Axios$1.prototype[e+"Form"]=t(!0)}));var Axios_1=Axios$1,CancelToken_1,hasRequiredCancelToken,spread,hasRequiredSpread,isAxiosError,hasRequiredIsAxiosError;function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var e=requireCanceledError();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(e){n=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t((function(t){r.reason||(r.reason=new e(t),n(r.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},CancelToken_1=t}function requireSpread(){return hasRequiredSpread?spread:(hasRequiredSpread=1,spread=function(e){return function(t){return e.apply(null,t)}})}function requireIsAxiosError(){if(hasRequiredIsAxiosError)return isAxiosError;hasRequiredIsAxiosError=1;var e=utils$9;return isAxiosError=function(t){return e.isObject(t)&&!0===t.isAxiosError}}var utils=utils$9,bind=bind$2,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(e){var t=new Axios(e),n=bind(Axios.prototype.request,t);return utils.extend(n,Axios.prototype,t),utils.extend(n,t),n.create=function(t){return createInstance(mergeConfig(e,t))},n}var axios$1=createInstance(defaults);axios$1.Axios=Axios,axios$1.CanceledError=requireCanceledError(),axios$1.CancelToken=requireCancelToken(),axios$1.isCancel=requireIsCancel(),axios$1.VERSION=requireData().version,axios$1.toFormData=requireToFormData(),axios$1.AxiosError=requireAxiosError(),axios$1.Cancel=axios$1.CanceledError,axios$1.all=function(e){return Promise.all(e)},axios$1.spread=requireSpread(),axios$1.isAxiosError=requireIsAxiosError(),axios$2.exports=axios$1,axios$2.exports.default=axios$1,function(e){e.exports=axios$2.exports}(axios$3);var axios=getDefaultExportFromCjs(axios$3.exports);class Core{constructor({doenetML:e,doenetId:t,activityCid:n,pageNumber:r,attemptNumber:a=1,itemNumber:i=1,serverSaveId:o,requestedVariant:s,requestedVariantIndex:l,flags:u={},stateVariableChanges:c={},coreId:p,updateDataOnContentChange:d}){this.coreId=p,this.doenetId=t,this.activityCid=n,this.pageNumber=r,this.attemptNumber=a,this.itemNumber=i,this.serverSaveId=o,this.updateDataOnContentChange=d,this.numerics=new Numerics,this.flags=u,this.finishCoreConstruction=this.finishCoreConstruction.bind(this),this.getStateVariableValue=this.getStateVariableValue.bind(this),this.componentInfoObjects=createComponentInfoObjects(),this.coreFunctions={requestUpdate:this.requestUpdate.bind(this),performUpdate:this.performUpdate.bind(this),requestAction:this.requestAction.bind(this),performAction:this.performAction.bind(this),resolveAction:this.resolveAction.bind(this),triggerChainedActions:this.triggerChainedActions.bind(this),requestRecordEvent:this.requestRecordEvent.bind(this),requestAnimationFrame:this.requestAnimationFrame.bind(this),cancelAnimationFrame:this.cancelAnimationFrame.bind(this),recordSolutionView:this.recordSolutionView.bind(this)},this.updateInfo={componentsToUpdateRenderers:[],compositesToExpand:new Set([]),compositesToUpdateReplacements:[],inactiveCompositesToUpdateReplacements:[],componentsToUpdateActionChaining:{},unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},compositesBeingExpanded:[],stateVariableUpdatesForMissingComponents:JSON.parse(JSON.stringify(c,serializedComponentsReplacer),serializedComponentsReviver)},this.cumulativeStateVariableChanges=JSON.parse(JSON.stringify(c,serializedComponentsReplacer),serializedComponentsReviver),this.requestedVariantIndex=l,this.requestedVariant=s,this.parameterStack=new ParameterStack,this.parameterStack.parameters.rngClass=prng_alea,this.initialized=!1,this.initializedPromiseResolves=[],this.resolveInitialized=()=>{this.initializedPromiseResolves.forEach((e=>e(!0))),this.initialized=!0},this.getInitializedPromise=()=>this.initialized?Promise.resolve(!0):new Promise(((e,t)=>{this.initializedPromiseResolves.push(e)})),cidFromText(e).then((t=>expandDoenetMLsToFullSerializedComponents({cids:[t],doenetMLs:[e],componentInfoObjects:this.componentInfoObjects,flags:this.flags}))).then(this.finishCoreConstruction).catch((e=>{postMessage({messageType:"inErrorState",args:{errMsg:e.message}})}))}async finishCoreConstruction({cids:e,fullSerializedComponents:t}){this.cid=e[0];let n=t[0];addDocumentIfItsMissing(n),createComponentNames({serializedComponents:n,componentInfoObjects:this.componentInfoObjects}),this.documentName=n[0].componentName,n[0].doenetAttributes.cid=this.cid,this._components={},this.componentsToRender={},this.componentsWithChangedChildrenToRender=new Set([]),this.stateVariableChangeTriggers={},this.actionsChangedToActions={},this.originsOfActionsChangedToActions={},this.essentialValuesSavedInDefinition={},this.saveStateToDBTimerId=null,this.rendererState={},this.rendererVariablesByComponentType={};for(let e in this.componentInfoObjects.allComponentClasses)Object.defineProperty(this.rendererVariablesByComponentType,e,{get:function(){let t=this.componentInfoObjects.allComponentClasses[e].returnStateVariableInfo({onlyForRenderer:!0}).stateVariableDescriptions;return delete this.rendererVariablesByComponentType[e],this.rendererVariablesByComponentType[e]=t}.bind(this),configurable:!0});this.processQueue=[],this.dependencies=new DependencyHandler({_components:this._components,componentInfoObjects:this.componentInfoObjects,core:this}),this.unmatchedChildren={};let r=getNumberOfVariants({serializedComponent:n[0],componentInfoObjects:this.componentInfoObjects}).numberOfVariantsPreIgnore;if(!this.requestedVariant){if(this.requestedVariantIndex=((this.requestedVariantIndex-1)%r+r)%r+1,n[0].variants.uniqueVariants){let e=this.componentInfoObjects.allComponentClasses[n[0].componentType].getUniqueVariant({serializedComponent:n[0],variantIndex:this.requestedVariantIndex,componentInfoObjects:this.componentInfoObjects});e.success&&(this.requestedVariant=e.desiredVariant)}this.requestedVariant||(this.requestedVariant={index:this.requestedVariantIndex})}this.parameterStack.parameters.variant=this.requestedVariant,n[0].variants.desiredVariant=this.parameterStack.parameters.variant,await this.addComponents({serializedComponents:n,initialAdd:!0}),this.updateInfo.componentsToUpdateRenderers=[],await this.document.stateValues.itemCreditAchieved,this.canonicalGeneratedVariantString=JSON.stringify(await this.document.stateValues.generatedVariantInfo,serializedComponentsReplacer),this.canonicalItemVariantStrings=(await this.document.stateValues.itemVariantInfo).map((e=>JSON.stringify(e,serializedComponentsReplacer))),this.coreInfo={generatedVariantString:this.canonicalGeneratedVariantString,allPossibleVariants:deepClone(await this.document.sharedParameters.allPossibleVariants),variantIndicesToIgnore:deepClone(await this.document.sharedParameters.variantIndicesToIgnore),rendererTypesInDocument:deepClone(this.rendererTypesInDocument),documentToRender:this.documentRendererInstructions},this.coreInfoString=JSON.stringify(this.coreInfo,serializedComponentsReplacer),this.messageViewerReady(),this.requestRecordEvent({verb:"experienced",object:{componentName:this.document.componentName,componentType:"document"}}),this.resolveInitialized()}async messageViewerReady(){postMessage({messageType:"initializeRenderers",args:{coreInfo:this.coreInfo}}),postMessage({messageType:"coreCreated"})}async postUpdateRenderers(e,t=!1){postMessage({messageType:"updateRenderers",args:e,init:t})}async addComponents({serializedComponents:e,parentName:t,indexOfDefiningChildren:n,initialAdd:r=!1,assignNamesOffset:a}){let i;Array.isArray(e)||(e=[e]);let o=[],s="";if(!r){if(i=this._components[t],!i)return console.warn(`Cannot add children to parent ${t} as ${t} does not exist`),[];if(i.isShadow)return console.warn(`Cannot add children to parent ${t} as it is a shadow component.`),[];o=[{componentName:t,componentClass:i.constructor},...i.ancestors],this.parameterStack.push(i.sharedParameters,!1),this.nTimesAddedComponents?this.nTimesAddedComponents++:this.nTimesAddedComponents=1,s=`addComponents${this.nTimesAddedComponents}`}let l=await this.createIsolatedComponents({serializedComponents:e,ancestors:o,createNameContext:s});if(r||this.parameterStack.pop(),!0!==l.success)throw Error(l.message);const u=l.components;let c={},p={};if(u.forEach((e=>p[e.componentName]=e)),r){if(1!==u.length)throw Error("Initial components need to be an array of just one component.");this.document=u[0],await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0),await this.replacementChangesFromCompositesToUpdate();let e=await this.initializeRenderedComponentInstruction(this.document);if(this.updateInfo.compositesToUpdateReplacements.length>0){await this.replacementChangesFromCompositesToUpdate();let e=[...new Set(this.updateInfo.componentsToUpdateRenderers)];this.updateInfo.componentsToUpdateRenderers=[],await this.updateRendererInstructions({componentNamesToUpdate:e})}this.documentRendererInstructions=e.componentToRender;let t=[{instructionType:"updateRendererStates",rendererStatesToUpdate:e.rendererStatesToUpdate}];this.postUpdateRenderers({updateInstructions:t},!0),await this.processStateVariableTriggers()}else{if(void 0===i)throw Error("Must specify parent when adding components.");void 0===n&&(n=i.definingChildren.length);let e=await this.addChildrenAndRecurseToShadows({parent:i,indexOfDefiningChildren:n,newChildren:u,assignNamesOffset:a});if(!e.success)throw Error("Couldn't satisfy child logic result.  Need informative error message");if(Object.assign(p,e.addedComponents),Object.assign(c,e.deletedComponents),await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0),await this.replacementChangesFromCompositesToUpdate(),await this.updateRendererInstructions({componentNamesToUpdate:await this.componentAndRenderedDescendants(i)}),this.updateInfo.compositesToUpdateReplacements.length>0){await this.replacementChangesFromCompositesToUpdate();let e=[...new Set(this.updateInfo.componentsToUpdateRenderers)];this.updateInfo.componentsToUpdateRenderers=[],await this.updateRendererInstructions({componentNamesToUpdate:e})}await this.processStateVariableTriggers()}return u}async updateRendererInstructions({componentNamesToUpdate:e,sourceOfUpdate:t={},actionId:n}){let r=[],a=[],i=[],o={};for(let t of this.componentsWithChangedChildrenToRender)if(t in this.componentsToRender){let n=[],a=this._components[t],s=[];if(a&&a.constructor.renderChildren){a.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:a,expandComposites:!0,forceExpandComposites:!0}),s=await this.returnActiveChildrenIndicesToRender(a);let e=0;for(let[t,r]of a.activeChildren.entries())s.includes(t)&&(r.rendererType?(n.push(`nameType:${r.componentName};${r.componentType}`),e++):"string"==typeof r?(n.push(`string${e}:${r}`),e++):"number"==typeof r&&(n.push(`number${e}:${r.toString()}`),e++))}let l=this.componentsToRender[t].children,u=[];for(let[e,t]of l.entries())t.componentName?u.push(`nameType:${t.componentName};${t.componentType}`):"string"==typeof t?u.push(`string${e}:${t}`):"number"==typeof t&&u.push(`number${e}:${t.toString()}`);if(n.length!==u.length||n.some(((e,t)=>e!==u[t]))){for(let e of l)if(e.componentName){let t=this.deleteFromComponentsToRender({componentName:e.componentName,recurseToChildren:!0});r.push(...t)}let n=[];if(s.length>0)for(let[e,t]of a.activeChildren.entries())if(s.includes(e))if(t.rendererType){let e=await this.initializeRenderedComponentInstruction(t);n.push(e.componentToRender),i.push(...e.rendererStatesToUpdate)}else"string"==typeof t?n.push(t):"number"==typeof t&&n.push(t.toString());this.componentsToRender[t].children=n,o[t]=n,this.componentsWithChangedChildrenToRender.delete(t),e.includes(t)||e.push(t)}}this.componentsWithChangedChildrenToRender=new Set([]);for(let t of e)if(t in this.componentsToRender){let e=this._components[t];if(e){let n={};for(let t in e.state)if(e.state[t].forRenderer){let r=removeFunctionsMathExpressionClass(await e.state[t].value);n[t]=r}let r={componentName:t,stateValues:n,rendererType:e.rendererType};this.rendererState[t]||(this.rendererState[t]={}),this.rendererState[t].stateValues=n,o[t]&&(r.childrenInstructions=o[t],this.rendererState[t].childrenInstructions=o[t]),i.push(r)}}if(i.length>0){let e={instructionType:"updateRendererStates",rendererStatesToUpdate:i,sourceOfUpdate:t};a.splice(0,0,e)}this.postUpdateRenderers({updateInstructions:a,actionId:n})}async initializeRenderedComponentInstruction(e){if(void 0===e.rendererType)return;e.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:e,expandComposites:!0});let t=[],n={};for(let t in e.state)e.state[t].forRenderer&&(n[t]=removeFunctionsMathExpressionClass(await e.state[t].value));let r=e.componentName,a=[];if(e.constructor.renderChildren){let n=await this.returnActiveChildrenIndicesToRender(e);for(let[r,i]of e.activeChildren.entries())if(n.includes(r))if(i.rendererType){let e=await this.initializeRenderedComponentInstruction(i);a.push(e.componentToRender),t.push(...e.rendererStatesToUpdate)}else"string"==typeof i?a.push(i):"number"==typeof i&&a.push(i.toString())}t.push({componentName:r,stateValues:n,childrenInstructions:a}),this.rendererState[r]={stateValues:n,childrenInstructions:a},this.componentsWithChangedChildrenToRender.delete(r);let i={};for(let t in e.actions)i[t]={actionName:t,componentName:e.componentName};for(let t in e.externalActions){let n=await e.externalActions[t];n&&(i[t]={actionName:t,componentName:n.componentName})}let o={componentName:r,effectiveName:e.componentOrAdaptedName,componentType:e.componentType,rendererType:e.rendererType,actions:i};return this.componentsToRender[r]={children:a},{componentToRender:o,rendererStatesToUpdate:t}}deleteFromComponentsToRender({componentName:e,recurseToChildren:t=!0}){let n=[e];if(t){let r=this.componentsToRender[e];if(r)for(let e of r.children){let r=this.deleteFromComponentsToRender({componentName:e.componentName,recurseToChildren:t});n.push(...r)}}return delete this.componentsToRender[e],this.componentsWithChangedChildrenToRender.delete(e),n}async processStateVariableTriggers(){for(let e in this.stateVariableChangeTriggers){let t=this._components[e];for(let n in this.stateVariableChangeTriggers[e]){let r=this.stateVariableChangeTriggers[e][n],a=await t.state[n].value;if(a!==r.previousValue){let i=r.previousValue;r.previousValue=a,t.actions[r.action]&&await this.performAction({componentName:e,actionName:r.action,args:{stateValues:{[n]:a},previousValues:{[n]:i}}})}}}}async expandAllComposites(e,t=!1){let n=await this.expandCompositesOfDescendants(e,t),r=!0;for(;r;){r=!1;for(let e of n){let n=this._components[e],a=!1;for(let e of n.unexpandedCompositesNotReady){let n=this._components[e];if(n.state.readyToExpandWhenResolved.isResolved){a=!0;break}if((await this.dependencies.resolveItem({componentName:n.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",force:t,recurseUpstream:!0})).success){a=!0;break}}if(a){let n=this._components[e];await this.deriveChildResultsFromDefiningChildren({parent:n,expandComposites:!0,forceExpandComposites:t}),r=!0}}}}async expandCompositesOfDescendants(e,t=!1){let n=[];e.childrenMatched||(await this.deriveChildResultsFromDefiningChildren({parent:e,expandComposites:!0,forceExpandComposites:t}),e.unexpandedCompositesNotReady.length>0?n.push(e.componentName):await this.dependencies.resolveBlockersFromChangedActiveChildren(e,t));for(let r in e.attributes){let a=e.attributes[r].component;if(a){let e=await this.expandCompositesOfDescendants(a,t);n.push(...e)}}for(let r in e.allChildren){let a=e.allChildren[r].component;if("object"!=typeof a)continue;let i=await this.expandCompositesOfDescendants(a,t);n.push(...i)}return n}async componentAndRenderedDescendants(e){if(!e?.componentName)return[];let t=[e.componentName];if(e.constructor.renderChildren){e.childrenMatched||await this.deriveChildResultsFromDefiningChildren({parent:e,expandComposites:!0});for(let n of e.activeChildren)t.push(...await this.componentAndRenderedDescendants(n))}return t}async createIsolatedComponents({serializedComponents:e,ancestors:t,shadow:n=!1,createNameContext:r=""}){let a="/";if(t.length>0){let e=t[0].componentName,n=this.components[e];a=n.attributes.newNamespace?.primitive?n.componentName+"/":getNamespaceFromName(n.componentName)}return{success:!0,components:(await this.createIsolatedComponentsSub({serializedComponents:e,ancestors:t,shadow:n,namespaceForUnamed:a,createNameContext:r})).components}}async createIsolatedComponentsSub({serializedComponents:e,ancestors:t,shadow:n=!1,createNameContext:r="",namespaceForUnamed:a="/",componentsReplacementOf:i}){let o=[];for(let[s,l]of e.entries()){if("object"!=typeof l){o.push(l);continue}if(!0===l.createdComponent){let e=this._components[l.componentName];o.push(e),this.setAncestors(e,t);continue}let e=this.componentInfoObjects.allComponentClasses[l.componentType];if(void 0===e)throw Error("Cannot create component of type "+l.componentType);l.doenetAttributes||(l.doenetAttributes={});let u=l.componentName;if(void 0===u){let e=t[0].componentName+"|"+r+"|";l.uniqueIdentifier?e+=l.uniqueIdentifier:e+=s,u=createUniqueName(l.componentType.toLowerCase(),e),u=a+u}let c=(await this.createChildrenThenComponent({serializedComponent:l,componentName:u,ancestors:t,componentClass:e,shadow:n,namespaceForUnamed:a,componentsReplacementOf:i})).newComponent;o.push(c)}return{components:o}}async createChildrenThenComponent({serializedComponent:e,componentName:t,ancestors:n,componentClass:r,shadow:a=!1,namespaceForUnamed:i="/",componentsReplacementOf:o}){let s=e.children,l=[],u=[],c=[{componentName:t,componentClass:r},...n],p=this.parameterStack.parameters;this.parameterStack.push();let d=this.parameterStack.parameters;if(r.descendantCompositesMustHaveAReplacement?(d.compositesMustHaveAReplacement=!0,d.compositesDefaultReplacementType=r.descendantCompositesDefaultReplacementType):!1===r.descendantCompositesMustHaveAReplacement&&(d.compositesMustHaveAReplacement=!1),r.modifySharedParameters&&r.modifySharedParameters({sharedParameters:d,serializedComponent:e}),e.doenetAttributes.pushSharedParameters)for(let t of e.doenetAttributes.pushSharedParameters){let e=t.parameterName;d[e]=e in d?[...d[e]]:[],d[e].push(t.value)}if(e.doenetAttributes.addToSharedParameters)for(let t of e.doenetAttributes.addToSharedParameters){let e=t.parameterName;d[e]=e in d?Object.assign({},d[e]):{},d[e][t.key]=t.value}if(void 0!==s)if(r.setUpVariant){let t,n;for(let[e,r]of s.entries())if("variantControl"===r.componentType||r.createdComponent&&"variantControl"===this._components[r.componentName].componentType){t=e,n=r;break}let o=gatherVariantComponents({serializedComponents:s,componentInfoObjects:this.componentInfoObjects});if(void 0!==t){if(e.variants){let t=e.variants.desiredVariant;void 0!==t&&(void 0!==t.index?n.variants={desiredVariantIndex:t.index}:void 0!==t.name&&(n.variants={desiredVariantName:t.name})),void 0===e.variants.numberOfVariants&&getNumberOfVariants({serializedComponent:e,componentInfoObjects:this.componentInfoObjects}),e.variants.uniqueVariants&&(d.numberOfVariantsPreIgnore=e.variants.numberOfVariantsPreIgnore)}let o=await this.createIsolatedComponentsSub({serializedComponents:[n],ancestors:c,shadow:a,createNameContext:"variantControl",namespaceForUnamed:i});if(l[t]=o.components[0],e.variants.uniqueVariants&&!e.variants.selectedUniqueVariant){let t=r.getUniqueVariant({serializedComponent:e,variantIndex:await o.components[0].stateValues.selectedVariantIndex,componentInfoObjects:this.componentInfoObjects});t.success&&(e.variants.desiredVariant=t.desiredVariant)}}if(await r.setUpVariant({serializedComponent:e,sharedParameters:d,definingChildrenSoFar:l,descendantVariantComponents:o}),r.keepChildrenSerialized&&void 0===t){let t=new Set([]),n=r.keepChildrenSerialized({serializedComponent:e,componentInfoObjects:this.componentInfoObjects});for(let e of n){if(t.has(Number(e)))throw Error("Invalid instructions to keep children serialized from "+r.componentType+": child repeated");t.add(Number(e)),u.push(s[e])}let o=[];for(let[e,n]of s.entries())t.has(e)||o.push(n);if(o.length>0){l=(await this.createIsolatedComponentsSub({serializedComponents:o,ancestors:c,shadow:a,namespaceForUnamed:i})).components}}else{let e=[...s.keys()].filter((e=>e!==t)),n=s.filter(((e,n)=>n!==t)),r=await this.createIsolatedComponentsSub({serializedComponents:n,ancestors:c,shadow:a,namespaceForUnamed:i});for(let[t,n]of e.entries())l[n]=r.components[t]}}else if(r.keepChildrenSerialized){let t=new Set([]),n=r.keepChildrenSerialized({serializedComponent:e,componentInfoObjects:this.componentInfoObjects});for(let e of n){if(t.has(Number(e)))throw Error("Invalid instructions to keep children serialized from "+r.componentType+": child repeated");t.add(Number(e)),u.push(s[e])}let o=[];for(let[e,n]of s.entries())t.has(e)||o.push(n);if(o.length>0){l=(await this.createIsolatedComponentsSub({serializedComponents:o,ancestors:c,shadow:a,namespaceForUnamed:i})).components}}else{l=(await this.createIsolatedComponentsSub({serializedComponents:s,ancestors:c,shadow:a,namespaceForUnamed:i})).components}let m={};if(e.attributes)for(let t in e.attributes){if(e.attributes[t].component){let n=await this.createIsolatedComponentsSub({serializedComponents:[e.attributes[t].component],ancestors:c,shadow:a,namespaceForUnamed:i,createNameContext:`attribute|${t}`});m[t]={component:n.components[0]}}else m[t]=e.attributes[t]}let f={};e.downstreamDependencies&&Object.assign(f,e.downstreamDependencies);let h=await this.createStateVariableDefinitions({componentClass:r,prescribedDependencies:f});delete this.updateInfo.deletedComponents[t],delete this.updateInfo.deletedStateVariables[t];let y=new r({componentName:t,ancestors:n,definingChildren:l,stateVariableDefinitions:h,serializedChildren:u,serializedComponent:e,attributes:m,componentInfoObjects:this.componentInfoObjects,coreFunctions:this.coreFunctions,flags:this.flags,shadow:a,numerics:this.numerics,sharedParameters:d,parentSharedParameters:p});this.registerComponent(y),o&&(y.replacementOf=o),e.adaptedFrom&&(y.adaptedFrom=this._components[e.adaptedFrom],y.adaptedFrom.adapterUsed=y);for(let e in f){let t=f[e];for(let n of t)if("referenceShadow"===n.dependencyType){let t={componentName:e};Object.assign(t,n),delete t.dependencyType,y.shadows=t;let r=this._components[e];r.shadowedBy||(r.shadowedBy=[]),r.shadowedBy.push(y);break}}await this.deriveChildResultsFromDefiningChildren({parent:y,expandComposites:!1}),await this.initializeComponentStateVariables(y),await this.dependencies.setUpComponentDependencies(y);let b=await this.dependencies.checkForDependenciesOnNewComponent(t);for(let e of b)await this.recordActualChangeInStateVariable({componentName:e.componentName,varName:e.varName});return await this.checkForStateVariablesUpdatesForNewComponent(t),await this.dependencies.resolveStateVariablesIfReady({component:y}),await this.checkForActionChaining({component:y}),this.parameterStack.pop(),{newComponent:y}}async checkForStateVariablesUpdatesForNewComponent(e){if(e in this.updateInfo.stateVariableUpdatesForMissingComponents){let t=await this.processNewStateVariableValues({[e]:this.updateInfo.stateVariableUpdatesForMissingComponents[e]}),n=this._components[e];for(let t in this.updateInfo.stateVariableUpdatesForMissingComponents[e])n.state[t]&&await this.getStateVariableValue({component:n,stateVariable:t,justUpdatedForNewComponent:!0});t.foundIgnore&&await this.processNewStateVariableValues({[e]:this.updateInfo.stateVariableUpdatesForMissingComponents[e]}),delete this.updateInfo.stateVariableUpdatesForMissingComponents[e]}}async deriveChildResultsFromDefiningChildren({parent:e,expandComposites:t=!0,forceExpandComposites:n=!1}){if(this.derivingChildResults||(this.derivingChildResults=[]),this.derivingChildResults.includes(e.componentName))return{success:!1,skipping:!0};this.derivingChildResults.push(e.componentName);let r=await this.expandCompositeOfDefiningChildren(e,e.definingChildren,t,n);e.unexpandedCompositesReady=r.unexpandedCompositesReady,e.unexpandedCompositesNotReady=r.unexpandedCompositesNotReady,e.activeChildren=e.definingChildren.slice(),e.allChildren={},e.allChildrenOrdered=[];for(let t=0;t<e.activeChildren.length;t++){let n,r=e.activeChildren[t];"object"==typeof r&&(n=r.componentName,e.allChildren[n]={activeChildrenIndex:t,definingChildrenIndex:t,component:r},e.allChildrenOrdered.push(n))}await this.replaceCompositeChildren(e);let a=await this.matchChildrenToChildGroups(e);if(a.success)delete this.unmatchedChildren[e.componentName],e.childrenMatchedWithPlaceholders=!0;else{e.childrenMatchedWithPlaceholders=!1;let t=a.unmatchedChildren.map((e=>e.componentType)).join(", ");this.unmatchedChildren[e.componentName]={message:`invalid children of type(s): ${t}`}}await this.dependencies.addBlockersFromChangedActiveChildren({parent:e});let i=this.derivingChildResults.indexOf(e.componentName);return this.derivingChildResults.splice(i,1),e.constructor.renderChildren&&this.componentsWithChangedChildrenToRender.add(e.componentName),a}async expandCompositeOfDefiningChildren(e,t,n,r){let a=[],i=[];for(let o=0;o<t.length;o++){let s=t[o];if(s instanceof this.componentInfoObjects.allComponentClasses._composite){if(this.findChildGroup(s.componentType,e.constructor).success)continue;if(!s.isExpanded){if(s.state.readyToExpandWhenResolved.isResolved){if(!n){a.push(s.componentName),this.updateInfo.compositesToExpand.add(s.componentName);continue}}else{if(!n){i.push(s.componentName),this.updateInfo.compositesToExpand.add(s.componentName);continue}if(!(await this.dependencies.resolveItem({componentName:s.componentName,type:"stateVariable",stateVariable:"readyToExpandWhenResolved",expandComposites:n,force:r})).success){i.push(s.componentName),this.updateInfo.compositesToExpand.add(s.componentName);continue}}await this.expandCompositeComponent(s)}let t=await this.expandCompositeOfDefiningChildren(e,s.replacements,n,r);a.push(...t.unexpandedCompositesReady),i.push(...t.unexpandedCompositesNotReady)}}return{unexpandedCompositesReady:a,unexpandedCompositesNotReady:i}}async matchChildrenToChildGroups(e){e.childMatchesByGroup={};for(let t in e.constructor.childGroupIndsByName)e.childMatchesByGroup[t]=[];let t=!0,n=[];for(let[r,a]of e.activeChildren.entries()){let i="object"!=typeof a?typeof a:a.componentType,o=this.findChildGroup(i,e.constructor);o.success?(e.childMatchesByGroup[o.group].push(r),void 0!==o.adapterIndUsed&&await this.substituteAdapter({parent:e,childInd:r,adapterIndUsed:o.adapterIndUsed})):(t=!1,n.push(a))}return{success:t,unmatchedChildren:n}}findChildGroup(e,t){let n=this.findChildGroupNoAdapters(e,t);if(n.success)return n;if("string"===e)return{success:!1};let r=this.componentInfoObjects.allComponentClasses[e],a=r.nAdapters;for(let e=0;e<a;e++){let a=r.getAdapterComponentType(e,this.componentInfoObjects.publicStateVariableInfo);if(n=this.findChildGroupNoAdapters(a,t),n.success)return n.adapterIndUsed=e,n}return{success:!1}}findChildGroupNoAdapters(e,t){if(t.childGroupOfComponentType[e])return{success:!0,group:t.childGroupOfComponentType[e]};for(let n of t.childGroups)for(let r of n.componentTypes)if(this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:e,baseComponentType:r})&&("_base"!==r||!this.componentInfoObjects.isInheritedComponentType({inheritedComponentType:e,baseComponentType:"_composite"})))return t.childGroupOfComponentType[e]=n.group,{success:!0,group:n.group};return{success:!1}}async returnActiveChildrenIndicesToRender(e){let t=[],n=1/0;"nChildrenToRender"in e.state&&(n=await e.stateValues.nChildrenToRender);let r=null;"childIndicesToRender"in e.state&&(r=await e.stateValues.childIndicesToRender);for(let[a,i]of e.activeChildren.entries()){if(a>=n)break;if(!r||r.includes(a))if("object"==typeof i)await i.stateValues.hidden||t.push(a);else{let n=!1;if(e.compositeReplacementActiveRange)for(let t of e.compositeReplacementActiveRange){let e=this._components[t.compositeName];if(await e.stateValues.hidden&&t.firstInd<=a&&t.lastInd>=a){n=!0;break}}n||t.push(a)}}return t}async substituteAdapter({parent:e,childInd:t,adapterIndUsed:n}){let r,a=e.activeChildren[t];r=a.componentName?a.getAdapter(n):{componentType:this.componentInfoObjects.allComponentClasses[a.componentType].getAdapterComponentType(n,this.componentInfoObjects.publicStateVariableInfo),placeholderInd:a.placeholderInd+"adapt"};let i=a.adapterUsed;if(void 0===i||i.componentType!==r.componentType)if(a.componentName){let t;t=e.attributes.newNamespace?.primitive?e.componentName+"/":getNamespaceFromName(e.componentName),r.adaptedFrom=a.componentName,i=(await this.createIsolatedComponentsSub({serializedComponents:[r],shadow:!0,ancestors:a.ancestors,createNameContext:a.componentName+"|adapter",namespaceForUnamed:t})).components[0]}else r.adaptedFrom=a,i=r;if(e.activeChildren.splice(t,1,i),a.componentName&&(delete e.allChildren[a.componentName].activeChildrenIndex,e.allChildren[i.componentName]={activeChildrenIndex:t,component:i}),a.componentName){let t=e.allChildrenOrdered.indexOf(a.componentName);e.allChildrenOrdered.splice(t+1,0,i.componentName)}else{let t=e.allChildrenOrdered.indexOf(a.placeholderInd);e.allChildrenOrdered.splice(t+1,0,i.placeholderInd)}}async expandCompositeComponent(e){if(!("readyToExpandWhenResolved"in e.state))throw Error(`Could not find state variable readyToExpandWhenResolved of composite ${e.componentName}`);if(!e.state.readyToExpandWhenResolved.isResolved)return this.updateInfo.compositesToExpand.add(e.componentName),{success:!1};if(this.updateInfo.compositesToExpand.delete(e.componentName),this.updateInfo.compositesBeingExpanded.push(e.componentName),e.parent){if(e.parent.unexpandedCompositesReady){let t=e.parent.unexpandedCompositesReady.indexOf(e.componentName);-1!==t&&e.parent.unexpandedCompositesReady.splice(t,1)}if(e.parent.unexpandedCompositesNotReady){let t=e.parent.unexpandedCompositesNotReady.indexOf(e.componentName);-1!==t&&e.parent.unexpandedCompositesNotReady.splice(t,1)}}if(e.shadows)return await this.expandShadowingComposite(e);let t=await e.constructor.createSerializedReplacements({component:this.components[e.componentName],components:this.components,workspace:e.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});if(e.constructor.stateVariableToEvaluateAfterReplacements&&await e.stateValues[e.constructor.stateVariableToEvaluateAfterReplacements],!t.replacements)throw Error(`Invalid createSerializedReplacements of ${e.componentName}`);{let n=t.replacements;await this.createAndSetReplacements({component:e,serializedReplacements:n}),t.withholdReplacements&&(e.replacementsToWithhold=e.replacements.length)}let n=this.updateInfo.compositesBeingExpanded.indexOf(e.componentName);if(-1===n)throw Error(`Something is wrong as we lost track that we were expanding ${e.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(n,1),{success:!0,compositesExpanded:[e.componentName]}}async expandShadowingComposite(e){if(this.updateInfo.compositesBeingExpanded.includes(e.shadows.componentName)){let t=this._components[e.shadows.componentName];for(;t.shadows;)t=this._components[t.shadows.componentName];throw Error(`Circular reference involving ${t.componentName}`)}let t=this._components[e.shadows.componentName],n=[];if(!t.isExpanded){let r=await this.expandCompositeComponent(t);if(!r.success)throw Error(`expand result of ${e.componentName} was not a success even though ready to expand.`);n.push(...r.compositesExpanded)}let r=[];for(let e of t.replacements)"object"==typeof e?r.push(await e.serialize()):r.push(e);let a=e.replacementsWorkspace.uniqueIdentifiersUsed=[],i=e.shadows.compositeName;r=postProcessCopy({serializedComponents:r,componentName:i,uniqueIdentifiersUsed:a});let o=e.attributes.newNamespace?.primitive;if(e.attributes.isResponse){let t=e.constructor.createAttributesObject({flags:this.flags});for(let n of r){if("object"!=typeof n)continue;n.attributes||(n.attributes={});let r=convertAttributesForComponentType({attributes:{isResponse:e.attributes.isResponse},componentType:n.componentType,componentInfoObjects:this.componentInfoObjects,compositeAttributesObj:t,compositeCreatesNewNamespace:o});Object.assign(n.attributes,r)}}if(e.constructor.assignNamesToReplacements){let t=this.components[i],n=t.attributes.newNamespace?.primitive,a=t.doenetAttributes.assignNames,s=o||n&&!a,l=e.doenetAttributes.assignNames;l&&await e.stateValues.addLevelToAssignNames&&(l=l.map((e=>[e]))),r=processAssignNames({assignNames:l,serializedComponents:r,parentName:e.componentName,parentCreatesNewNamespace:o,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:s}).serializedComponents}else{let t=o;r=processAssignNames({serializedComponents:r,parentName:e.componentName,parentCreatesNewNamespace:o,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:t}).serializedComponents}await this.createAndSetReplacements({component:e,serializedReplacements:r});let s=this.updateInfo.compositesBeingExpanded.indexOf(e.componentName);if(-1===s)throw Error(`Something is wrong as we lost track that we were expanding ${e.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(s,1),n.push(e.componentName),{success:!0,compositesExpanded:n}}async createAndSetReplacements({component:e,serializedReplacements:t}){let n;this.parameterStack.push(e.sharedParameters,!1),n=e.attributes.newNamespace?.primitive?e.componentName+"/":getNamespaceFromName(e.componentName);let r=await this.createIsolatedComponentsSub({serializedComponents:t,ancestors:e.ancestors,shadow:!0,createNameContext:e.componentName+"|replacements",namespaceForUnamed:n,componentsReplacementOf:e});this.parameterStack.pop(),e.replacements=r.components,await this.dependencies.addBlockersFromChangedReplacements(e),e.isExpanded=!0}async replaceCompositeChildren(e){delete e.placeholderActiveChildrenIndices,delete e.placeholderActiveChildrenIndicesByComposite,delete e.compositeReplacementActiveRange;let t=0;for(let n=0;n<e.activeChildren.length;n++){let r=e.activeChildren[n];if(r instanceof this.componentInfoObjects.allComponentClasses._composite){if(this.findChildGroup(r.componentType,e.constructor).success)continue;let a,i=!1;if(!r.isExpanded){if(!r.attributes.createComponentOfType?.primitive)continue;i=!0}if(i){let i;i=r.attributes.nComponents?r.attributes.nComponents.primitive:1;let o=this.componentInfoObjects.componentTypeLowerCaseMapping[r.attributes.createComponentOfType.primitive.toLowerCase()];a=[];for(let e=0;e<i;e++)a.push({componentType:o,fromComposite:r.componentName,placeholderInd:t}),t++;e.hasPlaceholderActiveChildren=!0;let s=[...Array(i).keys()].map((e=>e+n));e.placeholderActiveChildrenIndices||(e.placeholderActiveChildrenIndices=[]),e.placeholderActiveChildrenIndices.push(...s),e.placeholderActiveChildrenIndicesByComposite||(e.placeholderActiveChildrenIndicesByComposite={}),e.placeholderActiveChildrenIndicesByComposite[r.componentName]=s}else await this.markWithheldReplacementsInactive(r),a=r.replacements,r.replacementsToWithhold>0&&(a=a.slice(0,-r.replacementsToWithhold)),e.constructor.includeBlankStringChildren&&!e.constructor.removeBlankStringChildrenPostSugar||(a=a.filter((e=>"string"!=typeof e||/\S/.test(e))));e.compositeReplacementActiveRange||(e.compositeReplacementActiveRange=[]);for(let t of e.compositeReplacementActiveRange)t.lastInd>=n&&(t.lastInd+=a.length-1);e.compositeReplacementActiveRange.push({compositeName:r.componentName,target:await r.stateValues.target,firstInd:n,lastInd:n+a.length-1}),e.activeChildren.splice(n,1,...a),delete e.allChildren[r.componentName].activeChildrenIndex;for(let t=0;t<a.length;t++){let r=a[t];r.componentName&&(e.allChildren[r.componentName]={activeChildrenIndex:n+t,component:r})}let o=e.allChildrenOrdered.indexOf(r.componentName);if(e.allChildrenOrdered.splice(o+1,0,...a.filter((e=>"object"==typeof e)).map((e=>e.componentName?e.componentName:e.placeholderInd))),1!==a.length){let t=a.length-1;for(let r=n+a.length;r<e.activeChildren.length;r++){let n=e.activeChildren[r];n.componentName&&(e.allChildren[n.componentName].activeChildrenIndex+=t)}}n--}}}async markWithheldReplacementsInactive(e){let t=e.replacements.length;await e.stateValues.isInactiveCompositeReplacement?t=0:e.replacementsToWithhold>0&&(t-=e.replacementsToWithhold);for(let n of e.replacements.slice(0,t))await this.changeInactiveComponentAndDescendants(n,!1);for(let n of e.replacements.slice(t))await this.changeInactiveComponentAndDescendants(n,!0);if(!await e.stateValues.isInactiveCompositeReplacement){let t=e.componentName;this.updateInfo.inactiveCompositesToUpdateReplacements.includes(t)&&(this.updateInfo.inactiveCompositesToUpdateReplacements=this.updateInfo.inactiveCompositesToUpdateReplacements.filter((e=>e!=t)),this.updateInfo.compositesToUpdateReplacements.push(t))}}async changeInactiveComponentAndDescendants(e,t){if("object"==typeof e&&await e.stateValues.isInactiveCompositeReplacement!==t){e.state.isInactiveCompositeReplacement.value=t,await this.markUpstreamDependentsStale({component:e,varName:"isInactiveCompositeReplacement"}),this.dependencies.recordActualChangeInUpstreamDependencies({component:e,varName:"isInactiveCompositeReplacement"});for(let n in e.allChildren)await this.changeInactiveComponentAndDescendants(this._components[n],t);for(let n in e.attributes){let r=e.attributes[n].component;r&&await this.changeInactiveComponentAndDescendants(this._components[r.componentName],t)}e.replacements&&await this.markWithheldReplacementsInactive(e)}}findShadowedChildInSerializedComponents({serializedComponents:e,shadowedComponentName:t}){for(let n of e){if(n.originalName===t)return n;if(n.children){let e=this.findShadowedChildInSerializedComponents({serializedComponents:n.children,shadowedComponentName:t});if(e)return e}}}async createStateVariableDefinitions({componentClass:e,prescribedDependencies:t}){let n;if(t)for(let e in t){let r=t[e];for(let t of r)"referenceShadow"===t.dependencyType?n={linkSource:"referenceShadow",targetName:e,compositeName:t.compositeName,propVariable:t.propVariable,arrayStateVariable:t.arrayStateVariable,arrayKey:t.arrayKey,ignorePrimaryStateVariable:t.ignorePrimaryStateVariable,substituteForPrimaryStateVariable:t.substituteForPrimaryStateVariable,firstLevelReplacement:t.firstLevelReplacement,additionalStateVariableShadowing:t.additionalStateVariableShadowing}:"adapter"===t.dependencyType&&(n={linkSource:"adapter",adapterTargetIdentity:t.adapterTargetIdentity,adapterVariable:t.adapterVariable,substituteForPrimaryStateVariable:t.substituteForPrimaryStateVariable,stateVariablesToShadow:t.stateVariablesToShadow})}let r={};n||this.createAttributeStateVariableDefinitions({stateVariableDefinitions:r,componentClass:e});let a=e.returnNormalizedStateVariableDefinitions({attributeNames:Object.keys(r),numerics:this.numerics});return Object.assign(r,a),n&&("adapter"===n.linkSource?this.createAdapterStateVariableDefinitions({redefineDependencies:n,stateVariableDefinitions:r,componentClass:e}):await this.createReferenceShadowStateVariableDefinitions({redefineDependencies:n,stateVariableDefinitions:r,componentClass:e})),r}createAttributeStateVariableDefinitions({componentClass:e,stateVariableDefinitions:t}){let n=e.createAttributesObject({flags:this.flags});for(let r in n){let a=n[r];if(!a.createStateVariable)continue;let i,o=a.createStateVariable,s=t[o]={isAttribute:!0,hasEssential:!0},l=!a.createComponentOfType;if(a.public&&(s.public=!0,s.shadowingInstructions={},l?(s.shadowingInstructions.createComponentOfType=a.createPrimitiveOfType,"string"===s.shadowingInstructions.createComponentOfType&&(s.shadowingInstructions.createComponentOfType="text")):s.shadowingInstructions.createComponentOfType=a.createComponentOfType),!l){let t=this.componentInfoObjects.allComponentClasses[a.createComponentOfType];if(!t)throw Error(`Component type ${a.createComponentOfType} does not exist so cannot create state variable for attribute ${r} of componentType ${e.componentType}.`);i=a.componentStateVariableForAttributeValue,void 0===i&&(i=t.stateVariableForAttributeValue,void 0===i&&(i="value"))}s.returnDependencies=function(){let e={};return a.fallBackToParentStateVariable&&(e.parentValue={dependencyType:"parentStateVariable",variableName:a.fallBackToParentStateVariable}),l?e.attributePrimitive={dependencyType:"attributePrimitive",attributeName:r}:e.attributeComponent={dependencyType:"attributeComponent",attributeName:r,variableNames:[i]},e},s.definition=function({dependencyValues:e,usedDefault:t}){let n;if(e.attributeComponent)n=e.attributeComponent.stateValues[i];else{if(void 0===e.attributePrimitive||null===e.attributePrimitive){return void 0!==e.parentValue&&null!==e.parentValue&&!t.parentValue?{setValue:{[o]:e.parentValue}}:{useEssentialOrDefaultValue:{[o]:!0}}}n=e.attributePrimitive}return n=validateAttributeValue({value:n,attributeSpecification:a,attribute:r}),{setValue:{[o]:n}}},a.noInverse||(s.inverseDefinition=async function({desiredStateVariableValues:e,dependencyValues:t,usedDefault:n}){if(!t.attributeComponent){if(void 0!==t.attributePrimitive&&null!==t.attributePrimitive)return{success:!1};return void 0!==t.parentValue&&null!==t.parentValue&&!n.parentValue?{success:!0,instructions:[{setDependency:"parentValue",desiredValue:e[o]}]}:{success:!0,instructions:[{setEssentialValue:o,value:e[o]}]}}return{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:e[o],variableIndex:0}]}});let u=["forRenderer","defaultValue","propagateToProps","triggerActionOnChange"];for(let e of u)e in a&&(s[e]=a[e])}}createAdapterStateVariableDefinitions({redefineDependencies:e,stateVariableDefinitions:t,componentClass:n}){let r=this._components[e.adapterTargetIdentity.componentName],a=n.createAttributesObject({flags:this.flags});for(let n in a){let i=a[n];if(!i.createStateVariable)continue;let o=i.createStateVariable,s=t[o]={isAttribute:!0,hasEssential:!0},l=!i.createComponentOfType;i.public&&(s.public=!0,s.shadowingInstructions={},l?(s.shadowingInstructions.createComponentOfType=i.createPrimitiveOfType,"string"===s.shadowingInstructions.createComponentOfType&&(s.shadowingInstructions.createComponentOfType="text")):s.shadowingInstructions.createComponentOfType=i.createComponentOfType),o in r.state?s.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:e.adapterTargetIdentity.componentName,variableName:o}}):s.returnDependencies=()=>({}),s.definition=function({dependencyValues:e,usedDefault:t}){return void 0===e.adapterTargetVariable||t.adapterTargetVariable?{useEssentialOrDefaultValue:{[o]:!0}}:{setValue:{[o]:e.adapterTargetVariable}}},i.noInverse||(s.inverseDefinition=async function({desiredStateVariableValues:e,dependencyValues:t}){return void 0===t.adapterTargetVariable?{success:!0,instructions:[{setEssentialValue:o,value:e[o]}]}:{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:e[o]}]}});let u=["forRenderer","defaultValue","propagateToProps"];for(let e of u)e in i&&(s[e]=i[e])}let i="value";e.substituteForPrimaryStateVariable?i=e.substituteForPrimaryStateVariable:n.primaryStateVariableForDefinition&&(i=n.primaryStateVariableForDefinition);let o=t[i];o.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:e.adapterTargetIdentity.componentName,variableName:e.adapterVariable}}),o.set?o.definition=function({dependencyValues:e}){return{setValue:{[i]:o.set(e.adapterTargetVariable)}}}:o.definition=function({dependencyValues:e}){return{setValue:{[i]:e.adapterTargetVariable}}},o.inverseDefinition=function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:e[i]}]}},e.stateVariablesToShadow&&this.modifyStateDefsToBeShadows({stateVariablesToShadow:e.stateVariablesToShadow,stateVariableDefinitions:t,targetComponent:r})}async createReferenceShadowStateVariableDefinitions({redefineDependencies:e,stateVariableDefinitions:t,componentClass:n}){let r=this._components[e.compositeName],a=this._components[e.targetName];e.propVariable&&!a.state[e.propVariable]&&this.checkIfArrayEntry({stateVariable:e.propVariable,component:a})&&await this.createFromArrayEntry({stateVariable:e.propVariable,component:a});let i=n.createAttributesObject({flags:this.flags});for(let o in i){let s=i[o];if(!s.createStateVariable)continue;let l,u=s.createStateVariable,c=t[u]={isAttribute:!0,hasEssential:!0},p=!s.createComponentOfType;if(s.public&&(c.public=!0,c.shadowingInstructions={},p?(c.shadowingInstructions.createComponentOfType=s.createPrimitiveOfType,"string"===c.shadowingInstructions.createComponentOfType&&(c.shadowingInstructions.createComponentOfType="text")):c.shadowingInstructions.createComponentOfType=s.createComponentOfType),!p){let e=this.componentInfoObjects.allComponentClasses[s.createComponentOfType];if(!e)throw Error(`Component type ${s.createComponentOfType} does not exist so cannot create state variable for attribute ${o} of componentType ${n.componentType}.`);l=s.componentStateVariableForAttributeValue,void 0===l&&(l=e.stateVariableForAttributeValue,void 0===l&&(l="value"))}let d={};p?d.attributePrimitive={dependencyType:"attributePrimitive",attributeName:o}:d.attributeComponent={dependencyType:"attributeComponent",attributeName:o,variableNames:[l],fallBackToAttributeFromShadowTarget:!1},e.propVariable&&!s.propagateToProps||!(u in a.state)||(d.targetVariable={dependencyType:"stateVariable",componentName:a.componentName,variableName:u},"targetAttributesToIgnore"in r.state&&e.firstLevelReplacement&&(d.targetAttributesToIgnore={dependencyType:"stateVariable",componentName:r.componentName,variableName:"targetAttributesToIgnore"})),"targetAttributesToIgnoreRecursively"in r.state&&(d.targetAttributesToIgnoreRecursively={dependencyType:"stateVariable",componentName:r.componentName,variableName:"targetAttributesToIgnoreRecursively"}),s.fallBackToParentStateVariable&&(d.parentValue={dependencyType:"parentStateVariable",variableName:s.fallBackToParentStateVariable}),c.returnDependencies=()=>d,c.definition=function({dependencyValues:e,usedDefault:t}){let n;if(e.attributeComponent)n=e.attributeComponent.stateValues[l];else{if(void 0===e.attributePrimitive||null===e.attributePrimitive){let n=[];if(e.targetAttributesToIgnore&&n.push(...e.targetAttributesToIgnore),e.targetAttributesToIgnoreRecursively&&n.push(...e.targetAttributesToIgnoreRecursively),void 0===e.targetVariable||n.includes(o)||t.targetVariable){return void 0!==e.parentValue&&null!==e.parentValue&&!t.parentValue?{setValue:{[u]:e.parentValue}}:{useEssentialOrDefaultValue:{[u]:!0}}}return{setValue:{[u]:e.targetVariable}}}n=e.attributePrimitive}return n=validateAttributeValue({value:n,attributeSpecification:s,attribute:o}),{setValue:{[u]:n}}},s.noInverse||(c.inverseDefinition=async function({desiredStateVariableValues:e,dependencyValues:t,stateValues:n,workspace:r}){if(!t.attributeComponent){if(void 0!==t.attributePrimitive&&null!==t.attributePrimitive)return{success:!1};let n=[];if(t.targetAttributesToIgnore&&n.push(...t.targetAttributesToIgnore),t.targetAttributesToIgnoreRecursively&&n.push(...t.targetAttributesToIgnoreRecursively),void 0===t.targetVariable||n.includes(o)){return void 0!==t.parentValue&&null!==t.parentValue&&!usedDefault.parentValue?{success:!0,instructions:[{setDependency:"parentValue",desiredValue:e[u]}]}:{success:!0,instructions:[{setEssentialValue:u,value:e[u]}]}}return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:e[u]}]}}return{success:!0,instructions:[{setDependency:"attributeComponent",desiredValue:e[u],variableIndex:0}]}});let m=["forRenderer","defaultValue","propagateToProps"];for(let e of m)e in s&&(c[e]=s[e])}if(e.propVariable){if(!e.ignorePrimaryStateVariable){let r="value";e.substituteForPrimaryStateVariable?r=e.substituteForPrimaryStateVariable:n.primaryStateVariableForDefinition&&(r=n.primaryStateVariableForDefinition);let i=t[r];if(!i)throw e.substituteForPrimaryStateVariable?Error(`Invalid public state variable of componentType ${n.componentType}: substituteForPrimaryStateVariable ${e.substituteForPrimaryStateVariable} does not exist`):Error(`Cannot have a public state variable with componentType ${n.componentType} as the class doesn't have a primary state variable for definition`);i.isShadow=!0,i.returnDependencies=()=>({targetVariable:{dependencyType:"stateVariable",componentName:a.componentName,variableName:e.propVariable}});let o=!1;void 0!==a.state[e.propVariable].defaultValue&&(i.defaultValue=a.state[e.propVariable].defaultValue,i.set&&(i.defaultValue=i.set(i.defaultValue)),i.hasEssential=!0,o=!0),i.set?i.definition=function({dependencyValues:e,usedDefault:t}){let n=i.set(e.targetVariable);return o&&t.targetVariable&&deepCompare(n,i.defaultValue)?{useEssentialOrDefaultValue:{[r]:!0},alwaysShadow:[r]}:{setValue:{[r]:n},alwaysShadow:[r]}}:i.definition=function({dependencyValues:e,usedDefault:t}){return o&&t.targetVariable&&deepCompare(e.targetVariable,i.defaultValue)?{useEssentialOrDefaultValue:{[r]:!0},alwaysShadow:[r]}:{setValue:{[r]:e.targetVariable},alwaysShadow:[r]}},i.inverseDefinition=function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:e[r]}]}}}if(e.additionalStateVariableShadowing){let n=[],r=[];for(let t in e.additionalStateVariableShadowing)n.push(t),r.push(e.additionalStateVariableShadowing[t].stateVariableToShadow);this.modifyStateDefsToBeShadows({stateVariablesToShadow:n,stateVariableDefinitions:t,targetComponent:a,differentStateVariablesInTarget:r})}return}let o=!1;if("readyToExpandWhenResolved"in t){o=!0;let e=t.readyToExpandWhenResolved,n=e.returnDependencies.bind(e),r=e.definition;e.returnDependencies=function(e){let t=n(e);return t.targetReadyToExpandWhenResolved={dependencyType:"stateVariable",componentName:a.componentName,variableName:"readyToExpandWhenResolved"},t},e.definition=function(e){let t=r(e);return t.setValue&&t.setValue.readyToExpandWhenResolved&&(e.dependencyValues.targetReadyToExpandWhenResolved||(t.setValue.readyToExpandWhenResolved=!1)),t}}let s=[];for(let e in a.state){let t=a.state[e];(t.shadowVariable||t.isShadow)&&s.push(e)}this.modifyStateDefsToBeShadows({stateVariablesToShadow:s,stateVariableDefinitions:t,foundReadyToExpandWhenResolved:o,targetComponent:a})}modifyStateDefsToBeShadows({stateVariablesToShadow:e,stateVariableDefinitions:t,foundReadyToExpandWhenResolved:n,targetComponent:r,differentStateVariablesInTarget:a=[]}){let i={};for(let[o,s]of e.entries()){let l=t[s];if(void 0===l){if("__array_"!==s.slice(0,8))continue;l=t[s]={}}if(l.isShadow=!0,l.additionalStateVariablesDefined)for(let t of l.additionalStateVariablesDefined)e.includes(t)||(i[t]||(i[t]=[]),i[t].push(s));delete l.additionalStateVariablesDefined,n||delete l.stateVariablesDeterminingDependencies;let u=l.public&&l.shadowingInstructions.hasVariableComponentType;if(l.isArray)l.returnArrayDependenciesByKey=function({arrayKeys:e}){let t={};for(let n of e)t[n]={targetVariable:{dependencyType:"stateVariable",componentName:r.componentName,variableName:this.arrayVarNameFromArrayKey(n)}};let n={};return u&&(n.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:s}),l.inverseShadowToSetEntireArray&&(n.targetArray={dependencyType:"stateVariable",componentName:r.componentName,variableName:s}),{globalDependencies:n,dependenciesByKey:t}},l.arrayDefinitionByKey=function({globalDependencyValues:e,dependencyValuesByKey:t,arrayKeys:n}){let r={};for(let e of n)"targetVariable"in t[e]?r[e]=t[e].targetVariable:r[e]=l.defaultValueByArrayKey?.(e);let a={setValue:{[s]:r},alwaysShadow:[s]};return"targetVariableComponentType"in e&&(a.setCreateComponentOfType={[s]:e.targetVariableComponentType}),a},l.inverseArrayDefinitionByKey=function({desiredStateVariableValues:e,dependencyValuesByKey:t,dependencyNamesByKey:n,arraySize:r,initialChange:a}){if(l.inverseShadowToSetEntireArray)return{success:!0,instructions:[{setDependency:"targetArray",desiredValue:e[s],treatAsInitialChange:a}]};let i=[];for(let r in e[s])t[r]&&i.push({setDependency:n[r].targetVariable,desiredValue:e[s][r],shadowedVariable:!0});return{success:!0,instructions:i}};else{let e=()=>({});n&&(e=l.returnDependencies.bind(l));let t=a[o];t||(t=s),l.returnDependencies=function(n){let a=Object.assign({},e(n));return a.targetVariable={dependencyType:"stateVariable",componentName:r.componentName,variableName:t},u&&(a.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:t}),a},l.definition=function({dependencyValues:e,usedDefault:t}){let n={alwaysShadow:[s]};return"targetVariableComponentType"in e&&(n.setCreateComponentOfType={[s]:e.targetVariableComponentType}),t.targetVariable&&"defaultValue"in l&&l.hasEssential&&deepCompare(e.targetVariable,l.defaultValue)?n.useEssentialOrDefaultValue={[s]:!0}:n.setValue={[s]:e.targetVariable},n},l.excludeDependencyValuesInInverseDefinition=!0,l.inverseDefinition=function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:e[s],shadowedVariable:!0}]}}}}for(let e in i)this.modifyStateDefToDeleteVariableReferences({varNamesToDelete:i[e],stateDef:t[e]})}modifyStateDefToDeleteVariableReferences({varNamesToDelete:e,stateDef:t}){for(let n of e){let e=t.additionalStateVariablesDefined.indexOf(n);t.additionalStateVariablesDefined.splice(e,1)}let n=t.definition;t.definition=function(t){let r=n(t);for(let t in r)if(Array.isArray(r[t]))for(let n of e){let e=r[t].indexOf(n);-1!==e&&r[t].splice(e,1)}else for(let n of e)delete r[t][n];return r}}async initializeComponentStateVariables(e){for(let t in e.state)e.state[t].isAlias?(e.stateVarAliases||(e.stateVarAliases={}),e.stateVarAliases[t]=e.state[t].targetVariableName,delete e.state[t]):await this.initializeStateVariable({component:e,stateVariable:t})}async initializeStateVariable({component:e,stateVariable:t,arrayStateVariable:n,arrayEntryPrefix:r}){let a=this.getStateVariableValue;e.state[t]||(e.state[t]={});let i=e.state[t];if(i.isResolved=!1,Object.defineProperty(i,"value",{get:()=>a({component:e,stateVariable:t}),configurable:!0}),void 0!==r?await this.initializeArrayEntryStateVariable({stateVarObj:i,arrayStateVariable:n,arrayEntryPrefix:r,component:e,stateVariable:t}):i.isArray&&await this.initializeArrayStateVariable({stateVarObj:i,component:e,stateVariable:t}),i.triggerActionOnChange){let n=this.stateVariableChangeTriggers[e.componentName];n||(n=this.stateVariableChangeTriggers[e.componentName]={}),n[t]={action:i.triggerActionOnChange}}}async checkForActionChaining({component:e,stateVariables:t}){if(e){t||(t=Object.keys(e.state));for(let n of t){let t=e.state[n];if(t.chainActionOnActionOfStateVariableTargets){let r,a=t.chainActionOnActionOfStateVariableTargets,i=await t.value,o=this.originsOfActionsChangedToActions[e.componentName];o&&(r=o[n]),r||(r=[]);let s=[];if(Array.isArray(i)){s=[...new Set(i)];for(let t of s){let i=r.indexOf(t);if(-1===i){let r=this.actionsChangedToActions[t];r||(r=this.actionsChangedToActions[t]=[]),r.push({componentName:e.componentName,actionName:a.triggeredAction,stateVariableDefiningChain:n,args:{}})}else r.splice(i,1)}}for(let t of r){let r=this.actionsChangedToActions[t];if(r){let a=[];for(let t of r)t.componentName===e.componentName&&t.stateVariableDefiningChain===n||a.push(t);this.actionsChangedToActions[t]=a}}s.length>0?(o||(o=this.originsOfActionsChangedToActions[e.componentName]={}),o[n]=s):o&&(delete o[n],0===Object.keys(o).length&&delete this.originsOfActionsChangedToActions[e.componentName])}}}}async initializeArrayEntryStateVariable({stateVarObj:e,arrayStateVariable:t,arrayEntryPrefix:n,component:r,stateVariable:a}){e.isArrayEntry=!0,e.arrayStateVariable=t;let i=r.state[t];if(e.definition=i.definition,e.inverseDefinition=i.inverseDefinition,e.markStale=i.markStale,e.freshnessInfo=i.freshnessInfo,e.getPreviousDependencyValuesForMarkStale=i.getPreviousDependencyValuesForMarkStale,e.provideEssentialValuesInDefinition=i.provideEssentialValuesInDefinition,e.providePreviousValuesInDefinition=i.providePreviousValuesInDefinition,e.nDimensions=i.returnEntryDimensions(n),e.entryPrefix=n,e.varEnding=a.slice(n.length),i.createWorkspace&&(e.createWorkspace=!0,e.workspace=i.workspace),i.basedOnArrayKeyStateVariables&&(e.basedOnArrayKeyStateVariables=!0),i.additionalStateVariablesDefined){e.additionalStateVariablesDefined=[];let t=i.entryPrefixes.indexOf(n);for(let n of i.additionalStateVariablesDefined){let a=r.state[n];if(a.isArray){let n=a.entryPrefixes[t]+e.varEnding;e.additionalStateVariablesDefined.push(n)}else e.additionalStateVariablesDefined.push(n)}}if(i.shadowingInstructions&&(e.shadowingInstructions={},e.wrappingComponents=i.shadowingInstructions.returnWrappingComponents(n),i.shadowingInstructions.attributeComponentsToShadow&&(e.shadowingInstructions.attributeComponentsToShadow=i.shadowingInstructions.attributeComponentsToShadow),i.shadowingInstructions.createComponentOfType)){let t=i.entryPrefixes.indexOf(n);i.shadowingInstructions.createComponentOfType[t]&&(e.shadowingInstructions.createComponentOfType=[i.shadowingInstructions.createComponentOfType[t]])}if(i.getEntryValues?e.getValueFromArrayValues=async function(){return await i.getEntryValues({varName:a})}:e.getValueFromArrayValues=async function(){let t=await e.arrayKeys;if(0===t.length)return;let n=[];for(let e of t)n.push(i.getArrayValue({arrayKey:e}));return 1===n.length?n[0]:n},e.arraySizeStateVariable=i.arraySizeStateVariable,e._arrayKeys=[],e._unflattenedArrayKeys=[],Object.defineProperty(e,"arrayKeys",{get:function(){return(async()=>(await i.arraySize,e._arrayKeys))()}}),Object.defineProperty(e,"unflattenedArrayKeys",{get:function(){return(async()=>(await i.arraySize,e._unflattenedArrayKeys))()}}),r.state[e.arraySizeStateVariable].initiallyResolved){let t=await i.arraySize,n=i.getArrayKeysFromVarName({arrayEntryPrefix:e.entryPrefix,varEnding:e.varEnding,arraySize:t,nDimensions:i.nDimensions});e._unflattenedArrayKeys=n,e._arrayKeys=flattenDeep(n);let r=i.varNamesIncludingArrayKeys;for(let t of e._arrayKeys)r[t]||(r[t]=[]),r[t].push(a)}if(i.arrayEntryNames.push(a),Object.defineProperty(e,"arraySize",{get:()=>i.arraySize}),Object.defineProperty(e,"arrayEntrySize",{get:function(){return(async()=>{let t=[],n=[await e.unflattenedArrayKeys];for(let r=0;r<e.nDimensions;r++)n=n[0],t.push(n.length);return t.reverse(),t})()}}),i.stateVariablesDeterminingDependencies){e.stateVariablesDeterminingDependencies||(e.stateVariablesDeterminingDependencies=[]);for(let t of i.stateVariablesDeterminingDependencies)e.stateVariablesDeterminingDependencies.includes(t)||e.stateVariablesDeterminingDependencies.push(t)}let o=i.returnDependencies.bind(i);e.returnDependencies=async function(t){t.arraySize=await e.arraySize,t.arrayKeys=await e.arrayKeys;let n=await o(t),r=Object.keys(i.dependencyNames.namesByKey).length;return e.numberNamesInPreviousReturnDep!==r&&(t.changedDependency=!0),e.numberNamesInPreviousReturnDep=r,n}}async initializeArrayStateVariable({stateVarObj:e,component:t,stateVariable:n}){e.arrayValues=[],void 0===e.nDimensions&&(e.nDimensions=1),e.nDimensions>1?(e.keyToIndex=e=>e.split(",").map((e=>Number(e))),e.setArrayValue=function({value:t,arrayKey:n,arraySize:r,arrayValues:a=e.arrayValues}){let i=e.keyToIndex(n),o=i.length;if(!o>e.nDimensions)return console.warn("Cannot set array value.  Number of dimensions is too large."),{nFailures:1};let s=a,l=r;for(let c of i.slice(0,i.length-1)){if(!(c>=0&&c<l[0]))return console.warn("ignore setting array value out of bounds"),{nFailures:1};s[c]||(s[c]=[]),s=s[c],l=l.slice(1)}let u=0;if(o<e.nDimensions){function p(e,t,n){if(!Array.isArray(e))return console.warn("ignoring array values with insufficient dimensions"),{nFailures:1};let r=0,a=n[0];if(e.length>a&&(console.warn("ignoring array values of out bounds"),r+=e.length-a,e=e.slice(0,a)),1===n.length)for(let[n,r]of e.entries())t[n]=r;else for(let[a,i]of e.entries()){t[a]||(t=[]),r+=p(i,t[a],n[a]).nFailures}return{nFailures:r}}u+=p(t,s,l).nFailures}else s[i[i.length-1]]=t;return{nFailures:u}},e.getArrayValue=function({arrayKey:t,arrayValues:n=e.arrayValues}){let r=e.keyToIndex(t),a=n;for(let e of r.slice(0,r.length-1))if(a=a[e],!a)return;return a[r[r.length-1]]},e.getAllArrayKeys||(e.getAllArrayKeys=function(e,t=!0,n){function r(e){if(1===e.length)return Array.from(Array(e[0]),((e,t)=>String(t)));{let n=e[0],a=r(e.slice(1)),i=[];for(let e=0;e<n;e++)t?i.push(...a.map((t=>e+","+t))):i.push(a.map((t=>e+","+t)));return i}}return n?0===n.length?[]:r(n):e&&0!==e.length?r(e):[]}),e.arrayVarNameFromArrayKey||(e.arrayVarNameFromArrayKey=function(e){return r[0]+e.split(",").map((e=>Number(e)+1)).join("_")}),e.arrayVarNameFromPropIndex||(e.arrayVarNameFromPropIndex=function(t,n){return r[0]+[Number(t),...Array(e.nDimensions-1).fill(1)].join("_")}),e.adjustArrayToNewArraySize=async function(){let t=await e.arraySize;!function e(t,n){if(t.length=n[0],n.length>1){let r=n.slice(1);for(let[n,a]of t.entries())a||(a=t[n]=[]),e(a,r)}}(e.arrayValues,t)}):(e.keyToIndex=e=>Number(e),e.setArrayValue=function({value:t,arrayKey:r,arraySize:a,arrayValues:i=e.arrayValues}){let o=e.keyToIndex(r);return o>=0&&o<a[0]?(i[o]=t,{nFailures:0}):(console.warn(`Ignoring setting array values out of bounds: ${r} of ${n}`),{nFailures:1})},e.getArrayValue=function({arrayKey:t,arrayValues:n=e.arrayValues}){return n[t]},e.getAllArrayKeys||(e.getAllArrayKeys=function(e,t,n){return n?0===n.length?[]:Array.from(Array(n[0]),((e,t)=>String(t))):e&&0!==e.length?Array.from(Array(e[0]),((e,t)=>String(t))):[]}),e.arrayVarNameFromArrayKey||(e.arrayVarNameFromArrayKey=function(e){return r[0]+String(Number(e)+1)}),e.arrayVarNameFromPropIndex||(e.arrayVarNameFromPropIndex=function(e,t){return r[0]+e}),e.adjustArrayToNewArraySize=async function(){let t=await e.arraySize;e.arrayValues.length=t[0]}),e.getArrayKeysFromVarName||(e.getArrayKeysFromVarName=returnDefaultGetArrayKeysFromVarName(e.nDimensions)),e.indexToKey=e=>String(e);let r=e.entryPrefixes;r||(r=e.entryPrefixes=[n]),t.arrayEntryPrefixes||(t.arrayEntryPrefixes={});for(let e of r)t.arrayEntryPrefixes[e]=n;e.returnEntryDimensions||(e.returnEntryDimensions=()=>1),e.shadowingInstructions&&(e.shadowingInstructions.returnWrappingComponents||(e.shadowingInstructions.returnWrappingComponents=e=>[]),e.wrappingComponents=e.shadowingInstructions.returnWrappingComponents()),e.usedDefaultByArrayKey={},e.arrayEntryNames=[],e.varNamesIncludingArrayKeys={};let a=[n];function i(t,n,r){let a={},i={};for(let n of e.dependencyNames.global)a[n]=t[n],i[n]=r[n];let o={},s={},l={};for(let a of n)if(o[a]={},s[a]={},a in e.dependencyNames.namesByKey){l[a]=!0;for(let n in e.dependencyNames.namesByKey[a]){let i=e.dependencyNames.namesByKey[a][n];i in t?(o[a][n]=t[i],s[a][n]=r[i]):l[a]=!1}}return{globalDependencyValues:a,globalUsedDefault:i,dependencyValuesByKey:o,usedDefaultByKey:s,foundAllDependencyValuesForKey:l}}if(e.additionalStateVariablesDefined&&a.push(...e.additionalStateVariablesDefined),e.returnDependencies=async function(n){n.arraySize=await e.arraySize;for(let e in n.stateValues)"__array_"===e.slice(0,8)&&delete n.stateValues[e];if(void 0===n.arrayKeys&&(n.arrayKeys=e.getAllArrayKeys(n.arraySize)),!e.dependencyNames&&(e.dependencyNames={namesByKey:{},keysByName:{},global:[]},e.additionalStateVariablesDefined))for(let n of e.additionalStateVariablesDefined)t.state[n].dependencyNames=e.dependencyNames;let r={};if(e.basedOnArrayKeyStateVariables&&n.arrayKeys.length>1)for(let e of n.arrayKeys)for(let n of a){let a=t.state[n];r[n+"_"+e]={dependencyType:"stateVariable",variableName:a.arrayVarNameFromArrayKey(e)}}else{let t=e.returnArrayDependenciesByKey(n);t.globalDependencies&&(e.dependencyNames.global=Object.keys(t.globalDependencies),Object.assign(r,t.globalDependencies)),t.dependenciesByKey||(t.dependenciesByKey={});for(let a of n.arrayKeys){a in e.dependencyNames.namesByKey||(n.changedDependency=!0),e.dependencyNames.namesByKey[a]={};for(let n in t.dependenciesByKey[a]){let i="__"+a+"_"+n;r[i]=t.dependenciesByKey[a][n],e.dependencyNames.namesByKey[a][n]=i,e.dependencyNames.keysByName[i]||(e.dependencyNames.keysByName[i]=[]),e.dependencyNames.keysByName[i].includes(a)||e.dependencyNames.keysByName[i].push(a)}}e.dependencyNames.global.push("__array_size")}return r.__array_size={dependencyType:"stateVariable",variableName:e.arraySizeStateVariable},r},e.getCurrentFreshness=function({freshnessInfo:t,arrayKeys:r,arraySize:a}){void 0===r&&(r=e.getAllArrayKeys(a));let i=t.freshByKey,o=t.freshArraySize?1:0;for(let e of r)i[e]&&(o+=1);return o>0?o===r.length+1?{fresh:{[n]:!0}}:{partiallyFresh:{[n]:o}}:{fresh:{[n]:!1}}},e.markStale=function({freshnessInfo:t,changes:r,arrayKeys:a,arraySize:i}){let o={};void 0===a&&(a=e.getAllArrayKeys(i)),e.markStaleByKey&&(o=e.markStaleByKey({arrayKeys:a,changes:r}));let s=t.freshByKey;if(r.__array_size)return t.freshArraySize=!1,t.freshByKey={},o.fresh={[n]:!1},o;if(0===Object.keys(s).length)return t.freshByKey={},t.freshArraySize?(o.partiallyFresh={[n]:1},o):(o.fresh={[n]:!1},o);for(let i in r){if(e.dependencyNames.global.includes(i))return t.freshByKey={},t.freshArraySize?(o.partiallyFresh={[n]:1},o):(o.fresh={[n]:!1},o);if(e.basedOnArrayKeyStateVariables&&a.length>1)delete s[i];else for(let t of e.dependencyNames.keysByName[i])delete s[t]}let l=t.freshArraySize?1:0;for(let e of a)s[e]&&(l+=1);return l>0?l===a.length+1?(o.fresh={[n]:!0},o):(o.partiallyFresh={[n]:l},o):(o.fresh={[n]:!1},o)},e.freshenOnNoChanges=function({arrayKeys:t,freshnessInfo:n,arraySize:r}){let a=n.freshByKey;void 0===t&&(t=e.getAllArrayKeys(r));for(let e of t)a[e]=!0},e.definition=function(r){if(void 0===r.arrayKeys&&(r.arrayKeys=e.getAllArrayKeys(r.arraySize)),e.basedOnArrayKeyStateVariables&&r.arrayKeys.length>1)return{};{let a=i(r.dependencyValues,r.arrayKeys,r.usedDefault),o=a.globalDependencyValues,s=a.globalUsedDefault,l=a.dependencyValuesByKey,u=a.usedDefaultByKey,c=a.foundAllDependencyValuesForKey;delete r.dependencyValues,r.globalDependencyValues=o,r.globalUsedDefault=s,r.dependencyValuesByKey=l,r.usedDefaultByKey=u;let p,d=[],m=r.freshnessInfo.freshByKey;for(let e of r.arrayKeys)!m[e]&&c[e]&&(m[e]=!0,d.push(e));if(0===d.length)p={};else{if(r.arrayKeys=d,!e.arrayDefinitionByKey)throw Error(`For ${n} of ${t.componentType}, arrayDefinitionByKey must be a function`);if(p=e.arrayDefinitionByKey(r),p.setValue&&p.setValue[n])for(let e in p.setValue[n])m[e]=!0;if(p.useEssentialOrDefaultValue&&p.useEssentialOrDefaultValue[n])for(let e in p.useEssentialOrDefaultValue[n])m[e]=!0}if(!r.freshnessInfo.freshArraySize){if(r.changes.__array_size&&(p.arraySizeChanged=[n],e.additionalStateVariablesDefined))for(let n of e.additionalStateVariablesDefined)t.state[n].isArray&&p.arraySizeChanged.push(n);r.freshnessInfo.freshArraySize=!0}return p}},e.inverseDefinition=function(t){if(!e.inverseArrayDefinitionByKey)return{success:!1};if(void 0===t.arrayKeys&&(t.arrayKeys=e.getAllArrayKeys(t.arraySize)),e.basedOnArrayKeyStateVariables&&t.arrayKeys.length>1){let e=[];for(let n of a)for(let r in t.desiredStateVariableValues[n]){let a=n+"_"+r;a in t.dependencyValues&&e.push({setDependency:a,desiredValue:t.desiredStateVariableValues[n][r],treatAsInitialChange:t.initialChange})}return{success:!0,instructions:e}}{let n=i(t.dependencyValues,t.arrayKeys,t.usedDefault),r=n.globalDependencyValues,a=n.globalUsedDefault,o=n.dependencyValuesByKey,s=n.usedDefaultByKey;return delete t.dependencyValues,t.globalDependencyValues=r,t.globalUsedDefault=a,t.dependencyValuesByKey=o,t.usedDefaultByKey=s,t.dependencyNamesByKey=e.dependencyNames.namesByKey,e.inverseArrayDefinitionByKey(t)}},await this.createArraySizeStateVariable({stateVarObj:e,component:t,stateVariable:n}),e.arraySizeStale=!0,e.previousArraySize=[],Object.defineProperty(e,"arraySize",{get:function(){return(async()=>t.state[e.arraySizeStateVariable].initiallyResolved?(e.arraySizeStale&&await e.recalculateArraySizeDependentQuantities(),await t.stateValues[e.arraySizeStateVariable]):[])()}}),e.recalculateArraySizeDependentQuantities=async function(){let n=await t.stateValues[e.arraySizeStateVariable];if(e.previousArraySize.length!==n.length||e.previousArraySize.some(((e,t)=>e!=n[t]))){e.previousArraySize=[...n];let r=e.varNamesIncludingArrayKeys={};for(let a of e.arrayEntryNames){let i=t.state[a],o=e.getArrayKeysFromVarName({arrayEntryPrefix:i.entryPrefix,varEnding:i.varEnding,arraySize:n,nDimensions:e.nDimensions});i._unflattenedArrayKeys=o,i._arrayKeys=flattenDeep(o);for(let e of i._arrayKeys)r[e]||(r[e]=[]),r[e].push(a)}}e.arraySizeStale=!1},!e.freshnessInfo&&(e.freshnessInfo={freshByKey:{}},e.additionalStateVariablesDefined))for(let n of e.additionalStateVariablesDefined)t.state[n]||(t.state[n]={}),t.state[n].freshnessInfo=e.freshnessInfo}async createArraySizeStateVariable({stateVarObj:e,component:t,stateVariable:n}){let r=[n];e.additionalStateVariablesDefined&&r.push(...e.additionalStateVariablesDefined),r.sort();let a="__array_size_"+r.join("_");if(e.arraySizeStateVariable=a,e.stateVariablesDeterminingDependencies?(e.stateVariablesDeterminingDependencies,e.stateVariablesDeterminingDependencies.push(a)):e.stateVariablesDeterminingDependencies=[a],t.state[a]){if(t.state[a].isShadow){t.state[a].markStale=function(){for(let e of r)t.state[e].arraySizeStale=!0;return{}}}}else t.state[a]={returnDependencies:e.returnArraySizeDependencies,definition({dependencyValues:t}){let n=e.returnArraySize({dependencyValues:t});for(let[e,t]of n.entries())Number.isInteger(t)&&t>=0||(n[e]=0);return{setValue:{[a]:n}}},markStale(){for(let e of r)t.state[e].arraySizeStale=!0;return{}}},e.stateVariablesDeterminingArraySizeDependencies&&(t.state[a].stateVariablesDeterminingDependencies=e.stateVariablesDeterminingArraySizeDependencies),await this.initializeStateVariable({component:t,stateVariable:a})}async arrayEntryNamesFromPropIndex({stateVariables:e,component:t,propIndex:n}){let r=[];for(let a of e){let e,i=t.state[a];if(!i){if(!this.checkIfArrayEntry({stateVariable:a,component:t})){r.push(a);continue}await this.createFromArrayEntry({stateVariable:a,component:t}),i=t.state[a]}if(i.isArray)e=i.arrayVarNameFromPropIndex(n,a);else if(i.isArrayEntry){e=t.state[i.arrayStateVariable].arrayVarNameFromPropIndex(n,a)}else console.warn(`Cannot get propIndex from ${a} of ${t.componentName} as it is not an array or array entry state variable`),e=a;e?r.push(e):(console.warn(`Cannot get propIndex from ${a} of ${t.componentName}`),r.push(a))}return r}recursivelyReplaceCompositesWithReplacements({replacements:e,recurseNonStandardComposites:t=!1,forceExpandComposites:n=!1,includeWithheldReplacements:r=!1}){let a=[],i=[],o=[],s=[];for(let l of e)if(this.componentInfoObjects.isCompositeComponent({componentType:l.componentType,includeNonStandard:t}))if(a.push(l.componentName),l.isExpanded||(l.state.readyToExpandWhenResolved.isResolved?o.push(l.componentName):s.push(l.componentName)),l.isExpanded){let e=l.replacements;!r&&l.replacementsToWithhold>0&&(e=e.slice(0,-l.replacementsToWithhold));let u=this.recursivelyReplaceCompositesWithReplacements({replacements:e,recurseNonStandardComposites:t,forceExpandComposites:n,includeWithheldReplacements:r});a.push(...u.compositesFound),i.push(...u.newReplacements),o.push(...u.unexpandedCompositesReady),s.push(...u.unexpandedCompositesNotReady)}else i.push(l);else i.push(l);return{compositesFound:a,newReplacements:i,unexpandedCompositesReady:o,unexpandedCompositesNotReady:s}}async getStateVariableValue({component:e,stateVariable:t,justUpdatedForNewComponent:n=!1}){let r=e.state[t];if(!r)throw Error(`Can't get value of ${t} of ${e.componentName} as it doesn't exist.`);let a=r.additionalStateVariablesDefined,i=[t];a&&i.push(...a);for(let n of i)if(!e.state[n].isResolved){if(!(await this.dependencies.resolveItem({componentName:e.componentName,type:"stateVariable",stateVariable:n,force:!0})).success)throw Error(`Can't get value of ${t} of ${e.componentName} as ${n} couldn't be resolved.`)}let o=await this.getStateVariableDefinitionArguments({component:e,stateVariable:t});o.componentInfoObjects=this.componentInfoObjects,o.justUpdatedForNewComponent=n,o.freshnessInfo=r.freshnessInfo;let s,l=o.arraySize;if(0!==Object.keys(o.changes).length||void 0===r._previousValue||r.forceRecalculation)delete r.forceRecalculation,s=r.definition(o);else{let e=[t];a&&e.push(...a),s={noChanges:e},r.freshenOnNoChanges&&r.freshenOnNoChanges(o)}let u={[t]:!1},c={};if(a)for(let e of a)u[e]=!1;for(let n in s.setValue){if(!(n in e.state))throw Error(`Definition of state variable ${t} of ${e.componentName} returned value of ${n}, which isn't a state variable.`);let r;if(n in u)u[n]=!0,e.state[n].isArray?c[n]||(c[n]={arrayKeysChanged:{}}):c[n]=!0;else{if(e.state[n].isArray&&e.state[n].arrayEntryNames)for(let t of e.state[n].arrayEntryNames)if(t in u){r=t,u[t]=!0,c[t]=!0;break}if(!r)throw Error(`Attempting to set value of stateVariable ${n} in definition of ${t} of ${e.componentName}, but it's not listed as an additional state variable defined.`)}if(!(e.state[n].isResolved||r&&e.state[r].isResolved))throw Error(`Attempting to set value of stateVariable ${n} of ${e.componentName} while it is still unresolved!`);if(e.state[n].isArray){c[n]||(c[n]={arrayKeysChanged:{}});let t={};s.checkForActualChange&&s.checkForActualChange[n]&&(t=s.checkForActualChange[n]);for(let r in s.setValue[n])if(t[r]){e.state[n].getArrayValue({arrayKey:r})!==s.setValue[n][r]&&(e.state[n].setArrayValue({value:s.setValue[n][r],arrayKey:r,arraySize:l}),e.state[n].usedDefaultByArrayKey[r]=!1,c[n].arrayKeysChanged[r]=!0)}else e.state[n].setArrayValue({value:s.setValue[n][r],arrayKey:r,arraySize:l}),e.state[n].usedDefaultByArrayKey[r]=!1,c[n].arrayKeysChanged[r]=!0}else if(delete e.state[n].value,e.state[n].value=s.setValue[n],delete e.state[n].usedDefault,s.checkForActualChange?.[n]){let t=e.state[n].value,r=e.state[n]._previousValue;(t===r||Array.isArray(t)&&Array.isArray(r)&&t.length===r.length&&t.every(((e,t)=>e===r[t])))&&delete c[n]}}for(let n in s.useEssentialOrDefaultValue){if(!(n in e.state))throw Error(`Definition of state variable ${t} of ${e.componentName} requested essential or default value of ${n}, which isn't a state variable.`);if(!e.state[n].hasEssential)throw Error(`Definition of state variable ${t} of ${e.componentName} requested essential or default value of ${n}, but hasEssential is not set.`);let r;if(n in u)u[n]=!0,e.state[n].isArray?c[n]||(c[n]={arrayKeysChanged:{}}):c[n]=!0;else{if(e.state[n].isArray&&e.state[n].arrayEntryNames)for(let t of e.state[n].arrayEntryNames)if(t in u){r=t,u[t]=!0,c[t]=!0;break}if(!r)throw Error(`Attempting to set value of stateVariable ${n} in definition of ${t} of ${e.componentName}, but it's not listed as an additional state variable defined.`)}if(!(e.state[n].isResolved||r&&e.state[r].isResolved))throw Error(`Attempting to set value of stateVariable ${n} of ${e.componentName} while it is still unresolved!`);let a=n;e.state[n].essentialVarName&&(a=e.state[n].essentialVarName);let i=e.essentialState[a];if(e.state[n].isArray){c[n]||(c[n]={arrayKeysChanged:{}});let t={};s.checkForActualChange&&s.checkForActualChange[n]&&(t=s.checkForActualChange[n]);for(let r in s.useEssentialOrDefaultValue[n]){let o,u;if(t[r]&&(o=e.state[n].getArrayValue({arrayKey:r})),Array.isArray(i)?u=e.state[n].getArrayValue({arrayKey:r,arrayValues:i}):i=e.essentialState[a]=[],void 0!==u)e.state[n].setArrayValue({value:u,arrayKey:r,arraySize:l});else{let t=s.useEssentialOrDefaultValue[n][r].defaultValue;if(void 0!==t)e.state[n].setArrayValue({value:t,arrayKey:r,arraySize:l}),e.state[n].usedDefaultByArrayKey[r]=!0;else{if(void 0===e.state[n].defaultValueByArrayKey?.(r))throw Error(`Neither value nor default value specified; state variable: ${n}, component: ${e.componentName}, arrayKey: ${r}.`);e.state[n].setArrayValue({value:e.state[n].defaultValueByArrayKey(r),arrayKey:r,arraySize:l}),e.state[n].usedDefaultByArrayKey[r]=!0}}if(t[r]){e.state[n].getArrayValue({arrayKey:r})!==o&&(c[n].arrayKeysChanged[r]=!0)}else c[n].arrayKeysChanged[r]=!0}}else{if(void 0!==i)delete e.state[n].value,e.state[n].value=i;else{let t=s.useEssentialOrDefaultValue[n].defaultValue;if(void 0!==t)delete e.state[n].value,e.state[n].value=t,e.state[n].usedDefault=!0;else{if(void 0===e.state[n].defaultValue)throw Error(`Neither value nor default value specified; state variable: ${n}, component: ${e.componentName}.`);delete e.state[n].value,e.state[n].value=e.state[n].defaultValue,e.state[n].usedDefault=!0}}if(s.checkForActualChange?.[n]){let t=e.state[n].value,r=e.state[n]._previousValue;(t===r||Array.isArray(t)&&Array.isArray(r)&&t.length===r.length&&t.every(((e,t)=>e===r[t])))&&delete c[n]}}}for(let n in s.markAsUsedDefault){if(!e.state[n].isResolved)throw Error(`Marking state variable as used default when it isn't yet resolved: ${n} of ${e.componentName}`);if(!(n in u)){let r;if(e.state[n].isArray&&e.state[n].arrayEntryNames)for(let t of e.state[n].arrayEntryNames)if(t in u){r=t;break}if(!r)throw Error(`Marking state variable  ${n} as used default in definition of ${t} of ${e.componentName}, but it's not listed as an additional state variable defined.`)}if(Array.isArray())for(let t in s.markAsUsedDefault[n])s.markAsUsedDefault[n][t]&&(e.state[n].usedDefaultByArrayKey[t]=!0);else s.markAsUsedDefault[n]&&(e.state[n].usedDefault=!0)}if(s.noChanges)for(let n of s.noChanges){if(!e.state[n].isResolved)throw Error(`Claiming state variable is unchanged when it isn't yet resolved: ${n} of ${e.componentName}`);if(!(n in u)){let r;if(e.state[n].isArray&&e.state[n].arrayEntryNames)for(let t of e.state[n].arrayEntryNames)if(t in u){r=t;break}if(!r)throw Error(`Claiming stateVariable ${n} is unchanged in definition of ${t} of ${e.componentName}, but it's not listed as an additional state variable defined.`)}u[n]=!0,(Object.getOwnPropertyDescriptor(e.state[n],"value").get||e.state[n].immutable)&&(delete e.state[n].value,e.state[n].value=e.state[n]._previousValue)}for(let n in s.setEssentialValue){if(!(n in e.state))throw Error(`Definition of state variable ${t} of ${e.componentName} tried to make ${n} essential, which isn't a state variable.`);if(!(n in u)){let r;if(e.state[n].isArray&&e.state[n].arrayEntryNames)for(let t of e.state[n].arrayEntryNames)if(t in u){r=t;break}if(!r)throw Error(`Attempting to set essential value of stateVariable ${n} in definition of ${t} of ${e.componentName}, but it's not listed as an additional state variable defined.`)}if(!e.state[n].hasEssential)throw Error(`Attempting to set the essential value of stateVariable ${n} in definition of ${t} of ${e.componentName}, but it does not have an essential value`);if(!e.state[n].shadowVariable&&!e.state[n].doNotShadowEssential)throw Error(`Attempting to set the essential value of stateVariable ${n} in definition of ${t} of ${e.componentName}, but it is not allowed unless the state variable is shadowed or the essential state is not shadowed.`);this.essentialValuesSavedInDefinition[e.componentName]||(this.essentialValuesSavedInDefinition[e.componentName]={});let r=n;if(e.state[n].essentialVarName&&(r=e.state[n].essentialVarName),e.state[n].isArray){let t=e.essentialState[r];Array.isArray(t)||(t=e.essentialState[r]=[]),this.essentialValuesSavedInDefinition[e.componentName][n]||(this.essentialValuesSavedInDefinition[e.componentName][n]={mergeObject:!0});for(let r in s.setEssentialValue[n])e.state[n].setArrayValue({value:s.setEssentialValue[n][r],arrayKey:r,arraySize:l,arrayValues:t}),this.essentialValuesSavedInDefinition[e.componentName][n][r]=s.setEssentialValue[n][r]}else e.essentialState[r]=s.setEssentialValue[n],this.essentialValuesSavedInDefinition[e.componentName][n]=s.setEssentialValue[n]}if(s.setCreateComponentOfType)for(let t in s.setCreateComponentOfType){if(!e.state[t].shadowingInstructions?.hasVariableComponentType)throw Error(`Cannot set type of ${t} of ${e.componentName} as it it does not have the hasVariableComponentType attribute.`);let n=!1,r=e.state[t].shadowingInstructions;r||(r=e.state[t].shadowingInstructions={});let a=r.createComponentOfType,i=s.setCreateComponentOfType[t];if(Array.isArray(a)?Array.isArray(i)?(a.length!==i.length||a.some(((e,t)=>e!=i[t])))&&(n=!0):n=!0:n=!!Array.isArray(i)||a!==i,n&&(c[t]=!0),r.createComponentOfType=s.setCreateComponentOfType[t],e.state[t].isArray&&e.state[t].arrayEntryNames){let n=s.setCreateComponentOfType[t],r=Array.isArray(n);for(let a of e.state[t].arrayEntryNames)if(r){let r=await e.state[a].arrayKeys,i=[];for(let a of r){let r=e.state[t].keyToIndex(a);i.push(n[r])}e.state[a].shadowingInstructions.createComponentOfType=i}else e.state[a].shadowingInstructions.createComponentOfType=n}}if(s.arraySizeChanged)for(let t of s.arraySizeChanged)await e.state[t].adjustArrayToNewArraySize(),void 0===c[t]?c[t]={arrayKeysChanged:{}}:!0===c[t]&&(c[t]={allArrayKeysChanged:!0,arrayKeysChanged:{}}),c[t].arraySizeChanged=!0;for(let n in u){if(!(u[n]||e.state[n].isArrayEntry||e.state[n].isArray))throw Error(`definition of ${t} of ${e.componentName} didn't return value of ${n}`);e.state[n].isArray?(delete e.state[n].value,e.state[n].value=e.state[n].arrayValues):e.state[n].isArrayEntry&&(delete e.state[n].value,e.state[n].value=await e.state[n].getValueFromArrayValues())}for(let t in c)if(this.dependencies.recordActualChangeInUpstreamDependencies({component:e,varName:t,changes:c[t]}),e.state[t].isArray){let n=[];if(!0===c[t]||c[t].allArrayKeysChanged||c.arraySizeChanged)e.state[t].arrayEntryNames&&(n=e.state[t].arrayEntryNames);else{let r=e.state[t].varNamesIncludingArrayKeys;for(let e in c[t].arrayKeysChanged){let t=r[e];t&&n.push(...t)}}n=[...new Set(n)];for(let t of n)this.dependencies.recordActualChangeInUpstreamDependencies({component:e,varName:t})}return await r.value}async getStateVariableDefinitionArguments({component:e,stateVariable:t,excludeDependencyValues:n}){let r;r=n?{}:await this.dependencies.getStateVariableDependencyValues({component:e,stateVariable:t}),r.componentName=e.componentName;let a=e.state[t];if(a.isArrayEntry?(r.arrayKeys=await a.arrayKeys,r.arraySize=await a.arraySize):a.isArray&&(r.arraySize=await a.arraySize),a.createWorkspace&&(r.workspace=a.workspace),a.providePreviousValuesInDefinition||a.provideEssentialValuesInDefinition){let n=[t];if(a.additionalStateVariablesDefined&&n.push(...a.additionalStateVariablesDefined),a.providePreviousValuesInDefinition){let t={};for(let r of n)e.state[r].isArrayEntry&&(r=e.state[r].arrayStateVariable),t[r]=e.state[r]._previousValue;r.previousValues=t}if(a.provideEssentialValuesInDefinition){let t={};for(let r of n){e.state[r].isArrayEntry&&(r=e.state[r].arrayStateVariable);let n=r;e.state[r].essentialVarName&&(n=e.state[r].essentialVarName),t[r]=e.essentialState[n]}r.essentialValues=t}}return r}async recordActualChangeInStateVariable({componentName:e,varName:t}){let n=this._components[e];await this.markStateVariableAndUpstreamDependentsStale({component:n,varName:t});let r=[t];n.state[t].additionalStateVariablesDefined&&r.push(...n.state[t].additionalStateVariablesDefined);for(let e of r)n.state[e].forceRecalculation=!0,this.dependencies.recordActualChangeInUpstreamDependencies({component:n,varName:e})}findCaseInsensitiveMatches({stateVariables:e,componentClass:t}){let n=this.componentInfoObjects.stateVariableInfo[t.componentType],r=[];for(let t of e){let e=!1,a=t.toLowerCase();for(let t in n.stateVariableDescriptions)if(a===t.toLowerCase()){e=!0,r.push(t);break}if(e)continue;let i=!1,o=a;"__array_size_"===a.substring(0,13)&&(i=!0,o=a.substring(13));for(let t in n.aliases)if(o===t.toLowerCase()){i&&(t="__array_size_"+t),r.push(t),e=!0;break}if(e)continue;let s=Object.keys(n.arrayEntryPrefixes).sort(((e,t)=>t.length-e.length));for(let i of s)if(a.substring(0,i.length)===i.toLowerCase()){let o=n.arrayEntryPrefixes[i].arrayVariableName,s=n.stateVariableDescriptions[o];if(s.getArrayKeysFromVarName({arrayEntryPrefix:i,varEnding:t.substring(i.length),nDimensions:s.nDimensions}).length>0){let t=i+a.substring(i.length);e=!0,r.push(t);break}}e||r.push(t)}return r}matchPublicStateVariables({stateVariables:e,componentClass:t}){let n=this.componentInfoObjects.publicStateVariableInfo[t.componentType],r=[];for(let t of e){if(t in n.stateVariableDescriptions){r.push(t);continue}let e=t;if(e in n.aliases&&(e=n.aliases[e],e in n.stateVariableDescriptions)){r.push(e);continue}let a=!1,i=Object.keys(n.arrayEntryPrefixes).sort(((e,t)=>t.length-e.length));for(let t of i)if(e.substring(0,t.length)===t){let r=n.arrayEntryPrefixes[t].arrayVariableName,i=n.stateVariableDescriptions[r];if(i.getArrayKeysFromVarName({arrayEntryPrefix:t,varEnding:e.substring(t.length),nDimensions:i.nDimensions}).length>0){a=!0;break}}a?r.push(t):r.push("__not_public_"+t)}return r}substituteAliases({stateVariables:e,componentClass:t}){let n=[],r=this.componentInfoObjects.stateVariableInfo[t.componentType];for(let t of e){let e=!1;"__array_size_"===t.substring(0,13)&&(e=!0,t=t.substring(13)),t=t in r.aliases?r.aliases[t]:t,e&&(t="__array_size_"+t),n.push(t)}return n}publicCaseInsensitiveAliasSubstitutions({stateVariables:e,componentClass:t}){let n=this.findCaseInsensitiveMatches({stateVariables:e,componentClass:t});return n=this.matchPublicStateVariables({stateVariables:n,componentClass:t}),n=this.substituteAliases({stateVariables:n,componentClass:t}),n}checkIfArrayEntry({stateVariable:e,component:t}){for(let n in t.arrayEntryPrefixes)if(e.substring(0,n.length)===n){let r=t.arrayEntryPrefixes[n],a=t.state[r];if(a.getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:e.substring(n.length),nDimensions:a.nDimensions}).length>0)return!0}return!1}async createFromArrayEntry({stateVariable:e,component:t,initializeOnly:n=!1}){if(!t.arrayEntryPrefixes)throw Error(`Unknown state variable ${e} of ${t.componentName}`);let r=Object.keys(t.arrayEntryPrefixes).sort(((e,t)=>t.length-e.length));for(let a of r)if(e.substring(0,a.length)===a){let r=t.arrayEntryPrefixes[a],i=t.state[r];if(i.getArrayKeysFromVarName({arrayEntryPrefix:a,varEnding:e.substring(a.length),nDimensions:i.nDimensions}).length>0){let r=t.arrayEntryPrefixes[a];if(await this.initializeStateVariable({component:t,stateVariable:e,arrayStateVariable:r,arrayEntryPrefix:a}),n)return;let i=[e];if(t.state[e].additionalStateVariablesDefined){i.push(...t.state[e].additionalStateVariablesDefined);for(let n of t.state[e].additionalStateVariablesDefined)t.state[n]||await this.createFromArrayEntry({stateVariable:n,component:t,initializeOnly:!0})}await this.dependencies.setUpStateVariableDependencies({component:t,stateVariable:e,allStateVariablesAffected:i,core:this});let o=[];for(let e of i)this.dependencies.checkForCircularDependency({componentName:t.componentName,varName:e}),o.push(e),t.state[e].determineDependenciesStateVariable&&o.push(t.state[e].determineDependenciesStateVariable);return void await this.dependencies.resolveStateVariablesIfReady({component:t,stateVariables:o})}}throw Error(`Unknown state variable ${e} of ${t.componentName}`)}async markStateVariableAndUpstreamDependentsStale({component:e,varName:t}){t in this.rendererVariablesByComponentType[e.componentType]&&this.updateInfo.componentsToUpdateRenderers.push(e.componentName);let n={[t]:e.state[t]};e.state[t].additionalStateVariablesDefined&&e.state[t].additionalStateVariablesDefined.forEach((t=>n[t]=e.state[t]));let r=await this.lookUpCurrentFreshness({component:e,varName:t,allStateVariablesAffectedObj:n}),a=[],i=[],o=0;for(let e in n){let t=n[e];Object.getOwnPropertyDescriptor(t,"value").get||t.immutable?r&&(r.fresh&&r.fresh[e]?i.push(e):r.partiallyFresh&&r.partiallyFresh[e]&&(o+=r.partiallyFresh[e])):a.push(e)}i.push(...a);let s=i.length>0||o>0,l={};for(let e in n)l[e]=!0;let u=!1;if(s){let r=await this.processMarkStale({component:e,varName:t,allStateVariablesAffectedObj:n});if(r.fresh)for(let e in r.fresh)r.fresh[e]&&delete l[e];let a=0;for(let e in n){if(i.includes(e)&&(!r.fresh||!r.fresh[e])){u=!0;break}r.partiallyFresh&&r.partiallyFresh[e]&&(a+=r.partiallyFresh[e])}if(a<o&&(u=!0),r.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.push(e.componentName),r.updateParentRenderedChildren)for(let t of e.ancestors)if(!this.componentInfoObjects.allComponentClasses._composite.isPrototypeOf(t.componentCase)){t.componentClass.renderChildren&&this.componentsWithChangedChildrenToRender.add(t.componentName);break}if(r.updateRenderedChildren&&this.componentsWithChangedChildrenToRender.add(e.componentName),r.updateActionChaining){let t=this.updateInfo.componentsToUpdateActionChaining[e.componentName];t||(t=this.updateInfo.componentsToUpdateActionChaining[e.componentName]=[]);for(let e in n)t.includes(e)||t.push(e)}if(r.updateDependencies)for(let t of r.updateDependencies)e.state[t].needDependenciesUpdated=!0}for(let t in l){let r=n[t];if(delete r.recursiveDependencyValues,a.includes(t)){r._previousValue=await r.value,delete r.value;let n=this.getStateVariableValue;Object.defineProperty(r,"value",{get:()=>n({component:e,stateVariable:t}),configurable:!0})}}if(u)for(let t in l)await this.markUpstreamDependentsStale({component:e,varName:t})}async lookUpCurrentFreshness({component:e,varName:t,allStateVariablesAffectedObj:n}){let r=e.state[t];if(!r.getCurrentFreshness)return;let a,i,o=r.freshnessInfo;if(r.isArrayEntry&&(a=r._arrayKeys),r.isArrayEntry||r.isArray){let t=e.state[r.arraySizeStateVariable];i=t._previousValue,!(Object.getOwnPropertyDescriptor(t,"value").get||t.immutable)&&(i=await t.value),Array.isArray(i)||(i=[])}let s=r.getCurrentFreshness({freshnessInfo:o,arrayKeys:a,arraySize:i});if(s.partiallyFresh)for(let e in n)if(n[e].isArrayEntry){let t=n[e].arrayStateVariable;s.partiallyFresh[e]=s.partiallyFresh[t],delete s.partiallyFresh[t]}if(s.fresh)for(let e in n)if(n[e].isArrayEntry){let t=n[e].arrayStateVariable;t in s.fresh&&(s.fresh[e]=s.fresh[t],delete s.fresh[t])}return s}async processMarkStale({component:e,varName:t,allStateVariablesAffectedObj:n}){let r=e.state[t];if(!r.markStale||!r.initiallyResolved){let e={};return Object.keys(n).forEach((t=>e[t]=!1)),{fresh:e}}let a={},i=this.dependencies.downstreamDependencies[e.componentName][t];for(let e in i){let t=i[e],n={},r=!1;t.componentIdentityChanged&&(n.componentIdentityChanged=!0,r=!0),t.componentIdentitiesChanged&&(n.componentIdentitiesChanged=!0,r=!0),t.valuesChanged&&(n.valuesChanged=t.valuesChanged,r=!0),r&&(a[e]=n)}let o,s,l=r.freshnessInfo;if(r.isArrayEntry&&(o=r._arrayKeys),r.isArrayEntry||r.isArray){let t=e.state[r.arraySizeStateVariable];s=t._previousValue,!(Object.getOwnPropertyDescriptor(t,"value").get||t.immutable)&&(s=await t.value),Array.isArray(s)||(s=[])}let u=r.markStale({freshnessInfo:l,changes:a,arrayKeys:o,arraySize:s});if(u.partiallyFresh)for(let e in n)if(n[e].isArrayEntry){let t=n[e].arrayStateVariable;u.partiallyFresh[e]=u.partiallyFresh[t],delete u.partiallyFresh[t]}if(u.fresh)for(let e in n)if(n[e].isArrayEntry){let t=n[e].arrayStateVariable;t in u.fresh&&(u.fresh[e]=u.fresh[t],delete u.fresh[t])}return u}async markUpstreamDependentsStale({component:e,varName:t}){let n,r=e.componentName,a=this.getStateVariableValue,i=this.dependencies.upstreamDependencies[r][t];if(e.state[t]&&(n=e.state[t].freshnessInfo),i)for(let o of i){let i=!1;if(o.markStale&&await o.markStale(),o.downstreamComponentNames){let e=o.downstreamComponentNames.indexOf(r);if(-1===e)continue;if(o.mappedDownstreamVariableNamesByComponent){if(-1===o.mappedDownstreamVariableNamesByComponent[e].indexOf(t))throw Error(`something went wrong as ${t} not a downstreamVariable of ${o.dependencyName}`);"determineDependencies"===o.dependencyType&&(o.recalculateDependencies=!0),o.valuesChanged||(o.valuesChanged=[]),o.valuesChanged[e]||(o.valuesChanged[e]={}),o.valuesChanged[e][t]||(o.valuesChanged[e][t]={}),o.valuesChanged[e][t].potentialChange=!0,n&&(o.valuesChanged[e][t].freshnessInfo=n),i=!0}else t===o.downstreamVariableNameIfNoVariables&&(o.valuesChanged||(o.valuesChanged={[o.downstreamVariableNameIfNoVariables]:{}}),o.componentIdentityChanged=!0,o.valuesChanged[o.downstreamVariableNameIfNoVariables].potentialChange=!0,i=!0)}if(i){for(let e of o.upstreamVariableNames)if(e in this.rendererVariablesByComponentType[this.components[o.upstreamComponentName].componentType]){this.updateInfo.componentsToUpdateRenderers.push(o.upstreamComponentName);break}let t=o.upstreamVariableNames[0],n=this._components[o.upstreamComponentName],r={};o.upstreamVariableNames.forEach((e=>r[e]=n.state[e]));let i=await this.lookUpCurrentFreshness({component:n,varName:t,allStateVariablesAffectedObj:r}),s=[],l=[],u=0;for(let e in r){let t=r[e];Object.getOwnPropertyDescriptor(t,"value").get||t.immutable?i&&(i.fresh&&i.fresh[e]?l.push(e):i.partiallyFresh&&i.partiallyFresh[e]&&(u+=i.partiallyFresh[e])):s.push(e)}l.push(...s);let c=l.length>0||u>0,p={};for(let e in r)p[e]=!0;let d=!1;if(c){let a=await this.processMarkStale({component:n,varName:t,allStateVariablesAffectedObj:r});if(a.fresh)for(let e in a.fresh)a.fresh[e]&&delete p[e];let i=0;for(let e in r){if(l.includes(e)&&(!a.fresh||!a.fresh[e])){d=!0;break}a.partiallyFresh&&a.partiallyFresh[e]&&(i+=a.partiallyFresh[e])}if(i<u&&(d=!0),a.updateReplacements&&this.updateInfo.compositesToUpdateReplacements.push(o.upstreamComponentName),a.updateParentRenderedChildren)for(let e of n.ancestors)if(!this.componentInfoObjects.allComponentClasses._composite.isPrototypeOf(e.componentCase)){e.componentClass.renderChildren&&this.componentsWithChangedChildrenToRender.add(e.componentName);break}if(a.updateRenderedChildren&&this.componentsWithChangedChildrenToRender.add(e.componentName),a.updateActionChaining){let e=this.updateInfo.componentsToUpdateActionChaining[o.componentName];e||(e=this.updateInfo.componentsToUpdateActionChaining[o.componentName]=[]);for(let t in r)e.includes(t)||e.push(t)}if(a.updateDependencies)for(let t of a.updateDependencies)e.state[t].needDependenciesUpdated=!0}for(let e in p){let t=r[e];delete t.recursiveDependencyValues,s.includes(e)&&(t._previousValue=await t.value,delete t.value,Object.defineProperty(t,"value",{get:()=>a({component:n,stateVariable:e}),configurable:!0}))}if(d)for(let e in p)await this.markUpstreamDependentsStale({component:n,varName:e})}}}registerComponent(e){if(e.componentName in this._components)throw Error(`Duplicate componentName: ${e.componentName}`);this._components[e.componentName]=e}deregisterComponent(e,t=!0){if(!0===t)for(let t in e.allChildren)this.deregisterComponent(e.allChildren[t].component);delete this._components[e.componentName]}setAncestors(e,t=[]){e.ancestors=t;let n=[{componentName:e.componentName,componentClass:e.constructor},...e.ancestors];for(let t in e.allChildren){let e=this._components[t];this.setAncestors(e,n)}for(let t in e.attributes){let r=e.attributes[t].component;r&&this.setAncestors(r,n)}}async addChildrenAndRecurseToShadows({parent:e,indexOfDefiningChildren:t,newChildren:n,assignNamesOffset:r}){this.spliceChildren(e,t,n);let a=await this.processNewDefiningChildren({parent:e}),i={};if(!a.success)return a;for(let e of n)"object"==typeof e&&(i[e.componentName]=e);if(e.shadowedBy)for(let a of e.shadowedBy){if(a.shadows.propVariable)continue;let e=[];for(let t of n)e.push(await t.serialize());e=postProcessCopy({serializedComponents:e,componentName:a.shadows.compositeName});let o=a.attributes.newNamespace?.primitive,s=o;e=processAssignNames({indOffset:r,serializedComponents:e,parentName:a.componentName,parentCreatesNewNamespace:o,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:s}).serializedComponents;let l,u=this._components[a.componentName];this.parameterStack.push(u.sharedParameters,!1),l=o?a.componentName+"/":getNamespaceFromName(a.componentName);let c=await this.createIsolatedComponentsSub({serializedComponents:e,ancestors:a.ancestors,createNameContext:a.componentName+"|addChildren|"+r,namespaceForUnamed:l});this.parameterStack.pop();let p=await this.addChildrenAndRecurseToShadows({parent:u,indexOfDefiningChildren:t,newChildren:c.components,assignNamesOffset:r});if(!p.success)throw Error("was able to add components to parent but not shadows!");Object.assign(i,p.addedComponents)}return{success:!0,deletedComponents:{},addedComponents:i}}async processNewDefiningChildren({parent:e,expandComposites:t=!0}){this.parameterStack.push(e.sharedParameters,!1);let n=await this.deriveChildResultsFromDefiningChildren({parent:e,expandComposites:t});this.parameterStack.pop();let r=[{componentName:e.componentName,componentClass:e.constructor},...e.ancestors];for(let t in e.allChildren){let e=this._components[t];this.setAncestors(e,r)}return n}spliceChildren(e,t,n){let r=e.definingChildren.length;if(!Number.isInteger(t)||t>r||t<0)throw Error("Can't add children at index "+t+". Invalid index.");e.definingChildren.splice(t,0,...n)}async deleteComponents({components:e,deleteUpstreamDependencies:t=!0,skipProcessingChildrenOfParents:n=[]}){Array.isArray(e)||(e=[e]);const r={};this.determineComponentsToDelete({components:e,deleteUpstreamDependencies:t,componentsToDelete:r});const a={};for(let e in r){let t=r[e],n=this.components[t.parentName];if(void 0===n||n.componentName in r)continue;let i=a[t.parentName];void 0===i&&(i={parent:this._components[t.parentName],childNamesToBeDeleted:new Set},a[t.parentName]=i),i.childNamesToBeDeleted.add(e)}let i=[];for(let e in r){let t=this._components[e];if(t.replacementOf){let n=t.replacementOf,r=n.replacements.map((e=>e.componentName)),a=r.indexOf(e);-1!==a&&(n.replacements.splice(a,1),i.includes(n.componentName)||i.push(n.componentName))}}for(let e of i)e in r||await this.dependencies.addBlockersFromChangedReplacements(this._components[e]);let o=[];for(let e in a){let t=a[e],r=t.parent;o.push(r);for(let e=r.definingChildren.length-1;e>=0;e--){let n=r.definingChildren[e];t.childNamesToBeDeleted.has(n.componentName)&&r.definingChildren.splice(e,1)}n.includes(r.componentName)||await this.processNewDefiningChildren({parent:r,expandComposites:!1})}for(let e in r){let t=this._components[e];if(t.shadows){let e=this._components[t.shadows.componentName];1===e.shadowedBy.length?delete e.shadowedBy:e.shadowedBy.splice(e.shadowedBy.indexOf(t),1)}this.dependencies.deleteAllDownstreamDependencies({component:t});for(let e in this.dependencies.upstreamDependencies[t.componentName]){let n=this.dependencies.upstreamDependencies[t.componentName][e];for(let e of n)if(e.specifiedComponentName&&e.specifiedComponentName in r){let t=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.specifiedComponentName];t||(t=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.specifiedComponentName]=[]),t.includes(e)||t.push(e)}}await this.dependencies.deleteAllUpstreamDependencies({component:t}),this.updateInfo.deletedStateVariables[t.componentName]||(this.updateInfo.deletedStateVariables[t.componentName]=[]),this.updateInfo.deletedStateVariables[t.componentName].push(...Object.keys(t.state)),this.updateInfo.deletedComponents[t.componentName]=!0,delete this.unmatchedChildren[t.componentName],delete this.stateVariableChangeTriggers[t.componentName]}for(let e in r){let t=this._components[e];this.deregisterComponent(t,!1)}return this.updateInfo.componentsToUpdateRenderers=[...new Set(this.updateInfo.componentsToUpdateRenderers)].filter((e=>!(e in r))),this.updateInfo.compositesToUpdateReplacements=[...new Set(this.updateInfo.compositesToUpdateReplacements)].filter((e=>!(e in r))),{success:!0,deletedComponents:r,parentsOfDeleted:o}}determineComponentsToDelete({components:e,deleteUpstreamDependencies:t,componentsToDelete:n}){for(let r of e){if("object"!=typeof r)continue;if(r.componentName in n)continue;n[r.componentName]=this._components[r.componentName];let e=Object.values(r.allChildren).map((e=>e.component));for(let t in r.attributes){let n=r.attributes[t].component;n&&e.push(n)}void 0!==r.adaptedFrom&&e.push(r.adaptedFrom),!0===t&&(r.shadowedBy&&e.push(...r.shadowedBy),r.adapterUsed&&e.push(r.adapterUsed),r.replacements&&e.push(...r.replacements)),this.determineComponentsToDelete({components:e,deleteUpstreamDependencies:t,componentsToDelete:n})}}async updateCompositeReplacements({component:e,componentChanges:t,sourceOfUpdate:n}){let r={},a={},i=new Set;if(e.shadows){return{success:!0,deletedComponents:r,addedComponents:a,parentsOfDeleted:i}}let o=this.components[e.componentName];e.replacements||(e.replacements=[]),await e.stateValues.readyToExpandWhenResolved;const s=await e.constructor.calculateReplacementChanges({component:o,componentChanges:t,components:this.components,workspace:e.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects,flags:this.flags,resolveItem:this.dependencies.resolveItem.bind(this.dependencies),publicCaseInsensitiveAliasSubstitutions:this.publicCaseInsensitiveAliasSubstitutions.bind(this)});e.constructor.stateVariableToEvaluateAfterReplacements&&await e.stateValues[e.constructor.stateVariableToEvaluateAfterReplacements];for(let o of s)if("add"===o.changeType){void 0!==o.replacementsToWithhold&&await this.adjustReplacementsToWithhold({component:e,change:o,componentChanges:t});let s,l=this._components[e.componentName];this.parameterStack.push(l.sharedParameters,!1);let u={[e.componentName]:calculateAllComponentsShadowing(e)},c=o.numberReplacementsToReplace,p=o.firstReplacementInd;if(c>0&&o.changeTopLevelReplacements&&await this.deleteReplacementsFromShadowsThenComposite({change:o,composite:e,componentChanges:t,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a,processNewChildren:!1}),!o.serializedReplacements)throw Error("Invalid replacement change.");{let t,n=o.serializedReplacements;t=e.attributes.newNamespace?.primitive?e.componentName+"/":getNamespaceFromName(e.componentName),s=(await this.createIsolatedComponentsSub({serializedComponents:n,ancestors:e.ancestors,createNameContext:e.componentName+"|replacements",namespaceForUnamed:t,componentsReplacementOf:e})).components}this.parameterStack.pop();let d={[e.componentName]:{newComponents:s,parent:o.parent}};if(l.shadowedBy&&u[l.componentName].length>0){let e=await this.createShadowedReplacements({replacementsToShadow:s,componentToShadow:l,parentToShadow:o.parent,currentShadowedBy:u,assignNamesOffset:o.assignNamesOffset,componentChanges:t,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a});Object.assign(d,e)}for(let e in d){let n=this._components[e];if(!n)continue;let r=d[e].newComponents;if(n.isExpanded){for(let e of r)"object"==typeof e&&(a[e.componentName]=e);if(!0===o.changeTopLevelReplacements){let e=this._components[n.parentName];n.replacements.splice(p,0,...r),await this.dependencies.addBlockersFromChangedReplacements(n);let a={changeType:"addedReplacements",composite:n,newReplacements:r,topLevel:!0,firstIndex:p,numberDeleted:c};t.push(a),await this.processNewDefiningChildren({parent:e,expandComposites:!1});let i=await this.componentAndRenderedDescendants(e);this.updateInfo.componentsToUpdateRenderers.push(...i)}else{let i=this._components[d[e].parent.componentName];this.spliceChildren(i,o.indexOfDefiningChildren,r),await this.processNewDefiningChildren({parent:i});for(let e of r)"object"==typeof e&&(a[e.componentName]=e);let s=await this.componentAndRenderedDescendants(i);this.updateInfo.componentsToUpdateRenderers.push(...s);let l={changeType:"addedReplacements",composite:n,newReplacements:r};t.push(l)}}else{await this.expandCompositeComponent(n);let e={changeType:"addedReplacements",composite:n,newReplacements:n.replacements,topLevel:!0,firstIndex:0,numberDeleted:0};t.push(e)}}}else if("delete"===o.changeType)void 0!==o.replacementsToWithhold&&await this.adjustReplacementsToWithhold({component:e,change:o,componentChanges:t}),await this.deleteReplacementsFromShadowsThenComposite({change:o,composite:e,componentsToDelete:o.components,componentChanges:t,sourceOfUpdate:n,parentsOfDeleted:i,deletedComponents:r,addedComponents:a});else{if("moveDependency"===o.changeType)throw Error("moveDependency not implemented");if("addDependency"===o.changeType)throw Error("addDependency not implemented");if("updateStateVariables"===o.changeType){let e={},t={};for(let n in o.stateChanges){let r={componentName:o.component.componentName,stateVariable:n,value:o.stateChanges[n],overrideFixed:!0};await this.requestComponentChanges({instruction:r,initialChange:!1,workspace:e,newStateVariableValues:t})}await this.processNewStateVariableValues(t)}else"changeReplacementsToWithhold"===o.changeType&&(void 0!==o.replacementsToWithhold&&await this.adjustReplacementsToWithhold({component:e,change:o,componentChanges:t}),await this.processChildChangesAndRecurseToShadows(e))}return{success:!0,deletedComponents:r,addedComponents:a,parentsOfDeleted:i}}async deleteReplacementsFromShadowsThenComposite({change:e,composite:t,componentsToDelete:n,componentChanges:r,sourceOfUpdate:a,parentsOfDeleted:i,deletedComponents:o,addedComponents:s,processNewChildren:l=!0}){let u=[];if(!t.isExpanded)return u;if(t.shadowedBy)for(let c of t.shadowedBy){if(c.shadows.propVariable)continue;let t;if(n){t=[];for(let e of n){let n;if(e.shadowedBy)for(let t of e.shadowedBy)if(!t.shadows.propVariable&&t.shadows.compositeName===c.shadows.compositeName){n=t;break}n?t.push(n):console.error(`could not find shadowing component of ${e.componentName}`)}}let p=await this.deleteReplacementsFromShadowsThenComposite({change:e,composite:c,componentsToDelete:t,componentChanges:r,sourceOfUpdate:a,parentsOfDeleted:i,deletedComponents:o,addedComponents:s,processNewChildren:l});u.push(...p)}if(e.changeTopLevelReplacements){let n=e.firstReplacementInd,s=e.numberReplacementsToDelete;"add"===e.changeType&&(s=e.numberReplacementsToReplace);let u=t.replacements.splice(n,s);await this.dependencies.addBlockersFromChangedReplacements(t);let c=await this.deleteComponents({components:u,componentChanges:r,sourceOfUpdate:a,skipProcessingChildrenOfParents:[t.parentName]});if(l&&await this.processNewDefiningChildren({parent:this._components[t.parentName],expandComposites:!1}),!1===c.success)throw Error("Couldn't delete components on composite update");for(let e of c.parentsOfDeleted){i.add(e.componentName);let t=await this.componentAndRenderedDescendants(e);this.updateInfo.componentsToUpdateRenderers.push(...t)}let p={};for(let e in c.deletedComponents){let t=c.deletedComponents[e].parentName;void 0===p[t]&&(p[t]=[]),p[t].push(e)}let d={changeType:"deletedReplacements",composite:t,topLevel:!0,firstIndex:n,numberDeleted:s,deletedNamesByParent:p,deletedComponents:c.deletedComponents};r.push(d),Object.assign(o,c.deletedComponents);let m=this._components[t.parentName],f=await this.componentAndRenderedDescendants(m);this.updateInfo.componentsToUpdateRenderers.push(...f)}else{let e=n.length,l=await this.deleteComponents({components:n,deleteUpstreamDependencies:!1,componentChanges:r,sourceOfUpdate:a});if(!1===l.success)throw Error("Couldn't delete components prescribed by composite");for(let e of l.parentsOfDeleted){i.add(e.componentName);let t=await this.componentAndRenderedDescendants(e);this.updateInfo.componentsToUpdateRenderers.push(...t)}let u={};for(let e in l.deletedComponents){let t=l.deletedComponents[e].parentName;void 0===u[t]&&(u[t]=[]),u[t].push(e)}let c={changeType:"deletedReplacements",composite:t,numberDeleted:e,deletedNamesByParent:u,deletedComponents:l.deletedComponents};r.push(c),Object.assign(o,l.deletedComponents),Object.assign(s,l.addedComponents)}return u}async processChildChangesAndRecurseToShadows(e){let t=this._components[e.parentName];await this.processNewDefiningChildren({parent:t,expandComposites:!1});let n=await this.componentAndRenderedDescendants(t);if(this.updateInfo.componentsToUpdateRenderers.push(...n),e.shadowedBy)for(let t of e.shadowedBy)t.shadows.propVariable||await this.processChildChangesAndRecurseToShadows(t)}async createShadowedReplacements({replacementsToShadow:e,componentToShadow:t,parentToShadow:n,currentShadowedBy:r,assignNamesOffset:a,componentChanges:i,sourceOfUpdate:o,parentsOfDeleted:s,deletedComponents:l,addedComponents:u}){let c=calculateAllComponentsShadowing(t);if(!r[t.componentName]||!c.every((e=>r[t.componentName].includes(e))))throw Error(`circular reference involving ${t.componentName}`);this.updateInfo.compositesBeingExpanded.push(t.componentName);let p={};for(let c of t.shadowedBy)if(!c.shadows.propVariable){if(this.updateInfo.compositesBeingExpanded.includes(c.componentName))throw Error(`circular dependence involving ${c.componentName}`);if(c.shadowedBy&&(r[c.componentName]=calculateAllComponentsShadowing(c)),c.isExpanded){let t=[];for(let n of e)"object"==typeof n?t.push(await n.serialize()):t.push(n);t=postProcessCopy({serializedComponents:t,componentName:c.shadows.compositeName});let d,m=c.attributes.newNamespace?.primitive;if(c.attributes.isResponse){let e=c.constructor.createAttributesObject({flags:this.flags});for(let n of t){if("object"!=typeof n)continue;n.attributes||(n.attributes={});let t=convertAttributesForComponentType({attributes:{isResponse:c.attributes.isResponse},componentType:n.componentType,componentInfoObjects:this.componentInfoObjects,compositeAttributesObj:e,compositeCreatesNewNamespace:m});Object.assign(n.attributes,t)}}if(c.constructor.assignNamesToReplacements){let e=c.shadows.compositeName,n=this.components[e],r=n.attributes.newNamespace?.primitive,i=n.doenetAttributes.assignNames,o=m||r&&!i,s=c.doenetAttributes.assignNames;s&&await c.stateValues.addLevelToAssignNames&&(s=s.map((e=>[e]))),t=processAssignNames({assignNames:s,indOffset:a,serializedComponents:t,parentName:c.componentName,parentCreatesNewNamespace:m,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:o}).serializedComponents}else{let e=m;t=processAssignNames({indOffset:a,serializedComponents:t,parentName:c.componentName,parentCreatesNewNamespace:m,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:e}).serializedComponents}let f,h=this._components[c.componentName];this.parameterStack.push(h.sharedParameters,!1),f=m?c.componentName+"/":getNamespaceFromName(c.componentName);let y,b=await this.createIsolatedComponentsSub({serializedComponents:t,ancestors:c.ancestors,createNameContext:c.componentName+"|replacements",namespaceForUnamed:f,componentsReplacementOf:c});if(this.parameterStack.pop(),d=b.components,n){if(n.shadowedBy)for(let e of n.shadowedBy)if(!e.shadows.propVariable&&e.shadows.compositeName===c.shadows.compositeName){y=e;break}y||console.error(`could not find shadowing parent of ${n.componentName}`)}if(p[c.componentName]={newComponents:d,parent:y},c.shadowedBy&&r[c.componentName].length>0){let e=await this.createShadowedReplacements({replacementsToShadow:d,componentToShadow:c,parentToShadow:y,currentShadowedBy:r,assignNamesOffset:a,componentChanges:i,sourceOfUpdate:o,parentsOfDeleted:s,deletedComponents:l,addedComponents:u});Object.assign(p,e)}}}let d=this.updateInfo.compositesBeingExpanded.indexOf(t.componentName);if(-1===d)throw Error(`Something is wrong as we lost track that we were expanding ${component.componentName}`);return this.updateInfo.compositesBeingExpanded.splice(d,1),p}async adjustReplacementsToWithhold({component:e,change:t,componentChanges:n}){let r,a=[],i=t.replacementsToWithhold;if(r=void 0!==e.replacementsToWithhold?i-e.replacementsToWithhold:i,r<0){a.push(e.componentName);let t=e.replacements.length-i,o=e.replacements.length-i+r,s=e.replacements.slice(o,t),l={changeType:"addedReplacements",composite:e,topLevel:!0,newReplacements:s,firstIndex:o,numberDeleted:0};n.push(l)}else if(r>0){a.push(e.componentName);let t=e.replacements.length-i,o=t+r,s=e.replacements.slice(t,o),l={};for(let e of s){let t=e.parentName;void 0===l[t]&&(l[t]=[]),l[t].push(e.componentName)}let u={changeType:"deletedReplacements",composite:e,topLevel:!0,firstIndex:t,numberDeleted:r,deletedNamesByParent:l,deletedComponents:s};n.push(u)}if(e.replacementsToWithhold=i,await this.dependencies.addBlockersFromChangedReplacements(e),e.shadowedBy)for(let r of e.shadowedBy){if(r.shadows.propVariable)continue;let e=await this.adjustReplacementsToWithhold({component:r,change:t,componentChanges:n});a.push(...e)}return a}get rendererTypesInDocument(){return this.document.allPotentialRendererTypes}get components(){return this._components}set components(e){return null}async executeProcesses(){for(;this.processQueue.length>0;){let e,t=this.processQueue.splice(0,1)[0];if("update"===t.type)(!t.skippable||this.processQueue.length<2)&&(e=await this.performUpdate(t));else if("action"===t.type)(!t.skippable||this.processQueue.length<2)&&(e=await this.performAction(t));else{if("recordEvent"!==t.type)throw Error(`Unrecognized process type: ${t.type}`);e=await this.performRecordEvent(t)}t.resolve(e)}this.processing=!1}requestAction({componentName:e,actionName:t,args:n,event:r}){return new Promise(((a,i)=>{let o=n?.skippable;this.processQueue.push({type:"action",componentName:e,actionName:t,args:n,skippable:o,event:r,resolve:a,reject:i}),this.processing||(this.processing=!0,this.executeProcesses())}))}async performAction({componentName:e,actionName:t,args:n,event:r}){let a=this.components[e];if(a&&a.actions){let e=a.actions[t];if(e)return r&&this.requestRecordEvent(r),n||(n={}),await e(n)}console.warn(`Cannot run action ${t} on component ${e}`)}resolveAction({actionId:e}){e&&postMessage({messageType:"resolveAction",args:{actionId:e}})}async triggerChainedActions({componentName:e}){for(let e in this.updateInfo.componentsToUpdateActionChaining)await this.checkForActionChaining({component:this.components[e],stateVariables:this.updateInfo.componentsToUpdateActionChaining[e]});if(this.updateInfo.componentsToUpdateActionChaining={},this.actionsChangedToActions[e])for(let t of this.actionsChangedToActions[e])await this.performAction(t)}async requestUpdate({updateInstructions:e,transient:t=!1,event:n,skippable:r=!1,overrideReadOnly:a=!1}){if(!this.flags.readOnly||a)return new Promise(((a,i)=>{this.processQueue.push({type:"update",updateInstructions:e,transient:t,event:n,skippable:r,resolve:a,reject:i}),this.processing||(this.processing=!0,this.executeProcesses())}));{let t={};for(let n of e){let e=t[n.componentName];e||(e=t[n.componentName]={}),n.sourceInformation&&Object.assign(e,n.sourceInformation)}await this.updateRendererInstructions({componentNamesToUpdate:e.map((e=>e.componentName)),sourceOfUpdate:{sourceInformation:t}})}}async performUpdate({updateInstructions:e,actionId:t,event:n,overrideReadOnly:r=!1}){if(this.flags.readOnly&&!r){let n={};for(let t of e){let e=n[t.componentName];e||(e=n[t.componentName]={}),t.sourceInformation&&Object.assign(e,t.sourceInformation)}return void await this.updateRendererInstructions({componentNamesToUpdate:e.map((e=>e.componentName)),sourceOfUpdate:{sourceInformation:n},actionId:t})}let a={},i=[],o={},s={},l=[];for(let t of e){if(t.componentName){let e=o[t.componentName];e||(e=o[t.componentName]={}),t.sourceInformation&&Object.assign(e,t.sourceInformation)}if("updateValue"===t.updateType)await this.requestComponentChanges({instruction:t,workspace:s,newStateVariableValues:a});else if("addComponents"===t.updateType)await this.addComponents({serializedComponents:t.serializedComponents,parentName:t.parentName,assignNamesOffset:t.assignNamesOffset});else if("deleteComponents"===t.updateType){if(t.componentNames.length>0){let e=[];for(let n of t.componentNames){let t=this._components[n];t?e.push(t):console.warn(`Cannot delete ${n} as it doesn't exist.`)}e.length>0&&await this.deleteComponents({components:e})}}else"executeUpdate"===t.updateType?(await this.executeUpdateStateVariables(a),i.push(a),a={}):"recordItemSubmission"===t.updateType&&l.push(t)}await this.executeUpdateStateVariables(a),i.push(a),this.updateInfo.componentsToUpdateRenderers.push(...e.map((e=>e.componentName)));let u=[...new Set(this.updateInfo.componentsToUpdateRenderers)];if(this.updateInfo.componentsToUpdateRenderers=[],await this.updateRendererInstructions({componentNamesToUpdate:u,sourceOfUpdate:{sourceInformation:o,local:!0},actionId:t}),this.updateInfo.compositesToUpdateReplacements.length>0){await this.replacementChangesFromCompositesToUpdate();let e=[...new Set(this.updateInfo.componentsToUpdateRenderers)];this.updateInfo.componentsToUpdateRenderers=[],await this.updateRendererInstructions({componentNamesToUpdate:e,sourceOfUpdate:{sourceInformation:o,local:!0},actionId:t})}if(await this.processStateVariableTriggers(),this.updateInfo.componentsToUpdateRenderers=this.updateInfo.componentsToUpdateRenderers.filter((e=>!u.includes(e))),Object.keys(this.unmatchedChildren).length>0){let e="";for(let t in this.unmatchedChildren)this._components[t].isShadow||(e+=`Invalid children for ${t}: ${this.unmatchedChildren[t].message} `);e&&console.warn(e)}if(l.length>0){let e=[...new Set(l.map((e=>e.itemNumber)))];n&&(n.context||(n.context={}),n.context.subitemCreditAchieved||(n.context.subitemCreditAchieved={}),n.context.itemCreditAchieved=await this.document.stateValues.creditAchieved);let t=await this.document.stateValues.creditAchieved,r=await this.document.stateValues.itemCreditAchieved,a=[];for(let e of l)a.push({componentName:e.submittedComponent,response:e.response,responseText:e.responseText,creditAchieved:e.creditAchieved,subitemNumber:e.itemNumber});if(n)for(let t of e)n.context.subitemCreditAchieved[t]=r[t-1];this.itemNumber>0&&this.saveSubmissions({itemCreditAchieved:t,componentsSubmitted:a})}if(Object.keys(this.essentialValuesSavedInDefinition).length>0){for(let e in this.essentialValuesSavedInDefinition){let t=this._components[e]?.essentialState;if(t){this.cumulativeStateVariableChanges[e]||(this.cumulativeStateVariableChanges[e]={});for(let n in this.essentialValuesSavedInDefinition[e])if(void 0!==t[n]){let r=this.cumulativeStateVariableChanges[e][n];"object"==typeof r&&null!==r&&r.mergeObject?Object.assign(r,removeFunctionsMathExpressionClass(t[n])):this.cumulativeStateVariableChanges[e][n]=removeFunctionsMathExpressionClass(t[n])}}}this.essentialValuesSavedInDefinition={}}for(let e of i)for(let t in e){this.cumulativeStateVariableChanges[t]||(this.cumulativeStateVariableChanges[t]={});for(let n in e[t]){let r=this.cumulativeStateVariableChanges[t][n];"object"==typeof r&&null!==r&&r.mergeObject?Object.assign(r,removeFunctionsMathExpressionClass(e[t][n])):this.cumulativeStateVariableChanges[t][n]=removeFunctionsMathExpressionClass(e[t][n])}}clearTimeout(this.savePageStateTimeoutID),this.savePageStateTimeoutID=setTimeout((()=>{this.saveState()}),1e3),await this.document.stateValues.itemCreditAchieved,n&&this.requestRecordEvent(n)}requestRecordEvent(e){return new Promise(((t,n)=>{this.processQueue.push({type:"recordEvent",event:e,resolve:t,reject:n}),this.processing||(this.processing=!0,this.executeProcesses())}))}performRecordEvent({event:e}){if(!this.flags.allowSaveEvents)return;e.timestamp=(new Date).toISOString().slice(0,19).replace("T"," "),e.result||(e.result={}),e.context||(e.context={});const t={doenetId:this.doenetId,activityCid:this.activityCid,pageCid:this.cid,pageNumber:this.pageNumber,attemptNumber:this.attemptNumber,variantIndex:this.requestedVariant.index,verb:e.verb,object:JSON.stringify(e.object,serializedComponentsReplacer),result:JSON.stringify(removeFunctionsMathExpressionClass(e.result),serializedComponentsReplacer),context:JSON.stringify(e.context,serializedComponentsReplacer),timestamp:e.timestamp,version:"0.1.0"};return axios.post("/api/recordEvent.php",t).then((e=>{})).catch((e=>{console.error(`Error saving event: ${e.message}`)})),Promise.resolve()}async executeUpdateStateVariables(e){await this.processNewStateVariableValues(e),(await this.replacementChangesFromCompositesToUpdate()).updatedComposites&&(await this.expandAllComposites(this.document),await this.expandAllComposites(this.document,!0)),await this.replacementChangesFromCompositesToUpdate()}async replacementChangesFromCompositesToUpdate(){let e=[...new Set(this.updateInfo.compositesToUpdateReplacements)];this.updateInfo.compositesToUpdateReplacements=[];let t=[],n=0,r=!1,a=[];for(;e.length>0;){for(let n of e){let e=this._components[n];if(e instanceof this.componentInfoObjects.allComponentClasses._composite&&e.isExpanded)if(e.state.readyToExpandWhenResolved.initiallyResolved)if(await e.stateValues.isInactiveCompositeReplacement)this.updateInfo.inactiveCompositesToUpdateReplacements.push(n);else{let t=await this.updateCompositeReplacements({component:e,componentChanges:a});Object.keys(t.addedComponents).length>0&&(r=!0),Object.keys(t.deletedComponents).length>0&&(r=!0)}else t.push(n)}if(e=[...new Set(this.updateInfo.compositesToUpdateReplacements)],this.updateInfo.compositesToUpdateReplacements=[],n++,n>100)throw Error("Seem to have an infinite loop while calculating replacement changes")}return this.updateInfo.compositesToUpdateReplacements=t,{updatedComposites:r}}async processNewStateVariableValues(e){let t=0,n=!1;for(let r in e){let a=this._components[r];if(void 0===a){let t=this.updateInfo.stateVariableUpdatesForMissingComponents[r];void 0===t&&(t=this.updateInfo.stateVariableUpdatesForMissingComponents[r]={}),Object.assign(t,e[r]);continue}let i=e[r];for(let e in i){let o=a.state[e];if(void 0===o){let t=e.match(/^__def_primitive_(\d+)$/);if(t){let n=Number(t[1]);a.definingChildren[n]=i[e],await this.processNewDefiningChildren({parent:a,expandComposites:!1});continue}if(t=e.match(/^__def_primitive_ignore_(\d+)$/),t){let r=Number(t[1]);a.definingChildren[r]=i[e],n=!0;continue}console.warn(`can't update state variable ${e} of component ${r}, as it doesn't exist.`);continue}if(!o.hasEssential){console.warn(`can't update state variable ${e} of component ${r}, as it does not have an essential state variable.`);continue}let s=e;if(a.state[e].essentialVarName&&(s=a.state[e].essentialVarName),e in this.rendererVariablesByComponentType[a.componentType]&&this.updateInfo.componentsToUpdateRenderers.push(a.componentName),o.isArray){let n=a.essentialState[s];Array.isArray(n)||(n=a.essentialState[s]=[]);let l=[];a.state[o.arraySizeStateVariable].initiallyResolved||await a.state[o.arraySizeStateVariable].value;let u=await o.arraySize;for(let r in i[e]){if("mergeObject"===r)continue;let a=e=>e;o.set&&(a=o.set);let s=o.setArrayValue({value:a(i[e][r]),arrayKey:r,arraySize:u,arrayValues:n});o.usedDefaultByArrayKey[r]=!1,t+=s.nFailures;let c=o.varNamesIncludingArrayKeys[r];c&&l.push(...c)}for(let e of l)await this.recordActualChangeInStateVariable({componentName:r,varName:e})}else{if(!o.hasEssential){console.warn(`can't update state variable ${e} of component ${r}, as it does not have an essential state variable.`);continue}o.set?a.essentialState[s]=o.set(i[e]):a.essentialState[s]=i[e],delete o.usedDefault}await this.recordActualChangeInStateVariable({componentName:r,varName:e})}}return{nFailures:t,foundIgnore:n}}async requestComponentChanges({instruction:e,initialChange:t=!0,workspace:n,newStateVariableValues:r}){let a=this._components[e.componentName],i=this.substituteAliases({stateVariables:[e.stateVariable],componentClass:a.constructor})[0];void 0===n[e.componentName]&&(n[e.componentName]={});let o=n[e.componentName],s=a.state[i],l=s.additionalStateVariablesDefined,u=[i];l&&u.push(...l);for(let e of u)if(!a.state[e].isResolved){if(!(await this.dependencies.resolveItem({componentName:a.componentName,type:"stateVariable",stateVariable:e,force:!0})).success)throw Error(`Can't get value of ${i} of ${a.componentName} as ${e} couldn't be resolved.`)}let c=await this.getStateVariableDefinitionArguments({component:a,stateVariable:i,excludeDependencyValues:s.excludeDependencyValuesInInverseDefinition});c.componentInfoObjects=this.componentInfoObjects,c.initialChange=t,c.stateValues=a.stateValues,c.overrideFixed=e.overrideFixed,c.shadowedVariable=e.shadowedVariable,c.sourceInformation=e.sourceInformation;let p=i;if(s.isArrayEntry){let t=s.arrayStateVariable;p=t;let n={};if(1===c.arrayKeys.length){if("value"in e)n[c.arrayKeys[0]]=e.value;else if("valueOfStateVariable"in e){let t=this.substituteAliases({stateVariables:[e.valueOfStateVariable],componentClass:a.constructor})[0],r=a.state[t];if(!r)throw Error(`Invalid instruction to change ${e.stateVariable} of ${e.componentName}, value of state variable ${e.valueOfStateVariable} not found.`);n[c.arrayKeys[0]]=await r.value}}else for(let[t,r]of c.arrayKeys.entries())n[r]=e.value[t];c.desiredStateVariableValues={[t]:n}}else if("value"in e)c.desiredStateVariableValues={[i]:e.value};else if("valueOfStateVariable"in e){let t=this.substituteAliases({stateVariables:[e.valueOfStateVariable],componentClass:a.constructor})[0],n=a.state[t];if(!n)throw Error(`Invalid instruction to change ${e.stateVariable} of ${e.componentName}, value of state variable ${e.valueOfStateVariable} not found.`);c.desiredStateVariableValues={[i]:await n.value}}let d=o[p];if(void 0===d&&(d=o[p]={}),s.additionalStateVariablesDefined)for(let e of s.additionalStateVariablesDefined){let t=e;a.state[e].isArray&&(t=s.arrayStateVariable);let n=o[t];n&&(Object.assign(d,n),o[t]=d)}if(c.workspace=d,e.additionalStateVariableValues)for(let t in e.additionalStateVariableValues)s.additionalStateVariablesDefined.includes(t)?c.desiredStateVariableValues[t]=e.additionalStateVariableValues[t]:console.warn(`Can't invert ${t} at the same time as ${i}, as not an additional state variable defined`);if(!s.inverseDefinition)return void console.warn(`Cannot change state variable ${i} of ${a.componentName} as it doesn't have an inverse definition`);if(await a.stateValues.fixed&&!e.overrideFixed)return void console.log(`Changing ${i} of ${a.componentName} did not succeed because fixed is true.`);if(!t&&!1===await a.stateValues.modifyIndirectly)return void console.log(`Changing ${i} of ${a.componentName} did not succeed because modifyIndirectly is false.`);let m=await s.inverseDefinition(c);if(!m.success)return;let f,h=[];for(let e of m.instructions){let t=!1;if(e.setDependency){let n=e.setDependency,r=this.dependencies.downstreamDependencies[a.componentName][i][n];if(["stateVariable","parentStateVariable"].includes(r.dependencyType)&&1===r.downstreamComponentNames.length){let n=r.downstreamComponentNames[0],a=r.mappedDownstreamVariableNamesByComponent[0][0],i=this._components[n].state[a];if((i.isArrayEntry||i.isArray)&&!i.doNotCombineInverseArrayInstructions){let r=i.isArrayEntry?i.arrayStateVariable:a;if(!f||f.componentName===n&&f.stateVariable===r&&f.shadowedVariable===e.shadowedVariable&&f.treatAsInitialChange===e.treatAsInitialChange||(h.push(f),f=void 0),!e.additionalDependencyValues&&!i.basedOnArrayKeyStateVariables)if(t=!0,f||(f={combinedArray:!0,componentName:n,stateVariable:r,shadowedVariable:e.shadowedVariable,treatAsInitialChange:e.treatAsInitialChange,desiredValue:{}}),i.isArrayEntry){let t=await i.arrayKeys;if(1===t.length)f.desiredValue[t[0]]=e.desiredValue;else for(let[n,r]of t.entries())f.desiredValue[r]=e.desiredValue[n]}else Object.assign(f.desiredValue,e.desiredValue)}}}t||(f&&(h.push(f),f=void 0),h.push(e))}f&&(h.push(f),f=void 0);for(let t of h)if(t.setEssentialValue){if(!u.includes(t.setEssentialValue)){let e=!1;if(s.isArrayEntry){let n=[s.arrayStateVariable];if(s.additionalStateVariablesDefined)for(let e of s.additionalStateVariablesDefined){let t=a.state[e];t.isArrayEntry&&n.push(t.arrayStateVariable)}e=n.includes(t.setEssentialValue)}if(!e)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: specified changing value of ${t.setEssentialValue}, which is not a state variable defined with ${i}.`)}if(!a.state[t.setEssentialValue].hasEssential)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: can't set essential value of ${t.setEssentialValue} if it is does not have an essential value.`);if(!("value"in t))throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: setEssentialValue must specify a value`);let e=t.value;if(e instanceof me$3.class){e=(await preprocessMathInverseDefinition({desiredValue:e,stateValues:a.stateValues,variableName:t.setEssentialValue,workspace:d})).desiredValue}if(a.state[t.setEssentialValue].doNotShadowEssential||a.state[t.setEssentialValue].shadowVariable)this.calculateEssentialVariableChanges({component:a,varName:t.setEssentialValue,value:e,newStateVariableValues:r,recurseToShadows:!1});else{let n=a;for(;n.shadows&&void 0===n.shadows.propVariable;)n=this._components[n.shadows.componentName];this.calculateEssentialVariableChanges({component:n,varName:t.setEssentialValue,value:e,newStateVariableValues:r})}}else if(t.setDependency){let o=t.setDependency,s=this.dependencies.downstreamDependencies[a.componentName][i][o];if("child"===s.dependencyType){let l=t.childIndex;if(null!==s.downstreamPrimitives[l]){if(typeof t.desiredValue==typeof s.downstreamPrimitives[l]){let e=this._components[s.parentName],n=s.activeChildrenIndices[l];if(e.compositeReplacementActiveRange)for(let r of e.compositeReplacementActiveRange)if(r.firstInd<=n&&r.lastInd>=n)throw console.log(`parent: ${e.componentName}, activeChildInd: ${n}`),console.log(e.compositeReplacementActiveRange),console.log(t),Error("Need to implement changing primitive replacements from composite");let a=n;if(e.compositeReplacementActiveRange)for(let t of e.compositeReplacementActiveRange)t.lastInd<a&&(a-=t.lastInd-t.firstInd);let i,o=e;for(;o.shadows&&void 0===o.shadows.propVariable;)o=this._components[o.shadows.componentName];t.ignoreChildChangeForComponent&&(i=e.componentName),this.calculatePrimitiveChildChanges({parent:o,definingInd:a,newValue:t.desiredValue,newStateVariableValues:r,markToIgnoreForParent:i})}}else{let u=s.downstreamPrimitives.slice(0,l+1).filter((e=>!e)).length-1,c=s.downstreamComponentNames[u];if(!c)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${o} child of index ${t.childIndex} does not exist.`);let p=s.mappedDownstreamVariableNamesByComponent[t.childIndex][t.variableIndex];if(!p)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${o} variable of index ${t.variableIndex} does not exist.`);let d={componentName:c,stateVariable:p,value:t.desiredValue,overrideFixed:e.overrideFixed,arrayKey:t.arrayKey};await this.requestComponentChanges({instruction:d,initialChange:!0===t.treatAsInitialChange,workspace:n,newStateVariableValues:r})}}else if("attributeComponent"===s.dependencyType){let l=s.downstreamComponentNames[0],u=s.mappedDownstreamVariableNamesByComponent[0][t.variableIndex];if(!u)throw Error(`Invalid inverse definition of ${i} of ${a.componentName}: ${o} variable of index ${t.variableIndex} does not exist.`);let c={componentName:l,stateVariable:u,value:t.desiredValue,overrideFixed:e.overrideFixed,arrayKey:t.arrayKey};await this.requestComponentChanges({instruction:c,initialChange:!0===t.treatAsInitialChange,workspace:n,newStateVariableValues:r})}else{if(!["stateVariable","parentStateVariable"].includes(s.dependencyType)||1!==s.downstreamComponentNames.length)throw Error(`unimplemented dependency type ${s.dependencyType} in requestComponentChanges`);{let l=s.downstreamComponentNames[0],u=s.mappedDownstreamVariableNamesByComponent[0][0],c={componentName:l,stateVariable:u,value:t.desiredValue,overrideFixed:e.overrideFixed,shadowedVariable:t.shadowedVariable};if(t.additionalDependencyValues){let e=this.components[l].state[u];for(let n in t.additionalDependencyValues){let r=this.dependencies.downstreamDependencies[a.componentName][i][n];if(!["stateVariable","parentStateVariable"].includes(r.dependencyType)||1!==r.downstreamComponentNames.length){console.warn(`Can't simultaneously set additional dependency value ${n} if it isn't a state variable`);continue}let s=r.mappedDownstreamVariableNamesByComponent[0][0];r.downstreamComponentNames[0]===l&&e.additionalStateVariablesDefined.includes(s)?(c.additionalStateVariableValues||(c.additionalStateVariableValues={}),c.additionalStateVariableValues[s]=t.additionalDependencyValues[n]):console.warn(`Can't simultaneously set additional dependency value ${n} if it doesn't correspond to additional state variable defined of ${o}'s state variable`)}}await this.requestComponentChanges({instruction:c,initialChange:!0===t.treatAsInitialChange,workspace:n,newStateVariableValues:r})}}}else{if(!t.combinedArray)throw console.log(t),Error(`Unrecognized instruction in inverse definition of ${i} of ${a.componentName}`);{let a={componentName:t.componentName,stateVariable:t.stateVariable,value:t.desiredValue,overrideFixed:e.overrideFixed,shadowedVariable:t.shadowedVariable};await this.requestComponentChanges({instruction:a,initialChange:!0===t.treatAsInitialChange,workspace:n,newStateVariableValues:r})}}}calculateEssentialVariableChanges({component:e,varName:t,value:n,newStateVariableValues:r,recurseToShadows:a=!0}){if(r[e.componentName]||(r[e.componentName]={}),e.state[t].isArray?(r[e.componentName][t]||(r[e.componentName][t]={mergeObject:!0}),Object.assign(r[e.componentName][t],n)):r[e.componentName][t]=n,a&&e.shadowedBy)for(let a of e.shadowedBy)void 0===a.shadows.propVariable&&this.calculateEssentialVariableChanges({component:a,varName:t,value:n,newStateVariableValues:r})}calculatePrimitiveChildChanges({parent:e,definingInd:t,newValue:n,newStateVariableValues:r,markToIgnoreForParent:a}){if(r[e.componentName]||(r[e.componentName]={}),e.componentName===a?r[e.componentName][`__def_primitive_ignore_${t}`]=n:r[e.componentName][`__def_primitive_${t}`]=n,e.shadowedBy)for(let i of e.shadowedBy)void 0===i.shadows.propVariable&&this.calculatePrimitiveChildChanges({parent:i,definingInd:t,newValue:n,newStateVariableValues:r,markToIgnoreForParent:a})}async saveState(){if(!this.flags.allowSaveState&&!this.flags.allowLocalState)return;let e=nanoid();this.flags.allowLocalState&&set(`${this.doenetId}|${this.pageNumber}|${this.attemptNumber}|${this.cid}`,{coreState:this.cumulativeStateVariableChanges,rendererState:this.rendererState,coreInfo:this.coreInfo,saveId:e}),postMessage({messageType:"savedState"}),this.flags.allowSaveState&&(this.pageStateToBeSavedToDatabase={cid:this.cid,coreInfo:this.coreInfoString,coreState:JSON.stringify(this.cumulativeStateVariableChanges,serializedComponentsReplacer),rendererState:JSON.stringify(this.rendererState,serializedComponentsReplacer),pageNumber:this.pageNumber,attemptNumber:this.attemptNumber,doenetId:this.doenetId,saveId:e,serverSaveId:this.serverSaveId,updateDataOnContentChange:this.updateDataOnContentChange},this.changesToBeSaved=!0,this.saveChangesToDatabase())}async saveChangesToDatabase(){if(null!==this.saveStateToDBTimerId||!this.changesToBeSaved)return;let e;this.changesToBeSaved=!1,this.saveStateToDBTimerId=setTimeout((()=>{this.saveStateToDBTimerId=null,this.saveChangesToDatabase()}),1e4);try{e=await axios.post("/api/savePageState.php",this.pageStateToBeSavedToDatabase)}catch(e){return void postMessage({messageType:"sendToast",args:{message:"Error synchronizing data.  Changes not saved to the server.",toastType:toastType.ERROR}})}if(console.log("result from saving to database:",e.data),null===e.status)return void postMessage({messageType:"sendToast",args:{message:"Error synchronizing data.  Changes not saved to the server.  Are you connected to the internet?",toastType:toastType.ERROR}});let t=e.data;t.success?(this.serverSaveId=t.saveId,this.flags.allowLocalState&&set(`${this.doenetId}|${this.pageNumber}|${this.attemptNumber}|${this.cid}|ServerSaveId`,t.saveId),t.stateOverwritten&&(this.attemptNumber!==Number(t.attemptNumber)||this.cid===t.cid?(this.flags.allowLocalState&&set(`${this.doenetId}|${this.pageNumber}|${t.attemptNumber}|${t.cid}`,{coreState:JSON.parse(t.coreState,serializedComponentsReviver),rendererState:JSON.parse(t.rendererState,serializedComponentsReviver),coreInfo:JSON.parse(t.coreInfo,serializedComponentsReviver),saveId:t.saveId}),postMessage({messageType:"resetPage",args:{changedOnDevice:t.device,newCid:t.cid,newAttemptNumber:Number(t.attemptNumber)}})):postMessage({messageType:"inErrorState",args:{errMsg:"Content changed unexpectedly!"}}))):postMessage({messageType:"sendToast",args:{message:t.message,toastType:toastType.ERROR}})}saveSubmissions({itemCreditAchieved:e,componentsSubmitted:t}){if(!this.flags.allowSaveSubmissions)return;const n={doenetId:this.doenetId,attemptNumber:this.attemptNumber,credit:e,itemNumber:this.itemNumber,componentsSubmitted:JSON.stringify(removeFunctionsMathExpressionClass(t),serializedComponentsReplacer)};console.log("payload for save credit for item",n),axios.post("/api/saveCreditForItem.php",n).then((e=>{if(console.log(">>>>saveCreditForItem resp",e.data),null===e.status)postMessage({messageType:"sendToast",args:{message:"Credit not saved due to error.  Are you connected to the internet?",toastType:toastType.ERROR}});else if(e.data.success){let t=e.data;postMessage({messageType:"updateCreditAchieved",args:t}),t.viewedSolution&&postMessage({messageType:"sendToast",args:{message:"No credit awarded since solution was viewed.",toastType:toastType.INFO}}),t.timeExpired&&postMessage({messageType:"sendToast",args:{message:"No credit awarded since the time allowed has expired.",toastType:toastType.INFO}}),t.pastDueDate&&postMessage({messageType:"sendToast",args:{message:"No credit awarded since the due date has passed.",toastType:toastType.INFO}}),t.exceededAttemptsAllowed&&postMessage({messageType:"sendToast",args:{message:"No credit awarded since no more attempts are allowed.",toastType:toastType.INFO}}),t.databaseError&&postMessage({messageType:"sendToast",args:{message:"Credit not saved due to database error.",toastType:toastType.ERROR}})}else postMessage({messageType:"sendToast",args:{message:`Credit not saved due to error: ${e.data.message}`,toastType:toastType.ERROR}})})).catch((e=>{postMessage({messageType:"sendToast",args:{message:`Credit not saved due to error: ${e.message}`,toastType:toastType.ERROR}})}))}async recordSolutionView(){try{const e=await axios.post("/api/reportSolutionViewed.php",{doenetId:this.doenetId,itemNumber:this.itemNumber,pageNumber:this.pageNumber,attemptNumber:this.attemptNumber});if(null===e.status){let e="Cannot show solution due to error.  Are you connected to the internet?";return postMessage({messageType:"sendToast",args:{message:e,toastType:toastType.ERROR}}),{allowView:!1,message:e,scoredComponent:this.documentName}}{let t=e.data;if(t.success)return{allowView:!0,message:"",scoredComponent:this.documentName};return{allowView:!1,message:`Cannot show solution due to error: ${t.message}`,scoredComponent:this.documentName}}}catch(e){let t="Cannot show solution due to error.";return postMessage({messageType:"sendToast",args:{message:t,toastType:toastType.ERROR}}),{allowView:!1,message:t,scoredComponent:this.documentName}}}get scoredItemWeights(){return(async()=>(await this.document.stateValues.scoredDescendants).map((e=>e.stateValues.weight)))()}requestAnimationFrame(e){postMessage({messageType:"requestAnimationFrame",args:e})}cancelAnimationFrame(e){postMessage({messageType:"cancelAnimationFrame",args:e})}}function validateAttributeValue({value:e,attributeSpecification:t,attribute:n}){if(t.valueTransformations&&e in t.valueTransformations&&(e=t.valueTransformations[e]),void 0===t.transformNonFiniteTo||Number.isFinite(e)||(e=t.transformNonFiniteTo),t.toLowerCase&&(e=e.toLowerCase()),t.trim&&(e=e.trim()),t.validValues){if(!t.validValues.includes(e)){let r=t.validValues[0];console.warn(`Invalid value ${e} for attribute ${n}, using value ${r}`),e=r}}else t.clamp&&(e<t.clamp[0]?e=t.clamp[0]:e>t.clamp[1]?e=t.clamp[1]:Number.isFinite(e)||(e=t.defaultValue));return e}function calculateAllComponentsShadowing(e){let t=[];if(e.shadowedBy)for(let n of e.shadowedBy)if(!n.shadows.propVariable){t.push(n.componentName);let e=calculateAllComponentsShadowing(n);t.push(...e)}if(e.replacementOf){let n=calculateAllComponentsShadowing(e.replacementOf);t.push(...n)}return t}return Core}();
